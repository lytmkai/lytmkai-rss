<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[React Native (Expo) iOS 真机调试失败排查：xcodebuild exited with error code 65]]></title>    <link>https://juejin.cn/post/7578793960628092954</link>    <guid>https://juejin.cn/post/7578793960628092954</guid>    <pubDate>2025-12-02T07:09:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578793960628092954" data-draft-id="7578793960628076570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Native (Expo) iOS 真机调试失败排查：xcodebuild exited with error code 65"/> <meta itemprop="keywords" content="前端,React Native"/> <meta itemprop="datePublished" content="2025-12-02T07:09:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="皮蛋小精灵"/> <meta itemprop="url" content="https://juejin.cn/user/219558056559278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Native (Expo) iOS 真机调试失败排查：xcodebuild exited with error code 65
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/219558056559278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    皮蛋小精灵
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:09:46.000Z" title="Tue Dec 02 2025 07:09:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Error code 65</strong>，这种情况 90% 是 <strong>缓存（Cache）</strong> 或者 <strong>临时文件冲突</strong> 导致的。</p>
<p>Error 65 是 Xcode 最“不负责任”的报错，它的意思是：“我编译失败了，但我懒得在命令行里告诉你具体原因。”</p>
<p>请按以下顺序排查，通常第一步或第二步就能解决：</p>
<h3 data-id="heading-0">第一步：用 Xcode 查看“真凶” (最推荐)</h3>
<p>命令行看不出具体错误，但 Xcode 的图形界面可以看到。</p>
<ol>
<li>
<p>打开项目目录下的 <code>ios</code> 文件夹。</p>
</li>
<li>
<p>双击 <strong><code>项目.xcworkspace</code></strong> (白色的图标)。</p>
</li>
<li>
<p>确保顶部设备选的是你的 iPhone。</p>
</li>
<li>
<p>点击左上角的 <strong>▶ (运行)</strong> 按钮。</p>
</li>
<li>
<p><strong>等待失败：</strong> Xcode 会报错停止。</p>
</li>
<li>
<p><strong>看左侧导航栏：</strong> 点击那个 <strong>红色感叹号/叉号</strong> 图标。</p>
</li>
<li>
<p><strong>看右侧详情：</strong> 你会看到具体是哪一行报错了。</p>
<ul>
<li><em>如果是 Signing 错误：</em> 重新登录账号或重新选 Team。</li>
<li><em>如果是文件丢失：</em> 说明 Pods 没装好。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-1">第二步：清理 Xcode 构建缓存 (最快尝试)</h3>
<p>既然上午能行，说明代码大概率没问题，是 Xcode 的中间文件坏了。</p>
<ol>
<li>在 Xcode 窗口中。</li>
<li>按下快捷键：<strong><code>Command (⌘) + Shift + K</code></strong> (或者菜单栏 Product -&gt; Clean Build Folder)。</li>
<li>等待清理完成（顶部提示 Clean Succeeded）。</li>
<li>再次点击 <strong>▶ 运行</strong>。</li>
</ol>
<hr/>
<h3 data-id="heading-2">第三步：删除 DerivedData (深度清理)</h3>
<p>如果第二步没用，那是 Xcode 的深层缓存坏了（DerivedData 经常出这种问题）。</p>
<ol>
<li>
<p>关闭 Xcode。</p>
</li>
<li>
<p>打开终端，运行这行命令（直接删除缓存文件夹）：</p>
<pre><code class="hljs language-Bash" lang="Bash"><span class="hljs-built_in">rm</span> -rf ~/Library/Developer/Xcode/DerivedData
</code></pre>
</li>
<li>
<p>重新运行 <code>npx expo run:ios --device</code>。</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">第四步：重置原生依赖 (万能修复)</h3>
<p>如果上面都无法解决，可能是 <code>node_modules</code> 或 <code>Pods</code> 里的文件连接断了。用 Expo 的命令重置一下：</p>
<ol>
<li>
<p>在项目根目录运行：</p>
<pre><code class="hljs language-Bash" lang="Bash"><span class="hljs-comment"># 这一步会删除 ios 文件夹并重新生成，非常干净</span>
npx expo prebuild --clean
</code></pre>
</li>
<li>
<p>重新运行：</p>
<pre><code class="hljs language-Bash" lang="Bash">npx expo run:ios --device
</code></pre>
</li>
</ol>
<h3 data-id="heading-4">为什么会这样？</h3>
<ul>
<li><strong>USB 连接波动：</strong> 编译过程中数据线松了一下，导致传输一半的文件损坏。</li>
<li><strong>锁屏：</strong> 编译安装时，如果手机锁屏了，有时候会导致安装失败（Error 65 也包含安装失败）。<strong>建议编译时保持手机屏幕常亮。</strong></li>
<li><strong>签名过期：</strong> 免费个人签名的有效期很短，有时候 Xcode 认为证书还有效，但实际上已经过时了，需要清理后重新生成。</li>
</ul>
<p><strong>大概率是 Xcode 抽风了，试一下“第二步”通常就好了。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【花朵识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法]]></title>    <link>https://juejin.cn/post/7578803491822878747</link>    <guid>https://juejin.cn/post/7578803491822878747</guid>    <pubDate>2025-12-02T07:20:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578803491822878747" data-draft-id="7578876665695338505" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【花朵识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法"/> <meta itemprop="keywords" content="图像识别,深度学习,人工智能"/> <meta itemprop="datePublished" content="2025-12-02T07:20:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ziwu"/> <meta itemprop="url" content="https://juejin.cn/user/607373397353726"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【花朵识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/607373397353726/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ziwu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:20:56.000Z" title="Tue Dec 02 2025 07:20:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、介绍</h2>
<p>花朵识别系统，基于TensorFlow搭建Resnet50卷积神经网络算法，通过对5种常见的花朵图片数据集（'雏菊', '蒲公英', '玫瑰', '向日葵', '郁金香'）进行训练，最后得到一个识别精度较高的模型，然后搭建Web可视化操作平台。</p>
<p><strong>技术栈</strong>：</p>
<ul>
<li>项目前端使用Html、CSS、BootStrap搭建界面。</li>
<li>后端基于Django处理逻辑请求</li>
<li>基于Ajax实现前后端数据通信</li>
</ul>
<p><strong>选题背景与意义</strong>：
在人工智能技术蓬勃发展的当下，图像识别领域成果丰硕，花朵识别作为其中细分方向，具有广泛的应用场景，如植物研究、花卉市场管理等。然而，传统花朵识别方法依赖人工经验，效率与准确性欠佳。为此，我们开展花朵识别系统项目，基于TensorFlow搭建Resnet50卷积神经网络算法，利用5种常见花朵图片数据集训练，以获取高精度识别模型。同时，为方便用户操作，采用Html、CSS等搭建前端界面，Django处理后端逻辑，Ajax实现数据通信，搭建Web可视化平台。</p>
<h2 data-id="heading-1">二、系统效果图片展示</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4503cb112fdf4057b84368934fb4ff36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264855&amp;x-signature=RXbPRhHCFjDVnLvF1RwquRTX4wI%3D" alt="图片" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1f071651a424f03986f748e67315766~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264855&amp;x-signature=VDydddwo3zgKxSwSdgW0VCV9pFc%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-2">三、演示视频 and 完整代码 and 安装</h2>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fziwupy.cn%2Fp%2F6D4JhD" target="_blank" title="https://ziwupy.cn/p/6D4JhD" ref="nofollow noopener noreferrer">ziwupy.cn/p/6D4JhD</a></p>
<h2 data-id="heading-3">四、卷积神经网络算法介绍</h2>
<p>ResNet50 是深度残差网络（Residual Network）的一种，由微软研究院提出。它通过引入残差块（Residual Block）解决了深度神经网络训练中的梯度消失和梯度爆炸问题，使得网络可以训练得更深。残差块通过跳跃连接（skip connection）将输入直接传递到输出层，让网络学习残差映射而非完整映射，降低了训练难度。ResNet50 包含 50 层深度网络，具有强大的特征提取能力，在图像分类、目标检测等任务中表现优异。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> tensorflow.keras.applications.resnet50 <span class="hljs-keyword">import</span> ResNet50, preprocess_input
<span class="hljs-keyword">from</span> tensorflow.keras.preprocessing <span class="hljs-keyword">import</span> image
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 加载预训练的 ResNet50 模型（不包含顶层分类层）</span>
model = ResNet50(weights=<span class="hljs-string">'imagenet'</span>, include_top=<span class="hljs-literal">False</span>, pooling=<span class="hljs-string">'avg'</span>)

<span class="hljs-comment"># 加载并预处理图像</span>
img_path = <span class="hljs-string">'your_image.jpg'</span>
img = image.load_img(img_path, target_size=(<span class="hljs-number">224</span>, <span class="hljs-number">224</span>))
x = image.img_to_array(img)
x = np.expand_dims(x, axis=<span class="hljs-number">0</span>)
x = preprocess_input(x)

<span class="hljs-comment"># 提取特征</span>
features = model.predict(x)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"提取的特征向量维度:"</span>, features.shape)

</code></pre>
<p>上述代码先加载预训练的 ResNet50 模型（基于 ImageNet 数据集训练），然后加载并预处理图像，最后使用模型提取图像特征。实际应用中，可在此基础上添加自定义分类层进行图像识别任务。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙 ArkUI 从零到精通：基础语法全解析]]></title>    <link>https://juejin.cn/post/7578902814022565903</link>    <guid>https://juejin.cn/post/7578902814022565903</guid>    <pubDate>2025-12-02T07:21:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578902814022565903" data-draft-id="7576573061580537897" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙 ArkUI 从零到精通：基础语法全解析"/> <meta itemprop="keywords" content="前端,HarmonyOS,Android"/> <meta itemprop="datePublished" content="2025-12-02T07:21:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hqk"/> <meta itemprop="url" content="https://juejin.cn/user/2357827986264942"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙 ArkUI 从零到精通：基础语法全解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2357827986264942/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hqk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:21:01.000Z" title="Tue Dec 02 2025 07:21:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文参与了<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2F7e230b074eaa41c587c71c1d1a9a6514%3Ftype%3D1%3Fha_source%3Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/7e230b074eaa41c587c71c1d1a9a6514?type=1?ha_source=hmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">华为官方活动：HarmonyOS赋能资源丰富度建设</a></p>
<h2 data-id="heading-0">前言</h2>
<p>在上一篇中，讲解了<a href="https://juejin.cn/post/7576057623742464042" target="_blank" title="https://juejin.cn/post/7576057623742464042">鸿蒙ArkTS基础语法</a> ，本篇将会讲解ArkUI相关的知识点。</p>
<h2 data-id="heading-1">1、ArkUI介绍</h2>
<p>ArkUI：Ability kit在UIAbility组件可以使用ArkUI提供的组件，事件，动效，状态管理等能力。</p>
<p>我们先来看看ArkUI的<strong>基本结构</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e560ee37da674992bb5494d5a118bb90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=zf9sc8NRkvJZ7quhh1treFnkX%2FQ%3D" alt="QQ_1764139591463.png" loading="lazy"/>
如图所示：</p>
<ul>
<li>
<p>ArkUI基本结构包含：<strong>装饰器</strong>、<strong>自定义组件</strong>、<strong>系统组件</strong>、以及组件内一系列<strong>属性方法与事件方法</strong>等</p>
</li>
<li>
<p>装饰器：用于装饰类、结构、方法以及变量，并赋予对应的含义。如上图所示<code>@Entry</code>、<code>@Component</code>和<code>@State</code>都是装饰器</p>
<ul>
<li><code>@Entry</code>：表示该自定义组件为入口组价</li>
<li><code>@Component</code>：表示自定义组件</li>
<li><code>@State</code>：表示组件中的状态变量，状态变量变化会触发UI刷新</li>
</ul>
</li>
<li>
<p>UI描述：以声明式的方法来描述UI的结构，如上图所示 build()方法中的代码块</p>
</li>
<li>
<p>自定义组件：可复用的UI模块，可组合其他组件，如上图所示被<code>@Component</code>修饰的<code>struct Page4</code></p>
</li>
<li>
<p>属性方法：组件可以通过链式调用对应组件的多项属性方法，如<code>id()</code>、<code>width()</code>、<code>fontSize()</code>等</p>
</li>
<li>
<p>事件方法：组件可以通过链式调用设置多个事件的响应逻辑，如<code>onClick()</code></p>
</li>
</ul>
<p>当我们掌握了 ArkUI 的基本结构后，会发现 <strong>UI的最终呈现其实是由一个个组件拼起来的</strong>。</p>
<p>所以在理解“框架怎么组织 UI”之后，我们下一步就需要弄清楚：“真正构成 UI 的那些组件有哪些？它们各自怎么用？”</p>
<p>因此，下面我们就正式进入ArkUI的组件学习部分，我们将通过一系列小案例由浅入深逐步对ArkUI进行讲解。</p>
<h2 data-id="heading-2">2、ArkUI组件讲解</h2>
<p>ArkUI系统组件又分为：容器组件、基础组件。</p>
<h3 data-id="heading-3">2.1 容器组件</h3>
<p>容器组件顾名思义类似于一个容器一样，可以装下不同的组件。那该如何使用呢？那么就迎来了第一个容器组件<code>Row</code></p>
<h4 data-id="heading-4">2.1.1 Row容器组件</h4>
<p>我们先来看第一个小案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct Index {
  build() {
    Row({space: 20}){
      Text("字符串1").width(100).height(100).backgroundColor(Color.Pink)
      Text("字符串2").width(100).height(100).backgroundColor(Color.Red)
      Text("字符串3").width(100).height(100).backgroundColor(Color.Blue).fontColor(Color.White)
    }
    .width('100%')
    .height('100%')
    .border({color:Color.Red, style: BorderStyle.Dashed, width:1})
    .backgroundColor(Color.Yellow)
    .justifyContent(FlexAlign.SpaceEvenly)
    .alignItems(VerticalAlign.Center)
  }
}
</code></pre>
<p>运行效果图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13275a67886448468d15e47ccd980afc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=nJslVIxGRIWVk0SBh%2FidJOHqTP8%3D" alt="QQ_1764225287496.png" loading="lazy"/></p>
<p>在这个案例中：</p>
<ul>
<li><code>Row{}</code>里面包含了三个组件，并且这三个组件是水平排列</li>
<li><code>Row{}</code>设置了不同的属性
<ul>
<li><code>{space: 20}</code>表示容器内组件之间的间距为<code>20vp</code>，这个<code>vp</code>就好比<code>Android</code>里面的<code>dp</code>单位</li>
<li><code>.width('100%').height('100%')</code>，表示宽高都是100%，充满整个屏幕</li>
<li><code>border({color:Color.Red, style: BorderStyle.Dashed, width:1})</code>给这个<code>Row</code>组件设置了边框以及边框属性</li>
<li><code>.justifyContent(FlexAlign.SpaceEvenly)</code>给这个<code>Row</code>组件设置了<strong>水平对齐方式，这个属性方法它和这个<code>Row{}</code>组件是同一种对齐方向</strong></li>
<li><code>.alignItems(VerticalAlign.Center)</code>给这个<code>Row</code>组件设置了<strong>垂直对齐方式，这个属性方法它和这个<code>Row{}</code>组件是相反的对齐方向</strong></li>
</ul>
</li>
</ul>
<p>看到这是不是会想：那我咋知道这些组件有哪些方法？然后这些方法又该如何赋值呢？不可能每个组件我都要去死记硬背涩！</p>
<h5 data-id="heading-5">2.1.1.1 源码剖析</h5>
<p>所谓的授人以鱼不如授人以渔！我这将一步一步的带你去剖析源码，就算以后遇到陌生组件也能让你更快的熟悉并使用它！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0c1bd004395473ca6adaa0d889ac683~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=L92oMPG%2Fngi9nUErnCh%2FCWe7f04%3D" alt="QQ_1764227796785.png" loading="lazy"/></p>
<p><strong>如图所示</strong></p>
<p>按住<code>Ctrl</code>+鼠标左键点击<code>Row</code>，你将会看到这样的代码</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">Row</span>: RowInterface;
</code></pre>
<p>继续按住<code>Ctrl</code>+鼠标左键点击<code>RowInterface</code>，将会是如下代码：</p>
<pre><code class="hljs language-css" lang="css">interface RowInterface {
    (value?: {
        space?: string | number;
    }): RowAttribute;
}
</code></pre>
<p>这里只看到刚刚 <code>Row({space: 20})</code>这句代码的使用方式</p>
<ul>
<li><code>value? </code> 有<code>?</code>修饰说明了这个value可为空，而这个值的类型是 <code>{space?: string | number;}</code>这样的结构体</li>
<li><code>{space?: string | number;}</code>这样的结构体里面只有<code>space?</code>变量，而且这个变量也有<code>?</code>修饰，说明了这个<code>space</code>也可为空，而这个值类型是<code>string | number</code>，说明了，如果值不为空的话，那么<code>space</code>要么是<code>string</code>要么是 <code>number</code></li>
</ul>
<p>所以在使用<code>Row</code>组件时，构造方法里面可以传<code>{space?: string | number;}</code> 这样的结构体</p>
<p>然而这里没看到想要的属性方法，继续往下看，按住<code>Ctrl</code>+鼠标左键点击<code>RowAttribute</code>，将会是如下代码：</p>
<pre><code class="hljs language-scala" lang="scala">declare <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RowAttribute</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CommonMethod&lt;RowAttribute&gt;</span> </span>{

 <span class="hljs-comment">//Called when the vertical alignment is set.</span>
 alignItems(value: <span class="hljs-type">VerticalAlign</span>): <span class="hljs-type">RowAttribute</span>;
 
 <span class="hljs-comment">//Called when the horizontal alignment is set.</span>
 justifyContent(value: <span class="hljs-type">FlexAlign</span>): <span class="hljs-type">RowAttribute</span>;

 reverse(isReversed: <span class="hljs-type">Optional</span>&lt;boolean&gt;): <span class="hljs-type">RowAttribute</span>;
 
}
</code></pre>
<p>到这里我们看到<code>Row</code>组件特有的属性<code>alignItems</code>、<code>justifyContent</code>、<code>reverse</code>，对应属性方法的值范围，可以继续按照刚刚的方式往下看</p>
<p>不过在这里面我们就只看到这三个属性方法，上面案例里的<code>width</code>以及其他的属性方法呢？</p>
<p>我们看到<code>class RowAttribute extends CommonMethod&lt;RowAttribute&gt;</code>这句代码，<a href="https://juejin.cn/post/7576057623742464042" target="_blank" title="https://juejin.cn/post/7576057623742464042">在上一篇基础语法中</a>，讲解了这是继承关系，也就是<code>RowAttribute</code>拥有了<code>CommonMethod</code>所有非私有的属性以及方法</p>
<p>那继续按住<code>Ctrl</code>+鼠标左键点击<code>CommonMethod</code>，将会是如下代码：</p>
<pre><code class="hljs language-scss" lang="scss">declare class CommonMethod&lt;T&gt; {
  <span class="hljs-comment">//....省略部分代码</span>
  <span class="hljs-attribute">width</span>(value: Length): T;
  
  <span class="hljs-attribute">height</span>(value: Length): T;
  
  <span class="hljs-attribute">padding</span>(value: Padding | Length | LocalizedPadding): T
  
  <span class="hljs-built_in">background</span>(builder: CustomBuilder, options?: {
    align?: Alignment;
  }): T;
  
  <span class="hljs-attribute">border</span>(value: BorderOptions): T;
  
  <span class="hljs-built_in">backgroundColor</span>(value: ResourceColor): T;
 <span class="hljs-comment">//....省略部分代码</span>

</code></pre>
<p>在这里我们就看到了我们案例上使用的所有属性方法了。这里可以总结出：<strong>组件都有它自己独有的属性，并且非独有（公共）属性通过<code>extends CommonMethod&lt;T&gt;</code> 方式获得</strong></p>
<p>这里我们熟悉了<code>Row</code>组件，继续下一个组件</p>
<h4 data-id="heading-6">2.1.2 Column容器组件</h4>
<p>我们接着来看案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct ColumnPage {
  build() {
    Column({space: 20}){
      Row().width(100).height(100).backgroundColor(Color.Pink)
      Row().width(100).height(100).backgroundColor(Color.Yellow)
      Row().width(100).height(100).backgroundColor(Color.Blue)
      Row().width(100).height(100).backgroundColor(Color.Green)
    }
    .width('100%')
    .height('100%')
    .backgroundColor(Color.Gray)
    .justifyContent(FlexAlign.SpaceEvenly)
    .alignItems(HorizontalAlign.End)
  }
}
</code></pre>
<p>运行效果图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1c37862201240e39994c5a5fe5689d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=W4ypeU4fBNe7MqJWE1ewFGDo%2Bjc%3D" alt="QQ_1764230669769.png" loading="lazy"/></p>
<p>在这个案例中：</p>
<ul>
<li><code>Column{}</code>里面包含了四个组件，并且这四个组件是垂直排列</li>
<li><code>.justifyContent(FlexAlign.SpaceEvenly)</code>给这个<code>Column</code>组件设置了<strong>垂直对齐方式，这个属性方法它和这个<code>Column{}</code>组件是同一种对齐方向</strong></li>
<li><code>.alignItems(HorizontalAlign.End)</code>给这个<code>Column</code>组件设置了<strong>水平对齐方式，这个属性方法它和这个<code>Column{}</code>组件是相反的对齐方向</strong></li>
</ul>
<p>这个<code>Column</code>列组件与<code>Row</code>行组件是相反的，特别注意<code>Column</code>的<code>.alignItems(HorizontalAlign.End)</code>属性方法里面是<code>HorizontalAlign</code>，而<code>Row</code>的<code>.alignItems(VerticalAlign.Center)</code>是<code>VerticalAlign</code>。</p>
<p>OK，我们继续下一个组件！</p>
<h4 data-id="heading-7">2.1.3 Flex容器组件</h4>
<p>Flex（弹性组件）提供更加有效的方式对容器中的子元素进行排列、对齐和分配剩余空间。</p>
<p>容器默认存在主轴与交叉轴，子元素默认沿主轴排列，子元素在主轴方向的尺寸称为主轴尺寸，在交叉轴方向的尺寸称为交叉轴尺寸。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aad9cc84edce4ba69e71cf54f60f51fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=5LMTuPo%2F8jF5METoN7ARxt258Os%3D" alt="0000000000011111111.20250314163923.55033350674177624945588898470143.png" loading="lazy"/></p>
<p>既然<code>Flex</code>容器可以改变子元素在主轴与交叉轴排列，那么我们就能复刻<code>Row</code>组件以及<code>Column</code>组件</p>
<p>注意：</p>
<ul>
<li>当Flex容器为<code>Row</code>、<code>RowReverse</code>排列时，主轴与交叉轴就为图中所示；</li>
<li>当Flex容器为<code>Column</code>、<code>ColumnReverse</code>排列时，图中的主轴变交叉轴，交叉轴变主轴</li>
</ul>
<h5 data-id="heading-8">2.1.3.1 复刻Row组件</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { LengthMetrics } from '@kit.ArkUI';

@Entry
@Component
struct FlexiblePage {
  build() {
    Flex({
      direction: FlexDirection.Row,
      justifyContent: FlexAlign.Start,
      alignItems: ItemAlign.Start,
      wrap: FlexWrap.NoWrap,
      space: { main: LengthMetrics.vp(20), cross: LengthMetrics.vp(30) }
    }) {
      Column().width(100).height(200).backgroundColor(Color.Pink)
      Column().width(100).height(200).backgroundColor(Color.Red)
      Column().width(100).height(200).backgroundColor(Color.Blue)

      Column().width(100).height(200).backgroundColor(Color.White)
      Column().width(100).height(200).backgroundColor(Color.Green)
      Column().width(100).height(200).backgroundColor(Color.Orange)
    }
    .margin({ top: 10 })
    .width('100%')
    .height('100%')
    .backgroundColor(Color.Gray)
  }
}
</code></pre>
<p>运行效果图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2851334b2c614cf08377cd6b9189054b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=PKp%2B2pdy%2BLCA1%2B8YziUMfEaZq8o%3D" alt="QQ_1764233341962.png" loading="lazy"/></p>
<p>在这个案例中</p>
<ul>
<li>使用<code>direction: FlexDirection.Row</code>让<code>Flex</code>组件成功复刻了<code>Row</code>组件特性</li>
<li>当然<code>justifyContent</code>与<code>alignItems</code>也具备了<code>Row</code>组件特性</li>
</ul>
<p>刚刚复刻了<code>Row</code>组件，来试试复刻<code>Column</code>组件</p>
<h5 data-id="heading-9">2.1.3.2 复刻Column组件</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { LengthMetrics } from '@kit.ArkUI';

@Entry
@Component
struct FlexiblePage {
  build() {
   复刻了`Column`组件
   - ({
      direction: FlexDirection.Column,
      justifyContent: FlexAlign.Start,
      alignItems: ItemAlign.Start,
      wrap: FlexWrap.NoWrap,
      space: { main: LengthMetrics.vp(20), cross: LengthMetrics.vp(30) }
    }) {
      Column().width(100).height(200).backgroundColor(Color.Pink)
      Column().width(100).height(200).backgroundColor(Color.Red)
      Column().width(100).height(200).backgroundColor(Color.Blue)

      Column().width(100).height(200).backgroundColor(Color.White)
      Column().width(100).height(200).backgroundColor(Color.Green)
      Column().width(100).height(200).backgroundColor(Color.Orange)
    }
    .margin({ top: 10 })
    .width('100%')
    .height('100%')
    .backgroundColor(Color.Gray)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7cb176a192d4eaebae0ee1155eef561~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=ARfiuuimkaXMpARbkkIC0KrU0mI%3D" alt="QQ_1764235343899.png" loading="lazy"/></p>
<p>在这个案例中</p>
<ul>
<li>仅仅改变了<code>direction</code>的值，成功的复刻了<code>Column</code>组件</li>
<li>对应<code>justifyContent</code>与<code>alignItems</code>也具备了<code>Column</code>组件特性</li>
<li>案例里面<code>wrap</code>表示是否多行，<code>NoWrap</code>也就是不允许，读者可以自行测试多行效果，这里不在赘述</li>
<li><code>space</code> 设置元素之间的间距。<code>main</code>主轴元素之间间距；<code>cross</code>交叉轴之间的间距（注意不同的<code>direction</code>的值，主轴、交叉轴不同哟）</li>
</ul>
<p>OK，我们继续下一个！</p>
<h4 data-id="heading-10">2.2.4 Stack容器组件</h4>
<p>Stack案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct StackPage {
  @State message: string = 'Hello World';

  build() {
    Stack({alignContent: Alignment.Center}) {
      Column().width('90%').height('90%').backgroundColor(Color.Pink).zIndex(1)
      Column().width('50').height('50').backgroundColor(Color.Blue).zIndex(3)
      Column().width('150').height('150').backgroundColor(Color.Green).zIndex(2)
    }
    .height('100%')
    .width('100%')
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f335b15f71149a89ffdbbfdebf4c707~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=HCpINo0cJxVFX5Ez%2B8g6V%2F8e3w4%3D" alt="QQ_1764237543527.png" loading="lazy"/></p>
<p>在这个案例中：</p>
<ul>
<li>有三个大小不一的元素在里面通过<code>{alignContent: Alignment.Center}</code>实现了所有元素居中对齐。（一共有9中对齐方式，读者可以亲自尝试）</li>
<li><code>.zIndex(1)</code>通过这个属性方法设置 层级的优先级，数字越大，层级越靠前。<strong>可以将这个理解为厨房叠盘子，数字越大盘子就越上面，如果上面的盘子比下面的大，那就看不到下面的盘子</strong></li>
</ul>
<p>这个没什么难度，继续下一个！</p>
<h4 data-id="heading-11">2.2.5 Grid容器组件</h4>
<h5 data-id="heading-12">2.2.5.1 Grid案例一</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct GridPage {
  build() {
    Grid() {
      GridItem() {
        Row() {
          Column() {
            Text('商品名称')
          }
          .width('100%')
        }
      }.width("100%").height(100).backgroundColor(Color.Gray)
      GridItem().width("100%").height(100).backgroundColor(Color.Gray)
      GridItem().width("100%").height(100).backgroundColor(Color.Gray)
      GridItem().width("100%").height(100).backgroundColor(Color.Gray)
      GridItem().width("100%").height(100).backgroundColor(Color.Gray)
      GridItem().width("100%").height(100).backgroundColor(Color.Gray)
      GridItem().width("100%").height(100).backgroundColor(Color.Gray)
      GridItem().width("100%").height(100).backgroundColor(Color.Gray)
    }
    .height('100%')
    .width('100%')
    .columnsTemplate('1fr 1fr 1fr 1fr')
    .rowsGap(10)
    .columnsGap(10)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4067eb34d8e04e6e848e8186d5577dfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=XgDJKC3mll%2FeoeinfP0Y%2FL74QUA%3D" alt="QQ_1764299740119.png" loading="lazy"/></p>
<p>在这个案例中：</p>
<ul>
<li><code>Grid</code>组件需要结合<code>GridItem</code>组件一起使用，并且这两个组件都是容器组件。</li>
<li><code>.columnsTemplate('1fr 1fr 1fr 1fr')</code>属性方法表示该<code>Grid</code>组件分为几列数据，其中的<code>1fr</code>表示该列权重占比</li>
<li><code>rowsGap</code>与<code>columnsGap</code>分别表示设置 行间距以及列间距</li>
</ul>
<p>那现在问题来了，案例一的<code>GridItem</code>组件就仅仅第一个添加了基本组件，而且还仅仅只是一个<code>Text</code>组件，结构层次就已经比较多了，试想一下，如果<code>Item</code>内容再复杂一点，那代码岂不是很冗余？</p>
<p>带着这样的问题，我们来看下一个案例：</p>
<h5 data-id="heading-13">2.2.5.2 Grid案例二</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct GridPage {
  build() {
    Grid() {
      GirdItemComponent()
      GirdItemComponent()
      GirdItemComponent()
      GirdItemComponent()
      GirdItemComponent()
      GirdItemComponent()
      GirdItemComponent()
      GirdItemComponent()
      GirdItemComponent()
      GirdItemComponent()
      GirdItemComponent()
      GirdItemComponent()
    }
    .height('100%')
    .width('100%')
    .columnsTemplate('1fr 1fr 1fr 1fr')
    .rowsGap(10)
    .columnsGap(10)
  }
}

@Component
struct GirdItemComponent {
  build() {
    GridItem() {
      Row() {
        Column() {
          Text('商品名称')
        }.width('100%')
      }.height(100)
    }.borderRadius(4)
    .backgroundColor(Color.Pink)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e1ea64e4f5742c89114d70e0349aa96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=ijnLgRzhj3971TSDyrNna0Rm7S0%3D" alt="QQ_1764300613985.png" loading="lazy"/></p>
<p>在这个案例中：</p>
<ul>
<li>我们将<code>GridItem</code>放在了新的<code>struct GirdItemComponent</code>里面，并且用<code>@Component</code>修饰，此时<code>GirdItemComponent</code>已经被我们封装成了<strong>自定义组件</strong></li>
</ul>
<p>不过现在还有个问题：<code>GirdItemComponent()</code>数量目前是代码写死的，如何通过数据源动态渲染呢？</p>
<h5 data-id="heading-14">2.2.5.3 Grid案例三</h5>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct GridPage {
  listData:Array&lt;number&gt;=[1,2,3,4,5,6,7,8,9,10,11,12]
  build() {
    Grid() {
      ForEach(this.listData,(item:number,index:number)=&gt;{
        GirdItemComponent()
      })
    }
    .height('100%')
    .width('100%')
    .columnsTemplate('1fr 1fr 1fr 1fr')
    .rowsGap(10)
    .columnsGap(10)
  }
}
//部分代码省略......

</code></pre>
<p>在这个案例中</p>
<ul>
<li>使用<code>ForEach</code>循环，成功的通过数据源的数量动态渲染<code>GridItem</code></li>
</ul>
<p>接着讲下一个组件！</p>
<h4 data-id="heading-15">2.2.6 RelativeContainer 容器组件</h4>
<p>相对布局组件，用于复杂场景中元素对齐的布局。它可以根据组件与组件的关系，设置并定位对应自己的不同的位置。</p>
<p>RelativeContainer 案例</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct Page2 {
  build() {
    Row() {
      RelativeContainer() {
        Row(){Text('row1')}.justifyContent(FlexAlign.Center)
        .width(100).height(100)
        .backgroundColor("#FF3333")
        .alignRules({
          top: {anchor: "__container__", align: VerticalAlign.Top},
          left: {anchor: "__container__", align: HorizontalAlign.Start}
        })
        .id("row1")

        Row(){Text('row2')}.justifyContent(FlexAlign.Center)
        .width(100).height(100)
        .backgroundColor("#FFCC00")
        .alignRules({
          top: {anchor: "__container__", align: VerticalAlign.Top},
          right: {anchor: "__container__", align: HorizontalAlign.End}
        })
        .id("row2")

        Row(){Text('row3')}.justifyContent(FlexAlign.Center)
        .height(100)
        .backgroundColor("#FF6633")
        .alignRules({
          top: {anchor: "row1", align: VerticalAlign.Bottom},
          left: {anchor: "row1", align: HorizontalAlign.End},
          right: {anchor: "row2", align: HorizontalAlign.Start}
        })
        .id("row3")

        Row(){Text('row4')}.justifyContent(FlexAlign.Center)
        .backgroundColor("#FF9966")
        .alignRules({
          top: {anchor: "row3", align: VerticalAlign.Bottom},
          bottom: {anchor: "__container__", align: VerticalAlign.Bottom},
          left: {anchor: "__container__", align: HorizontalAlign.Start},
          right: {anchor: "row1", align: HorizontalAlign.End}
        })
        .id("row4")

        Row(){Text('row5')}.justifyContent(FlexAlign.Center)
        .backgroundColor("#FF66FF")
        .alignRules({
          top: {anchor: "row3", align: VerticalAlign.Bottom},
          bottom: {anchor: "__container__", align: VerticalAlign.Bottom},
          left: {anchor: "row2", align: HorizontalAlign.Start},
          right: {anchor: "__container__", align: HorizontalAlign.End}
        })
        .id("row5")
      }
      .width(300).height(300)
      .margin({left: 50})
      .border({width:2, color: "#6699FF"})
    }
    .height('100%')
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fc4db1db5e44bafb46f369ef21f8c20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=gvoZEu8eMfuC7jxvt%2FYrkMVcYD0%3D" alt="QQ_1764315080855.png" loading="lazy"/></p>
<p>在这个案例中：</p>
<ul>
<li>
<p>在<code>RelativeContainer</code>组件里，子组件位置通过<code>.alignRules(xx)</code>属性方法，设置当前子组件的位置</p>
</li>
<li>
<p>在<code>.alignRules(xx)</code>属性方法里，可以分别设置<code>top</code>、<code>bottom</code>、<code>left</code>、<code>right</code>、<code>center</code>、<code>middle</code>,不同方位以及居中对齐参数，但他们无非都是分为<strong>垂直方向以及水平方向</strong></p>
<ul>
<li><code>top</code>、<code>bottom</code>、<code>center</code> 这三个是垂直方向</li>
<li><code>left</code>、<code>right</code>、<code>middle</code> 这三个是水平方向</li>
</ul>
</li>
<li>
<p>在<code>{anchor: "xxx", align: xxx}</code>结构体中，<strong>不同的方向将会有不同的设置约束的方式</strong>，</p>
<ul>
<li>水平方向通过<code>align: HorizontalAlign.xxx</code>赋值</li>
<li>垂直方向通过<code>align: VerticalAlign.xxx</code>赋值</li>
</ul>
</li>
<li>
<p>在<code>{anchor: "xxx", align: xxx}</code>结构体中，当前子组件可以通过<code>anchor: "xxx"</code>与其他子组件或父组件建立约束</p>
<ul>
<li><code>anchor: "__container__"</code> 这个表示与父容器建立约束</li>
<li><code>anchor: "row3"</code> 这个表示与<code>row3</code>组件建立约束。而<code>row3</code>组件通过<code>.id("row3")</code>设置并命名了自己就是<code>row3</code>组件</li>
</ul>
</li>
<li>
<p>在<code>Row4</code>与<code>Row5</code>组件里，它俩分别建立了四个方位的约束，因此在没有设置<code>width</code>与<code>height</code>时，它也会自动根据约束生成对应的宽高长度</p>
</li>
</ul>
<p>OK，常用的容器组件，已经讲完了。现在我们开始讲解基础组件。</p>
<h3 data-id="heading-16">2.2 基础组件</h3>
<p>基础组件比较简单，我这准备用一些小案例来讲解基础组件如何使用</p>
<h4 data-id="heading-17">2.2.1 案例一：</h4>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct TextPage {
  @State message: string = 'Hello World';
  build() {
    RelativeContainer() {
      Text(this.message)
        .id('TextPageHelloWorld')
        .fontSize(50)
        .fontWeight(FontWeight.Bold)
        .alignRules({
          center: { anchor: '__container__', align: VerticalAlign.Center },
          middle: { anchor: '__container__', align: HorizontalAlign.Center }
        })

      Button('点我改变文本')
        .alignRules({
          top: { anchor: 'TextPageHelloWorld', align: VerticalAlign.Bottom },
          middle: { anchor: '__container__', align: HorizontalAlign.Center }
        })
        .onClick(() =&gt; {
          this.clickBtn()
        })
        .margin({ top: 20 })
    }
    .height('100%')
    .width('100%')
  }

  private clickBtn() {
    this.message = "我改变了Text"
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/001f5c7289ac467580f7b2cffdb2ccb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=MviNYS0Rkzaykn8mlbxkRUvDQiU%3D" alt="ezgif-50a344ea2841ebb4.gif" loading="lazy"/></p>
<p>在这个示例中：</p>
<ul>
<li>使用了<code>Text</code>、<code>Button</code>组件，而<code>Text</code>文本是通过变量<code>message</code>赋值，这个变量使用了<code>@State</code>修饰符</li>
<li><code>@State</code>又名：<strong>状态变量装饰器</strong>，被它修饰的变量<code>message</code>称为<strong>状态变量</strong>（让普通变量具备状态属性），也就是说当状态变量改变时，将会触发绑定的UI组件渲染更新</li>
<li>因此在<code>Button</code>点击事件里，改变了<code>message</code>状态变量，让<code>Text</code>组件渲染更新了最新的文本</li>
</ul>
<p>这个很简单，现在逐渐上难度</p>
<h4 data-id="heading-18">2.2.2 案例二：</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> { promptAction } from <span class="hljs-string">'@kit.ArkUI'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct LoginPage {

  <span class="hljs-meta">@State</span> phone: string = <span class="hljs-string">''</span>
  <span class="hljs-meta">@State</span> password: string = <span class="hljs-string">''</span>
  <span class="hljs-meta">@State</span> smsCode: string = <span class="hljs-string">''</span>

  <span class="hljs-meta">@State</span> loginByPassword: boolean = <span class="hljs-literal">true</span> <span class="hljs-comment">// true=密码登录，false=验证码登录</span>

  <span class="hljs-comment">// 验证码倒计时</span>
  <span class="hljs-meta">@State</span> counter: number = <span class="hljs-number">0</span>
  <span class="hljs-keyword">private</span> timerId: number = <span class="hljs-number">0</span>

  build() {
    Column({ space: <span class="hljs-number">20</span> }) {

      Text(<span class="hljs-string">"手机登录"</span>)
        .fontSize(<span class="hljs-number">30</span>)
        .fontWeight(FontWeight.Bold)
        .margin({ top: <span class="hljs-number">40</span> })

      <span class="hljs-comment">/** 手机号输入框 */</span>
      Row() {
        TextInput({ placeholder: <span class="hljs-string">'请输入手机号'</span> })
          .type(InputType.Number)
          .maxLength(<span class="hljs-number">11</span>)
          .onChange(v =&gt; <span class="hljs-keyword">this</span>.phone = v)
      }
      .padding(<span class="hljs-number">12</span>)
      .backgroundColor(<span class="hljs-string">'#F7F7F7'</span>)
      .borderRadius(<span class="hljs-number">8</span>)
      .width(<span class="hljs-string">'85%'</span>)

      <span class="hljs-comment">/** 密码登录区域 */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.loginByPassword) {
        Row() {
          TextInput({ placeholder: <span class="hljs-string">'请输入密码'</span> })
            .type(InputType.Password)
            .onChange(v =&gt; <span class="hljs-keyword">this</span>.password = v)
        }
        .padding(<span class="hljs-number">12</span>)
        .backgroundColor(<span class="hljs-string">'#F7F7F7'</span>)
        .borderRadius(<span class="hljs-number">8</span>)
        .width(<span class="hljs-string">'85%'</span>)
      }

      <span class="hljs-comment">/** 验证码登录区域 */</span>
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.loginByPassword) {
        Row({ space: <span class="hljs-number">10</span> }) {
          TextInput({
            placeholder: <span class="hljs-string">'请输入验证码'</span>
          })
            .onChange(v =&gt; <span class="hljs-keyword">this</span>.smsCode = v)
            .width(<span class="hljs-string">'60%'</span>)
          <span class="hljs-comment">// 发送验证码按钮</span>
          Button(
            <span class="hljs-keyword">this</span>.counter &gt; <span class="hljs-number">0</span>
              ? `${<span class="hljs-keyword">this</span>.counter} 秒后重试`
              : <span class="hljs-string">'发送验证码'</span>
          )
            .height(<span class="hljs-number">40</span>)
            .borderRadius(<span class="hljs-number">6</span>)
            .backgroundColor(<span class="hljs-string">'#007DFF'</span>)
            .fontColor(Color.White)
            .onClick(() =&gt; <span class="hljs-keyword">this</span>.onSendCode())
        }
        .padding(<span class="hljs-number">12</span>)
        .backgroundColor(<span class="hljs-string">'#F7F7F7'</span>)
        .borderRadius(<span class="hljs-number">8</span>)
        .width(<span class="hljs-string">'85%'</span>)
      }

      <span class="hljs-comment">/** 登录按钮 */</span>
      Button(<span class="hljs-string">"登录"</span>)
        .width(<span class="hljs-string">'85%'</span>)
        .height(<span class="hljs-number">45</span>)
        .backgroundColor(<span class="hljs-string">'#007DFF'</span>)
        .fontColor(Color.White)
        .borderRadius(<span class="hljs-number">8</span>)
        .onClick(() =&gt; <span class="hljs-keyword">this</span>.onLogin())

      <span class="hljs-comment">/** 登录方式切换 */</span>
      Row() {
        Text(<span class="hljs-keyword">this</span>.loginByPassword ? <span class="hljs-string">"使用验证码登录"</span> : <span class="hljs-string">"使用密码登录"</span>)
          .fontColor(<span class="hljs-string">'#007DFF'</span>)
          .onClick(() =&gt; {
            <span class="hljs-keyword">this</span>.loginByPassword = !<span class="hljs-keyword">this</span>.loginByPassword
            <span class="hljs-keyword">this</span>.password = <span class="hljs-string">''</span>
            <span class="hljs-keyword">this</span>.smsCode = <span class="hljs-string">''</span>
          })
      }
    }
    .width(<span class="hljs-string">'100%'</span>)
    .justifyContent(FlexAlign.Center)
  }

  <span class="hljs-comment">/** ---------------- 功能逻辑 ---------------- */</span>
  <span class="hljs-keyword">private</span> show(msg: string) {
    <span class="hljs-keyword">this</span>.toast(msg)
  }

  <span class="hljs-comment">/** 登录按钮逻辑 */</span>
  <span class="hljs-keyword">private</span> onLogin() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.phone.trim() === <span class="hljs-string">''</span>) {
      <span class="hljs-keyword">this</span>.show(<span class="hljs-string">"请输入手机号"</span>)
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.loginByPassword) {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.password.trim() === <span class="hljs-string">''</span>) {
        <span class="hljs-keyword">this</span>.show(<span class="hljs-string">"请输入密码"</span>)
        <span class="hljs-keyword">return</span>
      }
      <span class="hljs-keyword">this</span>.show(<span class="hljs-string">"密码登录成功（示例）"</span>)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.smsCode.trim() === <span class="hljs-string">''</span>) {
        <span class="hljs-keyword">this</span>.show(<span class="hljs-string">"请输入验证码"</span>)
        <span class="hljs-keyword">return</span>
      }
      <span class="hljs-keyword">this</span>.show(<span class="hljs-string">"验证码登录成功（示例）"</span>)
    }
  }

  <span class="hljs-comment">/** 发送验证码逻辑 */</span>
  <span class="hljs-keyword">private</span> onSendCode() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.phone.trim() === <span class="hljs-string">''</span>) {
      <span class="hljs-keyword">this</span>.show(<span class="hljs-string">"请先输入手机号"</span>)
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.counter &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">this</span>.show(`请等待 ${<span class="hljs-keyword">this</span>.counter} 秒后再试`)
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-comment">// 模拟发送成功</span>
    <span class="hljs-keyword">this</span>.show(<span class="hljs-string">"验证码已发送"</span>)

    <span class="hljs-keyword">this</span>.counter = <span class="hljs-number">60</span>
    <span class="hljs-keyword">this</span>.startTimer()
  }

  <span class="hljs-keyword">private</span> toast(msg: string) {
    promptAction.showToast({ message: msg })
  }

  <span class="hljs-comment">/** 60 秒倒计时定时器 */</span>
  <span class="hljs-keyword">private</span> startTimer() {
    clearInterval(<span class="hljs-keyword">this</span>.timerId)
    <span class="hljs-keyword">this</span>.timerId = setInterval(() =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.counter &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.counter--
      } <span class="hljs-keyword">else</span> {
        clearInterval(<span class="hljs-keyword">this</span>.timerId)
      }
    }, <span class="hljs-number">1000</span>)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efd276d1e9a2406fa012e6be5ddeb7bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=bCnybon3nGUsGIUH8UKnQj0kwo0%3D" alt="ezgif-4d505e9cca216e11.gif" loading="lazy"/></p>
<p>这是一个非常典型的验证码、密码登录例子，在这个例子中：</p>
<ul>
<li>
<p>使用的新组件<code>TextInput</code>输入框组件，</p>
<ul>
<li><code>{ placeholder: 'xxxx' }</code>表示该输入框组件，在没有输入内容之前提示文本</li>
<li><code>.type(InputType.xxx)</code>设置改输入框组件是什么类型的输入框</li>
</ul>
</li>
<li>
<p>在UI描述区域可以使用<code>if</code>语句来控制UI区域是否显示。（必须是<code>@State</code>修饰的<strong>状态变量</strong>）</p>
<ul>
<li><code>if (this.loginByPassword)</code>显示密码登录区域；</li>
<li><code>if (!this.loginByPassword)</code>显示验证码登录区域</li>
</ul>
</li>
<li>
<p>也可以在某个组件内使用三目运算符进行组件渲染。如案例中：<code>Text(this.loginByPassword ? "使用验证码登录" : "使用密码登录")</code>等。（必须是<code>@State</code>修饰的<strong>状态变量</strong>）</p>
</li>
<li>
<p><code>import { promptAction } from '@kit.ArkUI';</code>这里导入了SDK开放能力，SDK对同一个Kit下的接口模块进行了封装。这句代码意思就是，导入<code>@kit.ArkUI</code>里面的<code>promptAction</code>接口能力</p>
</li>
</ul>
<p>上面的俩个例子都是通过<strong>状态变量</strong>改变时影响布局的渲染，那能不能通过组件内容的更改从而改变变量的值呢？</p>
<h4 data-id="heading-19">2.2.3 案例三：</h4>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct PageMvvm {

  @State
  isChecked: boolean = false
  @State
  myDate: Date = new Date()
  @State
  sexMale: boolean = true
  @State
  sexFeMale: boolean = false
  @State
  mySearch: string = ''
  @State
  myToggle: boolean = false
  @State
  mySelect: string = 'aaa'

  build() {
    Column({space: 12}) {

      Column(){
        Text('CheckBox双向绑定')
        Checkbox().select($$this.isChecked)
        Text('' + this.isChecked)
      }

      MyDivider()

      Column(){
        Text('DatePicker双向绑定')
        DatePicker({selected: $$this.myDate})
        Text('' + this.myDate.toLocaleString())
      }
      MyDivider()
      Column(){
        Text('Radio双向绑定')
        Radio({value:'male',   group: 'sex'}).checked($$this.sexMale)
        Radio({value:'female', group: 'sex'}).checked($$this.sexFeMale)
        Text('' + this.sexMale)
      }
      MyDivider()
      Column(){
        Text('Search双向绑定')
        Search({value: $$this.mySearch})
        Text('' + this.mySearch)
      }

      MyDivider()
      Column() {
        Text('Toggle双向绑定')
        Toggle({ type: ToggleType.Switch,isOn:$$this.myToggle})
        Text('' + this.myToggle)
      }

      MyDivider()
      Column() {
        Text('Select双向绑定')
        Row(){
          Select([{ value: 'aaa' },
            { value: 'bbb'},
            { value: 'ccc'},
            { value: 'ddd'}])
            .value($$this.mySelect)
          Text('' + this.mySelect)
        }
      }
      MyDivider()
    }
    .height('100%')
    .width('100%')
  }
}

@Component
struct MyDivider {
  build() {
    Divider().height(3).backgroundColor(Color.Pink)
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/564f3edfe5d142b18d739cebf3933ccd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=itYF9dYkzoqLA5N1w3kIHY3kwTo%3D" alt="ezgif-36c0e0b8023d3deb.gif" loading="lazy"/></p>
<p>在该例子中：</p>
<ul>
<li>使用了一系列不同的新组件（<code>Checkbox</code>、<code>DatePicker</code>、<code>Radio</code>.....），在传值的时候，对应的变量前加了<code>$$</code>符号，当组件值改变时，也会同步改变对应变量。</li>
</ul>
<p>在日常开发中，我们难免会根据不同的需求，封装自己的UI。</p>
<p>那该如何封装自定义UI呢？</p>
<h3 data-id="heading-20">2.3 自定义UI</h3>
<p>在上面讲解<code>Grid</code>案例二的时候，就用过一次自定义UI，当时是用<code>@Component</code>封装了自定义组件。</p>
<p>而在鸿蒙<code>ArkTS</code>开发中,<code>@Component</code>和<code>@Builder</code>是构建UI最常用的两个装饰器。</p>
<p>虽然它们都用于生成 UI 界面，但它们在定位、能力、生命周期和性能上有本质的区别。</p>
<p>说了这么多，上案例讲解！</p>
<h4 data-id="heading-21">2.3.1 案例一</h4>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Builder
function ValueBuilder(text: string) {
  Text(`值传递Builder，不会刷新UI: ${text}`)
    .fontSize(16)
    .fontColor(Color.Gray)
    .margin(5)
}

class Tmp {
  title: string = ''
}

@Builder
function QuoteBuilder(tmp: Tmp) {
  Column() {
    Row() {
      Image($r('app.media.startIcon')).width(20)
      Text(`引用传递Builder,会刷新UI: ${tmp.title}`).fontSize(18)
    }
    .margin(10)
  }
}

@Component
@Entry
struct ParentPage {
  @State parentMessage: string = "父组件状态";

  @Builder
  LocalBuilder() {
    Text(`这是LocalBuilder 能通过this刷新 ${this.parentMessage}`)
  }

  build() {
    Column() {

      //全局值传递Builder
      ValueBuilder(this.parentMessage)

      //全局引用传递Builder
      QuoteBuilder({ title: this.parentMessage })

      //局部 this 指向Builder
      this.LocalBuilder()
      Divider().strokeWidth(2).color(Color.Blue).margin({top:20})

      Button("修改父组件状态")
        .onClick(() =&gt; {
          this.parentMessage = "状态已更新";
          console.log(`parentMessage=${this.parentMessage}`)
        }).margin({top:20})

      Text(this.parentMessage).margin({top:20})

      Divider().strokeWidth(2).color(Color.Blue).margin({top:20})

      // 使用子组件
      ChildComponent().margin({top:20})
    }
    .width('100%')
    .height('100%')
  }
}


// 2. 定义一个子组件 Component (独立模块，有生命周期)
@Component
struct ChildComponent {
  @State message: string = "我是独立的子组件";

  // 生命周期演示
  aboutToAppear() {
    console.log("ChildComponent 初始化了");
  }

  build() {
    Column() {
      Text(this.message)
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .backgroundColor(Color.Pink)
        .padding(10)
        .onClick(() =&gt; {
          this.message = "子组件被点击，只刷新我！";
        })
    }
  }
}
</code></pre>
<p>运行初始化日志：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">     ChildComponent 初始化了
</span></code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89f3553c240e4d1faf0e19d146e1666a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=uGPxqFgfIL6P606oYAMiz47%2FLHs%3D" alt="ezgif-3df822dc21ccbf98.gif" loading="lazy"/></p>
<p>在该例子中：</p>








































<table><thead><tr><th><strong>特性</strong></th><th><strong>@Component (自定义组件)</strong></th><th><strong>@Builder (UI 构建函数)</strong></th></tr></thead><tbody><tr><td><strong>本质</strong></td><td><strong>类/结构体</strong> (<code>struct</code>)</td><td><strong>函数/方法</strong> (<code>function</code>)</td></tr><tr><td><strong>生命周期</strong></td><td><strong>有</strong> (<code>aboutToAppear</code>, <code>aboutToDisappear</code> 等)</td><td><strong>无</strong></td></tr><tr><td><strong>状态管理</strong></td><td>拥有独立的状态 (<code>@State</code>, <code>@Link</code> 等)</td><td>依赖传入参数或宿主组件的状态</td></tr><tr><td><strong>渲染机制</strong></td><td>独立的渲染节点，更新时只刷新自己</td><td>视为宿主组件的一部分，通常随宿主刷新</td></tr><tr><td><strong>性能开销</strong></td><td>较重 (需要创建实例、维护状态和生命周期)</td><td>极轻 (仅仅是代码复用逻辑)</td></tr><tr><td><strong>复用范围</strong></td><td>全局可复用，不仅限 UI，还封装逻辑</td><td>主要是 UI 结构的复用 (分为全局和局部)</td></tr></tbody></table>
<p>我们在开发过程中往往会出现大量的代码在进行重复样式的设置，因此这就涉及到样式的复用。</p>
<h3 data-id="heading-22">2.4 样式复用</h3>
<h4 data-id="heading-23">2.4.1 @Styles 样式复用</h4>
<p>案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { promptAction } from '@kit.ArkUI';

enum PayType {
  WXPay, Alipay, BankPay, CreditCard
}

@Entry
@Component
struct PageStyle1 {
  @State
  heightValue: number = 50

  @Styles
  // payStyle(payType:PayType){  //编译报错，@Styles 方法不能含有参数
  payStyle(){
    .width('100%')
    .height(this.heightValue)
    .borderRadius(10)
    .backgroundColor('#FF1266e0')
    .onClick(() =&gt; {
      promptAction.showToast({ message: '支付成功！' })
    })
  }

  build() {
    Column() {
      Row() {
        Button('微信支付', { type: ButtonType.Normal })
          .payStyle()
      }
      .padding(10)

      Row() {
        Button('支付宝支付', { type: ButtonType.Normal })
          .payStyle()

      }
      .padding(10)

      Row() {
        Button('银行卡支付', { type: ButtonType.Normal })
          .payStyle()

      }
      .padding(10)

      Row() {
        Button('信用卡支付', { type: ButtonType.Normal })
          .payStyle()

      }
      .padding(10)

    }
    .width('100%')
    .height('100%')

  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a164547ff5c4713ac8cc5cd22b4816b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=vjhAxTfDLmNIu9l6dJXYgKk8Zhw%3D" alt="ezgif-60d51c07d55661eb.gif" loading="lazy"/></p>
<p>在该例子中：</p>
<ul>
<li>通过<code>@Styles</code>修饰的方法可以定义<strong>通用属性与通用事件，不支持参数传递（通用、通用、通用）</strong></li>
</ul>
<p>那如果说有多种情况，不同情况按钮颜色不一样，然而<code>@Styles</code>修饰的方法不可传参，区分不了按钮，那该怎么办呢？</p>
<h4 data-id="heading-24">2.4.2 @Extend 样式复用</h4>
<p>案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">import { promptAction } from '@kit.ArkUI';

@Entry
@Component
struct PageStyle2 {
  build() {
    Column({ space: 20 }) {
      Button("支付宝支付")
        .payButton("alipay")
      Button("微信支付")
        .payButton("wechat")
      Button("支付宝支付")
        .payButton("alipay")
      Button("微信支付")
        .payButton("wechat")
      Button("支付宝支付")
        .payButton("alipay")
      Button("微信支付")
        .payButton("wechat")
      Button("支付宝支付")
        .payButton("alipay")
    }
    .padding(20)
    .width('100%')
  }
}

@Extend(Button)
function payButton(type: 'alipay' | 'wechat'){
  .type(ButtonType.Normal)
  .fontColor(Color.White)
  .width('100%')
  .height(50)
  .borderRadius(4)
  .backgroundColor(type === 'wechat' ? '#00c168':'#ff1256e0')
  .onClick(()=&gt;{
    if( type === 'alipay'){
      promptAction.showToast({message: '支付宝支付成功！'})
    }else{
      promptAction.showToast({message: '微信支付成功！'})
    }
  })
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4b8ede32c5d4adeabd0d747122b4064~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=4pz507XuhOVL9F1Y0muvg5jI5NU%3D" alt="ezgif-2587c76ade83aa5c.gif" loading="lazy"/></p>
<p>在该例子中：</p>
<ul>
<li>使用<code>@Extend(Button)</code>扩展了原生组件的样式，支持封装私有属性、通用属性、事件。</li>
<li>与<code>@Styles</code>不同，<code>@Extend(Button)</code>支持参数传递，提供了更大的灵活性</li>
</ul>
<p>虽然<code>@Styles</code>和<code>@Extend(Button)</code>提供了样式复用的能力，但是它们还是存在一些限制，因此就有了<code>AttributeModifier</code>。</p>
<p>我们来看看如何使用它。</p>
<h4 data-id="heading-25">2.4.3 AttributeModifier</h4>
<p>案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct PageStyle3 {

  @State modifier: MyButtonModifier = new MyButtonModifier()
  @State modifier2: MyButtonModifier2 = new MyButtonModifier2()

  build() {

    Column({space: 20}){
      Button('点我试试').attributeModifier(this.modifier).onClick(()=&gt;{
        this.modifier.isDark = !this.modifier.isDark
      })

      Divider().height(2).backgroundColor(Color.Pink)

      Button('点我试试').attributeModifier(this.modifier2)

    }
    .width('100%')
    .height('100%')
  }
}

class MyButtonModifier implements AttributeModifier&lt;ButtonAttribute&gt;{
  isDark: boolean  = false
  applyNormalAttribute(instance: ButtonAttribute): void {
    instance.backgroundColor(this.isDark ? Color.Black: Color.Red)
  }
}

class MyButtonModifier2 implements AttributeModifier&lt;ButtonAttribute&gt; {
  applyNormalAttribute(instance: ButtonAttribute): void {
    instance.backgroundColor(Color.Black)
  }
  applyPressedAttribute(instance: ButtonAttribute): void {
    instance.backgroundColor(Color.Red)

  }
}
</code></pre>
<p>运行效果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14f251648531456c91057c98ac40677f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=60Iy%2BpFxBPLgzIzWIe%2BckUHLJ%2F8%3D" alt="ezgif-7320282bf35d4baa.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li><code>AttributeModifier&lt;ButtonAttribute&gt;</code> 其中<code>ButtonAttribute</code>是 <code>Button</code>专有属性类，也就是按钮扩展属性</li>
<li><code>applyNormalAttribute</code> 表示 按钮在正常情况下属性的表现</li>
<li><code>applyPressedAttribute</code> 表示 按钮在按下的情况下属性的表现</li>
</ul>
<h4 data-id="heading-26">2.4.4 多态样式stateStyles</h4>
<p>案例：</p>
<pre><code class="hljs language-ArkTS" lang="ArkTS">@Entry
@Component
struct PageStyle4 {
  build() {
    Column(){
      Row(){
        Text('今天你心情怎么样！')
      }
      .padding(20)
      .height(80)
      .border({
        color: Color.Pink,
        width: 3
      })
      .borderRadius(4)
      .stateStyles({
        normal:{
          .backgroundColor(Color.Green)
        },
        pressed:{
          .backgroundColor('#eee')
          .border({
            width: 1,
            style: BorderStyle.Solid,
            color: Color.Red
          })
        }
      })

    }
    .width('100%')
    .height('100%')
  }
}
</code></pre>
<p>运行效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b48add4fe046497ba0045f05cb591604~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaHFr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264861&amp;x-signature=VjIgkmyq9x8ZxU4yOpBF1qeIzJM%3D" alt="ezgif-7e5bff81b40c9dd2.gif" loading="lazy"/></p>
<p>在这个例子中：</p>
<ul>
<li>
<p>stateStyles可以依据组件的内部状态不同，快速设置不同样式</p>
</li>
<li>
<p>ArkUI提供以下五种状态</p>
<ul>
<li>focused：获取焦点时</li>
<li>normal：正常情况</li>
<li>pressed：按压时</li>
<li>disabled：不可选中时</li>
<li>selected：选中时</li>
</ul>
</li>
</ul>
<h3 data-id="heading-27">3、结束语</h3>
<p>OK，看到这里的小伙伴相信你对ArkUI有了一定的了解！
下一篇讲解状态管理、应用程序结构以及路由相关讲解！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【鸟类识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法]]></title>    <link>https://juejin.cn/post/7578820377000411187</link>    <guid>https://juejin.cn/post/7578820377000411187</guid>    <pubDate>2025-12-02T07:25:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578820377000411187" data-draft-id="7578948893761667099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【鸟类识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法"/> <meta itemprop="keywords" content="深度学习,图像识别"/> <meta itemprop="datePublished" content="2025-12-02T07:25:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ziwu"/> <meta itemprop="url" content="https://juejin.cn/user/607373397353726"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【鸟类识别系统】Python+TensorFlow+Django+人工智能+深度学习+卷积神经网络算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/607373397353726/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ziwu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:25:50.000Z" title="Tue Dec 02 2025 07:25:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、介绍</h2>
<p>鸟类识别系统，通过TensorFlow搭建卷积神经网络算法，数据集使用经典的加利福尼亚大学CUB-200-2011鸟类数据集，对其进行多轮迭代训练，最后得到了一个精度较高的模型，并搭建Web可视化操作平台。</p>
<p><strong>技术栈</strong>：</p>
<ul>
<li>项目前端使用Html、CSS、BootStrap搭建界面。</li>
<li>后端基于Django处理逻辑请求</li>
<li>基于Ajax实现前后端数据通信</li>
</ul>
<p><strong>选题背景与意义</strong>：
在生态保护与生物多样性研究日益重要的当下，精准识别鸟类品种对科研及爱好者而言意义重大。传统鸟类识别依赖人工比对图鉴，不仅效率低且对专业知识要求高。随着人工智能技术发展，利用深度学习算法实现自动化鸟类识别成为可行方向。本项目聚焦于此，采用TensorFlow搭建卷积神经网络算法，选用权威的加利福尼亚大学CUB-200-2011鸟类数据集，经多轮迭代训练出高精度模型。同时，为方便用户操作，还运用Html、CSS等搭建Web可视化平台，实现便捷交互。</p>
<h2 data-id="heading-1">二、系统效果图片展示</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5d8d63627504e1ea7e92c4839b1260a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765265150&amp;x-signature=KV%2FoSf3sS9wtOKFnMP9GZpJ6GiE%3D" alt="图片" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdcbdf989c5c4835a9bee4b1d87a5292~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765265150&amp;x-signature=ZX5rxQq3fg%2FGA5mb%2FZujnV%2BJmTw%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-2">三、演示视频 and 完整代码 and 安装</h2>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fziwupy.cn%2Fp%2FCNZ6zx" target="_blank" title="https://ziwupy.cn/p/CNZ6zx" ref="nofollow noopener noreferrer">ziwupy.cn/p/CNZ6zx</a></p>
<h2 data-id="heading-3">四、卷积神经网络算法介绍</h2>
<p>ResNet50是一种深度卷积神经网络（CNN），由微软研究院于2015年提出，属于ResNet系列模型。其核心创新是引入残差块（Residual Block），通过残差连接（Shortcut Connection）解决深层网络训练中的梯度消失问题，使网络能够训练更深层次的结构（共50层，含49个卷积层和1个全连接层）。残差块允许输入直接跳过部分卷积层，与输出相加，从而保留更多原始信息，提升特征提取能力。ResNet50在ImageNet数据集上达到76%的Top-1准确率，广泛应用于图像分类、目标检测等任务。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> tensorflow.keras.applications.resnet50 <span class="hljs-keyword">import</span> ResNet50, preprocess_input
<span class="hljs-keyword">from</span> tensorflow.keras.preprocessing <span class="hljs-keyword">import</span> image
<span class="hljs-keyword">from</span> tensorflow.keras.models <span class="hljs-keyword">import</span> Model
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 加载预训练模型（不包括顶层分类层）</span>
base_model = ResNet50(weights=<span class="hljs-string">'imagenet'</span>, include_top=<span class="hljs-literal">False</span>, input_shape=(<span class="hljs-number">224</span>, <span class="hljs-number">224</span>, <span class="hljs-number">3</span>))

<span class="hljs-comment"># 添加自定义分类层</span>
x = tf.keras.layers.GlobalAveragePooling2D()(base_model.output)
x = tf.keras.layers.Dense(<span class="hljs-number">1024</span>, activation=<span class="hljs-string">'relu'</span>)(x)
predictions = tf.keras.layers.Dense(<span class="hljs-number">10</span>, activation=<span class="hljs-string">'softmax'</span>)(x)  <span class="hljs-comment"># 假设10个类别</span>
model = Model(inputs=base_model.<span class="hljs-built_in">input</span>, outputs=predictions)

<span class="hljs-comment"># 冻结预训练层（可选）</span>
<span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> base_model.layers:
    layer.trainable = <span class="hljs-literal">False</span>

<span class="hljs-comment"># 示例：预处理单张图片并预测</span>
img_path = <span class="hljs-string">'example.jpg'</span>
img = image.load_img(img_path, target_size=(<span class="hljs-number">224</span>, <span class="hljs-number">224</span>))
img_array = image.img_to_array(img)
img_array = np.expand_dims(img_array, axis=<span class="hljs-number">0</span>)
img_array = preprocess_input(img_array)

predictions = model.predict(img_array)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"预测结果:"</span>, np.argmax(predictions))

</code></pre>
<p>代码加载预训练的ResNet50模型（基于ImageNet权重），替换顶层为自定义分类层（10类输出）。通过冻结预训练层，可利用其特征提取能力快速适配新任务（迁移学习）。输入图片需预处理为224×224尺寸，并使用preprocess_input标准化像素值。此方法适用于小数据集场景，可显著减少训练时间和计算资源需求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【开源】一个丝滑的 Claude Code 环境变量快速切换工具]]></title>    <link>https://juejin.cn/post/7578917474658762803</link>    <guid>https://juejin.cn/post/7578917474658762803</guid>    <pubDate>2025-12-02T07:27:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578917474658762803" data-draft-id="7578876665695387657" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【开源】一个丝滑的 Claude Code 环境变量快速切换工具"/> <meta itemprop="keywords" content="AI编程,Cursor,Claude"/> <meta itemprop="datePublished" content="2025-12-02T07:27:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="极客密码"/> <meta itemprop="url" content="https://juejin.cn/user/976022055165608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【开源】一个丝滑的 Claude Code 环境变量快速切换工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976022055165608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    极客密码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:27:56.000Z" title="Tue Dec 02 2025 07:27:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>起因是给家里 M 系列芯片的 Macmini 装了 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffarion1231%2Fcc-switch" target="_blank" title="https://github.com/farion1231/cc-switch" ref="nofollow noopener noreferrer">cc-switch</a> 之后觉得非常好用，可以很方便的将很多不同的 claude code 中转 API 站管理起来，切换也非常丝滑</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/703d5a220d2c480fa24354eddf6c8a73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765265276&amp;x-signature=u%2BEIpea9J3hXORGy5GCb8n8DmP4%3D" alt="cc-switch" loading="lazy"/></p>
<p>因此也给公司这台 Intel 芯片的黑苹果装上了，系统是 Big Sur 11.7.7</p>
<p>但因为黑苹果系统停在 MacOS Big Sur，所以导致很多使用了 Tauri 2.x 开发的软件打开基本都会丢样式</p>
<p>查了下说是 Big Sur 底层的 webview 版本太低了，也不想再折腾升系统了</p>
<p>所以就有了下面这个命令行切换工具</p>
<p>如果你比较喜欢 CLI 工具，想通过一行 npm install 命令就能安装一个 Claude Code 环境变量切换工具的话</p>
<p>那么它，将是你的不二之选。</p>
<p>做了新增、切换、删除、修改、额度显示等等，代码已全量开源：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fisnl%2Fccs" target="_blank" title="https://github.com/isnl/ccs" ref="nofollow noopener noreferrer">github.com/isnl/ccs</a></p>
<h2 data-id="heading-0">CCS - Claude Code Switcher</h2>
<p>一个用于管理多个 Claude Code API 商家配置的命令行工具。</p>
<h3 data-id="heading-1">安装</h3>
<pre><code class="hljs language-bash" lang="bash">npm install -g @claude-cli/ccs
</code></pre>
<h3 data-id="heading-2">特性</h3>
<ul>
<li>首次运行自动导入当前 Claude Code 配置</li>
<li>切换前自动备份</li>
<li>中英双语支持</li>
<li>额度用量跟踪与显示</li>
<li>美观的带边框表格显示</li>
</ul>
<h3 data-id="heading-3">Commands / 命令</h3>













































































<table><thead><tr><th>Command</th><th>Alias</th><th>Description (EN)</th><th>描述 (中文)</th></tr></thead><tbody><tr><td><code>ccs</code></td><td>-</td><td>Interactive switch</td><td>交互式切换商家</td></tr><tr><td><code>ccs list</code></td><td><code>ccs ls</code></td><td>List all providers</td><td>列出所有商家</td></tr><tr><td><code>ccs add</code></td><td><code>ccs a</code></td><td>Add a new provider</td><td>添加新商家</td></tr><tr><td><code>ccs edit [name]</code></td><td><code>ccs e [name]</code></td><td>Edit a provider</td><td>编辑商家配置</td></tr><tr><td><code>ccs use [name]</code></td><td><code>ccs u [name]</code></td><td>Switch to a provider</td><td>快速切换商家</td></tr><tr><td><code>ccs remove [name]</code></td><td><code>ccs rm [name]</code></td><td>Remove a provider</td><td>删除商家</td></tr><tr><td><code>ccs current</code></td><td><code>ccs c</code></td><td>Show current config</td><td>显示当前配置</td></tr><tr><td><code>ccs refresh [name]</code></td><td><code>ccs r [name]</code></td><td>Refresh quota info</td><td>刷新额度信息</td></tr><tr><td><code>ccs lang</code></td><td>-</td><td>Switch language</td><td>切换语言（中/英）</td></tr><tr><td><code>ccs --version</code></td><td><code>ccs -v</code></td><td>Show version</td><td>显示版本号</td></tr><tr><td><code>ccs --help</code></td><td><code>ccs -h</code></td><td>Show help</td><td>显示帮助信息</td></tr></tbody></table>
<h3 data-id="heading-4">截图</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81d0ba08e3c3448789a457a366879b9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p6B5a6i5a-G56CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765265276&amp;x-signature=fiHEc1hoDG0JO%2FlqTiQXe7zPJxE%3D" alt="2025-12-01-17-26-05" loading="lazy"/></p>
<h3 data-id="heading-5">额度配置</h3>
<p>添加或编辑商家时，可以选择配置额度显示：</p>
<ol>
<li><strong>User ID</strong> - 在商家设置页面查看</li>
<li><strong>Access Token</strong> - 在设置-安全设置中获取</li>
</ol>
<p>配置完成后，运行 <code>ccs refresh</code> 刷新额度信息，或在添加/编辑时自动获取。</p>
<h3 data-id="heading-6">配置</h3>
<h4 data-id="heading-7">配置文件</h4>
<p><code>~/.ccs.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"lang"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"zh"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"current"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a1b2c3d4-e5f6-7890-abcd-ef1234567890"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"providers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a1b2c3d4-e5f6-7890-abcd-ef1234567890"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"OpenRouter"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Main provider, cheap"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"baseURL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://openrouter.ai/api/v1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-or-xxx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"balanceConfig"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"enabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"userId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"12345"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"accessToken"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-access-token"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"usedBalance"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12.5</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"totalBalance"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b2c3d4e5-f6a7-8901-bcde-f12345678901"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"OneAPI"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Company internal API"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"baseURL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://api.example.com/v1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sk-xxx"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-8">商家字段</h4>













































































<table><thead><tr><th>Field</th><th>Required</th><th>Description (EN)</th><th>描述 (中文)</th></tr></thead><tbody><tr><td><code>id</code></td><td>Yes</td><td>UUID identifier</td><td>UUID 标识符</td></tr><tr><td><code>name</code></td><td>Yes</td><td>Provider name</td><td>商家名称</td></tr><tr><td><code>description</code></td><td>No</td><td>Description/notes</td><td>描述/备注</td></tr><tr><td><code>baseURL</code></td><td>Yes</td><td>API base URL</td><td>API 地址</td></tr><tr><td><code>apiKey</code></td><td>Yes</td><td>API key</td><td>API 密钥</td></tr><tr><td><code>balanceConfig</code></td><td>No</td><td>Quota config object</td><td>额度配置对象</td></tr><tr><td><code>balanceConfig.enabled</code></td><td>No</td><td>Enable quota display</td><td>启用额度显示</td></tr><tr><td><code>balanceConfig.userId</code></td><td>No</td><td>User ID for API</td><td>用户 ID</td></tr><tr><td><code>balanceConfig.accessToken</code></td><td>No</td><td>Access token for API</td><td>访问令牌</td></tr><tr><td><code>usedBalance</code></td><td>No</td><td>Used quota (USD)</td><td>已用额度 (美元)</td></tr><tr><td><code>totalBalance</code></td><td>No</td><td>Total quota (USD)</td><td>总额度 (美元)</td></tr></tbody></table>
<h3 data-id="heading-9">切换机制</h3>
<p>切换商家时：</p>
<ol>
<li>备份 <code>~/.claude/settings.json</code> → <code>~/.claude/settings.json.backup</code></li>
<li>写入 <code>ANTHROPIC_BASE_URL</code> 和 <code>ANTHROPIC_AUTH_TOKEN</code> 到 <code>~/.claude/settings.json</code></li>
</ol>
<h3 data-id="heading-10">技术栈</h3>
<ul>
<li>Claude Code - 代码编写</li>
<li>Commander.js - 命令解析</li>
<li>Inquirer.js - 交互式提示</li>
<li>Chalk - 终端美化</li>
</ul>
<h3 data-id="heading-11">License</h3>
<p>MIT</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[《独立开发者精选工具》第 023 期]]></title>    <link>https://juejin.cn/post/7578820377000329267</link>    <guid>https://juejin.cn/post/7578820377000329267</guid>    <pubDate>2025-12-02T07:13:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578820377000329267" data-draft-id="7578797337868763170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="《独立开发者精选工具》第 023 期"/> <meta itemprop="keywords" content="前端,后端,开源"/> <meta itemprop="datePublished" content="2025-12-02T07:13:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Immerse"/> <meta itemprop="url" content="https://juejin.cn/user/2708812817761752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            《独立开发者精选工具》第 023 期
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2708812817761752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Immerse
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:13:44.000Z" title="Tue Dec 02 2025 07:13:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.indietools.work" target="_blank" title="https://www.indietools.work" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/840bec24e4d743c1ade3d8a8e8fc6d20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264423&amp;x-signature=sN4pKyMOxSNbKDim73Vy0%2FlVJPU%3D" alt="" loading="lazy"/></a></p>
<p>Indie Tools 是一个收录独立开发、AI 出海领域最新、最实用的免费工具与资源工具站。让你快速找到所需，专注于创造产品。</p>
<p>独立开发者必备网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.indietools.work" target="_blank" title="https://www.indietools.work" ref="nofollow noopener noreferrer"><code>https://www.indietools.work</code></a></p>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyaolifeng0629%2FAwesome-independent-tools" target="_blank" title="https://github.com/yaolifeng0629/Awesome-independent-tools" ref="nofollow noopener noreferrer"><code>https://github.com/yaolifeng0629/Awesome-independent-tools</code></a></p>
<p>如果本文能给你提供启发和帮助，感谢各位小伙伴动动小手指，一键三连 (点赞、评论、转发)，给我一些支持和鼓励，谢谢。</p>
<h2 data-id="heading-0">favicon-generator</h2>
<h3 data-id="heading-1">总结</h3>
<p>免费在线 Favicon 生成工具，快速生成多设备图标。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/045e850392f64b65b5da68c06ad8e24a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264423&amp;x-signature=6oIge8V1gq0BvwxTVvLtWpRbcEs%3D" alt="favicon-generator" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/favicon-generator</code></p>
<h3 data-id="heading-2">特性</h3>
<ol>
<li>从图像自动生成多尺寸图标。</li>
<li>在线编辑器支持简单编辑和预览。</li>
<li>一键打包下载所有格式图标。</li>
<li>提供可直接嵌入的 HTML 代码。</li>
</ol>
<h3 data-id="heading-3">使用场景</h3>
<ol>
<li>网站开发者快速创建 Favicon。</li>
<li>为移动应用或 PWA 生成应用图标。</li>
</ol>
<h3 data-id="heading-4">缺点</h3>
<ol>
<li>高级编辑功能有限。</li>
<li>网站界面较陈旧。</li>
</ol>
<h2 data-id="heading-5">WeClone</h2>
<h3 data-id="heading-6">总结</h3>
<p>用聊天记录微调大模型，打造个性化数字分身。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4814140ea9c49a6b0bb92678e3a477a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264423&amp;x-signature=6IYR4ToS3agOC8OlijoJhq%2ByZLM%3D" alt="WeClone" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/weclone</code></p>
<h3 data-id="heading-7">特性</h3>
<ol>
<li>用个人聊天记录微调模型，模仿用户语言风格。</li>
<li>将模型绑定到聊天机器人，实现实时互动。</li>
<li>提供数据处理到部署的完整工作流。</li>
</ol>
<h3 data-id="heading-8">使用场景</h3>
<ol>
<li>创建个人数字分身与朋友互动。</li>
<li>为创作者构建虚拟形象与粉丝交流。</li>
<li>部署具有特定语言风格的社群助手。</li>
</ol>
<h3 data-id="heading-9">缺点</h3>
<ol>
<li>数据隐私保护可能不足。</li>
<li>生成效果受限于基础模型能力。</li>
</ol>
<h2 data-id="heading-10">Midjourney Sref</h2>
<h3 data-id="heading-11">总结</h3>
<p>收录 4000+个 Midjourney 风格参考代码，快速复制艺术风格。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f753ac486f02438b856a67f299b4ef43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264423&amp;x-signature=LhtRUUWI%2BEU%2BMnvHz6vjhc%2FD5iI%3D" alt="Midjourney Sref" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/midjourney-sref</code></p>
<h3 data-id="heading-12">特性</h3>
<ol>
<li>提供超 4000 个精选--sref 代码。</li>
<li>每个代码配有效果图预览。</li>
<li>界面简洁，易于搜索浏览。</li>
</ol>
<h3 data-id="heading-13">使用场景</h3>
<ol>
<li>快速为作品寻找特定艺术风格。</li>
<li>参考不同风格激发创作灵感。</li>
</ol>
<h3 data-id="heading-14">缺点</h3>
<ol>
<li>风格库庞大，新手选择困难。</li>
<li>功能单一，缺乏高级筛选。</li>
</ol>
<h2 data-id="heading-15">awesome-chatgpt-prompts-zh</h2>
<h3 data-id="heading-16">总结</h3>
<p>丰富的中文提示词库，提升 ChatGPT 对话质量。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3ecfe3a78874d8b91ae03774800276b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264423&amp;x-signature=%2FRb6wDFZKpd4%2BCB8Tjd4D0U5ztA%3D" alt="awesome-chatgpt-prompts-zh" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/awesome-chatgpt-prompts-zh</code></p>
<h3 data-id="heading-17">特性</h3>
<ol>
<li>收录不同场景和角色的中文提示词模板。</li>
<li>内容持续更新，紧跟功能迭代。</li>
<li>提示词经测试，可直接复制使用。</li>
</ol>
<h3 data-id="heading-18">使用场景</h3>
<ol>
<li>让 ChatGPT 扮演特定角色对话。</li>
<li>为创作者、学生提供提问灵感。</li>
</ol>
<h3 data-id="heading-19">缺点</h3>
<ol>
<li>提示词质量参差不齐。</li>
<li>主要面向中文用户。</li>
</ol>
<h2 data-id="heading-20">awesome-chatgpt-prompts</h2>
<h3 data-id="heading-21">总结</h3>
<p>社区驱动的 ChatGPT 提示词库，提升与大模型的互动效率。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/657d45f40d364c96b5bb4a0527a7a614~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264423&amp;x-signature=JmZII%2FJzrkbZiLwER7GzQ8ZnpAA%3D" alt="awesome-chatgpt-prompts" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/awesome-chatgpt-prompts</code></p>
<h3 data-id="heading-22">特性</h3>
<ol>
<li>提供多样化角色扮演提示。</li>
<li>覆盖编程、写作、营销等领域。</li>
<li>社区持续更新，保持实用性。</li>
</ol>
<h3 data-id="heading-23">使用场景</h3>
<ol>
<li>为创作者提供灵感和文案框架。</li>
<li>帮助开发者获取代码解决方案。</li>
<li>辅助学生进行学术写作。</li>
</ol>
<h3 data-id="heading-24">缺点</h3>
<ol>
<li>提示词质量水平不一。</li>
<li>部分提示词需调整适配新模型。</li>
</ol>
<h2 data-id="heading-25">minimaxi</h2>
<h3 data-id="heading-26">总结</h3>
<p>高性价比国内文本转语音 API 平台，付费使用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2c896b597fd465fa3a56e6eb1ebac2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264423&amp;x-signature=JfZInkBQnaIX38AteRdNjgIfw%2FA%3D" alt="minimaxi" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/minimaxi</code></p>
<h3 data-id="heading-27">特性</h3>
<ol>
<li>多种高自然度音色可选。</li>
<li>性价比高，适合预算有限用户。</li>
<li>API 稳定，方便集成。</li>
</ol>
<h3 data-id="heading-28">使用场景</h3>
<ol>
<li>为视频、有声读物生成配音。</li>
<li>为智能助手提供语音交互。</li>
</ol>
<h3 data-id="heading-29">缺点</h3>
<ol>
<li>需付费，不适合轻度用户。</li>
<li>国际化和多语言支持有限。</li>
</ol>
<h2 data-id="heading-30">SnippAI</h2>
<h3 data-id="heading-31">总结</h3>
<p>AI 截图工具，智能识别并处理屏幕内容。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bfeaf9843fd439797b46361278c867e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tZXJzZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765264423&amp;x-signature=SejHL2l6OeAQie%2FF%2FukwHyGdm8s%3D" alt="SnippAI" loading="lazy"/></p>
<p>链接: <code>https://www.indietools.work/product/snippai</code></p>
<h3 data-id="heading-32">特性</h3>
<ol>
<li>智能识别截图中的文本、代码或图像。</li>
<li>AI 驱动的总结、解释和翻译功能。</li>
<li>一键截图获取 AI 分析结果。</li>
<li>支持代码片段解释和格式优化。</li>
</ol>
<h3 data-id="heading-33">使用场景</h3>
<ol>
<li>快速提取和总结网页文章核心内容。</li>
<li>理解和解释代码片段功能。</li>
<li>辅助学生快速消化文献资料。</li>
<li>翻译截图中的外语文字。</li>
</ol>
<h3 data-id="heading-34">缺点</h3>
<ol>
<li>处理复杂专业内容时可能不精确。</li>
<li>离线状态下功能受限。</li>
</ol>
<h3 data-id="heading-35">往期回顾</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F-DDkWXf1gRSwMOhLeJWL_A" target="_blank" title="https://mp.weixin.qq.com/s/-DDkWXf1gRSwMOhLeJWL_A" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 023 期（最新）</a> 🔥</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FIfBFbvZeR8YadX3tynW90w" target="_blank" title="https://mp.weixin.qq.com/s/IfBFbvZeR8YadX3tynW90w" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 022 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FOGvJKwAxIdLl-P8T_z8fbQ" target="_blank" title="https://mp.weixin.qq.com/s/OGvJKwAxIdLl-P8T_z8fbQ" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 021 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FlsGaGKMBqqETuuhO7NpxFg" target="_blank" title="https://mp.weixin.qq.com/s/lsGaGKMBqqETuuhO7NpxFg" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 020 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPlrojO5X4Ypg61YeXYfVbg" target="_blank" title="https://mp.weixin.qq.com/s/PlrojO5X4Ypg61YeXYfVbg" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 019 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPC-mh4mXADdBQ0ovkDbrLg" target="_blank" title="https://mp.weixin.qq.com/s/PC-mh4mXADdBQ0ovkDbrLg" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 018 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fi_lSbscGcEMhNSlnKhZESA" target="_blank" title="https://mp.weixin.qq.com/s/i_lSbscGcEMhNSlnKhZESA" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 017 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fxc5saU93KoJh63jFlTAPjw" target="_blank" title="https://mp.weixin.qq.com/s/xc5saU93KoJh63jFlTAPjw" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 016 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FnHQxIBCU3VGF3x3N10aQ6Q" target="_blank" title="https://mp.weixin.qq.com/s/nHQxIBCU3VGF3x3N10aQ6Q" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 015 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FBkyeqA_BhNY5BrvhQVw_Pw" target="_blank" title="https://mp.weixin.qq.com/s/BkyeqA_BhNY5BrvhQVw_Pw" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 014 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F8RlROZ6HrgsVVDKwBvn8Nw" target="_blank" title="https://mp.weixin.qq.com/s/8RlROZ6HrgsVVDKwBvn8Nw" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 013 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FTJfOjWqphdqu8kkq3I6FCg" target="_blank" title="https://mp.weixin.qq.com/s/TJfOjWqphdqu8kkq3I6FCg" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 012 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FoUcBq_0pRU7ucmx03w5_7g" target="_blank" title="https://mp.weixin.qq.com/s/oUcBq_0pRU7ucmx03w5_7g" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 011 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fzr-1dGOVFyTF_YG6hrSEsg" target="_blank" title="https://mp.weixin.qq.com/s/zr-1dGOVFyTF_YG6hrSEsg" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 010 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FeKKBBDtKDb8TIy0wLko-sQ" target="_blank" title="https://mp.weixin.qq.com/s/eKKBBDtKDb8TIy0wLko-sQ" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 009 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F01oia3vAMUgFN1-_7gIkhA" target="_blank" title="https://mp.weixin.qq.com/s/01oia3vAMUgFN1-_7gIkhA" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 008 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FJFO5rPDbYWstu7c5zdB__Q" target="_blank" title="https://mp.weixin.qq.com/s/JFO5rPDbYWstu7c5zdB__Q" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 007 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fcqx-TFZLXFFSf3TRwNa--w" target="_blank" title="https://mp.weixin.qq.com/s/cqx-TFZLXFFSf3TRwNa--w" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 006 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9dYLnfOv1Jt565-wvgBsCA" target="_blank" title="https://mp.weixin.qq.com/s/9dYLnfOv1Jt565-wvgBsCA" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 005 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fy17Sz3GCOkoAs_kWsFHt_Q" target="_blank" title="https://mp.weixin.qq.com/s/y17Sz3GCOkoAs_kWsFHt_Q" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 004 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FHpcKT6wqQ6E2aFrayyEfLg" target="_blank" title="https://mp.weixin.qq.com/s/HpcKT6wqQ6E2aFrayyEfLg" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 003 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F7UYPzffH2aWWOIQRR7COlQ" target="_blank" title="https://mp.weixin.qq.com/s/7UYPzffH2aWWOIQRR7COlQ" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 002 期</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FmoCAaVlagxiEoURmtP6kmw" target="_blank" title="https://mp.weixin.qq.com/s/moCAaVlagxiEoURmtP6kmw" ref="nofollow noopener noreferrer">《独立开发者精选工具》第 001 期</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Agent如何重塑跨角色协作的AI提效新范式]]></title>    <link>https://juejin.cn/post/7578892205290258472</link>    <guid>https://juejin.cn/post/7578892205290258472</guid>    <pubDate>2025-12-02T07:46:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578892205290258472" data-draft-id="7578892205289979944" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Agent如何重塑跨角色协作的AI提效新范式"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2025-12-02T07:46:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="文心快码BaiduComate"/> <meta itemprop="url" content="https://juejin.cn/user/992209294070809"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Agent如何重塑跨角色协作的AI提效新范式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/992209294070809/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    文心快码BaiduComate
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:46:39.000Z" title="Tue Dec 02 2025 07:46:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是Agent？</h2>
<p><strong>我们开始看到一种新的“AI劳动力市场”雏形：</strong> 需求Agent、设计Agent、前端 Agent、运营Agent、数据 Agent…它们就像数字版的“岗位角色”，但永不疲惫、随时可调度。你可以把它想象成：“团队里突然多了一些懂规则、懂产品、懂代码、懂设计的AI新同事。”总结起来，<strong>Agent是“有大脑和工具调用能力”的执行者，它能做到规划、执行、调用工具、持续推进任务，完成一整套动作，是能完成任务的角色化智能体。</strong></p>
<p>举个例子，产品经理收到反馈：“百度文心快码官网风格不统一、细节处理不够好，想把统一所有页面风格。”通常，这个需求需要经历这些步骤：PM写文档 → 工程师读文档 → 工程师提问 → PM 补充 → 工程师开发 → PM验收。整个过程会面临很多问题和重复沟通：信息不对称、上下文传递不完整、需求细节被误解、工程师要不断追问、PM要不断确认逻辑、文档永远不够完备...这其实不是人的问题，而是角色之间天然存在断层。PM要表达业务逻辑，工程师要进行工程落地，两条线靠文档、会议、人力“粘”在一起。<strong>而多Agent协同，可以打通PM↔FE（前端工程师）全链路，协作从人-人，升级成了人Agent-人。</strong></p>
<h2 data-id="heading-1">案例1：Agent重构网站</h2>
<p>重构网站传统的工作流程非常繁琐，有很多步骤。有了Agent，能给传统工作流程带来啥变化呢？先来演示下：如何用Agent实现Comate官网重构。</p>
<p>Comate官网首页是偏黑色稍带星空主题，而案例页面、资讯页面等以白色为主，确实主题色不统一，来试试借助Agent，能否把统一主题的需求搞定。先让Agent梳理代码库中的主要页面：“我们要对主要页面进行风格统一，帮我罗列一下项目中主要的页面有哪些”。把需求告诉Agent，先拿一个案例页来试试：”请帮我把网站的主要页面统一成深色科技风格（黑色为主）。要求包括：主题是科技感和宇宙星空元素；统一个背景色（黑色+宇宙星空元素，宇宙星空元素要有很明显的效果）；统一布局宽度（max-width 1200px）；统一字符（font-ping-fang）；圆角统一8px；阴影（深色阴影+轻微蓝色发光）；字体颜色适配黑色背景，例如font-white；请基于上面的黑色科技风格，先帮我设计和改造“案例页”。</p>
<p>感觉星空科技感的效果不是很明显，跟Agent强调一下试试：“增加更多一些的科技感和宇宙星空的元素，丰富一下整体页面视觉效果”。这下看确实好多了，看来Agent也是喜欢聊天的，接下来适配一下其他页面：“基于刚才对案例页面的改动，同样的风格改造，对资讯页面也进行一下样式美化”。看看最终效果，简直是“买家秀”和“卖家秀”完全一致！</p>
<p>Agent重构Comate官网视频效果👉<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FcrYJB7QB2WijFxvAJaeD2g" target="_blank" title="https://mp.weixin.qq.com/s/crYJB7QB2WijFxvAJaeD2g" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/crYJB7QB2…</a></p>
<p><strong>Agent如何理解“风格”</strong> ？它不是靠关键词，而是扫描你的CSS/组件结构，建立“隐式风格模型”：阴影、字体、圆角、留白，还会根据已有页面推断“主题意图”。<strong>Agent最大的价值点是：</strong> 一次理解，多处改造；只说“换成黑色科技风”，就能给你统一方案；人类是逐页对比，而Agent可以全局扫描。</p>
<p>以前，公司每年至少有一次“大改UI”，会改主题改到崩溃。面对这种大改版，PM需要面临以下问题：</p>
<ul>
<li>UI/产品定一个规范，每个页面都要跟；</li>
<li>不同年代写的页面风格乱，很多页面的开发者可能来自不同的时间线，圆角大小不一、配色不同、字体不一致。</li>
<li>如果靠手动找、手动改，通常要2–7 天。</li>
</ul>
<p>作为PM，以前遇到这种“全站换肤”的需求，最头疼的就是“漏网之鱼”和“理解偏差”。比如PM说要有“科技感”，设计师认为是“赛博朋克”，前端认为是“蓝底白字”，最后做出来是“五彩斑斓的黑”。 而且往往改了首页、忘了详情页，或者改了按钮、忘了输入框。<strong>现在Agent能通过全局扫描代码，建立一个隐式的“风格模型”</strong> 。</p>
<p><strong>为什么“视觉类改造”是Agent的强项？</strong> 因为它能看到页面结构，不用一句句解释意图，有些Agent还能预估效果。有了Agent帮忙把信息加工好，减少了很多沟通成本，效果一目了然，需求“对齐成本”由Agent承担了～以前为了“一个圆角是4px还是8px”争论半天，现在Agent直接统刷一遍，大家都省心。有了Agent，<strong>让“执行型工作”被自动化，所有角色都往“判断、审阅、策略、决策”迁移</strong>，对传统的开发流程也产生了很大影响。</p>
<h2 data-id="heading-2">案例2：Agent改造活动页</h2>
<p>上文演示了Agent如何高效完成复杂的需求对齐。接下来挑战一个更考验效率的场景：<strong>高频、短周期的运营活动页</strong>。马上就是圣诞节了，文心快码又要搞事情了！传统流程大家都很熟悉：运营、PM提想法 → 设计师出图 → 研发开发活动组件 → 漫长的沟通和反复调整。流程链路长，为了赶上线窗口大家往往都很疲惫。现在只用三步：<strong>运营、PM提想法 → Agent结合Rules快速产出页面骨架 → 研发同学做最终集成和收尾</strong>。</p>
<p>来演示下PM如何通过文心快码Agent创建一个圣诞活动页面吧～输入指令：“把1024活动页改造成一个文心快码圣诞节活动页，要求包含活动规则模块和醒目的Banner，风格必须符合公司Design System规范。”</p>
<p>Agent已经开始工作了，这时你可能会有疑问：Agent写的代码会不会不符合公司的规范？颜色、间距会不会乱套？这就涉及Agent协作中的一个秘密武器：<strong>Rules (工程规范)</strong> 。研发会预设好design-system.md文件，这里强制规定了品牌设计师预设的“圣诞红”色值、按钮的大小、间距规范等。 这就像是给Agent戴上了一套“紧箍咒”，保证生成的页面不管怎么变，都一定符合文心快码的品牌调性。有了这套内置了工程规范的Rules，就不用花费时间去做样式Review，也不用担心PM在提需求时，Agent会生成一个和品牌格格不入的页面。<strong>Agent真正成了团队代码质量的守门人。</strong></p>
<p>节日主题页永远赶时间，因为运营想要快：明天上线、今晚改，设计可能只有一张活动的头图，前端要把主题“套”到现有页面，很花时间。Agent做主题换肤时，能根据“头图+色板+关键词”推断风格，自动添加“雪花、红绿配色、圣诞元素”，能避免你手动处理一堆margin/transition。</p>
<p>Agent改造运营活动页为圣诞节风格视频👉<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FcrYJB7QB2WijFxvAJaeD2g" target="_blank" title="https://mp.weixin.qq.com/s/crYJB7QB2WijFxvAJaeD2g" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/crYJB7QB2…</a></p>
<p>代码已经生成完成了，不仅组件和样式是规范的，连活动文案都自动填充好了：“圣诞狂欢，码力全开！” ，这可比让人头疼的各种ooxx虚拟占位符强太多了！</p>
<p>通过Agent，我们把原本需要三天的“PM/设计/FE协作流程”压缩到了<strong>几分钟，</strong> 这就是Agent重塑跨角色协作带来的提效新范式！</p>
<p><strong>人类擅长审美判断，Agent擅长重复性批量改造。</strong> 最快的方式是人类给审美方向，Agent批量铺开。我们甚至把团队里最资深运营同学的经验，做成了一个 <strong>“活动页面设计专家”</strong> 。它知道什么样的活动标题点击率高，什么样的布局转化率高。它生成的页面，是带着“运营智慧”的。</p>
<h2 data-id="heading-3">案例3：Agent构建数据统计看板</h2>
<p>上文在Agent的帮助下，高效上线了一个活动运营页面。为了方便观测活动效果，提前准备好了数据统计表，来试试让Agent构建数据看板：“在src/app/[lng]/dataAnalyse路径里面，以 src/constants/dataAnalyse.ts里面的 ACTIVITY_DATA为数据基础，制作一个适配 ACTIVITY_DATA数据格式的数据统计页面，要求有：根据 trackUuid去重，统计uv和pv数据的Echart柱状图，以天为横轴；使用antd的table展示，适配ACTIVITY_DATA数据格式的表格数据”。</p>
<p>数据页涉及表格、分页、筛选，还要对接接口、处理 loading/error，有时候还要自定义图表样式。<strong>这个场景特别适合展示Agent的“组合能力”</strong> ，帮你选图表类型，根据字段自动生成表格+Axios+TS类型，帮你生成“骨架代码 + hook + layout”。<strong>人类给目标，Agent可以自动补全细节</strong>，你可以说：“我要展示日活突增原因”，Agent可以自动提示你需要：折线图、分析维度、时间范围选择等。数据类页面很适合自动化，因为未来可能直接“上传数据库结构 → 自动生成后台系统”。</p>
<p>这里有个难点：如果让人来写，得先去读懂 ACTIVITY_DATA的数据结构是数组还是对象？字段名是 date 还是 timestamp？然后得写去重逻辑，还得去查Echarts的配置文档——配置项多到让人头皮发麻。但来看Agent的操作：它第一步就读取了数据文件的类型定义（TypeScript Interface），准确得理解了“根据trackUuid去重”这个逻辑，并自动生成了lodash的去重代码。最关键的是，Echarts的配置代码，一次性就写对了，不用研发去翻文档复制粘贴。完成后打开页面看看：柱状图出来了，表格也出来了。</p>
<p>构建数据统计Agent，并共享给全项目成员使用视频效果👉<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FcrYJB7QB2WijFxvAJaeD2g" target="_blank" title="https://mp.weixin.qq.com/s/crYJB7QB2WijFxvAJaeD2g" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/crYJB7QB2…</a></p>
<p>以后谁想看数据，把这个Agent分享给他就行，想要什么维度的数据，直接跟Agent说，它就能调整图表，这就叫 <strong>“数据民主化”</strong> 呀～</p>
<h2 data-id="heading-4">Q&amp;A</h2>
<p><strong>Q1：Agent听起来很强，会不会造成依赖？会不会变得不会自己动脑？</strong></p>
<p><strong>A：</strong> 这和IDE自动补全刚出来时大家的担心一样，但其实，我们反而更能把时间放在系统性思考上。在协作层面，本质上Agent替代的是“重复性劳动”和“对齐成本”，而不是工程师和PM的判断力。可以说：<strong>Agent把我们从“低价值沟通”中解放出来，让我们能把脑力集中在更值得思考的地方。</strong></p>
<p><strong>Q2：既然Plan Agent能拆需求、Design Agent能产图，PM在团队里的价值是不是变弱了？</strong></p>
<p><strong>A：</strong> 以前PM很多时间花在“做文档、补图、翻译给研发”。现在这些都可以交给Agent，PM能把精力放到：业务策略、用户洞察、A/B方案决策、多Agent工作流的调度，<strong>PM的角色从“信息搬运工”升级成“智能团队的策划者”。</strong></p>
<p><strong>Q3：文心快码提供了非常多的Agent，有什么使用小窍门吗？</strong></p>
<p><strong>A：</strong> 想要高效使用文心快码的多Agent ，需要抓住三个关键词：<strong>专业化、高质量和强协同</strong>。</p>
<p>首先是专业化：按任务选对Agent。如果你要转设计稿，用Figma2code；遇到Bug，就交给Debug Agent。它们内置了专业的领域知识，效率是最高的。其次是高质量：要善用规范和审查。 像上文演示的，通过Rules确保 Agent不犯低级错误，让CodeReview Agent在代码提交前自动把关规范和逻辑，这样代码就能得到双重保障。第三点，也是最关键的：利用Architect实现强协同。 Agent之间不是孤立的，一些复杂的研发任务可以通过Architect定义一个工作流，将DeepRead Agent、Actor Agent和WebSearch Agent串联起来，让它们像流水线一样自动化分析和拆解复杂任务并执行。</p>
<p><strong>Q4：怎么让Code Agent不乱改自己的项目？</strong></p>
<p><strong>A：</strong> Agent有时会越界，改动一些不需要它做的事情。Agent的能力强在“广度 + 主动性”，但也正因为主动性强，它极易越界，所以必须用规则（Rules）把它的活动范围、权限、约定全部框住。Rules不是限制能力，而是保障结果可控、可预期。</p>
<p><strong>Q5：演示过程中，对话首页有一个Spec Mode，这是什么新功能？</strong></p>
<p><strong>A：</strong> Spec模式是一种新的协作方式：让Agent先把它的理解与计划写成文档，把要做的事情拆成任务，经过用户确认再进行相应的代码编写，从而让Agent的代码生成质量和效果大幅提升。<strong>通过Spec，任务一次成功率显著提升、返工大幅减少、代码质量更稳。</strong> 目前Spec还处于Beta阶段，欢迎大家尝鲜试用，并提出意见，共同成长～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从前端工程师的角度将SEO做到极致 -- 菜鸟来实操]]></title>    <link>https://juejin.cn/post/7578902814022680591</link>    <guid>https://juejin.cn/post/7578902814022680591</guid>    <pubDate>2025-12-02T07:43:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578902814022680591" data-draft-id="7573589277004890150" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从前端工程师的角度将SEO做到极致 -- 菜鸟来实操"/> <meta itemprop="keywords" content="前端,SEO"/> <meta itemprop="datePublished" content="2025-12-02T07:43:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PBitW"/> <meta itemprop="url" content="https://juejin.cn/user/3048261967153544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从前端工程师的角度将SEO做到极致 -- 菜鸟来实操
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048261967153544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PBitW
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:43:00.000Z" title="Tue Dec 02 2025 07:43:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在开发公司海外官网时，我整理了项目中的数据埋点方案，并写成一篇掘金文章：</p>
<ol>
<li><a href="https://juejin.cn/post/7366527815292878882" target="_blank" title="https://juejin.cn/post/7366527815292878882">全网最简单的 Vue 数据埋点</a></li>
</ol>
<p>其实当时就想发一篇SEO相关文章，但是当时都是参考的另一位大佬的文章，基本上使用的也就是里面的一些内容，很多东西也不知道，所以就感觉没有必要写！</p>
<p>参考文章见：<a href="https://juejin.cn/post/7380688287549800467" target="_blank" title="https://juejin.cn/post/7380688287549800467">从前端工程师的角度将SEO做到极致🌈</a></p>
<p>回头一看，发现大佬写的还是很强，我这次遇见的问题，其实这文章里面也提过了，只是菜鸟不知道大佬写的东西可以解决我的问题 /(ㄒoㄒ)/~~</p>
<p>这篇文章相当于是大佬文章的一个实践，部分没有用上，因为感觉有重复或者不知道是什么，可以酌情观看！</p>
<h2 data-id="heading-0">1、添加 TDK</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7e3787f1f53462693d012ccf0eeba89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=zEl7WuSXySu1doileBgEd6hg1qc%3D" alt="image.png" loading="lazy"/></p>
<p>所以菜鸟给自己的网站是这样设置的</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Sailgene<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span>
  <span class="hljs-attr">name</span>=<span class="hljs-string">"Keywords"</span>
  <span class="hljs-attr">content</span>=<span class="hljs-string">"Sequencing,Nanopore,Revio,PacBio,ONT,DRS,ultra-long sequencing,full-length transcriptome,Full-length Transcriptome Sequencing,direct cDNA sequencing,tail iso-seq,small RNA sequencing,sRNA-seq,High-throughput Sequencing,long reads sequencing,Sailgene,NGS,TGS,WGS,Genome,Transcriptome,Metagenome,DNA sequencing,RNA sequencing"</span>
/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span>
  <span class="hljs-attr">name</span>=<span class="hljs-string">"description"</span>
  <span class="hljs-attr">content</span>=<span class="hljs-string">"The leading global provider of multi-omics services and solutions in genomics, transcriptomics, and microbiomics, equipped with PacBio Revio, Nanopore PromethION, Illumina, and DNBSEQ sequencing platforms, offers cost-effective NGS and TGS sequencing services for all sample types."</span>
/&gt;</span>
</code></pre>
<p>当时不知道 Keywords 被废弃了，所以还是加了。</p>
<h2 data-id="heading-1">2、HTML语义化</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00be5073de1f40d588b0d068470dbec7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=TJOSdBvplAdnkR6KPECodLQRGr4%3D" alt="image.png" loading="lazy"/></p>
<p>所以菜鸟在开发时，基本上img都加上了alt，该用h标签的就用了（且保证了每个界面只有一个h1），header、footer也都用了！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9db58a0d5b0943829e4cf4070b6ffc2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=JDhCiDaxnxQZ4ac%2FvxzmkJ3fPbs%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">3、Open Graph 协议</h2>
<p>菜鸟感觉这个和 <strong>meta标签的TDK</strong> 是差不多的，eg:</p>
<pre><code class="hljs language-ini" lang="ini">&lt;meta <span class="hljs-attr">property</span>=<span class="hljs-string">"og:title"</span> content=<span class="hljs-string">"Sailgene"</span> /&gt;
&lt;meta <span class="hljs-attr">property</span>=<span class="hljs-string">"og:type"</span> content=<span class="hljs-string">"organism.gene.Sequencing"</span> /&gt;
&lt;meta
  <span class="hljs-attr">property</span>=<span class="hljs-string">"og:description"</span>
  <span class="hljs-attr">content</span>=<span class="hljs-string">"The leading global provider of multi-omics services and solutions in genomics, transcriptomics, and microbiomics, equipped with PacBio Revio, Nanopore PromethION, Illumina, and DNBSEQ sequencing platforms, offers cost-effective NGS and TGS sequencing services for all sample types."</span>
/&gt;
&lt;meta
  <span class="hljs-attr">property</span>=<span class="hljs-string">"og:Keywords"</span>
  <span class="hljs-attr">content</span>=<span class="hljs-string">"Sequencing,Nanopore,Revio,PacBio,ONT,DRS,ultra-long sequencing,full-length transcriptome,Full-length Transcriptome Sequencing,direct cDNA sequencing,tail iso-seq,small RNA sequencing,sRNA-seq,High-throughput Sequencing,long reads sequencing,Sailgene,NGS,TGS,WGS,Genome,Transcriptome,Metagenome,DNA sequencing,RNA sequencing"</span>
/&gt;
</code></pre>
<p>总结：这个协议主要是 Facebook 提出来的，为了更好的展示用户分享的网页的内容，<strong>实现这个协议，有助于 SEO 优化，告诉 google 该网页有哪些内容，以及关键词等</strong>。</p>
<h2 data-id="heading-3">4、HTML lang</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8139e4e0be994259bb67523cea721e90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=Q03oHrj0jbZTW7eBZ3NM5xxYDSA%3D" alt="image.png" loading="lazy"/></p>
<p>当时这个菜鸟看不管啥项目都会有这个，所以暂时忽略了！</p>
<p>现在一看才发现留下了一个隐患，就是菜鸟开发的这个网站也可以中英文切换，但是切换后，我只<strong>设置了缓存里面的变化，并没有改变html的lang</strong>，所以这个希望大家可以引以为戒！</p>
<h2 data-id="heading-4">5、hreflang 属性</h2>
<p>这个和上面的不一样，菜鸟一开始以为是一个东西！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57b1ebfa84bf41feac0e44ac833631a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=g7OGx4%2B3qFdRl2m4q7fg4%2BE%2FTp8%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">6、SSR</h2>
<p>SSR 确实有更好的SEO效果，但是当时技术选型的时候没有考虑到需要推广，直接用了vue单页面开发，所以<strong>最开始的时候一定要确定好方向</strong>！</p>
<h2 data-id="heading-6">7、sitemap 站点地图 - 重点</h2>
<p>这个就是菜鸟这次加上的，具体原因是：</p>
<blockquote>
<p>香港及美国有2个公司，域名为（<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.sailgene.com" target="_blank" title="http://www.sailgene.com" ref="nofollow noopener noreferrer">www.sailgene.com</a> 和 <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.sailgene.us%25EF%25BC%2589%2C%25E4%25BD%2586%25E6%2598%25AFgoogle%25E7%2594%25A8sailgene%25E5%2585%25B3%25E9%2594%25AE%25E5%25AD%2597%25E6%2590%259C%25E7%25B4%25A2%25EF%25BC%258C%25E5%258F%25AA%25E8%2583%25BD%25E6%2590%259C%25E7%25B4%25A2%25E5%2587%25BA" target="_blank" title="http://www.sailgene.us%EF%BC%89,%E4%BD%86%E6%98%AFgoogle%E7%94%A8sailgene%E5%85%B3%E9%94%AE%E5%AD%97%E6%90%9C%E7%B4%A2%EF%BC%8C%E5%8F%AA%E8%83%BD%E6%90%9C%E7%B4%A2%E5%87%BA" ref="nofollow noopener noreferrer">www.sailgene.us）,但是google用sailgene关键字搜索，只能搜索出</a> <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.sailgene.com" target="_blank" title="http://www.sailgene.com" ref="nofollow noopener noreferrer">www.sailgene.com</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46c2c775aebe4944b1f70b530f2ebcc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=gA6Ha%2Bk63aQ6HwhvDPRAblTSvXk%3D" alt="image.png" loading="lazy"/></p>
<p>然后就问了如何实现 <strong>提交sitemap.xml</strong> 和 <strong>手动让 Google 抓取</strong></p>
<p>发现<code>sitemap.xml</code>就是一个文件，建好之后提交到服务器的<code>index.html</code>同级目录下就行。格式如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">urlset</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://www.sitemaps.org/schemas/sitemap/0.9"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://www.sailgene.com/<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2025-11-18<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://www.sailgene.com/#/content<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2025-11-18<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://www.sailgene.com/#/about<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2025-11-18<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://www.sailgene.com/#/contactus<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2025-11-18<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://www.sailgene.com/#/resources/sample<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2025-11-18<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://www.sailgene.com/#/services/0<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2025-11-18<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://www.sailgene.com/#/services/1<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2025-11-18<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://www.sailgene.com/#/services/2<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2025-11-18<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loc</span>&gt;</span>https://www.sailgene.com/#/services/3<span class="hljs-tag">&lt;/<span class="hljs-name">loc</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">lastmod</span>&gt;</span>2025-11-18<span class="hljs-tag">&lt;/<span class="hljs-name">lastmod</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">priority</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">priority</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
  ……
<span class="hljs-tag">&lt;/<span class="hljs-name">urlset</span>&gt;</span>
</code></pre>
<p>然后<strong>手动让Goole录入</strong>，就是需要登录：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsearch.google.com%2Fsearch-console" target="_blank" title="https://search.google.com/search-console" ref="nofollow noopener noreferrer">search.google.com/search-cons…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c986692d84214a5f9f53aa494d0c5c8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=i58HEQ%2Fp8QRc%2FAdX1PHAfPHE7nk%3D" alt="image.png" loading="lazy"/></p>
<p>菜鸟这里操作错了，把这个Goole生成的文件放到服务器的<code>index.html</code>同级目录下了，<strong>不知道有没有用，反正验证通过了，然后就跳转到了这里</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a007964a8da4380a6aa79d57b3759e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=45Px0f1PXLF5YVll4b7NOyiAClo%3D" alt="image.png" loading="lazy"/></p>
<p>这里还要再进行站点地图的设置</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0daddab96dee463aad2b1b99d07a3bb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=SkODgimlxQrFNyBrvE%2BEkFDvQgw%3D" alt="image.png" loading="lazy"/></p>
<p>点击</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a4f35c003594836a77982daaaadc151~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=zl%2BpvJibYNJSBeO7hmhctB6Hh2w%3D" alt="image.png" loading="lazy"/></p>
<p>然后输入并提交即可</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a00e4b7413740c29fb37a1355d0be5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=ihmYmvwDsSpWqKkGZ0BychQSEfw%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">注意</h3>
<blockquote>
<p>需要等待两三天，Goole 才会搜录，需要耐心！</p>
</blockquote>
<h3 data-id="heading-8">成果展示</h3>
<p>这是优化后，被搜录了的展示</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/550e0873a5e3418cbd33cdbe23cb3bb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=%2FhFV1OP5vVN%2FWu1qB8W4tMJiCpQ%3D" alt="image.png" loading="lazy"/></p>
<p>但是还是老话，SPA并不适合做搜录，搜录的也仅仅只是首页或者空白模板，只有搜<strong>网站名</strong>才能出现，搜网页内容是不会出现的！</p>
<h2 data-id="heading-9">8、结构化数据</h2>
<p>这里菜鸟也用错了，直接复制的大佬文章里面的代码，然后自己改成了这样</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"application/ld+json"</span>&gt;</span><span class="javascript">
  {
    <span class="hljs-string">"@context"</span>: <span class="hljs-string">"https://schema.org"</span>,
    <span class="hljs-string">"@type"</span>: <span class="hljs-string">"Product"</span>,
    <span class="hljs-string">"headline"</span>: <span class="hljs-string">"Sequencing,Nanopore,Revio,PacBio,ONT,DRS,ultra-long sequencing,full-length transcriptome,Full-length Transcriptome Sequencing,direct cDNA sequencing,tail iso-seq,small RNA sequencing,sRNA-seq,High-throughput Sequencing,long reads sequencing,Sailgene,NGS,TGS,WGS,Genome,Transcriptome,Metagenome,DNA sequencing,RNA sequencing"</span>
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>其实这个JSON-LD相当于一门有规定的语言，不能像菜鸟这样乱写，不会生效，具体见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fsearch%2Fdocs%2Fappearance%2Fstructured-data%2Fcarousel%3Fhl%3Dzh-cn" target="_blank" title="https://developers.google.com/search/docs/appearance/structured-data/carousel?hl=zh-cn" ref="nofollow noopener noreferrer">developers.google.com/search/docs…</a></p>
<h2 data-id="heading-10">9、robots.txt</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a60e6e191bf4745a33b9db0c7407a51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=9%2F6E2o5VjAOYNbXLP3sc7ssTSgY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-11">注意</h3>
<p>但是菜鸟在写下篇文章<a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">SPA到SSR的升级之路！</a>时，发现<code>Nuxt</code>是会带上这个文件的，所以就要注意配置！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef29ca381c8648aa9cbef316e94de1b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=ifrbiSu2M8j6GtPB9u3GuM%2BfjAA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-12">10、余下</h2>
<p>余下的是我没有使用到的但是我感觉有用的，可以直接去看大佬的文章<a href="https://juejin.cn/post/7380688287549800467" target="_blank" title="https://juejin.cn/post/7380688287549800467">从前端工程师的角度将SEO做到极致🌈</a>，但是怕大佬删掉了，所以我截图放这里保存一下!</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d48df8d8dac34d1a82db236595461af5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=sX0pV17qdqYFhUm8ZEZVyNW2SQk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-13">效果</h2>
<p>有图真相，这个是掘金的SEO评分：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9a724c5b11f4a7491ae95232f7dcfc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=7JjvxGbzxbVG9pHbxn%2FL0mvdvQQ%3D" alt="image.png" loading="lazy"/></p>
<p>这是我优化完，我的网站的SEO评分：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de98c97611744c8ea4ccabad88b723db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266180&amp;x-signature=pMuCLRGUth88geJxBeRQNKSiy8M%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PHP header already sent：中文乱码、BOM、空格导致的全套解决方案（图文版）]]></title>    <link>https://juejin.cn/post/7578853751530389519</link>    <guid>https://juejin.cn/post/7578853751530389519</guid>    <pubDate>2025-12-02T07:09:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578853751530389519" data-draft-id="7578853751530307599" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PHP header already sent：中文乱码、BOM、空格导致的全套解决方案（图文版）"/> <meta itemprop="keywords" content="PHP"/> <meta itemprop="datePublished" content="2025-12-02T07:09:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户60732036945"/> <meta itemprop="url" content="https://juejin.cn/user/2156565626632060"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PHP header already sent：中文乱码、BOM、空格导致的全套解决方案（图文版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2156565626632060/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户60732036945
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:09:50.000Z" title="Tue Dec 02 2025 07:09:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是不是也遇到过这个经典报错：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Warning:</span> Cannot modify header information - headers already sent <span class="hljs-keyword">by</span>...
</code></pre>
<p>中文名就叫：</p>
<blockquote>
<p><strong>“还没来得及发 HTTP 头，你就先输出东西了”</strong></p>
</blockquote>
<p>别慌，这绝对不是大问题，但也是 PHP 新手最容易踩的坑。<br/>
今天我用最简单的方式，带你把这个问题彻底讲懂。</p>
<hr/>
<h2 data-id="heading-0">1⃣ 这个错误到底什么意思？</h2>
<p>一句话解释：</p>
<blockquote>
<p>你调用 <code>header()</code>、<code>setcookie()</code>、<code>session_start()</code> 之前，<br/>
代码里已经“悄悄输出了一些东西”。</p>
</blockquote>
<p>这些“输出”可能是：</p>
<ul>
<li>一个看不见的空格</li>
<li>一个回车符</li>
<li>隐藏的 BOM 字节</li>
<li>你自己 echo/var_dump 的内容</li>
<li>引入文件里的输出</li>
</ul>
<p>只要有一点点输出，header 就会报错。</p>
<hr/>
<h2 data-id="heading-1">2⃣ 最常见的罪魁祸首：<strong>UTF-8 BOM</strong></h2>
<p>很多编辑器默认保存为“UTF-8 BOM”，而 PHP 最怕 BOM。</p>
<p>BOM 会在文件最开头偷偷输出三个字节：</p>
<pre><code class="hljs">EF BB BF
</code></pre>
<p>你看不见，但服务器能看到。</p>
<p>于是服务器说：</p>
<blockquote>
<p>“啊你已经输出了，我就不能设置 header 了。”</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">✔ 如何判断文件是不是 BOM？</h3>
<p>症状明显：</p>
<ul>
<li>中文突然乱码</li>
<li>header 报错特别早</li>
<li>新建文件使用过 Windows 记事本 / Dreamweaver</li>
</ul>
<hr/>
<h3 data-id="heading-3">✔ 如何去掉 BOM？</h3>
<p><strong>VSCode</strong><br/>
右下角 → 点击“UTF-8” → 选择 <strong>UTF-8（无 BOM）</strong> 保存即可。</p>
<p><strong>Notepad++</strong><br/>
菜单 → 格式 → 选择 <strong>UTF-8（无 BOM）</strong></p>
<p><strong>宝塔面板编辑器 / PHPStorm</strong><br/>
默认不会带 BOM，比较安全。</p>
<hr/>
<h2 data-id="heading-4">3⃣ 第二大元凶：文件顶部的空格 + 回车</h2>
<p>PHP 文件头部常见两种错误：</p>
<p>❌ 错误写法 1：</p>
<pre><code class="hljs language-php" lang="php">(空格)(空格)
<span class="hljs-meta">&lt;?php</span>
</code></pre>
<p>❌ 错误写法 2：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-comment">// 顶部多了一行空行</span>
</code></pre>
<p>这两个都会导致 header 报错。</p>
<hr/>
<h3 data-id="heading-5">✔ 正确写法</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
</code></pre>
<p>第一行第一列必须是 <code>&lt;?php</code>，上面不能有任何内容。</p>
<p>记住：<br/>
<strong>空格也算输出！回车也算输出！</strong></p>
<hr/>
<h2 data-id="heading-6">4⃣ 第三类：你自己输出的调试信息</h2>
<p>最容易忘的情况：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">var_dump</span>($data);  
<span class="hljs-selector-tag">header</span>("Location: /index.php");
</code></pre>
<p>你调试一下忘记删了，header 直接挂掉。</p>
<p>其它输出包括：</p>
<ul>
<li>echo</li>
<li>print</li>
<li>print_r</li>
<li>die</li>
<li>exit</li>
</ul>
<p>都要检查一遍。</p>
<hr/>
<h2 data-id="heading-7">5⃣ include/require 的文件里也可能有输出</h2>
<p>主文件可能没问题，但你这样写：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-built_in">require</span> <span class="hljs-string">'config.php'</span>;
<span class="hljs-title function_">header</span>(<span class="hljs-string">"Location: xxx.php"</span>);
</code></pre>
<p>只要 config.php 有：</p>
<ul>
<li>BOM</li>
<li>空格</li>
<li>echo</li>
<li>HTML</li>
</ul>
<p>都会导致 header 报错。</p>
<p>记得 <strong>所有被引入的文件也要检查</strong>。</p>
<hr/>
<h2 data-id="heading-8">6⃣ 万能解决方案：输出缓冲（最稳）</h2>
<p>如果你实在搞不清哪里输出了，可以直接使用：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">ob_start</span>();
</code></pre>
<p>把它放在所有代码最上方。</p>
<p>PHP 会把所有输出暂存，<br/>
等你把 header / cookie / session 都设置完，<br/>
再统一输出。</p>
<hr/>
<h2 data-id="heading-9">7⃣ 最稳定推荐写法（复制就能用）</h2>
<pre><code class="hljs language-php" lang="php"><span class="hljs-meta">&lt;?php</span>
<span class="hljs-title function_ invoke__">ob_start</span>();
<span class="hljs-title function_ invoke__">session_start</span>();
<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"Content-Type: text/html; charset=utf-8"</span>);

<span class="hljs-comment">// 你的逻辑...</span>
</code></pre>
<p>这套写法能避免 99% 的 “header already sent”。</p>
<h2 data-id="heading-10">9⃣ 最后给你一个超实用排查顺序（收藏版）</h2>
<ol>
<li>检查文件顶部是否有空格/空行</li>
<li>转成 UTF-8 无 BOM</li>
<li>搜索所有 output（echo/print/var_dump）</li>
<li>检查 include 的文件</li>
<li>统一加 <code>ob_start()</code></li>
<li>不行再检查 CDN 或 gzip（非常少见）</li>
</ol>
<p>按这顺序查，10 分钟必解决。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我用 AI，一天就把一个桌面提醒插件撸完了]]></title>    <link>https://juejin.cn/post/7579063781071323190</link>    <guid>https://juejin.cn/post/7579063781071323190</guid>    <pubDate>2025-12-02T07:45:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579063781071323190" data-draft-id="7578811288819843115" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我用 AI，一天就把一个桌面提醒插件撸完了"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T07:45:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="加瓦点灯"/> <meta itemprop="url" content="https://juejin.cn/user/808846972949678"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我用 AI，一天就把一个桌面提醒插件撸完了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/808846972949678/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    加瓦点灯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:45:02.000Z" title="Tue Dec 02 2025 07:45:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">我用 AI，一天就把一个桌面提醒插件撸完了</h2>
<blockquote>
<p>这个插件是基于utools平台的， 标题虽然有点夸张，但在 AI 的加持下，<strong>这个插件的 MVP 版本，确实是我和 ChatGPT 搭档一天撸出来的</strong>， 感兴趣的可以看看哦</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">一、先说说 uTools：一个很适合“折腾”的效率神器</h3>
<p>如果你还没用过 uTools，可以简单理解为：</p>
<blockquote>
<p>一个跨平台的效率启动器 / 快速搜索工具，<br/>
再加上一整套插件生态 + 开发者支持。</p>
</blockquote>
<p>具体可以看看官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.u-tools.cn%2Findex.html" target="_blank" title="https://www.u-tools.cn/index.html" ref="nofollow noopener noreferrer">uTools 是一种高效工作方式，AI 时代的轻工具平台</a></p>
<p>它有几个特点特别适合做这种“小而精”的工具：</p>
<ul>
<li><strong>跨平台</strong>：Windows / macOS / Linux 都能跑；</li>
<li><strong>插件机制</strong>：很多能力（窗口、托盘、系统通知等）都可以通过插件调用；</li>
<li><strong>唤起方便</strong>：全局快捷键一呼即出，非常适合“查一下、记一下、记个提醒”这种场景；</li>
<li><strong>开发门槛低</strong>：前端就是一套网页技术栈（我用的是 Vue），后端你爱怎么写怎么写。</li>
</ul>
<p>对我这种常年写 Java 的后端来说，用 uTools 做一个贴合自己使用习惯的“小插件”，成了一个很自然的选择。</p>
<hr/>
<h3 data-id="heading-2">二、为什么要做一个桌面提醒插件？</h3>
<p>市面上提醒 / 待办类应用已经很多了，但一直有几个痛点让我很难坚持用下去：</p>
<ol>
<li>
<p><strong>提醒不在“当前设备”上</strong><br/>
我工作时间基本都盯着电脑，手机的闹钟提醒太重了，也容易影响到同事，而插件提醒就是一个弹窗，随手一点就能关闭，很轻量，不扰人。</p>
</li>
<li>
<p><strong>重复规则太简单</strong><br/>
很多应用只支持：每天 / 每周几 / 每月几号。<br/>
但我经常需要一些更“奇怪”的规则，比如：</p>
<ul>
<li>每月 1、15、28 号各提醒一次；</li>
<li>每天 09:00、14:00、21:30 都要提醒；</li>
<li>工作日 09:00–18:00，每隔 45 分钟提醒喝水。</li>
</ul>
</li>
<li>
<p><strong>多渠道通知不好用</strong><br/>
有些事情我是真的不能错过，希望：</p>
<blockquote>
<p>桌面弹窗 + 系统通知 + 企业微信 / 钉钉<br/>
能一起推送一遍，有了站外推送， 即便不在电脑前，或者插件退出了，也能收到提醒。</p>
</blockquote>
</li>
</ol>
<hr/>
<h3 data-id="heading-3">三、插件长什么样？先上效果 &amp; 功能预览</h3>
<ul>
<li><strong>1：主界面 + 提醒列表</strong></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71cec64991c74122b3604079c2b0995a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg55Om54K554Gv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266648&amp;x-signature=XSWKUbV6tSxU6HGt3naDX1P5gYM%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>
<p><strong>2：新增 / 编辑提醒表单</strong></p>
<ul>
<li>标题、内容</li>
<li>时间设置（首个时间 + 多个额外时间点）</li>
<li>重复规则（每天 / 每周 / 每月 / 每年 / 自定义）</li>
<li>时间段循环提醒：起止时间 + 间隔分钟数</li>
</ul>
</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/888acb94fce341a1ae71569c989e2d49~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg55Om54K554Gv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266648&amp;x-signature=AGtrZz5DloVMJ8Ewi7jwvQLLLEk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52e1f9a25e1043c6ac8811bfa7f413cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg55Om54K554Gv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266648&amp;x-signature=DyZcdv5mrRtZbvftaFrkg3uLcPA%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>3：通知设置 + 多渠道配置</strong></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76ebf7c2b88a4ef3814a8f7874281915~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg55Om54K554Gv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266648&amp;x-signature=a1BrF2G3TYajdhGimKWMG7hWk%2Fo%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>4：提醒效果</strong></li>
</ul>
<p>弹窗提醒+系统提醒
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b18f7187f1ab41379cf91cad2712c96b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqg55Om54K554Gv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266648&amp;x-signature=y9uqdkxK4DWqXOWj6sY8hRjcnL4%3D" alt="20fda2b53f9fd8ef7068156d7c1a063d.jpg" loading="lazy"/></p>
<h4 data-id="heading-4">当前插件已经支持的功能</h4>
<p>简单列一下目前已经实现的功能：</p>
<ul>
<li>
<p>✅ <strong>各种重复类型</strong></p>
<ul>
<li>不重复 / 每天 / 每周（任意组合周几）</li>
<li>每月 / 每年（支持任意日期）</li>
<li>自定义模式（用药提醒、纪念日等）</li>
</ul>
</li>
<li>
<p>✅ <strong>多时间点提醒</strong></p>
<ul>
<li>每天可以设置多个时间点：<br/>
比如 <code>09:00 / 14:00 / 21:30</code> 各提醒一次</li>
</ul>
</li>
<li>
<p>✅ <strong>时间段循环提醒</strong></p>
<ul>
<li>
<p>设置「时间段 + 间隔」，例如：</p>
<ul>
<li>每天 09:00–18:00，每隔 45 分钟提醒一次</li>
</ul>
</li>
</ul>
</li>
<li>
<p>✅ <strong>Cron 表达式</strong></p>
<ul>
<li>给自己留了一个“高级玩法入口”</li>
</ul>
</li>
<li>
<p>✅ <strong>AI 一句话创建提醒</strong></p>
<ul>
<li>比如：“明天下午三点提醒我交电费”，后端解析出结构化提醒数据</li>
</ul>
</li>
<li>
<p>✅ <strong>多渠道通知</strong></p>
<ul>
<li>桌面弹窗（即使插件窗口隐藏）</li>
<li>系统通知</li>
<li>Bark 推送</li>
<li>企业微信机器人</li>
<li>钉钉机器人</li>
</ul>
</li>
<li>
<p>✅ <strong>后端统一存储</strong></p>
<ul>
<li>提醒记录保存在后端，天然支持多平台同步（同一账号，多个设备一起用）</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-5">四、整体实现</h3>
<p>主要分三块：</p>
<ol>
<li>
<p><strong>uTools 插件前端（Vue）</strong></p>
<ul>
<li>负责配置 / 展示 / 弹窗</li>
<li>通过 HTTP + WebSocket 和后端交互</li>
</ul>
</li>
<li>
<p><strong>Spring Boot 后端</strong></p>
<ul>
<li>负责存储提醒、计算下一次执行时间、触发提醒</li>
</ul>
</li>
<li>
<p><strong>通知适配层</strong></p>
<ul>
<li>把“提醒事件”统一分发到不同渠道：Bark、企微、钉钉、桌面弹窗、系统通知……</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-6">五、后端实现</h3>
<h4 data-id="heading-7">5.1 表结构设计：为“复杂重复规则”留好余地</h4>
<p>提醒系统的本质是一个“带规则的定时任务系统”。<br/>
我给每条提醒设计了大致这样的结构（简化版）：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t_user_reminder (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
    user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户ID'</span>,
    template_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'引用的模板ID，可为空'</span>,

    title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'提醒标题'</span>,
    content TEXT COMMENT <span class="hljs-string">'提醒内容'</span>,

    remind_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'下一次提醒时间'</span>,

    repeat_rule <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'NONE, DAILY, WEEKLY, MONTHLY, YEARLY, WORKDAY, CUSTOM'</span>,
    custom_mode <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'WEEKLY, YEARLY, MEDICINE, ANNIVERSARY 等'</span>,

    repeat_interval <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'间隔数，如每2天/每2周'</span>,
    repeat_weekdays <span class="hljs-keyword">SET</span>(<span class="hljs-string">'1'</span>,<span class="hljs-string">'2'</span>,<span class="hljs-string">'3'</span>,<span class="hljs-string">'4'</span>,<span class="hljs-string">'5'</span>,<span class="hljs-string">'6'</span>,<span class="hljs-string">'7'</span>) <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'每周的星期几'</span>,
    repeat_month_days <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'每月的哪几天，逗号分隔'</span>,

    status TINYINT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">1</span> COMMENT <span class="hljs-string">'1=启用 0=关闭 2=已结束'</span>,

    create_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    update_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
);
</code></pre>
<p>几个关键点：</p>
<ul>
<li><code>repeat_rule + custom_mode</code> 用来描述规则类型；</li>
<li><code>repeat_weekdays</code> / <code>repeat_month_days</code> 支持“一条记录多个日期”；</li>
<li><code>remind_time</code> 始终存“下一次执行时间”，触发一次就往后推一次。</li>
</ul>
<p>调度时的伪逻辑：</p>
<ol>
<li>定时任务定期扫描 <code>remind_time &lt;= now()</code> 且启用的记录；</li>
<li>推送通知；</li>
<li>根据规则计算下一次 <code>remind_time</code>，更新回去；</li>
<li>如果已经没有下一次了（比如单次提醒已过期），就把 <code>status</code> 改为已结束。</li>
</ol>
<h4 data-id="heading-8">5.2 Cron 表达式 &amp; next 计算</h4>
<p>为了给自己留个“高级玩法”，我加了 Cron 表达式的支持。</p>
<p>现实问题：<br/>
用户可能写 5 段，也可能写 6 段（带秒），还可能是带 <code>?</code> 的那种。<br/>
处理方式：</p>
<ol>
<li>后端接收时先做<strong>规范化</strong>：<br/>
缺秒就补秒，缺 <code>?</code> 就按默认规则填；</li>
<li>统一交给一个 <code>cron.next(baseTime)</code> 来算下一次执行时间。</li>
</ol>
<p>baseTime 的选择上，我最后简化成这样：</p>
<pre><code class="hljs language-ini" lang="ini">LocalDateTime <span class="hljs-attr">base</span> = LocalDateTime.now()<span class="hljs-comment">;</span>

if (!isForSchedule 
    &amp;&amp; remind.getCronStartTime() != null 
    &amp;&amp; base.isBefore(remind.getCronStartTime())) {
    <span class="hljs-attr">base</span> = remind.getCronStartTime()<span class="hljs-comment">;</span>
}

LocalDateTime <span class="hljs-attr">next</span> = cron.next(base)<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li>用于“预览”下次执行时间时，可能从 <code>cronStartTime</code> 算；</li>
<li>用于“调度”时，就是简单的 <code>now()</code>。</li>
</ul>
<p>这一块我其实是和 AI 来回沟通了几轮，让它帮我重构逻辑、校验边界条件，省了不少脑细胞。</p>
<h4 data-id="heading-9">5.3 AI 一句话创建提醒 &amp; Redis 限流</h4>
<p>我给自己加了一个很爽的小功能：</p>
<blockquote>
<p>在输入框里直接敲一句话：<br/>
“明天下午三点提醒我交电费”，<br/>
后端调用 AI 解析出时间、标题、备注，直接生成提醒。</p>
</blockquote>
<p>为了防止被恶意刷接口，用 Redis 做了一个非常简单的<strong>按天限流</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">public boolean checkAiLimit(Long userId) {
    String <span class="hljs-attr">key</span> = <span class="hljs-string">"ai_time_"</span> + userId<span class="hljs-comment">;</span>

    Long <span class="hljs-attr">count</span> = redisTemplate.opsForValue().increment(key)<span class="hljs-comment">;</span>
    if (count != null &amp;&amp; <span class="hljs-attr">count</span> == <span class="hljs-number">1</span>L) {
        long <span class="hljs-attr">seconds</span> = calcSecondsUntilEndOfDay()<span class="hljs-comment">;</span>
        redisTemplate.expire(key, Duration.ofSeconds(seconds))<span class="hljs-comment">;</span>
    }

    return count != null &amp;&amp; count &lt;= MAX_TIMES_PER_DAY<span class="hljs-comment">;</span>
}
</code></pre>
<ul>
<li>key 不带日期，过期时间设为当天剩余秒数；</li>
<li>第一次调用时设置失效时间，之后全部简单 <code>increment</code>；</li>
<li>超过阈值直接拒绝，给出友好提示。</li>
</ul>
<p>这段逻辑的方案设计，其实也是我先把想法和约束丢给 AI，让它帮我写完，再自己做一轮 review。</p>
<hr/>
<h3 data-id="heading-10">六、前端实现：复杂表单 + WebSocket + 独立提醒窗口</h3>
<p>前端整体基于 Vue，核心页面包括：</p>
<ul>
<li>提醒列表</li>
<li>新增 / 编辑提醒</li>
<li>即将提醒预览</li>
<li>通道配置弹窗</li>
<li>独立提醒弹窗窗口</li>
</ul>
<h4 data-id="heading-11">6.1 复杂时间 / 重复设置表单</h4>
<p>“新增提醒”这个表单是整个插件 UI 里最复杂的一块，要处理：</p>
<ul>
<li>首次提醒时间（日期 + 时间）</li>
<li>多个额外时间点 <code>extraTimes</code>（仅时间）</li>
<li>重复类型：不重复 / 每天 / 每周 / 每月 / 每年 / 自定义</li>
<li>自定义下的子模式：用药、纪念日等</li>
<li>时间段循环提醒：起止时间 + 间隔分钟</li>
</ul>
<p>展示多时间点时，我搞了一个简化版的展示字段 <code>displayTimesText</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">const</span> displayTimesText = computed(() =&gt; {
  <span class="hljs-keyword">const</span> [date, time] = extractDateAndTimeFromFirstDateTime();
  <span class="hljs-keyword">const</span> times = [time, ...form.extraTimes.filter(<span class="hljs-built_in">Boolean</span>)].filter(<span class="hljs-built_in">Boolean</span>);
  <span class="hljs-keyword">if</span> (!times.length) <span class="hljs-keyword">return</span> <span class="hljs-string">"未设置时间"</span>;
  <span class="hljs-keyword">return</span> times.join(<span class="hljs-string">"、"</span>);
});
</code></pre>
<p>开发过程中，AI 在这里帮我做了很多琐碎事情，比如：</p>
<ul>
<li>把“用户需求描述”翻译成结构化的 form 字段设计；</li>
<li>帮我生成初版的组件模板和样式；</li>
<li>排查 input[type="time"] 在不同浏览器下的一些小兼容问题；</li>
<li>优化滚动布局，解决双滚动条、按钮抖动等细节问题。</li>
</ul>
<h4 data-id="heading-12">6.2 WebSocket 长连接 &amp; 独立提醒窗口</h4>
<p>为了保证 <strong>“人不在插件窗口，提醒也能到桌面”</strong> ，我前端用了 WebSocket + 独立提醒窗口的方案。</p>
<p>基本流程：</p>
<ol>
<li>
<p>插件启动时，与后端建立 WebSocket 连接；</p>
</li>
<li>
<p>后端一旦有提醒触发，就推送一条消息；</p>
</li>
<li>
<p>前端收到消息后：</p>
<ul>
<li>如果主窗口在前台，可以直接弹页面内弹窗；</li>
<li>如果主窗口隐藏，则使用 uTools 能力打开一个独立提醒窗口 <code>remindWindow</code>，显示提醒信息、播放提示音。</li>
</ul>
</li>
</ol>
<p>伪代码结构类似这样：</p>
<pre><code class="hljs language-ini" lang="ini">let ws: WebSocket | <span class="hljs-attr">null</span> = null<span class="hljs-comment">;</span>
let heartbeatTimer: number | <span class="hljs-attr">null</span> = null<span class="hljs-comment">;</span>
let reconnectTimer: number | <span class="hljs-attr">null</span> = null<span class="hljs-comment">;</span>
let <span class="hljs-attr">reconnectAttempts</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
const <span class="hljs-attr">MAX_RECONNECT_ATTEMPTS</span> = <span class="hljs-number">5</span><span class="hljs-comment">;</span>
let remindWindow: <span class="hljs-attr">any</span> = null<span class="hljs-comment">;</span>

function initWebSocket() {
  <span class="hljs-attr">ws</span> = new WebSocket(HTTP_BASE + <span class="hljs-string">"/ws/reminder"</span>)<span class="hljs-comment">;</span>

  <span class="hljs-attr">ws.onopen</span> = () =&gt; {
    startHeartbeat()<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>

  <span class="hljs-attr">ws.onmessage</span> = (event) =&gt; {
    const <span class="hljs-attr">msg</span> = JSON.parse(event.data)<span class="hljs-comment">;</span>
    handleReminder(msg)<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>

  <span class="hljs-attr">ws.onclose</span> = () =&gt; {
    tryReconnect()<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
}
</code></pre>
<p>这里 AI 给我的主要帮助是：</p>
<ul>
<li>一次性生成了 WebSocket + 心跳 + 重连的模板代码；</li>
<li>帮我梳理清楚“重连最大次数”“心跳间隔”“关闭连接时清理定时器”等边界情况；</li>
<li>根据我贴出来的报错信息，定位过几次逻辑问题。</li>
</ul>
<h4 data-id="heading-13">6.3 多渠道通知设置 &amp; 提示音试听</h4>
<p>在插件设置页里，我提供了几种通知通道配置：</p>
<ul>
<li>Bark URL</li>
<li>企业微信机器人 Webhook</li>
<li>钉钉机器人 Webhook</li>
<li>是否开启桌面弹窗、系统通知</li>
<li>提示音选择 + 一键试听</li>
</ul>
<p>提示音做法很简单：</p>
<ul>
<li>将 <code>default.mp3 / soft.mp3 / strong.mp3</code> 放在静态资源目录；</li>
<li>选择不同值时，更新 <code>form.soundName</code>；</li>
<li>点击“试听”按钮时，用 <code>&lt;audio&gt;</code> 或 Audio 对象播放当前选择的声音。</li>
</ul>
<p>这些交互细节基本都是我先丢一句话给 AI：“我有三个提示音文件，如何在选择时可以试听？”<br/>
它给我一段完整实现，我再根据项目结构稍微改一下就能用。</p>
<hr/>
<h3 data-id="heading-14">七、通知适配层：给未来扩展通道留个口子</h3>
<p>后端有一个统一的 <code>NotifyChannel</code> 接口，所有通道都实现它：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NotifyChannel</span> {

    <span class="hljs-type">boolean</span> <span class="hljs-title function_">available</span><span class="hljs-params">(UserSettings settings)</span>;

    <span class="hljs-keyword">void</span> <span class="hljs-title function_">send</span><span class="hljs-params">(ReminderMsg msg, UserSettings settings)</span>;
}
</code></pre>
<p>然后分别有：</p>
<ul>
<li><code>BarkNotifyChannel</code></li>
<li><code>WeComRobotNotifyChannel</code></li>
<li><code>DingTalkRobotNotifyChannel</code></li>
<li>……（未来要扩的都可以继续加）</li>
</ul>
<p>总的推送服务大概这样：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class ReminderPushService {

    <span class="hljs-keyword">@Autowired</span>
    private List&lt;NotifyChannel&gt; notifyChannels;

    public void <span class="hljs-built_in">pushReminder</span>(TUserReminder reminder, UserSettings settings) {
        ReminderMsg msg = <span class="hljs-built_in">buildMsg</span>(reminder);
        for (NotifyChannel channel : notifyChannels) {
            if (channel.available(settings)) {
                channel<span class="hljs-selector-class">.send</span>(msg, settings);
            }
        }
    }
}
</code></pre>
<p>这种设计没什么炫技的地方，就是<strong>老老实实地面向接口编程</strong>。<br/>
但对后面扩展通道非常友好</p>
<hr/>
<h3 data-id="heading-15">八、为什么说“我用 AI，一天就把这个插件撸完了”？</h3>
<p>标题当然是带一点点“互联网文体”的 😂<br/>
准确一点说：</p>
<ul>
<li>
<p>如果让我自己从 0 开始设计、踩坑，这个插件可能要拆成<strong>好几天甚至一两周的业余时间</strong>；</p>
</li>
<li>
<p>这次我把很多事情都丢给 AI 帮忙：</p>
<ul>
<li>表结构初稿 &amp; 字段命名建议；</li>
<li>Cron 表达式兼容逻辑的实现 &amp; 重构；</li>
<li>Redis 限流的方案设计 + 代码；</li>
<li>WebSocket + 心跳 + 重连的模板；</li>
<li>Vue 表单的初版代码、样式优化建议；</li>
<li>各种细碎 bug：乱码、时间类型转换、滚动条问题……</li>
</ul>
</li>
</ul>
<p>结果就是：<strong>在已经很熟悉的 Java &amp; Vue 基础上，<br/>
靠 AI 填了大量机械、重复、查文档的部分</strong>，核心 MVP 确实是一整天搞定的。</p>
<p>我更多地是在做：</p>
<ul>
<li>需求决策：要不要这个功能？交互怎么做才顺手？</li>
<li>代码 Review：AI 给的代码哪里需要调整？</li>
<li>业务规则定义：这个提醒系统应该怎样才“顺人性”？</li>
</ul>
<p>AI 更适合作为一个<strong>高强度不抱怨的结对编程伙伴</strong>，帮我把“我已经知道怎么做，但懒得敲”的那部分快速完成。</p>
<hr/>
<h3 data-id="heading-16">九、写在最后</h3>
<p>到现在，「灵犀提醒」已经稳定地接管了我日常的很多小事：</p>
<ul>
<li>每天上班打卡、喝水、写日报；</li>
<li>每月房租、信用卡还款、各种账单；</li>
<li>特定日期的生日、纪念日提醒；</li>
<li>工作上的一些关键 follow-up，会同时打到企业微信 / 钉钉。</li>
</ul>
<p>这篇文章一方面是想分享下这套 <strong>“uTools + Spring Boot + AI 协作”的开发实践</strong></p>
<p>如果你：</p>
<ul>
<li>也常年对着电脑；</li>
<li>也老是忘东忘西；</li>
<li>也想找个机会实战一下“AI 辅助开发”；</li>
</ul>
<p>那不妨也找个周末，试试做一个属于你的“小插件”。</p>
<blockquote>
<p>如果你对这个提醒插件感兴趣，或者想看更细的某一块实现（比如 Cron 核心调度逻辑、WebSocket 服务端实现、AI 解析那一块），可以在评论区告诉我，</p>
</blockquote>
<p>如果，你也是个utools使用者， 不妨试用下插件哦</p>
<h3 data-id="heading-17">最后</h3>
<p>如果文章对你有帮助，点个免费的赞鼓励一下吧！关注公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFkCxUljJPvVRR1fYWGkZ-g" target="_blank" title="https://mp.weixin.qq.com/s/FkCxUljJPvVRR1fYWGkZ-g" ref="nofollow noopener noreferrer">:加瓦点灯，</a> 每天推送干货知识！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Elasticsearch：在隔离环境中安装 ELSER 模型]]></title>    <link>https://juejin.cn/post/7578818741698920454</link>    <guid>https://juejin.cn/post/7578818741698920454</guid>    <pubDate>2025-12-02T06:33:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578818741698920454" data-draft-id="7578811288820006955" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elasticsearch：在隔离环境中安装 ELSER 模型"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-02T06:33:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elasticsearch：在隔离环境中安装 ELSER 模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:33:15.000Z" title="Tue Dec 02 2025 06:33:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e69dd6753f1461391c2f1d60df1397a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=pqkfuL9kOiN46rtc8iVDAQDo8m8%3D" alt="" loading="lazy"/></p>
<p>在我之前的文章 “<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F131180664" title="https://elasticstack.blog.csdn.net/article/details/131180664" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch：部署 ELSER - Elastic Learned Sparse EncoderR</a>”，我描述了如何安装 ELSER 模型。在今天的文章中，我来讲讲如何在隔离的环境中安装 ELSER 模型。如果你在有网路的情况下，最容易安装 ELSER 的方法是是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fapi%2Fdoc%2Felasticsearch%2Fgroup%2Fendpoint-inference" title="https://www.elastic.co/docs/api/doc/elasticsearch/group/endpoint-inference" target="_blank" ref="nofollow noopener noreferrer">inference API</a>。我们可以通过如下的方式来进行。为了测试的方便，我们可以使用如下的方法来删除已经安装好的 ELSER 模型：</p>
<pre><code class="hljs language-ini" lang="ini">`DELETE /_ml/trained_models/.elser_model_2?<span class="hljs-attr">force</span>=<span class="hljs-literal">true</span>`AI写代码
</code></pre>
<p>这样，我们确保在我们的安装中没有 ELSER 的安装：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15fe9e0cc9634867aa20262b25fe2097~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=HKm7HJoYb5XxVZdiixIWIaSpu8g%3D" alt="" loading="lazy"/></p>
<p>我们接下来打入如下的命令来进行安装：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  PUT _inference/sparse_embedding/my_test_elser_inf_id
2.  {
3.    <span class="hljs-string">"service"</span>: <span class="hljs-string">"elasticsearch"</span>,
4.    <span class="hljs-string">"service_settings"</span>: {
5.      <span class="hljs-string">"model_id"</span>: <span class="hljs-string">".elser_model_2"</span>,
6.      <span class="hljs-string">"num_allocations"</span>: 1,
7.      <span class="hljs-string">"num_threads"</span>: 1
8.    }
9.  }

`AI写代码
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51d46b52e7bd412786e67f267550366d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=FluPdOzUue%2BJAPWbpVYWSjD90Ug%3D" alt="" loading="lazy"/></p>
<p>等过一会儿，我们再查看 Trained Modesl 页面：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c1c8376fa424fe3b5bc8341ee79a344~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=umAru7lMgDIK%2BDd8yBBkF3VmDj4%3D" alt="" loading="lazy"/></p>
<p>我们可以看到已经成功部署的 .elser_model_2 模型。</p>
<p>更多阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F154643629" title="https://elasticstack.blog.csdn.net/article/details/154643629" target="_blank" ref="nofollow noopener noreferrer">Elasticsearch：如何为 Elastic Stack 部署 E5 模型 - 下载及隔离环境</a></p>
<h2 data-id="heading-0">在网路隔离的环境中安装 ELSER</h2>
<p>如果你想在受限或封闭网络中部署 ELSER ，你有两个选项：</p>
<ol>
<li>
<p>创建你自己的 HTTP / HTTPS 端点并将模型文件放在上面，</p>
</li>
<li>
<p>把模型文件放到所有具备 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Freference%2Felasticsearch%2Fconfiguration-reference%2Fnode-settings%23master-node" title="https://www.elastic.co/docs/reference/elasticsearch/configuration-reference/node-settings#master-node" target="_blank" ref="nofollow noopener noreferrer">master 资格节点</a>的 config 目录里的某个子目录中。</p>
</li>
</ol>
<p>我们首先按照之前的方法来卸载已经安装好的 ELSER 模型：</p>
<pre><code class="hljs language-ini" lang="ini">`DELETE /_ml/trained_models/.elser_model_2?<span class="hljs-attr">force</span>=<span class="hljs-literal">true</span>`AI写代码
</code></pre>
<h3 data-id="heading-1">模型工件文件</h3>
<p>对于跨平台版本，你的系统里需要以下文件：</p>
<pre><code class="hljs language-arduino" lang="arduino">`

<span class="hljs-number">1.</span>  https:<span class="hljs-comment">//ml-models.elastic.co/elser_model_2.metadata.json</span>
<span class="hljs-number">2.</span>  https:<span class="hljs-comment">//ml-models.elastic.co/elser_model_2.pt</span>
<span class="hljs-number">3.</span>  https:<span class="hljs-comment">//ml-models.elastic.co/elser_model_2.vocab.json</span>

`AI写代码
</code></pre>
<p>对于优化版本，你的系统里需要以下文件：</p>
<pre><code class="hljs language-arduino" lang="arduino">`

<span class="hljs-number">1.</span>  https:<span class="hljs-comment">//ml-models.elastic.co/elser_model_2_linux-x86_64.metadata.json</span>
<span class="hljs-number">2.</span>  https:<span class="hljs-comment">//ml-models.elastic.co/elser_model_2_linux-x86_64.pt</span>
<span class="hljs-number">3.</span>  https:<span class="hljs-comment">//ml-models.elastic.co/elser_model_2_linux-x86_64.vocab.json</span>

`AI写代码
</code></pre>

<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  $ pwd
<span class="hljs-bullet">2.</span>  /Users/liuxg/elastic/elasticsearch-9.2.1/config/models
<span class="hljs-bullet">3.</span>  $ wget https://ml-models.elastic.co/elser<span class="hljs-emphasis">_model_</span>2.metadata.json
<span class="hljs-bullet">4.</span>  --2025-12-02 13:52:20--  https://ml-models.elastic.co/elser<span class="hljs-emphasis">_model_</span>2.metadata.json
<span class="hljs-bullet">5.</span>  Resolving ml-models.elastic.co (ml-models.elastic.co)... 34.120.127.120
<span class="hljs-bullet">6.</span>  Connecting to ml-models.elastic.co (ml-models.elastic.co)|34.120.127.120|:443... connected.
<span class="hljs-bullet">7.</span>  HTTP request sent, awaiting response... 200 OK
<span class="hljs-bullet">8.</span>  Length: 621 [application/json]
<span class="hljs-bullet">9.</span>  Saving to: ‘elser<span class="hljs-emphasis">_model_</span>2.metadata.json’

<span class="hljs-bullet">11.</span>  elser<span class="hljs-emphasis">_model_</span>2.metadata.json   100%[===============================================&gt;]     621  --.-KB/s    in 0s      

<span class="hljs-bullet">13.</span>  2025-12-02 13:52:21 (37.0 MB/s) - ‘elser<span class="hljs-emphasis">_model_</span>2.metadata.json’ saved [621/621]

<span class="hljs-bullet">15.</span>  $ wget https://ml-models.elastic.co/elser<span class="hljs-emphasis">_model_</span>2.pt
<span class="hljs-bullet">16.</span>  --2025-12-02 13:52:27--  https://ml-models.elastic.co/elser<span class="hljs-emphasis">_model_</span>2.pt
<span class="hljs-bullet">17.</span>  Resolving ml-models.elastic.co (ml-models.elastic.co)... 34.120.127.120
<span class="hljs-bullet">18.</span>  Connecting to ml-models.elastic.co (ml-models.elastic.co)|34.120.127.120|:443... connected.
<span class="hljs-bullet">19.</span>  HTTP request sent, awaiting response... 200 OK
<span class="hljs-bullet">20.</span>  Length: 438123914 (418M) [application/octet-stream]
<span class="hljs-bullet">21.</span>  Saving to: ‘elser<span class="hljs-emphasis">_model_</span>2.pt’

<span class="hljs-bullet">23.</span>  elser<span class="hljs-emphasis">_model_</span>2.pt              100%[===============================================&gt;] 417.83M  19.5MB/s    in 24s     

<span class="hljs-bullet">25.</span>  2025-12-02 13:52:53 (17.1 MB/s) - ‘elser<span class="hljs-emphasis">_model_</span>2.pt’ saved [438123914/438123914]

<span class="hljs-bullet">27.</span>  $ wget https://ml-models.elastic.co/elser<span class="hljs-emphasis">_model_</span>2.vocab.json
<span class="hljs-bullet">28.</span>  --2025-12-02 13:53:12--  https://ml-models.elastic.co/elser<span class="hljs-emphasis">_model_</span>2.vocab.json
<span class="hljs-bullet">29.</span>  Resolving ml-models.elastic.co (ml-models.elastic.co)... 34.120.127.120
<span class="hljs-bullet">30.</span>  Connecting to ml-models.elastic.co (ml-models.elastic.co)|34.120.127.120|:443... connected.
<span class="hljs-bullet">31.</span>  HTTP request sent, awaiting response... 200 OK
<span class="hljs-bullet">32.</span>  Length: 329405 (322K) [application/json]
<span class="hljs-bullet">33.</span>  Saving to: ‘elser<span class="hljs-emphasis">_model_</span>2.vocab.json’

<span class="hljs-bullet">35.</span>  elser<span class="hljs-emphasis">_model_</span>2.vocab.json      100%[===============================================&gt;] 321.68K   433KB/s    in 0.7s    

<span class="hljs-bullet">37.</span>  2025-12-02 13:53:13 (433 KB/s) - ‘elser<span class="hljs-emphasis">_model_</span>2.vocab.json’ saved [329405/329405]
<span class="hljs-bullet">38.</span>  $ pwd
<span class="hljs-bullet">39.</span>  /Users/liuxg/elastic/elasticsearch-9.2.1/config/models
<span class="hljs-bullet">40.</span>  $ ls
<span class="hljs-bullet">41.</span>  elser<span class="hljs-emphasis">_model_</span>2.metadata.json elser<span class="hljs-emphasis">_model_</span>2.pt            elser<span class="hljs-emphasis">_model_</span>2.vocab.json

`AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</code></pre>
<h2 data-id="heading-2">使用 HTTP 服务器</h2>
<blockquote>
<p><strong>INFO</strong>：如果你使用现有的 HTTP 服务器，要注意模型下载器只支持无密码的 HTTP 服务器。</p>
</blockquote>
<p>你可以使用任意 HTTP 服务来部署 ELSER 。这个示例使用官方的 Nginx Docker 镜像来搭建一个新的 HTTP 下载服务。</p>
<p>1）下载模型工件文件。如上所示，下载上面的三个文件，并把他们放入到 config 目录下的 models 子目录下。</p>
<p>2）把文件放到你选择的某个子目录里。</p>
<p>3）运行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  <span class="hljs-built_in">export</span> ELASTIC_ML_MODELS=<span class="hljs-string">"/path/to/models"</span>
2.  docker run --<span class="hljs-built_in">rm</span> -d -p 8080:80 --name ml-models -v <span class="hljs-variable">${ELASTIC_ML_MODELS}</span>:/usr/share/nginx/html nginx

`AI写代码
</code></pre>
<p>针对我的情况：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  <span class="hljs-built_in">export</span> ELASTIC_ML_MODELS=<span class="hljs-string">"/Users/liuxg/elastic/elasticsearch-9.2.1/config/models"</span>
2.  docker run --<span class="hljs-built_in">rm</span> -d -p 8080:80 --name ml-models -v <span class="hljs-variable">${ELASTIC_ML_MODELS}</span>:/usr/share/nginx/html nginx

`AI写代码
</code></pre>

<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  $ export ELASTIC<span class="hljs-emphasis">_ML_</span>MODELS="/Users/liuxg/elastic/elasticsearch-9.2.1/config/models"
<span class="hljs-bullet">2.</span>  $ docker run --rm -d -p 8080:80 --name ml-models -v ${ELASTIC<span class="hljs-emphasis">_ML_</span>MODELS}:/usr/share/nginx/html nginx
<span class="hljs-bullet">3.</span>  Unable to find image 'nginx:latest' locally
<span class="hljs-bullet">4.</span>  latest: Pulling from library/nginx
<span class="hljs-bullet">5.</span>  b89cf3ec7a3e: Pull complete 
<span class="hljs-bullet">6.</span>  2254fb813b11: Pull complete 
<span class="hljs-bullet">7.</span>  40b6fc5618c6: Pull complete 
<span class="hljs-bullet">8.</span>  bb8ecb62799c: Pull complete 
<span class="hljs-bullet">9.</span>  cc57e8335c98: Pull complete 
<span class="hljs-bullet">10.</span>  cf9a807fe41d: Pull complete 
<span class="hljs-bullet">11.</span>  88770be1d442: Pull complete 
<span class="hljs-bullet">12.</span>  Digest: sha256:553f64aecdc31b5bf944521731cd70e35da4faed96b2b7548a3d8e2598c52a42
<span class="hljs-bullet">13.</span>  Status: Downloaded newer image for nginx:latest
<span class="hljs-bullet">14.</span>  9697b5bef2ffd721babcef106e723d2ffe3990235276ff29ce27325210b75afc

`AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</code></pre>
<p>别忘了把 /path/to/models 改成模型工件文件所在子目录的路径。</p>
<p>这些命令会启动一个带有 Nginx 服务器的本地 Docker 镜像，并把包含模型文件的子目录挂载进去。因为需要下载和构建 Docker 镜像，第一次启动可能会花更长时间，之后的运行会更快。</p>
<p>4）通过在浏览器中访问下面这个 URL 来验证 Nginx 是否正常运行：</p>
<pre><code class="hljs language-arduino" lang="arduino">`http:<span class="hljs-comment">//{IP_ADDRESS_OR_HOSTNAME}:8080/elser_model_2.metadata.json`AI写代码</span>
</code></pre>

<pre><code class="hljs language-go" lang="go"><span class="hljs-string">`ifconfig | grep inet`</span>AI写代码
</code></pre>

<pre><code class="hljs language-markdown" lang="markdown">`1.  $ ifconfig | grep inet
<span class="hljs-bullet">2.</span>  	inet 127.0.0.1 netmask 0xff000000
<span class="hljs-bullet">3.</span>  	inet6 ::1 prefixlen 128 
<span class="hljs-bullet">4.</span>  	inet6 fe80::1%lo0 prefixlen 64 scopeid 0x1 
<span class="hljs-bullet">5.</span>  	inet6 fe80::c24:187e:e0e5:7cb6%en0 prefixlen 64 secured scopeid 0xe 
<span class="hljs-bullet">6.</span>  	inet 192.168.101.209 netmask 0xffffff00 broadcast 192.168.101.255
<span class="hljs-bullet">7.</span>  	inet6 2408:8207:2495:24c1:e5:a50c:16e5:6aed prefixlen 64 autoconf secured 
<span class="hljs-bullet">8.</span>  	inet6 2408:8207:2495:24c1:d568:879a:8d00:583b prefixlen 64 autoconf temporary 
<span class="hljs-bullet">9.</span>  	inet6 2408:8207:2495:24c1:1451:2091:5ea6:3 prefixlen 64 dynamic 
<span class="hljs-bullet">10.</span>  	inet6 fe80::74cb:fcff:fee0:5914%awdl0 prefixlen 64 scopeid 0x10 
<span class="hljs-bullet">11.</span>  	inet6 fe80::74cb:fcff:fee0:5914%llw0 prefixlen 64 scopeid 0x11 
<span class="hljs-bullet">12.</span>  	inet6 fe80::893f:7412:e4ba:cb1e%utun0 prefixlen 64 scopeid 0x12 
<span class="hljs-bullet">13.</span>  	inet6 fe80::4192:8070:e906:4697%utun1 prefixlen 64 scopeid 0x13 
<span class="hljs-bullet">14.</span>  	inet6 fe80::2a44:3b1c:bca:64bc%utun2 prefixlen 64 scopeid 0x14 
<span class="hljs-bullet">15.</span>  	inet6 fe80::ce81:b1c:bd2c:69e%utun3 prefixlen 64 scopeid 0x15 
<span class="hljs-bullet">16.</span>  	inet 198.18.192.51 --&gt; 198.18.192.51 netmask 0xfffff800
<span class="hljs-bullet">17.</span>  	inet 10.211.55.2 netmask 0xffffff00 broadcast 10.211.55.255
<span class="hljs-bullet">18.</span>  	inet6 fe80::80a9:97ff:fe43:7964%bridge100 prefixlen 64 scopeid 0x17 
<span class="hljs-bullet">19.</span>  	inet6 fdb2:2c26:f4e4::1 prefixlen 64 
<span class="hljs-bullet">20.</span>  	inet 10.37.129.2 netmask 0xffffff00 broadcast 10.37.129.255
<span class="hljs-bullet">21.</span>  	inet6 fe80::80a9:97ff:fe43:7965%bridge101 prefixlen 64 scopeid 0x19 
<span class="hljs-bullet">22.</span>  	inet6 fdb2:2c26:f4e4:1::1 prefixlen 64` AI写代码![](<span class="hljs-link">https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png</span>)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b586769db3245bba72c8a430a42675d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=z42X4f4omcsBpbHiFFCYbBZsOcU%3D" alt="" loading="lazy"/></p>
<p>如果 Nginx 运行正常，你会看到模型的 metadata 文件内容。</p>
<p>5）在 config/elasticsearch.yml 文件中加入下面这一行，把你的 Elasticsearch 部署指向 HTTP 服务器上的模型工件：</p>
<pre><code class="hljs language-arduino" lang="arduino">`xpack.ml.model_repository: http:<span class="hljs-comment">//{IP_ADDRESS_OR_HOSTNAME}:8080`AI写代码</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b553a4c3020f4dce8494d3889e88bc5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=vHG87Cr8wDJdRGsiXK1dhFf9FYQ%3D" alt="" loading="lazy"/></p>
<p>如果你使用你自己的 HTTP 或 HTTPS 服务器，请相应地修改地址。要确保写明协议（“http://” 或 “https://”）。确保所有具备 master 资格的节点都能访问你指定的服务器。</p>
<p>6）在所有具备 master 资格的节点上重复步骤 5。</p>
<p>7）逐个<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fmaintenance%2Fstart-stop-services%2Ffull-cluster-restart-rolling-restart-procedures%23restart-cluster-rolling" title="https://www.elastic.co/docs/deploy-manage/maintenance/start-stop-services/full-cluster-restart-rolling-restart-procedures#restart-cluster-rolling" target="_blank" ref="nofollow noopener noreferrer">重启</a>这些 master 资格节点。</p>
<p>8）在 Kibana 主菜单中进入 <strong>Trained Models</strong> 页面，或者使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Ffind-and-organize%2Ffind-apps-and-objects" title="https://www.elastic.co/docs/explore-analyze/find-and-organize/find-apps-and-objects" target="_blank" ref="nofollow noopener noreferrer">全局搜索</a>。你会在训练模型列表中看到 ELSER。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c844f1c476ee49a8b5b27a187fd49f7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=3157BI%2B4EApHaWhLfYtyQ0n9TOg%3D" alt="" loading="lazy"/></p>
<p>9）点击 <strong>Add trained model</strong> 按钮，选择你在步骤 1 下载并想部署的 ELSER 模型版本，然后点击 <strong>Download</strong>。所选模型会从你配置的 HTTP/HTTPS 服务器下载。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59d7c807eb844ca69eeb24057fa29ffd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=dLq0wXRVCc1OXAKDo3Vq%2BuzBwa0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f6d12f819ce42199770e1031bf50eb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=%2FdzKO9lmVpvkjwgroO8ZQdxnhGc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf860de9d7914badbb7d6ab30ec09de8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=twafnTk%2B8Gh8K4e7Y6Sdv354lcI%3D" alt="" loading="lazy"/></p>
<p>10）下载完成后，点击 <strong>Start deployment</strong> 按钮来启动部署。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/958544a41e6d48eb9756d6c14272fc87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=048PPSQmMGl8HhD3r%2F3tg8Hn8qw%3D" alt="" loading="lazy"/></p>
<p>11）填写一个 deployment ID，选择优先级，并设置 allocations 数量和每个 allocation 的线程数。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff472c520d3a4b2d8c79ab7ab16b5075~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=W0zQSgfDwDweKrgBSL1c1mbyazM%3D" alt="" loading="lazy"/></p>
<p>12）点击 <strong>Start</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/382708e3f3c04336b0c11eaa4f3130ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=FCj%2Fk1xHOCu%2BBADaakYj8xej14A%3D" alt="" loading="lazy"/></p>
<p>HTTP 服务器只在下载模型时需要。下载完成后，你可以停止并删除这个服务。<br/>
在本示例中，你可以运行下面的命令来停止使用的 Docker 镜像：</p>
<pre><code class="hljs language-arduino" lang="arduino">`docker stop ml-models`AI写代码
</code></pre>

<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  $ docker stop ml-models
<span class="hljs-bullet">2.</span>  ml-models
<span class="hljs-bullet">3.</span>  $ docker ps
<span class="hljs-bullet">4.</span>  CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES

`AI写代码
</code></pre>
<h2 data-id="heading-3">使用基于文件的访问</h2>
<p>要使用基于文件的访问，请按以下步骤操作：</p>
<p>1）下载模型工件文件。我们可以按照上面的步骤来进行。</p>
<p>2）把这些文件放到 Elasticsearch 部署的 config 目录里的 models 子目录中。</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  $ <span class="hljs-built_in">pwd</span>
2.  /Users/liuxg/elastic/elasticsearch-9.2.1/config/models
3.  $ <span class="hljs-built_in">ls</span>
4.  elser_model_2.metadata.json elser_model_2.pt            elser_model_2.vocab.json

`AI写代码
</code></pre>
<p>3）在 config/elasticsearch.yml 文件中加入下面这一行，把你的 Elasticsearch 部署指向这个模型目录：</p>
<pre><code class="hljs language-bash" lang="bash">`xpack.ml.model_repository: file://<span class="hljs-variable">${path.home}</span>/config/models/`AI写代码
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1aa92ffc07934001830b064ea6a3bff5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=iA0vFNOcqviEoh2ilkW1kev14H4%3D" alt="" loading="lazy"/></p>
<p>4）在所有具备 master 资格的节点上重复步骤 2 和步骤 3。</p>
<p>5）逐个<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fmaintenance%2Fstart-stop-services%2Ffull-cluster-restart-rolling-restart-procedures%23restart-cluster-rolling" title="https://www.elastic.co/docs/deploy-manage/maintenance/start-stop-services/full-cluster-restart-rolling-restart-procedures#restart-cluster-rolling" target="_blank" ref="nofollow noopener noreferrer">重启</a>这些 master 资格节点。</p>
<p>6）在 Kibana 主菜单中进入 Trained Models 页面，或者使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Ffind-and-organize%2Ffind-apps-and-objects" title="https://www.elastic.co/docs/explore-analyze/find-and-organize/find-apps-and-objects" target="_blank" ref="nofollow noopener noreferrer">全局搜索</a>。你会在训练模型列表中看到 ELSER。</p>
<p>7）点击 <strong>Add trained model</strong> 按钮，选择你在步骤 1 下载并想部署的 ELSER 模型版本，然后点击 <strong>Download</strong>。所选模型会从你在步骤 2 放置的模型目录中下载。</p>
<p>8）下载完成后，点击 <strong>Start deployment</strong> 按钮来启动部署。</p>
<p>9）填写一个 deployment ID，选择优先级，并设置 allocations 数量和每个 allocation 的线程数。</p>
<p>10）点击 <strong>Start</strong>。</p>
<h2 data-id="heading-4">测试 ELSER</h2>
<p>你可以在 Kibana 中测试已部署的模型。进入主菜单的 Trained Models 页面，或者使用全局搜索，在训练模型列表中找到已部署的 ELSER 模型，然后在 <strong>Actions</strong> 菜单中选择 <strong>Test model</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed2e3034e4ee405488bb965714667a03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=OHgW735YFowBsgyqLCA0ldreysc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/027d5988af784ca791b2645d11bc3e35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261995&amp;x-signature=vZO400yO32LUTMSXZ7iMvpQKKOs%3D" alt="" loading="lazy"/></p>
<p>你可以使用现有索引中的数据来测试模型。选择索引，然后选择要在其上测试 ELSER 的字段。输入搜索查询并点击 <strong>Test</strong>。使用与文档相关的查询可以更方便地评估模型的召回率。</p>
<p>结果会显示所选字段的十个随机值，以及每个文档与查询的相关性得分。得分越高，文档与查询的相关性越强。你可以点击 <strong>Reload examples</strong> 来重新加载示例文档。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI大模型+数字人 | AI数字人直播带货竟然这么简单！]]></title>    <link>https://juejin.cn/post/7578820377000542259</link>    <guid>https://juejin.cn/post/7578820377000542259</guid>    <pubDate>2025-12-02T07:44:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578820377000542259" data-draft-id="7578922565209423899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI大模型+数字人 | AI数字人直播带货竟然这么简单！"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-02T07:44:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智泊AI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI大模型+数字人 | AI数字人直播带货竟然这么简单！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智泊AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:44:50.000Z" title="Tue Dec 02 2025 07:44:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>一、AI大模型与数字人的发展</strong></p>
<p>传统意义上，<strong>数字人</strong>是指通过计算机图形学、图形渲染、语音合成、动作捕捉、深度学习、类脑科学等<strong>聚合科技创设的非物理世界的可交互虚拟形象</strong>。数字人是一个在20世纪80年代前后开始崭露头角的概念。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b042410afadd4d58acf18431af75bb8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=w%2FboiMB3lC3htwokOyFbpAMOoMo%3D" alt="图片" loading="lazy"/></p>
<p>在这个时期，日本打造了全球首位虚拟歌姬林明美；英国的George Stone也创作出虚拟人物Max Headroom。这一阶段的虚拟人物大多<strong>以计算机生成图像技术为基础</strong>，结合一些创新的动画和音效设计，使它们在视觉和听觉上达到逼真的效果。</p>
<p>进入21世纪，随着<strong>建模、动作捕捉</strong>等技术的不断进步，数字人产业得到显著发展。这一时期，以演员动捕结合计算机图形学合成的虚拟人物开始在影视行业得到广泛应用。</p>
<p>这些技术进步使得虚拟人物的动作和表情更加自然和真实，为影视制作提供了更大的创意空间和更多的表现形式。随着时间的推移，Z世代群体对自动生成内容的需求不断增加，<strong>身份型数字人</strong>的认可度也逐渐提升。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e84e9d1294a34a5580590b69ab055d3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=dFBpcoF%2FS5YCK0XPUi0KvAb%2Fmvw%3D" alt="图片" loading="lazy"/></p>
<p><strong>更多AI大模型学习视频及资源，都在<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</strong></p>
<p>这一时期，虚拟偶像开始走向大众，成为一种受到广泛关注的娱乐形式。“粉丝”可以通过社交媒体与自己喜爱的虚拟偶像进行互动。近年来，随着深度学习算法和硬件设备的不断进步，数字人的拟人化水平得到显著提升。</p>
<p>这些技术的发展使得数字人能够更好地理解和表达语言，具备<strong>更强的对话能力</strong>。这为数字人在各个领域的应用提供了更广阔的空间。例如，在客户服务领域，虚拟客服的智能化回答可以快速准确地解决用户的问题。</p>
<p>在教育领域，虚拟教师可以通过<strong>智能语音识别和语义理解技术</strong>为学生提供更具针对性的教学服务。在AI时代的推动下，数字人产业的发展前景十分广阔。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f6a63a67dbc4eb881a59a074dc13dd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=Tzo4AUK%2FSySyh0meUI6ZGb%2FQLQw%3D" alt="图片" loading="lazy"/></p>
<p>随着技术的不断进步和应用场景的拓展，虚拟人物将更加智能化、个性化和社会化。不仅可以将它们用于娱乐、影视等领域，还可以将其用于智能助手、社交机器人等领域，为社会带来更多的创新和变革。</p>
<p><strong>二、政策助力AI大模型与数字人发展</strong></p>
<p>1.“十四五”规划推动虚拟现实和增强现实发展</p>
<p>“十四五”规划明确将 <strong>“虚拟现实和增强现实”</strong> 定位为数字经济重要产业，强调数字化转型对生产方式、生活方式和治理方式的全面驱动，意在催生新产业、新业态和新模式，为经济发展注入新的活力。</p>
<p>在此背景下，2022年10月，工业和信息化部与多部门联合印发《虚拟现实与行业应用融合发展行动计划（2022—2026年）》。该计划的核心目标是推动<strong>虚拟现实技术</strong>在社会经济关键领域实现广泛应用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e1d1fb42a6e4f208fd3fb38aab9d4b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=ZfhZXZKmTeO8S6OHQYu5xajgQmY%3D" alt="图片" loading="lazy"/></p>
<p><strong>2.北京市首发数字人产业创新发展行动计划</strong></p>
<p>北京市经济和信息化局2022年8月发布《北京市促进数字人产业创新发展行动计划（2022—2025年）》（以下简称《计划》），这标志着国内首个专门针对数字人产业的支持政策正式出台。</p>
<p>《计划》不仅强调了数字人在互联网3.0时代的创新应用和产业机遇，还明确了依托国家文化专网，将数字人纳入<strong>文化数据服务平台</strong>的重要措施。根据《计划》，北京市将充分发挥其作为国际科技创新中心的建设优势，积极打造数字人产业创新高地。</p>
<p>为了实现这一目标，《计划》制定了一系列具体的发展目标。其中包括，在2025年之前，培育出1～2家营收超过50亿元的头部数字人企业，以及10家营收超过10亿元的重点数字人企业。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0168d10a98bc4d27b70a9eb669cb46c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=sC4U7e%2FU0uZTVFErh%2FJVPj7vFRo%3D" alt="图片" loading="lazy"/></p>
<p>同时，《计划》还提出要建成10家校企共建实验室和企业技术创新中心，打造5家以上共性技术平台，培育20个数字人应用标杆项目，并建成2家以上特色数字人园区和基地。</p>
<p><strong><strong>三、数字人产业链主要构成</strong></strong></p>
<p>数字人产业链是一个多层次、多维度的生态系统，涵盖从基础技术到应用实践的各个方面。这个产业链主要包括<strong>基础层、平台层、价值层和交互层</strong>4个核心组成部分。</p>
<p>● 基础层是数字人产业链的基石，主要包括硬件设备、软件开发和数据支持等。这些基础元素为数字人提供必要的<strong>技术支持和运行环境。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c1479624cf540cfa9ead3bd5a1d87b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=pSa7KazQNKXP10%2Br5QcELkij5XA%3D" alt="图片" loading="lazy"/></p>
<p>● 平台层主要指提供数字人创建、管理和运营服务的平台，这些平台为数字人的开发和部署<strong>提供工具和框架</strong>。</p>
<p>● 价值层关注的是数字人如何<strong>为用户和企业创造价值</strong>，包括内容、服务和商业模式等。</p>
<p>● 交互层是数字人与用户<strong>直接互动</strong>的界面，涉及用户体验和交互设计。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98061d85545442c6beb5d3ca561db9e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=AtKw%2FJKcnC8l4taL2V8aAuVMS2Y%3D" alt="图片" loading="lazy"/></p>
<p>AI赋能数字人行业，体现出巨大的商业价值，为市场带来了广阔的发展空间。艾媒咨询数据显示，2022年我国数字人核心市场规模达到120.8亿元，同比增长94.2%。预计到<strong>2025年</strong>，我国数字人行业核心市场规模将达到480.6亿元。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22844dab183e4f31877332d3da59bd0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=srFkVhpxUEpcQMZ9V5QF2Ow5khM%3D" alt="图片" loading="lazy"/></p>
<p><strong>四、AI引领数字人多模态交互新纪元</strong></p>
<p>随着人工智能技术的飞速发展，AI在推动数字人<strong>多模态交互能力</strong>提升方面发挥着越来越重要的作用。</p>
<p>目前，<strong>数字人</strong>接入<strong>大模型</strong>主要以<strong>文本交互</strong>为主，其本质是通过自动语音识别（Automatic Speech Recognition，ASR）、自然语言处理、文本-语音转换（Text to Speech，TTS）等AI技术进行转化，以实现数字人在感知、决策、表达等层面的交互。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f4ab113a2714811a7de5f4fa74f43b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=GslidFurd8j4%2F9hufagtnz6sOlY%3D" alt="图片" loading="lazy"/></p>
<p>虽然自然语言大模型与数字人的融合仍需进一步完善，但随着技术的不断发展，这种融合将会越来越成熟。这将为数字人产业带来更多的创新和更大的发展空间。在<strong>数字人动作合成</strong>的应用方面，AI技术也发挥着重要作用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b61879eea214b309eed5d57829297c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=djIEWpspFGpEmXs1x1lrf25WVb8%3D" alt="图片" loading="lazy"/></p>
<p>目前，计算机视觉数字人声唇同步技术相对完善，已经在游戏中大量应用。随着技术的不断发展，AI将能够更智能地合成数字人的动作和表情，从而实现更加<strong>真实、自然</strong>的交互体验。</p>
<p>AI大模型的多模态生成能力对数字人的发展具有巨大的推动潜力。这种能力可以使<strong>数字人的“思想”更加接近人类</strong>，从而实现更加自然、智能的交互。在未来发展中，AI大模型的多模态生成能力将为数字人产业带来前所未有的发展机遇。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e78fc326b154fe59cffbf9df53971b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=C%2Bc%2BGQPnYruLh2M19JqtLWL%2FhYo%3D" alt="图片" loading="lazy"/></p>
<p>通过在输入端实现多模态感知输入，AI技术将能够更全面地理解人类的情感和意图，从而更好地满足人类的需求。例如，通过分析人类的语音、面部表情和动作等信息，AI可以更加准确地<strong>判断人类的情绪和意图</strong>，从而为人类提供更加个性化的服务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c10296e98924c0f97bb2b3786b1c9c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=a0vDxT7icUVfHtp3BeKt12F4Vrs%3D" alt="图片" loading="lazy"/></p>
<p>通过在输出端提升多模态交互能力，AI技术将能够实现更加自然、逼真的交互体验，让人们感受到更加真实的数字人形象。例如，通过语音合成技术、动作合成技术和面部表情合成技术等，AI可以创造出更加真实、自然的数字人形象，让人们感受到更加接近人类的交互体验。</p>
<p><strong>五、AI虚拟直播引领电商降本增效</strong></p>
<p>近年来，直播行业得到飞速发展，形成了稳健的商业模式，并吸引了庞大的用户群体。相关数据显示，截至2022年年底，我国的直播用户数量已经达到7.5亿。这使得<strong>直播成为企业营销和销售的重要通道</strong>。</p>
<p>然而，随着消费者注意力资源的日益分散，他们在单一内容上的停留时间持续缩短，现已减少至30～40s。在这种背景下，数字人直播应运而生，凭借其能够长时间、不间断进行内容输出，<strong>有效帮助商家吸引并保持流量</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b22282cc77d4023a2d7e32caf4a9c16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=x6g%2BiqQbA8VfD4T5Vlyium6M12o%3D" alt="图片" loading="lazy"/></p>
<p>数字人直播的优势在于它不受直播间场域的约束，也不受主播的语言、能力和精力限制。这些优势使得数字人直播能够灵活应用于国内外各种平台、地域和品类的直播活动中，从而<strong>助力品牌和产品实现更广泛的传播</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0fc3b72e14f46368c5ea46c76cb90d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=KoEEWhcD77vqwV9uLz2IEgxVosQ%3D" alt="图片" loading="lazy"/></p>
<p>此外，数字人多直播间运营策略有助于品牌充分发挥其流量价值。品牌在经过宣传推广后，往往已经积累了一定的知名度和流量。通过多直播间运营，线下品牌可以<strong>增加用户触点</strong>，同时建立<strong>差异化的产品销售渠道</strong>。</p>
<p><strong><strong>案例：智能购物的革命性体验</strong></strong></p>
<p><strong>AI与零售</strong>的结合正在推动<strong>数智化零售</strong>新时代的到来。在这个新时代，AI技术将更加深入地应用于零售业，为消费者提供更好的购物体验，为零售商提供更高效和智能的运营方式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b1e6938ffb14ea08c7a4a06aacd8349~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=kCiAj2heYa6O6thFj09OTfv%2Bix8%3D" alt="图片" loading="lazy"/></p>
<p>京东零售作为电商领域的领先者，其技术体系的中台化战略为AI技术的应用提供了更好的支撑。</p>
<p>京东零售AI体系的建设注重应用化、大模型化、算力需求指数化等趋势，聚焦零售算法的场景体验、效率、成本问题，构建<strong>体系化、中台化的算法中台</strong>，以支持业务数智化升级。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f35a3f60a3444357ad8d07a019301b38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=X8nymxr6YAoXI2krmEEbAhsSoSc%3D" alt="图片" loading="lazy"/></p>
<p>端智能技术是京东零售聚焦的核心技术方向之一。这种技术可以将AI算法应用于终端设备，实现智能化处理和交互，从而提升用户体验和效率。</p>
<p>通过端智能技术，电商平台可以为用户提供更加个性化的推荐服务，例如，根据用户的浏览历史、购买记录等信息，推荐适合用户的商品，提高用户购物的<strong>满意度和对企业的忠诚度</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/158d445b2ce344898808dcaf11e56e54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=31vyacMKmz2njGb5m2TQHtQRZmY%3D" alt="图片" loading="lazy"/></p>
<p><strong>CTR</strong>（Click Through Rate，<strong>点击率</strong>）<strong>大模型</strong>是一种重要的AI技术，用于预测广告点击率和转化率。通过深度学习和海量数据训练，<strong>CTR大模型</strong>可以优化广告投放和营销策略，提升转化率和变现效果。</p>
<p>例如，电商平台上通常会有大量的广告投放，CTR大模型可以帮助商家选择合适的<strong>广告位和投放时间</strong>，提高广告点击率和转化率，从而降低营销成本和提高收益。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4a1161e7996484cb767eec6f14a0b2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=HhrsSOaSGcDMxlEug%2FyVCF66ekI%3D" alt="图片" loading="lazy"/></p>
<p>异构的算法算力智能调度系统则可以根据不同算法和数据的特点，智能分配计算资源，提高计算效率和精度。</p>
<p>可以将这种技术用于各种不同的场景，如商品推荐、价格预测、库存管理等。通过智能调度算法算力资源，可以避免计算资源的浪费和提高算法效率，进一步<strong>优化零售业务的运营效率</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/faf1c29d20bd450b8701c873d0414fce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=P3OVjosWoV6hZQFUVRwFdF2VHc8%3D" alt="图片" loading="lazy"/></p>
<p>通过AI技术的应用，搜索推荐系统可以更好地理解用户意图和需求，提供更加精准和个性化的推荐结果。京东零售致力于用户意图识别、复杂意图推荐、意图引导交互等环节，打造面向用户意图的<strong>高效搜索推荐系统</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f59d1c5e2ff243c8bed15b8d547e5250~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=93CdapPVIdYRltOUYZbOn5tjCjQ%3D" alt="图片" loading="lazy"/></p>
<p>其中用户意图识别环节的跨模态理解、感知能力提升，复杂意图推荐环节的人性化推荐、推荐理由生成，意图引导交互环节的<strong>人格化导购、创意组合优化</strong>等应用的突破，都将有机会带来革命性创新。</p>
<p>在用户意图识别环节中，跨模态理解技术的应用可以使得搜索推荐系统更好地理解用户的意图和需求，例如，用户在搜索框中输入商品名称时，搜索推荐系统可以通过<strong>跨模态理解技术</strong>识别用户的搜索意图是购买商品。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/082bfef5a36f4adca31e0b2d9e339111~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266290&amp;x-signature=6WydAMQS3QHVP5jhrwwa6Tsyw5U%3D" alt="图片" loading="lazy"/></p>
<p>同时，还可以根据用户的浏览历史、购买记录等，以及商品的特征信息等跨模态数据来提高推荐的精准度和个性化程度，进而提升用户体验和忠诚度。</p>
<p><strong>更多AI大模型学习视频及资源，都在<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Apache Doris 在小米统一 OLAP 和湖仓一体的实践]]></title>    <link>https://juejin.cn/post/7578902814022746127</link>    <guid>https://juejin.cn/post/7578902814022746127</guid>    <pubDate>2025-12-02T07:47:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578902814022746127" data-draft-id="7578892205290192936" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Apache Doris 在小米统一 OLAP 和湖仓一体的实践"/> <meta itemprop="keywords" content="数据库,程序员,运维"/> <meta itemprop="datePublished" content="2025-12-02T07:47:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Apache Doris 在小米统一 OLAP 和湖仓一体的实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:47:43.000Z" title="Tue Dec 02 2025 07:47:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>小米早在 2019 年便引入 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org" target="_blank" title="https://doris.apache.org" ref="nofollow noopener noreferrer">Apache Doris</a> 作为 OLAP 分析型数据库之一，经过五年的技术沉淀，已形成<strong>以 Doris 为核心的分析体系</strong>，并基于 2.1 版本异步物化视图、3.0 版本湖仓一体与存算分离等核心能力优化数据架构。本文将详细介绍小米数据中台基于 Apache Doris 3.0 的查询链路优化、性能提升、资源管理、自动化运维、可观测等一系列应用实践。</p>
</blockquote>
<p>小米集团成立于 2010 年，是一家以智能手机、智能硬件和 IoT 平台为核心的全球领先科技企业，业务遍及全球 100 多个国家和地区。小米构建了全球最大的消费类 IoT 物联网平台，同时持续推进“手机×AIoT”战略。旗下产品涵盖智能手机、电视、笔记本、可穿戴设备及生态链智能产品，并投资孵化众多智能科技企业。</p>
<p>Apache Doris 在小米内部应用广泛，业务涵盖汽车、手机领域（包括手机系统应用与硬件制造）、互联网、线上线下销售与服务、底层平台以及新业务等多个领域，支撑着多样化的数据分析需求。<strong>目前，Doris 集群数量超过 40 个，管理数据规模数 PB，日均查询量达到 5000 万次，资源规模在近一年内增长约 80%，展现出快速发展的态势。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a990b92db31493d8a9a4760b81a8f9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=fGGavKpw4yYj9XSeL7xMM6wTM0E%3D" alt="Doris 对小米业务线的支持.PNG" loading="lazy"/></p>
<h2 data-id="heading-0">小米数据中台 OLAP 发展与挑战</h2>
<h3 data-id="heading-1">01 架构演变历程</h3>
<p>早期小米技术栈复杂多样，数据湖体系与 OLAP 引擎众多。自 2019 年在小米内部投入应用以来，Apache Doris 逐渐从中脱颖而出，发展成为小米数据架构的核心引擎。</p>
<p><strong>一方面，Apache Doris 整合了内部复杂的 OLAP 分析体系，统一承载起原本由多系统分散提供的查询能力；另一方面，Doris 凭借出色的查询性能与良好的生态兼容，配合 Trino、Spark、Iceberg、Paimon 等完成了从外仓到湖仓一体架构的关键升级。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fc47f90cc4c40daacd0149ce3bb85df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=cjNJkOXO6pzqsyilkaULeoF1nzk%3D" alt="架构演变历程.png" loading="lazy"/></p>
<p>2022 年起，Doris 在小米内部已形成了较为成熟的应用体系：依托内部发布平台，在物理机上实现集群的自动化部署与运维；同时接入内部监控体系，全面保障 Doris 集群的可观测性与稳定性。</p>
<p>2025 年，我们正式引入了湖仓一体与存算分离能力成熟的 Doris 3.0 稳定版本，与 2.1 版本并行运行，并针对 Doris 3.0 在管理层面进行了重大调整：引入集群编排系统，并基于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.selectdb.com%2Fenterprise%2Fmanagement-guide%2Fwhat-is-doris-manager" target="_blank" title="https://docs.selectdb.com/enterprise/management-guide/what-is-doris-manager" ref="nofollow noopener noreferrer">Doris Manager </a>自主开发了集群管理系统，提供更全面、标准化的运维与可观测性方案。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4bc7f166a58415b897ec47a7af2c988~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=ObcXkGLTgt6l8RsTu1Iiy6BRauE%3D" alt="架构演变历程-1.PNG" loading="lazy"/></p>
<h3 data-id="heading-2">02 外仓面临的挑战</h3>
<p>小米早期 OLAP 体系中，离线数仓视为“内仓”，而  OLAP 服务则归为“外仓”，内外仓的数据流动依赖 Flink 或 Spark 等数据集成工具。团队主要负责 Doris 集群的部署与日常运维，在此过程中，我们遇到了诸多来自用户和自身的痛点问题，下面将结合业务场景介绍。</p>
<h4 data-id="heading-3">跨系统数据集成</h4>
<p>数据通过 Flink 或 Spark 从离线的内仓抽取至 Doris，形成跨系统数据流动。这种模式带来一系列挑战：</p>
<ul>
<li>数据冗余：同一份数据在多个系统中存储，增加成本；</li>
<li>口径不一致：不同系统处理逻辑差异导致结果偏差；</li>
<li>排查困难：当 BI 看板数据出现差异时，需跨多个系统定位问题；</li>
<li>开发负担重：业务方需自行维护 ETL 链路和多套查询接口。</li>
</ul>
<p>以广告业务为例，其数据链路涉及多个存储系统（如 Iceberg、Druid）和同步任务，分析师需根据查询粒度选择不同系统，心智负担显著。对开发侧而言，需针对不同数据链路进行定制化开发，同时在多个系统上重复建设数据看板，导致开发工作重复、周期长，整体投入成本较高。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3f63d2568f64516b9afd0b6e6308f27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=eUed9SaD5RWLUT59V35VFs94g1A%3D" alt="跨系统数据集成.PNG" loading="lazy"/></p>
<h4 data-id="heading-4">存算一体架构局限</h4>
<p><strong>1、高可用容灾</strong></p>
<p>2023 年海外机房火灾事件暴露了存算一体架构的脆弱性，虽然数据最终恢复，但也促使团队重新审视数据高可用策略。针对 Doris 2.x 的高可用方案，团队曾评估两种路径：</p>
<ul>
<li>主从复制（CCR）：依赖较新版本支持，缺乏生产验证，主备切换复杂，客户端需双连，恢复时间长；</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4049824ee04f4d6c9e240a16d0e8c746~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=BnnUGOBfQ1xox%2BGVL9cgKnz4ffk%3D" alt="高可用容灾.PNG" loading="lazy"/></p>
<ul>
<li>跨可用区副本分布：通过 Resource Group 将副本分散至不同机房，虽可避免单点故障，但跨机房读写带来性能损耗。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52e3387f7b5947f49e4a3c72d8b132f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=H5sgo%2BdEFoXYsqd5nl4Wp0Qfpq8%3D" alt="高可用容灾-1.png" loading="lazy"/></p>
<p>最终采用后者作为临时方案，但仍未根本解决成本与可用性之间的矛盾。</p>
<p><strong>2、资源利用率低</strong></p>
<p>物理机部署模式下，构建一个高可用 Doris 集群需要 3 FE + 3 BE，对于中小规模业务而言，此配置远超实际需求，导致资源浪费严重。若为每个小业务独立建集群，将导致集群数量激增，运维压力剧增；若采用共享集群，则面临资源争抢、隔离困难、计费模糊等问题。</p>
<p>直到 Apache Doris 3.0 发布后引入存算分离版本，高可用容灾与资源弹性问题得到解决，下个章节将详细展开介绍。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/358325b51c4f45cf86073cbdab56206b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=kw2b5GVG7%2FzPnOF%2FTn%2FMusK9PkU%3D" alt="资源利用率低.png" loading="lazy"/></p>
<h4 data-id="heading-5">集群运维效率低</h4>
<p>原有基于物理机的手动部署流程，从申请资源到集群上线通常耗时一周以上。面对快速增长的业务需求，该模式已无法满足敏捷交付要求。</p>
<h2 data-id="heading-6">Apache Doris 3.0 应用实践与突破</h2>
<p>基于上述挑战，Doris 2.0 及早期版本在湖仓一体、存算分离、集群自动化运维等方面仍有不足，而 3.0 存算分离版本带来了诸多升级，经过一段时间的验证，团队规划出 3.0 版本与早期版本并行的升级架构，并在 3.0 版本的基础上对架构设计与使用模式进行了显著优化。</p>
<h3 data-id="heading-7">01 Doris 3.0 核心优势</h3>
<p>首先是 3.0 存算分离的部署模式，其主要依赖计算组进行资源隔离通过将计算层与存储层解耦，BE 节点实现无状态化，依托底层 Kubernetes 支持，可以实现快速弹性伸缩以满足不同体量用户的需求。</p>
<p>同时，Doris 原生支持湖仓查询能力，在存算分离模式下，能够直接访问外部数据湖，有效打通数据孤岛。这一特性不仅显著简化了传统数据链路，也减少了因多层复制带来的数据冗余，真正推动湖仓一体架构的落地实践。</p>
<p>基于此，数据开发平台的整体架构发生变化：Doris 不再局限于传统“外仓”的角色，而是向上演进为统一的查询引擎层，与底层 Iceberg、Paimon 等湖仓格式解耦，直接进行联邦查询，同时利用自身的数据缓存、物化视图等能力对热点数据进行加速，兼顾灵活性与高性能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1809d114405b4a559bdd5cf85c68c722~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=XNYNxEwumQGq5%2BajpPBA8SDdueY%3D" alt="Doris 3.0 核心优势.png" loading="lazy"/></p>
<h4 data-id="heading-8">Doris vs Trino 湖仓分析能力对比：全面领先</h4>
<p>在 TPC-DS 1TB 标准测试中，Doris 对比 Trino 在整体查询性能上展现出全面领先的优势。无论是复杂多表关联、聚合分析，还是高并发场景下的响应效率，Doris 均表现出更优的执行速度和资源利用率，平均查询耗时明显更低，尤其适用于对查询性能要求较高的实时分析场景。</p>
<ul>
<li>TPC-DS 1T 测试：Doris 对比 Trino 全面领先</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3751c34bb6574eff8a8d179cc0d02936~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=A4pGRRzLPLx7igsslQ%2BVpxGLlJo%3D" alt="Doris vs Trino 湖仓分析能力对比.png" loading="lazy"/></p>
<p>在小米内部的数据查询场景，涵盖多表关联、聚合计算、过滤下推等常见操作的实际业务查询中，<strong>Doris 对比 Trino 的数据湖查询效率高 3～5 倍</strong>。</p>
<ul>
<li>内部数据查询场景：Doris 对比 Trino 数据湖查询效率高 3～5 倍</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63eba0d9dce8405aa8c805490cc80f1d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=%2BalB6InW%2F63FF%2B03Meplnt0WPL4%3D" alt="Doris vs Trino 湖仓分析能力对比-1.png" loading="lazy"/></p>
<h3 data-id="heading-9">02 统一查询网关</h3>
<ul>
<li><strong>统一认证鉴权</strong>：在连接层，将不同引擎的权限和认证体系统一提升到网关层，用户通过网关统一查询，无需担心引擎权限问题。</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.selectdb.com%2Fblog%2F209" target="_blank" title="https://www.selectdb.com/blog/209" ref="nofollow noopener noreferrer">SQL 改写</a></strong>：利用 Doris 的 SQL 改写能力，将其提升到网关层，帮助用户在不同引擎间平滑切换，避免因 SQL 语句不兼容导致出错。</li>
<li><strong>连接协议优化</strong>：采用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.selectdb.com%2Fblog%2F220" target="_blank" title="https://www.selectdb.com/blog/220" ref="nofollow noopener noreferrer">Arrow Flight SQL </a>传输协议和 ADBC 连接方式，传输效率较 JDBC 高 10 倍以上，真实业务场景查询耗时减少 36%，Kyuubi 实例内存用量减少 50%，代理层服务的管理效率显著提升。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea706dad05684a998408ca2d129318bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=j7Tc3BORx%2BAE2RydZQ5R5MPQy0M%3D" alt="统一查询网关.png" loading="lazy"/></p>
<h3 data-id="heading-10">03 数据链路：物化视图上卷代替导入任务</h3>
<p>以广告业务场景为例，面对分钟级明细数据聚合查询较慢的问题，常见方案是将原始明细数据聚合成小时级数据，定期导入 Doris 以提升查询性能。这一过程需开发和维护复杂的调度任务，运维成本较高。</p>
<p>自 Doris 2.1 版本引入<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.selectdb.com%2Fblog%2F1204" target="_blank" title="https://www.selectdb.com/blog/1204" ref="nofollow noopener noreferrer">异步物化视图</a>能力后，只需在 Doris 中声明物化视图定义，系统即可自动完成从外部数据湖（如 Iceberg）增量同步、数据聚合、更新调度等全过程，无需额外开发 ETL 链路，也无需关注底层执行细节，显著降低了开发与运维负担。同时，Doris 支持物化视图改写能力，用户仍可使用原有 SQL 查询原始表，系统会自动识别并将其透明改写为对应的物化视图，实现查询加速。目前该功能基于增量方式实现，主要支持仅追加场景，更新场景仍处于研发状态。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cddfb14903844329c27bb5136e77ed6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=cQbNMHJWgNCbDyeZTZ6gwYB80CU%3D" alt="数据链路：物化视图上卷代替导入任务.png" loading="lazy"/></p>
<p>异步物化视图能力的建表语句示例如下：</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">CREATE</span> MATERIALIZED <span class="hljs-keyword">VIEW</span> mv
BUILD DEFERRED
REFRESH INCREMENTAL
<span class="hljs-keyword">ON</span> <span class="hljs-keyword">COMMIT</span>
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> (<span class="hljs-type">date</span>)
DISTRIBUTED <span class="hljs-keyword">BY</span> RANDOM BUCKETS <span class="hljs-number">4</span>
PROPERTIES (<span class="hljs-string">'replication_num'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'3'</span>) 
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span> 
  <span class="hljs-type">date</span>, 
  k1<span class="hljs-operator">+</span><span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> k2, 
  <span class="hljs-built_in">SUM</span>(a1) <span class="hljs-keyword">AS</span> a2
<span class="hljs-keyword">FROM</span>
  paimon.data.table
<span class="hljs-keyword">WHERE</span> <span class="hljs-type">date</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-number">20250222</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> <span class="hljs-number">1</span>, <span class="hljs-number">2</span>;
</code></pre>
<h3 data-id="heading-11">04 自助化、精细化的资源管理</h3>
<p>为了优化资源管理与运维流程，我们自研了精细的 Doris Manager 集群管理服务，将用户的运维需求转化为自助操作，依托社区开源的 Doris Operator 在 Kubernetes 平台自动完成资源申请与释放，实现快速的集群变更。用户直接通过平台提交资源申请，无需等待平台申请机器、初始化、发布和上线等步骤，以集群扩容为例，交付周期从原先的约一周大幅缩短至分钟级，显著提升了运维响应速度与效率。</p>
<p>同时，通过 Doris Manager 集群自动化注册与发现能力，新集群创建的同时向元数据中心注册 Catalog，可自动被查询网关识别并接入统一访问入口，用户无需额外配置即可通过网关发起 Doris 查询，进一步优化了使用体验。</p>
<p>接入 Kubernetes 后，资源调度更加精细化，最小调度粒度从物理机级别转变为机器核心、内存大小、磁盘容量等维度，能够根据不同业务需求灵活调配资源，提高资源利用率，满足多样化的业务场景。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/774ad21b7dc34483b096d9c2e3df79ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=Bu0j2u3vRBbHA6I1qEa9ZSXLQ6M%3D" alt="自助化、精细化的资源管理.png" loading="lazy"/></p>
<h3 data-id="heading-12">05 更完善的数据采集与可观测性</h3>
<p>在集群可观测性方面，基于 Kubernetes 的标准化组件，参照 OpenTelemetry 的规范对 Doris 的监控体系进行全面升级。通过 Prometheus 的 ServiceMonitor 机制采集 Doris 各组件的性能指标，为用户提供全面、细粒度性能监控数据。</p>
<p>在日志采集方面，采用自研的 Hera（log tail 组件）实现高效采集，同时，借鉴社区的日志检索场景实践，将 Doris 作为 OpenTelemetry 的存储后端：Doris 自身运行产生的日志经采集后，最终回流并存储至 Doris 内部表中，形成“日志产生-采集-存储-查询”的闭环。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f06a773c3bf46c19110e76f33873c60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=y%2Fp5pgHWZjPZAxRxHL8ToqdNPv8%3D" alt="更完善的数据采集与可观测性.png" loading="lazy"/></p>
<p>与之前仅支持基础指标采集的 Falcon 体系相比，Hera 架构覆盖了审计日志、监控指标、运行日志、Profiling 结果以及正在完善的分布式 tracing 信息，提供更加全面的综合诊断能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc94080fcbd54ce290d24a69e06467cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765266463&amp;x-signature=muSrWk1jB64W79j7Tg1ttm%2BC3SM%3D" alt="更完善的数据采集与可观测性-1.png" loading="lazy"/></p>
<h2 data-id="heading-13">后续规划</h2>
<p>感谢 Doris 社区始终保持高效的版本迭代节奏与稳定性打磨，后续我们将基于以下几方面展开工作：</p>
<ul>
<li><strong>完成 Doris 版本收敛工作</strong>：将核心功能并线至 2.1 和 3.0 版本，并统一工具链版本依赖以减少环境差异，最终实现开发迭代效率的显著提升，为后续功能迭代奠定高效基础。</li>
<li><strong>围绕湖仓一体能力进行深度优化</strong>：重点提升湖仓支持的完整性与稳定性，推动 Doris 存算分离架构的大规模落地，同时完善增量计算能力的覆盖范围，以满足复杂场景下的实时数据处理需求。</li>
<li><strong>拓展新场景与 AI 融合方向</strong>：孵化日志、Tracing 等数据存储能力，通过 AI for Doris 提升运维管理效率，并探索 Doris for AI 的反向赋能能力，构建数据平台与智能技术的双向协同生态。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[27-集成swagger接口文档]]></title>    <link>https://juejin.cn/post/7578830345870704681</link>    <guid>https://juejin.cn/post/7578830345870704681</guid>    <pubDate>2025-12-02T06:38:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578830345870704681" data-draft-id="7578832575503728682" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="27-集成swagger接口文档"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T06:38:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="红色石头本尊"/> <meta itemprop="url" content="https://juejin.cn/user/1521379824903399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            27-集成swagger接口文档
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379824903399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    红色石头本尊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:38:47.000Z" title="Tue Dec 02 2025 06:38:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">安装工具</h3>
<blockquote>
<p>go install github.com/swaggo/swag/cmd/swag@latest</p>
</blockquote>
<h3 data-id="heading-1">验证安装（查看版本）</h3>
<p>swag version</p>
<blockquote>
<p>如果使用 Gin 框架，安装 <code>gin-swagger</code> 和 <code>swaggo/files</code>（提供 Swagger UI 静态资源）</p>
</blockquote>
<pre><code class="hljs language-txt" lang="txt">go get github.com/swaggo/gin-swagger
go get github.com/swaggo/files
</code></pre>
<h4 data-id="heading-2">初始化</h4>
<blockquote>
<p>初始化 Swagger 配置</p>
</blockquote>
<ul>
<li>在项目根目录执行以下命令，生成 Swagger 基础配置文件（<code>docs</code> 文件夹，含 <code>docs.go</code>、<code>swagger.json</code>、<code>swagger.yaml</code>）</li>
<li>swag init
<ul>
<li>在根目录下执行奥</li>
</ul>
</li>
</ul>
<blockquote>
<p>编写注释</p>
</blockquote>
<ul>
<li>是通过注释形成文档的</li>
<li>注释分类
<ul>
<li><strong>项目全局注释</strong>（main.go 中）：描述项目整体信息</li>
<li><strong>接口注释</strong>（每个 API handler 上方）：描述接口路径、参数、响应等</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-txt" lang="txt">// 全局注释

注释标签	     说明								示例
@title		文档标题（必填）				 @title Gin-Swaggo API 示例
@version	API 版本（必填）					      @version 1.0
@description	项目描述				@description 基于 Gin 的用户管理 API
@host		API 服务地址（如 localhost:8080）	         @host localhost:8080
@BasePath	接口基础路径（所有接口前缀）		           @BasePath /api/v1
@contact.name	联系人名称			                   @contact.name 开发者
@contact.email	联系人邮箱					@contact.email dev@example.com
@license.name	许可证名称					@license.name Apache 2.0
</code></pre>
<pre><code class="hljs language-txt" lang="txt">// ### 接口注释（每个 handler 上方）
package models
注释标签				说明			       示例
@Summary			接口简介（简短描述）		   @Summary 查询用户详情
@Description			接口详细描述		@Description 根据用户ID获取用户信息
@Tags				接口分组（多个标签用逗号分隔）	       @Tags 用户管理,查询
@Accept	请求数据格式（如 json、form-data）	                   @Accept json
@Produce				响应数据格式（如 json、xml）	@Produce json
@Param					接口参数（格式：名称 位置 类型 是否必填 描述）	
                                        路径参数：@Param id path uint true "用户ID"；
                                  Body 参数：@Param user body UserRequest true "用户信息"；
                                        Query 参数：@Param name query string false "用户名"

@Success				成功响应（格式：状态码 {类型} 模型 描述）	@Success 200 {object} UserResponse "成功返回"
@Failure				失败响应（格式同 @Success）	@Failure 400 {object} map[string]string "参数错误"
@Router					接口路径 + 请求方法（相对 BasePath）	@Router /user/{id} [get]
@Security				接口认证（如 JWT）	@Security ApiKeyAuth
</code></pre>
<h4 data-id="heading-3">案例如下</h4>
<ul>
<li>main.go</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> models

<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"lsgo/router"</span>
	<span class="hljs-string">"github.com/gin-gonic/gin"</span>
	swaggerFiles <span class="hljs-string">"github.com/swaggo/files"</span>
	ginSwagger <span class="hljs-string">"github.com/swaggo/gin-swagger"</span>
	_ <span class="hljs-string">"your-project-path/docs"</span> <span class="hljs-comment">// 必须导入 docs 目录（替换为实际项目路径）</span>
	<span class="hljs-string">"net/http"</span>
)

<span class="hljs-comment">// 项目全局注释（main.go 中，swag init 会扫描）</span>
<span class="hljs-comment">// @title           Gin-Swaggo API 示例</span>
<span class="hljs-comment">// @version         1.0</span>
<span class="hljs-comment">// @description     这是一个基于 Gin + Swaggo 的 API 文档示例//描述</span>
<span class="hljs-comment">// @termsOfService  http://swagger.io/terms/</span>
<span class="hljs-comment">// @contact.name    开发者// 名字</span>
<span class="hljs-comment">// @contact.email   dev@example.com//邮箱</span>
<span class="hljs-comment">// @license.name    Apache 2.0</span>
<span class="hljs-comment">// @license.url     http://www.apache.org/licenses/LICENSE-2.0.html</span>
<span class="hljs-comment">// @host            localhost:8080  // API 服务地址（访问文档时默认拼接）有环境的用服务器地址</span>
<span class="hljs-comment">// @BasePath        /api/v1  // 接口基础路径（所有接口路径前缀）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	r := gin.Default()
        <span class="hljs-comment">// 只在开发环境启用 Swagger 看个人情况</span>
	<span class="hljs-keyword">if</span> os.Getenv(<span class="hljs-string">"GIN_MODE"</span>) != <span class="hljs-string">"release"</span> {
	    r.GET(<span class="hljs-string">"/swagger/*any"</span>, ginSwagger.WrapHandler(swaggerFiles.Handler))
	}

	<span class="hljs-comment">// 注册 Swagger UI 路由（访问路径：http://localhost:8080/swagger/index.html）</span>
	r.GET(<span class="hljs-string">"/swagger/*any"</span>, ginSwagger.WrapHandler(swaggerFiles.Handler))

	<span class="hljs-comment">// 接口路由（基础路径 /api/v1）</span>
	v1 := r.Group(<span class="hljs-string">"/api/v1"</span>)
	{
		user := v1.Group(<span class="hljs-string">"/user"</span>)
		{
			user.GET(<span class="hljs-string">"/:id"</span>, router.GetUser)       <span class="hljs-comment">// 查单个用户</span>
			user.POST(<span class="hljs-string">""</span>, router.CreateUser)      <span class="hljs-comment">// 创建用户</span>
			user.PUT(<span class="hljs-string">"/:id"</span>, router.UpdateUser)   <span class="hljs-comment">// 更新用户</span>
			user.DELETE(<span class="hljs-string">"/:id"</span>, router.DeleteUser)<span class="hljs-comment">// 删除用户</span>
		}
	}
	r.Run(<span class="hljs-string">":8080"</span>)
}
</code></pre>
<ul>
<li>router/user.go</li>
</ul>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> router

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"github.com/gin-gonic/gin"</span>
	<span class="hljs-string">"net/http"</span>
)


<span class="hljs-comment">// 定义请求/响应结构体（需添加注释，swag 会识别为 Schema）</span>
<span class="hljs-comment">// UserRequest 创建/更新用户的请求体</span>
<span class="hljs-keyword">type</span> UserRequest <span class="hljs-keyword">struct</span> {
	<span class="hljs-comment">// 用户名（必填）</span>
	Username <span class="hljs-type">string</span> <span class="hljs-string">`json:"username" binding:"required"`</span>
	<span class="hljs-comment">// 年龄（必填，最小值 1）</span>
	Age <span class="hljs-type">int</span> <span class="hljs-string">`json:"age" binding:"required,min=1"`</span>
	<span class="hljs-comment">// 邮箱（可选）</span>
	Email <span class="hljs-type">string</span> <span class="hljs-string">`json:"email,omitempty"`</span>
}

<span class="hljs-comment">// UserResponse 用户响应结构体</span>
<span class="hljs-keyword">type</span> UserResponse <span class="hljs-keyword">struct</span> {
	<span class="hljs-comment">// 用户ID</span>
	ID       <span class="hljs-type">uint</span>   <span class="hljs-string">`json:"id"`</span>
	<span class="hljs-comment">// 用户名</span>
	Username <span class="hljs-type">string</span> <span class="hljs-string">`json:"username"`</span>
	<span class="hljs-comment">// 年龄</span>
	Age      <span class="hljs-type">int</span>    <span class="hljs-string">`json:"age"`</span>
	<span class="hljs-comment">// 邮箱</span>
	Email    <span class="hljs-type">string</span> <span class="hljs-string">`json:"email,omitempty"`</span>
	<span class="hljs-comment">// 响应状态</span>
	Status   <span class="hljs-type">string</span> <span class="hljs-string">`json:"status"`</span>
}

<span class="hljs-comment">// GetUser 查单个用户</span>
<span class="hljs-comment">// @Summary      查询用户详情</span>
<span class="hljs-comment">// @Description  根据用户ID获取用户信息</span>
<span class="hljs-comment">// @Tags         用户管理  // 接口分类（文档中按 Tags 分组）</span>
<span class="hljs-comment">// @Accept       json</span>
<span class="hljs-comment">// @Produce      json</span>
<span class="hljs-comment">// @Param        id   path      uint   true  "用户ID"  // path 参数（true 表示必填）</span>
<span class="hljs-comment">// @Success      200  {object}  UserResponse  "成功返回用户信息"</span>
<span class="hljs-comment">// @Failure      400  {object}  map[string]string  "请求参数错误"</span>
<span class="hljs-comment">// @Failure      404  {object}  map[string]string  "用户不存在"</span>
<span class="hljs-comment">// @Router       /user/{id} [get]  // 接口路径（相对 BasePath）</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetUser</span><span class="hljs-params">(c *gin.Context)</span></span> {
	id := c.Param(<span class="hljs-string">"id"</span>)
	<span class="hljs-comment">// 模拟业务逻辑</span>
	c.JSON(http.StatusOK, UserResponse{
		ID:       <span class="hljs-number">1</span>,
		Username: <span class="hljs-string">"张三"</span>,
		Age:      <span class="hljs-number">25</span>,
		Email:    <span class="hljs-string">"zhangsan@example.com"</span>,
		Status:   <span class="hljs-string">"success"</span>,
	})
}

<span class="hljs-comment">// CreateUser 创建用户</span>
<span class="hljs-comment">// @Summary      创建用户</span>
<span class="hljs-comment">// @Description  新增用户（用户名和年龄为必填）</span>
<span class="hljs-comment">// @Tags         用户管理</span>
<span class="hljs-comment">// @Accept       json</span>
<span class="hljs-comment">// @Produce      json</span>
<span class="hljs-comment">// @Param        user  body      UserRequest  true  "用户信息"  // body 参数</span>
<span class="hljs-comment">// @Success      201  {object}  UserResponse  "创建成功"</span>
<span class="hljs-comment">// @Failure      400  {object}  map[string]string  "请求参数错误"</span>
<span class="hljs-comment">// @Router       /user [post]</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CreateUser</span><span class="hljs-params">(c *gin.Context)</span></span> {
	<span class="hljs-keyword">var</span> req UserRequest
	<span class="hljs-keyword">if</span> err := c.ShouldBindJSON(&amp;req); err != <span class="hljs-literal">nil</span> {
		c.JSON(http.StatusBadRequest, gin.H{<span class="hljs-string">"error"</span>: err.Error()})
		<span class="hljs-keyword">return</span>
	}
	<span class="hljs-comment">// 模拟入库逻辑</span>
	c.JSON(http.StatusCreated, UserResponse{
		ID:       <span class="hljs-number">2</span>,
		Username: req.Username,
		Age:      req.Age,
		Email:    req.Email,
		Status:   <span class="hljs-string">"created"</span>,
	})
}

<span class="hljs-comment">// UpdateUser 更新用户</span>
<span class="hljs-comment">// @Summary      更新用户</span>
<span class="hljs-comment">// @Description  根据ID更新用户信息</span>
<span class="hljs-comment">// @Tags         用户管理</span>
<span class="hljs-comment">// @Accept       json</span>
<span class="hljs-comment">// @Produce      json</span>
<span class="hljs-comment">// @Param        id    path      uint         true  "用户ID"</span>
<span class="hljs-comment">// @Param        user  body      UserRequest  true  "更新的用户信息"</span>
<span class="hljs-comment">// @Success      200  {object}  UserResponse  "更新成功"</span>
<span class="hljs-comment">// @Failure      400  {object}  map[string]string  "请求参数错误"</span>
<span class="hljs-comment">// @Failure      404  {object}  map[string]string  "用户不存在"</span>
<span class="hljs-comment">// @Router       /user/{id} [put]</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">UpdateUser</span><span class="hljs-params">(c *gin.Context)</span></span> {
	id := c.Param(<span class="hljs-string">"id"</span>)
	<span class="hljs-keyword">var</span> req UserRequest
	<span class="hljs-keyword">if</span> err := c.ShouldBindJSON(&amp;req); err != <span class="hljs-literal">nil</span> {
		c.JSON(http.StatusBadRequest, gin.H{<span class="hljs-string">"error"</span>: err.Error()})
		<span class="hljs-keyword">return</span>
	}
	<span class="hljs-comment">// 模拟更新逻辑</span>
	c.JSON(http.StatusOK, UserResponse{
		ID:       <span class="hljs-number">1</span>,
		Username: req.Username,
		Age:      req.Age,
		Email:    req.Email,
		Status:   <span class="hljs-string">"updated"</span>,
	})
}

<span class="hljs-comment">// DeleteUser 删除用户</span>
<span class="hljs-comment">// @Summary      删除用户</span>
<span class="hljs-comment">// @Description  根据ID删除用户</span>
<span class="hljs-comment">// @Tags         用户管理</span>
<span class="hljs-comment">// @Accept       json</span>
<span class="hljs-comment">// @Produce      json</span>
<span class="hljs-comment">// @Param        id  path      uint   true  "用户ID"</span>
<span class="hljs-comment">// @Success      200  {object}  map[string]string  "删除成功"</span>
<span class="hljs-comment">// @Failure      404  {object}  map[string]string  "用户不存在"</span>
<span class="hljs-comment">// @Router       /user/{id} [delete]</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DeleteUser</span><span class="hljs-params">(c *gin.Context)</span></span> {
	id := c.Param(<span class="hljs-string">"id"</span>)
	<span class="hljs-comment">// 模拟删除逻辑</span>
	c.JSON(http.StatusOK, gin.H{<span class="hljs-string">"status"</span>: <span class="hljs-string">"deleted"</span>, <span class="hljs-string">"user_id"</span>: id})
}


<span class="hljs-comment">// @ignore  // 忽略该接口，不生成文档</span>
<span class="hljs-comment">//func Test(c *gin.Context) { ... }</span>
</code></pre>
<blockquote>
<p>每次更新都需要重新生成生成文档</p>
</blockquote>
<ul>
<li>swag init (在根目录执行)</li>
<li>若注释无语法错误，会更新 <code>docs</code> 目录下的 <code>swagger.json</code>/<code>swagger.yaml</code></li>
</ul>
<blockquote>
<p>启动服务</p>
</blockquote>
<ul>
<li>go run main.go</li>
<li>浏览器访问**<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Fswagger%2Findex.html**%25E5%259C%25B0%25E5%259D%2580%25E5%25B0%25B1%25E5%258F%25AF%25E4%25BB%25A5%25E6%259F%25A5%25E7%259C%258B%25E6%2596%2587%25E6%25A1%25A3%25E4%25BA%2586" target="_blank" title="http://localhost:8080/swagger/index.html**%E5%9C%B0%E5%9D%80%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%9F%A5%E7%9C%8B%E6%96%87%E6%A1%A3%E4%BA%86" ref="nofollow noopener noreferrer">http://localhost:8080/swagger/index.html**地址就可以查看文档了</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Linux系统性能排查实战指南：从定位到解决]]></title>    <link>https://juejin.cn/post/7578922565209522203</link>    <guid>https://juejin.cn/post/7578922565209522203</guid>    <pubDate>2025-12-02T07:39:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578922565209522203" data-draft-id="7578876665695256585" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Linux系统性能排查实战指南：从定位到解决"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T07:39:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="嘻哈baby"/> <meta itemprop="url" content="https://juejin.cn/user/485305583405066"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Linux系统性能排查实战指南：从定位到解决
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/485305583405066/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    嘻哈baby
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:39:59.000Z" title="Tue Dec 02 2025 07:39:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>上周线上服务器突然变慢，用户反馈接口响应从200ms飙到2s。</p>
<p>登上服务器一看，load average飙到20多（4核机器），但具体是什么原因导致的？CPU？内存？磁盘IO？网络？</p>
<p>花了2小时才定位到问题：一个定时任务写日志把磁盘写满了，导致数据库疯狂刷盘。</p>
<p>这篇文章把性能排查的完整流程和工具总结一下，下次再遇到类似问题能快速定位。</p>
<hr/>
<h2 data-id="heading-1">一、性能问题排查思路</h2>
<p>遇到性能问题，不要慌，按这个顺序排查：</p>
<pre><code class="hljs"/></pre>
<ol>
<li>先看整体负载（load average）
↓</li>
<li>定位瓶颈类型（CPU/内存/磁盘/网络）
↓</li>
<li>找到问题进程
↓</li>
<li>分析根因
↓</li>
<li>解决问题</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">**核心原则：从宏观到微观，从现象到本质。**</span>

<span class="hljs-meta">---
</span>
<span class="hljs-comment">## 二、第一步：看整体负载</span>

<span class="hljs-comment">### 2.1 uptime - 快速查看负载</span>

<span class="hljs-string">```bash</span>
<span class="hljs-string">$</span> <span class="hljs-string">uptime</span>
 <span class="hljs-number">14</span><span class="hljs-string">:30:25</span> <span class="hljs-string">up</span> <span class="hljs-number">45</span> <span class="hljs-string">days,</span>  <span class="hljs-number">3</span><span class="hljs-string">:21,</span>  <span class="hljs-number">2</span> <span class="hljs-string">users,</span>  <span class="hljs-attr">load average:</span> <span class="hljs-number">8.52</span><span class="hljs-string">,</span> <span class="hljs-number">6.31</span><span class="hljs-string">,</span> <span class="hljs-number">4.12</span>
</code></pre>
<p><strong>load average三个数字含义：</strong></p>
<ul>
<li>第一个：最近1分钟平均负载</li>
<li>第二个：最近5分钟平均负载</li>
<li>第三个：最近15分钟平均负载</li>
</ul>
<p><strong>怎么判断负载高不高？</strong></p>
<p>对比CPU核心数：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看CPU核心数</span>
$ <span class="hljs-built_in">nproc</span>
4
</code></pre>
<ul>
<li>load average &lt; CPU核心数 → 正常</li>
<li>load average ≈ CPU核心数 → 较忙</li>
<li>load average &gt; CPU核心数 × 2 → 过载，需要排查</li>
</ul>
<p>上面的例子，4核机器load到8.52，已经过载了。</p>
<h3 data-id="heading-2">2.2 top - 实时监控</h3>
<pre><code class="hljs language-bash" lang="bash">$ top
</code></pre>
<p>关注几个关键指标：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">top</span> <span class="hljs-bullet">-</span> <span class="hljs-number">14</span><span class="hljs-string">:30:25</span> <span class="hljs-string">up</span> <span class="hljs-number">45</span> <span class="hljs-string">days,</span>  <span class="hljs-number">3</span><span class="hljs-string">:21,</span>  <span class="hljs-number">2</span> <span class="hljs-string">users,</span>  <span class="hljs-attr">load average:</span> <span class="hljs-number">8.52</span><span class="hljs-string">,</span> <span class="hljs-number">6.31</span><span class="hljs-string">,</span> <span class="hljs-number">4.12</span>
<span class="hljs-attr">Tasks:</span> <span class="hljs-number">203</span> <span class="hljs-string">total,</span>   <span class="hljs-number">3</span> <span class="hljs-string">running,</span> <span class="hljs-number">200</span> <span class="hljs-string">sleeping,</span>   <span class="hljs-number">0</span> <span class="hljs-string">stopped,</span>   <span class="hljs-number">0</span> <span class="hljs-string">zombie</span>
<span class="hljs-string">%Cpu(s):</span> <span class="hljs-number">75.2</span> <span class="hljs-string">us,</span> <span class="hljs-number">12.3</span> <span class="hljs-string">sy,</span>  <span class="hljs-number">0.0</span> <span class="hljs-string">ni,</span>  <span class="hljs-number">8.5</span> <span class="hljs-string">id,</span>  <span class="hljs-number">3.2</span> <span class="hljs-string">wa,</span>  <span class="hljs-number">0.0</span> <span class="hljs-string">hi,</span>  <span class="hljs-number">0.8</span> <span class="hljs-string">si,</span>  <span class="hljs-number">0.0</span> <span class="hljs-string">st</span>
<span class="hljs-attr">MiB Mem :</span>  <span class="hljs-number">7821.3 </span><span class="hljs-string">total,</span>   <span class="hljs-number">234.5</span> <span class="hljs-string">free,</span>  <span class="hljs-number">6543.2 </span><span class="hljs-string">used,</span>  <span class="hljs-number">1043.6 </span><span class="hljs-string">buff/cache</span>
<span class="hljs-attr">MiB Swap:</span>  <span class="hljs-number">2048.0 </span><span class="hljs-string">total,</span>  <span class="hljs-number">1024.0 </span><span class="hljs-string">free,</span>  <span class="hljs-number">1024.0 </span><span class="hljs-string">used.</span>   <span class="hljs-number">876.4</span> <span class="hljs-string">avail</span> <span class="hljs-string">Mem</span>

  <span class="hljs-string">PID</span> <span class="hljs-string">USER</span>      <span class="hljs-string">PR</span>  <span class="hljs-string">NI</span>    <span class="hljs-string">VIRT</span>    <span class="hljs-string">RES</span>    <span class="hljs-string">SHR</span> <span class="hljs-string">S</span>  <span class="hljs-string">%CPU</span> <span class="hljs-string">%MEM</span>     <span class="hljs-string">TIME+</span> <span class="hljs-string">COMMAND</span>
<span class="hljs-number">12345</span> <span class="hljs-string">mysql</span>     <span class="hljs-number">20</span>   <span class="hljs-number">0</span> <span class="hljs-number">4523412</span> <span class="hljs-number">3.</span><span class="hljs-string">2g</span>   <span class="hljs-number">8532 </span><span class="hljs-string">S</span> <span class="hljs-number">156.3</span> <span class="hljs-number">42.1</span>  <span class="hljs-number">1234</span><span class="hljs-string">:56</span> <span class="hljs-string">mysqld</span>
<span class="hljs-number">23456</span> <span class="hljs-string">www-data</span>  <span class="hljs-number">20</span>   <span class="hljs-number">0</span>  <span class="hljs-number">892340</span> <span class="hljs-string">256m</span>  <span class="hljs-number">12340</span> <span class="hljs-string">S</span>  <span class="hljs-number">45.2</span>  <span class="hljs-number">3.3</span>   <span class="hljs-number">567</span><span class="hljs-string">:89</span> <span class="hljs-string">php-fpm</span>
</code></pre>
<p><strong>重点看这几行：</strong></p>








































<table><thead><tr><th>指标</th><th>含义</th><th>异常判断</th></tr></thead><tbody><tr><td><code>us</code></td><td>用户态CPU</td><td>&gt;70% 可能有CPU密集任务</td></tr><tr><td><code>sy</code></td><td>内核态CPU</td><td>&gt;30% 可能有大量系统调用</td></tr><tr><td><code>wa</code></td><td>IO等待</td><td>&gt;20% 说明磁盘IO有瓶颈</td></tr><tr><td><code>id</code></td><td>空闲</td><td>越低越忙</td></tr><tr><td><code>Mem used</code></td><td>内存使用</td><td>接近total需要关注</td></tr><tr><td><code>Swap used</code></td><td>交换分区</td><td>有使用说明内存不够</td></tr></tbody></table>
<h3 data-id="heading-3">2.3 htop - 更直观的top</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装</span>
apt install htop  <span class="hljs-comment"># Ubuntu</span>
yum install htop  <span class="hljs-comment"># CentOS</span>

<span class="hljs-comment"># 运行</span>
htop
</code></pre>
<p>htop相比top的优势：</p>
<ul>
<li>彩色显示，更直观</li>
<li>可以鼠标操作</li>
<li>可以直接kill进程</li>
<li>支持树状显示进程父子关系</li>
</ul>
<hr/>
<h2 data-id="heading-4">三、CPU问题排查</h2>
<h3 data-id="heading-5">3.1 判断是否CPU瓶颈</h3>
<pre><code class="hljs language-bash" lang="bash">$ top
<span class="hljs-comment"># 看 %Cpu(s) 行的 us + sy 是否接近100%</span>
<span class="hljs-comment"># 看 id（空闲）是否接近0%</span>
</code></pre>
<p>如果 <code>us + sy &gt; 90%</code> 且 <code>id &lt; 10%</code>，基本可以确定是CPU瓶颈。</p>
<h3 data-id="heading-6">3.2 找到CPU高的进程</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 按CPU排序（top默认就是）</span>
$ top -o %CPU

<span class="hljs-comment"># 或者用ps</span>
$ ps aux --<span class="hljs-built_in">sort</span>=-%cpu | <span class="hljs-built_in">head</span> -20
</code></pre>
<h3 data-id="heading-7">3.3 分析进程在干什么</h3>
<p>找到高CPU进程后，分析它在做什么：</p>
<p><strong>方法1：strace 跟踪系统调用</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 跟踪进程的系统调用</span>
$ strace -p &lt;PID&gt; -c
^C
% time     seconds  usecs/call     calls    errors syscall
------ ----------- ----------- --------- --------- ----------------
 85.23    1.234567         123     10000           write
  8.45    0.123456          12     10000           <span class="hljs-built_in">read</span>
  4.32    0.054321           5     10000           open
</code></pre>
<p><strong>方法2：perf 分析CPU热点</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装</span>
apt install linux-tools-generic

<span class="hljs-comment"># 采样30秒</span>
$ perf record -p &lt;PID&gt; -g -- <span class="hljs-built_in">sleep</span> 30

<span class="hljs-comment"># 查看结果</span>
$ perf report
</code></pre>
<p><strong>方法3：看进程的堆栈</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Java进程</span>
$ jstack &lt;PID&gt;

<span class="hljs-comment"># 通用方法</span>
$ <span class="hljs-built_in">cat</span> /proc/&lt;PID&gt;/stack
</code></pre>
<h3 data-id="heading-8">3.4 常见CPU高的原因</h3>






























<table><thead><tr><th>现象</th><th>可能原因</th><th>解决方案</th></tr></thead><tbody><tr><td>单个进程CPU 100%</td><td>死循环、算法问题</td><td>代码review、优化算法</td></tr><tr><td>多个进程CPU都高</td><td>并发请求过多</td><td>限流、扩容</td></tr><tr><td>sy（系统态）高</td><td>大量系统调用</td><td>减少IO操作、优化代码</td></tr><tr><td>短时间CPU飙高</td><td>定时任务、GC</td><td>错峰执行、调优GC</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">四、内存问题排查</h2>
<h3 data-id="heading-10">4.1 查看内存使用</h3>
<pre><code class="hljs language-bash" lang="bash">$ free -h
              total        used        free      shared  buff/cache   available
Mem:          7.6Gi       5.8Gi       234Mi       123Mi       1.6Gi       1.4Gi
Swap:         2.0Gi       1.0Gi       1.0Gi
</code></pre>
<p><strong>重点指标：</strong></p>
<ul>
<li><code>available</code>：真正可用的内存（比free更准确）</li>
<li><code>Swap used</code>：如果不为0，说明物理内存不够了</li>
</ul>
<h3 data-id="heading-11">4.2 找到内存大户</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 按内存排序</span>
$ ps aux --<span class="hljs-built_in">sort</span>=-%mem | <span class="hljs-built_in">head</span> -20

<span class="hljs-comment"># 或者用top，按M键切换为内存排序</span>
$ top
<span class="hljs-comment"># 然后按 M</span>
</code></pre>
<h3 data-id="heading-12">4.3 分析内存去哪了</h3>
<p><strong>系统层面：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看内存详细分布</span>
$ <span class="hljs-built_in">cat</span> /proc/meminfo

<span class="hljs-comment"># 重点看这几项</span>
MemTotal:        8000000 kB  <span class="hljs-comment"># 总内存</span>
MemFree:          200000 kB  <span class="hljs-comment"># 空闲内存</span>
MemAvailable:    1500000 kB  <span class="hljs-comment"># 可用内存</span>
Buffers:          100000 kB  <span class="hljs-comment"># 缓冲区</span>
Cached:          1200000 kB  <span class="hljs-comment"># 页面缓存</span>
SwapTotal:       2000000 kB  <span class="hljs-comment"># 交换分区总量</span>
SwapFree:        1000000 kB  <span class="hljs-comment"># 交换分区空闲</span>
</code></pre>
<p><strong>进程层面：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看进程内存详情</span>
$ <span class="hljs-built_in">cat</span> /proc/&lt;PID&gt;/status | grep -E <span class="hljs-string">"VmRSS|VmSize"</span>
VmSize:  4523412 kB  <span class="hljs-comment"># 虚拟内存（不重要）</span>
VmRSS:   3321456 kB  <span class="hljs-comment"># 实际物理内存（重要）</span>

<span class="hljs-comment"># 查看进程内存映射</span>
$ <span class="hljs-built_in">cat</span> /proc/&lt;PID&gt;/smaps | <span class="hljs-built_in">head</span> -50
</code></pre>
<h3 data-id="heading-13">4.4 内存泄漏排查</h3>
<p>如果发现某个进程内存持续增长：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 定时记录内存使用</span>
$ <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span> <span class="hljs-subst">$(ps -p &lt;PID&gt; -o rss=)</span>"</span> &gt;&gt; /tmp/mem.log
    <span class="hljs-built_in">sleep</span> 60
<span class="hljs-keyword">done</span>

<span class="hljs-comment"># 一段时间后分析增长曲线</span>
</code></pre>
<p><strong>Java进程：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看堆内存</span>
$ jmap -heap &lt;PID&gt;

<span class="hljs-comment"># dump堆内存分析</span>
$ jmap -dump:format=b,file=heap.bin &lt;PID&gt;
<span class="hljs-comment"># 用MAT或VisualVM分析</span>
</code></pre>
<h3 data-id="heading-14">4.5 OOM Killer</h3>
<p>如果内存真的不够，Linux会启动OOM Killer杀进程：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看被OOM杀掉的进程</span>
$ dmesg | grep -i <span class="hljs-string">"out of memory"</span>
$ dmesg | grep -i <span class="hljs-string">"killed process"</span>
</code></pre>
<hr/>
<h2 data-id="heading-15">五、磁盘IO问题排查</h2>
<h3 data-id="heading-16">5.1 判断是否IO瓶颈</h3>
<pre><code class="hljs language-bash" lang="bash">$ top
<span class="hljs-comment"># 看 wa（IO wait）是否 &gt; 20%</span>
</code></pre>
<p>如果wa很高，基本就是磁盘IO瓶颈。</p>
<h3 data-id="heading-17">5.2 iostat - 磁盘IO监控</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装</span>
apt install sysstat

<span class="hljs-comment"># 每2秒刷新一次</span>
$ iostat -xz 2
</code></pre>
<p>输出解读：</p>
<pre><code class="hljs language-bash" lang="bash">Device      r/s     w/s   rkB/s   wkB/s  %util
sda        15.00  250.00  120.00 51200.00  98.50
</code></pre>



































<table><thead><tr><th>指标</th><th>含义</th><th>异常判断</th></tr></thead><tbody><tr><td>r/s</td><td>每秒读次数</td><td>-</td></tr><tr><td>w/s</td><td>每秒写次数</td><td>-</td></tr><tr><td>rkB/s</td><td>每秒读取KB</td><td>-</td></tr><tr><td>wkB/s</td><td>每秒写入KB</td><td>-</td></tr><tr><td><strong>%util</strong></td><td><strong>磁盘繁忙度</strong></td><td><strong>&gt;80% 说明磁盘繁忙</strong></td></tr></tbody></table>
<h3 data-id="heading-18">5.3 找到IO高的进程</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># iotop需要安装</span>
$ apt install iotop

<span class="hljs-comment"># 查看IO最高的进程</span>
$ iotop -o
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-bash" lang="bash">PID  PRIO USER    DISK READ  DISK WRITE  COMMAND
12345  be/4 mysql     0.00 B/s   50.23 M/s  mysqld
23456  be/4 root      0.00 B/s   10.45 M/s  rsync
</code></pre>
<h3 data-id="heading-19">5.4 磁盘空间检查</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看磁盘使用率</span>
$ <span class="hljs-built_in">df</span> -h
Filesystem      Size  Used Avail Use% Mounted on
/dev/sda1       100G   95G    5G  95% /

<span class="hljs-comment"># 查看哪个目录占用大</span>
$ <span class="hljs-built_in">du</span> -sh /* | <span class="hljs-built_in">sort</span> -rh | <span class="hljs-built_in">head</span> -20

<span class="hljs-comment"># 更细的分析</span>
$ <span class="hljs-built_in">du</span> -sh /var/* | <span class="hljs-built_in">sort</span> -rh | <span class="hljs-built_in">head</span> -10
</code></pre>
<p><strong>磁盘满了会导致：</strong></p>
<ul>
<li>数据库无法写入</li>
<li>日志无法记录</li>
<li>应用崩溃</li>
</ul>
<h3 data-id="heading-20">5.5 常见IO问题</h3>






























<table><thead><tr><th>现象</th><th>可能原因</th><th>解决方案</th></tr></thead><tbody><tr><td>%util接近100%</td><td>磁盘瓶颈</td><td>换SSD、优化查询</td></tr><tr><td>磁盘空间满</td><td>日志太多、大文件</td><td>清理日志、扩容</td></tr><tr><td>随机IO高</td><td>数据库查询慢</td><td>加索引、优化SQL</td></tr><tr><td>顺序IO高</td><td>大文件读写</td><td>错峰执行</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-21">六、网络问题排查</h2>
<h3 data-id="heading-22">6.1 查看网络连接</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看所有连接</span>
$ ss -tunap

<span class="hljs-comment"># 统计各状态连接数</span>
$ ss -s
Total: 1234
TCP:   890 (estab 567, closed 123, orphaned 0, timewait 200)

<span class="hljs-comment"># 查看TIME_WAIT连接数</span>
$ ss -tan | grep TIME-WAIT | <span class="hljs-built_in">wc</span> -l
</code></pre>
<p><strong>TIME_WAIT过多</strong>会导致端口耗尽：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看可用端口范围</span>
$ <span class="hljs-built_in">cat</span> /proc/sys/net/ipv4/ip_local_port_range
32768   60999

<span class="hljs-comment"># 如果TIME_WAIT接近这个范围，需要优化</span>
</code></pre>
<h3 data-id="heading-23">6.2 网络流量监控</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装iftop</span>
$ apt install iftop

<span class="hljs-comment"># 查看实时流量</span>
$ iftop -i eth0
</code></pre>
<p>或者用更简单的：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 每秒刷新</span>
$ watch -n 1 <span class="hljs-string">"cat /proc/net/dev | grep eth0"</span>
</code></pre>
<h3 data-id="heading-24">6.3 抓包分析</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 抓取特定端口的包</span>
$ tcpdump -i eth0 port 3306 -w mysql.pcap

<span class="hljs-comment"># 抓取特定IP的包</span>
$ tcpdump -i eth0 host 192.168.1.100

<span class="hljs-comment"># 用Wireshark分析</span>
</code></pre>
<h3 data-id="heading-25">6.4 网络延迟排查</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ping测试</span>
$ ping -c 10 目标IP

<span class="hljs-comment"># 路由追踪</span>
$ traceroute 目标IP

<span class="hljs-comment"># 更详细的mtr</span>
$ mtr 目标IP
</code></pre>
<hr/>
<h2 data-id="heading-26">七、实战案例</h2>
<h3 data-id="heading-27">案例1：接口变慢，CPU正常，wa高</h3>
<p><strong>现象：</strong></p>
<ul>
<li>接口响应从200ms变成2s</li>
<li>top看CPU的wa（IO等待）达到40%</li>
<li>load average很高</li>
</ul>
<p><strong>排查过程：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 确认是IO问题</span>
$ iostat -xz 2
<span class="hljs-comment"># 发现 %util 接近100%</span>

<span class="hljs-comment"># 2. 找到IO高的进程</span>
$ iotop -o
<span class="hljs-comment"># 发现是mysql写入很高</span>

<span class="hljs-comment"># 3. 查看磁盘空间</span>
$ <span class="hljs-built_in">df</span> -h
<span class="hljs-comment"># 发现根分区使用率99%！</span>

<span class="hljs-comment"># 4. 找到大文件</span>
$ <span class="hljs-built_in">du</span> -sh /var/* | <span class="hljs-built_in">sort</span> -rh
<span class="hljs-comment"># /var/log 占了80G</span>

<span class="hljs-comment"># 5. 具体是哪个日志</span>
$ <span class="hljs-built_in">ls</span> -lh /var/log/*.<span class="hljs-built_in">log</span> | <span class="hljs-built_in">sort</span> -k5 -h
<span class="hljs-comment"># 发现某个应用日志有60G</span>
</code></pre>
<p><strong>解决：</strong></p>
<ol>
<li>清理日志：<code>&gt; /var/log/xxx.log</code></li>
<li>配置日志轮转：logrotate</li>
<li>监控磁盘使用率告警</li>
</ol>
<h3 data-id="heading-28">案例2：内存持续增长，最终OOM</h3>
<p><strong>现象：</strong></p>
<ul>
<li>应用每隔几天就会被OOM Killer杀掉</li>
<li>重启后又正常，过几天又OOM</li>
</ul>
<p><strong>排查过程：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 确认是哪个进程被杀</span>
$ dmesg | grep -i <span class="hljs-string">"killed process"</span>
<span class="hljs-comment"># 发现是java进程</span>

<span class="hljs-comment"># 2. 监控内存增长</span>
$ <span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    ps -p &lt;PID&gt; -o rss= &gt;&gt; /tmp/mem.log
    <span class="hljs-built_in">sleep</span> 300
<span class="hljs-keyword">done</span>
<span class="hljs-comment"># 发现内存每天增长几百MB</span>

<span class="hljs-comment"># 3. dump堆内存</span>
$ jmap -dump:format=b,file=heap.bin &lt;PID&gt;
<span class="hljs-comment"># 用MAT分析，发现某个Map一直在增长</span>

<span class="hljs-comment"># 4. 代码review</span>
<span class="hljs-comment"># 发现是缓存没有设置过期时间，一直往里塞数据</span>
</code></pre>
<p><strong>解决：</strong></p>
<ol>
<li>缓存设置过期时间和最大容量</li>
<li>定期重启（临时方案）</li>
<li>增加内存监控告警</li>
</ol>
<h3 data-id="heading-29">案例3：偶发性卡顿</h3>
<p><strong>现象：</strong></p>
<ul>
<li>每天固定时间（凌晨2点）系统变慢</li>
<li>其他时间正常</li>
</ul>
<p><strong>排查：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看定时任务</span>
$ crontab -l
0 2 * * * /opt/backup.sh

<span class="hljs-comment"># 查看备份脚本</span>
$ <span class="hljs-built_in">cat</span> /opt/backup.sh
<span class="hljs-comment"># 发现是全量数据库备份，占用大量IO</span>
</code></pre>
<p><strong>解决：</strong></p>
<ol>
<li>备份任务加nice降低优先级</li>
<li>使用增量备份</li>
<li>错峰到业务低谷期</li>
</ol>
<hr/>
<h2 data-id="heading-30">八、性能排查工具速查表</h2>


























































































<table><thead><tr><th>类别</th><th>工具</th><th>用途</th></tr></thead><tbody><tr><td><strong>综合</strong></td><td>top/htop</td><td>实时监控CPU、内存</td></tr><tr><td/><td>vmstat</td><td>系统整体状态</td></tr><tr><td/><td>dstat</td><td>综合资源监控</td></tr><tr><td><strong>CPU</strong></td><td>top</td><td>查看CPU使用</td></tr><tr><td/><td>perf</td><td>CPU热点分析</td></tr><tr><td/><td>strace</td><td>系统调用跟踪</td></tr><tr><td><strong>内存</strong></td><td>free</td><td>内存使用概览</td></tr><tr><td/><td>ps aux --sort=-%mem</td><td>内存大户</td></tr><tr><td/><td>pmap</td><td>进程内存映射</td></tr><tr><td><strong>磁盘</strong></td><td>df</td><td>磁盘空间</td></tr><tr><td/><td>du</td><td>目录大小</td></tr><tr><td/><td>iostat</td><td>磁盘IO</td></tr><tr><td/><td>iotop</td><td>IO进程排序</td></tr><tr><td><strong>网络</strong></td><td>ss/netstat</td><td>连接状态</td></tr><tr><td/><td>iftop</td><td>流量监控</td></tr><tr><td/><td>tcpdump</td><td>抓包分析</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-31">九、一键排查脚本</h2>
<p>分享一个我常用的快速排查脚本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># quick-check.sh - 快速性能检查</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"========== 系统负载 =========="</span>
<span class="hljs-built_in">uptime</span>

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n========== CPU使用 =========="</span>
top -bn1 | <span class="hljs-built_in">head</span> -5

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n========== 内存使用 =========="</span>
free -h

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n========== 磁盘空间 =========="</span>
<span class="hljs-built_in">df</span> -h | grep -v tmpfs

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n========== 磁盘IO =========="</span>
iostat -x 1 2 | <span class="hljs-built_in">tail</span> -10

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n========== CPU占用TOP10 =========="</span>
ps aux --<span class="hljs-built_in">sort</span>=-%cpu | <span class="hljs-built_in">head</span> -11

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n========== 内存占用TOP10 =========="</span>
ps aux --<span class="hljs-built_in">sort</span>=-%mem | <span class="hljs-built_in">head</span> -11

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n========== 网络连接统计 =========="</span>
ss -s

<span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n========== 最近的系统日志 =========="</span>
dmesg | <span class="hljs-built_in">tail</span> -20
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x quick-check.sh
./quick-check.sh
</code></pre>
<hr/>
<h2 data-id="heading-32">十、远程服务器排查技巧</h2>
<p>如果你管理的服务器分布在不同地方（公司机房、云服务器、家里的服务器），远程排查会遇到一些额外的问题。</p>
<h3 data-id="heading-33">10.1 SSH连接慢或断开</h3>
<p>服务器负载高时，SSH可能连不上或者很卡。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li><strong>用mosh替代SSH</strong>（更抗网络波动）：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 服务器安装</span>
apt install mosh

<span class="hljs-comment"># 客户端连接</span>
mosh user@server
</code></pre>
<ol start="2">
<li><strong>开启SSH保活</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ~/.ssh/config</span>
Host *
    ServerAliveInterval 30
    ServerAliveCountMax 5
</code></pre>
<h3 data-id="heading-34">10.2 多台服务器统一管理</h3>
<p>服务器多了，一台台登录很麻烦。</p>
<p><strong>方案1：使用tmux/screen保持会话</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 服务器上启动tmux</span>
tmux new -s debug

<span class="hljs-comment"># 断开后重连</span>
tmux attach -t debug
</code></pre>
<p><strong>方案2：批量执行命令</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用pdsh并行执行</span>
pdsh -w server[1-10] <span class="hljs-string">"uptime"</span>

<span class="hljs-comment"># 或者用ansible</span>
ansible all -m shell -a <span class="hljs-string">"uptime"</span>
</code></pre>
<h3 data-id="heading-35">10.3 跨网络访问内网服务器</h3>
<p>有时候服务器在内网，没有公网IP，远程排查就很麻烦。</p>
<p>比如：</p>
<ul>
<li>家里的开发服务器，在公司想连上去排查问题</li>
<li>客户的服务器在内网，需要远程协助排查</li>
</ul>
<p><strong>传统方案：</strong></p>
<ul>
<li>VPN：配置复杂，维护成本高</li>
<li>跳板机：多一跳，延迟高</li>
<li>frp内网穿透：需要自己维护服务端</li>
</ul>
<p><strong>我的方案：用星空组网</strong></p>
<p>原理是把多台服务器组成一个虚拟局域网，不管在哪都能直接SSH连接。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 服务器和本地电脑都装星空组网客户端</span>
<span class="hljs-comment"># 2. 登录同一账号，加入同一网络</span>
<span class="hljs-comment"># 3. 服务器获得虚拟IP，比如 10.26.1.10</span>

<span class="hljs-comment"># 直接用虚拟IP SSH连接</span>
ssh user@10.26.1.10

<span class="hljs-comment"># 或者配置~/.ssh/config</span>
Host homeserver
    HostName 10.26.1.10
    User root
</code></pre>
<p><strong>优势：</strong></p>
<ul>
<li>P2P直连，延迟低（比跳板机快）</li>
<li>不需要公网IP</li>
<li>免费版3设备够用</li>
<li>配置5分钟搞定</li>
</ul>
<p>我现在管理的几台服务器（家里、公司、云上）都组在一个网络里，在哪都能直接连，排查问题方便多了。</p>
<h3 data-id="heading-36">10.4 远程排查的注意事项</h3>
<ol>
<li><strong>先确认能稳定连接</strong>，再开始排查（别排查到一半断了）</li>
<li><strong>操作前做好记录</strong>，方便事后复盘</li>
<li><strong>高危操作用screen/tmux</strong>，防止SSH断开导致命令中断</li>
<li><strong>修改配置前先备份</strong>：<code>cp config config.bak</code></li>
</ol>
<hr/>
<h2 data-id="heading-37">十一、总结</h2>
<p>性能排查的核心思路：</p>
<ol>
<li><strong>先看整体</strong>：uptime看负载，top看资源分布</li>
<li><strong>定位瓶颈类型</strong>：是CPU、内存、磁盘还是网络？</li>
<li><strong>找到问题进程</strong>：用对应工具排序</li>
<li><strong>分析根因</strong>：看日志、抓包、分析堆栈</li>
<li><strong>解决问题</strong>：优化代码、调整配置、扩容</li>
</ol>
<p><strong>记住几个关键阈值：</strong></p>
<ul>
<li>load average &gt; CPU核心数×2 → 过载</li>
<li>CPU wa &gt; 20% → I</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端 HTML 转 PDF]]></title>    <link>https://juejin.cn/post/7578820377000280115</link>    <guid>https://juejin.cn/post/7578820377000280115</guid>    <pubDate>2025-12-02T07:02:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578820377000280115" data-draft-id="7578820377000083507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端 HTML 转 PDF "/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-02T07:02:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="调皮LE"/> <meta itemprop="url" content="https://juejin.cn/user/3844366792665853"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端 HTML 转 PDF 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3844366792665853/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    调皮LE
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:02:34.000Z" title="Tue Dec 02 2025 07:02:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>前端 HTML 转 PDF 的工具函数</strong>，核心作用是：把网页中指定 ID 的 DOM 元素（比如表格、报表、表单等），通过 <code>html2canvas</code> 和 <code>jspdf</code> 两个库转换成 PDF 文件并下载到本地。</p>
<p>简单说：它能让用户 “一键下载” 网页上的某个区域为 PDF（比如报表、数据统计页、合同预览页等），还预留了 “水印功能” 的注释代码（可按需启用）。</p>
<h3 data-id="heading-0">核心依赖说明</h3>
<p>函数依赖两个关键库，必须先安装才能使用：</p>

















<table><thead><tr><th>库名</th><th>作用</th></tr></thead><tbody><tr><td><code>html2canvas</code></td><td>把指定的 HTML 元素 “截图” 成 Canvas 画布（相当于把网页内容转成图片）</td></tr><tr><td><code>jspdf</code></td><td>生成 PDF 文件，再把 Canvas 图片嵌入 PDF 中，最终触发浏览器下载</td></tr></tbody></table>
<h3 data-id="heading-1">函数核心逻辑（分步拆解）</h3>
<p>函数名 <code>htmlToPdf</code>，接收两个参数：</p>
<ul>
<li><code>title</code>：下载的 PDF 文件名（比如 “2024 年报表”）；</li>
<li><code>htmlId</code>：需要转换的 HTML 元素的 ID（比如 <code>#report-container</code>）。</li>
</ul>
<p>整体流程：<strong>定位 HTML 元素 → 滚动置顶避免截图不全 → （可选加水印）→ HTML 转 Canvas → Canvas 转 PDF → 下载 PDF</strong></p>
<h4 data-id="heading-2">1. 准备工作：定位元素 + 滚动置顶</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(htmlId); <span class="hljs-comment">// 找到要转PDF的HTML元素</span>
<span class="hljs-comment">// 滚动置顶：避免元素被滚动条遮挡，导致截图不全</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">pageYOffset</span> = <span class="hljs-number">0</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">0</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">0</span>;
</code></pre>
<h4 data-id="heading-3">2. 可选：添加水印（已注释，需启用可取消注释）</h4>
<p>注释部分的逻辑是：创建一个带文字水印（比如 “我是水印”）的 Canvas，作为背景图添加到目标元素上，转 PDF 时水印会一起被截取（适合需要版权保护的场景）。</p>
<h4 data-id="heading-4">3. HTML 转 Canvas（核心步骤）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">html2Canvas</span>(element, {
  <span class="hljs-attr">allowTaint</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 允许跨域图片（如果元素内有跨域图片需开启）</span>
  <span class="hljs-attr">useCORS</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用CORS跨域支持</span>
  <span class="hljs-attr">scale</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 缩放2倍：提升PDF清晰度（代价是文件变大）</span>
  <span class="hljs-attr">height</span>: element.<span class="hljs-property">scrollHeight</span>, <span class="hljs-comment">// 用元素实际滚动高度：避免只截取可视区域（关键！）</span>
  <span class="hljs-attr">windowHeight</span>: element.<span class="hljs-property">scrollHeight</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">canvas</span> =&gt;</span> {
  <span class="hljs-comment">// Canvas生成成功后，进入PDF生成步骤</span>
});
</code></pre>
<h4 data-id="heading-5">4. Canvas 转 PDF 并下载</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> contentWidth = canvas.<span class="hljs-property">width</span>; <span class="hljs-comment">// Canvas宽度</span>
<span class="hljs-keyword">const</span> contentHeight = canvas.<span class="hljs-property">height</span>; <span class="hljs-comment">// Canvas高度</span>
<span class="hljs-keyword">const</span> pageHeight = (contentWidth * <span class="hljs-number">841.89</span>) / <span class="hljs-number">592.28</span>; <span class="hljs-comment">// A4纸的高度（按比例计算）</span>
<span class="hljs-keyword">let</span> leftHeight = contentHeight; <span class="hljs-comment">// 未生成PDF的剩余高度</span>
<span class="hljs-keyword">let</span> position = <span class="hljs-number">0</span>; <span class="hljs-comment">// PDF页面偏移量</span>

<span class="hljs-comment">// 创建A4尺寸的PDF（纵向："p" = portrait）</span>
<span class="hljs-keyword">const</span> pdf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsPDF</span>(<span class="hljs-string">"p"</span>, <span class="hljs-string">"pt"</span>, <span class="hljs-string">"a4"</span>);
<span class="hljs-comment">// Canvas转成图片数据（jpeg格式，质量1.0）</span>
<span class="hljs-keyword">const</span> pageData = canvas.<span class="hljs-title function_">toDataURL</span>(<span class="hljs-string">"image/jpeg"</span>, <span class="hljs-number">1.0</span>);

<span class="hljs-comment">// 处理分页：如果内容高度超过1页A4纸，自动分页</span>
<span class="hljs-keyword">if</span> (leftHeight &lt; pageHeight) {
  <span class="hljs-comment">// 单页：直接嵌入图片（20是左右边距，避免内容贴边）</span>
  pdf.<span class="hljs-title function_">addImage</span>(pageData, <span class="hljs-string">"JPEG"</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>, imgWidth, imgHeight);
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// 多页：循环截取内容，每满1页添加新页面</span>
  <span class="hljs-keyword">while</span> (leftHeight &gt; <span class="hljs-number">0</span>) {
    pdf.<span class="hljs-title function_">addImage</span>(pageData, <span class="hljs-string">"JPEG"</span>, <span class="hljs-number">20</span>, position, imgWidth, imgHeight);
    leftHeight -= pageHeight;
    position -= <span class="hljs-number">841.89</span>; <span class="hljs-comment">// 向下偏移A4纸高度</span>
    <span class="hljs-keyword">if</span> (leftHeight &gt; <span class="hljs-number">0</span>) pdf.<span class="hljs-title function_">addPage</span>(); <span class="hljs-comment">// 剩余内容不为空时，新增一页</span>
  }
}

<span class="hljs-comment">// 触发下载：文件名=title+".pdf"</span>
pdf.<span class="hljs-title function_">save</span>(title + <span class="hljs-string">".pdf"</span>);
</code></pre>
<h3 data-id="heading-6">如何使用</h3>
<h4 data-id="heading-7">1. 安装依赖</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># npm 安装</span>
npm install html2canvas jspdf --save

<span class="hljs-comment"># pnpm 安装</span>
pnpm add html2canvas jspdf
</code></pre>
<h4 data-id="heading-8">2.创建一个htmlToPdf.js文件</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> html2Canvas <span class="hljs-keyword">from</span> <span class="hljs-string">"html2canvas"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">JsPDF</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"jspdf"</span>;
<span class="hljs-comment">// title:下载文件的名称  htmlId:包裹的标签的id</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">htmlToPdf</span> = (<span class="hljs-params">title, htmlId</span>) =&gt; {
  <span class="hljs-keyword">const</span> element = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(htmlId);
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">pageYOffset</span> = <span class="hljs-number">0</span>;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">0</span>;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">0</span>;
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// // 以下注释的是增加导出的pdf水印 ！！！！！！！！！！！！！</span>
    <span class="hljs-comment">// const value = '我是水印'</span>
    <span class="hljs-comment">// //创建一个画布</span>
    <span class="hljs-comment">// let can = document.createElement('canvas')</span>
    <span class="hljs-comment">// //设置画布的长宽</span>
    <span class="hljs-comment">// can.width = 400</span>
    <span class="hljs-comment">// can.height = 500</span>
    <span class="hljs-comment">// let cans = can.getContext('2d') as any</span>
    <span class="hljs-comment">// //旋转角度</span>
    <span class="hljs-comment">// cans.rotate((-15 * Math.PI) / 180)</span>
    <span class="hljs-comment">// cans.font = '18px Vedana'</span>
    <span class="hljs-comment">// //设置填充绘画的颜色、渐变或者模式</span>
    <span class="hljs-comment">// cans.fillStyle = 'rgba(200, 200, 200, 0.40)'</span>
    <span class="hljs-comment">// //设置文本内容的当前对齐方式</span>
    <span class="hljs-comment">// cans.textAlign = 'left'</span>
    <span class="hljs-comment">// //设置在绘制文本时使用的当前文本基线</span>
    <span class="hljs-comment">// cans.textBaseline = 'Middle'</span>
    <span class="hljs-comment">// //在画布上绘制填色的文本（输出的文本，开始绘制文本的X坐标位置，开始绘制文本的Y坐标位置）</span>
    <span class="hljs-comment">// cans.fillText(value, can.width / 8, can.height / 2)</span>
    <span class="hljs-comment">// let div = document.createElement('div')</span>
    <span class="hljs-comment">// div.style.pointerEvents = 'none'</span>
    <span class="hljs-comment">// div.style.top = '20px'</span>
    <span class="hljs-comment">// div.style.left = '-20px'</span>
    <span class="hljs-comment">// div.style.position = 'fixed'</span>
    <span class="hljs-comment">// div.style.zIndex = '100000'</span>
    <span class="hljs-comment">// div.style.width = element.scrollHeight + 'px'</span>
    <span class="hljs-comment">// div.style.height = element.scrollHeight + 'px'</span>
    <span class="hljs-comment">// div.style.background =</span>
    <span class="hljs-comment">//   'url(' + can.toDataURL('image/png') + ') left top repeat'</span>
    <span class="hljs-comment">// element.appendChild(div) // 到页面中</span>
    <span class="hljs-title function_">html2Canvas</span>(element, {
      <span class="hljs-attr">allowTaint</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">useCORS</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">scale</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// 提升画面质量，但是会增加文件大小</span>
      <span class="hljs-attr">height</span>: element.<span class="hljs-property">scrollHeight</span>, <span class="hljs-comment">// 需要注意，element的 高度 宽度一定要在这里定义一下，不然会存在只下载了当前你能看到的页面   避雷避雷！！！</span>
      <span class="hljs-attr">windowHeight</span>: element.<span class="hljs-property">scrollHeight</span>
    }).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">canvas</span>) {
      <span class="hljs-keyword">const</span> contentWidth = canvas.<span class="hljs-property">width</span>;
      <span class="hljs-keyword">const</span> contentHeight = canvas.<span class="hljs-property">height</span>;
      <span class="hljs-comment">// 一页pdf显示html页面生成的canvas高度;</span>
      <span class="hljs-keyword">const</span> pageHeight = (contentWidth * <span class="hljs-number">841.89</span>) / <span class="hljs-number">592.28</span>;
      <span class="hljs-comment">// 未生成pdf的html页面高度</span>
      <span class="hljs-keyword">let</span> leftHeight = contentHeight;
      <span class="hljs-comment">// 页面偏移</span>
      <span class="hljs-keyword">let</span> position = <span class="hljs-number">0</span>;
      <span class="hljs-comment">// a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高  //40是左右页边距</span>
      <span class="hljs-keyword">const</span> imgWidth = <span class="hljs-number">595.28</span> - <span class="hljs-number">40</span>;
      <span class="hljs-keyword">const</span> imgHeight = (<span class="hljs-number">592.28</span> / contentWidth) * contentHeight;
      <span class="hljs-keyword">const</span> pageData = canvas.<span class="hljs-title function_">toDataURL</span>(<span class="hljs-string">"image/jpeg"</span>, <span class="hljs-number">1.0</span>);
      <span class="hljs-keyword">const</span> pdf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsPDF</span>(<span class="hljs-string">"p"</span>, <span class="hljs-string">"pt"</span>, <span class="hljs-string">"a4"</span>);
      <span class="hljs-comment">// 有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)</span>
      <span class="hljs-comment">// 当内容未超过pdf一页显示的范围，无需分页</span>
      <span class="hljs-keyword">if</span> (leftHeight &lt; pageHeight) {
        pdf.<span class="hljs-title function_">addImage</span>(pageData, <span class="hljs-string">"JPEG"</span>, <span class="hljs-number">20</span>, <span class="hljs-number">20</span>, imgWidth, imgHeight);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">while</span> (leftHeight &gt; <span class="hljs-number">0</span>) {
          pdf.<span class="hljs-title function_">addImage</span>(pageData, <span class="hljs-string">"JPEG"</span>, <span class="hljs-number">20</span>, position, imgWidth, imgHeight);
          leftHeight -= pageHeight;
          position -= <span class="hljs-number">841.89</span>;
          <span class="hljs-comment">// 避免添加空白页</span>
          <span class="hljs-keyword">if</span> (leftHeight &gt; <span class="hljs-number">0</span>) {
            pdf.<span class="hljs-title function_">addPage</span>();
          }
        }
      }
      pdf.<span class="hljs-title function_">save</span>(title + <span class="hljs-string">".pdf"</span>);
    });
  }, <span class="hljs-number">1000</span>);
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> htmlToPdf;
</code></pre>
<h4 data-id="heading-9">3. 在 Vue/React 中使用示例</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Vue 示例：页面中有一个要转PDF的区域 --&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;!-- 要转PDF的元素：必须有唯一ID --&gt;
    &lt;div id="report-container"&gt;
      &lt;h1&gt;2024年销售报表&lt;/h1&gt;
      &lt;table&gt;...&lt;/table&gt; &lt;!-- 报表内容 --&gt;
    &lt;/div&gt;
    &lt;!-- 下载按钮 --&gt;
    &lt;button @click="downloadPdf"&gt;下载PDF&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import htmlToPdf from '@/utils/htmlToPdf'; // 导入函数

export default {
  methods: {
    downloadPdf() {
      // 调用函数：参数1=PDF文件名，参数2=目标元素ID（注意加#）
      htmlToPdf('2024年销售报表', '#report-container');
    }
  }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-10">常见问题与优化</h3>
<h4 data-id="heading-11">1. 截图不全 / 内容缺失？</h4>
<ul>
<li>确保目标元素的 <code>height</code>/<code>scrollHeight</code> 正确（函数已处理，但如果元素是动态渲染的，可能需要调整 <code>setTimeout</code> 延迟时间，比如从 1000ms 改为 2000ms）；</li>
<li>避免元素内有 <code>position: fixed</code> 的内容（会被重复截取）。</li>
</ul>
<h4 data-id="heading-12">2. 图片跨域导致截图空白？</h4>
<ul>
<li>确保 <code>html2Canvas</code> 配置中 <code>allowTaint: true</code> 和 <code>useCORS: true</code> 已开启；</li>
<li>图片服务器需配置 CORS 允许当前域名访问。</li>
</ul>
<h4 data-id="heading-13">3. PDF 清晰度太低？</h4>
<ul>
<li>增大 <code>scale</code> 参数（比如改为 3），但会导致文件变大；</li>
<li>把 <code>toDataURL</code> 的质量参数从 1.0 保留（已最优）。</li>
</ul>
<h4 data-id="heading-14">4. 想要启用水印？</h4>
<ul>
<li>取消代码中水印相关的注释，修改 <code>value</code> 为你的水印文字（比如 “内部资料”）；</li>
<li>调整 <code>rotate</code> 旋转角度、<code>font</code> 字体大小、<code>fillStyle</code> 透明度（0.4 为半透明）。</li>
</ul>
<h3 data-id="heading-15">总结</h3>
<p>这个函数是前端开发中非常实用的 “HTML 转 PDF 工具”，适用于报表下载、合同导出、数据归档等场景。核心是通过 <code>html2canvas</code> 转图片、<code>jspdf</code> 生成文件，逻辑完整且预留了水印扩展，稍作调整就能适配大部分项目需求～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Electron 初体验]]></title>    <link>https://juejin.cn/post/7578948893762060315</link>    <guid>https://juejin.cn/post/7578948893762060315</guid>    <pubDate>2025-12-02T07:57:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578948893762060315" data-draft-id="7576888607480348691" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Electron 初体验"/> <meta itemprop="keywords" content="Electron,前端,Trae"/> <meta itemprop="datePublished" content="2025-12-02T07:57:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PBitW"/> <meta itemprop="url" content="https://juejin.cn/user/3048261967153544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Electron 初体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048261967153544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PBitW
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:57:28.000Z" title="Tue Dec 02 2025 07:57:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近菜鸟公司准备做一个纯前端项目，需求是：</p>
<blockquote>
<p>用户输入一些东西，然后选择本地的文件夹路径，等选好后会点击提交，提交就是将用户填写的东西传参给该电脑上的脚本，让其跑出一些文件。</p>
</blockquote>
<p>这个需求，一开始描述的时候，同事说的服务器，菜鸟就以为是做一个网页，给用户访问，那问题就来了：怎么去获得服务器上的文件路径？纯前端做不到啊！</p>
<p>当时给菜鸟整懵逼了，后面交流才发现，是将服务器和脚本一起给用户或者理解为用户用向日葵远程服务器！</p>
<p>然后大佬就说了，这种情况，可以用<code>Electron</code>，因为有<code>node</code>在里面，所以可以获取路径，正好也可以搞成一个桌面软件！</p>
<h2 data-id="heading-0">初识 Electron</h2>
<p>这个菜鸟是直接看官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Felectron.nodejs.cn%2Fdocs%2Flatest%2Ftutorial%2Ftutorial-first-app%2F" target="_blank" title="https://electron.nodejs.cn/docs/latest/tutorial/tutorial-first-app/" ref="nofollow noopener noreferrer">electron.nodejs.cn/docs/latest…</a></p>
<p>按照官网的来，是那种从零搭建的，不是和vue一样，搭建起来就有很多内置的东西！</p>
<h3 data-id="heading-1">坑点</h3>
<p>这里一步一步照着来就行，没啥大问题，最大的问题就是<code>Electron</code>可能下载不完全!</p>
<p>菜鸟一开始想用<code>pnpm</code>下载的，<strong>下载速度确实快，但是差东西也是真的差</strong>，反正运行就报错：</p>
<blockquote>
<p>barcodeformedicinal@1.0.0 dev</p>
<p>electron .</p>
<p>F:\proGitLab\BarcodeForMedicinal\node_modules.pnpm\electron@30.5.1\node_modules\electron\index.js:17</p>
<p>throw new Error('Electron failed to install correctly, please delete node_modules/electron and try installing again');</p>
<p>Error: Electron failed to install correctly, please delete node_modules/electron and try installing again</p>
</blockquote>
<p>菜鸟一开始问<code>Trae</code>，说可能是最新版本的<code>Electron</code>国内没有稳定镜像，需要换成28~32之间的版本，所以把<code>package.json</code>改成</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"barcodeformedicinal"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"main.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"electron ."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"author"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ISC"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"electron"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"30.x"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<p><code>pnpm install electron --save-dev</code>下载之后，就会自动变成一个30比较稳定的版本了。</p>
<p>但还没有用，继续报错，菜鸟就尝试设置<code>pnpm</code>为国内镜像</p>
<blockquote>
<p>pnpm config set registry <a href="https://link.juejin.cn?target=https%3A%2F%2Fregistry.npmmirror.com" target="_blank" title="https://registry.npmmirror.com" ref="nofollow noopener noreferrer">registry.npmmirror.com</a></p>
</blockquote>
<p>还是没有用，所以只能还是用<code>npm</code>设置镜像为国内</p>
<blockquote>
<p>npm config set registry <a href="https://link.juejin.cn?target=https%3A%2F%2Fregistry.npmmirror.com" target="_blank" title="https://registry.npmmirror.com" ref="nofollow noopener noreferrer">registry.npmmirror.com</a></p>
</blockquote>
<p>并新建一个<code>.npmrc</code>文件，内容如下</p>
<blockquote>
<p>electron_mirror=<a href="https://link.juejin.cn?target=https%3A%2F%2Fnpmmirror.com%2Fmirrors%2Felectron%2F" target="_blank" title="https://npmmirror.com/mirrors/electron/" ref="nofollow noopener noreferrer">npmmirror.com/mirrors/ele…</a></p>
</blockquote>
<p>然后执行</p>
<blockquote>
<p>npm i</p>
</blockquote>
<p>可能会卡在这一步</p>
<blockquote>
<p>npm warn deprecated boolean@3.2.0: Package no longer supported. Contact Support at <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fsupport" target="_blank" title="https://www.npmjs.com/support" ref="nofollow noopener noreferrer">www.npmjs.com/support</a> for more info.</p>
</blockquote>
<p>这里建议<strong>重启电脑，重新开翻墙</strong>，菜鸟昨天晚上一直卡这里，第二天电脑自己关机了，再重新运行一下直接就成功了，还是<code>npm</code>最牛皮，虽然<strong>有点幽灵依赖问题，但是稳</strong>！</p>
<h2 data-id="heading-2">vite + Electron</h2>
<p>菜鸟按上面的搞完，发现这个是按照原生去开发的，而不是用<code>vue</code>，想用<code>vue</code>应该先创建<code>vue</code>项目，再来接入<code>Electron</code>。</p>
<p>创建<code>vue</code>项目可以去看我的 —— <a href="https://juejin.cn/post/7463137546526572579" target="_blank" title="https://juejin.cn/post/7463137546526572579">vue3+vite+eslint|prettier+elementplus+国际化+axios封装+pinia</a></p>
<p>这里参考了别人的文章 —— <a href="https://juejin.cn/post/7360899424107970586" target="_blank" title="https://juejin.cn/post/7360899424107970586">用electron+vite+vue3搭建桌面端项目，electron基础配置一</a></p>
<p>创建<code>vue</code>项目完毕后，还需要下载几个包：</p>
<pre><code class="hljs language-npm" lang="npm">npm install -D electron-builder
npm install -D electron-devtools-installer
npm install -D vite-plugin-electron
</code></pre>
<p>这里先解释一下这几个包，其中最重要的是 <code>vite-plugin-electron</code>!</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79f0bf6349b64727b98e189d2a5ec888~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=qYxPwzeuNbrwZiBQH0PBjPbfzZg%3D" alt="image.png" loading="lazy"/></p>
<p>其次就是 <code>electron-builder</code>，这个是你 <code>electron</code> 打包成安装包必须要下载的！</p>
<p><code>electron-devtools-installer</code> 是辅助开发，可以在 <code>electron</code> 控制台的 <code>Chrome DevTools</code> 里自动安装 <code>Vue3 Devtools</code> 方便调试<code>vue</code>代码！</p>
<h3 data-id="heading-3">electron/main.js 默认模板</h3>
<p><code>electron</code>引入成功了，可以开始写<code>electron</code>的相关代码了，新建一个<code>ElectronSrc</code> 文件用来写<code>electron</code>的代码，在它下面创建一个<code>main.js</code>文件用来写主进程代码</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { app, <span class="hljs-title class_">BrowserWindow</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'electron'</span>)
<span class="hljs-keyword">const</span> { join } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)

<span class="hljs-comment">// 屏蔽安全警告 - 只在开发或你确认安全的场景使用，生产环境最好不要屏蔽安全警告</span>
<span class="hljs-comment">// ectron Security Warning (Insecure Content-Security-Policy)</span>
process.<span class="hljs-property">env</span>[<span class="hljs-string">'ELECTRON_DISABLE_SECURITY_WARNINGS'</span>] = <span class="hljs-string">'true'</span>

<span class="hljs-comment">// 创建浏览器窗口时，调用这个函数。</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">createWindow</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> win = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({
        <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>,
    })

    <span class="hljs-comment">// development模式</span>
    <span class="hljs-keyword">if</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_DEV_SERVER_URL</span>) {
        win.<span class="hljs-title function_">loadURL</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_DEV_SERVER_URL</span>)
        <span class="hljs-comment">// 开启调试台</span>
        win.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">openDevTools</span>()
    }<span class="hljs-keyword">else</span> {
        win.<span class="hljs-title function_">loadFile</span>(<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'../dist/index.html'</span>))
    }
}

<span class="hljs-comment">// Electron 会在初始化后并准备</span>
app.<span class="hljs-title function_">whenReady</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">createWindow</span>()
    app.<span class="hljs-title function_">on</span>(<span class="hljs-string">'activate'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">BrowserWindow</span>.<span class="hljs-title function_">getAllWindows</span>().<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-title function_">createWindow</span>()
    })
})

app.<span class="hljs-title function_">on</span>(<span class="hljs-string">'window-all-closed'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">platform</span> !== <span class="hljs-string">'darwin'</span>) app.<span class="hljs-title function_">quit</span>()
})
</code></pre>
<p>这基本就是每个项目都要写的最简单的一点内容，所以可以搞成默认模板！</p>
<h3 data-id="heading-4">全屏</h3>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-keyword">const</span> win = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({
    <span class="hljs-attr">frame</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 保留窗口框（默认 true）</span>
    <span class="hljs-attr">fullscreen</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 按F11的效果，所以不要开启</span>
    <span class="hljs-attr">autoHideMenuBar</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Windows/Linux 下隐藏菜单栏（按 Alt 会显示）</span>
    <span class="hljs-attr">webPreferences</span>: {
      <span class="hljs-attr">preload</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"preload.js"</span>),
      <span class="hljs-attr">contextIsolation</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">nodeIntegration</span>: <span class="hljs-literal">false</span>
    }
  });

  <span class="hljs-comment">// 启动时最大化</span>
  win.<span class="hljs-title function_">maximize</span>();
</code></pre>
<h3 data-id="heading-5">配置</h3>
<p>在 <code>vite.config.js</code> 中配置 <code>vite-plugin-electron</code> 插件入口</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { fileURLToPath, <span class="hljs-variable constant_">URL</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>

<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> vueDevTools <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-vue-devtools'</span>
<span class="hljs-keyword">import</span> electron <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-electron'</span>

<span class="hljs-comment">// https://vite.dev/config/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">vue</span>(),
    <span class="hljs-title function_">vueDevTools</span>(),
    <span class="hljs-title function_">electron</span>({
      <span class="hljs-comment">// 主进程入口文件</span>
      <span class="hljs-attr">entry</span>: <span class="hljs-string">'./ElectronSrc/main.js'</span> <span class="hljs-comment">// 你自己创建的为准</span>
    })
  ],
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'./src'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))
    },
  },
})
</code></pre>
<p>在 <code>package.json</code> 把 <code>"type": "module",</code> 删除掉并且配置main字段</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"barcodeformedicinal"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ElectronSrc/main.js"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 你自己创建的为准</span>
  <span class="hljs-attr">"engines"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^20.19.0 || &gt;=22.12.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint . --fix --cache"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prettier --write src/"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"pinia"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.0.3"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.5.22"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue-router"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.6.3"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@eslint/js"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^9.37.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vitejs/plugin-vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^6.0.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vue/eslint-config-prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^10.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"electron"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^30.5.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"electron-builder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^26.0.12"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"electron-devtools-installer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^9.37.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"eslint-plugin-vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"~10.5.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"globals"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^16.4.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"3.6.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.1.11"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite-plugin-electron"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.29.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite-plugin-vue-devtools"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^8.0.3"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-6">解释</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dc0a9afca70461e997ffc2c19d4f3a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=dJ%2B6Lx1VuVH0gyxqp%2FeuV9%2F9vSQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">注意</h3>
<p>菜鸟是第一次开发，所以这里目录结构其实不是很规范，如果大家按照大型项目那样的目录结构的话，下面有些<code>package.json</code>文件的配置，就要先<code>cd</code>，然后运行<code>build</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4b2e095c0414a2ebe6db8d188afcd0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=3AqBwed9D38V5JL0hVhjtMx0W%2Bs%3D" alt="image.png" loading="lazy"/></p>
<p><code>Trae</code>建议目录结构</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40d53a8ad3f14ed8a3509053533c0e71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=yRvqq0BakDSedqX6ctnkRmAWt%2B4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">优化开发体验</h2>
<p>这里直接用之前项目的<code>eslint</code>会不生效，排查了半天，发现是之前搞了一个自动引入的<code>json</code>文件，这个新建的项目没有，所以导致的报错！</p>
<p><strong>这种情况自己排查很难排查，直接调用这两个命令更加方便</strong></p>
<pre><code class="hljs language-npm" lang="npm"># 运行 ESLint 检查并自动修复
npm run lint

# 运行 Prettier 格式化
npm run format
</code></pre>
<h3 data-id="heading-9">tailwind 导入</h3>
<p>这里菜鸟用的是官网提供的最新的导入方式</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d051ed31a0904d55a719a32bcaf21c9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=s%2BMiIDhU8658YMNgDIOCPStEIdM%3D" alt="image.png" loading="lazy"/></p>
<p>这里不导入base的方式可以看我之前的文章：<a href="https://juejin.cn/post/7501147702667952168#heading-7" target="_blank" title="https://juejin.cn/post/7501147702667952168#heading-7">工作两年，最后从css转向tailwind了！</a></p>
<h2 data-id="heading-10">搭建界面</h2>
<p>这里开发界面其实就是用<code>vue</code>开发，这里菜鸟选用了<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.naiveui.com%2Fzh-CN%2Fos-theme%2Fcomponents%2Fdata-table" target="_blank" title="https://www.naiveui.com/zh-CN/os-theme/components/data-table" ref="nofollow noopener noreferrer">Naive UI</a>，大佬说这个更加好用，比element plus要清晰！</p>
<p>实际开发发现，这个Naive UI更加适合jsx使用很强的人使用，菜鸟不是很会！</p>
<p>这里把两个界面的代码直接放过来了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a652c3cbcf74fa7b9946cb29b40a2c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=5wPxCtH6kUen9mR9Ivso%2FI16cPM%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useMessage, <span class="hljs-title class_">NForm</span>, <span class="hljs-title class_">NFormItem</span>, <span class="hljs-title class_">NInput</span>, <span class="hljs-title class_">NButton</span>, <span class="hljs-title class_">NDataTable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> { ref, h } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">const</span> message = <span class="hljs-title function_">useMessage</span>();

<span class="hljs-keyword">const</span> modelRef = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">path</span>: <span class="hljs-string">""</span>,
  <span class="hljs-attr">sampleData</span>: [
    {
      <span class="hljs-title class_">Barcode</span>: <span class="hljs-string">""</span>,
      <span class="hljs-attr">sampleName</span>: <span class="hljs-string">""</span>
    }
  ]
});
<span class="hljs-keyword">const</span> rules = {
  <span class="hljs-attr">sampleData</span>: [
    {
      <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-title function_">validator</span>(<span class="hljs-params">rule, value</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Validating sampleData:"</span>, value);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i <span class="hljs-keyword">of</span> value) {
          <span class="hljs-keyword">if</span> (!i.<span class="hljs-property">Barcode</span> || !i.<span class="hljs-property">sampleName</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"样本信息需要完善！"</span>));
          }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      },
      <span class="hljs-attr">trigger</span>: [<span class="hljs-string">"input"</span>, <span class="hljs-string">"blur"</span>]
    }
  ],
  <span class="hljs-attr">path</span>: [
    {
      <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">"请输入芯片路径"</span>
    }
  ]
};
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createColumns</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> [
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"Barcode"</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">"Barcode"</span>,
      <span class="hljs-title function_">render</span>(<span class="hljs-params">row, index</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">NInput</span>, {
          <span class="hljs-attr">placeholder</span>: <span class="hljs-string">"请输入Barcode"</span>,
          <span class="hljs-attr">value</span>: row.<span class="hljs-property">Barcode</span>,
          <span class="hljs-title function_">onUpdateValue</span>(<span class="hljs-params">v</span>) {
            modelRef.<span class="hljs-property">value</span>.<span class="hljs-property">sampleData</span>[index].<span class="hljs-property">Barcode</span> = v;
          }
        });
      }
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"样本名称"</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">"sampleName"</span>,
      <span class="hljs-title function_">render</span>(<span class="hljs-params">row, index</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-title class_">NInput</span>, {
          <span class="hljs-attr">placeholder</span>: <span class="hljs-string">"请输入样本名称"</span>,
          <span class="hljs-attr">value</span>: row.<span class="hljs-property">sampleName</span>,
          <span class="hljs-title function_">onUpdateValue</span>(<span class="hljs-params">v</span>) {
            modelRef.<span class="hljs-property">value</span>.<span class="hljs-property">sampleData</span>[index].<span class="hljs-property">sampleName</span> = v;
          }
        });
      }
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"操作"</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">"operation"</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">80</span>,
      <span class="hljs-title function_">render</span>(<span class="hljs-params">row, index</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(
          <span class="hljs-string">"p"</span>,
          {
            <span class="hljs-attr">class</span>: <span class="hljs-string">"text-red-500 cursor-pointer"</span>,
            <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> {
              modelRef.<span class="hljs-property">value</span>.<span class="hljs-property">sampleData</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
              message.<span class="hljs-title function_">success</span>(<span class="hljs-string">"删除成功"</span>);
            }
          },
          { <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">"删除"</span> }
        );
      }
    }
  ];
}
<span class="hljs-keyword">const</span> columns = <span class="hljs-title function_">createColumns</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">addRow</span>(<span class="hljs-params"/>) {
  modelRef.<span class="hljs-property">value</span>.<span class="hljs-property">sampleData</span>.<span class="hljs-title function_">push</span>({ <span class="hljs-title class_">Barcode</span>: <span class="hljs-string">""</span>, <span class="hljs-attr">sampleName</span>: <span class="hljs-string">""</span> });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">submitForm</span>(<span class="hljs-params"/>) {
  formRef.<span class="hljs-property">value</span>
    .<span class="hljs-title function_">validate</span>()
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// TODO：调用脚本</span>
      message.<span class="hljs-title function_">success</span>(<span class="hljs-string">"鉴定成功"</span>);
    })
    .<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {
      message.<span class="hljs-title function_">error</span>(<span class="hljs-string">"请完善样本信息"</span>);
    });
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">n-form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"formRef"</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"modelRef"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"rules"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">n-form-item</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"sampleData"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"样本信息"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-full"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mb-4 flex justify-end"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">n-button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ml-auto"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addRow"</span>&gt;</span>添加一行<span class="hljs-tag">&lt;/<span class="hljs-name">n-button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">n-data-table</span> <span class="hljs-attr">:columns</span>=<span class="hljs-string">"columns"</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"modelRef.sampleData"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">n-form-item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">n-form-item</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"path"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"芯片路径"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">n-input</span> <span class="hljs-attr">v-model:value</span>=<span class="hljs-string">"modelRef.path"</span> @<span class="hljs-attr">keydown.enter.prevent</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">n-form-item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">n-form-item</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex w-full justify-center"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">n-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"submitForm"</span>&gt;</span>开始鉴定<span class="hljs-tag">&lt;/<span class="hljs-name">n-button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">n-form-item</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">n-form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cab3cc862224477895b957732ddcc971~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=svxbgGct4A98u%2FdlDNqq3VkGyE8%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">NButton</span>, <span class="hljs-title class_">NDataTable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"naive-ui"</span>;
<span class="hljs-keyword">import</span> { h } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

<span class="hljs-keyword">const</span> data = [
  {
    <span class="hljs-attr">appraisalId</span>: <span class="hljs-string">"123456"</span>,
    <span class="hljs-attr">appraisalStatus</span>: <span class="hljs-string">"已鉴定"</span>,
    <span class="hljs-attr">createTime</span>: <span class="hljs-string">"2023-08-01 10:00:00"</span>,
    <span class="hljs-attr">path</span>: <span class="hljs-string">"/path/to/chip"</span>
  }
];
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createColumns</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> [
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"鉴定编号"</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">"appraisalId"</span>
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"鉴定状态"</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">"appraisalStatus"</span>
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"创建时间"</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">"createTime"</span>
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"芯片路径"</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">"path"</span>
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">"操作"</span>,
      <span class="hljs-attr">key</span>: <span class="hljs-string">"operation"</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>,
      <span class="hljs-title function_">render</span>(<span class="hljs-params">row, index</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(
          <span class="hljs-string">"div"</span>,
          {
            <span class="hljs-attr">class</span>: <span class="hljs-string">"flex justify-evenly"</span>
          },
          {
            <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> [
              <span class="hljs-title function_">h</span>(<span class="hljs-title class_">NButton</span>, { <span class="hljs-attr">type</span>: <span class="hljs-string">"primary"</span>, <span class="hljs-attr">size</span>: <span class="hljs-string">"small"</span> }, { <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">"查看详情"</span> }),
              <span class="hljs-title function_">h</span>(<span class="hljs-title class_">NButton</span>, { <span class="hljs-attr">type</span>: <span class="hljs-string">"primary"</span>, <span class="hljs-attr">size</span>: <span class="hljs-string">"small"</span> }, { <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">"查看报告"</span> })
            ]
          }
        );
      }
    }
  ];
}
<span class="hljs-keyword">const</span> columns = <span class="hljs-title function_">createColumns</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">n-data-table</span> <span class="hljs-attr">:columns</span>=<span class="hljs-string">"columns"</span> <span class="hljs-attr">:data</span>=<span class="hljs-string">"data"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h2 data-id="heading-11">访问路径搭建</h2>
<p>前面只是前端部分，所以很简单，但是难的就是菜鸟这里要搞：访问路径、调用脚本、自己把数据存起来并展示到历史记录这些功能，接下来一个一个搞！</p>
<p>这里先写访问路径的搭建，现在的AI是真的很强</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd1731d14208494db2fa4bd1e321ee40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=pj4rqVD45pHRbgLbnIoYNKYFw80%3D" alt="image.png" loading="lazy"/></p>
<p>这里菜鸟直接用了，还真可以，所以找AI要了解释</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9230e17924c74b1f80cf8360dc3ca6ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=QXvtADOcONfhogo%2BHnLhQRFfON4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7b57ea3eaf040659a959a8b19a97f04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=5oa%2FGsBSppXwP%2BfHIsmDxq%2FX7tw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a73f09132a1b444ca2a2938fcb198ac4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=WcznaINslp8w5sHfiJPd0QOQ7qA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef1fdea4e7214892bc0004281d87e280~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=WcJGPUdFVq%2BeNI%2BwNVFMtP3W%2BVQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-12">搭建调用脚本</h2>
<p>这个的<code>vue</code>和<code>preload.js</code>还是一样比较好写，就是<code>preload.js</code>暴露，然后<code>vue</code>调用<code>electron</code>暴露出来的方法即可</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { contextBridge, ipcRenderer } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"electron"</span>);

contextBridge.<span class="hljs-title function_">exposeInMainWorld</span>(<span class="hljs-string">"electronAPI"</span>, {
  <span class="hljs-attr">selectPath</span>: <span class="hljs-function">() =&gt;</span> ipcRenderer.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">"select-path"</span>),
  <span class="hljs-attr">runScript</span>: <span class="hljs-function">(<span class="hljs-params">args</span>) =&gt;</span> ipcRenderer.<span class="hljs-title function_">invoke</span>(<span class="hljs-string">"runScript"</span>, args)
});
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">submitForm</span>(<span class="hljs-params"/>) {
  formRef.<span class="hljs-property">value</span>
    .<span class="hljs-title function_">validate</span>()
    .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-comment">// 运行本地脚本</span>
      <span class="hljs-keyword">const</span> args = {
        <span class="hljs-attr">path</span>: modelRef.<span class="hljs-property">value</span>.<span class="hljs-property">path</span>, <span class="hljs-comment">// 参数1，芯片路径</span>
        <span class="hljs-attr">sampleData</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(modelRef.<span class="hljs-property">value</span>.<span class="hljs-property">sampleData</span>) <span class="hljs-comment">// 参数2，样本数据</span>
      };

      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">electronAPI</span>.<span class="hljs-title function_">runScript</span>(args);
        message.<span class="hljs-title function_">success</span>(<span class="hljs-string">"脚本执行成功："</span> + result);
      } <span class="hljs-keyword">catch</span> (err) {
        message.<span class="hljs-title function_">error</span>(<span class="hljs-string">"脚本执行失败："</span> + err);
      }
    })
    .<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {
      message.<span class="hljs-title function_">error</span>(<span class="hljs-string">"请完善样本信息"</span>);
    });
}
</code></pre>
<p>难点在于<code>electron</code>怎么去调用脚本？</p>
<p>这里调用脚本可以有两个选择：<code>exec</code> 和 <code>execfile</code>，这里菜鸟更推荐前面的！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2d3e37e98dc438fb8b231e4c462e1d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=xm%2FZebnKuWrv3hyiB5KvDfqkEF8%3D" alt="image.png" loading="lazy"/></p>
<p>菜鸟一开始用<code>excefile</code>总是报错</p>
<blockquote>
<p>Error occurred in handler for 'runScript': Error: spawn EINVAL</p>
</blockquote>
<p>一直解决不了，然后大佬建议我用<code>exec</code>，结果就可以了，具体原因如下</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62a39f22c9f24d05b5d4d13187d9d50f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=DWVd%2F%2BM8zxMiQqQnIcAU53rnmTY%3D" alt="image.png" loading="lazy"/></p>
<p>正确的写法比较复杂（第二个没试，因为菜鸟已经选用了<code>exce</code>所以就没有换了，所以就没有深究了！）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c936efd9c5ca4e1d9bd67aa3e0b8a96e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=SXbPxUzW0NH3Xc90alDPVHCIqu4%3D" alt="image.png" loading="lazy"/></p>
<p>有兴趣的读者可以自己尝试一下第二种，和<code>exec</code>感觉差不多！</p>
<h3 data-id="heading-13">调用固定位置脚本</h3>
<p>然后这个是菜鸟一开的代码</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { exec } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"child_process"</span>);

<span class="hljs-comment">// 运行脚本</span>
ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScript"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; { 
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"准备运行脚本，传入参数："</span>, data);
    
    <span class="hljs-keyword">const</span> scriptPath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"test.cmd"</span>); 
    
    <span class="hljs-comment">// 拼接命令（自动交由 shell 解析）</span>
    <span class="hljs-keyword">const</span> command = <span class="hljs-string">`"<span class="hljs-subst">${scriptPath}</span>" "<span class="hljs-subst">${data.path}</span>" '<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data.sampleData)}</span>'`</span>; 
    
    <span class="hljs-comment">// 关键：shell 由系统决定 </span>
    <span class="hljs-title function_">exec</span>(command, { <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span> }, <span class="hljs-function">(<span class="hljs-params">error, stdout, stderr</span>) =&gt;</span> { 
      <span class="hljs-keyword">if</span> (error) { 
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"脚本执行失败："</span>, error); 
        <span class="hljs-title function_">reject</span>(stderr || stdout || <span class="hljs-string">"脚本运行异常"</span>); 
        <span class="hljs-keyword">return</span>; 
      } 
      <span class="hljs-title function_">resolve</span>(stdout); 
    }); 
  }); 
});
</code></pre>
<p>菜鸟这里是直接运行的自己写在</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54a789f451024364802109ad5000e12b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=fKbtlTaoa69nnGXClFYEjYvf15M%3D" alt="image.png" loading="lazy"/></p>
<p>下的一个脚本文件，这里脚本可以随便写点什么，能证明调用了就行</p>
<pre><code class="hljs language-cmd" lang="cmd">@echo off
echo 这是一个测试脚本
echo 你传进来的路径是：%1
echo 你传进来的样本数据是：%2
</code></pre>
<h3 data-id="heading-14">根据配置运行脚本</h3>
<p>但是菜鸟一想，这脚本还要我们公司的其他部门给我，然后还要一起打包进去，那这不就很奇怪，应该是根据配置文件，去某个文件夹下寻找脚本，并运行才对！</p>
<p>所以菜鸟建了一个配置文件 <code>config.json</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac710fa6d14b4400a92b52e3dc2860bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=%2F3ml37L%2Fsju9DR%2FOnA6rZURPi%2Bw%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scriptDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"F:\\myPro"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"test.cmd"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>如何把配置文件移动到你需要的地方（菜鸟这里是存在了用户目录下），代码呈现</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);

<span class="hljs-comment">// 保存配置</span>
<span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>); 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userDataPath);

<span class="hljs-keyword">const</span> scriptDir = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>); <span class="hljs-comment">// 目标文件夹</span>
<span class="hljs-keyword">const</span> defaultScriptDir = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"scripts"</span>); <span class="hljs-comment">// 源文件夹</span>
<span class="hljs-comment">// 如果目标文件夹不存在，先创建</span>
<span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(scriptDir)) {
  fs.<span class="hljs-title function_">mkdirSync</span>(scriptDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> }); <span class="hljs-comment">// 递归创建目录</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"scripts 文件夹已创建"</span>);
}
<span class="hljs-comment">// 读取默认目录下的文件列表，逐个拷贝</span>
fs.<span class="hljs-title function_">readdirSync</span>(defaultScriptDir).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">file</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> srcFile = path.<span class="hljs-title function_">join</span>(defaultScriptDir, file);
  <span class="hljs-keyword">const</span> destFile = path.<span class="hljs-title function_">join</span>(scriptDir, file);
  <span class="hljs-comment">// 只拷贝文件</span>
  <span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">lstatSync</span>(srcFile).<span class="hljs-title function_">isFile</span>()) {
    fs.<span class="hljs-title function_">copyFileSync</span>(srcFile, destFile);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${file}</span> 已拷贝到 scripts`</span>);
  }
});
</code></pre>
<p>现在要做的就是怎么读取到配置文件了！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/477536c3f63d416da640b230d3b7e224~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=C4uKIzMOGjj5JIhgKcfTHC%2Fyq9w%3D" alt="image.png" loading="lazy"/></p>
<p>运行脚本的时候，去获取配置文件</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 运行脚本 -- 同步</span>
ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScript"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"准备运行脚本，传入参数："</span>, data);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
      <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
      <span class="hljs-comment">// 读取 config.json</span>
      <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"config.json 不存在，请先初始化 scripts 文件夹"</span>);
      }
      <span class="hljs-keyword">const</span> configContent = fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>);
      <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(configContent);
      <span class="hljs-comment">// 获取脚本路径</span>
      <span class="hljs-keyword">const</span> scriptPath = path.<span class="hljs-title function_">join</span>(config.<span class="hljs-property">scriptDir</span>, config.<span class="hljs-property">name</span>);
      <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(scriptPath)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`脚本文件不存在: <span class="hljs-subst">${scriptPath}</span>`</span>);
      }
      <span class="hljs-comment">// 拼接命令（自动交由 shell 解析）</span>
      <span class="hljs-keyword">const</span> command = <span class="hljs-string">`"<span class="hljs-subst">${scriptPath}</span>" "<span class="hljs-subst">${data.path}</span>" '<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data.sampleData)}</span>'`</span>;
      <span class="hljs-comment">// 关键：shell 由系统决定</span>
      <span class="hljs-title function_">exec</span>(command, { <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span> }, <span class="hljs-function">(<span class="hljs-params">error, stdout, stderr</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (error) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"脚本执行失败："</span>, error);
          <span class="hljs-title function_">reject</span>(stderr || stdout || <span class="hljs-string">"脚本运行异常"</span>);
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-title function_">resolve</span>(stdout);
      });
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"脚本运行异常："</span>, err);
      <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
    }
  });
});
</code></pre>
<p>但是又一想，万一别人给的脚本不能及时返回怎么办？</p>
<p>那就只能用一个进程调用一下脚本就行，不用管其是否成功，所以加了一个方法（<strong>加入方法后一定要<code>npm run dev</code>一下项目，不然会报错找不到</strong>）！</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> { spawn } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"child_process"</span>);

<span class="hljs-comment">// 运行脚本 -- 不等待结果</span>
ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScriptNoWait"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"准备运行脚本，传入参数："</span>, data);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
      <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
      <span class="hljs-comment">// 读取 config.json</span>
      <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"config.json 不存在，请先初始化 scripts 文件夹"</span>);
      }
      <span class="hljs-keyword">const</span> configContent = fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>);
      <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(configContent);
      <span class="hljs-comment">// 获取脚本路径</span>
      <span class="hljs-keyword">const</span> scriptPath = path.<span class="hljs-title function_">join</span>(config.<span class="hljs-property">scriptDir</span>, config.<span class="hljs-property">name</span>);
      <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(scriptPath)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`脚本文件不存在: <span class="hljs-subst">${scriptPath}</span>`</span>);
      }

      <span class="hljs-comment">// 参数转换</span>
      <span class="hljs-keyword">const</span> args = [data.<span class="hljs-property">path</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data.<span class="hljs-property">sampleData</span>)];
      <span class="hljs-comment">// spawn 后台执行</span>
      <span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(scriptPath, args, {
        <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 让系统选择 cmd/bash</span>
        <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 让脚本成为独立进程</span>
        <span class="hljs-attr">stdio</span>: <span class="hljs-string">"ignore"</span> <span class="hljs-comment">// 不接收任何输出</span>
      });

      <span class="hljs-comment">// 断开 Electron 与脚本的关系</span>
      child.<span class="hljs-title function_">unref</span>();

      <span class="hljs-comment">// ***关键：不等待脚本执行结果***</span>
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"脚本已成功启动"</span>); <span class="hljs-comment">// 不等待 stdout，也不等待脚本结束</span>
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"脚本运行异常："</span>, err);
      <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
    }
  });
});
</code></pre>
<p>这样，运行脚本的功能也算是完结了！</p>
<h2 data-id="heading-15">把数据存起来并展示到历史记录</h2>
<p>这里菜鸟想到的是，直接存在<code>data.json</code>中</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3397b82c332c43d2b989b4a2388a0d0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=v8HHwws1Bb1eTnvJ9YlM7md3ln4%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">[]
</code></pre>
<p>内容就是一个数组，然后就是读取和存入的逻辑</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 保存数据到data.json</span>
ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"saveRecord"</span>, <span class="hljs-keyword">async</span> (event, record) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(record);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
      <span class="hljs-keyword">const</span> dataPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"data.json"</span>);
      <span class="hljs-comment">// 读取 data.json</span>
      <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(dataPath)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"data.json 不存在，请先初始化 scripts 文件夹"</span>);
      }
      <span class="hljs-keyword">const</span> dataContent = fs.<span class="hljs-title function_">readFileSync</span>(dataPath, <span class="hljs-string">"utf-8"</span>);
      <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(dataContent);
      <span class="hljs-comment">// 追加记录</span>
      data.<span class="hljs-title function_">push</span>(record);
      <span class="hljs-comment">// 写入 data.json</span>
      fs.<span class="hljs-title function_">writeFileSync</span>(dataPath, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"记录已成功保存"</span>);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"保存记录异常："</span>, err);
      <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
    }
  });
});

<span class="hljs-comment">// 读取data.json数据</span>
ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"readRecords"</span>, <span class="hljs-keyword">async</span> (event) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
      <span class="hljs-keyword">const</span> dataPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"data.json"</span>);
      <span class="hljs-comment">// 读取 data.json</span>
      <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(dataPath)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"data.json 不存在，请先初始化 scripts 文件夹"</span>);
      }
      <span class="hljs-keyword">const</span> dataContent = fs.<span class="hljs-title function_">readFileSync</span>(dataPath, <span class="hljs-string">"utf-8"</span>);
      <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(dataContent);
      <span class="hljs-title function_">resolve</span>(data);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"读取记录异常："</span>, err);
      <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
    }
  });
});
</code></pre>
<p>vue 界面的调用就不展示代码了，大致逻辑就是：点击鉴定的时候调用脚本并存入数据，点击历史记录就读取。</p>
<p>和之前写法一样，就不粘贴代码出来了！</p>
<h2 data-id="heading-16">打包</h2>
<p>完成了上面，感觉大功即将大成，但是要想看看有没有用，还是得看打包后的文件能不能再<code>Linux</code>上运行！</p>
<p>但是这个时候执行<code>npm run build</code>只会打包vue项目，并不会变成electron项目！</p>
<p>这里打包想要修改<code>package.json</code></p>
<pre><code class="hljs language-package.json" lang="package.json">{
  "name": "barcodeformedicinal",
  "version": "0.0.0",
  "private": true,
  "main": "ElectronSrc/main.js",
  "engines": {
    "node": "^20.19.0 || &gt;=22.12.0"
  },
  "scripts": {
    "dev": "vite",
    "build:vue": "vite build",
    "build:electron": "electron-builder",
    "build": "npm run build:vue &amp;&amp; npm run build:electron", // 要同时打包两个
    "preview": "vite preview",
    "lint": "eslint . --fix --cache",
    "format": "prettier --write src/"
  },
  // 配置electron打包
  "build": {
    "appId": "com.example.barcodeformedicinal",
    "productName": "中药材条形码鉴定",
    "asar": true,
    "directories": {
      "output": "dist_electron"
    },
    "files": [
      // 把dist和electron一起打包，要package.json是因为需要main
      "dist/**",
      "ElectronSrc/**",
      "package.json"
    ],
    "win": {
      "target": "nsis"
    }
  },
  "dependencies": {
    "pinia": "^3.0.3",
    "vue": "^3.5.22",
    "vue-router": "^4.6.3"
  },
  "devDependencies": {
    ……
  }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e168b7fa8fc24b81b171b6764233e777~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=xxPK0euJXSOOPSnFEbp0BKWURXk%3D" alt="image.png" loading="lazy"/></p>
<p>为什么<code>files</code>里面需要加上<code>package.json</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/054314963cf641698b0cb33bf2689135~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=1Fx4LVeAKPrOGEo7h74AqK%2BILjY%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-17">注意</h3>
<blockquote>
<p>window 打包可能会报错，但点击是可以运行的，菜鸟暂时没有管。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55d5f8d029494c10842b84414525dcda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=1mvEaYagE4q0OmW4eGNLKe4Y8ng%3D" alt="image.png" loading="lazy"/>
菜鸟准备复现，结果又好了，所以建议大家多试试，很可能是和网络有关！</p>
</blockquote>
<h3 data-id="heading-18">打包为Linux可以运行</h3>
<p>打包成Linux运行的，需要加上 <code>-- --linux</code>，不然默认是打包window上的exe！</p>
<pre><code class="hljs language-package.json" lang="package.json">{
  "name": "barcodeformedicinal",
  "version": "0.0.0",
  "private": true,
  "main": "ElectronSrc/main.js",
  "engines": {
    "node": "^20.19.0 || &gt;=22.12.0"
  },
  "scripts": {
    "dev": "vite",
    "build:vue": "vite build",
    "build:electron": "electron-builder",
    "build": "npm run build:vue &amp;&amp; npm run build:electron -- --linux", // 这里加上-- --linux
    "preview": "vite preview",
    "lint": "eslint . --fix --cache",
    "format": "prettier --write src/"
  },
  "build": {
    "appId": "com.example.barcodeformedicinal",
    "productName": "中药材条形码鉴定",
    "asar": true,
    "directories": {
      "output": "dist_electron"
    },
    "files": [
      "dist/**",
      "ElectronSrc/**",
      "package.json"
    ],
    "linux": {
      "target": [
        "AppImage",
        "deb",
        "rpm"
      ],
      "category": "Utility"
    }
  },
  "dependencies": {
    ……
  },
  "devDependencies": {
    ……
  }
}
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05bcc52f1dbf40f5b871beeb78a13923~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=tC%2FQxjpJ9KYLVrwKYMFf3ezMoTo%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd77536226584c30a46c601aecb63d7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267208&amp;x-signature=%2FVqFp3FL9cvFIpRVepmtsQ4whhY%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用开心上架上架 App Store，一次跨平台团队的完整发布流程调度记录]]></title>    <link>https://juejin.cn/post/7578948893762093083</link>    <guid>https://juejin.cn/post/7578948893762093083</guid>    <pubDate>2025-12-02T07:58:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578948893762093083" data-draft-id="7578922565209620507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用开心上架上架 App Store，一次跨平台团队的完整发布流程调度记录"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T07:58:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心就好2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用开心上架上架 App Store，一次跨平台团队的完整发布流程调度记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心就好2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:58:23.000Z" title="Tue Dec 02 2025 07:58:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在跨端团队的日常开发中，“把 App 上架到 App Store”往往听起来像一件固定步骤的任务，但真正执行时，它更像一个需要多角色协作的“小型发布项目”。
特别是当团队成员分布在不同系统——Windows 做前端、macOS 处理设计、Linux 运行 CI、Android 负责测试——工具链与流程必须灵活组合，才能让上架不被某个节点卡住。</p>
<p>这篇文章以项目经理视角，从“流程调度”的角度复盘一次实际的上架过程，其中上传环节采用了“开心上架（Appuploader）”命令行，但整条链路仍是多工具组合的体系。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、发布流程的真实样貌：一项跨部门协作任务，而不是点击一个上传按钮</strong></h2>
<p>项目经理最先面对的困难，其实不是技术，而是<strong>流程不透明</strong>。
不同角色对“上架”有不同理解：</p>
<ul>
<li>开发觉得：能打包就行</li>
<li>运营认为：后台资料填好就行</li>
<li>产品认为：体验没问题就能过</li>
<li>后端认为：接口稳定就 OK</li>
<li>测试认为：流程跑通就是合格</li>
<li>审核团队（苹果）则有一套完全不同的标准</li>
</ul>
<p>作为调度者，必须把这些认知对齐，才能让上架链路顺畅。</p>
<p>因此，上架流程首先要被拆成可控的几个阶段。</p>
<hr/>
<h2 data-id="heading-1"><strong>二、第一阶段：版本冻结与体验校验</strong></h2>
<p>这一阶段通常由产品、测试主导，重点不在代码，而在<strong>确定应用是否准备好接受审核</strong>。</p>
<p>核心检查包括：</p>
<h3 data-id="heading-2"><strong>1. 登录路径可用</strong></h3>
<p>审核账号是否具备最低权限？
登录流程是否依赖短信验证码（审核可能无法收到）？</p>
<h3 data-id="heading-3"><strong>2. 首屏与核心功能必须稳定</strong></h3>
<p>苹果审核网络不稳定，弱网测试必须通过。</p>
<h3 data-id="heading-4"><strong>3. 权限说明必须规范</strong></h3>
<p>Info.plist 权限文案清不清晰，是否与实际用途匹配。</p>
<h3 data-id="heading-5"><strong>4. 网页内容（uni-app/H5）必须具备原生结构感</strong></h3>
<p>避免被判定为“简单网页容器”。</p>
<p>这一阶段目标是确保不会在 2.1 或 5.1.1 阶段卡住。</p>
<hr/>
<h2 data-id="heading-6"><strong>三、第二阶段：构建与签名——工具链不重要，一致性最重要</strong></h2>
<p>这部分通常由前端研发或 CI 负责人处理。
构建来源可能是：</p>
<ul>
<li>HBuilderX 云打包</li>
<li>本地 Xcode Archive</li>
<li>或者 CI 上的自动构建</li>
</ul>
<p>关键在于一致性：</p>
<ul>
<li>使用同一套 p12</li>
<li>使用同一份描述文件</li>
<li>不要在不同机器生成新证书</li>
<li>构建环境尽量保持固定</li>
</ul>
<p>任何“环境漂移”都会导致签名无法验证，从而在上传阶段直接报错。
可以使用开心上架生成证书导出统一管理：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/780bde39fd2843f7aa7d70e683b0dd6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267103&amp;x-signature=Fc1pIHET%2FKcp2yCMcTt9ufOnDb8%3D" alt="证书生成" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-7"><strong>四、第三阶段：IPA 上传——多工具组合下的“分工协作”</strong></h2>
<p>真实团队使用的上传方式往往不是单一的，而是根据情况分工：</p>
<hr/>
<h3 data-id="heading-8"><strong>1. GUI 上传（适合运营 / 产品复核）</strong></h3>
<p><strong>使用 Transporter 或 Xcode Organizer</strong></p>
<p>特点：</p>
<ul>
<li>清晰直观</li>
<li>适合人工检查构建是否正确</li>
<li>适用于临时版本上传</li>
</ul>
<p>局限：
必须是 macOS。</p>
<hr/>
<h3 data-id="heading-9"><strong>2. 开心上架（Appuploader）命令行上传（Windows / Linux 环境必需）</strong></h3>
<p>跨平台团队常用命令行上传方式进行自动化，示例：</p>
<pre><code class="hljs language-arduino" lang="arduino">appuploader_cli \
  -u team@icloud.com \
  -p xxx-xxx-xxx-xxx \
  -c <span class="hljs-number">2</span> \
  -f ./dist/release.ipa
</code></pre>
<p>在实际项目中，这类工具通常承担：</p>
<ul>
<li>CI 自动上传</li>
<li>Windows 研发环境上传</li>
<li>Linux 构建机上传</li>
<li>高频 TF 测试版本上传</li>
</ul>
<p>它解决的是**“上传必须 Mac”这一限制**，让流程始终保持可执行性。</p>
<p>图形化界面：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/930cbc9733d44c379cc1a510f6ae2a83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267103&amp;x-signature=PLhOW4Xnu0%2FMEE2z5i2MZksPAQ0%3D" alt="ipa上传" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-10"><strong>3. 混合模式执行（最常见）</strong></h3>
<p>实际协作流程通常是：</p>
<pre><code class="hljs">CI 构建好 IPA →  
研发用命令行上传到 TestFlight →  
运营使用 Transporter 复核正式版 →  
最终由产品提交审核
</code></pre>
<p>不同角色做擅长的事情，这样最有效率。</p>
<hr/>
<h2 data-id="heading-11"><strong>五、第四阶段：App Store Connect 配置是审核能否一次通过的关键</strong></h2>
<p>许多团队误以为“上传成功 = 快审核了”，但实际上审核速度主要取决于后台资料填写是否规范。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8299c470221a421aba9952f4b8a4d3d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765267103&amp;x-signature=Ai%2BPIJIZFapTUjV1B1Ewx1uB6zg%3D" alt="asc" loading="lazy"/></p>
<p>关键内容包括：</p>
<h3 data-id="heading-12"><strong>1. 截图</strong></h3>
<p>必须真实反映应用界面，避免过度设计。</p>
<h3 data-id="heading-13"><strong>2. 隐私标签（Data Collection）</strong></h3>
<p>严格如实填写，尤其要注意第三方 SDK 的数据采集。</p>
<h3 data-id="heading-14"><strong>3. 审核说明</strong></h3>
<p>清晰告诉审核员：</p>
<ul>
<li>如何进入核心功能</li>
<li>审核账号是什么</li>
<li>若应用依赖特定服务器，需要提醒</li>
</ul>
<h3 data-id="heading-15"><strong>4. 应用简介与关键词</strong></h3>
<p>必须与应用内容一致。</p>
<p>这部分往往由运营负责，但会影响最终能否顺利通过审核。</p>
<hr/>
<h2 data-id="heading-16"><strong>六、第五阶段：审核处理——不是“等消息”，而是“准备应对方案”</strong></h2>
<p>在项目复盘中，团队总结了两个经验：</p>
<h3 data-id="heading-17"><strong>1. 第一次提审尽量准备充分</strong></h3>
<ul>
<li>权限说明写完整</li>
<li>审核说明写清晰</li>
<li>截图保持与应用一致</li>
</ul>
<p>第一次被拒会让审核排队更久。</p>
<hr/>
<h3 data-id="heading-18"><strong>2. 拒审不要只修一个点</strong></h3>
<p>例如苹果反馈：</p>
<ul>
<li>登录不可用</li>
<li>或内容与截图不符</li>
<li>或隐私声明不清晰</li>
</ul>
<p>不要只处理其中一条，因为审核可能基于多条合规项。</p>
<p>团队通常采用的策略：</p>
<pre><code class="hljs">补齐所有可能相关的问题 → 一次性重新提交
</code></pre>
<p>这样避免反复拒审。</p>
<hr/>
<h2 data-id="heading-19"><strong>七、工具在上架流程中的位置：不是主角，而是“流程执行器”</strong></h2>
<p>这次复盘最重要的结论其实很朴素：</p>
<blockquote>
<p>工具不决定上架成功，流程决定。</p>
</blockquote>
<p>工具只是这一链路中的“执行节点”：</p>





























<table><thead><tr><th>环节</th><th>常见工具</th></tr></thead><tbody><tr><td>构建</td><td>HBuilderX、Xcode、云构建</td></tr><tr><td>签名</td><td>证书管理工具、CI 注入</td></tr><tr><td>上传</td><td>开心上架 CLI、Transporter、Organizer</td></tr><tr><td>审核</td><td>App Store Connect Web</td></tr><tr><td>协作</td><td>项目管理工具、版本控制</td></tr></tbody></table>
<p>工具互相补位，而不是互相替代。</p>
<hr/>
<h2 data-id="heading-20"><strong>上架是一条“团队级”的合作，而不是某个人的任务</strong></h2>
<p>经过这次上线，团队对 App Store 上架的理解更深了一层：</p>
<ul>
<li>开发负责构建与签名稳定性</li>
<li>测试负责体验稳定性</li>
<li>运营负责后台资料</li>
<li>产品负责审核策略</li>
<li>后端负责接口保障</li>
<li>上传工具负责把构建传上去</li>
<li>审核是苹果判断你是否准备好上线的最后一步</li>
</ul>
<p>上架并不难，难的是让流程稳定、让角色清晰、让信息同步。
参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.appuploader.net%2Ftutorial%2Fzh%2F1%2F1.html" target="_blank" title="https://www.appuploader.net/tutorial/zh/1/1.html" ref="nofollow noopener noreferrer">www.appuploader.net/tutorial/zh…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 静态变量（Static Variables）指南]]></title>    <link>https://juejin.cn/post/7578892205290389544</link>    <guid>https://juejin.cn/post/7578892205290389544</guid>    <pubDate>2025-12-02T07:54:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578892205290389544" data-draft-id="7578901433970802688" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 静态变量（Static Variables）指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T07:54:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小周在成长"/> <meta itemprop="url" content="https://juejin.cn/user/3632442150752573"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 静态变量（Static Variables）指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3632442150752573/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小周在成长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:54:20.000Z" title="Tue Dec 02 2025 07:54:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">📖 静态变量基本概念</h2>
<h3 data-id="heading-1"><strong>什么是静态变量？</strong></h3>
<ul>
<li>使用 <code>static</code> 关键字修饰的成员变量</li>
<li>属于<strong>类本身</strong>，而不是类的某个实例</li>
<li>所有对象<strong>共享</strong>同一个静态变量</li>
<li>在类加载时初始化，生命周期与类相同</li>
</ul>
<h2 data-id="heading-2">🎯 静态变量的特点</h2>
<h3 data-id="heading-3"><strong>1. 类级别共享</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticVariableDemo</span> {
    <span class="hljs-comment">// 实例变量 - 每个对象独立拥有</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">instanceVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 静态变量 - 所有对象共享</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">staticVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        instanceVar++;   <span class="hljs-comment">// 修改实例变量</span>
        staticVar++;     <span class="hljs-comment">// 修改静态变量</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">show</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"instanceVar = "</span> + instanceVar + <span class="hljs-string">", staticVar = "</span> + staticVar);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">StaticVariableDemo</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StaticVariableDemo</span>();
        <span class="hljs-type">StaticVariableDemo</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StaticVariableDemo</span>();
        
        obj1.increment();
        obj1.show();  <span class="hljs-comment">// 输出: instanceVar = 1, staticVar = 1</span>
        
        obj2.increment();
        obj2.show();  <span class="hljs-comment">// 输出: instanceVar = 1, staticVar = 2</span>
        
        <span class="hljs-comment">// 静态变量可以通过类名直接访问</span>
        System.out.println(<span class="hljs-string">"通过类名访问: "</span> + StaticVariableDemo.staticVar);  <span class="hljs-comment">// 输出: 2</span>
        
        <span class="hljs-comment">// 也可以通过对象访问（不推荐）</span>
        System.out.println(<span class="hljs-string">"通过对象访问: "</span> + obj1.staticVar);  <span class="hljs-comment">// 输出: 2</span>
    }
}
</code></pre>
<h3 data-id="heading-4"><strong>2. 内存分配时机</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryAllocation</span> {
    <span class="hljs-comment">// 静态变量在类加载时初始化</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">staticField</span> <span class="hljs-operator">=</span> <span class="hljs-string">"静态变量（类加载时初始化）"</span>;
    
    <span class="hljs-comment">// 实例变量在对象创建时初始化</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">instanceField</span> <span class="hljs-operator">=</span> <span class="hljs-string">"实例变量（对象创建时初始化）"</span>;
    
    <span class="hljs-comment">// 静态代码块（类加载时执行）</span>
    <span class="hljs-keyword">static</span> {
        System.out.println(<span class="hljs-string">"1. 静态代码块执行"</span>);
        System.out.println(<span class="hljs-string">"   静态变量值: "</span> + staticField);
    }
    
    <span class="hljs-comment">// 实例代码块（对象创建时执行）</span>
    {
        System.out.println(<span class="hljs-string">"3. 实例代码块执行"</span>);
        System.out.println(<span class="hljs-string">"   实例变量值: "</span> + instanceField);
    }
    
    <span class="hljs-comment">// 构造器（对象创建时执行）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MemoryAllocation</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"4. 构造器执行"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"2. main方法开始"</span>);
        
        System.out.println(<span class="hljs-string">"\n=== 创建第一个对象 ==="</span>);
        <span class="hljs-type">MemoryAllocation</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MemoryAllocation</span>();
        
        System.out.println(<span class="hljs-string">"\n=== 创建第二个对象 ==="</span>);
        <span class="hljs-type">MemoryAllocation</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MemoryAllocation</span>();
        
        <span class="hljs-comment">/*
        输出顺序:
        1. 静态代码块执行（只执行一次）
           静态变量值: 静态变量（类加载时初始化）
        2. main方法开始
        
        === 创建第一个对象 ===
        3. 实例代码块执行
           实例变量值: 实例变量（对象创建时初始化）
        4. 构造器执行
        
        === 创建第二个对象 ===
        3. 实例代码块执行
           实例变量值: 实例变量（对象创建时初始化）
        4. 构造器执行
        */</span>
    }
}
</code></pre>
<h2 data-id="heading-5">🏗️ 静态变量的声明和使用</h2>
<h3 data-id="heading-6"><strong>1. 基本语法</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticSyntax</span> {
    <span class="hljs-comment">// 声明静态变量</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> count;           <span class="hljs-comment">// 默认值 0</span>
    <span class="hljs-keyword">static</span> String name;         <span class="hljs-comment">// 默认值 null</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> flag;        <span class="hljs-comment">// 默认值 false</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> price;        <span class="hljs-comment">// 默认值 0.0</span>
    
    <span class="hljs-comment">// 声明并初始化</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">PI</span> <span class="hljs-operator">=</span> <span class="hljs-number">3.14159</span>;  <span class="hljs-comment">// 静态常量</span>
    
    <span class="hljs-comment">// 静态代码块初始化</span>
    <span class="hljs-keyword">static</span> {
        System.out.println(<span class="hljs-string">"静态代码块执行"</span>);
        count = <span class="hljs-number">10</span>;
        name = <span class="hljs-string">"Java"</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 访问静态变量（推荐通过类名）</span>
        System.out.println(<span class="hljs-string">"count = "</span> + StaticSyntax.count);
        System.out.println(<span class="hljs-string">"name = "</span> + StaticSyntax.name);
        System.out.println(<span class="hljs-string">"total = "</span> + StaticSyntax.total);
        System.out.println(<span class="hljs-string">"PI = "</span> + StaticSyntax.PI);
        
        <span class="hljs-comment">// 修改静态变量</span>
        StaticSyntax.total = <span class="hljs-number">200</span>;
        System.out.println(<span class="hljs-string">"修改后 total = "</span> + StaticSyntax.total);
        
        <span class="hljs-comment">// 静态常量不能修改</span>
        <span class="hljs-comment">// StaticSyntax.PI = 3.14;  // ❌ 编译错误</span>
    }
}
</code></pre>
<h3 data-id="heading-7"><strong>2. 静态变量的访问方式</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccessWays</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello, Static!"</span>;
    <span class="hljs-type">String</span> <span class="hljs-variable">instanceMsg</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello, Instance!"</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ✅ 正确方式1：通过类名访问（推荐）</span>
        System.out.println(<span class="hljs-string">"类名访问: "</span> + AccessWays.message);
        
        <span class="hljs-comment">// ✅ 正确方式2：在静态方法中直接访问（同一类内）</span>
        System.out.println(<span class="hljs-string">"直接访问: "</span> + message);
        
        <span class="hljs-comment">// ✅ 正确方式3：通过对象访问（不推荐，会产生误导）</span>
        <span class="hljs-type">AccessWays</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AccessWays</span>();
        System.out.println(<span class="hljs-string">"对象访问: "</span> + obj.message);  <span class="hljs-comment">// 可以但不推荐</span>
        
        <span class="hljs-comment">// ❌ 错误：静态方法中不能直接访问实例变量</span>
        <span class="hljs-comment">// System.out.println(instanceMsg);  // 编译错误</span>
        
        <span class="hljs-comment">// ✅ 正确：需要先创建对象</span>
        System.out.println(<span class="hljs-string">"实例变量: "</span> + obj.instanceMsg);
        
        <span class="hljs-comment">// 访问其他类的静态变量</span>
        System.out.println(<span class="hljs-string">"\n访问其他类的静态变量:"</span>);
        System.out.println(<span class="hljs-string">"Integer最大值: "</span> + Integer.MAX_VALUE);
        System.out.println(<span class="hljs-string">"Math的PI: "</span> + Math.PI);
    }
}

<span class="hljs-comment">// 另一个类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnotherClass</span> {
    <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-string">"来自另一个类的静态变量"</span>;
}
</code></pre>
<h2 data-id="heading-8">🔧 静态变量的应用场景</h2>
<h3 data-id="heading-9"><strong>1. 计数器/ID生成器</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-comment">// 静态变量作为计数器</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 实例变量：每个对象的唯一ID</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> id;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Counter</span><span class="hljs-params">()</span> {
        count++;            <span class="hljs-comment">// 每次创建对象计数器加1</span>
        id = count;         <span class="hljs-comment">// 为对象分配唯一ID</span>
        System.out.println(<span class="hljs-string">"创建第 "</span> + id + <span class="hljs-string">" 个对象"</span>);
    }
    
    <span class="hljs-comment">// 获取当前对象数量</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> count;
    }
    
    <span class="hljs-comment">// 获取对象ID</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"初始对象数: "</span> + Counter.getCount());
        
        <span class="hljs-type">Counter</span> <span class="hljs-variable">c1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
        <span class="hljs-type">Counter</span> <span class="hljs-variable">c2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
        <span class="hljs-type">Counter</span> <span class="hljs-variable">c3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Counter</span>();
        
        System.out.println(<span class="hljs-string">"\n对象信息:"</span>);
        System.out.println(<span class="hljs-string">"c1 ID: "</span> + c1.getId());
        System.out.println(<span class="hljs-string">"c2 ID: "</span> + c2.getId());
        System.out.println(<span class="hljs-string">"c3 ID: "</span> + c3.getId());
        System.out.println(<span class="hljs-string">"总对象数: "</span> + Counter.getCount());
    }
}
</code></pre>
<h3 data-id="heading-10"><strong>2. 配置信息/全局常量</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> {
    <span class="hljs-comment">// 全局配置信息（静态常量）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">APP_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"MyApplication"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">VERSION</span> <span class="hljs-operator">=</span> <span class="hljs-string">"1.0.0"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_USERS</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">TAX_RATE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.13</span>;
    
    <span class="hljs-comment">// 运行时配置（静态变量）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">language</span> <span class="hljs-operator">=</span> <span class="hljs-string">"zh-CN"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">debugMode</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">connectionTimeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">30000</span>;
    
    <span class="hljs-comment">// 提供静态方法访问和修改配置</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getLanguage</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> language;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setLanguage</span><span class="hljs-params">(String lang)</span> {
        language = lang;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDebugMode</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> debugMode;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDebugMode</span><span class="hljs-params">(<span class="hljs-type">boolean</span> debug)</span> {
        debugMode = debug;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getConnectionTimeout</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> connectionTimeout;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setConnectionTimeout</span><span class="hljs-params">(<span class="hljs-type">int</span> timeout)</span> {
        <span class="hljs-keyword">if</span> (timeout &gt; <span class="hljs-number">0</span>) {
            connectionTimeout = timeout;
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printConfig</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"=== 应用配置 ==="</span>);
        System.out.println(<span class="hljs-string">"应用名称: "</span> + APP_NAME);
        System.out.println(<span class="hljs-string">"版本: "</span> + VERSION);
        System.out.println(<span class="hljs-string">"语言: "</span> + language);
        System.out.println(<span class="hljs-string">"调试模式: "</span> + debugMode);
        System.out.println(<span class="hljs-string">"连接超时: "</span> + connectionTimeout + <span class="hljs-string">"ms"</span>);
        System.out.println(<span class="hljs-string">"最大用户数: "</span> + MAX_USERS);
        System.out.println(<span class="hljs-string">"税率: "</span> + TAX_RATE);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 使用全局配置</span>
        AppConfig.printConfig();
        
        <span class="hljs-comment">// 修改运行时配置</span>
        AppConfig.setDebugMode(<span class="hljs-literal">true</span>);
        AppConfig.setLanguage(<span class="hljs-string">"en-US"</span>);
        
        System.out.println(<span class="hljs-string">"\n=== 修改后配置 ==="</span>);
        AppConfig.printConfig();
        
        <span class="hljs-comment">// 在其他类中使用配置</span>
        System.out.println(<span class="hljs-string">"\n在业务代码中使用:"</span>);
        <span class="hljs-type">double</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-number">100.0</span>;
        <span class="hljs-type">double</span> <span class="hljs-variable">tax</span> <span class="hljs-operator">=</span> price * AppConfig.TAX_RATE;
        System.out.println(<span class="hljs-string">"商品价格: $"</span> + price);
        System.out.println(<span class="hljs-string">"税费: $"</span> + tax);
        System.out.println(<span class="hljs-string">"总价: $"</span> + (price + tax));
    }
}
</code></pre>
<h3 data-id="heading-11"><strong>3. 缓存数据</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataCache</span> {
    <span class="hljs-comment">// 静态Map作为缓存</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-comment">// 缓存过期时间（毫秒）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, Long&gt; expireTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">DEFAULT_EXPIRE</span> <span class="hljs-operator">=</span> <span class="hljs-number">60000</span>; <span class="hljs-comment">// 默认1分钟</span>
    
    <span class="hljs-comment">/**
     * 存入缓存
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, Object value)</span> {
        put(key, value, DEFAULT_EXPIRE);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, Object value, <span class="hljs-type">long</span> expireMillis)</span> {
        cache.put(key, value);
        expireTime.put(key, System.currentTimeMillis() + expireMillis);
        System.out.println(<span class="hljs-string">"缓存已存入: "</span> + key + <span class="hljs-string">" = "</span> + value);
    }
    
    <span class="hljs-comment">/**
     * 获取缓存
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">if</span> (!cache.containsKey(key)) {
            System.out.println(<span class="hljs-string">"缓存未命中: "</span> + key);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        <span class="hljs-comment">// 检查是否过期</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-keyword">if</span> (now &gt; expireTime.get(key)) {
            System.out.println(<span class="hljs-string">"缓存已过期: "</span> + key);
            cache.remove(key);
            expireTime.remove(key);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        
        System.out.println(<span class="hljs-string">"缓存命中: "</span> + key);
        <span class="hljs-keyword">return</span> cache.get(key);
    }
    
    <span class="hljs-comment">/**
     * 清理过期缓存
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanExpired</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">for</span> (String key : <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(expireTime).keySet()) {
            <span class="hljs-keyword">if</span> (now &gt; expireTime.get(key)) {
                cache.remove(key);
                expireTime.remove(key);
                count++;
            }
        }
        
        System.out.println(<span class="hljs-string">"清理了 "</span> + count + <span class="hljs-string">" 个过期缓存"</span>);
    }
    
    <span class="hljs-comment">/**
     * 清空所有缓存
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        cache.clear();
        expireTime.clear();
        System.out.println(<span class="hljs-string">"缓存已清空"</span>);
    }
    
    <span class="hljs-comment">/**
     * 获取缓存统计信息
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showStats</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"\n=== 缓存统计 ==="</span>);
        System.out.println(<span class="hljs-string">"缓存数量: "</span> + cache.size());
        System.out.println(<span class="hljs-string">"缓存内容:"</span>);
        <span class="hljs-keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : cache.entrySet()) {
            System.out.println(<span class="hljs-string">"  "</span> + entry.getKey() + <span class="hljs-string">": "</span> + entry.getValue());
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-comment">// 测试缓存功能</span>
        DataCache.put(<span class="hljs-string">"user:1"</span>, <span class="hljs-string">"张三"</span>);
        DataCache.put(<span class="hljs-string">"product:100"</span>, <span class="hljs-string">"iPhone"</span>, <span class="hljs-number">5000</span>);  <span class="hljs-comment">// 5秒过期</span>
        
        <span class="hljs-comment">// 立即获取</span>
        System.out.println(<span class="hljs-string">"\n获取缓存:"</span>);
        System.out.println(<span class="hljs-string">"user:1 = "</span> + DataCache.get(<span class="hljs-string">"user:1"</span>));
        System.out.println(<span class="hljs-string">"product:100 = "</span> + DataCache.get(<span class="hljs-string">"product:100"</span>));
        
        <span class="hljs-comment">// 等待6秒后再次获取</span>
        System.out.println(<span class="hljs-string">"\n等待6秒后..."</span>);
        Thread.sleep(<span class="hljs-number">6000</span>);
        
        System.out.println(<span class="hljs-string">"user:1 = "</span> + DataCache.get(<span class="hljs-string">"user:1"</span>));
        System.out.println(<span class="hljs-string">"product:100 = "</span> + DataCache.get(<span class="hljs-string">"product:100"</span>));  <span class="hljs-comment">// 应已过期</span>
        
        <span class="hljs-comment">// 清理过期缓存</span>
        DataCache.cleanExpired();
        DataCache.showStats();
    }
}
</code></pre>
<h2 data-id="heading-12">⚠️ 静态变量的注意事项</h2>
<h3 data-id="heading-13"><strong>1. 线程安全问题</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafety</span> {
    <span class="hljs-comment">// 非线程安全的静态变量</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 线程安全的递增方法（使用synchronized）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">safeIncrement</span><span class="hljs-params">()</span> {
        counter++;
    }
    
    <span class="hljs-comment">// 非线程安全的递增方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unsafeIncrement</span><span class="hljs-params">()</span> {
        counter++;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-comment">// 创建10个线程，每个线程递增1000次</span>
        Thread[] threads = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>[<span class="hljs-number">10</span>];
        
        <span class="hljs-comment">// 测试非线程安全的方法</span>
        counter = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 重置计数器</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            threads[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) {
                    unsafeIncrement();  <span class="hljs-comment">// 非线程安全</span>
                }
            });
            threads[i].start();
        }
        
        <span class="hljs-comment">// 等待所有线程完成</span>
        <span class="hljs-keyword">for</span> (Thread t : threads) {
            t.join();
        }
        
        System.out.println(<span class="hljs-string">"非线程安全结果: "</span> + counter + <span class="hljs-string">" (期望: 10000)"</span>);
        
        <span class="hljs-comment">// 测试线程安全的方法</span>
        counter = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 重置计数器</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            threads[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) {
                    safeIncrement();  <span class="hljs-comment">// 线程安全</span>
                }
            });
            threads[i].start();
        }
        
        <span class="hljs-keyword">for</span> (Thread t : threads) {
            t.join();
        }
        
        System.out.println(<span class="hljs-string">"线程安全结果: "</span> + counter + <span class="hljs-string">" (期望: 10000)"</span>);
        
        <span class="hljs-comment">// 更好的线程安全方案：使用AtomicInteger</span>
        java.util.concurrent.atomic.<span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">atomicCounter</span> <span class="hljs-operator">=</span> 
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.concurrent.atomic.AtomicInteger(<span class="hljs-number">0</span>);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            threads[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) {
                    atomicCounter.incrementAndGet();
                }
            });
            threads[i].start();
        }
        
        <span class="hljs-keyword">for</span> (Thread t : threads) {
            t.join();
        }
        
        System.out.println(<span class="hljs-string">"AtomicInteger结果: "</span> + atomicCounter.get() + <span class="hljs-string">" (期望: 10000)"</span>);
    }
}
</code></pre>
<h3 data-id="heading-14"><strong>2. 静态变量与继承</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-comment">// 父类静态变量</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">staticField</span> <span class="hljs-operator">=</span> <span class="hljs-string">"父类静态变量"</span>;
    
    <span class="hljs-comment">// 父类实例变量</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">instanceField</span> <span class="hljs-operator">=</span> <span class="hljs-string">"父类实例变量"</span>;
    
    <span class="hljs-comment">// 静态方法</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">staticMethod</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"父类静态方法"</span>);
    }
    
    <span class="hljs-comment">// 实例方法</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">instanceMethod</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"父类实例方法"</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-comment">// 子类静态变量（隐藏父类同名静态变量）</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">staticField</span> <span class="hljs-operator">=</span> <span class="hljs-string">"子类静态变量"</span>;
    
    <span class="hljs-comment">// 子类实例变量（隐藏父类同名实例变量）</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">instanceField</span> <span class="hljs-operator">=</span> <span class="hljs-string">"子类实例变量"</span>;
    
    <span class="hljs-comment">// 静态方法（隐藏父类同名静态方法）</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">staticMethod</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"子类静态方法"</span>);
    }
    
    <span class="hljs-comment">// 实例方法（重写父类实例方法）</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">instanceMethod</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"子类实例方法"</span>);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticInheritance</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"=== 静态成员 ==="</span>);
        
        <span class="hljs-comment">// 静态成员属于类，通过类名访问</span>
        System.out.println(<span class="hljs-string">"Parent.staticField: "</span> + Parent.staticField);
        System.out.println(<span class="hljs-string">"Child.staticField: "</span> + Child.staticField);
        
        Parent.staticMethod();
        Child.staticMethod();
        
        System.out.println(<span class="hljs-string">"\n=== 实例成员 ==="</span>);
        
        <span class="hljs-type">Parent</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Parent</span>();
        <span class="hljs-type">Child</span> <span class="hljs-variable">child</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>();
        <span class="hljs-type">Parent</span> <span class="hljs-variable">polymorphic</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>();  <span class="hljs-comment">// 多态</span>
        
        System.out.println(<span class="hljs-string">"parent.instanceField: "</span> + parent.instanceField);
        System.out.println(<span class="hljs-string">"child.instanceField: "</span> + child.instanceField);
        System.out.println(<span class="hljs-string">"polymorphic.instanceField: "</span> + polymorphic.instanceField);  <span class="hljs-comment">// 访问父类的</span>
        
        parent.instanceMethod();
        child.instanceMethod();
        polymorphic.instanceMethod();  <span class="hljs-comment">// 多态：调用子类重写的方法</span>
        
        System.out.println(<span class="hljs-string">"\n=== 通过子类访问父类静态成员 ==="</span>);
        <span class="hljs-comment">// 可以通过子类类名访问父类静态成员，但不推荐</span>
        System.out.println(<span class="hljs-string">"通过子类访问: "</span> + Child.staticField);  <span class="hljs-comment">// 子类的</span>
        
        <span class="hljs-comment">// 强制访问父类静态成员</span>
        System.out.println(<span class="hljs-string">"强制访问父类: "</span> + ((Parent)<span class="hljs-literal">null</span>).staticField);  <span class="hljs-comment">// 父类的</span>
        
        <span class="hljs-comment">// 总结：</span>
        <span class="hljs-comment">// 1. 静态成员不存在重写（Override），只有隐藏（Hide）</span>
        <span class="hljs-comment">// 2. 静态成员通过类名访问，编译时确定</span>
        <span class="hljs-comment">// 3. 实例成员通过对象访问，运行时确定（多态）</span>
    }
}
</code></pre>
<h3 data-id="heading-15"><strong>3. 静态变量的初始化顺序</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InitializationOrder</span> {
    <span class="hljs-comment">// 静态变量（按顺序初始化）</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> init(<span class="hljs-string">"静态变量 a"</span>);
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> init(<span class="hljs-string">"静态变量 b"</span>);
    
    <span class="hljs-comment">// 静态代码块（按顺序执行）</span>
    <span class="hljs-keyword">static</span> {
        System.out.println(<span class="hljs-string">"静态代码块 1"</span>);
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> init(<span class="hljs-string">"静态变量 c"</span>);
    
    <span class="hljs-keyword">static</span> {
        System.out.println(<span class="hljs-string">"静态代码块 2"</span>);
    }
    
    <span class="hljs-comment">// 实例变量</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> init(<span class="hljs-string">"实例变量 x"</span>);
    
    <span class="hljs-comment">// 实例代码块</span>
    {
        System.out.println(<span class="hljs-string">"实例代码块"</span>);
    }
    
    <span class="hljs-comment">// 构造器</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InitializationOrder</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"构造器执行"</span>);
    }
    
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> init(<span class="hljs-string">"静态变量 d"</span>);
    
    <span class="hljs-comment">// 初始化方法</span>
    <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">init</span><span class="hljs-params">(String message)</span> {
        System.out.println(<span class="hljs-string">"初始化: "</span> + message);
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"\n=== main方法开始 ==="</span>);
        System.out.println(<span class="hljs-string">"\n=== 第一次创建对象 ==="</span>);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitializationOrder</span>();
        
        System.out.println(<span class="hljs-string">"\n=== 第二次创建对象 ==="</span>);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitializationOrder</span>();
        
        <span class="hljs-comment">/*
        输出顺序：
        初始化: 静态变量 a
        初始化: 静态变量 b
        静态代码块 1
        初始化: 静态变量 c
        静态代码块 2
        初始化: 静态变量 d
        
        === main方法开始 ===
        
        === 第一次创建对象 ===
        初始化: 实例变量 x
        实例代码块
        构造器执行
        
        === 第二次创建对象 ===
        初始化: 实例变量 x
        实例代码块
        构造器执行
        */</span>
    }
}
</code></pre>
<h2 data-id="heading-16">💡 静态变量最佳实践</h2>
<h3 data-id="heading-17"><strong>1. 单例模式（Singleton）</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> {
    <span class="hljs-comment">// 1. 私有静态变量（唯一实例）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Singleton instance;
    
    <span class="hljs-comment">// 2. 私有构造器（防止外部创建实例）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Singleton</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Singleton实例被创建"</span>);
    }
    
    <span class="hljs-comment">// 3. 公共静态方法（全局访问点）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();  <span class="hljs-comment">// 懒加载</span>
        }
        <span class="hljs-keyword">return</span> instance;
    }
    
    <span class="hljs-comment">// 4. 线程安全版本（双重检查锁定）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstanceThreadSafe</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// 第一次检查</span>
            <span class="hljs-keyword">synchronized</span> (Singleton.class) {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {  <span class="hljs-comment">// 第二次检查</span>
                    instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();
                }
            }
        }
        <span class="hljs-keyword">return</span> instance;
    }
    
    <span class="hljs-comment">// 5. 静态内部类版本（推荐）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonHolder</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Singleton</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Singleton</span>();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton <span class="hljs-title function_">getInstanceByHolder</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> SingletonHolder.INSTANCE;
    }
    
    <span class="hljs-comment">// 实例方法</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showMessage</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"Hello Singleton!"</span>);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">Singleton</span> <span class="hljs-variable">s1</span> <span class="hljs-operator">=</span> Singleton.getInstance();
        <span class="hljs-type">Singleton</span> <span class="hljs-variable">s2</span> <span class="hljs-operator">=</span> Singleton.getInstance();
        
        System.out.println(<span class="hljs-string">"s1 == s2? "</span> + (s1 == s2));  <span class="hljs-comment">// true</span>
        s1.showMessage();
    }
}
</code></pre>
<h3 data-id="heading-18"><strong>2. 工具类（Utility Class）</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 工具类通常设计为final，包含静态方法，私有构造器防止实例化</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringUtils</span> {
    
    <span class="hljs-comment">// 私有构造器，防止实例化</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">StringUtils</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AssertionError</span>(<span class="hljs-string">"不能实例化工具类"</span>);
    }
    
    <span class="hljs-comment">// 静态工具方法</span>
    
    <span class="hljs-comment">/**
     * 检查字符串是否为空或空白
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isBlank</span><span class="hljs-params">(String str)</span> {
        <span class="hljs-keyword">return</span> str == <span class="hljs-literal">null</span> || str.trim().isEmpty();
    }
    
    <span class="hljs-comment">/**
     * 检查字符串是否不为空
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isNotBlank</span><span class="hljs-params">(String str)</span> {
        <span class="hljs-keyword">return</span> !isBlank(str);
    }
    
    <span class="hljs-comment">/**
     * 首字母大写
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">capitalize</span><span class="hljs-params">(String str)</span> {
        <span class="hljs-keyword">if</span> (isBlank(str)) {
            <span class="hljs-keyword">return</span> str;
        }
        <span class="hljs-keyword">return</span> str.substring(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>).toUpperCase() + str.substring(<span class="hljs-number">1</span>);
    }
    
    <span class="hljs-comment">/**
     * 重复字符串
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">repeat</span><span class="hljs-params">(String str, <span class="hljs-type">int</span> times)</span> {
        <span class="hljs-keyword">if</span> (str == <span class="hljs-literal">null</span> || times &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; times; i++) {
            sb.append(str);
        }
        <span class="hljs-keyword">return</span> sb.toString();
    }
    
    <span class="hljs-comment">/**
     * 反转字符串
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">reverse</span><span class="hljs-params">(String str)</span> {
        <span class="hljs-keyword">if</span> (str == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(str).reverse().toString();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 使用工具类的静态方法</span>
        System.out.println(<span class="hljs-string">"isBlank测试:"</span>);
        System.out.println(<span class="hljs-string">"  null: "</span> + StringUtils.isBlank(<span class="hljs-literal">null</span>));
        System.out.println(<span class="hljs-string">"  '': "</span> + StringUtils.isBlank(<span class="hljs-string">""</span>));
        System.out.println(<span class="hljs-string">"  '  ': "</span> + StringUtils.isBlank(<span class="hljs-string">"  "</span>));
        System.out.println(<span class="hljs-string">"  'abc': "</span> + StringUtils.isBlank(<span class="hljs-string">"abc"</span>));
        
        System.out.println(<span class="hljs-string">"\ncapitalize测试:"</span>);
        System.out.println(<span class="hljs-string">"  'hello': "</span> + StringUtils.capitalize(<span class="hljs-string">"hello"</span>));
        System.out.println(<span class="hljs-string">"  'WORLD': "</span> + StringUtils.capitalize(<span class="hljs-string">"WORLD"</span>));
        
        System.out.println(<span class="hljs-string">"\nrepeat测试:"</span>);
        System.out.println(<span class="hljs-string">"  'ab'*3: "</span> + StringUtils.repeat(<span class="hljs-string">"ab"</span>, <span class="hljs-number">3</span>));
        
        System.out.println(<span class="hljs-string">"\nreverse测试:"</span>);
        System.out.println(<span class="hljs-string">"  '12345': "</span> + StringUtils.reverse(<span class="hljs-string">"12345"</span>));
        
        <span class="hljs-comment">// 尝试实例化工具类（会抛出异常）</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// StringUtils utils = new StringUtils();  // 运行时异常</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.out.println(<span class="hljs-string">"\n不能实例化工具类: "</span> + e.getMessage());
        }
    }
}
</code></pre>
<h3 data-id="heading-19"><strong>3. 常量类</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 专门存放常量的类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Constants</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Constants</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 防止实例化</span>
    }
    
    <span class="hljs-comment">// 数据库相关常量</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DB_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"jdbc:mysql://localhost:3306/mydb"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DB_USER</span> <span class="hljs-operator">=</span> <span class="hljs-string">"root"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DB_PASSWORD</span> <span class="hljs-operator">=</span> <span class="hljs-string">"password"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DB_MAX_CONNECTIONS</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    
    <span class="hljs-comment">// 应用配置常量</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">APP_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"MyApp"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">VERSION</span> <span class="hljs-operator">=</span> <span class="hljs-string">"2.1.0"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEFAULT_LANGUAGE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"zh-CN"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">SESSION_TIMEOUT</span> <span class="hljs-operator">=</span> <span class="hljs-number">1800</span>; <span class="hljs-comment">// 30分钟</span>
    
    <span class="hljs-comment">// 文件路径常量</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOG_DIR</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/var/log/myapp"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONFIG_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/etc/myapp/config.properties"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TEMP_DIR</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/tmp/myapp"</span>;
    
    <span class="hljs-comment">// 业务常量</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_FILE_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>; <span class="hljs-comment">// 10MB</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_LOGIN_ATTEMPTS</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">TAX_RATE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.13</span>;
    
    <span class="hljs-comment">// 状态码常量</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATUS_OK</span> <span class="hljs-operator">=</span> <span class="hljs-number">200</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATUS_ERROR</span> <span class="hljs-operator">=</span> <span class="hljs-number">500</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">STATUS_NOT_FOUND</span> <span class="hljs-operator">=</span> <span class="hljs-number">404</span>;
    
    <span class="hljs-comment">// 颜色常量（RGB）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COLOR_RED</span> <span class="hljs-operator">=</span> <span class="hljs-number">0xFF0000</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COLOR_GREEN</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x00FF00</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COLOR_BLUE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0x0000FF</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COLOR_WHITE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0xFFFFFF</span>;
    
    <span class="hljs-comment">// 使用枚举也是更好的选择</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">UserRole</span> {
        ADMIN, USER, GUEST
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">OrderStatus</span> {
        PENDING, PROCESSING, SHIPPED, DELIVERED, CANCELLED
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 使用常量</span>
        System.out.println(<span class="hljs-string">"应用名称: "</span> + Constants.APP_NAME);
        System.out.println(<span class="hljs-string">"版本: "</span> + Constants.VERSION);
        System.out.println(<span class="hljs-string">"最大文件大小: "</span> + Constants.MAX_FILE_SIZE + <span class="hljs-string">" bytes"</span>);
        System.out.println(<span class="hljs-string">"税率: "</span> + Constants.TAX_RATE);
        
        <span class="hljs-comment">// 使用枚举</span>
        System.out.println(<span class="hljs-string">"\n用户角色:"</span>);
        <span class="hljs-keyword">for</span> (UserRole role : UserRole.values()) {
            System.out.println(<span class="hljs-string">"  "</span> + role);
        }
    }
}
</code></pre>
<h2 data-id="heading-20">📊 静态变量 vs 实例变量</h2>























































<table><thead><tr><th>特性</th><th>静态变量</th><th>实例变量</th></tr></thead><tbody><tr><td><strong>所属级别</strong></td><td>类级别</td><td>对象级别</td></tr><tr><td><strong>内存分配</strong></td><td>类加载时</td><td>对象创建时</td></tr><tr><td><strong>内存位置</strong></td><td>方法区</td><td>堆内存</td></tr><tr><td><strong>共享性</strong></td><td>所有对象共享</td><td>每个对象独立</td></tr><tr><td><strong>生命周期</strong></td><td>与类相同</td><td>与对象相同</td></tr><tr><td><strong>访问方式</strong></td><td><code>类名.变量名</code></td><td><code>对象.变量名</code></td></tr><tr><td><strong>默认值</strong></td><td>有（同实例变量）</td><td>有</td></tr><tr><td><strong>初始化</strong></td><td>静态代码块/声明时</td><td>实例代码块/声明时/构造器</td></tr><tr><td><strong>线程安全</strong></td><td>需要额外处理</td><td>每个对象独立</td></tr></tbody></table>
<h2 data-id="heading-21">🎓 总结要点</h2>
<ol>
<li><strong>静态变量属于类</strong>：所有对象共享同一份</li>
<li><strong>初始化时机</strong>：类加载时初始化，只初始化一次</li>
<li><strong>访问方式</strong>：推荐通过类名访问，不推荐通过对象访问</li>
<li><strong>线程安全</strong>：静态变量需要特别注意线程安全问题</li>
<li><strong>内存管理</strong>：静态变量生命周期长，要避免内存泄漏</li>
<li><strong>使用场景</strong>：
<ul>
<li>共享数据（计数器、缓存）</li>
<li>工具类、常量类</li>
<li>单例模式</li>
<li>配置信息</li>
</ul>
</li>
</ol>
<p>记住：<strong>静态变量是全局的，要谨慎使用</strong>！过多使用静态变量会导致代码耦合度高、难以测试、内存泄漏等问题。合理使用静态变量可以让代码更简洁高效。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微服务间进行调用进行失败后重试]]></title>    <link>https://juejin.cn/post/7578948893762109467</link>    <guid>https://juejin.cn/post/7578948893762109467</guid>    <pubDate>2025-12-02T07:59:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578948893762109467" data-draft-id="7578948893761978395" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微服务间进行调用进行失败后重试"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T07:59:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="哈哈哈笑什么"/> <meta itemprop="url" content="https://juejin.cn/user/808832912075352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微服务间进行调用进行失败后重试
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/808832912075352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    哈哈哈笑什么
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T07:59:20.000Z" title="Tue Dec 02 2025 07:59:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你需要在 Spring Cloud 中实现服务调用（通常是 Feign/OpenFeign 调用）时，遇到超时或失败后自动重试指定次数的机制 —— 核心是通过成熟的重试组件（Spring Retry 或 Resilience4j）结合服务调用组件，实现 “失败重试 + 指定次数 + 超时触发” 的需求。下面提供两种主流、可直接落地的方案，优先推荐 Spring Cloud 官方推荐的 Resilience4j 方案。</p>
<h2 data-id="heading-0">一、方案一：Spring Retry + OpenFeign（传统常用方案）</h2>
<p>Spring Retry 是轻量级重试框架，可与 OpenFeign 无缝整合，通过注解快速配置重试规则，适合简单场景（仅需重试 + 超时控制）。</p>
<h3 data-id="heading-1">1. 前置依赖（pom.xml）</h3>
<p>需引入 OpenFeign 核心依赖 + Spring Retry 依赖（Spring Retry 需 AOP 支持）：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- OpenFeign 核心依赖（服务调用基础） --&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-comment">&lt;!-- Spring Retry 依赖（重试核心） --&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.retry<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-retry<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-comment">&lt;!-- AOP 依赖（Spring Retry 必须，用于切面拦截重试） --&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-2">2. 核心配置（application.yml）</h3>
<p>需配置两部分：① Feign 调用超时时间（触发重试的前提）；② Spring Retry 全局默认规则（可选，也可在注解中单独配置）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 1. Feign 调用超时配置（必须，否则默认超时可能过长/过短） feign: client: config: default: # 全局配置（也可指定单个服务名，如 service-order） connect-timeout: 3000 # 连接超时时间（3秒，单位：毫秒） read-timeout: 5000 # 读取超时时间（5秒，单位：毫秒） # 2. Spring Retry 全局默认配置（可选，注解中配置会覆盖此值） spring: retry: retryable-exceptions: # 触发重试的异常类型（默认包含 IOException、TimeoutException 等） - java.net.SocketTimeoutException # 超时异常 - java.net.ConnectException # 连接异常 - org.springframework.web.client.HttpServerErrorException # 服务端5xx异常 max-attempts: 3 # 最大重试次数（默认3次：1次原始调用 + 2次重试） backoff: initial-interval: 1000 # 首次重试间隔（1秒） multiplier: 1.5 # 重试间隔倍数（下次间隔 = 上次 * 1.5，如1秒→1.5秒→2.25秒）</span>
</code></pre>
<h3 data-id="heading-3">3. 代码实现（3 步搞定）</h3>
<h4 data-id="heading-4">步骤 1：启动类开启 Feign 和 Retry 支持</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication; <span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication; <span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients; <span class="hljs-keyword">import</span> org.springframework.retry.annotation.EnableRetry; <span class="hljs-comment">// 开启 Feign 客户端 @EnableFeignClients // 开启 Retry 重试机制 @EnableRetry @SpringBootApplication public class ServiceConsumerApplication { public static void main(String[] args) { SpringApplication.run(ServiceConsumerApplication.class, args); } }</span>
</code></pre>
<h4 data-id="heading-5">步骤 2：Feign 客户端接口（定义服务调用）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient; <span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping; <span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable; <span class="hljs-comment">// 调用目标服务：service-order（服务名） @FeignClient(name = "service-order") public interface OrderFeignClient { // 调用目标服务的接口：根据订单ID查询订单 @GetMapping("/order/{orderId}") String getOrderById(@PathVariable("orderId") Long orderId); }</span>
</code></pre>
<h4 data-id="heading-6">步骤 3：服务层添加重试注解（@Retryable）</h4>
<p>在调用 Feign 客户端的方法上添加 <code>@Retryable</code>，指定重试规则（优先级：注解配置 &gt; 全局配置）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.retry.annotation.Backoff; <span class="hljs-keyword">import</span> org.springframework.retry.annotation.Retryable; <span class="hljs-keyword">import</span> org.springframework.stereotype.Service; <span class="hljs-keyword">import</span> javax.annotation.Resource; <span class="hljs-meta">@Service</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> { <span class="hljs-meta">@Resource</span> <span class="hljs-keyword">private</span> OrderFeignClient orderFeignClient; <span class="hljs-comment">/** * 调用订单服务，失败/超时后重试 * <span class="hljs-doctag">@param</span> orderId 订单ID * <span class="hljs-doctag">@return</span> 订单信息 */</span> <span class="hljs-meta">@Retryable( value = {SocketTimeoutException.class, ConnectException.class, HttpServerErrorException.class}, // 触发重试的异常（精准控制） maxAttempts = 3, // 最大重试次数：1次原始调用 + 2次重试 backoff = @Backoff(initialDelay = 1000, multiplier = 1.5) // 重试间隔：1秒→1.5秒→2.25秒 )</span> <span class="hljs-keyword">public</span> String <span class="hljs-title function_">queryOrder</span><span class="hljs-params">(Long orderId)</span> { <span class="hljs-comment">// 调用 Feign 客户端（底层会触发超时/失败检测） return orderFeignClient.getOrderById(orderId); } /** * 重试失败后的兜底方法（可选，无此方法则重试失败后抛出原异常） * 注意：方法参数、返回值必须与重试方法一致，且需抛出 Throwable */ @Recover public String queryOrderRecover(Long orderId, Throwable e) { // 兜底逻辑：返回默认值、记录日志、降级处理等 System.err.println("订单服务调用失败，触发降级：" + e.getMessage()); return "订单查询暂时不可用，请稍后重试"; } }</span>
</code></pre>
<h3 data-id="heading-7">4. 关键说明</h3>
<ul>
<li><strong>重试触发条件</strong>：仅当 Feign 调用抛出 <code>@Retryable</code> 中指定的异常（超时、连接失败、服务端 5xx）时才重试；客户端异常（4xx，如参数错误）不会重试（符合业务逻辑）。</li>
<li><strong>@Recover 兜底方法</strong>：可选，当重试次数耗尽仍失败时，会执行该方法返回兜底结果，避免直接抛出异常影响用户。</li>
<li><strong>幂等性要求</strong>：重试机制仅适用于「幂等接口」（多次调用结果一致，如查询、删除）；非幂等接口（如创建订单、扣减库存）需谨慎使用，避免重复操作（可通过唯一标识防重）。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不仅免费，还开源？这个 AI Mock 神器我必须曝光它]]></title>    <link>https://juejin.cn/post/7578793960627486746</link>    <guid>https://juejin.cn/post/7578793960627486746</guid>    <pubDate>2025-12-02T05:55:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578793960627486746" data-draft-id="7577683422879055906" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不仅免费，还开源？这个 AI Mock 神器我必须曝光它"/> <meta itemprop="keywords" content="前端,JavaScript,浏览器"/> <meta itemprop="datePublished" content="2025-12-02T05:55:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不一样的少年_"/> <meta itemprop="url" content="https://juejin.cn/user/3035079961218551"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不仅免费，还开源？这个 AI Mock 神器我必须曝光它
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3035079961218551/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不一样的少年_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:55:49.000Z" title="Tue Dec 02 2025 05:55:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    47
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>前两周我做了一个零侵入的接口 Mock  插件。还写了篇掘金文章记录了一下：<a href="https://juejin.cn/post/7570984257666056238" target="_blank" title="https://juejin.cn/post/7570984257666056238">juejin.cn/post/757098…</a></p>
<p>此前用 Popup 弹窗做联调，窗小、易误关、操作繁琐；</p>
<p>于是我重构为 Sidebar 常驻侧栏：规则随时可见，刷新也不丢。</p>
<ul>
<li>
<p><strong>换成 Sidebar 侧边栏</strong>：钉在页面右边，想开就开，数据都存着，再也不怕手抖关掉。即使刷新页面，规则也不会丢，重新打开就能继续用</p>
</li>
<li>
<p><strong>接入 AI 自动生成</strong>：描述你想要的数据，或者直接贴接口的 TypeScript 类型，AI 秒出结构化数据。手写？不存在的</p>
</li>
<li>
<p><strong>支持延时和状态码</strong>：可以模拟慢接口（延时 3 秒）、接口报错（返回 500）等真实场景</p>
</li>
</ul>
<p>现在用起来爽多了，前端开发不用干等后端，自己就能把页面跑起来。</p>
<p><strong>下文附安装与使用指南，欢迎试用与反馈</strong>。</p>
<p>如果你现在还在用 Popup 弹窗做 Mock，或者还在一个字一个字敲 JSON， 真心建议试试 Sidebar + AI 这套，用完你就知道什么叫"真香"。</p>
</blockquote>
<h2 data-id="heading-0">演示效果</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b8ca4cefce64d1dbe6dd0b6479bf06d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=UsVkNA4XKI92D6ffqMvU7pWcjHk%3D" alt="mock插件演示.gif" loading="lazy"/></p>
<h2 data-id="heading-1">插件功能预览</h2>
<ul>
<li>拦截能力：覆盖 fetch 与 XMLHttpRequest ，规则实时生效，零侵入</li>
<li>匹配规则：支持模糊匹配和完全匹配、正则表达式</li>
<li>响应控制：支持按 HTTP 方法过滤（GET/POST/PUT/DELETE）</li>
<li>异常模拟：支持模拟200/400/401/403/500等状态码</li>
<li>AI 生成：输入描述或贴 TS 类型，秒出结构化数据，支持模板与一键覆写</li>
<li><code>持续优化中,欢迎反馈与建议</code></li>
<li><code>建设中</code>: 调试与管理：导入导出、规则分组、Network 面板标识等；性能与匹配体验持续优化，欢迎反馈</li>
</ul>
<h2 data-id="heading-2">什么时候你会需要它？</h2>
<ul>
<li><strong>后端还在写接口</strong>：你不用干等，Mock 一下先把前端页面撸出来</li>
<li><strong>测试加载状态</strong>：设置延时 2 秒，看看你的 Loading 动画、骨架屏是不是真的在转</li>
<li><strong>测试异常处理</strong>：一键切换 200/400/401/403/500，看看你的错误提示是否友好</li>
<li><strong>测试防重复提交</strong>：延时 3 秒 + 返回失败，看看用户会不会疯狂点击</li>
<li><strong>给老板/客户演示</strong>：不用搭环境、不用连服务器，打开浏览器就能演示</li>
</ul>
<p><code>注：支持拦截ajax和fetch请求</code></p>
<hr/>
<h2 data-id="heading-3">🚀 快速开始</h2>
<h3 data-id="heading-4">获取代码</h3>
<ul>
<li><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTeernage%2FAI-Mock" target="_blank" title="https://github.com/Teernage/AI-Mock" ref="nofollow noopener noreferrer">github.com/Teernage/AI…</a> ⭐ 如果对您有帮助欢迎Star</li>
<li><strong>Gitee</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fxuzhenxin110%2FAI-Mock" target="_blank" title="https://gitee.com/xuzhenxin110/AI-Mock" ref="nofollow noopener noreferrer">gitee.com/xuzhenxin11…</a></li>
</ul>
<p>打开代码仓库，按以下方操作下载插件包。安装包为 zip，请先解压。</p>
<p><strong>下载与解压</strong></p>
<ul>
<li>在仓库的 Releases 或打包入口下载插件包（zip）。</li>
<li>将 zip 解压到任意目录，得到 AI-Mock-v1.0.0 文件夹。</li>
</ul>
<p><strong>参考示意图：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28fddc75094349fca1a061281ca612b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=yZbS02yyAXOfbOiHnbP5yJR%2BC0E%3D" alt="下载安装包.gif" loading="lazy"/></p>
<h3 data-id="heading-5">一键安装</h3>
<ol start="2">
<li>打开Chrome浏览器
3..  地址栏输入：<code>chrome://extensions/</code></li>
<li>打开右上角"开发者模式"</li>
<li>点击"加载已解压的扩展程序"</li>
<li>选择刚刚解压的AI-Mock-v1.0.0文件夹</li>
<li>搞定！扩展安装完成！</li>
</ol>
<p><strong>参考示意图：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0de60559bf94963b003f59bc9a7146e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=7YL4Y9RyU21uwhQJ2fqeySPOa74%3D" alt="安装ai-mock.gif" loading="lazy"/></p>
<p>gitee 仓库链接的同理，在仓库页点击“发行版（Release）”, 进入最新版本页面，下载插件包即可</p>
<p><strong>AI 前置准备</strong></p>
<ul>
<li>使用 AI 生成前需配置 DeepSeek API Key。为便于体验，提供一个限额试用 Key；额度用尽或失效后，请前往 DeepSeek 官网申请个人 Key 并在侧栏替换</li>
<li>试用 Key（仅用于体验，随时可能失效）： <code>sk-9fa67c84581d4f67b61039ff8b199baa</code></li>
</ul>
<p>示例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d0f80f238a14bda9266f7c5e3cdcace~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=OBDpl4Rxte4ItaYTefnMy5%2B4eWg%3D" alt="配置key.gif" loading="lazy"/></p>
<p>DeepSeek 官网申请key示例:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cdc607666b54e1eac842ecaa7d78d30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=OQm3vJUzHfSWSoIzfkrGGq8jOkI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">设计与实现</h2>
<h3 data-id="heading-7">1. Sidebar 侧边栏 vs popup弹窗</h3>






























<table><thead><tr><th>特性</th><th>Popup</th><th>Sidebar</th></tr></thead><tbody><tr><td>显示空间</td><td>小（~400x600px）</td><td>大（可调整宽度）</td></tr><tr><td>操作便捷性</td><td>点击外部就关闭</td><td>固定显示，不怕误触</td></tr><tr><td>与页面交互</td><td>互斥</td><td>可同时显示</td></tr><tr><td>数据持久化</td><td>关闭即丢失</td><td>刷新页面也保留</td></tr></tbody></table>
<h3 data-id="heading-8">2. AI 生成 Mock 数据</h3>
<p>这块就两件事：</p>
<ul>
<li>你给一个 URL，我把它转成正则，用来拦截这个接口</li>
<li>你给数据类型或者一句话描述，AI 直接把 Mock 数据“现做现给”</li>
</ul>
<h4 data-id="heading-9">1. 根据描述输出 Mock 数据</h4>
<ul>
<li>只要一句话就够：
<ul>
<li>输入：用户列表，包含姓名、年龄、邮箱，来 10 条</li>
</ul>
</li>
</ul>
<p><strong>效果图：</strong><br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1be757a4b85741e08c5843ecb0af04fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=DzzYcfaP1JCCNiCrUF4jFQZlMt8%3D" alt="根据描述输出 Mock 数据.gif" loading="lazy"/></p>
<h4 data-id="heading-10">2. 根据类型输出 Mock 数据</h4>
<ul>
<li>或者直接贴 数据的类型：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p><strong>效果图：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4e8a604d22c47b59ed1a6e0d220580f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=sJE8i306zEN9oNlnWyU4%2BgabS5w%3D" alt="根据类型输出 Mock 数据.gif" loading="lazy"/></p>
<h4 data-id="heading-11">3. 根据输入的地址生成正则表达式</h4>
<p><code>目的：把带占位符的路径，转成更稳的正则，方便在开发态拦截请求</code></p>
<p><strong>常用示例：</strong></p>
<ul>
<li>输入： /api/users/:id</li>
<li>正则： ^/api/users/[^/]+/?$</li>
<li>可拦截： /api/users/1 、 /api/users/abc</li>
</ul>
<p><strong>效果图：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4075626ca2124648a3901af9b9631373~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=peR4oQO0ybOHOtr6eIgNNMQvx%2BU%3D" alt="ai生成正则表达式.gif" loading="lazy"/></p>
<h3 data-id="heading-12">修改 Mock 数据</h3>
<ul>
<li>
<p>这块很直观，给你三种编辑入口，改完就是生效：</p>
<ul>
<li>规则编辑里改：打开“编辑规则”，在 Mock 数据 (JSON) 文本框里直接改，支持“格式化/验证/复制/清空”，点“保存”后立即应用</li>
</ul>
</li>
<li>
<p>放大弹窗改：点击“放大”，全屏 JSON 编辑器更适合改大结构或深层嵌套，改完“验证”一下再“保存”</p>
</li>
<li>
<p>卡片内联改：在规则卡片下方的“Mock 响应”树视图，鼠标双击某个值就能直接编辑，编辑完进行回车保存。这个适合改小字段（比如把 data.hits.total 从 1 改成 20 ）</p>
</li>
</ul>
<p><strong>效果图：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5a6147cda3b44b6beeae493f518b3a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=ruDfe6kG5TGTmPgqdKuYOze81eA%3D" alt="json数据修改方式.gif" loading="lazy"/></p>
<h4 data-id="heading-13">同步规则</h4>
<ul>
<li>三个地方改的都是同一份数据，任意入口保存后，其他入口会显示最新值</li>
<li>修改仅作用于“当前这条规则”，不会影响其他规则或接口</li>
</ul>
<h4 data-id="heading-14">推荐使用场景</h4>
<ul>
<li>小改动（单字段/少量数值）：用“卡片内联”最快</li>
<li>中等改动（几个字段/一层结构）：在“编辑规则”里改，配合“格式化/验证”</li>
<li>大改动（数组长度、层级结构、批量替换）：用“放大弹窗”编辑 JSON，更清晰、更不容易漏</li>
</ul>
<h4 data-id="heading-15">操作建议</h4>
<ul>
<li>先“验证”再“保存”：能快速提示 JSON 语法、字段类型不匹配等问题</li>
<li>用“格式化”提升可读性，避免缩进错乱</li>
<li>需要回到初始或重置时，用“清空”或点击“生成”重新出一版数据</li>
<li>要分享或备份当前数据，用“复制”一键拷贝</li>
</ul>
<h3 data-id="heading-16">4. 延时请求 - 测试加载状态</h3>
<p>设置延时 3 秒，模拟慢接口：</p>
<ul>
<li>测试 Loading 动画是否正常</li>
<li>测试骨架屏效果</li>
<li>测试用户会不会重复点击</li>
<li>测试超时逻辑</li>
</ul>
<p>演示效果图:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df1b39dde0d84a3b8f93ef33f1e3f4cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=HUfTLRdHQ1EaMOf1x%2Bf2mUMmSgw%3D" alt="延迟效果.gif" loading="lazy"/></p>
<h3 data-id="heading-17">4. 状态码 - 测试异常场景</h3>
<p>一键切换不同状态码：</p>
<ul>
<li><strong>200</strong>：测试成功流程</li>
<li><strong>400</strong>：测试参数校验</li>
<li><strong>401</strong>：测试登录跳转</li>
<li><strong>403</strong>：测试权限提示</li>
<li><strong>500</strong>：测试错误兜底</li>
</ul>
<p><strong>效果图:</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7929c1a7827742df82f934e6de9584b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261107&amp;x-signature=rLscOpMXzfkKf6u1FOk9%2F8zJtKQ%3D" alt="状态码修改.gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-18">核心实现</h2>
<h3 data-id="heading-19">1. Manifest V3：从 Popup 到 Sidebar</h3>
<p><strong>配置文件：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"manifest_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AI Mock"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"side_panel"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"default_path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sidepanel.html"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"sidePanel"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"storage"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"scripting"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"host_permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"&lt;all_urls&gt;"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>打开侧边栏：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// background.ts</span>
chrome.<span class="hljs-property">action</span>.<span class="hljs-property">onClicked</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-keyword">async</span> (tab) =&gt; {
  <span class="hljs-keyword">await</span> chrome.<span class="hljs-property">sidePanel</span>.<span class="hljs-title function_">open</span>({ <span class="hljs-attr">windowId</span>: tab.<span class="hljs-property">windowId</span> });
});
</code></pre>
<p><strong>关键区别：</strong></p>
<ul>
<li>Popup：窗口小、点击外部就关闭、关闭即销毁</li>
<li>Sidebar：空间大、可固定显示、数据持久化</li>
</ul>
<hr/>
<h3 data-id="heading-20">2. 拦截 fetch / XHR（支持延时和状态码）</h3>
<p>劫持实现原理参考我上篇文章：<a href="https://juejin.cn/post/7570984257666056238" target="_blank" title="https://juejin.cn/post/7570984257666056238">【前端效率工具】再也不用 APIfox 联调！零侵入 Mock，全程不改代码、不开代理</a><a href="https://juejin.cn/post/7570984257666056238" target="_blank" title="https://juejin.cn/post/7570984257666056238">juejin.cn/post/757098…</a></p>
<p><strong>核心代码：</strong></p>
<p><code>injected.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> originalFetch = <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span>;

<span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">input, init</span>) {
  <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">typeof</span> input === <span class="hljs-string">'string'</span> ? input : input.<span class="hljs-property">url</span>;
  <span class="hljs-keyword">const</span> method = init?.<span class="hljs-property">method</span> || <span class="hljs-string">'GET'</span>;
  
  <span class="hljs-comment">// 查找匹配的规则</span>
  <span class="hljs-keyword">const</span> rule = <span class="hljs-keyword">await</span> <span class="hljs-title function_">findMatchedRule</span>(url, method);
  
  <span class="hljs-keyword">if</span> (rule) { 
    <span class="hljs-comment">//  延时处理</span>
    <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">delay</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, rule.<span class="hljs-property">delay</span>));
    }
    
    <span class="hljs-comment">// 返回指定状态码</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(
      <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(rule.<span class="hljs-property">data</span>),
      {
        <span class="hljs-attr">status</span>: rule.<span class="hljs-property">statusCode</span> || <span class="hljs-number">200</span>,
        <span class="hljs-attr">statusText</span>: <span class="hljs-title function_">getStatusText</span>(rule.<span class="hljs-property">statusCode</span>),
        <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> }
      }
    );
  }
  
  <span class="hljs-comment">// 不拦截，调用原始 fetch</span>
  <span class="hljs-keyword">return</span> originalFetch.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>);
};

<span class="hljs-comment">// 状态码文本映射</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getStatusText</span>(<span class="hljs-params">code: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">statusTexts</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = {
    <span class="hljs-number">200</span>: <span class="hljs-string">'OK'</span>,
    <span class="hljs-number">400</span>: <span class="hljs-string">'Bad Request'</span>,
    <span class="hljs-number">401</span>: <span class="hljs-string">'Unauthorized'</span>,
    <span class="hljs-number">403</span>: <span class="hljs-string">'Forbidden'</span>,
    <span class="hljs-number">404</span>: <span class="hljs-string">'Not Found'</span>,
    <span class="hljs-number">500</span>: <span class="hljs-string">'Internal Server Error'</span>,
    <span class="hljs-number">502</span>: <span class="hljs-string">'Bad Gateway'</span>,
    <span class="hljs-number">503</span>: <span class="hljs-string">'Service Unavailable'</span>,
    <span class="hljs-number">504</span>: <span class="hljs-string">'Gateway Timeout'</span>
  };
  <span class="hljs-keyword">return</span> statusTexts[code] || <span class="hljs-string">'Unknown'</span>;
}
</code></pre>
<p><strong>匹配规则：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">findMatchedRule</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span>, method: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-comment">// 从 storage 获取规则</span>
  <span class="hljs-keyword">const</span> { rules } = <span class="hljs-keyword">await</span> chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'rules'</span>);
  
  <span class="hljs-keyword">return</span> rules.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">rule: Rule</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!rule.<span class="hljs-property">enabled</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// 方法匹配</span>
    <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">method</span> !== <span class="hljs-string">'ALL'</span> &amp;&amp; rule.<span class="hljs-property">method</span> !== method) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// URL 匹配</span>
    <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">matchMode</span> === <span class="hljs-string">'contains'</span>) {
      <span class="hljs-keyword">return</span> url.<span class="hljs-title function_">includes</span>(rule.<span class="hljs-property">url</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">matchMode</span> === <span class="hljs-string">'exact'</span>) {
      <span class="hljs-keyword">return</span> url === rule.<span class="hljs-property">url</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">matchMode</span> === <span class="hljs-string">'regex'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(rule.<span class="hljs-property">url</span>).<span class="hljs-title function_">test</span>(url);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  });
}
</code></pre>
<p><strong>支持的匹配模式：</strong></p>
<ul>
<li><strong>包含匹配</strong>：<code>/api/user</code> 可以匹配 <code>/api/user/list</code>、<code>/api/user/detail</code></li>
<li><strong>完整匹配</strong>：必须完全一致</li>
<li><strong>正则匹配</strong>：<code>/api/user/\d+</code> 可以匹配 <code>/api/user/123</code></li>
</ul>
<hr/>
<h3 data-id="heading-21">3. AI 生成 Mock 数据</h3>
<p><strong>Prompt 设计：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">buildPrompt</span> = (<span class="hljs-params">userInput: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-string">`
你是一个专业的 Mock 数据生成助手。

用户需求：<span class="hljs-subst">${userInput}</span>

请生成符合以下规范的 JSON 数据：
1. 必须是有效的 JSON 格式
2. 包含常见的响应结构（code, msg, data）
3. 数据要真实合理（中文姓名、真实邮箱格式等）
4. 如果是列表，生成 2-3 条示例数据

只返回 JSON，不要有其他说明文字。
  `</span>.<span class="hljs-title function_">trim</span>();
};
</code></pre>
<p><strong>生成逻辑：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">generateMockData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (!aiPrompt.<span class="hljs-property">value</span>) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">warning</span>(<span class="hljs-string">'请输入数据描述'</span>);
    <span class="hljs-keyword">return</span>;
  }

  generating.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'YOUR_AI_API_ENDPOINT'</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      },
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-attr">prompt</span>: <span class="hljs-title function_">buildPrompt</span>(aiPrompt.<span class="hljs-property">value</span>),
        <span class="hljs-attr">model</span>: <span class="hljs-string">'gpt-3.5-turbo'</span>
      })
    });

    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
    
    <span class="hljs-comment">// 解析 AI 返回的 JSON</span>
    <span class="hljs-keyword">const</span> mockData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>);
    
    <span class="hljs-comment">// 填充到编辑器</span>
    form.<span class="hljs-property">data</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(mockData, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>);
    
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'✨ AI 生成成功'</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'生成失败：'</span> + error.<span class="hljs-property">message</span>);
  } <span class="hljs-keyword">finally</span> {
    generating.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>;
  }
};
</code></pre>
<hr/>
<h3 data-id="heading-22">4. 规则数据结构</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rule</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">remark</span>: <span class="hljs-built_in">string</span>;              <span class="hljs-comment">// 规则名称</span>
  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>;                 <span class="hljs-comment">// URL 匹配</span>
  <span class="hljs-attr">matchMode</span>: <span class="hljs-string">'contains'</span> | <span class="hljs-string">'exact'</span> | <span class="hljs-string">'regex'</span>;
  <span class="hljs-attr">method</span>: <span class="hljs-string">'ALL'</span> | <span class="hljs-string">'GET'</span> | <span class="hljs-string">'POST'</span> | <span class="hljs-string">'PUT'</span> | <span class="hljs-string">'DELETE'</span>;
  <span class="hljs-attr">statusCode</span>: <span class="hljs-built_in">number</span>;          <span class="hljs-comment">// 🆕 状态码（默认 200）</span>
  <span class="hljs-attr">delay</span>: <span class="hljs-built_in">number</span>;               <span class="hljs-comment">// 🆕 延时（毫秒，默认 0）</span>
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;;   <span class="hljs-comment">// Mock 数据</span>
  <span class="hljs-attr">enabled</span>: <span class="hljs-built_in">boolean</span>;            <span class="hljs-comment">// 是否启用</span>
  <span class="hljs-attr">createdAt</span>: <span class="hljs-built_in">number</span>;           <span class="hljs-comment">// 创建时间</span>
}
</code></pre>
<p><strong>存储和读取：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 保存规则</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">saveRules</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">await</span> chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">rules</span>: rules.<span class="hljs-property">value</span> });
};

<span class="hljs-comment">// 加载规则</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadRules</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'rules'</span>);
  rules.<span class="hljs-property">value</span> = result.<span class="hljs-property">rules</span> || [];
};

<span class="hljs-comment">// 监听变化</span>
chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">onChanged</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-function">(<span class="hljs-params">changes, areaName</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (areaName === <span class="hljs-string">'local'</span> &amp;&amp; changes.<span class="hljs-property">rules</span>) {
    rules.<span class="hljs-property">value</span> = changes.<span class="hljs-property">rules</span>.<span class="hljs-property">newValue</span>;
  }
});
</code></pre>
<hr/>
<h2 data-id="heading-23">总结</h2>
<p>这次重构主要做了四件事：</p>
<ol>
<li><strong>Sidebar 替代 Popup</strong>：更大的空间、更好的体验</li>
<li><strong>AI 自动生成</strong>：一句话描述即可生成 Mock 数据</li>
<li><strong>延时请求</strong>：测试 Loading、骨架屏、超时逻辑</li>
<li><strong>自定义状态码</strong>：测试各种异常场景</li>
</ol>
<p>这四个功能组合起来，基本覆盖了前端开发中 90% 的 Mock 需求。</p>
<p>如果你也在等后端接口，或者被 Popup 小窗口折磨过，
真的可以试试这个插件，保证你用了就回不去了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin 协程： GlobalScope 和 Application Scope 选择和使用 —— 新手指南]]></title>    <link>https://juejin.cn/post/7578793960627617818</link>    <guid>https://juejin.cn/post/7578793960627617818</guid>    <pubDate>2025-12-02T06:08:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578793960627617818" data-draft-id="7578793960627552282" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin 协程： GlobalScope 和 Application Scope 选择和使用 —— 新手指南"/> <meta itemprop="keywords" content="Kotlin,Android Jetpack,Android"/> <meta itemprop="datePublished" content="2025-12-02T06:08:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="QING618"/> <meta itemprop="url" content="https://juejin.cn/user/339115460529117"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin 协程： GlobalScope 和 Application Scope 选择和使用 —— 新手指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/339115460529117/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    QING618
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:08:51.000Z" title="Tue Dec 02 2025 06:08:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">在 Kotlin 协程中，选择正确的 Scope 非常重要。本文将详细解释 <code>GlobalScope</code> 和 Application Scope（通常指 <code>CoroutineScope</code>）的区别和使用场景。</h2>
<h2 data-id="heading-1">📌 1. GlobalScope</h2>
<h3 data-id="heading-2">特点：</h3>
<ul>
<li><strong>全局生命周期</strong>：跟随整个应用进程</li>
<li><strong>不会自动取消</strong>：除非应用进程结束</li>
<li><strong>谨慎使用</strong>：容易造成内存泄漏</li>
</ul>
<h3 data-id="heading-3">使用示例：</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ⚠️ 不推荐 - 容易造成内存泄漏</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">riskyMethod</span><span class="hljs-params">()</span></span> {
    GlobalScope.launch {
        <span class="hljs-comment">// 长时间运行的任务</span>
        delay(<span class="hljs-number">5000</span>)
        updateUI() <span class="hljs-comment">// 可能已经销毁的 Activity 中调用</span>
    }
}

<span class="hljs-comment">// 需要手动管理</span>
<span class="hljs-keyword">var</span> job: Job? = <span class="hljs-literal">null</span>

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">startTask</span><span class="hljs-params">()</span></span> {
    job = GlobalScope.launch {
        <span class="hljs-comment">// 执行任务</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">stopTask</span><span class="hljs-params">()</span></span> {
    job?.cancel()
}
</code></pre>
<h2 data-id="heading-4">📌 2. Application Scope（推荐）</h2>
<h3 data-id="heading-5">创建方式：</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 方式1：自定义 Application Scope</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> : <span class="hljs-type">Application</span>() {
    <span class="hljs-comment">// 自定义 Application Scope</span>
    <span class="hljs-keyword">val</span> applicationScope = CoroutineScope(SupervisorJob() + Dispatchers.Default)
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        <span class="hljs-comment">// 初始化</span>
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onTerminate</span><span class="hljs-params">()</span></span> {
        applicationScope.cancel()
        <span class="hljs-keyword">super</span>.onTerminate()
    }
}

<span class="hljs-comment">// 方式2：使用 AndroidX 的 Lifecycle</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> : <span class="hljs-type">Application</span>() {
    <span class="hljs-keyword">val</span> applicationScope = CoroutineScope(SupervisorJob() + Dispatchers.Main.immediate)
}
</code></pre>
<h2 data-id="heading-6">📌 3. ViewModel Scope</h2>
<p>在 Android 中更推荐使用 ViewModel 的 scope：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    
    <span class="hljs-comment">// ViewModel 自带 viewModelScope</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span> {
        viewModelScope.launch {
            <span class="hljs-comment">// 自动跟随 ViewModel 生命周期</span>
            <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = repository.getData()
            _uiState.value = <span class="hljs-keyword">data</span>
        }
    }
    
    <span class="hljs-comment">// 或者创建自定义 scope</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> customScope = CoroutineScope(
        SupervisorJob() + Dispatchers.IO
    )
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCleared</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCleared()
        customScope.cancel()
    }
}
</code></pre>
<h2 data-id="heading-7">📌 4. Lifecycle Scope</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        
        <span class="hljs-comment">// lifecycleScope 自动跟随生命周期</span>
        lifecycleScope.launch {
            repeatOnLifecycle(Lifecycle.State.STARTED) {
                <span class="hljs-comment">// 只在 STARTED 状态执行</span>
                collectData()
            }
        }
        
        <span class="hljs-comment">// 或者使用 launchWhenStarted</span>
        lifecycleScope.launchWhenStarted {
            <span class="hljs-comment">// 当 Activity 进入 STARTED 状态时恢复</span>
        }
    }
}
</code></pre>
<h2 data-id="heading-8">📌 5. 对比表格</h2>








































<table><thead><tr><th>特性</th><th>GlobalScope</th><th>Application Scope</th><th>ViewModel Scope</th><th>Lifecycle Scope</th></tr></thead><tbody><tr><td><strong>生命周期</strong></td><td>应用进程</td><td>自定义控制</td><td>ViewModel 生命周期</td><td>Activity/Fragment 生命周期</td></tr><tr><td><strong>自动取消</strong></td><td>❌ 否</td><td>✅ 可自定义</td><td>✅ 是</td><td>✅ 是</td></tr><tr><td><strong>推荐使用</strong></td><td>❌ 很少</td><td>✅ 后台任务</td><td>✅ ViewModel 中</td><td>✅ UI 相关</td></tr><tr><td><strong>内存安全</strong></td><td>❌ 危险</td><td>✅ 可控</td><td>✅ 安全</td><td>✅ 安全</td></tr></tbody></table>
<h2 data-id="heading-9">📌 6. 最佳实践</h2>
<h3 data-id="heading-10">✅ 推荐做法：</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 在 Application 中创建全局 scope</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApp</span> : <span class="hljs-type">Application</span>() {
    <span class="hljs-keyword">val</span> appScope = CoroutineScope(SupervisorJob() + Dispatchers.IO)
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> instance: MyApp
            <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span>
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        instance = <span class="hljs-keyword">this</span>
    }
}

<span class="hljs-comment">// 2. 使用 ViewModel scope（首选）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : ViewModel() {
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> {
        viewModelScope.launch {
            _loading.value = <span class="hljs-literal">true</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> user = userRepository.getUser(userId)
                _user.value = user
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _error.value = e.message
            } <span class="hljs-keyword">finally</span> {
                _loading.value = <span class="hljs-literal">false</span>
            }
        }
    }
}

<span class="hljs-comment">// 3. 需要全局后台任务时</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnalyticsService</span>(context: Context) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> scope = CoroutineScope(SupervisorJob() + Dispatchers.IO)
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">logEvent</span><span class="hljs-params">(event: <span class="hljs-type">String</span>)</span></span> {
        scope.launch {
            <span class="hljs-comment">// 发送分析事件到服务器</span>
            sendToServer(event)
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">cleanup</span><span class="hljs-params">()</span></span> {
        scope.cancel()
    }
}
</code></pre>
<h2 data-id="heading-11">📌 7. 总结建议</h2>
<h4 data-id="heading-12">1). 几乎不要使用 <code>GlobalScope</code>，除非：</h4>
<ul>
<li>编写测试代码</li>
<li>编写一次性脚本</li>
<li>明确知道任务需要一直运行到应用结束</li>
</ul>
<h4 data-id="heading-13">2). 按层次选择 Scope:</h4>
<ul>
<li><strong>UI 更新</strong> → lifecycleScope 或 viewModelScope</li>
<li><strong>业务逻辑</strong> → viewModelScope</li>
<li><strong>全局后台任务</strong> → Application Scope</li>
<li><strong>数据库/网络</strong> → IO Dispatcher + 合适的 Scope</li>
</ul>
<h4 data-id="heading-14">3).遵循原则：</h4>
<ul>
<li><strong>生命周期感知</strong>：协程应该能被正确取消</li>
<li><strong>结构化并发</strong>：使用父-子协程关系</li>
<li><strong>异常处理</strong>：使用 <code>SupervisorJob</code> 防止一个协程失败影响其他</li>
</ul>
<p><strong>协程创建的成本很低，但内存泄漏的成本很高</strong>。选择合适的 Scope 是编写健壮协程代码的关键。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[取代Navicat！全新一代数据库管理工具来了，超级智能！]]></title>    <link>https://juejin.cn/post/7578781397118418990</link>    <guid>https://juejin.cn/post/7578781397118418990</guid>    <pubDate>2025-12-02T06:12:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578781397118418990" data-draft-id="7578803751609909298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="取代Navicat！全新一代数据库管理工具来了，超级智能！"/> <meta itemprop="keywords" content="后端,Java,MySQL"/> <meta itemprop="datePublished" content="2025-12-02T06:12:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MacroZheng"/> <meta itemprop="url" content="https://juejin.cn/user/958429871749192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            取代Navicat！全新一代数据库管理工具来了，超级智能！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/958429871749192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MacroZheng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:12:49.000Z" title="Tue Dec 02 2025 06:12:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作为后端开发，我们经常需要使用数据库管理工具来操作数据库，比较常用的有Navicat。今天给大家分享一款比它界面更现代化，提示更智能的数据库管理工具SQLark，集成AI功能可以实现报错分析，希望对大家有所帮助！</p>
</blockquote>
<h2 data-id="heading-0">SQLark简介</h2>
<p>SQLark是一款面向信创应用开发者的数据库管理工具，支持Oracle、MySQL、PostgreSQL、达梦等数据库。</p>
<p>SQLark的主要功能如下：</p>
<ul>
<li>智能的SQL补全：支持对SQL中关键词、表名、字段名等的智能补全，能一键完成INSERT语句中所有字段的输入。</li>
<li>全面的数据查看功能：支持表/视图/物化视图数据的表格形式查看，对<code>JSON/XML/大字段</code>数据能进行优化展示。</li>
<li>方便的数据生成功能：支持快速生成千万级表数据，能自动匹配数据规则。</li>
<li>多种格式的导入导出：支持对<code>xlsx/xls/csv/txt/json/xml</code>格式文件的数据进行导入导出操作。</li>
<li>小百灵AI功能：能提供代码解释、报错分析、代码生成、SQL优化、达梦知识检索等功能。</li>
</ul>
<p>下面是SQLark使用过程中的效果图，界面还是挺炫酷的！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aae945cff6dd4ac1a394bd2dfdc0af1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=kxQ90CvV7DmXS2t2O4qZiHM%2FXco%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">安装</h2>
<blockquote>
<p>SQLark具有多种客户端，支持Windows、macOS、Linux环境，大家可以选择合适的客户端进行下载。</p>
</blockquote>
<ul>
<li>我们可以从SQLark的官网下载安装包，这里以Windows环境为例，下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sqlark.com" target="_blank" title="https://www.sqlark.com" ref="nofollow noopener noreferrer">www.sqlark.com</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c77844e21924ef994cab919aed252e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=3Q6wOJss393fPS7vaciH0eJRV58%3D" alt="" loading="lazy"/></p>
<ul>
<li>下载完成后进行解压，解压完成后双击<code>SQLarkLaunch.exe</code>即可使用，打开后界面如下。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab0d7084a31e4b0ea09347eb65482dc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=HOyX6YBcRzMCdn7Dvai1TV7I%2BeE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">使用</h2>
<h3 data-id="heading-3">SQL编辑器</h3>
<ul>
<li>SQLark的提示非常智能，支持对关键词、模式名、表名、表别名、字段名等对象名的补全；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b74ff73a718c4be881218115c7de4d56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=Icdevpt3JScajvVoK3vDX9EbGXI%3D" alt="" loading="lazy"/></p>
<ul>
<li>在编写INSERT语句时，输入<code>()</code>会提示所有字段，选择后可以一键完成所有字段名的输入；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/717703079b2a424d811b3237286e8bb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=OQ5A5O3%2FZ1Jab06hE0OfyJfpDzQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>在<code>配置-&gt;首选项-&gt;常用代码段</code>功能中，可以自定义代码模版，例如这里配置的输入<code>upd</code>可以直接生成UPDATE语句；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9df65d5ee8a0448b9bf723238aeb298b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=8Sg%2F4w42D22GyVoxJ48LqxRUkNs%3D" alt="" loading="lazy"/></p>
<ul>
<li>在使用过程中可以使用<code>Tab</code>键来跳跃到下一个输入点，有点类似IDEA里的操作；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ac726d249c845a080cc826257f36f4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=Bh3kw5JbHZoSbXm%2Bq6u90E4Wf8A%3D" alt="" loading="lazy"/></p>
<ul>
<li>通过<code>Ctrl+鼠标左键</code>可以跳转至表结构设计窗口；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/364125ce9e45475ea38942282318ac57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=KDGVVLUnjojHnOYBDQlPUmVsl6M%3D" alt="" loading="lazy"/></p>
<ul>
<li>选择表名后，通过<code>F4键</code>可跳转至表数据浏览窗口。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea1da741340647cfa08dba0788386c17~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=e0HifVkhhMpz4xvfUeid4K7%2FDVQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">数据查看</h3>
<ul>
<li>SQLark的数据展示功能非常全面，一些数据比较多的列，可以通过<code>查看</code>功能在右侧窗口中查看详细信息；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c55767e75b2f4ea189144f5fd6bb59c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=JzXZhmKozZoBSdeyFgw8YJO2bVE%3D" alt="" loading="lazy"/></p>
<ul>
<li>支持在数据表的表头中显示字段类型和注释；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14269771ee86451ebeb8a86284eb391f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=WJo3OH4NjwcM1R3m%2FG2TXUNW%2FnA%3D" alt="" loading="lazy"/></p>
<ul>
<li>可以自动识别JSON或XML格式数据并进行格式化展示；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17a923f6a3444136a678e1585f7ec870~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=aoAYXPFAX6pxCNWFCByHGUpmGZQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>对于<code>BLOB/CLOB</code>大字段类型数据，可通过双击单元格查看完整内容。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcf18644f8d5476cbb788abeac7c647c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=CWWJtrh7P%2F1wwla4I9RtyClZ3p8%3D" alt="" loading="lazy"/></p>
<ul>
<li>支持通过条件对数据进行筛选，并可以生成SQL预览；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ad51494a3fc4b3eac370176547ac84c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=Pg3ecEGlkWjjA2Z4phQ1hnUYSAs%3D" alt="" loading="lazy"/></p>
<ul>
<li>支持通过条件对数据进行排序。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e7588bef9914ec3bb9832633d2289c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=GGz6fg909rYaonwLu11bXoUT15Y%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">数据生成</h3>
<ul>
<li>通过SQLark能快速生成仿真表数据，应用在开发测试环节中，点击顶部<code>数据生成</code>按钮，然后选择好表即可生成；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bab2f9bc84b74c78bd204e94d70c1aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=pMQd%2BFfU495Nz1X8m%2BevsNwyURk%3D" alt="" loading="lazy"/></p>
<ul>
<li>我们可以看到SQLark能基于列名、列注释等信息，自动匹配数据生成规则，对于自动生成不太符合的规则，你也可以自行定义，SQLark中内置了多种规则可供选择。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03591d72a37b4e59ae7732612678516c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=bDVB9pcpSfYGcFSDHK008v3fYGk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">导入导出</h3>
<ul>
<li>点击<code>导出</code>按钮，可以将数据库表中的数据导出到外部文件中，支持多种格式的文件；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd6ea0685f9e4a3f983502472e8db1c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=L1gs7Hzvjk0zSfMKpdklzDxMHtQ%3D" alt="" loading="lazy"/></p>
<ul>
<li>点击<code>导入</code>按钮，可以将外部数据文件导入到数据库中，也支持多种格式的文件。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78c47fa636bb4b1eb8c4c4c6c200071a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=m3KhhIHpKkIPSFgkjXzCoCPd9Bs%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">小百灵AI</h3>
<ul>
<li>点击右上角<code>小百灵AI</code>按钮可以打开AI助手，内置了Qwen3和DeepSeek大模型，可按需灵活切换；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3472990ef218460a9525c393adc33744~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=fb4ns8%2B%2BJhPCNF9xyMc9V5oKamo%3D" alt="" loading="lazy"/></p>
<ul>
<li>对于复杂SQL，我们选中代码后，右键选择<code>问AI</code>，小百灵AI就会为我们解释代码的意义了；</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f4879d5250d42f99509faf934c9481e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=dVqlyLYw9KheHUwX%2FFgLalPNDwk%3D" alt="" loading="lazy"/></p>
<ul>
<li>当我们运行SQL出错时，选择错误信息右侧的<code>问AI</code>，即可让小百灵AI为我们提供解决方案了，还是挺方便的！</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/481926e08fa045cc9df450abf966e15d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFjcm9aaGVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260768&amp;x-signature=BAgYLR89W7eqwXf7bgBZ05Dsq%2FI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">总结</h2>
<p>今天给大家分享了一款现代化的数据库管理工具SQLark，它的SQL编辑器提示非常全面，数据展示功能也很优秀，小百灵AI的代码解释和错误分析功能用起来也挺方便，感兴趣的小伙伴可以尝试下它！</p>
<h2 data-id="heading-9">下载地址</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sqlark.com" target="_blank" title="https://www.sqlark.com" ref="nofollow noopener noreferrer">www.sqlark.com</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端下午茶！看看炫酷的动画，轻松一下！]]></title>    <link>https://juejin.cn/post/7578917474658189363</link>    <guid>https://juejin.cn/post/7578917474658189363</guid>    <pubDate>2025-12-02T06:28:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578917474658189363" data-draft-id="7578803751609991218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端下午茶！看看炫酷的动画，轻松一下！"/> <meta itemprop="keywords" content="前端,动效"/> <meta itemprop="datePublished" content="2025-12-02T06:28:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟祥_成都"/> <meta itemprop="url" content="https://juejin.cn/user/96412752684744"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端下午茶！看看炫酷的动画，轻松一下！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/96412752684744/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟祥_成都
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:28:01.000Z" title="Tue Dec 02 2025 06:28:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>之前说了会更新 gsap 动画教程，我们先来个开胃菜，看看最近练习的 demo 是否有同学愿意一起学习和交流。</p>
<p>既然你都点进来看帖子了，来都来了，留下来喝个小茶，看个小动画再走呗！</p>
<h2 data-id="heading-1">视频滚动动画</h2>
<p>视频被切为了动画帧，随着滚动鼠标滚动或者触控板滑动而不断播放视频。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/711ac59d28a0477db368a498d4e23b9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261680&amp;x-signature=Tvvu1V2r4d4gJKvV%2Fd%2BvuIIY8Jk%3D" alt="video1.gif" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.frontlight.tech%2Fanimation%2Fgsap%2Fexample%2Fvideo%2Fexample1" target="_blank" title="https://www.frontlight.tech/animation/gsap/example/video/example1" ref="nofollow noopener noreferrer">以上效果在线地址 - 国内</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui%2Ftree%2Fmain%2Fapps%2Freact-pc-website%2Fapp%2Fanimation%2Fgsap%2Fexample%2Fvideo%2Fexample1" target="_blank" title="https://github.com/lio-mengxiang/t-ui/tree/main/apps/react-pc-website/app/animation/gsap/example/video/example1" ref="nofollow noopener noreferrer">github 源码地址（感谢给个 star）</a></p>
<h2 data-id="heading-2">图片滚动动画</h2>
<p>图片随着滚动鼠标滚动或者触控板滑动而不断变化，第二屏会有一定的视差滚动的效果。</p>
<p>主要涉及 clip-path 属性的变化。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88f88152c7a74dbca13ac5434bebfc0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261680&amp;x-signature=qmtVkT8Mr94sNlag8GJ0oL9Hh4U%3D" alt="clip-path1.gif" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.frontlight.tech%2Fanimation%2Fgsap%2Fexample%2Fclip-path%2Fexample1" target="_blank" title="https://www.frontlight.tech/animation/gsap/example/clip-path/example1" ref="nofollow noopener noreferrer">以上效果在线地址 - 国内</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui%2Ftree%2Fmain%2Fapps%2Freact-pc-website%2Fapp%2Fanimation%2Fgsap%2Fexample%2Fclip-path%2Fexample1" target="_blank" title="https://github.com/lio-mengxiang/t-ui/tree/main/apps/react-pc-website/app/animation/gsap/example/clip-path/example1" ref="nofollow noopener noreferrer">github 源码地址（感谢给个 star）</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37f241159bbd4c3189e14cd977a58317~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261680&amp;x-signature=ZoP%2FSnX%2FDZ54alN4le9pToSCm3w%3D" alt="clip-path2.gif" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.frontlight.tech%2Fanimation%2Fgsap%2Fexample%2Fclip-path%2Fexample2" target="_blank" title="https://www.frontlight.tech/animation/gsap/example/clip-path/example2" ref="nofollow noopener noreferrer">以上效果在线地址 - 国内</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui%2Ftree%2Fmain%2Fapps%2Freact-pc-website%2Fapp%2Fanimation%2Fgsap%2Fexample%2Fclip-path%2Fexample2" target="_blank" title="https://github.com/lio-mengxiang/t-ui/tree/main/apps/react-pc-website/app/animation/gsap/example/clip-path/example2" ref="nofollow noopener noreferrer">github 源码地址（感谢给个 star）</a></p>
<h2 data-id="heading-3">transform 动画</h2>
<p>图片随着滚动鼠标滚动或者触控板滑动而不断变化，主要是 transform 属性上的变化。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dee9adeb63194650a2a8504e3559a16d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261680&amp;x-signature=fw0Rqg23dQwiPMxoZ%2FdrU6qA75I%3D" alt="transform1.gif" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.frontlight.tech%2Fanimation%2Fgsap%2Fexample%2Ftransform%2Fexample1" target="_blank" title="https://www.frontlight.tech/animation/gsap/example/transform/example1" ref="nofollow noopener noreferrer">以上效果在线地址 - 国内</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui%2Ftree%2Fmain%2Fapps%2Freact-pc-website%2Fapp%2Fanimation%2Fgsap%2Fexample%2Ftransform%2Fexample1" target="_blank" title="https://github.com/lio-mengxiang/t-ui/tree/main/apps/react-pc-website/app/animation/gsap/example/transform/example1" ref="nofollow noopener noreferrer">github 源码地址（感谢给个 star）</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9395b4e5134d48de8fe6bbdc44384b2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261680&amp;x-signature=l7He6BXfAFw86CBv1ARVzkLZ8I8%3D" alt="transform2.gif" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.frontlight.tech%2Fanimation%2Fgsap%2Fexample%2Ftransform%2Fexample3" target="_blank" title="https://www.frontlight.tech/animation/gsap/example/transform/example3" ref="nofollow noopener noreferrer">以上效果在线地址 - 国内</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui%2Ftree%2Fmain%2Fapps%2Freact-pc-website%2Fapp%2Fanimation%2Fgsap%2Fexample%2Ftransform%2Fexample3" target="_blank" title="https://github.com/lio-mengxiang/t-ui/tree/main/apps/react-pc-website/app/animation/gsap/example/transform/example3" ref="nofollow noopener noreferrer">github 源码地址（感谢给个 star）</a></p>
<h2 data-id="heading-4">欢迎加入交流群</h2>
<p>欢迎加入交流群一起进步！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Prometheus + Grafana 监控系统搭建实战：从零到生产可用]]></title>    <link>https://juejin.cn/post/7578820376999952435</link>    <guid>https://juejin.cn/post/7578820376999952435</guid>    <pubDate>2025-12-02T06:35:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578820376999952435" data-draft-id="7578820376999919667" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Prometheus + Grafana 监控系统搭建实战：从零到生产可用"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T06:35:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="嘻哈baby"/> <meta itemprop="url" content="https://juejin.cn/user/485305583405066"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Prometheus + Grafana 监控系统搭建实战：从零到生产可用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/485305583405066/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    嘻哈baby
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:35:19.000Z" title="Tue Dec 02 2025 06:35:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>上个月公司服务器半夜挂了，第二天早上才发现。老板问：为什么没有监控？</p>
<p>好吧，是时候搞一套监控系统了。</p>
<p>调研了一圈，最终选了 <strong>Prometheus + Grafana</strong> 这套组合：</p>
<ul>
<li>Prometheus：负责采集和存储指标数据</li>
<li>Grafana：负责可视化展示</li>
<li>开源免费，社区活跃</li>
<li>云原生标配，K8s原生支持</li>
</ul>
<p>这篇文章记录完整的搭建过程，包括踩过的坑。</p>
<hr/>
<h2 data-id="heading-1">一、架构设计</h2>
<p>先看整体架构：</p>
<pre><code class="hljs"/></pre>
<p>┌─────────────────────────────────────────────────────────────┐
│                        监控系统架构                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐              │
│  │  服务器A  │    │  服务器B  │    │  服务器C  │              │
│  │  Node    │    │  Node    │    │  Node    │              │
│  │ Exporter │    │ Exporter │    │ Exporter │              │
│  └────┬─────┘    └────┬─────┘    └────┬─────┘              │
│       │               │               │                     │
│       └───────────────┼───────────────┘                     │
│                       │                                     │
│                       ▼                                     │
│              ┌────────────────┐                             │
│              │   Prometheus   │◄─── 拉取指标（Pull模式）      │
│              │   (时序数据库)  │                             │
│              └───────┬────────┘                             │
│                      │                                      │
│                      ▼                                      │
│              ┌────────────────┐                             │
│              │    Grafana     │◄─── 可视化展示               │
│              │   (仪表盘)      │                             │
│              └───────┬────────┘                             │
│                      │                                      │
│                      ▼                                      │
│              ┌────────────────┐                             │
│              │  Alertmanager  │◄─── 告警推送                 │
│              │   (告警管理)    │     (邮件/钉钉/企微)         │
│              └────────────────┘                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">**核心组件：**</span>

<span class="hljs-string">|</span> <span class="hljs-string">组件</span> <span class="hljs-string">|</span> <span class="hljs-string">作用</span> <span class="hljs-string">|</span> <span class="hljs-string">端口</span> <span class="hljs-string">|</span>
<span class="hljs-string">|------|------|------|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Prometheus</span> <span class="hljs-string">|</span> <span class="hljs-string">指标采集、存储、查询</span> <span class="hljs-string">|</span> <span class="hljs-number">9090</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Grafana</span> <span class="hljs-string">|</span> <span class="hljs-string">可视化仪表盘</span> <span class="hljs-string">|</span> <span class="hljs-number">3000</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Node</span> <span class="hljs-string">Exporter</span> <span class="hljs-string">|</span> <span class="hljs-string">采集服务器指标（CPU/内存/磁盘）</span> <span class="hljs-string">|</span> <span class="hljs-number">9100</span> <span class="hljs-string">|</span>
<span class="hljs-string">|</span> <span class="hljs-string">Alertmanager</span> <span class="hljs-string">|</span> <span class="hljs-string">告警管理和推送</span> <span class="hljs-string">|</span> <span class="hljs-number">9093</span> <span class="hljs-string">|</span>

<span class="hljs-meta">---
</span>
<span class="hljs-comment">## 二、环境准备</span>

<span class="hljs-string">**服务器配置：**</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">监控服务器：2核4GB（跑Prometheus+Grafana）</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">被监控服务器：若干台</span>

<span class="hljs-string">**系统环境：**</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">Ubuntu</span> <span class="hljs-number">22.04</span> <span class="hljs-string">/</span> <span class="hljs-string">CentOS</span> <span class="hljs-number">7</span><span class="hljs-string">+</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">Docker</span> <span class="hljs-number">20.10</span><span class="hljs-string">+（推荐用Docker部署）</span>

<span class="hljs-meta">---
</span>
<span class="hljs-comment">## 三、部署 Prometheus</span>

<span class="hljs-comment">### 3.1 Docker Compose 部署</span>

<span class="hljs-string">创建目录和配置文件：</span>

<span class="hljs-string">```bash</span>
<span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/opt/monitoring/{prometheus,grafana,alertmanager}</span>
<span class="hljs-string">cd</span> <span class="hljs-string">/opt/monitoring</span>
</code></pre>
<p>创建 <code>docker-compose.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">prometheus:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">prom/prometheus:v2.47.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">prometheus</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9090:9090"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./prometheus/rules:/etc/prometheus/rules</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">prometheus_data:/prometheus</span>
    <span class="hljs-attr">command:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'--config.file=/etc/prometheus/prometheus.yml'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'--storage.tsdb.path=/prometheus'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'--storage.tsdb.retention.time=30d'</span>  <span class="hljs-comment"># 数据保留30天</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">'--web.enable-lifecycle'</span>  <span class="hljs-comment"># 支持热重载</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">monitoring</span>

  <span class="hljs-attr">grafana:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">grafana/grafana:10.1.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">grafana</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"3000:3000"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">grafana_data:/var/lib/grafana</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_SECURITY_ADMIN_PASSWORD=your_password</span>  <span class="hljs-comment"># 改成你的密码</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GF_USERS_ALLOW_SIGN_UP=false</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">monitoring</span>

  <span class="hljs-attr">alertmanager:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">prom/alertmanager:v0.26.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">alertmanager</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9093:9093"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./alertmanager/alertmanager.yml:/etc/alertmanager/alertmanager.yml</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">monitoring</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">prometheus_data:</span>
  <span class="hljs-attr">grafana_data:</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">monitoring:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</code></pre>
<h3 data-id="heading-2">3.2 配置 Prometheus</h3>
<p>创建 <code>prometheus/prometheus.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">global:</span>
  <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">15s</span>      <span class="hljs-comment"># 采集间隔</span>
  <span class="hljs-attr">evaluation_interval:</span> <span class="hljs-string">15s</span>  <span class="hljs-comment"># 规则评估间隔</span>

<span class="hljs-attr">alerting:</span>
  <span class="hljs-attr">alertmanagers:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">static_configs:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-string">alertmanager:9093</span>

<span class="hljs-attr">rule_files:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/prometheus/rules/*.yml</span>

<span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-comment"># 监控Prometheus自身</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'prometheus'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">'localhost:9090'</span>]

  <span class="hljs-comment"># 监控服务器（Node Exporter）</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'nodes'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">'192.168.1.10:9100'</span>  <span class="hljs-comment"># 服务器A</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">'192.168.1.11:9100'</span>  <span class="hljs-comment"># 服务器B</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">'192.168.1.12:9100'</span>  <span class="hljs-comment"># 服务器C</span>
    <span class="hljs-attr">relabel_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">source_labels:</span> [<span class="hljs-string">__address__</span>]
        <span class="hljs-attr">regex:</span> <span class="hljs-string">'([^:]+):.*'</span>
        <span class="hljs-attr">target_label:</span> <span class="hljs-string">instance</span>
        <span class="hljs-attr">replacement:</span> <span class="hljs-string">'${1}'</span>
</code></pre>
<h3 data-id="heading-3">3.3 配置告警规则</h3>
<p>创建 <code>prometheus/rules/node_alerts.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">groups:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">node_alerts</span>
    <span class="hljs-attr">rules:</span>
      <span class="hljs-comment"># CPU使用率过高</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighCpuUsage</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-number">100</span> <span class="hljs-bullet">-</span> <span class="hljs-string">(avg</span> <span class="hljs-string">by(instance)</span> <span class="hljs-string">(irate(node_cpu_seconds_total{mode="idle"}[5m]))</span> <span class="hljs-string">*</span> <span class="hljs-number">100</span><span class="hljs-string">)</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">80</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">5m</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"CPU使用率过高"</span>
          <span class="hljs-attr">description:</span> <span class="hljs-string">"服务器 <span class="hljs-template-variable">{{ $labels.instance }}</span> CPU使用率超过80%，当前值：<span class="hljs-template-variable">{{ $value | printf \"%.1f\" }}</span>%"</span>

      <span class="hljs-comment"># 内存使用率过高</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighMemoryUsage</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">(1</span> <span class="hljs-bullet">-</span> <span class="hljs-string">node_memory_MemAvailable_bytes</span> <span class="hljs-string">/</span> <span class="hljs-string">node_memory_MemTotal_bytes)</span> <span class="hljs-string">*</span> <span class="hljs-number">100</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">85</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">5m</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"内存使用率过高"</span>
          <span class="hljs-attr">description:</span> <span class="hljs-string">"服务器 <span class="hljs-template-variable">{{ $labels.instance }}</span> 内存使用率超过85%，当前值：<span class="hljs-template-variable">{{ $value | printf \"%.1f\" }}</span>%"</span>

      <span class="hljs-comment"># 磁盘使用率过高</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighDiskUsage</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">(1</span> <span class="hljs-bullet">-</span> <span class="hljs-string">node_filesystem_avail_bytes{fstype!~"tmpfs|overlay"}</span> <span class="hljs-string">/</span> <span class="hljs-string">node_filesystem_size_bytes)</span> <span class="hljs-string">*</span> <span class="hljs-number">100</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">85</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">5m</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"磁盘使用率过高"</span>
          <span class="hljs-attr">description:</span> <span class="hljs-string">"服务器 <span class="hljs-template-variable">{{ $labels.instance }}</span> 磁盘 <span class="hljs-template-variable">{{ $labels.mountpoint }}</span> 使用率超过85%"</span>

      <span class="hljs-comment"># 服务器宕机</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">InstanceDown</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">up</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">1m</span>
        <span class="hljs-attr">labels:</span>
          <span class="hljs-attr">severity:</span> <span class="hljs-string">critical</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"服务器宕机"</span>
          <span class="hljs-attr">description:</span> <span class="hljs-string">"服务器 <span class="hljs-template-variable">{{ $labels.instance }}</span> 已经宕机超过1分钟"</span>
</code></pre>
<h3 data-id="heading-4">3.4 配置 Alertmanager（钉钉告警）</h3>
<p>创建 <code>alertmanager/alertmanager.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">global:</span>
  <span class="hljs-attr">resolve_timeout:</span> <span class="hljs-string">5m</span>

<span class="hljs-attr">route:</span>
  <span class="hljs-attr">group_by:</span> [<span class="hljs-string">'alertname'</span>, <span class="hljs-string">'instance'</span>]
  <span class="hljs-attr">group_wait:</span> <span class="hljs-string">30s</span>
  <span class="hljs-attr">group_interval:</span> <span class="hljs-string">5m</span>
  <span class="hljs-attr">repeat_interval:</span> <span class="hljs-string">4h</span>
  <span class="hljs-attr">receiver:</span> <span class="hljs-string">'dingtalk'</span>

<span class="hljs-attr">receivers:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'dingtalk'</span>
    <span class="hljs-attr">webhook_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">'http://dingtalk-webhook:8060/dingtalk/webhook1/send'</span>
        <span class="hljs-attr">send_resolved:</span> <span class="hljs-literal">true</span>
</code></pre>
<p><strong>钉钉Webhook需要单独部署一个转发服务，这里用 <code>prometheus-webhook-dingtalk</code>：</strong></p>
<p>在 <code>docker-compose.yml</code> 中添加：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dingtalk:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">timonwong/prometheus-webhook-dingtalk:v2.1.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">dingtalk-webhook</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8060:8060"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./dingtalk/config.yml:/etc/prometheus-webhook-dingtalk/config.yml</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">monitoring</span>
</code></pre>
<p>创建 <code>dingtalk/config.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">targets:</span>
  <span class="hljs-attr">webhook1:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">https://oapi.dingtalk.com/robot/send?access_token=你的钉钉机器人Token</span>
    <span class="hljs-attr">secret:</span> <span class="hljs-string">你的钉钉机器人加签密钥</span>
</code></pre>
<h3 data-id="heading-5">3.5 启动服务</h3>
<pre><code class="hljs language-bash" lang="bash">docker-compose up -d

<span class="hljs-comment"># 检查状态</span>
docker-compose ps

<span class="hljs-comment"># 查看日志</span>
docker-compose logs -f prometheus
</code></pre>
<p>访问 <code>http://服务器IP:9090</code> 验证Prometheus是否正常。</p>
<hr/>
<h2 data-id="heading-6">四、部署 Node Exporter</h2>
<p>在<strong>每台被监控的服务器</strong>上部署 Node Exporter。</p>
<h3 data-id="heading-7">4.1 Docker 部署</h3>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --name node_exporter \
  --restart always \
  --net host \
  --pid host \
  -v <span class="hljs-string">"/:/host:ro,rslave"</span> \
  prom/node-exporter:v1.6.1 \
  --path.rootfs=/host
</code></pre>
<h3 data-id="heading-8">4.2 二进制部署（推荐生产环境）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 下载</span>
wget https://github.com/prometheus/node_exporter/releases/download/v1.6.1/node_exporter-1.6.1.linux-amd64.tar.gz

<span class="hljs-comment"># 解压</span>
tar xvf node_exporter-1.6.1.linux-amd64.tar.gz
<span class="hljs-built_in">mv</span> node_exporter-1.6.1.linux-amd64/node_exporter /usr/local/bin/

<span class="hljs-comment"># 创建systemd服务</span>
<span class="hljs-built_in">cat</span> &gt; /etc/systemd/system/node_exporter.service &lt;&lt; <span class="hljs-string">'EOF'</span>
[Unit]
Description=Node Exporter
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/node_exporter
Restart=on-failure

[Install]
WantedBy=multi-user.target
EOF

<span class="hljs-comment"># 启动</span>
systemctl daemon-reload
systemctl <span class="hljs-built_in">enable</span> node_exporter
systemctl start node_exporter

<span class="hljs-comment"># 验证</span>
curl localhost:9100/metrics
</code></pre>
<h3 data-id="heading-9">4.3 验证数据采集</h3>
<p>回到Prometheus的Web界面：</p>
<ol>
<li>访问 <code>http://Prometheus服务器:9090/targets</code></li>
<li>确认所有Node Exporter状态为 <code>UP</code></li>
</ol>
<p>如果状态是 <code>DOWN</code>，检查：</p>
<ul>
<li>Node Exporter是否启动</li>
<li>防火墙是否开放9100端口</li>
<li>网络是否连通</li>
</ul>
<hr/>
<h2 data-id="heading-10">五、配置 Grafana 仪表盘</h2>
<h3 data-id="heading-11">5.1 登录 Grafana</h3>
<p>访问 <code>http://服务器IP:3000</code></p>
<ul>
<li>用户名：admin</li>
<li>密码：docker-compose.yml 中设置的密码</li>
</ul>
<h3 data-id="heading-12">5.2 添加数据源</h3>
<ol>
<li>左侧菜单 → Configuration → Data Sources</li>
<li>点击 "Add data source"</li>
<li>选择 "Prometheus"</li>
<li>URL填写：<code>http://prometheus:9090</code>（Docker网络内部地址）</li>
<li>点击 "Save &amp; Test"</li>
</ol>
<h3 data-id="heading-13">5.3 导入仪表盘</h3>
<p>不用从零开始做仪表盘，直接导入社区模板：</p>
<ol>
<li>
<p>左侧菜单 → Dashboards → Import</p>
</li>
<li>
<p>输入仪表盘ID：</p>
<ul>
<li><strong>Node Exporter Full</strong>：1860（最全面的服务器监控）</li>
<li><strong>Docker监控</strong>：893</li>
<li><strong>Prometheus Stats</strong>：2</li>
</ul>
</li>
<li>
<p>选择Prometheus数据源</p>
</li>
<li>
<p>点击Import</p>
</li>
</ol>
<p><strong>导入1860号仪表盘后，你会看到：</strong></p>
<ul>
<li>CPU使用率曲线</li>
<li>内存使用情况</li>
<li>磁盘IO</li>
<li>网络流量</li>
<li>系统负载</li>
<li>...</li>
</ul>
<p>非常全面，基本不用自己配置。</p>
<h3 data-id="heading-14">5.4 自定义仪表盘（进阶）</h3>
<p>如果想自定义，了解几个常用的PromQL查询：</p>
<p><strong>CPU使用率：</strong></p>
<pre><code class="hljs language-promql" lang="promql">100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)
</code></pre>
<p><strong>内存使用率：</strong></p>
<pre><code class="hljs language-promql" lang="promql">(1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100
</code></pre>
<p><strong>磁盘使用率：</strong></p>
<pre><code class="hljs language-promql" lang="promql">(1 - node_filesystem_avail_bytes{fstype!~"tmpfs|overlay"} / node_filesystem_size_bytes) * 100
</code></pre>
<p><strong>网络接收流量（MB/s）：</strong></p>
<pre><code class="hljs language-promql" lang="promql">irate(node_network_receive_bytes_total{device!~"lo|veth.*"}[5m]) / 1024 / 1024
</code></pre>
<p><strong>系统负载：</strong></p>
<pre><code class="hljs language-promql" lang="promql">node_load1  # 1分钟负载
node_load5  # 5分钟负载
node_load15 # 15分钟负载
</code></pre>
<hr/>
<h2 data-id="heading-15">六、监控更多服务</h2>
<h3 data-id="heading-16">6.1 监控 MySQL</h3>
<p>部署 <code>mysqld_exporter</code>：</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --name mysqld_exporter \
  --restart always \
  -p 9104:9104 \
  -e DATA_SOURCE_NAME=<span class="hljs-string">"exporter:密码@(mysql服务器:3306)/"</span> \
  prom/mysqld-exporter
</code></pre>
<p>在Prometheus配置中添加：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'mysql'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">'mysqld_exporter:9104'</span>]
</code></pre>
<p>Grafana仪表盘ID：7362</p>
<h3 data-id="heading-17">6.2 监控 Redis</h3>
<p>部署 <code>redis_exporter</code>：</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --name redis_exporter \
  --restart always \
  -p 9121:9121 \
  oliver006/redis_exporter \
  --redis.addr=redis://Redis服务器:6379
</code></pre>
<p>Prometheus配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'redis'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">'redis_exporter:9121'</span>]
</code></pre>
<p>Grafana仪表盘ID：763</p>
<h3 data-id="heading-18">6.3 监控 Nginx</h3>
<p>需要先开启Nginx的stub_status模块：</p>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 8080;
    location /nginx_status {
        stub_status;
        allow 127.0.0.1;
        deny all;
    }
}
</code></pre>
<p>部署 <code>nginx-prometheus-exporter</code>：</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --name nginx_exporter \
  --restart always \
  -p 9113:9113 \
  nginx/nginx-prometheus-exporter \
  -nginx.scrape-uri=http://Nginx服务器:8080/nginx_status
</code></pre>
<p>Grafana仪表盘ID：12708</p>
<h3 data-id="heading-19">6.4 监控 Docker 容器</h3>
<p>部署 <code>cAdvisor</code>：</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d \
  --name cadvisor \
  --restart always \
  -p 8080:8080 \
  -v /:/rootfs:ro \
  -v /var/run:/var/run:ro \
  -v /sys:/sys:ro \
  -v /var/lib/docker/:/var/lib/docker:ro \
  gcr.io/cadvisor/cadvisor:v0.47.0
</code></pre>
<p>Prometheus配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'cadvisor'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">'cadvisor:8080'</span>]
</code></pre>
<p>Grafana仪表盘ID：893</p>
<hr/>
<h2 data-id="heading-20">七、告警配置实战</h2>
<h3 data-id="heading-21">7.1 告警触发流程</h3>
<pre><code class="hljs">Prometheus采集指标 → 匹配告警规则 → 触发告警 → 发送到Alertmanager → 推送到钉钉/邮件
</code></pre>
<h3 data-id="heading-22">7.2 告警规则详解</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighCpuUsage</span>
  <span class="hljs-attr">expr:</span> <span class="hljs-number">100</span> <span class="hljs-bullet">-</span> <span class="hljs-string">(avg</span> <span class="hljs-string">by(instance)</span> <span class="hljs-string">(irate(node_cpu_seconds_total{mode="idle"}[5m]))</span> <span class="hljs-string">*</span> <span class="hljs-number">100</span><span class="hljs-string">)</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">80</span>
  <span class="hljs-attr">for:</span> <span class="hljs-string">5m</span>  <span class="hljs-comment"># 持续5分钟才告警，避免瞬时波动误报</span>
  <span class="hljs-attr">labels:</span>
    <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span>  <span class="hljs-comment"># 告警级别</span>
  <span class="hljs-attr">annotations:</span>
    <span class="hljs-attr">summary:</span> <span class="hljs-string">"CPU使用率过高"</span>
    <span class="hljs-attr">description:</span> <span class="hljs-string">"服务器 <span class="hljs-template-variable">{{ $labels.instance }}</span> CPU使用率超过80%"</span>
</code></pre>
<p><strong>关键参数：</strong></p>
<ul>
<li><code>expr</code>：PromQL表达式，满足条件则触发</li>
<li><code>for</code>：持续时间，防止抖动</li>
<li><code>labels</code>：标签，用于告警分组和路由</li>
<li><code>annotations</code>：告警内容描述</li>
</ul>
<h3 data-id="heading-23">7.3 告警分级路由</h3>
<p>在Alertmanager中配置不同级别告警发送到不同渠道：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">route:</span>
  <span class="hljs-attr">receiver:</span> <span class="hljs-string">'default'</span>
  <span class="hljs-attr">routes:</span>
    <span class="hljs-comment"># 严重告警发到运维群</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">match:</span>
        <span class="hljs-attr">severity:</span> <span class="hljs-string">critical</span>
      <span class="hljs-attr">receiver:</span> <span class="hljs-string">'ops-team'</span>
      <span class="hljs-attr">repeat_interval:</span> <span class="hljs-string">1h</span>
    
    <span class="hljs-comment"># 警告级别发到开发群</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">match:</span>
        <span class="hljs-attr">severity:</span> <span class="hljs-string">warning</span>
      <span class="hljs-attr">receiver:</span> <span class="hljs-string">'dev-team'</span>
      <span class="hljs-attr">repeat_interval:</span> <span class="hljs-string">4h</span>

<span class="hljs-attr">receivers:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'default'</span>
    <span class="hljs-attr">webhook_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">'http://dingtalk:8060/dingtalk/default/send'</span>
  
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'ops-team'</span>
    <span class="hljs-attr">webhook_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">'http://dingtalk:8060/dingtalk/ops/send'</span>
  
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">'dev-team'</span>
    <span class="hljs-attr">webhook_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">url:</span> <span class="hljs-string">'http://dingtalk:8060/dingtalk/dev/send'</span>
</code></pre>
<h3 data-id="heading-24">7.4 告警静默</h3>
<p>半夜发版不想收到告警？可以设置静默：</p>
<ol>
<li>访问 Alertmanager：<code>http://服务器IP:9093</code></li>
<li>点击 "Silences" → "New Silence"</li>
<li>设置匹配条件和静默时间</li>
</ol>
<hr/>
<h2 data-id="heading-25">八、远程监控方案</h2>
<p>如果你的服务器分布在不同地方（公司、家里、云上），怎么统一监控？</p>
<h3 data-id="heading-26">8.1 方案一：公网暴露（不推荐）</h3>
<p>把Prometheus的9090端口暴露到公网，不安全。</p>
<h3 data-id="heading-27">8.2 方案二：VPN（传统方案）</h3>
<p>配置复杂，维护成本高。</p>
<h3 data-id="heading-28">8.3 方案三：组网工具（推荐）</h3>
<p>我用的是<strong>星空组网</strong>，把分布在不同地方的服务器组成一个虚拟局域网：</p>
<ol>
<li>每台服务器装星空组网客户端</li>
<li>登录同一账号，加入同一网络</li>
<li>服务器互相之间可以用虚拟IP访问</li>
</ol>
<p><strong>配置Prometheus监控远程服务器：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'nodes'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">'10.26.1.10:9100'</span>  <span class="hljs-comment"># 公司服务器（虚拟IP）</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">'10.26.1.20:9100'</span>  <span class="hljs-comment"># 家里NAS（虚拟IP）</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">'10.26.1.30:9100'</span>  <span class="hljs-comment"># 云服务器（虚拟IP）</span>
</code></pre>
<p><strong>优势：</strong></p>
<ul>
<li>不用暴露端口到公网</li>
<li>配置简单，5分钟搞定</li>
<li>P2P直连，延迟低</li>
<li>免费版3设备够个人用</li>
</ul>
<p>这样在家也能看到公司服务器的监控数据，出差时也能随时查看。</p>
<hr/>
<h2 data-id="heading-29">九、性能优化</h2>
<h3 data-id="heading-30">9.1 Prometheus 存储优化</h3>
<p>默认配置下，Prometheus会把所有数据存本地。数据量大了会有问题。</p>
<p><strong>优化参数：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># docker-compose.yml 的 command 部分</span>
<span class="hljs-attr">command:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">'--storage.tsdb.retention.time=15d'</span>  <span class="hljs-comment"># 减少保留时间</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">'--storage.tsdb.retention.size=10GB'</span>  <span class="hljs-comment"># 限制存储大小</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">'--storage.tsdb.wal-compression'</span>      <span class="hljs-comment"># 开启WAL压缩</span>
</code></pre>
<h3 data-id="heading-31">9.2 采集频率优化</h3>
<p>不是所有指标都需要15秒采集一次：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-comment"># 核心服务，15秒采集</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'critical-nodes'</span>
    <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">15s</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">'核心服务器:9100'</span>]

  <span class="hljs-comment"># 非核心服务，1分钟采集</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'normal-nodes'</span>
    <span class="hljs-attr">scrape_interval:</span> <span class="hljs-string">60s</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">'普通服务器:9100'</span>]
</code></pre>
<h3 data-id="heading-32">9.3 Grafana 查询优化</h3>
<p>仪表盘卡顿？可能是查询太重：</p>
<ol>
<li>减少时间范围（从7天改成1天）</li>
<li>增加查询步长（Step）</li>
<li>使用 <code>rate()</code> 代替 <code>irate()</code>（更平滑，计算量小）</li>
</ol>
<hr/>
<h2 data-id="heading-33">十、踩过的坑</h2>
<h3 data-id="heading-34">坑1：时间不同步导致数据断层</h3>
<p><strong>现象：</strong> Grafana图表有断层，Prometheus显示"target is 5m in the future"</p>
<p><strong>原因：</strong> 被监控服务器时间比Prometheus快了5分钟</p>
<p><strong>解决：</strong> 所有服务器配置NTP同步</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Ubuntu</span>
apt install chrony
systemctl <span class="hljs-built_in">enable</span> chrony

<span class="hljs-comment"># 强制同步</span>
chronyc makestep
</code></pre>
<h3 data-id="heading-35">坑2：Docker网络内访问不通</h3>
<p><strong>现象：</strong> Prometheus采集不到容器内的Exporter</p>
<p><strong>原因：</strong> 网络模式问题</p>
<p><strong>解决：</strong> 确保所有容器在同一个Docker网络（monitoring）</p>
<h3 data-id="heading-36">坑3：Grafana仪表盘不显示数据</h3>
<p><strong>现象：</strong> 导入仪表盘后一片空白</p>
<p><strong>原因：</strong> 数据源名称不匹配</p>
<p><strong>解决：</strong> 仪表盘设置里把数据源改成你创建的名称</p>
<h3 data-id="heading-37">坑4：磁盘监控指标为空</h3>
<p><strong>现象：</strong> <code>node_filesystem_*</code> 指标没有数据</p>
<p><strong>原因：</strong> Node Exporter没有挂载宿主机文件系统</p>
<p><strong>解决：</strong> 用 <code>--path.rootfs=/host</code> 参数并挂载 <code>/:/host:ro</code></p>
<hr/>
<h2 data-id="heading-38">十一、生产环境 Checklist</h2>
<p>部署到生产环境前，检查这些：</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Prometheus数据持久化到宿主机目录</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> Grafana密码已修改</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 告警规则配置完成</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 告警通知渠道已测试</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 所有服务器时间已同步</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 监控系统本身也在被监控</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 定期备份Grafana配置</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 防火墙只开放必要端口</li>
</ul>
<hr/>
<h2 data-id="heading-39">十二、总结</h2>
<p>Prometheus + Grafana 这套组合，基本是现在监控的事实标准。</p>
<p><strong>核心要点：</strong></p>
<ol>
<li><strong>架构</strong>：Prometheus采集 + Grafana展示 + Alertmanager告警</li>
<li><strong>部署</strong>：推荐Docker Compose，方便管理</li>
<li><strong>仪表盘</strong>：直接导入社区模板，省时省力</li>
<li><strong>告警</strong>：规则要合理，避免告警风暴</li>
<li><strong>远程监控</strong>：用组网工具打通不同地点的服务器</li>
</ol>
<p><strong>下一步可以做的：</strong></p>
<ul>
<li>接入更多服务监控（MySQL、Redis、应用指标）</li>
<li>配置更完善的告警规则</li>
<li>搭建高可用集群（Thanos/Cortex）</li>
</ul>
<p>有问题评论区讨论，我尽量回复。</p>
<hr/>
<p><strong>参考资料：</strong></p>
<ul>
<li>Prometheus官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fprometheus.io%2Fdocs%2F" target="_blank" title="https://prometheus.io/docs/" ref="nofollow noopener noreferrer">prometheus.io/docs/</a></li>
<li>Grafana官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgrafana.com%2Fdocs%2F" target="_blank" title="https://grafana.com/docs/" ref="nofollow noopener noreferrer">grafana.com/docs/</a></li>
<li>Node Exporter GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fprometheus%2Fnode_exporter" target="_blank" title="https://github.com/prometheus/node_exporter" ref="nofollow noopener noreferrer">github.com/prometheus/…</a></li>
</ul>
<pre><code class="hljs"/></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL - 一文理清存储引擎：InnoDB vs MyISAM 核心差异]]></title>    <link>https://juejin.cn/post/7578901433970327552</link>    <guid>https://juejin.cn/post/7578901433970327552</guid>    <pubDate>2025-12-02T06:37:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578901433970327552" data-draft-id="7578820431040397352" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL - 一文理清存储引擎：InnoDB vs MyISAM 核心差异"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T06:37:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL - 一文理清存储引擎：InnoDB vs MyISAM 核心差异
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:37:44.000Z" title="Tue Dec 02 2025 06:37:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MySQL - 一文理清存储引擎：InnoDB vs MyISAM 核心差异 🧠</h2>
<p>在使用 MySQL 数据库时，我们常常会遇到一个基础但至关重要的选择：<strong>使用哪种存储引擎？</strong>  虽然 MySQL 支持多种存储引擎（如 MEMORY、CSV、ARCHIVE 等），但在实际生产环境中，最常被拿来比较和使用的无疑是 <strong>InnoDB</strong> 和 <strong>MyISAM</strong>。这两种引擎不仅历史悠久，而且各自代表了不同的设计哲学与应用场景。</p>
<p>本文将从多个维度深入剖析 InnoDB 与 MyISAM 的核心差异，涵盖事务支持、锁机制、崩溃恢复、索引结构、性能表现、适用场景等，并辅以 Java 示例代码、Mermaid 图表以及权威外部参考资料，帮助你彻底理清两者的区别，做出更合理的技术选型决策。💡</p>
<hr/>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>存储引擎是什么？🧱</h3>
<p>在 MySQL 中，<strong>存储引擎</strong>（Storage Engine）负责数据的物理存储、检索和管理。你可以把 MySQL 想象成一个“操作系统”，而存储引擎则是其底层的“文件系统”。不同的存储引擎提供了不同的功能特性，比如是否支持事务、是否支持外键、如何处理并发读写等。</p>
<p>MySQL 默认使用 <strong>InnoDB</strong> 作为其默认存储引擎（自 MySQL 5.5 起）。在此之前，默认是 <strong>MyISAM</strong>。这一转变本身就说明了行业对数据一致性、可靠性和并发处理能力需求的提升。</p>
<blockquote>
<p>✅ <strong>小知识</strong>：你可以通过 <code>SHOW ENGINES;</code> 查看当前 MySQL 实例支持的所有存储引擎及其状态。</p>
</blockquote>
<pre><code class="hljs language-sql" lang="sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">SHOW</span> ENGINES;
<span class="hljs-operator">+</span><span class="hljs-comment">--------------------+---------+----------------------------------------------------------------+</span>
<span class="hljs-operator">|</span> Engine             <span class="hljs-operator">|</span> Support <span class="hljs-operator">|</span> Comment                                                        <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">--------------------+---------+----------------------------------------------------------------+</span>
<span class="hljs-operator">|</span> InnoDB             <span class="hljs-operator">|</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-operator">|</span> Supports transactions, <span class="hljs-type">row</span><span class="hljs-operator">-</span>level locking, <span class="hljs-keyword">and</span> <span class="hljs-keyword">foreign</span> keys     <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> MyISAM             <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> MyISAM storage engine                                          <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> MEMORY             <span class="hljs-operator">|</span> YES     <span class="hljs-operator">|</span> Hash based, stored <span class="hljs-keyword">in</span> memory, useful <span class="hljs-keyword">for</span> temporary tables      <span class="hljs-operator">|</span>
...

AI写代码<span class="hljs-keyword">sql</span>
<span class="hljs-number">12345678</span>
</code></pre>
<hr/>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 事务支持：ACID vs 无事务 ⚖️</h3>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>InnoDB：支持完整 ACID 事务</h4>
<p>InnoDB 是 <strong>事务安全</strong>（transaction-safe）的存储引擎，完全支持 <strong>ACID</strong> 四大特性：</p>
<ul>
<li><strong>Atomicity（原子性）</strong> ：事务中的所有操作要么全部成功，要么全部失败回滚。</li>
<li><strong>Consistency（一致性）</strong> ：事务执行前后，数据库从一个一致状态转移到另一个一致状态。</li>
<li><strong>Isolation（隔离性）</strong> ：多个事务并发执行时互不干扰。</li>
<li><strong>Durability（持久性）</strong> ：一旦事务提交，其结果永久保存，即使系统崩溃也不会丢失。</li>
</ul>
<p>这使得 InnoDB 成为金融、电商、订单系统等对数据一致性要求极高的场景的首选。</p>
<h4 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>MyISAM：不支持事务</h4>
<p>MyISAM <strong>完全不支持事务</strong>。这意味着：</p>
<ul>
<li>无法回滚（ROLLBACK）；</li>
<li>无法保证多个操作的原子性；</li>
<li>在写入过程中若发生崩溃，可能导致数据损坏或不一致。</li>
</ul>
<p>虽然 MyISAM 在某些只读或轻量级写入场景下性能优异，但缺乏事务支持使其难以胜任现代应用的核心数据存储。</p>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>Java 示例：事务回滚对比</h4>
<p>假设我们有一个用户余额转账的场景：</p>
<h5 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>使用 InnoDB（支持事务）</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.sql.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InnoDBTransactionExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"jdbc:mysql://localhost:3306/testdb?useSSL=false&amp;serverTimezone=UTC"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-string">"root"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">"password"</span>;

        <span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> DriverManager.getConnection(url, user, password)) {
            conn.setAutoCommit(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 关闭自动提交</span>

            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 扣减 A 用户余额</span>
                <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps1</span> <span class="hljs-operator">=</span> conn.prepareStatement(<span class="hljs-string">"UPDATE accounts SET balance = balance - 100 WHERE user_id = ?"</span>);
                ps1.setInt(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
                ps1.executeUpdate();

                <span class="hljs-comment">// 增加 B 用户余额</span>
                <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps2</span> <span class="hljs-operator">=</span> conn.prepareStatement(<span class="hljs-string">"UPDATE accounts SET balance = balance + 100 WHERE user_id = ?"</span>);
                ps2.setInt(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
                ps2.executeUpdate();

                <span class="hljs-comment">// 模拟异常：人为抛出异常触发回滚</span>
                <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"模拟转账失败！"</span>);

                conn.commit(); <span class="hljs-comment">// 提交事务</span>
                System.out.println(<span class="hljs-string">"转账成功！"</span>);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                conn.rollback(); <span class="hljs-comment">// 回滚事务</span>
                System.out.println(<span class="hljs-string">"转账失败，已回滚："</span> + e.getMessage());
            }
        } <span class="hljs-keyword">catch</span> (SQLException e) {
            e.printStackTrace();
        }
    }
}

AI写代码java
运行
<span class="hljs-number">123456789101112131415161718192021222324252627282930313233343536</span>
</code></pre>
<blockquote>
<p>✅ 如果 <code>accounts</code> 表使用的是 InnoDB 引擎，上述代码能确保即使第二步失败，第一步的扣款也会被回滚，保持数据一致性。</p>
</blockquote>
<h5 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>使用 MyISAM（无事务）</h5>
<p>如果 <code>accounts</code> 表使用的是 MyISAM 引擎，即使你在 Java 中调用 <code>conn.rollback()</code>，<strong>MySQL 也不会真正回滚</strong>！因为 MyISAM 不支持事务。结果可能是：A 用户的钱被扣了，但 B 用户没收到，造成资金损失 💸。</p>
<blockquote>
<p>🚫 <strong>结论</strong>：涉及资金、库存、状态变更等关键业务，必须使用 InnoDB。</p>
</blockquote>
<hr/>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 锁机制：行锁 vs 表锁 🔒</h3>
<p>锁机制直接影响数据库的并发性能。</p>
<h4 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>InnoDB：支持行级锁（Row-Level Locking）</h4>
<p>InnoDB 在执行 DML（INSERT/UPDATE/DELETE）操作时，默认使用 <strong>行级锁</strong>。这意味着：</p>
<ul>
<li>多个事务可以同时修改不同行的数据，互不阻塞；</li>
<li>并发写入能力强，适合高并发 OLTP（在线事务处理）系统。</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 事务A</span>
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 事务B</span>
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Bob'</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

AI写代码<span class="hljs-keyword">sql</span>
<span class="hljs-number">12345</span>
</code></pre>
<p>在 InnoDB 中，这两个 UPDATE 可以并行执行，因为它们锁定的是不同行。</p>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>MyISAM：仅支持表级锁（Table-Level Locking）</h4>
<p>MyISAM 在执行任何写操作（INSERT/UPDATE/DELETE）时，都会对整个表加锁。这意味着：</p>
<ul>
<li>同一时刻只能有一个写操作；</li>
<li>读操作可以并发，但写操作会阻塞所有其他读写操作；</li>
<li>在高并发写入场景下，性能急剧下降。</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 事务A（写）</span>
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 事务B（读）</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;

AI写代码<span class="hljs-keyword">sql</span>
<span class="hljs-number">12345</span>
</code></pre>
<p>在 MyISAM 中，事务B会被阻塞，直到事务A完成写入并释放表锁。</p>
<h4 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>并发性能对比图（Mermaid）</h4>
<pre><code class="hljs language-css" lang="css">graph LR
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[高并发写入场景]</span> --&gt; <span class="hljs-selector-tag">B</span>{存储引擎}
    <span class="hljs-selector-tag">B</span> --&gt;|InnoDB| C<span class="hljs-selector-attr">[行级锁&lt;br/&gt;多事务并行修改不同行&lt;br/&gt;✅ 高并发]</span>
    <span class="hljs-selector-tag">B</span> --&gt;|MyISAM| D<span class="hljs-selector-attr">[表级锁&lt;br/&gt;写操作阻塞全表&lt;br/&gt;❌ 低并发]</span>

AI写代码mermaid
<span class="hljs-number">1234</span>
</code></pre>
<blockquote>
<p>📌 <strong>提示</strong>：即使 MyISAM 的 SELECT 很快，但一旦有写入，所有查询都可能排队等待。</p>
</blockquote>
<hr/>
<h3 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. 崩溃恢复与数据安全性 🛡️</h3>
<h4 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>InnoDB：具备崩溃恢复能力（Crash Recovery）</h4>
<p>InnoDB 使用 <strong>重做日志</strong>（Redo Log）和 <strong>回滚段</strong>（Undo Log）来实现崩溃恢复：</p>
<ul>
<li>Redo Log 记录已提交事务的物理修改，用于在崩溃后重放，确保持久性；</li>
<li>Undo Log 用于回滚未提交事务，并支持 MVCC（多版本并发控制）。</li>
</ul>
<p>即使 MySQL 服务意外宕机，InnoDB 也能在重启时自动恢复到一致状态，<strong>极大降低数据丢失风险</strong>。</p>
<h4 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>MyISAM：无崩溃恢复机制</h4>
<p>MyISAM 没有事务日志，数据直接写入磁盘文件（<code>.MYD</code> 数据文件 + <code>.MYI</code> 索引文件）。如果在写入过程中发生断电或崩溃：</p>
<ul>
<li>可能导致表损坏（corruption）；</li>
<li>需要手动运行 <code>REPAIR TABLE</code> 或 <code>myisamchk</code> 工具修复；</li>
<li>修复过程耗时且可能丢失数据。</li>
</ul>
<blockquote>
<p>📚 官方文档指出：MyISAM 表在崩溃后“可能需要修复”，而 InnoDB 则“自动恢复”。</p>
</blockquote>
<hr/>
<h3 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4. 外键支持：关系完整性保障 🤝</h3>
<h4 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>InnoDB：支持外键约束（Foreign Key）</h4>
<p>InnoDB 支持在表之间定义外键，强制维护<strong>引用完整性</strong>。例如：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    user_id <span class="hljs-type">INT</span>,
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>),
    <span class="hljs-keyword">FOREIGN</span> KEY (user_id) <span class="hljs-keyword">REFERENCES</span> users(id)
) ENGINE<span class="hljs-operator">=</span>InnoDB;

AI写代码<span class="hljs-keyword">sql</span>
<span class="hljs-number">123456</span>
</code></pre>
<p>这样，当你尝试插入一个不存在的 <code>user_id</code> 时，MySQL 会拒绝该操作，防止“孤儿订单”。</p>
<p>此外，外键还支持级联操作（CASCADE）：</p>
<ul>
<li><code>ON DELETE CASCADE</code>：删除用户时自动删除其所有订单；</li>
<li><code>ON UPDATE CASCADE</code>：更新用户 ID 时同步更新订单中的 user_id。</li>
</ul>
<h4 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>MyISAM：不支持外键</h4>
<p>MyISAM <strong>完全忽略</strong> <code>FOREIGN KEY</code> 语法（即使你写了，MySQL 也会静默忽略）。这意味着：</p>
<ul>
<li>无法通过数据库层面保证数据一致性；</li>
<li>必须在应用层手动校验关联关系，增加开发复杂度和出错概率。</li>
</ul>
<blockquote>
<p>💡 <strong>建议</strong>：如果你的应用依赖表间关系（如用户-订单、文章-评论），请务必使用 InnoDB。</p>
</blockquote>
<hr/>
<h3 data-id="heading-18"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5. 索引结构：B+Tree vs 全表扫描优化 📚</h3>
<p>虽然 InnoDB 和 MyISAM 都使用 <strong>B+Tree</strong> 作为索引结构，但实现方式有本质区别。</p>
<h4 data-id="heading-19"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>InnoDB：聚簇索引（Clustered Index）</h4>
<ul>
<li><strong>主键索引即数据本身</strong>：InnoDB 将表数据按主键顺序物理存储，主键索引的叶子节点直接包含行数据。</li>
<li><strong>二级索引包含主键值</strong>：非主键索引（Secondary Index）的叶子节点存储的是主键值，查询时需“回表”查找完整数据。</li>
</ul>
<p>优点：</p>
<ul>
<li>主键查询极快（无需额外 I/O）；</li>
<li>范围查询高效（数据物理有序）。</li>
</ul>
<p>缺点：</p>
<ul>
<li>插入性能受主键顺序影响（最好使用自增 ID）；</li>
<li>二级索引查询需两次查找（先查索引，再查主键）。</li>
</ul>
<h4 data-id="heading-20"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>MyISAM：非聚簇索引（Non-Clustered Index）</h4>
<ul>
<li><strong>索引与数据分离</strong>：<code>.MYI</code> 文件存索引，<code>.MYD</code> 文件存数据；</li>
<li>所有索引（包括主键）的叶子节点都存储指向数据行的<strong>物理地址</strong>（指针）。</li>
</ul>
<p>优点：</p>
<ul>
<li>索引结构简单；</li>
<li>COUNT(*) 查询极快（直接读取表元数据中的行数缓存）。</li>
</ul>
<p>缺点：</p>
<ul>
<li>主键查询需两次 I/O（先查索引指针，再读数据）；</li>
<li>数据无序存储，范围查询效率较低。</li>
</ul>
<h4 data-id="heading-21"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>COUNT(*) 性能差异</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- MyISAM：O(1) 时间复杂度（直接返回缓存的行数）</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> myisam_table;

<span class="hljs-comment">-- InnoDB：O(n) 时间复杂度（需扫描聚簇索引）</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> innodb_table;

AI写代码<span class="hljs-keyword">sql</span>
<span class="hljs-number">12345</span>
</code></pre>
<blockquote>
<p>⚠️ 注意：InnoDB 的 <code>COUNT(*)</code> 在无 WHERE 条件时较慢，但可通过添加覆盖索引优化。</p>
</blockquote>
<hr/>
<h3 data-id="heading-22"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6. 全文索引（Full-Text Search）🔍</h3>
<p>历史上，MyISAM 是唯一支持全文索引的引擎。但从 <strong>MySQL 5.6 开始，InnoDB 也支持全文索引</strong>。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- InnoDB 全文索引（MySQL 5.6+）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> articles (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">200</span>),
    content TEXT,
    FULLTEXT(title, content)
) ENGINE<span class="hljs-operator">=</span>InnoDB;

AI写代码<span class="hljs-keyword">sql</span>
<span class="hljs-number">1234567</span>
</code></pre>
<p>因此，<strong>全文搜索不再是 MyISAM 的专属优势</strong>。除非你使用的是非常老的 MySQL 版本（&lt;5.6），否则无需为此选择 MyISAM。</p>
<hr/>
<h3 data-id="heading-23"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7. 存储空间与压缩 💾</h3>
<h4 data-id="heading-24"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>InnoDB</h4>
<ul>
<li>占用更多磁盘空间（因需存储事务日志、回滚信息、双写缓冲等）；</li>
<li>支持表压缩（需开启 <code>innodb_file_per_table</code> 和压缩算法）；</li>
<li>行格式可配置（COMPACT、DYNAMIC、REDUNDANT）。</li>
</ul>
<h4 data-id="heading-25"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>MyISAM</h4>
<ul>
<li>存储更紧凑；</li>
<li>支持表级压缩（使用 <code>myisampack</code> 工具），但压缩后表变为只读。</li>
</ul>
<blockquote>
<p>📊 一般情况下，InnoDB 表比 MyISAM 表大约大 20%~30%，但换来的是事务、崩溃恢复等关键能力。</p>
</blockquote>
<hr/>
<h3 data-id="heading-26"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>8. 缓存机制：Buffer Pool vs Key Buffer 🧠</h3>
<h4 data-id="heading-27"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>InnoDB：使用 Buffer Pool</h4>
<ul>
<li>缓存<strong>数据页 + 索引页</strong>；</li>
<li>通过 LRU 算法管理内存；</li>
<li>可配置大小（<code>innodb_buffer_pool_size</code>），通常设为物理内存的 50%~75%。</li>
</ul>
<h4 data-id="heading-28"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>MyISAM：使用 Key Buffer</h4>
<ul>
<li>仅缓存<strong>索引块</strong>；</li>
<li>数据缓存依赖操作系统文件缓存；</li>
<li>配置参数为 <code>key_buffer_size</code>。</li>
</ul>
<blockquote>
<p>📌 对于频繁访问的数据，InnoDB 的 Buffer Pool 能显著减少磁盘 I/O，提升整体性能。</p>
</blockquote>
<hr/>
<h3 data-id="heading-29"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>9. 适用场景总结 🎯</h3>








































<table><thead><tr><th>场景</th><th>推荐引擎</th><th>理由</th></tr></thead><tbody><tr><td>电商、金融、订单系统</td><td>✅ InnoDB</td><td>需要事务、外键、高并发写入</td></tr><tr><td>日志记录、只读报表</td><td>⚠️ MyISAM（或考虑 Archive）</td><td>写入少、读多、无需事务</td></tr><tr><td>高频 COUNT(*) 统计</td><td>⚠️ MyISAM</td><td>O(1) 返回行数</td></tr><tr><td>全文搜索（MySQL ≥5.6）</td><td>✅ InnoDB</td><td>已支持全文索引</td></tr><tr><td>高并发 OLTP 应用</td><td>✅ InnoDB</td><td>行锁 + MVCC 支持高并发</td></tr><tr><td>临时数据分析表</td><td>⚠️ MyISAM / MEMORY</td><td>快速创建、无需持久化</td></tr></tbody></table>
<blockquote>
<p>❗ <strong>重要提醒</strong>：随着硬件成本下降和 MySQL 优化进步，<strong>MyISAM 的优势场景越来越少</strong>。除非你有非常明确的只读、高速 COUNT 需求，否则默认选择 InnoDB 更安全、更通用。</p>
</blockquote>
<hr/>
<h3 data-id="heading-30"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>10. Java 应用中的最佳实践 🛠️</h3>
<h4 data-id="heading-31"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 显式指定存储引擎（建表时）</h4>
<pre><code class="hljs language-ini" lang="ini">String <span class="hljs-attr">createTableSQL</span> = <span class="hljs-string">"""
    CREATE TABLE products (
        id BIGINT AUTO_INCREMENT PRIMARY KEY,
        name VARCHAR(255) NOT NULL,
        price DECIMAL(10,2),
        INDEX idx_name (name)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
    """</span><span class="hljs-comment">;</span>

AI写代码java
运行
12345678
</code></pre>
<h4 data-id="heading-32"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 使用连接池 + 事务管理（Spring Boot 示例）</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Service</span>
<span class="hljs-variable">@Transactional</span> <span class="hljs-comment">// Spring 自动管理 InnoDB 事务</span>
public class OrderService {

    <span class="hljs-variable">@Autowired</span>
    private JdbcTemplate jdbcTemplate;

    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">transfer</span>(Long fromUserId, Long toUserId, BigDecimal amount) {
        <span class="hljs-selector-tag">jdbcTemplate</span><span class="hljs-selector-class">.update</span>(<span class="hljs-string">"UPDATE accounts SET balance = balance - ? WHERE user_id = ?"</span>, amount, fromUserId);
        <span class="hljs-selector-tag">jdbcTemplate</span><span class="hljs-selector-class">.update</span>(<span class="hljs-string">"UPDATE accounts SET balance = balance + ? WHERE user_id = ?"</span>, amount, toUserId);
        <span class="hljs-comment">// 若异常，Spring 自动回滚</span>
    }
}

<span class="hljs-selector-tag">AI</span>写代码<span class="hljs-selector-tag">java</span>
运行
<span class="hljs-number">12345678910111213</span>
</code></pre>
<h4 data-id="heading-33"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. 避免在 MyISAM 表上使用事务注解</h4>
<p>如果你不小心在 MyISAM 表上使用了 <code>@Transactional</code>，Spring 不会报错，但<strong>事务不会生效</strong>！务必确认表引擎。</p>
<hr/>
<h3 data-id="heading-34"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>11. 如何查看和转换存储引擎？🔧</h3>
<h4 data-id="heading-35"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>查看表引擎</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users;
<span class="hljs-comment">-- 或</span>
<span class="hljs-keyword">SELECT</span> ENGINE <span class="hljs-keyword">FROM</span> information_schema.TABLES 
<span class="hljs-keyword">WHERE</span> TABLE_SCHEMA <span class="hljs-operator">=</span> <span class="hljs-string">'your_db'</span> <span class="hljs-keyword">AND</span> TABLE_NAME <span class="hljs-operator">=</span> <span class="hljs-string">'users'</span>;

AI写代码<span class="hljs-keyword">sql</span>
<span class="hljs-number">1234</span>
</code></pre>
<h4 data-id="heading-36"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>转换引擎（谨慎操作！）</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 将 MyISAM 表转为 InnoDB</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> your_table ENGINE<span class="hljs-operator">=</span>InnoDB;

AI写代码<span class="hljs-keyword">sql</span>
<span class="hljs-number">12</span>
</code></pre>
<blockquote>
<p>⚠️ 转换过程会重建整张表，大表操作需在低峰期进行，并预留足够磁盘空间。</p>
</blockquote>
<hr/>
<h3 data-id="heading-37"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>12. 常见误区澄清 ❌</h3>
<h4 data-id="heading-38"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>误区1：“MyISAM 比 InnoDB 快”</h4>
<ul>
<li><strong>部分正确</strong>：在纯读、无并发写、简单 COUNT 场景下，MyISAM 可能更快；</li>
<li><strong>但现实应用中</strong>：InnoDB 的 Buffer Pool、行锁、MVCC 等机制使其在大多数场景下综合性能更优。</li>
</ul>
<h4 data-id="heading-39"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>误区2：“InnoDB 占用太多内存”</h4>
<ul>
<li>是的，InnoDB 需要配置 <code>innodb_buffer_pool_size</code>；</li>
<li>但这是<strong>值得的投资</strong>，合理的内存配置能极大提升性能。</li>
</ul>
<h4 data-id="heading-40"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>误区3：“MyISAM 适合大数据量”</h4>
<ul>
<li>错！MyISAM 表越大，崩溃后修复时间越长；</li>
<li>InnoDB 的分区、压缩、并行查询更适合大数据场景。</li>
</ul>
<hr/>
<h3 data-id="heading-41"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>结语：选择 InnoDB，拥抱未来 🌟</h3>
<p>InnoDB 和 MyISAM 的差异，本质上是  <strong>“可靠性优先” vs “简单快速”</strong>  的设计哲学之争。在当今分布式、高并发、强一致性的应用架构下，<strong>InnoDB 几乎是唯一合理的选择</strong>。</p>
<p>MyISAM 并未消失，它仍有其 niche 场景（如只读维表、历史归档），但作为新项目的默认选项，<strong>InnoDB 是更安全、更强大、更面向未来的选择</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用户密码安全存储：Go 实现 SM3 哈希加盐]]></title>    <link>https://juejin.cn/post/7578797337868550178</link>    <guid>https://juejin.cn/post/7578797337868550178</guid>    <pubDate>2025-12-02T06:37:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578797337868550178" data-draft-id="7578853751530127375" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用户密码安全存储：Go 实现 SM3 哈希加盐"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T06:37:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="今天也很困"/> <meta itemprop="url" content="https://juejin.cn/user/1286850568007976"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用户密码安全存储：Go 实现 SM3 哈希加盐
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1286850568007976/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    今天也很困
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:37:21.000Z" title="Tue Dec 02 2025 06:37:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>前言</strong></h2>
<p>在现代 Web 系统中，<strong>用户密码安全存储</strong>是非常关键的一环。<br/>
传统做法用简单哈希，容易受到彩虹表攻击。</p>
<p>本文将介绍如何使用 <strong>SM3 哈希算法 + 随机盐 (salt)</strong> 来加密用户密码，并提供 Go 语言实现示例。</p>
<hr/>
<h2 data-id="heading-1"><strong>一、为什么要加盐 (Salt)</strong></h2>
<p>直接哈希密码存在以下问题：</p>
<ol>
<li>
<p><strong>彩虹表攻击</strong></p>
<ul>
<li>攻击者可以通过预先计算的哈希表快速破解常用密码。</li>
</ul>
</li>
<li>
<p><strong>相同密码哈希值相同</strong></p>
<ul>
<li>用户 A 和用户 B 使用相同密码，会生成相同哈希值，增加泄露风险。</li>
</ul>
</li>
</ol>
<p><strong>解决方案</strong>：<br/>
在密码哈希前增加随机盐 (Salt)，每个用户的密码哈希值都不同，即使密码相同也不会重复。</p>
<hr/>
<h2 data-id="heading-2"><strong>二、SM3 哈希算法</strong></h2>
<p>SM3 是中国国家标准的哈希算法（国密算法），具有：</p>
<ul>
<li>输出长度 256 位</li>
<li>安全性高，适用于密码存储</li>
<li>广泛应用于金融和安全系统</li>
</ul>
<p>在 Go 中可以使用 <code>github.com/tjfoc/gmsm/sm3</code> 来实现 SM3 哈希。</p>
<hr/>
<h2 data-id="heading-3"><strong>三、Go 实现用户密码加密</strong></h2>
<p>下面是一套完整的 SM3 密码加密方案：</p>
<h3 data-id="heading-4"><strong>1. 生成随机盐</strong></h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">generateSalt</span><span class="hljs-params">()</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    b := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">16</span>) <span class="hljs-comment">// 16字节随机盐</span>
    <span class="hljs-keyword">if</span> _, err := rand.Read(b); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err
    }
    <span class="hljs-keyword">return</span> hex.EncodeToString(b), <span class="hljs-literal">nil</span>
}
</code></pre>
<ul>
<li>使用 <code>crypto/rand</code> 生成安全随机数</li>
<li>转为十六进制字符串存储</li>
</ul>
<hr/>
<h3 data-id="heading-5"><strong>2. SM3 哈希函数</strong></h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sm3Hash</span><span class="hljs-params">(password, salt <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">string</span> {
    h := sm3.New()
    h.Write([]<span class="hljs-type">byte</span>(password + salt))
    <span class="hljs-keyword">return</span> hex.EncodeToString(h.Sum(<span class="hljs-literal">nil</span>))
}
</code></pre>
<ul>
<li>将密码和盐拼接后进行 SM3 哈希</li>
<li>返回十六进制字符串</li>
</ul>
<hr/>
<h3 data-id="heading-6"><strong>3. 生成哈希密码</strong></h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HashPassword</span><span class="hljs-params">(password <span class="hljs-type">string</span>)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    salt, err := generateSalt()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err
    }
    hash := sm3Hash(password, salt)
    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"sm3$v1$%s$%s"</span>, salt, hash), <span class="hljs-literal">nil</span>
}
</code></pre>
<ul>
<li>存储格式为：<code>sm3$v1$&lt;salt_hex&gt;$&lt;hash_hex&gt;</code></li>
<li>包含算法标识、版本、盐和哈希值，便于版本升级和兼容不同算法</li>
</ul>
<hr/>
<h3 data-id="heading-7"><strong>4. 验证密码</strong></h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CheckPassword</span><span class="hljs-params">(dbPassword, inputPassword <span class="hljs-type">string</span>)</span></span> (<span class="hljs-type">bool</span>, <span class="hljs-type">error</span>) {
    parts := strings.Split(dbPassword, <span class="hljs-string">"$"</span>)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(parts) != <span class="hljs-number">4</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, errors.New(<span class="hljs-string">"hash 格式不正确"</span>)
    }
    _, version, salt, hash := parts[<span class="hljs-number">0</span>], parts[<span class="hljs-number">1</span>], parts[<span class="hljs-number">2</span>], parts[<span class="hljs-number">3</span>]
    <span class="hljs-keyword">if</span> version != <span class="hljs-string">"v1"</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, errors.New(<span class="hljs-string">"不支持的版本"</span>)
    }
    calculatedHash := sm3Hash(inputPassword, salt)
    <span class="hljs-keyword">return</span> calculatedHash == hash, <span class="hljs-literal">nil</span>
}
</code></pre>
<ul>
<li>从数据库中取出存储的哈希</li>
<li>提取盐和版本信息</li>
<li>对输入密码进行同样哈希并对比</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>5. 可扩展支持多种算法</strong></h3>
<p>代码中还可以支持 <code>bcrypt</code> 或其他哈希算法：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CheckPassword</span><span class="hljs-params">(dbPassword, inputPassword, hashAlgo <span class="hljs-type">string</span>)</span></span> (<span class="hljs-type">bool</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">switch</span> hashAlgo {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"bcrypt"</span>:
        <span class="hljs-keyword">return</span> bcrypt.CompareHashAndPassword([]<span class="hljs-type">byte</span>(dbPassword), []<span class="hljs-type">byte</span>(inputPassword)) == <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">"sm3"</span>:
        <span class="hljs-keyword">return</span> CheckPassword(dbPassword, inputPassword)
    <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>, errors.New(<span class="hljs-string">"未知 hash 算法"</span>)
    }
}
</code></pre>
<ul>
<li>方便未来系统迁移或混合使用多种哈希方案</li>
</ul>
<hr/>
<h2 data-id="heading-9"><strong>四、完整示例</strong></h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    password := <span class="hljs-string">"123456"</span>
    
    hash, _ := HashPassword(password)
    fmt.Println(<span class="hljs-string">"存储密码:"</span>, hash)
    
    ok, _ := CheckPassword(hash, password)
    fmt.Println(<span class="hljs-string">"验证密码:"</span>, ok)
}
</code></pre>
<p>输出示例：</p>
<pre><code class="hljs language-ruby" lang="ruby">存储密码: sm3<span class="hljs-variable">$v</span>1<span class="hljs-variable">$e2a3f4</span>...<span class="hljs-variable">$9f8d7c</span>...
验证密码: <span class="hljs-literal">true</span>
</code></pre>
<hr/>
<h2 data-id="heading-10"><strong>五、小结</strong></h2>
<ul>
<li><strong>使用 SM3 + 随机盐</strong>，可以安全存储用户密码</li>
<li><strong>存储格式建议包含算法和版本号</strong>，便于升级</li>
<li><strong>密码验证时只需从数据库取出盐和哈希值</strong>即可</li>
<li>结合 Go 的标准库和 <code>gmsm/sm3</code>，可以快速落地</li>
</ul>
<blockquote>
<p>使用 SM3 哈希和盐的方式，能有效抵御彩虹表攻击和密码重复泄露风险，是企业级系统密码安全存储的可靠方案。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vitest 一个基于 Vite 的快速单元测试框架]]></title>    <link>https://juejin.cn/post/7578811288819908651</link>    <guid>https://juejin.cn/post/7578811288819908651</guid>    <pubDate>2025-12-02T06:16:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578811288819908651" data-draft-id="7578787344613146660" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vitest 一个基于 Vite 的快速单元测试框架"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-02T06:16:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Bacon"/> <meta itemprop="url" content="https://juejin.cn/user/589804532932286"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vitest 一个基于 Vite 的快速单元测试框架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/589804532932286/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Bacon
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:16:13.000Z" title="Tue Dec 02 2025 06:16:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、Vitest 是什么？一句话概括</h3>
<p><strong>Vitest 是一个基于 Vite 的快速单元测试框架。</strong></p>
<p>你可以把它理解为  <strong>“测试界的 Vite”</strong> ​ 。它继承了 Vite 的所有优点：极快的启动速度、热更新（HMR）等，并将其应用到了测试领域。</p>
<hr/>
<h3 data-id="heading-1">二、核心优势：为什么选择 Vitest？</h3>
<p>为了让你更直观地理解，我们先看一张核心优势图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abd37fa9bfbe48958eb7699f151dc80e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFjb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260973&amp;x-signature=b6Aehjpeu0U92zfDEbcZC2YO1MY%3D" alt="image.png" loading="lazy"/></p>
<p>下面我们来详细解释这些优势：</p>
<ol>
<li>
<p><strong>⚡️ 极致的速度</strong></p>
<ul>
<li><strong>原理</strong>：和 Vite 一样，Vitest 使用 <code>esbuild</code>来编译 TypeScript/JSX，这比 Jest 使用的 <code>tsc</code>或 <code>babel</code>要快得多。</li>
<li><strong>效果</strong>：无论是启动测试、还是运行测试，速度都非常快。</li>
</ul>
</li>
<li>
<p><strong>🔗 与 Vite 项目无缝集成</strong></p>
<ul>
<li><strong>配置共享</strong>：你的 <code>vite.config.ts</code>中的插件、解析器别名（alias）、环境变量等配置，Vitest 都可以直接使用。无需为测试环境再写一套复杂的配置。</li>
<li><strong>一致性</strong>：保证了你的代码在开发、构建、测试三个环节的行为完全一致。</li>
</ul>
</li>
<li>
<p><strong>👨‍💻 出色的开发者体验（DX）</strong></p>
<ul>
<li><strong>智能监视模式</strong>：这是最大的亮点！当你修改代码后，Vitest 会智能地<strong>只重新运行与之相关的测试</strong>，而不是整个测试套件，就像测试的“热重载”。</li>
<li><strong>内置支持</strong>：开箱即用支持 TypeScript、JSX、ESM，无需额外配置。</li>
</ul>
</li>
<li>
<p><strong>🔄 高度兼容 Jest 生态</strong></p>
<ul>
<li><strong>API 兼容</strong>：如果你熟悉 Jest，那么上手 Vitest 几乎零成本。它支持 <code>describe</code>, <code>test</code>, <code>expect</code>, <code>jest.fn()</code>等语法。</li>
<li><strong>生态兼容</strong>：支持 Jest 的快照测试（Snapshot Testing）和大多数 Jest 的匹配器（Matchers）。</li>
<li><strong>易于迁移</strong>：从 Jest 迁移到 Vitest 非常简单。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-2">三、快速上手：4步搭建你的第一个测试</h3>
<p>假设你已有一个 Vite 项目（如 Vue、React 或纯 JavaScript/TypeScript 项目）。</p>
<h4 data-id="heading-3">步骤 1: 安装 Vitest</h4>
<p>在你的项目根目录下运行：</p>
<pre><code class="hljs language-csharp" lang="csharp">npm install -D vitest
<span class="hljs-meta"># 或</span>
yarn <span class="hljs-keyword">add</span> -D vitest
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> -D vitest
</code></pre>
<h4 data-id="heading-4">步骤 2: 配置 Vitest</h4>
<p>创建 <code>vitest.config.ts</code>文件，或者直接在已有的 <code>vite.config.ts</code>中配置：</p>
<p><strong>方式一：独立的 <code>vitest.config.ts</code></strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vitest.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vitest/config'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">test</span>: {
    <span class="hljs-comment">// 指定测试文件的匹配模式</span>
    <span class="hljs-attr">include</span>: [<span class="hljs-string">'**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'</span>],
  },
})
</code></pre>
<p><strong>方式二：在 <code>vite.config.ts</code>中合并配置（推荐，保持一致性）</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>

<span class="hljs-comment">// https://vitejs.dev/config/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()],
  <span class="hljs-attr">test</span>: { <span class="hljs-comment">// &lt;-- 在这里添加 test 配置项</span>
    <span class="hljs-attr">globals</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 让 describe、it、expect 等API全局可用，无需导入</span>
  },
})
</code></pre>
<h4 data-id="heading-5">步骤 3: 编写一个简单的函数和测试用例</h4>
<p>创建一个数学函数 <code>math.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/math.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-keyword">return</span> a * b;
}
</code></pre>
<p>为它创建测试文件 <code>math.test.ts</code>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// src/math.test.ts</span>
import { describe, it, expect } from 'vitest'; <span class="hljs-comment">// 如果配置了 globals: true，则可省略导入</span>
import { add, multiply } from './math';

<span class="hljs-built_in">describe</span>('数学函数测试', () =&gt; {
  <span class="hljs-built_in">it</span>('应该正确相加两个数字', () =&gt; {
    <span class="hljs-built_in">expect</span>(add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))<span class="hljs-selector-class">.toBe</span>(<span class="hljs-number">3</span>);
    <span class="hljs-built_in">expect</span>(add(-<span class="hljs-number">1</span>, <span class="hljs-number">5</span>))<span class="hljs-selector-class">.toBe</span>(<span class="hljs-number">4</span>);
  });

  <span class="hljs-built_in">it</span>('应该正确相乘两个数字', () =&gt; {
    <span class="hljs-built_in">expect</span>(multiply(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>))<span class="hljs-selector-class">.toBe</span>(<span class="hljs-number">12</span>);
    <span class="hljs-built_in">expect</span>(multiply(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>))<span class="hljs-selector-class">.toBe</span>(<span class="hljs-number">0</span>);
  });

  <span class="hljs-built_in">it</span>('快照测试：确保函数输出稳定', () =&gt; {
    <span class="hljs-built_in">expect</span>(add(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>))<span class="hljs-selector-class">.toMatchSnapshot</span>(); <span class="hljs-comment">// 第一次运行会生成一个快照文件</span>
  });
});
</code></pre>
<h4 data-id="heading-6">步骤 4: 运行测试</h4>
<p>在 <code>package.json</code>中添加一个测试脚本：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"test:run"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest run"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>
<p><strong>启动监视模式</strong>：运行 <code>npm test</code>。这会启动 Vitest 的监视模式，当你修改代码或测试文件时，它会自动重新运行相关的测试。</p>
<p><em>(示意图：Vitest 终端输出，绿色代表通过)</em></p>
</li>
<li>
<p><strong>单次运行</strong>：运行 <code>npm run test:run</code>。这会在不启动监视模式的情况下运行一次所有测试，常用于 CI/CD 环境。</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-7">四、核心概念与高级特性</h3>
<ol>
<li>
<p><strong>测试套件和用例</strong></p>
<ul>
<li><code>describe</code>：用于将多个相关的测试组合在一起。</li>
<li><code>it</code>或 <code>test</code>：定义单个测试用例。</li>
</ul>
</li>
<li>
<p><strong>断言（Assertions）</strong></p>
<ul>
<li>使用 <code>expect</code>来对值进行断言。Vitest 支持大量 Jest 风格的匹配器，如 <code>.toBe()</code>, <code>.toEqual()</code>, <code>.toBeTruthy()</code>, <code>.toContain()</code>等。</li>
</ul>
</li>
<li>
<p><strong>模拟（Mocking）</strong></p>
<ul>
<li>Vitest 提供了强大的模拟功能。</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { vi } <span class="hljs-keyword">from</span> <span class="hljs-string">'vitest'</span>;

<span class="hljs-comment">// 模拟一个函数</span>
<span class="hljs-keyword">const</span> mockFn = vi.<span class="hljs-title function_">fn</span>();
<span class="hljs-title function_">mockFn</span>(<span class="hljs-string">'hello'</span>);
<span class="hljs-title function_">expect</span>(mockFn).<span class="hljs-title function_">toHaveBeenCalledWith</span>(<span class="hljs-string">'hello'</span>);

<span class="hljs-comment">// 模拟一个模块</span>
vi.<span class="hljs-title function_">mock</span>(<span class="hljs-string">'./path/to/module'</span>, <span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-attr">someExport</span>: vi.<span class="hljs-title function_">fn</span>(),
}));
</code></pre>
</li>
<li>
<p><strong>测试覆盖率</strong></p>
<ul>
<li>
<p>使用 <code>@vitest/coverage</code>包可以轻松生成覆盖率报告。</p>
</li>
<li>
<p>安装：<code>npm i -D @vitest/coverage</code></p>
</li>
<li>
<p>配置 <code>vitest.config.ts</code>：</p>
<pre><code class="hljs language-php" lang="php">export <span class="hljs-keyword">default</span> <span class="hljs-title function_ invoke__">defineConfig</span>({
  <span class="hljs-attr">test</span>: {
    <span class="hljs-attr">coverage</span>: {
      <span class="hljs-attr">provider</span>: <span class="hljs-string">'istanbul'</span> // 或 <span class="hljs-string">'c8'</span>
    }
  }
})
</code></pre>
</li>
<li>
<p>运行：<code>vitest --coverage</code></p>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">总结：一张图掌握 Vitest 工作流</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a247b87f66e43189df2a19a2131fdfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmFjb24=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765260973&amp;x-signature=oTmqgj4SBN7gMTgb70f08suO290%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AES-GCM 解密失败解决方案]]></title>    <link>https://juejin.cn/post/7578830345870606377</link>    <guid>https://juejin.cn/post/7578830345870606377</guid>    <pubDate>2025-12-02T06:33:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578830345870606377" data-draft-id="7578811288819941419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AES-GCM 解密失败解决方案"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-02T06:33:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="学不动学不明白"/> <meta itemprop="url" content="https://juejin.cn/user/3879514419244103"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AES-GCM 解密失败解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3879514419244103/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    学不动学不明白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:33:22.000Z" title="Tue Dec 02 2025 06:33:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>使用<code>uniapp</code>开发微信小程序，因为后端返回参数有加密数据使用的是<code>AES_GCM</code>加密算法，因此使用<code>asmcrypto.js</code>用于解密，微信开发者工具中，代码正常，但是部署上线后出现<code>atob</code>、<code>Buffer</code> 或 <code>TextDecoder</code>为<code>undefind</code>情况</p>
<h2 data-id="heading-1">问题代码</h2>
<ul>
<li>小程序中不支持 <code>atob</code></li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 解码</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">base64ToBytes</span>(<span class="hljs-params">base64</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Uint8Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-title function_">atob</span>(base64), <span class="hljs-function"><span class="hljs-params">c</span> =&gt;</span> c.<span class="hljs-title function_">charCodeAt</span>(<span class="hljs-number">0</span>));
}
</code></pre>
<ul>
<li>小程序中不支持 <code>TextDecoder</code></li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">key, info</span>) {

    <span class="hljs-comment">// ·········</span>
    <span class="hljs-comment">// ·········</span>
    <span class="hljs-comment">// 5. 转 UTF-8 字符串</span>
    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>(<span class="hljs-string">"utf-8"</span>);
    <span class="hljs-comment">// ·········</span>
    <span class="hljs-comment">// ·········</span>
}
</code></pre>
<h2 data-id="heading-2">处理</h2>
<ul>
<li>小程序中不支持 <code>atob</code>，替换方法</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">base64ToBytes</span>(<span class="hljs-params">base64</span>) {
  <span class="hljs-keyword">const</span> arrayBuffer = uni.<span class="hljs-title function_">base64ToArrayBuffer</span>(base64);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arrayBuffer);
}
</code></pre>
<ul>
<li>小程序中不支持 <code>TextDecoder</code>, 替换方法</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">// Uint8Array 转 UTF-8 字符串
function utf8BytesToString(bytes) {
  let <span class="hljs-attr">str</span> = <span class="hljs-string">''</span><span class="hljs-comment">;</span>
  let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  while (i &lt; bytes.length) {
    const <span class="hljs-attr">b1</span> = bytes[i++]<span class="hljs-comment">;</span>
    if (b1 &lt; 0x80) {
      str += String.fromCharCode(b1)<span class="hljs-comment">;</span>
    } else if (b1 &lt; 0xE0) {
      const <span class="hljs-attr">b2</span> = bytes[i++]<span class="hljs-comment">;</span>
      str += String.fromCharCode(((b1 &amp; 0x1F) &lt;&lt; 6) | (b2 &amp; 0x3F))<span class="hljs-comment">;</span>
    } else if (b1 &lt; 0xF0) {
      const <span class="hljs-attr">b2</span> = bytes[i++]<span class="hljs-comment">;</span>
      const <span class="hljs-attr">b3</span> = bytes[i++]<span class="hljs-comment">;</span>
      str += String.fromCharCode(
        ((b1 &amp; 0x0F) &lt;&lt; 12) |
        ((b2 &amp; 0x3F) &lt;&lt; 6) |
        (b3 &amp; 0x3F)
      )<span class="hljs-comment">;</span>
    } else {
      const <span class="hljs-attr">b2</span> = bytes[i++]<span class="hljs-comment">;</span>
      const <span class="hljs-attr">b3</span> = bytes[i++]<span class="hljs-comment">;</span>
      const <span class="hljs-attr">b4</span> = bytes[i++]<span class="hljs-comment">;</span>
      let <span class="hljs-attr">codepoint</span> =
        ((b1 &amp; 0x07) &lt;&lt; 18) |
        ((b2 &amp; 0x3F) &lt;&lt; 12) |
        ((b3 &amp; 0x3F) &lt;&lt; 6) |
        (b4 &amp; 0x3F)<span class="hljs-comment">;</span>
      codepoint <span class="hljs-attr">-</span>= <span class="hljs-number">0</span>x10000<span class="hljs-comment">;</span>
      str += String.fromCharCode(
        0xD800 + (codepoint &gt;&gt; 10),
        0xDC00 + (codepoint &amp; 0x3FF)
      )<span class="hljs-comment">;</span>
    }
  }
  return str<span class="hljs-comment">;</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[electron 自动更新]]></title>    <link>https://juejin.cn/post/7578777952727564322</link>    <guid>https://juejin.cn/post/7578777952727564322</guid>    <pubDate>2025-12-02T05:52:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578777952727564322" data-draft-id="7578777952727531554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="electron 自动更新"/> <meta itemprop="keywords" content="Electron"/> <meta itemprop="datePublished" content="2025-12-02T05:52:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hky301"/> <meta itemprop="url" content="https://juejin.cn/user/4406498334361022"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            electron 自动更新
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498334361022/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hky301
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:52:25.000Z" title="Tue Dec 02 2025 05:52:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>项目使用electron-forge 打包工具，但是不能实现新版本安装之后自动打开软件。
需要使用electron-builder。</p>
<p>在项目基础上，增加一下代码。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1ffe2378f884d3084bfd3ecf0d255e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGt5MzAx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259545&amp;x-signature=KS8gW4%2F4FqvLMfmUzhhL7n5CaUA%3D" alt="image.png" loading="lazy"/></p>
<p>创建build-direct.js</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// scripts/build-direct.js</span>
<span class="hljs-keyword">const</span> { spawn } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">WEBPACK_DIR</span> = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'.webpack'</span>, <span class="hljs-string">'x64'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAIN_FILE</span> = path.<span class="hljs-title function_">join</span>(<span class="hljs-variable constant_">WEBPACK_DIR</span>, <span class="hljs-string">'main'</span>)
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RENDERER_DIR</span> = path.<span class="hljs-title function_">join</span>(<span class="hljs-variable constant_">WEBPACK_DIR</span>, <span class="hljs-string">'renderer'</span>, <span class="hljs-string">'main_window'</span>)

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 开始构建：Forge → electron-builder (直接使用 .webpack)'</span>)

<span class="hljs-comment">// 启动 Forge package，但不因它失败而中断</span>
<span class="hljs-keyword">const</span> forge = <span class="hljs-title function_">spawn</span>(<span class="hljs-string">'npm'</span>, [<span class="hljs-string">'run'</span>, <span class="hljs-string">'package:produce'</span>], {
  <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span>,
  <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>
})

<span class="hljs-keyword">let</span> forgeExited = <span class="hljs-literal">false</span>
<span class="hljs-comment">// let forgeSuccess = false</span>

forge.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">(<span class="hljs-params">code</span>) =&gt;</span> {
  forgeExited = <span class="hljs-literal">true</span>
  <span class="hljs-comment">// forgeSuccess = code === 0</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📦 Forge 进程退出，code=<span class="hljs-subst">${code}</span>`</span>)
  <span class="hljs-title function_">checkAndBuild</span>()
})

<span class="hljs-comment">// 等待最多 90 秒，只要文件存在就继续</span>
<span class="hljs-keyword">const</span> maxWait = <span class="hljs-number">90000</span>
<span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()

<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkAndBuild</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> elapsed = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - startTime
  <span class="hljs-keyword">if</span> (!forgeExited &amp;&amp; elapsed &lt; maxWait) {
    <span class="hljs-comment">// 还没超时，稍后重试</span>
    <span class="hljs-built_in">setTimeout</span>(checkAndBuild, <span class="hljs-number">2000</span>)
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-comment">// 检查 .webpack 是否完整</span>
  <span class="hljs-keyword">const</span> ready =
    fs.<span class="hljs-title function_">existsSync</span>(<span class="hljs-variable constant_">MAIN_FILE</span>) &amp;&amp;
    fs.<span class="hljs-title function_">existsSync</span>(path.<span class="hljs-title function_">join</span>(<span class="hljs-variable constant_">RENDERER_DIR</span>, <span class="hljs-string">'index.html'</span>)) &amp;&amp;
    fs.<span class="hljs-title function_">existsSync</span>(path.<span class="hljs-title function_">join</span>(<span class="hljs-variable constant_">RENDERER_DIR</span>, <span class="hljs-string">'preload.js'</span>))

  <span class="hljs-keyword">if</span> (ready) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'✅ .webpack/x64/ 已就绪，继续执行 electron-builder...'</span>)
    <span class="hljs-title function_">runElectronBuilder</span>()
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'❌ .webpack/x64/ 未生成或不完整，无法继续'</span>)
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>)
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">runElectronBuilder</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { execSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>)
  <span class="hljs-keyword">try</span> {
    <span class="hljs-title function_">execSync</span>(<span class="hljs-string">'npx electron-builder --win --x64'</span>, {
      <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-attr">cwd</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'..'</span>)
    })
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n🎉 构建成功！'</span>)
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'💥 electron-builder 失败'</span>, err)
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>)
  }
}
</code></pre>
<p>electron 入口文件</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { app, <span class="hljs-title class_">BrowserWindow</span>, globalShortcut, ipcMain, <span class="hljs-title class_">Menu</span>, session } <span class="hljs-keyword">from</span> <span class="hljs-string">'electron'</span>
<span class="hljs-keyword">import</span> { autoUpdater } <span class="hljs-keyword">from</span> <span class="hljs-string">'electron-updater'</span>
<span class="hljs-keyword">import</span> os <span class="hljs-keyword">from</span> <span class="hljs-string">'os'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>
<span class="hljs-keyword">import</span> winston <span class="hljs-keyword">from</span> <span class="hljs-string">'winston'</span>
<span class="hljs-built_in">require</span>(<span class="hljs-string">'winston-daily-rotate-file'</span>)
<span class="hljs-comment">// This allows TypeScript to pick up the magic constants that's auto-generated by Forge's Webpack</span>
<span class="hljs-comment">// plugin that tells the Electron app where to look for the Webpack-bundled app code (depending on</span>
<span class="hljs-comment">// whether you're running in development or production).</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">MAIN_WINDOW_WEBPACK_ENTRY</span>: <span class="hljs-built_in">string</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">MAIN_WINDOW_PRELOAD_WEBPACK_ENTRY</span>: <span class="hljs-built_in">string</span>

<span class="hljs-comment">// ========================================================================</span>
<span class="hljs-comment">// 核心：自定义格式化工具，用于解析堆栈并添加代码位置</span>
<span class="hljs-comment">// ========================================================================</span>
<span class="hljs-comment">// const addSourceLocation = winston.format((info) =&gt; {</span>
<span class="hljs-comment">//   const stack = new Error().stack.split('\n')</span>

<span class="hljs-comment">//   // 从堆栈信息中找到调用logger的那一行代码</span>
<span class="hljs-comment">//   // 我们需要跳过winston内部的调用堆栈</span>
<span class="hljs-comment">//   let callerInfo = ''</span>
<span class="hljs-comment">//   for (let i = 1; i &lt; stack.length; i++) {</span>
<span class="hljs-comment">//     // 过滤掉winston模块自身和Node.js内部模块的堆栈信息</span>
<span class="hljs-comment">//     if (!stack[i].includes('node_modules/winston') &amp;&amp; !stack[i].includes('node:internal')) {</span>
<span class="hljs-comment">//       callerInfo = stack[i].trim()</span>
<span class="hljs-comment">//       break</span>
<span class="hljs-comment">//     }</span>
<span class="hljs-comment">//   }</span>

<span class="hljs-comment">//   // 从堆栈行中提取文件名和行号 (例如: /path/to/your/file.js:123:45)</span>
<span class="hljs-comment">//   const match = /\((.*):(\d+):\d+\)$/.exec(callerInfo) || /at (.*):(\d+):\d+$/.exec(callerInfo)</span>
<span class="hljs-comment">//   if (match) {</span>
<span class="hljs-comment">//     const [, filePath, line] = match</span>
<span class="hljs-comment">//     // 我们只取文件名，而不是完整的绝对路径，让日志更整洁</span>
<span class="hljs-comment">//     info.location = `${path.basename(filePath)}:${line}`</span>
<span class="hljs-comment">//   }</span>

<span class="hljs-comment">//   return info</span>
<span class="hljs-comment">// })</span>

<span class="hljs-keyword">const</span> logDir = path.<span class="hljs-title function_">join</span>(app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">'userData'</span>), <span class="hljs-string">'logs'</span>)

<span class="hljs-keyword">const</span> dailyRotateFileTransport = <span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">DailyRotateFile</span>({
  <span class="hljs-attr">level</span>: <span class="hljs-string">'info'</span>,
  <span class="hljs-attr">filename</span>: path.<span class="hljs-title function_">join</span>(logDir, <span class="hljs-string">'%DATE%-app.log'</span>), <span class="hljs-comment">// %DATE% 会被替换为日期</span>
  <span class="hljs-attr">datePattern</span>: <span class="hljs-string">'YYYY-MM-DD'</span>, <span class="hljs-comment">// 日期格式</span>
  <span class="hljs-attr">zippedArchive</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 归档旧日志时进行压缩</span>
  <span class="hljs-attr">maxSize</span>: <span class="hljs-string">'20m'</span>, <span class="hljs-comment">// 单个日志文件最大尺寸</span>
  <span class="hljs-attr">maxFiles</span>: <span class="hljs-string">'14d'</span> <span class="hljs-comment">// 最多保留14天的日志文件</span>
})

<span class="hljs-comment">// 日志格式规范 文件名:行号|函数名|[接口地址]|数据</span>
<span class="hljs-comment">// demo: log.info(`index:88|reportStatus|${JSON.stringify({'navigator.onLine': false,networkStatus: true})}`)</span>
<span class="hljs-keyword">const</span> logger = winston.<span class="hljs-title function_">createLogger</span>({
  <span class="hljs-attr">format</span>: winston.<span class="hljs-property">format</span>.<span class="hljs-title function_">combine</span>(
    <span class="hljs-comment">// winston.format.colorize(),</span>
    winston.<span class="hljs-property">format</span>.<span class="hljs-title function_">timestamp</span>({
      <span class="hljs-attr">format</span>: <span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span>
    }),
    <span class="hljs-comment">// addSourceLocation(), // 应用我们自定义的工具</span>
    <span class="hljs-comment">// winston.format.printf((info) =&gt; `-&gt;${info.timestamp}|${info.level}|${info.location}|${info.message}`)</span>
    winston.<span class="hljs-property">format</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-function">(<span class="hljs-params">info</span>) =&gt;</span> <span class="hljs-string">`-&gt;<span class="hljs-subst">${info.timestamp}</span>|<span class="hljs-subst">${info.level}</span>|<span class="hljs-subst">${info.message}</span>`</span>)
  ),
  <span class="hljs-attr">transports</span>: [<span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">Console</span>(), dailyRotateFileTransport]
})

<span class="hljs-comment">// Handle creating/removing shortcuts on Windows when installing/uninstalling.</span>
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">require</span>(<span class="hljs-string">'electron-squirrel-startup'</span>)) {
  app.<span class="hljs-title function_">quit</span>()
}

<span class="hljs-comment">// 设置开机自启动</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">setAutoLaunch</span> = (<span class="hljs-params"/>) =&gt; {
  app.<span class="hljs-title function_">setLoginItemSettings</span>({
    <span class="hljs-attr">openAtLogin</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用开机自启动</span>
    <span class="hljs-attr">path</span>: process.<span class="hljs-property">execPath</span>, <span class="hljs-comment">// 应用程序的可执行文件路径</span>
    <span class="hljs-comment">// args: ['--autostart'],     // 启动时的命令行参数</span>
    <span class="hljs-comment">// enabled: true,             // 启用此登录项</span>
    <span class="hljs-attr">name</span>: <span class="hljs-string">'三迪智能mes'</span> <span class="hljs-comment">// 应用名称</span>
    <span class="hljs-comment">// openAsHidden: true,        // 启动时隐藏窗口</span>
  })
}

<span class="hljs-comment">// ========================</span>
<span class="hljs-comment">// 自动更新 - 定时检查逻辑</span>
<span class="hljs-comment">// ========================</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">updateCheckInterval</span>: <span class="hljs-title class_">NodeJS</span>.<span class="hljs-property">Timeout</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

<span class="hljs-keyword">let</span> <span class="hljs-attr">mainWindow</span>: <span class="hljs-title class_">BrowserWindow</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

<span class="hljs-keyword">const</span> createWindow = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
  session.<span class="hljs-property">defaultSession</span>.<span class="hljs-property">webRequest</span>.<span class="hljs-title function_">onHeadersReceived</span>(<span class="hljs-function">(<span class="hljs-params">details, callback</span>) =&gt;</span> {
    <span class="hljs-title function_">callback</span>({
      <span class="hljs-attr">responseHeaders</span>: {
        ...details.<span class="hljs-property">responseHeaders</span>,
        <span class="hljs-string">'Content-Security-Policy'</span>: [
          <span class="hljs-string">"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src *; style-src 'self' 'unsafe-inline'; img-src 'self' data:"</span>
        ]
      }
    })
  })

  <span class="hljs-comment">// 设置开机自启动</span>
  <span class="hljs-title function_">setAutoLaunch</span>()

  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">'get-local-ip'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> networkInterfaces = os.<span class="hljs-title function_">networkInterfaces</span>()
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> name <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(networkInterfaces)) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> net <span class="hljs-keyword">of</span> networkInterfaces[name]!) {
        <span class="hljs-comment">// Skip over non-IPv4 and internal (i.e. 127.0.0.1) addresses</span>
        <span class="hljs-keyword">if</span> (net.<span class="hljs-property">family</span> === <span class="hljs-string">'IPv4'</span> &amp;&amp; !net.<span class="hljs-property">internal</span>) {
          <span class="hljs-keyword">return</span> net.<span class="hljs-property">address</span> <span class="hljs-comment">// 找到并返回第一个 IPv4 地址</span>
        }
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">'127.0.0.1'</span> <span class="hljs-comment">// 如果没找到，返回默认地址</span>
  })

  <span class="hljs-comment">// 监听来自渲染进程的'log'事件</span>
  ipcMain.<span class="hljs-title function_">on</span>(<span class="hljs-string">'log'</span>, <span class="hljs-function">(<span class="hljs-params">event, { level, message }</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (logger[level]) {
      logger[level](message)
    } <span class="hljs-keyword">else</span> {
      logger.<span class="hljs-title function_">info</span>(message) <span class="hljs-comment">// 如果级别不存在，默认为info</span>
    }
  })

  <span class="hljs-comment">// ipcMain.handle('get-workstation-type', () =&gt; {</span>
  <span class="hljs-comment">//   return process.env.WORKSTATION_TYPE;</span>
  <span class="hljs-comment">// })</span>

  <span class="hljs-comment">// Create the browser window.</span>
  mainWindow = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({
    <span class="hljs-attr">title</span>: <span class="hljs-string">'MES扫码系统'</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-number">1600</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">700</span>,
    <span class="hljs-attr">alwaysOnTop</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 添加这一行来设置窗口始终置顶</span>
    <span class="hljs-attr">fullscreen</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// &lt;-- 关键设置：启动时即全屏</span>
    <span class="hljs-attr">frame</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 无边框</span>
    <span class="hljs-attr">webPreferences</span>: {
      <span class="hljs-attr">contextIsolation</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用上下文隔离,隔离预加载脚本和前端页面，建立安全桥梁</span>
      <span class="hljs-attr">nodeIntegration</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 决定了渲染进程能否直接使用 Node.js 的功能</span>
      <span class="hljs-attr">preload</span>: <span class="hljs-variable constant_">MAIN_WINDOW_PRELOAD_WEBPACK_ENTRY</span>
    }
  })

  <span class="hljs-comment">// ---------------------&gt; 开始添加自定义快捷键 &lt;---------------------</span>

  <span class="hljs-comment">// 定义一个快捷键，'CommandOrControl' 会在 macOS 上映射为 Command，在 Windows/Linux 上映射为 Control</span>
  <span class="hljs-keyword">const</span> customShortcut = <span class="hljs-string">'CommandOrControl+F12'</span>

  <span class="hljs-comment">// 注册全局快捷键</span>
  <span class="hljs-keyword">const</span> ret = globalShortcut.<span class="hljs-title function_">register</span>(customShortcut, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`快捷键 "<span class="hljs-subst">${customShortcut}</span>" 被按下`</span>)

    <span class="hljs-comment">// 检查窗口是否存在且可见</span>
    <span class="hljs-keyword">if</span> (mainWindow) {
      <span class="hljs-comment">// 使用 toggleDevTools() 来打开或关闭开发者工具</span>
      mainWindow.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">toggleDevTools</span>()
    }
  })

  <span class="hljs-keyword">if</span> (!ret) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'快捷键注册失败'</span>)
  }

  <span class="hljs-comment">// 检查快捷键是否注册成功</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`快捷键 "<span class="hljs-subst">${customShortcut}</span>" 是否注册成功: <span class="hljs-subst">${globalShortcut.isRegistered(customShortcut)}</span>`</span>)

  <span class="hljs-comment">// ---------------------&gt; 自定义快捷键添加结束 &lt;---------------------</span>

  <span class="hljs-comment">// 监听来自渲染器进程的 最小化窗口</span>
  ipcMain.<span class="hljs-title function_">on</span>(<span class="hljs-string">'minimize-window'</span>, <span class="hljs-function">() =&gt;</span> {
    mainWindow.<span class="hljs-title function_">minimize</span>()
  })

  <span class="hljs-comment">// 监听来自渲染器进程的 'close-app' 消息</span>
  ipcMain.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close-app'</span>, <span class="hljs-function">() =&gt;</span> {
    app.<span class="hljs-title function_">quit</span>()
  })

  <span class="hljs-keyword">const</span> menu = <span class="hljs-title class_">Menu</span>.<span class="hljs-title function_">buildFromTemplate</span>([])
  <span class="hljs-title class_">Menu</span>.<span class="hljs-title function_">setApplicationMenu</span>(menu)

  <span class="hljs-comment">// and load the index.html of the app.</span>
  mainWindow.<span class="hljs-title function_">loadURL</span>(<span class="hljs-variable constant_">MAIN_WINDOW_WEBPACK_ENTRY</span>)

  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'development'</span>) {
    <span class="hljs-comment">// Open the DevTools.</span>
    mainWindow.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">openDevTools</span>()
  }

  ipcMain.<span class="hljs-title function_">on</span>(<span class="hljs-string">'quit-and-install'</span>, <span class="hljs-function">() =&gt;</span> {
    autoUpdater.<span class="hljs-title function_">quitAndInstall</span>(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>) <span class="hljs-comment">// 立即退出并安装</span>
  })
}

<span class="hljs-comment">// ===== 自动更新逻辑（Squirrel.Windows 专用） =====</span>
<span class="hljs-keyword">if</span> (app.<span class="hljs-property">isPackaged</span>) {
  <span class="hljs-keyword">const</span> server = <span class="hljs-string">'http://192.168.2.74'</span> <span class="hljs-comment">// 内网更新服务器</span>
  <span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${server}</span>/updates`</span> <span class="hljs-comment">// 必须以 /updates 结尾</span>

  <span class="hljs-comment">// 设置更新地址（Squirrel 要求格式为 RELEASES 文件所在目录）</span>
  autoUpdater.<span class="hljs-title function_">setFeedURL</span>(url)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">startAutoUpdateCheck</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 避免重复启动</span>
  <span class="hljs-keyword">if</span> (updateCheckInterval) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkForUpdatesSilently</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!app.<span class="hljs-property">isPackaged</span>) {
      <span class="hljs-keyword">return</span>
    } <span class="hljs-comment">// 开发模式不检查</span>

    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'开始定时检查更新...'</span>)
    autoUpdater.<span class="hljs-title function_">checkForUpdatesAndNotify</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">`自动更新检查失败: <span class="hljs-subst">${err.message}</span>`</span>)
    })
  }

  <span class="hljs-comment">// 立即检查一次</span>
  <span class="hljs-title function_">checkForUpdatesSilently</span>()

  <span class="hljs-comment">// 每 30 分钟检查一次（30 * 60 * 1000 = 1,800,000 ms）</span>
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">INTERVAL_MS</span> = <span class="hljs-number">10</span> * <span class="hljs-number">1000</span>
  updateCheckInterval = <span class="hljs-built_in">setInterval</span>(checkForUpdatesSilently, <span class="hljs-variable constant_">INTERVAL_MS</span>)
}

<span class="hljs-comment">// ===== Squirrel 更新事件监听 =====</span>
autoUpdater.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'[Update] Error:'</span>, error.<span class="hljs-property">message</span>)
})

autoUpdater.<span class="hljs-title function_">on</span>(<span class="hljs-string">'checking-for-update'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[Update] Checking for update...'</span>)
})

autoUpdater.<span class="hljs-title function_">on</span>(<span class="hljs-string">'update-available'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[Update] Update available.'</span>)
  <span class="hljs-comment">// 可通过 IPC 通知渲染进程</span>
  mainWindow?.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'update-available'</span>)
})

autoUpdater.<span class="hljs-title function_">on</span>(<span class="hljs-string">'update-not-available'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[Update] Update not available.'</span>)
  mainWindow?.<span class="hljs-property">webContents</span>.<span class="hljs-title function_">send</span>(<span class="hljs-string">'update-not-available'</span>)
})

autoUpdater.<span class="hljs-title function_">on</span>(<span class="hljs-string">'update-downloaded'</span>, <span class="hljs-function">(<span class="hljs-params">info</span>) =&gt;</span> {
  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`[AutoUpdate] 新版本已下载完成: <span class="hljs-subst">${info.version}</span>，即将自动重启安装...`</span>)

  <span class="hljs-comment">// 关键：静默安装并自动重启</span>
  <span class="hljs-title function_">setImmediate</span>(<span class="hljs-function">() =&gt;</span> {
    autoUpdater.<span class="hljs-title function_">quitAndInstall</span>(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>)
  })
})

<span class="hljs-comment">// This method will be called when Electron has finished</span>
<span class="hljs-comment">// initialization and is ready to create browser windows.</span>
<span class="hljs-comment">// Some APIs can only be used after this event occurs.</span>
app.<span class="hljs-title function_">on</span>(<span class="hljs-string">'ready'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">createWindow</span>()
  <span class="hljs-comment">// 启动自动更新检查（传入 mainWindow 可选，这里我们不需要）</span>
  <span class="hljs-title function_">startAutoUpdateCheck</span>()
})

<span class="hljs-comment">// 在应用退出前，注销所有快捷键，这是一个好习惯</span>
app.<span class="hljs-title function_">on</span>(<span class="hljs-string">'will-quit'</span>, <span class="hljs-function">() =&gt;</span> {
  globalShortcut.<span class="hljs-title function_">unregisterAll</span>()
})

<span class="hljs-comment">// Quit when all windows are closed, except on macOS. There, it's common</span>
<span class="hljs-comment">// for applications and their menu bar to stay active until the user quits</span>
<span class="hljs-comment">// explicitly with Cmd + Q.</span>
app.<span class="hljs-title function_">on</span>(<span class="hljs-string">'window-all-closed'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">platform</span> !== <span class="hljs-string">'darwin'</span>) {
    app.<span class="hljs-title function_">quit</span>()
  }
})

app.<span class="hljs-title function_">on</span>(<span class="hljs-string">'activate'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// On OS X it's common to re-create a window in the app when the</span>
  <span class="hljs-comment">// dock icon is clicked and there are no other windows open.</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">BrowserWindow</span>.<span class="hljs-title function_">getAllWindows</span>().<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-title function_">createWindow</span>()
  }
})

<span class="hljs-comment">// In this file you can include the rest of your app's specific main process</span>
<span class="hljs-comment">// code. You can also put them in separate files and import them here.</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[霸榜 GitHub 的 TrendRadar 能用吗？实测三天服务器崩了，附修复代码]]></title>    <link>https://juejin.cn/post/7578780780027740169</link>    <guid>https://juejin.cn/post/7578780780027740169</guid>    <pubDate>2025-12-02T05:57:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578780780027740169" data-draft-id="7578803751609204786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="霸榜 GitHub 的 TrendRadar 能用吗？实测三天服务器崩了，附修复代码"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-02T05:57:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="七牛云行业应用"/> <meta itemprop="url" content="https://juejin.cn/user/3722267698664140"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            霸榜 GitHub 的 TrendRadar 能用吗？实测三天服务器崩了，附修复代码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3722267698664140/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    七牛云行业应用
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:57:11.000Z" title="Tue Dec 02 2025 05:57:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>引言：GitHub 榜首项目的“生产环境陷阱”</strong>
对于 Python 开发者而言，本周最火的项目莫过于 <strong>TrendRadar</strong>。它结合了 Playwright 爬虫和 LLM（大模型），能自动聚合抖音、知乎、微博等 35+ 个平台的热点，并生成 AI 简报。
作为一名热衷于自动化工具的架构师，我第一时间在服务器上 Pull 了代码并跑了起来。前两天体验极佳，飞书群里的情报推送源源不断。</p>
<p><strong>然而，第三天早上，服务全挂了。</strong></p>
<p>查看 Docker 日志，屏幕上赫然一行红字：
OSError: [Errno 28] No space left on device
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63d62a9446b443d68e70c1211190f8e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiD54mb5LqR6KGM5Lia5bqU55So:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259831&amp;x-signature=J5W4YMIwjBvlWA6HklZz9gmNnww%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>这就是开源 Demo 与工业级应用的差距：<strong>如果不解决存储架构问题，TrendRadar 就是一个“硬盘粉碎机”。</strong></p>
<p><strong>一、 事故复盘：如何确认是 Inode 爆掉？</strong></p>
<p>在报错现场，我首先执行了 df -h，结果显示磁盘空间仅使用了 45%。这就非常诡异：<strong>明明还有几十 G 空间，为什么提示空间不足？</strong>
这时候，老运维都知道要查一下 <strong>Inode（索引节点）</strong>。</p>
<p><strong>1. 排查 Inode 使用率</strong></p>
<p>执行命令：
code Bash</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">df</span> -i
</code></pre>
<p><strong>结果显示：IUse% 达到了 100%</strong>。</p>
<p>这意味着虽然磁盘还有空间，但文件系统的“户口本”已经发完了。TrendRadar 为了留存舆情证据，会为每一条热点保存高清截图和 HTML 快照，短短 72 小时生成了数万个小文件，直接吃光了 Inode。</p>
<p><strong>2. 定位“元凶”目录</strong></p>
<p>为了确认是哪个目录在搞鬼，可以使用以下组合命令快速统计各目录文件数：
code Bash</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> /*; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span>; find <span class="hljs-variable">$i</span> | <span class="hljs-built_in">wc</span> -l; <span class="hljs-keyword">done</span>
</code></pre>
<p>很快我们定位到了罪魁祸首：TrendRadar/data/snapshots/。</p>
<p><strong>结论</strong>： 在爬虫类应用中，本地文件系统（尤其是 Ext4）并不适合存储海量小文件。我们需要架构级的改造。</p>
<p><strong>二、 架构抉择：为什么爬虫必须“存算分离”？</strong></p>
<p>面对海量非结构化数据（图片/日志），我们对比了两种常见的扩容方案。这次我们不仅看功能，更看<strong>量化指标</strong>：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6726d733ff64abe9fa45e1a4336f846~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiD54mb5LqR6KGM5Lia5bqU55So:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259831&amp;x-signature=9md863UF%2B0tHzIGBQ3Wy1f2wAO8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>架构决策：</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b5dd576179e4f84bc401ef9e21fe1d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiD54mb5LqR6KGM5Lia5bqU55So:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259831&amp;x-signature=wxWzG4tdqYAeFsvJSbIqz0XcYS4%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>为了保证 Crawler（计算层）的无状态，必须实施<strong>存算分离</strong>。将所有持久化数据“外包”给专业的七牛云 Kodo。</p>
<p><strong>三、 源码二开实战：从 Local Save 到 Cloud Stream</strong></p>
<p>TrendRadar 是基于 Python + Playwright 编写的。改造的核心思路是：<strong>利用 Playwright 原生能力截获内存 Buffer，直接推送到云端</strong>。</p>
<p><strong>第一步：环境准备</strong></p>
<p>安装七牛云 Python SDK：</p>
<pre><code class="hljs language-bash" lang="bash">pip install qiniu

</code></pre>
<p><strong>第二步：封装“云存储管理器”</strong></p>
<p>我们在 utils 目录下新建 oss_manager.py，封装统一的上传接口。
code Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># utils/oss_manager.py</span>
<span class="hljs-keyword">from</span> qiniu <span class="hljs-keyword">import</span> Auth, put_data
<span class="hljs-keyword">import</span> os

<span class="hljs-comment"># 建议从环境变量读取，适配 Docker/K8s 部署</span>
ACCESS_KEY = os.getenv(<span class="hljs-string">'QINIU_AK'</span>)
SECRET_KEY = os.getenv(<span class="hljs-string">'QINIU_SK'</span>)
BUCKET_NAME = os.getenv(<span class="hljs-string">'QINIU_BUCKET'</span>)
CDN_DOMAIN = os.getenv(<span class="hljs-string">'QINIU_DOMAIN'</span>)

q = Auth(ACCESS_KEY, SECRET_KEY)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_bytes_stream</span>(<span class="hljs-params">data_bytes, file_key</span>):
    <span class="hljs-string">"""
    内存直传：直接将二进制流上传到七牛云，完全不占用本地磁盘
    """</span>
    token = q.upload_token(BUCKET_NAME, file_key, <span class="hljs-number">3600</span>)
    ret, info = put_data(token, file_key, data_bytes)
    
    <span class="hljs-keyword">if</span> info.status_code == <span class="hljs-number">200</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"<span class="hljs-subst">{CDN_DOMAIN}</span>/<span class="hljs-subst">{file_key}</span>"</span>
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

</code></pre>
<p><strong>第三步：魔改截图逻辑 (Core Refactoring)</strong></p>
<p>Playwright 的 page.screenshot() 方法如果不传 path 参数，<strong>默认就会返回 bytes (二进制流)</strong>。这是一个官方支持的高效路径，也是社区中将 Playwright 对接 S3 的标准做法。</p>
<p>我们找到 TrendRadar 的截图代码，进行如下修改：</p>
<p><strong>修改后 (Cloud Native)</strong>：</p>
<p>code Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> utils.oss_manager <span class="hljs-keyword">import</span> upload_bytes_stream
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">capture_snapshot</span>(<span class="hljs-params">page, filename</span>):
    <span class="hljs-comment"># 1. 获取截图的二进制 Buffer (不落盘)</span>
    <span class="hljs-comment"># 这与上传 S3 的套路一致，但七牛云在国内的连接稳定性更佳</span>
    screenshot_bytes = page.screenshot() 
    
    <span class="hljs-comment"># 2. 构造云端存储路径（按日期分层）</span>
    date_str = time.strftime(<span class="hljs-string">"%Y/%m/%d"</span>)
    cloud_key = <span class="hljs-string">f"snapshots/<span class="hljs-subst">{date_str}</span>/<span class="hljs-subst">{filename}</span>"</span>
    
    <span class="hljs-comment"># 3. 内存直传七牛云</span>
    url = upload_bytes_stream(screenshot_bytes, cloud_key)
    
    <span class="hljs-keyword">if</span> url:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[Success] Snapshot uploaded: <span class="hljs-subst">{url}</span>"</span>)
        <span class="hljs-keyword">return</span> url
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"[Error] Upload failed"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>

</code></pre>
<p><strong>第四步：打通飞书/企微通知</strong></p>
<p>修改完存储后，最关键的一步是将返回的 url 写入到通知模版中。这样，当飞书机器人推送热点简报时，用户点击图片链接，直接访问的是七牛云 CDN 加速后的高清图，既验证了集成成功，又提升了加载体验。</p>
<p><strong>四、 部署建议与生命周期管理</strong></p>
<p><strong>1. 像管理 Secrets 一样管理密钥</strong></p>
<p>为了保持 TrendRadar 官方 Docker 部署的优雅体验，不要把 AK/SK 硬编码在代码里。建议在 docker-compose.yml 中添加环境变量，与现有的 FEISHU_WEBHOOK_URL 保持一致：
code Yaml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">environment:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">QINIU_AK=your_access_key</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">QINIU_SK=your_secret_key</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">QINIU_BUCKET=trend-radar-assets</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">QINIU_DOMAIN=http://assets.example.com</span>

</code></pre>
<p><strong>2. 用“生命周期”榨干每一分成本</strong></p>
<p>舆情数据的时效性极强。针对这一点，我们可以利用<strong>云对象存储的标准能力——生命周期管理 (Lifecycle)</strong>。
在七牛云 Kodo 后台，只需配置一条简单的规则：</p>
<p><strong>●前缀匹配</strong>： snapshots/</p>
<p><strong>●转低频</strong>： 上传 <strong>30天</strong> 后 -&gt; 转为 <strong>低频存储</strong> (Standard-IA)，成本降低约 50%。</p>
<p><strong>●过期删除</strong>： 上传 <strong>90天</strong> 后 -&gt; <strong>自动删除</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e481f021dc2b47309f222a672151b9d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiD54mb5LqR6KGM5Lia5bqU55So:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259831&amp;x-signature=yZ81Nvsd86WAdnAQQSQ%2FEwSoFRI%3D" alt="企业微信截图_a7ac3fd3-4aca-47b3-b6dd-8bb8af4f729b.png" loading="lazy"/></p>
<p>这套策略是云存储的通用标准，既保留了近期的热点证据，又将长期存储成本压到了最低，完全不需要写 Crontab 脚本去维护。
五、 总结与替代方案对比
当然，解决 Inode 耗尽还有其他“土办法”，比如：</p>
<p><strong>1.重新格式化磁盘</strong>： 使用 mkfs.ext4 -N 调大 Inode 数。（缺点：需要停机，数据全丢，治标不治本）</p>
<p><strong>2.更深的目录分层</strong>： 缓解目录索引压力。（缺点：逻辑复杂，无法解决总容量限制）</p>
<p>相比之下，“<strong>对象存储 + 代码改造</strong>” 是一条一劳永逸的云原生路径。它不仅解决了眼前的崩溃问题，更为 TrendRadar 赋予了无限的扩展能力。</p>
<p><strong>让算力归算力（Docker），让存储归存储（七牛云），这才是 AI Agent 时代该有的架构素养。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[python元组和字典]]></title>    <link>https://juejin.cn/post/7578830345870589993</link>    <guid>https://juejin.cn/post/7578830345870589993</guid>    <pubDate>2025-12-02T06:26:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578830345870589993" data-draft-id="7578832575503794218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="python元组和字典"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-02T06:26:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dTTb"/> <meta itemprop="url" content="https://juejin.cn/user/1320982225094746"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            python元组和字典
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1320982225094746/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dTTb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:26:58.000Z" title="Tue Dec 02 2025 06:26:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、元组（tuple）</h3>
<p>元组是 Python 中<strong>有序、不可修改</strong>的序列，常用于存储不会变化的数据（比如固定的配置信息、坐标等）。</p>
<h4 data-id="heading-1">1. 元组的创建</h4>
<p>元组用 <code>()</code> 包裹元素，元素之间用逗号分隔，语法非常简单：</p>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 1. 直接用 () 创建（推荐）</span>
<span class="hljs-attr">tuple1</span> = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-string">"Python"</span>, <span class="hljs-literal">True</span>)  <span class="hljs-comment"># 元素可以是不同类型（数字、字符串、布尔值等）</span>
<span class="hljs-attr">tuple2</span> = (<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>)     <span class="hljs-comment"># 同类型元素的元组</span>

<span class="hljs-comment"># 2. 省略 () 创建（简写形式）</span>
<span class="hljs-attr">tuple3</span> = <span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>  <span class="hljs-comment"># 等价于 (10, 20, 30)，注意必须有逗号</span>

<span class="hljs-comment"># 3. 单个元素的元组（必须加逗号，否则会被当成普通变量）</span>
<span class="hljs-attr">tuple4</span> = (<span class="hljs-number">5</span>,)  <span class="hljs-comment"># 正确：元组类型</span>
<span class="hljs-attr">tuple5</span> = (<span class="hljs-number">5</span>)   <span class="hljs-comment"># 错误：int类型（不是元组）</span>

<span class="hljs-comment"># 4. 空元组</span>
<span class="hljs-attr">empty_tuple</span> = ()
</code></pre>
<h4 data-id="heading-2">2. 元组的核心特性</h4>
<ul>
<li><strong>有序</strong>：元素的存储顺序和创建时一致，支持通过索引访问（索引从 0 开始）。</li>
<li><strong>不可修改</strong>：创建后不能添加、删除或修改元素（这是元组和列表最核心的区别）。</li>
</ul>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tuple1</span> = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
print(tuple1<span class="hljs-section">[0]</span>)  <span class="hljs-comment"># 输出：1（通过索引访问第一个元素）</span>
print(tuple1<span class="hljs-section">[-1]</span>) <span class="hljs-comment"># 输出：3（通过负索引访问最后一个元素）</span>

<span class="hljs-comment"># 以下操作会报错（元组不可修改）</span>
tuple1<span class="hljs-section">[0]</span> = 100  <span class="hljs-comment"># 错误：不能修改元素</span>
tuple1.append(4) <span class="hljs-comment"># 错误：没有append方法（无法添加元素）</span>
del tuple1<span class="hljs-section">[1]</span>    <span class="hljs-comment"># 错误：不能删除元素</span>
</code></pre>
<h4 data-id="heading-3">3. 元组的常用操作</h4>
<p>虽然元组不可修改，但有一些实用的内置操作：</p>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-python" lang="python">tuple2 = (<span class="hljs-string">"苹果"</span>, <span class="hljs-string">"香蕉"</span>, <span class="hljs-string">"橙子"</span>)

<span class="hljs-comment"># 1. 计算长度（元素个数）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(tuple2))  <span class="hljs-comment"># 输出：3</span>

<span class="hljs-comment"># 2. 查找元素是否存在（in/not in）</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"香蕉"</span> <span class="hljs-keyword">in</span> tuple2)  <span class="hljs-comment"># 输出：True</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"葡萄"</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> tuple2)  <span class="hljs-comment"># 输出：True</span>

<span class="hljs-comment"># 3. 统计元素出现次数</span>
tuple3 = (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(tuple3.count(<span class="hljs-number">2</span>))  <span class="hljs-comment"># 输出：3</span>

<span class="hljs-comment"># 4. 查找元素的索引（找到第一个匹配项）</span>
<span class="hljs-built_in">print</span>(tuple3.index(<span class="hljs-number">3</span>))  <span class="hljs-comment"># 输出：3（3在索引3的位置）</span>

<span class="hljs-comment"># 5. 元组拼接（生成新元组，原元组不变）</span>
tuple4 = (<span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
new_tuple = tuple3 + tuple4
<span class="hljs-built_in">print</span>(new_tuple)  <span class="hljs-comment"># 输出：(1, 2, 2, 3, 2, 4, 5)</span>
</code></pre>
<h3 data-id="heading-4">二、字典（dictionary）</h3>
<p>字典是 Python 中<strong>无序（Python 3.7 + 后实际有序）、键值对（key-value）</strong>  类型的数据结构，核心作用是通过 “键” 快速查找 “值”（比如存储用户信息：姓名→小明，年龄→20）。</p>
<h4 data-id="heading-5">1. 字典的创建</h4>
<p>字典用 <code>{}</code> 包裹，每个元素是 <code>key: value</code> 的形式，键值对之间用逗号分隔：</p>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 1. 直接用 {} 创建（推荐）</span>
user = {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"小明"</span>,    <span class="hljs-comment"># key: "name"，value: "小明"</span>
    <span class="hljs-string">"age"</span>: 20,        <span class="hljs-comment"># key: "age"，value: 20</span>
    <span class="hljs-string">"gender"</span>: <span class="hljs-string">"男"</span>,
    <span class="hljs-string">"hobbies"</span>: [<span class="hljs-string">"篮球"</span>, <span class="hljs-string">"游戏"</span>]  <span class="hljs-comment"># value可以是列表、元组等复杂类型</span>
}

<span class="hljs-comment"># 2. 用 dict() 函数创建</span>
student = dict(name=<span class="hljs-string">"小红"</span>, age=18, score=95)  <span class="hljs-comment"># 键不需要加引号</span>
empty_dict = dict()  <span class="hljs-comment"># 空字典</span>

<span class="hljs-comment"># 3. 空字典的简写</span>
empty_dict2 = {}
</code></pre>
<h4 data-id="heading-6">2. 字典的核心规则</h4>
<ul>
<li><strong>key（键）的要求</strong>：必须是<strong>不可变类型</strong>（字符串、数字、元组），且<strong>不能重复</strong>（重复的键会覆盖前面的值）。</li>
<li><strong>value（值）的要求</strong>：可以是任意类型（数字、字符串、列表、字典等），可以重复。</li>
</ul>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 错误的key示例（以下会报错）</span>
<span class="hljs-attr">dict1</span> = {[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]: <span class="hljs-string">"错误"</span>}  <span class="hljs-comment"># 列表是可变类型，不能作为key</span>
<span class="hljs-attr">dict2</span> = {<span class="hljs-string">"name"</span>: <span class="hljs-string">"张三"</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"李四"</span>}  <span class="hljs-comment"># 重复key，最终存储"name": "李四"（覆盖）</span>

<span class="hljs-comment"># 正确的key示例</span>
<span class="hljs-attr">dict3</span> = {(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>): <span class="hljs-string">"坐标"</span>, <span class="hljs-string">"score"</span>: <span class="hljs-number">90</span>, <span class="hljs-number">100</span>: <span class="hljs-string">"满分"</span>}  <span class="hljs-comment"># 元组、字符串、数字都可以作为key</span>
</code></pre>
<h4 data-id="heading-7">3. 字典的常用操作（重点）</h4>
<p>字典的核心操作围绕 “增删改查” 展开，都是通过 key 实现的：</p>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-scss" lang="scss">user = {"name": <span class="hljs-string">"小明"</span>, <span class="hljs-string">"age"</span>: <span class="hljs-number">20</span>, <span class="hljs-string">"gender"</span>: <span class="hljs-string">"男"</span>}

# <span class="hljs-number">1</span>. 查：通过key获取value（最常用）
<span class="hljs-built_in">print</span>(user["name"])  # 输出：小明（直接用<span class="hljs-selector-attr">[key]</span>访问）
<span class="hljs-built_in">print</span>(user.get("age"))  # 输出：<span class="hljs-number">20</span>（用<span class="hljs-built_in">get</span>()方法访问，推荐）

# 注意：key不存在时的区别
# <span class="hljs-built_in">print</span>(user["height"])  # 报错：KeyError（key不存在）
<span class="hljs-built_in">print</span>(user.get("height", <span class="hljs-number">175</span>))  # 输出：<span class="hljs-number">175</span>（key不存在时返回默认值，不会报错）

# <span class="hljs-number">2</span>. 增：添加新的键值对
user<span class="hljs-selector-attr">[<span class="hljs-string">"height"</span>]</span> = <span class="hljs-number">175</span>  # 新增key: <span class="hljs-string">"height"</span>，value: <span class="hljs-number">175</span>
user[<span class="hljs-string">"hobbies"</span>] = [<span class="hljs-string">"篮球"</span>, <span class="hljs-string">"游戏"</span>]
<span class="hljs-built_in">print</span>(user)  # 输出：{'name': <span class="hljs-string">'小明'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">20</span>, <span class="hljs-string">'gender'</span>: <span class="hljs-string">'男'</span>, <span class="hljs-string">'height'</span>: <span class="hljs-number">175</span>, <span class="hljs-string">'hobbies'</span>: [<span class="hljs-string">'篮球'</span>, <span class="hljs-string">'游戏'</span>]}

# <span class="hljs-number">3</span>. 改：修改已有key的value
user<span class="hljs-selector-attr">[<span class="hljs-string">"age"</span>]</span> = <span class="hljs-number">21</span>  # key已存在，直接覆盖value
<span class="hljs-built_in">print</span>(user["age"])  # 输出：<span class="hljs-number">21</span>

# <span class="hljs-number">4</span>. 删：删除键值对
<span class="hljs-selector-tag">del</span> user<span class="hljs-selector-attr">[<span class="hljs-string">"gender"</span>]</span>  # 通过key删除
<span class="hljs-built_in">print</span>(user)  # 输出：{'name': <span class="hljs-string">'小明'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">21</span>, <span class="hljs-string">'height'</span>: <span class="hljs-number">175</span>, <span class="hljs-string">'hobbies'</span>: [<span class="hljs-string">'篮球'</span>, <span class="hljs-string">'游戏'</span>]}

user<span class="hljs-selector-class">.pop</span>("height")  # 用<span class="hljs-built_in">pop</span>()删除，返回对应的value
<span class="hljs-built_in">print</span>(user)  # 输出：{'name': <span class="hljs-string">'小明'</span>, <span class="hljs-string">'age'</span>: <span class="hljs-number">21</span>, <span class="hljs-string">'hobbies'</span>: [<span class="hljs-string">'篮球'</span>, <span class="hljs-string">'游戏'</span>]}

# <span class="hljs-number">5</span>. 其他常用操作
<span class="hljs-built_in">print</span>(len(user))  # 输出：<span class="hljs-number">3</span>（统计键值对个数）
<span class="hljs-built_in">print</span>(user.keys())  # 输出：<span class="hljs-built_in">dict_keys</span>(['name', 'age', 'hobbies'])（获取所有key）
<span class="hljs-built_in">print</span>(user.values())  # 输出：<span class="hljs-built_in">dict_values</span>(['小明', <span class="hljs-number">21</span>, ['篮球', '游戏']])（获取所有value）
<span class="hljs-built_in">print</span>(user.items())  # 输出：<span class="hljs-built_in">dict_items</span>([('name', '小明'), ('age', <span class="hljs-number">21</span>), ('hobbies', ['篮球', '游戏'])])（获取所有键值对）

# <span class="hljs-number">6</span>. 遍历字典（常用）
for key in user:
    <span class="hljs-built_in">print</span>(f<span class="hljs-string">"{key}: {user[key]}"</span>)  # 遍历key，通过key获取value
</code></pre>
<h3 data-id="heading-8">三、元组和字典的核心区别</h3>



































<table><thead><tr><th>特性</th><th>元组（tuple）</th><th>字典（dictionary）</th></tr></thead><tbody><tr><td>存储形式</td><td>有序序列（单个元素）</td><td>无序键值对（key-value）</td></tr><tr><td>是否可修改</td><td>不可修改（只读）</td><td>可修改（增删改键值对）</td></tr><tr><td>访问方式</td><td>通过索引（如 tuple [0]）</td><td>通过 key（如 dict ["name"]）</td></tr><tr><td>元素要求</td><td>元素可以是任意类型</td><td>key 必须是不可变类型，value 任意</td></tr><tr><td>核心用途</td><td>存储固定不变的数据</td><td>存储需要快速查找、映射的数据</td></tr></tbody></table>
<h3 data-id="heading-9">总结</h3>
<ol>
<li><strong>元组</strong>：用 <code>()</code> 创建，有序不可修改，通过索引访问，适合存储固定数据（如坐标、配置项）。</li>
<li><strong>字典</strong>：用 <code>{}</code> 创建，键值对结构，通过 key 快速访问 value，支持增删改，适合存储需要映射关系的数据（如用户信息、配置表）。</li>
<li>关键记住：元组的核心是 “不可变”，字典的核心是 “键值对 + 快速查找”。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解决浏览器后台定时器降频问题：用 Worker 实现高精度 setInterval]]></title>    <link>https://juejin.cn/post/7578797337868599330</link>    <guid>https://juejin.cn/post/7578797337868599330</guid>    <pubDate>2025-12-02T06:44:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578797337868599330" data-draft-id="7578892205289816104" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解决浏览器后台定时器降频问题：用 Worker 实现高精度 setInterval"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-02T06:44:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="今天也很困"/> <meta itemprop="url" content="https://juejin.cn/user/1286850568007976"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解决浏览器后台定时器降频问题：用 Worker 实现高精度 setInterval
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1286850568007976/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    今天也很困
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:44:22.000Z" title="Tue Dec 02 2025 06:44:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>前言</strong></h2>
<p>在前端开发中，我们经常使用 <code>setTimeout</code> 和 <code>setInterval</code> 来处理定时任务，例如轮询接口、动画帧、倒计时等。</p>
<p>但是，有一个常见问题：</p>
<blockquote>
<p><strong>当浏览器窗口非激活状态时（后台标签页）</strong> ，浏览器为了优化性能，会限制 <code>setTimeout</code> 和 <code>setInterval</code> 的执行频率。<br/>
这意味着你的定时任务可能被延迟，甚至停止执行。</p>
</blockquote>
<p>为了解决这个问题，我们可以使用 <strong>Web Worker</strong> 来实现 <strong>不受页面激活状态影响的定时器</strong>。</p>
<p>本文以 <code>workerTimer.setInterval</code> 为例，详细介绍实现原理和使用方式。</p>
<hr/>
<h2 data-id="heading-1"><strong>一、为什么要用 Worker</strong></h2>
<p>浏览器对非激活标签页做了性能优化：</p>
<ul>
<li>Chrome 会将 <code>setInterval</code> 的最小间隔限制到 <strong>1000ms</strong>（甚至更大）</li>
<li>Safari、Firefox 也有类似策略</li>
</ul>
<p><strong>后果</strong>：</p>
<ul>
<li>精确计时任务不再准确</li>
<li>轮询接口可能被延迟</li>
<li>动画或倒计时出现卡顿</li>
</ul>
<p><strong>解决思路</strong>：</p>
<ul>
<li><strong>Web Worker</strong> 独立于主线程</li>
<li>定时器在 Worker 内部运行，不受页面激活状态影响</li>
<li>主线程通过消息回调获取结果</li>
</ul>
<hr/>
<h2 data-id="heading-2"><strong>二、workerTimer.setInterval 原理</strong></h2>
<p><code>workerTimer</code> 封装了 Worker，实现了 <code>setInterval</code> 和 <code>setTimeout</code> 的高精度替代方案。</p>
<h3 data-id="heading-3"><strong>1. Worker 内部逻辑</strong></h3>
<ul>
<li>Worker 用 <code>setInterval</code>/<code>setTimeout</code> 来触发定时器</li>
<li>将定时事件通过 <code>postMessage</code> 发回主线程</li>
<li>Worker 内维护自己的 <code>intervalIds</code>，可随时清理</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">postMessage</span>({
    <span class="hljs-attr">message</span>: <span class="hljs-string">'interval:tick'</span>,
    <span class="hljs-attr">id</span>: data.<span class="hljs-property">id</span>
  })
}, data.<span class="hljs-property">interval</span>)
</code></pre>
<ul>
<li>每个定时器通过 <code>id</code> 标识</li>
<li>主线程收到消息后，执行对应回调</li>
</ul>
<hr/>
<h3 data-id="heading-4"><strong>2. workerTimer.setInterval 接口</strong></h3>
<pre><code class="hljs language-typescript" lang="typescript">workerTimer.<span class="hljs-built_in">setInterval</span>(<span class="hljs-attr">cb</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>, <span class="hljs-attr">interval</span>: <span class="hljs-built_in">number</span>, context?: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">number</span>
</code></pre>
<p><strong>参数说明</strong>：</p>

























<table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>cb</td><td>function</td><td>定时器回调函数</td></tr><tr><td>interval</td><td>number</td><td>时间间隔（毫秒）</td></tr><tr><td>context</td><td>any</td><td>回调函数执行上下文（可选）</td></tr></tbody></table>
<p><strong>返回值</strong>：</p>
<ul>
<li>返回一个唯一 <code>id</code>，用于清理定时器</li>
</ul>
<p><strong>内部实现</strong>：</p>
<ol>
<li><code>workerTimer</code> 自增 <code>id</code></li>
<li>将回调和上下文保存到 <code>callbacks</code></li>
<li>通过 <code>worker.postMessage</code> 启动 Worker 内的 <code>setInterval</code></li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">this</span>.id++
<span class="hljs-keyword">const</span> id = <span class="hljs-keyword">this</span>.id
<span class="hljs-keyword">this</span>.callbacks[id] = { fn: cb, context }
worker.postMessage({
  command: <span class="hljs-string">'interval:start'</span>,
  interval,
  id
})
<span class="hljs-keyword">return</span> id
</code></pre>
<hr/>
<h3 data-id="heading-5"><strong>3. 回调处理</strong></h3>
<p>Worker 每次触发定时器，发送消息到主线程：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title function_ invoke__">postMessage</span>({
  <span class="hljs-attr">message</span>: <span class="hljs-string">'interval:tick'</span>,
  <span class="hljs-attr">id</span>: data.id
})
</code></pre>
<p>主线程接收消息后：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">const</span> callbackItem = <span class="hljs-keyword">this</span>.callbacks[id]
<span class="hljs-keyword">if</span> (callbackItem?.fn) callbackItem.fn.call(callbackItem.context)
</code></pre>
<ul>
<li>找到对应的回调</li>
<li>用保存的上下文执行函数</li>
<li>保证了定时器逻辑与原生 <code>setInterval</code> 一致</li>
</ul>
<hr/>
<h3 data-id="heading-6"><strong>4. 清理定时器</strong></h3>
<pre><code class="hljs language-bash" lang="bash">workerTimer.clearInterval(<span class="hljs-built_in">id</span>)
</code></pre>
<ul>
<li>发送消息到 Worker</li>
<li>Worker 内部调用 <code>clearInterval</code></li>
<li>删除 <code>callbacks</code> 中对应条目</li>
<li>避免内存泄漏</li>
</ul>
<hr/>
<h2 data-id="heading-7"><strong>三、使用示例</strong></h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> workerTimer <span class="hljs-keyword">from</span> <span class="hljs-string">'./workerTimer'</span>

<span class="hljs-comment">// 每秒打印一次</span>
<span class="hljs-keyword">const</span> timerId = workerTimer.<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'tick'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>())
}, <span class="hljs-number">1000</span>)

<span class="hljs-comment">// 5秒后停止</span>
workerTimer.<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  workerTimer.<span class="hljs-built_in">clearInterval</span>(timerId)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'interval cleared'</span>)
}, <span class="hljs-number">5000</span>)
</code></pre>
<p><strong>特点</strong>：</p>
<ul>
<li>在后台标签页也能保持高精度</li>
<li>回调函数可绑定自定义上下文</li>
<li>支持同时管理多个定时器</li>
</ul>
<hr/>
<h2 data-id="heading-8"><strong>四、总结</strong></h2>
<ul>
<li>浏览器后台标签页会降低原生定时器精度</li>
<li>使用 Worker 可以实现 <strong>高精度、独立于页面状态的定时器</strong></li>
<li><code>workerTimer.setInterval</code> 封装了 Worker 内部逻辑，提供与原生 API 接近的接口</li>
<li>可配合 <code>workerTimer.setTimeout</code> 实现完整定时器功能</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 定义Worker消息类型</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">WorkerMessage</span> {
  <span class="hljs-attr">command</span>: <span class="hljs-built_in">string</span>
  interval?: <span class="hljs-built_in">number</span>
  timeout?: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">WorkerResponse</span> {
  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
}

<span class="hljs-comment">// 创建Web Worker</span>
<span class="hljs-keyword">const</span> blobURL = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>(
    [
      <span class="hljs-string">'('</span>,

      <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">const</span> <span class="hljs-attr">intervalIds</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>&gt; = {}

        self.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span> <span class="hljs-title function_">onMsgFunc</span>(<span class="hljs-params">e: MessageEvent</span>) {
          <span class="hljs-keyword">const</span> data = e.<span class="hljs-property">data</span>
          <span class="hljs-keyword">switch</span> (data.<span class="hljs-property">command</span>) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'interval:start'</span>: {
              <span class="hljs-keyword">const</span> intervalId = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
                <span class="hljs-title function_">postMessage</span>({
                  <span class="hljs-attr">message</span>: <span class="hljs-string">'interval:tick'</span>,
                  <span class="hljs-attr">id</span>: data.<span class="hljs-property">id</span>
                })
              }, data.<span class="hljs-property">interval</span>)

              <span class="hljs-title function_">postMessage</span>({
                <span class="hljs-attr">message</span>: <span class="hljs-string">'interval:started'</span>,
                <span class="hljs-attr">id</span>: data.<span class="hljs-property">id</span>
              })

              intervalIds[data.<span class="hljs-property">id</span>] = intervalId <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>
              <span class="hljs-keyword">break</span>
            }
            <span class="hljs-keyword">case</span> <span class="hljs-string">'interval:clear'</span>: {
              <span class="hljs-built_in">clearInterval</span>(intervalIds[data.<span class="hljs-property">id</span>])
              <span class="hljs-title function_">postMessage</span>({
                <span class="hljs-attr">message</span>: <span class="hljs-string">'interval:cleared'</span>,
                <span class="hljs-attr">id</span>: data.<span class="hljs-property">id</span>
              })
              <span class="hljs-keyword">delete</span> intervalIds[data.<span class="hljs-property">id</span>]
              <span class="hljs-keyword">break</span>
            }
            <span class="hljs-keyword">case</span> <span class="hljs-string">'timeout:start'</span>: {
              <span class="hljs-keyword">const</span> timeoutId = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                <span class="hljs-title function_">postMessage</span>({
                  <span class="hljs-attr">message</span>: <span class="hljs-string">'timeout:tick'</span>,
                  <span class="hljs-attr">id</span>: data.<span class="hljs-property">id</span>
                })
                <span class="hljs-title function_">postMessage</span>({
                  <span class="hljs-attr">message</span>: <span class="hljs-string">'timeout:cleared'</span>,
                  <span class="hljs-attr">id</span>: data.<span class="hljs-property">id</span>
                })
                <span class="hljs-keyword">delete</span> intervalIds[data.<span class="hljs-property">id</span>]
              }, data.<span class="hljs-property">timeout</span>)

              intervalIds[data.<span class="hljs-property">id</span>] = timeoutId <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>
              <span class="hljs-keyword">break</span>
            }
            <span class="hljs-keyword">case</span> <span class="hljs-string">'timeout:clear'</span>: {
              <span class="hljs-built_in">clearTimeout</span>(intervalIds[data.<span class="hljs-property">id</span>])
              <span class="hljs-title function_">postMessage</span>({
                <span class="hljs-attr">message</span>: <span class="hljs-string">'timeout:cleared'</span>,
                <span class="hljs-attr">id</span>: data.<span class="hljs-property">id</span>
              })
              <span class="hljs-keyword">delete</span> intervalIds[data.<span class="hljs-property">id</span>]
              <span class="hljs-keyword">break</span>
            }
          }
        }
      }.<span class="hljs-title function_">toString</span>(),

      <span class="hljs-string">')()'</span>
    ],
    { <span class="hljs-attr">type</span>: <span class="hljs-string">'application/javascript'</span> }
  )
)

<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(blobURL)
<span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">revokeObjectURL</span>(blobURL)

<span class="hljs-keyword">type</span> <span class="hljs-title class_">CallbackItem</span> = {
  <span class="hljs-attr">fn</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
    context?: <span class="hljs-built_in">any</span>
}

<span class="hljs-keyword">const</span> workerTimer = {
    <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">callbacks</span>: {} <span class="hljs-keyword">as</span> <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-title class_">CallbackItem</span>&gt;,

  <span class="hljs-built_in">setInterval</span>(<span class="hljs-attr">cb</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>, <span class="hljs-attr">interval</span>: <span class="hljs-built_in">number</span>, context?: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>++
  <span class="hljs-keyword">const</span> id = <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>[id] = { <span class="hljs-attr">fn</span>: cb, context }
  worker.<span class="hljs-title function_">postMessage</span>({
    <span class="hljs-attr">command</span>: <span class="hljs-string">'interval:start'</span>,
    interval,
    id
  })
  <span class="hljs-keyword">return</span> id
},

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-attr">cb</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>, <span class="hljs-attr">timeout</span>: <span class="hljs-built_in">number</span>, context?: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">number</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>++
  <span class="hljs-keyword">const</span> id = <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>[id] = { <span class="hljs-attr">fn</span>: cb, context }
  worker.<span class="hljs-title function_">postMessage</span>({
    <span class="hljs-attr">command</span>: <span class="hljs-string">'timeout:start'</span>,
    timeout,
    id
  })
  <span class="hljs-keyword">return</span> id
},

<span class="hljs-title function_">onMessage</span>(<span class="hljs-params">e: MessageEvent&lt;WorkerResponse&gt;</span>) {
  <span class="hljs-keyword">const</span> { message, id } = e.<span class="hljs-property">data</span>
  <span class="hljs-keyword">switch</span> (message) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'interval:tick'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'timeout:tick'</span>: {
      <span class="hljs-keyword">const</span> callbackItem = <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>[id]
      <span class="hljs-keyword">if</span> (callbackItem?.<span class="hljs-property">fn</span>) callbackItem.<span class="hljs-property">fn</span>.<span class="hljs-title function_">call</span>(callbackItem.<span class="hljs-property">context</span>)
      <span class="hljs-keyword">break</span>
    }

    <span class="hljs-keyword">case</span> <span class="hljs-string">'interval:cleared'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'timeout:cleared'</span>:
      <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbacks</span>[id]
      <span class="hljs-keyword">break</span>
  }
},

<span class="hljs-title function_">clearInterval</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) {
  worker.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">command</span>: <span class="hljs-string">'interval:clear'</span>, id })
},

<span class="hljs-title function_">clearTimeout</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span></span>) {
  worker.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">command</span>: <span class="hljs-string">'timeout:clear'</span>, id })
}
}

worker.<span class="hljs-property">onmessage</span> = workerTimer.<span class="hljs-property">onMessage</span>.<span class="hljs-title function_">bind</span>(workerTimer)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> workerTimer
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C语言循环嵌套]]></title>    <link>https://juejin.cn/post/7578797337868533794</link>    <guid>https://juejin.cn/post/7578797337868533794</guid>    <pubDate>2025-12-02T06:30:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578797337868533794" data-draft-id="7576914798056554548" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C语言循环嵌套"/> <meta itemprop="keywords" content="C语言"/> <meta itemprop="datePublished" content="2025-12-02T06:30:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Andys"/> <meta itemprop="url" content="https://juejin.cn/user/4276469480849276"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C语言循环嵌套
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4276469480849276/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Andys
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:30:55.000Z" title="Tue Dec 02 2025 06:30:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">循环嵌套</h2>
<pre><code class="hljs language-C" lang="C"><span class="hljs-keyword">for</span>(初始化表达式;循环条件;操作表达式){
    <span class="hljs-keyword">for</span>(初始化表达式<span class="hljs-number">1</span>;循环条件<span class="hljs-number">1</span>;操作表达式<span class="hljs-number">1</span>){
        执行语句
    }

}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/609a8359ee0d46c5a87f1901005e2aaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5keXM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261854&amp;x-signature=NDhUh2mLsy7v4Lz9k5PuJzwnmpA%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-C" lang="C"><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">10</span>;i++){
		
		<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, i);
		
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=<span class="hljs-number">10</span>;j++){
			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"j=%d\n"</span>, j);
			
			<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> k=<span class="hljs-number">1</span>;k&lt;=<span class="hljs-number">10</span>;k++){
				<span class="hljs-built_in">printf</span>(<span class="hljs-string">"i=%d, j=%d, k=%d\n"</span>, i, j, k);
			}
		}
	}
	


</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a99e4bf3b67f4a019e8616acd15ac0c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5keXM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261854&amp;x-signature=ezjjqyYrpMq1WPVh%2FCGRQYh6Ch8%3D" alt="image.png" loading="lazy"/></p>
<p>如图所示，图中代码可以用来打网上很火的圣诞树代码，也是
运用了循环嵌套。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e86d8e107d0b4d01a79504800e991046~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5keXM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261854&amp;x-signature=lmrSR8cF3JF8KDyzMvwcv6a5%2BPs%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-C" lang="C"> <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">5</span>;i++){
		
		<span class="hljs-comment">//printf("%d\n", i);</span>
		
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">5</span>;j&gt;=i;j--){
			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>, i);
			
		}<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
	
	}
	
	

</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7edf4f44c6654b49aba21a8c155d6edc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5keXM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261854&amp;x-signature=Pn1w%2F2WxcmZW%2FeRZWkt8Pk4vQsE%3D" alt="image.png" loading="lazy"/></p>
<p>下方是正着打的代码</p>
<pre><code class="hljs language-C" lang="C">	
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">5</span>;i++){
		
		<span class="hljs-comment">//printf("%d\n", i);</span>
		
		<span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> j=<span class="hljs-number">1</span>;j&lt;=i;j++){
			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>, i);
			
		}<span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
	
	}
	

</code></pre>
<p>运行后可以得到以下结果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52f229f0f1e44d779c3122cbe5f9c813~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5keXM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765261854&amp;x-signature=t7h%2FTVP0M%2Fo5Ky8xyx%2B9aXYjUo0%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[重新学习 Git：从版本控制系统说起]]></title>    <link>https://juejin.cn/post/7578781397118500910</link>    <guid>https://juejin.cn/post/7578781397118500910</guid>    <pubDate>2025-12-02T06:17:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578781397118500910" data-draft-id="7578793960627634202" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="重新学习 Git：从版本控制系统说起"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-02T06:17:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="系夏普"/> <meta itemprop="url" content="https://juejin.cn/user/895462143964748"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            重新学习 Git：从版本控制系统说起
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895462143964748/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    系夏普
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:17:56.000Z" title="Tue Dec 02 2025 06:17:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>准备重新学习一遍git，查漏补缺，一起学习进步。</p>
<h2 data-id="heading-0">1. 什么是版本控制系统（VCS）？</h2>
<p><strong>版本控制系统</strong>（Version Control System, VCS）是一种用于追踪文件变更、管理历史版本、支持多人协作开发的工具。它的核心价值在于解决三大痛点：</p>
<ul>
<li><strong>文件修改混乱</strong>（改来改去不知道哪个是最新/最好的）</li>
<li><strong>历史记录丢失</strong>（删了重要内容却无法找回）</li>
<li><strong>多人协作冲突</strong>（同事覆盖了你的代码，你覆盖了他的设计）</li>
</ul>
<p>简而言之，你可以把 VCS 想象成一个<strong>自动存档 + 时光机</strong>。</p>
<h3 data-id="heading-1">举个例子：</h3>
<p>你正在写一篇作文或者文章。如果没有 VCS，你可能会这样操作：</p>
<ul>
<li>“作文-初稿.doc”</li>
<li>“作文-修改1.doc”</li>
<li>“作文-修改2-加结尾版.doc”</li>
<li>“作文-最终版-真的最终版.doc”</li>
</ul>
<p>最后你面对一堆文件，根本分不清哪一版最好，还容易误删。</p>
<p>而有了版本控制系统，它会自动帮你：</p>
<ul>
<li>记录每一次修改的内容和时间</li>
<li>标注是谁做了这次更改</li>
<li>允许你一键回退到任意历史版本</li>
<li>在多人协作时智能合并不同人的修改，避免互相覆盖</li>
</ul>
<blockquote>
<p><strong>总结一句话</strong>：VCS 让你<strong>安全地记录变化，方便回溯和协作</strong>。</p>
</blockquote>
<p>虽然程序员最常用它管理代码，但其实<strong>任何文件</strong>（文档、设计稿、论文、配置文件等）都可以用 VCS 管理。</p>
<hr/>
<h2 data-id="heading-2">2. 集中式 vs 分布式：两种 VCS 架构</h2>
<p>版本控制系统主要分为两类：<strong>集中式</strong>（Centralized） 和 <strong>分布式</strong>（Distributed）。它们最大的区别在于：<strong>历史记录存在哪里？能不能在没网的时候工作？</strong></p>
<hr/>
<h3 data-id="heading-3">集中式版本控制系统（CVCS）</h3>
<p><strong>代表工具</strong>：SVN（Subversion）</p>
<h4 data-id="heading-4">类比：图书馆借书</h4>
<ul>
<li>所有书籍（代码 + 完整历史）都存放在<strong>中央服务器</strong>（图书馆）。</li>
<li>你要看书，必须联网去“借”最新版本。</li>
<li>看完要“还”回去，才能让别人看到你的修改。</li>
<li>如果图书馆关门了（服务器宕机）或路上封路了（断网），你就<strong>既不能借书，也不能还书</strong>。</li>
</ul>
<h4 data-id="heading-5">特点：</h4>
<ul>
<li>✅ 结构简单，权限管理集中</li>
<li>❌ <strong>严重依赖网络</strong></li>
<li>❌ <strong>单点故障风险高</strong>（服务器一崩，全员停工）</li>
<li>❌ 本地通常只有当前版本，<strong>看不到完整历史</strong></li>
</ul>
<blockquote>
<p>就像班级群里共享一个在线文档——所有人围着同一个文件操作，稍不注意就覆盖别人的内容。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">分布式版本控制系统（DVCS）</h3>
<p><strong>代表工具</strong>：<strong>Git</strong></p>
<p>当你参与一个 Git 项目时，你会通过 <code>git clone</code> 命令<strong>完整复制整个仓库到本地</strong>，包括：</p>
<ul>
<li>当前所有文件</li>
<li>全部历史版本</li>
<li>每次提交的作者、时间、修改内容</li>
</ul>
<p>这意味着：</p>
<ul>
<li>
<p>✅ <strong>无需网络也能工作</strong>：你可以在无网环境里反复提交、创建分支、对比版本。</p>
<ul>
<li>小故事：现在国内信号覆盖广，很少出现这种断网情况，没网的环境还工作嘛？确实有些保密企业不能联网，还记得刚毕业第一份工作，第一个月去客户拉单晶硅车间，就要上交手机，电脑断网，电气同事向日葵被ban，懂的都懂(<em>ﾟ∀ﾟ</em>)。</li>
</ul>
</li>
<li>
<p>✅ <strong>完整备份</strong>：每个协作者的电脑都是一份完整备份，不怕服务器丢失数据</p>
</li>
<li>
<p>✅ <strong>灵活协作</strong>：改好了再联网，用 <code>git push</code>把你的成果同步到远程仓库（如 GitHub、GitLab）</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次uniapp问题排查]]></title>    <link>https://juejin.cn/post/7578797337868615714</link>    <guid>https://juejin.cn/post/7578797337868615714</guid>    <pubDate>2025-12-02T06:47:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578797337868615714" data-draft-id="7578901433970458624" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次uniapp问题排查"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-02T06:47:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="只与明月听"/> <meta itemprop="url" content="https://juejin.cn/user/386661153249102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次uniapp问题排查
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/386661153249102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    只与明月听
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T06:47:45.000Z" title="Tue Dec 02 2025 06:47:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近在开发uniapp，虽然第一次写，但是有vue开发经验，也没觉得有啥不一样的，上手还是比较简单的，但是明显我还是低估了uniapp的复杂度，这东西难点不在于业务开发，而是各个不同机型的适配，相比于传统的web开发，还是繁琐了很多。</p>
<p>业务开发中遇到了一个蛮有趣的问题，这里总结下。</p>
<h5 data-id="heading-0">背景与环境</h5>
<p>首先简单的描述下背景：就是在app登出的时候，发现了苹果6Plus在退出登录时表现不一样的地方，H5和安卓以及苹果16、ipad都表现正常，就是点击退出登录按钮，弹出一个弹窗，点击退出登录，跳转到到登录页，很常规的一个操作了，但是在苹果6Plus机型上，出现了异常，弹窗点击不动，页面出现了卡死，只能杀死应用重新进入。</p>
<p>这里贴下相关代码：</p>
<pre><code class="hljs language-php" lang="php">message.<span class="hljs-title function_ invoke__">comform</span>({
   <span class="hljs-attr"> msg</span>:<span class="hljs-string">"确定退出登录嘛"</span>,
   <span class="hljs-attr"> title</span>:<span class="hljs-string">"退出登录"</span>
}).<span class="hljs-title function_ invoke__">then</span>(res =&gt; {
    await userStore.<span class="hljs-title function_ invoke__">logout</span>()
    uni.<span class="hljs-title function_ invoke__">redirectTo</span>({
       <span class="hljs-attr"> url</span>:<span class="hljs-string">'/pages/login/index'</span>
    })
})
</code></pre>
<p>这里就是清除下<code>userStore</code>中的状态，然后就跳转路由到登录页。</p>
<blockquote>
<p>这里总结下uniapp路由跳转的方式</p>
<ol start="0">
<li>uni.navigateTo 保留当掐你页面，跳转到某个应用内的页面</li>
</ol>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 带参数跳转</span>
uni.<span class="hljs-title function_ invoke__">navigateTo</span>({
 <span class="hljs-attr"> url</span>: <span class="hljs-string">'/pages/detail/detail?id=123&amp;name=test'</span>
})
​
<span class="hljs-comment">// 对象参数（需要编码）</span>
uni.<span class="hljs-title function_ invoke__">navigateTo</span>({
 <span class="hljs-attr"> url</span>: <span class="hljs-string">'/pages/detail/detail?data='</span> + <span class="hljs-title function_ invoke__">encodeURIComponent</span>(JSON.<span class="hljs-title function_ invoke__">stringify</span>({
   <span class="hljs-attr"> id</span>: <span class="hljs-number">123</span>,
   <span class="hljs-attr"> name</span>: <span class="hljs-string">'test'</span>
  }))
})
</code></pre>
<ol start="2">
<li>uni.redirectTo 关闭当前页面 跳转到应用内的某个页面</li>
</ol>
<pre><code class="hljs language-css" lang="css">uni<span class="hljs-selector-class">.redirectTo</span>({
  url: <span class="hljs-string">'/pages/home/home'</span>
})
</code></pre>
<ol start="3">
<li>uni.reLaunch 关闭所有页面，打开到应用内的某个页面</li>
</ol>
<pre><code class="hljs language-css" lang="css">uni<span class="hljs-selector-class">.reLaunch</span>({
  url: <span class="hljs-string">'/pages/index/index'</span>
})
</code></pre>
<ol start="4">
<li>uni.switchTab 跳转到tabBar页面，并关闭其他所有非tabBar页面</li>
</ol>
<pre><code class="hljs language-css" lang="css">uni<span class="hljs-selector-class">.switchTab</span>({
  url: <span class="hljs-string">'/pages/home/home'</span>
})
</code></pre>
<ol start="5">
<li>uni.navigateBack 返回上一级或者多级页面</li>
</ol>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 返回上一页</span>
uni<span class="hljs-selector-class">.navigateBack</span>()
​
<span class="hljs-comment">// 返回多级页面</span>
uni<span class="hljs-selector-class">.navigateBack</span>({
  delta: <span class="hljs-number">2</span>  // 返回<span class="hljs-number">2</span>级
})
</code></pre>
</blockquote>
<p>其中<code>logout</code>也是比较简单了，代码如下：</p>
<pre><code class="hljs language-scss" lang="scss">const layout = async () =&gt; { 
    <span class="hljs-built_in">removeToken</span>()
    <span class="hljs-built_in">resetState</span>()
}
</code></pre>
<p>也就是登录前移除token和store中的一些状态，看代码没有任何问题，但是就是在苹果6Plus中出现卡顿，很费解，光看代码看不出任何问题，就带着问题问了下gpt，知道了<code>WKWebView 导航队列锁</code>这个东西。</p>
<h5 data-id="heading-1">WKWebView 导航队列锁</h5>
<p><code>WKWebView</code> 导航队列锁定是 WebKit 内核中的一个<strong>线程安全机制</strong>，旨在防止在页面加载过程中的竞态条件。但在老版本中，这个机制实现得过于保守，导致并发导航操作容易被阻塞。</p>
<p>主要有这么几个场景会触发</p>
<ol start="0">
<li>
<p>快速连续导航调用</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 微观时序问题 - 导航竞争</span>
<span class="hljs-keyword">const</span> startTime = performance.<span class="hljs-title function_">now</span>();
​
<span class="hljs-comment">// 导航请求1 - 第0ms</span>
uni.<span class="hljs-title function_">navigateTo</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/pageA'</span> });
​
<span class="hljs-comment">// 在导航1还未完成状态转换时...</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 导航请求2 - 第5ms (此时导航1可能还在 WKNavigationStateScheduled)</span>
    uni.<span class="hljs-title function_">navigateTo</span>({ <span class="hljs-attr">url</span>: <span class="hljs-string">'/pageB'</span> });
}, <span class="hljs-number">5</span>);
</code></pre>
</li>
<li>
<p>资源加载与导航竞争</p>
<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-comment">// WebKit 内部资源加载时序</span>
- (<span class="hljs-type">void</span>)startNavigation:(<span class="hljs-built_in">WKNavigation</span> *)navigation {
    [<span class="hljs-keyword">self</span> acquireNavigationLock]; <span class="hljs-comment">// 获取导航锁</span>
    
    <span class="hljs-comment">// 开始加载主文档</span>
    [<span class="hljs-keyword">self</span> loadMainDocument];
    
    <span class="hljs-comment">// 此时如果主文档中有同步资源请求</span>
    <span class="hljs-comment">// &lt;script src="sync-script.js"&gt;&lt;/script&gt;</span>
    <span class="hljs-comment">// 资源加载会阻塞导航锁释放</span>
    
    [<span class="hljs-keyword">self</span> releaseNavigationLock]; <span class="hljs-comment">// 延迟释放！</span>
}
</code></pre>
</li>
<li>
<p>js桥接与导航交互</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// uni-app 框架层可能的问题</span>
<span class="hljs-comment">// 1. 页面生命周期钩子与导航竞争</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">onLoad</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 在 onLoad 中执行耗时操作</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadHeavyData</span>(); <span class="hljs-comment">// 阻塞导航完成</span>
    },
    
    <span class="hljs-title function_">onShow</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 触发 UI 更新，需要渲染锁</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startAnimation</span>(); 
    }
}
​
</code></pre>
<p>这个实例中，onLoad的触发时机是页面首次创建时 ， onShow触发是页面显示的时候会触发，当onLoad中执行loadHeavyData耗时操作时，等页面显示执行onShow中的startAnimation就会导致竞争资源，就会触发队列锁，导致页面卡死，比较好的方法就是让他们再一个方法中执行，然后将他们的步骤拆分下，比如这样：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">onLoad() {
    <span class="hljs-comment">// 阶段1: 立即执行 (导航锁持有期间)</span>
    <span class="hljs-keyword">this</span>.initUIState();
​
    <span class="hljs-comment">// 阶段2: 延迟执行 (导航锁释放后)</span>
    <span class="hljs-keyword">this</span>.deferHeavyTask();
​
    <span class="hljs-comment">// 阶段3: 空闲时执行</span>
    <span class="hljs-keyword">this</span>.idleNonCriticalTask();
},
</code></pre>
</li>
<li>
<p>css、js动画与js冲突</p>
<pre><code class="hljs language-ini" lang="ini">function startAnimation() {
    const <span class="hljs-attr">element</span> = document.querySelector(<span class="hljs-string">'.animated'</span>)<span class="hljs-comment">;</span>
    <span class="hljs-attr">element.style.transform</span> = <span class="hljs-string">'translateX(0)'</span><span class="hljs-comment">;</span>
    
    // 触发 CSS 动画
    requestAnimationFrame(() =&gt; {
        <span class="hljs-attr">element.style.transform</span> = <span class="hljs-string">'translateX(100px)'</span><span class="hljs-comment">;</span>
        
        // 在同一帧内触发导航
        uni.navigateTo({ url: '/next' })<span class="hljs-comment">; // 危险！</span>
    })<span class="hljs-comment">;</span>
}
</code></pre>
</li>
</ol>
<p>然后回到项目相关代码，似乎也没有很大的计算量导致资源竞争，触发队列锁，看下gpt5优化后的代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> clicking = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogout</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span>(clicking.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>
    click.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">await</span> message.<span class="hljs-title function_">confirm</span>({<span class="hljs-attr">msg</span>:<span class="hljs-string">'确定退出登录？'</span>,<span class="hljs-attr">title</span>:<span class="hljs-string">'退出登录'</span>})
    useStore.<span class="hljs-title function_">logOut</span>()
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> clicking.<span class="hljs-property">value</span>=<span class="hljs-literal">false</span>,<span class="hljs-number">300</span>)
}
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">delay</span> = ms =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(r,ms))
<span class="hljs-keyword">const</span> loggingOut = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">LogOut</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span>(loggingOut.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>
    loggingOut.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
    <span class="hljs-title function_">removeToken</span>()
    <span class="hljs-title function_">resetState</span>()
    uni.<span class="hljs-property">$emit</span>?.(<span class="hljs-string">'router:unlock'</span>)
    uni.<span class="hljs-property">$emit</span>?.(<span class="hljs-string">'ui:closs-popups'</span>)
    
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">220</span>)
    
    <span class="hljs-keyword">try</span> {uni.<span class="hljs-title function_">reLaunch</span>({<span class="hljs-attr">url</span>:<span class="hljs-string">'/pages/login/index'</span>}) } <span class="hljs-keyword">catch</span> {}
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">try</span>{uni.<span class="hljs-title function_">relaunch</span>({<span class="hljs-attr">url</span>:<span class="hljs-string">'/pages/login/index'</span>}) <span class="hljs-keyword">catch</span> {}, <span class="hljs-number">700</span>)
    
    loggingOut.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
}
</code></pre>
<p>看了下代码，似乎也没有啥变更，只是都加了个开关，然后加了个延时操作，但是问题确实解决了。确实非常奇怪的问题。</p>
<h5 data-id="heading-2"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么事务注解会失效？一文搞懂 AOP 代理原理与解决方案]]></title>    <link>https://juejin.cn/post/7578762210287550527</link>    <guid>https://juejin.cn/post/7578762210287550527</guid>    <pubDate>2025-12-02T03:45:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578762210287550527" data-draft-id="7578811288819335211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么事务注解会失效？一文搞懂 AOP 代理原理与解决方案"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-02T03:45:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="5h0wer"/> <meta itemprop="url" content="https://juejin.cn/user/2015829577707083"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么事务注解会失效？一文搞懂 AOP 代理原理与解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2015829577707083/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    5h0wer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T03:45:07.000Z" title="Tue Dec 02 2025 03:45:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、问题的重现：事务失效的诡异现象</h2>
<p>在前段时间的项目学习中，我遇见了一个问题，就是当我在一个方法中调用一个有事务注解的方法时，idea提示事务会失效。如下图，我对一个单个创建的方法加了回滚的事务，而后续批量插入调用了这个方法，此时出现了这个提示。</p>
<p><strong>@Transactional 自调用(实际上是目标对象内)的方法调用目标对象的另一个方法/在运行时不会导致实际的事务</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5b7822e022140f8b9aae9481c539bd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgNWgwd2Vy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765251907&amp;x-signature=yy3cQGQ%2BBYnj3FpT8OeRfSfIJqo%3D" alt="" loading="lazy"/></p>
<p>起初我并没有深究，直到近期的面试中，面试官问了我一个问题，当两个serviceA和serviceB方法位于同一个Service类中，serviceB定义了切面，然后serviceA调用serviceB，切面会生效吗？我当时回答不会，因为无法创建代理对象。</p>
<p>是的，@Transaction 注解就是通过AOP实现的，事后我恍然大悟，原来是AOP搞的鬼！</p>
<h2 data-id="heading-1">二、AOP：Spring框架的隐形功臣</h2>
<p>那什么是AOP呢？AOP作为Spring的核心思想，与IoC和DI共同实现了Spring的高内聚、低耦合、轻量的特性，是Spring整个生态不可或缺的基石。AOP（Aspect-Oriented Programming）是一种编程范式，旨在解决横切关注点（cross-cutting concerns）的模块化问题。它允许开发者将影响多个类的公共行为（如日志、事务、安全等）从业务逻辑中分离出来。具有以下的核心思想：</p>
<ul>
<li><strong>关注点分离</strong>：将系统分为核心关注点（业务逻辑）和横切关注点（通用功能）</li>
<li><strong>增强而非修改</strong>：通过动态织入方式为现有代码添加功能，而不是直接修改源代码</li>
</ul>
<p>对于一个切面，我们会通过@Before、@After、@Around等注解定义切面织入的位置。</p>
<h2 data-id="heading-2">三、深入理解：AOP的实现原理——代理模式</h2>
<p>要真正理解为什么事务注解会失效，我们需要深入AOP的实现机制。Spring AOP的核心就是<strong>代理模式</strong>。Spring不会直接调用我们的业务对象，而是创建一个代理对象，通过这个代理对象来间接调用。</p>
<h3 data-id="heading-3">代理对象的工作机制</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 原始业务对象</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchCreateUsers</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 这里直接调用createUser() - 问题所在！</span>
        <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            <span class="hljs-title function_">createUser</span>(); <span class="hljs-comment">// ❌ 事务不会生效，因为不是代理对象调用，没有实现切面的织入！</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-4">Spring AOP的两种动态代理方式</h3>
<p>Spring AOP主要使用两种动态代理技术：JDK动态代理和CGLIB动态代理。</p>
<h4 data-id="heading-5">1. JDK动态代理</h4>
<p><strong>原理</strong>：基于接口实现，使用Java反射机制</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 示例：JDK动态代理的实现原理</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JdkDynamicProxyDemo</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-comment">// 目标对象</span>
        <span class="hljs-title class_">UserService</span> target = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();
        
        <span class="hljs-comment">// 创建代理对象</span>
        <span class="hljs-title class_">UserService</span> proxy = (<span class="hljs-title class_">UserService</span>) <span class="hljs-title class_">Proxy</span>.<span class="hljs-title function_">newProxyInstance</span>(
            target.<span class="hljs-title function_">getClass</span>().<span class="hljs-title function_">getClassLoader</span>(),
            target.<span class="hljs-title function_">getClass</span>().<span class="hljs-title function_">getInterfaces</span>(),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvocationHandler</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-title class_">Object</span> proxy, <span class="hljs-title class_">Method</span> method, <span class="hljs-title class_">Object</span>[] args) 
                    throws <span class="hljs-title class_">Throwable</span> {
                    
                    <span class="hljs-comment">// 前置增强：开启事务</span>
                    <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"开启事务..."</span>);
                    
                    <span class="hljs-comment">// 调用目标方法</span>
                    <span class="hljs-title class_">Object</span> result = method.<span class="hljs-title function_">invoke</span>(target, args);
                    
                    <span class="hljs-comment">// 后置增强：提交事务</span>
                    <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"提交事务..."</span>);
                    
                    <span class="hljs-keyword">return</span> result;
                }
            }
        );
        
        <span class="hljs-comment">// 通过代理对象调用方法</span>
        proxy.<span class="hljs-title function_">createUser</span>(); <span class="hljs-comment">// ✅ 事务生效，代理对象织入了切面的逻辑</span>
    }
}
</code></pre>
<p><strong>JDK动态代理的特点：</strong></p>
<ul>
<li>只能为接口创建代理</li>
<li>要求目标类至少实现一个接口</li>
<li>使用<code>java.lang.reflect.Proxy</code>类</li>
<li>性能相对较好（Java 8+优化后）</li>
</ul>
<h4 data-id="heading-6">2. CGLIB动态代理</h4>
<p><strong>原理</strong>：基于类继承，使用字节码生成技术</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 示例：CGLIB动态代理的实现原理</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CglibProxyDemo</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-comment">// 创建Enhancer对象</span>
        <span class="hljs-title class_">Enhancer</span> enhancer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Enhancer</span>();
        
        <span class="hljs-comment">// 设置父类（目标类）</span>
        enhancer.<span class="hljs-title function_">setSuperclass</span>(<span class="hljs-title class_">UserServiceImpl</span>.<span class="hljs-property">class</span>);
        
        <span class="hljs-comment">// 设置回调</span>
        enhancer.<span class="hljs-title function_">setCallback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodInterceptor</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-title class_">Object</span> <span class="hljs-title function_">intercept</span>(<span class="hljs-title class_">Object</span> obj, <span class="hljs-title class_">Method</span> method, 
                                    <span class="hljs-title class_">Object</span>[] args, <span class="hljs-title class_">MethodProxy</span> proxy) 
                throws <span class="hljs-title class_">Throwable</span> {
                
                <span class="hljs-comment">// 前置增强：开启事务</span>
                <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"CGLIB代理：开启事务..."</span>);
                
                <span class="hljs-comment">// 调用父类方法</span>
                <span class="hljs-title class_">Object</span> result = proxy.<span class="hljs-title function_">invokeSuper</span>(obj, args);
                
                <span class="hljs-comment">// 后置增强：提交事务</span>
                <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"CGLIB代理：提交事务..."</span>);
                
                <span class="hljs-keyword">return</span> result;
            }
        });
        
        <span class="hljs-comment">// 创建代理对象</span>
        <span class="hljs-title class_">UserService</span> proxy = (<span class="hljs-title class_">UserService</span>) enhancer.<span class="hljs-title function_">create</span>();
        
        <span class="hljs-comment">// 通过代理对象调用方法</span>
        proxy.<span class="hljs-title function_">createUser</span>(); <span class="hljs-comment">// ✅ 事务生效，代理对象织入了切面的逻辑</span>
    }
}
</code></pre>
<p><strong>CGLIB动态代理的特点：</strong></p>
<ul>
<li>可以为类创建代理（不需要接口）</li>
<li>通过继承目标类实现代理</li>
<li>使用ASM字节码操作框架</li>
<li>不能代理final类和方法（无法继承或重写）</li>
<li>性能略低于JDK动态代理（但差距不大）</li>
</ul>
<h2 data-id="heading-7">四、揭开谜底：为什么事务注解会失效？</h2>
<p>现在我们可以回答开头的问题了。事务失效的根本原因在于<strong>代理对象的调用机制</strong>。</p>
<h3 data-id="heading-8">问题重现分析</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        <span class="hljs-comment">// 数据库插入操作</span>
        userDao.<span class="hljs-title function_">insert</span>(user);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchCreateUsers</span>(<span class="hljs-params">List&lt;User&gt; users</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">User</span> user : users) {
            <span class="hljs-comment">// 问题：这里调用的是this.createUser()，而不是代理对象的createUser()</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createUser</span>(user);
            <span class="hljs-comment">// 正确做法：应该调用代理对象的createUser()方法</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-9">图解调用流程</h3>
<pre><code class="hljs language-scss" lang="scss">错误调用流程：
<span class="hljs-built_in">batchCreateUsers</span>() → this<span class="hljs-selector-class">.createUser</span>() → 原始对象的<span class="hljs-built_in">createUser</span>()
                            ↓
                     ❌ 切面没有织入，没有事务控制！

正确调用流程：
<span class="hljs-built_in">batchCreateUsers</span>() → 代理对象<span class="hljs-selector-class">.createUser</span>() → 原始对象的<span class="hljs-built_in">createUser</span>()
                            ↓
                    ✅ 切面织入，有事务控制（前置：开启事务，后置：提交事务）
</code></pre>
<h3 data-id="heading-10">Spring的选择：默认使用哪种代理？</h3>
<p>Spring AOP根据以下规则选择代理方式：</p>
<ol>
<li>如果目标对象实现了接口 → 默认使用JDK动态代理</li>
<li>如果目标对象没有实现接口 → 使用CGLIB动态代理</li>
<li>可以通过配置强制使用CGLIB：<code>spring.aop.proxy-target-class=true</code></li>
</ol>
<h2 data-id="heading-11">五、解决方案：如何避免事务失效</h2>
<h3 data-id="heading-12">方案1：自我注入（推荐）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {

    <span class="hljs-comment">//SpringBoot 2.x + 默认开启循环依赖支持，自我注入不会有问题；</span>
    <span class="hljs-comment">//若关闭循环依赖（spring.main.allow-circular-references=false），则此方案失效</span>
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserService</span> self; <span class="hljs-comment">// 注入自己</span>
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        userDao.<span class="hljs-title function_">insert</span>(user);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchCreateUsers</span>(<span class="hljs-params">List&lt;User&gt; users</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">User</span> user : users) {
            self.<span class="hljs-title function_">createUser</span>(user); <span class="hljs-comment">// 通过代理对象调用</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-13">方案2：从ApplicationContext获取代理对象</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationContextAware</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ApplicationContext</span> applicationContext;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setApplicationContext</span>(<span class="hljs-params">ApplicationContext applicationContext</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">applicationContext</span> = applicationContext;
    }
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        userDao.<span class="hljs-title function_">insert</span>(user);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchCreateUsers</span>(<span class="hljs-params">List&lt;User&gt; users</span>) {
        <span class="hljs-title class_">UserService</span> proxy = applicationContext.<span class="hljs-title function_">getBean</span>(<span class="hljs-title class_">UserService</span>.<span class="hljs-property">class</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">User</span> user : users) {
            proxy.<span class="hljs-title function_">createUser</span>(user);
        }
    }
}
</code></pre>
<h3 data-id="heading-14">方案3：使用AopContext获取当前代理对象</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        userDao.<span class="hljs-title function_">insert</span>(user);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchCreateUsers</span>(<span class="hljs-params">List&lt;User&gt; users</span>) {
        <span class="hljs-comment">// 启用暴露代理（以下三种方法）</span>
        <span class="hljs-comment">// 在配置中设置：expose-proxy=true</span>
        <span class="hljs-comment">// 注解方式：@EnableAspectJAutoProxy(exposeProxy = true)</span>
        <span class="hljs-comment">// 配置文件方式（SpringBoot）：spring.aop.expose-proxy=true</span>
        <span class="hljs-title class_">UserService</span> proxy = (<span class="hljs-title class_">UserService</span>) <span class="hljs-title class_">AopContext</span>.<span class="hljs-title function_">currentProxy</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">User</span> user : users) {
            proxy.<span class="hljs-title function_">createUser</span>(user);
        }
    }
}
</code></pre>
<h3 data-id="heading-15">方案4：重构代码结构</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 将事务方法拆分到独立的Service中</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserTransactionService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        userDao.<span class="hljs-title function_">insert</span>(user);
    }
}

<span class="hljs-meta">@Service</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserTransactionService</span> userTransactionService;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchCreateUsers</span>(<span class="hljs-params">List&lt;User&gt; users</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">User</span> user : users) {
            userTransactionService.<span class="hljs-title function_">createUser</span>(user);
        }
    }
}
</code></pre>
<h2 data-id="heading-16">六、面试回答指南</h2>
<p>针对面试官的问题："当两个serviceA和serviceB方法位于同一个Service类中，serviceB定义了切面，然后serviceA调用serviceB，切面会生效吗？"</p>
<p><strong>标准回答：</strong></p>
<p>"不会生效。这是因为Spring AOP是基于代理实现的。当serviceA调用serviceB时，实际上是通过<code>this.serviceB()</code>这种方式直接调用，绕过了代理对象。代理对象只拦截外部调用，对于同一个类内部的相互调用，Spring无法通过代理进行增强。要解决这个问题，可以通过自我注入、从ApplicationContext获取代理对象、或者重构代码结构等方式来确保通过代理对象进行调用。"</p>
<h2 data-id="heading-17">七、总结</h2>
<p>通过本文的分析，我们可以得出以下结论：</p>
<ol>
<li><strong>事务失效的本质</strong>：AOP代理机制导致的内部调用绕过代理对象</li>
<li><strong>Spring AOP的实现</strong>：基于JDK动态代理（接口）和CGLIB动态代理（类继承）</li>
<li><strong>代理对象的作用</strong>：在目标方法执行前后插入增强逻辑（如事务控制）</li>
<li><strong>解决方案</strong>：确保通过代理对象调用有切面的方法</li>
</ol>
<p>理解AOP的代理机制不仅有助于解决事务失效的问题，还能帮助我们更好地设计系统架构，合理使用AOP的各种特性。记住：<strong>在Spring的世界里，有些时候"绕过自己"（通过代理调用）才能更好地完成工作！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 终极指南：Mac M4 编译 Rust 至 Linux (AMD64)]]></title>    <link>https://juejin.cn/post/7578803491821944859</link>    <guid>https://juejin.cn/post/7578803491821944859</guid>    <pubDate>2025-12-02T03:47:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578803491821944859" data-draft-id="7578780780027052041" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 终极指南：Mac M4 编译 Rust 至 Linux (AMD64)"/> <meta itemprop="keywords" content="后端,Rust"/> <meta itemprop="datePublished" content="2025-12-02T03:47:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="干饭比赛第一名获得者"/> <meta itemprop="url" content="https://juejin.cn/user/3368559355902248"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 终极指南：Mac M4 编译 Rust 至 Linux (AMD64)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559355902248/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    干饭比赛第一名获得者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T03:47:40.000Z" title="Tue Dec 02 2025 03:47:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你的 Mac 是 <strong>ARM</strong> 架构，服务器是 <strong>x86/AMD</strong> 架构。</p>
<p>普通编译出来的程序，服务器看不懂。我们需要一个“翻译官”把代码翻译成服务器能懂的格式。</p>
<ul>
<li><strong>Zig</strong>：就是那个强大的底层翻译官（链接器）。</li>
</ul>

<ul>
<li><strong>cargo-zigbuild</strong>：是 Rust 的指挥官，它指挥 Zig 去干活。</li>
</ul>
<hr/>
<h3 data-id="heading-0">第一步：安装必要的工具</h3>
<p>打开终端（Terminal），依次执行以下命令：</p>
<ol>
<li><strong>安装 Zig</strong> (翻译官)</li>
</ol>
<pre><code class="hljs">brew install zig
</code></pre>
<p>Bash</p>
<ol start="2">
<li><strong>安装 cargo-zigbuild</strong> (指挥官)</li>
</ol>
<pre><code class="hljs">cargo install cargo-zigbuild
</code></pre>
<p>Bash</p>
<ol start="3">
<li><strong>添加目标架构支持</strong>告诉 Rust 我们通过能够生成 x86_64 的代码：</li>
</ol>
<pre><code class="hljs language-sql" lang="sql">rustup target <span class="hljs-keyword">add</span> x86_64<span class="hljs-operator">-</span><span class="hljs-literal">unknown</span><span class="hljs-operator">-</span>linux<span class="hljs-operator">-</span>gnu
</code></pre>
<p>Bash</p>
<hr/>
<h3 data-id="heading-1">第二步：修改 Cargo.toml (最关键的一步！)</h3>
<p><strong>问题所在</strong>：Linux 上的 OpenSSL 库和 Mac 上的不一样。如果直接编译，编译器会在 Mac 上找 Linux 版的 OpenSSL 库，找不到就会报错。</p>
<p><strong>解决方案</strong>：有两种方法，<strong>推荐方法 A</strong>。</p>
<h4 data-id="heading-2">方法 A：使用    vendored  模式（推荐，最稳妥）</h4>
<p>让 Rust 编译器自动下载一份 OpenSSL 的源码，并把它<strong>静态编译</strong>进你的程序里。这样你的程序到了服务器上，不需要依赖服务器的 OpenSSL 版本，直接就能跑。</p>
<p>打开项目根目录下的    Cargo.toml ，找到    [dependencies]  区域：</p>
<p><strong>如果你直接依赖了</strong> <strong>openssl</strong>  <strong>：</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 修改前可能是：openssl = "0.10"</span>
<span class="hljs-comment"># 修改后：</span>
<span class="hljs-attr">openssl</span> = { version = <span class="hljs-string">"0.10"</span>, features = [<span class="hljs-string">"vendored"</span>] }
</code></pre>
<p>toml</p>
<p><strong>如果你使用的是</strong> <strong>axum</strong> <strong>配合</strong> <strong>reqwest</strong> <strong>或</strong> <strong>sqlx</strong> <strong>(通常是这种情况)：</strong> 你需要检查  reqwest  或  sqlx  的配置，确保它们启用  native-tls-vendored  或者干脆切换到  rustls 。</p>
<ul>
<li><strong>场景 1 (Axum + Reqwest)：</strong></li>
</ul>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 强制让 reqwest 自带 openssl 源码</span>
<span class="hljs-attr">reqwest</span> = { version = <span class="hljs-string">"0.11"</span>, features = [<span class="hljs-string">"json"</span>, <span class="hljs-string">"native-tls-vendored"</span>] }
</code></pre>
<p>toml</p>
<ul>
<li><strong>场景 2 (Axum + Sqlx)：</strong></li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino">sqlx = { version = <span class="hljs-string">"0.7"</span>, features = [<span class="hljs-string">"runtime-tokio-native-tls"</span>, <span class="hljs-string">"postgres"</span>] } 
# 如果编译报错，尝试改用 <span class="hljs-built_in">rustls</span> (无需 OpenSSL，更简单)：
<span class="hljs-meta"># sqlx = { version = <span class="hljs-string">"0.7"</span>, features = [<span class="hljs-string">"runtime-tokio-rustls"</span>, <span class="hljs-string">"postgres"</span>] }</span>
</code></pre>
<p>toml</p>
<h4 data-id="heading-3">方法 B：完全抛弃 OpenSSL，使用 Rustls</h4>
<p>这是 Rust 社区更推荐的做法。   rustls  是纯 Rust 写的加密库，不需要 C 语言的 OpenSSL，<strong>完全没有交叉编译的烦恼</strong>。</p>
<ul>
<li>在    Cargo.toml  中，把所有涉及    native-tls  的特性改成    rustls 。</li>
</ul>
<hr/>
<h3 data-id="heading-4">第三步：执行编译</h3>
<p>在项目根目录下，执行打包命令：</p>
<pre><code class="hljs language-css" lang="css">cargo zigbuild <span class="hljs-attr">--target</span> x86_64-unknown-linux-gnu <span class="hljs-attr">--release</span>
</code></pre>
<p>Bash</p>
<ul>
<li>   --target x86_64-unknown-linux-gnu ：指定目标是 Linux AMD64。</li>
</ul>

<ul>
<li>   --release ：生成优化后的生产环境版本（文件更小，速度更快）。</li>
</ul>
<hr/>
<h3 data-id="heading-5">第四步：获取结果与验证</h3>
<ol>
<li><strong>找到文件</strong>：</li>
</ol>
<p>编译成功后，可执行文件位于：</p>
<p>   target/x86_64-unknown-linux-gnu/release/你的项目名 </p>
<ol start="2">
<li><strong>验证文件类型</strong>（可选）：</li>
</ol>
<p>在终端输入：</p>
<pre><code class="hljs language-bash" lang="bash">file target/x86_64-unknown-linux-gnu/release/你的项目名
</code></pre>
<p>Bash</p>
<p>你应该看到类似输出：   ELF 64-bit LSB pie executable, x86-64, ... (只要看到 <strong>ELF</strong> 和 <strong>x86-64</strong>，就说明编译成功了)</p>
<hr/>
<h3 data-id="heading-6">第五步：上传到服务器并运行</h3>
<ol>
<li><strong>上传</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">scp target/x86_64-unknown-linux-gnu/release/你的项目名 root@你的服务器IP:/root/
</code></pre>
<p>Bash</p>
<ol start="2">
<li><strong>运行</strong>：</li>
</ol>
<p>登录服务器：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x ./你的项目名  <span class="hljs-comment"># 赋予执行权限</span>
./你的项目名           <span class="hljs-comment"># 运行</span>
</code></pre>
<p>Bash</p>
<hr/>
<h3 data-id="heading-7">⚡️ 查漏补缺总结</h3>
<ol>
<li><strong>OpenSSL 是最大的坑</strong>：仅仅添加    openssl  依赖是不够的，必须开启    features = ["vendored"] ，否则编译时会报 linker error。</li>
</ol>

<ol start="2">
<li><strong>glibc 版本问题</strong>：   cargo-zigbuild  默认会兼容较老的 glibc 版本，这通常没问题。如果你的服务器系统特别老（比如 CentOS 7），可能需要指定 glibc 版本，例如：   --target x86_64-unknown-linux-gnu.2.17 （一般情况不需要这步）。</li>
</ol>

<ol start="3">
<li><strong>Docker 替代方案</strong>：如果上述步骤依然报错（通常是因为还有其他 C 语言依赖库），最简单的备选方案是使用 Docker 在本地模拟 Linux 环境编译，但对于小白来说，   cargo-zigbuild  是配置成本最低的。</li>
</ol>
<p><strong>按照上述“推荐方法 A”修改 Cargo.toml，然后运行命令，99% 的情况都能成功！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[dict.fromkeys()和OrderedDict具体是如何实现去重的？]]></title>    <link>https://juejin.cn/post/7578832575503401002</link>    <guid>https://juejin.cn/post/7578832575503401002</guid>    <pubDate>2025-12-02T03:48:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578832575503401002" data-draft-id="7578760249949585462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="dict.fromkeys()和OrderedDict具体是如何实现去重的？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T03:48:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户34584828505"/> <meta itemprop="url" content="https://juejin.cn/user/3710177917545754"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            dict.fromkeys()和OrderedDict具体是如何实现去重的？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3710177917545754/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户34584828505
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T03:48:41.000Z" title="Tue Dec 02 2025 03:48:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Python 中，<code>dict.fromkeys()</code> 和 <code>OrderedDict.fromkeys()</code> 的去重逻辑<strong>核心依赖 “字典的键（key）必须唯一” 这一特性</strong>，本质是 “用键的唯一性过滤重复元素”，仅在 “是否保留插入顺序” 上有差异（Python 3.7+ 后差异已极小）。以下从「原理拆解、底层实现、去重步骤」三方面详细说明：</p>
<h2 data-id="heading-0">一、核心前提：字典的键（key）特性</h2>
<p>无论是普通 <code>dict</code> 还是 <code>OrderedDict</code>，都遵循两个关键规则：</p>
<ol>
<li>
<p><strong>键的唯一性</strong>：字典中不能存在重复的 key，若重复赋值（如 <code>d = {1: None, 1: None}</code>），后定义的 key 会覆盖前一个（最终仅保留 1 个）；</p>
</li>
<li>
<p><strong>插入顺序保留</strong>（Python 3.7+）：</p>
<ul>
<li>普通 <code>dict</code> 从 Python 3.7 开始，官方保证<strong>保留键的插入顺序</strong>（底层实现优化）；</li>
<li><code>OrderedDict</code> 是 Python 2.7+ 就存在的有序字典，专门设计用于 “严格保留插入顺序”（Python 3.7+ 后与普通 <code>dict</code> 的顺序特性一致，但仍有额外功能如 <code>move_to_end()</code>）。</li>
</ul>
</li>
</ol>
<p>这两个规则是 “去重并保留顺序” 的核心基础。</p>
<h2 data-id="heading-1">二、<code>dict.fromkeys()</code> 的去重原理与实现</h2>
<h3 data-id="heading-2">1. 函数功能与语法</h3>
<p><code>dict.fromkeys(iterable, value=None)</code> 是字典的类方法，作用是：</p>
<ul>
<li>接收一个<strong>可迭代对象</strong>（如列表、元组），将其每个元素作为字典的 <code>key</code>；</li>
<li>所有 key 对应的 <code>value</code> 默认为 <code>None</code>（可通过第二个参数指定统一值）；</li>
<li>返回一个新字典。</li>
</ul>
<p>语法示例：</p>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">lst</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>]
<span class="hljs-attr">d</span> = dict.fromkeys(lst)
print(d)  <span class="hljs-comment"># 输出：{1: None, 2: None, 3: None}（去重且保留插入顺序）</span>
</code></pre>
<h3 data-id="heading-3">2. 去重的底层实现步骤</h3>
<p><code>dict.fromkeys()</code> 本质是 “遍历可迭代对象，逐个往字典中添加 key”，去重逻辑隐含在遍历过程中，具体步骤：</p>
<ol>
<li>
<p><strong>初始化空字典</strong>：创建一个空的哈希表（字典底层数据结构），用于存储 key-value 对；</p>
</li>
<li>
<p><strong>遍历可迭代对象</strong>：按顺序取出 <code>iterable</code> 中的每个元素（如列表 <code>[1,2,2,3]</code> 依次取 1、2、2、3）；</p>
</li>
<li>
<p><strong>判断 key 是否已存在</strong>：</p>
<ul>
<li>对每个元素，计算其哈希值（<code>hash(key)</code>），通过哈希表快速查找是否已存在该 key（查找效率 O (1)）；</li>
<li>若 key 不存在：将其插入字典（保留当前顺序），value 设为默认值 <code>None</code>；</li>
<li>若 key 已存在：<strong>直接跳过，不重复插入</strong>（这就是去重的核心）；</li>
</ul>
</li>
<li>
<p><strong>返回字典</strong>：遍历结束后，字典中的 key 就是 “去重后且保留原插入顺序” 的结果。</p>
</li>
</ol>
<h3 data-id="heading-4">3. 去重示例拆解（对应方式 1 的代码）</h3>
<p>方式 1 中 <code>filtered = [1,4,6,7,7]</code>（筛选后未去重的列表），执行 <code>dict.fromkeys(filtered)</code>：</p>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">filtered</span> = [<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">7</span>]
<span class="hljs-attr">d</span> = dict.fromkeys(filtered)
</code></pre>
<ul>
<li>遍历第 1 个元素 <code>1</code>：哈希表中无 <code>1</code>，插入 → 字典：<code>{1: None}</code>；</li>
<li>遍历第 2 个元素 <code>4</code>：哈希表中无 <code>4</code>，插入 → 字典：<code>{1: None, 4: None}</code>；</li>
<li>遍历第 3 个元素 <code>6</code>：哈希表中无 <code>6</code>，插入 → 字典：<code>{1: None, 4: None, 6: None}</code>；</li>
<li>遍历第 4 个元素 <code>7</code>：哈希表中无 <code>7</code>，插入 → 字典：<code>{1: None, 4: None, 6: None, 7: None}</code>；</li>
<li>遍历第 5 个元素 <code>7</code>：哈希表中已存在 <code>7</code>，跳过 → 字典无变化；</li>
<li>最终字典的 key 为 <code>[1,4,6,7]</code>，转列表后就是去重结果。</li>
</ul>
<h3 data-id="heading-5">4. 关键特点</h3>
<ul>
<li>去重逻辑：依赖 “key 唯一”，重复元素直接跳过，无显式比较（效率高）；</li>
<li>顺序保留：Python 3.7+ 保证插入顺序，与原列表顺序一致；</li>
<li>效率：遍历 + 哈希查找，时间复杂度 O (m)（m 为 <code>filtered</code> 列表长度）。</li>
</ul>
<h2 data-id="heading-6">三、<code>OrderedDict.fromkeys()</code> 的去重原理与实现</h2>
<h3 data-id="heading-7">1. 与普通 <code>dict.fromkeys()</code> 的区别</h3>
<p><code>OrderedDict</code> 是 <code>collections</code> 模块中的有序字典，其 <code>fromkeys()</code> 方法<strong>功能、语法、去重逻辑与普通 <code>dict.fromkeys()</code> 完全一致</strong>，唯一差异是：</p>
<ul>
<li><strong>顺序保证的兼容性</strong>：Python 3.7 之前，普通 <code>dict</code> 不保证插入顺序，而 <code>OrderedDict</code> 从诞生起就严格保留插入顺序；</li>
<li><strong>额外功能</strong>：<code>OrderedDict</code> 提供 <code>move_to_end()</code>、<code>popitem(last=True/False)</code> 等顺序相关方法（去重场景用不到）。</li>
</ul>
<h3 data-id="heading-8">2. 去重实现步骤</h3>
<p>与普通 <code>dict.fromkeys()</code> 完全相同，仅底层存储结构略有差异（<code>OrderedDict</code> 内部用 “双向链表” 记录插入顺序，而 Python 3.7+ 普通 <code>dict</code> 用 “插入顺序数组” 记录），但对用户而言，去重效果一致：</p>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-scss" lang="scss">from collections import OrderedDict

filtered = <span class="hljs-selector-attr">[1,4,6,7,7]</span>
od = OrderedDict<span class="hljs-selector-class">.fromkeys</span>(filtered)
<span class="hljs-built_in">print</span>(od)  # 输出：<span class="hljs-built_in">OrderedDict</span>([(<span class="hljs-number">1</span>, None), (<span class="hljs-number">4</span>, None), (<span class="hljs-number">6</span>, None), (<span class="hljs-number">7</span>, None)])
<span class="hljs-built_in">print</span>(list(od.keys()))  # 输出：<span class="hljs-selector-attr">[1,4,6,7]</span>（去重且保留顺序）
</code></pre>
<h3 data-id="heading-9">3. 适用场景</h3>
<ul>
<li>Python 3.6 及以下版本：需 “去重 + 保留顺序” 时，必须用 <code>OrderedDict.fromkeys()</code>（普通 <code>dict</code> 无序）；</li>
<li>Python 3.7 及以上版本：普通 <code>dict.fromkeys()</code> 已能满足 “去重 + 保留顺序”，无需再用 <code>OrderedDict</code>（除非需要其额外的顺序操作方法）。</li>
</ul>
<h2 data-id="heading-10">四、两者对比与总结</h2>








































<table><thead><tr><th>特性</th><th><code>dict.fromkeys()</code></th><th><code>OrderedDict.fromkeys()</code></th></tr></thead><tbody><tr><td>去重原理</td><td>依赖 key 唯一性，重复 key 跳过</td><td>依赖 key 唯一性，重复 key 跳过</td></tr><tr><td>顺序保留（Python 3.7+）</td><td>是</td><td>是</td></tr><tr><td>顺序保留（Python &lt;3.7）</td><td>否</td><td>是</td></tr><tr><td>底层效率</td><td>略高（结构更简单）</td><td>略低（双向链表额外开销）</td></tr><tr><td>依赖</td><td>无（内置 dict）</td><td>需导入 <code>collections.OrderedDict</code></td></tr><tr><td>适用场景</td><td>Python 3.7+ 日常去重 + 保序</td><td>Python &lt;3.7 或需额外顺序操作的场景</td></tr></tbody></table>
<h2 data-id="heading-11">五、关键补充：为什么不用 <code>set</code> 去重？</h2>
<p>可能有疑问：“既然 <code>set</code> 也能去重，为什么还要用 <code>dict.fromkeys()</code>？”—— 核心差异是「是否保留顺序」：</p>
<ul>
<li><code>set</code> 是无序结构，去重后会打乱原列表顺序（如 <code>list(set([1,4,6,7,7]))</code> 可能输出 <code>[1,6,4,7]</code>）；</li>
<li><code>dict.fromkeys()</code> 和 <code>OrderedDict.fromkeys()</code> 去重后<strong>严格保留原列表的插入顺序</strong>（这是方式 1 的核心需求）。</li>
</ul>
<p>例如：</p>
<p>python</p>
<p>运行</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">filtered</span> = <span class="hljs-selector-attr">[4,1,6,7,7]</span>  # 原顺序是 <span class="hljs-number">4</span>→<span class="hljs-number">1</span>→<span class="hljs-number">6</span>→<span class="hljs-number">7</span>
<span class="hljs-selector-tag">print</span>(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(filtered)))  # 输出：<span class="hljs-selector-attr">[1,4,6,7]</span>（顺序打乱）
<span class="hljs-selector-tag">print</span>(<span class="hljs-built_in">list</span>(dict.<span class="hljs-built_in">fromkeys</span>(filtered).<span class="hljs-built_in">keys</span>()))  # 输出：<span class="hljs-selector-attr">[4,1,6,7]</span>（顺序保留）
</code></pre>
<h2 data-id="heading-12">最终总结</h2>
<p><code>dict.fromkeys()</code> 和 <code>OrderedDict.fromkeys()</code> 的去重逻辑本质是：</p>
<ol>
<li>利用 “字典 key 不可重复” 的特性，遍历元素时跳过已存在的 key；</li>
<li>保留元素的 “首次插入顺序”（Python 3.7+ 普通 dict 也支持）；</li>
<li>去重效率高（O (m)），且能兼顾顺序，是 “去重 + 保序” 的最优方案之一。</li>
</ol>
<p>方式 1 中用 <code>dict.fromkeys()</code>，正是因为它能高效完成 “筛选后列表的去重 + 保序”，且语法简洁、无需额外依赖</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Cloud实战总结：90%开发者踩过的坑，这篇一次性帮你填平！]]></title>    <link>https://juejin.cn/post/7578797337868156962</link>    <guid>https://juejin.cn/post/7578797337868156962</guid>    <pubDate>2025-12-02T05:25:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578797337868156962" data-draft-id="7578777952727433250" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Cloud实战总结：90%开发者踩过的坑，这篇一次性帮你填平！"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-02T05:25:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员西西"/> <meta itemprop="url" content="https://juejin.cn/user/326976944214804"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Cloud实战总结：90%开发者踩过的坑，这篇一次性帮你填平！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/326976944214804/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员西西
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:25:35.000Z" title="Tue Dec 02 2025 05:25:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>你有没有过这样的经历？明明跟着教程搭建 Spring Cloud 项目，却卡在注册中心集群部署；好不容易上线，突然遭遇服务熔断失效导致的雪崩；想优化配置中心，却对着一堆 yaml 文件无从下手？</p>
<p>作为常年跟微服务打交道的开发，我太懂这种痛了！Spring Cloud 作为微服务架构的 “扛把子”，组件多、配置杂、版本兼容问题突出，哪怕是有经验的开发者，也难免在实战中踩坑。最近后台收到好多粉丝私信，说想要一份 “不绕弯、能直接用” 的 Spring Cloud 总结 —— 今天这篇，就专门解决你的痛点！</p>
<h2 data-id="heading-1">为什么 Spring Cloud 成为微服务标配，却让人又爱又恨？</h2>
<p>先跟大家聊聊，为啥咱们开发圈离不开 Spring Cloud？随着业务复杂度提升，单体架构的瓶颈越来越明显：代码臃肿、部署困难、扩容受限，而微服务架构通过 “拆分服务、独立部署、弹性伸缩”，完美解决了这些问题。</p>
<p>而 Spring Cloud 作为 Spring 生态的核心组件，凭借 “开箱即用、组件丰富、与 Spring Boot 无缝集成” 的优势，成为 80% 互联网公司的微服务首选框架。它涵盖了服务注册发现（Eureka/Nacos）、配置中心（Config/Nacos Config）、服务熔断降级（Hystrix/Sentinel）、网关（Gateway）等核心功能，相当于给微服务架构搭好了 “骨架”。</p>
<p>但痛点也很突出：一是组件版本兼容性复杂（比如 Spring Cloud 与 Spring Boot 版本必须匹配，选错就报错）；二是部分组件文档零散，实战细节缺失；三是不同场景下的选型困惑（比如注册中心选 Eureka 还是 Nacos？熔断用 Hystrix 还是 Sentinel？）。这也是为什么很多开发者觉得 Spring Cloud “难用” 的核心原因。</p>
<h2 data-id="heading-2">Spring Cloud 核心组件实战总结，直接抄作业！</h2>
<p>下面我把实战中最常用的 5 个核心组件，从 “选型建议 + 配置要点 + 避坑技巧” 三个维度，给大家做一份超详细总结，都是能直接落地的干货：</p>
<h2 data-id="heading-3">1. 服务注册发现：Nacos（首选）vs Eureka（逐步淘汰）</h2>
<ul>
<li><strong>选型建议</strong>：新项目直接选 Nacos！支持服务注册发现 + 配置中心二合一，集群部署简单，还能兼容 Eureka 客户端，老项目迁移成本低；Eureka 已停止更新，仅建议维护老项目时使用。</li>
<li><strong>核心配置要点</strong>：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Nacos客户端配置（application.yml）</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">discovery:</span>
        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span><span class="hljs-string">:8848</span> <span class="hljs-comment"># Nacos集群地址，用逗号分隔</span>
        <span class="hljs-attr">namespace:</span> <span class="hljs-string">dev</span> <span class="hljs-comment"># 环境隔离，避免不同环境服务互相调用</span>
        <span class="hljs-attr">group:</span> <span class="hljs-string">DEFAULT_GROUP</span> <span class="hljs-comment"># 服务分组，按业务模块划分</span>
</code></pre>
<p><strong>避坑技巧</strong>：集群部署时必须配置 “namespace” 隔离环境，否则测试环境服务可能调用到生产环境；Nacos 默认心跳时间 5 秒，服务异常时最快 15 秒剔除，高可用场景可调整为 2 秒心跳、6 秒剔除。</p>
<h2 data-id="heading-4">2. 配置中心：Nacos Config（替代 Spring Cloud Config）</h2>
<ul>
<li><strong>选型建议</strong>：放弃 Spring Cloud Config+Git 的复杂组合！Nacos Config 支持动态刷新配置、灰度发布、配置加密，操作更简单，还能减少依赖组件。</li>
<li><strong>核心配置要点</strong>：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment">#  bootstrap.yml（优先于application.yml加载）</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">config:</span>
        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.100</span><span class="hljs-string">:8848</span>
        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span> <span class="hljs-comment"># 配置文件格式（yaml/json/properties）</span>
        <span class="hljs-attr">shared-configs:</span> <span class="hljs-comment"># 共享配置（比如数据库连接、日志配置）</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">data-id:</span> <span class="hljs-string">common-config.yaml</span>
            <span class="hljs-attr">group:</span> <span class="hljs-string">DEFAULT_GROUP</span>
            <span class="hljs-attr">refresh:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 支持动态刷新</span>
</code></pre>
<p><strong>避坑技巧</strong>：配置文件必须放在 “bootstrap.yml” 中，否则无法优先加载；动态刷新配置时，需要在类上添加@RefreshScope注解，否则配置更新后不会生效。</p>
<h2 data-id="heading-5">3. 服务熔断降级：Sentinel（替代 Hystrix）</h2>
<ul>
<li><strong>选型建议</strong>：Hystrix 已停止更新，Sentinel 功能更强大（支持流量控制、熔断降级、系统保护），还提供可视化控制台，上手成本低，强烈推荐！</li>
<li><strong>核心配置要点</strong>：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 熔断降级配置（注解方式）</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// 限流配置：QPS阈值10，超出则触发降级</span>
    <span class="hljs-meta">@SentinelResource</span>(value = <span class="hljs-string">"createOrder"</span>, blockHandler = <span class="hljs-string">"blockHandler"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">createOrder</span>(<span class="hljs-params"/>) {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"订单创建成功"</span>;
    }
    <span class="hljs-comment">// 降级处理方法（参数和返回值需与原方法一致）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">blockHandler</span>(<span class="hljs-params">BlockException e</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"当前请求过多，请稍后重试"</span>;
    }
}
</code></pre>
<p><strong>避坑技巧</strong>：Sentinel 控制台默认不持久化规则，生产环境需配置 “规则持久化到 Nacos”，否则重启后规则丢失；熔断降级的 “恢复时间窗口” 建议设置为 5 秒，避免频繁切换影响服务稳定性。</p>
<h2 data-id="heading-6">4. 服务网关：Spring Cloud Gateway（替代 Zuul）</h2>
<ul>
<li><strong>选型建议</strong>：Zuul 基于 Servlet 阻塞 IO，性能较差；Gateway 基于 Netty 非阻塞 IO，支持动态路由、负载均衡、限流熔断，是目前的最优选择。</li>
<li><strong>核心配置要点</strong>：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">gateway:</span>
      <span class="hljs-attr">routes:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">order-service</span> <span class="hljs-comment"># 路由ID，唯一</span>
          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://order-service</span> <span class="hljs-comment"># 目标服务名称（Nacos注册的服务名）</span>
          <span class="hljs-attr">predicates:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/order/**</span> <span class="hljs-comment"># 路由匹配规则</span>
          <span class="hljs-attr">filters:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=1</span> <span class="hljs-comment"># 去掉路径前缀（/order/xxx -&gt; /xxx）</span>
            <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Sentinel</span> <span class="hljs-comment"># 集成Sentinel限流</span>
              <span class="hljs-attr">args:</span>
                <span class="hljs-attr">resource:</span> <span class="hljs-string">order-service</span>
                <span class="hljs-attr">blockHandler:</span> <span class="hljs-string">com.example.gateway.GatewayBlockHandler</span>
</code></pre>
<p><strong>避坑技巧</strong>：Gateway 不支持 Spring MVC 注解（如 @RestController），如果需要自定义过滤器，需实现GlobalFilter接口；路由匹配规则按配置顺序执行，优先级高的路由要放在前面。</p>
<h2 data-id="heading-7">5. 服务调用：OpenFeign（替代 Ribbon）</h2>
<ul>
<li><strong>选型建议</strong>：OpenFeign 是 Ribbon 的增强版，支持声明式调用、请求重试、熔断集成，代码更简洁，无需手动拼接 URL。</li>
<li><strong>核心配置要点</strong>：</li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 声明式调用接口</span>
<span class="hljs-variable">@FeignClient</span>(value = <span class="hljs-string">"user-service"</span>, fallback = UserServiceFallback.class)
public interface UserServiceClient {
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/user/{id}"</span>)
    UserDTO <span class="hljs-built_in">getUserById</span>(<span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">"id"</span>) Long id);
}
<span class="hljs-comment">// 降级 fallback 类</span>
<span class="hljs-variable">@Component</span>
public class UserServiceFallback implements UserServiceClient {
    <span class="hljs-variable">@Override</span>
    public UserDTO <span class="hljs-built_in">getUserById</span>(Long id) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">UserDTO</span>(-<span class="hljs-number">1</span>L, <span class="hljs-string">"默认用户"</span>, <span class="hljs-string">"服务暂时不可用"</span>);
    }
}
</code></pre>
<p><strong>避坑技巧</strong>：OpenFeign 默认超时时间 1 秒，生产环境需调整为 3 秒（ribbon.ReadTimeout=3000）；集成 Sentinel 时，需在application.yml中配置feign.sentinel.enabled=true，否则熔断不生效。</p>
<h2 data-id="heading-8">总结</h2>
<p>以上就是 Spring Cloud 最核心的 5 个组件总结，涵盖了选型、配置、避坑三个关键维度，都是我在多个生产项目中踩坑总结的实战经验。其实 Spring Cloud 不难，关键是找对方法 —— 先明确业务场景，再选择合适的组件，最后掌握核心配置和避坑技巧，就能轻松上手。</p>
<p>如果这篇总结对你有帮助，别忘了<strong>点赞 + 收藏 + 转发</strong>给身边的开发同事！另外，你在使用 Spring Cloud 时还遇到过哪些问题？比如分布式事务、链路追踪等场景的解决方案，或者想了解某组件的进阶用法，欢迎在评论区留言告诉我～ 下期内容，咱们针对性解决！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么 react-grab 可以在 Vue 项目中使用？]]></title>    <link>https://juejin.cn/post/7578830345870327849</link>    <guid>https://juejin.cn/post/7578830345870327849</guid>    <pubDate>2025-12-02T05:35:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578830345870327849" data-draft-id="7578811288819662891" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么 react-grab 可以在 Vue 项目中使用？"/> <meta itemprop="keywords" content="前端,AI编程"/> <meta itemprop="datePublished" content="2025-12-02T05:35:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么 react-grab 可以在 Vue 项目中使用？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:35:46.000Z" title="Tue Dec 02 2025 05:35:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>这是一个"本想抄作业，结果发现可以直接抄卷子"的故事。</p>
</blockquote>
<h2 data-id="heading-0">本想造个 Vue 版的轮子</h2>
<p>前段时间在 React 项目里用了 <code>react-grab</code> 这个库，体验那是相当丝滑：鼠标指哪打哪，元素信息一键复制，调试样式简直是神器。</p>
<p>正好我维护的有个 Vue 的项目，写 CSS 的时候习惯性想用它，结果突然反应过来："坏了，这玩意儿叫 <strong>React</strong> Grab，Vue 项目肯定没戏。"</p>
<p>当时我就想，既然用不了，那我就自己模仿它的原理写一个 <code>vue-grab</code> 呗！反正核心逻辑无非就是监听鼠标、获取 DOM 属性这些，应该不难。</p>
<p>于是我撸起袖子，打开它的源码准备"参考参考"（其实就是准备抄作业）。</p>
<p>结果当我扒开代码一看，整个人都愣住了——<strong>这货跟 React 不能说完全无关，只能说毫不沾边！</strong></p>
<p>本来准备大干一场造个轮子，结果发现轮子就在脚底下，还是通用的。今天就来聊聊这个有意思的现象。</p>
<h2 data-id="heading-1">扒开源码看真相</h2>
<p><code>react-grab</code> 到底干了啥？其实它的逻辑特别简单，总结下来就这一条线：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[监听鼠标] --&gt; B[高亮元素] --&gt; C[解析DOM] --&gt; D[复制信息]
</code></pre>
<p>仔细看看这四个步骤：</p>
<ol start="0">
<li><strong>监听鼠标</strong>：用的是 <code>mousemove</code>、<code>click</code>，这是浏览器的原生事件。</li>
<li><strong>高亮元素</strong>：往页面上插个 <code>div</code> 做遮罩，这是原生 DOM 操作。</li>
<li><strong>解析 DOM</strong>：读一下 <code>node.style</code> 和 <code>attributes</code>，这也是原生 API。</li>
<li><strong>复制信息</strong>：调用的 <code>navigator.clipboard</code>，还是原生 API。</li>
</ol>
<p>发现没？<strong>这一套流程走下来，根本不需要 React 的运行时参与</strong>。它没用 <code>useState</code>，也没用 <code>Virtual DOM</code>，完全就是纯纯的 JavaScript。</p>
<h3 data-id="heading-2">铁证如山</h3>
<p>口说无凭，咱们看证据。</p>
<p><strong>证据一：看依赖</strong></p>
<p>打开它的 <code>package.json</code>，看看 <code>dependencies</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// 只有一些工具库，完全没有 react 或 react-dom！</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"peerDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// 这里也没有强制要求 react</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>证据二：看用法</strong></p>
<p>再看它的入口文件，根本不需要什么 <code>&lt;Provider&gt;</code> 包裹，也不用 <code>useGrab</code> 这种 Hook，直接调用个函数就完事了：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// src/main.ts</span>
<span class="hljs-comment">// 不管你是 Vue、React 还是原生 JS，用法都一样：</span>
​
import { <span class="hljs-keyword">init</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-grab'</span>;
​
<span class="hljs-keyword">init</span>({
  theme: <span class="hljs-string">'dark'</span>,
  color: <span class="hljs-string">'#3b82f6'</span>,
});
</code></pre>
<p>我在 Vue 项目的 <code>main.ts</code> 里试了一下，完美运行。这时候我才意识到：<strong>这哪里是 react-grab，这分明是 any-grab 啊！</strong></p>
<h2 data-id="heading-3">为什么作者要"撒谎"？</h2>
<p>既然跟 React 没强依赖，作者为啥非得叫 <code>react-grab</code>？我猜大概率是这几个原因：</p>
<ol start="0">
<li><strong>作者习惯</strong>：作者平时可能只写 React，最初就是为了在 React 项目里用，顺手就起了这个名。</li>
<li><strong>生态蹭热度</strong>：不得不承认，React 的生态圈太大了。叫 <code>js-grab</code> 可能没人搜，叫 <code>react-grab</code> 一下子曝光率就上来了。</li>
<li><strong>思维定势</strong>：很多前端开发者现在离了框架就不会写代码了，潜意识里觉得 UI 库就该跟框架绑定。</li>
</ol>
<p>其实这种"挂羊头卖狗肉"的库还不少。比如 <code>react-hot-toast</code>，其实它也有非 React 的版本；还有很多以 <code>vue-</code> 开头的懒加载库，核心其实就是个 <code>IntersectionObserver</code>，根本不挑框架。</p>
<h2 data-id="heading-4">怎么练就"火眼金睛"？</h2>
<p>这次经历给我提了个醒：<strong>找轮子的时候，千万别被名字限制了想象力</strong>。</p>
<p>下次再看到这种带框架前缀的库，别急着划走，按这三步走，只需 30 秒就能看穿它的真面目：</p>
<ol start="0">
<li><strong>查户口 (看 <code>package.json</code>)</strong> 用 <code>npm info &lt;包名&gt; peerDependencies</code> 扫一眼。如果 <code>react</code> 或 <code>vue</code> 是 <code>peerDependencies</code> 甚至完全没有，大概率是通用的。</li>
<li><strong>看门脸 (看初始化代码)</strong> 如果文档里让你用 <code>&lt;Provider&gt;</code> 包着，或者必须 <code>app.use()</code>，那是真绑死了。但如果只是 import 一个函数 <code>init()</code> 一下，那它基本就是个原生 JS 库。</li>
<li><strong>看核心 (看它操作什么)</strong> 如果是操作 DOM (像拖拽、高亮、截图)、处理数据 (像日期格式化、请求库)，这些天然就是框架无关的。</li>
</ol>
<h2 data-id="heading-5">顺便介绍下</h2>
<p>刚才提到的那个 Vue 项目，其实是我最近开源的 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">Chat &amp; Edit</a></strong>。</p>
<p>这是一个基于 <strong>Vue 3.5 + TypeScript</strong> 构建的 AI 辅助写作工具，整合了 Chat 对话与 AI 编辑器双重模式。</p>
<p>除了常规的流式 Markdown 渲染，它最大的特点是<strong>工程化实践</strong>：</p>
<ul>
<li>🛠 <strong>调试黑科技</strong>：支持使用 Chrome DevTools MCP 进行调试。</li>
<li>🧪 <strong>测试完备</strong>：集成了 Vitest (单元测试) 和 Playwright (E2E 测试)。</li>
<li>🏗 <strong>现代架构</strong>：采用 Pinia 状态管理，配置了完整的 ESLint + Husky 工作流。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1159e37f8e84967bd2b87ae47e1c5ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765258546&amp;x-signature=koaDWRXraMzFYQiEdgWjTM%2FXj0A%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df306235bf6e4b4197deb468449d9c6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765258546&amp;x-signature=sCfGlC1LxbG%2FzFzxo34%2FO7AX6aM%3D" alt="image.png" loading="lazy"/>
如果你对 <strong>AI 应用架构</strong> 或者 项目内容 感兴趣，欢迎来点个 Star ⭐️，一起交流！</p>
<h2 data-id="heading-6">写在最后</h2>
<p>这件事让我明白了一个道理：<strong>代码不会骗人，但名字会。</strong></p>
<p>很多时候，我们被框架的围墙困住了，觉得 React 的东西 Vue 不能用，Vue 的东西 Angular 不能用。其实跳出来一看，大家底座都是浏览器，都是 DOM，都是 JavaScript。</p>
<p>下次看到好用的工具，哪怕它叫 <code>react-xxx</code>，胆子大一点，扒开源码看看，说不定就能白嫖到你的 Vue 项目里。毕竟，<strong>好工具是不分门户的</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[以为是 MyBatis Plus 链式调用的“优雅”写法，结果反手给我报了个 NPE？]]></title>    <link>https://juejin.cn/post/7578794217962045480</link>    <guid>https://juejin.cn/post/7578794217962045480</guid>    <pubDate>2025-12-02T05:35:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578794217962045480" data-draft-id="7578198815729451008" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="以为是 MyBatis Plus 链式调用的“优雅”写法，结果反手给我报了个 NPE？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T05:35:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="骑着bug的coder"/> <meta itemprop="url" content="https://juejin.cn/user/1922418579089566"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            以为是 MyBatis Plus 链式调用的“优雅”写法，结果反手给我报了个 NPE？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1922418579089566/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    骑着bug的coder
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:35:08.000Z" title="Tue Dec 02 2025 05:35:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 问题背景</h2>
<p>最近在对线索服务进行代码重构。业务场景是一个标准的后台管理查询接口：<code>DCC线索激活列表查询</code>。</p>
<p>这个接口的查询参数比较多，包括：</p>
<ul>
<li>范围查询：<code>defeatTimeStart</code> / <code>defeatTimeEnd</code> (战败时间范围)</li>
</ul>
<p>原来的代码使用了大量的 <code>Optional.ofNullable(...).ifPresent(...)</code> 来判空和组装查询条件。虽然逻辑没问题，但满屏的 <code>Optional</code> 看起来确实显得比较臃肿，不够清爽。</p>
<h2 data-id="heading-1">2. 优化动机</h2>
<p>我想着，MyBatis Plus（MP）原生支持的 <strong>Conditional Query（条件构造器）</strong> 早就很成熟了。利用它的 <code>condition</code> 参数，可以将原本 3-4 行的 <code>if</code> 逻辑压缩成一行链式调用。</p>
<p>于是，我满怀信心地进行了一波“优雅”的代码重构：</p>
<p><strong>目标</strong>：移除冗余的 <code>if</code> 和 <code>Optional</code>，让代码看起来更整洁、更符合现代 Java 风格。</p>
<p><strong>重构前（伪代码）：</strong></p>
<pre><code class="hljs language-java" lang="java">Optional.ofNullable(<span class="hljs-built_in">this</span>.defeatTimeEnd)
                .ifPresent(time -&gt; queryWrapper.lt(SacClueInfoDlr::getLastReviewTime, time.plusDays(<span class="hljs-number">1</span>)));
</code></pre>
<p><strong>重构后（我以为的优雅写法）：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 👇 看着是不是很爽？一行搞定！</span>
queryWrapper.lt(<span class="hljs-built_in">this</span>.defeatTimeEnd != <span class="hljs-literal">null</span>, SacClueInfoDlr::getLastReviewTime, <span class="hljs-built_in">this</span>.defeatTimeEnd.plusDays(<span class="hljs-number">1</span>));
</code></pre>
<p>看着这整齐划一的链式调用，我还在沾沾自喜：这代码重构得，赏心悦目！</p>
<h2 data-id="heading-2">3. 踩坑现场</h2>
<p>代码上手一测，直接一个 <strong>NPE (NullPointerException)</strong>。</p>
<pre><code class="hljs language-csharp" lang="csharp">java.lang.NullPointerException:<span class="hljs-literal">null</span>
</code></pre>
<p>我当时第一反应是懵的：
<strong>“不对啊！我在第一个参数里明明加了 <code>this.defeatTimeEnd != null</code> 的判断啊！MyBatis Plus 不是应该根据这个布尔值来决定是否执行后面的逻辑吗？”</strong></p>
<p>难道 MP 的 <code>condition</code> 机制失效了？</p>
<h2 data-id="heading-3">4. 原理深度复盘：JVM 的求值陷阱</h2>
<p>冷静下来 Debug 了一下，我发现自己错怪了 MyBatis Plus，我发现自己犯了一个<strong>低级但经典的 Java 基础错误：严重混淆了「SQL 的条件构建」和「Java 的参数求值」机制！</strong></p>
<p>让我们重新审视这行代码：</p>
<pre><code class="hljs language-sql" lang="sql">java
.lt(<span class="hljs-keyword">condition</span>, <span class="hljs-keyword">column</span>, <span class="hljs-keyword">value</span>)
</code></pre>
<p>在我的潜意识里，我期望的执行流程是（<strong>惰性求值</strong>）：</p>
<ol>
<li>MP 检查 <code>condition</code> (<code>defeatTimeEnd != null</code>)。</li>
<li>如果 <code>condition</code> 为 <code>false</code>，直接短路，<strong>不计算后面的参数</strong>。</li>
<li>如果 <code>true</code>，才去计算 <code>value</code>。</li>
</ol>
<p><strong>但在 JVM 眼里，真实世界的 Java 是这样执行的（及早求值 / Eager Evaluation）：</strong></p>
<p>在调用 <code>.lt()</code> 方法之前，Java <strong>必须先把所有参数的值计算出来</strong>，然后才能入栈调用方法。</p>
<p>为了讲清楚这个问题，我们写一个最简单的原生 Java 方法来模拟：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 模拟一个简单的条件执行方法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">(<span class="hljs-type">boolean</span> condition, String value)</span> {
    <span class="hljs-comment">// 即使这里有判断，也拦不住外面的 NPE</span>
    <span class="hljs-keyword">if</span> (condition) {
        System.out.println(value);
    }
}

<span class="hljs-comment">// 调用场景：</span>
<span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
<span class="hljs-comment">// ❌ 这里直接崩了！根本进不到 test 方法里！</span>
test(s != <span class="hljs-literal">null</span>, s.toString()); 
</code></pre>
<p>在调用任何方法（包括 MP 的 <code>.lt()</code>）之前，Java <strong>必须先把所有参数的值计算出来</strong>，然后才能入栈调用方法。</p>
<p>对于我的那行报错代码：</p>
<pre><code class="hljs language-java" lang="java">.lt(defeatTimeEnd != <span class="hljs-literal">null</span>, ..., defeatTimeEnd.plusDays(<span class="hljs-number">1</span>))
</code></pre>
<ol>
<li><strong>参数 1 求值</strong>：<code>defeatTimeEnd != null</code> -&gt; 结果 <code>false</code>。</li>
<li><strong>参数 2 求值</strong>：<code>SacClueInfoDlr::getLastReviewTime</code> -&gt; 结果 <code>Function</code> 对象。</li>
<li><strong>参数 3 求值</strong>：<code>defeatTimeEnd.plusDays(1)</code> -&gt; <strong>💥 炸了！</strong></li>
</ol>
<p><strong>真相大白</strong>：
因为 <code>defeatTimeEnd</code> 本身是 <code>null</code>，但在传入参数时，我强行调用了它的 <code>.plusDays()</code> 方法。<strong>不管你的 condition 是 true 还是 false，这个 <code>.plusDays()</code> 方法在 JVM 准备参数阶段就已经被执行了！</strong> 这时候连 MyBatis Plus 的代码大门都还没进去呢。</p>
<h2 data-id="heading-4">5. 最终方案：回归朴实</h2>
<p>既然明白了原理，那些看似优雅的链式调用在涉及到<strong>方法调用（Method Call）<strong>或</strong>复杂计算</strong>时，不仅不优雅，反而是个巨大的隐患。</p>
<p>为了系统的稳健性，我果断回滚了这部分逻辑，回归到了最朴实无华的 <code>if</code> 判断：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 只有当对象非空时，才进入代码块执行方法调用</span>
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.defeatTimeEnd != <span class="hljs-literal">null</span>) {
    queryWrapper.lt(SacClueInfoDlr::getLastReviewTime, <span class="hljs-built_in">this</span>.defeatTimeEnd.plusDays(<span class="hljs-number">1</span>));
}

<span class="hljs-keyword">if</span> (StringUtils.isNotBlank(<span class="hljs-built_in">this</span>.dlrCodeIn)) {
    queryWrapper.in(SacClueInfoDlr::getDlrCode, Arrays.asList(<span class="hljs-built_in">this</span>.dlrCodeIn.split(<span class="hljs-string">","</span>)));
}
</code></pre>
<h2 data-id="heading-5">6. 避坑指南 (Takeaway)</h2>
<p>兄弟们，下次在使用 MyBatis Plus 的链式调用（Conditional Query）时，一定要谨记这个原则：</p>
<ol>
<li><strong>纯变量/引用传递</strong>：放心用链式，代码简洁。
<ul>
<li>✅ <code>.eq(name != null, User::getName, name)</code></li>
</ul>
</li>
<li><strong>涉及方法调用/计算</strong>：<strong>必须用 <code>if</code> 块！</strong>
<ul>
<li>❌ <code>.eq(obj != null, User::getVal, obj.getValue())</code> —— <strong>NPE 预警！</strong></li>
<li>❌ <code>.in(str != null, User::getIds, str.split(","))</code> —— <strong>逻辑错误/NPE 预警！</strong></li>
</ul>
</li>
</ol>
<p><strong>总结：别为了省那两行 <code>if</code>，让 JVM 教你做人。代码的“优雅”永远建立在“正确”和“安全”之上。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[理解 CSS backface-visibility：卡片翻转效果背后的属性]]></title>    <link>https://juejin.cn/post/7578780780027559945</link>    <guid>https://juejin.cn/post/7578780780027559945</guid>    <pubDate>2025-12-02T05:16:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578780780027559945" data-draft-id="7578780780027543561" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="理解 CSS backface-visibility：卡片翻转效果背后的属性"/> <meta itemprop="keywords" content="前端,CSS"/> <meta itemprop="datePublished" content="2025-12-02T05:16:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="parade岁月"/> <meta itemprop="url" content="https://juejin.cn/user/3773179639113831"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            理解 CSS backface-visibility：卡片翻转效果背后的属性
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3773179639113831/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    parade岁月
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:16:55.000Z" title="Tue Dec 02 2025 05:16:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前段时间在做一个产品展示页，需要实现卡片翻转效果。本以为很简单，结果翻转的时候总是"穿帮"——正面和背面同时显示，或者背面的文字是镜像的。折腾了半天才发现，原来是 <code>backface-visibility</code> 这个属性没搞明白。</p>
<p>今天就来聊聊这个 CSS 属性。</p>
<blockquote>
<p>🎮 <strong>在线演示</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Ffrontend-learning.pages.dev%2Fanimation%2Fdemos%2Fbackface-visibility" target="_blank" title="https://frontend-learning.pages.dev/animation/demos/backface-visibility" ref="nofollow noopener noreferrer">frontend-learning.pages.dev/animation/d…</a></p>
<p>建议边看文章边打开演示页面，所有效果都可以直接交互体验。</p>
</blockquote>
<h2 data-id="heading-0">先说结论</h2>
<p><code>backface-visibility</code> 控制的是：<strong>当一个元素的背面朝向你时，这个背面是否可见</strong>。</p>
<p>听起来有点绕？没关系，我们慢慢来。</p>
<h2 data-id="heading-1">理解"背面"这个概念</h2>
<p>这是理解整个属性的关键。很多人（包括我）一开始都没搞清楚这个"背面"到底是什么。</p>
<p><strong>关键理解</strong>：每个 HTML 元素就像一张纸，天生就有正面和背面。当你用 <code>rotateY(180deg)</code> 翻转它时，你看到的是它的<strong>背面</strong>（就像纸翻过来，文字是镜像的）。</p>
<p>来看个最简单的例子：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">style</span>=<span class="hljs-string">"
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  padding: 40px;
  transform: rotateY(180deg);
"</span>
&gt;</span>
  HELLO
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>你会看到什么？<strong>镜像的 HELLO</strong>。这就是元素的背面。</p>
<p><code>backface-visibility: hidden</code> 的作用就是：<strong>当背面朝向你时，让它变透明</strong>。</p>
<h2 data-id="heading-2">四个场景，逐步理解</h2>
<p>我做了四个对比演示，帮你理解这个属性是怎么工作的。</p>
<h3 data-id="heading-3">场景 1：正常叠加</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"position: relative;"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"front"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"position: absolute;"</span>&gt;</span>FRONT<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"back"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"position: absolute;"</span>&gt;</span>BACK<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>结果</strong>：只看到 BACK
<strong>原因</strong>：两个都是 <code>absolute</code>，BACK 在上层覆盖了 FRONT</p>
<p>这个很好理解，就是普通的 DOM 层叠。</p>
<h3 data-id="heading-4">场景 2：BACK 翻转 180°</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.back</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);
}
</code></pre>
<p><strong>结果</strong>：看到镜像的 BACK
<strong>原因</strong>：BACK 翻转后，你看到的是它的<strong>背面</strong>（文字镜像）</p>
<p>这里就出现问题了！虽然 BACK 翻转了，但你看到的是它的背面，文字是反的。</p>
<h3 data-id="heading-5">场景 3：隐藏 BACK 的背面</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.back</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);
  <span class="hljs-attribute">backface-visibility</span>: hidden; <span class="hljs-comment">/* 关键！*/</span>
}
</code></pre>
<p><strong>结果</strong>：✅ 只看到 FRONT
<strong>原因</strong>：BACK 的背面被隐藏，露出下面的 FRONT</p>
<p>现在好了！BACK 的背面不可见了，所以你能看到下面的 FRONT。</p>
<h3 data-id="heading-6">场景 4：完美翻转</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.front</span>,
<span class="hljs-selector-class">.back</span> {
  <span class="hljs-attribute">backface-visibility</span>: hidden; <span class="hljs-comment">/* 两面都隐藏背面 */</span>
}
<span class="hljs-selector-class">.back</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);
}

<span class="hljs-comment">/* 悬停时翻转父容器 */</span>
<span class="hljs-selector-class">.card-container</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);
}
</code></pre>
<p><strong>结果</strong>：✅ 悬停完美翻转
<strong>原理</strong>：</p>
<ul>
<li>初始状态：FRONT 正面朝向你（显示），BACK 背面朝向你（隐藏）</li>
<li>翻转后：FRONT 背面朝向你（隐藏），BACK 正面朝向你（显示）</li>
</ul>
<p>这就是完美的卡片翻转效果！</p>
<h2 data-id="heading-7">语法很简单</h2>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.element</span> {
  <span class="hljs-attribute">backface-visibility</span>: visible | hidden;
}
</code></pre>
<ul>
<li><code>visible</code>：默认值，背面可见</li>
<li><code>hidden</code>：背面不可见</li>
</ul>
<p>就这两个值，没别的了。</p>
<h2 data-id="heading-8">一个常见误区：为什么不能分别旋转子元素？</h2>
<p>这是我当时最困惑的地方。既然翻转后正面和背面都旋转了 180°，为什么不能直接这样写？</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ❌ 错误写法 */</span>
<span class="hljs-selector-class">.card-container</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.front</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);
}
<span class="hljs-selector-class">.card-container</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.back</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);
}
</code></pre>
<p>看起来很合理对吧？但实际上<strong>完全不行</strong>。</p>
<h3 data-id="heading-9">问题在哪？</h3>
<p>关键在于：<strong>CSS 的 <code>transform</code> 属性会被完全覆盖，而不是累加</strong>。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 初始状态 */</span>
<span class="hljs-selector-class">.front</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">0deg</span>);
}
<span class="hljs-selector-class">.back</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);
}

<span class="hljs-comment">/* 悬停后 */</span>
<span class="hljs-selector-class">.card-container</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.front</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>); <span class="hljs-comment">/* ✓ 从 0° 变成 180° */</span>
}
<span class="hljs-selector-class">.card-container</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.back</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>); <span class="hljs-comment">/* ✗ 从 180° 变成 180°，没变化！ */</span>
}
</code></pre>
<p>背面的初始值 <code>rotateY(180deg)</code> 被新值 <code>rotateY(180deg)</code> 覆盖，但因为值相同，所以背面根本没动！</p>
<h3 data-id="heading-10">正确做法：旋转父容器</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ✅ 正确写法 */</span>
<span class="hljs-selector-class">.card-container</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>); <span class="hljs-comment">/* 旋转整个父容器 */</span>
}
</code></pre>
<p>这样做的原理是：<strong>子元素的 transform 是相对于父元素的坐标系</strong>。</p>
<pre><code class="hljs language-scss" lang="scss">初始状态：
<span class="hljs-selector-class">.card</span> (<span class="hljs-number">0</span>°)
  ├── <span class="hljs-selector-class">.front</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">0</span>°) 相对于 .card   → 绝对位置 <span class="hljs-number">0</span>°
  └── .back:  <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180</span>°) 相对于 .card → 绝对位置 <span class="hljs-number">180</span>°

悬停后：
.card (<span class="hljs-number">180</span>°)  ← 整个坐标系旋转了
  ├── .front: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">0</span>°) 相对于 .card   → 绝对位置 <span class="hljs-number">0</span>° + <span class="hljs-number">180</span>° = <span class="hljs-number">180</span>°
  └── .back:  <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180</span>°) 相对于 .card → 绝对位置 <span class="hljs-number">180</span>° + <span class="hljs-number">180</span>° = <span class="hljs-number">360</span>° = <span class="hljs-number">0</span>°
</code></pre>
<p>父元素旋转时，子元素的相对角度不变，但绝对角度会改变。这才是正确的翻转逻辑。</p>
<h2 data-id="heading-11">为什么需要三层结构？</h2>
<p>标准的卡片翻转需要三层 DOM 结构：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"爷容器"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- perspective（观察点） --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"父容器"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- transform-style + rotateY（翻转者） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"正面"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- backface-visibility（被翻转的面） --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"背面"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- backface-visibility（被翻转的面） --&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-12">每一层的职责</h3>
<p><strong>爷容器</strong>：设置 <code>perspective</code></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card-container</span> {
  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000px</span>; <span class="hljs-comment">/* 必须在父元素上 */</span>
}
</code></pre>
<ul>
<li>定义观察者的位置，创建 3D 空间</li>
<li>类比：你站在舞台前看表演，这个属性决定你站在哪里看</li>
<li><strong>为什么在外层</strong>？<code>perspective</code> 必须设置在父元素上，才能对子元素的 3D 变换生效</li>
</ul>
<p><strong>父容器</strong>：设置 <code>transform-style</code> 和执行 <code>rotateY</code></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d; <span class="hljs-comment">/* 保持 3D 空间 */</span>
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.6s</span>;
}

<span class="hljs-selector-class">.card-container</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>); <span class="hljs-comment">/* 翻转整个卡片 */</span>
}
</code></pre>
<ul>
<li><code>preserve-3d</code>：让子元素保持在 3D 空间中（而不是被压平）</li>
<li>类比：这是舞台上的转盘，带着上面的演员一起旋转</li>
</ul>
<p><strong>子元素</strong>：正面和背面</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.card-front</span>,
<span class="hljs-selector-class">.card-back</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">backface-visibility</span>: hidden; <span class="hljs-comment">/* 关键！隐藏背面 */</span>
}

<span class="hljs-selector-class">.card-back</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>); <span class="hljs-comment">/* 背面预先翻转 */</span>
}
</code></pre>
<ul>
<li><code>position: absolute</code>：让两个面重叠在同一位置</li>
<li>背面预先翻转 180°：这样当父容器翻转 180° 时，背面刚好正面朝向你</li>
</ul>
<h3 data-id="heading-13">为什么不能少一层？</h3>
<p>如果只有两层：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ❌ 错误 */</span>
<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000px</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>);
}
</code></pre>
<p><strong>问题</strong>：<code>perspective</code> 和 <code>transform</code> 在同一个元素上，<code>perspective</code> 不会对自己的 <code>transform</code> 生效，只会对子元素生效。结果就是没有透视效果。</p>
<h2 data-id="heading-14">完整的卡片翻转模板</h2>
<p>直接复制这个模板，改改样式就能用：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- HTML 结构 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-container"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 爷容器：观察点 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 父容器：翻转者 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-front"</span>&gt;</span>正面内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-back"</span>&gt;</span>背面内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 第 1 层：爷容器 - 设置观察点 */</span>
<span class="hljs-selector-class">.card-container</span> {
  <span class="hljs-attribute">perspective</span>: <span class="hljs-number">1000px</span>; <span class="hljs-comment">/* 必须在父元素上 */</span>
}

<span class="hljs-comment">/* 第 2 层：父容器 - 执行翻转 */</span>
<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">transform-style</span>: preserve-<span class="hljs-number">3</span>d; <span class="hljs-comment">/* 保持 3D 空间 */</span>
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.6s</span>;
}

<span class="hljs-selector-class">.card-container</span><span class="hljs-selector-pseudo">:hover</span> <span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>); <span class="hljs-comment">/* 翻转整个卡片 */</span>
}

<span class="hljs-comment">/* 第 3 层：子元素 - 正面和背面 */</span>
<span class="hljs-selector-class">.card-front</span>,
<span class="hljs-selector-class">.card-back</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">backface-visibility</span>: hidden; <span class="hljs-comment">/* 关键！隐藏背面 */</span>
}

<span class="hljs-selector-class">.card-back</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotateY</span>(<span class="hljs-number">180deg</span>); <span class="hljs-comment">/* 背面预先翻转 */</span>
}
</code></pre>
<p>这个模板是标准写法，三层结构缺一不可。</p>
<h2 data-id="heading-15">几个注意事项</h2>
<ol>
<li><strong>必须配合 3D 变换</strong>：<code>backface-visibility</code> 只在 3D 变换（如 <code>rotateY</code>, <code>rotateX</code>）中有意义，2D 旋转（<code>rotate</code>）不会产生背面</li>
<li><strong>性能优化</strong>：设置为 <code>hidden</code> 可以让浏览器跳过背面的渲染，提升性能</li>
<li><strong>浏览器兼容</strong>：现代浏览器都支持，旧版本可能需要 <code>-webkit-</code> 前缀</li>
</ol>
<h2 data-id="heading-16">总结</h2>
<p><code>backface-visibility</code> 这个属性本身很简单，就两个值。但要真正理解它，需要搞清楚几个概念：</p>
<ol>
<li>每个元素天生就有正面和背面</li>
<li><code>backface-visibility: hidden</code> 让背面朝向你时变透明</li>
<li>卡片翻转必须在父元素上执行旋转</li>
<li>标准的三层结构不能省略</li>
</ol>
<p>最后再推荐一次我做的演示页面，里面有所有场景的交互演示和详细说明：</p>
<p>👉 <a href="https://link.juejin.cn?target=https%3A%2F%2Ffrontend-learning.pages.dev%2Fanimation%2Fdemos%2Fbackface-visibility" target="_blank" title="https://frontend-learning.pages.dev/animation/demos/backface-visibility" ref="nofollow noopener noreferrer">frontend-learning.pages.dev/animation/d…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MoonBit语法基础概述]]></title>    <link>https://juejin.cn/post/7578797337868009506</link>    <guid>https://juejin.cn/post/7578797337868009506</guid>    <pubDate>2025-12-02T05:01:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578797337868009506" data-draft-id="7578797337867993122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MoonBit语法基础概述"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2025-12-02T05:01:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端之虎陈随易"/> <meta itemprop="url" content="https://juejin.cn/user/1239904846873326"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MoonBit语法基础概述
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904846873326/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端之虎陈随易
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:01:37.000Z" title="Tue Dec 02 2025 05:01:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">改变世界的编程语言 MoonBit</h2>
<blockquote>
<p>大家好，我是农村程序员，独立开发者，前端之虎陈随易，我的个人网站是 <code>https://chensuiyi.me</code></p>
</blockquote>
<blockquote>
<p>这是我的 <code>《改变世界的编程语言MoonBit》</code> 系列文章，将自己学习和理解 MoonBit 的过程分享给大家，希望能带来参考和帮助。</p>
</blockquote>
<blockquote>
<p>全部文章可以前往 MoonBit 开发网 <code>https://moonbit.edgeone.app</code> 或 <code>https://moonbit.pages.dev</code> 查看，我坚信，MoonBit 将会改变世界。</p>
</blockquote>

<h3 data-id="heading-1">往期文章</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FFPDr9JzFoGp806pzSDRe-g" target="_blank" title="https://mp.weixin.qq.com/s/FPDr9JzFoGp806pzSDRe-g" ref="nofollow noopener noreferrer">改变世界的编程语言 MoonBit：背景知识速览</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FTr7-XOI20OMU5YZ0v7e-Mg" target="_blank" title="https://mp.weixin.qq.com/s/Tr7-XOI20OMU5YZ0v7e-Mg" ref="nofollow noopener noreferrer">改变世界的编程语言 MoonBit：项目文件详解</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FDZBJMFutT8um9FX2SxBNHg" target="_blank" title="https://mp.weixin.qq.com/s/DZBJMFutT8um9FX2SxBNHg" ref="nofollow noopener noreferrer">改变世界的编程语言 MoonBit：配置系统介绍(上)</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FA9RLmkumNjNWOVH8SO34cw" target="_blank" title="https://mp.weixin.qq.com/s/A9RLmkumNjNWOVH8SO34cw" ref="nofollow noopener noreferrer">改变世界的编程语言 MoonBit：配置系统介绍(下)</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FubphoWliaegeU5E1TBgbsw" target="_blank" title="https://mp.weixin.qq.com/s/ubphoWliaegeU5E1TBgbsw" ref="nofollow noopener noreferrer">改变世界的编程语言 MoonBit：如何用于前端开发</a></li>
</ul>

<p>前面几篇文章，我们系统地学习了 MoonBit 的背景知识、项目结构、配置系统以及如何在前端开发中使用。今天，我们终于要进入 MoonBit 语言本身的语法学习了！</p>
<p>本文将带你全面了解 MoonBit 的基础语法，包括程序结构、变量绑定、数据类型、函数定义、控制流等核心概念。让我们一起开始这段精彩的语法之旅吧！</p>

<h3 data-id="heading-2">程序的基本组成</h3>
<p>一个 MoonBit 程序由以下顶层定义组成：</p>
<ul>
<li><strong>类型定义</strong>：定义结构体、枚举等数据类型</li>
<li><strong>函数定义</strong>：定义可复用的代码块</li>
<li><strong>常量定义和变量绑定</strong>：定义不变的常量和可变的变量</li>
<li><strong><code>init</code> 函数</strong>：初始化函数</li>
<li><strong><code>main</code> 函数</strong>：程序主入口</li>
<li><strong><code>test</code> 块</strong>：内联测试</li>
</ul>
<p><strong>类比理解</strong>：</p>
<p>如果把 MoonBit 程序比作一本书，那么：</p>
<ul>
<li>类型定义就像是书中的角色设定</li>
<li>函数定义就像是各个章节</li>
<li><code>main</code> 函数就是故事的开头</li>
<li><code>test</code> 块就是每章后面的习题</li>
</ul>

<h3 data-id="heading-3">表达式和语句</h3>
<p>MoonBit 区分<strong>语句</strong>和<strong>表达式</strong>，这是理解 MoonBit 的关键。</p>
<p><strong>表达式</strong>：会产生一个值，包括：</p>
<ul>
<li>值字面量（布尔值、数字、字符、字符串、数组、元组、结构体）</li>
<li>算术、逻辑或比较操作</li>
<li>访问数组元素（如 <code>a[0]</code>）、结构体字段（如 <code>r.x</code>）、元组组件（如 <code>t.0</code>）</li>
<li>变量和枚举构造器</li>
<li>匿名函数定义</li>
<li><code>match</code>、<code>if</code>、<code>loop</code> 表达式等</li>
</ul>
<p><strong>语句</strong>：执行某些操作但不产生值，包括：</p>
<ul>
<li>命名本地函数定义</li>
<li>本地变量绑定</li>
<li>赋值</li>
<li><code>return</code> 语句</li>
<li>任何返回类型为 <code>Unit</code> 的表达式</li>
</ul>
<p><strong>重要规则</strong>：在函数体中，只有最后一个子句应该是一个表达式，它作为返回值。</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn foo() -&gt; Int {
  let x = 1  // 语句：变量绑定
  x + 1      // 表达式：作为返回值
}
</code></pre>
<p><strong>通俗理解</strong>：</p>
<p>语句就像做事情，比如"把苹果放桌上"；表达式就像回答问题，比如"桌上有几个苹果？答：3 个"。</p>

<h3 data-id="heading-4">变量绑定</h3>
<p>MoonBit 支持三种变量绑定方式：</p>
<h4 data-id="heading-5">不可变变量（let）</h4>
<p>使用 <code>let</code> 声明的变量不能被重新赋值：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main {
  let x = 10
  // x = 20  // ❌ 错误！不可变变量不能重新赋值
  println(x)
}
</code></pre>
<h4 data-id="heading-6">可变变量（let mut）</h4>
<p>使用 <code>let mut</code> 声明的变量可以被重新赋值：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main {
  let mut i = 10
  i = 20  // ✅ 正确！可变变量可以重新赋值
  println(i)
}
</code></pre>
<h4 data-id="heading-7">常量（const）</h4>
<p>使用 <code>const</code> 声明的常量只能在顶层定义，不能在函数内部定义：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">const ZERO = 0  // ✅ 顶层常量

fn main {
  // const LOCAL = 1  // ❌ 错误！常量不能在函数内定义
  println(ZERO)
}
</code></pre>
<p><strong>注意事项</strong>：</p>
<ul>
<li>顶层变量绑定需要显式类型注释（除非使用字符串、字节或数字等字面量定义）</li>
<li>顶层变量不能是可变的（如需可变，使用 <code>Ref</code> 代替）</li>
</ul>

<h3 data-id="heading-8">命名约定</h3>
<p>MoonBit 有一套清晰的命名规范：</p>




















<table><thead><tr><th>类型</th><th>规则</th><th>示例</th></tr></thead><tbody><tr><td>变量、函数</td><td>小写字母开头，建议 snake_case</td><td><code>my_var</code>、<code>calculate_sum</code></td></tr><tr><td>常量、类型</td><td>大写字母开头，建议 PascalCase 或 SCREAMING_SNAKE_CASE</td><td><code>MyType</code>、<code>MAX_SIZE</code></td></tr></tbody></table>
<h4 data-id="heading-9">关键字（不能使用）</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">as</span>, <span class="hljs-keyword">else</span>, <span class="hljs-keyword">extern</span>, <span class="hljs-keyword">fn</span>, fnalias, <span class="hljs-keyword">if</span>, <span class="hljs-keyword">let</span>, <span class="hljs-keyword">const</span>, <span class="hljs-keyword">match</span>, using,
<span class="hljs-keyword">mut</span>, <span class="hljs-keyword">type</span>, typealias, <span class="hljs-keyword">struct</span>, <span class="hljs-keyword">enum</span>, <span class="hljs-keyword">trait</span>, traitalias, derive,
<span class="hljs-keyword">while</span>, <span class="hljs-keyword">break</span>, <span class="hljs-keyword">continue</span>, import, <span class="hljs-keyword">return</span>, throw, raise, <span class="hljs-keyword">try</span>, catch,
<span class="hljs-keyword">pub</span>, <span class="hljs-keyword">priv</span>, readonly, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, _, test, <span class="hljs-keyword">loop</span>, <span class="hljs-keyword">for</span>, <span class="hljs-keyword">in</span>, <span class="hljs-keyword">impl</span>,
with, guard, <span class="hljs-keyword">async</span>, is, suberror, and, letrec, enumview, noraise, defer
</code></pre>
<h4 data-id="heading-10">保留关键字（会引发警告）</h4>
<pre><code class="hljs language-rust" lang="rust">module, <span class="hljs-keyword">move</span>, <span class="hljs-keyword">ref</span>, <span class="hljs-keyword">static</span>, <span class="hljs-keyword">super</span>, <span class="hljs-keyword">unsafe</span>, <span class="hljs-keyword">use</span>, <span class="hljs-keyword">where</span>, <span class="hljs-keyword">await</span>,
<span class="hljs-keyword">dyn</span>, <span class="hljs-keyword">abstract</span>, <span class="hljs-keyword">do</span>, <span class="hljs-keyword">final</span>, <span class="hljs-keyword">macro</span>, <span class="hljs-keyword">override</span>, <span class="hljs-keyword">typeof</span>, <span class="hljs-keyword">virtual</span>, <span class="hljs-keyword">yield</span>...
</code></pre>
<p><strong>通俗理解</strong>：</p>
<p>命名规范就像给孩子取名字，有些名字（关键字）是被语言"占用"的，你不能用；有些名字虽然目前可以用，但可能将来会被占用（保留关键字）。</p>

<h3 data-id="heading-11">程序入口</h3>
<h4 data-id="heading-12">init 函数</h4>
<p><code>init</code> 函数是特殊的初始化函数：</p>
<ul>
<li>没有参数列表也没有返回类型</li>
<li>同一个包中可以有多个 <code>init</code> 函数</li>
<li>不能被显式调用或被其他函数引用</li>
<li>在初始化包时会隐式自动调用</li>
</ul>
<pre><code class="hljs language-moonbit" lang="moonbit">fn init {
  let x = 1
  println(x)
}
</code></pre>
<h4 data-id="heading-13">main 函数</h4>
<p><code>main</code> 函数是程序的主入口，在初始化阶段之后执行：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main {
  let x = 2
  println(x)
}
</code></pre>
<p>运行以上两段代码，输出：</p>
<pre><code class="hljs">1
2
</code></pre>
<p><strong>注意</strong>：只有标记为 <code>is-main: true</code> 的包才能定义 <code>main</code> 函数。</p>
<h4 data-id="heading-14">test 块</h4>
<p><code>test</code> 块用于定义内联测试：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">test "test_name" {
  assert_eq(1 + 1, 2)
  assert_eq(2 + 2, 4)
  inspect([1, 2, 3], content="[1, 2, 3]")
}
</code></pre>
<p><strong>通俗理解</strong>：</p>
<ul>
<li><code>init</code> 就像开餐厅前的准备工作（备菜、摆桌子）</li>
<li><code>main</code> 就像正式开门营业</li>
<li><code>test</code> 就像品控检查，确保菜品质量</li>
</ul>

<h3 data-id="heading-15">内置数据类型</h3>
<p>MoonBit 提供了丰富的内置数据类型：</p>
<h4 data-id="heading-16">Unit 类型</h4>
<p><code>Unit</code> 表示没有有意义的值，类似于 C/C++ 的 <code>void</code>，但它是一个真正的类型：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn print_hello() -&gt; Unit {
  println("Hello, world!")
}
</code></pre>
<h4 data-id="heading-17">布尔值</h4>
<p>布尔类型有两个值：<code>true</code> 和 <code>false</code>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let a = true
let b = false
let c = a &amp;&amp; b    // 逻辑与
let d = a || b    // 逻辑或
let e = not(a)    // 逻辑非
</code></pre>
<h4 data-id="heading-18">数字类型</h4>
<p>MoonBit 支持多种数字类型：</p>























































<table><thead><tr><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>Int16</code></td><td>16 位有符号整数</td><td><code>(42 : Int16)</code></td></tr><tr><td><code>Int</code></td><td>32 位有符号整数</td><td><code>42</code></td></tr><tr><td><code>Int64</code></td><td>64 位有符号整数</td><td><code>1000L</code></td></tr><tr><td><code>UInt16</code></td><td>16 位无符号整数</td><td><code>(14 : UInt16)</code></td></tr><tr><td><code>UInt</code></td><td>32 位无符号整数</td><td><code>14U</code></td></tr><tr><td><code>UInt64</code></td><td>64 位无符号整数</td><td><code>14UL</code></td></tr><tr><td><code>Double</code></td><td>64 位浮点数</td><td><code>3.14</code></td></tr><tr><td><code>Float</code></td><td>32 位浮点数</td><td><code>(3.14 : Float)</code></td></tr><tr><td><code>BigInt</code></td><td>大整数</td><td><code>10000000000000000000000N</code></td></tr></tbody></table>
<p><strong>数字字面量支持多种进制</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let decimal = 1_000_000      // 十进制，支持下划线分隔
let binary = 0b110010        // 二进制
let octal = 0o1234           // 八进制
let hex = 0xA_B_C            // 十六进制
</code></pre>
<p><strong>类型自动重载</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let int : Int = 42
let double : Double = 42     // 自动转换为 42.0
let bigint : BigInt = 42     // 自动转换为大整数
</code></pre>

<h4 data-id="heading-19">字符串</h4>
<p>字符串包含一系列 UTF-16 码点：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let a = "兔rabbit"
println(a[0].to_char())  // Some('兔')
println(a[1].to_char())  // Some('r')
</code></pre>
<p><strong>多行字符串</strong>：</p>
<p>使用 <code>#|</code> 前缀保留原始字符串，使用 <code>$|</code> 前缀支持转义和插值：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let lang = "MoonBit"
let b =
  #| Hello
  #| ---
  $| \{lang}\n
  #| ---
</code></pre>
<p><strong>字符串插值</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let x = 42
println("The answer is \{x}")  // The answer is 42
</code></pre>
<p><strong>转义序列</strong>：</p>





































<table><thead><tr><th>转义序列</th><th>含义</th></tr></thead><tbody><tr><td><code>\n</code></td><td>换行</td></tr><tr><td><code>\r</code></td><td>回车</td></tr><tr><td><code>\t</code></td><td>制表符</td></tr><tr><td><code>\b</code></td><td>退格</td></tr><tr><td><code>\\</code></td><td>反斜杠</td></tr><tr><td><code>\u5154</code></td><td>Unicode 转义（4 位）</td></tr><tr><td><code>\u{1F600}</code></td><td>Unicode 转义（可变长）</td></tr></tbody></table>
<h4 data-id="heading-20">字符</h4>
<p><code>Char</code> 表示一个 Unicode 码点：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let a : Char = 'A'
let b = '兔'
let zero = '\u0030'  // '0'
let emoji = '\u{1F600}'  // 😀
</code></pre>
<p>当期望类型是 <code>Int</code> 时，字符字面量可以重载为 <code>Int</code> 类型：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let s : String = "hello"
let diff = s[0] - 'a'  // 字符 'a' 被重载为 Int
</code></pre>
<h4 data-id="heading-21">字节</h4>
<p>字节字面量是一个 ASCII 字符或转义序列：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let b1 : Byte = b'a'
let b2 = b'\xff'

// 字节序列
let bs : Bytes = b"abcd"
</code></pre>

<h4 data-id="heading-22">元组</h4>
<p>元组是使用圆括号构造的有限值集合：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn pack(a : Bool, b : Int, c : String) -&gt; (Bool, Int, String) {
  (a, b, c)
}

fn main {
  let quad = pack(false, 100, "text")
  let (bool_val, int_val, str) = quad  // 解构
  println("\{bool_val} \{int_val} \{str}")

  // 也可以通过索引访问
  let x = quad.0  // false
  let y = quad.1  // 100
}
</code></pre>
<h4 data-id="heading-23">数组</h4>
<p>数组是使用方括号构造的有限值序列：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let numbers = [1, 2, 3, 4]

fn main {
  let a = numbers[2]    // 访问第3个元素
  numbers[3] = 5        // 修改第4个元素
  println(a + numbers[3])  // 8
}
</code></pre>
<p><strong>两种数组类型</strong>：</p>
<ul>
<li><code>Array[T]</code>：可增长的数组</li>
<li><code>FixedArray[T]</code>：固定大小的数组</li>
</ul>
<p><strong>ArrayView（数组视图）</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let xs = [0, 1, 2, 3, 4, 5]
let s1 = xs[2:]      // [2, 3, 4, 5]
let s2 = xs[:4]      // [0, 1, 2, 3]
let s3 = xs[2:5]     // [2, 3, 4]
</code></pre>
<h4 data-id="heading-24">Map（映射）</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">let map : Map[String, Int] = { "x": 1, "y": 2, "z": 3 }
</code></pre>
<h4 data-id="heading-25">Option 和 Result</h4>
<p>用于表示可能的错误或失败：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let a : Int? = None           // 没有值
let b : Option[Int] = Some(42)  // 有值

let c : Result[Int, String] = Ok(42)       // 成功
let d : Result[Int, String] = Err("error") // 失败
</code></pre>
<h4 data-id="heading-26">Ref（可变引用）</h4>
<p><code>Ref[T]</code> 是包含类型 <code>T</code> 的值的可变引用：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let a : Ref[Int] = { val: 100 }

fn main {
  a.val = 200
  println(a.val)  // 200
}
</code></pre>

<h3 data-id="heading-27">函数定义</h3>
<h4 data-id="heading-28">顶层函数</h4>
<p>使用 <code>fn</code> 关键字定义顶层函数，需要显式类型注释：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn add3(x : Int, y : Int, z : Int) -&gt; Int {
  x + y + z
}
</code></pre>
<h4 data-id="heading-29">局部函数</h4>
<p>局部函数可以是命名的或匿名的，类型可以自动推断：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main {
  // 命名局部函数
  fn inc(x) {
    x + 1
  }

  // 匿名函数
  let double = fn(x) { x * 2 }

  // 箭头函数（更简洁）
  [1, 2, 3].each(x =&gt; println(x * x))

  println(inc(5))     // 6
  println(double(5))  // 10
}
</code></pre>
<h4 data-id="heading-30">函数应用</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">add3(1, 2, 7)  // 10

// 任何求值为函数值的表达式都是可应用的
let w = (if true { fn(x) { x + 1 } } else { fn(x) { x + 2 } })(3)
// w = 4
</code></pre>
<h4 data-id="heading-31">部分应用</h4>
<p>使用 <code>_</code> 操作符进行部分应用：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn add(x : Int, y : Int) -&gt; Int {
  x + y
}

fn main {
  let add10 = add(10, _)  // 创建一个新函数
  println(add10(5))   // 15
  println(add10(10))  // 20
}
</code></pre>

<h4 data-id="heading-32">带标签的参数</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">fn labelled(arg1~ : Int, arg2~ : Int) -&gt; Int {
  arg1 + arg2
}

fn main {
  let arg1 = 1
  // 可以使用 label=value 或 label~ 简写
  println(labelled(arg2=2, arg1~))  // 3
}
</code></pre>
<h4 data-id="heading-33">可选参数</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">fn optional(opt? : Int = 42) -&gt; Int {
  opt
}

fn main {
  println(optional())       // 42（使用默认值）
  println(optional(opt=0))  // 0
}
</code></pre>
<h4 data-id="heading-34">没有默认值的可选参数</h4>
<p>没有默认值的可选参数类型为 <code>T?</code>，默认值为 <code>None</code>。调用时 MoonBit 会自动用 <code>Some</code> 包装：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn new_image(width? : Int, height? : Int) -&gt; Unit {
  if width is Some(w) {
    println("width: \{w}")
  } else {
    println("no width")
  }
}

fn main {
  new_image(width=1920, height=1080)
}
</code></pre>
<p>转发可选参数时，使用 <code>label?=value</code> 语法，<code>label?</code> 是 <code>label?=label</code> 的简写：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn fixed_width_image(height? : Int) -&gt; Unit {
  new_image(width=1920, height?)  // 转发 height 参数
}
</code></pre>

<h3 data-id="heading-35">控制结构</h3>
<h4 data-id="heading-36">条件表达式（if）</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">let initial = if size &lt; 1 { 1 } else { size }
</code></pre>
<p><strong>注意</strong>：条件表达式在 MoonBit 中始终返回一个值，结果和 else 子句的返回值必须是相同的类型。</p>
<h4 data-id="heading-37">匹配表达式（match）</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">fn decide_sport(weather : String) -&gt; String {
  match weather {
    "sunny" =&gt; "tennis"
    "rainy" =&gt; "swimming"
    _ =&gt; "unknown"  // 默认情况
  }
}
</code></pre>
<h4 data-id="heading-38">卫语句（guard）</h4>
<p>用于检查指定的不变量：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn guarded_get(array : Array[Int], index : Int) -&gt; Int? {
  guard index &gt;= 0 &amp;&amp; index &lt; array.length() else { None }
  Some(array[index])
}
</code></pre>
<p>结合 <code>is</code> 表达式使用：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn getProcessedText(resources : Map[String, Resource], path : String) -&gt; String {
  guard resources.get(path) is Some(resource) else {
    fail("\{path} not found")
  }
  guard resource is PlainText(text) else {
    fail("\{path} is not plain text")
  }
  process(text)
}
</code></pre>

<h4 data-id="heading-39">While 循环</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main {
  let mut i = 5
  while i &gt; 0 {
    println(i)
    i = i - 1
  }
}
// 输出: 5 4 3 2 1
</code></pre>
<p>支持 <code>break</code> 和 <code>continue</code>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main {
  let mut i = 5
  while i &gt; 0 {
    i = i - 1
    if i == 4 { continue }  // 跳过本次
    if i == 1 { break }     // 退出循环
    println(i)
  }
}
// 输出: 3 2
</code></pre>
<p>支持 <code>else</code> 子句：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main {
  let mut i = 2
  while i &gt; 0 {
    println(i)
    i = i - 1
  } else {
    println("循环结束，i = \{i}")
  }
}
// 输出: 2 1 循环结束，i = 0
</code></pre>
<h4 data-id="heading-40">For 循环</h4>
<p>C 风格的 for 循环：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main {
  for i = 0; i &lt; 5; i = i + 1 {
    println(i)
  }
}
// 输出: 0 1 2 3 4
</code></pre>
<p>多变量绑定：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">for i = 0, j = 0; i + j &lt; 100; i = i + 1, j = j + 1 {
  println(i)
}
</code></pre>

<h4 data-id="heading-41">for..in 循环</h4>
<p>遍历数据结构的便捷语法：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">for x in [1, 2, 3] {
  println(x)
}
</code></pre>
<p>遍历整数范围：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">for j in 0..&lt;10 {   // 0 到 9
  println(j)
}

for l in 0..=10 {   // 0 到 10（包含）
  println(l)
}
</code></pre>
<p>遍历 Map：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">for k, v in { "x": 1, "y": 2, "z": 3 } {
  println("\{k}: \{v}")
}
</code></pre>
<p>遍历数组（带索引）：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">for index, elem in [4, 5, 6] {
  println("第 \{index + 1} 个元素是 \{elem}")
}
</code></pre>
<h4 data-id="heading-42">函数式循环（loop）</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">fn sum(xs : @list.List[Int]) -&gt; Int {
  loop (xs, 0) {
    (Empty, acc) =&gt; break acc
    (More(x, tail=rest), acc) =&gt; continue (rest, x + acc)
  }
}
</code></pre>
<h4 data-id="heading-43">defer 表达式</h4>
<p>用于可靠的资源释放：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main {
  defer println("释放资源")
  println("使用资源")
}
// 输出：使用资源
//       释放资源
</code></pre>
<p>连续的 <code>defer</code> 以倒序执行：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn main {
  defer println("第一处 defer")
  defer println("第二处 defer")
  println("做些事情")
}
// 输出：做些事情
//       第二处 defer
//       第一处 defer
</code></pre>

<h3 data-id="heading-44">自定义数据类型</h3>
<h4 data-id="heading-45">结构体（struct）</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">struct User {
  id : Int
  name : String
  mut email : String  // 可变字段
}

fn main {
  let u = User::{ id: 0, name: "John Doe", email: "john@doe.com" }
  u.email = "john@doe.name"  // 修改可变字段
  println(u.name)
}
</code></pre>
<p><strong>简写构造</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let name = "john"
let email = "john@doe.com"
let u = { id: 0, name, email }  // 字段名与变量名相同时可简写
</code></pre>
<p><strong>结构体更新语法</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let user = { id: 0, name: "John", email: "john@doe.com" }
let updated = { ..user, email: "new@email.com" }  // 只更新 email
</code></pre>
<h4 data-id="heading-46">枚举（enum）</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">enum Relation {
  Smaller
  Greater
  Equal
}

fn compare_int(x : Int, y : Int) -&gt; Relation {
  if x &lt; y { Smaller }
  else if x &gt; y { Greater }
  else { Equal }
}
</code></pre>
<p><strong>带数据的枚举</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">enum Lst {
  Nil
  Cons(Int, Lst)  // 携带额外数据
}

fn is_singleton(l : Lst) -&gt; Bool {
  match l {
    Cons(_, Nil) =&gt; true
    _ =&gt; false
  }
}
</code></pre>
<p><strong>带标签参数的构造器</strong>：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">enum Point {
  Point2D(x~ : Int, y~ : Int)
}

fn main {
  let p = Point2D(x=10, y=20)
  match p {
    Point2D(x~, y~) =&gt; println("x=\{x}, y=\{y}")
  }
}
</code></pre>
<h4 data-id="heading-47">元组结构体</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">struct UserId(Int)
struct UserInfo(UserId, String)

fn main {
  let id = UserId(1)
  let info = UserInfo(id, "John")

  // 通过索引访问
  println(id.0)      // 1
  println(info.1)    // John
}
</code></pre>
<h4 data-id="heading-48">类型别名</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">pub type MyIndex = Int
pub type MyMap = Map[Int, String]
</code></pre>

<h3 data-id="heading-49">模式匹配</h3>
<h4 data-id="heading-50">简单模式</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">const ONE = 1

fn match_int(x : Int) -&gt; Unit {
  match x {
    0 =&gt; println("zero")
    ONE =&gt; println("one")
    value =&gt; println(value)  // 绑定到变量
  }
}
</code></pre>
<p>使用 <code>_</code> 作为通配符，<code>..</code> 忽略剩余字段：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">struct Point3D { x : Int, y : Int, z : Int }

fn match_point(p : Point3D) -&gt; Unit {
  match p {
    { x: 0, .. } =&gt; println("在 yz 平面上")
    _ =&gt; println("不在 yz 平面上")
  }
}
</code></pre>
<h4 data-id="heading-51">数组模式</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">fn match_array(arr : Array[Int]) -&gt; Unit {
  match arr {
    [] =&gt; println("空数组")
    [a, b, c] =&gt; println("三元素: \{a}, \{b}, \{c}")
    [a, .. rest, b] =&gt; println("首: \{a}, 尾: \{b}")
  }
}
</code></pre>
<h4 data-id="heading-52">范围模式</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">fn classify_char(c : Char) -&gt; String {
  match c {
    'a'..='z' =&gt; "lowercase"
    'A'..='Z' =&gt; "uppercase"
    '0'..='9' =&gt; "digit"
    _ =&gt; "other"
  }
}
</code></pre>
<h4 data-id="heading-53">Map 模式</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">fn match_map(map : Map[String, Int]) -&gt; Unit {
  match map {
    { "b": _, .. } =&gt; println("包含 key 'b'")
    { "a": x, .. } =&gt; println("a 的值是 \{x}")
    _ =&gt; println("其他情况")
  }
}
</code></pre>
<h4 data-id="heading-54">守卫条件</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">fn guard_example(x : Int?) -&gt; Int {
  match x {
    Some(a) if a &gt;= 0 =&gt; a
    Some(b) =&gt; -b
    None =&gt; -1
  }
}
</code></pre>

<h3 data-id="heading-55">泛型</h3>
<p>泛型在顶层函数和数据类型定义中受支持：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">enum List[T] {
  Nil
  Cons(T, List[T])
}

fn[S, T] List::map(self : List[S], f : (S) -&gt; T) -&gt; List[T] {
  match self {
    Nil =&gt; Nil
    Cons(x, xs) =&gt; Cons(f(x), xs.map(f))
  }
}

fn[S, T] List::reduce(self : List[S], op : (T, S) -&gt; T, init : T) -&gt; T {
  match self {
    Nil =&gt; init
    Cons(x, xs) =&gt; xs.reduce(op, op(init, x))
  }
}
</code></pre>

<h3 data-id="heading-56">特殊语法</h3>
<h4 data-id="heading-57">管道操作符（|&gt;）</h4>
<pre><code class="hljs language-moonbit" lang="moonbit">5 |&gt; ignore                    // 等价于 ignore(5)
[] |&gt; Array::push(5)           // 等价于 Array::push([], 5)
1 |&gt; add(5) |&gt; ignore          // 链式调用
</code></pre>
<h4 data-id="heading-58">级联运算符（..）</h4>
<p>用于连续对同一值执行多个操作：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let result = StringBuilder::new()
  ..write_char('a')
  ..write_char('b')
  ..write_string("cdef")
  .to_string()
</code></pre>
<h4 data-id="heading-59">is 表达式</h4>
<p>测试值是否符合特定模式：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn is_none[T](x : T?) -&gt; Bool {
  x is None
}

fn start_with_lower(s : String) -&gt; Bool {
  s is ['a'..='z', ..]
}

// 在 if 中使用
fn process(x : Array[Int?]) -&gt; Unit {
  if x is [v, ..] &amp;&amp; v is Some(i) &amp;&amp; i is (0..=10) {
    println("匹配成功：\{i}")
  }
}
</code></pre>
<h4 data-id="heading-60">展开运算符（..）</h4>
<p>在构造数组时展开元素序列：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">let a1 = [1, 2, 3]
let a2 = [4, 5, 6]
let combined : Array[Int] = [..a1, ..a2, 7, 8]
// [1, 2, 3, 4, 5, 6, 7, 8]
</code></pre>
<h4 data-id="heading-61">TODO 语法（...）</h4>
<p>用于标记尚未实现的代码：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn todo_func() -&gt; Int {
  ...  // 占位符，表示待实现
}
</code></pre>

<h3 data-id="heading-62">迭代器</h3>
<p>MoonBit 内置了 <code>Iter[T]</code> 类型，是一种内部迭代器：</p>
<pre><code class="hljs language-moonbit" lang="moonbit">fn filter_even(l : Array[Int]) -&gt; Array[Int] {
  l.iter()
    .filter(x =&gt; (x &amp; 1) == 0)
    .collect()
}

fn fact(n : Int) -&gt; Int {
  (1).until(n).fold(Int::mul, init=1)
}
</code></pre>
<p>常用方法：</p>
<ul>
<li><code>each</code>：遍历每个元素</li>
<li><code>fold</code>：折叠操作</li>
<li><code>collect</code>：收集到数组</li>
<li><code>filter</code>：过滤元素</li>
<li><code>map</code>：转换元素</li>
<li><code>concat</code>：合并两个迭代器</li>
</ul>
<p><strong>优势</strong>：<code>filter</code>、<code>map</code> 等方法是惰性的，不会为中间值分配内存。</p>

<h3 data-id="heading-63">总结</h3>
<p>本文介绍了 MoonBit 语言的基础语法，包括：</p>













































<table><thead><tr><th>概念</th><th>要点</th></tr></thead><tbody><tr><td>程序结构</td><td>由类型定义、函数定义、变量绑定、init/main/test 组成</td></tr><tr><td>变量绑定</td><td><code>let</code>（不可变）、<code>let mut</code>（可变）、<code>const</code>（常量）</td></tr><tr><td>数据类型</td><td>Unit、布尔、数字、字符串、数组、元组、Map、Option、Result 等</td></tr><tr><td>函数</td><td>顶层函数、局部函数、匿名函数、标签参数、可选参数</td></tr><tr><td>控制流</td><td>if、match、guard、while、for、for..in、loop、defer</td></tr><tr><td>自定义类型</td><td>struct、enum、元组结构体、类型别名</td></tr><tr><td>模式匹配</td><td>简单模式、数组模式、范围模式、Map 模式、守卫条件</td></tr><tr><td>泛型</td><td>类型参数化的函数和数据类型</td></tr><tr><td>特殊语法</td><td>管道 <code>|&gt;</code>、级联 <code>..</code>、is 表达式、展开运算符</td></tr></tbody></table>
<p>MoonBit 融合了函数式和命令式编程的优点，语法简洁优雅，类型系统强大。掌握这些基础语法后，你就可以开始编写真正的 MoonBit 程序了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[技术干货丨AI 大模型微调到底是什么？一篇通俗文帮你弄明白]]></title>    <link>https://juejin.cn/post/7578780780027658249</link>    <guid>https://juejin.cn/post/7578780780027658249</guid>    <pubDate>2025-12-02T05:47:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578780780027658249" data-draft-id="7578803491822207003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="技术干货丨AI 大模型微调到底是什么？一篇通俗文帮你弄明白"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-02T05:47:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            技术干货丨AI 大模型微调到底是什么？一篇通俗文帮你弄明白
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:47:19.000Z" title="Tue Dec 02 2025 05:47:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p><strong>什么是微调?</strong></p>
<p><strong>微调就是在已经训练好的大模型基础上，用你自己的数据继续训练，让模型更符合你的特定需求。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3890544d45ef488dad986143cfedd92d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259238&amp;x-signature=W21vM7d42eiUf3tsIP%2FzRPzCoiQ%3D" alt="" loading="lazy"/></p>
<p>CPT(ContinualPre-Training)继续预训练最基础的微调方式。你拿到一个预训练好的模型，然后用大量无标签的文本数据继续训练它。</p>
<p>SFT(Supervised Fine-Tuning)监督微调最常用的微调方式。你准备好问题-答案对，教模型如何回答特定类型的问题。</p>
<p>DPO(Direct Preference Optimization)偏好训练最新的微调技术，通过对比“好答案“和“坏答案"来训练模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02bd9959a0d74cb98a29bcd59792a9c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259238&amp;x-signature=puIiK%2B8zPrQ5BKBopZuVPuL4bNc%3D" alt="" loading="lazy"/></p>
<p><strong>三种微调方式详解</strong></p>
<p><strong>PT（Continued Pre-Training，继续预训练）</strong></p>
<p>通过无标注数据进行无监督继续预训练，强化或新增模型特定能力。</p>
<p><strong>数据要求</strong></p>
<p>需要大量文本数据(通常几GB到几十GB)数据质量要高，最好是你目标领域的专业内容</p>
<p><strong>适用场景</strong></p>
<p>让模型学习特定领域的知识，比如医学、法律、金融</p>
<p>增强模型对某种语言或方言的理解</p>
<p>让模型熟悉你所在行业的专业术语</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ab498977630429ab2f0830945a0a9c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259238&amp;x-signature=LJKg338zQ9lzJtdaw60g%2FPOK3gY%3D" alt="" loading="lazy"/></p>
<p><strong>SFT(Supervised Fine-Tuning)监督微调</strong></p>
<p>有监督微调，增强模型指令跟随的能力，提供全参和高效训练方式。</p>
<p><strong>数据要求</strong></p>
<p>通常需要几千到几万条高质量的问答对</p>
<p>答案要准确、风格统一</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93c4931daaaf4d2dac09d1c94432fce4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259238&amp;x-signature=e%2BRAA2yDlgvMXVuskG8mN0lD%2Bxk%3D" alt="" loading="lazy"/></p>
<p><strong>适用场景</strong></p>
<p>训练客服机器人</p>
<p>创建特定任务的助手(比如代码助手、写作助手)</p>
<p>让模型学会特定的对话风格</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0c08423d9d147eb9771d89e4d2cef34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259238&amp;x-signature=05GOXSBsnWJUlnWzlblpW3gvGoI%3D" alt="" loading="lazy"/></p>
<p><strong>DPO(Direct Preference Optimization)偏好训练</strong></p>
<p>引入负反馈，降低幻觉，使得模型输出更符合人类偏好</p>
<p><strong>工作原理</strong></p>
<p>给模型同一个问题的两个不同答案</p>
<p>告诉模型哪个答案更好</p>
<p>模型学会倾向于生成更好的答案</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8821decf02dc45da880b109edad68530~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259238&amp;x-signature=fmqyHy5gohE3JLL4fpIKEoG9ihU%3D" alt="" loading="lazy"/></p>
<p><strong>适用场景</strong></p>
<p>让模型的回答更符合人类偏好</p>
<p>减少有害内容的生成</p>
<p>提高回答的质量和安全性</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbbb70ddb86d451fb93661ad5fe78dd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259238&amp;x-signature=b2I19Vj2AY8WT8zy6Tt9LOIYc98%3D" alt="" loading="lazy"/></p>
<p><strong>非必要不微调</strong></p>
<p>1.<strong>成本高</strong>:需要大量GPU资源和时间</p>
<p>2.<strong>技术门槛高</strong>:需要懂机器学习、数据处理、模型训练</p>
<p>3.数据要求严格:需要高质量、大量的训练数据4.维护复杂:模型更新后需要重新微调</p>
<p><strong>优先考虑替代方案</strong></p>
<p><strong>1.提示词工程</strong></p>
<p>通过精心设计的提示词让模型理解你的需求</p>
<p>成本低，见效快，容易调整</p>
<p>适合大部分使用场景</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0013c9f8d8c4ad5981f1b656d287785~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259238&amp;x-signature=LnCLu2CXLNfKx8SJ9%2FOWYSouT9g%3D" alt="" loading="lazy"/></p>
<p><strong>2.RAG</strong></p>
<p>让模型检索相关文档后再回答</p>
<p>能够获取最新信息</p>
<p>不需要重新训练模型</p>
<p><strong>什么情况有必要微调</strong></p>
<p><strong>1.特定领域的专业知识</strong></p>
<p>当你的业务涉及非常专业的领域，而通用模型的知识不够用时</p>
<p>如:医疗诊断系统、法律文书生成、特定行业的技术支持。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8751049e3d042f8909f21a01aa81506~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259238&amp;x-signature=5BSmho4rLXsaFf7jATDs4LMYyHo%3D" alt="" loading="lazy"/></p>
<p><strong>2.特殊的输出格式要求</strong></p>
<p>需要模型输出特定格式，而提示词难以稳定控制时。如:结构化数据提取、特定的代码生成规范、标准化的报告格式。</p>
<p><strong>3.私有数据的深度理解</strong></p>
<p>需要模型深度理解你的私有数据，而RAG检索效果不够好时。如:企业内部知识库的深度应用、个人化推荐系统、基于历史数据的预测</p>
<p><strong>4.性能要求极高的场景</strong></p>
<p>对响应速度和准确性要求都很高的场景。如:实时客服系统、高频交易的决策支持、大规模自动化处理</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b890ac5b28b4899a0dcfa4b40373384~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259238&amp;x-signature=OlfJhOf1IoQB6ZTjWvuPU2QriTQ%3D" alt="" loading="lazy"/></p>
<p><strong>总结</strong></p>
<p>微调是一个强大的工具，但不是万能药。在考虑微调之前，先试试提示词优化和RAG。只有在确实需要深度定制，且有足够资源投入时，才考虑微调。</p>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于SpringAI构建大模型应用]]></title>    <link>https://juejin.cn/post/7578794217962127400</link>    <guid>https://juejin.cn/post/7578794217962127400</guid>    <pubDate>2025-12-02T05:50:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578794217962127400" data-draft-id="7578820431040118824" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于SpringAI构建大模型应用"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-02T05:50:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于SpringAI构建大模型应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:50:26.000Z" title="Tue Dec 02 2025 05:50:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读27分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 背景</h2>
<p>在这里，我主要分享的是在<strong>应用</strong>层面大模型相关的技术，假如你已有一个现成的大模型接口，无论是符合OpenAI规范的，还是各家公司一些自己的接口，例如Gemini，Deepseek，通义千问，问心一言等，让用这些大模型来构建一些应用，可以选取下面的方案：</p>
<ol>
<li>使用低代码大模型应用搭建平台，例如<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcoze-dev%2Fcoze-studio%3Ftab%3Dreadme-ov-file" target="_blank" title="https://github.com/coze-dev/coze-studio?tab=readme-ov-file" ref="nofollow noopener noreferrer">Coze</a>，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flanggenius%2Fdify%2F" target="_blank" title="https://github.com/langgenius/dify/" ref="nofollow noopener noreferrer">Dify</a>， <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flabring%2FFastGPT" target="_blank" title="https://github.com/labring/FastGPT" ref="nofollow noopener noreferrer">FastGPT</a>等，这些平台带了流程编排，知识库，也很方便的和各种大模型对接，向量模型、向量库，有些还有了监控界面或者插件市场等，能满足我们的大部分需求</li>
<li>使用编程的方式来构建应用，这种可以使用公司现有的技术栈，提供更为灵活的使用，接入现有的系统等，或者从更高层面来说，定制自己的大模型应用规范，定制大模型应用构建平台，接入平台等；也可以把上面所说的低代码平台看作为自建大模型应用体系的一部分，即可以通过代码的方式灵活去构建应用，也通过平台更高效的去构建应用</li>
</ol>
<p>我们后面讲的主要是使用第二种方式，我们选取一些现有的框架来实现，Python主要<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain" target="_blank" title="https://github.com/langchain-ai/langchain" ref="nofollow noopener noreferrer">Langchain</a>相关技术，Java也有一个对应的框架<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flangchain4j%2Flangchain4j" target="_blank" title="https://github.com/langchain4j/langchain4j" ref="nofollow noopener noreferrer">Langchain4j</a>，也有<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-ai%2Freference%2Findex.html" target="_blank" title="https://docs.spring.io/spring-ai/reference/index.html" ref="nofollow noopener noreferrer">SpringAI</a></p>
<p>这些框架帮我们做了很多事情：</p>
<ol>
<li>封装一个通用的模型调用接口，屏蔽了底层不同公司大模型接口的差异</li>
<li>管理了会话和上下文，会话就是将用户之前问的问题和现在问的问题关联起来</li>
<li>结构化输出，将大模型的文本输出转为程序可以使用的结构化对象，例如JSON对象</li>
<li>工具/函数调用</li>
<li>可观测性</li>
<li>模型效果评估</li>
</ol>
<blockquote>
<p>一个框架<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FBerriAI%2Flitellm" target="_blank" title="https://github.com/BerriAI/litellm" ref="nofollow noopener noreferrer">LiteLLM</a>专门把不同大模型接口适配为OpenAI格式的，这也是一种屏蔽差异的方式</p>
</blockquote>
<h2 data-id="heading-1">2. 架构</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9876edfe1c494ed99924fe829325aab3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259426&amp;x-signature=kLIqwGgG%2Bgu9SAhFLKbYHQsCvAU%3D" alt="" loading="lazy"/>.png)</p>
<p>整体架构如上，下面主要介绍部分实现</p>
<ul>
<li>模型框架层，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-ai%2Freference%2Findex.html" target="_blank" title="https://docs.spring.io/spring-ai/reference/index.html" ref="nofollow noopener noreferrer">SpringAI</a>，Java大模型应用开发框架</li>
<li>模型推理能力，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Follama%2Follama" target="_blank" title="https://github.com/ollama/ollama" ref="nofollow noopener noreferrer">Ollama</a>，利用本地CPU或GPU，和现有训练模型，实现模型推理能力，便于开发，生产环境需要替换</li>
<li>监控追踪，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flangfuse%2Flangfuse" target="_blank" title="https://github.com/langfuse/langfuse" ref="nofollow noopener noreferrer">LangFuse</a>，追踪大模型应用请求，例如输入输出，耗时、Token消耗等</li>
</ul>
<h2 data-id="heading-2">3. 实现</h2>
<h3 data-id="heading-3">3.1 安装</h3>
<p>Ollama和LangFuse参照文档安装和启动</p>
<p>SpringAI通过pom导入，除此之外，还导入了springboot ollama、opentelemetry等相关包，后者是为了接入LangFuse</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.jd.jt<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ai-base<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Archetype - ai-base<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://maven.apache.org<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.opentelemetry.instrumentation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>opentelemetry-instrumentation-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.17.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-model-ollama<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Spring AI needs a reactive web server to run for some reason--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.opentelemetry.instrumentation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>opentelemetry-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Spring Boot Actuator for observability support --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Micrometer Observation -&gt; OpenTelemetry bridge --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.micrometer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>micrometer-tracing-bridge-otel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- OpenTelemetry OTLP exporter for traces --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.opentelemetry<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>opentelemetry-exporter-otlp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.38<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">3.2 起步示例</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.http.MediaType;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;

    <span class="hljs-keyword">public</span> MyController(ChatClient.Builder chatClientBuilder) {
        <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.build();
    }

    <span class="hljs-meta">@GetMapping(value = <span class="hljs-string">"/ai-stream"</span>, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span>
    Flux&lt;String&gt; generationStream(<span class="hljs-meta">@RequestParam(<span class="hljs-string">"userInput"</span>)</span> String userInput) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.chatClient.prompt()
                .user(userInput)
                .stream()
                .content();
    }

    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/ai"</span>)</span>
    String generation(String userInput) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.chatClient.prompt()
                .user(userInput)
                .call()
                .content();
    }
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2FProject%2Fgithub%2Fai-base%2Fsrc%2Fmain%2Fresources%2Fapplication.properties" target="_blank" title="https://www.cnblogs.com/Project/github/ai-base/src/main/resources/application.properties" ref="nofollow noopener noreferrer">application.properties</a></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.ollama.chat.enabled</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.ai.model.chat</span>=ollama
<span class="hljs-attr">spring.ai.ollama.chat.options.model</span>=qwen3:<span class="hljs-number">8</span>b
<span class="hljs-attr">spring.ai.chat.observations.include-prompt</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.ai.chat.observations.include-completion</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">management.tracing.sampling.probability</span>=<span class="hljs-number">1.0</span>
</code></pre>
<p>执行命令</p>
<pre><code class="hljs language-bash" lang="bash">curl --location <span class="hljs-string">'http://localhost:8080/ai?userInput=%E4%BD%A0%E5%A5%BD'</span>

&lt;think&gt;
嗯，用户发来“你好”，我需要以自然的方式回应。首先，应该用中文回复，保持友好和亲切的语气。可以简单问候，比如“你好！有什么我可以帮助你的吗？”这样既回应了对方的问候，又主动询问是否需要帮助，符合我的设计原则。同时，要避免使用复杂或生硬的表达，让对话显得轻松。另外，考虑到用户可能有各种需求，保持开放式的提问可以引导他们进一步说明具体问题，这样我才能更好地提供帮助。确保回复简洁明了，符合日常交流的习惯。
&lt;/think&gt;

你好！有什么我可以帮助你的吗？😊
</code></pre>
<h3 data-id="heading-5">3.3 提示词</h3>
<h4 data-id="heading-6">3.3.1 提示词模板</h4>
<p>将变量嵌入提示词模板中，动态生成提示词</p>
<pre><code class="hljs language-ini" lang="ini">public String generateChildName() {

    PromptTemplate <span class="hljs-attr">promptTemplate</span> = new PromptTemplate(<span class="hljs-string">"""
            男方姓：{maleName}
            女方姓：{femaleName}
            帮孩子起名
            """</span>)<span class="hljs-comment">;</span>

    Prompt <span class="hljs-attr">prompt</span> = promptTemplate.create(Map.of(<span class="hljs-string">"maleName"</span>, <span class="hljs-string">"宋"</span>, <span class="hljs-string">"femaleName"</span>, <span class="hljs-string">"刘"</span>))<span class="hljs-comment">;</span>

    return chatClient.prompt(prompt).call().content()<span class="hljs-comment">;</span>
}
</code></pre>
<p>执行命令</p>
<pre><code class="hljs language-rust" lang="rust">curl --location <span class="hljs-symbol">'http</span>:<span class="hljs-comment">//localhost:8080/get-name</span>

&lt;think&gt;
嗯，用户让我帮忙给孩子起名，男方姓宋，女方姓刘。首先，我需要了解用户的需求。他们可能想要一个结合双方姓氏的名字，或者更倾向于其中一个姓氏。不过通常在中国，孩子跟父姓，所以可能主要用宋姓，但有时候也会考虑双姓或者结合双方姓氏的元素。
...
</code></pre>
<p>提示词模板也可以通过<code>Resource</code>的方式使用，这样提示词可以存在任何地方了，工程文件、数据库、配置中心等，把提示词模板放在外部，更容易管理和实时变更，我们也可以通过第三方库来实现这个功能</p>
<h4 data-id="heading-7">3.3.2 提示词管理</h4>
<p>提示词管理是将提示词单独存储在工程外部，提供一些易用的功能，例如版本控制，搜索提示词等。</p>
<p>我们这用了LangFuse，所以只要把它接入我们的项目即可</p>
<ol>
<li>在界面上面创建提示词模板，并发布</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24b88b57453f41f5b0181a574f6ae32c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259426&amp;x-signature=66H41qG2HhLTqU5bdaKfGyFmmeQ%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li>在Java项目中接入，因为LangFuse没有Java的SDK，所以我们需要使用Api的方式</li>
</ol>

<pre><code class="hljs language-xml" lang="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.lianjiatech<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>retrofit-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>​ 创建LangFuseClient Http请求Client，改造之前写generateChildName方法，从LangFuse获取提示词</p>
<pre><code class="hljs language-less" lang="less">
<span class="hljs-variable">@RetrofitClient</span>(baseUrl = <span class="hljs-string">"http://localhost:3000"</span>)
public interface LangFuseClient {

    <span class="hljs-variable">@GET</span>(<span class="hljs-string">"api/public/v2/prompts/{promptName}"</span>)
    <span class="hljs-variable">@Headers</span>(<span class="hljs-string">"Authorization: Basic cGstbGYtNDFmZjZkYjItZWZjNC00YTg4LTkyNmItZmMxZDE1ZGUwNGNiOnNrLWxmLTYzN2RmMDE0LWVkZDItNDdhNi1iNmUwLTE0N2U2MjMyOWYyMQ=="</span>)
    LFPrompt <span class="hljs-built_in">getPrompts</span>(<span class="hljs-variable">@Path</span>(<span class="hljs-string">"promptName"</span>) String promptName);
}


public String <span class="hljs-built_in">generateChildName</span>() {

        <span class="hljs-selector-tag">LFPrompt</span> <span class="hljs-selector-tag">lfPrompt</span> = <span class="hljs-selector-tag">langFuseClient</span><span class="hljs-selector-class">.getPrompts</span>(<span class="hljs-string">"起名"</span>);
        <span class="hljs-selector-tag">PromptTemplate</span> <span class="hljs-selector-tag">promptTemplate</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">PromptTemplate</span>(lfPrompt.<span class="hljs-built_in">getPrompt</span>());

        <span class="hljs-selector-tag">Prompt</span> <span class="hljs-selector-tag">prompt</span> = <span class="hljs-selector-tag">promptTemplate</span><span class="hljs-selector-class">.create</span>(Map.<span class="hljs-built_in">of</span>(<span class="hljs-string">"maleName"</span>, <span class="hljs-string">"宋"</span>, <span class="hljs-string">"femaleName"</span>, <span class="hljs-string">"刘"</span>));

        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">chatClient</span><span class="hljs-selector-class">.prompt</span>(prompt)<span class="hljs-selector-class">.call</span>()<span class="hljs-selector-class">.content</span>();
}
</code></pre>
<ol start="3">
<li>执行命令，查看结果</li>
</ol>
<pre><code class="hljs language-rust" lang="rust">  curl --location <span class="hljs-symbol">'http</span>:<span class="hljs-comment">//localhost:8080/get-name'</span>
  
  &lt;think&gt;
  嗯，用户让我帮忙给孩子起名，男方姓宋，女方姓刘。首先，我需要确认用户的需求。他们可能希望名字中包含双方的姓氏，或者结合两者的元素。不过，用户没有明确说明是否要双姓，所以可能需要考虑不同的可能性。
  
  接下来，我得考虑名字的寓意和音韵。中文名字通常讲究平仄搭配，读起来顺口，同时要有好的寓意。比如，宋和刘的组合，可能需要找一个字来连接，或者用两个字分别代表双方的姓氏。
  
  然后，用户要求输出在<span class="hljs-number">30</span>个字以内，所以每个名字要简洁。可能需要列出多个选项，让用户有选择的余地。同时，要注意避免生僻字，确保名字的易读性和美观性。
  
</code></pre>
<h4 data-id="heading-8">3.3.3 提示词工程</h4>
<p>提示词工程是通过关注提示词开发和优化，提升大语言模型处理复杂任务场景的能力</p>
<p>具体可以参考<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.promptingguide.ai%2Fzh" target="_blank" title="https://www.promptingguide.ai/zh" ref="nofollow noopener noreferrer">提示工程指南</a></p>
<p>主要涉及了：</p>
<ol>
<li>提示词的基本结构，例如包含指令、上下文，用户输入，输出指示</li>
<li>通用技巧</li>
<li><strong>提示词技术</strong>，零样本提示，少样本提示，链式思考</li>
</ol>
<p>如果有现成的提示词，可以直接拿过来用，开源的提示词<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ff%2Fawesome-chatgpt-prompts" target="_blank" title="https://github.com/f/awesome-chatgpt-prompts" ref="nofollow noopener noreferrer">awesome-chatgpt-prompts</a>，商业的提示词<a href="https://link.juejin.cn?target=https%3A%2F%2Fpromptbase.com%2F" target="_blank" title="https://promptbase.com/" ref="nofollow noopener noreferrer">promptbase</a>，这样的网站很多，甚至可以使用大模型来生成提示词，通常会比自己从头开始写效率会高</p>
<h3 data-id="heading-9">3.4 结构化输出</h3>
<p>将大模型的文本输出转化为固定结构</p>
<pre><code class="hljs language-ini" lang="ini">    public List&lt;String&gt; generateChildName() {

        LFPrompt <span class="hljs-attr">lfPrompt</span> = langFuseClient.getPrompts(<span class="hljs-string">"起名"</span>)<span class="hljs-comment">;</span>
        PromptTemplate <span class="hljs-attr">promptTemplate</span> = new PromptTemplate(lfPrompt.getPrompt())<span class="hljs-comment">;</span>

        Prompt <span class="hljs-attr">prompt</span> = promptTemplate.create(Map.of(<span class="hljs-string">"maleName"</span>, <span class="hljs-string">"宋"</span>, <span class="hljs-string">"femaleName"</span>, <span class="hljs-string">"刘"</span>))<span class="hljs-comment">;</span>


        return chatClient.prompt(prompt).call().entity(new ListOutputConverter(new DefaultConversionService()))<span class="hljs-comment">;</span>
    }
</code></pre>
<p>执行命令，可以看到返回结果变为了数组格式，但并不完美，通过提示词关闭think内容后，格式上面还是有一些问题，后续<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fspring-projects%2Fspring-ai%2Fpull%2F3386" target="_blank" title="https://github.com/spring-projects/spring-ai/pull/3386" ref="nofollow noopener noreferrer">SpringAI会支持通过参数的方式关闭think过程</a></p>
<pre><code class="hljs language-swift" lang="swift">curl <span class="hljs-operator">--</span>location 'http:<span class="hljs-comment">//localhost:8080/get-name'</span>

[
    <span class="hljs-string">"&lt;think&gt;<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>&lt;/think&gt;<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>宋明轩"</span>,
    <span class="hljs-string">"宋子涵"</span>,
    <span class="hljs-string">"宋浩然"</span>,
    <span class="hljs-string">"宋梓睿"</span>,
    <span class="hljs-string">"宋俊熙"</span>,
    <span class="hljs-string">"宋天宇"</span>,
    <span class="hljs-string">"宋浩宇"</span>,
    <span class="hljs-string">"宋梓豪"</span>,
    <span class="hljs-operator">...</span>
]
</code></pre>
<p>可以从提示词中，看到Spring AI为我们加了约束输出的提示词，输出结果也是按照这个格式，这个截图是LangFuse的监控的一部分，可以看到请求大模型的记录</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92c3a4200c6e441ba4a60a6351dad93c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259426&amp;x-signature=PqIgAXLxaWnaRPO5VfA%2FwSQitwE%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0e2a45be9d94636ae41fe5828bfdaba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259426&amp;x-signature=BMaFGMTaZldtExnoYnSmY8Zvx1I%3D" alt="" loading="lazy"/></p>
<p>另外可以将结果转为Map或者Java的某个具体Class</p>
<h3 data-id="heading-10">3.5 会话和上下文</h3>
<p>在使用大模型应用的过程中，通常会有两种模式</p>
<ol>
<li>单轮对话，也就是一问一答，之前问过的问题不会再考虑</li>
<li>多轮对话，在整个对话周期呢，大模型会关联之前的问题，综合之后给出回复</li>
</ol>
<p>要实现多轮对话的功能，就需要我们记录是否是一次会话和会话期间的上下文，因为大模型本身是无状态的，它自己不记录这些内容</p>
<pre><code class="hljs language-ini" lang="ini">

import org.springframework.ai.chat.client.ChatClient<span class="hljs-comment">;</span>
import org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor<span class="hljs-comment">;</span>
import org.springframework.ai.chat.memory.ChatMemory<span class="hljs-comment">;</span>
import org.springframework.ai.chat.memory.MessageWindowChatMemory<span class="hljs-comment">;</span>
import org.springframework.ai.chat.prompt.Prompt<span class="hljs-comment">;</span>
import org.springframework.ai.chat.prompt.PromptTemplate<span class="hljs-comment">;</span>
import org.springframework.ai.converter.ListOutputConverter<span class="hljs-comment">;</span>
import org.springframework.core.convert.support.DefaultConversionService<span class="hljs-comment">;</span>
import org.springframework.stereotype.Service<span class="hljs-comment">;</span>

import java.util.List<span class="hljs-comment">;</span>
import java.util.Map<span class="hljs-comment">;</span>

@Service
public class ChatService {

    private final ChatClient chatClient<span class="hljs-comment">;</span>



    public ChatService(ChatClient.Builder chatClientBuilder) {
        ChatMemory <span class="hljs-attr">chatMemory</span> = MessageWindowChatMemory.builder().maxMessages(<span class="hljs-number">10</span>).build()<span class="hljs-comment">;</span>

        <span class="hljs-attr">this.chatClient</span> = chatClientBuilder
                .defaultAdvisors(MessageChatMemoryAdvisor.builder(chatMemory).build())
                .build()<span class="hljs-comment">;</span>
    }

    public List&lt;String&gt; generateChildName(String conversationId, String surname, String gender) {
        // 系统提示词
        String <span class="hljs-attr">systemMessage</span> = <span class="hljs-string">"你是一个专业的起名专家，擅长根据中国传统文化和现代审美为孩子起名。请确保名字寓意美好、朗朗上口。"</span><span class="hljs-comment">;</span>

        // 用户提示词模板
        String <span class="hljs-attr">userMessageTemplate</span> = <span class="hljs-string">"""
                请为姓{surname}的{gender}孩子起名，要求：
                1. 输出不超过10个名字
                2. 每个名字都要有寓意说明
                3. 名字要符合现代审美"""</span><span class="hljs-comment">;</span>

        PromptTemplate <span class="hljs-attr">userPromptTemplate</span> = new PromptTemplate(userMessageTemplate)<span class="hljs-comment">;</span>
        Prompt <span class="hljs-attr">userPrompt</span> = userPromptTemplate.create(Map.of(
                "surname", surname,
                "gender", gender
        ))<span class="hljs-comment">;</span>

        return chatClient
                .prompt()
                .system(systemMessage)  // 系统提示词
                .user(userPrompt.getContents())  // 用户提示词
                .advisors(a -&gt; a.param(ChatMemory.CONVERSATION_ID, conversationId))
                .call()
                .entity(new ListOutputConverter(new DefaultConversionService()))<span class="hljs-comment">;</span>
    }


}
</code></pre>
<p>当发了两次请求之后，从回复的内容可以看看，大模型知道问了两次</p>
<pre><code class="hljs language-swift" lang="swift">[<span class="hljs-string">"&lt;think&gt;<span class="hljs-subst">\n</span>好的，用户之前让我为姓宋的男孩起名，现在又发了一个类似的请求，但这次要求输出格式是逗号分隔的列表，没有其他文本。我需要仔细分析用户的需求。<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>首先，用户可能是在测试我是否能按照新的格式要求输出，或者他们需要将名字直接用于某个系统，比如注册表单或应用程序，所以需要简洁的格式。之前的回复是中文名字和寓意，现在需要转换为只列出名字，用逗号分隔。<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>接下来，我需要确保每个名字都符合现代审美，同时保持寓意美好。用户之前提供的例子中有“宋子墨”、“宋知远”等，这些名字都比较文雅，符合传统文化，同时又不失现代感。我需要保持这种风格，避免生僻字，确保名字朗朗上口。<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>另外，用户可能希望名字有独特的寓意，同时避免重复。比如“宋明轩”中的“明”象征光明，“轩”有气度的意思，这样的组合既传统又现代。我需要检查每个名字的寓意是否明确，并且没有重复的字。<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>还要注意名字的结构，姓氏“宋”是单姓，名字通常为两个字，所以每个名字都是两个字的组合。需要确保每个名字都符合这个结构，并且整体看起来协调。<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>最后，用户要求不超过10个名字，所以我要控制数量，确保每个名字都经过筛选，符合所有要求。同时，输出格式必须严格遵循逗号分隔，没有其他文字，这可能需要在生成时特别注意格式的正确性，避免任何多余的字符或空格。<span class="hljs-subst">\n</span>&lt;/think&gt;<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>宋知远"</span>,<span class="hljs-string">"宋云舟"</span>,<span class="hljs-string">"宋景行"</span>,<span class="hljs-string">"宋清晏"</span>,<span class="hljs-string">"宋修远"</span>,<span class="hljs-string">"宋墨言"</span>,<span class="hljs-string">"宋怀瑾"</span>,<span class="hljs-string">"宋承泽"</span>,<span class="hljs-string">"宋明轩"</span>,<span class="hljs-string">"宋致远"</span>]
</code></pre>
<h3 data-id="heading-11">3.6 工具/函数调用</h3>
<p>利用外部的工具，函数现有的能力，同时利用大模型的能力，结合起来完成复杂的任务，例如：</p>
<ol>
<li>某些数学计算函数，天气查询服务，下单服务，订票服务，发邮件等，利用这些服务可以扩展大模型的能力</li>
<li>又例如通过数据库查询信息，文档库查询文档</li>
</ol>
<p>工具类</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">tool</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Tool</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TicketUtil</span> {

    <span class="hljs-meta">@Tool</span>(description = <span class="hljs-string">"输入出发地和目的地，购买火车票"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">buyTicket</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> source, <span class="hljs-built_in">String</span> target</span>) {

        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"已购买"</span> + source + <span class="hljs-string">"到"</span> + target + <span class="hljs-string">"的票"</span>);
    }
}
</code></pre>
<p>大模型请求时，使用tool方法</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> com.jd.ai.util.TicketUtil;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

@Service
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TicketService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;


    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">TicketService</span><span class="hljs-params">(ChatClient.Builder chatClientBuilder)</span> </span>{
        <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.<span class="hljs-built_in">build</span>();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">buyTicket</span><span class="hljs-params">()</span> </span>{

        <span class="hljs-keyword">return</span> chatClient
                .<span class="hljs-built_in">prompt</span>(<span class="hljs-string">"帮我买北京到晋城的车票"</span>)
                .<span class="hljs-built_in">tools</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">TicketUtil</span>())
                .<span class="hljs-built_in">call</span>()
                .<span class="hljs-built_in">content</span>();

    }


}
</code></pre>

<pre><code class="hljs language-bash" lang="bash">大模型回复：
好的，用户让我帮忙买北京到晋城的车票。首先，我需要确认出发地和目的地是否正确。用户已经明确说明是北京到晋城，所以直接调用buyTicket函数，参数是<span class="hljs-built_in">source</span>:北京，target:晋城。没有其他参数需要处理，比如日期或座位类型，所以直接生成工具调用。然后，系统返回“Done”，说明操作成功。接下来，我应该告诉用户购票成功，并询问是否需要进一步帮助，比如确认车次或办理乘车证。这样既完成了购票，又提供了后续支持，确保用户满意。 您的北京至晋城车票已成功购买！请问是否需要帮您查询具体车次信息或办理乘车证相关手续呢？

控制台输出：
已购买北京到晋城的票
</code></pre>
<h3 data-id="heading-12">3.7 知识库和RAG</h3>
<p>RAG(Retrieval Augmented Generation)是检索增强生成，简单来讲通过提前检索一些知识，将这些知识和用户的问题一起给大模型，会提高大模型回复的质量</p>
<h4 data-id="heading-13">3.7.1 知识库</h4>
<p>对于通过分词的检索系统来讲，知识库一般是通过语义来检索的，要实现语义检索，需要对数据做向量化，所以需要向量模型和向量库</p>
<p>在这里我们用<code>SimpleVectorStore</code>来做向量库，这是一个内存库</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.ai.embedding.EmbeddingModel;
<span class="hljs-keyword">import</span> org.springframework.ai.vectorstore.SimpleVectorStore;
<span class="hljs-keyword">import</span> org.springframework.ai.vectorstore.VectorStore;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VectorStoreConfiguration</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> VectorStore vectorStore(EmbeddingModel embeddingModel) {
        <span class="hljs-keyword">return</span> SimpleVectorStore.builder(embeddingModel).build();
    }
}
</code></pre>
<p>使用<code>mxbai-embed-large</code>作为向量模型，这个模型也使用了ollama的功能，且在SpringAI中不需要额外的配置就可以使用，当然也可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-ai%2Freference%2Fapi%2Fembeddings%2Follama-embeddings.html" target="_blank" title="https://docs.spring.io/spring-ai/reference/api/embeddings/ollama-embeddings.html" ref="nofollow noopener noreferrer">参照文档</a>做一些定制配置，这里我们存了一些<a href="https://link.juejin.cn?target=https%3A%2F%2Fdouban.8610000.xyz%2Fq.json" target="_blank" title="https://douban.8610000.xyz/q.json" ref="nofollow noopener noreferrer">豆瓣的电影信息</a>到里面</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> jakarta.annotation.PostConstruct;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.advisor.MessageChatMemoryAdvisor;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.memory.ChatMemory;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.memory.MessageWindowChatMemory;
<span class="hljs-keyword">import</span> org.springframework.ai.document.Document;
<span class="hljs-keyword">import</span> org.springframework.ai.reader.JsonReader;
<span class="hljs-keyword">import</span> org.springframework.ai.vectorstore.VectorStore;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.core.io.FileSystemResource;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MovieService</span> {


    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;

    <span class="hljs-meta">@Autowired</span>
    VectorStore vectorStore;


    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">load</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sourceFile</span> <span class="hljs-operator">=</span> <span class="hljs-string">"/Users/songjiyang.3/Downloads/less_douban_movie.json"</span>;
        <span class="hljs-type">JsonReader</span> <span class="hljs-variable">jsonReader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JsonReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileSystemResource</span>(sourceFile),
                <span class="hljs-string">"title"</span>, <span class="hljs-string">"year"</span>, <span class="hljs-string">"id"</span>, <span class="hljs-string">"role_desc"</span>, <span class="hljs-string">"original_title"</span>);
        List&lt;Document&gt; documents = jsonReader.get();
        <span class="hljs-built_in">this</span>.vectorStore.add(documents);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MovieService</span><span class="hljs-params">(ChatClient.Builder chatClientBuilder)</span> {
        <span class="hljs-type">ChatMemory</span> <span class="hljs-variable">chatMemory</span> <span class="hljs-operator">=</span> MessageWindowChatMemory.builder().maxMessages(<span class="hljs-number">10</span>).build();

        <span class="hljs-built_in">this</span>.chatClient = chatClientBuilder
                .defaultAdvisors(MessageChatMemoryAdvisor.builder(chatMemory).build())
                .build();
    }

    <span class="hljs-keyword">public</span> List&lt;Document&gt; <span class="hljs-title function_">search</span><span class="hljs-params">(String query)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.vectorStore.similaritySearch(query);
    }



  
</code></pre>
<p>下面是从向量库的搜索结果，搜索2013会出现2013年的电影，搜喜剧也出来一些电影，但并不是十分准确，因为我们这只存了电影的标题和演员名称，如果加入一些剧情文本，可能会匹配出来</p>
<pre><code class="hljs language-swift" lang="swift">http:<span class="hljs-comment">//localhost:8080/search-movie?query=2013</span>

[{<span class="hljs-string">"id"</span>:<span class="hljs-string">"9eb7a024-e1aa-45ef-921b-f565b45b4fd0"</span>,<span class="hljs-string">"text"</span>:<span class="hljs-string">"title: 恐怖直播<span class="hljs-subst">\n</span>year: 2013<span class="hljs-subst">\n</span>id: 21360417<span class="hljs-subst">\n</span>role_desc: 金秉祐 / 河正宇 / 李璟荣 / 全慧珍<span class="hljs-subst">\n</span>original_title: 더 테러 라이브<span class="hljs-subst">\n</span>"</span>,<span class="hljs-string">"media"</span>:null,<span class="hljs-string">"metadata"</span>:{<span class="hljs-string">"distance"</span>:<span class="hljs-number">0.4173857673321675</span>},<span class="hljs-string">"score"</span>:<span class="hljs-number">0.5826142326678325</span>},{<span class="hljs-string">"id"</span>:<span class="hljs-string">"b6a81d8a-bc6f-4eb1-921a-6a130f12b3eb"</span>,<span class="hljs-string">"text"</span>:<span class="hljs-string">"title: 本命年<span class="hljs-subst">\n</span>year: 1990<span class="hljs-subst">\n</span>id: 1296266<span class="hljs-subst">\n</span>role_desc: 谢飞 / 蔡鸿翔 / 程琳 / 姜文<span class="hljs-subst">\n</span>original_title: <span class="hljs-subst">\n</span>"</span>,<span class="hljs-string">"media"</span>:null,<span class="hljs-string">"metadata"</span>:{<span class="hljs-string">"distance"</span>:<span class="hljs-number">0.41915724341448546</span>},<span class="hljs-string">"score"</span>:<span class="hljs-number">0.5808427565855145</span>},{<span class="hljs-string">"id"</span>:<span class="hljs-string">"c5a67630-92ce-40b7-97c8-1ff989add62a"</span>,<span class="hljs-string">"text"</span>:<span class="hljs-string">"title: 素媛<span class="hljs-subst">\n</span>year: 2013<span class="hljs-subst">\n</span>id: 21937452<span class="hljs-subst">\n</span>role_desc: 李濬益 / 薛景求 / 严志媛 / 李来<span class="hljs-subst">\n</span>original_title: 소원<span class="hljs-subst">\n</span>"</span>,<span class="hljs-string">"media"</span>:null,<span class="hljs-string">"metadata"</span>:{<span class="hljs-string">"distance"</span>:<span class="hljs-number">0.4254743519837735</span>},<span class="hljs-string">"score"</span>:<span class="hljs-number">0.5745256480162265</span>},{<span class="hljs-string">"id"</span>:<span class="hljs-string">"d4d735e2-ac91-47e4-b241-dc7d86a32c6a"</span>,<span class="hljs-string">"text"</span>:<span class="hljs-string">"title: 7号房的礼物<span class="hljs-subst">\n</span>year: 2013<span class="hljs-subst">\n</span>id: 10777687<span class="hljs-subst">\n</span>role_desc: 李焕庆 / 柳承龙 / 朴信惠 / 郑镇荣<span class="hljs-subst">\n</span>original_title: 7번방의 선물<span class="hljs-subst">\n</span>"</span>,<span class="hljs-string">"media"</span>:null,<span class="hljs-string">"metadata"</span>:{<span class="hljs-string">"distance"</span>:<span class="hljs-number">0.4299756041030963</span>},<span class="hljs-string">"score"</span>:<span class="hljs-number">0.5700243958969037</span>}]


http:<span class="hljs-comment">//localhost:8080/search-movie?query=喜剧</span>
[{<span class="hljs-string">"id"</span>:<span class="hljs-string">"b8243634-9582-478f-ad61-69668af77d4d"</span>,<span class="hljs-string">"text"</span>:<span class="hljs-string">"title: 熔炉<span class="hljs-subst">\n</span>year: 2011<span class="hljs-subst">\n</span>id: 5912992<span class="hljs-subst">\n</span>role_desc: 黄东赫 / 孔侑 / 郑有美 / 金贤秀<span class="hljs-subst">\n</span>original_title: 도가니<span class="hljs-subst">\n</span>"</span>,<span class="hljs-string">"media"</span>:null,<span class="hljs-string">"metadata"</span>:{<span class="hljs-string">"distance"</span>:<span class="hljs-number">0.4354497256890415</span>},<span class="hljs-string">"score"</span>:<span class="hljs-number">0.5645502743109585</span>},{<span class="hljs-string">"id"</span>:<span class="hljs-string">"3a9d6a51-f99a-45cd-b6b3-36d868474b40"</span>,<span class="hljs-string">"text"</span>:<span class="hljs-string">"title: 我能说<span class="hljs-subst">\n</span>year: 2017<span class="hljs-subst">\n</span>id: 27000061<span class="hljs-subst">\n</span>role_desc: 金炫锡 / 罗文姬 / 李帝勋 / 廉惠兰<span class="hljs-subst">\n</span>original_title: 아이 캔 스피크<span class="hljs-subst">\n</span>"</span>,<span class="hljs-string">"media"</span>:null,<span class="hljs-string">"metadata"</span>:{<span class="hljs-string">"distance"</span>:<span class="hljs-number">0.44649545952808223</span>},<span class="hljs-string">"score"</span>:<span class="hljs-number">0.5535045404719178</span>},{<span class="hljs-string">"id"</span>:<span class="hljs-string">"7b21368e-4a78-4561-aa9a-dc3287b66372"</span>,<span class="hljs-string">"text"</span>:<span class="hljs-string">"title: 可玛猫<span class="hljs-subst">\n</span>year: 2009<span class="hljs-subst">\n</span>id: 2310047<span class="hljs-subst">\n</span>role_desc: 合田经郎 / 合田经郎<span class="hljs-subst">\n</span>original_title: こま撮り映画・こまねこ<span class="hljs-subst">\n</span>"</span>,<span class="hljs-string">"media"</span>:null,<span class="hljs-string">"metadata"</span>:{<span class="hljs-string">"distance"</span>:<span class="hljs-number">0.44757831325045716</span>},<span class="hljs-string">"score"</span>:<span class="hljs-number">0.5524216867495428</span>},{<span class="hljs-string">"id"</span>:<span class="hljs-string">"14c92297-f014-4b9d-8613-cfcdf9b2578c"</span>,<span class="hljs-string">"text"</span>:<span class="hljs-string">"title: 红鳉鱼<span class="hljs-subst">\n</span>year: 2015<span class="hljs-subst">\n</span>id: 26266892<span class="hljs-subst">\n</span>role_desc: 高畑秀太 / 二宫和也 / 北野武 / 宫川大辅<span class="hljs-subst">\n</span>original_title: 赤めだか<span class="hljs-subst">\n</span>"</span>,<span class="hljs-string">"media"</span>:null,<span class="hljs-string">"metadata"</span>:{<span class="hljs-string">"distance"</span>:<span class="hljs-number">0.4475958034962455</span>},<span class="hljs-string">"score"</span>:<span class="hljs-number">0.5524041965037545</span>}]
</code></pre>
<h4 data-id="heading-14">3.7.2 RAG</h4>
<p>有了知识库之后，可以在此的基础上面，对大模型的问题做增强检索</p>
<pre><code class="hljs language-scss" lang="scss">    public String <span class="hljs-built_in">suggestKnow</span>(String query){
        return chatClient<span class="hljs-selector-class">.prompt</span>()
                <span class="hljs-selector-class">.system</span>("你是一个电影推荐专家，请根据用户输入的查询词和知识库信息，推荐一部电影。")
                <span class="hljs-selector-class">.advisors</span>(new QuestionAnswerAdvisor(vectorStore))
                <span class="hljs-selector-class">.user</span>(query)
                <span class="hljs-selector-class">.call</span>()
                <span class="hljs-selector-class">.content</span>();
    }

    public String <span class="hljs-built_in">suggest</span>(String query){
        return chatClient<span class="hljs-selector-class">.prompt</span>()
                <span class="hljs-selector-class">.system</span>("你是一个电影推荐专家，请根据用户输入的查询词，推荐一部电影。")
                <span class="hljs-selector-class">.user</span>(query)
                <span class="hljs-selector-class">.call</span>()
                <span class="hljs-selector-class">.content</span>();
    }
</code></pre>
<p>推荐结果，可以看到有无知识库的区别，但是因为在这，这个知识库的质量不高，所以整体来讲，无知识库反而推荐的更好</p>
<pre><code class="hljs language-bash" lang="bash">http://localhost:8080/suggest-movie?query=喜剧

好的，用户想要推荐一部喜剧电影。首先，我需要确定用户可能喜欢的喜剧类型，是轻松幽默的，还是带有讽刺或家庭元素的？不过用户只提到“喜剧”这个词，没有更多细节，所以我得选一部广受好评、适合大多数人的喜剧。 考虑到不同地区的观众，可能需要推荐一部国际知名的电影，比如美国或欧洲的。比如《疯狂的石头》是华语片，可能用户对中国电影感兴趣？或者选一部经典的老电影，比如《大话西游》？不过用户可能想要更现代的。 另外，用户可能希望电影有深度，不只是单纯的搞笑，比如《死亡诗社》虽然偏剧情，但也有幽默元素？或者像《伴我同行》这样的成长喜剧？不过用户明确要喜剧，可能更倾向于纯粹搞笑的。 再想想，像《疯狂动物城》这样的动画喜剧，适合各个年龄层，而且口碑不错。或者《触不可及》这样的法式喜剧，既有幽默又有温情。或者《人在囧途》这样的华语喜剧，比较贴近生活。 不过用户可能没有明确地区偏好，所以选一部国际认可的，比如《布达佩斯大饭店》虽然带点文艺，但也有喜剧元素。或者《银河护卫队》这样的超级英雄喜剧，比较受欢迎。 综合考虑，可能选一部广为人知、评价高的，比如《疯狂的石头》作为华语代表，或者《伴我同行》作为经典。不过用户可能想要更近期的，比如《人生遥控器》或者《疯狂动物城》。或者《大侦探福尔摩斯》虽然偏动作，但也有幽默。 再检查一下，用户可能需要一部适合推荐给朋友的，所以选一部口碑好、有笑点的，比如《人在囧途》或者《疯狂的石头》。或者《大话西游》作为经典，但可能用户已经看过。 最终决定推荐《疯狂的石头》，因为它是一部华语喜剧，剧情紧凑，有反转，适合喜欢黑色幽默的观众。同时也能展示中国电影的特色，可能用户对这方面感兴趣。或者再考虑其他选项，比如《让子弹飞》也是张艺谋的，但更偏剧情。可能还是《疯狂的石头》更合适。 根据您的需求，我推荐《疯狂的石头》（2006年，中国）。这部由徐峥自编自导自演的黑色幽默喜剧，以重庆火锅店为背景，通过多条故事线交织展开。影片将江湖恩怨、商战博弈与市井生活巧妙结合，既有荒诞的笑点，又暗含对人性的深刻剖析。其独特的叙事结构和对市井文化的刻画，使其成为华语喜剧中的经典之作。

http://localhost:8080/suggest-movie-know?query=喜剧
好的，用户现在要找喜剧类的电影推荐。我需要根据提供的知识库里的信息来推荐。首先，我要看一下知识库里的电影列表，看看哪些是喜剧类型。 知识库里的电影有四部：熔炉（2011）、我能说（2017）、可玛猫（2009）、红鳉鱼（2015）。不过，这些电影的描述里没有明确提到类型，只有角色和导演等信息。比如，熔炉可能是一部剧情片或者社会剧，因为它的原名是“道加尼”，可能涉及社会问题。我能说的描述里也没有类型信息，但根据名字可能涉及语言或沟通的主题，可能不是喜剧。可玛猫的原名是“こま撮り映画・こまねこ”，看起来像是关于猫的电影，可能带有幽默元素，但不确定是否是喜剧。红鳉鱼的原名是“赤めだか”，可能和鱼类有关，但类型不明确。 问题在于，用户要求推荐喜剧，但提供的知识库中没有明确说明任何电影属于喜剧类型。因此，根据现有的信息，无法确定这些电影是否符合喜剧的要求。这时候应该告诉用户，根据提供的资料，无法推荐喜剧电影，因为没有相关类型的信息。需要确认是否有其他信息或者是否需要进一步补充。 根据提供的资料，这些电影的描述中未明确提及喜剧类型，因此无法直接推荐符合喜剧分类的影片。建议提供更多关于电影类型的细节或补充信息以便更精准推荐。
</code></pre>
<h3 data-id="heading-15">3.8 MCP</h3>
<p>MCP(Model Context Protocol )是大模型应用和其他资源或者工具交互的一种标准协议，分为客户端和服务端</p>
<h4 data-id="heading-16">3.8.1 MCP服务端</h4>
<p>引入依赖，webmvc这种方式会暴露一个http路径，其他mcp客户端通过这个路径来这个服务端交互，还有其他方式来实现MCP服务，例如STDIO</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-mcp-server-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>在原先的买票工具上面，加一个ToolCallbackProvider，这个会把工具类暴露出来</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TicketUtil</span> {

    <span class="hljs-meta">@Tool</span>(description = <span class="hljs-string">"输入出发地和目的地，购买火车票"</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">buyTicket</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> source, <span class="hljs-built_in">String</span> target</span>) {

        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"已购买"</span> + source + <span class="hljs-string">"到"</span> + target + <span class="hljs-string">"的票"</span>);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ToolCallbackProvider</span> <span class="hljs-title function_">tools</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">MethodToolCallbackProvider</span>.<span class="hljs-title function_">builder</span>().<span class="hljs-title function_">toolObjects</span>(<span class="hljs-variable language_">this</span>).<span class="hljs-title function_">build</span>();
    }
}
</code></pre>
<p>增加配置</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.mcp.server.name</span>=webmvc-mcp-server
<span class="hljs-attr">spring.ai.mcp.server.version</span>=<span class="hljs-number">1.0</span>.<span class="hljs-number">0</span>
<span class="hljs-attr">spring.ai.mcp.server.type</span>=SYNC
<span class="hljs-attr">spring.ai.mcp.server.instructions</span>=This server provides weather information tools and resources
<span class="hljs-attr">spring.ai.mcp.server.sse-message-endpoint</span>=/mcp/messages
<span class="hljs-attr">spring.ai.mcp.server.capabilities.tool</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.ai.mcp.server.capabilities.resource</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.ai.mcp.server.capabilities.prompt</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.ai.mcp.server.capabilities.completion</span>=<span class="hljs-literal">true</span>
</code></pre>
<p>使用MCP客户端接入，这里使用了<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.cherry-ai.com%2F" target="_blank" title="https://docs.cherry-ai.com/" ref="nofollow noopener noreferrer">Cherry-Studio</a>，首先在里面配置MCP服务</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e7ca88c859b45b399623f900b5f088a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259426&amp;x-signature=hS3nr5FDvvAdsXDxFi8UbOzjPrs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ccd11394d7f48d4add23f112c7004b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259426&amp;x-signature=Gtp7lzaVDXL8p7yeft9ZyzaFYeE%3D" alt="" loading="lazy"/></p>
<p>然后在对话问答中勾选MCP服务并提问，可以看到MCP调用<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fdd76c6c166f48b5b7b9fa052360db52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259426&amp;x-signature=CA2q5Nk%2BxPeAxH6yE4tsPQH7PYM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-17">3.8.2 MCP客户端</h4>
<p>MCP的客户端可以是一个IDE，或者大模型对话客户端（例如上面的Cherry-Studio），当然，也可以是一个程序，SpringAI也支持实现MCP客户端</p>
<p>引入依赖</p>
<pre><code class="hljs language-xml" lang="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-mcp-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>SpirngBoot配置</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.ollama.chat.enabled</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.ai.model.chat</span>=ollama
<span class="hljs-attr">spring.ai.ollama.chat.options.model</span>=qwen3:<span class="hljs-number">8</span>b
<span class="hljs-attr">spring.ai.chat.observations.include-prompt</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">spring.ai.chat.observations.include-completion</span>=<span class="hljs-literal">true</span>
<span class="hljs-attr">management.tracing.sampling.probability</span>=<span class="hljs-number">1.0</span>
<span class="hljs-attr">spring.ai.mcp.client.sse.connections.server1.url</span>=http://localhost:<span class="hljs-number">8080</span>
<span class="hljs-attr">server.port</span>=<span class="hljs-number">8081</span>  //本地<span class="hljs-number">8080</span>被MCP服务端占用了
</code></pre>
<p>在模型调用中加入MCP服务，注释的代码是上面使用本地工具的例子，MCP可以理解为远程或者外部的工具，MCP服务端就是刚刚在上一节中我们自己实现的服务端，我们通过配置的<code>http://localhost:8080</code>找到了它，并了解了它有哪些工具，这些都是SpringAI帮我们做的</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.ai.mcp.SyncMcpToolCallbackProvider;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TicketService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SyncMcpToolCallbackProvider toolCallbackProvider;

    <span class="hljs-keyword">public</span> TicketService(ChatClient.Builder chatClientBuilder) {
        <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.build();
    }


    <span class="hljs-keyword">public</span> String buyTicketMCP() {

        <span class="hljs-keyword">return</span> chatClient
                .prompt(<span class="hljs-string">"帮我买北京到晋城的车票"</span>)
                .toolCallbacks(toolCallbackProvider)
                .call()
                .content();

    }
  
<span class="hljs-comment">//    public String buyTicket() {</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//        return chatClient</span>
<span class="hljs-comment">//                .prompt("帮我买北京到晋城的车票")</span>
<span class="hljs-comment">//                .tools(new TicketUtil())</span>
<span class="hljs-comment">//                .call()</span>
<span class="hljs-comment">//                .content();</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//    }</span>

}
</code></pre>
<p>使用和结果，可以看到大模型的思考过程中是使用了mcp服务的</p>
<pre><code class="hljs language-bash" lang="bash">http://localhost:8081/buy-ticket-mcp?query=买北京的晋城的票


好的，用户让我帮忙买北京到晋城的车票。首先，我需要确认用户的需求是否明确。用户提到的出发地是北京，目的地是晋城，这两个地点都是中国的城市，但需要确认是否有直达的火车线路，或者是否需要中转。不过，根据提供的工具函数，似乎只需要输入出发地和目的地即可，不需要考虑其他复杂因素。 接下来，我需要检查工具函数的参数。工具函数是spring_ai_mcp_client_server1_buyTicket，参数是arg0和arg1，都是字符串类型。根据描述，arg0应该是出发地，arg1是目的地。因此，正确的参数应该是arg0为“北京”，arg1为“晋城”。 不过，我需要确认用户是否已经提供了足够的信息。比如，是否有指定日期、座位类型或者车次偏好？但用户的问题中没有提到这些细节，所以可能只需要处理基本的出发地和目的地。如果用户后续有更多需求，可能需要进一步询问，但当前情况下，先按照提供的两个参数处理。 另外，要确保输入的格式正确，是否需要使用全称还是简称？比如，北京通常用“北京”表示，晋城也是全称。所以直接使用这两个城市名称作为参数应该是正确的。 最后，生成对应的工具调用，将参数填入函数中，返回正确的JSON结构。确保没有拼写错误，参数顺序正确，arg0是出发地，arg1是目的地。这样用户的需求就能被正确处理了。 车票购买请求已处理，北京至晋城的火车票已成功预订。请注意查收短信通知，确认车次和乘车时间。如有其他需求，请随时告知。
</code></pre>
<h3 data-id="heading-18">3.9 监控和指标</h3>
<p>通过对大模型应用的监控，可以有以下好处：</p>
<ol>
<li>方便调试、开发，了解大模型应用内部的执行流程</li>
<li>耗时分析</li>
<li>Token成本分析</li>
<li>模型评估的前提</li>
<li>方便排查问题</li>
</ol>
<p>这里我们主要用的是<a href="https://link.juejin.cn?target=https%3A%2F%2Flangfuse.com%2Fdocs%2Fobservability%2Foverview" target="_blank" title="https://langfuse.com/docs/observability/overview" ref="nofollow noopener noreferrer">LangFuse</a>，现在SpringAI已经可以很好的和LangFuse配合来监控大模型调用，但目前对于工具、MCP的调用还欠缺，需要自己来实现</p>
<p>下面是一个监控的示例，左边是一系列的请求，右边是某一个请求的详情，可以看到各个执行节点，各个节点入参和出参等</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73d4a022b054418db94c790c9d5427e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259426&amp;x-signature=veHVZsehpWLvQtEBG1vPXUNoRkg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-19">3.9.1 接入LangFuse</h4>
<p>接入的依赖和配置参考3.1</p>
<p>另外需要配置的一个URL和秘钥，URL是LangFuse的启动的地址，秘钥需要通过LangFuse管理界面生成，配置以下环境变量</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">OTEL_EXPORTER_OTLP_ENDPOINT</span>=http://localhost:<span class="hljs-number">3000</span>/api/public/otel<span class="hljs-comment">;OTEL_EXPORTER_OTLP_HEADERS=Authorization\=Basic cGstbGYtNGFhYjdhNWEtNThjYi00MWQ2LWIyODktY2M1MDgyMmNiMDliOnNrLWxmLWYxM2YzMmMzLTlkMzItNGE5My1iZmI0LTMxODFiOTE1Yzg2Yw\=\=</span>
</code></pre>
<p>详情见<a href="https://link.juejin.cn?target=https%3A%2F%2Flangfuse.com%2Fintegrations%2Fframeworks%2Fspring-ai" target="_blank" title="https://langfuse.com/integrations/frameworks/spring-ai" ref="nofollow noopener noreferrer">LangFuse文档</a></p>
<h3 data-id="heading-20">3.10 模型评估</h3>
<p>很多时候，在开发大模型应用的时候，我们需要不断调整提示词，知识库，工作流，工具，模型、模型参数等，这些内容的变更，都会影响最终大模型的回复质量，为了保证大模型的回复质量满足我们的需求，所以需要有模型评估这个环节</p>
<p>下面是模型评估的一个基本流程</p>
<ol>
<li>
<p>离线评估</p>
<ol>
<li>准备数据集，也就是用户的问题和期望的回复</li>
<li>运行数据集测试</li>
<li>评估生成的结果，可以人工/大模型/自定义的方式评估</li>
</ol>
</li>
<li>
<p>在线评估，在离线评估达到一个可以上线的水平之后</p>
<ol>
<li>线上收集用户问题和实际的回复</li>
<li>评估生成的结果，可以人工/大模型/自定义的方式评估，同时也可以结合用户的反馈</li>
<li>根据实际的评估数据，找到现有流程的问题，更新原有流程，同时填加新的测试集数据</li>
</ol>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e34a53de2679425a8abb7ba52986f047~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259426&amp;x-signature=lO4JdbFvHzwrDClAY0VlRTthVqs%3D" alt="" loading="lazy"/></p>
<p>LangFuse可以帮助我们实现上面的评估，详情可以<a href="https://link.juejin.cn?target=https%3A%2F%2Flangfuse.com%2Fdocs%2Fevaluation%2Foverview" target="_blank" title="https://langfuse.com/docs/evaluation/overview" ref="nofollow noopener noreferrer">参考文档</a></p>
<h3 data-id="heading-21">3.11 多模态调用</h3>
<p>更换ollama支持多模态的模型，这选用了llama3.2-vision:11b，支持图文</p>
<p>修改配置</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.ollama.chat.options.model</span>=llama3.<span class="hljs-number">2</span>-vision:<span class="hljs-number">11</span>b
</code></pre>
<p>多模态调用</p>
<pre><code class="hljs language-typescript" lang="typescript">    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">multiModality</span>(<span class="hljs-params"/>) {

        <span class="hljs-keyword">return</span> chatClient.<span class="hljs-title function_">prompt</span>()
                .<span class="hljs-title function_">system</span>(<span class="hljs-string">"结果必须用中文回复"</span>)
                .<span class="hljs-title function_">user</span>(u -&gt; u.<span class="hljs-title function_">text</span>(<span class="hljs-string">"解释图片的内容"</span>)
                        .<span class="hljs-title function_">media</span>(<span class="hljs-title class_">MimeTypeUtils</span>.<span class="hljs-property">IMAGE_PNG</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileSystemResource</span>(<span class="hljs-string">"/Users/songjiyang.3/Downloads/OIP-C.jpeg"</span>)))
                .<span class="hljs-title function_">call</span>()
                .<span class="hljs-title function_">content</span>();
    }
</code></pre>
<p>结果</p>
<pre><code class="hljs">该图片显示了一只猫的头部，猫的头部被一个白色毛毯包裹起来，猫的眼睛被毛毯的部分遮住了。
</code></pre>
<h3 data-id="heading-22">3.12 插件管理</h3>
<p>我们在有些开源的大模型工具中，会看到<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.coze.cn%2Fopen%2Fdocs%2Fguides%2Fplugin" target="_blank" title="https://www.coze.cn/open/docs/guides/plugin" ref="nofollow noopener noreferrer">插件</a>，插件是一个工具集，一个插件内可以包含一个或多个工具（API）</p>
<p>看起来只是把多个工具整合起来，但配置插件市场，可以让工具变的像手机APP一样，安装即可使用，大量现成的工具可以供我们使用（可能需要付费）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c467982842394a439bc2f5c9ceb897ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259426&amp;x-signature=T2JanJwGAMVlOXvgnJNhRr%2BkVMo%3D" alt="" loading="lazy"/></p>
<p>对于Saas服务这个非常好用，也算是一种开源</p>
<h2 data-id="heading-23">4. 总结</h2>
<p>本文介绍了使用SpringAI + Ollama + LangFuse 构建大模型应用，包括整体的架构，和使用SpringAI构建应用的各个细节，在实际项目中，每个部分都会更复杂</p>
<p>适用于企业级定制开发、复杂对话系统、RAG知识问答</p>
<h2 data-id="heading-24">5. 想法</h2>
<p>大模型技术的底层是算力，现在互联网应用能给用户免费使用的原因是因为服务器以极低的成本被大量用户共享使用，而大量用户带来的流量的收益是高于这些成本的，一旦服务器的成本变高，公司就是使用某些手段，例如限速，订阅的方式来平衡支出。</p>
<p>而大模型的使用依赖算力，问一个问题的成本大概可以估计出来，如下表，虽然看起来成本不高，但用户体量一旦起来，算力成本非常高，现在之所以很多是免费使用，一是因为现在还处于抢占市场阶段，二是因为用户的输入可以成本大模型的训练数据。</p>



































<table><thead><tr><th>厂商</th><th>免费政策</th><th>企业级API价格（输入/输出）</th><th>适用场景</th></tr></thead><tbody><tr><td>百度文心一言</td><td>全功能免费</td><td>0.004/0.016元/千tokens（4.5）</td><td>个人/企业全场景</td></tr><tr><td>阿里通义千问</td><td>新用户免费额度</td><td>0.0003/0.0006元/千tokens（Turbo）</td><td>性价比优先的企业应用</td></tr><tr><td>华为盘古</td><td>无免费额度</td><td>推理资源20元/小时起</td><td>工业级复杂任务</td></tr><tr><td>字节豆包</td><td>完全免费</td><td>未公开（当前免费）</td><td>个人学习、轻量开发</td></tr></tbody></table>
<p>基本上是不可能免费给用户使用，大胆猜测一下，后面算力会变为宽带，流量这样的基础设施，由用户自行购买使用来满足自己的需求</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[爆肝6周，手把手教你搭建一套生产级RAG论文研究助手]]></title>    <link>https://juejin.cn/post/7578803751609860146</link>    <guid>https://juejin.cn/post/7578803751609860146</guid>    <pubDate>2025-12-02T05:58:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578803751609860146" data-draft-id="7578781397118320686" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="爆肝6周，手把手教你搭建一套生产级RAG论文研究助手"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-02T05:58:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            爆肝6周，手把手教你搭建一套生产级RAG论文研究助手
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:58:07.000Z" title="Tue Dec 02 2025 05:58:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>在当今AI浪潮中，大模型（LLM）无疑是技术前沿的明星。然而，如何让大模型更好地理解我们的私有数据，并提供更准确、更可信的回答，RAG（检索增强生成）技术给出了一个绝佳的答案。但市面上关于RAG的教程，往往止步于理论或简单的原型，距离真正的“生产级”系统总有一段距离。</p>
<p>今天，我们要介绍的这个开源项目，正是为了解决这一痛点而来。它不是简单的代码堆砌，而是一个为期6周、<strong>以学习者为中心</strong>的<strong>生产级RAG系统实战教程</strong>——《The Mother of AI Project》的第一阶段：<strong>arXiv论文策展人 (arXiv Paper Curator)</strong> 。</p>
<p>这个项目将手把手带你构建一个完整的AI研究助手。它能自动抓取学术论文，深入理解其内容，并运用先进的RAG技术，精准回答你的研究疑问。更重要的是，它将教会你如何按照行业最佳实践，从零开始搭建一个<strong>生产级的RAG系统</strong>。</p>
<p>它与众不同之处在于：<strong>强调先打好关键词搜索的基础，再结合向量搜索进行混合检索</strong>。这正是许多成功企业构建搜索系统所遵循的专业路径——以扎实的搜索基础为核心，再辅以AI增强，而非一味追求AI优先而忽视了搜索的根本。</p>
<p>通过这个项目，你不仅能拥有一个强大的AI研究助手，更能掌握构建任何领域生产级RAG系统的深厚技术。</p>
<h3 data-id="heading-0">你将构建什么？</h3>
<p>这个项目以周为单位，循序渐进地构建一个复杂而强大的RAG系统：</p>
<ul>
<li><strong>第1周：</strong> 搭建Docker、FastAPI、PostgreSQL、OpenSearch和Airflow构成的完整基础设施。</li>
<li><strong>第2周：</strong> 实现自动获取和解析arXiv学术论文的数据管道。</li>
<li><strong>第3周：</strong> 学习生产级BM25关键词搜索，包括过滤和相关性评分。</li>
<li><strong>第4周：</strong> 掌握智能分块技术，并结合关键词与语义理解实现混合搜索。</li>
<li><strong>第5周：</strong> 构建完整的RAG管道，集成本地LLM、流式响应和Gradio界面。</li>
<li><strong>第6周：</strong> 实现生产级监控（Langfuse追踪）和Redis缓存，以优化性能。</li>
</ul>
<p>下面，让我们逐周深入，看看这6周的旅程将带你探索哪些精彩内容。</p>
<h3 data-id="heading-1">第1周：奠定基石——基础设施</h3>
<p>万丈高楼平地起，一个稳定的基础设施是任何生产级AI系统的基石。在第一周，你将学会如何利用Docker Compose，搭建起包括FastAPI、PostgreSQL、OpenSearch、Apache Airflow和Ollama（本地LLM服务）在内的核心服务。这将为你后续的所有开发提供坚实的环境支持。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61e88b522d7540678b723194e6376729~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259887&amp;x-signature=MDof1dnP%2FMOeUbmDGsuo4dt%2BW6A%3D" alt="" loading="lazy"/> 图1：第1周基础设施概览，涵盖API、数据库、搜索、工作流和本地LLM</p>
<p><strong>本周目标：</strong></p>
<ul>
<li>使用Docker Compose完成基础设施搭建。</li>
<li>FastAPI开发，实现自动文档和健康检查。</li>
<li>配置和管理PostgreSQL数据库。</li>
<li>设置OpenSearch混合搜索引擎。</li>
<li>配置Ollama本地LLM服务。</li>
<li>服务编排和健康监控。</li>
</ul>
<h3 data-id="heading-2">第2周：数据喂养——自动化论文摄取</h3>
<p>有了基础设施，RAG系统的“燃料”——数据就成了核心。第二周，你将构建一个自动化的数据摄取管道。它能从arXiv API批量抓取论文元数据和PDF文档，并利用Docling等工具进行科学PDF解析，提取结构化内容。通过Apache Airflow，整个过程将实现自动化调度，确保系统拥有源源不断且处理完善的最新学术资料。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f2fafb60f1e459d9cd4a0a78a2ee4e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259887&amp;x-signature=BdDKBwgC73dlCVPHF83u2VbT%2BGo%3D" alt="" loading="lazy"/></p>
<p>Week 2 Data Ingestion Architecture</p>
<p>图2：第2周数据摄取架构，展示了从arXiv到PostgreSQL的数据流</p>
<p><strong>本周目标：</strong></p>
<ul>
<li>集成arXiv API，实现限速和重试逻辑。</li>
<li>使用Docling解析科学PDF文档。</li>
<li>通过Apache Airflow构建自动化数据摄取管道。</li>
<li>提取和存储论文元数据。</li>
<li>实现从API到数据库的完整论文处理。</li>
</ul>
<h3 data-id="heading-3">第3周：搜索之本——关键词先行</h3>
<p>很多RAG系统一上来就直奔向量搜索，但这往往会忽略一个重要的基础：关键词搜索。本项目强调<strong>先打好BM25关键词搜索的扎实基础</strong>。因为在实际生产中，精确匹配、术语识别和效率，关键词搜索往往表现卓越。你将利用OpenSearch，实现高效的关键词检索、过滤和相关性评分，为后续的混合搜索打下坚实的基础。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2ae0354dc6449f98c2f9c53e4c09a4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259887&amp;x-signature=XK8icssYhPE0PbOkdko9csFEBqI%3D" alt="" loading="lazy"/></p>
<p>Week 3 OpenSearch Flow Architecture</p>
<p>图3：第3周OpenSearch集成流程架构，专注于关键词搜索</p>
<p><strong>本周目标：</strong></p>
<ul>
<li>理解关键词搜索对RAG系统的重要性。</li>
<li>掌握OpenSearch的索引管理、映射和搜索优化。</li>
<li>深入理解BM25算法背后的原理。</li>
<li>利用Query DSL构建复杂的搜索查询。</li>
<li>学习搜索相关性分析和性能测量。</li>
</ul>
<h3 data-id="heading-4">第4周：智能跃迁——分块与混合搜索</h3>
<p>在关键词搜索的基础之上，第四周将为系统增加语义理解能力。你将学习如何进行<strong>智能分块</strong>，将长文档切分成有意义的片段，并利用Jina AI等工具生成向量嵌入。随后，通过RRF（Reciprocal Rank Fusion）融合算法，将关键词搜索的精确性和向量搜索的语义召回能力相结合，实现<strong>混合搜索</strong>，让检索结果既精准又全面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71bc59e247a14e2998eb96bdf70c849a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259887&amp;x-signature=saMhbDGxOxVSoGlLMq6PfhCtQ64%3D" alt="" loading="lazy"/></p>
<p>Week 4 Hybrid Search Architecture</p>
<p>图4：第4周混合搜索架构，展示了分块、嵌入和RRF融合</p>
<p><strong>本周目标：</strong></p>
<ul>
<li>掌握基于章节的智能文档分块策略。</li>
<li>集成Jina AI等生产级嵌入服务。</li>
<li>通过RRF融合实现关键词与语义检索的混合搜索。</li>
<li>设计统一的API，支持多种搜索模式。</li>
<li>分析不同搜索方法的性能权衡。</li>
</ul>
<h3 data-id="heading-5">第5周：核心智能——完整的RAG管道</h3>
<p>至此，RAG系统的检索部分已趋于完善。第五周，我们将集成大模型，完成整个RAG管道的核心。你将把Ollama部署为本地LLM服务，确保数据隐私。通过精心的提示工程，系统响应速度将提升<strong>6倍</strong>（从120秒优化到15-20秒）。同时，实现<strong>流式响应（SSE）</strong> 提供实时用户反馈，并构建一个友好的<strong>Gradio交互式Web界面</strong>，让非技术用户也能轻松使用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ad13f3e556e4f31979af557e7df2ce7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259887&amp;x-signature=73OJFSBbhlXYHQYv9nHOHuECYes%3D" alt="" loading="lazy"/></p>
<p>Week 5 Complete RAG System Architecture</p>
<p>图5：第5周完整的RAG系统架构，包括LLM生成层和Gradio界面</p>
<p><strong>本周目标：</strong></p>
<ul>
<li>掌握本地LLM服务（Ollama）集成。</li>
<li>通过提示工程实现6倍性能优化和80%的Prompt压缩。</li>
<li>实现流式响应（Server-Sent Events）。</li>
<li>设计支持标准和流式查询的API。</li>
<li>构建带有高级参数控制的Gradio交互式界面。</li>
</ul>
<p><strong>性能飞跃：</strong></p>



































<table><thead><tr><th>指标</th><th>优化前</th><th>优化后 (第5周)</th><th>提升幅度</th></tr></thead><tbody><tr><td><strong>响应时间</strong></td><td>120+ 秒</td><td>15-20 秒</td><td><strong>快6倍</strong></td></tr><tr><td><strong>首次出字时间</strong></td><td>不适用</td><td>2-3 秒</td><td><strong>流式启用</strong></td></tr><tr><td><strong>Prompt效率</strong></td><td>~10KB</td><td>~2KB</td><td><strong>80%缩减</strong></td></tr><tr><td><strong>用户体验</strong></td><td>仅API</td><td>Web界面+流式</td><td><strong>生产就绪</strong></td></tr></tbody></table>
<h3 data-id="heading-6">第6周：生产就绪——监控与缓存</h3>
<p>一个功能完善的RAG系统还不足以称为“生产级”。在最后一周，你将为系统加上至关重要的可观测性和性能优化层。通过集成<strong>Langfuse</strong>进行端到端的RAG管道追踪，你可以清晰地看到每个请求从查询到回答的完整路径，分析性能瓶颈。同时，引入<strong>Redis缓存</strong>，针对重复查询可将响应速度从15-20秒提升到惊人的<strong>50毫秒</strong>，实现<strong>150-400倍</strong>的加速，并有效降低LLM调用成本达<strong>60%</strong> 。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83ea922dd9bd4183ae3ad7c799d61bcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259887&amp;x-signature=VPmQ2MSsNh%2B1ml7CPNFpx8XV8DI%3D" alt="" loading="lazy"/></p>
<p>Week 6 Monitoring &amp; Caching Architecture</p>
<p>图6：第6周监控与缓存架构，添加了Langfuse追踪和Redis缓存层</p>
<p><strong>本周目标：</strong></p>
<ul>
<li>集成Langfuse，实现端到端RAG管道追踪和性能分析。</li>
<li>制定Redis缓存策略，包括智能缓存键和TTL管理。</li>
<li>构建实时性能监控仪表盘，显示延迟、成本和缓存命中率。</li>
<li>掌握行业标准的观测和优化技术。</li>
<li>分析和优化LLM使用及基础设施成本。</li>
</ul>
<p><strong>性能与成本显著提升：</strong></p>









































<table><thead><tr><th>指标</th><th>优化前</th><th>优化后 (第6周)</th><th>提升幅度</th></tr></thead><tbody><tr><td><strong>平均响应时间</strong></td><td>15-20秒</td><td>3-5秒 (混合负载)</td><td><strong>快3-4倍</strong></td></tr><tr><td><strong>缓存命中响应</strong></td><td>不适用</td><td>50-100毫秒</td><td><strong>快150-400倍</strong></td></tr><tr><td><strong>LLM Token用量</strong></td><td>100%</td><td>40% (60%缓存)</td><td><strong>减少60%</strong></td></tr><tr><td><strong>日常成本</strong></td><td>$12</td><td>$4.50</td><td><strong>节省63%</strong></td></tr><tr><td><strong>系统可观测性</strong></td><td>无</td><td>完整追踪</td><td><strong>全面可见</strong></td></tr></tbody></table>
<h3 data-id="heading-7">快速开始</h3>
<p>这个项目非常适合那些想深入了解RAG系统、提升AI工程实践能力的开发者。所有内容都可以在本地运行，无需额外费用。</p>
<p><strong>先决条件：</strong></p>
<ul>
<li>Docker Desktop (含 Docker Compose)</li>
<li>Python 3.12+</li>
<li>UV Package Manager</li>
<li>8GB+ RAM 和 20GB+ 空闲磁盘空间</li>
</ul>
<p><strong>开始构建：</strong></p>
<ol>
<li>克隆项目仓库：</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">   git <span class="hljs-built_in">clone</span> &lt;repository-url&gt;  
<span class="hljs-built_in">cd</span> arxiv-paper-curator
</code></pre>
<p>2.  配置环境变量：</p>

<pre><code class="hljs">cpenv
</code></pre>

<pre><code class="hljs language-go" lang="go">（根据需要修改 <span class="hljs-string">`.env`</span> 文件，例如第<span class="hljs-number">4</span>周需要添加 <span class="hljs-string">`JINA_API_KEY`</span>）
</code></pre>
<p>3.    安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">uv <span class="hljs-built_in">sync</span>
</code></pre>
<p>4.  启动所有服务：</p>

<pre><code class="hljs language-css" lang="css">    docker compose up <span class="hljs-attr">--build</span> -d
</code></pre>
<p>5.  验证服务：</p>

<pre><code class="hljs language-bash" lang="bash">    curl http://localhost:8000/health
</code></pre>
<h3 data-id="heading-8">写在最后</h3>
<p>《The Mother of AI Project: arXiv Paper Curator》不仅仅是一个开源项目，更是一门系统而实用的AI工程课程。它将带领你亲历一个生产级RAG系统从无到有的全过程，从基础设施搭建到数据管道，从关键词搜索到混合检索，再到大模型集成、性能优化和生产监控。</p>
<p>如果你是一名AI/ML工程师、软件工程师或数据科学家，渴望将理论知识转化为解决实际问题的能力，那么这个项目绝对是你不容错过的实战宝典。它将帮你填补理论与实践之间的鸿沟，让你真正掌握构建现代AI应用所需的核心技能。</p>
<p>项目地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjamwithai%2Farxiv-paper-curator" target="_blank" title="https://github.com/jamwithai/arxiv-paper-curator" ref="nofollow noopener noreferrer">github.com/jamwithai/a…</a></p>
<h2 data-id="heading-9">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[unipush推送入门：10分钟搞定UniPush在线消息集成]]></title>    <link>https://juejin.cn/post/7578793960627453978</link>    <guid>https://juejin.cn/post/7578793960627453978</guid>    <pubDate>2025-12-02T05:46:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578793960627453978" data-draft-id="7578519990283485210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="unipush推送入门：10分钟搞定UniPush在线消息集成"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-02T05:46:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="扑棱蛾子"/> <meta itemprop="url" content="https://juejin.cn/user/2823201593493790"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            unipush推送入门：10分钟搞定UniPush在线消息集成
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2823201593493790/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    扑棱蛾子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:46:05.000Z" title="Tue Dec 02 2025 05:46:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">引言</h2>
<p>消息推送是提升 App 用户活跃度和留存率的关键能力。对于采用 UniApp 开发的跨端应用，DCloud 官方提供的 <strong>UniPush</strong> 服务无疑是集成推送功能最高效选择。</p>
<p>本文将以一名开发者的视角，手把手带你完成 <strong>从项目初始化到成功接收第一条推送消息</strong> 的完整流程。你将学会：</p>
<ol>
<li>UniPush 的<strong>正确接入姿势</strong>与核心配置</li>
<li>开发阶段必须使用的<strong>自定义调试基座</strong></li>
<li>如何获取设备标识（CID）并进行<strong>在线推送测试</strong></li>
<li>避开新手常见“坑点”的实用技巧</li>
</ol>
<blockquote>
<p>技术栈：UniApp + UniPush（华为、小米等厂商推送配置将在下篇介绍）</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">一、 开发环境与项目初始化</h2>
<h3 data-id="heading-2">1.1 项目创建与模块配置</h3>
<ol>
<li><strong>项目创建</strong>：在 HBuilderX 中新建一个 UniApp 项目（过程略）。</li>
<li><strong>启用 UniPush</strong>：打开项目根目录的 <code>manifest.json</code> 文件，进入  <strong>“App模块配置”</strong>  选项卡，勾选  <strong>“Push(消息推送)”</strong>  模块，并确保选中  <strong>“UniPush”</strong>  作为具体服务。<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/686640ac586246399a1a3fa5c3d0dcd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omR5qOx6Ju-5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259165&amp;x-signature=rpIT9JPEDnkrvYFn45S5tplbIYA%3D" alt="image.png" loading="lazy"/></li>
</ol>
<h3 data-id="heading-3">1.2 制作自定义调试基座</h3>
<p><strong>为什么必须使用自定义基座？</strong><br/>
UniApp 的标准运行基座（标准真机运行包）所使用的 DCloud 公有证书，其推送标识（CID）<strong>无法用于正式推送</strong>。只有使用你自己 App 的正式证书（或调试证书）打包的自定义基座，才能获得真实、有效的 CID。</p>
<p><strong>制作步骤：</strong></p>
<ol>
<li>
<p>在 HBuilderX 顶部菜单，选择 <strong>运行 -&gt; 运行到手机或模拟器 -&gt; 制作自定义调试基座</strong>。</p>
</li>
<li>
<p>在弹出的界面中，你需要为 Android 平台提供应用签名证书。</p>
<ul>
<li><strong>证书生成</strong>：可以使用在线工具如 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.yunedit.com%2Fcreatecert" target="_blank" title="https://www.yunedit.com/createcert" ref="nofollow noopener noreferrer">香蕉云编</a></strong> 快速生成调试证书（.keystore 文件），妥善保存密码及别名信息。</li>
<li><strong>证书填写</strong>：将生成的证书文件路径、密码、别名等信息，准确填入 HBuilderX 的对应输入框。</li>
</ul>
</li>
<li>
<p>点击  <strong>“打包”</strong> ，等待云端完成自定义基座的制作。</p>
</li>
</ol>
<p><strong>如何使用：</strong><br/>
制作完成后，运行项目时，务必在运行菜单中<strong>选择“自定义调试基座”</strong> ，而非“运行标准基座”。只有运行在自定义基座上，后续的推送测试才有效。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1424a23f2e74d1d9fa812f0fac914af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omR5qOx6Ju-5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259165&amp;x-signature=Hdxe6olyzOK3WiQobYVacdeBOXA%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-4">二、 UniPush 服务开通与配置</h2>
<p>推送能力依赖于 DCloud 的后台服务，因此需要在开发者中心完成配置。</p>
<ol>
<li>
<p><strong>进入开发者中心</strong>：访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.dcloud.net.cn%2F" target="_blank" title="https://dev.dcloud.net.cn/" ref="nofollow noopener noreferrer">DCloud 开发者中心</a>，在  <strong>“应用列表”</strong>  中找到你的项目。</p>
</li>
<li>
<p><strong>配置应用信息</strong>：</p>
<ul>
<li>如果未创建，请先为你的 App 创建一个应用。</li>
<li>进入应用详情，在  <strong>“各平台信息”</strong>  中配置 Android 平台信息。</li>
<li>这里需要填写的<strong>包名、应用签名</strong>，必须与上一步制作自定义基座时使用的证书信息<strong>完全一致</strong>。你可以在“香蕉云编”等工具生成证书的页面找到对应的 MD5 或 SHA1 签名。</li>
</ul>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b17f92d7b534f48b20dffccd850b159~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omR5qOx6Ju-5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259165&amp;x-signature=aKS3hxWFL8EwhU84osCtk%2FcKWvM%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">三、 核心代码实现与在线推送测试</h2>
<h3 data-id="heading-6">3.1 获取设备推送标识 (CID)</h3>
<p>CID 是 UniPush 服务识别每台设备的唯一 ID。在客户端，我们使用 <code>uni.getPushClientId</code> API 获取。</p>
<p><strong>关键注意事项（时序问题）：</strong><br/>
推送服务初始化需要时间，应用启动后立即调用此 API 可能返回空值。一个稳健的做法是延时获取或在监听事件中获取。</p>
<p><strong>推荐实现方案：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在 App.vue 的 onLaunch 中，或首个页面的 onLoad 中调用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initUniPush</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 方案1：延时获取（简单直接）</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    uni.<span class="hljs-title function_">getPushClientId</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> cid = res.<span class="hljs-property">cid</span>;
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'设备推送标识CID:'</span>, cid);
        <span class="hljs-comment">// 重要：将 CID 发送到你的业务服务器进行关联存储</span>
        <span class="hljs-comment">// uploadCidToServer(cid);</span>
        
        <span class="hljs-comment">// 可通过 Vuex 或全局事件更新 UI 状态</span>
        uni.$emit(<span class="hljs-string">'push-cid-ready'</span>, cid);
      },
      <span class="hljs-attr">fail</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取CID失败:'</span>, err);
        <span class="hljs-comment">// 处理失败逻辑，如重试</span>
      }
    });
  }, <span class="hljs-number">3000</span>); <span class="hljs-comment">// 延迟 3 秒，可根据实际情况调整</span>

  <span class="hljs-comment">// 方案2：监听事件（更精准）</span>
  <span class="hljs-comment">// uni.onPushMessage((res) =&gt; {...}); // 接收推送消息</span>
  <span class="hljs-comment">// 也可以在服务初始化成功的事件中获取CID</span>
}
</code></pre>
<h3 data-id="heading-7">3.2 发送你的第一条推送</h3>
<ol>
<li>
<p><strong>登录 DCloud 后台</strong>：进入你的应用，找到  <strong>“UniPush”</strong>  功能模块。</p>
</li>
<li>
<p><strong>创建推送</strong>：</p>
<ul>
<li>点击  <strong>“在线推送”</strong>  或  <strong>“推送消息”</strong> 。</li>
<li>推送方式选择  <strong>“单播（CID）”</strong> ，将上一步获取的 CID 填入。</li>
<li>填写推送标题、内容。<strong>内容应尽量模拟真实场景</strong>（如“欢迎使用”、“订单已发货”），避免使用“test”、“aaaa”等测试文本，以防被系统或厂商通道误判为骚扰信息而拦截。</li>
<li>点击发送。</li>
</ul>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/977b333379fa4f99a9da33d45f7912c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omR5qOx6Ju-5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259165&amp;x-signature=WFcGec9BArATZaa7GT9mEgqCUVw%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>
<p><strong>验证结果</strong>：</p>
<ul>
<li>发送后，在  <strong>“推送记录”</strong>  中可以查看状态。显示“已接收”即表示推送已成功抵达客户端。</li>
<li>确保你的 App 正处于<strong>前台运行</strong>或<strong>后台存活</strong>状态。此时，你应该能在设备上收到通知栏消息。</li>
</ul>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02c67c6b391e40018399cd3d60ee4633~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5omR5qOx6Ju-5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259165&amp;x-signature=tQyZ4VR1NabCgz6YJq6yaQj7r0g%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-8">四、 总结与注意事项</h2>
<p>至此，你已经完成了 UniPush 在线推送的核心流程。我们来总结一下关键点：</p>
<p>✅ <strong>正确流程</strong>：创建项目 → 启用模块 → <strong>制作自定义基座（关键！）</strong>  → 平台配置 → 获取CID → 后台推送。</p>
<p>⚠️ <strong>核心要点</strong>：</p>
<ol>
<li><strong>调试必须用自定义基座</strong>：这是获得有效 CID 的前提。</li>
<li><strong>CID 获取有时序</strong>：使用延时或监听事件确保获取成功。</li>
<li><strong>信息一致</strong>：开发者中心配置的包名、签名需与打包证书一致。</li>
<li><strong>推送内容需“真实”</strong> ：避免纯测试内容被过滤。</li>
<li><strong>在线推送的局限性</strong>：目前实现的是“在线推送”，即 App 进程存活（前台或后台）才能接收。要实现 App 完全关闭后仍能接收（离线推送），需要集成<strong>各大手机厂商的推送通道</strong>（华为、小米、OPPO、vivo 等）</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DeepSeek 最新开源！直接干到了数学奥赛金牌水平。]]></title>    <link>https://juejin.cn/post/7578803491822288923</link>    <guid>https://juejin.cn/post/7578803491822288923</guid>    <pubDate>2025-12-02T05:59:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578803491822288923" data-draft-id="7578803491821928475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DeepSeek 最新开源！直接干到了数学奥赛金牌水平。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-02T05:59:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DeepSeek 最新开源！直接干到了数学奥赛金牌水平。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T05:59:52.000Z" title="Tue Dec 02 2025 05:59:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>刚刚，DeepSeek 开源了最新的数学推理模型 <strong>DeepSeek-Math-V2</strong>。<br/>
最近国外 Gemini、Claude 神仙打架，小鲸鱼又活过来了。</p>
<p>这不仅仅是一次普通的模型迭代，根据在国际数学奥林匹克和普特南数学竞赛上的表现来看，这可能是开源模型在数学推理领域的一个里程碑时刻。</p>
<p>数学推理新王登基了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5f07382387a4b3f9e0ccad13e9a3857~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259992&amp;x-signature=Zev95xW4KXGwKxd%2FhBA%2B%2B8%2BLeYI%3D" alt="图片" loading="lazy"/></p>
<p>如果说上一代 DeepSeek-Math 让我们看到了开源模型在数学领域的潜力，那么这一次 V2 版本交出了一份令人咋舌的成绩单：<strong>IMO 2025 金牌水平</strong>。</p>
<p>让我们一起来深扒一下这个新发布的模型到底有多强。</p>
<h2 data-id="heading-0">01、项目简介</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdb74df8b5c242e9943675dbe58254f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259992&amp;x-signature=rWUlGGHPsZWnGqwgxUFyEj47i80%3D" alt="图片" loading="lazy"/></p>
<p>上面这个图就是 DeepSeek-Math-V2 甩出的成绩单。</p>
<p>🏆 IMO 2025（国际数学奥林匹克）：金牌水平</p>
<p>DeepSeek-Math-V2 展现了极强的定理证明能力，达到了金牌选手的得分线。</p>
<p>在 IMO-ProofBench 基准测试上，超越了 Google DeepMind 引以为傲的 <strong>DeepThink</strong> 模型，它曾也是金牌得主。</p>
<p>而且超越 <strong>DeepThink 不是一个点，而是 10 个点。紧跟在它们后面的是 GPT-5、Grok4 等模型。</strong></p>
<p><strong>🎓 Putnam 2024（普特南数学竞赛）：118/120 分</strong></p>
<p>这几乎是一个满分成绩！要知道 Putnam 是全美顶尖大学生参加的超高难度数学竞赛，能拿满分意味着它不仅会做题，还能处理极高难度的逻辑陷阱。</p>
<h2 data-id="heading-1">02、为什么提升这么多？</h2>
<p>为什么 DeepSeek-Math-V2 能取得如此巨大的突破？官方的技术文档透露了几个关键点，这不仅仅是堆参数的结果。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79d119127c7144168c6e99c59db3490a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259992&amp;x-signature=wvGDpoqavsfGcUyWhmv3P8D6%2Bgo%3D" alt="图片" loading="lazy"/></p>
<p>① 核心架构</p>
<p>这个模型是基于 DeepSeek 最新的 <strong>V3.2-Exp-Base</strong> 构建的。</p>
<p>它继承了 V3 系列强大的通用语言理解能力和 MoE（混合专家）架构的高效性。而且参数量达到了惊人的 <strong>685B</strong>（6850亿），这是一个真正的巨无霸模型。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d555cac4f64b43b48ed9abb017e6ec43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259992&amp;x-signature=2q9LEP%2F5V0GWHOdCr6a0Gt08NTk%3D" alt="图片" loading="lazy"/></p>
<p>② 验证者-生成器双核驱动</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f6a7ebe80084c5fad34ef5ea8b8e964~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765259992&amp;x-signature=a%2B7ioR%2BthGlwygnG%2BVTxATMloDM%3D" alt="图片" loading="lazy"/></p>
<p>这是本次 V2 最大的技术亮点。</p>
<p>传统的数学模型往往只是预测下一个 Token，追求最终答案正确。但数学推理的核心在于<strong>过程的严谨性</strong>。</p>
<p>DeepSeek-Math-V2 引入了自我验证（Self-Verification）机制：</p>
<ul>
<li><strong>Generator（生成器）</strong> ：负责提出解题思路和证明步骤。</li>
<li>Verifier（验证者）：像人类数学家一样，一步步审查推理过程的严谨性。</li>
</ul>
<p>这种机制解决了 AI 做数学题的一个顽疾：“答案对了，但过程全是胡扯”。</p>
<p>V2 版本不仅能给出答案，还能确保每一步推导都是逻辑闭环的。</p>
<p>③ Test-Time Compute Scaling</p>
<p>类似于 OpenAI 的 o1 系列思路，DeepSeek-Math-V2 支持在推理阶段通过增加计算量来换取更高的准确率。</p>
<p>它会在输出最终结果前，进行多轮的自我博弈和验证，直到找到最完美的证明路径。</p>
<h2 data-id="heading-2">03、开源地址</h2>
<p>这个模型 Apache 2.0 协议全开源，DeepSeek 这次依然保持了侠客风范，不藏着掖着。</p>
<pre><code class="hljs language-bash" lang="bash">HF地址：https://huggingface.co/deepseek-ai/DeepSeek-Math-V2开源地址：https://github.com/deepseek-ai/DeepSeek-Math-V2
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>