<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[echartsä¸­appendDataçš„è¯¦ç»†è®²è§£]]></title>    <link>https://juejin.cn/post/7584702863688957967</link>    <guid>https://juejin.cn/post/7584702863688957967</guid>    <pubDate>2025-12-18T01:09:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584702863688957967" data-draft-id="7584689488770547747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="echartsä¸­appendDataçš„è¯¦ç»†è®²è§£"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-18T01:09:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘çš„divä¸¢äº†è‚¿ä¹ˆåŠ"/> <meta itemprop="url" content="https://juejin.cn/user/1310273593440398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            echartsä¸­appendDataçš„è¯¦ç»†è®²è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1310273593440398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘çš„divä¸¢äº†è‚¿ä¹ˆåŠ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T01:09:00.000Z" title="Thu Dec 18 2025 01:09:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"ğŸ‹"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"ğŸ“"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"ğŸ‘"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"ğŸ‰"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"ğŸ’"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">appendData çš„è¯´æ˜</h4>
<p>appendData æ¥å£æä¾›äº†åˆ†ç‰‡åŠ è½½åï¼Œå¢é‡æ¸²æŸ“çš„èƒ½åŠ›ã€‚<br/>
appendDataåœ¨å¤§æ•°æ®é‡(å¦‚ï¼šç™¾ä¸‡ä»¥ä¸Š)çš„æ¸²æŸ“åœºæ™¯ï¼Œåˆ†ç‰‡åŠ è½½æ•°æ®å’Œå¢é‡æ¸²æŸ“ã€‚<br/>
åœ¨å¤§æ•°æ®é‡çš„åœºæ™¯ä¸‹ï¼ˆä¾‹å¦‚åœ°ç†æ•°çš„æ‰“ç‚¹ï¼‰ï¼Œå°±ç®—æ•°æ®ä½¿ç”¨äºŒè¿›åˆ¶æ ¼å¼ã€‚<br/>
ä¹Ÿä¼šæœ‰å‡ åæˆ–ä¸Šç™¾å…†ï¼Œåœ¨äº’è”ç½‘ç¯å¢ƒä¸‹ï¼Œå¾€å¾€éœ€è¦åˆ†ç‰‡åŠ è½½ã€‚</p>
<p>æ¸²æŸ“æ–°åŠ å…¥çš„æ•°æ®å—æ—¶ä¸ä¼šæ¸…é™¤åŸæœ‰å·²ç»æ¸²æŸ“çš„éƒ¨åˆ†ã€‚<br/>
ä¸Šé¢è¿™ä¸€æ®µè¯ï¼Œæ˜¯echartså®˜ç½‘ä¸­å¯¹appendDataçš„æè¿°ã€‚<br/>
æ–‡å­—åœ°å€è¯´æ˜ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fecharts.apache.org%2Fzh%2Fapi.html%23echartsInstance.appendData" target="_blank" title="https://echarts.apache.org/zh/api.html#echartsInstance.appendData" ref="nofollow noopener noreferrer">echarts.apache.org/zh/api.htmlâ€¦</a></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br/>
ç°åœ¨ä¸æ”¯æŒç³»åˆ—ï¼ˆseriesï¼‰ ä½¿ç”¨ dataset åŒæ—¶ä½¿ç”¨ appendDataã€‚<br/>
åªæ”¯æŒç³»åˆ—ä½¿ç”¨è‡ªå·±çš„ series.data æ—¶ä½¿ç”¨ appendDataã€‚</p>
<p>ç›®å‰å¹¶éæ‰€æœ‰çš„å›¾è¡¨éƒ½æ”¯æŒåˆ†ç‰‡åŠ è½½æ—¶çš„å¢é‡æ¸²æŸ“ã€‚ã€é‡è¦ã€‘<br/>
ç›®å‰æ”¯æŒçš„å›¾æœ‰ï¼šECharts åŸºç¡€ç‰ˆæœ¬çš„ æ•£ç‚¹å›¾ï¼ˆscatterï¼‰ å’Œ çº¿å›¾ï¼ˆlinesï¼‰ã€‚<br/>
ECharts GL çš„ æ•£ç‚¹å›¾ï¼ˆscatterGLï¼‰ã€çº¿å›¾ï¼ˆlinesGLï¼‰ å’Œ å¯è§†åŒ–å»ºç­‘ç¾¤ï¼ˆpolygons3Dï¼‰ã€‚<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83b57af0459a46b0925bb05843a1e448~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR55qEZGl25Lii5LqG6IK_5LmI5Yqe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624940&amp;x-signature=yyXNxJDH8BhjD8FFBeaS03oNPeg%3D" alt="image" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e9d768628184c06a454f4cf4ffa8e00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR55qEZGl25Lii5LqG6IK_5LmI5Yqe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624940&amp;x-signature=JY2nCVe8vLPteY1OH29uIYyBuwY%3D" alt="image" loading="lazy"/></p>
<h4 data-id="heading-1">appendData çš„è¯­æ³•</h4>
<pre><code class="hljs language-typescript" lang="typescript">chart.<span class="hljs-title function_">appendData</span>({
  seriesIndex?: <span class="hljs-built_in">number</span>, <span class="hljs-comment">// å¿…é¡»æ˜¯å·²å­˜åœ¨çš„ç³»åˆ—ç´¢å¼•ï¼Œè¯´æ˜ï¼šä¸èƒ½å¤Ÿæ·»åŠ æ–°çš„æŠ˜çº¿ã€‚</span>
  <span class="hljs-comment">// å¢åŠ çš„æ•°æ®ã€‚</span>
  data?: <span class="hljs-title class_">Array</span>|<span class="hljs-title class_">TypedArray</span> <span class="hljs-comment">// è¦è¿½åŠ çš„æ•°æ®ç‚¹</span>
})
</code></pre>
<h4 data-id="heading-2">é€šè¿‡ä¸Šé¢çš„è¯­æ³•è¯´æ˜ä¸€ä¸ªé—®é¢˜(appendDataÂ ä¸èƒ½æ–°å¢ä¸€æ¡çº¿)</h4>
<p>appendDataÂ æ–¹æ³•åªèƒ½ç”¨äºå‘å·²å­˜åœ¨çš„æ•°æ®ç³»åˆ—è¿½åŠ æ•°æ®ç‚¹ï¼Œè€Œä¸èƒ½æ·»åŠ æ–°çš„æ•°æ®ç³»åˆ—ï¼ˆå³æ–°çš„çº¿æ¡ï¼‰ã€‚<br/>
ä¹Ÿå°±æ˜¯è¯´ï¼šappendDataÂ ä¸èƒ½æ–°å¢ä¸€æ¡çº¿ã€‚<br/>
åŸå› ï¼šæ ¹æ®è¿™ä¸ªæ–¹æ³•çš„å‚æ•°å¯ä»¥æ¨æ–­é™¤ä¸èƒ½å¤Ÿæ–°å¢1æ¡æŠ˜çº¿ã€‚åŸå› å¦‚ä¸‹ï¼š<br/>
appendDataÂ æ–¹æ³•ç”¨äºå‘å›¾è¡¨ä¸­è¿½åŠ æ•°æ®ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œ<br/>
è¯¥å¯¹è±¡åŒ…å«Â seriesIndexÂ å’ŒÂ dataÂ ä¸¤ä¸ªå±æ€§ã€‚
seriesIndex: number, // å¿…é¡»æ˜¯å·²å­˜åœ¨çš„ç³»åˆ—ç´¢å¼•</p>
<h4 data-id="heading-3">appendData çš„ç‰¹åˆ«è¯´æ˜</h4>
<p>appendData æ–¹æ³•ä¸ä¼šè‡ªåŠ¨æ›´æ–°xè½´ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ›´æ–°xè½´çš„æ•°æ®ã€‚<br/>
æ‰€ä»¥ï¼šå¦‚æœæˆ‘ä»¬è¦ä½¿ç”¨ appendData è·Ÿæ–°æŠ˜çº¿å›¾,æŸ±çŠ¶å›¾çš„æ•°æ®ã€‚<br/>
å¿…é¡»è¦é…åˆï¼šsetOption æ¥è·Ÿæ–° xè½´ã€‚<br/>
çœ‹åˆ°è¿™é‡Œæ˜¯æ˜¯ä¸æ˜¯æ„Ÿè§‰åˆ°å¾ˆæ‰¯~~~~~<br/>
å…¶å®å¹¶ä¸æ‰¯ï¼ŒappendData å°±ä¸èƒ½ç”¨åœ¨ series ç³»åˆ—çš„å›¾è¡¨ä¸­ã€‚<br/>
ç½‘ä¸Šå…¶ä»–æ–‡ç« ä½¿ç”¨ appendData è·Ÿæ–°æŠ˜çº¿å›¾ï¼ŒæŸ±çŠ¶å›¾çš„ï¼Œä¸€å®šä¹Ÿä½¿ç”¨äº† setOption æ¥è·Ÿæ–° xè½´ã€‚<br/>
é‚£æˆ‘ä»¬æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘éƒ½ä½¿ç”¨äº† setOption æ¥æ›´æ–°Xè½´ï¼Œä¸ºå•¥è¿˜è¦å¤šä½¿ç”¨ appendData å‘¢?<br/>
å› æ­¤ï¼šappendDataä¸èƒ½ç”¨åœ¨æŠ˜çº¿å›¾ï¼ŒæŸ±çŠ¶å›¾ä¸­ã€‚</p>
<h4 data-id="heading-4">æŠ˜çº¿å›¾å•ç‹¬ä½¿ç”¨ appendData ä¼šå¼•å‘é”™è¯¯ Uncaught TypeError: Cannot read properties of undefined (reading '0')</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"startStream"</span>&gt;</span>å¼€å§‹è¿½åŠ æ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"chart"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 400px;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">'echarts'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'RealtimeLineChart'</span>,
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">myChart</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">xAxisData</span>: [<span class="hljs-string">"20:23:01"</span>, <span class="hljs-string">"20:23:02"</span>, <span class="hljs-string">"20:23:03"</span>, <span class="hljs-string">"20:23:04"</span>,<span class="hljs-string">"20:23:05"</span>],
      <span class="hljs-attr">seriesData</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>, <span class="hljs-number">40</span>, <span class="hljs-number">50</span>]
    };
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initChart</span>();
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// åˆå§‹åŒ–å›¾è¡¨</span>
    <span class="hljs-title function_">initChart</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'xAxisData'</span>,<span class="hljs-variable language_">this</span>.<span class="hljs-property">xAxisData</span>)
      <span class="hljs-comment">// ç¡®ä¿DOMå…ƒç´ å·²æ¸²æŸ“</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">myChart</span> = echarts.<span class="hljs-title function_">init</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">chart</span>);
        <span class="hljs-keyword">const</span> option = {
          <span class="hljs-attr">title</span>: {
            <span class="hljs-attr">text</span>: <span class="hljs-string">'å®æ—¶æ•°æ®ç›‘æ§'</span>,
            <span class="hljs-attr">left</span>: <span class="hljs-string">'center'</span>
          },
          <span class="hljs-attr">tooltip</span>: {
            <span class="hljs-attr">trigger</span>: <span class="hljs-string">'axis'</span>,
            <span class="hljs-attr">formatter</span>: <span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> {
              <span class="hljs-keyword">return</span> <span class="hljs-string">`æ—¶é—´: <span class="hljs-subst">${params[<span class="hljs-number">0</span>].name}</span>&lt;br/&gt;å€¼: <span class="hljs-subst">${params[<span class="hljs-number">0</span>].value}</span>`</span>;
            }
          },
          <span class="hljs-attr">xAxis</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'category'</span>,
            <span class="hljs-attr">boundaryGap</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-comment">// xAxisData è¡¨ç¤º Xè½´çš„æ•°æ®å€¼</span>
            <span class="hljs-attr">data</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">xAxisData</span>
          },
          <span class="hljs-attr">yAxis</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'value'</span>,
            <span class="hljs-attr">scale</span>: <span class="hljs-literal">true</span>
          },
          <span class="hljs-attr">series</span>: [{
            <span class="hljs-attr">name</span>: <span class="hljs-string">'æ•°æ®å€¼'</span>,
            <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>,
            <span class="hljs-attr">smooth</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">itemStyle</span>: {
              <span class="hljs-attr">color</span>: <span class="hljs-string">'#1890ff'</span>
            },
            <span class="hljs-attr">areaStyle</span>: {
              <span class="hljs-attr">color</span>: <span class="hljs-keyword">new</span> echarts.<span class="hljs-property">graphic</span>.<span class="hljs-title class_">LinearGradient</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, [
                { <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#1890ff'</span> },
                { <span class="hljs-attr">offset</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'rgba(24, 144, 255, 0.1)'</span> }
              ])
            },
            <span class="hljs-comment">// Yè½´å¯¹äºçš„æ•°æ®</span>
            <span class="hljs-attr">data</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">seriesData</span>
          }],
          <span class="hljs-attr">grid</span>: {
            <span class="hljs-attr">left</span>: <span class="hljs-string">'3%'</span>,
            <span class="hljs-attr">right</span>: <span class="hljs-string">'4%'</span>,
            <span class="hljs-attr">bottom</span>: <span class="hljs-string">'3%'</span>,
            <span class="hljs-attr">containLabel</span>: <span class="hljs-literal">true</span>
          }
        };
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">myChart</span>.<span class="hljs-title function_">setOption</span>(option);
    },
    <span class="hljs-comment">// å¯åŠ¨å®æ—¶æ•°æ®æµ</span>
    <span class="hljs-title function_">startStream</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">if</span>(!<span class="hljs-variable language_">this</span>.<span class="hljs-property">xAxisData</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"20:23:06"</span>)){
        <span class="hljs-comment">// å‘Xè½´æ·»åŠ æ•°æ®</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">xAxisData</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">"20:23:06"</span>)
        <span class="hljs-comment">// æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼šå‘Yè½´è¿½åŠ æ•°æ®</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">myChart</span>.<span class="hljs-title function_">appendData</span>({
          <span class="hljs-attr">seriesIndex</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attr">data</span>: [<span class="hljs-number">1000</span>]
        });
      }
    }
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9ccdbf53f394df78b983771112847c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR55qEZGl25Lii5LqG6IK_5LmI5Yqe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624940&amp;x-signature=b9cidmxG4NDm7f4OEzFl2%2BOLpBM%3D" alt="image" loading="lazy"/></p>
<h4 data-id="heading-5">appendData æ›´æ–°Yè½´æ•°æ®ï¼ŒsetOptionæ¥è·Ÿæ–°Xè½´</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">... å•ç‹¬ä½¿ç”¨ appendData ä¼šå¼•å‘é”™è¯¯ Uncaught TypeError: Cannot read properties of undefined (reading <span class="hljs-string">'0'</span>)...
... å…¶ä»–ä»£ç ä¸å˜ ...
  methods: {
    <span class="hljs-comment">// å¯åŠ¨å®æ—¶æ•°æ®æµ</span>
    startStream() {
      <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.xAxisData.includes(<span class="hljs-string">"20:23:06"</span>)){
        <span class="hljs-comment">// å‘Xè½´æ·»åŠ æ•°æ®</span>
        <span class="hljs-keyword">this</span>.xAxisData.push(<span class="hljs-string">"20:23:06"</span>)
        <span class="hljs-comment">// æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼šå‘Yè½´è¿½åŠ æ•°æ®ã€‚appendDataåªèƒ½è·Ÿæ–°Yè½´æ•°æ®ã€‚</span>
        <span class="hljs-keyword">this</span>.myChart.appendData({
          seriesIndex: <span class="hljs-number">0</span>,
          <span class="hljs-keyword">data</span>: [<span class="hljs-number">1000</span>]
        });

        <span class="hljs-comment">// æ›´æ–°Xè½´æ•°æ®</span>
        <span class="hljs-keyword">this</span>.myChart.setOption({
          xAxis: {
            <span class="hljs-keyword">data</span>: <span class="hljs-keyword">this</span>.xAxisData
          }
        });
      }
    }
  }
&lt;/script&gt;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29cf7cb22f6e4f3f8e3f5aaf4550164a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR55qEZGl25Lii5LqG6IK_5LmI5Yqe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624940&amp;x-signature=3F3ay%2BG%2Fr%2Bn1%2FxuYkRJH2fhLXvo%3D" alt="image" loading="lazy"/></p>
<h4 data-id="heading-6">[xè½´çš„æ•°ï¼Œyè½´æ•°æ®]è¿™æ ·å½¢å¼çš„æ•°æ®appendDataå¯ä»¥æ›´æ–°å˜›?</h4>
<p>æœ‰æœºæ™ºçš„å°ä¼™ä¼´ä¼šè¯´ï¼šappendData æ–¹æ³•ä¸ä¼šè‡ªåŠ¨æ›´æ–°xè½´ã€‚<br/>
é‚£ä¹ˆå¦‚æœæˆ‘ä»¬çš„æ•°æ®æ˜¯ä¸‹é¢è¿™ç§å½¢å¼ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">seriesData:  [ </span>
  [ <span class="hljs-string">"2023-12-04 09:50:07"</span>, <span class="hljs-string">"0.137"</span>],
  ................................,
  [ <span class="hljs-string">"2023-12-04 10:50:07"</span>, <span class="hljs-string">"0.143"</span>],
  ]
</code></pre>
<p>æ˜¯ä¸æ˜¯å°±å¯ä»¥ä½¿ç”¨appendData è·Ÿæ–°æŠ˜çº¿å›¾çš„æ•°æ®äº†ï¼Ÿ
ç­”æ¡ˆæ˜¯ï¼šä¸å¯ä»¥ã€‚ä¸‹é¢æˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸‹</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"startStream"</span>&gt;</span>å¼€å§‹è¿½åŠ æ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"chart"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 400px;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">'echarts'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'RealtimeLineChart'</span>,
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">myChart</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">seriesData</span>:  [ 
        [ <span class="hljs-string">"2023-12-04 09:50:07"</span>, <span class="hljs-string">"0.137"</span>],
        [ <span class="hljs-string">"2023-12-04 09:55:07"</span>, <span class="hljs-string">"0.147"</span>],
        [ <span class="hljs-string">"2023-12-04 10:00:07"</span>, <span class="hljs-string">"0.137"</span>],
        [ <span class="hljs-string">"2023-12-04 10:05:07"</span>, <span class="hljs-string">"0.163"</span>],
        [ <span class="hljs-string">"2023-12-04 10:10:07"</span>, <span class="hljs-string">"0.150"</span>], 
        [ <span class="hljs-string">"2023-12-04 10:15:07"</span>, <span class="hljs-string">"0.143"</span>], 
        [ <span class="hljs-string">"2023-12-04 10:20:07"</span>, <span class="hljs-string">"0.133"</span>],
        [ <span class="hljs-string">"2023-12-04 10:25:07"</span>, <span class="hljs-string">"0.147"</span>], 
        [ <span class="hljs-string">"2023-12-04 10:30:07"</span>, <span class="hljs-string">"0.147"</span>],
        [ <span class="hljs-string">"2023-12-04 10:35:07"</span>, <span class="hljs-string">"0.143"</span>],
        [ <span class="hljs-string">"2023-12-04 10:40:07"</span>, <span class="hljs-string">"0.140"</span>], 
        [ <span class="hljs-string">"2023-12-04 10:45:07"</span>, <span class="hljs-string">"0.150"</span>], 
        [ <span class="hljs-string">"2023-12-04 10:50:07"</span>, <span class="hljs-string">"0.143"</span>],
      ]
    };
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initChart</span>();
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// åˆå§‹åŒ–å›¾è¡¨</span>
    <span class="hljs-title function_">initChart</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// ç¡®ä¿DOMå…ƒç´ å·²æ¸²æŸ“</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">myChart</span> = echarts.<span class="hljs-title function_">init</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">chart</span>);
      <span class="hljs-keyword">const</span> option = {
        <span class="hljs-attr">title</span>: {
          <span class="hljs-attr">text</span>: <span class="hljs-string">'å®æ—¶æ•°æ®ç›‘æ§'</span>,
          <span class="hljs-attr">left</span>: <span class="hljs-string">'center'</span>
        },
        <span class="hljs-attr">tooltip</span>: {
          <span class="hljs-attr">trigger</span>: <span class="hljs-string">'axis'</span>,
        },
        <span class="hljs-attr">xAxis</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'category'</span>,
          <span class="hljs-attr">boundaryGap</span>: <span class="hljs-literal">false</span>,
        },
        <span class="hljs-attr">yAxis</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'value'</span>,
          <span class="hljs-attr">scale</span>: <span class="hljs-literal">true</span>
        },
        <span class="hljs-attr">series</span>: [{
          <span class="hljs-attr">name</span>: <span class="hljs-string">'æ•°æ®å€¼'</span>,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>,
          <span class="hljs-attr">smooth</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">itemStyle</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-string">'#1890ff'</span>
          },
          <span class="hljs-attr">areaStyle</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-keyword">new</span> echarts.<span class="hljs-property">graphic</span>.<span class="hljs-title class_">LinearGradient</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, [
              { <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#1890ff'</span> },
              { <span class="hljs-attr">offset</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'rgba(24, 144, 255, 0.1)'</span> }
            ])
          },
          <span class="hljs-comment">// Yè½´å¯¹äºçš„æ•°æ®</span>
          <span class="hljs-attr">data</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">seriesData</span>
        }],
        <span class="hljs-attr">grid</span>: {
          <span class="hljs-attr">left</span>: <span class="hljs-string">'3%'</span>,
          <span class="hljs-attr">right</span>: <span class="hljs-string">'4%'</span>,
          <span class="hljs-attr">bottom</span>: <span class="hljs-string">'3%'</span>,
          <span class="hljs-attr">containLabel</span>: <span class="hljs-literal">true</span>
        }
      };
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">myChart</span>.<span class="hljs-title function_">setOption</span>(option);
    },
    <span class="hljs-comment">// å¯åŠ¨å®æ—¶æ•°æ®æµ,ä½¿ç”¨appendDataæ›´æ–°æ•°æ®ä¼šæŠ¥é”™çš„å“ˆ</span>
    <span class="hljs-title function_">startStream</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">myChart</span>.<span class="hljs-title function_">appendData</span>({
        <span class="hljs-attr">seriesIndex</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">data</span>: [<span class="hljs-string">"2023-12-04 10:55:07"</span>, <span class="hljs-string">"14.3"</span>]
      });
    },
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65a40697144246829fcb52dbe254f459~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR55qEZGl25Lii5LqG6IK_5LmI5Yqe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624940&amp;x-signature=6PKGV1AinD0KyCu%2B4O7phFCYkJU%3D" alt="image" loading="lazy"/></p>
<h4 data-id="heading-7">æŠ˜çº¿å›¾è¿½åŠ æ•°æ®ä½¿ç”¨ setOption</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"startStream"</span>&gt;</span>å¼€å§‹è¿½åŠ æ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"chart"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100%; height: 400px;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">'echarts'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'RealtimeLineChart'</span>,
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">myChart</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">seriesData</span>:  [ 
        [ <span class="hljs-string">"2023-12-04 09:50:07"</span>, <span class="hljs-string">"0.137"</span>],
        [ <span class="hljs-string">"2023-12-04 09:55:07"</span>, <span class="hljs-string">"0.147"</span>],
        [ <span class="hljs-string">"2023-12-04 10:00:07"</span>, <span class="hljs-string">"0.137"</span>],
        [ <span class="hljs-string">"2023-12-04 10:05:07"</span>, <span class="hljs-string">"0.163"</span>],
        [ <span class="hljs-string">"2023-12-04 10:10:07"</span>, <span class="hljs-string">"0.150"</span>], 
        [ <span class="hljs-string">"2023-12-04 10:15:07"</span>, <span class="hljs-string">"0.143"</span>], 
        [ <span class="hljs-string">"2023-12-04 10:20:07"</span>, <span class="hljs-string">"0.133"</span>],
        [ <span class="hljs-string">"2023-12-04 10:25:07"</span>, <span class="hljs-string">"0.147"</span>], 
        [ <span class="hljs-string">"2023-12-04 10:30:07"</span>, <span class="hljs-string">"0.147"</span>],
        [ <span class="hljs-string">"2023-12-04 10:35:07"</span>, <span class="hljs-string">"0.143"</span>],
        [ <span class="hljs-string">"2023-12-04 10:40:07"</span>, <span class="hljs-string">"0.140"</span>], 
        [ <span class="hljs-string">"2023-12-04 10:45:07"</span>, <span class="hljs-string">"0.150"</span>], 
        [ <span class="hljs-string">"2023-12-04 10:50:07"</span>, <span class="hljs-string">"0.143"</span>],
      ]
    };
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initChart</span>();
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// åˆå§‹åŒ–å›¾è¡¨</span>
    <span class="hljs-title function_">initChart</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// ç¡®ä¿DOMå…ƒç´ å·²æ¸²æŸ“</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">myChart</span> = echarts.<span class="hljs-title function_">init</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">chart</span>);
      <span class="hljs-keyword">const</span> option = {
        <span class="hljs-attr">title</span>: {
          <span class="hljs-attr">text</span>: <span class="hljs-string">'å®æ—¶æ•°æ®ç›‘æ§'</span>,
          <span class="hljs-attr">left</span>: <span class="hljs-string">'center'</span>
        },
        <span class="hljs-attr">tooltip</span>: {
          <span class="hljs-attr">trigger</span>: <span class="hljs-string">'axis'</span>,
        },
        <span class="hljs-attr">xAxis</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'category'</span>,
          <span class="hljs-attr">boundaryGap</span>: <span class="hljs-literal">false</span>,
        },
        <span class="hljs-attr">yAxis</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'value'</span>,
          <span class="hljs-attr">scale</span>: <span class="hljs-literal">true</span>
        },
        <span class="hljs-attr">series</span>: [{
          <span class="hljs-attr">name</span>: <span class="hljs-string">'æ•°æ®å€¼'</span>,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'line'</span>,
          <span class="hljs-attr">smooth</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">itemStyle</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-string">'#1890ff'</span>
          },
          <span class="hljs-attr">areaStyle</span>: {
            <span class="hljs-attr">color</span>: <span class="hljs-keyword">new</span> echarts.<span class="hljs-property">graphic</span>.<span class="hljs-title class_">LinearGradient</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, [
              { <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#1890ff'</span> },
              { <span class="hljs-attr">offset</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'rgba(24, 144, 255, 0.1)'</span> }
            ])
          },
          <span class="hljs-comment">// Yè½´å¯¹äºçš„æ•°æ®</span>
          <span class="hljs-attr">data</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">seriesData</span>
        }],
        <span class="hljs-attr">grid</span>: {
          <span class="hljs-attr">left</span>: <span class="hljs-string">'3%'</span>,
          <span class="hljs-attr">right</span>: <span class="hljs-string">'4%'</span>,
          <span class="hljs-attr">bottom</span>: <span class="hljs-string">'3%'</span>,
          <span class="hljs-attr">containLabel</span>: <span class="hljs-literal">true</span>
        }
      };
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">myChart</span>.<span class="hljs-title function_">setOption</span>(option);
    },
    <span class="hljs-comment">// å¯åŠ¨å®æ—¶æ•°æ®æµ,ä½¿ç”¨ setOption æ›´æ–°æ•°æ®</span>
    <span class="hljs-title function_">startStream</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">seriesData</span>.<span class="hljs-title function_">push</span>([<span class="hljs-string">"2023-12-04 10:55:07"</span>, <span class="hljs-string">"0.19"</span>]);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">myChart</span>.<span class="hljs-title function_">setOption</span>({
        <span class="hljs-attr">series</span>:[{
          <span class="hljs-attr">data</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">seriesData</span>
        }]
      });
    },
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19d9531b145f4b988a683649754913cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR55qEZGl25Lii5LqG6IK_5LmI5Yqe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624940&amp;x-signature=x4gt0Pnz4P19yK5Cy4cOEGbfwA8%3D" alt="image" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vben Adminç®¡ç†ç³»ç»Ÿé›†æˆqiankunå¾®æœåŠ¡]]></title>    <link>https://juejin.cn/post/7584719268043391010</link>    <guid>https://juejin.cn/post/7584719268043391010</guid>    <pubDate>2025-12-18T01:41:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584719268043391010" data-draft-id="7584408254819254307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vben Adminç®¡ç†ç³»ç»Ÿé›†æˆqiankunå¾®æœåŠ¡"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2025-12-18T01:41:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="go_caipu"/> <meta itemprop="url" content="https://juejin.cn/user/4353721778049864"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vben Adminç®¡ç†ç³»ç»Ÿé›†æˆqiankunå¾®æœåŠ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721778049864/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    go_caipu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T01:41:33.000Z" title="Thu Dec 18 2025 01:41:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fa66c7e104947cba2a6199d9ff4d068~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29fY2FpcHU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766626892&amp;x-signature=H7H4FwL2VxW5ukRIPjeV6gjJ9z8%3D" alt="image.png" loading="lazy"/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdoc.vben.pro%2F" target="_blank" title="https://doc.vben.pro/" ref="nofollow noopener noreferrer">Vben Admin</a>æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ä¼ä¸šçº§ç®¡ç†ç³»ç»Ÿæ¡†æ¶ï¼Œæˆ‘ä»¬æ­£åœ¨è¿›è¡Œä¸šåŠ¡é€‚é…ï¼Œè®¡åˆ’æŠŠå„ä¸šåŠ¡åŠŸèƒ½é€šè¿‡å‰ç«¯å¾®æœåŠ¡æ–¹å¼é›†æˆåˆ°ä¸»ç³»ç»Ÿé‡Œï¼Œç½‘ä¸Šæ²¡æœ‰æ‰¾åˆ°å¯å‚è€ƒçš„æ¡ˆä¾‹ï¼Œæ‰€ä»¥è‡ªè¡Œå°è¯•å®ç°åˆæ­¥demoï¼Œä¸­é—´é‡åˆ°è¾ƒå¤šçš„é—®é¢˜è®°å½•ä¸‹é›†æˆè¿‡ç¨‹ï¼Œä»¥å¤‡åç»­å‚è€ƒä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-1">ç¯å¢ƒå‡†å¤‡</h3>
<p>ä¸ºäº†å¿«é€ŸéªŒè¯æˆ‘ä»¬ä»å®˜ç½‘åœ°å€æ‹‰å–ä¸€ä¸ªå…¨æ–°çš„é¡¹ç›®è¿›è¡Œæ“ä½œï¼Œå‡å°‘ä¸­é—´å…¶ä»–å½±å“çš„å› ç´ ã€‚</p>
<h4 data-id="heading-2">è·å–æºç å¹¶è¿è¡Œä¸»åº”ç”¨web-antd</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># clone ä»£ç </span>
git clone https://github.com/vbenjs/vue-vben-admin.git

<span class="hljs-section"># å®‰è£…ä¾èµ–</span>
pnpm i 
<span class="hljs-section"># æµ‹è¯•å¯åŠ¨ä¸€ä¸ªåº”ç”¨</span>
pnpm dev:antd
å‡ºç°å¦‚ä¸‹ï¼Œè¡¨æ˜å¯åŠ¨æˆåŠŸ
<span class="hljs-strong">**VITE**</span> v7.2.2Â  ready in <span class="hljs-strong">**3291**</span> ms
Â  âœÂ  <span class="hljs-strong">**Local**</span>: Â  http://localhost:<span class="hljs-strong">**5666**</span>/Â  Â  Â  Â   17:46:35
Â  âœÂ  <span class="hljs-strong">**Network**</span>: http://192.168.70.22:<span class="hljs-strong">**5666**</span>/Â Â  17:46:35
Â  âœÂ  <span class="hljs-strong">**Vben Admin Docs**</span>: https://doc.vben.proÂ  Â   Â  17:46:35
Â  âœÂ  <span class="hljs-strong">**Nitro Mock Server**</span>: http://localhost:5320/api 17:46:35
Â  âœÂ  press <span class="hljs-strong">**h + enter**</span> to show help Â  Â  Â  Â  Â  Â  Â  Â  
âœ” <span class="hljs-strong">**Nitro Mock Server started.**</span>
</code></pre>
<p>ç°åœ¨å·²ç»èƒ½æ­£å¸¸è¿è¡Œç¨‹åºã€‚</p>
<h4 data-id="heading-3">å¯åŠ¨å­åº”ç”¨</h4>
<p>æ¡†æ¶åœ¨appsç›®å½•æä¾›å‡ ä¸ªä¸åŒç»„ä»¶é¡¹ç›®ï¼Œæˆ‘ä»¬è¿™æ¬¡é€‰æ‹©web-antdä½œä¸ºä¸»åº”ç”¨ï¼Œå°†web-antdå¤åˆ¶ä¸€ä¸ªæ–‡ä»¶å¤¹web-antd-childä½œä¸ºå­åº”ç”¨çš„æ–¹å¼è¿›è¡Œé›†æˆï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> apps
<span class="hljs-comment"># æ‹·è´ç”Ÿæˆå­åº”ç”¨æ–‡ä»¶å¤¹ web-antd-child</span>
<span class="hljs-built_in">cp</span> -r web-antd web-antd-child
<span class="hljs-built_in">cd</span> web-antd-child
<span class="hljs-comment"># å®‰è£…å­åº”ç”¨ä¾èµ–</span>
pnpm i
<span class="hljs-comment"># å¯åŠ¨</span>
pnpm dev
</code></pre>
<h3 data-id="heading-4">ä¸»æ¡†æ¶é›†æˆ</h3>
<h4 data-id="heading-5">æ·»åŠ qiankunæ–‡ä»¶</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è½¬åˆ°ä¸»æ¡†æ¶ç›®å½•</span>
cd apps/web_antd
<span class="hljs-meta prompt_"># </span><span class="bash">å®‰è£…qiankun</span> 
pnpm i qiankun
</code></pre>
<p>åœ¨web-antdç›®å½•çš„srcç›®å½•æ·»åŠ qiankunç›®å½•ï¼Œå¹¶æ–°å»ºæ–‡ä»¶index.ts å’Œconfig.ts</p>
<pre><code class="hljs language-shell" lang="shell">cd src
<span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment">#æ·»åŠ qiankunæ–‡ä»¶å¤¹</span></span>
mkdir qiankun&amp;&amp;cd qiankun
<span class="hljs-meta prompt_">#</span><span class="bash"><span class="hljs-comment"># å¯¼å…¥æ–‡ä»¶</span></span>
touch index.ts config.ts
</code></pre>
<p>config.tsæ–‡ä»¶å†…å®¹å¦‚ä¸‹,å¤§æ¦‚æ„æ€å°±æ˜¯åŠ è½½å­åº”ç”¨å°†æ–‡ä»¶å†…å®¹æ³¨å…¥åˆ°#sub-containerå®¹å™¨ä¸­ï¼Œå®¹å™¨å®šä¹‰åé¢ä¼šåŠ ï¼Œè·¯ç”±æ‹¦æˆªè§„åˆ™æ˜¯/app/basicï¼Œpropså®šä¹‰çš„æ˜¯ä¸»åº”ç”¨æ•°æ®ä¼ ç»™å­åº”ç”¨ï¼Œä¿è¯ä¸»åº”ç”¨ç™»å½•åå­åº”ç”¨å¯ä»¥å…±äº«ä¸»åº”ç”¨æ•°æ®ã€‚</p>
<pre><code class="hljs language-ruby" lang="ruby">/**  æœ¬åœ°åº”ç”¨æµ‹è¯•å¾®æœåŠ¡æ¶æ„ *<span class="hljs-regexp">/
export default {
  subApps: [
    {
      name: 'basic', /</span><span class="hljs-regexp">/ å­åº”ç”¨åç§°ï¼Œè·Ÿpackage.jsonä¸€è‡´
      /</span><span class="hljs-regexp">/ entry: import.meta.env.VITE_API_BASE_URL, /</span><span class="hljs-regexp">/ å­åº”ç”¨å…¥å£ï¼Œæœ¬åœ°ç¯å¢ƒä¸‹æŒ‡å®šç«¯å£
      entry: 'http:/</span><span class="hljs-regexp">/localhost:5667', /</span><span class="hljs-regexp">/ å­åº”ç”¨å…¥å£ï¼Œæœ¬åœ°å‰ç«¯ç¯å¢ƒä¸‹æŒ‡å®šç«¯å£'http:/</span><span class="hljs-regexp">/localhost:5174'ï¼Œå‘å¸ƒå¯ä»¥è°ƒæ•´ä¸ºä¸»ç³»ç»Ÿ:/app</span><span class="hljs-regexp">/workflow-app/</span>= <span class="hljs-regexp">/app/</span>æ’ä»¶åç§°/
      <span class="hljs-symbol">container:</span> <span class="hljs-string">'#sub-container'</span>, <span class="hljs-regexp">//</span> æŒ‚è½½å­åº”ç”¨çš„dom
      <span class="hljs-symbol">activeRule:</span> <span class="hljs-string">'/app/basic'</span>, <span class="hljs-regexp">//</span> è·¯ç”±åŒ¹é…è§„åˆ™
      <span class="hljs-symbol">props:</span> {
        <span class="hljs-symbol">userInfo:</span> [],
        <span class="hljs-symbol">token:</span> <span class="hljs-string">''</span>,
      }, <span class="hljs-regexp">//</span> ä¸»åº”ç”¨ä¸å­åº”ç”¨é€šä¿¡ä¼ å€¼
      <span class="hljs-symbol">sandbox:</span> {
        <span class="hljs-symbol">strictStyleIsolation:</span> <span class="hljs-literal">true</span>, <span class="hljs-regexp">//</span> å¯ç”¨ä¸¥æ ¼æ ·å¼éš”ç¦»
      },
    },
  ],
};

</code></pre>
<p>æ–‡ä»¶index.ts æ–‡ä»¶å†…å®¹å¦‚ä¸‹,æ³¨å†Œå¾®æœåŠ¡ç”Ÿå‘½å‘¨æœŸ</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å‚è€ƒé¡¹ç›®ï¼šhttps://github.com/wstee/qiankun-web</span>
<span class="hljs-keyword">import</span> { useAccessStore, useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/stores'</span>;
<span class="hljs-keyword">import</span> { registerMicroApps } <span class="hljs-keyword">from</span> <span class="hljs-string">'qiankun'</span>;

<span class="hljs-keyword">import</span> config <span class="hljs-keyword">from</span> <span class="hljs-string">'./config'</span>;

<span class="hljs-keyword">let</span> { subApps } = config;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">registerApps</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// å¦‚æœå­åº”ç”¨æ˜¯ä¸å®šçš„ï¼Œå¯ä»¥è¿™é‡Œå®šä¹‰æ¥å£ä»åå°è·å–èµ‹å€¼ç»™subAppsï¼ŒåŠ¨æ€æ·»åŠ </span>
 
    <span class="hljs-title function_">registerMicroApps</span>(subApps, {
      <span class="hljs-attr">beforeLoad</span>: [
        <span class="hljs-function">(<span class="hljs-params">app: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
          <span class="hljs-comment">// eslint-disable-next-line no-console</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[ä¸»åº”ç”¨] beforeLoad'</span>, app.<span class="hljs-property">name</span>);
          <span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">useUserStore</span>();
          <span class="hljs-keyword">const</span> accessStore = <span class="hljs-title function_">useAccessStore</span>();
          app.<span class="hljs-property">props</span>.<span class="hljs-property">token</span> = accessStore.<span class="hljs-property">accessToken</span>;
          app.<span class="hljs-property">props</span>.<span class="hljs-property">userInfo</span> = useStore.<span class="hljs-property">userInfo</span>;
          <span class="hljs-comment">// app.props.publicKey = import.meta.env.VITE_PUBLIC_KEY;</span>
        },
      ],
      <span class="hljs-comment">// ç”Ÿå‘½å‘¨æœŸé’©å­</span>
      <span class="hljs-attr">loader</span>: <span class="hljs-function">(<span class="hljs-params">loading: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
        <span class="hljs-comment">// å¯ä»¥åœ¨è¿™é‡Œå¤„ç†åŠ è½½çŠ¶æ€</span>
        <span class="hljs-comment">// eslint-disable-next-line no-console</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å­åº”ç”¨åŠ è½½çŠ¶æ€:'</span>, loading);
      },
      <span class="hljs-attr">beforeMount</span>: [
        <span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> {
          <span class="hljs-comment">// eslint-disable-next-line no-console</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[ä¸»åº”ç”¨] beforeMount'</span>, app.<span class="hljs-property">name</span>);
          <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(app.<span class="hljs-property">container</span>);
          <span class="hljs-keyword">if</span> (container) container.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
        },
      ],
      <span class="hljs-attr">afterUnmount</span>: [
        <span class="hljs-function">(<span class="hljs-params">app</span>) =&gt;</span> {
          <span class="hljs-comment">// eslint-disable-next-line no-console</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count: %s'</span>, app);
        },
      ],
    });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// eslint-disable-next-line no-console</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'count: %s'</span>, error);
  }
}

</code></pre>
<p>ä¿®æ”¹src/bootstrap.ts è®¾ç½®å¯åŠ¨æ—¶åŠ è½½qiankuné…ç½®ï¼Œæ­¤å¤„åªæ˜¯åŠ è½½ï¼Œä½†æ²¡æœ‰å‘å…¶ä»–æ•™ç¨‹ä¸€æ ·å¯åŠ¨start({}),å› ä¸ºsub_containeræŒ‚è½½ç‚¹è¿˜æ²¡æœ‰åŠ åˆ°åº”ç”¨ä¸­æ‰§è¡Œå¯åŠ¨ä¼šæŠ¥é”™ï¼Œä¼šæ‰¾ä¸åˆ°#sub-containerå…ƒç´ ã€‚</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># src/bootstrap.ts ä¿®æ”¹å†…å®¹</span>
<span class="hljs-comment">#å¯¼å…¥å¼•ç”¨æ–‡ä»¶</span>
import { registerApps } from '<span class="hljs-comment">#/qiankun';</span>

<span class="hljs-comment"># å®šä¹‰appå‰é¢æ³¨å†ŒregisterApps</span>
+ registerApps()<span class="hljs-comment">;</span>
const <span class="hljs-attr">app</span> = createApp(App)<span class="hljs-comment">;</span>

</code></pre>
<p>æ­¤æ—¶å¯åŠ¨ä¸»åº”ç”¨ æ§åˆ¶å°ä¼šæœ‰ä¸€ä¸ªè­¦å‘Šï¼Œå¤§æ¦‚æ„æ€æ²¡æœ‰æ‰§è¡Œstart({})å¯åŠ¨å¾®æœåŠ¡ï¼Œæš‚æ—¶å…ˆä¸ç®¡ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f83117c739e14356b2a92ccae45c416a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29fY2FpcHU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766626892&amp;x-signature=%2FfIvYFLC5RRY8UrZ5FS3K231J%2BQ%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">æ³¨å†Œå­åº”ç”¨è·¯ç”±</h4>
<p>åœ¨scr/views/_core/appContainer.vue ä½ç½®æ·»åŠ ä¸€ä¸ªæ–‡ä»¶ï¼Œä½œä¸ºå­åº”ç”¨è·¯ç”±ç€é™†é¡µï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// fix: è¿™ä¸ªé¡µé¢é„ä½œä¸ºappå­é¡µé¢ç€é™†é¡µï¼Œä¸å¢åŠ ä¹ˆä¼šæŠ¥é”™æ‰¾ä¸åˆ°åŠ è½½é¡µé¢</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"display: none"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<p>æœ¬æ¬¡è¦æ”¯æŒå¦‚ä¸‹ä¸¤ä¸ªå­åº”ç”¨è·¯ç”±è®¿é—®ï¼Œæ‰€ä»¥æ·»åŠ 2ä¸ªé™æ€è·¯ç”±åœ°å€,é¡µé¢éƒ½æŒ‡å‘ä¸Šé¢çš„ç©ºè·¯ç”±ç€é™†é¡µã€‚</p>
<ul>
<li>/app/basic/demo1</li>
<li>/app/basic/demo2
è°ƒæ•´å†…å®¹ï¼šä¿®æ”¹src/routes/modules/demos.tsæ·»åŠ ä¸Šè¿°ä¸¤ä¸ªæµ‹è¯•è·¯ç”±ï¼Œåœ¨ç¬¬26è¡Œæ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š</li>
</ul>

<pre><code class="hljs language-css" lang="css">  {
    meta: {
      <span class="hljs-attribute">icon</span>: <span class="hljs-string">'ic:baseline-view-in-ar'</span>,
      keepAlive: true,
      order: <span class="hljs-number">1000</span>,
      title: <span class="hljs-string">'å­åº”ç”¨demo1'</span>,
    },
    name: <span class="hljs-string">'subdemo1'</span>,
    path: <span class="hljs-string">'/app/basic/demo1'</span>,
    component: () =&gt; <span class="hljs-built_in">import</span>(<span class="hljs-string">'#/views/_core/appContainer.vue'</span>),
  },
  {
    meta: {
      <span class="hljs-attribute">icon</span>: <span class="hljs-string">'ic:baseline-view-in-ar'</span>,
      keepAlive: true,
      order: <span class="hljs-number">1000</span>,
      title: <span class="hljs-string">'å­åº”ç”¨demo2'</span>,
    },
    name: <span class="hljs-string">'subdemo2'</span>,
    path: <span class="hljs-string">'/app/basic/demo2'</span>,
    component: () =&gt; <span class="hljs-built_in">import</span>(<span class="hljs-string">'#/views/_core/appContainer.vue'</span>),
  },
</code></pre>
<p>æ­¤æ—¶è®¿é—®<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A5666%25E9%25A1%25B5%25E9%259D%25A2" target="_blank" title="http://localhost:5666%E9%A1%B5%E9%9D%A2" ref="nofollow noopener noreferrer">http://localhost:5666é¡µé¢</a> åº”è¯¥æ˜¯å¯ä»¥çœ‹åˆ°2ä¸ªè·¯ç”±å†…å®¹ï¼Œä¸è¿‡é¡µé¢å†…å®¹åŒºåŸŸæ˜¯ç©ºç™½.
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fb11d47e9a040ea9b0cfea3cdbc172b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29fY2FpcHU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766626892&amp;x-signature=SMdg4i1scCeAgOoLW2hNoM9YClo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">packageåŒ…æ·»åŠ æŒ‚è½½å®¹å™¨</h4>
<p>packageä½œä¸ºå•ç‹¬æ ¸å¿ƒåŒ…ï¼Œé‡Œé¢åŒ…æ‹¬ä¸»æ¡†æ¶æ–‡ä»¶content.vue,éœ€è¦å¢åŠ ä¸»åŒ…å®‰è£…qiankunã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> packages/effects/layouts
<span class="hljs-comment">#å®‰è£…qiankun</span>
pnpm i qiankun
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šä¿®æ”¹ä¸»åŒ…å¼•ç”¨æœ‰ä¸ªä¸å¥½çš„åœ°æ–¹ï¼Œåé¢å¦‚æœæ›´æ–°vbenä¸»ä»“åº“çš„æ—¶å€™ï¼Œæœ‰å˜æ›´éƒ½è¦æ‰‹åŠ¨å¤„ç†gitå†²çªã€‚</p>
</blockquote>
<p>æ‰“å¼€é¡µé¢packages/effects/layouts/src/basic/content/content.vueæ–‡ä»¶ï¼Œåœ¨ç›¸åº”ä½ç½®æ·»åŠ å¦‚ä¸‹ä»£ç </p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;script lang=<span class="hljs-string">"ts"</span> setup&gt;
...
#å¯¼å…¥
<span class="hljs-keyword">import</span> { start } <span class="hljs-keyword">from</span> <span class="hljs-string">'qiankun'</span>;
...
# åŠ è½½start

<span class="hljs-keyword">function</span> <span class="hljs-title function_">startApps</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunStarted</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunStarted</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-comment">// registerApps()</span>
    <span class="hljs-title function_">start</span>({
      <span class="hljs-attr">prefetch</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// å¼€å¯é¢„åŠ è½½ä¼šå¯¼è‡´é‡å¤åŠ è½½åº”ç”¨</span>
      <span class="hljs-title function_">fetch</span>(<span class="hljs-params">url, ...args</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">fetch</span>(url, ...args).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Fetch failed:'</span>, url);
          <span class="hljs-comment">// ç›´æ¥è¿”å›ä¸€ä¸ªå¤±è´¥çš„ Promiseï¼Œé˜»æ­¢é‡è¯•</span>
          <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>;
        });
      },
      <span class="hljs-attr">sandbox</span>: {
        <span class="hljs-attr">experimentalStyleIsolation</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ ·å¼éš”ç¦»</span>
      },
    });
  }
}
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">startApps</span>();
});
&lt;/script&gt;

    &lt;!--- qiankun by go-caipu æ³¨å…¥å®¹å™¨ --&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sub-container"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sub-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>

</code></pre>
<p>å®Œæ•´æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;script lang=<span class="hljs-string">"ts"</span> setup&gt;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">VNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> {
  <span class="hljs-title class_">RouteLocationNormalizedLoaded</span>,
  <span class="hljs-title class_">RouteLocationNormalizedLoadedGeneric</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;

<span class="hljs-keyword">import</span> { computed, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RouterView</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;

<span class="hljs-keyword">import</span> { preferences, usePreferences } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/preferences'</span>;
<span class="hljs-keyword">import</span> { getTabKey, storeToRefs, useTabbarStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/stores'</span>;

<span class="hljs-keyword">import</span> { start } <span class="hljs-keyword">from</span> <span class="hljs-string">'qiankun'</span>;

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">IFrameRouterView</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../iframe'</span>;

<span class="hljs-title function_">defineOptions</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'LayoutContent'</span> });

<span class="hljs-keyword">const</span> tabbarStore = <span class="hljs-title function_">useTabbarStore</span>();
<span class="hljs-keyword">const</span> { keepAlive } = <span class="hljs-title function_">usePreferences</span>();

<span class="hljs-keyword">const</span> { getCachedTabs, getExcludeCachedTabs, renderRouteView } =
  <span class="hljs-title function_">storeToRefs</span>(tabbarStore);

<span class="hljs-comment">/**
 * æ˜¯å¦ä½¿ç”¨åŠ¨ç”»
 */</span>
<span class="hljs-keyword">const</span> getEnabledTransition = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> { transition } = preferences;
  <span class="hljs-keyword">const</span> transitionName = transition.<span class="hljs-property">name</span>;
  <span class="hljs-keyword">return</span> transitionName &amp;&amp; transition.<span class="hljs-property">enable</span>;
});

<span class="hljs-comment">// é¡µé¢åˆ‡æ¢åŠ¨ç”»</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getTransitionName</span>(<span class="hljs-params">_route: RouteLocationNormalizedLoaded</span>) {
  <span class="hljs-comment">// å¦‚æœåå¥½è®¾ç½®æœªè®¾ç½®ï¼Œåˆ™ä¸ä½¿ç”¨åŠ¨ç”»</span>
  <span class="hljs-keyword">const</span> { tabbar, transition } = preferences;
  <span class="hljs-keyword">const</span> transitionName = transition.<span class="hljs-property">name</span>;
  <span class="hljs-keyword">if</span> (!transitionName || !transition.<span class="hljs-property">enable</span>) {
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// æ ‡ç­¾é¡µæœªå¯ç”¨æˆ–è€…æœªå¼€å¯ç¼“å­˜ï¼Œåˆ™ä½¿ç”¨å…¨å±€é…ç½®åŠ¨ç”»</span>
  <span class="hljs-keyword">if</span> (!tabbar.<span class="hljs-property">enable</span> || !keepAlive) {
    <span class="hljs-keyword">return</span> transitionName;
  }

  <span class="hljs-comment">// å¦‚æœé¡µé¢å·²ç»åŠ è½½è¿‡ï¼Œåˆ™ä¸ä½¿ç”¨åŠ¨ç”»</span>
  <span class="hljs-comment">// if (route.meta.loaded) {</span>
  <span class="hljs-comment">//   return;</span>
  <span class="hljs-comment">// }</span>
  <span class="hljs-comment">// å·²ç»æ‰“å¼€ä¸”å·²ç»åŠ è½½è¿‡çš„é¡µé¢ä¸ä½¿ç”¨åŠ¨ç”»</span>
  <span class="hljs-comment">// const inTabs = getCachedTabs.value.includes(route.name as string);</span>

  <span class="hljs-comment">// return inTabs &amp;&amp; route.meta.loaded ? undefined : transitionName;</span>
  <span class="hljs-keyword">return</span> transitionName;
}

<span class="hljs-comment">/**
 * è½¬æ¢ç»„ä»¶ï¼Œè‡ªåŠ¨æ·»åŠ  name
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">component</span>
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">transformComponent</span>(<span class="hljs-params">
  component: VNode,
  route: RouteLocationNormalizedLoadedGeneric,
</span>) {
  <span class="hljs-comment">// ç»„ä»¶è§†å›¾æœªæ‰¾åˆ°ï¼Œå¦‚æœæœ‰è®¾ç½®åå¤‡è§†å›¾ï¼Œåˆ™è¿”å›åå¤‡è§†å›¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æŠ›å‡ºé”™è¯¯</span>
  <span class="hljs-keyword">if</span> (!component) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(
      <span class="hljs-string">'Component view not foundï¼Œplease check the route configuration'</span>,
    );
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  }

  <span class="hljs-keyword">const</span> routeName = route.<span class="hljs-property">name</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
  <span class="hljs-comment">// å¦‚æœç»„ä»¶æ²¡æœ‰ nameï¼Œåˆ™ç›´æ¥è¿”å›</span>
  <span class="hljs-keyword">if</span> (!routeName) {
    <span class="hljs-keyword">return</span> component;
  }
  <span class="hljs-keyword">const</span> componentName = (component?.<span class="hljs-property">type</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)?.<span class="hljs-property">name</span>;

  <span class="hljs-comment">// å·²ç»è®¾ç½®è¿‡ nameï¼Œåˆ™ç›´æ¥è¿”å›</span>
  <span class="hljs-keyword">if</span> (componentName) {
    <span class="hljs-keyword">return</span> component;
  }

  <span class="hljs-comment">// componentName ä¸ routeName ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿”å›</span>
  <span class="hljs-keyword">if</span> (componentName === routeName) {
    <span class="hljs-keyword">return</span> component;
  }

  <span class="hljs-comment">// è®¾ç½® name</span>
  component.<span class="hljs-property">type</span> ||= {};
  (component.<span class="hljs-property">type</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">name</span> = routeName;

  <span class="hljs-keyword">return</span> component;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">startApps</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunStarted</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">qiankunStarted</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-comment">// registerApps()</span>
    <span class="hljs-title function_">start</span>({
      <span class="hljs-attr">prefetch</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// å¼€å¯é¢„åŠ è½½ä¼šå¯¼è‡´é‡å¤åŠ è½½åº”ç”¨</span>
      <span class="hljs-title function_">fetch</span>(<span class="hljs-params">url, ...args</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">fetch</span>(url, ...args).<span class="hljs-keyword">catch</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Fetch failed:'</span>, url);
          <span class="hljs-comment">// ç›´æ¥è¿”å›ä¸€ä¸ªå¤±è´¥çš„ Promiseï¼Œé˜»æ­¢é‡è¯•</span>
          <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>;
        });
      },
      <span class="hljs-attr">sandbox</span>: {
        <span class="hljs-attr">experimentalStyleIsolation</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ ·å¼éš”ç¦»</span>
      },
    });
  }
}
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">startApps</span>();
});
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"relative h-full"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">IFrameRouterView</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">RouterView</span> <span class="hljs-attr">v-slot</span>=<span class="hljs-string">"{ Component, route }"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Transition</span>
        <span class="hljs-attr">v-if</span>=<span class="hljs-string">"getEnabledTransition"</span>
        <span class="hljs-attr">:name</span>=<span class="hljs-string">"getTransitionName(route)"</span>
        <span class="hljs-attr">appear</span>
        <span class="hljs-attr">mode</span>=<span class="hljs-string">"out-in"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">KeepAlive</span>
          <span class="hljs-attr">v-if</span>=<span class="hljs-string">"keepAlive"</span>
          <span class="hljs-attr">:exclude</span>=<span class="hljs-string">"getExcludeCachedTabs"</span>
          <span class="hljs-attr">:include</span>=<span class="hljs-string">"getCachedTabs"</span>
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">component</span>
            <span class="hljs-attr">:is</span>=<span class="hljs-string">"transformComponent(Component, route)"</span>
            <span class="hljs-attr">v-if</span>=<span class="hljs-string">"renderRouteView"</span>
            <span class="hljs-attr">v-show</span>=<span class="hljs-string">"!route.meta.iframeSrc"</span>
            <span class="hljs-attr">:key</span>=<span class="hljs-string">"getTabKey(route)"</span>
          /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">component</span>
          <span class="hljs-attr">:is</span>=<span class="hljs-string">"Component"</span>
          <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"renderRouteView"</span>
          <span class="hljs-attr">:key</span>=<span class="hljs-string">"getTabKey(route)"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Transition</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-else</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">KeepAlive</span>
          <span class="hljs-attr">v-if</span>=<span class="hljs-string">"keepAlive"</span>
          <span class="hljs-attr">:exclude</span>=<span class="hljs-string">"getExcludeCachedTabs"</span>
          <span class="hljs-attr">:include</span>=<span class="hljs-string">"getCachedTabs"</span>
        &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">component</span>
            <span class="hljs-attr">:is</span>=<span class="hljs-string">"transformComponent(Component, route)"</span>
            <span class="hljs-attr">v-if</span>=<span class="hljs-string">"renderRouteView"</span>
            <span class="hljs-attr">v-show</span>=<span class="hljs-string">"!route.meta.iframeSrc"</span>
            <span class="hljs-attr">:key</span>=<span class="hljs-string">"getTabKey(route)"</span>
          /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">component</span>
          <span class="hljs-attr">:is</span>=<span class="hljs-string">"Component"</span>
          <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"renderRouteView"</span>
          <span class="hljs-attr">:key</span>=<span class="hljs-string">"getTabKey(route)"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">RouterView</span>&gt;</span>
    <span class="hljs-comment">&lt;!--- qiankun by go-caipu --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sub-container"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sub-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

</code></pre>
<p>åˆ°æ­¤ä¸»åº”ç”¨é…ç½®å®Œæˆã€‚</p>
<h3 data-id="heading-8">å­åº”ç”¨web-antd-childé›†æˆ</h3>
<p>å› ä¸ºå­åº”ç”¨è°ƒæ•´å†…å®¹è¾ƒå¤šï¼Œæœ‰çš„æ–‡ä»¶ç›´æ¥ç»™å‡ºæ•´ä¸ªä¿®æ”¹çš„æ–‡ä»¶</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è½¬åˆ°å­åº”ç”¨ç›®å½•</span>
<span class="hljs-built_in">cd</span> ./apps/web-antd-child/
<span class="hljs-comment"># å®‰è£… vite æ”¯æŒqiankun</span>
pnpm i vite-plugin-qiankun
</code></pre>
<h4 data-id="heading-9">ä¿®æ”¹.env.development ç¯å¢ƒå˜é‡</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ä¿®æ”¹VITE_BASE è®©ç¨‹åºä»¥/app/basicå­åŒ…æ–¹å¼è¿è¡Œ</span>
<span class="hljs-attr">VITE_BASE</span>=/app/basic

<span class="hljs-comment"># æ˜¯å¦æ³¨å…¥å…¨å±€loading æ”¹ç½®ä¸è¦loadingæ•ˆæœï¼Œå› ä¸ºåŠ è½½å­åº”ç”¨çš„æ—¶å€™ç›´æ¥æ˜¯å…³é—­ä¸äº†ï¼Œå¾—è¦è°ƒæ•´ç¨‹åºæ­¤æ¬¡å…ˆå…³é—­</span>
<span class="hljs-attr">VITE_INJECT_APP_LOADING</span>=<span class="hljs-literal">false</span>
</code></pre>
<h4 data-id="heading-10">ä¿®æ”¹index.html</h4>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å°†åŸæ–‡ä»¶ä¸­ &lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">"app"</span>&gt;&lt;/div&gt; è°ƒæ•´ä¸º &lt;div <span class="hljs-built_in">id</span>=<span class="hljs-string">"app"</span>&gt;&lt;/div&gt;</span>
</code></pre>
<h4 data-id="heading-11">ä¿®æ”¹.vite.config.ts å¢åŠ qiankunåŠ è½½</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/vite-config'</span>;

<span class="hljs-keyword">import</span> qiankun <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-qiankun'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">application</span>: {},
    <span class="hljs-attr">vite</span>: {
      <span class="hljs-attr">server</span>: {
        <span class="hljs-attr">proxy</span>: {
          <span class="hljs-string">'/api'</span>: {
            <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">''</span>),
            <span class="hljs-comment">// mockä»£ç†ç›®æ ‡åœ°å€</span>
            <span class="hljs-attr">target</span>: <span class="hljs-string">'http://localhost:5320/api'</span>,
            <span class="hljs-attr">ws</span>: <span class="hljs-literal">true</span>,
          },
        },
      },
      <span class="hljs-attr">plugins</span>: [
        <span class="hljs-title function_">qiankun</span>(<span class="hljs-string">'/app/basic'</span>, {
          <span class="hljs-attr">useDevMode</span>: <span class="hljs-literal">true</span>,
        }),
      ],
    },
  };
});

</code></pre>
<h4 data-id="heading-12">ä¿®æ”¹ bootstrap.tsæ–‡ä»¶</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">import</span> { registerAccessDirective } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/access'</span>;
<span class="hljs-keyword">import</span> { registerLoadingDirective } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/common-ui/es/loading'</span>;
<span class="hljs-keyword">import</span> { preferences } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/preferences'</span>;
<span class="hljs-keyword">import</span> { initStores } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/stores'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'@vben/styles'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'@vben/styles/antd'</span>;

<span class="hljs-keyword">import</span> { useTitle } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vueuse/core'</span>;

<span class="hljs-keyword">import</span> { $t, setupI18n } <span class="hljs-keyword">from</span> <span class="hljs-string">'#/locales'</span>;

<span class="hljs-keyword">import</span> { initComponentAdapter } <span class="hljs-keyword">from</span> <span class="hljs-string">'./adapter/component'</span>;
<span class="hljs-keyword">import</span> { initSetupVbenForm } <span class="hljs-keyword">from</span> <span class="hljs-string">'./adapter/form'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.vue'</span>;
<span class="hljs-keyword">import</span> { router } <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params">namespace: string, container: any = <span class="hljs-literal">null</span></span>) {
  <span class="hljs-comment">// åˆå§‹åŒ–ç»„ä»¶é€‚é…å™¨</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">initComponentAdapter</span>();

  <span class="hljs-comment">// åˆå§‹åŒ–è¡¨å•ç»„ä»¶</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">initSetupVbenForm</span>();

  <span class="hljs-comment">// // è®¾ç½®å¼¹çª—çš„é»˜è®¤é…ç½®</span>
  <span class="hljs-comment">// setDefaultModalProps({</span>
  <span class="hljs-comment">//   fullscreenButton: false,</span>
  <span class="hljs-comment">// });</span>
  <span class="hljs-comment">// // è®¾ç½®æŠ½å±‰çš„é»˜è®¤é…ç½®</span>
  <span class="hljs-comment">// setDefaultDrawerProps({</span>
  <span class="hljs-comment">//   zIndex: 1020,</span>
  <span class="hljs-comment">// });</span>

  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);

  <span class="hljs-comment">// æ³¨å†Œv-loadingæŒ‡ä»¤</span>
  <span class="hljs-title function_">registerLoadingDirective</span>(app, {
    <span class="hljs-attr">loading</span>: <span class="hljs-string">'loading'</span>, <span class="hljs-comment">// åœ¨è¿™é‡Œå¯ä»¥è‡ªå®šä¹‰æŒ‡ä»¤åç§°ï¼Œä¹Ÿå¯ä»¥æ˜ç¡®æä¾›falseè¡¨ç¤ºä¸æ³¨å†Œè¿™ä¸ªæŒ‡ä»¤</span>
    <span class="hljs-attr">spinning</span>: <span class="hljs-string">'spinning'</span>,
  });

  <span class="hljs-comment">// å›½é™…åŒ– i18n é…ç½®</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">setupI18n</span>(app);

  <span class="hljs-comment">// é…ç½® pinia-tore</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">initStores</span>(app, { namespace });

  <span class="hljs-comment">// å®‰è£…æƒé™æŒ‡ä»¤</span>
  <span class="hljs-title function_">registerAccessDirective</span>(app);

  <span class="hljs-comment">// åˆå§‹åŒ– tippy</span>
  <span class="hljs-keyword">const</span> { initTippy } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@vben/common-ui/es/tippy'</span>);
  <span class="hljs-title function_">initTippy</span>(app);

  <span class="hljs-comment">// é…ç½®è·¯ç”±åŠè·¯ç”±å®ˆå«</span>
  app.<span class="hljs-title function_">use</span>(router);

  <span class="hljs-comment">// é…ç½®Motionæ’ä»¶</span>
  <span class="hljs-keyword">const</span> { <span class="hljs-title class_">MotionPlugin</span> } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@vben/plugins/motion'</span>);
  app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">MotionPlugin</span>);

  <span class="hljs-comment">// åŠ¨æ€æ›´æ–°æ ‡é¢˜</span>
  <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (preferences.<span class="hljs-property">app</span>.<span class="hljs-property">dynamicTitle</span>) {
      <span class="hljs-keyword">const</span> routeTitle = router.<span class="hljs-property">currentRoute</span>.<span class="hljs-property">value</span>.<span class="hljs-property">meta</span>?.<span class="hljs-property">title</span>;
      <span class="hljs-keyword">const</span> pageTitle =
        (routeTitle ? <span class="hljs-string">`<span class="hljs-subst">${$t(routeTitle)}</span> - `</span> : <span class="hljs-string">''</span>) + preferences.<span class="hljs-property">app</span>.<span class="hljs-property">name</span>;
      <span class="hljs-title function_">useTitle</span>(pageTitle);
    }
  });

  app.<span class="hljs-title function_">mount</span>(container ? container.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#sub_app'</span>) : <span class="hljs-string">'#sub_app'</span>);
  <span class="hljs-keyword">return</span> app;
}

<span class="hljs-keyword">export</span> { bootstrap };


</code></pre>
<h4 data-id="heading-13">ä¿®æ”¹ main.ts</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { initPreferences } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/preferences'</span>;
<span class="hljs-keyword">import</span> { useAccessStore, useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/stores'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'@vben/styles'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'@vben/styles/antd'</span>;
<span class="hljs-keyword">import</span> { unmountGlobalLoading } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vben/utils'</span>;

<span class="hljs-keyword">import</span> {
  qiankunWindow,
  renderWithQiankun,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-plugin-qiankun/dist/helper'</span>;

<span class="hljs-keyword">import</span> { bootstrap } <span class="hljs-keyword">from</span> <span class="hljs-string">'./bootstrap'</span>;
<span class="hljs-keyword">import</span> { overridesPreferences } <span class="hljs-keyword">from</span> <span class="hljs-string">'./preferences'</span>;

<span class="hljs-keyword">let</span> <span class="hljs-attr">app</span>: any = <span class="hljs-literal">null</span>;
<span class="hljs-comment">/**
 * åº”ç”¨åˆå§‹åŒ–å®Œæˆä¹‹åå†è¿›è¡Œé¡µé¢åŠ è½½æ¸²æŸ“
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initApplication</span>(<span class="hljs-params">container: any = <span class="hljs-literal">null</span></span>) {
  <span class="hljs-comment">// nameç”¨äºæŒ‡å®šé¡¹ç›®å”¯ä¸€æ ‡è¯†</span>
  <span class="hljs-comment">// ç”¨äºåŒºåˆ†ä¸åŒé¡¹ç›®çš„åå¥½è®¾ç½®ä»¥åŠå­˜å‚¨æ•°æ®çš„keyå‰ç¼€ä»¥åŠå…¶ä»–ä¸€äº›éœ€è¦éš”ç¦»çš„æ•°æ®</span>
  <span class="hljs-keyword">const</span> env = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">PROD</span> ? <span class="hljs-string">'prod'</span> : <span class="hljs-string">'dev'</span>;
  <span class="hljs-keyword">const</span> appVersion = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_APP_VERSION</span>;
  <span class="hljs-keyword">const</span> namespace = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">import</span>.meta.env.VITE_APP_NAMESPACE}</span>-<span class="hljs-subst">${appVersion}</span>-<span class="hljs-subst">${env}</span>`</span>;

  <span class="hljs-comment">// appåå¥½è®¾ç½®åˆå§‹åŒ–</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">initPreferences</span>({
    namespace,
    <span class="hljs-attr">overrides</span>: overridesPreferences,
  });
  <span class="hljs-comment">// å¯åŠ¨åº”ç”¨å¹¶æŒ‚è½½</span>
  <span class="hljs-comment">// vueåº”ç”¨ä¸»è¦é€»è¾‘åŠè§†å›¾</span>
  app = <span class="hljs-keyword">await</span> <span class="hljs-title function_">bootstrap</span>(namespace, container);
  <span class="hljs-comment">// ç§»é™¤å¹¶é”€æ¯loading</span>
  <span class="hljs-title function_">unmountGlobalLoading</span>();
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">initQianKun</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">renderWithQiankun</span>({
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props: any</span>) {
      <span class="hljs-keyword">const</span> { container, token, userInfo } = props;
      <span class="hljs-keyword">await</span> <span class="hljs-title function_">initApplication</span>(container);
      <span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">useUserStore</span>();
      <span class="hljs-keyword">const</span> accessStore = <span class="hljs-title function_">useAccessStore</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[å­åº”ç”¨]  mounting'</span>, props);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[å­åº”ç”¨]  token:'</span>, token);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[å­åº”ç”¨]  userInfo:'</span>, userInfo);

      useStore.<span class="hljs-title function_">setUserInfo</span>(userInfo);
      accessStore.<span class="hljs-title function_">setAccessToken</span>(token);
      <span class="hljs-comment">// ç§»é™¤å¹¶é”€æ¯loading</span>
      <span class="hljs-title function_">unmountGlobalLoading</span>();
    },
    <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// eslint-disable-next-line no-console</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[å­åº”ç”¨]  bootstraped'</span>);
    },
    <span class="hljs-title function_">update</span>(<span class="hljs-params">props: any</span>) {
      <span class="hljs-comment">// eslint-disable-next-line no-console</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[å­åº”ç”¨]  update'</span>);
      <span class="hljs-keyword">const</span> { container } = props;
      <span class="hljs-title function_">initApplication</span>(container);
    },
    <span class="hljs-title function_">unmount</span>(<span class="hljs-params">props</span>) {
      <span class="hljs-comment">// eslint-disable-next-line no-console</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'[å­åº”ç”¨] unmount'</span>, props);
      app?.<span class="hljs-title function_">unmount</span>();
      app = <span class="hljs-literal">null</span>;
    },
  });
};
<span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºä¹¾å¤ç¯å¢ƒï¼Œå¦åˆ™ä¼šæŠ¥é”™iqiankun]: Target container with #subAppContainerVue3 not existed while subAppVue3 mounting!</span>
qiankunWindow.<span class="hljs-property">__POWERED_BY_QIANKUN__</span>
  ? <span class="hljs-keyword">await</span> <span class="hljs-title function_">initQianKun</span>()
  : <span class="hljs-keyword">await</span> <span class="hljs-title function_">initApplication</span>();
</code></pre>
<h4 data-id="heading-14">æ·»åŠ æµ‹è¯•è·¯ç”±</h4>
<p>ä¿®æ”¹/web-basic/src/router/routes/index.ts çš„å†…å®¹ï¼Œå¢åŠ 2ä¸ªæµ‹è¯•è·¯ç”±ã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment">#å°†const externalRoutes: RouteRecordRaw[] = [] è°ƒæ•´ä¸ºä¸‹é¢å†…å®¹</span>
<span class="hljs-attr">const externalRoutes:</span> <span class="hljs-string">RouteRecordRaw[]</span> <span class="hljs-string">=</span> [
  {
    <span class="hljs-attr">meta:</span> {
      <span class="hljs-attr">icon:</span> <span class="hljs-string">'ic:baseline-view-in-ar'</span>,
      <span class="hljs-attr">keepAlive:</span> <span class="hljs-literal">true</span>,
      <span class="hljs-attr">order:</span> <span class="hljs-number">1000</span>,
      <span class="hljs-attr">title:</span> <span class="hljs-string">'æ¼”ç¤ºåŠŸèƒ½'</span>,
    },
    <span class="hljs-attr">name:</span> <span class="hljs-string">'Test'</span>,
    <span class="hljs-attr">path:</span> <span class="hljs-string">'/demo'</span>,
    <span class="hljs-attr">component:</span> <span class="hljs-string">()</span> <span class="hljs-string">=&gt;</span> <span class="hljs-string">import('#/views/demos/antd/index.vue')</span>,
  },
  {
    <span class="hljs-attr">meta:</span> {
      <span class="hljs-attr">icon:</span> <span class="hljs-string">'ic:baseline-view-in-ar'</span>,
      <span class="hljs-attr">keepAlive:</span> <span class="hljs-literal">true</span>,
      <span class="hljs-attr">order:</span> <span class="hljs-number">1000</span>,
      <span class="hljs-attr">title:</span> <span class="hljs-string">'æ¼”ç¤ºåŠŸèƒ½'</span>,
    },
    <span class="hljs-attr">name:</span> <span class="hljs-string">'demo2'</span>,
    <span class="hljs-attr">path:</span> <span class="hljs-string">'/demo2'</span>,
    <span class="hljs-attr">component:</span> <span class="hljs-string">()</span> <span class="hljs-string">=&gt;</span> <span class="hljs-string">import('#/views/dashboard/workspace/index.vue')</span>,
  },
]<span class="hljs-string">;</span>

</code></pre>
<p>é‡æ–°è¿è¡Œå­é¡¹ç›®<strong>pnpm dev</strong>, æ­¤æ—¶åº”è¯¥èƒ½æ‰“å¼€<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A5667%2Fapp%2Fbasic%2Fdemo1" target="_blank" title="http://localhost:5667/app/basic/demo1" ref="nofollow noopener noreferrer">http://localhost:5667/app/basic/demo1</a> å’Œ <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A5667%2Fapp%2Fbasic%2Fdemo2" target="_blank" title="http://localhost:5667/app/basic/demo2" ref="nofollow noopener noreferrer">http://localhost:5667/app/basic/demo2</a> å­åº”ç”¨é¡µé¢å•ç‹¬è®¿é—®é¡µé¢å¦‚ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a20b46d2227e4a8d8a03ed5fdd2e54f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29fY2FpcHU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766626892&amp;x-signature=5Rr7IK3kocgh7muT7DoBeWwYRJI%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨ä¸»åº”ç”¨è®¿é—®å­åº”ç”¨é¡µé¢æ•ˆæœï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d88adcfbbdea409199d15f4c58197408~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29fY2FpcHU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766626892&amp;x-signature=M25k97Pzsx9w1s5jZDY%2FEUT%2F%2F9Y%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-15">é—ç•™é—®é¢˜</h3>
<ol>
<li>ä¸»åº”ç”¨å’Œå­åº”ç”¨ä¿æŒä¸»é¢˜é£æ ¼ä¸€è‡´ï¼Œä¸»åº”ç”¨è°ƒæ•´å­åº”ç”¨åŒæ­¥è°ƒæ•´ã€‚ç›®å‰é¦–æ¬¡æ‰“å¼€å­åº”ç”¨ä¼šå½±å“ä¸»åº”ç”¨æ ·å¼å˜æˆé»‘è‰²ä¸»é¢˜ï¼Œè¿˜åœ¨ç ”ç©¶å½“ä¸­ã€‚</li>
<li>å­åº”ç”¨ç™»å½•é‰´æƒä½¿ç”¨ä¸»åº”ç”¨é‰´æƒï¼Œå¦‚æœå­åº”ç”¨é‰´æƒè¿‡æœŸè¦è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œ</li>
</ol>
<h3 data-id="heading-16">åç»­ä¼˜åŒ–ç‚¹</h3>
<ol>
<li>ç®¡ç†ç³»ç»Ÿéƒ½æ˜¯ä»åå°åŠ è½½è·¯ç”±èœå•ï¼Œæœ¬æ¬¡ä»…æ˜¯ä¸€ä¸ªdemoï¼Œåç»­ä¼˜åŒ–è°ƒæ•´æˆåŠ¨æ€ä»åå°è·å–èœå•å’Œå®ç°å­åº”ç”¨çš„åŠ¨æ€æ›´æ–°ï¼Œå®ç°å­åº”ç”¨çš„çƒ­æ’æ‹”è¦å’Œåç«¯ç¨‹åºè¿›è¡Œè”åŠ¨ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[zustandæŒä¹…åŒ–]]></title>    <link>https://juejin.cn/post/7584730804513964075</link>    <guid>https://juejin.cn/post/7584730804513964075</guid>    <pubDate>2025-12-18T01:59:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584730804513964075" data-draft-id="7584729714339479571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="zustandæŒä¹…åŒ–"/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2025-12-18T01:59:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é™å¾…é›¨è½"/> <meta itemprop="url" content="https://juejin.cn/user/3219836765220077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            zustandæŒä¹…åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3219836765220077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é™å¾…é›¨è½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T01:59:36.000Z" title="Thu Dec 18 2025 01:59:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Zustand æä¾›äº†<strong>æç®€çš„æŒä¹…åŒ–æ–¹æ¡ˆ</strong>ï¼Œæ ¸å¿ƒé€šè¿‡å†…ç½®çš„Â <code>persist</code>Â ä¸­é—´ä»¶å®ç°ï¼Œæ— éœ€é¢å¤–ä¾èµ–ï¼ˆæˆ–ä»…éœ€å°‘é‡é…ç½®ï¼‰ï¼Œæ”¯æŒ localStorage/sessionStorage/ è‡ªå®šä¹‰å­˜å‚¨ï¼ˆå¦‚ React Native çš„ AsyncStorageï¼‰ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„æŒä¹…åŒ–æ•™ç¨‹ï¼ŒåŒ…å«åŸºç¡€ç”¨æ³•ã€é«˜çº§é…ç½®ã€å¸¸è§é—®é¢˜è§£å†³ã€‚</p>
<h3 data-id="heading-0">ä¸€ã€åŸºç¡€ç”¨æ³•ï¼ˆæœ€å¸¸ç”¨ï¼‰</h3>
<h4 data-id="heading-1">1. å®‰è£…ä¾èµ–ï¼ˆè‹¥éœ€ç±»å‹æ”¯æŒï¼‰</h4>
<p>Zustand æ ¸å¿ƒåŒ…å·²å†…ç½®Â <code>persist</code>Â ä¸­é—´ä»¶ï¼Œæ— éœ€é¢å¤–å®‰è£…ï¼Œä»…éœ€ç¡®ä¿ zustand ç‰ˆæœ¬ â‰¥4.0.0ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install zustand <span class="hljs-comment"># æˆ– yarn add zustand</span>
</code></pre>
<h4 data-id="heading-2">2. åŸºç¡€æŒä¹…åŒ–é…ç½®</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;
<span class="hljs-keyword">import</span> { persist } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand/middleware'</span>; <span class="hljs-comment">// å¯¼å…¥æŒä¹…åŒ–ä¸­é—´ä»¶</span>

<span class="hljs-comment">// åˆ›å»ºå¸¦æŒä¹…åŒ–çš„ store</span>
<span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">create</span>(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šåŸå§‹ store é€»è¾‘</span>
    <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
      <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span> })),
      <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> }),
    }),
    <span class="hljs-comment">// ç¬¬äºŒä¸ªå‚æ•°ï¼šæŒä¹…åŒ–é…ç½®</span>
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'counter-storage'</span>, <span class="hljs-comment">// å­˜å‚¨çš„ keyï¼ˆå¿…é€‰ï¼Œç”¨äº localStorage æ ‡è¯†ï¼‰</span>
      <span class="hljs-comment">// é»˜è®¤å­˜å‚¨åˆ° localStorageï¼Œå¯æŒ‡å®šä¸º sessionStorageï¼š</span>
      <span class="hljs-comment">// storage: sessionStorage,</span>
    }
  )
);

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨ï¼ˆå’Œæ™®é€š zustand ç”¨æ³•å®Œå…¨ä¸€è‡´ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { count, increment, reset } = <span class="hljs-title function_">useCounterStore</span>();
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Count: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{increment}</span>&gt;</span>+<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{reset}</span>&gt;</span>é‡ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>âœ… æ•ˆæœï¼šåˆ·æ–°é¡µé¢åï¼Œ<code>count</code>Â çŠ¶æ€ä¼šä» localStorage ä¸­æ¢å¤ï¼Œæ— éœ€é¢å¤–ä»£ç ã€‚</p>
<h3 data-id="heading-3">äºŒã€é«˜çº§é…ç½®ï¼ˆè¦†ç›–å¸¸è§åœºæ™¯ï¼‰</h3>
<h4 data-id="heading-4">1. è‡ªå®šä¹‰å­˜å‚¨æ–¹å¼ï¼ˆå¦‚ React Nativeï¼‰</h4>
<p>é»˜è®¤å­˜å‚¨æ˜¯Â <code>localStorage</code>ï¼ˆWebï¼‰ï¼Œè‹¥éœ€é€‚é… React Nativeï¼Œå¯æŒ‡å®šÂ <code>AsyncStorage</code>ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;
<span class="hljs-keyword">import</span> { persist } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand/middleware'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">AsyncStorage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@react-native-async-storage/async-storage'</span>; <span class="hljs-comment">// RN æŒä¹…åŒ–å­˜å‚¨</span>

<span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">create</span>(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
      <span class="hljs-attr">userInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">token</span>: <span class="hljs-string">''</span> },
      <span class="hljs-attr">setUser</span>: <span class="hljs-function">(<span class="hljs-params">user</span>) =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">userInfo</span>: user }),
    }),
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'user-storage'</span>,
      <span class="hljs-attr">storage</span>: { <span class="hljs-comment">// è‡ªå®šä¹‰å­˜å‚¨é€‚é…å™¨</span>
        <span class="hljs-attr">getItem</span>: <span class="hljs-keyword">async</span> (name) =&gt; {
          <span class="hljs-keyword">const</span> value = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">getItem</span>(name);
          <span class="hljs-keyword">return</span> value ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(value) : <span class="hljs-literal">null</span>;
        },
        <span class="hljs-attr">setItem</span>: <span class="hljs-keyword">async</span> (name, value) =&gt; {
          <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">setItem</span>(name, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value));
        },
        <span class="hljs-attr">removeItem</span>: <span class="hljs-keyword">async</span> (name) =&gt; {
          <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">removeItem</span>(name);
        },
      },
    }
  )
);
</code></pre>
<h4 data-id="heading-5">3. æŒä¹…åŒ–åŠ å¯†ï¼ˆæ•æ„Ÿæ•°æ®ï¼‰</h4>
<p>è‹¥å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ tokenï¼‰ï¼Œå¯é€šè¿‡Â <code>serialize</code>/<code>deserialize</code>Â åŠ å¯† / è§£å¯†ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;
<span class="hljs-keyword">import</span> { persist } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand/middleware'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CryptoJS</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'crypto-js'</span>; <span class="hljs-comment">// éœ€å®‰è£…ï¼šnpm install crypto-js</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SECRET_KEY</span> = <span class="hljs-string">'your-secret-key'</span>; <span class="hljs-comment">// å®é™…é¡¹ç›®ä¸­å»ºè®®ä»ç¯å¢ƒå˜é‡è¯»å–</span>

<span class="hljs-keyword">const</span> useSecureStore = <span class="hljs-title function_">create</span>(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
      <span class="hljs-attr">token</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">setToken</span>: <span class="hljs-function">(<span class="hljs-params">token</span>) =&gt;</span> <span class="hljs-title function_">set</span>({ token }),
    }),
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'secure-storage'</span>,
      <span class="hljs-comment">// åºåˆ—åŒ–ï¼ˆå­˜å‚¨æ—¶åŠ å¯†ï¼‰</span>
      <span class="hljs-attr">serialize</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> encrypted = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">AES</span>.<span class="hljs-title function_">encrypt</span>(
          <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(state),
          <span class="hljs-variable constant_">SECRET_KEY</span>
        ).<span class="hljs-title function_">toString</span>();
        <span class="hljs-keyword">return</span> encrypted;
      },
      <span class="hljs-comment">// ååºåˆ—åŒ–ï¼ˆè¯»å–æ—¶è§£å¯†ï¼‰</span>
      <span class="hljs-attr">deserialize</span>: <span class="hljs-function">(<span class="hljs-params">encrypted</span>) =&gt;</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> decrypted = <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">AES</span>.<span class="hljs-title function_">decrypt</span>(encrypted, <span class="hljs-variable constant_">SECRET_KEY</span>).<span class="hljs-title function_">toString</span>(
            <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-property">enc</span>.<span class="hljs-property">Utf8</span>
          );
          <span class="hljs-keyword">return</span> decrypted ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(decrypted) : {};
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-keyword">return</span> {}; <span class="hljs-comment">// è§£å¯†å¤±è´¥è¿”å›ç©ºçŠ¶æ€</span>
        }
      },
    }
  )
);
</code></pre>
<h4 data-id="heading-6">4. æ‰‹åŠ¨æ§åˆ¶æŒä¹…åŒ–ï¼ˆæ¸…é™¤ / é‡æ–°åŠ è½½ï¼‰</h4>
<p>å¯é€šè¿‡Â <code>persist</code>Â è¿”å›çš„Â <code>persist</code>Â å¯¹è±¡æ‰‹åŠ¨æ“ä½œå­˜å‚¨ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: s.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
    }),
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'manual-storage'</span> }
  )
);

<span class="hljs-comment">// è·å–æŒä¹…åŒ–æ“ä½œæ–¹æ³•</span>
<span class="hljs-keyword">const</span> { persist } = useStore;

<span class="hljs-comment">// æ‰‹åŠ¨æ¸…é™¤æŒä¹…åŒ–æ•°æ®</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">clearStorage</span>(<span class="hljs-params"/>) {
  persist.<span class="hljs-title function_">clearStorage</span>(); <span class="hljs-comment">// æ¸…é™¤ localStorage ä¸­çš„æ•°æ®</span>
}

<span class="hljs-comment">// æ‰‹åŠ¨é‡æ–°åŠ è½½æŒä¹…åŒ–æ•°æ®</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reloadStorage</span>(<span class="hljs-params"/>) {
  persist.<span class="hljs-title function_">rehydrate</span>(); <span class="hljs-comment">// ä»å­˜å‚¨ä¸­é‡æ–°åŠ è½½çŠ¶æ€åˆ° store</span>
}

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ControlPanel</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{clearStorage}</span>&gt;</span>æ¸…é™¤æŒä¹…åŒ–æ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{reloadStorage}</span>&gt;</span>é‡æ–°åŠ è½½æ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-7">5. æŒä¹…åŒ–å†²çªå¤„ç†ï¼ˆå¤šæ ‡ç­¾é¡µåŒæ­¥ï¼‰</h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤šæ ‡ç­¾é¡µä¿®æ”¹çŠ¶æ€å¯èƒ½å¯¼è‡´å†²çªï¼Œå¯é€šè¿‡Â <code>merge</code>Â é…ç½®åˆå¹¶çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
    }),
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'sync-storage'</span>,
      <span class="hljs-comment">// åˆå¹¶å¤šæ ‡ç­¾é¡µçš„çŠ¶æ€ï¼ˆå–æœ€æ–°çš„ countï¼‰</span>
      <span class="hljs-attr">merge</span>: <span class="hljs-function">(<span class="hljs-params">persistedState, currentState</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> {
          ...currentState,
          <span class="hljs-attr">count</span>: persistedState.<span class="hljs-property">count</span> &gt; currentState.<span class="hljs-property">count</span> ? persistedState.<span class="hljs-property">count</span> : currentState.<span class="hljs-property">count</span>,
        };
      },
    }
  )
);
</code></pre>
<h3 data-id="heading-8">ä¸‰ã€å¸¸è§é—®é¢˜è§£å†³</h3>
<h4 data-id="heading-9">1. çŠ¶æ€ä¸æŒä¹…åŒ–ï¼Ÿ</h4>
<ul>
<li>æ£€æŸ¥Â <code>name</code>Â é…ç½®æ˜¯å¦å”¯ä¸€ï¼ˆé¿å…å’Œå…¶ä»–å­˜å‚¨å†²çªï¼‰ï¼›</li>
<li>ç¡®è®¤å­˜å‚¨çš„çŠ¶æ€æ˜¯å¯åºåˆ—åŒ–çš„ï¼ˆä¸èƒ½å­˜å‡½æ•°ã€Symbol ç­‰ï¼Œ<code>persist</code>Â ä¼šè‡ªåŠ¨å¿½ç•¥ä¸å¯åºåˆ—åŒ–å­—æ®µï¼‰ï¼›</li>
<li>è‹¥ç”¨è‡ªå®šä¹‰å­˜å‚¨ï¼ˆå¦‚ RN AsyncStorageï¼‰ï¼Œæ£€æŸ¥æ˜¯å¦å®‰è£…å¹¶é“¾æ¥ä¾èµ–ã€‚</li>
</ul>
<h4 data-id="heading-10">2. æŒä¹…åŒ–åçŠ¶æ€æ›´æ–°ä¸ç”Ÿæ•ˆï¼Ÿ</h4>
<ul>
<li>ç¡®ä¿ä¿®æ”¹çŠ¶æ€æ—¶ä½¿ç”¨Â <code>set</code>Â æ–¹æ³•ï¼ˆè€Œéç›´æ¥èµ‹å€¼ï¼‰ï¼›</li>
<li>è‹¥æ‰‹åŠ¨ä¿®æ”¹äº† localStorageï¼Œéœ€è°ƒç”¨Â <code>persist.rehydrate()</code>Â é‡æ–°åŠ è½½ã€‚</li>
</ul>
<h4 data-id="heading-11">3. ç±»å‹æŠ¥é”™ï¼ˆTypeScriptï¼‰ï¼Ÿ</h4>
<p>ä¸ºÂ <code>persist</code>Â æ˜¾å¼æŒ‡å®šçŠ¶æ€ç±»å‹</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CounterState</span> {
  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">const</span> useCounterStore = create&lt;<span class="hljs-title class_">CounterState</span>&gt;()(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: s.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
    }),
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'counter-storage'</span> }
  )
);
</code></pre>
<h3 data-id="heading-12">å››ã€æ€»ç»“</h3>
<p>Zustand æŒä¹…åŒ–çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ol>
<li><strong>æç®€é…ç½®</strong>ï¼šä¸€è¡Œä»£ç å®ç°åŸºç¡€æŒä¹…åŒ–ï¼Œæ— éœ€ç¹ççš„ reducer/action é…ç½®ï¼›</li>
<li><strong>é«˜åº¦çµæ´»</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰å­˜å‚¨ã€åŠ å¯†ã€éƒ¨åˆ†æŒä¹…åŒ–ã€æ‰‹åŠ¨æ§åˆ¶ï¼›</li>
<li><strong>è·¨å¹³å°</strong>ï¼šé€‚é… Webï¼ˆlocalStorage/sessionStorageï¼‰ã€React Nativeï¼ˆAsyncStorageï¼‰ï¼›</li>
<li><strong>æ€§èƒ½å‹å¥½</strong>ï¼šä»…åœ¨çŠ¶æ€å˜æ›´æ—¶è§¦å‘å­˜å‚¨ï¼Œæ— å¤šä½™æ€§èƒ½å¼€é”€ã€‚</li>
</ol>
<p>å®é™…å¼€å‘ä¸­ï¼Œä¼˜å…ˆä½¿ç”¨åŸºç¡€é…ç½®ï¼Œæ•æ„Ÿæ•°æ®åŠ è§£å¯†ï¼Œå¤šåœºæ™¯é€‚é…è‡ªå®šä¹‰å­˜å‚¨å³å¯æ»¡è¶³ 99% çš„éœ€æ±‚ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Web Worker å‰ç«¯å¤šçº¿ç¨‹è§£æ]]></title>    <link>https://juejin.cn/post/7584695558159663145</link>    <guid>https://juejin.cn/post/7584695558159663145</guid>    <pubDate>2025-12-18T02:05:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584695558159663145" data-draft-id="7584729825384235046" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Web Worker å‰ç«¯å¤šçº¿ç¨‹è§£æ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-18T02:05:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="äºŒäºŒå››ä¸€"/> <meta itemprop="url" content="https://juejin.cn/user/2975738274777080"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Web Worker å‰ç«¯å¤šçº¿ç¨‹è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2975738274777080/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    äºŒäºŒå››ä¸€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:05:55.000Z" title="Thu Dec 18 2025 02:05:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body ::selection{color:#fff;background-color:#ed7373}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:.6em;margin-top:1.5em;padding-bottom:4px;color:#ed7373}.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px}.markdown-body h4{font-size:16px}.markdown-body h5,.markdown-body h6{font-size:14px}.markdown-body p{line-height:inherit;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border-top:1px solid #dfe1e6;margin:33px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:rgba(239,198,221,.2666666667);color:#7b164f;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==") 10px 10px no-repeat;background-size:40px;background-color:#fdf8f8}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#fdf8f8}.markdown-body a{position:relative;text-decoration:underline;text-decoration-color:#ffd4d4;color:#ed7373;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAD1lJREFUeF7tnV122zgShQHJG5gT9/OkV2J7JR3voI/U707eI5/eQeyVRFlJa56nc2YDFjkHEulWHP3g5xZYAK5eku6QYOFWfSwUAJLW8EcFqMBJBSy1oQJU4LQCBITRQQXOKEBAGB5UgIAwBqhAnALMIHG68axGFCAgjTia3YxTgIDE6cazGlGAgDTiaHYzTgECEqcbz2pEAQLSiKPZzTgFCEicbjyrEQUISCOOZjfjFCAgcbrxrEYUICCNOJrdjFOAgMTpxrMaUYCANOJodjNOAQISpxvPakQBAtKIo9nNOAUISJxuPKsRBQhII45GdfN/v//+/l9//rlBtae9HQKi3UOZ7ft7sfhgjfm3sfa9u3RvzHtrjPv77r8PfpvemB0o1v3Z95tuNvt29fKyqQkgApI5ADVebgeFtTfGmA8I+3pj1rbv17Ouey4dFgKCiIgC2/i+WDwYax0QbzMDtDcjLC67/PL58xraeIbGCEgGkTVd4vty+QWVKUL75WCZb7f3JWUVAhLq5UKPHzLGRyXmP822208lgEJAlESMlBlDfeGyhsafelAIiMawAdjkpmO38/kXa8wtoDnRJvq+v79+fHwSvUhk4wQkUjjNp/33jz9uZ33/VbONP9nW9x/fPT5+0mYzAdHmkUR7lNUaob1RN+QiIKEuVHz838vl1xKGVOck1DbTRUAUB7yvaSXVG5592sy22zsNs1wExNNjWg+rEI5XqWfb7a9TQ0JAtEa+h101wzF0f/JMQkA8AlHjIQ3AMco+KSQERGP0X7CpITj2Skw4BUxACgOkOThG/0wECQEpCJBm4Rh81Fl7l3tHMAEpBJCJ4Hjq+/7bvOt229THGSVny8vV1W6b/Kzrbnprb088VAVXN/fMFgGBuxDfYE443L4oB0TM9OqwxcVtjJR7xiTzUIuA4OMZ2mI2OICBN+wgfpACJWcWISDQcMY2lgMOt7XjerW6w1q+b03sqUUgzJf6TUAuKTTRv+eAI8f0qdSwK1cWISATAXDusjngyDkj5PrTzedu+z2uNsmURQiIMkBqg2OUVwKSHFmEgCgCpFY4xCDJkEUIiBJAaodjlBlZuEtOMIz2EhAFgLQCxxtIIG9YkR5mEZCJAWkNjldIlsu/EEW79AsfCMiEgLQKx8EaCSKLPL1bre6l3EhApJS90G7LcKCziOQwi4BMAAjh+GGlPTmLSK7pEJDMgBCOfwRHvb9Lsg4hIBkBIRw/i/0dUawLrocQkEyAEI7jQoPeNi9WqBOQDIAQjtMig16uTUAyxLHIJQjHeVkRdYjkijoziAgW+0YJx2VxEYAYYzbvVqtfL18t/AgCEq6Z1xmEw0um3U2km8/dqnrS791qJRLLIo0m9bSCkwmHvxNBgDCD+Es+7ZGEI0x/DrHC9Cr6aMIR7j7ELBaL9HDds59BOOIkB33wh9O8cfLnOYtwxOsM+egPV9LjHSB9JuFIU/j7ctmntSD7cmvOYiV6B3IHPGOD5E7VxK4nnw4q0A03Kya7QqYBwpGmK6j+MFJrIK53zCCRPgZtsjt59Zozh+s0aP3DNSW2BkJAIuFATE2eu3TtcLi+w24wggU6AYkABDVuPnXpFuAAZg8jrReHWAGQIB177LLSzg7oqtih4Dcsig6vmEECw0CyKG8BDic3VEPh4RUBCQAENePSaubY1R2LxYOxNvklDa8aEpCACBY+FLKgdcTGZjLHYvHBWuu+PoX6iQ+vmEE8XQW/8w3XJRyeDjhymOTi4OHlWKRf8JFUYU444uGQXvsgIAG+kcgesXAM6y83/fAhGtv36242+5b708i+8kmtF+XKHhxiTZA9YuDwCLSn2Xb7KebLtL7BHnqch82hTY7HZ6k9xotxiHXGTejsEQXHcvnVGnPrEU2b2XZ7pwESQTjEFwbf6kxAzgGCeOvf2H7ElGQMoDmHH8ekk4RD8snBU2FAQE4oAy7Og594S7p+BIweGeriIZJw5CzMWaRfdDV0UStqzByTPX7oVt9/nHXdc64hV41wsEjPMLyKqTucWZAtGZkyiTAc2esOZpBMs1cpY2bIW89dP4UhkYZj6pqKNcgRWFBb2lO+fAQDxBiTYse5e4k0HMaY4NrNY/QcdAgBOSJX8vjf3biNWV+vVndB3jg4GPZA0b5N+BSwNByp+sXqzmleD+UQgMTWHqN5AgEIg0TAtrdemTxzjAYxgxzLIMul23X6wYOlU4dEzVy9bQw5zNq1DahHpOGYuuZgBvGI+uQZJEAgOjOHWsjB+t7DbK9DUgIQkVnPGZmadb0ECDyIGeR4Bkl6mRnS0WhIYsf2LcLhQoOACACCfk8T+Dnu4BetJa3qe9yxkTcUj8sFHUJAjgPiPugSO6yB1B9vzUJCEppFBLPHprP2Xut2fWaQE/eSxOJYBJDR1ETbXnscUosk12THdVYPBwE5AUhiQIgCAswk3tO+As/ji2oUNIa6cDCHWOBp3tDhS4wzUZD4ZhEkIDn0idH01DkEBAyIaw5dpB9zHqgu8FqQgw3rEncXIAPft60qAXF32JRt3qnBJ7X36a1TUwPX926O2Pbiey3fwM11XBWADGsFv5n9o6m72SfnkJ2Iff98/fj4FCJo6mpxrmnLVJCdJj4wp+pRKhxVFOmeBXXwSw2S7s6glXQfqJPs3N0/+nufG0jCdbyGcT59neKYYjNIxKfPvGdtnCM8wTvpM587M8LhgOGPVwDHTAz4wofQQaqNIgGJgGOvX8CdPXVYEXKtFOcm2+k5zHI2hmx7yTXMTNHO59ziAEne9uAJCeChqaCM5eOsY8cA7PSqQw6vPWSt13rvjV1PnbXPmlfHQ7QuChBEMIQUjAnj7uCMFeI09GxW7N1+54+uuxkmRf4z77p1yuxhigZS5xYDCAKOUUTfdQrELFGOoVZqvRQLiFRQamq3CECQcPhObY5OSs4iATNFsYGRamMNxXSsdpfOUw8IGg4nSMgdE5JFhCEhIJfCPP7fVQOCmKE5Ik3wRrnUABxtkLpTJ9vnOXERH2blnqkWECE4ot42gsoiodnLN6wAmwm91kJ87anpOJWAABa/Tvso8m6ZfJf+xyLo9G/ytPduCqr/+O7x8VNNgY3qizpAROEwJnh4NQodskh20TnAgITUaEB7Lva9sANUAZI6XXlB++Q7N3KohdqKgrApZNKisPhONlcNIMJwBM1cnVMVEZDIWgShGwrW5GhU2IAKQBBOPqct+g4JqUcAwxpI/ZHpAS+Fse9l0qSARG869Ora/iA0HK7NmJ2tP5kMAASUzaLrsgA3FHvopICUljkOvZwKCQJcRCYL2ZtWbJQnGD4ZICXDMeo93MHdO3yD36Hlux/slG8hs1ec4r2IziSAgIYGJzuHuDtfVG44IGr6FzG8An1gNKdWvppqOi47ILA73wkVp3B4ICTJY37gDSbZFk3BLGFLVkBQsy6nhJgCjtEWn5oEMd6HagjIZBJBqanNbIBAHXtEwSnhODRn2EP2MPy/sTaBPWWHrN20aKYJiLe2ZANEcguJVkenvp/rrbOQcEz13XHNMByzLQsgktlDKxzoQADWHXvTOLzyclEWQMB3vteOtQKHxNZ/bi/x4kP+AzpS2YNw+Dn46FHMHt7iiWcQiexBOLz9e+xATu0GyCcKiMSaB+EI8O6xQ5k9ggQUBQSxV+iwN4QjyLfMHslyCX7EE157NHLnkyjIxziRemkEIA7VNiGWQcDTkk28VEAUjgI/XqOBGjFAgMV5E0WlJBxcFIxHTQQQ5PCqhbpDGo7ZdntX2ztz40M+7EwRQICzV9VnD2E4RJ6oDAuxso8WAQRVf9S+2isNB4vydDhlAFku+3TT4t9hBbi2eBPScBhjmpjYkHaUXkAqntaVhgPx3Il04JXSPhwQVIFe6/CKcJSCxt5OrYBUWZwTjrLgEAEEMYNV4xCBcJQHhwggoECoqsAEaXIywmq8oWjBCT7EgkzxVlSgEw4toR5nBwGJ083rLMLhJZPqg/CALJdfjDHubYPxvwoyCOGId7+mM+GAgAKj6BoEpAFrDgWkqASk5KKTcCiIaqAJcEBanuYlHMDIVNIUHJBWV9IJh5KIBpsBB8TZB/gssSlpJyrhAEelouakAPkr5psZb3QpolAnHIqiWcAUEUBQj9tq37BIOAQiUlmTMoAsFh+stW49JO2neD2EcKS5tpSzRQBBzGSNAmrMIoSjlPBOt1MEkKFQR9Qh6t5CTjjSg66kFiQBSd9yMiqpZKhFOEoKbYytYoAgh1muq1MPtQgHJuBKa0UMEOgwa6/qZqr3OxGO0sIaZ68sIIvFg7H2I87c/JBAnm85I0DJ+86AflXblCggAlkkayZBreec8j7hUMvFq2HygOCzyM54ya0obj/Zdj7/Yo25lXIh4ZBSFtuuOCBCWWQPiTHr+XZ7j3zvrHS9Mdp9vVrdYV3J1iQUyAOIUBY5EORptt1+SgFlAMN933z8trmE3juoCYeItCKNZgFEMoscquKCz/b9etZ1zz6wDFDcmP1QShQMZg6R+BVvNBsgw7qIWzwUD8RBtU1vzMb93Q5/DkH63u5tyGXH63CQmUM8nuEXyAbILovID7XgAiEa5LAKoeI0bWQFpEVICMc0gY26anZActUjKIFS2iEcKerpOHcSQIbn1r/mrgNySk44cqotd61JAHHdqRkSwiEXsLlbngwQ19EJZrbE9SUc4hJnvcCkgFQHiZLnVrJGUOUXmxyQUV/pjYHSfmzhc9XSGmpsXw0gBU8Bbzpr73/5/Hmt0cG0KU0BVYAcQOLeDp91pTtGRtYbMaqVdY46QMa6xPb9g+R282Q3sd5IlrCEBlQCMgqndJariDc+lhB8JdioGpDXAn7/IjrxregXHJa8pb6EgKCNPypQBCATg0IwGqamKEB+GHp13U1v7a3Q1vWnvu+/XT8+PjUcG+z6/lGJ8n+uVhmK+nHmK2QGzD0zsnZAzLtu7fOgVfmKsQe+ClQByLHOur1eL1dXO1Bs170C089mm6uXl92DVITBN0zaPa5aQNp1KXuOVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFTg//8JNVC78ovQAAAAAElFTkSuQmCC");background-size:100%}.markdown-body a:active,.markdown-body a:hover{opacity:.66}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #ed7373;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#ed7373}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#fdf2f2}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #ed7373;background-color:#fdf2f2}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ed7373}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{appearance:none;-webkit-appearance:none;-moz-appearance:none;outline:none;width:16px;height:16px;border-radius:2px;background-color:transparent;box-shadow:inset 0 0 0 1px rgba(28,31,35,.3490196078);vertical-align:middle;margin:0;transform:translateY(-2px)}.markdown-body input[type=checkbox]:checked{background-color:#ed7373;background-image:url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGFyaWEtaGlkZGVuPSJ0cnVlIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3LjQxMSA3LjMwOGExLjUgMS41IDAgMDEuMjggMi4xMDNsLTYuNSA4LjVhMS41IDEuNSAwIDAxLTIuMzc1LjAxbC0zLjUtNC41YTEuNSAxLjUgMCAxMTIuMzY4LTEuODQybDIuMzA2IDIuOTY1IDUuMzE4LTYuOTU1YTEuNSAxLjUgMCAwMTIuMTAzLS4yOHoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=");box-shadow:inset 0 0 0 1px #ed7373}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">1. Web Worker å®šä¹‰</h2>
<p>Web Worker æ˜¯æµè§ˆå™¨æä¾›çš„å¤šçº¿ç¨‹èƒ½åŠ›ï¼Œå…è®¸åœ¨ä¸»çº¿ç¨‹ä¹‹å¤–è¿è¡Œ JavaScriptã€‚</p>
<p>å®ƒçš„ç›®æ ‡åªæœ‰ä¸€ä¸ªï¼š  ğŸ‘‰ <strong>æŠŠè€—æ—¶ä»»åŠ¡ä» UI çº¿ç¨‹ä¸­æŒªèµ°ï¼Œè®©é¡µé¢ä¿æŒæµç•…ã€‚</strong></p>
<h2 data-id="heading-1">2. Web Worker ä½œç”¨</h2>
<p>è§£å†³ä¸»çº¿ç¨‹çš„ç°å®å›°å¢ƒï¼Œä¸»çº¿ç¨‹åŒæ—¶è´Ÿè´£ï¼š</p>
<ul>
<li>JS æ‰§è¡Œ</li>
<li>é¡µé¢æ¸²æŸ“</li>
<li>ç”¨æˆ·äº¤äº’</li>
<li>äº‹ä»¶å“åº”</li>
</ul>
<p>ä¸€æ—¦é‡åˆ°ğŸ‘‡</p>
<ul>
<li>å¤§é‡è®¡ç®—</li>
<li>JSON è§£æ</li>
<li>æ–‡ä»¶å¤„ç†</li>
<li>å›¾ç‰‡ / è§†é¢‘å¤„ç†</li>
<li>é«˜é¢‘è½®è¯¢ / é•¿æ—¶é—´ä»»åŠ¡</li>
</ul>
<p>ğŸ‘‰ <strong>UI å°±ä¼šå¡ï¼Œé¡µé¢å°±ä¼šâ€œå‡æ­»â€ã€‚</strong></p>
<h2 data-id="heading-2">3. Web Worker çš„å·¥ä½œåŸç†</h2>
<h3 data-id="heading-3">1ï¸âƒ£ çº¿ç¨‹æ¨¡å‹</h3>
<pre><code class="hljs">ä¸»çº¿ç¨‹ï¼ˆUI / Reactï¼‰
   â”‚
   â”œâ”€â”€ postMessage
   â–¼
Worker çº¿ç¨‹ï¼ˆç‹¬ç«‹äº‹ä»¶å¾ªç¯ï¼‰
   â”‚
   â””â”€â”€ postMessage
</code></pre>
<ul>
<li>Worker è¿è¡Œåœ¨ <strong>ç‹¬ç«‹çº¿ç¨‹</strong></li>
<li>æ‹¥æœ‰è‡ªå·±çš„äº‹ä»¶å¾ªç¯</li>
<li><strong>ä¸ä¼šé˜»å¡ UI</strong></li>
</ul>
<h3 data-id="heading-4">2ï¸âƒ£ é€šä¿¡æœºåˆ¶</h3>
<ul>
<li>ä½¿ç”¨ <code>postMessage</code> ä¼ é€’æ¶ˆæ¯</li>
<li>é»˜è®¤é‡‡ç”¨ <strong>structured cloneï¼ˆæ·±æ‹·è´ï¼‰</strong></li>
<li>å¯ä½¿ç”¨ <strong>Transferable</strong>ï¼ˆå¦‚ ArrayBufferï¼‰è½¬ç§»æ‰€æœ‰æƒï¼Œé¿å…æ‹·è´</li>
</ul>
<p>âš ï¸ Worker <strong>ä¸èƒ½è®¿é—® DOM / window / document</strong>ï¼Œä¸»çº¿ç¨‹çš„ä¸Šä¸‹æ–‡</p>
<h2 data-id="heading-5">4. Web Worker çš„ç±»å‹</h2>



































<table><thead><tr><th>ç±»å‹</th><th>åç§°</th><th>ç‰¹ç‚¹</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>Dedicated Worker</td><td>ä¸“ç”¨ Worker</td><td>ä¸€å¯¹ä¸€ã€æœ€å¸¸ç”¨</td><td>è®¡ç®—ã€è§£æã€åå°ä»»åŠ¡</td></tr><tr><td>Shared Worker</td><td>å…±äº« Worker</td><td>å¤šé¡µé¢å…±äº«</td><td>å¤šæ ‡ç­¾é¡µå…±äº«çŠ¶æ€</td></tr><tr><td>Service Worker</td><td>service Worker</td><td>æ‹¦æˆªç½‘ç»œè¯·æ±‚</td><td>PWA / ç¦»çº¿ç¼“å­˜</td></tr><tr><td>Worklet</td><td>â€”â€”</td><td>ä½å»¶è¿Ÿ</td><td>éŸ³é¢‘ / æ¸²æŸ“</td></tr></tbody></table>
<p>ğŸ‘‰ <strong>æ—¥å¸¸ä¸šåŠ¡ä¸­ 90% ç”¨ Dedicated Worker</strong></p>
<h2 data-id="heading-6">5. Web Worker çš„ç‰¹ç‚¹</h2>
<ul>
<li>âœ… çœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œ</li>
<li>âœ… é¿å…ä¸»çº¿ç¨‹é˜»å¡</li>
<li>âŒ ä¸èƒ½æ“ä½œ DOM</li>
<li>âŒ åˆ›å»ºå’Œé€šä¿¡æœ‰æˆæœ¬</li>
<li>âš ï¸ æ•°æ®ä¼ è¾“éœ€è¦è€ƒè™‘æ€§èƒ½</li>
</ul>
<h2 data-id="heading-7">6. ä¼˜ç¼ºç‚¹å¯¹ç…§</h2>
<ol>
<li>âœ… ä¼˜ç‚¹</li>
</ol>
<ul>
<li>æå‡é¡µé¢å“åº”é€Ÿåº¦</li>
<li>é€‚åˆ CPU å¯†é›†å‹ä»»åŠ¡</li>
<li>å¯ä½œä¸ºåå°â€œè®¡ç®—å¼•æ“â€</li>
<li>å¯å‘é€å¼‚æ­¥è¯·æ±‚</li>
<li>å¯è¿è¡Œ fetch / WebSocket / IndexedDB</li>
</ul>
<ol start="2">
<li>âŒ ç¼ºç‚¹</li>
</ol>
<ul>
<li>æ— æ³•æ“ä½œ DOM</li>
<li>é€šä¿¡å­˜åœ¨æ•°æ®æ‹·è´æˆæœ¬</li>
<li>åˆ›å»º/é”€æ¯å¼€é”€ä¸å°</li>
<li>è°ƒè¯•ã€æ‰“åŒ…éœ€è¦é¢å¤–é…ç½®</li>
</ul>
<h2 data-id="heading-8">7. React ä¸­å¦‚ä½•ä¼˜é›…ä½¿ç”¨ Web Worker</h2>
<ol>
<li>âŒ å¸¸è§è¯¯åŒº</li>
</ol>
<ul>
<li>æ¯ä¸ªç»„ä»¶ new ä¸€ä¸ª Worker</li>
<li>Worker ç”Ÿå‘½å‘¨æœŸä¸æ¸…ç†</li>
<li>ä¸»çº¿ç¨‹/Worker å¼ºè€¦åˆ</li>
</ul>
<ol start="2">
<li>âœ… æ¨èæ¨¡å¼ï¼šHook + å•ä¾‹ Worker</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> { post } = useWorker() <span class="hljs-comment">// React Hook åº“</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> post(<span class="hljs-string">'compute'</span>, payload)

</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>Worker åªåˆ›å»ºä¸€æ¬¡</li>
<li>Promise åŒ–è°ƒç”¨</li>
<li>ç»„ä»¶åªå…³å¿ƒç»“æœ</li>
</ul>
<blockquote>
<p>Web Worker æ˜¯å…¨å±€èµ„æºï¼Œè€Œä¸æ˜¯ç»„ä»¶èµ„æºã€‚</p>
</blockquote>
<h2 data-id="heading-9">8. å…¸å‹é€‚ç”¨åœºæ™¯</h2>
<ol>
<li>ğŸ”¥ å¼ºçƒˆæ¨èä½¿ç”¨</li>
</ol>
<ul>
<li>å¤§æ•°æ®è®¡ç®— / æ’åº / è¿‡æ»¤</li>
<li>å›¾ç‰‡å¤„ç†ã€å‹ç¼©ã€æ»¤é•œ</li>
<li>è§†é¢‘è½¬ç ã€éŸ³é¢‘åˆ†æ</li>
<li>æ–‡ä»¶è§£æï¼ˆCSV / Excel / JSONï¼‰</li>
<li>åŠ å¯†ã€è§£å¯†ã€å“ˆå¸Œè®¡ç®—</li>
</ul>
<ol start="2">
<li>âš ï¸ è°¨æ…ä½¿ç”¨</li>
</ol>
<ul>
<li>è½»é‡é€»è¾‘</li>
<li>é«˜é¢‘çŸ­ä»»åŠ¡</li>
<li>å¼ºä¾èµ– DOM çš„æ“ä½œ</li>
</ul>
<h2 data-id="heading-10">10. Web Worker + WebSocketï¼ˆå·¥ç¨‹è¿›é˜¶ï¼‰</h2>
<p>ä¸€ä¸ªéå¸¸å®ç”¨çš„ç»„åˆï¼š</p>
<ul>
<li>Worker é‡Œç»´æŠ¤ WebSocket</li>
<li>å¤„ç†å¿ƒè·³ / é‡è¿ / è§£æ</li>
<li>ä¸»çº¿ç¨‹åªè´Ÿè´£ UI æ¸²æŸ“</li>
</ul>
<p>ä¼˜åŠ¿ï¼š</p>
<ul>
<li>UI ä¸å—ç½‘ç»œæŠ–åŠ¨å½±å“</li>
<li>è¿æ¥é€»è¾‘é«˜åº¦è§£è€¦</li>
<li>æ›´ç¨³å®šçš„å®æ—¶é€šä¿¡</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ React UI   â”‚
â”‚            â”‚
â”‚ è®¢é˜…æ•°æ®   â”‚
â”‚ postMessageâ”‚
â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ structured <span class="hljs-built_in">clone</span>
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web Worker â”‚
â”‚            â”‚
â”‚ WebSocket  â”‚
â”‚ å¿ƒè·³/é‡è¿  â”‚
â”‚ é™æµ/èšåˆ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript Date çš„é‚£äº›äº‹]]></title>    <link>https://juejin.cn/post/7584702863689547791</link>    <guid>https://juejin.cn/post/7584702863689547791</guid>    <pubDate>2025-12-18T02:11:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584702863689547791" data-draft-id="7584689488771039267" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript Date çš„é‚£äº›äº‹"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2025-12-18T02:11:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="paradeå²æœˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3773179639113831"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript Date çš„é‚£äº›äº‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3773179639113831/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    paradeå²æœˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:11:02.000Z" title="Thu Dec 18 2025 02:11:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ—¶é—´çš„"é•¿ç›¸"ï¼šä½ çœ‹åˆ°çš„æ—¶é—´æœ‰å“ªäº›å½¢å¼?</h2>
<p>åœ¨ä»£ç ä¸­,æ—¶é—´é€šå¸¸ä»¥ä¸¤ç§å½¢å¼å­˜åœ¨:<strong>æ—¶é—´æˆ³</strong>å’Œ<strong>å­—ç¬¦ä¸²</strong>ã€‚</p>
<h3 data-id="heading-1">1.1 æ—¶é—´æˆ³ (Timestamp)</h3>
<p>æ—¶é—´æˆ³æ˜¯ä¸€ä¸ªæ•°å­—,è¡¨ç¤ºä» <strong>1970 å¹´ 1 æœˆ 1 æ—¥ 00:00:00 UTC</strong>(ç§°ä¸º Unix çºªå…ƒ)åˆ°æŸä¸ªæ—¶åˆ»ç»è¿‡çš„æ—¶é—´ã€‚</p>
<h4 data-id="heading-2">ç§’çº§ vs æ¯«ç§’çº§</h4>
<ul>
<li><strong>ç§’çº§æ—¶é—´æˆ³</strong>:Unix/Linux ç³»ç»Ÿå¸¸ç”¨,å¦‚ <code>1734345000</code></li>
<li><strong>æ¯«ç§’çº§æ—¶é—´æˆ³</strong>:JavaScript ä½¿ç”¨çš„æ˜¯è¿™ç§,å¦‚ <code>1734345000000</code></li>
</ul>
<blockquote>
<p><strong>ğŸ’¡ æç¤º</strong>:ä¸¤è€…å·® 1000 å€,ä½æ•°ç›¸å·® 3 ä½ã€‚ç§’çº§ 10 ä½æ•°,æ¯«ç§’çº§ 13 ä½æ•°ã€‚</p>
</blockquote>
<h4 data-id="heading-3">è·å–æ—¶é—´æˆ³çš„æ–¹å¼</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·å–å½“å‰æ—¶é—´çš„æ¯«ç§’çº§æ—¶é—´æˆ³</span>
<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() <span class="hljs-comment">// âœ… æ¨è,ç®€æ´é«˜æ•ˆ</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() <span class="hljs-comment">// ç­‰ä»·,ä½†å¤šåˆ›å»ºäº†ä¸€ä¸ª Date å¯¹è±¡</span>
+<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() <span class="hljs-comment">// éšå¼è½¬æ¢,ä¸æ¨è(å¯è¯»æ€§å·®)</span>

<span class="hljs-comment">// ç¤ºä¾‹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()) <span class="hljs-comment">// 1734345000000</span>
</code></pre>
<h3 data-id="heading-4">1.2 å­—ç¬¦ä¸²å½¢å¼</h3>
<p>æ—¶é—´å­—ç¬¦ä¸²æœ‰å¤šç§æ ¼å¼æ ‡å‡†,äº†è§£å®ƒä»¬èƒ½å¸®ä½ é¿å…å¾ˆå¤šè§£æé—®é¢˜ã€‚</p>
<h4 data-id="heading-5">ISO 8601 æ ‡å‡†(æ¨è)</h4>
<p>å›½é™…æ ‡å‡†åŒ–ç»„ç»‡åˆ¶å®šçš„æ ¼å¼,<strong>è·¨å¹³å°ã€è·¨è¯­è¨€é€šç”¨</strong>ã€‚</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">2025-12-16T10:30:00.000Z</span>
â”‚    â”‚  â”‚ â”‚ â”‚  â”‚  â”‚   â””â”€â”€ Z è¡¨ç¤º UTC æ—¶åŒº(ä¹Ÿå¯ä»¥æ˜¯ +08:00)
â”‚    â”‚  â”‚ â”‚ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€ æ¯«ç§’
â”‚    â”‚  â”‚ â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç§’
â”‚    â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†
â”‚    â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¶
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ—¥
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å¹´
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ISO å­—ç¬¦ä¸²ç¤ºä¾‹</span>
<span class="hljs-string">'2025-12-16'</span> <span class="hljs-comment">// åªæœ‰æ—¥æœŸéƒ¨åˆ†</span>
<span class="hljs-string">'2025-12-16T10:30:00'</span> <span class="hljs-comment">// ä¸å¸¦æ—¶åŒº(ä¼šè¢«å½“ä½œæœ¬åœ°æ—¶é—´)</span>
<span class="hljs-string">'2025-12-16T10:30:00Z'</span> <span class="hljs-comment">// UTC æ—¶é—´</span>
<span class="hljs-string">'2025-12-16T10:30:00+08:00'</span> <span class="hljs-comment">// å¸¦æ—¶åŒºåç§»(ä¸œå…«åŒº)</span>
</code></pre>
<h4 data-id="heading-6">RFC 2822 æ ‡å‡†</h4>
<p>å¸¸è§äºé‚®ä»¶å¤´ã€HTTP å“åº”å¤´ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-string">'Mon, 16 Dec 2025 10:30:00 GMT'</span>
<span class="hljs-string">'Tue, 16 Dec 2025 18:30:00 +0800'</span>
</code></pre>
<h4 data-id="heading-7">æœ¬åœ°åŒ–å­—ç¬¦ä¸²</h4>
<p>å› åœ°åŒºã€è¯­è¨€è€Œå¼‚,<strong>ä¸å»ºè®®ç”¨äºæ•°æ®ä¼ è¾“</strong>,ä»…ç”¨äºå±•ç¤ºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-string">'2025å¹´12æœˆ16æ—¥'</span> <span class="hljs-comment">// ä¸­æ–‡</span>
<span class="hljs-string">'12/16/2025'</span> <span class="hljs-comment">// ç¾å¼(æœˆ/æ—¥/å¹´)</span>
<span class="hljs-string">'16/12/2025'</span> <span class="hljs-comment">// æ¬§å¼(æ—¥/æœˆ/å¹´)</span>
<span class="hljs-string">'December 16, 2025'</span> <span class="hljs-comment">// è‹±æ–‡</span>
</code></pre>
<h4 data-id="heading-8">å„æ ¼å¼é€‚ç”¨åœºæ™¯</h4>






























<table><thead><tr><th>æ ¼å¼</th><th>é€‚ç”¨åœºæ™¯</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>æ—¶é—´æˆ³</td><td>å­˜å‚¨ã€è®¡ç®—ã€æ¥å£ä¼ è¾“</td><td>æœ€é€šç”¨,æ— æ­§ä¹‰</td></tr><tr><td>ISO 8601</td><td>æ¥å£ä¼ è¾“ã€æ—¥å¿—ã€æ•°æ®åº“</td><td>æ ‡å‡†æ ¼å¼,å¼ºçƒˆæ¨è</td></tr><tr><td>RFC 2822</td><td>é‚®ä»¶ã€HTTP å¤´</td><td>ç‰¹å®šåè®®ä½¿ç”¨</td></tr><tr><td>æœ¬åœ°åŒ–å­—ç¬¦ä¸²</td><td>ä»…ç”¨äº UI å±•ç¤º</td><td>å±•ç¤ºå‹å¥½,ä½†ä¸èƒ½ç”¨äºä¼ è¾“</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">äºŒã€åˆ›å»º Date å¯¹è±¡çš„å‡ ç§æ–¹å¼</h2>
<h3 data-id="heading-10">2.1 æ— å‚æ„é€ :è·å–å½“å‰æ—¶é—´</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> now = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(now) <span class="hljs-comment">// Mon Dec 16 2024 18:30:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)</span>
</code></pre>
<h3 data-id="heading-11">2.2 æ—¶é—´æˆ³æ„é€ </h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¯«ç§’çº§æ—¶é—´æˆ³</span>
<span class="hljs-keyword">const</span> date1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">1734345000000</span>)

<span class="hljs-comment">// âš ï¸ å¦‚æœåç«¯è¿”å›ç§’çº§æ—¶é—´æˆ³,è®°å¾—ä¹˜ 1000</span>
<span class="hljs-keyword">const</span> backendTimestamp = <span class="hljs-number">1734345000</span> <span class="hljs-comment">// ç§’çº§</span>
<span class="hljs-keyword">const</span> date2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(backendTimestamp * <span class="hljs-number">1000</span>)
</code></pre>
<blockquote>
<p><strong>ğŸ’¡ å¸¸è§é”™è¯¯</strong>:å¿˜è®°è½¬æ¢ç§’çº§æ—¶é—´æˆ³,å¯¼è‡´æ—¥æœŸæ˜¾ç¤ºä¸º 1970 å¹´ã€‚</p>
</blockquote>
<h3 data-id="heading-12">2.3 å­—ç¬¦ä¸²æ„é€ (é‡ç‚¹:å¯é æ€§é—®é¢˜)</h3>
<h4 data-id="heading-13">âœ… ISO æ ¼å¼æœ€å¯é </h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è¿™äº›åœ¨æ‰€æœ‰ç°ä»£æµè§ˆå™¨ä¸­è¡¨ç°ä¸€è‡´</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16T10:30:00.000Z'</span>) <span class="hljs-comment">// UTC æ—¶é—´</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16T10:30:00+08:00'</span>) <span class="hljs-comment">// å¸¦æ—¶åŒº</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16T10:30:00'</span>) <span class="hljs-comment">// æœ¬åœ°æ—¶é—´</span>
</code></pre>
<h4 data-id="heading-14">âš ï¸ ä¸å¯é çš„å­—ç¬¦ä¸²æ ¼å¼</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. çº¯æ—¥æœŸå­—ç¬¦ä¸² - æ—¶åŒºè¡Œä¸ºä¸ä¸€è‡´!</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16'</span>)
<span class="hljs-comment">// Chrome/Firefox: å½“ä½œ UTC 00:00:00,è½¬æœ¬åœ°æ—¶é—´æ˜¯ 08:00:00</span>
<span class="hljs-comment">// Safari/iOS Safari: å½“ä½œæœ¬åœ°æ—¶é—´ 00:00:00</span>
<span class="hljs-comment">// ç»“æœ: åŒä¸€ä¸ªå­—ç¬¦ä¸²,ä¸åŒæµè§ˆå™¨å¯èƒ½ç›¸å·® 8 å°æ—¶!</span>

<span class="hljs-comment">// 2. æ–œæ åˆ†éš” - éƒ¨åˆ†æµè§ˆå™¨ä¸æ”¯æŒ</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025/12/16'</span>) <span class="hljs-comment">// å¤§éƒ¨åˆ†æµè§ˆå™¨ OK,ä½†ä¸æ˜¯æ ‡å‡†</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'12/16/2025'</span>) <span class="hljs-comment">// ç¾å¼æ ¼å¼,ä¾èµ–æµè§ˆå™¨å®ç°</span>

<span class="hljs-comment">// 3. å…¶ä»–æ ¼å¼ - ç»“æœä¸å¯é¢„æµ‹</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'16-12-2025'</span>) <span class="hljs-comment">// âŒ å¯èƒ½è¿”å› Invalid Date</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'12-16-2025'</span>) <span class="hljs-comment">// âŒ ä¸åŒæµè§ˆå™¨è§£æä¸åŒ</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'December 16, 2025'</span>) <span class="hljs-comment">// âš ï¸ èƒ½ç”¨,ä½†ä¾èµ–è‹±æ–‡ç¯å¢ƒ</span>

<span class="hljs-comment">// 4. å¸¦ä¸­æ–‡ - å®Œå…¨ä¸æ”¯æŒ</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025å¹´12æœˆ16æ—¥'</span>) <span class="hljs-comment">// âŒ Invalid Date</span>
</code></pre>
<h4 data-id="heading-15">ğŸ’¡ æœ€ä½³å®è·µ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¦‚æœæ‹¿åˆ°éæ ‡å‡†æ ¼å¼,å…ˆè½¬æˆ ISO æˆ–æ—¶é—´æˆ³</span>
<span class="hljs-keyword">const</span> dateStr = <span class="hljs-string">'16/12/2025'</span> <span class="hljs-comment">// æ¬§å¼æ ¼å¼</span>
<span class="hljs-keyword">const</span> [day, month, year] = dateStr.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)
<span class="hljs-keyword">const</span> safeDate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">`<span class="hljs-subst">${year}</span>-<span class="hljs-subst">${month.padStart(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)}</span>-<span class="hljs-subst">${day.padStart(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)}</span>`</span>)

<span class="hljs-comment">// æˆ–è€…ä½¿ç”¨æ—¥æœŸåº“(å¦‚ Day.js)å¤„ç†</span>
</code></pre>
<h3 data-id="heading-16">2.4 æ—¶é—´åˆ†é‡æ„é€ (æœˆä»½å‘ç‚¹é¢„å‘Š)</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// new Date(year, monthIndex, day, hours, minutes, seconds, ms)</span>
<span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">11</span>, <span class="hljs-number">16</span>, <span class="hljs-number">10</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>)
<span class="hljs-comment">//                         â†‘</span>
<span class="hljs-comment">//                    æ³¨æ„: 11 è¡¨ç¤º 12 æœˆ!</span>
</code></pre>
<p>è¿™å°±å¼•å‡ºäº†ä¸‹ä¸€ç« çš„é‡ç‚¹â€”â€”æœˆä»½ä» 0 å¼€å§‹çš„é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-17">ä¸‰ã€æœˆä»½ä» 0 å¼€å§‹:åˆ°åº•æ˜¯å“ªé‡Œçš„å‘?</h2>
<p>è¿™æ˜¯ JavaScript Date æœ€è‡­åæ˜­è‘—çš„è®¾è®¡ä¹‹ä¸€ã€‚ä½†å¾ˆå¤šäººå¯¹å®ƒæœ‰è¯¯è§£,è®©æˆ‘ä»¬æ¥æ¾„æ¸…ã€‚</p>
<h3 data-id="heading-18">3.1 æ¾„æ¸…è¯¯åŒº:å­—ç¬¦ä¸²æ„é€ ä¸å—å½±å“</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… å­—ç¬¦ä¸²ä¸­çš„ 12 å°±æ˜¯ 12 æœˆ,æ²¡æœ‰ä»»ä½•é—®é¢˜</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16'</span>) <span class="hljs-comment">// 12 æœˆ 16 æ—¥</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16T10:30'</span>) <span class="hljs-comment">// 12 æœˆ 16 æ—¥ 10:30</span>

<span class="hljs-comment">// âœ… ISO å­—ç¬¦ä¸²ä¸­çš„æœˆä»½æ˜¯æ­£å¸¸çš„ 1-12</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-01-01'</span>) <span class="hljs-comment">// 1 æœˆ 1 æ—¥</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-31'</span>) <span class="hljs-comment">// 12 æœˆ 31 æ—¥</span>
</code></pre>
<h3 data-id="heading-19">3.2 çœŸæ­£çš„å‘ç‚¹:æ—¶é—´åˆ†é‡æ„é€ å’Œ getter/setter</h3>
<h4 data-id="heading-20">å‘ç‚¹ 1:æ—¶é—´åˆ†é‡æ„é€ </h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ å¸¸è§é”™è¯¯: ç¬¬äºŒä¸ªå‚æ•°ä»¥ä¸ºæ˜¯æœˆä»½(1-12)</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">12</span>, <span class="hljs-number">16</span>) <span class="hljs-comment">// é”™è¯¯! è¿™æ˜¯ 2026 å¹´ 1 æœˆ 16 æ—¥</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)   <span class="hljs-comment">// é”™è¯¯! è¿™æ˜¯ 2 æœˆ 1 æ—¥,ä¸æ˜¯ 1 æœˆ</span>

<span class="hljs-comment">// âœ… æ­£ç¡®å†™æ³•: ç¬¬äºŒä¸ªå‚æ•°æ˜¯ monthIndex(0-11)</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">11</span>, <span class="hljs-number">16</span>) <span class="hljs-comment">// 2025 å¹´ 12 æœˆ 16 æ—¥</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)   <span class="hljs-comment">// 2025 å¹´ 1 æœˆ 1 æ—¥</span>
</code></pre>
<h4 data-id="heading-21">å‘ç‚¹ 2:getMonth() è¿”å› 0-11</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16'</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(date.<span class="hljs-title function_">getMonth</span>()) <span class="hljs-comment">// 11,ä¸æ˜¯ 12!</span>

<span class="hljs-comment">// âœ… æƒ³è¦å¾—åˆ°æ­£å¸¸æœˆä»½,éœ€è¦ +1</span>
<span class="hljs-keyword">const</span> month = date.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span> <span class="hljs-comment">// 12</span>

<span class="hljs-comment">// âŒ å¸¸è§é”™è¯¯: å¿˜è®° +1</span>
<span class="hljs-keyword">const</span> wrongMonth = date.<span class="hljs-title function_">getMonth</span>() <span class="hljs-comment">// 11 (é”™è¯¯!)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å½“å‰æœˆä»½æ˜¯ <span class="hljs-subst">${wrongMonth}</span> æœˆ`</span>) <span class="hljs-comment">// "å½“å‰æœˆä»½æ˜¯ 11 æœˆ"(å®é™…æ˜¯ 12 æœˆ)</span>
</code></pre>
<h4 data-id="heading-22">å‘ç‚¹ 3:setMonth() åŒæ ·æ˜¯ 0-11</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-06-16'</span>)

<span class="hljs-comment">// âŒ é”™è¯¯: ä»¥ä¸ºæ˜¯è®¾ç½®ä¸º 12 æœˆ</span>
date.<span class="hljs-title function_">setMonth</span>(<span class="hljs-number">12</span>) <span class="hljs-comment">// å®é™…è®¾ç½®ä¸ºä¸‹ä¸€å¹´ 1 æœˆ!</span>

<span class="hljs-comment">// âœ… æ­£ç¡®: è®¾ç½®ä¸º 12 æœˆ</span>
date.<span class="hljs-title function_">setMonth</span>(<span class="hljs-number">11</span>)
</code></pre>
<h3 data-id="heading-23">3.3 ä¸ºä»€ä¹ˆè®¾è®¡æˆè¿™æ ·?</h3>
<p>è¿™æ˜¯å†å²é—ç•™é—®é¢˜ã€‚JavaScript çš„ Date å¯¹è±¡è®¾è®¡å€Ÿé‰´äº† Java çš„ <code>java.util.Date</code>(Java åæ¥ä¹ŸåºŸå¼ƒäº†è¿™ä¸ªç±»)ã€‚</p>
<p>å¯èƒ½çš„åŸå› :</p>
<ol>
<li><strong>æ•°ç»„ç´¢å¼•æ€ç»´</strong>:æœˆä»½å¯ä»¥ç›´æ¥ä½œä¸ºæœˆä»½åç§°æ•°ç»„çš„ç´¢å¼•</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> months = [<span class="hljs-string">'January'</span>, <span class="hljs-string">'February'</span>, <span class="hljs-string">'March'</span>, <span class="hljs-string">'April'</span>, <span class="hljs-string">'May'</span>, <span class="hljs-string">'June'</span>,
                <span class="hljs-string">'July'</span>, <span class="hljs-string">'August'</span>, <span class="hljs-string">'September'</span>, <span class="hljs-string">'October'</span>, <span class="hljs-string">'November'</span>, <span class="hljs-string">'December'</span>]
<span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(months[date.<span class="hljs-title function_">getMonth</span>()]) <span class="hljs-comment">// ç›´æ¥å–æœˆä»½å,æ— éœ€ -1</span>
</code></pre>
<ol start="2">
<li><strong>æ—©æœŸè®¾è®¡ä»“ä¿ƒ</strong>:JavaScript åªç”¨äº† 10 å¤©è®¾è®¡å‡ºæ¥,å¾ˆå¤šå†³ç­–æ²¡æœ‰æ·±æ€ç†Ÿè™‘</li>
</ol>
<h3 data-id="heading-24">3.4 è®°å¿†å£è¯€</h3>
<blockquote>
<p><strong>å­—ç¬¦ä¸²æœˆä»½æ­£å¸¸å†™,åˆ†é‡æ„é€ å’Œ getter è¦å‡ä¸€(æˆ–ä» 0 å¼€å§‹)ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-25">å››ã€Date çš„å…¶ä»–å¸¸è§å‘</h2>
<h3 data-id="heading-26">4.1 æ—¶åŒºé—®é¢˜:æœ¬åœ°æ—¶é—´ vs UTC æ—¶é—´</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16T00:00:00Z'</span>) <span class="hljs-comment">// UTC æ—¶é—´åˆå¤œ</span>

<span class="hljs-comment">// æœ¬åœ°æ—¶é—´æ–¹æ³•(å—æ—¶åŒºå½±å“)</span>
date.<span class="hljs-title function_">getHours</span>() <span class="hljs-comment">// 8 (åŒ—äº¬æ—¶é—´ +8 å°æ—¶)</span>
date.<span class="hljs-title function_">getDate</span>() <span class="hljs-comment">// 16</span>
date.<span class="hljs-title function_">getDay</span>() <span class="hljs-comment">// 2 (å‘¨äºŒ)</span>

<span class="hljs-comment">// UTC æ—¶é—´æ–¹æ³•(ä¸å—æ—¶åŒºå½±å“)</span>
date.<span class="hljs-title function_">getUTCHours</span>() <span class="hljs-comment">// 0</span>
date.<span class="hljs-title function_">getUTCDate</span>() <span class="hljs-comment">// 16</span>
date.<span class="hljs-title function_">getUTCDay</span>() <span class="hljs-comment">// 2</span>

<span class="hljs-comment">// toString ä¹Ÿä¸åŒ</span>
date.<span class="hljs-title function_">toString</span>() 
<span class="hljs-comment">// "Tue Dec 16 2025 08:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)"</span>

date.<span class="hljs-title function_">toISOString</span>() 
<span class="hljs-comment">// "2025-12-16T00:00:00.000Z"</span>

date.<span class="hljs-title function_">toUTCString</span>() 
<span class="hljs-comment">// "Tue, 16 Dec 2025 00:00:00 GMT"</span>
</code></pre>
<blockquote>
<p><strong>ğŸ’¡ æç¤º</strong>:æ¶‰åŠè·¨æ—¶åŒºåœºæ™¯æ—¶,ç»Ÿä¸€ä½¿ç”¨ UTC æ—¶é—´,é¿å…æ··ä¹±ã€‚</p>
</blockquote>
<h3 data-id="heading-27">4.2 æœˆæœ«æº¢å‡º:è‡ªåŠ¨è¿›ä½</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Date ä¼šè‡ªåŠ¨å¤„ç†æº¢å‡º,è¿™æœ‰æ—¶æ˜¯ feature,æœ‰æ—¶æ˜¯ bug</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">0</span>, <span class="hljs-number">32</span>) <span class="hljs-comment">// 1 æœˆ 32 æ—¥ â†’ 2 æœˆ 1 æ—¥</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">1</span>, <span class="hljs-number">30</span>) <span class="hljs-comment">// 2 æœˆ 30 æ—¥ â†’ 3 æœˆ 2 æ—¥(2025 éé—°å¹´)</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">11</span>, <span class="hljs-number">32</span>) <span class="hljs-comment">// 12 æœˆ 32 æ—¥ â†’ 2026 å¹´ 1 æœˆ 1 æ—¥</span>

<span class="hljs-comment">// âœ… åˆ©ç”¨è¿™ä¸ªç‰¹æ€§è·å–æŸæœˆæœ€åä¸€å¤©</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getLastDayOfMonth</span>(<span class="hljs-params">year, month</span>) {
  <span class="hljs-comment">// month æ˜¯ 1-12,æ‰€ä»¥ month ä½œä¸º monthIndex å°±æ˜¯ä¸‹ä¸ªæœˆ</span>
  <span class="hljs-comment">// day ä¼  0 è¡¨ç¤ºä¸Šä¸ªæœˆæœ€åä¸€å¤©</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(year, month, <span class="hljs-number">0</span>).<span class="hljs-title function_">getDate</span>()
}

<span class="hljs-title function_">getLastDayOfMonth</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">2</span>) <span class="hljs-comment">// 28 (2 æœˆæœ€åä¸€å¤©)</span>
<span class="hljs-title function_">getLastDayOfMonth</span>(<span class="hljs-number">2024</span>, <span class="hljs-number">2</span>) <span class="hljs-comment">// 29 (2024 æ˜¯é—°å¹´)</span>
<span class="hljs-title function_">getLastDayOfMonth</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">12</span>) <span class="hljs-comment">// 31 (12 æœˆæœ€åä¸€å¤©)</span>
</code></pre>
<h4 data-id="heading-28">æ›´å¤šç‰¹æ®Šå‚æ•°ç”¨æ³•</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// day ä¼  0: ä¸Šä¸ªæœˆæœ€åä¸€å¤©</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// 2025-02-28 (2 æœˆæœ€åä¸€å¤©)</span>

<span class="hljs-comment">// day ä¼ è´Ÿæ•°: å¾€å‰æ¨</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">2</span>, -<span class="hljs-number">1</span>) <span class="hljs-comment">// 2025-02-27 (2 æœˆå€’æ•°ç¬¬äºŒå¤©)</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// 2024-12-31 (å»å¹´æœ€åä¸€å¤©)</span>

<span class="hljs-comment">// è·å–ä¸Šä¸ªæœˆåŒä¸€å¤©</span>
<span class="hljs-keyword">const</span> today = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">2</span>, <span class="hljs-number">15</span>) <span class="hljs-comment">// 3 æœˆ 15 æ—¥</span>
<span class="hljs-keyword">const</span> lastMonth = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">1</span>, <span class="hljs-number">15</span>) <span class="hljs-comment">// 2 æœˆ 15 æ—¥</span>

<span class="hljs-comment">// è·å–ä¸‹ä¸ªæœˆç¬¬ä¸€å¤©</span>
<span class="hljs-keyword">const</span> nextMonthFirst = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-number">2025</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// 4 æœˆ 1 æ—¥</span>

<span class="hljs-comment">// âœ… åˆ¤æ–­æ˜¯å¦ä¸ºé—°å¹´</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isLeapYear</span>(<span class="hljs-params">year</span>) {
  <span class="hljs-comment">// 2 æœˆ 29 æ—¥å¦‚æœå­˜åœ¨,å°±æ˜¯é—°å¹´</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(year, <span class="hljs-number">1</span>, <span class="hljs-number">29</span>).<span class="hljs-title function_">getDate</span>() === <span class="hljs-number">29</span>
}

<span class="hljs-title function_">isLeapYear</span>(<span class="hljs-number">2024</span>) <span class="hljs-comment">// true</span>
<span class="hljs-title function_">isLeapYear</span>(<span class="hljs-number">2025</span>) <span class="hljs-comment">// false</span>
</code></pre>
<h3 data-id="heading-29">4.3 Invalid Date:å¦‚ä½•åˆ¤æ–­æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> valid = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16'</span>)
<span class="hljs-keyword">const</span> invalid = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'not a date'</span>)

<span class="hljs-comment">// âœ… æ–¹æ³• 1: æ£€æŸ¥ getTime() æ˜¯å¦ä¸º NaN (æ¨è)</span>
<span class="hljs-built_in">isNaN</span>(valid.<span class="hljs-title function_">getTime</span>()) <span class="hljs-comment">// false</span>
<span class="hljs-built_in">isNaN</span>(invalid.<span class="hljs-title function_">getTime</span>()) <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ–¹æ³• 2: è½¬å­—ç¬¦ä¸²æ£€æŸ¥</span>
invalid.<span class="hljs-title function_">toString</span>() <span class="hljs-comment">// "Invalid Date"</span>

<span class="hljs-comment">// æ–¹æ³• 3: ä½¿ç”¨ valueOf()</span>
<span class="hljs-built_in">isNaN</span>(invalid.<span class="hljs-title function_">valueOf</span>()) <span class="hljs-comment">// true</span>

<span class="hljs-comment">// âœ… å°è£…æˆå‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isValidDate</span>(<span class="hljs-params">date</span>) {
  <span class="hljs-keyword">return</span> date <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span> &amp;&amp; !<span class="hljs-built_in">isNaN</span>(date.<span class="hljs-title function_">getTime</span>())
}

<span class="hljs-comment">// æµ‹è¯•</span>
<span class="hljs-title function_">isValidDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) <span class="hljs-comment">// true</span>
<span class="hljs-title function_">isValidDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'invalid'</span>)) <span class="hljs-comment">// false</span>
<span class="hljs-title function_">isValidDate</span>(<span class="hljs-string">'2025-12-16'</span>) <span class="hljs-comment">// false (ä¸æ˜¯ Date å¯¹è±¡)</span>
</code></pre>
<h3 data-id="heading-30">4.4 Date å¯¹è±¡æ¯”è¾ƒçš„é™·é˜±</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> date1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16'</span>)
<span class="hljs-keyword">const</span> date2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16'</span>)

<span class="hljs-comment">// âŒ é”™è¯¯: ç›´æ¥æ¯”è¾ƒä¼šæ¯”è¾ƒå¼•ç”¨,è€Œéå€¼</span>
date1 == date2 <span class="hljs-comment">// false</span>
date1 === date2 <span class="hljs-comment">// false</span>

<span class="hljs-comment">// âœ… æ­£ç¡®: è½¬æˆæ—¶é—´æˆ³æ¯”è¾ƒ</span>
date1.<span class="hljs-title function_">getTime</span>() === date2.<span class="hljs-title function_">getTime</span>() <span class="hljs-comment">// true</span>
+date1 === +date2 <span class="hljs-comment">// true (éšå¼è½¬æ¢)</span>

<span class="hljs-comment">// âœ… æ¯”è¾ƒå¤§å°(å¯ä»¥ç›´æ¥æ¯”è¾ƒ,ä¼šè‡ªåŠ¨è½¬æ—¶é—´æˆ³)</span>
date1 &gt; date2 <span class="hljs-comment">// false</span>
date1 &lt; date2 <span class="hljs-comment">// false</span>
date1 &gt;= date2 <span class="hljs-comment">// true</span>

<span class="hljs-comment">// å®é™…åº”ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> deadline = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-31'</span>)
<span class="hljs-keyword">const</span> today = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
<span class="hljs-keyword">if</span> (today &gt; deadline) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å·²è¿‡æœŸ'</span>)
}
</code></pre>
<h3 data-id="heading-31">4.5 æ—¶é—´æˆ³ç²¾åº¦é—®é¢˜</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JavaScript çš„ Number ç±»å‹æ˜¯ 64 ä½æµ®ç‚¹æ•°</span>
<span class="hljs-comment">// å®‰å…¨æ•´æ•°èŒƒå›´: -(2^53 - 1) åˆ° (2^53 - 1)</span>
<span class="hljs-title class_">Number</span>.<span class="hljs-property">MAX_SAFE_INTEGER</span> <span class="hljs-comment">// 9007199254740991</span>

<span class="hljs-comment">// å¯¹äºæ—¶é—´æˆ³æ¥è¯´:</span>
<span class="hljs-comment">// æ¯«ç§’çº§æ—¶é—´æˆ³åœ¨ 2287 å¹´ä¹‹å‰éƒ½æ˜¯å®‰å…¨çš„</span>
<span class="hljs-keyword">const</span> year2287 = <span class="hljs-number">9999999999999</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(year2287) <span class="hljs-comment">// Sat Nov 20 2286 17:46:39 GMT+0800</span>

<span class="hljs-comment">// âš ï¸ ä½†å¦‚æœåç«¯è¿”å›å¾®ç§’çº§æˆ–çº³ç§’çº§æ—¶é—´æˆ³,å¯èƒ½è¶…å‡ºå®‰å…¨èŒƒå›´</span>
<span class="hljs-keyword">const</span> microTimestamp = <span class="hljs-number">1734345000000000</span> <span class="hljs-comment">// å¾®ç§’çº§(16ä½,è¶…å‡ºå®‰å…¨èŒƒå›´)</span>
<span class="hljs-comment">// è¿™ç§æƒ…å†µéœ€è¦ç”¨ BigInt æˆ–å­—ç¬¦ä¸²å¤„ç†</span>

<span class="hljs-comment">// è§£å†³æ–¹æ¡ˆç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> microStr = <span class="hljs-string">'1734345000000000'</span>
<span class="hljs-keyword">const</span> millisTimestamp = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Number</span>(microStr) / <span class="hljs-number">1000</span>)
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(millisTimestamp)
</code></pre>
<h3 data-id="heading-32">4.6 æ ¼å¼åŒ–å›°éš¾:æ²¡æœ‰å†…ç½® format æ–¹æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16T10:30:00'</span>)

<span class="hljs-comment">// æƒ³è¦ "2025-12-16" æ ¼å¼? åªèƒ½æ‰‹åŠ¨æ‹¼æ¥</span>
<span class="hljs-keyword">const</span> year = date.<span class="hljs-title function_">getFullYear</span>()
<span class="hljs-keyword">const</span> month = <span class="hljs-title class_">String</span>(date.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>) <span class="hljs-comment">// åˆ«å¿˜äº† +1!</span>
<span class="hljs-keyword">const</span> day = <span class="hljs-title class_">String</span>(date.<span class="hljs-title function_">getDate</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
<span class="hljs-keyword">const</span> formatted = <span class="hljs-string">`<span class="hljs-subst">${year}</span>-<span class="hljs-subst">${month}</span>-<span class="hljs-subst">${day}</span>`</span> <span class="hljs-comment">// "2025-12-16"</span>

<span class="hljs-comment">// æƒ³è¦ "2025-12-16 10:30:00"? ç»§ç»­æ‹¼...</span>
<span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">String</span>(date.<span class="hljs-title function_">getHours</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
<span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">String</span>(date.<span class="hljs-title function_">getMinutes</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
<span class="hljs-keyword">const</span> seconds = <span class="hljs-title class_">String</span>(date.<span class="hljs-title function_">getSeconds</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
<span class="hljs-keyword">const</span> fullFormatted = <span class="hljs-string">`<span class="hljs-subst">${year}</span>-<span class="hljs-subst">${month}</span>-<span class="hljs-subst">${day}</span> <span class="hljs-subst">${hours}</span>:<span class="hljs-subst">${minutes}</span>:<span class="hljs-subst">${seconds}</span>`</span>

<span class="hljs-comment">// ğŸ˜« æ¯æ¬¡éƒ½è¦å†™è¿™ä¹ˆå¤šä»£ç </span>

<span class="hljs-comment">// âœ… å°è£…æˆå·¥å…·å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">formatDate</span>(<span class="hljs-params">date, format = <span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span></span>) {
  <span class="hljs-keyword">const</span> year = date.<span class="hljs-title function_">getFullYear</span>()
  <span class="hljs-keyword">const</span> month = <span class="hljs-title class_">String</span>(date.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
  <span class="hljs-keyword">const</span> day = <span class="hljs-title class_">String</span>(date.<span class="hljs-title function_">getDate</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
  <span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">String</span>(date.<span class="hljs-title function_">getHours</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
  <span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">String</span>(date.<span class="hljs-title function_">getMinutes</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
  <span class="hljs-keyword">const</span> seconds = <span class="hljs-title class_">String</span>(date.<span class="hljs-title function_">getSeconds</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>)
  
  <span class="hljs-keyword">return</span> format
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'YYYY'</span>, year)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'MM'</span>, month)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'DD'</span>, day)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'HH'</span>, hours)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'mm'</span>, minutes)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'ss'</span>, seconds)
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-title function_">formatDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) <span class="hljs-comment">// "2025-12-16 10:30:00"</span>
<span class="hljs-title function_">formatDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-string">'YYYY/MM/DD'</span>) <span class="hljs-comment">// "2025/12/16"</span>
</code></pre>
<h3 data-id="heading-33">4.7 Date å¯¹è±¡æ˜¯å¯å˜çš„</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âš ï¸ Date å¯¹è±¡çš„ setter æ–¹æ³•ä¼šä¿®æ”¹åŸå¯¹è±¡</span>
<span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16'</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(date.<span class="hljs-title function_">toString</span>()) <span class="hljs-comment">// "Mon Dec 16 2025..."</span>

date.<span class="hljs-title function_">setMonth</span>(<span class="hljs-number">0</span>) <span class="hljs-comment">// ä¿®æ”¹ä¸º 1 æœˆ</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(date.<span class="hljs-title function_">toString</span>()) <span class="hljs-comment">// "Thu Jan 16 2025..." (åŸå¯¹è±¡è¢«æ”¹å˜!)</span>

<span class="hljs-comment">// è¿™åœ¨å‡½æ•°ä¼ å‚æ—¶å®¹æ˜“äº§ç”Ÿå‰¯ä½œç”¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addOneDay</span>(<span class="hljs-params">date</span>) {
  date.<span class="hljs-title function_">setDate</span>(date.<span class="hljs-title function_">getDate</span>() + <span class="hljs-number">1</span>)
  <span class="hljs-keyword">return</span> date <span class="hljs-comment">// âš ï¸ è¿”å›çš„æ˜¯ä¿®æ”¹åçš„åŸå¯¹è±¡</span>
}

<span class="hljs-keyword">const</span> original = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-12-16'</span>)
<span class="hljs-keyword">const</span> next = <span class="hljs-title function_">addOneDay</span>(original)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(original.<span class="hljs-title function_">toString</span>()) <span class="hljs-comment">// åŸå¯¹è±¡ä¹Ÿå˜äº†!</span>

<span class="hljs-comment">// âœ… æ­£ç¡®åšæ³•: å…ˆå¤åˆ¶å†ä¿®æ”¹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addOneDaySafe</span>(<span class="hljs-params">date</span>) {
  <span class="hljs-keyword">const</span> newDate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(date.<span class="hljs-title function_">getTime</span>()) <span class="hljs-comment">// å¤åˆ¶</span>
  newDate.<span class="hljs-title function_">setDate</span>(newDate.<span class="hljs-title function_">getDate</span>() + <span class="hljs-number">1</span>)
  <span class="hljs-keyword">return</span> newDate
}
</code></pre>
<hr/>
<h2 data-id="heading-34">äº”ã€Day.js è§£å†³äº†å“ªäº›ç—›ç‚¹? (å¯¹æ¯”åŸç”Ÿ Date)</h2>
<p>Day.js æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ—¥æœŸå¤„ç†åº“(ä»… 2KB gzip),API è®¾è®¡å€Ÿé‰´äº† Moment.js,ä½†æ›´åŠ ç°ä»£å’Œè½»ä¾¿ã€‚</p>
<h3 data-id="heading-35">5.1 ç—›ç‚¹å¯¹æ¯”è¡¨</h3>























































<table><thead><tr><th>ç—›ç‚¹</th><th>åŸç”Ÿ Date</th><th>Day.js</th></tr></thead><tbody><tr><td><strong>æœˆä»½ä» 0 å¼€å§‹</strong></td><td><code>getMonth()</code> è¿”å› 0-11,éœ€è¦æ‰‹åŠ¨ +1</td><td><code>month()</code> ä¹Ÿæ˜¯ 0-11,ä½† <code>format('M')</code> è‡ªåŠ¨è¾“å‡º 1-12</td></tr><tr><td><strong>æ ¼å¼åŒ–æ—¥æœŸ</strong></td><td>æ— å†…ç½®æ–¹æ³•,éœ€æ‰‹åŠ¨æ‹¼æ¥åå‡ è¡Œä»£ç </td><td><code>format('YYYY-MM-DD HH:mm:ss')</code> ä¸€è¡Œæå®š</td></tr><tr><td><strong>å­—ç¬¦ä¸²è§£æä¸ä¸€è‡´</strong></td><td>ä¸åŒæµè§ˆå™¨ç»“æœä¸åŒ,é ISO æ ¼å¼ä¸å¯é </td><td>ç»Ÿä¸€è§£æ,<code>customParseFormat</code> æ’ä»¶æ”¯æŒä»»æ„æ ¼å¼</td></tr><tr><td><strong>æ—¥æœŸåŠ å‡</strong></td><td>éœ€æ‰‹åŠ¨è®¡ç®—æ¯«ç§’æˆ–ç”¨ <code>setDate()</code> ç­‰æ–¹æ³•</td><td><code>add(7, 'day')</code>ã€<code>subtract(1, 'month')</code> è¯­ä¹‰æ¸…æ™°</td></tr><tr><td><strong>æ—¥æœŸæ¯”è¾ƒ</strong></td><td>éœ€è½¬æ—¶é—´æˆ³æ¯”è¾ƒ,ä»£ç å†—é•¿</td><td><code>isBefore()</code>ã€<code>isAfter()</code>ã€<code>isSame()</code> ç›´è§‚æ˜“è¯»</td></tr><tr><td><strong>ä¸å¯å˜æ€§</strong></td><td><code>setMonth()</code> ç­‰æ–¹æ³•ä¼šä¿®æ”¹åŸå¯¹è±¡,æ˜“äº§ç”Ÿ bug</td><td>æ‰€æœ‰æ“ä½œè¿”å›æ–°å¯¹è±¡,åŸå¯¹è±¡ä¸å˜,é¿å…å‰¯ä½œç”¨</td></tr><tr><td><strong>æ—¶åŒºå¤„ç†</strong></td><td>åªæœ‰æœ¬åœ°å’Œ UTC,åˆ‡æ¢éº»çƒ¦</td><td><code>timezone</code> æ’ä»¶è½»æ¾å¤„ç†ä»»æ„æ—¶åŒº</td></tr><tr><td><strong>ç›¸å¯¹æ—¶é—´</strong></td><td>æ— å†…ç½®æ”¯æŒ</td><td><code>fromNow()</code> ç›´æ¥è¾“å‡º"3 å¤©å‰"ã€"2 å°æ—¶å"</td></tr><tr><td><strong>ä½“ç§¯</strong></td><td>å†…ç½®,0 æˆæœ¬</td><td>~2KB gzip,æè½»é‡</td></tr></tbody></table>
<h3 data-id="heading-36">5.2 Day.js åŸºæœ¬ä½¿ç”¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> dayjs <span class="hljs-keyword">from</span> <span class="hljs-string">'dayjs'</span>

<span class="hljs-comment">// åˆ›å»ºæ—¥æœŸå¯¹è±¡</span>
<span class="hljs-title function_">dayjs</span>() <span class="hljs-comment">// å½“å‰æ—¶é—´</span>
<span class="hljs-title function_">dayjs</span>(<span class="hljs-string">'2025-12-16'</span>) <span class="hljs-comment">// ä»å­—ç¬¦ä¸²</span>
<span class="hljs-title function_">dayjs</span>(<span class="hljs-number">1734345000000</span>) <span class="hljs-comment">// ä»æ—¶é—´æˆ³</span>
<span class="hljs-title function_">dayjs</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) <span class="hljs-comment">// ä» Date å¯¹è±¡</span>

<span class="hljs-comment">// æ ¼å¼åŒ– (æœ€å¸¸ç”¨!)</span>
<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">format</span>(<span class="hljs-string">'YYYY-MM-DD'</span>) <span class="hljs-comment">// "2025-12-16"</span>
<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">format</span>(<span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span>) <span class="hljs-comment">// "2025-12-16 10:30:00"</span>
<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">format</span>(<span class="hljs-string">'YYYYå¹´MMæœˆDDæ—¥'</span>) <span class="hljs-comment">// "2025å¹´12æœˆ16æ—¥"</span>

<span class="hljs-comment">// æ—¥æœŸåŠ å‡</span>
<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">add</span>(<span class="hljs-number">7</span>, <span class="hljs-string">'day'</span>) <span class="hljs-comment">// 7 å¤©å</span>
<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">subtract</span>(<span class="hljs-number">1</span>, <span class="hljs-string">'month'</span>) <span class="hljs-comment">// 1 ä¸ªæœˆå‰</span>
<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-string">'year'</span>) <span class="hljs-comment">// 1 å¹´å</span>

<span class="hljs-comment">// æ—¥æœŸæ¯”è¾ƒ</span>
<span class="hljs-title function_">dayjs</span>(<span class="hljs-string">'2025-12-16'</span>).<span class="hljs-title function_">isBefore</span>(<span class="hljs-string">'2025-12-17'</span>) <span class="hljs-comment">// true</span>
<span class="hljs-title function_">dayjs</span>(<span class="hljs-string">'2025-12-16'</span>).<span class="hljs-title function_">isAfter</span>(<span class="hljs-string">'2025-12-15'</span>) <span class="hljs-comment">// true</span>
<span class="hljs-title function_">dayjs</span>(<span class="hljs-string">'2025-12-16'</span>).<span class="hljs-title function_">isSame</span>(<span class="hljs-string">'2025-12-16'</span>) <span class="hljs-comment">// true</span>

<span class="hljs-comment">// ç›¸å¯¹æ—¶é—´ (éœ€è¦ relativeTime æ’ä»¶)</span>
<span class="hljs-keyword">import</span> relativeTime <span class="hljs-keyword">from</span> <span class="hljs-string">'dayjs/plugin/relativeTime'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'dayjs/locale/zh-cn'</span>
dayjs.<span class="hljs-title function_">extend</span>(relativeTime)
dayjs.<span class="hljs-title function_">locale</span>(<span class="hljs-string">'zh-cn'</span>)

<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">fromNow</span>() <span class="hljs-comment">// "å‡ ç§’å‰"</span>
<span class="hljs-title function_">dayjs</span>().<span class="hljs-title function_">add</span>(<span class="hljs-number">3</span>, <span class="hljs-string">'day'</span>).<span class="hljs-title function_">fromNow</span>() <span class="hljs-comment">// "3 å¤©å"</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ•°æ®å¤§å±å¸¸ç”¨å¸ƒå±€-ç­‰æ¯”ç¼©æ”¾å¸ƒå±€(Scale Laylout)-ä½¿ç”¨ CSS Transform Scale å®ç°ç­‰æ¯”ç¼©æ”¾]]></title>    <link>https://juejin.cn/post/7584722109584146475</link>    <guid>https://juejin.cn/post/7584722109584146475</guid>    <pubDate>2025-12-18T02:10:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584722109584146475" data-draft-id="7584722109584097323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ•°æ®å¤§å±å¸¸ç”¨å¸ƒå±€-ç­‰æ¯”ç¼©æ”¾å¸ƒå±€(Scale  Laylout)-ä½¿ç”¨ CSS Transform Scale å®ç°ç­‰æ¯”ç¼©æ”¾"/> <meta itemprop="keywords" content="å‰ç«¯,CSS"/> <meta itemprop="datePublished" content="2025-12-18T02:10:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç é€”æ½‡æ½‡"/> <meta itemprop="url" content="https://juejin.cn/user/2386391857112611"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ•°æ®å¤§å±å¸¸ç”¨å¸ƒå±€-ç­‰æ¯”ç¼©æ”¾å¸ƒå±€(Scale  Laylout)-ä½¿ç”¨ CSS Transform Scale å®ç°ç­‰æ¯”ç¼©æ”¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2386391857112611/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç é€”æ½‡æ½‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:10:26.000Z" title="Thu Dec 18 2025 02:10:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ•°æ®å¤§å±å¸¸ç”¨å¸ƒå±€-ç­‰æ¯”ç¼©æ”¾å¸ƒå±€(Scale  Laylout)-ä½¿ç”¨ CSS Transform Scale å®ç°ç­‰æ¯”ç¼©æ”¾</h2>
<h2 data-id="heading-1">1.ä»‹ç»</h2>
<h3 data-id="heading-2">1.1 å…¸å‹ç‰¹å¾å’Œå…¸å‹ç‰¹ç‚¹</h3>
<p>Scale Layout çš„å…¸å‹ç‰¹å¾ï¼š</p>
<blockquote>
<p>1.æµè§ˆå™¨ç¼©å°</p>
<p>2.æ•´ä¸ªé¡µé¢ä¸€èµ·ç¼©</p>
<p>3.å¸ƒå±€ä¸å˜</p>
<p>4.å­—ä½“å¯ä»¥ç¼©åˆ°å‡  px</p>
</blockquote>
<p>å·¥ç¨‹ä¸Šæ„å‘³ç€ï¼š</p>
<ul>
<li>é¡µé¢æœ‰ä¸€ä¸ªå›ºå®šâ€œè®¾è®¡å°ºå¯¸â€</li>
<li>æµè§ˆå™¨å˜åŒ–æ—¶ ä¸é‡æ’ï¼ˆä¸ reflowï¼‰</li>
<li>åªæ˜¯ æ•´ä½“åš transform</li>
</ul>
<p>ä¸ºä»€ä¹ˆé€‚åˆæ•°æ®å¤§å±ï¼Ÿ</p>
<p>æ•°æ®å¤§å±çš„å…¸å‹ç‰¹ç‚¹</p>
<ul>
<li>å›ºå®šåˆ†è¾¨ç‡è®¾è®¡ï¼ˆ1920Ã—1080 / 3840Ã—2160ï¼‰</li>
<li>ä¸»è¦æ˜¯ çœ‹ï¼Œä¸æ˜¯ ç‚¹</li>
<li>è¿è¡Œç¯å¢ƒå¯æ§ï¼ˆä¼šè®®å®¤ / å¤§å±ç”µè§†ï¼‰</li>
</ul>
<h3 data-id="heading-3">1.2 æ•ˆæœå±•ç¤º</h3>
<p>æ•ˆæœå®ç°å±•ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e98d559d9d84481975c2ff8079c7848~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB6YCU5r2H5r2H:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766628625&amp;x-signature=wjsPffTfH8KjbdK6dxh1JSWzUts%3D" alt="å½•å±2025-12-17 09.44.00 (online-video-cutter.com) - Compressed with FlexClip (2)" loading="lazy"/></p>
<h3 data-id="heading-4">1.3 CSS ç¼–å†™åŸåˆ™</h3>
<p>åœ¨è¿™ç§æ–¹æ¡ˆä¸‹ï¼Œä½ çš„ CSS ç¼–å†™åŸåˆ™æ˜¯</p>
<p>CSS ä¸–ç•Œé‡Œæ°¸è¿œæ˜¯ 1920Ã—1080ï¼Œç¼©æ”¾äº¤ç»™ JSï¼Œä½¿ç”¨å›ºå®š pxï¼Œä¸è¦å†™å“åº”å¼</p>
<h2 data-id="heading-5">2.å®æˆ˜æ¡ˆä¾‹-ä½¿ç”¨ CSS Transform Scale å®ç°ç­‰æ¯”ç¼©æ”¾</h2>
<ol>
<li>å›ºå®šè®¾è®¡å°ºå¯¸</li>
</ol>
<p>åœ¨å…¨å±€æ ·å¼ä¸­ï¼Œ#app è¢«è®¾ç½®ä¸ºå›ºå®šçš„è®¾è®¡å°ºå¯¸ï¼š</p>
<p>Index.css</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-id">#app</span> {
  <span class="hljs-keyword">@apply</span> inline-block absolute left-<span class="hljs-number">1</span>/<span class="hljs-number">2</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">1920px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">1080px</span>;
  <span class="hljs-attribute">transform-origin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.9</span>);
}
</code></pre>
<ol start="2">
<li>åŠ¨æ€ç¼©æ”¾è®¡ç®—</li>
</ol>
<p>ä½¿ç”¨ useScreenScale hook è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { onMounted, onUnmounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">useScreenScale</span> = (<span class="hljs-params"/>) =&gt; {
	<span class="hljs-comment">/**
	 * Scales the screen based on the design dimensions.
	 * window resize is not usually triggered, so no need to use debounce
	 * <span class="hljs-doctag">@return</span> {<span class="hljs-type">void</span>} This function does not return a value.
	 */</span>
	<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleScreenScale</span> = (<span class="hljs-params"/>) =&gt; {
		<span class="hljs-keyword">const</span> designDreftWidth = <span class="hljs-number">1920</span>
		<span class="hljs-keyword">const</span> designDreftHeight = <span class="hljs-number">1080</span>

		<span class="hljs-keyword">const</span> scale =
			<span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientWidth</span> / <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientHeight</span> &lt;
			designDreftWidth / designDreftHeight
				? <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientWidth</span> / designDreftWidth
				: <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientHeight</span> / designDreftHeight

		<span class="hljs-keyword">if</span> (<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#app'</span>) !== <span class="hljs-literal">null</span>) {
			;(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#app'</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>).<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> =
				<span class="hljs-string">`scale(<span class="hljs-subst">${scale}</span>) translate(-50%)`</span>
		}
	}
	<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
		<span class="hljs-title function_">handleScreenScale</span>()
		<span class="hljs-variable language_">window</span>.<span class="hljs-property">onresize</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">handleScreenScale</span>()
	})

	<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
		<span class="hljs-variable language_">window</span>.<span class="hljs-property">onresize</span> = <span class="hljs-literal">null</span>
	})
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useScreenScale
</code></pre>
<p>ç¼©æ”¾é€»è¾‘ï¼š</p>
<ul>
<li>
<p>æ¯”è¾ƒå½“å‰å±å¹•å®½é«˜æ¯”ä¸è®¾è®¡ç¨¿å®½é«˜æ¯”ï¼ˆ16:9ï¼‰</p>
</li>
<li>
<p>å¦‚æœå±å¹•æ›´çª„ï¼šæŒ‰å®½åº¦ç¼©æ”¾ scale = å±å¹•å®½åº¦ / 1920</p>
</li>
<li>
<p>å¦‚æœå±å¹•æ›´é«˜ï¼šæŒ‰é«˜åº¦ç¼©æ”¾ scale = å±å¹•é«˜åº¦ / 1080</p>
</li>
<li>
<p>åº”ç”¨å˜æ¢ï¼štransform: scale(scale) translate(-50%)</p>
<ul>
<li>translate(-50%)å’Œleftï¼ˆ50%ï¼‰é…åˆï¼Œå®ç°æ°´å¹³å±…ä¸­</li>
</ul>
</li>
<li>
<p>scale() ç¼©æ”¾ï¼Œscaleå°±æ˜¯ç¼©æ”¾æ¯”ä¾‹</p>
</li>
<li>
<p>translate(-50%) é…åˆ left-1/2 å®ç°å±…ä¸­</p>
</li>
</ul>
<ol start="3">
<li>åœ¨ App.vue ä¸­å¯ç”¨</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
<span class="hljs-title function_">useScreenScale</span>()
&lt;/script&gt;
</code></pre>
<p>é¡µé¢å¦‚ä½•å®ç°ç­‰æ¯”ç¼©æ”¾?</p>
<p>é¡µé¢æ— éœ€é¢å¤–å¤„ç†ï¼Œå› ä¸ºï¼š</p>
<blockquote>
<p>æ‰€æœ‰é¡µé¢éƒ½åœ¨ #app å†…éƒ¨</p>
<p>#app æ•´ä½“ç¼©æ”¾ï¼Œå†…éƒ¨å…ƒç´ è‡ªåŠ¨è·Ÿéš</p>
<p>ä½¿ç”¨å›ºå®šåƒç´ å€¼å³å¯ï¼Œä¾‹å¦‚ï¼š</p>
</blockquote>
<pre><code class="hljs language-html" lang="html"> <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-[1114px] h-full"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">HistoryEventsList</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">"historyEventsListRef"</span>
          @<span class="hljs-attr">update:queryParams</span>=<span class="hljs-string">"handleTrendQuery"</span>
          @<span class="hljs-attr">open:warningEventDetail</span>=<span class="hljs-string">"handleOpenWarningEventDetail"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"w-[738px] h-full"</span>&gt;</span>
</code></pre>
<p>è¿™äº›å›ºå®šåƒç´ å€¼ï¼ˆå¦‚ 1114pxã€738pxï¼‰ä¼šéš #app çš„ç¼©æ”¾æ¯”ä¾‹è‡ªåŠ¨ç¼©æ”¾ã€‚</p>
<h2 data-id="heading-6">3.æ³¨æ„å‘ç‚¹-  Element Plus å¼¹å‡ºå±‚çš„é»˜è®¤è¡Œä¸º</h2>
<p>Element Plus å¼¹å‡ºå±‚çš„é»˜è®¤è¡Œä¸ºï¼ŒElement Plus çš„å¼¹å‡ºå±‚ç»„ä»¶ï¼ˆel-selectã€el-cascaderã€el-date-picker ç­‰ï¼‰é»˜è®¤ä¼šå°†ä¸‹æ‹‰èœå•æŒ‚è½½åˆ° body ä¸Šï¼Œè€Œä¸æ˜¯ç»„ä»¶æ‰€åœ¨çš„ DOM æ ‘ä¸­ã€‚</p>
<p>DOM ç»“æ„ç¤ºæ„ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>  â† è¿™é‡Œåº”ç”¨äº† transform: scale(0.75)
    <span class="hljs-tag">&lt;<span class="hljs-name">HistoryEventsList</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-select</span>&gt;</span>  â† è¾“å…¥æ¡†åœ¨è¿™é‡Œ
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-select</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">HistoryEventsList</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  
  <span class="hljs-comment">&lt;!-- é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸‹æ‹‰èœå•ä¼šæŒ‚è½½åˆ°è¿™é‡Œ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"el-select-dropdown"</span>&gt;</span>  â† ä¸‹æ‹‰èœå•åœ¨ body ä¸‹ï¼Œä¸åœ¨ #app å†…ï¼
    <span class="hljs-tag">&lt;<span class="hljs-name">el-option</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">el-option</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<p>ç”±äºç¼©æ”¾æ˜¯å†™åœ¨appä¸Šçš„ï¼Œä½†æ˜¯å¼¹å‡ºå±‚æŒ‚åœ¨äº†bodyä¸Šï¼Œæ‰€ä»¥åº”è¯¥å°†å¼¹å‡ºå±‚æŒ‚åˆ°appä¸Š,ä½¿ç”¨append-to="#app"</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">el-date-picker</span>
            <span class="hljs-attr">v-model</span>=<span class="hljs-string">"currentDateRange"</span>
            <span class="hljs-attr">:shortcuts</span>=<span class="hljs-string">"EVENT_SHORTCUTS"</span>
            <span class="hljs-attr">append-to</span>=<span class="hljs-string">"#app"</span>
            <span class="hljs-attr">type</span>=<span class="hljs-string">"daterange"</span>
            <span class="hljs-attr">range-separator</span>=<span class="hljs-string">"è‡³"</span>
            <span class="hljs-attr">start-placeholder</span>=<span class="hljs-string">"å¼€å§‹æ—¥æœŸ"</span>
            <span class="hljs-attr">end-placeholder</span>=<span class="hljs-string">"ç»“æŸæ—¥æœŸ"</span>
            <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>
            <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ width: '100%', height: '32px' }"</span>
          /&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOSæ•°æ®æŒä¹…åŒ–æœ€ä½³å®è·µâ€”â€”Preferencesé¦–é€‰é¡¹å­˜å‚¨è¯¦è§£]]></title>    <link>https://juejin.cn/post/7584730308752850994</link>    <guid>https://juejin.cn/post/7584730308752850994</guid>    <pubDate>2025-12-18T02:35:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584730308752850994" data-draft-id="7584714813366321190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOSæ•°æ®æŒä¹…åŒ–æœ€ä½³å®è·µâ€”â€”Preferencesé¦–é€‰é¡¹å­˜å‚¨è¯¦è§£"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-18T02:35:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·73614681275"/> <meta itemprop="url" content="https://juejin.cn/user/433640354087403"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOSæ•°æ®æŒä¹…åŒ–æœ€ä½³å®è·µâ€”â€”Preferencesé¦–é€‰é¡¹å­˜å‚¨è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/433640354087403/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·73614681275
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:35:32.000Z" title="Thu Dec 18 2025 02:35:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æŠ€æœ¯æ ˆ</strong>ï¼šHarmonyOS 5.0 + ArkTS + @ohos.data.preferences</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šç”¨æˆ·è®¾ç½®ã€å†å²è®°å½•ã€åº”ç”¨çŠ¶æ€ä¿å­˜</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨åº”ç”¨å¼€å‘ä¸­ï¼Œæ•°æ®æŒä¹…åŒ–æ˜¯å¿…ä¸å¯å°‘çš„åŠŸèƒ½ã€‚HarmonyOSæä¾›äº†<code>@ohos.data.preferences</code>æ¨¡å—ç”¨äºè½»é‡çº§æ•°æ®å­˜å‚¨ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•å°è£…ä¸€ä¸ªé€šç”¨çš„é¦–é€‰é¡¹å·¥å…·ç±»ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€Preferences vs å…³ç³»å‹æ•°æ®åº“</h2>






























<table><thead><tr><th>ç‰¹æ€§</th><th>Preferences</th><th>å…³ç³»å‹æ•°æ®åº“</th></tr></thead><tbody><tr><td>æ•°æ®é‡</td><td>å°ï¼ˆKBçº§ï¼‰</td><td>å¤§ï¼ˆMBçº§ï¼‰</td></tr><tr><td>æ•°æ®ç»“æ„</td><td>é”®å€¼å¯¹</td><td>è¡¨ç»“æ„</td></tr><tr><td>æŸ¥è¯¢èƒ½åŠ›</td><td>ç®€å•</td><td>å¤æ‚SQL</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ç”¨æˆ·è®¾ç½®</td><td>ä¸šåŠ¡æ•°æ®</td></tr></tbody></table>
<h2 data-id="heading-2">äºŒã€å·¥å…·ç±»å°è£…</h2>
<h3 data-id="heading-3">2.1 åŸºç¡€å·¥å…·ç±»</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> dataPreferences <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.preferences'</span>;
<span class="hljs-keyword">import</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PreferencesUtil</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-variable constant_">PREFERENCES_NAME</span> = <span class="hljs-string">'app_preferences'</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">preferences</span>: dataPreferences.<span class="hljs-property">Preferences</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-comment">/**
   * åˆå§‹åŒ–ï¼ˆå¿…é¡»åœ¨EntryAbility.onCreateä¸­è°ƒç”¨ï¼‰
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span> = <span class="hljs-keyword">await</span> dataPreferences.<span class="hljs-title function_">getPreferences</span>(
        context,
        <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">PREFERENCES_NAME</span>
      );
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'PreferencesUtil: åˆå§‹åŒ–æˆåŠŸ'</span>);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'PreferencesUtil: åˆå§‹åŒ–å¤±è´¥'</span>, err);
    }
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">putString</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">put</span>(key, value);
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">flush</span>();
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getString</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">defaultValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>) <span class="hljs-keyword">return</span> defaultValue;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">get</span>(key, defaultValue) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">putNumber</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">put</span>(key, value);
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">flush</span>();
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getNumber</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">defaultValue</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>) <span class="hljs-keyword">return</span> defaultValue;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">get</span>(key, defaultValue) <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">putBoolean</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">value</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">put</span>(key, value);
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">flush</span>();
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getBoolean</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">defaultValue</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>) <span class="hljs-keyword">return</span> defaultValue;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">get</span>(key, defaultValue) <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span>;
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">delete</span>(<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">delete</span>(key);
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">flush</span>();
  }
}
</code></pre>
<h3 data-id="heading-4">2.2 å¤æ‚å¯¹è±¡å­˜å‚¨</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">HearingTestResult</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">maxFrequency</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">hearingAge</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">level</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestHistoryManager</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-variable constant_">KEY</span> = <span class="hljs-string">'hearing_test_history'</span>;

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">saveResult</span>(<span class="hljs-attr">result</span>: <span class="hljs-title class_">HearingTestResult</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> history = <span class="hljs-keyword">await</span> <span class="hljs-title class_">TestHistoryManager</span>.<span class="hljs-title function_">getHistory</span>();
    history.<span class="hljs-title function_">push</span>(result);
    <span class="hljs-comment">// åªä¿ç•™æœ€è¿‘20æ¡</span>
    <span class="hljs-keyword">const</span> trimmed = history.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">20</span>);
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">putString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">KEY</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(trimmed));
  }

  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getHistory</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">HearingTestResult</span>[]&gt; {
    <span class="hljs-keyword">const</span> str = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">getString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">KEY</span>, <span class="hljs-string">'[]'</span>);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(str) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HearingTestResult</span>[];
    } <span class="hljs-keyword">catch</span> {
      <span class="hljs-keyword">return</span> [];
    }
  }
}
</code></pre>
<h3 data-id="heading-5">2.3 é”®åå¸¸é‡ç®¡ç†</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">PreferencesKeys</span> = {
  <span class="hljs-attr">VIBRATION_ENABLED</span>: <span class="hljs-string">'vibration_enabled'</span>,
  <span class="hljs-attr">VOLUME_LEVEL</span>: <span class="hljs-string">'volume_level'</span>,
  <span class="hljs-attr">THEME_MODE</span>: <span class="hljs-string">'theme_mode'</span>,
  <span class="hljs-attr">USE_COUNT</span>: <span class="hljs-string">'use_count'</span>,
  <span class="hljs-attr">TOTAL_DURATION</span>: <span class="hljs-string">'total_duration'</span>,
  <span class="hljs-attr">ONBOARDING_COMPLETED</span>: <span class="hljs-string">'onboarding_completed'</span>,
};
</code></pre>
<h2 data-id="heading-6">ä¸‰ã€åœ¨EntryAbilityä¸­åˆå§‹åŒ–</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.UIAbility'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PreferencesUtil</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'common'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">init</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);
  }
}
</code></pre>
<h2 data-id="heading-7">å››ã€ä½¿ç”¨ç¤ºä¾‹</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä¿å­˜ç”¨æˆ·è®¾ç½®</span>
<span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">putBoolean</span>(<span class="hljs-title class_">PreferencesKeys</span>.<span class="hljs-property">VIBRATION_ENABLED</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">putNumber</span>(<span class="hljs-title class_">PreferencesKeys</span>.<span class="hljs-property">VOLUME_LEVEL</span>, <span class="hljs-number">80</span>);

<span class="hljs-comment">// è¯»å–ç”¨æˆ·è®¾ç½®</span>
<span class="hljs-keyword">const</span> vibrationEnabled = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">getBoolean</span>(<span class="hljs-title class_">PreferencesKeys</span>.<span class="hljs-property">VIBRATION_ENABLED</span>, <span class="hljs-literal">true</span>);
<span class="hljs-keyword">const</span> volumeLevel = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">getNumber</span>(<span class="hljs-title class_">PreferencesKeys</span>.<span class="hljs-property">VOLUME_LEVEL</span>, <span class="hljs-number">80</span>);

<span class="hljs-comment">// ä¿å­˜å¤æ‚å¯¹è±¡</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">HearingTestResult</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(),
  <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
  <span class="hljs-attr">maxFrequency</span>: <span class="hljs-number">16000</span>,
  <span class="hljs-attr">hearingAge</span>: <span class="hljs-number">25</span>,
  <span class="hljs-attr">level</span>: <span class="hljs-string">'æ­£å¸¸'</span>
};
<span class="hljs-keyword">await</span> <span class="hljs-title class_">TestHistoryManager</span>.<span class="hljs-title function_">saveResult</span>(result);
</code></pre>
<h2 data-id="heading-8">äº”ã€é¿å‘æŒ‡å—</h2>
<ol>
<li><strong>åˆå§‹åŒ–æ—¶æœº</strong>ï¼šå¿…é¡»åœ¨<code>EntryAbility.onCreate</code>ä¸­åˆå§‹åŒ–</li>
<li><strong>flushè°ƒç”¨</strong>ï¼šæ¯æ¬¡<code>put</code>åéƒ½è¦è°ƒç”¨<code>flush()</code></li>
<li><strong>JSONåºåˆ—åŒ–</strong>ï¼šå¤æ‚å¯¹è±¡éœ€è¦<code>JSON.stringify</code>/<code>JSON.parse</code></li>
<li><strong>æ•°æ®é‡é™åˆ¶</strong>ï¼šPreferencesé€‚åˆå°æ•°æ®ï¼Œå¤§æ•°æ®ç”¨å…³ç³»å‹æ•°æ®åº“</li>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œæ³¨æ„ä½¿ç”¨<code>await</code></li>
</ol>
<h2 data-id="heading-9">æ€»ç»“</h2>
<p>æœ¬æ–‡å°è£…äº†ä¸€ä¸ªé€šç”¨çš„Preferenceså·¥å…·ç±»ï¼Œæ”¯æŒåŸºç¡€ç±»å‹å’Œå¤æ‚å¯¹è±¡çš„å­˜å‚¨ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªå·¥å…·ç±»è¢«ç”¨äºä¿å­˜ç”¨æˆ·è®¾ç½®ã€æµ‹è¯•å†å²ã€ä½¿ç”¨ç»Ÿè®¡ç­‰æ•°æ®ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOSæ·±è‰²æ¨¡å¼é€‚é…å®æˆ˜â€”â€”ä¸»é¢˜åˆ‡æ¢ä¸WCAGå¯¹æ¯”åº¦æ ‡å‡†]]></title>    <link>https://juejin.cn/post/7584725529876414514</link>    <guid>https://juejin.cn/post/7584725529876414514</guid>    <pubDate>2025-12-18T02:37:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584725529876414514" data-draft-id="7584987267267117066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOSæ·±è‰²æ¨¡å¼é€‚é…å®æˆ˜â€”â€”ä¸»é¢˜åˆ‡æ¢ä¸WCAGå¯¹æ¯”åº¦æ ‡å‡†"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-18T02:37:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·73614681275"/> <meta itemprop="url" content="https://juejin.cn/user/433640354087403"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOSæ·±è‰²æ¨¡å¼é€‚é…å®æˆ˜â€”â€”ä¸»é¢˜åˆ‡æ¢ä¸WCAGå¯¹æ¯”åº¦æ ‡å‡†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/433640354087403/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·73614681275
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:37:05.000Z" title="Thu Dec 18 2025 02:37:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æŠ€æœ¯æ ˆ</strong>ï¼šHarmonyOS 5.0 + ArkTS + AppStorage</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåº”ç”¨ä¸»é¢˜åˆ‡æ¢ã€æ— éšœç¢é€‚é…ã€åä¸ºåº”ç”¨å¸‚åœºå®¡æ ¸</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>æ·±è‰²æ¨¡å¼å·²æˆä¸ºç°ä»£åº”ç”¨çš„æ ‡é…åŠŸèƒ½ã€‚åä¸ºåº”ç”¨å¸‚åœºå®¡æ ¸å¯¹æ·±è‰²æ¨¡å¼æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œæ‰€æœ‰æ–‡å­—å¿…é¡»æ¸…æ™°å¯è§ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•å®ç°ç¬¦åˆWCAGæ ‡å‡†çš„æ·±è‰²æ¨¡å¼é€‚é…ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€WCAGå¯¹æ¯”åº¦æ ‡å‡†</h2>
<p>WCAGï¼ˆWeb Content Accessibility Guidelinesï¼‰å®šä¹‰äº†æ–‡å­—å¯¹æ¯”åº¦æ ‡å‡†ï¼š</p>




















<table><thead><tr><th>çº§åˆ«</th><th>æ­£å¸¸æ–‡æœ¬</th><th>å¤§æ–‡æœ¬</th></tr></thead><tbody><tr><td>AAçº§</td><td>â‰¥ 4.5:1</td><td>â‰¥ 3:1</td></tr><tr><td>AAAçº§</td><td>â‰¥ 7:1</td><td>â‰¥ 4.5:1</td></tr></tbody></table>
<h2 data-id="heading-2">äºŒã€ä¸»é¢˜é¢œè‰²å®šä¹‰</h2>
<h3 data-id="heading-3">2.1 æµ…è‰²ä¸»é¢˜</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">LightTheme</span>: <span class="hljs-title class_">ThemeColors</span> = {
  <span class="hljs-attr">pageBg</span>: <span class="hljs-string">'#F8F9FA'</span>,
  <span class="hljs-attr">cardBg</span>: <span class="hljs-string">'#FFFFFF'</span>,
  <span class="hljs-attr">cardBgSecondary</span>: <span class="hljs-string">'#F5F5F5'</span>,
  
  <span class="hljs-comment">// æ–‡å­—è‰² - ç¬¦åˆWCAGæ ‡å‡†</span>
  <span class="hljs-attr">textPrimary</span>: <span class="hljs-string">'#1A1A1A'</span>,      <span class="hljs-comment">// å¯¹æ¯”åº¦ 16.1:1</span>
  <span class="hljs-attr">textSecondary</span>: <span class="hljs-string">'#595959'</span>,    <span class="hljs-comment">// å¯¹æ¯”åº¦ 7.0:1</span>
  <span class="hljs-attr">textTertiary</span>: <span class="hljs-string">'#737373'</span>,     <span class="hljs-comment">// å¯¹æ¯”åº¦ 4.6:1</span>
  
  <span class="hljs-attr">divider</span>: <span class="hljs-string">'#EEEEEE'</span>,
  <span class="hljs-attr">border</span>: <span class="hljs-string">'#E5E5E5'</span>,
  <span class="hljs-attr">buttonBg</span>: <span class="hljs-string">'#F0F0F0'</span>,
  <span class="hljs-attr">shadowColor</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.08)'</span>,
};
</code></pre>
<h3 data-id="heading-4">2.2 æ·±è‰²ä¸»é¢˜</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">DarkTheme</span>: <span class="hljs-title class_">ThemeColors</span> = {
  <span class="hljs-attr">pageBg</span>: <span class="hljs-string">'#121212'</span>,
  <span class="hljs-attr">cardBg</span>: <span class="hljs-string">'#1E1E1E'</span>,
  <span class="hljs-attr">cardBgSecondary</span>: <span class="hljs-string">'#2A2A2A'</span>,
  
  <span class="hljs-comment">// æ–‡å­—è‰² - ç¬¦åˆWCAGæ ‡å‡†</span>
  <span class="hljs-attr">textPrimary</span>: <span class="hljs-string">'#FFFFFF'</span>,      <span class="hljs-comment">// å¯¹æ¯”åº¦ 15.3:1</span>
  <span class="hljs-attr">textSecondary</span>: <span class="hljs-string">'#CCCCCC'</span>,    <span class="hljs-comment">// å¯¹æ¯”åº¦ 9.7:1</span>
  <span class="hljs-attr">textTertiary</span>: <span class="hljs-string">'#999999'</span>,     <span class="hljs-comment">// å¯¹æ¯”åº¦ 5.1:1</span>
  
  <span class="hljs-attr">divider</span>: <span class="hljs-string">'#333333'</span>,
  <span class="hljs-attr">border</span>: <span class="hljs-string">'#404040'</span>,
  <span class="hljs-attr">buttonBg</span>: <span class="hljs-string">'#2A2A2A'</span>,
  <span class="hljs-attr">shadowColor</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.3)'</span>,
};
</code></pre>
<h3 data-id="heading-5">2.3 ä¸»é¢˜æ¥å£å®šä¹‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ThemeColors</span> {
  <span class="hljs-attr">pageBg</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">cardBg</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">cardBgSecondary</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">textPrimary</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">textSecondary</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">textTertiary</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">divider</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">border</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">buttonBg</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">shadowColor</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
<h2 data-id="heading-6">ä¸‰ã€ä¸»é¢˜ç®¡ç†å™¨</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThemeManager</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">isDarkMode</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">isDark: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt; = [];

  <span class="hljs-keyword">static</span> <span class="hljs-title function_">setDarkMode</span>(<span class="hljs-attr">isDark</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-property">isDarkMode</span> = isDark;
    <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> <span class="hljs-title function_">listener</span>(isDark));
  }

  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getIsDarkMode</span>(): <span class="hljs-built_in">boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-property">isDarkMode</span>;
  }

  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getTheme</span>(): <span class="hljs-title class_">ThemeColors</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-property">isDarkMode</span> ? <span class="hljs-title class_">DarkTheme</span> : <span class="hljs-title class_">LightTheme</span>;
  }

  <span class="hljs-keyword">static</span> <span class="hljs-title function_">addListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-function">(<span class="hljs-params">isDark: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);
  }

  <span class="hljs-keyword">static</span> <span class="hljs-title function_">removeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-function">(<span class="hljs-params">isDark: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);
    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
  }
}
</code></pre>
<h2 data-id="heading-7">å››ã€é¡µé¢ä¸­ä½¿ç”¨ä¸»é¢˜</h2>
<h3 data-id="heading-8">4.1 ä½¿ç”¨AppStorageå®ç°å…¨å±€çŠ¶æ€</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">MainPage</span> {
  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'appDarkMode'</span>) <span class="hljs-attr">isDarkMode</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;
  
  <span class="hljs-title function_">getBgColor</span>(): <span class="hljs-built_in">string</span> { 
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> ? <span class="hljs-string">'#0D1117'</span> : <span class="hljs-string">'#F5F5F5'</span>; 
  }
  
  <span class="hljs-title function_">getTextPrimary</span>(): <span class="hljs-built_in">string</span> { 
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> ? <span class="hljs-string">'#FFFFFF'</span> : <span class="hljs-string">'#1A1A1A'</span>; 
  }
  
  <span class="hljs-title function_">getTextSecondary</span>(): <span class="hljs-built_in">string</span> { 
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> ? <span class="hljs-string">'rgba(255,255,255,0.7)'</span> : <span class="hljs-string">'rgba(0,0,0,0.6)'</span>; 
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">toggleTheme</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span>;
    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'appDarkMode'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span>);
    <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">putBoolean</span>(<span class="hljs-string">'app_dark_mode'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span>);
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'æ ‡é¢˜'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getTextPrimary</span>())
      
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'å‰¯æ ‡é¢˜'</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getTextSecondary</span>())
      
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'åˆ‡æ¢ä¸»é¢˜'</span>)
        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toggleTheme</span>())
    }
    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getBgColor</span>())
  }
}
</code></pre>
<h3 data-id="heading-9">4.2 è·Ÿéšç³»ç»Ÿä¸»é¢˜</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ConfigurationConstant</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.ConfigurationConstant'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">SettingsPage</span> {
  <span class="hljs-meta">@StorageProp</span>(<span class="hljs-string">'currentColorMode'</span>) <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onColorModeChange'</span>) 
  <span class="hljs-attr">currentColorMode</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>;
  
  <span class="hljs-meta">@State</span> <span class="hljs-attr">themeMode</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'system'</span>; <span class="hljs-comment">// 'system' | 'light' | 'dark'</span>

  <span class="hljs-title function_">onColorModeChange</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">themeMode</span> === <span class="hljs-string">'system'</span>) {
      <span class="hljs-keyword">const</span> isDark = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentColorMode</span> === <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_DARK</span>;
      <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'appDarkMode'</span>, isDark);
    }
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">applyThemeMode</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">isDark</span>: <span class="hljs-built_in">boolean</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">themeMode</span> === <span class="hljs-string">'system'</span>) {
      isDark = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentColorMode</span> === <span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_DARK</span>;
    } <span class="hljs-keyword">else</span> {
      isDark = <span class="hljs-variable language_">this</span>.<span class="hljs-property">themeMode</span> === <span class="hljs-string">'dark'</span>;
    }
    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'appDarkMode'</span>, isDark);
    <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">putString</span>(<span class="hljs-string">'theme_mode'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">themeMode</span>);
  }
}
</code></pre>
<h2 data-id="heading-10">äº”ã€å¯¹æ¯”åº¦æ£€æŸ¥å·¥å…·</h2>
<p>æ¨èä½¿ç”¨åœ¨çº¿å·¥å…·æ£€æŸ¥é¢œè‰²å¯¹æ¯”åº¦ï¼š</p>
<ul>
<li>WebAIM Contrast Checker: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebaim.org%2Fresources%2Fcontrastchecker%2F" target="_blank" title="https://webaim.org/resources/contrastchecker/" ref="nofollow noopener noreferrer">webaim.org/resources/câ€¦</a></li>
<li>Coolors Contrast Checker: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcoolors.co%2Fcontrast-checker" target="_blank" title="https://coolors.co/contrast-checker" ref="nofollow noopener noreferrer">coolors.co/contrast-châ€¦</a></li>
</ul>
<h2 data-id="heading-11">å…­ã€é¿å‘æŒ‡å—</h2>
<ol>
<li><strong>åä¸ºå®¡æ ¸è¦æ±‚</strong>ï¼šæ·±è‰²æ¨¡å¼ä¸‹æ‰€æœ‰æ–‡å­—å¿…é¡»æ¸…æ™°å¯è§</li>
<li><strong>@StorageLink vs @StorageProp</strong>ï¼šå‰è€…åŒå‘ç»‘å®šï¼Œåè€…åªè¯»</li>
<li><strong>é¢œè‰²é€æ˜åº¦</strong>ï¼šä½¿ç”¨<code>rgba()</code>æ—¶æ³¨æ„é€æ˜åº¦å¯¹å¯¹æ¯”åº¦çš„å½±å“</li>
<li><strong>å›¾æ ‡é€‚é…</strong>ï¼šæ·±è‰²æ¨¡å¼ä¸‹å›¾æ ‡ä¹Ÿéœ€è¦é€‚é…</li>
</ol>
<h2 data-id="heading-12">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†HarmonyOSæ·±è‰²æ¨¡å¼çš„å®Œæ•´å®ç°æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç¬¦åˆWCAGæ ‡å‡†çš„é¢œè‰²å®šä¹‰ã€ä¸»é¢˜ç®¡ç†å™¨ã€é¡µé¢ä½¿ç”¨æ–¹æ³•ç­‰ã€‚æ­£ç¡®çš„æ·±è‰²æ¨¡å¼é€‚é…ä¸ä»…èƒ½é€šè¿‡åº”ç”¨å¸‚åœºå®¡æ ¸ï¼Œè¿˜èƒ½æå‡ç”¨æˆ·ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOSçº¯éŸ³æµ‹å¬å®ç°â€”â€”ä¸“ä¸šå¬åŠ›æ£€æµ‹åŠŸèƒ½å¼€å‘]]></title>    <link>https://juejin.cn/post/7584987267267133450</link>    <guid>https://juejin.cn/post/7584987267267133450</guid>    <pubDate>2025-12-18T02:37:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584987267267133450" data-draft-id="7584725529876430898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOSçº¯éŸ³æµ‹å¬å®ç°â€”â€”ä¸“ä¸šå¬åŠ›æ£€æµ‹åŠŸèƒ½å¼€å‘"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-18T02:37:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·73614681275"/> <meta itemprop="url" content="https://juejin.cn/user/433640354087403"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOSçº¯éŸ³æµ‹å¬å®ç°â€”â€”ä¸“ä¸šå¬åŠ›æ£€æµ‹åŠŸèƒ½å¼€å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/433640354087403/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·73614681275
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:37:47.000Z" title="Thu Dec 18 2025 02:37:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æŠ€æœ¯æ ˆ</strong>ï¼šHarmonyOS 5.0 + ArkTS + AudioRenderer</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¬åŠ›å¥åº·åº”ç”¨ã€åŒ»ç–—è¾…åŠ©å·¥å…·</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>çº¯éŸ³æµ‹å¬ï¼ˆPure Tone Audiometryï¼‰æ˜¯ä¸´åºŠä¸Šæœ€å¸¸ç”¨çš„å¬åŠ›æ£€æµ‹æ–¹æ³•ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨HarmonyOSåº”ç”¨ä¸­å®ç°ä¸€ä¸ªä¸“ä¸šçš„çº¯éŸ³æµ‹å¬åŠŸèƒ½ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€çº¯éŸ³æµ‹å¬åŸç†</h2>
<h3 data-id="heading-2">1.1 æµ‹è¯•é¢‘ç‡</h3>
<p>æ ‡å‡†çº¯éŸ³æµ‹å¬ä½¿ç”¨ä»¥ä¸‹é¢‘ç‡ï¼š</p>
<ul>
<li><strong>125Hz, 250Hz, 500Hz</strong>ï¼šä½é¢‘</li>
<li><strong>1000Hz, 2000Hz</strong>ï¼šä¸­é¢‘ï¼ˆè¯­éŸ³é¢‘ç‡ï¼‰</li>
<li><strong>4000Hz, 8000Hz</strong>ï¼šé«˜é¢‘</li>
</ul>
<h3 data-id="heading-3">1.2 å¬é˜ˆåˆ†çº§ï¼ˆWHOæ ‡å‡†ï¼‰</h3>

































<table><thead><tr><th>å¬é˜ˆ (dB)</th><th>å¬åŠ›ç­‰çº§</th></tr></thead><tbody><tr><td>â‰¤25</td><td>æ­£å¸¸</td></tr><tr><td>26-40</td><td>è½»åº¦æŸå¤±</td></tr><tr><td>41-55</td><td>ä¸­åº¦æŸå¤±</td></tr><tr><td>56-70</td><td>ä¸­é‡åº¦æŸå¤±</td></tr><tr><td>71-90</td><td>é‡åº¦æŸå¤±</td></tr><tr><td>&gt;90</td><td>æé‡åº¦æŸå¤±</td></tr></tbody></table>
<h2 data-id="heading-4">äºŒã€æ•°æ®ç»“æ„è®¾è®¡</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PureToneFrequencyResult</span> {
  <span class="hljs-attr">frequency</span>: <span class="hljs-built_in">number</span>;        <span class="hljs-comment">// æµ‹è¯•é¢‘ç‡ Hz</span>
  <span class="hljs-attr">leftEarThreshold</span>: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// å·¦è€³å¬é˜ˆ dBï¼Œ-1è¡¨ç¤ºæœªæµ‹è¯•</span>
  <span class="hljs-attr">rightEarThreshold</span>: <span class="hljs-built_in">number</span>;<span class="hljs-comment">// å³è€³å¬é˜ˆ dB</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PureToneTestResult</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">timestamp</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">results</span>: <span class="hljs-title class_">PureToneFrequencyResult</span>[];
  <span class="hljs-attr">leftEarAverage</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">rightEarAverage</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">overallLevel</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">leftEarLevel</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">rightEarLevel</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€æµ‹è¯•é¡µé¢å®ç°</h2>
<h3 data-id="heading-6">3.1 é¡µé¢çŠ¶æ€ç®¡ç†</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">PureToneTestPage</span> {
  <span class="hljs-meta">@StorageLink</span>(<span class="hljs-string">'appDarkMode'</span>) <span class="hljs-attr">isDarkMode</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;
  
  <span class="hljs-meta">@State</span> <span class="hljs-attr">currentEar</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'left'</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">currentFrequencyIndex</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">currentVolume</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">30</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">isPlaying</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">testResults</span>: <span class="hljs-title class_">PureToneFrequencyResult</span>[] = [];
  <span class="hljs-meta">@State</span> <span class="hljs-attr">testPhase</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'intro'</span>;

  <span class="hljs-keyword">private</span> <span class="hljs-attr">testFrequencies</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">125</span>, <span class="hljs-number">250</span>, <span class="hljs-number">500</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">4000</span>, <span class="hljs-number">8000</span>];
  <span class="hljs-keyword">private</span> <span class="hljs-attr">audioEngine</span>: <span class="hljs-title class_">AudioEngine</span> = <span class="hljs-title class_">AudioEngine</span>.<span class="hljs-title function_">getInstance</span>();

  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initTestResults</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioEngine</span>.<span class="hljs-title function_">init</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">initTestResults</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">testResults</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">testFrequencies</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">freq: <span class="hljs-built_in">number</span></span>) =&gt;</span> ({
      <span class="hljs-attr">frequency</span>: freq,
      <span class="hljs-attr">leftEarThreshold</span>: -<span class="hljs-number">1</span>,
      <span class="hljs-attr">rightEarThreshold</span>: -<span class="hljs-number">1</span>
    }));
  }
}
</code></pre>
<h3 data-id="heading-7">3.2 æ’­æ”¾æµ‹è¯•éŸ³</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">playTestTone</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlaying</span>) {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioEngine</span>.<span class="hljs-title function_">stop</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlaying</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlaying</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">const</span> frequency = <span class="hljs-variable language_">this</span>.<span class="hljs-property">testFrequencies</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFrequencyIndex</span>];
  <span class="hljs-keyword">const</span> safeVolume = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0.1</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVolume</span> / <span class="hljs-number">100</span>);
  
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioEngine</span>.<span class="hljs-title function_">setAudioType</span>(<span class="hljs-string">'tone'</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioEngine</span>.<span class="hljs-title function_">setWaveformType</span>(<span class="hljs-string">'sine'</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioEngine</span>.<span class="hljs-title function_">setFrequency</span>(frequency);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioEngine</span>.<span class="hljs-title function_">setVolume</span>(safeVolume);
  
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">audioEngine</span>.<span class="hljs-title function_">start</span>(<span class="hljs-number">3</span>);
  
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlaying</span> = <span class="hljs-literal">false</span>; }, <span class="hljs-number">3000</span>);
}
</code></pre>
<h3 data-id="heading-8">3.3 è®°å½•å¬é˜ˆ</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">recordThreshold</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-property">testResults</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFrequencyIndex</span>];
  
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentEar</span> === <span class="hljs-string">'left'</span>) {
    result.<span class="hljs-property">leftEarThreshold</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVolume</span>;
  } <span class="hljs-keyword">else</span> {
    result.<span class="hljs-property">rightEarThreshold</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVolume</span>;
  }

  <span class="hljs-comment">// éœ‡åŠ¨åé¦ˆ</span>
  vibrator.<span class="hljs-title function_">startVibration</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'time'</span>, <span class="hljs-attr">duration</span>: <span class="hljs-number">50</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">usage</span>: <span class="hljs-string">'notification'</span> });

  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">nextTest</span>();
}

<span class="hljs-keyword">private</span> <span class="hljs-title function_">nextTest</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentEar</span> === <span class="hljs-string">'left'</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentEar</span> = <span class="hljs-string">'right'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVolume</span> = <span class="hljs-number">30</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentEar</span> = <span class="hljs-string">'left'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFrequencyIndex</span>++;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVolume</span> = <span class="hljs-number">30</span>;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFrequencyIndex</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">testFrequencies</span>.<span class="hljs-property">length</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">testPhase</span> = <span class="hljs-string">'completed'</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveResults</span>();
    }
  }
}
</code></pre>
<h3 data-id="heading-9">3.4 è®¡ç®—å¹³å‡å¬é˜ˆ</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">savePureToneTestResult</span>(<span class="hljs-attr">results</span>: <span class="hljs-title class_">PureToneFrequencyResult</span>[]): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">PureToneTestResult</span>&gt; {
  <span class="hljs-keyword">const</span> speechFrequencies = [<span class="hljs-number">500</span>, <span class="hljs-number">1000</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">4000</span>];
  <span class="hljs-keyword">let</span> leftSum = <span class="hljs-number">0</span>, rightSum = <span class="hljs-number">0</span>, leftCount = <span class="hljs-number">0</span>, rightCount = <span class="hljs-number">0</span>;
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> r <span class="hljs-keyword">of</span> results) {
    <span class="hljs-keyword">if</span> (speechFrequencies.<span class="hljs-title function_">includes</span>(r.<span class="hljs-property">frequency</span>)) {
      <span class="hljs-keyword">if</span> (r.<span class="hljs-property">leftEarThreshold</span> &gt;= <span class="hljs-number">0</span>) {
        leftSum += r.<span class="hljs-property">leftEarThreshold</span>;
        leftCount++;
      }
      <span class="hljs-keyword">if</span> (r.<span class="hljs-property">rightEarThreshold</span> &gt;= <span class="hljs-number">0</span>) {
        rightSum += r.<span class="hljs-property">rightEarThreshold</span>;
        rightCount++;
      }
    }
  }
  
  <span class="hljs-keyword">const</span> leftAvg = leftCount &gt; <span class="hljs-number">0</span> ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(leftSum / leftCount) : -<span class="hljs-number">1</span>;
  <span class="hljs-keyword">const</span> rightAvg = rightCount &gt; <span class="hljs-number">0</span> ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(rightSum / rightCount) : -<span class="hljs-number">1</span>;
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">id</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>_<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random().toString(<span class="hljs-number">36</span>).substr(<span class="hljs-number">2</span>, <span class="hljs-number">9</span>)}</span>`</span>,
    <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
    <span class="hljs-attr">results</span>: results,
    <span class="hljs-attr">leftEarAverage</span>: leftAvg,
    <span class="hljs-attr">rightEarAverage</span>: rightAvg,
    <span class="hljs-attr">overallLevel</span>: <span class="hljs-title function_">getHearingLevelByThreshold</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(leftAvg, rightAvg)),
    <span class="hljs-attr">leftEarLevel</span>: <span class="hljs-title function_">getHearingLevelByThreshold</span>(leftAvg),
    <span class="hljs-attr">rightEarLevel</span>: <span class="hljs-title function_">getHearingLevelByThreshold</span>(rightAvg)
  };
}

<span class="hljs-keyword">static</span> <span class="hljs-title function_">getHearingLevelByThreshold</span>(<span class="hljs-attr">threshold</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">if</span> (threshold &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'æœªæµ‹è¯•'</span>;
  <span class="hljs-keyword">if</span> (threshold &lt;= <span class="hljs-number">25</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'æ­£å¸¸'</span>;
  <span class="hljs-keyword">if</span> (threshold &lt;= <span class="hljs-number">40</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'è½»åº¦æŸå¤±'</span>;
  <span class="hljs-keyword">if</span> (threshold &lt;= <span class="hljs-number">55</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'ä¸­åº¦æŸå¤±'</span>;
  <span class="hljs-keyword">if</span> (threshold &lt;= <span class="hljs-number">70</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'ä¸­é‡åº¦æŸå¤±'</span>;
  <span class="hljs-keyword">if</span> (threshold &lt;= <span class="hljs-number">90</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">'é‡åº¦æŸå¤±'</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">'æé‡åº¦æŸå¤±'</span>;
}
</code></pre>
<h2 data-id="heading-10">å››ã€UIç•Œé¢ç¤ºä¾‹</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
  <span class="hljs-title class_">Column</span>() {
    <span class="hljs-comment">// è¿›åº¦æŒ‡ç¤º</span>
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">testFrequencies</span>, <span class="hljs-function">(<span class="hljs-params">freq: <span class="hljs-built_in">number</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
        <span class="hljs-title class_">Circle</span>()
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">12</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">12</span>)
          .<span class="hljs-title function_">fill</span>(index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFrequencyIndex</span> ? <span class="hljs-string">'#2D7FF9'</span> : 
                index === <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFrequencyIndex</span> ? <span class="hljs-string">'#34C759'</span> : <span class="hljs-string">'#333'</span>)
      })
    }.<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceEvenly</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)

    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.testFrequencies[<span class="hljs-variable language_">this</span>.currentFrequencyIndex]}</span> Hz`</span>)
      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">48</span>).<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
    
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.currentEar === <span class="hljs-string">'left'</span> ? <span class="hljs-string">'å·¦è€³'</span> : <span class="hljs-string">'å³è€³'</span>}</span>`</span>)
      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)

    <span class="hljs-title class_">Slider</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVolume</span>, <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">max</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">step</span>: <span class="hljs-number">5</span> })
      .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">number</span></span>) =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentVolume</span> = value; })

    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'æ’­æ”¾'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">playTestTone</span>())
      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'å¬åˆ°äº†'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">recordThreshold</span>())
    }.<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceEvenly</span>)
  }
}
</code></pre>
<h2 data-id="heading-11">äº”ã€é¿å‘æŒ‡å—</h2>
<ol>
<li><strong>éŸ³é‡æ ¡å‡†</strong>ï¼šä¸åŒè®¾å¤‡éŸ³é‡è¾“å‡ºä¸åŒï¼Œå»ºè®®æ·»åŠ æ ¡å‡†åŠŸèƒ½</li>
<li><strong>æµ‹è¯•ç¯å¢ƒ</strong>ï¼šæé†’ç”¨æˆ·åœ¨å®‰é™ç¯å¢ƒä¸­ä½¿ç”¨è€³æœºæµ‹è¯•</li>
<li><strong>å…è´£å£°æ˜</strong>ï¼šæ˜ç¡®è¯´æ˜ä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»å­¦æ£€æŸ¥</li>
<li><strong>æ•°æ®ä¿æŠ¤</strong>ï¼šæµ‹è¯•ç»“æœä»…å­˜å‚¨åœ¨æœ¬åœ°</li>
</ol>
<h2 data-id="heading-12">æ€»ç»“</h2>
<p>æœ¬æ–‡å®ç°äº†ä¸€ä¸ªä¸“ä¸šçš„çº¯éŸ³æµ‹å¬åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ ‡å‡†é¢‘ç‡æµ‹è¯•ã€å¬é˜ˆè®°å½•ã€ç­‰çº§è¯„ä¼°ç­‰ã€‚è¯¥åŠŸèƒ½å¯å¸®åŠ©ç”¨æˆ·åˆæ­¥äº†è§£è‡ªå·±çš„å¬åŠ›çŠ¶å†µã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[zustand ä»åŸç†åˆ°å®è·µ - æœ€ä½³å®è·µ]]></title>    <link>https://juejin.cn/post/7584740835368058934</link>    <guid>https://juejin.cn/post/7584740835368058934</guid>    <pubDate>2025-12-18T02:39:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584740835368058934" data-draft-id="7584722109584343083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="zustand ä»åŸç†åˆ°å®è·µ - æœ€ä½³å®è·µ"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2025-12-18T02:39:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é²¨å”"/> <meta itemprop="url" content="https://juejin.cn/user/413072101215944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            zustand ä»åŸç†åˆ°å®è·µ - æœ€ä½³å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/413072101215944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é²¨å”
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:39:08.000Z" title="Thu Dec 18 2025 02:39:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Zustand æœ€ä½³å®è·µæŒ‡å—</h2>
<p>åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•ä½¿ç”¨ Zustand æ¥ç®¡ç† React åº”ç”¨çš„çŠ¶æ€ï¼ŒåŒæ—¶éµå¾ªæœ€ä½³å®è·µä»¥ç¡®ä¿ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½ã€‚</p>
<h3 data-id="heading-1">1. è®¾è®¡åŸåˆ™</h3>
<h4 data-id="heading-2">1.1 å•ä¸€ Store + å¤š Slice</h4>
<p>ä½¿ç”¨å•ä¸€çš„ store æ¥ç®¡ç†æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ï¼Œä½†å°†çŠ¶æ€åˆ†å‰²æˆå¤šä¸ª sliceã€‚</p>
<h4 data-id="heading-3">1.2 No-Store-Actions</h4>
<p>å°†åŠ¨ä½œé€»è¾‘ä» store ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œæ”¾åˆ°ç‹¬ç«‹çš„ actions æ–‡ä»¶ä¸­ã€‚</p>
<h4 data-id="heading-4">1.3 ä½¿ç”¨ selector æŒ‰éœ€è®¢é˜…</h4>
<p>åœ¨ react ç»„ä»¶å‡½æ•°é¡¶éƒ¨ scope é‡Œé¢ï¼Œä¸€å¾‹é‡‡ç”¨ selector è¿›è¡ŒæŒ‰éœ€è®¢é˜…ã€‚</p>
<h4 data-id="heading-5">1.4 ä½¿ç”¨ Immer å®ç°å¯å˜æ€§çš„æ›´æ–°å†™æ³•</h4>
<p>åœ¨åˆ›å»º store æ—¶ï¼Œé€šè¿‡ä¸­é—´ä»¶æ³¨å…¥ Immerï¼Œä»¥ä¾¿äºåœ¨ action å‡½æ•°ä¸­å®ç°å¯å˜æ€§çš„æ›´æ–°å†™æ³•ã€‚</p>
<h4 data-id="heading-6">1.5 éœ€è¦è€ƒè™‘ç»“åˆ Redux DevTools çš„å¯è°ƒè¯•æ€§</h4>
<p>è°ƒç”¨ Zustand çš„ <code>setState</code> æ—¶ï¼Œéœ€è¦ä¼ é€’ action nameï¼Œä»¥ä¾¿åœ¨ Redux DevTools ä¸­æ¸…æ™°åœ°è¿½è¸ªçŠ¶æ€å˜åŒ–ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºä¸º "anonymous"ã€‚</p>
<h4 data-id="heading-7">1.6 Type First</h4>
<p>åœ¨ç¼–å†™ä»£ç ä¹‹å‰ï¼Œå…ˆå®šä¹‰å¥½ç±»å‹ï¼Œç¡®ä¿ç±»å‹å®‰å…¨ã€‚</p>
<h4 data-id="heading-8">1.7 ä»£ç ç»„ç»‡è§„èŒƒ</h4>
<ul>
<li>å°†çŠ¶æ€ï¼ˆmodelï¼‰ã€åŠ¨ä½œï¼ˆactionï¼‰å’Œå¤ç”¨å‹ hook(selector hook)åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„æ–‡ä»¶å¤¹ä¸­ï¼Œå½¢æˆæ¸…æ™°çš„æ–‡ä»¶ç»“æ„ã€‚</li>
<li>ä¸åŒç±»å‹çš„æ–‡ä»¶åˆ›å»ºä¸€ä¸ª <code>index.ts</code> æ–‡ä»¶ä½œä¸ºè¯¥ç±»å‹æ–‡ä»¶çš„ç»Ÿä¸€å¯¼å‡ºå‡ºå£æ–‡ä»¶</li>
</ul>
<h3 data-id="heading-9">2. ç›®å½•ç»“æ„</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-attribute">src</span>/stores/
â”œâ”€â”€ index<span class="hljs-selector-class">.ts</span>                 <span class="hljs-comment">// åªå¯¼å‡º useStore å’Œ AppStore</span>
â”œâ”€â”€ createAppStore<span class="hljs-selector-class">.ts</span>        <span class="hljs-comment">// å”¯ä¸€ create è°ƒç”¨ï¼Œimmer ç­‰ä¸­é—´ä»¶æ³¨å…¥</span>
â”œâ”€â”€ models/                  <span class="hljs-comment">// åˆå§‹çŠ¶æ€å½¢çŠ¶å’Œç±»å‹å®šä¹‰</span>
â”‚   â”œâ”€â”€ index<span class="hljs-selector-class">.ts</span>            <span class="hljs-comment">// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ model ç±»å‹</span>
â”‚   â”œâ”€â”€ user<span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.ts</span>
â”‚   â”œâ”€â”€ <span class="hljs-attribute">order</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.ts</span>
â”‚   â””â”€â”€ cart<span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.ts</span>
â”œâ”€â”€ slices/                  <span class="hljs-comment">// åªæ”¾"æ•°æ® + çº¯ set"</span>
â”‚   â”œâ”€â”€ index<span class="hljs-selector-class">.ts</span>            <span class="hljs-comment">// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ slice ç±»å‹å’Œåˆ›å»ºå‡½æ•°</span>
â”‚   â”œâ”€â”€ user<span class="hljs-selector-class">.ts</span>
â”‚   â”œâ”€â”€ <span class="hljs-attribute">order</span><span class="hljs-selector-class">.ts</span>
â”‚   â””â”€â”€ cart<span class="hljs-selector-class">.ts</span>
â”œâ”€â”€ actions/                 <span class="hljs-comment">// æ‰€æœ‰ä¸šåŠ¡åŠ¨ä½œ</span>
â”‚   â”œâ”€â”€ index<span class="hljs-selector-class">.ts</span>            <span class="hljs-comment">// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ actions</span>
â”‚   â”œâ”€â”€ user<span class="hljs-selector-class">.ts</span>
â”‚   â”œâ”€â”€ <span class="hljs-attribute">order</span><span class="hljs-selector-class">.ts</span>
â”‚   â””â”€â”€ cart<span class="hljs-selector-class">.ts</span>
â”œâ”€â”€ selectors/               <span class="hljs-comment">// å¤ç”¨å‹ selector hooks</span>
â”‚   â””â”€â”€ index<span class="hljs-selector-class">.ts</span>            <span class="hljs-comment">// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ selector hooks</span>
â””â”€â”€ utils/                   <span class="hljs-comment">// è¾…åŠ©å·¥å…·</span>
    â””â”€â”€ actionName<span class="hljs-selector-class">.ts</span>       <span class="hljs-comment">// Action åç§°ç”Ÿæˆå·¥å…·</span>
</code></pre>
<p><strong>ğŸ“ å…³é”®è¯´æ˜ï¼š</strong></p>
<ol>
<li>
<p><strong><code>stores/index.ts</code></strong> - åªå¯¼å‡ºæ ¸å¿ƒ Store</p>
<ul>
<li>å¯¼å‡º <code>useStore</code> å’Œ <code>AppStore</code> ç±»å‹</li>
<li>ä¸å†é‡æ–°å¯¼å‡ºå…¶ä»–å†…å®¹</li>
</ul>
</li>
<li>
<p><strong>å„å­ç›®å½•çš„ <code>index.ts</code></strong> - å„ç±»å‹æ–‡ä»¶çš„ç»Ÿä¸€å‡ºå£</p>
<ul>
<li><code>models/index.ts</code> - å¯¼å‡ºæ‰€æœ‰ model ç±»å‹å’Œåˆå§‹çŠ¶æ€</li>
<li><code>slices/index.ts</code> - å¯¼å‡ºæ‰€æœ‰ slice ç±»å‹å’Œåˆ›å»ºå‡½æ•°</li>
<li><code>actions/index.ts</code> - å¯¼å‡ºæ‰€æœ‰ action å‡½æ•°</li>
<li><code>selectors/index.ts</code> - å¯¼å‡ºæ‰€æœ‰å¤ç”¨å‹ selector hooks</li>
</ul>
</li>
<li>
<p><strong>ç»„ä»¶å¯¼å…¥è§„åˆ™</strong></p>
<ul>
<li><code>useStore</code> ä» <code>@/stores</code> å¯¼å…¥</li>
<li>actions ä» <code>@/stores/actions</code> å¯¼å…¥</li>
<li>selectors ä» <code>@/stores/selectors</code> å¯¼å…¥</li>
<li>types ä» <code>@/stores/models</code> å¯¼å…¥</li>
</ul>
</li>
<li>
<p><strong><code>selectors/</code></strong> - å¤ç”¨å‹ selector hooks</p>
<ul>
<li>å°è£…å¸¸ç”¨çš„çŠ¶æ€è®¿é—®é€»è¾‘</li>
<li>å†…éƒ¨ä½¿ç”¨ <code>useShallow</code> æˆ– <code>useMemo</code> ä¼˜åŒ–æ€§èƒ½</li>
<li>ä¸ºå¤æ‚çš„æ´¾ç”ŸçŠ¶æ€æä¾›ç‹¬ç«‹çš„ hook</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">3. ç¼–ç æ­¥éª¤</h3>
<h4 data-id="heading-11">3.1 å®šä¹‰æ¨¡å‹</h4>
<p>å®ç°ä¸€ä¸ªç‰¹å®šçš„ä¸šåŠ¡é¢†åŸŸçš„çŠ¶æ€ç®¡ç†ï¼Œæ¨èé¦–å…ˆä»å®šä¹‰è¯¥ä¸šåŠ¡é¢†åŸŸçš„æ•°æ®æ¨¡å‹å¼€å§‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// models/user.model.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> userInitial = {
  <span class="hljs-attr">profile</span>: <span class="hljs-literal">null</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">User</span> | <span class="hljs-literal">null</span>,
  <span class="hljs-attr">token</span>: <span class="hljs-string">""</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>,
};
</code></pre>
<h4 data-id="heading-12">3.2 èµ‹äºˆæ¯ä¸ª setState ä¸€ä¸ª action name</h4>
<p>ä¸ºäº†è®© Redux DevTools èƒ½å¤Ÿæ¸…æ™°åœ°æ˜¾ç¤ºæ¯ä¸ª action çš„åç§°ï¼ˆè€Œä¸æ˜¯ "anonymous"ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªè¾…åŠ©å·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆ action åç§°ã€‚</p>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li>âœ… ä½¿ç”¨ <code>createActionName</code> è¾…åŠ©å‡½æ•°è‡ªåŠ¨ç”Ÿæˆ action åç§°</li>
<li>âœ… Action åç§°éµå¾ª <code>{domain}/{action}/{status}</code> æ ¼å¼</li>
<li>âœ… åœ¨ slice çš„ setter æ–¹æ³•ä¸­æ”¯æŒå¯é€‰çš„ <code>actionName</code> å‚æ•°</li>
<li>âœ… åœ¨ actions ä¸­è°ƒç”¨ setter æ—¶ä¼ é€’å…·ä½“çš„ action åç§°</li>
</ul>
<p><strong>åˆ›å»ºè¾…åŠ©å·¥å…·ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils/actionName.ts</span>
<span class="hljs-comment">/**
 * Action åç§°è¾…åŠ©å·¥å…·
 *
 * ç”¨äºè‡ªåŠ¨ç”Ÿæˆ Redux DevTools ä¸­æ˜¾ç¤ºçš„ action åç§°
 *
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```typescript
 * const actionName = createActionName("user", login);
 * actionName("loading")  // "user/login/loading"
 * actionName("success")  // "user/login/success"
 * actionName()           // "user/login"
 * ```
 */</span>

<span class="hljs-comment">/**
 * åˆ›å»º action åç§°ç”Ÿæˆå™¨
 *
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">domain</span> - é¢†åŸŸåç§°ï¼ˆå¦‚ "user", "order", "cart"ï¼‰
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">fn</span> - action å‡½æ•°ï¼Œç”¨äºè·å–å‡½æ•°å
 * <span class="hljs-doctag">@returns</span> è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥ä¼ å…¥åç¼€ç”Ÿæˆå®Œæ•´çš„ action åç§°
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createActionName</span>(<span class="hljs-params">domain: <span class="hljs-built_in">string</span>, fn: <span class="hljs-built_in">Function</span></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">suffix?: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> base = <span class="hljs-string">`<span class="hljs-subst">${domain}</span>/<span class="hljs-subst">${fn.name}</span>`</span>;
    <span class="hljs-keyword">return</span> suffix ? <span class="hljs-string">`<span class="hljs-subst">${base}</span>/<span class="hljs-subst">${suffix}</span>`</span> : base;
  };
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå·¥å…·ï¼Ÿ</strong></p>
<ul>
<li>âœ… <strong>è‡ªåŠ¨æ¨æ–­</strong>ï¼šåˆ©ç”¨å‡½æ•° <code>name</code> å±æ€§ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥ action åç§°</li>
<li>âœ… <strong>ç»Ÿä¸€æ ¼å¼</strong>ï¼šéµå¾ª <code>{domain}/{action}/{status}</code> å‘½åè§„èŒƒ</li>
<li>âœ… <strong>è°ƒè¯•å‹å¥½</strong>ï¼šåœ¨ Redux DevTools ä¸­æ¸…æ™°æ˜¾ç¤ºï¼Œä¸å†æ˜¯ "anonymous"</li>
<li>âœ… <strong>æ˜“äºç»´æŠ¤</strong>ï¼šä¿®æ”¹å‡½æ•°åè‡ªåŠ¨æ›´æ–° action åç§°</li>
</ul>
<p><strong>åœ¨ Actions ä¸­ä½¿ç”¨ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// actions/user.ts</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"../createAppStore"</span>;
<span class="hljs-keyword">import</span> { api } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../api/mock"</span>;
<span class="hljs-keyword">import</span> { createActionName } <span class="hljs-keyword">from</span> <span class="hljs-string">"../utils/actionName"</span>;

<span class="hljs-comment">/**
 * ç”¨æˆ·ç™»å½•
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">login</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">email: <span class="hljs-built_in">string</span>, pwd: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> { _setUser } = useStore.<span class="hljs-title function_">getState</span>();
  <span class="hljs-keyword">const</span> actionName = <span class="hljs-title function_">createActionName</span>(<span class="hljs-string">"user"</span>, login); <span class="hljs-comment">// âœ… åˆ›å»º action åç§°ç”Ÿæˆå™¨</span>

  <span class="hljs-comment">// å¼€å§‹åŠ è½½</span>
  <span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">isLoading</span> = <span class="hljs-literal">true</span>;
    draft.<span class="hljs-property">error</span> = <span class="hljs-literal">null</span>;
  }, <span class="hljs-title function_">actionName</span>(<span class="hljs-string">"loading"</span>)); <span class="hljs-comment">// "user/login/loading"</span>

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> { token, profile } = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">login</span>(email, pwd);

    <span class="hljs-comment">// ç™»å½•æˆåŠŸ</span>
    <span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
      draft.<span class="hljs-property">token</span> = token;
      draft.<span class="hljs-property">profile</span> = profile;
      draft.<span class="hljs-property">isLoading</span> = <span class="hljs-literal">false</span>;
      draft.<span class="hljs-property">error</span> = <span class="hljs-literal">null</span>;
    }, <span class="hljs-title function_">actionName</span>(<span class="hljs-string">"success"</span>)); <span class="hljs-comment">// "user/login/success"</span>
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// ç™»å½•å¤±è´¥</span>
    <span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
      draft.<span class="hljs-property">isLoading</span> = <span class="hljs-literal">false</span>;
      draft.<span class="hljs-property">error</span> = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">"ç™»å½•å¤±è´¥"</span>;
    }, <span class="hljs-title function_">actionName</span>(<span class="hljs-string">"error"</span>)); <span class="hljs-comment">// "user/login/error"</span>
    <span class="hljs-keyword">throw</span> error;
  }
};

<span class="hljs-comment">/**
 * ç”¨æˆ·ç™»å‡º
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">logout</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { _setUser } = useStore.<span class="hljs-title function_">getState</span>();
  <span class="hljs-keyword">const</span> actionName = <span class="hljs-title function_">createActionName</span>(<span class="hljs-string">"user"</span>, logout);

  <span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">token</span> = <span class="hljs-string">""</span>;
    draft.<span class="hljs-property">profile</span> = <span class="hljs-literal">null</span>;
  }, <span class="hljs-title function_">actionName</span>()); <span class="hljs-comment">// "user/logout"</span>
};
</code></pre>
<p><strong>Action å‘½åè§„èŒƒï¼š</strong></p>








































<table><thead><tr><th>åœºæ™¯</th><th>Action Name ç¤ºä¾‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å¼‚æ­¥æ“ä½œ - å¼€å§‹</td><td><code>user/login/loading</code></td><td>è¡¨ç¤ºæ­£åœ¨åŠ è½½</td></tr><tr><td>å¼‚æ­¥æ“ä½œ - æˆåŠŸ</td><td><code>user/login/success</code></td><td>è¡¨ç¤ºæ“ä½œæˆåŠŸ</td></tr><tr><td>å¼‚æ­¥æ“ä½œ - å¤±è´¥</td><td><code>user/login/error</code></td><td>è¡¨ç¤ºæ“ä½œå¤±è´¥</td></tr><tr><td>åŒæ­¥æ“ä½œ</td><td><code>user/logout</code></td><td>ç®€å•çš„åŒæ­¥æ“ä½œ</td></tr><tr><td>çŠ¶æ€æ›´æ–°</td><td><code>order/setOrderFilter</code></td><td>è®¾ç½®ç­›é€‰æ¡ä»¶</td></tr><tr><td>è·¨ slice æ“ä½œ</td><td><code>user/logout/clearCart</code></td><td>ç™»å‡ºæ—¶æ¸…ç©ºè´­ç‰©è½¦</td></tr></tbody></table>
<p><strong>åœ¨ Redux DevTools ä¸­çš„æ•ˆæœï¼š</strong></p>
<p>ä½¿ç”¨ <code>createActionName</code> åï¼ŒRedux DevTools ä¼šæ¸…æ™°æ˜¾ç¤ºï¼š</p>
<ul>
<li>âœ… <code>user/login/loading</code> â†’ <code>user/login/success</code> â†’ ç™»å½•æµç¨‹æ¸…æ™°å¯è§</li>
<li>âœ… <code>cart/addToCart/success</code> â†’ è´­ç‰©è½¦æ“ä½œä¸€ç›®äº†ç„¶</li>
<li>âŒ ä¸å†æ˜¯ <code>anonymous</code> â†’ éš¾ä»¥è¿½è¸ªé—®é¢˜</li>
</ul>
<h4 data-id="heading-13">3.3 ç¼–å†™ Sliceï¼ˆä»…æ•°æ® + çº¯ setï¼‰</h4>
<p><strong>âœ… Good Case: Slice åªåŒ…å«æ•°æ®å’Œçº¯ set æ–¹æ³•ï¼ˆä½¿ç”¨ immerï¼‰</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// slices/user.ts</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">StateCreator</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">WritableDraft</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"immer"</span>;
<span class="hljs-keyword">import</span> { userInitial, <span class="hljs-keyword">type</span> <span class="hljs-title class_">UserState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/user.model"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserSlice</span> {
  <span class="hljs-attr">user</span>: <span class="hljs-title class_">UserState</span>;
  <span class="hljs-attr">_setUser</span>: <span class="hljs-function">(<span class="hljs-params">
    updater: (draft: WritableDraft&lt;UserState&gt;) =&gt; <span class="hljs-built_in">void</span>,
    actionName?: <span class="hljs-built_in">string</span> <span class="hljs-comment">// âœ… æ·»åŠ å¯é€‰çš„ action åç§°å‚æ•°</span>
  </span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createUserSlice</span>: <span class="hljs-title class_">StateCreator</span>&lt;
  <span class="hljs-title class_">UserSlice</span>,
  [[<span class="hljs-string">"zustand/immer"</span>, <span class="hljs-built_in">never</span>], [<span class="hljs-string">"zustand/devtools"</span>, <span class="hljs-built_in">never</span>]], <span class="hljs-comment">// âœ… æ·»åŠ  devtools ç±»å‹</span>
  [],
  <span class="hljs-title class_">UserSlice</span>
&gt; = <span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">user</span>: userInitial,

  <span class="hljs-comment">/**
   * çº¯ setter æ–¹æ³•ï¼ˆç”± immer æ”¯æŒï¼‰
   *
   * <span class="hljs-doctag">@param</span> <span class="hljs-variable">updater</span> - çŠ¶æ€æ›´æ–°å‡½æ•°
   * <span class="hljs-doctag">@param</span> <span class="hljs-variable">actionName</span> - å¯é€‰çš„ action åç§°ï¼Œç”¨äº Redux DevTools
   *
   * ä½¿ç”¨ç¤ºä¾‹ï¼š
   * _setUser((draft) =&gt; {
   *   draft.token = "new_token";     // âœ… ç›´æ¥ä¿®æ”¹
   *   draft.profile = { ... };       // âœ… ç›´æ¥èµ‹å€¼
   * }, "user/login");                // âœ… ä¼ é€’ action åç§°ï¼ˆå¯é€‰ï¼‰
   */</span>
  <span class="hljs-attr">_setUser</span>: <span class="hljs-function">(<span class="hljs-params">updater, actionName</span>) =&gt;</span>
    <span class="hljs-title function_">set</span>(
      <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
        <span class="hljs-title function_">updater</span>(state.<span class="hljs-property">user</span>);
        <span class="hljs-comment">// immer ä¼šè‡ªåŠ¨å¤„ç†ä¸å¯å˜æ›´æ–°</span>
      },
      <span class="hljs-literal">false</span>, <span class="hljs-comment">// âœ… replace å‚æ•°</span>
      actionName || <span class="hljs-string">"user/_setUser"</span> <span class="hljs-comment">// âœ… ä¼ é€’ action åç§°ç»™ devtools</span>
    ),
});
</code></pre>
<p><strong>âŒ Bad Case: åœ¨ Slice ä¸­æ··å…¥å‰¯ä½œç”¨ä»£ç ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šslice ä¸­åŒ…å«å¼‚æ­¥é€»è¾‘å’Œä¸šåŠ¡è§„åˆ™</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createUserSlice</span>: <span class="hljs-title class_">StateCreator</span>&lt;<span class="hljs-title class_">UserSlice</span>&gt; = <span class="hljs-function">(<span class="hljs-params">set, get</span>) =&gt;</span> ({
  <span class="hljs-attr">user</span>: userInitial,

  <span class="hljs-comment">// âŒ é—®é¢˜ 1: ä¸šåŠ¡é€»è¾‘è€¦åˆåœ¨ slice ä¸­ï¼Œéš¾ä»¥å¤ç”¨å’Œæµ‹è¯•</span>
  <span class="hljs-attr">login</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">pwd</span>: <span class="hljs-built_in">string</span>) =&gt; {
    <span class="hljs-keyword">const</span> { token, profile } = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">login</span>({ email, pwd });
    <span class="hljs-title function_">set</span>({ <span class="hljs-attr">user</span>: { token, profile } });
  },

  <span class="hljs-comment">// âŒ é—®é¢˜ 2: è·¨ slice è®¿é—®é€»è¾‘æ•£è½å„å¤„</span>
  <span class="hljs-attr">loginAndLoadOrders</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">pwd</span>: <span class="hljs-built_in">string</span>) =&gt; {
    <span class="hljs-keyword">const</span> { token, profile } = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">login</span>({ email, pwd });
    <span class="hljs-title function_">set</span>({ <span class="hljs-attr">user</span>: { token, profile } });
    <span class="hljs-comment">// è®¿é—®å…¶ä»– slice çš„æ–¹æ³•</span>
    <span class="hljs-title function_">get</span>().<span class="hljs-title function_">loadOrders</span>(profile.<span class="hljs-property">id</span>);
  },
});
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä¸å¥½ï¼Ÿ</strong></p>
<ul>
<li>ä¸šåŠ¡é€»è¾‘ä¸çŠ¶æ€å®šä¹‰è€¦åˆï¼Œè¿åå•ä¸€èŒè´£åŸåˆ™</li>
<li>éš¾ä»¥æµ‹è¯•å¼‚æ­¥é€»è¾‘</li>
<li>è·¨ slice è°ƒç”¨ä¼šäº§ç”Ÿå¤æ‚çš„ä¾èµ–å…³ç³»</li>
<li>æ— æ³•åœ¨ç»„ä»¶å¤–ï¼ˆå¦‚è·¯ç”±å®ˆå«ï¼‰å¤ç”¨è¿™äº›é€»è¾‘</li>
</ul>
<h4 data-id="heading-14">3.4 å•ä¸€ Store ç»„åˆæ‰€æœ‰ Slice å¹¶æ³¨å…¥ Immer</h4>
<p><strong>âœ… Good Case: å•ä¸€ Store + ä¸­é—´ä»¶ç»Ÿä¸€æ³¨å…¥</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// createAppStore.ts</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand"</span>;
<span class="hljs-keyword">import</span> { devtools, subscribeWithSelector } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand/middleware"</span>;
<span class="hljs-keyword">import</span> { immer } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand/middleware/immer"</span>;
<span class="hljs-keyword">import</span> { createUserSlice, <span class="hljs-keyword">type</span> <span class="hljs-title class_">UserSlice</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./slices/user"</span>;
<span class="hljs-keyword">import</span> { createOrderSlice, <span class="hljs-keyword">type</span> <span class="hljs-title class_">OrderSlice</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./slices/order"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">AppStore</span> = <span class="hljs-title class_">UserSlice</span> &amp; <span class="hljs-title class_">OrderSlice</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useStore = create&lt;<span class="hljs-title class_">AppStore</span>&gt;()(
  <span class="hljs-title function_">devtools</span>(
    <span class="hljs-title function_">subscribeWithSelector</span>(
      <span class="hljs-title function_">immer</span>(<span class="hljs-function">(<span class="hljs-params">...a</span>) =&gt;</span> ({
        ...<span class="hljs-title function_">createUserSlice</span>(...a),
        ...<span class="hljs-title function_">createOrderSlice</span>(...a),
      }))
    ),
    { <span class="hljs-attr">name</span>: <span class="hljs-string">"app"</span> }
  )
);
</code></pre>
<p><strong>âŒ Bad Case 1: æ¯ä¸ª Slice å•ç‹¬æ³¨å…¥ Immer</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šåœ¨æ¯ä¸ª slice å†…éƒ¨å•ç‹¬ä½¿ç”¨ immer</span>
<span class="hljs-keyword">import</span> { immer } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand/middleware/immer"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createUserSlice</span>: <span class="hljs-title class_">StateCreator</span>&lt;<span class="hljs-title class_">UserSlice</span>&gt; = <span class="hljs-title function_">immer</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">user</span>: userInitial,
  <span class="hljs-attr">setUser</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span>
    <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
      state.<span class="hljs-property">user</span> = data; <span class="hljs-comment">// immer è¯­æ³•</span>
    }),
}));

<span class="hljs-comment">// é—®é¢˜ï¼š</span>
<span class="hljs-comment">// 1. é‡å¤æ³¨å…¥ middlewareï¼Œæ€§èƒ½æµªè´¹</span>
<span class="hljs-comment">// 2. ç»„åˆå¤šä¸ª slice æ—¶ç±»å‹æ¨å¯¼å¤æ‚</span>
<span class="hljs-comment">// 3. æ— æ³•ç»Ÿä¸€æ§åˆ¶ middleware é…ç½®</span>
</code></pre>
<p><strong>âŒ Bad Case 2: å¤šä¸ªç‹¬ç«‹çš„ Store</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šä¸ºæ¯ä¸ªé¢†åŸŸåˆ›å»ºç‹¬ç«‹ store</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = create&lt;<span class="hljs-title class_">UserSlice</span>&gt;()(<span class="hljs-comment">/* ... */</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useOrderStore = create&lt;<span class="hljs-title class_">OrderSlice</span>&gt;()(<span class="hljs-comment">/* ... */</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCartStore = create&lt;<span class="hljs-title class_">CartSlice</span>&gt;()(<span class="hljs-comment">/* ... */</span>);

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useUserStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">user</span>);
  <span class="hljs-keyword">const</span> orders = <span class="hljs-title function_">useOrderStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">orders</span>);
  <span class="hljs-keyword">const</span> cart = <span class="hljs-title function_">useCartStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">cart</span>);

  <span class="hljs-comment">// âŒ é—®é¢˜ï¼šè·¨ store çš„çŠ¶æ€åè°ƒå¾ˆå›°éš¾</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (user.<span class="hljs-property">profile</span>) {
      <span class="hljs-comment">// å¦‚ä½•è®© orderStore çŸ¥é“ user å·²ç™»å½•ï¼Ÿ</span>
      <span class="hljs-comment">// åªèƒ½é€šè¿‡è®¢é˜…æˆ–æ‰‹åŠ¨è°ƒç”¨ï¼Œå®¹æ˜“å‡ºé”™</span>
    }
  }, [user.<span class="hljs-property">profile</span>]);
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆæ¨èå•ä¸€ Storeï¼Ÿ</strong></p>
<ul>
<li>ä¸­é—´ä»¶ï¼ˆdevtools/persistï¼‰åªéœ€é…ç½®ä¸€æ¬¡</li>
<li>è·¨é¢†åŸŸçš„ä¸šåŠ¡é€»è¾‘ç¼–æ’æ›´ç®€å•</li>
<li>ç±»å‹æ¨å¯¼æ›´å‡†ç¡®ï¼Œå¼€å‘ä½“éªŒæ›´å¥½</li>
<li>DevTools å¯ä»¥çœ‹åˆ°å®Œæ•´çš„çŠ¶æ€æ ‘</li>
</ul>
<p><strong>ä½•æ—¶å¯ä»¥è€ƒè™‘å¤š Storeï¼Ÿ</strong></p>
<ul>
<li>å®Œå…¨ç‹¬ç«‹çš„å­åº”ç”¨ï¼ˆå¾®å‰ç«¯ï¼‰</li>
<li>éœ€è¦åŠ¨æ€åŠ è½½/å¸è½½çš„æ¨¡å—</li>
<li>è·¨çª—å£/Worker é€šä¿¡çš„åœºæ™¯</li>
</ul>
<h4 data-id="heading-15">3.5 åŠ¨ä½œå¤–ç½®ï¼ˆNo-Store-Actionsï¼‰</h4>
<p><strong>âœ… Good Case: å°†ä¸šåŠ¡é€»è¾‘æŠ½ç¦»åˆ°ç‹¬ç«‹çš„ actions æ–‡ä»¶</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// actions/user.ts</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"../createAppStore"</span>;
<span class="hljs-keyword">import</span> { api } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../api/mock"</span>;
<span class="hljs-keyword">import</span> { createActionName } <span class="hljs-keyword">from</span> <span class="hljs-string">"../utils/actionName"</span>;

<span class="hljs-comment">/**
 * ç”¨æˆ·ç™»å½•
 *
 * æœ€ä½³å®è·µï¼š
 * 1. ä½¿ç”¨ useStore.getState() è·å–çŠ¶æ€å’Œ setter
 * 2. åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œ loading çŠ¶æ€ç®¡ç†
 * 3. ä½¿ç”¨ createActionName ç”Ÿæˆ action åç§°ï¼ˆè§ 3.1ï¼‰
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">login</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">email: <span class="hljs-built_in">string</span>, pwd: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> { _setUser } = useStore.<span class="hljs-title function_">getState</span>();
  <span class="hljs-keyword">const</span> actionName = <span class="hljs-title function_">createActionName</span>(<span class="hljs-string">"user"</span>, login);

  <span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">isLoading</span> = <span class="hljs-literal">true</span>;
    draft.<span class="hljs-property">error</span> = <span class="hljs-literal">null</span>;
  }, <span class="hljs-title function_">actionName</span>(<span class="hljs-string">"loading"</span>));

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> { token, profile } = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">login</span>(email, pwd);
    <span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
      draft.<span class="hljs-property">token</span> = token;
      draft.<span class="hljs-property">profile</span> = profile;
      draft.<span class="hljs-property">isLoading</span> = <span class="hljs-literal">false</span>;
    }, <span class="hljs-title function_">actionName</span>(<span class="hljs-string">"success"</span>));
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
      draft.<span class="hljs-property">isLoading</span> = <span class="hljs-literal">false</span>;
      draft.<span class="hljs-property">error</span> = error <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Error</span> ? error.<span class="hljs-property">message</span> : <span class="hljs-string">"ç™»å½•å¤±è´¥"</span>;
    }, <span class="hljs-title function_">actionName</span>(<span class="hljs-string">"error"</span>));
    <span class="hljs-keyword">throw</span> error;
  }
};

<span class="hljs-comment">/**
 * è·¨ slice ç¼–æ’ï¼šç™»å‡ºæ—¶æ¸…ç©ºæ‰€æœ‰ç”¨æˆ·ç›¸å…³æ•°æ®
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">logout</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { _setUser, _setOrder, _setCart } = useStore.<span class="hljs-title function_">getState</span>();
  <span class="hljs-keyword">const</span> actionName = <span class="hljs-title function_">createActionName</span>(<span class="hljs-string">"user"</span>, logout);

  <span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">token</span> = <span class="hljs-string">""</span>;
    draft.<span class="hljs-property">profile</span> = <span class="hljs-literal">null</span>;
  }, <span class="hljs-title function_">actionName</span>());

  <span class="hljs-comment">// è·¨ slice åä½œï¼šæ¸…ç©ºè®¢å•å’Œè´­ç‰©è½¦</span>
  <span class="hljs-title function_">_setOrder</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">list</span> = [];
  }, <span class="hljs-title function_">actionName</span>(<span class="hljs-string">"clearOrders"</span>));

  <span class="hljs-title function_">_setCart</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">items</span> = [];
  }, <span class="hljs-title function_">actionName</span>(<span class="hljs-string">"clearCart"</span>));
};
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// actions/index.ts - ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ actions</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./user"</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./order"</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./cart"</span>;
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¦åŠ¨ä½œå¤–ç½®ï¼Ÿ</strong></p>
<ul>
<li>âœ… <strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼šStore åªè´Ÿè´£çŠ¶æ€å®šä¹‰ï¼ŒActions è´Ÿè´£ä¸šåŠ¡é€»è¾‘</li>
<li>âœ… <strong>æ˜“äºæµ‹è¯•</strong>ï¼šActions æ˜¯çº¯å‡½æ•°ï¼Œå¯ä»¥ç‹¬ç«‹æµ‹è¯•</li>
<li>âœ… <strong>ä¾¿äºå¤ç”¨</strong>ï¼šActions å¯ä»¥åœ¨ç»„ä»¶å¤–è°ƒç”¨ï¼ˆå¦‚è·¯ç”±å®ˆå«ã€ä¸­é—´ä»¶ï¼‰</li>
<li>âœ… <strong>è·¨ slice ç¼–æ’</strong>ï¼šè½»æ¾åè°ƒå¤šä¸ª slice çš„çŠ¶æ€æ›´æ–°</li>
<li>âœ… <strong>ä»£ç ç»„ç»‡</strong>ï¼šæŒ‰ä¸šåŠ¡åŠŸèƒ½åˆ’åˆ†æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ··åœ¨ä¸€èµ·</li>
</ul>
<p><strong>âŒ Bad Case: åœ¨ Store ä¸­å®šä¹‰ Actions</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šactions å®šä¹‰åœ¨ store å†…éƒ¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useStore = create&lt;<span class="hljs-title class_">AppStore</span>&gt;()(<span class="hljs-function">(<span class="hljs-params">set, get</span>) =&gt;</span> ({
  <span class="hljs-attr">user</span>: userInitial,

  <span class="hljs-comment">// âŒ é—®é¢˜ 1: store æ–‡ä»¶è‡ƒè‚¿ï¼Œéš¾ä»¥ç»´æŠ¤</span>
  <span class="hljs-attr">login</span>: <span class="hljs-keyword">async</span> (<span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">pwd</span>: <span class="hljs-built_in">string</span>) =&gt; {
    <span class="hljs-keyword">const</span> { token, profile } = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">login</span>({ email, pwd });
    <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({
      <span class="hljs-attr">user</span>: { ...state.<span class="hljs-property">user</span>, token, profile },
    }));
  },

  <span class="hljs-comment">// âŒ é—®é¢˜ 2: æ— æ³•åœ¨ç»„ä»¶å¤–ä½¿ç”¨ï¼ˆå¦‚ Router Guardï¼‰</span>
  <span class="hljs-attr">logout</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">set</span>({ <span class="hljs-attr">user</span>: userInitial });
  },

  <span class="hljs-comment">// âŒ é—®é¢˜ 3: æµ‹è¯•æ—¶å¿…é¡» mock æ•´ä¸ª store</span>
  <span class="hljs-attr">checkAuth</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> !!<span class="hljs-title function_">get</span>().<span class="hljs-property">user</span>.<span class="hljs-property">token</span>;
  },
}));
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä¸å¥½ï¼Ÿ</strong></p>
<ul>
<li>Store æ–‡ä»¶ä¼šéšç€ä¸šåŠ¡å¢é•¿å˜å¾—éå¸¸åºå¤§</li>
<li>Actions æ— æ³•åœ¨éç»„ä»¶ç¯å¢ƒä¸­è°ƒç”¨ï¼ˆéœ€è¦é€šè¿‡ <code>useStore.getState()</code> ç»•è¿‡ï¼‰</li>
<li>æµ‹è¯•å›°éš¾ï¼Œå¿…é¡»åˆ›å»ºå®Œæ•´çš„ store å®ä¾‹</li>
<li>ç±»å‹å®šä¹‰å¤æ‚ï¼Œactions å’Œ state æ··åœ¨ä¸€èµ·</li>
</ul>
<h4 data-id="heading-16">3.6 ç»„ä»¶ä½¿ç”¨ï¼šç²¾ç¡®è®¢é˜… + è°ƒç”¨ Actions</h4>
<p><strong>âœ… Good Case: ä»å„è‡ªçš„å‡ºå£æ–‡ä»¶å¯¼å…¥ï¼Œä½¿ç”¨ selector ç²¾ç¡®è®¢é˜… + è°ƒç”¨ç‹¬ç«‹ actions</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… æ¨èï¼šä»å„è‡ªçš„å‡ºå£æ–‡ä»¶å¯¼å…¥</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores"</span>;
<span class="hljs-keyword">import</span> { login } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/actions"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginBtn</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// âœ… åªè®¢é˜…éœ€è¦çš„çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> profile = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> login("ok@mail.com", "123456")}&gt;
      {profile ? profile.name : "ç™»å½•"}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>âŒ Bad Case 0: ä»å…·ä½“æ–‡ä»¶å¯¼å…¥ï¼Œè€Œéå‡ºå£æ–‡ä»¶</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šç»•è¿‡å‡ºå£æ–‡ä»¶ï¼Œç›´æ¥ä»å…·ä½“æ–‡ä»¶å¯¼å…¥</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/createAppStore"</span>;
<span class="hljs-keyword">import</span> { login } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/actions/user"</span>;
<span class="hljs-keyword">import</span> { useUserProfile } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/selectors/user"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginBtn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> profile = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>);
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> login("ok@mail.com", "123456")}&gt;
      {profile ? profile.name : "ç™»å½•"}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// é—®é¢˜ï¼š</span>
<span class="hljs-comment">// 1. å¯¼å…¥è·¯å¾„ä¸ä¸€è‡´ï¼Œéš¾ä»¥ç»´æŠ¤</span>
<span class="hljs-comment">// 2. ç ´åäº†å‡ºå£æ–‡ä»¶çš„è®¾è®¡åŸåˆ™</span>
<span class="hljs-comment">// 3. å¦‚æœç›®å½•ç»“æ„è°ƒæ•´ï¼Œéœ€è¦ä¿®æ”¹å¤šå¤„å¯¼å…¥</span>
</code></pre>
<p><strong>âŒ Bad Case 1: ç»„ä»¶å†…ç›´æ¥æ“ä½œ State</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginBtn</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> profile = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// âŒ é—®é¢˜ï¼šä¸šåŠ¡é€»è¾‘æ•£è½åœ¨ç»„ä»¶ä¸­ï¼Œæ— æ³•å¤ç”¨</span>
    <span class="hljs-keyword">const</span> { token, profile } = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">login</span>(<span class="hljs-string">"ok@mail.com"</span>, <span class="hljs-string">"123456"</span>);
    useStore.<span class="hljs-title function_">getState</span>().<span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
      draft.<span class="hljs-property">token</span> = token;
      draft.<span class="hljs-property">profile</span> = profile;
    });
  };

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleLogin}</span>&gt;</span>{profile?.name ?? "ç™»å½•"}<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}
</code></pre>
<p><strong>âŒ Bad Case 2: è®¢é˜…æ•´ä¸ª Store æˆ–è¿‡å¤šå­—æ®µ</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginBtn</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// âŒ é—®é¢˜ 1: è®¢é˜…äº†æ•´ä¸ª storeï¼Œä»»ä½•çŠ¶æ€å˜åŒ–éƒ½ä¼šå¯¼è‡´é‡æ¸²æŸ“</span>
  <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useStore</span>();

  <span class="hljs-comment">// âŒ é—®é¢˜ 2: è®¢é˜…äº†ä¸éœ€è¦çš„å­—æ®µ</span>
  <span class="hljs-keyword">const</span> { user, order, cart } = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> ({
    <span class="hljs-attr">user</span>: s.<span class="hljs-property">user</span>,
    <span class="hljs-attr">order</span>: s.<span class="hljs-property">order</span>,
    <span class="hljs-attr">cart</span>: s.<span class="hljs-property">cart</span>,
  }));

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> login("ok@mail.com", "123456")}&gt;
      {store.user.profile?.name ?? "ç™»å½•"}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>âŒ Bad Case 3: åœ¨ Render ä¸­è°ƒç”¨ getState()</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginBtn</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// âŒ ä¸¥é‡é—®é¢˜ï¼šä¸ä¼šå“åº”çŠ¶æ€å˜åŒ–ï¼</span>
  <span class="hljs-keyword">const</span> profile = useStore.<span class="hljs-title function_">getState</span>().<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>;

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> login("ok@mail.com", "123456")}&gt;
      {profile?.name ?? "ç™»å½•"}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä¸å¥½ï¼Ÿ</strong></p>
<ul>
<li><strong>Bad Case 0</strong>: å¯¼å…¥è·¯å¾„ä¸ä¸€è‡´ï¼Œç ´åå‡ºå£æ–‡ä»¶è®¾è®¡åŸåˆ™</li>
<li><strong>Bad Case 1</strong>: ä¸šåŠ¡é€»è¾‘é‡å¤ï¼Œéš¾ä»¥æµ‹è¯•å’Œç»´æŠ¤</li>
<li><strong>Bad Case 2</strong>: ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼Œå½±å“æ€§èƒ½</li>
<li><strong>Bad Case 3</strong>: ç»„ä»¶ä¸ä¼šéšçŠ¶æ€æ›´æ–°è€Œæ›´æ–°ï¼Œå‡ºç° UI ä¸åŒæ­¥</li>
</ul>
<h4 data-id="heading-17">3.7 å¤ç”¨å‹ Selector Hooks</h4>
<p><strong>âœ… Good Case: å°†å¸¸ç”¨çš„çŠ¶æ€è®¿é—®é€»è¾‘å°è£…æˆç‹¬ç«‹çš„ selector hook</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// selectors/index.ts</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"../createAppStore"</span>;
<span class="hljs-keyword">import</span> { useShallow } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand/react/shallow"</span>;
<span class="hljs-keyword">import</span> { useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">OrderStatus</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models"</span>;

<span class="hljs-comment">/**
 * è·å–ç”¨æˆ·ä¿¡æ¯çš„å¤ç”¨ hook
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useUserProfile</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useStore</span>(
    <span class="hljs-title function_">useShallow</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> ({
      <span class="hljs-attr">profile</span>: s.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>,
      <span class="hljs-attr">isLoggedIn</span>: s.<span class="hljs-property">user</span>.<span class="hljs-property">isLoggedIn</span>,
    }))
  );
}

<span class="hljs-comment">/**
 * è·å–è´­ç‰©è½¦æ‘˜è¦ä¿¡æ¯çš„å¤ç”¨ hook
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useCartSummary</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> items = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">cart</span>.<span class="hljs-property">items</span>);

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> itemCount = items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> sum + item.<span class="hljs-property">quantity</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> totalPrice = items.<span class="hljs-title function_">reduce</span>(
      <span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> sum + item.<span class="hljs-property">price</span> * item.<span class="hljs-property">quantity</span>,
      <span class="hljs-number">0</span>
    );

    <span class="hljs-keyword">return</span> { itemCount, totalPrice };
  }, [items]);
}

<span class="hljs-comment">/**
 * è·å–è®¢å•åˆ—è¡¨çš„å¤ç”¨ hookï¼ˆæ”¯æŒç­›é€‰ï¼‰
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useOrderList</span>(<span class="hljs-params">status: OrderStatus | <span class="hljs-string">"all"</span> = <span class="hljs-string">"all"</span></span>) {
  <span class="hljs-keyword">const</span> list = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">order</span>.<span class="hljs-property">list</span>);

  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (status === <span class="hljs-string">"all"</span>) {
      <span class="hljs-keyword">return</span> list;
    }
    <span class="hljs-keyword">return</span> list.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">o</span>) =&gt;</span> o.<span class="hljs-property">status</span> === status);
  }, [list, status]);
}
</code></pre>
<p><strong>ç»„ä»¶ä¸­ä½¿ç”¨ï¼š</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… ä» selectors å‡ºå£æ–‡ä»¶å¯¼å…¥å¤ç”¨å‹ selector hooks</span>
<span class="hljs-keyword">import</span> { useUserProfile, useCartSummary } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/selectors"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserDashboard</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { profile, isLoggedIn } = <span class="hljs-title function_">useUserProfile</span>();
  <span class="hljs-keyword">const</span> { itemCount, totalPrice } = <span class="hljs-title function_">useCartSummary</span>();

  <span class="hljs-keyword">if</span> (!isLoggedIn) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è¯·å…ˆç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ¬¢è¿ï¼Œ{profile?.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
        è´­ç‰©è½¦ï¼š{itemCount} ä»¶å•†å“ï¼Œæ€»ä»· Â¥{totalPrice}
      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>âŒ Bad Case: åœ¨æ¯ä¸ªç»„ä»¶ä¸­é‡å¤ç¼–å†™ç›¸åŒçš„ selector é€»è¾‘</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šåœ¨å¤šä¸ªç»„ä»¶ä¸­é‡å¤ç›¸åŒçš„é€»è¾‘</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentA</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> items = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">cart</span>.<span class="hljs-property">items</span>);
  <span class="hljs-keyword">const</span> itemCount = items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> sum + item.<span class="hljs-property">quantity</span>, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> totalPrice = items.<span class="hljs-title function_">reduce</span>(
    <span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> sum + item.<span class="hljs-property">price</span> * item.<span class="hljs-property">quantity</span>,
    <span class="hljs-number">0</span>
  );

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æ€»ä»·ï¼šÂ¥{totalPrice}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ComponentB</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// âŒ é‡å¤çš„é€»è¾‘</span>
  <span class="hljs-keyword">const</span> items = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">cart</span>.<span class="hljs-property">items</span>);
  <span class="hljs-keyword">const</span> itemCount = items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> sum + item.<span class="hljs-property">quantity</span>, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> totalPrice = items.<span class="hljs-title function_">reduce</span>(
    <span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> sum + item.<span class="hljs-property">price</span> * item.<span class="hljs-property">quantity</span>,
    <span class="hljs-number">0</span>
  );

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å•†å“æ•°ï¼š{itemCount}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-comment">// é—®é¢˜ï¼š</span>
<span class="hljs-comment">// 1. ä»£ç é‡å¤ï¼Œéš¾ä»¥ç»´æŠ¤</span>
<span class="hljs-comment">// 2. å¦‚æœè®¡ç®—é€»è¾‘éœ€è¦ä¿®æ”¹ï¼Œè¦æ”¹å¤šå¤„</span>
<span class="hljs-comment">// 3. æ²¡æœ‰æ€§èƒ½ä¼˜åŒ–ï¼ˆuseMemoï¼‰</span>
</code></pre>
<p><strong>ä½•æ—¶åº”è¯¥åˆ›å»ºå¤ç”¨å‹ Selector Hookï¼Ÿ</strong></p>
<ol>
<li><strong>å¤šä¸ªç»„ä»¶éœ€è¦ç›¸åŒçš„çŠ¶æ€è®¿é—®é€»è¾‘</strong> - å¦‚ <code>useUserProfile</code>ã€<code>useCartSummary</code></li>
<li><strong>éœ€è¦å¯¹çŠ¶æ€è¿›è¡Œå¤æ‚è®¡ç®—æˆ–æ´¾ç”Ÿ</strong> - å¦‚è®¡ç®—æ€»ä»·ã€ç­›é€‰åˆ—è¡¨</li>
<li><strong>éœ€è¦ç»„åˆå¤šä¸ªçŠ¶æ€ç‰‡æ®µ</strong> - å¦‚åŒæ—¶è·å–ç”¨æˆ·ä¿¡æ¯å’Œç™»å½•çŠ¶æ€</li>
<li><strong>éœ€è¦æ€§èƒ½ä¼˜åŒ–</strong> - ä½¿ç”¨ <code>useShallow</code> æˆ– <code>useMemo</code> é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“</li>
</ol>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li>å°† selector hooks ç»Ÿä¸€æ”¾åœ¨ <code>selectors/</code> ç›®å½•</li>
<li>åœ¨ <code>selectors/index.ts</code> ä¸­ç»Ÿä¸€å¯¼å‡º</li>
<li>åœ¨ hook å†…éƒ¨ä½¿ç”¨ <code>useShallow</code> æˆ– <code>useMemo</code> ä¼˜åŒ–æ€§èƒ½</li>
<li>ä¸º selector hook æ·»åŠ æ¸…æ™°çš„æ³¨é‡Šå’Œç±»å‹å®šä¹‰</li>
</ul>
<h3 data-id="heading-18">4. æ€§èƒ½ä¸é™·é˜±</h3>
<h4 data-id="heading-19">4.1 å¼•ç”¨ç±»å‹è®¢é˜…å¿…é¡»ä½¿ç”¨ <code>useShallow</code></h4>
<p><strong>âœ… Good Case: ä½¿ç”¨ useShallow é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useShallow } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand/react/shallow"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserCard</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// âœ… ä½¿ç”¨ shallow æ¯”è¾ƒï¼Œåªæœ‰ profile æˆ– token çœŸæ­£å˜åŒ–æ—¶æ‰ re-render</span>
  <span class="hljs-keyword">const</span> { profile, token } = <span class="hljs-title function_">useStore</span>(
    <span class="hljs-title function_">useShallow</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> ({
      <span class="hljs-attr">profile</span>: s.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>,
      <span class="hljs-attr">token</span>: s.<span class="hljs-property">user</span>.<span class="hljs-property">token</span>,
    }))
  );

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{profile?.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p><strong>âŒ Bad Case: ä¸ä½¿ç”¨ useShallow å¯¼è‡´æ¯æ¬¡éƒ½é‡æ–°æ¸²æŸ“</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">UserCard</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// âŒ é—®é¢˜ï¼šæ¯æ¬¡ useStore è°ƒç”¨éƒ½ä¼šè¿”å›æ–°çš„å¯¹è±¡å¼•ç”¨</span>
  <span class="hljs-comment">// å³ä½¿ profile å’Œ token çš„å€¼æ²¡å˜ï¼Œç»„ä»¶ä¹Ÿä¼š re-render</span>
  <span class="hljs-keyword">const</span> { profile, token } = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> ({
    <span class="hljs-attr">profile</span>: s.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>,
    <span class="hljs-attr">token</span>: s.<span class="hljs-property">user</span>.<span class="hljs-property">token</span>,
  }));

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{profile?.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-comment">// éªŒè¯é—®é¢˜ï¼š</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ParentComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> unrelatedState = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.<span class="hljs-property">cart</span>.<span class="hljs-property">items</span>); <span class="hljs-comment">// è´­ç‰©è½¦å˜åŒ–</span>

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* âŒ UserCard ä¹Ÿä¼šé‡æ¸²æŸ“ï¼Œå³ä½¿ user æ•°æ®æ²¡å˜ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">UserCard</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä¸å¥½ï¼Ÿ</strong></p>
<ul>
<li>Selector è¿”å›çš„å¯¹è±¡æ¯æ¬¡éƒ½æ˜¯æ–°å¼•ç”¨ï¼ŒReact é»˜è®¤ä½¿ç”¨ <code>Object.is</code> æ¯”è¾ƒ</li>
<li>å¯¼è‡´å¤§é‡ä¸å¿…è¦çš„é‡æ¸²æŸ“</li>
<li>åœ¨åˆ—è¡¨æ¸²æŸ“æ—¶æ€§èƒ½é—®é¢˜å°¤ä¸ºæ˜æ˜¾</li>
</ul>
<p><strong>è§„åˆ™ï¼š</strong></p>
<ul>
<li>è¿”å›<strong>å•ä¸ªåŸå§‹å€¼</strong>ï¼ˆstring/number/booleanï¼‰â†’ æ— éœ€ <code>useShallow</code></li>
<li>è¿”å›<strong>å¯¹è±¡/æ•°ç»„</strong>ï¼ˆå³ä½¿å†…å®¹ç›¸åŒï¼‰â†’ <strong>å¿…é¡»ä½¿ç”¨</strong> <code>useShallow</code></li>
</ul>
<h4 data-id="heading-20">4.2 åˆå¹¶å¤šæ¬¡æ›´æ–°åˆ°å•ä¸ª setState</h4>
<p><strong>âœ… Good Case: åœ¨å•æ¬¡ setState ä¸­æ›´æ–°å¤šä¸ªå­—æ®µ</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">syncUserData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">userId: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> [profile, settings, orders] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
    api.<span class="hljs-title function_">getProfile</span>(userId),
    api.<span class="hljs-title function_">getSettings</span>(userId),
    api.<span class="hljs-title function_">getOrders</span>(userId),
  ]);

  <span class="hljs-comment">// âœ… æ–¹æ¡ˆ 1: åˆå¹¶åˆ°å•ä¸ª setStateï¼ˆæ¨èï¼‰</span>
  useStore.<span class="hljs-title function_">setState</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({
    <span class="hljs-attr">user</span>: { ...state.<span class="hljs-property">user</span>, profile },
    <span class="hljs-attr">settings</span>: { ...state.<span class="hljs-property">settings</span>, <span class="hljs-attr">data</span>: settings },
    <span class="hljs-attr">orders</span>: { ...state.<span class="hljs-property">orders</span>, <span class="hljs-attr">list</span>: orders },
  }));
};
</code></pre>
<p><strong>âŒ Bad Case: è¿ç»­å¤šæ¬¡ setState å¯èƒ½å½±å“æ€§èƒ½</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">syncUserData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">userId: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> [profile, settings, orders] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
    api.<span class="hljs-title function_">getProfile</span>(userId),
    api.<span class="hljs-title function_">getSettings</span>(userId),
    api.<span class="hljs-title function_">getOrders</span>(userId),
  ]);

  <span class="hljs-comment">// âŒ ä¸æ¨èï¼šè™½ç„¶ React 18+ ä¼šè‡ªåŠ¨æ‰¹å¤„ç†ï¼Œä½†ä¸å¤Ÿä¼˜é›…</span>
  useStore.<span class="hljs-title function_">getState</span>().<span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">profile</span> = profile;
  });
  useStore.<span class="hljs-title function_">getState</span>().<span class="hljs-title function_">_setSettings</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">data</span> = settings;
  });
  useStore.<span class="hljs-title function_">getState</span>().<span class="hljs-title function_">_setOrders</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">list</span> = orders;
  });
};
</code></pre>
<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>React 18+</strong> å·²ç»è‡ªåŠ¨æ‰¹å¤„ç†åŒæ­¥äº‹ä»¶å’Œå¼‚æ­¥å›è°ƒä¸­çš„æ›´æ–°</li>
<li>ä½†<strong>æœ€ä½³å®è·µä»ç„¶æ˜¯åˆå¹¶åˆ°å•ä¸ª setState</strong>ï¼ŒåŸå› ï¼š
<ul>
<li>ä»£ç æ›´æ¸…æ™°ï¼Œæ„å›¾æ›´æ˜ç¡®ï¼ˆ"è¿™æ˜¯ä¸€æ¬¡åŸå­æ“ä½œ"ï¼‰</li>
<li>é¿å…ä¸­é—´çŠ¶æ€ï¼ˆå³ä½¿å¾ˆçŸ­æš‚ï¼‰</li>
<li>åœ¨æŸäº›è¾¹ç¼˜åœºæ™¯ä¸‹æ›´å¯é </li>
</ul>
</li>
</ul>
<p><strong>å¦‚æœå¿…é¡»åˆ†å¼€è°ƒç”¨æ€ä¹ˆåŠï¼Ÿï¼ˆReact 18+ï¼‰</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// React 18+ ä¼šè‡ªåŠ¨æ‰¹å¤„ç†ï¼Œæ— éœ€æ‹…å¿ƒ</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateMultiple</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">someAsyncOp</span>();

  <span class="hljs-comment">// âœ… è¿™äº›æ›´æ–°ä¼šè¢«è‡ªåŠ¨åˆå¹¶</span>
  useStore.<span class="hljs-title function_">getState</span>().<span class="hljs-title function_">_setUser</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">profile</span> = newProfile;
  });
  useStore.<span class="hljs-title function_">getState</span>().<span class="hljs-title function_">_setOrders</span>(<span class="hljs-function">(<span class="hljs-params">draft</span>) =&gt;</span> {
    draft.<span class="hljs-property">list</span> = newOrders;
  });
};
</code></pre>
<h3 data-id="heading-21">5. å‡ºå£æ–‡ä»¶æ¨¡å¼è¯¦è§£</h3>
<h4 data-id="heading-22">5.1 ä¸ºä»€ä¹ˆéœ€è¦å‡ºå£æ–‡ä»¶ï¼Ÿ</h4>
<p><strong>é—®é¢˜åœºæ™¯ï¼šæ²¡æœ‰å‡ºå£æ–‡ä»¶æ—¶çš„æ··ä¹±</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç»„ä»¶ A</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/createAppStore"</span>;
<span class="hljs-keyword">import</span> { login } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/actions/user"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">UserState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/models/user.model"</span>;

<span class="hljs-comment">// ç»„ä»¶ B</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"../stores/createAppStore"</span>;
<span class="hljs-keyword">import</span> { login } <span class="hljs-keyword">from</span> <span class="hljs-string">"../stores/actions/user"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">UserState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../stores/models/user.model"</span>;

<span class="hljs-comment">// ç»„ä»¶ C</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../stores/createAppStore"</span>;
<span class="hljs-keyword">import</span> { login } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../stores/actions/user"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">UserState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../stores/models/user.model"</span>;

<span class="hljs-comment">// é—®é¢˜ï¼š</span>
<span class="hljs-comment">// 1. éœ€è¦è®°ä½æ¯ä¸ªå…·ä½“æ–‡ä»¶çš„ä½ç½®</span>
<span class="hljs-comment">// 2. ç›®å½•ç»“æ„è°ƒæ•´æ—¶ï¼Œéœ€è¦ä¿®æ”¹å¤šå¤„å¯¼å…¥</span>
<span class="hljs-comment">// 3. å¯¼å…¥è·¯å¾„å†—é•¿ï¼Œéš¾ä»¥ç»´æŠ¤</span>
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šå‡ºå£æ–‡ä»¶æ¨¡å¼</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ä»å„è‡ªçš„å‡ºå£æ–‡ä»¶å¯¼å…¥</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores"</span>;
<span class="hljs-keyword">import</span> { login } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/actions"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">UserState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/models"</span>;

<span class="hljs-comment">// ä¼˜åŠ¿ï¼š</span>
<span class="hljs-comment">// 1. å¯¼å…¥è·¯å¾„ç®€æ´ç»Ÿä¸€</span>
<span class="hljs-comment">// 2. ä¸éœ€è¦å…³å¿ƒå…·ä½“æ–‡ä»¶å</span>
<span class="hljs-comment">// 3. ç›®å½•é‡æ„æ—¶åªéœ€ä¿®æ”¹å¯¹åº”çš„ index.ts</span>
<span class="hljs-comment">// 4. ä¾¿äºä»£ç å®¡æŸ¥å’Œè§„èŒƒæ£€æŸ¥</span>
</code></pre>
<h4 data-id="heading-23">5.2 å¦‚ä½•å®ç°å‡ºå£æ–‡ä»¶ï¼Ÿ</h4>
<p><strong>ä¸ºæ¯ä¸ªç±»å‹çš„æ–‡ä»¶åˆ›å»º index.ts</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// stores/models/index.ts</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./user.model"</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./order.model"</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./cart.model"</span>;
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// stores/slices/index.ts</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./user"</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./order"</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./cart"</span>;
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// stores/actions/index.ts</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./user"</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./order"</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">"./cart"</span>;
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// stores/selectors/index.ts</span>
<span class="hljs-comment">// åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç›´æ¥å®šä¹‰å’Œå¯¼å‡º selector hooks</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"../createAppStore"</span>;
<span class="hljs-keyword">import</span> { useShallow } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand/react/shallow"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useUserProfile</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useStore</span>(
    <span class="hljs-title function_">useShallow</span>(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> ({
      <span class="hljs-attr">profile</span>: s.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>,
      <span class="hljs-attr">isLoggedIn</span>: !!s.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>,
    }))
  );
}
<span class="hljs-comment">// ...</span>
</code></pre>
<p><strong>stores/index.ts åªå¯¼å‡ºæ ¸å¿ƒ Store</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// stores/index.ts</span>
<span class="hljs-comment">/**
 * Store æ ¸å¿ƒå¯¼å‡ºæ–‡ä»¶
 *
 * åªå¯¼å‡ºæ ¸å¿ƒçš„ Store Hook å’Œç±»å‹
 */</span>

<span class="hljs-keyword">export</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"./createAppStore"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">AppStore</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./createAppStore"</span>;
</code></pre>
<h4 data-id="heading-24">5.3 ä½¿ç”¨å‡ºå£æ–‡ä»¶</h4>
<p><strong>âœ… Good Case: ä»å„è‡ªçš„å‡ºå£æ–‡ä»¶å¯¼å…¥</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… æ¨èï¼šä»å„è‡ªçš„å‡ºå£æ–‡ä»¶å¯¼å…¥</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores"</span>;
<span class="hljs-keyword">import</span> { login, logout, loadOrders, addToCart } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/actions"</span>;
<span class="hljs-keyword">import</span> { useUserProfile, useCartSummary } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/selectors"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">UserState</span>, <span class="hljs-title class_">Order</span>, <span class="hljs-title class_">CartItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/models"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { profile } = <span class="hljs-title function_">useUserProfile</span>();
  <span class="hljs-keyword">const</span> { itemCount } = <span class="hljs-title function_">useCartSummary</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{profile?.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è´­ç‰©è½¦ï¼š{itemCount} ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> login("user@example.com", "123456")}&gt;ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>âŒ Bad Case: ç›´æ¥ä»å…·ä½“æ–‡ä»¶å¯¼å…¥</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âŒ ä¸æ¨èï¼šç»•è¿‡å‡ºå£æ–‡ä»¶</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/createAppStore"</span>;
<span class="hljs-keyword">import</span> { login, logout } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/actions/user"</span>;
<span class="hljs-keyword">import</span> { loadOrders } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/actions/order"</span>;
<span class="hljs-keyword">import</span> { useUserProfile } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/selectors/useUserProfile"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">UserState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/models/user.model"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Order</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/models/order.model"</span>;

<span class="hljs-comment">// é—®é¢˜ï¼š</span>
<span class="hljs-comment">// 1. å¯¼å…¥è¯­å¥å†—é•¿ï¼Œéš¾ä»¥ç»´æŠ¤</span>
<span class="hljs-comment">// 2. éœ€è¦è®°ä½æ¯ä¸ªå…·ä½“æ–‡ä»¶çš„ä½ç½®</span>
<span class="hljs-comment">// 3. ç ´åäº†å‡ºå£æ–‡ä»¶çš„è®¾è®¡</span>
</code></pre>
<h4 data-id="heading-25">5.4 TypeScript ç±»å‹å¯¼å…¥</h4>
<p><strong>ç±»å‹å¯¼å…¥ä¹Ÿåº”è¯¥ä»å‡ºå£æ–‡ä»¶</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… æ¨èï¼šç±»å‹ä» models/index.ts å¯¼å…¥</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">UserState</span>, <span class="hljs-title class_">Order</span>, <span class="hljs-title class_">CartItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/models"</span>;

<span class="hljs-comment">// âŒ ä¸æ¨èï¼šç›´æ¥ä»å…·ä½“ model æ–‡ä»¶å¯¼å…¥ç±»å‹</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">UserState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/models/user.model"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Order</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/models/order.model"</span>;
</code></pre>
<p><strong>ä½¿ç”¨ <code>import type</code> è¯­æ³•</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// âœ… æ¨èï¼šä½¿ç”¨ import type æ˜ç¡®æ ‡è¯†ç±»å‹å¯¼å…¥</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores"</span>;
<span class="hljs-keyword">import</span> { login } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/actions"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">UserState</span>, <span class="hljs-title class_">Order</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/models"</span>;

<span class="hljs-comment">// æˆ–è€…æ··åˆå¯¼å…¥</span>
<span class="hljs-keyword">import</span> { login } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/actions"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-keyword">type</span> <span class="hljs-title class_">UserState</span>, <span class="hljs-keyword">type</span> <span class="hljs-title class_">Order</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@/stores/models"</span>;
</code></pre>
<h4 data-id="heading-26">5.5 å†…éƒ¨æ–‡ä»¶ä¹‹é—´çš„å¯¼å…¥</h4>
<p><strong>å†…éƒ¨æ–‡ä»¶ï¼ˆstores ç›®å½•å†…ï¼‰å¯ä»¥ç›´æ¥ç›¸äº’å¯¼å…¥</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// stores/actions/user.ts</span>
<span class="hljs-comment">// âœ… å†…éƒ¨æ–‡ä»¶å¯ä»¥ç›´æ¥å¯¼å…¥å…¶ä»–å†…éƒ¨æ–‡ä»¶</span>
<span class="hljs-keyword">import</span> { useStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"../createAppStore"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">UserState</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/user.model"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">login</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">email: <span class="hljs-built_in">string</span>, pwd: <span class="hljs-built_in">string</span></span>) =&gt; {
  <span class="hljs-comment">// ...</span>
};
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// stores/createAppStore.ts</span>
<span class="hljs-comment">// âœ… å†…éƒ¨æ–‡ä»¶å¯ä»¥ç›´æ¥å¯¼å…¥ slices</span>
<span class="hljs-keyword">import</span> { createUserSlice } <span class="hljs-keyword">from</span> <span class="hljs-string">"./slices/user"</span>;
<span class="hljs-keyword">import</span> { createOrderSlice } <span class="hljs-keyword">from</span> <span class="hljs-string">"./slices/order"</span>;
<span class="hljs-keyword">import</span> { createCartSlice } <span class="hljs-keyword">from</span> <span class="hljs-string">"./slices/cart"</span>;
</code></pre>
<p><strong>è§„åˆ™ï¼š</strong></p>
<ul>
<li><strong>å¤–éƒ¨ä½¿ç”¨</strong>ï¼ˆç»„ä»¶ã€é¡µé¢ç­‰ï¼‰â†’ ä»å„è‡ªçš„å‡ºå£æ–‡ä»¶å¯¼å…¥
<ul>
<li><code>useStore</code> â†’ <code>@/stores</code></li>
<li>actions â†’ <code>@/stores/actions</code></li>
<li>selectors â†’ <code>@/stores/selectors</code></li>
<li>types â†’ <code>@/stores/models</code></li>
</ul>
</li>
<li><strong>å†…éƒ¨ä½¿ç”¨</strong>ï¼ˆstores ç›®å½•å†…çš„æ–‡ä»¶ï¼‰â†’ å¯ä»¥ç›´æ¥ç›¸å¯¹å¯¼å…¥</li>
</ul>
<h4 data-id="heading-27">5.6 å‡ºå£æ–‡ä»¶çš„ç»´æŠ¤</h4>
<p><strong>æ·»åŠ æ–°çš„ action æ—¶ï¼š</strong></p>
<ol>
<li>åœ¨ <code>actions/xxx.ts</code> ä¸­ç¼–å†™ action</li>
<li>åœ¨ <code>actions/index.ts</code> ä¸­å¯¼å‡ºï¼ˆå¦‚æœä½¿ç”¨ <code>export *</code>ï¼Œä¼šè‡ªåŠ¨å¯¼å‡ºï¼‰</li>
<li>ç»„ä»¶ä» <code>@/stores/actions</code> å¯¼å…¥</li>
</ol>
<p><strong>æ·»åŠ æ–°çš„ model æ—¶ï¼š</strong></p>
<ol>
<li>åœ¨ <code>models/xxx.model.ts</code> ä¸­å®šä¹‰ç±»å‹å’Œåˆå§‹çŠ¶æ€</li>
<li>åœ¨ <code>models/index.ts</code> ä¸­å¯¼å‡º</li>
<li>ç»„ä»¶ä» <code>@/stores/models</code> å¯¼å…¥ç±»å‹</li>
</ol>
<p><strong>æ·»åŠ æ–°çš„ selector hook æ—¶ï¼š</strong></p>
<ol>
<li>åœ¨ <code>selectors/index.ts</code> ä¸­ç¼–å†™ hook</li>
<li>ç»„ä»¶ä» <code>@/stores/selectors</code> å¯¼å…¥</li>
</ol>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ <code>export *</code> ç®€åŒ–å¯¼å‡ºè¯­å¥</li>
<li>ä¸ºæ¯ä¸ªç±»å‹çš„æ–‡ä»¶åˆ›å»º <code>index.ts</code> ä½œä¸ºå‡ºå£</li>
<li><code>stores/index.ts</code> åªå¯¼å‡º <code>useStore</code> å’Œ <code>AppStore</code></li>
<li>å®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰ç»„ä»¶ç»•è¿‡å‡ºå£æ–‡ä»¶å¯¼å…¥</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Express.js åŸºç¡€]]></title>    <link>https://juejin.cn/post/7584740835367993398</link>    <guid>https://juejin.cn/post/7584740835367993398</guid>    <pubDate>2025-12-18T02:31:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584740835367993398" data-draft-id="7584724634172784703" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Express.js åŸºç¡€"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-18T02:31:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¢¨å­åŒå¿—"/> <meta itemprop="url" content="https://juejin.cn/user/2084329779627965"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Express.js åŸºç¡€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2084329779627965/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¢¨å­åŒå¿—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:31:30.000Z" title="Thu Dec 18 2025 02:31:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Express.js æ˜¯ Node.js ç”Ÿæ€ç³»ç»Ÿä¸­æœ€æµè¡Œã€æœ€æˆç†Ÿçš„ Web åº”ç”¨æ¡†æ¶ã€‚å®ƒæä¾›äº†æç®€ä¸”çµæ´»çš„ APIï¼Œä½¿å¾—æ„å»º Web æœåŠ¡å™¨å’Œ RESTful API å˜å¾—å¿«é€Ÿè€Œç®€å•ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€Express ç®€ä»‹ä¸å®‰è£…</h2>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯ Express</h3>
<p>Express æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„æç®€ä¸”çµæ´»çš„ Web åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œæä¾›äº†ä¸€ç»„å¼ºå¤§çš„åŠŸèƒ½ï¼Œé€‚ç”¨äº Web å’Œç§»åŠ¨åº”ç”¨ç¨‹åºçš„å¼€å‘ã€‚å®ƒæ„å»ºåœ¨ Node.js çš„ HTTP æ¨¡å—ä¹‹ä¸Šï¼Œç®€åŒ–äº†æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºçš„å¼€å‘è¿‡ç¨‹ã€‚</p>
<h3 data-id="heading-2">å®‰è£… Express</h3>
<p>åœ¨ä½¿ç”¨ Express ä¹‹å‰ï¼Œéœ€è¦å…ˆå®‰è£…å®ƒã€‚Express é€šè¿‡ npmï¼ˆNode Package Managerï¼‰è¿›è¡Œå®‰è£…å’Œç®¡ç†ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºé¡¹ç›®ç›®å½•</span>
<span class="hljs-built_in">mkdir</span> my-express-app
<span class="hljs-built_in">cd</span> my-express-app

<span class="hljs-comment"># åˆå§‹åŒ–é¡¹ç›®ï¼ˆåˆ›å»º package.jsonï¼‰</span>
npm init -y

<span class="hljs-comment"># å®‰è£… Express</span>
npm install express
</code></pre>
<hr/>
<h2 data-id="heading-3">äºŒã€åˆ›å»ºç¬¬ä¸€ä¸ª Express åº”ç”¨</h2>
<p>åˆ›å»ºä¸€ä¸ª Express åº”ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦è°ƒç”¨ <code>express()</code> å‡½æ•°å³å¯ã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ª Express åº”ç”¨å®ä¾‹ï¼Œå®ƒæ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¸å¿ƒã€‚</p>
<h3 data-id="heading-4">æœ€ç®€å•çš„ Express åº”ç”¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¼•å…¥ Express æ¨¡å—</span>
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);

<span class="hljs-comment">// åˆ›å»º Express åº”ç”¨å®ä¾‹</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// å®šä¹‰è·¯ç”±</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Hello World!'</span>);
});

<span class="hljs-comment">// å¯åŠ¨æœåŠ¡å™¨ï¼Œç›‘å¬æŒ‡å®šç«¯å£</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3000</span>;
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
});
</code></pre>
<h3 data-id="heading-5">express() å‡½æ•°</h3>
<p><code>express()</code> æ˜¯ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œç”¨äºåˆ›å»º Express åº”ç”¨å®ä¾‹ã€‚è¿™ä¸ªå®ä¾‹åŒ…å«äº†æ‰€æœ‰ Express çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬è·¯ç”±ã€ä¸­é—´ä»¶ã€æ¨¡æ¿å¼•æ“ç­‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();  <span class="hljs-comment">// åˆ›å»ºåº”ç”¨å®ä¾‹</span>

<span class="hljs-comment">// app å¯¹è±¡ç°åœ¨åŒ…å«äº†æ‰€æœ‰ Express çš„æ–¹æ³•å’Œå±æ€§</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> app);  <span class="hljs-comment">// 'function'ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼‰</span>
</code></pre>
<h3 data-id="heading-6">app.listen() æ–¹æ³•</h3>
<p><code>app.listen()</code> æ–¹æ³•ç”¨äºå¯åŠ¨æœåŠ¡å™¨å¹¶å¼€å§‹ç›‘å¬æŒ‡å®šç«¯å£çš„ HTTP è¯·æ±‚ã€‚å®ƒæ˜¯ Express åº”ç”¨å¯åŠ¨çš„å…³é”®æ–¹æ³•ã€‚</p>
<p><strong>åŸºæœ¬è¯­æ³•ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">listen</span>(port, callback)
</code></pre>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>port</code>: è¦ç›‘å¬çš„ç«¯å£å·ï¼ˆæ•°å­—ï¼‰
<ul>
<li><strong>ç«¯å£å·èŒƒå›´</strong>ï¼šæœ‰æ•ˆç«¯å£å·ä¸º 0-65535</li>
<li><strong>æ¨èç«¯å£</strong>ï¼šå¼€å‘ç¯å¢ƒå¸¸ç”¨ 3000ã€3001ã€8000ã€8080ã€5000 ç­‰</li>
<li><strong>ä¸èƒ½ä½¿ç”¨çš„ç«¯å£</strong>ï¼š
<ul>
<li><strong>0-1023</strong>ï¼šç³»ç»Ÿä¿ç•™ç«¯å£ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ï¼Œå¸¸è§çš„æœ‰ï¼š
<ul>
<li>80ï¼šHTTPï¼ˆé€šå¸¸éœ€è¦ root æƒé™ï¼‰</li>
<li>443ï¼šHTTPSï¼ˆé€šå¸¸éœ€è¦ root æƒé™ï¼‰</li>
<li>22ï¼šSSH</li>
<li>21ï¼šFTP</li>
<li>25ï¼šSMTP</li>
<li>3306ï¼šMySQL</li>
<li>5432ï¼šPostgreSQL</li>
</ul>
</li>
<li><strong>1024-49151</strong>ï¼šæ³¨å†Œç«¯å£ï¼ˆIANA æ³¨å†Œï¼‰ï¼Œåº”é¿å…ä¸å·²çŸ¥æœåŠ¡å†²çª</li>
<li><strong>49152-65535</strong>ï¼šåŠ¨æ€/ç§æœ‰ç«¯å£ï¼ˆç›¸å¯¹å®‰å…¨ï¼Œé€‚åˆå¼€å‘ä½¿ç”¨ï¼‰</li>
</ul>
</li>
<li><strong>æ³¨æ„äº‹é¡¹</strong>ï¼šå¦‚æœç«¯å£å·²è¢«å ç”¨ï¼Œä¼šæŠ›å‡º <code>EADDRINUSE</code> é”™è¯¯</li>
</ul>
</li>
<li><code>callback</code>: æœåŠ¡å™¨å¯åŠ¨åæ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼ˆå¯é€‰ï¼‰</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// æ–¹å¼ä¸€ï¼šåªæŒ‡å®šç«¯å£</span>
app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);

<span class="hljs-comment">// æ–¹å¼äºŒï¼šæŒ‡å®šç«¯å£å’Œå›è°ƒå‡½æ•°ï¼ˆæ¨èï¼‰</span>
app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æœåŠ¡å™¨è¿è¡Œåœ¨ 3000 ç«¯å£'</span>);
});

<span class="hljs-comment">// æ–¹å¼ä¸‰ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®ç«¯å£</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3000</span>;
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœåŠ¡å™¨è¿è¡Œåœ¨ <span class="hljs-subst">${PORT}</span> ç«¯å£`</span>);
});
</code></pre>
<p><strong>ä½¿ç”¨ Node.js HTTP æ¨¡å—ï¼ˆåº•å±‚æ–¹å¼ï¼‰ï¼š</strong></p>
<p>Express çš„ <code>app.listen()</code> å®é™…ä¸Šæ˜¯å¯¹ Node.js <code>http.createServer()</code> çš„å°è£…ã€‚ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ HTTP æ¨¡å—ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(app);

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æœåŠ¡å™¨è¿è¡Œåœ¨ 3000 ç«¯å£'</span>);
});
</code></pre>
<hr/>
<h2 data-id="heading-7">ä¸‰ã€è·¯ç”±åŸºç¡€</h2>
<p>è·¯ç”±æ˜¯ Express åº”ç”¨çš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ã€‚å®ƒå®šä¹‰äº†åº”ç”¨å¦‚ä½•å“åº”å®¢æˆ·ç«¯å¯¹ä¸åŒ URL è·¯å¾„å’Œ HTTP æ–¹æ³•çš„è¯·æ±‚ã€‚</p>
<h3 data-id="heading-8">ä»€ä¹ˆæ˜¯è·¯ç”±</h3>
<p>è·¯ç”±æ˜¯æŒ‡ç¡®å®šåº”ç”¨ç¨‹åºå¦‚ä½•å“åº”å®¢æˆ·ç«¯å¯¹ç‰¹å®šç«¯ç‚¹çš„è¯·æ±‚ï¼Œè¯¥ç«¯ç‚¹æ˜¯ URIï¼ˆæˆ–è·¯å¾„ï¼‰å’Œç‰¹å®šçš„ HTTP è¯·æ±‚æ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETE ç­‰ï¼‰çš„ç»„åˆã€‚</p>
<h3 data-id="heading-9">è·¯ç”±çš„åŸºæœ¬ç»“æ„</h3>
<p>æ¯ä¸ªè·¯ç”±éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå¤„ç†å‡½æ•°ï¼Œå½“è·¯ç”±åŒ¹é…æ—¶æ‰§è¡Œï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">METHOD</span>(path, handler)
</code></pre>
<ul>
<li><code>app</code>: Express åº”ç”¨å®ä¾‹</li>
<li><code>METHOD</code>: HTTP è¯·æ±‚æ–¹æ³•ï¼ˆgetã€postã€putã€delete ç­‰ï¼‰</li>
<li><code>path</code>: æœåŠ¡å™¨ä¸Šçš„è·¯å¾„</li>
<li><code>handler</code>: è·¯ç”±åŒ¹é…æ—¶æ‰§è¡Œçš„å‡½æ•°</li>
</ul>
<h3 data-id="heading-10">HTTP æ–¹æ³•è·¯ç”±</h3>
<p>Express æ”¯æŒæ‰€æœ‰ HTTP æ–¹æ³•ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ GETã€POSTã€PUT å’Œ DELETEã€‚</p>
<h4 data-id="heading-11">app.get() - GET è¯·æ±‚</h4>
<p>GET è¯·æ±‚ç”¨äºè·å–èµ„æºï¼Œæ˜¯æœ€å¸¸ç”¨çš„ HTTP æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·å–æ‰€æœ‰ç”¨æˆ·</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>([
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Jane'</span> }
  ]);
});

<span class="hljs-comment">// è·å–å•ä¸ªç”¨æˆ·</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> userId = req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">id</span>: userId, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> });
});
</code></pre>
<h4 data-id="heading-12">app.post() - POST è¯·æ±‚</h4>
<p>POST è¯·æ±‚ç”¨äºåˆ›å»ºæ–°èµ„æºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// éœ€è¦é…ç½®ä¸­é—´ä»¶è§£æè¯·æ±‚ä½“</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

<span class="hljs-comment">// åˆ›å»ºç”¨æˆ·</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { name, email } = req.<span class="hljs-property">body</span>;
  
  <span class="hljs-comment">// åˆ›å»ºç”¨æˆ·çš„é€»è¾‘...</span>
  
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">201</span>).<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: name,
    <span class="hljs-attr">email</span>: email,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'ç”¨æˆ·åˆ›å»ºæˆåŠŸ'</span>
  });
});
</code></pre>
<h4 data-id="heading-13">app.put() - PUT è¯·æ±‚</h4>
<p>PUT è¯·æ±‚ç”¨äºæ›´æ–°æ•´ä¸ªèµ„æºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

<span class="hljs-comment">// æ›´æ–°ç”¨æˆ·ï¼ˆå®Œæ•´æ›´æ–°ï¼‰</span>
app.<span class="hljs-title function_">put</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> userId = req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;
  <span class="hljs-keyword">const</span> { name, email } = req.<span class="hljs-property">body</span>;
  
  <span class="hljs-comment">// æ›´æ–°ç”¨æˆ·çš„é€»è¾‘...</span>
  
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">id</span>: userId,
    <span class="hljs-attr">name</span>: name,
    <span class="hljs-attr">email</span>: email,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'ç”¨æˆ·æ›´æ–°æˆåŠŸ'</span>
  });
});
</code></pre>
<h4 data-id="heading-14">app.delete() - DELETE è¯·æ±‚</h4>
<p>DELETE è¯·æ±‚ç”¨äºåˆ é™¤èµ„æºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ é™¤ç”¨æˆ·</span>
app.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> userId = req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;
  
  <span class="hljs-comment">// åˆ é™¤ç”¨æˆ·çš„é€»è¾‘...</span>
  
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">204</span>).<span class="hljs-title function_">send</span>();  <span class="hljs-comment">// 204 No Content</span>
});
</code></pre>
<h4 data-id="heading-15">å…¶ä»– HTTP æ–¹æ³•</h4>
<p>Express è¿˜æ”¯æŒå…¶ä»– HTTP æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// PATCH - éƒ¨åˆ†æ›´æ–°</span>
app.<span class="hljs-title function_">patch</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'éƒ¨åˆ†æ›´æ–°ç”¨æˆ·'</span> });
});

<span class="hljs-comment">// OPTIONS - é¢„æ£€è¯·æ±‚</span>
<span class="hljs-comment">// ä½¿ç”¨åœºæ™¯ï¼šä¸»è¦ç”¨äº CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰åœºæ™¯</span>
<span class="hljs-comment">// - å½“å‰ç«¯åº”ç”¨ï¼ˆå¦‚ http://localhost:3000ï¼‰è¯·æ±‚åç«¯ APIï¼ˆå¦‚ http://localhost:8080ï¼‰æ—¶</span>
<span class="hljs-comment">// - å½“è¯·æ±‚ä½¿ç”¨äº† PUTã€DELETEã€PATCH ç­‰éç®€å•æ–¹æ³•ï¼Œæˆ–åŒ…å«è‡ªå®šä¹‰è¯·æ±‚å¤´æ—¶</span>
<span class="hljs-comment">// è§£å†³çš„é—®é¢˜ï¼š</span>
<span class="hljs-comment">// - æµè§ˆå™¨å®‰å…¨ç­–ç•¥ï¼šæµè§ˆå™¨ä¼šé˜»æ­¢è·¨åŸŸè¯·æ±‚ï¼Œé™¤éæœåŠ¡å™¨æ˜ç¡®å…è®¸</span>
<span class="hljs-comment">// - å‘ŠçŸ¥å®¢æˆ·ç«¯æœåŠ¡å™¨æ”¯æŒå“ªäº› HTTP æ–¹æ³•å’Œè¯·æ±‚å¤´</span>
app.<span class="hljs-title function_">options</span>(<span class="hljs-string">'/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">set</span>(<span class="hljs-string">'Allow'</span>, <span class="hljs-string">'GET, POST, OPTIONS'</span>);
  res.<span class="hljs-title function_">send</span>();
});

<span class="hljs-comment">// HEAD - è·å–å“åº”å¤´</span>
app.<span class="hljs-title function_">head</span>(<span class="hljs-string">'/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">end</span>();
});
</code></pre>
<h3 data-id="heading-16">è·¯ç”±è·¯å¾„åŒ¹é…</h3>
<p>Express æ”¯æŒå¤šç§è·¯ç”±è·¯å¾„åŒ¹é…æ–¹å¼ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²åŒ¹é…ã€æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å’Œå‚æ•°åŒ¹é…ã€‚</p>
<h4 data-id="heading-17">å­—ç¬¦ä¸²è·¯å¾„åŒ¹é…</h4>
<p>æœ€ç®€å•çš„è·¯ç”±è·¯å¾„æ˜¯å­—ç¬¦ä¸²åŒ¹é…ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç²¾ç¡®åŒ¹é…</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/about'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'å…³äºé¡µé¢'</span>);
});

<span class="hljs-comment">// åŒ¹é…æ ¹è·¯å¾„</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'é¦–é¡µ'</span>);
});
</code></pre>
<h4 data-id="heading-18">è·¯å¾„å‚æ•°åŒ¹é…</h4>
<p>ä½¿ç”¨ <code>:</code> å®šä¹‰è·¯å¾„å‚æ•°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å•ä¸ªå‚æ•°</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">userId</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span> });
});

<span class="hljs-comment">// å¤šä¸ªå‚æ•°</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:userId/posts/:postId'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">userId</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">userId</span>,
    <span class="hljs-attr">postId</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">postId</span>
  });
});
</code></pre>
<h4 data-id="heading-19">å¯é€‰å‚æ•°</h4>
<p>ä½¿ç”¨ <code>?</code> å®šä¹‰å¯é€‰å‚æ•°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// /users å’Œ /users/:id éƒ½å¯ä»¥åŒ¹é…</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id?'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>) {
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">userId</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span> });
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'æ‰€æœ‰ç”¨æˆ·'</span> });
  }
});
</code></pre>
<h4 data-id="heading-20">é€šé…ç¬¦åŒ¹é…</h4>
<p>ä½¿ç”¨ <code>*</code> è¿›è¡Œé€šé…ç¬¦åŒ¹é…ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŒ¹é… /users/ åé¢çš„æ‰€æœ‰è·¯å¾„</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/*'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'ç”¨æˆ·ç›¸å…³é¡µé¢'</span>);
});
</code></pre>
<h4 data-id="heading-21">æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</h4>
<p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå¤æ‚åŒ¹é…ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åªåŒ¹é…æ•°å­— ID</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id(\\d+)'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">userId</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span> });
});

<span class="hljs-comment">// åŒ¹é…ç‰¹å®šæ ¼å¼</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/files/:filename(.*\\.(jpg|png|gif))'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`å›¾ç‰‡æ–‡ä»¶: <span class="hljs-subst">${req.params.filename}</span>`</span>);
});
</code></pre>
<h3 data-id="heading-22">å¤šä¸ªå¤„ç†å‡½æ•°</h3>
<p>ä¸€ä¸ªè·¯ç”±å¯ä»¥æœ‰å¤šä¸ªå¤„ç†å‡½æ•°ï¼ˆä¸­é—´ä»¶ï¼‰ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// éªŒè¯å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">validateUser</span>(<span class="hljs-params">req, res, next</span>) {
  <span class="hljs-keyword">const</span> userId = req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;
  <span class="hljs-keyword">if</span> (!userId || <span class="hljs-built_in">isNaN</span>(userId)) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'æ— æ•ˆçš„ç”¨æˆ· ID'</span> });
  }
  <span class="hljs-title function_">next</span>();  <span class="hljs-comment">// ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å‡½æ•°</span>
}

<span class="hljs-comment">// è·å–ç”¨æˆ·å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-keyword">const</span> userId = req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">id</span>: userId, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> });
}

<span class="hljs-comment">// ä½¿ç”¨å¤šä¸ªå¤„ç†å‡½æ•°</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id'</span>, validateUser, getUser);
</code></pre>
<hr/>
<h2 data-id="heading-23">å››ã€è¯·æ±‚å¯¹è±¡ï¼ˆreqï¼‰ï¼šè·å–è¯·æ±‚æ•°æ®</h2>
<p>åœ¨ Express ä¸­ï¼Œæ¯ä¸ªè·¯ç”±å¤„ç†å‡½æ•°éƒ½ä¼šæ¥æ”¶è¯·æ±‚å¯¹è±¡ï¼ˆ<code>req</code>ï¼‰ï¼Œå®ƒåŒ…å«äº†å®¢æˆ·ç«¯å‘é€çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯·æ±‚å¤´ã€è¯·æ±‚å‚æ•°ã€è¯·æ±‚ä½“ç­‰ã€‚</p>
<h3 data-id="heading-24">req.params - è·¯å¾„å‚æ•°</h3>
<p>è·¯å¾„å‚æ•°æ˜¯ URL è·¯å¾„ä¸­çš„åŠ¨æ€éƒ¨åˆ†ï¼Œä½¿ç”¨ <code>:</code> å®šä¹‰ï¼Œé€šè¿‡ <code>req.params</code> å¯¹è±¡è®¿é—®ã€‚</p>
<h4 data-id="heading-25">åŸºæœ¬ç”¨æ³•</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®šä¹‰è·¯å¾„å‚æ•°</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">params</span>);  <span class="hljs-comment">// { id: '123' }</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);  <span class="hljs-comment">// '123'</span>
  
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">userId</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'è·å–ç”¨æˆ·ä¿¡æ¯'</span>
  });
});

<span class="hljs-comment">// è®¿é—® /users/123</span>
<span class="hljs-comment">// req.params = { id: '123' }</span>
</code></pre>
<h4 data-id="heading-26">å¤šä¸ªè·¯å¾„å‚æ•°</h4>
<p>ä¸€ä¸ªè·¯ç”±å¯ä»¥å®šä¹‰å¤šä¸ªè·¯å¾„å‚æ•°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:userId/posts/:postId'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">params</span>);
  <span class="hljs-comment">// è®¿é—® /users/123/posts/456</span>
  <span class="hljs-comment">// req.params = { userId: '123', postId: '456' }</span>
  
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">userId</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">userId</span>,
    <span class="hljs-attr">postId</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">postId</span>
  });
});
</code></pre>
<h4 data-id="heading-27">è·¯å¾„å‚æ•°å‘½åè§„åˆ™</h4>
<p>è·¯å¾„å‚æ•°çš„åç§°å¯ä»¥æ˜¯å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿çš„ç»„åˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æœ‰æ•ˆ</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id'</span>, handler);
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:userId'</span>, handler);
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:user_id'</span>, handler);

<span class="hljs-comment">// æ— æ•ˆï¼ˆä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼‰</span>
<span class="hljs-comment">// app.get('/users/:user-id', handler);  // é”™è¯¯</span>
</code></pre>
<h3 data-id="heading-28">req.query - æŸ¥è¯¢å‚æ•°</h3>
<p>æŸ¥è¯¢å‚æ•°æ˜¯ URL ä¸­ <code>?</code> åé¢çš„é”®å€¼å¯¹ï¼Œé€šè¿‡ <code>req.query</code> å¯¹è±¡è®¿é—®ã€‚æŸ¥è¯¢å‚æ•°ç”¨äºè¿‡æ»¤ã€æ’åºã€åˆ†é¡µç­‰æ“ä½œã€‚</p>
<h4 data-id="heading-29">åŸºæœ¬ç”¨æ³•</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®¿é—® /search?q=express&amp;page=1</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/search'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">query</span>);  <span class="hljs-comment">// { q: 'express', page: '1' }</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">q</span>);  <span class="hljs-comment">// 'express'</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">page</span>);  <span class="hljs-comment">// '1'</span>
  
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">query</span>: req.<span class="hljs-property">query</span>.<span class="hljs-property">q</span>,
    <span class="hljs-attr">page</span>: req.<span class="hljs-property">query</span>.<span class="hljs-property">page</span>
  });
});
</code></pre>
<h4 data-id="heading-30">å¤šä¸ªæŸ¥è¯¢å‚æ•°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®¿é—® /products?category=electronics&amp;minPrice=100&amp;maxPrice=500&amp;sort=price</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/products'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { category, minPrice, maxPrice, sort } = req.<span class="hljs-property">query</span>;
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åˆ†ç±»:'</span>, category);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æœ€ä½ä»·æ ¼:'</span>, minPrice);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æœ€é«˜ä»·æ ¼:'</span>, maxPrice);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ’åº:'</span>, sort);
  
  <span class="hljs-comment">// ä½¿ç”¨æŸ¥è¯¢å‚æ•°è¿›è¡Œè¿‡æ»¤å’Œæ’åº...</span>
  
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">category</span>: category,
    <span class="hljs-attr">minPrice</span>: minPrice,
    <span class="hljs-attr">maxPrice</span>: maxPrice,
    <span class="hljs-attr">sort</span>: sort
  });
});
</code></pre>
<h4 data-id="heading-31">æ•°ç»„æŸ¥è¯¢å‚æ•°</h4>
<p>æŸ¥è¯¢å‚æ•°å¯ä»¥æ˜¯æ•°ç»„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®¿é—® /products?tags=javascript&amp;tags=nodejs&amp;tags=express</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/products'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">tags</span>);  <span class="hljs-comment">// ['javascript', 'nodejs', 'express']</span>
  
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">tags</span>: req.<span class="hljs-property">query</span>.<span class="hljs-property">tags</span>
  });
});
</code></pre>
<h4 data-id="heading-32">æŸ¥è¯¢å‚æ•°çš„é»˜è®¤å€¼</h4>
<p>ä¸ºæŸ¥è¯¢å‚æ•°æä¾›é»˜è®¤å€¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/products'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> page = <span class="hljs-built_in">parseInt</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">page</span>) || <span class="hljs-number">1</span>;  <span class="hljs-comment">// é»˜è®¤ç¬¬ 1 é¡µ</span>
  <span class="hljs-keyword">const</span> limit = <span class="hljs-built_in">parseInt</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">limit</span>) || <span class="hljs-number">10</span>;  <span class="hljs-comment">// é»˜è®¤æ¯é¡µ 10 æ¡</span>
  <span class="hljs-keyword">const</span> sort = req.<span class="hljs-property">query</span>.<span class="hljs-property">sort</span> || <span class="hljs-string">'id'</span>;  <span class="hljs-comment">// é»˜è®¤æŒ‰ id æ’åº</span>
  
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">page</span>: page,
    <span class="hljs-attr">limit</span>: limit,
    <span class="hljs-attr">sort</span>: sort
  });
});
</code></pre>
<h3 data-id="heading-33">req.body - è¯·æ±‚ä½“</h3>
<p>è¯·æ±‚ä½“åŒ…å« POSTã€PUT ç­‰è¯·æ±‚ä¸­å‘é€çš„æ•°æ®ã€‚éœ€è¦ä¸­é—´ä»¶æ¥è§£æï¼ˆå¦‚ <code>express.json()</code>ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// éœ€è¦å…ˆé…ç½®ä¸­é—´ä»¶</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">body</span>);  <span class="hljs-comment">// { name: 'John', email: 'john@example.com' }</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">body</span>.<span class="hljs-property">name</span>);  <span class="hljs-comment">// 'John'</span>
  
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">name</span>,
    <span class="hljs-attr">email</span>: req.<span class="hljs-property">body</span>.<span class="hljs-property">email</span>
  });
});
</code></pre>
<h3 data-id="heading-34">req çš„å…¶ä»–å¸¸ç”¨å±æ€§</h3>
<h4 data-id="heading-35">req.headers - è¯·æ±‚å¤´</h4>
<p>è¯·æ±‚å¤´åŒ…å«äº†å®¢æˆ·ç«¯å‘é€çš„æ‰€æœ‰ HTTP å¤´ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">headers</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">headers</span>[<span class="hljs-string">'user-agent'</span>]);  <span class="hljs-comment">// æµè§ˆå™¨ä¿¡æ¯</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">headers</span>[<span class="hljs-string">'content-type'</span>]);  <span class="hljs-comment">// å†…å®¹ç±»å‹</span>
});
</code></pre>
<h4 data-id="heading-36">req.method - HTTP æ–¹æ³•</h4>
<p>è·å–è¯·æ±‚çš„ HTTP æ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETE ç­‰ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è¯·æ±‚æ–¹æ³•: <span class="hljs-subst">${req.method}</span>`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è¯·æ±‚è·¯å¾„: <span class="hljs-subst">${req.path}</span>`</span>);
  <span class="hljs-title function_">next</span>();
});
</code></pre>
<h4 data-id="heading-37">req.path - è¯·æ±‚è·¯å¾„</h4>
<p>è·å–è¯·æ±‚çš„è·¯å¾„éƒ¨åˆ†ï¼ˆä¸åŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®¿é—® /users/123?page=1</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">path</span>);  <span class="hljs-comment">// '/users/123'</span>
});
</code></pre>
<h4 data-id="heading-38">req.url - å®Œæ•´ URL</h4>
<p>è·å–è¯·æ±‚çš„å®Œæ•´ URLï¼ˆåŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®¿é—® /users/123?page=1</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(req.<span class="hljs-property">url</span>);  <span class="hljs-comment">// '/users/123?page=1'</span>
});
</code></pre>
<h4 data-id="heading-39">req.ip - å®¢æˆ·ç«¯ IP åœ°å€</h4>
<p>è·å–å®¢æˆ·ç«¯çš„ IP åœ°å€ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å®¢æˆ·ç«¯ IP:'</span>, req.<span class="hljs-property">ip</span>);
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`ä½ çš„ IP åœ°å€æ˜¯: <span class="hljs-subst">${req.ip}</span>`</span>);
});
</code></pre>
<h3 data-id="heading-40">è·¯å¾„å‚æ•° vs æŸ¥è¯¢å‚æ•°</h3>
<p>ç†è§£è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°çš„åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯å¾ˆé‡è¦ï¼š</p>
<p><strong>è·¯å¾„å‚æ•°ï¼ˆreq.paramsï¼‰ï¼š</strong></p>
<ul>
<li>ç”¨äºæ ‡è¯†èµ„æºï¼ˆå¦‚ç”¨æˆ· IDã€æ–‡ç«  IDï¼‰</li>
<li>URL çš„ä¸€éƒ¨åˆ†ï¼Œå¿…éœ€</li>
<li>ç¤ºä¾‹ï¼š<code>/users/123</code>ï¼ˆ123 æ˜¯ç”¨æˆ· IDï¼‰</li>
</ul>
<p><strong>æŸ¥è¯¢å‚æ•°ï¼ˆreq.queryï¼‰ï¼š</strong></p>
<ul>
<li>ç”¨äºè¿‡æ»¤ã€æ’åºã€åˆ†é¡µç­‰æ“ä½œ</li>
<li>URL çš„å¯é€‰éƒ¨åˆ†</li>
<li>ç¤ºä¾‹ï¼š<code>/users?page=1&amp;limit=10</code>ï¼ˆpage å’Œ limit ç”¨äºåˆ†é¡µï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-41">äº”ã€å“åº”å¯¹è±¡ï¼ˆresï¼‰ï¼šå‘é€å“åº”</h2>
<p>å“åº”å¯¹è±¡ï¼ˆ<code>res</code>ï¼‰ä»£è¡¨ HTTP å“åº”ï¼Œç”¨äºå‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€è®¾ç½®å“åº”å¤´ã€è®¾ç½®çŠ¶æ€ç ç­‰ã€‚</p>
<h3 data-id="heading-42">res.send() - é€šç”¨å“åº”æ–¹æ³•</h3>
<p><code>res.send()</code> æ˜¯æœ€çµæ´»çš„å“åº”æ–¹æ³•ï¼Œå¯ä»¥å‘é€å„ç§ç±»å‹çš„æ•°æ®ã€‚Express ä¼šæ ¹æ®æ•°æ®ç±»å‹è‡ªåŠ¨è®¾ç½®é€‚å½“çš„ <code>Content-Type</code>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Hello World!'</span>);  <span class="hljs-comment">// å‘é€å­—ç¬¦ä¸²ï¼ŒContent-Type: text/html</span>
});

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/json'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello'</span> });  <span class="hljs-comment">// å‘é€å¯¹è±¡ï¼ŒContent-Type: application/json</span>
});

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/buffer'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(<span class="hljs-string">'Hello'</span>));  <span class="hljs-comment">// å‘é€ Bufferï¼ŒContent-Type: application/octet-stream</span>
});

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>([
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Jane'</span> }
  ]);  <span class="hljs-comment">// å‘é€æ•°ç»„ï¼ŒContent-Type: application/json</span>
});
</code></pre>
<h3 data-id="heading-43">res.json() - JSON å“åº”</h3>
<p><code>res.json()</code> ä¸“é—¨ç”¨äºå‘é€ JSON å“åº”ï¼Œä¼šè‡ªåŠ¨è®¾ç½® <code>Content-Type</code> ä¸º <code>application/json</code>ï¼Œå¹¶è°ƒç”¨ <code>JSON.stringify()</code>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/user'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span>
  });
});

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>([
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Jane'</span> }
  ]);
});

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/user/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">id</span>: req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>,
    <span class="hljs-attr">profile</span>: {
      <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,
      <span class="hljs-attr">city</span>: <span class="hljs-string">'New York'</span>
    },
    <span class="hljs-attr">tags</span>: [<span class="hljs-string">'developer'</span>, <span class="hljs-string">'nodejs'</span>]
  });
});
</code></pre>
<h3 data-id="heading-44">res.status() - è®¾ç½®çŠ¶æ€ç </h3>
<p><code>res.status()</code> ç”¨äºè®¾ç½® HTTP å“åº”çŠ¶æ€ç ï¼Œé€šå¸¸ä¸å…¶ä»–å“åº”æ–¹æ³•é“¾å¼è°ƒç”¨ã€‚</p>
<h4 data-id="heading-45">åŸºæœ¬ç”¨æ³•</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æˆåŠŸå“åº”ï¼ˆ200ï¼‰</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/success'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'æˆåŠŸ'</span> });
});

<span class="hljs-comment">// åˆ›å»ºæˆåŠŸï¼ˆ201ï¼‰</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">201</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> });
});

<span class="hljs-comment">// æœªæ‰¾åˆ°ï¼ˆ404ï¼‰</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/not-found'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'èµ„æºæœªæ‰¾åˆ°'</span> });
});

<span class="hljs-comment">// æœåŠ¡å™¨é”™è¯¯ï¼ˆ500ï¼‰</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/error'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'</span> });
});
</code></pre>
<h4 data-id="heading-46">å¸¸ç”¨ HTTP çŠ¶æ€ç </h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 2xx - æˆåŠŸ</span>
res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'OK'</span> });           <span class="hljs-comment">// æˆåŠŸ</span>
res.<span class="hljs-title function_">status</span>(<span class="hljs-number">201</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Created'</span> });       <span class="hljs-comment">// åˆ›å»ºæˆåŠŸ</span>
res.<span class="hljs-title function_">status</span>(<span class="hljs-number">204</span>).<span class="hljs-title function_">send</span>();                             <span class="hljs-comment">// æ— å†…å®¹ï¼ˆå¸¸ç”¨äº DELETEï¼‰</span>

<span class="hljs-comment">// 4xx - å®¢æˆ·ç«¯é”™è¯¯</span>
res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Bad Request'</span> });     <span class="hljs-comment">// è¯·æ±‚é”™è¯¯</span>
res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Unauthorized'</span> });   <span class="hljs-comment">// æœªæˆæƒ</span>
res.<span class="hljs-title function_">status</span>(<span class="hljs-number">403</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Forbidden'</span> });       <span class="hljs-comment">// ç¦æ­¢è®¿é—®</span>
res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Not Found'</span> });       <span class="hljs-comment">// æœªæ‰¾åˆ°</span>
res.<span class="hljs-title function_">status</span>(<span class="hljs-number">409</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Conflict'</span> });       <span class="hljs-comment">// å†²çª</span>

<span class="hljs-comment">// 5xx - æœåŠ¡å™¨é”™è¯¯</span>
res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Internal Server Error'</span> });  <span class="hljs-comment">// æœåŠ¡å™¨é”™è¯¯</span>
res.<span class="hljs-title function_">status</span>(<span class="hljs-number">503</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Service Unavailable'</span> });     <span class="hljs-comment">// æœåŠ¡ä¸å¯ç”¨</span>
</code></pre>
<h3 data-id="heading-47">res.redirect() - é‡å®šå‘</h3>
<p><code>res.redirect()</code> ç”¨äºå°†å®¢æˆ·ç«¯é‡å®šå‘åˆ°å¦ä¸€ä¸ª URLã€‚è¿™å¯¹äºé¡µé¢è·³è½¬ã€URL é‡å†™ç­‰åœºæ™¯éå¸¸æœ‰ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸´æ—¶é‡å®šå‘ï¼ˆ302ï¼‰</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/old-page'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">'/new-page'</span>);
});

<span class="hljs-comment">// æ°¸ä¹…é‡å®šå‘ï¼ˆ301ï¼‰</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/old-url'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">redirect</span>(<span class="hljs-number">301</span>, <span class="hljs-string">'/new-url'</span>);
});

<span class="hljs-comment">// é‡å®šå‘åˆ°å¤–éƒ¨ URL</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/external'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">'https://www.example.com'</span>);
});

<span class="hljs-comment">// é‡å®šå‘åˆ°ç›¸å¯¹è·¯å¾„</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/login'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// ç™»å½•æˆåŠŸåé‡å®šå‘åˆ°é¦–é¡µ</span>
  res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">'/'</span>);
});

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id/edit'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// ç¼–è¾‘å®Œæˆåé‡å®šå‘åˆ°ç”¨æˆ·è¯¦æƒ…é¡µ</span>
  <span class="hljs-keyword">const</span> userId = req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>;
  res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">`/users/<span class="hljs-subst">${userId}</span>`</span>);
});
</code></pre>
<h3 data-id="heading-48">res çš„å…¶ä»–å¸¸ç”¨æ–¹æ³•</h3>
<h4 data-id="heading-49">res.set() / res.header() - è®¾ç½®å“åº”å¤´</h4>
<p>è®¾ç½® HTTP å“åº”å¤´ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">set</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/html'</span>);
  res.<span class="hljs-title function_">set</span>(<span class="hljs-string">'X-Custom-Header'</span>, <span class="hljs-string">'custom-value'</span>);
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'&lt;h1&gt;Hello&lt;/h1&gt;'</span>);
});

<span class="hljs-comment">// æˆ–è€…ä½¿ç”¨ res.header()</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">header</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/json'</span>);
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello'</span> });
});
</code></pre>
<h4 data-id="heading-50">res.get() - è·å–å“åº”å¤´</h4>
<p>è·å–å·²è®¾ç½®çš„å“åº”å¤´å€¼ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">set</span>(<span class="hljs-string">'X-Custom-Header'</span>, <span class="hljs-string">'custom-value'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-title function_">get</span>(<span class="hljs-string">'X-Custom-Header'</span>));  <span class="hljs-comment">// 'custom-value'</span>
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Hello'</span>);
});
</code></pre>
<h4 data-id="heading-51">res.cookie() - è®¾ç½® Cookie</h4>
<p>è®¾ç½® Cookieã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/set-cookie'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">'john'</span>, { <span class="hljs-attr">maxAge</span>: <span class="hljs-number">900000</span>, <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span> });
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'Cookie å·²è®¾ç½®'</span>);
});
</code></pre>
<h4 data-id="heading-52">res.write() å’Œ res.end() - åˆ†å—å†™å…¥å’Œç»“æŸå“åº”</h4>
<p>res.write()ï¼šç”¨äºåˆ†å—å†™å…¥å“åº”æ•°æ®ï¼Œå¯ä»¥å¤šæ¬¡è°ƒç”¨
res.end()ï¼šç”¨äºç»“æŸå“åº”</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/chunked'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'Hello'</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">' '</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'World'</span>);
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'!'</span>);  <span class="hljs-comment">// ç»“æŸå“åº”</span>
});
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li><code>res.write()</code> å¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼Œä½†å¿…é¡»æœ€åè°ƒç”¨ <code>res.end()</code> æ¥ç»“æŸå“åº”</li>
<li>å¦‚æœä½¿ç”¨ <code>res.send()</code> æˆ– <code>res.json()</code>ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨ç»“æŸå“åº”ï¼Œä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ <code>res.end()</code></li>
</ul>
<h4 data-id="heading-53">res.render() - æ¸²æŸ“æ¨¡æ¿</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// éœ€è¦é…ç½®æ¨¡æ¿å¼•æ“ï¼ˆå¦‚ EJSï¼‰</span>
app.<span class="hljs-title function_">set</span>(<span class="hljs-string">'view engine'</span>, <span class="hljs-string">'ejs'</span>);

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">render</span>(<span class="hljs-string">'index'</span>, { <span class="hljs-attr">title</span>: <span class="hljs-string">'é¦–é¡µ'</span>, <span class="hljs-attr">users</span>: [] });
});
</code></pre>
<h4 data-id="heading-54">res.download() - ä¸‹è½½æ–‡ä»¶</h4>
<p><code>res.download()</code> ç”¨äºå°†æ–‡ä»¶ä½œä¸ºé™„ä»¶ä¸‹è½½å‘é€ç»™å®¢æˆ·ç«¯ï¼Œä¼šè‡ªåŠ¨è®¾ç½®é€‚å½“çš„å“åº”å¤´ã€‚å®¢æˆ·ç«¯è®¿é—®åï¼Œæµè§ˆå™¨ä¼šå¼¹å‡ºä¸‹è½½å¯¹è¯æ¡†ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä¿å­˜æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/download'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">download</span>(<span class="hljs-string">'/path/to/file.pdf'</span>, <span class="hljs-string">'document.pdf'</span>);  <span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸‹è½½æ—¶çš„æ–‡ä»¶åï¼ˆå¯é€‰ï¼‰</span>
});
</code></pre>
<h4 data-id="heading-55">res.sendFile() - å‘é€æ–‡ä»¶</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/file'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">sendFile</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'public'</span>, <span class="hljs-string">'index.html'</span>));
});
</code></pre>
<h3 data-id="heading-56">å“åº”æ–¹æ³•é“¾å¼è°ƒç”¨</h3>
<p>å¤šä¸ªå“åº”æ–¹æ³•å¯ä»¥é“¾å¼è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/user'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res
    .<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>)
    .<span class="hljs-title function_">set</span>(<span class="hljs-string">'X-Custom-Header'</span>, <span class="hljs-string">'custom-value'</span>)
    .<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>
    });
});
</code></pre>
<hr/>
<h2 data-id="heading-57">å…­ã€å®Œæ•´ç¤ºä¾‹ï¼šRESTful API</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ RESTful API ç¤ºä¾‹ï¼Œå±•ç¤ºäº† Express çš„å„ç§åŠŸèƒ½çš„ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// é…ç½®ä¸­é—´ä»¶è§£æ JSON è¯·æ±‚ä½“</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

<span class="hljs-comment">// æ¨¡æ‹Ÿæ•°æ®å­˜å‚¨</span>
<span class="hljs-keyword">let</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Jane Smith'</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">'jane@example.com'</span> }
];

<span class="hljs-comment">// GET /users - è·å–æ‰€æœ‰ç”¨æˆ·ï¼ˆæ”¯æŒåˆ†é¡µå’Œè¿‡æ»¤ï¼‰</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> page = <span class="hljs-built_in">parseInt</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">page</span>) || <span class="hljs-number">1</span>;
  <span class="hljs-keyword">const</span> limit = <span class="hljs-built_in">parseInt</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">limit</span>) || <span class="hljs-number">10</span>;
  <span class="hljs-keyword">const</span> role = req.<span class="hljs-property">query</span>.<span class="hljs-property">role</span>;  <span class="hljs-comment">// å¯é€‰çš„è§’è‰²è¿‡æ»¤</span>
  
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">page</span>: page,
    <span class="hljs-attr">limit</span>: limit,
    <span class="hljs-attr">count</span>: users.<span class="hljs-property">length</span>,
    <span class="hljs-attr">data</span>: users
  });
});

<span class="hljs-comment">// GET /users/:id - è·å–å•ä¸ªç”¨æˆ·</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> userId = <span class="hljs-built_in">parseInt</span>(req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);
  <span class="hljs-keyword">const</span> user = users.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === userId);
  
  <span class="hljs-keyword">if</span> (!user) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">error</span>: <span class="hljs-string">'ç”¨æˆ·æœªæ‰¾åˆ°'</span>
    });
  }
  
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">data</span>: user
  });
});

<span class="hljs-comment">// POST /users - åˆ›å»ºç”¨æˆ·</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/users'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { name, email } = req.<span class="hljs-property">body</span>;
  
  <span class="hljs-keyword">if</span> (!name || !email) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">error</span>: <span class="hljs-string">'ç¼ºå°‘å¿…è¦å­—æ®µï¼šname å’Œ email'</span>
    });
  }
  
  <span class="hljs-keyword">const</span> newUser = {
    <span class="hljs-attr">id</span>: users.<span class="hljs-property">length</span> + <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: name,
    <span class="hljs-attr">email</span>: email
  };
  
  users.<span class="hljs-title function_">push</span>(newUser);
  
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">201</span>).<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'ç”¨æˆ·åˆ›å»ºæˆåŠŸ'</span>,
    <span class="hljs-attr">data</span>: newUser
  });
});

<span class="hljs-comment">// PUT /users/:id - æ›´æ–°ç”¨æˆ·ï¼ˆå®Œæ•´æ›´æ–°ï¼‰</span>
app.<span class="hljs-title function_">put</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> userId = <span class="hljs-built_in">parseInt</span>(req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);
  <span class="hljs-keyword">const</span> userIndex = users.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === userId);
  
  <span class="hljs-keyword">if</span> (userIndex === -<span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">error</span>: <span class="hljs-string">'ç”¨æˆ·æœªæ‰¾åˆ°'</span>
    });
  }
  
  <span class="hljs-keyword">const</span> { name, email } = req.<span class="hljs-property">body</span>;
  users[userIndex] = { ...users[userIndex], name, email };
  
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">'ç”¨æˆ·æ›´æ–°æˆåŠŸ'</span>,
    <span class="hljs-attr">data</span>: users[userIndex]
  });
});

<span class="hljs-comment">// DELETE /users/:id - åˆ é™¤ç”¨æˆ·</span>
app.<span class="hljs-title function_">delete</span>(<span class="hljs-string">'/users/:id'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> userId = <span class="hljs-built_in">parseInt</span>(req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);
  <span class="hljs-keyword">const</span> userIndex = users.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === userId);
  
  <span class="hljs-keyword">if</span> (userIndex === -<span class="hljs-number">1</span>) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">error</span>: <span class="hljs-string">'ç”¨æˆ·æœªæ‰¾åˆ°'</span>
    });
  }
  
  users.<span class="hljs-title function_">splice</span>(userIndex, <span class="hljs-number">1</span>);
  
  res.<span class="hljs-title function_">status</span>(<span class="hljs-number">204</span>).<span class="hljs-title function_">send</span>();  <span class="hljs-comment">// 204 No Content</span>
});

<span class="hljs-comment">// è·å–ç”¨æˆ·çš„æ–‡ç« åˆ—è¡¨ï¼ˆè·¯å¾„å‚æ•° + æŸ¥è¯¢å‚æ•°ï¼‰</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/users/:userId/posts'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> userId = req.<span class="hljs-property">params</span>.<span class="hljs-property">userId</span>;  <span class="hljs-comment">// è·¯å¾„å‚æ•°</span>
  <span class="hljs-keyword">const</span> page = <span class="hljs-built_in">parseInt</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">page</span>) || <span class="hljs-number">1</span>;  <span class="hljs-comment">// æŸ¥è¯¢å‚æ•°</span>
  <span class="hljs-keyword">const</span> limit = <span class="hljs-built_in">parseInt</span>(req.<span class="hljs-property">query</span>.<span class="hljs-property">limit</span>) || <span class="hljs-number">10</span>;  <span class="hljs-comment">// æŸ¥è¯¢å‚æ•°</span>
  <span class="hljs-keyword">const</span> sort = req.<span class="hljs-property">query</span>.<span class="hljs-property">sort</span> || <span class="hljs-string">'createdAt'</span>;  <span class="hljs-comment">// æŸ¥è¯¢å‚æ•°</span>
  
  res.<span class="hljs-title function_">json</span>({
    <span class="hljs-attr">userId</span>: userId,
    <span class="hljs-attr">page</span>: page,
    <span class="hljs-attr">limit</span>: limit,
    <span class="hljs-attr">sort</span>: sort,
    <span class="hljs-attr">posts</span>: []
  });
});

<span class="hljs-comment">// é‡å®šå‘ç¤ºä¾‹</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/home'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">'/'</span>);
});

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">'æ¬¢è¿è®¿é—®ç”¨æˆ·ç®¡ç† API'</span>);
});

<span class="hljs-comment">// å¯åŠ¨æœåŠ¡å™¨</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3000</span>;
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
});
</code></pre>
<hr/>
<h2 data-id="heading-58">æ€»ç»“</h2>
<p>Express.js ä½œä¸º Node.js æœ€æµè¡Œçš„ Web æ¡†æ¶ï¼Œæä¾›äº†ç®€æ´è€Œå¼ºå¤§çš„ API æ¥æ„å»º Web åº”ç”¨å’Œ RESTful APIã€‚æœ¬æ–‡æ·±å…¥æ¢è®¨äº† Express çš„åŸºç¡€æ¦‚å¿µï¼š</p>
<ol>
<li><strong>Express ç®€ä»‹ä¸å®‰è£…</strong>ï¼šäº†è§£ Express æ˜¯ä»€ä¹ˆä»¥åŠå¦‚ä½•å®‰è£…</li>
<li><strong>åˆ›å»ºç¬¬ä¸€ä¸ª Express åº”ç”¨</strong>ï¼šé€šè¿‡ <code>express()</code> åˆ›å»ºåº”ç”¨å®ä¾‹ï¼Œä½¿ç”¨ <code>app.listen()</code> å¯åŠ¨æœåŠ¡å™¨</li>
<li><strong>è·¯ç”±åŸºç¡€</strong>ï¼šä½¿ç”¨ <code>app.get()</code>ã€<code>app.post()</code>ã€<code>app.put()</code>ã€<code>app.delete()</code> ç­‰æ–¹æ³•å®šä¹‰è·¯ç”±ï¼Œæ”¯æŒè·¯å¾„å‚æ•°ã€æŸ¥è¯¢å‚æ•°ç­‰å¤šç§åŒ¹é…æ–¹å¼</li>
<li><strong>è¯·æ±‚å¯¹è±¡ï¼ˆreqï¼‰</strong>ï¼šé€šè¿‡ <code>req.params</code> è·å–è·¯å¾„å‚æ•°ï¼Œé€šè¿‡ <code>req.query</code> è·å–æŸ¥è¯¢å‚æ•°ï¼Œé€šè¿‡ <code>req.body</code> è·å–è¯·æ±‚ä½“æ•°æ®</li>
<li><strong>å“åº”å¯¹è±¡ï¼ˆresï¼‰</strong>ï¼šä½¿ç”¨ <code>res.send()</code>ã€<code>res.json()</code>ã€<code>res.status()</code>ã€<code>res.redirect()</code> ç­‰æ–¹æ³•å‘å®¢æˆ·ç«¯å‘é€å“åº”</li>
<li><strong>å®Œæ•´ç¤ºä¾‹</strong>ï¼šæ„å»ºä¸€ä¸ªå®Œæ•´çš„ RESTful APIï¼Œç»¼åˆè¿ç”¨æ‰€å­¦çŸ¥è¯†</li>
</ol>
<hr/>
<h2 data-id="heading-59">å‚è€ƒèµ„æº</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fexpressjs.com%2F" target="_blank" title="https://expressjs.com/" ref="nofollow noopener noreferrer">Express.js å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2F" target="_blank" title="https://nodejs.org/" ref="nofollow noopener noreferrer">Node.js å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3schools.com%2Fnodejs%2Fdefault.asp" target="_blank" title="https://www.w3schools.com/nodejs/default.asp" ref="nofollow noopener noreferrer">W3Schools Node.js æ•™ç¨‹</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2F" target="_blank" title="https://docs.npmjs.com/" ref="nofollow noopener noreferrer">npm åŒ…ç®¡ç†å™¨æ–‡æ¡£</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOSéœ‡åŠ¨åé¦ˆå¼€å‘â€”â€”æå‡ç”¨æˆ·ä½“éªŒçš„è§¦è§‰äº¤äº’]]></title>    <link>https://juejin.cn/post/7584730308752932914</link>    <guid>https://juejin.cn/post/7584730308752932914</guid>    <pubDate>2025-12-18T02:40:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584730308752932914" data-draft-id="7584730308752916530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOSéœ‡åŠ¨åé¦ˆå¼€å‘â€”â€”æå‡ç”¨æˆ·ä½“éªŒçš„è§¦è§‰äº¤äº’"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-18T02:40:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·73614681275"/> <meta itemprop="url" content="https://juejin.cn/user/433640354087403"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOSéœ‡åŠ¨åé¦ˆå¼€å‘â€”â€”æå‡ç”¨æˆ·ä½“éªŒçš„è§¦è§‰äº¤äº’
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/433640354087403/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·73614681275
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:40:12.000Z" title="Thu Dec 18 2025 02:40:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æŠ€æœ¯æ ˆ</strong>ï¼šHarmonyOS 5.0 + ArkTS + @ohos.vibrator</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæŒ‰é’®åé¦ˆã€æ“ä½œç¡®è®¤ã€æ¸¸æˆäº¤äº’ã€æ‰‹æœºæ’æ°´</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>è§¦è§‰åé¦ˆæ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„é‡è¦æ‰‹æ®µã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨HarmonyOSåº”ç”¨ä¸­ä½¿ç”¨éœ‡åŠ¨APIå®ç°å„ç§è§¦è§‰äº¤äº’æ•ˆæœã€‚</p>
<h2 data-id="heading-1">ä¸€ã€éœ‡åŠ¨APIæ¦‚è¿°</h2>
<p>HarmonyOSæä¾›äº†<code>@ohos.vibrator</code>æ¨¡å—ç”¨äºæ§åˆ¶è®¾å¤‡éœ‡åŠ¨ï¼š</p>
<ul>
<li><strong>æ—¶é•¿éœ‡åŠ¨</strong>ï¼šæŒ‡å®šéœ‡åŠ¨æŒç»­æ—¶é—´</li>
<li><strong>é¢„è®¾æ•ˆæœ</strong>ï¼šä½¿ç”¨ç³»ç»Ÿé¢„è®¾çš„éœ‡åŠ¨æ¨¡å¼</li>
<li><strong>è‡ªå®šä¹‰æ¨¡å¼</strong>ï¼šé€šè¿‡éœ‡åŠ¨æ¨¡å¼æ•°ç»„å®ç°å¤æ‚æ•ˆæœ</li>
</ul>
<h2 data-id="heading-2">äºŒã€æƒé™é…ç½®</h2>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// module.json5</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"requestPermissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.VIBRATE"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:vibrate_reason"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"usedScene"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"inuse"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">ä¸‰ã€åŸºç¡€ä½¿ç”¨</h2>
<h3 data-id="heading-4">3.1 ç®€å•éœ‡åŠ¨</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> vibrator <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.vibrator'</span>;

<span class="hljs-comment">// éœ‡åŠ¨100æ¯«ç§’</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">simpleVibrate</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> vibrator.<span class="hljs-title function_">startVibration</span>({
      <span class="hljs-attr">type</span>: <span class="hljs-string">'time'</span>,
      <span class="hljs-attr">duration</span>: <span class="hljs-number">100</span>
    }, {
      <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">usage</span>: <span class="hljs-string">'unknown'</span>
    });
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'éœ‡åŠ¨å¤±è´¥:'</span>, err);
  }
}
</code></pre>
<h3 data-id="heading-5">3.2 åœæ­¢éœ‡åŠ¨</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">stopVibrate</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> vibrator.<span class="hljs-title function_">stopVibration</span>(vibrator.<span class="hljs-property">VibratorStopMode</span>.<span class="hljs-property">VIBRATOR_STOP_MODE_TIME</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åœæ­¢éœ‡åŠ¨å¤±è´¥:'</span>, err);
  }
}
</code></pre>
<h3 data-id="heading-6">3.3 å›è°ƒæ–¹å¼</h3>
<pre><code class="hljs language-typescript" lang="typescript">vibrator.<span class="hljs-title function_">startVibration</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'time'</span>,
  <span class="hljs-attr">duration</span>: <span class="hljs-number">50</span>
}, {
  <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">usage</span>: <span class="hljs-string">'notification'</span>
}, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'éœ‡åŠ¨å¤±è´¥:'</span>, error);
  }
});
</code></pre>
<h2 data-id="heading-7">å››ã€å®é™…åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-8">4.1 æŒ‰é’®ç‚¹å‡»åé¦ˆ</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">VibrationButton</span> {
  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'æŒ‰é’®'</span>;
  <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">() =&gt;</span> {};

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">vibrateFeedback</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> vibrator.<span class="hljs-title function_">startVibration</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'time'</span>,
        <span class="hljs-attr">duration</span>: <span class="hljs-number">30</span>  <span class="hljs-comment">// çŸ­ä¿ƒéœ‡åŠ¨</span>
      }, { <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">usage</span>: <span class="hljs-string">'touch'</span> });
    } <span class="hljs-keyword">catch</span> (err) {}
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Button</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>)
      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">vibrateFeedback</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onClick</span>();
      })
  }
}
</code></pre>
<h3 data-id="heading-9">4.2 æ“ä½œæˆåŠŸ/å¤±è´¥åé¦ˆ</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æˆåŠŸåé¦ˆ - çŸ­ä¿ƒå•æ¬¡</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">successFeedback</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">await</span> vibrator.<span class="hljs-title function_">startVibration</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'time'</span>,
    <span class="hljs-attr">duration</span>: <span class="hljs-number">50</span>
  }, { <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">usage</span>: <span class="hljs-string">'notification'</span> });
}

<span class="hljs-comment">// å¤±è´¥åé¦ˆ - è¿ç»­ä¸¤æ¬¡</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">errorFeedback</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">await</span> vibrator.<span class="hljs-title function_">startVibration</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'time'</span>, <span class="hljs-attr">duration</span>: <span class="hljs-number">100</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">usage</span>: <span class="hljs-string">'alarm'</span> });
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">150</span>));
  <span class="hljs-keyword">await</span> vibrator.<span class="hljs-title function_">startVibration</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'time'</span>, <span class="hljs-attr">duration</span>: <span class="hljs-number">100</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">usage</span>: <span class="hljs-string">'alarm'</span> });
}
</code></pre>
<h3 data-id="heading-10">4.3 æ‰‹æœºæ’æ°´åœºæ™¯</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AudioEngine</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-attr">enableVibration</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;

  <span class="hljs-title function_">setVibrationEnabled</span>(<span class="hljs-attr">enabled</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">enableVibration</span> = enabled;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">start</span>(<span class="hljs-attr">durationSeconds</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-comment">// å¯åŠ¨éŸ³é¢‘æ’­æ”¾...</span>
    
    <span class="hljs-comment">// é…åˆéœ‡åŠ¨å¢å¼ºæ’æ°´æ•ˆæœ</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">enableVibration</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startVibration</span>();
    }
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">startVibration</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> config = <span class="hljs-title function_">getAppConfig</span>();
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">feature</span>.<span class="hljs-property">vibrationPattern</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">try</span> {
        vibrator.<span class="hljs-title function_">startVibration</span>({
          <span class="hljs-attr">type</span>: <span class="hljs-string">'time'</span>,
          <span class="hljs-attr">duration</span>: <span class="hljs-number">100</span>
        }, {
          <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,
          <span class="hljs-attr">usage</span>: <span class="hljs-string">'unknown'</span>
        });
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å¯åŠ¨éœ‡åŠ¨å¤±è´¥:'</span>, err);
      }
    }
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">stopVibration</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">try</span> {
      vibrator.<span class="hljs-title function_">stopVibration</span>(vibrator.<span class="hljs-property">VibratorStopMode</span>.<span class="hljs-property">VIBRATOR_STOP_MODE_TIME</span>);
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'åœæ­¢éœ‡åŠ¨å¤±è´¥:'</span>, err);
    }
  }
}
</code></pre>
<h3 data-id="heading-11">4.4 æµ‹è¯•è®°å½•ç¡®è®¤</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title function_">recordThreshold</span>(): <span class="hljs-built_in">void</span> {
  <span class="hljs-comment">// è®°å½•æµ‹è¯•ç»“æœ...</span>
  
  <span class="hljs-comment">// éœ‡åŠ¨åé¦ˆç¡®è®¤</span>
  <span class="hljs-keyword">try</span> {
    vibrator.<span class="hljs-title function_">startVibration</span>({
      <span class="hljs-attr">type</span>: <span class="hljs-string">'time'</span>,
      <span class="hljs-attr">duration</span>: <span class="hljs-number">50</span>
    }, {
      <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">usage</span>: <span class="hljs-string">'notification'</span>
    }, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Vibration failed:'</span>, error);
      }
    });
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Vibration exception:'</span>, err);
  }
}
</code></pre>
<h2 data-id="heading-12">äº”ã€éœ‡åŠ¨é…ç½®ç®¡ç†</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">FeatureConfig</span> {
  <span class="hljs-attr">enableVibration</span>: <span class="hljs-built_in">boolean</span>;
  <span class="hljs-attr">vibrationPattern</span>: <span class="hljs-built_in">number</span>[];  <span class="hljs-comment">// [éœ‡åŠ¨æ—¶é•¿, é—´éš”, éœ‡åŠ¨æ—¶é•¿, ...]</span>
}

<span class="hljs-comment">// æ‰‹æœºæ’æ°´é…ç½®</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">WaterEjectorConfig</span> = {
  <span class="hljs-attr">feature</span>: {
    <span class="hljs-attr">enableVibration</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">vibrationPattern</span>: [<span class="hljs-number">100</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">50</span>],  <span class="hljs-comment">// éœ‡åŠ¨100ms, åœ50ms, éœ‡åŠ¨100ms, åœ50ms</span>
  }
};

<span class="hljs-comment">// å¬åŠ›æµ‹è¯•é…ç½®</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">HearingTestConfig</span> = {
  <span class="hljs-attr">feature</span>: {
    <span class="hljs-attr">enableVibration</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// å¬åŠ›æµ‹è¯•ä¸éœ€è¦éœ‡åŠ¨</span>
    <span class="hljs-attr">vibrationPattern</span>: [],
  }
};
</code></pre>
<h2 data-id="heading-13">å…­ã€ç”¨æˆ·è®¾ç½®æ§åˆ¶</h2>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">SettingsPage</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">vibrationEnabled</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;

  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loadSettings</span>();
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">loadSettings</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vibrationEnabled</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">getBoolean</span>(<span class="hljs-string">'vibration_enabled'</span>, <span class="hljs-literal">true</span>);
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">toggleVibration</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">vibrationEnabled</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">vibrationEnabled</span>;
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">PreferencesUtil</span>.<span class="hljs-title function_">putBoolean</span>(<span class="hljs-string">'vibration_enabled'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">vibrationEnabled</span>);
    
    <span class="hljs-comment">// æ›´æ–°éŸ³é¢‘å¼•æ“è®¾ç½®</span>
    <span class="hljs-title class_">AudioEngine</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">setVibrationEnabled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vibrationEnabled</span>);
    
    <span class="hljs-comment">// åé¦ˆå½“å‰çŠ¶æ€</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">vibrationEnabled</span>) {
      vibrator.<span class="hljs-title function_">startVibration</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'time'</span>, <span class="hljs-attr">duration</span>: <span class="hljs-number">50</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">usage</span>: <span class="hljs-string">'touch'</span> });
    }
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'éœ‡åŠ¨åé¦ˆ'</span>)
      <span class="hljs-title class_">Toggle</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ToggleType</span>.<span class="hljs-property">Switch</span>, <span class="hljs-attr">isOn</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">vibrationEnabled</span> })
        .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toggleVibration</span>())
    }
  }
}
</code></pre>
<h2 data-id="heading-14">ä¸ƒã€é¿å‘æŒ‡å—</h2>
<ol>
<li><strong>æƒé™å£°æ˜</strong>ï¼šå¿…é¡»åœ¨<code>module.json5</code>ä¸­å£°æ˜<code>VIBRATE</code>æƒé™</li>
<li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šéœ‡åŠ¨APIå¯èƒ½å¤±è´¥ï¼Œéœ€è¦try-catch</li>
<li><strong>ç”¨æˆ·æ§åˆ¶</strong>ï¼šæä¾›å¼€å…³è®©ç”¨æˆ·æ§åˆ¶æ˜¯å¦å¯ç”¨éœ‡åŠ¨</li>
<li><strong>é€‚åº¦ä½¿ç”¨</strong>ï¼šè¿‡åº¦éœ‡åŠ¨ä¼šå½±å“ç”¨æˆ·ä½“éªŒå’Œç”µæ± å¯¿å‘½</li>
<li><strong>è®¾å¤‡å…¼å®¹</strong>ï¼šéƒ¨åˆ†è®¾å¤‡å¯èƒ½ä¸æ”¯æŒéœ‡åŠ¨</li>
</ol>
<h2 data-id="heading-15">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†HarmonyOSéœ‡åŠ¨APIçš„ä½¿ç”¨æ–¹æ³•å’Œå®é™…åº”ç”¨åœºæ™¯ã€‚åˆç†ä½¿ç”¨è§¦è§‰åé¦ˆå¯ä»¥æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒï¼Œä½†è¦æ³¨æ„é€‚åº¦ä½¿ç”¨å¹¶æä¾›ç”¨æˆ·æ§åˆ¶é€‰é¡¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®æµ‹ Kandinsky 5.0 å›¾ç¼–è¾‘åŠŸèƒ½ï¼šä¸é¾™çŒ«æ¨¡å‹æ•ˆæœæ·±åº¦å¯¹æ¯”ï¼Œç»“æœå‡ºä¹æ„æ–™ï¼]]></title>    <link>https://juejin.cn/post/7584742635500912667</link>    <guid>https://juejin.cn/post/7584742635500912667</guid>    <pubDate>2025-12-18T00:11:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584742635500912667" data-draft-id="7584714813365583910" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®æµ‹ Kandinsky 5.0 å›¾ç¼–è¾‘åŠŸèƒ½ï¼šä¸é¾™çŒ«æ¨¡å‹æ•ˆæœæ·±åº¦å¯¹æ¯”ï¼Œç»“æœå‡ºä¹æ„æ–™ï¼"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-18T00:11:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å›´ç‚‰èŠç§‘æŠ€"/> <meta itemprop="url" content="https://juejin.cn/user/3229679898597516"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®æµ‹ Kandinsky 5.0 å›¾ç¼–è¾‘åŠŸèƒ½ï¼šä¸é¾™çŒ«æ¨¡å‹æ•ˆæœæ·±åº¦å¯¹æ¯”ï¼Œç»“æœå‡ºä¹æ„æ–™ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3229679898597516/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å›´ç‚‰èŠç§‘æŠ€
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:11:19.000Z" title="Thu Dec 18 2025 00:11:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Kandinsky 5.0 çš„ Image Editing ç³»åˆ—æ¨¡å‹å‡­å€Ÿ 1K åˆ†è¾¨ç‡è¾“å‡ºã€é«˜è§†è§‰è´¨é‡ã€å¼ºæ–‡å­—ç”Ÿæˆèƒ½åŠ›åŠä¿„è¯­æ¦‚å¿µç†è§£ç­‰ç‰¹æ€§ï¼Œæˆä¸ºå›¾ç¼–è¾‘é¢†åŸŸçš„é‡è¦é€‰é¡¹ã€‚é’ˆå¯¹ 24G æ˜¾å­˜çš„ RTX 4090 æ˜¾å¡ï¼Œé€šè¿‡ CPU Offloadingã€æ¨¡å‹é‡åŒ–ç­‰ä¼˜åŒ–é…ç½®ï¼Œå¯å®ç°è¿è¡Œã€‚æœ¬æ–‡å°†ä»ç¯å¢ƒæ­å»ºã€æ ¸å¿ƒä¼˜åŒ–é…ç½®ã€å®æ“æ­¥éª¤åˆ°å¸¸è§é—®é¢˜æ’æŸ¥ï¼Œå…¨é¢è®²è§£ä½¿ç”¨æµç¨‹ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ç¯å¢ƒå‡†å¤‡</h2>
<h3 data-id="heading-1">1. åŸºç¡€ç¯å¢ƒè¦æ±‚</h3>
<ul>
<li>ç¡¬ä»¶ï¼šRTX 4090ï¼ˆ24G æ˜¾å­˜ï¼‰</li>
<li>ç³»ç»Ÿï¼šLinux</li>
<li>è½¯ä»¶ä¾èµ–ï¼š
<ul>
<li>Python 3.9+</li>
<li>PyTorch 2.8+ï¼ˆéœ€åŒ¹é… CUDA 12.8+ï¼‰</li>
<li>CUDA 12.8.1ï¼ˆå®˜æ–¹æ¨èç‰ˆæœ¬ï¼Œç¡®ä¿ GPU ç®—åŠ›å……åˆ†åˆ©ç”¨ï¼‰</li>
<li>å…¶ä»–ä¾èµ–åº“ï¼ˆé€šè¿‡ requirements.txt å®‰è£…ï¼‰</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">2. ç¯å¢ƒæ­å»ºæ­¥éª¤</h3>
<h4 data-id="heading-3">ï¼ˆ1ï¼‰å…‹éš†ä»“åº“å¹¶è¿›å…¥ç›®å½•</h4>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/kandinskylab/kandinsky-5.git
<span class="hljs-built_in">cd</span> kandinsky-5
</code></pre>
<h4 data-id="heading-4">ï¼ˆ2ï¼‰å®‰è£…ä¾èµ–åŒ…</h4>
<p>ä¼˜å…ˆä½¿ç”¨å®˜æ–¹æ¨èçš„ä¾èµ–ç‰ˆæœ¬ï¼Œé¿å…å…¼å®¹æ€§é—®é¢˜ï¼š
è¿è¡Œ</p>
<pre><code class="hljs language-bash" lang="bash">pip install -r requirements.txt
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼šRTX 4090 æ— éœ€å®‰è£… Flash Attention 3ï¼ˆHopper æ¶æ„ä¸“å±ä¼˜åŒ–ï¼‰ï¼Œé»˜è®¤ä½¿ç”¨ PyTorch SDPA æ³¨æ„åŠ›æœºåˆ¶å³å¯ï¼Œå‡å°‘æ˜¾å­˜å ç”¨ã€‚</p>
</blockquote>
<h4 data-id="heading-5">ï¼ˆ3ï¼‰ä¸‹è½½å›¾ç¼–è¾‘æ¨¡å‹</h4>
<p>æ— éœ€ä¸‹è½½å…¨éƒ¨æ¨¡å‹ï¼Œä»…æŒ‡å®š Image Editing ç›¸å…³æ¨¡å‹ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´å’Œæ˜¾å­˜å¼€é”€ï¼š</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> HF_ENDPOINT=https://hf-mirror.com
<span class="hljs-comment"># ä»…ä¸‹è½½å›¾ç¼–è¾‘æ ¸å¿ƒæ¨¡å‹ï¼Œéœ€è¦ä½¿ç”¨è‡ªå·±åœ¨hugging faceä¸Šç”Ÿæˆçš„tokenã€‚https://huggingface.co/settings/tokens</span>
python download_models.py --models kandinskylab/Kandinsky-5.0-I2I-Lite --hf_token hf_xxxxxx
</code></pre>
<h2 data-id="heading-6">äºŒã€æ ¸å¿ƒä¼˜åŒ–é…ç½®ï¼š24G æ˜¾å­˜é€‚é…å…³é”®</h2>
<p>RTX 4090ï¼ˆ24G æ˜¾å­˜ï¼‰è¿è¡Œ Kandinsky å›¾ç¼–è¾‘æ¨¡å‹çš„æ ¸å¿ƒæ˜¯é€šè¿‡<strong>CPU Offloading</strong>ã€<strong>æ¨¡å‹é‡åŒ–</strong>ã€<strong>æ³¨æ„åŠ›å¼•æ“é€‰å‹</strong>ä¸‰é‡ä¼˜åŒ–ï¼Œå°†æ˜¾å­˜å ç”¨æ§åˆ¶åœ¨ 24G ä»¥å†…ã€‚ä»¥ä¸‹æ˜¯å…³é”®é…ç½®è¯´æ˜ï¼š</p>
<h3 data-id="heading-7">1. CPU Offloadingï¼ˆæ ¸å¿ƒæ˜¾å­˜ä¼˜åŒ–ï¼‰</h3>
<p>é€šè¿‡å°†éƒ¨åˆ†æ¨¡å‹å±‚ï¼ˆå¦‚ VAEã€æ–‡æœ¬ç¼–ç å™¨ï¼‰å¸è½½åˆ° CPU è¿è¡Œï¼Œä»…ä¿ç•™æ ¸å¿ƒç”Ÿæˆæ¨¡å—ï¼ˆDiTï¼‰åœ¨ GPUï¼Œå¯å¤§å¹…é™ä½æ˜¾å­˜å ç”¨ã€‚Kandinsky æ”¯æŒè‡ªåŠ¨åˆ†å±‚å¸è½½ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®šå±‚åˆ†é…ï¼Œä»…éœ€é€šè¿‡å‚æ•°å¯ç”¨ã€‚</p>
<h3 data-id="heading-8">2. Qwen ç¼–ç å™¨é‡åŒ–</h3>
<p>å¯ç”¨ NF4 é‡åŒ–ï¼ˆåŸºäº bitsandbytesï¼‰ï¼Œå¯å°†æ–‡æœ¬ç¼–ç å™¨ï¼ˆQwen2.5-VLï¼‰çš„æ˜¾å­˜å ç”¨é™ä½çº¦ 40%ï¼Œä¸”ä¸å½±å“ç”Ÿæˆè´¨é‡ã€‚è¯¥ä¼˜åŒ–å¯¹å›¾ç¼–è¾‘ä»»åŠ¡çš„æ–‡æœ¬æŒ‡ä»¤ç†è§£èƒ½åŠ›æ— æ˜æ˜¾å½±å“ï¼Œæ˜¯ 24G æ˜¾å­˜çš„å¿…é€‰é…ç½®ã€‚</p>
<h3 data-id="heading-9">3. æ³¨æ„åŠ›å¼•æ“é€‰å‹</h3>
<p>RTX 4090 æ”¯æŒ PyTorch SDPAï¼ˆåŸç”Ÿæ”¯æŒï¼Œæ— éœ€é¢å¤–å®‰è£…ï¼‰ï¼Œç›¸æ¯” Flash Attention 2/3ï¼ŒSDPA åœ¨ 24G æ˜¾å­˜åœºæ™¯ä¸‹æ›´ç¨³å®šï¼Œä¸”èƒ½å‡å°‘ç¼–è¯‘å¼€é”€ã€‚é»˜è®¤ä½¿ç”¨<code>auto</code>æ¨¡å¼ä¼šè‡ªåŠ¨é€‚é…æœ€ä¼˜å¼•æ“ï¼Œä¹Ÿå¯æ‰‹åŠ¨æŒ‡å®š SDPAã€‚</p>
<h3 data-id="heading-10">4. åˆ†è¾¨ç‡ä¸æ­¥é•¿æ§åˆ¶</h3>
<ul>
<li>æ¨èåˆ†è¾¨ç‡ï¼š1024Ã—1024ï¼ˆé»˜è®¤æœ€ä¼˜ï¼‰æˆ– 1280Ã—768ï¼ˆå®½é«˜æ¯”é€‚é…ï¼‰ï¼Œé¿å…è¶…è¿‡ 1920Ã—1080ï¼ˆæ˜¾å­˜å ç”¨ä¼šæ¿€å¢ï¼‰ã€‚</li>
<li>é‡‡æ ·æ­¥é•¿ï¼ˆNFEï¼‰ï¼šé»˜è®¤ 100 æ­¥ï¼Œå¯é™è‡³ 75 æ­¥ï¼ˆæ˜¾å­˜èŠ‚çœçº¦ 15%ï¼Œè´¨é‡æŸå¤±æå°ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-11">ä¸‰ã€å®æ“æ­¥éª¤ï¼šå›¾ç¼–è¾‘å®Œæ•´æµç¨‹</h2>
<h3 data-id="heading-12">1. å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆå¿«é€Ÿä¸Šæ‰‹ï¼‰</h3>
<p>é€šè¿‡<code>test.py</code>è„šæœ¬ï¼Œç»“åˆä¼˜åŒ–å‚æ•°ç›´æ¥è¿è¡Œå›¾ç¼–è¾‘ä»»åŠ¡ï¼Œé€‚åˆå¿«é€ŸéªŒè¯æ•ˆæœã€‚</p>
<h4 data-id="heading-13">åŸºæœ¬è¯­æ³•ï¼š</h4>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-bash" lang="bash">python test.py \
  --config ./configs/k5_lite_i2i_sft_hd.yaml \
  --prompt <span class="hljs-string">"æ›¿æ¢æŒ‡ä»¤"</span> \
  --image <span class="hljs-string">"è¾“å…¥å›¾ç‰‡è·¯å¾„"</span> \
  --width 1024 \
  --height 1024 \
  --offload  <span class="hljs-comment"># å¯ç”¨CPU Offloading</span>
  --qwen_quantization  <span class="hljs-comment"># å¯ç”¨Qwenç¼–ç å™¨é‡åŒ–</span>
  --attention_engine=sdpa  <span class="hljs-comment"># æŒ‡å®šSDPAæ³¨æ„åŠ›å¼•æ“</span>
  --nfe 75  <span class="hljs-comment"># å¯é€‰ï¼šé™ä½é‡‡æ ·æ­¥é•¿</span>
</code></pre>
<h4 data-id="heading-14">ç¤ºä¾‹ï¼šå°†å›¾ç‰‡ä¸­çš„çŒ«æ›¿æ¢ä¸ºå“ˆå£«å¥‡ï¼ˆä¿ç•™èƒŒæ™¯ä¸å˜ï¼‰</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84e68a06a64843a78d5371c77164d144~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621479&amp;x-signature=710Qe%2Be29T%2F6B2SB2mncmdawURg%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-bash" lang="bash">python test.py \
  --config ./configs/k5_lite_i2i_sft_hd.yaml \
  --prompt <span class="hljs-string">"Replace the cat with a husky, leave the rest unchanged"</span> \
  --image <span class="hljs-string">"./assets/cat_in_hat.png"</span> \
  --width 1024 \
  --height 1024 \
  --offload \
  --qwen_quantization \
  --attention_engine=sdpa
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/890914bbf81740b8a4e73243de0792de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621479&amp;x-signature=AQVNadKTqitUNEHZBlaaoYNoPq8%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-15">2. Python è„šæœ¬æ¨¡å¼ï¼ˆçµæ´»å®šåˆ¶ï¼‰</h3>
<p>é€šè¿‡ç¼–å†™ Python è„šæœ¬ï¼Œå¯å®ç°æ›´ç²¾ç»†çš„å‚æ•°æ§åˆ¶ï¼ˆå¦‚ç§å­å›ºå®šã€è¾“å‡ºè·¯å¾„è‡ªå®šä¹‰ç­‰ï¼‰ï¼Œé€‚é…å¤æ‚åœºæ™¯ã€‚</p>
<h4 data-id="heading-16">å®Œæ•´è„šæœ¬ç¤ºä¾‹ï¼š</h4>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> kandinsky <span class="hljs-keyword">import</span> get_I2I_pipeline

<span class="hljs-comment"># 1. è®¾å¤‡æ˜ å°„ä¸ä¼˜åŒ–é…ç½®ï¼ˆæ ¸å¿ƒé€‚é…24Gæ˜¾å­˜ï¼‰</span>
device_map = {
    <span class="hljs-string">"dit"</span>: torch.device(<span class="hljs-string">'cuda:0'</span>),  <span class="hljs-comment"># æ ¸å¿ƒç”Ÿæˆæ¨¡å—ä¿ç•™åœ¨GPU</span>
    <span class="hljs-string">"vae"</span>: torch.device(<span class="hljs-string">'cuda:0'</span>),  <span class="hljs-comment"># VAEè½»é‡ï¼Œå¯ç•™åœ¨GPUï¼›è‹¥æ˜¾å­˜ç´§å¼ å¯æ”¹ä¸º'cpu'</span>
    <span class="hljs-string">"text_embedder"</span>: torch.device(<span class="hljs-string">'cuda:0'</span>)  <span class="hljs-comment"># é‡åŒ–åæ˜¾å­˜å ç”¨ä½ï¼Œä¼˜å…ˆGPU</span>
}

<span class="hljs-comment"># 2. åŠ è½½å›¾ç¼–è¾‘æµæ°´çº¿ï¼ˆå¯ç”¨Offloadingå’Œé‡åŒ–ï¼‰</span>
pipe = get_I2I_pipeline(
    resolution=<span class="hljs-number">1024</span>,  <span class="hljs-comment"># é€‚é…24Gæ˜¾å­˜çš„æœ€ä¼˜åˆ†è¾¨ç‡</span>
    offload=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># å¯ç”¨CPU Offloading</span>
    device_map=device_map,
    conf_path=<span class="hljs-string">"./configs/k5_lite_i2i_sft_hd.yaml"</span>,
    qwen_quantization=<span class="hljs-literal">True</span>  <span class="hljs-comment"># å¯ç”¨Qwenç¼–ç å™¨NF4é‡åŒ–</span>
)

<span class="hljs-comment"># 3. è®¾ç½®æ³¨æ„åŠ›å¼•æ“ï¼ˆSDPAé€‚é…4090ï¼‰</span>
pipe.set_attention_engine(<span class="hljs-string">"sdpa"</span>)

<span class="hljs-comment"># 4. æ‰§è¡Œå›¾ç¼–è¾‘ä»»åŠ¡</span>
out = pipe(
    prompt=<span class="hljs-string">"Turn this into a neon sign hanging on a brick wall in a cool modern office"</span>,  <span class="hljs-comment"># ç¼–è¾‘æŒ‡ä»¤</span>
    image=<span class="hljs-string">"./assets/test_image.jpg"</span>,  <span class="hljs-comment"># è¾“å…¥å›¾ç‰‡è·¯å¾„</span>
    seed=<span class="hljs-number">42</span>,  <span class="hljs-comment"># å›ºå®šç§å­ï¼Œç¡®ä¿ç»“æœå¯å¤ç°</span>
    nfe=<span class="hljs-number">75</span>,  <span class="hljs-comment"># é‡‡æ ·æ­¥é•¿ï¼ˆé™ä½æ˜¾å­˜å ç”¨ï¼‰</span>
    save_path=<span class="hljs-string">"./edited_neon_sign.png"</span>  <span class="hljs-comment"># è¾“å‡ºè·¯å¾„</span>
)

<span class="hljs-comment"># 5. ä¿å­˜ç»“æœ</span>
out[<span class="hljs-number">0</span>].save(<span class="hljs-string">"./final_edited_image.png"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"å›¾ç¼–è¾‘å®Œæˆï¼Œç»“æœå·²ä¿å­˜ï¼"</span>)
</code></pre>
<h3 data-id="heading-17">3. å…³é”®å‚æ•°è¯´æ˜</h3>








































<table><thead><tr><th>å‚æ•°</th><th>ä½œç”¨</th><th>æ¨èå€¼</th></tr></thead><tbody><tr><td><code>--offload</code></td><td>å¯ç”¨ CPU Offloadingï¼Œå¸è½½éƒ¨åˆ†æ¨¡å‹åˆ° CPU</td><td>å¿…é€‰ï¼ˆ24G æ˜¾å­˜åœºæ™¯ï¼‰</td></tr><tr><td><code>--qwen_quantization</code></td><td>Qwen2.5-VL ç¼–ç å™¨ NF4 é‡åŒ–</td><td>å¿…é€‰ï¼ˆèŠ‚çœ 40% æ–‡æœ¬ç¼–ç å™¨æ˜¾å­˜ï¼‰</td></tr><tr><td><code>--attention_engine</code></td><td>é€‰æ‹©æ³¨æ„åŠ›å¼•æ“</td><td>sdpaï¼ˆ4090 æœ€ä¼˜ï¼‰</td></tr><tr><td><code>--resolution</code></td><td>è¾“å‡ºåˆ†è¾¨ç‡</td><td>1024Ã—1024ï¼ˆæˆ– 1280Ã—768ï¼‰</td></tr><tr><td><code>--nfe</code></td><td>é‡‡æ ·æ­¥é•¿</td><td>75-100ï¼ˆå¹³è¡¡è´¨é‡ä¸æ˜¾å­˜ï¼‰</td></tr><tr><td><code>--magcache</code></td><td>å¯ç”¨ MagCache åŠ é€Ÿï¼ˆä»…æ”¯æŒ SFT æ¨¡å‹ï¼‰</td><td>å¯é€‰ï¼ˆåŠ é€Ÿç”Ÿæˆï¼Œä¸å¢åŠ æ˜¾å­˜ï¼‰</td></tr></tbody></table>
<h2 data-id="heading-18">å››ã€æ˜¾å­˜å ç”¨ä¼˜åŒ–éªŒè¯</h2>
<p>åœ¨ RTX 4090ï¼ˆ24Gï¼‰ä¸Šï¼Œå¯ç”¨ä¸Šè¿°ä¼˜åŒ–é…ç½®åï¼Œå„ç¯èŠ‚æ˜¾å­˜å ç”¨å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¨¡å‹åŠ è½½é˜¶æ®µï¼šçº¦ 16-18Gï¼ˆOffloading + é‡åŒ–åé™ä½ 30%ï¼‰</li>
<li>ç”Ÿæˆé˜¶æ®µå³°å€¼ï¼šçº¦ 20-22Gï¼ˆ1024Ã—1024 åˆ†è¾¨ç‡ + 75 æ­¥ï¼‰</li>
<li>å‰©ä½™æ˜¾å­˜ï¼š2-4Gï¼ˆé¿å…æ˜¾å­˜æº¢å‡ºï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šï¼‰</li>
</ul>
<blockquote>
<p>è‹¥éœ€è¿›ä¸€æ­¥é™ä½æ˜¾å­˜å ç”¨ï¼Œå¯å°† VAE æ¨¡å—å¸è½½åˆ° CPUï¼ˆä¿®æ”¹<code>device_map["vae"] = torch.device('cpu')</code>ï¼‰ï¼Œä½†ç”Ÿæˆé€Ÿåº¦ä¼šé™ä½çº¦ 10%ã€‚</p>
</blockquote>
<h2 data-id="heading-19">äº”ã€ä¸ç¾å›¢é¾™çŒ«æ¨¡å‹çš„å¯¹æ¯”å‚è€ƒ</h2>
<p>åœ¨å›¾ç‰‡ç¼–è¾‘åœºæ™¯ä¸­ï¼Œå°† Kandinsky 5.0 Image Editing ä¸ç¾å›¢å¼€æºçš„é¾™çŒ«æ¨¡å‹å¯¹æ¯”åå‘ç°ï¼Œä¸¤è€…å­˜åœ¨æ˜æ˜¾çš„ä½“éªŒå·®å¼‚ï¼šä»å®é™…è¿è¡Œæ•ˆç‡æ¥çœ‹ï¼ŒKandinsky 5.0 çš„ç”Ÿæˆé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œå…¶å•å›¾ç¼–è¾‘è€—æ—¶é«˜äºé¾™çŒ«æ¨¡å‹ã€‚ä»¥ä¸‹æ˜¯å°†è½¦æ¢æˆæ‘©æ‰˜è½¦çš„æ•ˆæœï¼Œå¯ä»¥å’Œä¹‹å‰æ–‡ç« ä¸­é¾™çŒ«çš„æ•ˆæœè¿›è¡Œæ¯”å¯¹ã€‚</p>
<pre><code class="hljs language-css" lang="css">python test<span class="hljs-selector-class">.py</span> \
  <span class="hljs-attr">--config</span> ./configs/k5_lite_i2i_sft_hd<span class="hljs-selector-class">.yaml</span> \
  <span class="hljs-attr">--prompt</span> "Replace the truck with <span class="hljs-selector-tag">a</span> motorcycle, leave the <span class="hljs-attribute">rest</span> unchanged" \
  <span class="hljs-attr">--image</span> "./assets/truck<span class="hljs-selector-class">.jpg</span>" \
  <span class="hljs-attr">--width</span> <span class="hljs-number">512</span> \
  <span class="hljs-attr">--height</span> <span class="hljs-number">512</span> \
  <span class="hljs-attr">--offload</span> \
  <span class="hljs-attr">--qwen_quantization</span> \
  <span class="hljs-attr">--attention_engine</span>=sdpa
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80851b95765a48709b6ec49ea3f94390~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621479&amp;x-signature=iYAOsxhm%2BzJcUI2r3Rp6YcWBCBk%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>å±…ç„¶ç”Ÿæˆçš„å›¾ç‰‡åªæ˜¯æ¢äº†ä¸ªè§’åº¦ï¼Œæ²¡æœ‰æ¢æˆæ‘©æ‰˜è½¦ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc17d2bbabf14f208d5aff8ef3b7902b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621479&amp;x-signature=BD8E9voU9KTy97uWYMzspKx5v2o%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<p>æ›´å…³é”®çš„æ˜¯ï¼Œé¾™çŒ«æ¨¡å‹åœ¨ä¸­æ–‡æŒ‡ä»¤ç†è§£ä¸é€‚é…æ€§ä¸Šå…·å¤‡æ˜¾è‘—ä¼˜åŠ¿ â€”â€” å¯¹äºä¸­æ–‡ç”¨æˆ·å¸¸ç”¨çš„è¡¨è¿°æ–¹å¼ã€æ–‡åŒ–åœºæ™¯ç›¸å…³çš„ç¼–è¾‘éœ€æ±‚ï¼Œé¾™çŒ«èƒ½æ›´ç²¾å‡†åœ°æ•æ‰æ ¸å¿ƒæ„å›¾ï¼Œå‡å°‘æŒ‡ä»¤åå·®å¯¼è‡´çš„ç”Ÿæˆè¯¯å·®ã€‚</p>
<p>å› æ­¤ï¼Œè‹¥ä½ çš„ä½¿ç”¨åœºæ™¯ä»¥ä¸­æ–‡æŒ‡ä»¤ä¸ºä¸»ï¼Œä¸”å¯¹è¿è¡Œé€Ÿåº¦æœ‰è¾ƒé«˜è¦æ±‚ï¼ŒåŒæ—¶å¸Œæœ›å…¼é¡¾å¼€æºç”Ÿæ€çš„æ˜“ç”¨æ€§ï¼Œ<strong>ä¼˜å…ˆæ¨èé€‰æ‹©ç¾å›¢é¾™çŒ«æ¨¡å‹</strong>ï¼›è€Œå¦‚æœéœ€è¦ 1K é«˜åˆ†è¾¨ç‡è¾“å‡ºã€ä¿„è¯­æ¦‚å¿µæ”¯æŒæˆ–ç‰¹å®šé£æ ¼åŒ–ç¼–è¾‘æ•ˆæœï¼ŒKandinsky 5.0 ä»æ˜¯å€¼å¾—å°è¯•çš„å¤‡é€‰æ–¹æ¡ˆï¼ˆéœ€æ¥å—å…¶é€Ÿåº¦ä¸ä¸­æ–‡é€‚é…çš„å±€é™æ€§ï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GPT-5.2 å‘å¸ƒï¼šä¸æ˜¯å°å‡çº§ï¼Œæ˜¯ã€Œæ™ºèƒ½è·ƒè¿ã€]]></title>    <link>https://juejin.cn/post/7584987267266347018</link>    <guid>https://juejin.cn/post/7584987267266347018</guid>    <pubDate>2025-12-18T00:32:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584987267266347018" data-draft-id="7583667970736734208" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GPT-5.2 å‘å¸ƒï¼šä¸æ˜¯å°å‡çº§ï¼Œæ˜¯ã€Œæ™ºèƒ½è·ƒè¿ã€"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-18T00:32:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="golangå­¦ä¹ è®°"/> <meta itemprop="url" content="https://juejin.cn/user/4371313964100990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GPT-5.2 å‘å¸ƒï¼šä¸æ˜¯å°å‡çº§ï¼Œæ˜¯ã€Œæ™ºèƒ½è·ƒè¿ã€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4371313964100990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    golangå­¦ä¹ è®°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:32:41.000Z" title="Thu Dec 18 2025 00:32:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>â€œè¿™æ˜¯ GPT-5 ä»¥æ¥ agentic coding æœ€å¤§çš„è·ƒå‡ï¼Œç‰ˆæœ¬å·çš„å°å¹…å‡çº§ä½ä¼°äº†æ™ºèƒ½çš„å¤§å¹…æå‡ã€‚â€<br/>
â€”â€” Windsurf CEOï¼Œçœ‹åˆ° SWE-Bench Pro ç»“æœåå¦‚æ˜¯è¯´</p>
</blockquote>
<p>å°±åœ¨ Altman å†…éƒ¨æ‹‰å“ <strong>Code Red</strong> ä¸€å‘¨åï¼ŒOpenAI æœæ–­äº¤å·â€”â€”<strong>GPT-5.2 ä¸‰å‰‘é½å‘</strong>ï¼š</p>
<ul>
<li><code>gpt-5.2-instant</code>ï¼šå¯¹è¯å¿«å¦‚é—ªç”µ âš¡</li>
<li><code>gpt-5.2-thinking</code>ï¼šæ·±åº¦æ¨ç†å¼•æ“ ğŸ§ </li>
<li><code>gpt-5.2-pro</code>ï¼šé¡¶çº§æ”»åšä¸“å®¶ ğŸ’</li>
</ul>
<hr/>
<h2 data-id="heading-0">ğŸ”¥ ä¸€ã€ä¸ºä»€ä¹ˆå«ã€Œ5.2ã€ï¼Ÿå› ä¸ºâ€”â€”å®ƒæœ¬è¯¥å«ã€ŒGPT-6ã€</h2>
<p>å…ˆçœ‹ä¸€ç»„éœ‡æ’¼æ•°æ®ğŸ‘‡</p>



































<table><thead><tr><th>Benchmark</th><th>GPT-5.1</th><th>GPT-5.2 Thinking</th><th>æå‡</th></tr></thead><tbody><tr><td><strong>AIME 2025</strong>ï¼ˆæ•°å­¦å¥¥èµ›ï¼‰</td><td>â€”</td><td>âœ… <strong>100% æ»¡åˆ†</strong>ï¼ˆæ— å·¥å…·ï¼‰</td><td>â€”</td></tr><tr><td><strong>ARC-AGI-2</strong>ï¼ˆæŠ½è±¡æ¨ç†ï¼‰</td><td>17.6%</td><td><strong>52.9%</strong></td><td>â†‘ <strong>200%+</strong></td></tr><tr><td><strong>SWE-Bench Pro</strong>ï¼ˆçœŸå®ä»£ç ï¼‰</td><td>50.8%</td><td><strong>55.6%</strong></td><td>â†‘ 4.8 pts</td></tr><tr><td><strong>GDPval</strong>ï¼ˆçŸ¥è¯†å·¥ä½œèƒœç‡ï¼‰</td><td>â€”</td><td><strong>70.9%</strong> vs äººç±»ä¸“å®¶</td><td>â€”</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04ccb69eafbc420a9a32c8d31c432823~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=5yoCD3sV%2FCX0o%2BWjZNtE%2FG%2BirE4%3D" alt="GPT-5.2 æ ¸å¿ƒ Benchmark å¯¹æ¯”å›¾ï¼šARCã€AIMEã€SWE-Bench å…¨é¢ç¢¾å‹" loading="lazy"/></p>
<blockquote>
<p>ğŸ“Œ å…³é”®æ´å¯Ÿï¼š<br/>
<strong>ARC-AGI-2 ä» 17.6% â†’ 52.9%</strong> æ˜¯è´¨å˜â€”â€”æ­¤å‰æ‰€æœ‰æ¨¡å‹åœ¨æ­¤ä»»åŠ¡ä¸Šé•¿æœŸå¡åœ¨ 20% ä»¥ä¸‹ï¼ŒGPT-5.2 æ˜¯é¦–ä¸ªçªç ´ã€Œå¸¸è¯†æ€§æŠ½è±¡æ¨ç†ã€é—¨æ§›çš„æ¨¡å‹ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">ğŸ§© äºŒã€ä¸‰å¤§ç‰ˆæœ¬ï¼Œç²¾å‡†åˆ†å·¥</h2>

































<table><thead><tr><th>æ¨¡å‹</th><th>å®šä½</th><th>é€‚ç”¨åœºæ™¯</th><th>æ¨ç†è€—æ—¶</th><th>API åç§°</th></tr></thead><tbody><tr><td><strong>GPT-5.2 Instant</strong></td><td>æ—¥å¸¸å¯¹è¯å¿«æªæ‰‹</td><td>èŠå¤©ã€ç¿»è¯‘ã€ç®€å•é—®ç­”</td><td>&lt;1s</td><td><code>gpt-5.2-chat-latest</code></td></tr><tr><td><strong>GPT-5.2 Thinking</strong></td><td>æ·±åº¦ä»»åŠ¡ä¸»åŠ›</td><td>ç¼–ç ã€é•¿æ–‡åˆ†æã€æ•°å­¦ã€è§„åˆ’</td><td>æ•°ç§’~æ•°åˆ†é’Ÿ</td><td><code>gpt-5.2</code></td></tr><tr><td><strong>GPT-5.2 Pro</strong></td><td>ä¸“å®¶çº§æ”»åš</td><td>ç§‘ç ”çº§æ¨ç†ã€å¤æ‚å»ºæ¨¡ã€æé™ç²¾åº¦</td><td>åˆ†é’Ÿçº§ï¼ˆå¯é€‰ <code>xhigh</code> effortï¼‰</td><td><code>gpt-5.2-pro</code></td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ ç±»æ¯”ï¼š</p>
<ul>
<li>Instant = æ™ºèƒ½æ‰‹æœºå¿«åº”ç”¨</li>
<li>Thinking = ç¬”è®°æœ¬ä¸»åŠ›æœº</li>
<li>Pro = å·¥ä½œç«™ + GPU é›†ç¾¤</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-2">ğŸŒŸ ä¸‰ã€ä¸ƒå¤§èƒ½åŠ›è·ƒå‡ï¼Œé™„å®˜æ–¹å®æµ‹å›¾</h2>
<h3 data-id="heading-3">1ï¸âƒ£ ğŸ§® æ•°å­¦ä¸ç§‘å­¦ï¼šæ‹¿ä¸‹ AIME æ»¡åˆ†ï¼</h3>
<ul>
<li><strong>AIME 2025</strong>ï¼šâœ… <strong>100% æ»¡åˆ†</strong>ï¼ˆæ— å·¥å…·è°ƒç”¨ï¼‰â€”â€”å²ä¸Šé¦–æ¬¡</li>
<li><strong>HMMT 2025</strong>ï¼š99.4% â†’ Pro ç‰ˆ <strong>100%</strong></li>
<li><strong>GPQA Diamond</strong>ï¼š92.4% â†’ Pro ç‰ˆ <strong>93.2%</strong></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7ccf8d772cf48969ee32bd937fb45d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=VAmelUZMIFbMIyjhiGjg%2BvE4U30%3D" alt="æ•°å­¦ä¸ç§‘å­¦è¯„æµ‹ï¼šAIME æ»¡åˆ†ã€HMMT æ¥è¿‘æ»¡åˆ†" loading="lazy"/></p>
<blockquote>
<p>ğŸ” äº®ç‚¹ï¼šä¸ä»…èƒ½è§£é¢˜ï¼Œè¿˜èƒ½<strong>ç”Ÿæˆä¸¥è°¨è¯æ˜è¿‡ç¨‹</strong>ï¼Œé”™è¯¯ç‡å¤§å¹…ä¸‹é™ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">2ï¸âƒ£ ğŸ’» å†™ä»£ç ï¼šSWE-Bench Pro é¦–è¶… 55%</h3>
<p>æ–° benchmark <strong>SWE-Bench Pro</strong> æ›´è´´è¿‘å·¥ä¸šç•Œï¼š</p>
<ul>
<li>æ”¯æŒ <strong>Python/Java/TS/Go</strong> å››è¯­è¨€</li>
<li>è¦æ±‚ç†è§£ issue â†’ ä¿®æ”¹ä»£ç  â†’ é€šè¿‡æµ‹è¯• â†’ å†™æ³¨é‡Š</li>
</ul>





















<table><thead><tr><th>æ¨¡å‹</th><th>SWE-Bench Pro</th></tr></thead><tbody><tr><td>GPT-5.1</td><td>50.8%</td></tr><tr><td><strong>GPT-5.2 Thinking</strong></td><td><strong>55.6%</strong></td></tr><tr><td>Claude 3.5 Sonnet</td><td>~53%*ï¼ˆä¼°ç®—ï¼‰</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68e4f5515c64428f9af12284f397a5ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=2Q0xJ6DTk0erP1HNCcRn9CmmLWo%3D" alt="SWE-Bench Pro ç»“æœï¼šGPT-5.2 æ˜¾è‘—é¢†å…ˆ" loading="lazy"/></p>
<blockquote>
<p>ğŸ¯ å‰ç«¯èƒ½åŠ›é£è·ƒï¼š<strong>å• prompt ç”Ÿæˆ 3D æµ·æµªæ¨¡æ‹Ÿ</strong>ï¼ˆWebGL + ç‰©ç†å‚æ•°ï¼‰ğŸ‘‡<br/>
cursorè™½ç„¶æ¨å‡ºäº†æœ€æ–°çš„visual editor ï¼Œä½†æ˜¯3Dèƒ½åŠ›è¿˜ä¸è¡Œ<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2577ac00b6b84a3ab162000a1a9f9848~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=QPkoSHf%2B14z1f2g2zW7NUQCCX9k%3D" alt="æµ·æµªæ¨¡æ‹Ÿ Demoï¼šå• prompt ç”Ÿæˆå¯äº¤äº’ 3D åœºæ™¯" loading="lazy"/></p>
</blockquote>
<hr/>
<h3 data-id="heading-5">3ï¸âƒ£ ğŸ‘ï¸ è§†è§‰ç†è§£ï¼šé”™è¯¯ç‡<strong>å‡åŠ</strong>ï¼Œç©ºé—´æ„ŸçŸ¥å¼€æŒ‚</h3>
<ul>
<li><strong>CharXiv Reasoning</strong>ï¼ˆè®ºæ–‡å›¾è¡¨é—®ç­”ï¼‰ï¼š80.3% â†’ <strong>88.7%</strong></li>
<li><strong>ScreenSpot-Pro</strong>ï¼ˆGUI ç†è§£ï¼‰ï¼š64.2% â†’ <strong>86.3%</strong></li>
</ul>
<h4 data-id="heading-6">ä¸»æ¿è¯†åˆ«å®æµ‹ï¼šä»ã€Œè®¤ä¸å…¨ã€åˆ°ã€Œç²¾å‡†æ ‡æ³¨ã€</h4>













<table><thead><tr><th>GPT-5.1</th><th>GPT-5.2</th></tr></thead><tbody><tr><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b2d67365e244f9fa32cc9d4702feec6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=%2BkQQZbQ9T92ZL3jo5bCWA9v41bc%3D" alt="GPT-5.1 ä¸»æ¿è¯†åˆ«ï¼šæ¼æ ‡ã€é”™ä½" loading="lazy"/></td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20d9360b475246c7af604cd5d03a7424~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=5wC0COUgYGfs6irTlu7IUx97i5Q%3D" alt="GPT-5.2 ä¸»æ¿è¯†åˆ«ï¼šç»„ä»¶å…¨æ ‡ã€ä½ç½®ç²¾å‡†" loading="lazy"/></td></tr></tbody></table>
<blockquote>
<p>âœ… ç©ºé—´æ¨ç†èƒ½åŠ›å¤§å¹…æå‡ï¼šèƒ½ç†è§£ã€Œå·¦ä¸Šè§’çš„ PCIe æ’æ§½ã€ã€ŒCPU ä¸‹æ–¹çš„ VRM æ¨¡å—ã€</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">4ï¸âƒ£ ğŸ“œ é•¿æ–‡æ¡£ï¼š4-Needle ä»»åŠ¡ <strong>256K ä¸Šæ¥è¿‘ 100%</strong></h3>
<p>OpenAI MRCRv2 æµ‹è¯•ï¼šåœ¨è¶…é•¿æ–‡æ¡£ä¸­æ‰¾ç¬¬ N ä¸ªã€Œneedleã€ã€‚</p>

















<table><thead><tr><th>æ¨¡å‹</th><th>4-Needle @256K</th></tr></thead><tbody><tr><td>GPT-5.1</td><td>~30%</td></tr><tr><td><strong>GPT-5.2 Thinking</strong></td><td><strong>~100%</strong> âœ…</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d94353c3ee2f4d278a86eb376e0df007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=n4azNKBWv4pqarm1BLTXt5uLXOs%3D" alt="4-Needle ä»»åŠ¡ï¼šGPT-5.2 åœ¨ 256K ä¸Šè¿‘ä¹å®Œç¾" loading="lazy"/><br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c90659c473ed4209b5a0c93f61318ee1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=X1EDzHL9M3RTfDgvOb0qlNpgdyA%3D" alt="8-Needle ä»»åŠ¡ï¼šåŒæ ·å¤§å¹…é¢†å…ˆ" loading="lazy"/></p>
<blockquote>
<p>âš™ï¸ æ–°å¢ <code>/compact</code> API ç«¯ç‚¹ï¼šå¯åŠ¨æ€å‹ç¼©ä¸Šä¸‹æ–‡ï¼Œæ”¯æŒ<strong>è¶…é•¿å·¥å…·é“¾ä»»åŠ¡</strong>ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-8">5ï¸âƒ£ ğŸ› ï¸ å·¥å…·è°ƒç”¨ï¼šå¤šè½®ä»»åŠ¡ã€Œä¸€æ­¥åˆ°ä½ã€</h3>
<p>Tau2-benchï¼ˆå®¢æœåœºæ™¯ï¼‰ï¼š</p>
<ul>
<li>Telecom é¢†åŸŸï¼š95.6% â†’ <strong>98.7%</strong></li>
<li>Retail é¢†åŸŸï¼š77.9% â†’ <strong>82.0%</strong></li>
</ul>
<h4 data-id="heading-9">ç”¨æˆ·éœ€æ±‚ï¼šã€Œèˆªç­å»¶è¯¯ + é”™è¿‡è½¬æœº + è¡Œæä¸¢å¤± + åŒ»ç–—éœ€æ±‚ + è¿‡å¤œå®‰æ’ã€</h4>













<table><thead><tr><th>GPT-5.1</th><th>GPT-5.2</th></tr></thead><tbody><tr><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7267df93494442f9a935c100ed55807e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=vHnLOH9iBcXHB5sskWl44jfiIW0%3D" alt="GPT-5.1ï¼šæ¼æ‰ç‰¹æ®Šåº§ä½ã€èµ”å¿æµç¨‹" loading="lazy"/></td><td><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b13ec10cbda347e5b0efc8a35f4ad0ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=59glwy5QWY07Jd9ZjmYkfM21ltA%3D" alt="GPT-5.2ï¼šå®Œæ•´å¤„ç†ï¼šæ”¹ç­¾+åº§ä½+èµ”å¿+é…’åº—" loading="lazy"/></td></tr></tbody></table>
<blockquote>
<p>âœ… Pro ç‰ˆå¯ä¸²è”å¤šä¸ªå·¥å…·è°ƒç”¨ï¼Œå®ç°<strong>ç«¯åˆ°ç«¯è‡ªåŠ¨åŒ–å·¥ä½œæµ</strong>ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-10">6ï¸âƒ£ ğŸ“Š çœŸå®çŸ¥è¯†å·¥ä½œï¼š70.9% ä»»åŠ¡èƒœè¿‡äººç±»ä¸“å®¶</h3>
<p>æ–° benchmark <strong>GDPval</strong> æµ‹ 44 ä¸ªèŒä¸šä»»åŠ¡ï¼š</p>
<ul>
<li>åš PPTã€å»ºè´¢åŠ¡æ¨¡å‹ã€å†™è¡Œä¸šæŠ¥å‘Šâ€¦â€¦</li>
</ul>

















<table><thead><tr><th>æ¨¡å‹</th><th>èƒœè¿‡äººç±»ä¸“å®¶æ¯”ä¾‹</th></tr></thead><tbody><tr><td>GPT-5.2 Thinking</td><td><strong>70.9%</strong></td></tr><tr><td>GPT-5.2 Pro</td><td><strong>74.1%</strong></td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3b63f7e31ef4e12be229fd74c4bfd0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=tGrBPESRygBYv2vta7c72j38L8I%3D" alt="GDPval ä»»åŠ¡å¯¹æ¯”ï¼šå·¦è¾¹ GPT-5.1ï¼Œå³è¾¹ GPT-5.2ï¼ˆWorkforce Plannerï¼‰" loading="lazy"/></p>
<blockquote>
<p>ğŸ“Œ è¯„å®¡å‘˜è¯„ä»·ï¼š<br/>
<strong>ã€Œçœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªæœ‰å‘˜å·¥çš„ä¸“ä¸šå…¬å¸åšçš„ï¼Œå¸ƒå±€å’Œå»ºè®®éƒ½å¾ˆä¸“ä¸šã€</strong></p>
</blockquote>
<blockquote>
<p>ğŸ’° æ•ˆç‡ï¼š<strong>é€Ÿåº¦æ˜¯äººç±» 11 å€ï¼Œæˆæœ¬ &lt;1%</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-11">7ï¸âƒ£ ğŸ¯ å¹»è§‰ &amp; å®‰å…¨ï¼šé”™è¯¯å›å¤ â†“30%ï¼Œå„¿ç«¥ä¿æŠ¤ä¸Šçº¿</h3>
<ul>
<li>æœ‰é”™è¯¯å›å¤ç‡ï¼š<strong>8.8% â†’ 6.2%</strong>ï¼ˆâ†“30%ï¼‰</li>
<li>æ–°å¢ <strong>å¹´é¾„é¢„æµ‹æ¨¡å‹</strong>ï¼šè‡ªåŠ¨è¯†åˆ« 18 å²ä»¥ä¸‹ç”¨æˆ·ï¼Œé™åˆ¶æ•æ„Ÿå†…å®¹</li>
<li>å¿ƒç†å¥åº·å¯¹è¯å®‰å…¨æ€§æå‡ï¼ˆå»¶ç»­ GPT-5 Safe Completionï¼‰</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce0b3f3902524f88b47f92340c7e17c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=aQ1%2BOKbqKwMmI7ATf0D90DGdrzc%3D" alt="å¹»è§‰ç‡ä¸‹é™ 30%" loading="lazy"/><br/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0437fa6fc29b46e0b9901a0a174e510e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=y45OjjnhWUvRx8E3eNY7w4T9vzQ%3D" alt="å®‰å…¨æ€§è¯„ä¼°ï¼šè‡ªæ®‹/æƒ…æ„Ÿä¾èµ–ç­‰åœºæ™¯æ”¹è¿›" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-12">ğŸ’° å››ã€ä»·æ ¼ä¸æ€§ä»·æ¯”ï¼šè´µäº† 40%ï¼Œä½†å¯èƒ½æ›´çœé’±ï¼Ÿ</h2>




















<table><thead><tr><th>æ¨¡å‹</th><th>ä»·æ ¼ï¼ˆvs GPT-5.1ï¼‰</th><th>æ¯ç™¾ä¸‡ tokenï¼ˆè¾“å…¥+è¾“å‡ºï¼‰</th></tr></thead><tbody><tr><td>GPT-5.2</td><td><strong>+40%</strong></td><td>$5.00</td></tr><tr><td>GPT-5.2 Pro</td><td>+150%+</td><td>$20.00+</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea5684b146f842b984c14f167d8842ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZ29sYW5n5a2m5Lmg6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622761&amp;x-signature=5uPKaIzs8Z4KBzFADajxHZwMQMI%3D" alt="GPT-5.2 API ä»·æ ¼è¡¨" loading="lazy"/></p>
<blockquote>
<p>ğŸ” OpenAI è§£é‡Šï¼š<br/>
<strong>ã€Œå•ä»·æ›´é«˜ï¼Œä½† token æ•ˆç‡æå‡ï¼Œè¾¾åˆ°åŒæ ·æ•ˆæœçš„æ€»æˆæœ¬åè€Œæ›´ä½ã€</strong><br/>
ä¾‹ï¼šç”Ÿæˆä¸€ä»½ä¸“ä¸šæŠ¥å‘Šï¼ŒGPT-5.1 éœ€ 3 è½®è¿­ä»£ï¼ˆ300K tokenï¼‰ï¼ŒGPT-5.2 1 è½®æå®šï¼ˆ80K tokenï¼‰â†’ <strong>åé™ 40% æˆæœ¬</strong></p>
</blockquote>
<blockquote>
<p>ğŸ“Œ è®¢é˜…ç”¨æˆ·æ³¨æ„ï¼š</p>
<ul>
<li>ChatGPT Plus / Pro / Business / Enterprise <strong>ä»Šæ—¥èµ·æ¨é€</strong></li>
<li>GPT-5.1 å°†ä¿ç•™ <strong>3 ä¸ªæœˆ</strong>åä¸‹çº¿</li>
<li>Playground æ–°å¢ <code>xhigh</code> reasoning effortï¼ˆè´¨é‡ä¼˜å…ˆæ¨¡å¼ï¼‰</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-13">ğŸ§­ äº”ã€å¼€å‘è€…è¡ŒåŠ¨å»ºè®®</h2>

























<table><thead><tr><th>ä½ çš„è§’è‰²</th><th>æ¨èåŠ¨ä½œ</th></tr></thead><tbody><tr><td><strong>æ™®é€šç”¨æˆ·</strong></td><td>åœ¨ ChatGPT è®¾ç½®ä¸­åˆ‡æ¢è‡³ GPT-5.2 Thinkingï¼Œä½“éªŒã€Œä¸€æ¬¡ç”Ÿæˆå³è¾¾æ ‡ã€</td></tr><tr><td><strong>å·¥ç¨‹å¸ˆ</strong></td><td>å‡çº§ API â†’ ç”¨ <code>gpt-5.2</code> æ›¿ä»£ <code>gpt-5.1</code>ï¼›å¤æ‚ä»»åŠ¡è¯• <code>gpt-5.2-pro</code> + <code>xhigh</code></td></tr><tr><td><strong>ä¼ä¸šç”¨æˆ·</strong></td><td>è¯„ä¼° GDPval åœºæ™¯ï¼ˆPPT/æŠ¥è¡¨/å»ºæ¨¡ï¼‰â€”â€”äººåŠ›æˆæœ¬å¯é™ 90%+</td></tr><tr><td><strong>ç ”ç©¶è€…</strong></td><td>å…³æ³¨ ARC-AGI-2 / AIME / HLE çªç ´ï¼Œé‡å®¡ã€ŒAI æŠ½è±¡æ¨ç†ã€ä¸Šé™</td></tr></tbody></table>
<blockquote>
<p>ğŸš€ é¢å¤–å½©è›‹ï¼š<br/>
<strong>Codex ä¼˜åŒ–ç‰ˆå³å°†æ¨å‡º</strong>â€”â€”ç»“åˆ Skills + GPT-5.2ï¼Œæˆ–å°†è¯ç”Ÿã€Œé¢†åŸŸä¸“å®¶çº§ç¼–ç¨‹åŠ©æ‰‹ã€ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-14">âœ… ç»“è¯­ï¼šGPT-5.2 ä¸æ˜¯å‡çº§ï¼Œæ˜¯ã€Œæ‹ç‚¹ã€</h2>
<p>å®ƒè¯æ˜äº†ä¸€ä»¶äº‹ï¼š</p>
<blockquote>
<p><strong>å½“æ¨¡å‹åœ¨æŠ½è±¡æ¨ç†ï¼ˆARC-AGIï¼‰ã€æ•°å­¦è¯æ˜ï¼ˆAIMEï¼‰ã€çœŸå®ç¼–ç ï¼ˆSWE-Bench Proï¼‰ä¸‰å¤§ã€Œç¡¬éª¨å¤´ã€ä¸ŠåŒæ—¶çªç ´ï¼ŒAGI çš„è·¯å¾„å°±ä¸å†æ˜¯å“²å­¦é—®é¢˜ï¼Œè€Œæ˜¯å·¥ç¨‹é—®é¢˜ã€‚</strong></p>
</blockquote>
<p>Code Red çš„è­¦æŠ¥è§£é™¤äº†â€”â€”ä½†çœŸæ­£çš„ç«èµ›ï¼Œæ‰åˆšåˆšå¼€å§‹ã€‚</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOSæƒé™ç®¡ç†å®æˆ˜â€”â€”éº¦å…‹é£ã€éœ‡åŠ¨ç­‰æ•æ„Ÿæƒé™ç”³è¯·]]></title>    <link>https://juejin.cn/post/7584730308752949298</link>    <guid>https://juejin.cn/post/7584730308752949298</guid>    <pubDate>2025-12-18T02:40:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584730308752949298" data-draft-id="7584987267267182602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOSæƒé™ç®¡ç†å®æˆ˜â€”â€”éº¦å…‹é£ã€éœ‡åŠ¨ç­‰æ•æ„Ÿæƒé™ç”³è¯·"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-18T02:40:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·73614681275"/> <meta itemprop="url" content="https://juejin.cn/user/433640354087403"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOSæƒé™ç®¡ç†å®æˆ˜â€”â€”éº¦å…‹é£ã€éœ‡åŠ¨ç­‰æ•æ„Ÿæƒé™ç”³è¯·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/433640354087403/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·73614681275
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:40:58.000Z" title="Thu Dec 18 2025 02:40:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>æŠ€æœ¯æ ˆ</strong>ï¼šHarmonyOS 5.0 + ArkTS + abilityAccessCtrl</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéŸ³é¢‘å½•åˆ¶ã€è®¾å¤‡æ§åˆ¶ã€éšç§æ•°æ®è®¿é—®</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>HarmonyOSé‡‡ç”¨ä¸¥æ ¼çš„æƒé™ç®¡ç†æœºåˆ¶ï¼Œæ•æ„Ÿæƒé™éœ€è¦åœ¨é…ç½®æ–‡ä»¶å£°æ˜å¹¶åŠ¨æ€ç”³è¯·ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•æ­£ç¡®å¤„ç†éº¦å…‹é£ã€éœ‡åŠ¨ç­‰å¸¸ç”¨æƒé™ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€æƒé™åˆ†ç±»</h2>




















<table><thead><tr><th>æƒé™ç±»å‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>system_grant</td><td>ç³»ç»Ÿè‡ªåŠ¨æˆäºˆ</td><td>ç½‘ç»œè®¿é—®</td></tr><tr><td>user_grant</td><td>éœ€ç”¨æˆ·æˆæƒ</td><td>éº¦å…‹é£ã€ç›¸æœº</td></tr></tbody></table>
<h2 data-id="heading-2">äºŒã€é…ç½®æ–‡ä»¶å£°æ˜</h2>
<h3 data-id="heading-3">2.1 module.json5é…ç½®</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"requestPermissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.MICROPHONE"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:microphone_reason"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"usedScene"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"inuse"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.VIBRATE"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"reason"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:vibrate_reason"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"usedScene"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"when"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"inuse"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-4">2.2 å­—ç¬¦ä¸²èµ„æº</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// resources/base/element/string.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"string"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"microphone_reason"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ç”¨äºæ£€æµ‹ç¯å¢ƒå™ªéŸ³åˆ†è´å€¼ï¼Œä¿æŠ¤æ‚¨çš„å¬åŠ›å¥åº·"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vibrate_reason"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ç”¨äºæ“ä½œåé¦ˆå’Œæ‰‹æœºæ’æ°´åŠŸèƒ½"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€åŠ¨æ€æƒé™ç”³è¯·</h2>
<h3 data-id="heading-6">3.1 æƒé™å·¥å…·ç±»</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> abilityAccessCtrl <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.abilityAccessCtrl'</span>;
<span class="hljs-keyword">import</span> bundleManager <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.bundle.bundleManager'</span>;
<span class="hljs-keyword">import</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermissionUtil</span> {
  <span class="hljs-comment">/**
   * æ£€æŸ¥æƒé™æ˜¯å¦å·²æˆäºˆ
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkPermission</span>(<span class="hljs-attr">permission</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {
    <span class="hljs-keyword">const</span> atManager = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
    <span class="hljs-keyword">const</span> bundleInfo = <span class="hljs-keyword">await</span> bundleManager.<span class="hljs-title function_">getBundleInfoForSelf</span>(
      bundleManager.<span class="hljs-property">BundleFlag</span>.<span class="hljs-property">GET_BUNDLE_INFO_WITH_APPLICATION</span>
    );
    <span class="hljs-keyword">const</span> tokenId = bundleInfo.<span class="hljs-property">appInfo</span>.<span class="hljs-property">accessTokenId</span>;
    
    <span class="hljs-keyword">const</span> grantStatus = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">checkAccessToken</span>(tokenId, permission);
    <span class="hljs-keyword">return</span> grantStatus === abilityAccessCtrl.<span class="hljs-property">GrantStatus</span>.<span class="hljs-property">PERMISSION_GRANTED</span>;
  }

  <span class="hljs-comment">/**
   * è¯·æ±‚å•ä¸ªæƒé™
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">requestPermission</span>(
    <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span>,
    <span class="hljs-attr">permission</span>: <span class="hljs-built_in">string</span>
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {
    <span class="hljs-keyword">const</span> atManager = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(context, [permission]);
      <span class="hljs-keyword">return</span> result.<span class="hljs-property">authResults</span>[<span class="hljs-number">0</span>] === <span class="hljs-number">0</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¯·æ±‚æƒé™å¤±è´¥:'</span>, err);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }

  <span class="hljs-comment">/**
   * è¯·æ±‚å¤šä¸ªæƒé™
   */</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">requestPermissions</span>(
    <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span>,
    <span class="hljs-attr">permissions</span>: <span class="hljs-built_in">string</span>[]
  ): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">boolean</span>&gt;&gt; {
    <span class="hljs-keyword">const</span> atManager = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();
    <span class="hljs-keyword">const</span> resultMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">boolean</span>&gt;();
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(context, permissions);
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; permissions.<span class="hljs-property">length</span>; i++) {
        resultMap.<span class="hljs-title function_">set</span>(permissions[i], result.<span class="hljs-property">authResults</span>[i] === <span class="hljs-number">0</span>);
      }
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¯·æ±‚æƒé™å¤±è´¥:'</span>, err);
      permissions.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> resultMap.<span class="hljs-title function_">set</span>(p, <span class="hljs-literal">false</span>));
    }
    
    <span class="hljs-keyword">return</span> resultMap;
  }
}
</code></pre>
<h3 data-id="heading-7">3.2 éº¦å…‹é£æƒé™ç”³è¯·</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">DecibelMeterPage</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">hasPermission</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">isMonitoring</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">decibelDetector</span>: <span class="hljs-title class_">DecibelDetector</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkAndRequestPermission</span>();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkAndRequestPermission</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">getContext</span>(<span class="hljs-variable language_">this</span>) <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;
    
    <span class="hljs-comment">// å…ˆæ£€æŸ¥æ˜¯å¦å·²æœ‰æƒé™</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasPermission</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PermissionUtil</span>.<span class="hljs-title function_">checkPermission</span>(<span class="hljs-string">'ohos.permission.MICROPHONE'</span>);
    
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasPermission</span>) {
      <span class="hljs-comment">// è¯·æ±‚æƒé™</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">hasPermission</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">PermissionUtil</span>.<span class="hljs-title function_">requestPermission</span>(
        context,
        <span class="hljs-string">'ohos.permission.MICROPHONE'</span>
      );
    }
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasPermission</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initDecibelDetector</span>();
    }
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">initDecibelDetector</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">decibelDetector</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecibelDetector</span>(<span class="hljs-function">(<span class="hljs-params">db: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
      <span class="hljs-comment">// å¤„ç†åˆ†è´å€¼</span>
    });
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">decibelDetector</span>.<span class="hljs-title function_">start</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isMonitoring</span> = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">hasPermission</span>) {
        <span class="hljs-title class_">Column</span>() {
          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'éœ€è¦éº¦å…‹é£æƒé™'</span>)
            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'è¯·æˆæƒéº¦å…‹é£æƒé™ä»¥ä½¿ç”¨åˆ†è´æ£€æµ‹åŠŸèƒ½'</span>)
            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#666'</span>)
          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'æˆæƒ'</span>)
            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkAndRequestPermission</span>())
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// æ­£å¸¸åŠŸèƒ½ç•Œé¢</span>
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.isMonitoring ? <span class="hljs-string">'æ£€æµ‹ä¸­...'</span> : <span class="hljs-string">'æœªå¯åŠ¨'</span>}</span>`</span>)
      }
    }
  }
}
</code></pre>
<h2 data-id="heading-8">å››ã€æƒé™è¢«æ‹’ç»çš„å¤„ç†</h2>
<h3 data-id="heading-9">4.1 å¼•å¯¼ç”¨æˆ·åˆ°è®¾ç½®é¡µ</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Want</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.Want'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">openAppSettings</span>(<span class="hljs-params">context: common.UIAbilityContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {
    <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.huawei.hmos.settings'</span>,
    <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'com.huawei.hmos.settings.MainAbility'</span>,
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'application_info_entry'</span>,
    <span class="hljs-attr">parameters</span>: {
      <span class="hljs-attr">pushParams</span>: context.<span class="hljs-property">abilityInfo</span>.<span class="hljs-property">bundleName</span>
    }
  };
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">startAbility</span>(want);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ‰“å¼€è®¾ç½®å¤±è´¥:'</span>, err);
  }
}
</code></pre>
<h3 data-id="heading-10">4.2 å‹å¥½çš„æƒé™è¯´æ˜å¼¹çª—</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@CustomDialog</span>
struct <span class="hljs-title class_">PermissionDialog</span> {
  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">CustomDialogController</span>;
  <span class="hljs-attr">permissionName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'éº¦å…‹é£'</span>;
  <span class="hljs-attr">permissionReason</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'ç”¨äºæ£€æµ‹ç¯å¢ƒå™ªéŸ³'</span>;
  <span class="hljs-attr">onConfirm</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">() =&gt;</span> {};
  <span class="hljs-attr">onCancel</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">() =&gt;</span> {};

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`éœ€è¦<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.permissionName}</span>æƒé™`</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
      
      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">permissionReason</span>)
        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#666'</span>)
        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })
      
      <span class="hljs-title class_">Row</span>() {
        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'å–æ¶ˆ'</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onCancel</span>();
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">close</span>();
          })
        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'å»æˆæƒ'</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onConfirm</span>();
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">close</span>();
          })
      }
      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })
      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceEvenly</span>)
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    }
    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
  }
}
</code></pre>
<h2 data-id="heading-11">äº”ã€å¸¸ç”¨æƒé™åˆ—è¡¨</h2>



































<table><thead><tr><th>æƒé™åç§°</th><th>ç”¨é€”</th><th>ç±»å‹</th></tr></thead><tbody><tr><td>ohos.permission.MICROPHONE</td><td>éº¦å…‹é£å½•éŸ³</td><td>user_grant</td></tr><tr><td>ohos.permission.VIBRATE</td><td>è®¾å¤‡éœ‡åŠ¨</td><td>system_grant</td></tr><tr><td>ohos.permission.INTERNET</td><td>ç½‘ç»œè®¿é—®</td><td>system_grant</td></tr><tr><td>ohos.permission.CAMERA</td><td>ç›¸æœºæ‹ç…§</td><td>user_grant</td></tr><tr><td>ohos.permission.READ_MEDIA</td><td>è¯»å–åª’ä½“æ–‡ä»¶</td><td>user_grant</td></tr></tbody></table>
<h2 data-id="heading-12">å…­ã€é¿å‘æŒ‡å—</h2>
<ol>
<li><strong>å£°æ˜ä¸ç”³è¯·</strong>ï¼šuser_grantæƒé™éœ€è¦åœ¨é…ç½®æ–‡ä»¶å£°æ˜ä¸”åŠ¨æ€ç”³è¯·</li>
<li><strong>reasonå­—æ®µ</strong>ï¼šå¿…é¡»æä¾›æ¸…æ™°çš„æƒé™ä½¿ç”¨è¯´æ˜ï¼Œå®¡æ ¸ä¼šæ£€æŸ¥</li>
<li><strong>æ—¶æœºé€‰æ‹©</strong>ï¼šåœ¨éœ€è¦ä½¿ç”¨æ—¶å†ç”³è¯·ï¼Œä¸è¦ä¸€å¯åŠ¨å°±ç”³è¯·æ‰€æœ‰æƒé™</li>
<li><strong>æ‹’ç»å¤„ç†</strong>ï¼šç”¨æˆ·æ‹’ç»åè¦æœ‰å‹å¥½çš„å¼•å¯¼ï¼Œä¸èƒ½å¼ºåˆ¶é€€å‡º</li>
<li><strong>éšç§æ”¿ç­–</strong>ï¼šåº”ç”¨å•†åº—è¦æ±‚åœ¨éšç§æ”¿ç­–ä¸­è¯´æ˜æƒé™ç”¨é€”</li>
</ol>
<h2 data-id="heading-13">ä¸ƒã€åä¸ºåº”ç”¨å¸‚åœºå®¡æ ¸è¦ç‚¹</h2>
<ol>
<li>æƒé™ç”³è¯·å¿…é¡»æœ‰æ˜ç¡®çš„ä½¿ç”¨åœºæ™¯</li>
<li>reasonå­—æ®µè¦æ¸…æ™°è¯´æ˜ç”¨é€”</li>
<li>ä¸èƒ½ç”³è¯·ä¸åŠŸèƒ½æ— å…³çš„æƒé™</li>
<li>ç”¨æˆ·æ‹’ç»æƒé™ååº”ç”¨ä»èƒ½æ­£å¸¸ä½¿ç”¨å…¶ä»–åŠŸèƒ½</li>
</ol>
<h2 data-id="heading-14">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº†HarmonyOSæƒé™ç®¡ç†çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬é…ç½®å£°æ˜ã€åŠ¨æ€ç”³è¯·ã€æ‹’ç»å¤„ç†ç­‰ã€‚æ­£ç¡®çš„æƒé™ç®¡ç†ä¸ä»…æ˜¯åº”ç”¨ä¸Šæ¶çš„å¿…è¦æ¡ä»¶ï¼Œä¹Ÿæ˜¯ä¿æŠ¤ç”¨æˆ·éšç§çš„é‡è¦æªæ–½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nacosåˆ°åº•æ˜¯APè¿˜æ˜¯CPï¼Ÿä¸€æ–‡è¯´æ¸…æ¥š]]></title>    <link>https://juejin.cn/post/7584722109584392235</link>    <guid>https://juejin.cn/post/7584722109584392235</guid>    <pubDate>2025-12-18T02:41:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584722109584392235" data-draft-id="7584740835368042550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nacosåˆ°åº•æ˜¯APè¿˜æ˜¯CPï¼Ÿä¸€æ–‡è¯´æ¸…æ¥š"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,åˆ†å¸ƒå¼"/> <meta itemprop="datePublished" content="2025-12-18T02:41:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nacosåˆ°åº•æ˜¯APè¿˜æ˜¯CPï¼Ÿä¸€æ–‡è¯´æ¸…æ¥š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:41:25.000Z" title="Thu Dec 18 2025 02:41:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•å­</h2>
<p>æˆ‘ä¹‹å‰å†™è¿‡å‡ ç¯‡æ‰‹å†™Raftçš„æ–‡ç« ï¼Œé™†é™†ç»­ç»­è®²äº†å¾ˆå¤šRaftçš„åŸç†ï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/7573597479980761124" target="_blank" title="https://juejin.cn/post/7573597479980761124">å‡†å¤‡æ‰‹å†™Simple Raftï¼ˆä¸€ï¼‰ï¼šæƒ³é€šRaftçš„æ ¸å¿ƒé—®é¢˜</a></li>
</ul>
<p>æœ€è¿‘å‡†å¤‡å†™å¼€æºJobFlowï¼Œåˆæ·±å…¥ç ”ç©¶äº†Nacosï¼š</p>
<ul>
<li><a href="https://juejin.cn/post/7583469866007969827" target="_blank" title="https://juejin.cn/post/7583469866007969827">åŸºäºNacosçš„è½»é‡ä»»åŠ¡è°ƒåº¦æ–¹æ¡ˆ â€”â€” ä» XXL-Job çš„ç—›ç‚¹è¯´èµ·</a></li>
</ul>
<p>å€Ÿè¿™ä¸ªæœºä¼šï¼ŒæŠŠRaftåšä¸ªæ€»ç»“å§ã€‚åˆ†æˆä¸¤ç¯‡ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€ç¯‡ï¼šNacosåˆ°åº•æ˜¯APè¿˜æ˜¯CPï¼Ÿä¸€æ–‡è¯´æ¸…æ¥š</strong>ï¼ˆæœ¬ç¯‡ï¼‰</li>
<li>ç¬¬äºŒç¯‡ï¼šæ·±å…¥JRaftï¼šNacosé…ç½®ä¸­å¿ƒçš„æ€§èƒ½ä¼˜åŒ–å®è·µ</li>
</ul>
<p>è¿™ä¸€ç¯‡æˆ‘ä»¬èšç„¦æ ¸å¿ƒé—®é¢˜ï¼Œç”¨å¤§ç™½è¯æŠŠNacosçš„è®¾è®¡é€»è¾‘è®²æ¸…æ¥šã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ç›´æ¥å›ç­”ï¼šNacosæ—¢æ˜¯APä¹Ÿæ˜¯CP</h2>
<p>å¾ˆå¤šäººé—®ï¼š"Nacosåˆ°åº•æ˜¯APè¿˜æ˜¯CPï¼Ÿ"</p>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>çœ‹ä½ ç”¨å“ªä¸ªåŠŸèƒ½ã€‚</strong></p>
<pre><code class="hljs language-erlang" lang="erlang">Nacosçš„æ¶æ„è®¾è®¡
â”œâ”€â”€ æœåŠ¡æ³¨å†Œä¸­å¿ƒ
â”‚   â”œâ”€â”€ ä¸´æ—¶å®ä¾‹ï¼ˆé»˜è®¤ï¼‰â†’ APæ¨¡å¼
â”‚   â”‚   åè®®ï¼šDistro
â”‚   â”‚   ç‰¹ç‚¹ï¼šé«˜å¯ç”¨ï¼Œæœ€ç»ˆä¸€è‡´
â”‚   â”‚   å æ¯”ï¼š<span class="hljs-number">99</span><span class="hljs-comment">%çš„ä½¿ç”¨åœºæ™¯</span>
â”‚   â”‚
â”‚   â””â”€â”€ æŒä¹…åŒ–å®ä¾‹ â†’ CPæ¨¡å¼
â”‚       åè®®ï¼šRaft
â”‚       ç‰¹ç‚¹ï¼šå¼ºä¸€è‡´ï¼Œå¯èƒ½ä¸å¯ç”¨
â”‚       å æ¯”ï¼š<span class="hljs-number">1</span><span class="hljs-comment">%çš„ç‰¹æ®Šåœºæ™¯</span>
â”‚
â””â”€â”€ é…ç½®ä¸­å¿ƒ â†’ CPæ¨¡å¼
    åè®®ï¼šRaft
    ç‰¹ç‚¹ï¼šå¼ºä¸€è‡´ï¼Œæ•°æ®ä¸èƒ½é”™
    å æ¯”ï¼š<span class="hljs-number">100</span><span class="hljs-comment">%</span>
</code></pre>
<p>å¤§éƒ¨åˆ†äººç”¨NacosåšæœåŠ¡æ³¨å†Œï¼Œç”¨çš„éƒ½æ˜¯ä¸´æ—¶å®ä¾‹ï¼ˆAPæ¨¡å¼ï¼‰ï¼Œæ ¹æœ¬æ²¡ç”¨åˆ°Raftã€‚</p>
<p>åªæœ‰é…ç½®ä¸­å¿ƒå’Œå°‘é‡æŒä¹…åŒ–å®ä¾‹æ‰ç”¨Raftï¼ˆCPæ¨¡å¼ï¼‰ã€‚</p>
<h3 data-id="heading-2">é¢è¯•æ—¶æ€ä¹ˆå›ç­”ï¼Ÿ</h3>
<pre><code class="hljs language-arduino" lang="arduino">é¢è¯•å®˜ï¼šNacosæ˜¯APè¿˜æ˜¯CPï¼Ÿ

å¦‚æœç›´æ¥å›ç­”<span class="hljs-string">"CP"</span>æˆ–<span class="hljs-string">"AP"</span>ï¼š<span class="hljs-number">20</span>åˆ†

æ­£ç¡®å›ç­”ï¼š
<span class="hljs-string">"Nacosçš„æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œé»˜è®¤ä½¿ç”¨ä¸´æ—¶å®ä¾‹ï¼Œæ˜¯APæ¨¡å¼ï¼Œ
é€šè¿‡Distroåè®®å®ç°æœ€ç»ˆä¸€è‡´æ€§ï¼Œä¿è¯é«˜å¯ç”¨ã€‚
é…ç½®ä¸­å¿ƒä½¿ç”¨Raftåè®®ï¼Œæ˜¯CPæ¨¡å¼ï¼Œä¿è¯å¼ºä¸€è‡´æ€§ã€‚
å¦å¤–ä¹Ÿæ”¯æŒæŒä¹…åŒ–å®ä¾‹ï¼ŒåŒæ ·èµ°Raftåè®®ï¼Œ
é€‚ç”¨äºæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰åŸºç¡€è®¾æ–½çš„æ³¨å†Œã€‚"</span>

è¿™æ ·å›ç­”ï¼š<span class="hljs-number">80</span>åˆ†
</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ·±å…¥è®²è®²ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ã€‚</p>
<hr/>
<h2 data-id="heading-3">äºŒã€CAPç†è®ºï¼š5åˆ†é’Ÿè®²æ¸…æ¥š</h2>
<p>åœ¨è®²Nacosä¹‹å‰ï¼Œå¿…é¡»å…ˆç†è§£CAPç†è®ºã€‚</p>
<h3 data-id="heading-4">CAPæ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>CAPæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„é“å¾‹ï¼Œç”±ä¸‰ä¸ªå•è¯é¦–å­—æ¯ç»„æˆï¼š</p>
<ul>
<li><strong>C (Consistency)</strong>ï¼šä¸€è‡´æ€§
<ul>
<li>æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°ç›¸åŒçš„æ•°æ®</li>
<li>è¯»å–æ“ä½œæ€»èƒ½è¯»åˆ°æœ€æ–°å†™å…¥çš„å€¼</li>
</ul>
</li>
<li><strong>A (Availability)</strong>ï¼šå¯ç”¨æ€§
<ul>
<li>ä»»ä½•è¯·æ±‚éƒ½èƒ½å¾—åˆ°å“åº”</li>
<li>ä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œæ€»è¦ç»™ä¸ªç­”å¤</li>
</ul>
</li>
<li><strong>P (Partition tolerance)</strong>ï¼šåˆ†åŒºå®¹é”™
<ul>
<li>ç½‘ç»œåˆ†åŒºæ—¶ç³»ç»Ÿä»èƒ½å·¥ä½œ</li>
<li>éƒ¨åˆ†èŠ‚ç‚¹ä¹‹é—´é€šä¿¡ä¸­æ–­ï¼Œç³»ç»Ÿç…§å¸¸è¿è¡Œ</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">CAPå®šç†</h3>
<p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸¤ä¸ªã€‚</strong></p>
<p>ä½†å®é™…ä¸Šï¼Œç½‘ç»œåˆ†åŒºï¼ˆPï¼‰æ˜¯ä¸€å®šä¼šå‘ç”Ÿçš„ï¼Œä½ æ²¡æ³•é¿å…ã€‚æ‰€ä»¥çœŸæ­£çš„é€‰æ‹©æ˜¯ï¼š</p>
<pre><code class="hljs language-css" lang="css">å½“ç½‘ç»œåˆ†åŒºå‘ç”Ÿæ—¶ï¼Œä½ é€‰Cè¿˜æ˜¯<span class="hljs-selector-tag">A</span>ï¼Ÿ
</code></pre>
<h3 data-id="heading-6">CPç³»ç»Ÿï¼šå®å¯ä¸å¯ç”¨ï¼Œä¹Ÿä¸èƒ½æ•°æ®é”™</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6816e596047646f287b9e71491dce12c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LiP5rWq5peg55eV:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766630485&amp;x-signature=hAkq6qyXMbJJEswVLGVi3BZFXQI%3D" alt="201.jpg" loading="lazy"/></p>
<pre><code class="hljs language-diff" lang="diff">å…¸å‹åœºæ™¯ï¼šé“¶è¡Œè½¬è´¦

å‘ç”Ÿç½‘ç»œåˆ†åŒºï¼š
<span class="hljs-deletion">- æ­å·æœºæˆ¿ï¼šæœ‰å®¢æˆ·Açš„è´¦æˆ·</span>
<span class="hljs-deletion">- åŒ—äº¬æœºæˆ¿ï¼šæœ‰å®¢æˆ·Bçš„è´¦æˆ·</span>
<span class="hljs-deletion">- ä¸¤ä¸ªæœºæˆ¿ä¹‹é—´ç½‘ç»œæ–­äº†</span>

å¦‚æœé€‰æ‹©Cï¼ˆä¸€è‡´æ€§ï¼‰ï¼š
<span class="hljs-deletion">- æ‹’ç»æœåŠ¡ï¼š"ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œè¯·ç¨åå†è¯•"</span>
<span class="hljs-deletion">- ç­‰ç½‘ç»œæ¢å¤åå†è½¬è´¦</span>
<span class="hljs-deletion">- ä¿è¯ä¸ä¼šå‡ºç°"æ‰£äº†Açš„é’±ï¼Œä½†Bæ²¡æ”¶åˆ°"</span>

ä»£è¡¨æŠ€æœ¯ï¼šRaftã€ZooKeeperã€etcd
</code></pre>
<h3 data-id="heading-7">APç³»ç»Ÿï¼šå®å¯æ•°æ®ä¸ä¸€è‡´ï¼Œä¹Ÿè¦ç»§ç»­æœåŠ¡</h3>
<pre><code class="hljs language-diff" lang="diff">å…¸å‹åœºæ™¯ï¼šå¾®åšç‚¹èµ

å‘ç”Ÿç½‘ç»œåˆ†åŒºï¼š
<span class="hljs-deletion">- æ­å·æœºæˆ¿ï¼šæ˜¾ç¤º1000ä¸ªèµ</span>
<span class="hljs-deletion">- åŒ—äº¬æœºæˆ¿ï¼šæ˜¾ç¤º1002ä¸ªèµ</span>
<span class="hljs-deletion">- ä¸¤ä¸ªæœºæˆ¿ä¹‹é—´ç½‘ç»œæ–­äº†</span>

å¦‚æœé€‰æ‹©Aï¼ˆå¯ç”¨æ€§ï¼‰ï¼š
<span class="hljs-deletion">- ç»§ç»­æœåŠ¡ï¼Œå„æœºæˆ¿ç‹¬ç«‹è®¡æ•°</span>
<span class="hljs-deletion">- æ­å·çš„ç”¨æˆ·çœ‹åˆ°1000èµ</span>
<span class="hljs-deletion">- åŒ—äº¬çš„ç”¨æˆ·çœ‹åˆ°1002èµ</span>
<span class="hljs-deletion">- ç­‰ç½‘ç»œæ¢å¤åå†åŒæ­¥ï¼ˆæœ€ç»ˆä¸€è‡´ï¼‰</span>

ä»£è¡¨æŠ€æœ¯ï¼šDistroã€Gossipã€Cassandra
</code></pre>
<h3 data-id="heading-8">å…³é”®ç†è§£</h3>
<pre><code class="hljs language-markdown" lang="markdown">ä¸æ˜¯"APç³»ç»Ÿä¸ä¸€è‡´"ï¼Œè€Œæ˜¯"æš‚æ—¶ä¸ä¸€è‡´"ã€‚

APç³»ç»Ÿä¿è¯ï¼š
<span class="hljs-bullet">1.</span> ä»»ä½•æ—¶å€™éƒ½èƒ½æœåŠ¡ï¼ˆå¯ç”¨ï¼‰
<span class="hljs-bullet">2.</span> æœ€ç»ˆä¼šä¸€è‡´ï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰
<span class="hljs-bullet">3.</span> ä¸ä¸€è‡´çš„æ—¶é—´çª—å£å¾ˆçŸ­ï¼ˆé€šå¸¸1-2ç§’ï¼‰

CPç³»ç»Ÿä¿è¯ï¼š
<span class="hljs-bullet">1.</span> æ•°æ®ä»»ä½•æ—¶å€™éƒ½ä¸€è‡´ï¼ˆå¼ºä¸€è‡´ï¼‰
<span class="hljs-bullet">2.</span> å¯èƒ½æ‹’ç»æœåŠ¡ï¼ˆä¸å¯ç”¨ï¼‰
<span class="hljs-bullet">3.</span> ä¸ä¸€è‡´çš„æ—¶é—´çª—å£ä¸º0
</code></pre>
<hr/>
<h2 data-id="heading-9">ä¸‰ã€å¾®æœåŠ¡æ³¨å†Œä¸ºä»€ä¹ˆé€‰APï¼Ÿ</h2>
<p>ç†è§£äº†CAPï¼Œæˆ‘ä»¬çœ‹çœ‹ä¸ºä»€ä¹ˆå¾®æœåŠ¡æ³¨å†Œè¦ç”¨APæ¨¡å¼ã€‚</p>
<h3 data-id="heading-10">å¾®æœåŠ¡çš„åœºæ™¯</h3>
<p>å‡è®¾ä½ çš„ç”µå•†ç³»ç»Ÿï¼š</p>
<pre><code class="hljs language-diff" lang="diff">ç”¨æˆ·æœåŠ¡ï¼š10ä¸ªå®ä¾‹
è®¢å•æœåŠ¡ï¼š20ä¸ªå®ä¾‹
å•†å“æœåŠ¡ï¼š15ä¸ªå®ä¾‹

æ¯å¤©ï¼š
<span class="hljs-deletion">- å‡Œæ™¨å‘ç‰ˆé‡å¯ï¼š45ä¸ªå®ä¾‹é‡å¯</span>
<span class="hljs-deletion">- é«˜å³°æœŸæ‰©å®¹ï¼šæ–°å¢10ä¸ªå®ä¾‹</span>
<span class="hljs-deletion">- ä½å³°æœŸç¼©å®¹ï¼šä¸‹çº¿5ä¸ªå®ä¾‹</span>
<span class="hljs-deletion">- å¶å°”å®•æœºï¼š1-2ä¸ªå®ä¾‹æŒ‚æ‰</span>

å¹³å‡æ¯å°æ—¶æœ‰å‡ åæ¬¡å®ä¾‹ä¸Šä¸‹çº¿
</code></pre>
<h3 data-id="heading-11">å¦‚æœç”¨CPæ¨¡å¼ä¼šæ€æ ·ï¼Ÿ</h3>
<pre><code class="hljs language-markdown" lang="markdown">åœºæ™¯ï¼šè®¢å•æœåŠ¡çš„ä¸€ä¸ªå®ä¾‹å®•æœº

CPæ¨¡å¼çš„å¤„ç†æµç¨‹ï¼š
<span class="hljs-bullet">1.</span> Nacosæ£€æµ‹åˆ°å®ä¾‹ä¸‹çº¿
<span class="hljs-bullet">2.</span> éœ€è¦é€šè¿‡Raftåè®®æ›´æ–°æ³¨å†Œä¿¡æ¯
<span class="hljs-bullet">3.</span> LeaderèŠ‚ç‚¹å‘èµ·æ—¥å¿—å¤åˆ¶
<span class="hljs-bullet">4.</span> ç­‰å¾…è¿‡åŠèŠ‚ç‚¹ç¡®è®¤ï¼ˆ50-100msï¼‰
<span class="hljs-bullet">5.</span> ç¡®è®¤åï¼Œæ‰€æœ‰èŠ‚ç‚¹æ‰æ›´æ–°æ³¨å†Œè¡¨

é—®é¢˜ï¼š
<span class="hljs-bullet">-</span> æ…¢ï¼šæ¯æ¬¡ä¸Šä¸‹çº¿éƒ½è¦èµ°å…±è¯†
<span class="hljs-bullet">-</span> é˜»å¡ï¼šå†™æ“ä½œä¼šç­‰å¾…
<span class="hljs-bullet">-</span> é£é™©ï¼šNacosé›†ç¾¤ç½‘ç»œåˆ†åŒºå¯¼è‡´æœåŠ¡ä¸å¯ç”¨

æœ€ä¸¥é‡çš„ï¼š
å¦‚æœNacosé›†ç¾¤è‡ªå·±å‘ç”Ÿç½‘ç»œåˆ†åŒº
â†’ æ— æ³•è¾¾æˆå…±è¯†
â†’ æ‹’ç»æ‰€æœ‰æ³¨å†Œ/å¿ƒè·³
â†’ æ•´ä¸ªç³»ç»Ÿç˜«ç—ª
</code></pre>
<h3 data-id="heading-12">APæ¨¡å¼çš„å¤„ç†æ–¹å¼</h3>
<pre><code class="hljs language-markdown" lang="markdown">åœºæ™¯ï¼šè®¢å•æœåŠ¡çš„ä¸€ä¸ªå®ä¾‹å®•æœº

APæ¨¡å¼çš„å¤„ç†æµç¨‹ï¼š
<span class="hljs-bullet">1.</span> NacosæŸä¸ªèŠ‚ç‚¹æ£€æµ‹åˆ°ï¼ˆå¿ƒè·³è¶…æ—¶ï¼‰
<span class="hljs-bullet">2.</span> ç«‹å³æ›´æ–°æœ¬åœ°æ³¨å†Œä¿¡æ¯ï¼ˆ1-2msï¼‰
<span class="hljs-bullet">3.</span> å¼‚æ­¥é€šçŸ¥å…¶ä»–NacosèŠ‚ç‚¹ï¼ˆä¸ç­‰å¾…ï¼‰
<span class="hljs-bullet">4.</span> å®¢æˆ·ç«¯åœ¨1-2ç§’å†…æ‹‰å–åˆ°æœ€æ–°ä¿¡æ¯

ä¼˜åŠ¿ï¼š
<span class="hljs-bullet">-</span> å¿«ï¼šç›´æ¥å†™æœ¬åœ°å†…å­˜
<span class="hljs-bullet">-</span> ä¸é˜»å¡ï¼šä¸ç­‰å…¶ä»–èŠ‚ç‚¹å“åº”
<span class="hljs-bullet">-</span> é«˜å¯ç”¨ï¼šå³ä½¿Nacosç½‘ç»œåˆ†åŒºä¹Ÿèƒ½å„è‡ªæœåŠ¡

æœ€é‡è¦çš„ï¼š
å¾®æœåŠ¡è°ƒç”¨æœ‰é‡è¯•æœºåˆ¶
â†’ å³ä½¿çŸ­æš‚æ‹¿åˆ°è¿‡æœŸçš„æ³¨å†Œä¿¡æ¯
â†’ è°ƒç”¨å¤±è´¥åä¼šé‡è¯•å…¶ä»–å®ä¾‹
â†’ å½±å“å¾ˆå°
</code></pre>
<h3 data-id="heading-13">ä¸´æ—¶å®ä¾‹çš„å·¥ä½œåŸç†</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant S as æœåŠ¡å®ä¾‹
    participant N1 as NacosèŠ‚ç‚¹1
    participant N2 as NacosèŠ‚ç‚¹2
    participant N3 as NacosèŠ‚ç‚¹3
    participant C as è°ƒç”¨æ–¹
    
    Note over S,N1: 1. æœåŠ¡æ³¨å†Œ
    S-&gt;&gt;N1: æ³¨å†Œå®ä¾‹ä¿¡æ¯
    N1-&gt;&gt;N1: å†™å…¥æœ¬åœ°å†…å­˜(1-2ms)
    N1--&gt;&gt;S: æ³¨å†ŒæˆåŠŸ
    
    par å¼‚æ­¥åŒæ­¥
        N1-&gt;&gt;N2: å¼‚æ­¥åŒæ­¥å®ä¾‹ä¿¡æ¯
        N1-&gt;&gt;N3: å¼‚æ­¥åŒæ­¥å®ä¾‹ä¿¡æ¯
    end
    
    Note over S,N1: 2. å¿ƒè·³ä¿æ´»
    loop æ¯5ç§’
        S-&gt;&gt;N1: å‘é€å¿ƒè·³
        N1-&gt;&gt;N1: æ›´æ–°lastBeatæ—¶é—´
    end
    
    Note over S,N1: 3. å®ä¾‹ä¸‹çº¿
    S-&gt;&gt;S: è¿›ç¨‹å´©æºƒï¼Œåœæ­¢å¿ƒè·³
    
    Note over N1: 15ç§’å
    N1-&gt;&gt;N1: æ£€æµ‹åˆ°å¿ƒè·³è¶…æ—¶
    N1-&gt;&gt;N1: æ ‡è®°å®ä¾‹ä¸å¥åº·
    
    par å¼‚æ­¥é€šçŸ¥
        N1-&gt;&gt;N2: é€šçŸ¥å®ä¾‹ä¸‹çº¿
        N1-&gt;&gt;N3: é€šçŸ¥å®ä¾‹ä¸‹çº¿
    end
    
    Note over C: 4. è°ƒç”¨æ–¹æ‹‰å–
    C-&gt;&gt;N2: æŸ¥è¯¢æœåŠ¡åˆ—è¡¨
    N2--&gt;&gt;C: è¿”å›å¥åº·å®ä¾‹åˆ—è¡¨
</code></pre>
<h3 data-id="heading-14">ä¸´æ—¶å®ä¾‹çš„æ—¶é—´çº¿</h3>
<pre><code class="hljs language-r" lang="r"><span class="hljs-built_in">T</span> <span class="hljs-operator">+</span> <span class="hljs-number">0</span>ç§’ï¼šæœåŠ¡å¯åŠ¨ï¼Œæ³¨å†Œåˆ°Nacos
<span class="hljs-built_in">T</span> <span class="hljs-operator">+</span> <span class="hljs-number">5</span>ç§’ï¼šå‘é€ç¬¬ä¸€æ¬¡å¿ƒè·³
<span class="hljs-built_in">T</span> <span class="hljs-operator">+</span> <span class="hljs-number">10</span>ç§’ï¼šå‘é€ç¬¬äºŒæ¬¡å¿ƒè·³
<span class="hljs-built_in">T</span> <span class="hljs-operator">+</span> <span class="hljs-number">15</span>ç§’ï¼šæœåŠ¡å®•æœºï¼Œåœæ­¢å¿ƒè·³

<span class="hljs-built_in">T</span> <span class="hljs-operator">+</span> <span class="hljs-number">30</span>ç§’ï¼šNacosæ£€æµ‹åˆ°<span class="hljs-number">15</span>ç§’æ²¡å¿ƒè·³
         æ ‡è®°å®ä¾‹ä¸º<span class="hljs-string">"ä¸å¥åº·"</span>
         ä½†ä¸åˆ é™¤ï¼ˆç»™æ¢å¤çš„æœºä¼šï¼‰

<span class="hljs-built_in">T</span> <span class="hljs-operator">+</span> <span class="hljs-number">45</span>ç§’ï¼šNacosæ£€æµ‹åˆ°<span class="hljs-number">30</span>ç§’æ²¡å¿ƒè·³
         åˆ é™¤å®ä¾‹
         
å…³é”®æ—¶é—´ç‚¹ï¼š
<span class="hljs-operator">-</span> <span class="hljs-number">5</span>ç§’ï¼šå¿ƒè·³é—´éš”
<span class="hljs-operator">-</span> <span class="hljs-number">15</span>ç§’ï¼šæ ‡è®°ä¸å¥åº·çš„é˜ˆå€¼
<span class="hljs-operator">-</span> <span class="hljs-number">30</span>ç§’ï¼šåˆ é™¤å®ä¾‹çš„é˜ˆå€¼
</code></pre>
<h3 data-id="heading-15">ä¸ºä»€ä¹ˆå¾®æœåŠ¡é€‚åˆAPï¼Ÿ</h3>
<pre><code class="hljs language-markdown" lang="markdown">å¾®æœåŠ¡çš„ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">1.</span> å®ä¾‹é¢‘ç¹ä¸Šä¸‹çº¿
<span class="hljs-bullet">   -</span> å‘ç‰ˆã€é‡å¯ã€æ‰©ç¼©å®¹
<span class="hljs-bullet">   -</span> ä¸€å¤©å‡ åæ¬¡å¾ˆæ­£å¸¸

<span class="hljs-bullet">2.</span> è°ƒç”¨æœ‰å®¹é”™æœºåˆ¶
<span class="hljs-bullet">   -</span> é‡è¯•
<span class="hljs-bullet">   -</span> ç†”æ–­
<span class="hljs-bullet">   -</span> é™çº§

<span class="hljs-bullet">3.</span> çŸ­æš‚ä¸ä¸€è‡´å¯ä»¥æ¥å—
<span class="hljs-bullet">   -</span> æ‹¿åˆ°è¿‡æœŸçš„å®ä¾‹ä¿¡æ¯
<span class="hljs-bullet">   -</span> è°ƒç”¨å¤±è´¥é‡è¯•å°±è¡Œ
<span class="hljs-bullet">   -</span> 1-2ç§’åæ•°æ®å°±ä¸€è‡´äº†

æ‰€ä»¥ï¼š
<span class="hljs-bullet">-</span> é«˜å¯ç”¨ &gt; å¼ºä¸€è‡´
<span class="hljs-bullet">-</span> é€‰æ‹©APæ¨¡å¼
</code></pre>
<hr/>
<h2 data-id="heading-16">å››ã€é…ç½®ä¸­å¿ƒä¸ºä»€ä¹ˆé€‰CPï¼Ÿ</h2>
<p>é…ç½®å’ŒæœåŠ¡æ³¨å†Œå®Œå…¨ä¸åŒï¼Œé…ç½®é”™äº†æ˜¯è‡´å‘½çš„ã€‚</p>
<h3 data-id="heading-17">é…ç½®ä¸ä¸€è‡´çš„ç¾éš¾</h3>
<pre><code class="hljs language-diff" lang="diff">åœºæ™¯ï¼šæ•°æ®åº“è¿æ¥æ± é…ç½®

å¦‚æœä½¿ç”¨APæ¨¡å¼ï¼Œå¯èƒ½å‡ºç°ï¼š

NacosèŠ‚ç‚¹1çš„é…ç½®ï¼š
  datasource.url=jdbc:mysql://192.168.1.100:3306/db

NacosèŠ‚ç‚¹2çš„é…ç½®ï¼š
  datasource.url=jdbc:mysql://192.168.1.200:3306/db

ç»“æœï¼š
<span class="hljs-deletion">- éƒ¨ç½²åœ¨æ­å·æœºæˆ¿çš„åº”ç”¨å®ä¾‹</span>
  ä»NacosèŠ‚ç‚¹1æ‹‰å–é…ç½®
  è¿åˆ°æ•°æ®åº“Aï¼ˆ192.168.1.100ï¼‰

<span class="hljs-deletion">- éƒ¨ç½²åœ¨åŒ—äº¬æœºæˆ¿çš„åº”ç”¨å®ä¾‹</span>
  ä»NacosèŠ‚ç‚¹2æ‹‰å–é…ç½®
  è¿åˆ°æ•°æ®åº“Bï¼ˆ192.168.1.200ï¼‰

åæœï¼š
<span class="hljs-deletion">- åŒä¸€ä¸ªè®¢å•ï¼Œæ­å·çœ‹åˆ°çš„çŠ¶æ€æ˜¯"å¾…æ”¯ä»˜"</span>
<span class="hljs-deletion">- åŒ—äº¬çœ‹åˆ°çš„çŠ¶æ€æ˜¯"å·²æ”¯ä»˜"</span>
<span class="hljs-deletion">- æ•°æ®å®Œå…¨æ··ä¹±</span>
<span class="hljs-deletion">- ç³»ç»Ÿæ•…éšœ</span>

è¿™æ˜¯ä¸å¯æ¥å—çš„ï¼
</code></pre>
<h3 data-id="heading-18">CPæ¨¡å¼çš„é…ç½®å†™å…¥</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant C as å®¢æˆ·ç«¯
    participant L as Nacos Leader
    participant F1 as Nacos Follower1
    participant F2 as Nacos Follower2
    
    C-&gt;&gt;L: å‘å¸ƒé…ç½®
    Note over L: 1. å†™å…¥æœ¬åœ°æ—¥å¿—
    L-&gt;&gt;L: append log
    
    Note over L,F2: 2. å¹¶è¡Œå¤åˆ¶
    par å¤åˆ¶åˆ°æ‰€æœ‰Follower
        L-&gt;&gt;F1: å¤åˆ¶æ—¥å¿—
        L-&gt;&gt;F2: å¤åˆ¶æ—¥å¿—
    end
    
    F1-&gt;&gt;F1: å†™å…¥æ—¥å¿—
    F1--&gt;&gt;L: ç¡®è®¤
    
    F2-&gt;&gt;F2: å†™å…¥æ—¥å¿—
    F2--&gt;&gt;L: ç¡®è®¤
    
    Note over L: 3. è¿‡åŠç¡®è®¤ï¼Œæäº¤
    L-&gt;&gt;L: commit log
    
    Note over L: 4. åº”ç”¨åˆ°é…ç½®æ•°æ®
    L-&gt;&gt;L: apply to config store
    
    L--&gt;&gt;C: å‘å¸ƒæˆåŠŸ
    
    Note over L,F2: 5. æ¨é€é…ç½®å˜æ›´
    par é€šçŸ¥æ‰€æœ‰åº”ç”¨å®ä¾‹
        L-&gt;&gt;F1: æ¨é€æ–°é…ç½®
        L-&gt;&gt;F2: æ¨é€æ–°é…ç½®
    end
</code></pre>
<h3 data-id="heading-19">CPæ¨¡å¼çš„å¤„ç†æµç¨‹</h3>
<pre><code class="hljs language-markdown" lang="markdown">å†™é…ç½®çš„å®Œæ•´æµç¨‹ï¼š

<span class="hljs-bullet">1.</span> å®¢æˆ·ç«¯æäº¤é…ç½®å˜æ›´
   POST /nacos/v1/cs/configs
   dataId: application.yml
   content: server.port=8080

<span class="hljs-bullet">2.</span> Leaderæ”¶åˆ°è¯·æ±‚
<span class="hljs-bullet">   -</span> å†™å…¥æœ¬åœ°æ—¥å¿—æ–‡ä»¶
<span class="hljs-bullet">   -</span> åˆ†é…æ—¥å¿—ç´¢å¼•ï¼šindex=12345

<span class="hljs-bullet">3.</span> å¹¶è¡Œå¤åˆ¶ç»™Follower
<span class="hljs-bullet">   -</span> Leader â†’ Follower1
<span class="hljs-bullet">   -</span> Leader â†’ Follower2
<span class="hljs-bullet">   -</span> å¼‚æ­¥å‘é€ï¼Œä½†è¦ç­‰å“åº”

<span class="hljs-bullet">4.</span> ç­‰å¾…è¿‡åŠç¡®è®¤ï¼ˆé˜»å¡ï¼‰
<span class="hljs-bullet">   -</span> 3ä¸ªèŠ‚ç‚¹éœ€è¦2ä¸ªç¡®è®¤
<span class="hljs-bullet">   -</span> å¯èƒ½ç­‰50-100ms
<span class="hljs-bullet">   -</span> è¶…æ—¶5ç§’åå¤±è´¥

<span class="hljs-bullet">5.</span> è¿‡åŠç¡®è®¤åæäº¤
<span class="hljs-bullet">   -</span> æ ‡è®°æ—¥å¿—ä¸ºå·²æäº¤
<span class="hljs-bullet">   -</span> åº”ç”¨åˆ°é…ç½®æ•°æ®åº“

<span class="hljs-bullet">6.</span> è¿”å›å®¢æˆ·ç«¯æˆåŠŸ

<span class="hljs-bullet">7.</span> æ¨é€é…ç½®ç»™åº”ç”¨
<span class="hljs-bullet">   -</span> æ‰€æœ‰è®¢é˜…è¯¥é…ç½®çš„åº”ç”¨
<span class="hljs-bullet">   -</span> å®æ—¶æ”¶åˆ°å˜æ›´é€šçŸ¥
</code></pre>
<h3 data-id="heading-20">é…ç½®ä¸­å¿ƒçš„ç‰¹ç‚¹</h3>
<pre><code class="hljs language-markdown" lang="markdown">é…ç½®çš„ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">1.</span> å˜æ›´ä¸é¢‘ç¹
<span class="hljs-bullet">   -</span> ä¸€å¤©å¯èƒ½å°±æ”¹å‡ æ¬¡
<span class="hljs-bullet">   -</span> ä¸åƒæœåŠ¡å®ä¾‹ä¸€å¤©ä¸Šä¸‹çº¿å‡ åæ¬¡

<span class="hljs-bullet">2.</span> å¯ä»¥æ¥å—å†™å…¥æ…¢ä¸€ç‚¹
<span class="hljs-bullet">   -</span> 50-100mså¯ä»¥æ¥å—
<span class="hljs-bullet">   -</span> ä¸éœ€è¦åƒæ³¨å†Œé‚£æ ·æ¯«ç§’çº§

<span class="hljs-bullet">3.</span> ç»å¯¹ä¸èƒ½ä¸ä¸€è‡´
<span class="hljs-bullet">   -</span> å®å¯å†™å…¥å¤±è´¥ï¼ˆ503é”™è¯¯ï¼‰
<span class="hljs-bullet">   -</span> ä¹Ÿä¸èƒ½ä¸åŒèŠ‚ç‚¹é…ç½®ä¸ä¸€æ ·

<span class="hljs-bullet">4.</span> éœ€è¦å¯é æ€§
<span class="hljs-bullet">   -</span> é…ç½®è¦æŒä¹…åŒ–
<span class="hljs-bullet">   -</span> é‡å¯ä¸èƒ½ä¸¢
<span class="hljs-bullet">   -</span> å†å²å¯è¿½æº¯

æ‰€ä»¥ï¼š
<span class="hljs-bullet">-</span> å¼ºä¸€è‡´ &gt; é«˜å¯ç”¨
<span class="hljs-bullet">-</span> é€‰æ‹©CPæ¨¡å¼
</code></pre>
<hr/>
<h2 data-id="heading-21">äº”ã€Raftåè®®5åˆ†é’Ÿè®²æ¸…æ¥š</h2>
<p>Nacosçš„é…ç½®ä¸­å¿ƒç”¨çš„æ˜¯Raftåè®®ã€‚ç†è§£Raftæ˜¯ç†è§£Nacosçš„åŸºç¡€ã€‚</p>
<h3 data-id="heading-22">Raftçš„æ ¸å¿ƒæ€æƒ³</h3>
<p>ç”¨ä¸€å¥è¯æ€»ç»“ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">é€šè¿‡<span class="hljs-string">"è¿‡åŠç¡®è®¤"</span>ï¼Œä¿è¯æ‰€æœ‰èŠ‚ç‚¹æŒ‰ç›¸åŒé¡ºåºæ‰§è¡Œç›¸åŒæ“ä½œ
</code></pre>
<p>è¿™å¥è¯æœ‰ä¸‰ä¸ªå…³é”®è¯ï¼š</p>
<ul>
<li>è¿‡åŠç¡®è®¤ï¼šå¤šæ•°æ´¾åŸåˆ™</li>
<li>ç›¸åŒé¡ºåºï¼šæ—¥å¿—ç´¢å¼•ä¿è¯</li>
<li>ç›¸åŒæ“ä½œï¼šæ—¥å¿—å†…å®¹ä¸€è‡´</li>
</ul>
<h3 data-id="heading-23">Raftçš„ä¸‰å¤§æœºåˆ¶</h3>
<h4 data-id="heading-24">1. Leaderé€‰ä¸¾</h4>
<pre><code class="hljs language-diff" lang="diff">Rafté›†ç¾¤ä¸­ä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªLeader

Leaderçš„èŒè´£ï¼š
<span class="hljs-deletion">- æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚</span>
<span class="hljs-deletion">- è´Ÿè´£æ—¥å¿—å¤åˆ¶</span>
<span class="hljs-deletion">- å†³å®šä½•æ—¶æäº¤</span>

é€‰ä¸¾è§„åˆ™ï¼š
<span class="hljs-deletion">- æ—¥å¿—æœ€æ–°çš„èŠ‚ç‚¹ä¼˜å…ˆå½“é€‰</span>
<span class="hljs-deletion">- å¿…é¡»è·å¾—è¿‡åŠé€‰ç¥¨</span>
<span class="hljs-deletion">- é€šè¿‡Termï¼ˆä»»æœŸå·ï¼‰åŒºåˆ†æ–°è€Leader</span>

ä¸ºä»€ä¹ˆæ—¥å¿—è¦æœ€æ–°ï¼Ÿ
â†’ ä¿è¯æ–°Leaderä¸€å®šæœ‰æ‰€æœ‰å·²æäº¤çš„æ•°æ®
â†’ å¦åˆ™å·²æäº¤çš„æ•°æ®å¯èƒ½ä¸¢å¤±
</code></pre>
<p>é€‰ä¸¾è¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[Followeræ£€æµ‹å¿ƒè·³è¶…æ—¶] --&gt; B[è½¬ä¸ºCandidate]
    B --&gt; C[Term+1]
    C --&gt; D[ç»™è‡ªå·±æŠ•ç¥¨]
    D --&gt; E[å‘å…¶ä»–èŠ‚ç‚¹è¯·æ±‚æŠ•ç¥¨]
    
    E --&gt; F{æ”¶åˆ°è¿‡åŠé€‰ç¥¨?}
    F --&gt;|æ˜¯| G[æˆä¸ºLeader]
    F --&gt;|å¦| H[ç»§ç»­ç­‰å¾…æˆ–é‡æ–°é€‰ä¸¾]
    
    G --&gt; I[å‘é€å¿ƒè·³ç»´æŒåœ°ä½]
    
    E --&gt; J{æ”¶åˆ°æ›´é«˜Termçš„æ¶ˆæ¯?}
    J --&gt;|æ˜¯| K[è½¬å›Follower]
</code></pre>
<h4 data-id="heading-25">2. æ—¥å¿—å¤åˆ¶</h4>
<p>Leaderæ”¶åˆ°å†™è¯·æ±‚åï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> å†™å…¥æœ¬åœ°æ—¥å¿—
   LogEntry {
<span class="hljs-code">       index: 100      // æ—¥å¿—ä½ç½®
       term: 5         // ä»»æœŸå·
       command: "PUT name=alice"  // å…·ä½“æ“ä½œ
   }
</span>
<span class="hljs-bullet">2.</span> å¹¶è¡Œå¤åˆ¶ç»™Follower
<span class="hljs-bullet">   -</span> Leaderå‘é€AppendEntries RPC
<span class="hljs-bullet">   -</span> æºå¸¦æ—¥å¿—å†…å®¹

<span class="hljs-bullet">3.</span> ç­‰å¾…è¿‡åŠç¡®è®¤
<span class="hljs-bullet">   -</span> 3èŠ‚ç‚¹éœ€è¦2ä¸ªç¡®è®¤
<span class="hljs-bullet">   -</span> 5èŠ‚ç‚¹éœ€è¦3ä¸ªç¡®è®¤

<span class="hljs-bullet">4.</span> è¿‡åŠåæäº¤
<span class="hljs-bullet">   -</span> æ ‡è®°æ—¥å¿—ä¸ºå·²æäº¤
<span class="hljs-bullet">   -</span> åº”ç”¨åˆ°çŠ¶æ€æœº

<span class="hljs-bullet">5.</span> è¿”å›å®¢æˆ·ç«¯æˆåŠŸ
</code></pre>
<p>å…³é”®çš„ä¸€è‡´æ€§æ£€æŸ¥ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Leaderå‘é€æ—¥å¿—æ—¶ï¼Œä¼šå¸¦ä¸Š"å‰ä¸€æ¡æ—¥å¿—"çš„ä¿¡æ¯ï¼š</span>

<span class="hljs-string">AppendEntriesRequest</span> {
    <span class="hljs-attr">prevLogIndex:</span> <span class="hljs-number">99</span>
    <span class="hljs-attr">prevLogTerm:</span> <span class="hljs-number">5</span>
    <span class="hljs-attr">entries:</span> [
        {<span class="hljs-attr">index:</span> <span class="hljs-number">100</span>, <span class="hljs-attr">term:</span> <span class="hljs-number">5</span>, <span class="hljs-attr">command:</span> <span class="hljs-string">"..."</span>}
    ]
}

<span class="hljs-string">Followeræ”¶åˆ°åï¼š</span>
<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">æ£€æŸ¥æœ¬åœ°æ—¥å¿—[99]</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">å¦‚æœtermä¹Ÿæ˜¯5</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ¥å—ï¼Œè¿½åŠ æ—¥å¿—[100]</span>
<span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">å¦‚æœtermä¸æ˜¯5</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ‹’ç»ï¼Œè¯´æ˜æ—¥å¿—å†²çª</span>

<span class="hljs-string">ä¸ºä»€ä¹ˆè¿™æ ·æ£€æŸ¥ï¼Ÿ</span>
<span class="hljs-string">â†’</span> <span class="hljs-string">é€’å½’ä¿è¯ï¼šå¦‚æœ99ä¸€è‡´ï¼Œè¯´æ˜1-98éƒ½ä¸€è‡´</span>
<span class="hljs-string">â†’</span> <span class="hljs-string">å¦‚æœ100ä¸€è‡´ï¼Œè¯´æ˜1-99éƒ½ä¸€è‡´</span>
<span class="hljs-string">â†’</span> <span class="hljs-string">ä¿è¯æ•´ä¸ªæ—¥å¿—åºåˆ—ä¸€è‡´</span>
</code></pre>
<h4 data-id="heading-26">3. Termæœºåˆ¶</h4>
<pre><code class="hljs language-ini" lang="ini">Termï¼ˆä»»æœŸï¼‰æ˜¯Raftçš„é€»è¾‘æ—¶é’Ÿ

ä½œç”¨1ï¼šåŒºåˆ†æ–°è€Leader
  æ—§Leader: <span class="hljs-attr">term</span>=<span class="hljs-number">5</span>
  æ–°Leader: <span class="hljs-attr">term</span>=<span class="hljs-number">6</span>
  æ—§Leaderçœ‹åˆ°<span class="hljs-attr">term</span>=<span class="hljs-number">6</span> â†’ è‡ªåŠ¨é™çº§ä¸ºFollower

ä½œç”¨2ï¼šé˜²æ­¢è„‘è£‚
  ä¸¤ä¸ªCandidateåŒæ—¶é€‰ä¸¾
  â†’ termé«˜çš„ä¼šèµ¢
  â†’ termä½çš„ä¼šå¤±è´¥

ä½œç”¨3ï¼šæ‹’ç»è¿‡æœŸè¯·æ±‚
  æ”¶åˆ°<span class="hljs-attr">term</span>=<span class="hljs-number">5</span>çš„è¯·æ±‚
  å½“å‰<span class="hljs-attr">term</span>=<span class="hljs-number">6</span>
  â†’ ç›´æ¥æ‹’ç»

è§„åˆ™ï¼š
- æ¯æ¬¡é€‰ä¸¾term+1
- æ”¶åˆ°æ›´é«˜termçš„æ¶ˆæ¯ â†’ ç«‹å³æ›´æ–°è‡ªå·±çš„term
- æ‹’ç»å¤„ç†æ›´ä½termçš„è¯·æ±‚
</code></pre>
<h3 data-id="heading-27">è¿‡åŠç¡®è®¤çš„æ•°å­¦</h3>
<pre><code class="hljs language-diff" lang="diff">ä¸ºä»€ä¹ˆè¦è¿‡åŠï¼Ÿ

3èŠ‚ç‚¹é›†ç¾¤ï¼š
<span class="hljs-deletion">- éœ€è¦2ä¸ªèŠ‚ç‚¹ç¡®è®¤ï¼ˆåŒ…æ‹¬Leaderè‡ªå·±ï¼‰</span>
<span class="hljs-deletion">- å®¹å¿1ä¸ªèŠ‚ç‚¹æ•…éšœ</span>

5èŠ‚ç‚¹é›†ç¾¤ï¼š
<span class="hljs-deletion">- éœ€è¦3ä¸ªèŠ‚ç‚¹ç¡®è®¤</span>
<span class="hljs-deletion">- å®¹å¿2ä¸ªèŠ‚ç‚¹æ•…éšœ</span>

NèŠ‚ç‚¹é›†ç¾¤ï¼š
<span class="hljs-deletion">- éœ€è¦(N/2 + 1)ä¸ªèŠ‚ç‚¹ç¡®è®¤</span>
<span class="hljs-deletion">- å®¹å¿(N-1)/2ä¸ªèŠ‚ç‚¹æ•…éšœ</span>

ä¸ºä»€ä¹ˆä¸æ˜¯å…¨éƒ¨ç¡®è®¤ï¼Ÿ
â†’ ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æ•…éšœå°±ä¸å¯ç”¨äº†

ä¸ºä»€ä¹ˆä¸æ˜¯1/3ç¡®è®¤ï¼Ÿ
â†’ å¯èƒ½å‡ºç°æ•°æ®ä¸ä¸€è‡´

è¿‡åŠæ˜¯æœ€ä¼˜è§£ï¼š
â†’ å®¹é”™èƒ½åŠ›å’Œä¸€è‡´æ€§çš„å¹³è¡¡ç‚¹
</code></pre>
<h3 data-id="heading-28">Raftä¿è¯çš„å®‰å…¨æ€§</h3>
<pre><code class="hljs language-markdown" lang="markdown">æ ¸å¿ƒä¿è¯ï¼šå·²æäº¤çš„æ•°æ®æ°¸ä¸ä¸¢å¤±

æ€ä¹ˆä¿è¯ï¼Ÿ

<span class="hljs-bullet">1.</span> é€‰ä¸¾é™åˆ¶
<span class="hljs-bullet">   -</span> åªæœ‰æ—¥å¿—æœ€æ–°çš„èŠ‚ç‚¹æ‰èƒ½å½“é€‰
<span class="hljs-bullet">   -</span> æ–°Leaderä¸€å®šæœ‰æ‰€æœ‰å·²æäº¤çš„æ•°æ®

<span class="hljs-bullet">2.</span> æäº¤è§„åˆ™
<span class="hljs-bullet">   -</span> åªèƒ½æäº¤å½“å‰termçš„æ—¥å¿—
<span class="hljs-bullet">   -</span> æ—§termçš„æ—¥å¿—é€šè¿‡æ–°æ—¥å¿—é—´æ¥æäº¤
   
<span class="hljs-bullet">3.</span> æ—¥å¿—åŒ¹é…
<span class="hljs-bullet">   -</span> é€šè¿‡prevLogIndex/prevLogTermæ£€æŸ¥
<span class="hljs-bullet">   -</span> å‘ç°å†²çªå°±åˆ é™¤é‡å»º

ç»“æœï¼š
<span class="hljs-bullet">-</span> æ‰€æœ‰èŠ‚ç‚¹æœ€ç»ˆæ—¥å¿—å®Œå…¨ä¸€è‡´
<span class="hljs-bullet">-</span> å·²æäº¤çš„æ•°æ®åœ¨ä»»ä½•èŠ‚ç‚¹éƒ½èƒ½è¯»åˆ°
<span class="hljs-bullet">-</span> å³ä½¿å‘ç”ŸLeaderåˆ‡æ¢ä¹Ÿä¸ä¼šä¸¢æ•°æ®
</code></pre>
<hr/>
<h2 data-id="heading-29">å…­ã€Nacosçš„åŒæ¨¡å¼å¯¹æ¯”</h2>
<p>ç°åœ¨æˆ‘ä»¬ç†è§£äº†APå’ŒCPï¼Œä¹Ÿç†è§£äº†Raftï¼Œæ¥çœ‹çœ‹Nacosçš„ä¸¤ç§æ¨¡å¼ã€‚</p>
<h3 data-id="heading-30">ä¸´æ—¶å®ä¾‹ vs æŒä¹…åŒ–å®ä¾‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ³¨å†Œä¸´æ—¶å®ä¾‹ï¼ˆé»˜è®¤ï¼‰</span>
<span class="hljs-type">Instance</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Instance</span>();
instance.setIp(<span class="hljs-string">"192.168.1.100"</span>);
instance.setPort(<span class="hljs-number">8080</span>);
instance.setEphemeral(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// ä¸´æ—¶å®ä¾‹</span>
namingService.registerInstance(<span class="hljs-string">"user-service"</span>, instance);

<span class="hljs-comment">// æ³¨å†ŒæŒä¹…åŒ–å®ä¾‹</span>
<span class="hljs-type">Instance</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Instance</span>();
instance.setIp(<span class="hljs-string">"192.168.1.100"</span>);
instance.setPort(<span class="hljs-number">3306</span>);
instance.setEphemeral(<span class="hljs-literal">false</span>);  <span class="hljs-comment">// æŒä¹…åŒ–å®ä¾‹</span>
namingService.registerInstance(<span class="hljs-string">"mysql-service"</span>, instance);
</code></pre>
<h3 data-id="heading-31">è¯¦ç»†å¯¹æ¯”</h3>























































<table><thead><tr><th>ç»´åº¦</th><th>ä¸´æ—¶å®ä¾‹ï¼ˆAPï¼‰</th><th>æŒä¹…åŒ–å®ä¾‹ï¼ˆCPï¼‰</th></tr></thead><tbody><tr><td><strong>åè®®</strong></td><td>Distro</td><td>Raft</td></tr><tr><td><strong>å†™å…¥é€Ÿåº¦</strong></td><td>1-2ms</td><td>50-100ms</td></tr><tr><td><strong>ä¸€è‡´æ€§</strong></td><td>æœ€ç»ˆä¸€è‡´ï¼ˆ1-2ç§’ï¼‰</td><td>å¼ºä¸€è‡´ï¼ˆå®æ—¶ï¼‰</td></tr><tr><td><strong>ä¿æ´»æ–¹å¼</strong></td><td>å®¢æˆ·ç«¯å‘å¿ƒè·³</td><td>Serverä¸»åŠ¨æ£€æŸ¥</td></tr><tr><td><strong>å®ä¾‹ä¸‹çº¿</strong></td><td>å¿ƒè·³åœæ­¢è‡ªåŠ¨åˆ é™¤</td><td>éœ€è¦æ˜¾å¼åˆ é™¤</td></tr><tr><td><strong>æ•°æ®æŒä¹…åŒ–</strong></td><td>å¦ï¼Œé‡å¯ä¸¢å¤±</td><td>æ˜¯ï¼ŒæŒä¹…åŒ–åˆ°ç£ç›˜</td></tr><tr><td><strong>ç½‘ç»œåˆ†åŒº</strong></td><td>å„è‡ªç»§ç»­æœåŠ¡</td><td>å°‘æ•°æ´¾ä¸å¯ç”¨</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å¾®æœåŠ¡å®ä¾‹</td><td>æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—</td></tr><tr><td><strong>ä½¿ç”¨å æ¯”</strong></td><td>99%</td><td>1%</td></tr></tbody></table>
<h3 data-id="heading-32">ä»€ä¹ˆæ—¶å€™ç”¨æŒä¹…åŒ–å®ä¾‹ï¼Ÿ</h3>
<pre><code class="hljs language-markdown" lang="markdown">é€‚åˆæŒä¹…åŒ–å®ä¾‹çš„åœºæ™¯ï¼š

<span class="hljs-bullet">1.</span> æ•°æ®åº“å®ä¾‹
<span class="hljs-bullet">   -</span> MySQLã€PostgreSQLã€Redis
<span class="hljs-bullet">   -</span> å®ä¾‹ä¸ä¼šé¢‘ç¹ä¸Šä¸‹çº¿
<span class="hljs-bullet">   -</span> éœ€è¦å‡†ç¡®çš„å¥åº·æ£€æŸ¥
<span class="hljs-bullet">   -</span> åœ°å€ä¿¡æ¯å¿…é¡»å‡†ç¡®

<span class="hljs-bullet">2.</span> æ¶ˆæ¯é˜Ÿåˆ—
<span class="hljs-bullet">   -</span> RocketMQã€Kafka
<span class="hljs-bullet">   -</span> Brokeråœ°å€ä¸èƒ½é”™
<span class="hljs-bullet">   -</span> éœ€è¦æŒä¹…åŒ–ä¿å­˜

<span class="hljs-bullet">3.</span> å…¶ä»–åŸºç¡€è®¾æ–½
<span class="hljs-bullet">   -</span> Elasticsearché›†ç¾¤
<span class="hljs-bullet">   -</span> é…ç½®ä¸­å¿ƒæœ¬èº«
   
ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">-</span> å®ä¾‹ç¨³å®šï¼Œå¾ˆå°‘å˜åŒ–
<span class="hljs-bullet">-</span> åœ°å€ä¿¡æ¯å¿…é¡»å‡†ç¡®
<span class="hljs-bullet">-</span> é‡å¯åä»éœ€è¦ä¿ç•™æ³¨å†Œä¿¡æ¯
</code></pre>

<pre><code class="hljs language-markdown" lang="markdown">ä¸é€‚åˆæŒä¹…åŒ–å®ä¾‹çš„åœºæ™¯ï¼š

<span class="hljs-bullet">1.</span> æ™®é€šå¾®æœåŠ¡
<span class="hljs-bullet">   -</span> Spring Bootåº”ç”¨
<span class="hljs-bullet">   -</span> é¢‘ç¹å‘ç‰ˆé‡å¯
<span class="hljs-bullet">   -</span> å®ä¾‹åŠ¨æ€æ‰©ç¼©å®¹
   
<span class="hljs-bullet">2.</span> çŸ­ç”Ÿå‘½å‘¨æœŸåº”ç”¨
<span class="hljs-bullet">   -</span> Kubernetes Pod
<span class="hljs-bullet">   -</span> Serverlesså‡½æ•°
<span class="hljs-bullet">   -</span> ä¸´æ—¶ä»»åŠ¡

ç‰¹ç‚¹ï¼š
<span class="hljs-bullet">-</span> å®ä¾‹é¢‘ç¹ä¸Šä¸‹çº¿
<span class="hljs-bullet">-</span> å…è®¸çŸ­æš‚ä¸ä¸€è‡´
<span class="hljs-bullet">-</span> è°ƒç”¨æ–¹æœ‰é‡è¯•æœºåˆ¶
</code></pre>
<h3 data-id="heading-33">å®é™…ä½¿ç”¨å»ºè®®</h3>
<pre><code class="hljs language-diff" lang="diff">ç»éªŒæ³•åˆ™ï¼š

é»˜è®¤ç”¨ä¸´æ—¶å®ä¾‹
<span class="hljs-deletion">- 99%çš„å¾®æœåŠ¡åœºæ™¯</span>
<span class="hljs-deletion">- é™¤éæœ‰ç‰¹æ®Šéœ€æ±‚</span>

åªåœ¨è¿™äº›æƒ…å†µç”¨æŒä¹…åŒ–å®ä¾‹ï¼š
<span class="hljs-deletion">- æ•°æ®åº“ã€ç¼“å­˜ã€MQç­‰åŸºç¡€è®¾æ–½</span>
<span class="hljs-deletion">- å®ä¾‹åœ°å€å‡ ä¹ä¸å˜</span>
<span class="hljs-deletion">- éœ€è¦å‡†ç¡®çš„å¥åº·æ£€æŸ¥</span>
<span class="hljs-deletion">- å¿…é¡»ä¿è¯æ•°æ®å¼ºä¸€è‡´</span>

å¦‚æœä¸ç¡®å®šç”¨å“ªä¸ªï¼š
â†’ ç”¨ä¸´æ—¶å®ä¾‹å°±å¯¹äº†
</code></pre>
<hr/>
<h2 data-id="heading-34">ä¸ƒã€å¸¸è§é¢è¯•é—®é¢˜</h2>
<h3 data-id="heading-35">Q1ï¼šä¸ºä»€ä¹ˆNacosä¸å…¨ç”¨Raftï¼Ÿ</h3>
<pre><code class="hljs language-markdown" lang="markdown">å¦‚æœæœåŠ¡æ³¨å†Œä¹Ÿç”¨Raftï¼š

ç¼ºç‚¹ï¼š
<span class="hljs-bullet">1.</span> å†™å…¥æ…¢
<span class="hljs-bullet">   -</span> æ¯æ¬¡æ³¨å†Œ/å¿ƒè·³éƒ½è¦è¿‡åŠç¡®è®¤
<span class="hljs-bullet">   -</span> åŸæ¥1-2msï¼Œç°åœ¨50-100ms

<span class="hljs-bullet">2.</span> å¯ç”¨æ€§å·®
<span class="hljs-bullet">   -</span> Nacosé›†ç¾¤ç½‘ç»œåˆ†åŒºæ—¶å¯èƒ½ä¸å¯ç”¨
<span class="hljs-bullet">   -</span> å½±å“æ‰€æœ‰å¾®æœåŠ¡

<span class="hljs-bullet">3.</span> ååé‡ä½
<span class="hljs-bullet">   -</span> Leaderæˆä¸ºç“¶é¢ˆ
<span class="hljs-bullet">   -</span> æ— æ³•æ”¯æ’‘å¤§è§„æ¨¡é›†ç¾¤

ä¼˜ç‚¹ï¼š
<span class="hljs-bullet">1.</span> å¼ºä¸€è‡´æ€§
<span class="hljs-bullet">   -</span> æ‰€æœ‰èŠ‚ç‚¹æ•°æ®å®Œå…¨ä¸€è‡´

æƒè¡¡ï¼š
<span class="hljs-bullet">-</span> å¾®æœåŠ¡æ³¨å†Œï¼šä¸éœ€è¦å¼ºä¸€è‡´ï¼Œéœ€è¦é«˜å¯ç”¨ â†’ AP
<span class="hljs-bullet">-</span> é…ç½®ä¸­å¿ƒï¼šå¿…é¡»å¼ºä¸€è‡´ï¼Œå¯ä»¥ç‰ºç‰²éƒ¨åˆ†å¯ç”¨ â†’ CP
</code></pre>
<h3 data-id="heading-36">Q2ï¼šå¦‚æœè¿‡åŠèŠ‚ç‚¹éƒ½å®•æœºäº†æ€ä¹ˆåŠï¼Ÿ</h3>
<pre><code class="hljs language-markdown" lang="markdown">åœºæ™¯ï¼š3èŠ‚ç‚¹é›†ç¾¤ï¼Œ2ä¸ªèŠ‚ç‚¹å®•æœº

Raftçš„å¤„ç†ï¼š
<span class="hljs-bullet">-</span> æ‹’ç»æ‰€æœ‰å†™å…¥ï¼ˆæ— æ³•è¾¾æˆå…±è¯†ï¼‰
<span class="hljs-bullet">-</span> å·²æœ‰çš„é…ç½®å¯ä»¥è¯»å–
<span class="hljs-bullet">-</span> ç­‰å¾…èŠ‚ç‚¹æ¢å¤

ä¸´æ—¶æ–¹æ¡ˆï¼š
<span class="hljs-bullet">1.</span> ç´§æ€¥æ‰©å®¹
<span class="hljs-bullet">   -</span> å¿«é€Ÿå¯åŠ¨æ–°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤
<span class="hljs-bullet">   -</span> ç­‰æ–°èŠ‚ç‚¹è¿½ä¸Šæ•°æ®

<span class="hljs-bullet">2.</span> é™çº§åˆ°å•èŠ‚ç‚¹æ¨¡å¼
<span class="hljs-bullet">   -</span> ä»…ç´§æ€¥æƒ…å†µ
<span class="hljs-bullet">   -</span> æœ‰æ•°æ®ä¸¢å¤±é£é™©
<span class="hljs-bullet">   -</span> éœ€è¦ä¸“ä¸šäººå‘˜æ“ä½œ

é¢„é˜²æªæ–½ï¼š
<span class="hljs-bullet">-</span> éƒ¨ç½²5èŠ‚ç‚¹ï¼ˆå®¹å¿2ä¸ªæ•…éšœï¼‰
<span class="hljs-bullet">-</span> è·¨æœºæˆ¿éƒ¨ç½²
<span class="hljs-bullet">-</span> åšå¥½ç›‘æ§å‘Šè­¦
<span class="hljs-bullet">-</span> å¤‡ä»½é…ç½®æ•°æ®
</code></pre>
<h3 data-id="heading-37">Q3ï¼šDistroåè®®å’ŒRaftåè®®çš„æœ¬è´¨åŒºåˆ«ï¼Ÿ</h3>
<pre><code class="hljs language-markdown" lang="markdown">Distroï¼ˆAPï¼‰ï¼š
<span class="hljs-bullet">-</span> è®¾è®¡ç›®æ ‡ï¼šé«˜å¯ç”¨
<span class="hljs-bullet">-</span> å†™å…¥æ–¹å¼ï¼šç›´æ¥å†™æœ¬åœ°ï¼Œå¼‚æ­¥åŒæ­¥
<span class="hljs-bullet">-</span> æ•°æ®ä¸€è‡´ï¼šæœ€ç»ˆä¸€è‡´ï¼Œå…è®¸çŸ­æš‚ä¸ä¸€è‡´
<span class="hljs-bullet">-</span> æ•…éšœå¤„ç†ï¼šå„è‡ªç‹¬ç«‹æœåŠ¡
<span class="hljs-bullet">-</span> æ€§èƒ½ï¼šæå¿«ï¼ˆ1-2msï¼‰

Raftï¼ˆCPï¼‰ï¼š
<span class="hljs-bullet">-</span> è®¾è®¡ç›®æ ‡ï¼šå¼ºä¸€è‡´
<span class="hljs-bullet">-</span> å†™å…¥æ–¹å¼ï¼šLeaderå¤åˆ¶ï¼Œç­‰è¿‡åŠç¡®è®¤
<span class="hljs-bullet">-</span> æ•°æ®ä¸€è‡´ï¼šå¼ºä¸€è‡´ï¼Œä»»ä½•æ—¶å€™éƒ½ä¸€è‡´
<span class="hljs-bullet">-</span> æ•…éšœå¤„ç†ï¼šå°‘æ•°æ´¾æ‹’ç»æœåŠ¡
<span class="hljs-bullet">-</span> æ€§èƒ½ï¼šè¾ƒæ…¢ï¼ˆ50-100msï¼‰

é€‰æ‹©ä¾æ®ï¼š
<span class="hljs-bullet">-</span> æ•°æ®èƒ½å®¹å¿çŸ­æš‚ä¸ä¸€è‡´å—ï¼Ÿ
<span class="hljs-bullet">  -</span> èƒ½ â†’ Distro
<span class="hljs-bullet">  -</span> ä¸èƒ½ â†’ Raft
</code></pre>
<h3 data-id="heading-38">Q4ï¼šä¸ºä»€ä¹ˆå¿ƒè·³è¶…æ—¶æ˜¯15ç§’ï¼Ÿ</h3>
<pre><code class="hljs language-diff" lang="diff">Nacosä¸´æ—¶å®ä¾‹çš„æ—¶é—´å‚æ•°ï¼š

å¿ƒè·³é—´éš”ï¼š5ç§’
ä¸å¥åº·é˜ˆå€¼ï¼š15ç§’ï¼ˆ3æ¬¡å¿ƒè·³ï¼‰
åˆ é™¤é˜ˆå€¼ï¼š30ç§’ï¼ˆ6æ¬¡å¿ƒè·³ï¼‰

è®¾è®¡è€ƒè™‘ï¼š

15ç§’ä¸å¥åº·ï¼š
<span class="hljs-deletion">- å¤ªçŸ­ï¼ˆå¦‚5ç§’ï¼‰â†’ ç½‘ç»œæŠ–åŠ¨å°±è¯¯åˆ¤</span>
<span class="hljs-deletion">- å¤ªé•¿ï¼ˆå¦‚60ç§’ï¼‰â†’ æ•…éšœå‘ç°å¤ªæ…¢</span>
<span class="hljs-deletion">- 15ç§’æ˜¯å¹³è¡¡ç‚¹</span>

30ç§’åˆ é™¤ï¼š
<span class="hljs-deletion">- ç»™å®ä¾‹æ¢å¤çš„æ—¶é—´</span>
<span class="hljs-deletion">- é˜²æ­¢çŸ­æš‚é‡å¯è¢«åˆ é™¤</span>

å®é™…ç”Ÿäº§å¯è°ƒæ•´ï¼š
spring.cloud.nacos.discovery:
  heart-beat-interval: 5000
  heart-beat-timeout: 15000
  ip-delete-timeout: 30000
</code></pre>
<h3 data-id="heading-39">Q5ï¼šLeaderå®•æœºåéœ€è¦å¤šä¹…é€‰å‡ºæ–°Leaderï¼Ÿ</h3>
<pre><code class="hljs language-markdown" lang="markdown">Rafté€‰ä¸¾æ—¶é—´çº¿ï¼š

T+0ç§’ï¼šLeaderå®•æœºï¼Œåœæ­¢å‘é€å¿ƒè·³

T+5ç§’ï¼šæŸä¸ªFollowerå¿ƒè·³è¶…æ—¶
<span class="hljs-code">      è½¬ä¸ºCandidateï¼Œå‘èµ·é€‰ä¸¾
      Termä»5å˜ä¸º6
</span>
T+5.1ç§’ï¼šå…¶ä»–Followeræ”¶åˆ°æŠ•ç¥¨è¯·æ±‚
<span class="hljs-code">        æ£€æŸ¥Candidateçš„æ—¥å¿—æ˜¯å¦æœ€æ–°
        å¦‚æœæ˜¯ï¼ŒæŠ•ç¥¨ç»™å®ƒ
</span>
T+5.2ç§’ï¼šCandidateæ”¶åˆ°è¿‡åŠé€‰ç¥¨
<span class="hljs-code">        æˆä¸ºæ–°Leader
        å¼€å§‹å‘é€å¿ƒè·³
</span>
T+5.3ç§’ï¼šå…¶ä»–Followeræ”¶åˆ°æ–°Leaderçš„å¿ƒè·³
<span class="hljs-code">        ç¡®è®¤æ–°Leader
</span>
æ€»è€—æ—¶ï¼šçº¦5ç§’

å®é™…å¯èƒ½æ›´å¿«ï¼š
<span class="hljs-bullet">-</span> ç½‘ç»œå¥½çš„æƒ…å†µä¸‹1-2ç§’
<span class="hljs-bullet">-</span> å¯ä»¥è°ƒå°election<span class="hljs-emphasis">_timeoutåŠ é€Ÿ
</span></code></pre>
<h3 data-id="heading-40">Q6ï¼šé…ç½®ä¸­å¿ƒçš„å†™å…¥æ€§èƒ½å¦‚ä½•ï¼Ÿ</h3>
<pre><code class="hljs language-markdown" lang="markdown">æ€§èƒ½æ•°æ®ï¼ˆ3èŠ‚ç‚¹é›†ç¾¤ï¼‰ï¼š

å†™å…¥å»¶è¿Ÿï¼š
<span class="hljs-bullet">-</span> P50: 20-50ms
<span class="hljs-bullet">-</span> P99: 100-200ms
<span class="hljs-bullet">-</span> P999: 500ms

ååé‡ï¼š
<span class="hljs-bullet">-</span> å•Leaderï¼š500-1000 QPS
<span class="hljs-bullet">-</span> å¯¹äºé…ç½®ä¸­å¿ƒè¶³å¤Ÿäº†
  ï¼ˆé…ç½®å˜æ›´é¢‘ç‡å¾ˆä½ï¼‰

æ€§èƒ½ç“¶é¢ˆï¼š
<span class="hljs-bullet">1.</span> Leaderå•ç‚¹
<span class="hljs-bullet">   -</span> æ‰€æœ‰å†™å…¥èµ°Leader
<span class="hljs-bullet">2.</span> ç£ç›˜IO
<span class="hljs-bullet">   -</span> æ¯æ¬¡å†™å…¥è¦fsync
<span class="hljs-bullet">3.</span> ç½‘ç»œå»¶è¿Ÿ
<span class="hljs-bullet">   -</span> éœ€è¦ç­‰Followerå“åº”

ä¼˜åŒ–æ–¹å‘ï¼š
<span class="hljs-bullet">-</span> æ‰¹é‡å†™å…¥
<span class="hljs-bullet">-</span> å¼‚æ­¥åˆ·ç›˜
<span class="hljs-bullet">-</span> SSDç¡¬ç›˜
</code></pre>
<hr/>
<h2 data-id="heading-41">å…«ã€æ€»ç»“</h2>
<h3 data-id="heading-42">æ ¸å¿ƒè¦ç‚¹</h3>
<p><strong>1. Nacosæ˜¯APè¿˜æ˜¯CPï¼Ÿ</strong></p>
<pre><code class="hljs language-diff" lang="diff">ä¸æ˜¯äºŒé€‰ä¸€ï¼Œè€Œæ˜¯é’ˆå¯¹ä¸åŒåœºæ™¯ï¼š

æœåŠ¡æ³¨å†Œï¼ˆä¸´æ—¶å®ä¾‹ï¼‰ï¼šAP
<span class="hljs-deletion">- Distroåè®®</span>
<span class="hljs-deletion">- é«˜å¯ç”¨ä¼˜å…ˆ</span>
<span class="hljs-deletion">- æœ€ç»ˆä¸€è‡´æ€§</span>
<span class="hljs-deletion">- é€‚åˆå¾®æœåŠ¡</span>

é…ç½®ä¸­å¿ƒï¼šCP
<span class="hljs-deletion">- Raftåè®®</span>
<span class="hljs-deletion">- å¼ºä¸€è‡´ä¼˜å…ˆ</span>
<span class="hljs-deletion">- å¯èƒ½ä¸å¯ç”¨</span>
<span class="hljs-deletion">- é€‚åˆé…ç½®ç®¡ç†</span>

æŒä¹…åŒ–å®ä¾‹ï¼šCP
<span class="hljs-deletion">- Raftåè®®</span>
<span class="hljs-deletion">- å¼ºä¸€è‡´ä¼˜å…ˆ</span>
<span class="hljs-deletion">- é€‚åˆåŸºç¡€è®¾æ–½</span>
</code></pre>
<p><strong>2. CAPç†è®ºçš„æœ¬è´¨</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">ä¸æ˜¯<span class="hljs-string">"èƒ½ä¸èƒ½åŒæ—¶æ»¡è¶³CAP"</span>
è€Œæ˜¯<span class="hljs-string">"ç½‘ç»œåˆ†åŒºæ—¶ï¼Œé€‰Cè¿˜æ˜¯A"</span>

CPï¼šå®å¯ä¸å¯ç”¨ï¼Œä¹Ÿä¸èƒ½æ•°æ®é”™
APï¼šå®å¯æš‚æ—¶ä¸ä¸€è‡´ï¼Œä¹Ÿè¦ç»§ç»­æœåŠ¡
</code></pre>
<p><strong>3. Raftçš„æ ¸å¿ƒ</strong></p>
<pre><code class="hljs language-diff" lang="diff">ä¸€å¥è¯ï¼šé€šè¿‡è¿‡åŠç¡®è®¤ï¼Œä¿è¯æ‰€æœ‰èŠ‚ç‚¹æŒ‰ç›¸åŒé¡ºåºæ‰§è¡Œç›¸åŒæ“ä½œ

ä¸‰å¤§æœºåˆ¶ï¼š
<span class="hljs-deletion">- Leaderé€‰ä¸¾ï¼šæ—¥å¿—æœ€æ–°çš„å½“é€‰</span>
<span class="hljs-deletion">- æ—¥å¿—å¤åˆ¶ï¼šè¿‡åŠç¡®è®¤åæäº¤</span>
<span class="hljs-deletion">- Termæœºåˆ¶ï¼šé˜²æ­¢è„‘è£‚</span>

å®‰å…¨ä¿è¯ï¼šå·²æäº¤çš„æ•°æ®æ°¸ä¸ä¸¢å¤±
</code></pre>
<p><strong>4. å®é™…ä½¿ç”¨å»ºè®®</strong></p>
<pre><code class="hljs language-diff" lang="diff">é»˜è®¤ç”¨ä¸´æ—¶å®ä¾‹ï¼š
<span class="hljs-deletion">- 99%çš„å¾®æœåŠ¡åœºæ™¯</span>
<span class="hljs-deletion">- é«˜å¯ç”¨ï¼Œæ€§èƒ½å¥½</span>

åªåœ¨å¿…è¦æ—¶ç”¨æŒä¹…åŒ–å®ä¾‹ï¼š
<span class="hljs-deletion">- æ•°æ®åº“ã€MQç­‰åŸºç¡€è®¾æ–½</span>
<span class="hljs-deletion">- éœ€è¦å¼ºä¸€è‡´æ€§</span>

é…ç½®ä¸­å¿ƒå¿…é¡»ç”¨Raftï¼š
<span class="hljs-deletion">- é…ç½®é”™äº†æ˜¯è‡´å‘½çš„</span>
<span class="hljs-deletion">- ä¸èƒ½æ¥å—ä¸ä¸€è‡´</span>
</code></pre>
<h3 data-id="heading-43">å†™åœ¨æœ€å</h3>
<p>Nacosçš„è®¾è®¡å¾ˆèªæ˜ï¼šä¸è¿½æ±‚"å®Œç¾çš„ä¸€è‡´æ€§"æˆ–"ç»å¯¹çš„å¯ç”¨æ€§"ï¼Œè€Œæ˜¯<strong>æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æ¨¡å¼</strong>ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„æ ¸å¿ƒæ€æƒ³ï¼š<strong>æ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰æƒè¡¡ã€‚</strong></p>
<p>å¦‚æœä½ æƒ³æ·±å…¥äº†è§£Raftçš„å®ç°ç»†èŠ‚ã€JRaftçš„æ€§èƒ½ä¼˜åŒ–ã€ä»¥åŠç”Ÿäº§ç¯å¢ƒçš„æœ€ä½³å®è·µï¼Œæ¬¢è¿ç»§ç»­é˜…è¯»ä¸‹ä¸€ç¯‡ï¼š</p>
<p><strong>ã€Šæ·±å…¥JRaftï¼šNacosé…ç½®ä¸­å¿ƒçš„æ€§èƒ½ä¼˜åŒ–å®è·µã€‹</strong></p>
<hr/>
<h2 data-id="heading-44">å‚è€ƒèµ„æ–™</h2>
<ul>
<li>Nacoså®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnacos.io%2Fzh-cn%2Fdocs%2Fwhat-is-nacos.html" target="_blank" title="https://nacos.io/zh-cn/docs/what-is-nacos.html" ref="nofollow noopener noreferrer">nacos.io/zh-cn/docs/â€¦</a></li>
<li>Raftè®ºæ–‡ï¼šIn Search of an Understandable Consensus Algorithm</li>
<li>CAPç†è®ºï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FCAP_theorem" target="_blank" title="https://en.wikipedia.org/wiki/CAP_theorem" ref="nofollow noopener noreferrer">en.wikipedia.org/wiki/CAP_thâ€¦</a></li>
</ul>
<hr/>
<p><strong>æœ¬æ–‡å®Œ</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¾¹ç¼˜AIæ¨ç†è®¡ç®— - StarryOS RK3588 è¾¹ç¼˜AIç³»ç»Ÿæ¶æ„æ·±åº¦è§£æï¼ˆå…«ï¼‰ï¼šRKNN NPUå®‰å…¨FFIå°è£…]]></title>    <link>https://juejin.cn/post/7584729714339643411</link>    <guid>https://juejin.cn/post/7584729714339643411</guid>    <pubDate>2025-12-18T02:15:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584729714339643411" data-draft-id="7584729714339627027" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¾¹ç¼˜AIæ¨ç†è®¡ç®— - StarryOS RK3588 è¾¹ç¼˜AIç³»ç»Ÿæ¶æ„æ·±åº¦è§£æï¼ˆå…«ï¼‰ï¼šRKNN NPUå®‰å…¨FFIå°è£…"/> <meta itemprop="keywords" content="æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-18T02:15:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯­è½å¿ƒç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/2875978147955741"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¾¹ç¼˜AIæ¨ç†è®¡ç®— - StarryOS RK3588 è¾¹ç¼˜AIç³»ç»Ÿæ¶æ„æ·±åº¦è§£æï¼ˆå…«ï¼‰ï¼šRKNN NPUå®‰å…¨FFIå°è£…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978147955741/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯­è½å¿ƒç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:15:51.000Z" title="Thu Dec 18 2025 02:15:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»“åº“åœ°å€: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkaori-seasons%2Fai-edge-inference" target="_blank" title="https://github.com/kaori-seasons/ai-edge-inference" ref="nofollow noopener noreferrer">github.com/kaori-seasoâ€¦</a></p>
<hr/>
<h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†MIPI-CSIæ‘„åƒå¤´é©±åŠ¨é“¾çš„å¤æ‚å®ç°ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æRKNN NPUå®‰å…¨FFIå°è£…çš„å®ç°ç»†èŠ‚ï¼Œè¿™æ˜¯StarryOSç³»ç»Ÿä¸­ç¡®ä¿AIæ¨ç†å®‰å…¨æ€§å’Œæ€§èƒ½çš„å…³é”®ç»„ä»¶ã€‚</p>
<p>RK3588èŠ¯ç‰‡å†…ç½®äº†é«˜è¾¾6 TOPSçš„ç¥ç»ç½‘ç»œå¤„ç†å•å…ƒï¼ˆNPUï¼‰ï¼Œä½†å…¶å®˜æ–¹SDKä»¥é—­æºC/C++åº“çš„å½¢å¼æä¾›ã€‚ä¸ºäº†åœ¨Rustç¯å¢ƒä¸­å®‰å…¨åœ°ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼ŒStarryOSå®ç°äº†ä¸¥æ ¼çš„FFIï¼ˆForeign Function Interfaceï¼‰å°è£…å±‚ã€‚</p>
<h2 data-id="heading-1">FFIå®‰å…¨å°è£…çš„é‡è¦æ€§</h2>
<h3 data-id="heading-2">å†…å­˜å®‰å…¨æŒ‘æˆ˜</h3>
<p>åœ¨Rustç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œå†…å­˜å®‰å…¨æ˜¯æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œå½“éœ€è¦ä¸é—­æºçš„C/C++åº“äº¤äº’æ—¶ï¼Œè¿™ä¸€ä¼˜åŠ¿é¢ä¸´æŒ‘æˆ˜ï¼š</p>
<ol>
<li><strong>æŒ‡é’ˆæ“ä½œé£é™©</strong>ï¼šC/C++åº“å¯èƒ½è¿”å›åŸå§‹æŒ‡é’ˆï¼Œå®¹æ˜“é€ æˆæ‚¬ç©ºæŒ‡é’ˆæˆ–è¶Šç•Œè®¿é—®</li>
<li><strong>èµ„æºç®¡ç†é—®é¢˜</strong>ï¼šC/C++åº“çš„èµ„æºåˆ†é…å’Œé‡Šæ”¾éœ€è¦æ‰‹åŠ¨ç®¡ç†</li>
<li><strong>å¹¶å‘å®‰å…¨</strong>ï¼šC/C++åº“å¯èƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
</ol>
<h3 data-id="heading-3">å®‰å…¨å°è£…ç­–ç•¥</h3>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒStarryOSé‡‡ç”¨äº†ä»¥ä¸‹å®‰å…¨å°è£…ç­–ç•¥ï¼š</p>
<ol>
<li><strong>RAIIæ¨¡å¼</strong>ï¼šä½¿ç”¨Rustçš„RAIIï¼ˆResource Acquisition Is Initializationï¼‰æ¨¡å¼ç®¡ç†èµ„æº</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šå°†åŸå§‹Cç±»å‹å°è£…ä¸ºå®‰å…¨çš„Rustç±»å‹</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šé€šè¿‡Rustçš„ç”Ÿå‘½å‘¨æœŸç³»ç»Ÿç¡®ä¿å†…å­˜å®‰å…¨</li>
<li><strong>è¾¹ç•Œæ£€æŸ¥</strong>ï¼šåœ¨æ•°æ®è®¿é—®æ—¶è¿›è¡Œè¾¹ç•Œæ£€æŸ¥</li>
</ol>
<h2 data-id="heading-4">æ ¸å¿ƒæ•°æ®ç»“æ„</h2>
<h3 data-id="heading-5">RKNNä¸Šä¸‹æ–‡ç®¡ç†</h3>
<p>RKNNä¸Šä¸‹æ–‡æ˜¯NPUæ“ä½œçš„æ ¸å¿ƒå¯¹è±¡ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">/// RKNN ä¸Šä¸‹æ–‡å¥æŸ„</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">RknnContext</span> = <span class="hljs-type">i32</span>;

<span class="hljs-comment">/// RKNN ä¸Šä¸‹æ–‡ (RAII åŒ…è£…)</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">RknnCtx</span> {
    ctx: RknnContext,
    input_tensors: <span class="hljs-type">Vec</span>&lt;Tensor&gt;,
    output_tensors: <span class="hljs-type">Vec</span>&lt;Tensor&gt;,
    is_initialized: <span class="hljs-type">bool</span>,
    model_header: <span class="hljs-type">Option</span>&lt;RknnModelHeader&gt;,
    model_loaded: <span class="hljs-type">bool</span>,
}
</code></pre>
<h3 data-id="heading-6">å¼ é‡ç®¡ç†</h3>
<p>å¼ é‡æ˜¯ç¥ç»ç½‘ç»œæ¨ç†çš„åŸºæœ¬æ•°æ®å•ä½ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">/// RKNN å¼ é‡</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Tensor</span> {
    buffer: DmaBuffer,
    attr: TensorAttr,
}

<span class="hljs-comment">/// DMAç¼“å†²åŒº</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">DmaBuffer</span> {
    va: *<span class="hljs-keyword">mut</span> <span class="hljs-type">u8</span>,      <span class="hljs-comment">// è™šæ‹Ÿåœ°å€</span>
    pa: <span class="hljs-type">u64</span>,          <span class="hljs-comment">// ç‰©ç†åœ°å€</span>
    size: <span class="hljs-type">usize</span>,      <span class="hljs-comment">// ç¼“å†²åŒºå¤§å°</span>
}
</code></pre>
<h3 data-id="heading-7">æ¨¡å‹å¤´éªŒè¯</h3>
<p>ä¸ºäº†ç¡®ä¿æ¨¡å‹çš„æœ‰æ•ˆæ€§å’Œå…¼å®¹æ€§ï¼Œç³»ç»Ÿå®ç°äº†å®Œæ•´çš„æ¨¡å‹å¤´éªŒè¯ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">/// RKNN æ¨¡å‹æ–‡ä»¶å¤´ç»“æ„</span>
<span class="hljs-meta">#[derive(Debug)]</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">RknnModelHeader</span> {
    <span class="hljs-comment">/// é­”æ•° ("RKNN")</span>
    magic: [<span class="hljs-type">u8</span>; <span class="hljs-number">4</span>],
    <span class="hljs-comment">/// ç‰ˆæœ¬å· (ä¸»ç‰ˆæœ¬, æ¬¡ç‰ˆæœ¬, ä¿®è®¢ç‰ˆæœ¬)</span>
    version: [<span class="hljs-type">u8</span>; <span class="hljs-number">3</span>],
    <span class="hljs-comment">/// æ¨¡å‹ç±»å‹ (0=æ ‡å‡†, 1=é‡åŒ–)</span>
    model_type: <span class="hljs-type">u8</span>,
    <span class="hljs-comment">/// æ¨¡å‹å¤§å° (å­—èŠ‚)</span>
    model_size: <span class="hljs-type">u32</span>,
    <span class="hljs-comment">/// è¾“å…¥å¼ é‡æ•°</span>
    input_count: <span class="hljs-type">u16</span>,
    <span class="hljs-comment">/// è¾“å‡ºå¼ é‡æ•°</span>
    output_count: <span class="hljs-type">u16</span>,
    <span class="hljs-comment">/// æ˜¯å¦æ”¯æŒåŠ¨æ€å½¢çŠ¶</span>
    support_dynamic: <span class="hljs-type">bool</span>,
    <span class="hljs-comment">/// æœ€å¤§è¾“å…¥å¤§å° (å­—èŠ‚)</span>
    max_input_size: <span class="hljs-type">u32</span>,
    <span class="hljs-comment">/// æœ€å¤§è¾“å‡ºå¤§å° (å­—èŠ‚)</span>
    max_output_size: <span class="hljs-type">u32</span>,
}
</code></pre>
<h2 data-id="heading-8">å®‰å…¨å°è£…å®ç°</h2>
<h3 data-id="heading-9">RAIIèµ„æºç®¡ç†</h3>
<p>é€šè¿‡å®ç°Drop traitï¼Œç¡®ä¿èµ„æºçš„è‡ªåŠ¨é‡Šæ”¾ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Drop</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">DmaBuffer</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">if</span> !<span class="hljs-keyword">self</span>.va.<span class="hljs-title function_ invoke__">is_null</span>() {
            <span class="hljs-keyword">unsafe</span> {
                <span class="hljs-comment">// è®¡ç®—åŸå§‹ layout å¹¶é‡Šæ”¾</span>
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Ok</span>(layout) = alloc::alloc::Layout::<span class="hljs-title function_ invoke__">from_size_align</span>(<span class="hljs-keyword">self</span>.size, <span class="hljs-number">8192</span>) {
                    alloc::alloc::<span class="hljs-title function_ invoke__">dealloc</span>(<span class="hljs-keyword">self</span>.va, layout);
                }
            }
        }
    }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Drop</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">RknnCtx</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">drop</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.is_initialized &amp;&amp; <span class="hljs-keyword">self</span>.ctx &gt; <span class="hljs-number">0</span> {
            <span class="hljs-comment">// æ¸…ç† RKNN ä¸Šä¸‹æ–‡èµ„æº</span>
            <span class="hljs-keyword">self</span>.input_tensors.<span class="hljs-title function_ invoke__">clear</span>();
            <span class="hljs-keyword">self</span>.output_tensors.<span class="hljs-title function_ invoke__">clear</span>();
            <span class="hljs-keyword">self</span>.model_header = <span class="hljs-literal">None</span>;
            <span class="hljs-keyword">self</span>.is_initialized = <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<h3 data-id="heading-10">çº¿ç¨‹å®‰å…¨ä¿è¯</h3>
<p>ä¸ºäº†æ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒï¼Œå®ç°äº†Sendå’ŒSync traitï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// Safety: RknnCtx can be safely sent between threads</span>
<span class="hljs-comment">// All pointers are managed internally and not shared</span>
<span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Send</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">RknnCtx</span> {}
<span class="hljs-keyword">unsafe</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">Sync</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">RknnCtx</span> {}
</code></pre>
<h3 data-id="heading-11">æ¨¡å‹åŠ è½½æµç¨‹</h3>
<p>æ¨¡å‹åŠ è½½è¿‡ç¨‹åŒ…å«äº†å®Œæ•´çš„éªŒè¯å’Œåˆå§‹åŒ–ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">/// åŠ è½½ RKNN æ¨¡å‹</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">load_model</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, model_data: &amp;[<span class="hljs-type">u8</span>]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), &amp;<span class="hljs-symbol">'static</span> <span class="hljs-type">str</span>&gt; {
    <span class="hljs-keyword">if</span> !<span class="hljs-keyword">self</span>.is_initialized {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Context not initialized"</span>);
    }
    
    <span class="hljs-keyword">if</span> model_data.<span class="hljs-title function_ invoke__">is_empty</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Empty model data"</span>);
    }
    
    <span class="hljs-comment">// ç¬¬ä¸€æ­¥: è§£æå¹¶éªŒè¯æ¨¡å‹å¤´</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">header</span> = RknnModelHeader::<span class="hljs-title function_ invoke__">parse</span>(model_data)?;
    
    <span class="hljs-comment">// ç¬¬äºŒæ­¥: éªŒè¯æ¨¡å‹æ•°æ®å®Œæ•´æ€§</span>
    header.<span class="hljs-title function_ invoke__">validate_integrity</span>(model_data)?;
    
    <span class="hljs-comment">// ç¬¬ä¸‰æ­¥: æ£€æŸ¥æ¨¡å‹å…¼å®¹æ€§</span>
    <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">verify_model_compatibility</span>(&amp;header)?;
    
    <span class="hljs-comment">// ç¬¬å››æ­¥: åˆ†é…æ¨¡å‹å†…å­˜å’Œç¼“å†²åŒº</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">model_buffer</span> = DmaBuffer::<span class="hljs-title function_ invoke__">allocate</span>(
        header.model_size <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>,
        <span class="hljs-number">4096</span>,  <span class="hljs-comment">// 4KB å¯¹é½ç”¨äº NPU DMA</span>
    )?;
    
    <span class="hljs-comment">// ç¬¬äº”æ­¥: å¤åˆ¶æ¨¡å‹æ•°æ®åˆ° DMA ç¼“å†²åŒº</span>
    <span class="hljs-keyword">unsafe</span> {
        core::ptr::<span class="hljs-title function_ invoke__">copy_nonoverlapping</span>(
            model_data.<span class="hljs-title function_ invoke__">as_ptr</span>(),
            model_buffer.<span class="hljs-title function_ invoke__">virt_addr</span>(),
            (header.model_size <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span>).<span class="hljs-title function_ invoke__">min</span>(model_data.<span class="hljs-title function_ invoke__">len</span>()),
        );
    }
    
    <span class="hljs-comment">// ç¬¬å…­æ­¥: è°ƒç”¨ RKNN API (æ¨¡æ‹Ÿ)</span>
    <span class="hljs-keyword">self</span>.model_header = <span class="hljs-title function_ invoke__">Some</span>(header);
    <span class="hljs-keyword">self</span>.model_loaded = <span class="hljs-literal">true</span>;
    
    <span class="hljs-title function_ invoke__">Ok</span>(())
}
</code></pre>
<h3 data-id="heading-12">æ¨¡å‹éªŒè¯</h3>
<p>æ¨¡å‹éªŒè¯ç¡®ä¿åŠ è½½çš„æ¨¡å‹æ˜¯æœ‰æ•ˆä¸”å…¼å®¹çš„ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">/// éªŒè¯æ¨¡å‹ä¸ç¡¬ä»¶å…¼å®¹æ€§</span>
<span class="hljs-keyword">fn</span> <span class="hljs-title function_">verify_model_compatibility</span>(&amp;<span class="hljs-keyword">self</span>, header: &amp;RknnModelHeader) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), &amp;<span class="hljs-symbol">'static</span> <span class="hljs-type">str</span>&gt; {
    <span class="hljs-comment">// éªŒè¯æ¨¡å‹ç±»å‹</span>
    <span class="hljs-keyword">match</span> header.model_type {
        <span class="hljs-number">0</span> =&gt; {},  <span class="hljs-comment">// æµ®ç‚¹æ¨¡å‹</span>
        <span class="hljs-number">1</span> =&gt; {},  <span class="hljs-comment">// é‡åŒ–æ¨¡å‹</span>
        _ =&gt; <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Unknown model type"</span>),
    }
    
    <span class="hljs-comment">// éªŒè¯å¼ é‡æ•°é‡</span>
    <span class="hljs-keyword">if</span> header.input_count &gt; <span class="hljs-number">16</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Too many input tensors (max 16)"</span>);
    }
    
    <span class="hljs-keyword">if</span> header.output_count &gt; <span class="hljs-number">16</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Too many output tensors (max 16)"</span>);
    }
    
    <span class="hljs-comment">// éªŒè¯ç‰ˆæœ¬å…¼å®¹æ€§</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">major</span> = header.version[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">minor</span> = header.version[<span class="hljs-number">1</span>];
    
    <span class="hljs-comment">// RK3588 æ”¯æŒ RKNN v1.4.0 ä»¥ä¸Š</span>
    <span class="hljs-keyword">if</span> major &lt; <span class="hljs-number">1</span> || (major == <span class="hljs-number">1</span> &amp;&amp; minor &lt; <span class="hljs-number">4</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Model version too old, requires v1.4.0+"</span>);
    }
    
    <span class="hljs-keyword">if</span> major &gt; <span class="hljs-number">2</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Model version too new"</span>);
    }
    
    <span class="hljs-title function_ invoke__">Ok</span>(())
}
</code></pre>
<h3 data-id="heading-13">å¼ é‡åˆå§‹åŒ–</h3>
<p>å¼ é‡åˆå§‹åŒ–ç¡®ä¿è¾“å…¥è¾“å‡ºç¼“å†²åŒºæ­£ç¡®é…ç½®ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">/// åˆå§‹åŒ–è¾“å…¥å¼ é‡</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">init_inputs</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, input_shapes: &amp;[(<span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>, <span class="hljs-type">usize</span>)]) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), &amp;<span class="hljs-symbol">'static</span> <span class="hljs-type">str</span>&gt; {
    <span class="hljs-keyword">if</span> !<span class="hljs-keyword">self</span>.model_loaded {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Model not loaded"</span>);
    }
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(<span class="hljs-keyword">ref</span> header) = <span class="hljs-keyword">self</span>.model_header {
        <span class="hljs-keyword">if</span> input_shapes.<span class="hljs-title function_ invoke__">len</span>() != header.input_count <span class="hljs-keyword">as</span> <span class="hljs-type">usize</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Input shape count mismatch with model"</span>);
        }
    }
    
    <span class="hljs-comment">// æ¸…é™¤æ—§çš„è¾“å…¥å¼ é‡</span>
    <span class="hljs-keyword">self</span>.input_tensors.<span class="hljs-title function_ invoke__">clear</span>();
    
    <span class="hljs-title function_ invoke__">for</span> (i, &amp;(n, c, h, w)) <span class="hljs-keyword">in</span> input_shapes.<span class="hljs-title function_ invoke__">iter</span>().<span class="hljs-title function_ invoke__">enumerate</span>() {
        <span class="hljs-comment">// éªŒè¯å½¢çŠ¶</span>
        <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span> || c == <span class="hljs-number">0</span> || h == <span class="hljs-number">0</span> || w == <span class="hljs-number">0</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Invalid tensor shape (zero dimension)"</span>);
        }
        
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">size</span> = n * c * h * w;
        
        <span class="hljs-comment">// éªŒè¯å¤§å°</span>
        <span class="hljs-keyword">if</span> size &gt; <span class="hljs-number">256</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> / <span class="hljs-number">4</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Input tensor too large"</span>);
        }
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¶…è¿‡æ¨¡å‹æœ€å¤§è¾“å…¥å¤§å°</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">Some</span>(<span class="hljs-keyword">ref</span> header) = <span class="hljs-keyword">self</span>.model_header {
            <span class="hljs-title function_ invoke__">if</span> (size * <span class="hljs-number">4</span>) <span class="hljs-keyword">as</span> <span class="hljs-type">u32</span> &gt; header.max_input_size {
                <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Input tensor exceeds model max size"</span>);
            }
        }
        
        <span class="hljs-comment">// æ¨æ–­æ•°æ®ç±»å‹</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">data_type</span> = <span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">infer_input_data_type</span>(i);
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">element_size</span> = <span class="hljs-keyword">match</span> data_type {
            DataType::Float32 =&gt; <span class="hljs-number">4</span>,
            DataType::Int32 =&gt; <span class="hljs-number">4</span>,
            DataType::Int8 =&gt; <span class="hljs-number">1</span>,
            DataType::Uint8 =&gt; <span class="hljs-number">1</span>,
            DataType::Float16 =&gt; <span class="hljs-number">2</span>,
        };
        
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">attr</span> = TensorAttr {
            index: i <span class="hljs-keyword">as</span> <span class="hljs-type">u32</span>,
            name: [<span class="hljs-number">0</span>; <span class="hljs-number">256</span>],
            n_dims: <span class="hljs-number">4</span>,
            dims: [n <span class="hljs-keyword">as</span> <span class="hljs-type">u32</span>, c <span class="hljs-keyword">as</span> <span class="hljs-type">u32</span>, h <span class="hljs-keyword">as</span> <span class="hljs-type">u32</span>, w <span class="hljs-keyword">as</span> <span class="hljs-type">u32</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
            n_elems: size <span class="hljs-keyword">as</span> <span class="hljs-type">u32</span>,
            size: (size * element_size) <span class="hljs-keyword">as</span> <span class="hljs-type">u32</span>,
            fmt: <span class="hljs-number">0</span>,
            type_: data_<span class="hljs-keyword">type</span> <span class="hljs-title class_">as</span> <span class="hljs-type">u32</span>,
            qnt_type: <span class="hljs-number">0</span>,
            fl: <span class="hljs-number">0</span>,
            zp: <span class="hljs-number">0</span>,
            scale: <span class="hljs-number">1.0</span>,
        };
        
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">tensor</span> = Tensor::<span class="hljs-title function_ invoke__">new</span>(size * element_size, attr)?;
        <span class="hljs-keyword">self</span>.input_tensors.<span class="hljs-title function_ invoke__">push</span>(tensor);
    }
    
    <span class="hljs-title function_ invoke__">Ok</span>(())
}
</code></pre>
<h3 data-id="heading-14">æ¨ç†æ‰§è¡Œ</h3>
<p>æ¨ç†æ‰§è¡Œè¿‡ç¨‹åŒ…å«äº†å®Œæ•´çš„æ•°æ®éªŒè¯å’Œå¤„ç†ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">/// æ‰§è¡Œæ¨ç†</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">run_inference</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;<span class="hljs-type">u32</span>, &amp;<span class="hljs-symbol">'static</span> <span class="hljs-type">str</span>&gt; {
    <span class="hljs-keyword">if</span> !<span class="hljs-keyword">self</span>.is_initialized {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Context not initialized"</span>);
    }
    
    <span class="hljs-keyword">if</span> !<span class="hljs-keyword">self</span>.model_loaded {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Model not loaded"</span>);
    }
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.input_tensors.<span class="hljs-title function_ invoke__">is_empty</span>() || <span class="hljs-keyword">self</span>.output_tensors.<span class="hljs-title function_ invoke__">is_empty</span>() {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Tensors not initialized"</span>);
    }
    
    <span class="hljs-comment">// ç¬¬ä¸€æ­¥: éªŒè¯æ‰€æœ‰è¾“å…¥ç¼“å†²åŒºå®Œæ•´æ€§</span>
    <span class="hljs-title function_ invoke__">for</span> (i, tensor) <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.input_tensors.<span class="hljs-title function_ invoke__">iter</span>().<span class="hljs-title function_ invoke__">enumerate</span>() {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">data</span> = tensor.<span class="hljs-title function_ invoke__">data</span>();
        <span class="hljs-keyword">if</span> data.<span class="hljs-title function_ invoke__">is_empty</span>() {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Input tensor data is empty"</span>);
        }
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å¸¦æœ‰ NaN æˆ–æ— ç©·å¤§ (FP32)</span>
        <span class="hljs-keyword">if</span> tensor.<span class="hljs-title function_ invoke__">attr</span>().type_ == DataType::Float32 <span class="hljs-keyword">as</span> <span class="hljs-type">u32</span> {
            <span class="hljs-keyword">for</span> <span class="hljs-variable">chunk</span> <span class="hljs-keyword">in</span> data.<span class="hljs-title function_ invoke__">chunks</span>(<span class="hljs-number">4</span>) {
                <span class="hljs-keyword">if</span> chunk.<span class="hljs-title function_ invoke__">len</span>() == <span class="hljs-number">4</span> {
                    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">val</span> = <span class="hljs-type">f32</span>::<span class="hljs-title function_ invoke__">from_le_bytes</span>([
                        chunk[<span class="hljs-number">0</span>], chunk[<span class="hljs-number">1</span>], chunk[<span class="hljs-number">2</span>], chunk[<span class="hljs-number">3</span>]
                    ]);
                    <span class="hljs-keyword">if</span> !val.<span class="hljs-title function_ invoke__">is_finite</span>() {
                        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Input contains NaN or infinity"</span>);
                    }
                }
            }
        }
    }
    
    <span class="hljs-comment">// ç¬¬äºŒæ­¥: æ‰§è¡Œå®é™…æ¨ç† (æ¨¡æ‹Ÿå®ç°)</span>
    <span class="hljs-comment">// å®é™…å¤„ç†ä¸­ï¼š</span>
    <span class="hljs-comment">// 1. è°ƒç”¨ rknn_run() C API</span>
    <span class="hljs-comment">// 2. ç­‰å¾… NPU å¤„ç†å®Œæˆ</span>
    <span class="hljs-comment">// 3. è·å–è¾“å‡ºç»“æœ</span>
    
    <span class="hljs-comment">// æ¨¡æ‹Ÿæ¨ç†è€—æ—¶</span>
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">inference_time_ms</span> = <span class="hljs-number">50</span>;
    
    <span class="hljs-comment">// ç¬¬ä¸‰æ­¥: æ£€æŸ¥è¾“å‡ºç¼“å†²åŒºæ˜¯å¦å·²å¡«ç©º</span>
    <span class="hljs-keyword">for</span> <span class="hljs-variable">tensor</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.output_tensors.<span class="hljs-title function_ invoke__">iter_mut</span>() {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">data</span> = tensor.<span class="hljs-title function_ invoke__">data_mut</span>();
        <span class="hljs-keyword">if</span> data.<span class="hljs-title function_ invoke__">is_empty</span>() {
            <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Err</span>(<span class="hljs-string">"Output tensor buffer is empty"</span>);
        }
    }
    
    <span class="hljs-title function_ invoke__">Ok</span>(inference_time_ms)
}
</code></pre>
<h2 data-id="heading-15">å…¨å±€å®ä¾‹ç®¡ç†</h2>
<p>ä¸ºäº†æ–¹ä¾¿åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨ï¼ŒStarryOSåˆ›å»ºäº†å…¨å±€RKNNä¸Šä¸‹æ–‡å®ä¾‹ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">/// å…¨å±€ RKNN ä¸Šä¸‹æ–‡</span>
<span class="hljs-keyword">use</span> lazy_static::lazy_static;

lazy_static! {
    <span class="hljs-keyword">pub</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">ref</span> RKNN_CTX: spin::Mutex&lt;<span class="hljs-type">Option</span>&lt;RknnCtx&gt;&gt; = spin::Mutex::<span class="hljs-title function_ invoke__">new</span>(<span class="hljs-literal">None</span>);
}

<span class="hljs-comment">/// åˆå§‹åŒ– RKNN ç³»ç»Ÿ</span>
<span class="hljs-keyword">pub</span> <span class="hljs-keyword">fn</span> <span class="hljs-title function_">rknn_init</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">Result</span>&lt;(), &amp;<span class="hljs-symbol">'static</span> <span class="hljs-type">str</span>&gt; {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">ctx</span> = RknnCtx::<span class="hljs-title function_ invoke__">new</span>()?;
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">global_ctx</span> = RKNN_CTX.<span class="hljs-title function_ invoke__">lock</span>();
    *global_ctx = <span class="hljs-title function_ invoke__">Some</span>(ctx);
    <span class="hljs-title function_ invoke__">Ok</span>(())
}
</code></pre>
<h2 data-id="heading-16">æµ‹è¯•éªŒè¯</h2>
<p>ä¸ºäº†ç¡®ä¿å°è£…çš„æ­£ç¡®æ€§ï¼ŒåŒ…å«äº†å…¨é¢çš„å•å…ƒæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-meta">#[cfg(test)]</span>
<span class="hljs-keyword">mod</span> tests {
    <span class="hljs-keyword">use</span> super::*;
    
    <span class="hljs-meta">#[test]</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">test_dma_buffer</span>() {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">buffer</span> = DmaBuffer::<span class="hljs-title function_ invoke__">allocate</span>(<span class="hljs-number">1024</span>, <span class="hljs-number">8192</span>);
        <span class="hljs-built_in">assert!</span>(buffer.<span class="hljs-title function_ invoke__">is_ok</span>());
        
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">buf</span> = buffer.<span class="hljs-title function_ invoke__">unwrap</span>();
        <span class="hljs-built_in">assert_eq!</span>(buf.<span class="hljs-title function_ invoke__">size</span>(), <span class="hljs-number">1024</span>);
        <span class="hljs-built_in">assert!</span>(!buf.<span class="hljs-title function_ invoke__">virt_addr</span>().<span class="hljs-title function_ invoke__">is_null</span>());
    }
    
    <span class="hljs-meta">#[test]</span>
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">test_rknn_model_header_parse</span>() {
        <span class="hljs-comment">// æœ‰æ•ˆçš„ RKNN æ¨¡å‹å¤´</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">model_data</span> = alloc::<span class="hljs-built_in">vec!</span>[<span class="hljs-number">0u8</span>; <span class="hljs-number">64</span>];
        model_data[<span class="hljs-number">0</span>..<span class="hljs-number">4</span>].<span class="hljs-title function_ invoke__">copy_from_slice</span>(<span class="hljs-string">b"RKNN"</span>);
        model_data[<span class="hljs-number">4</span>] = <span class="hljs-number">1</span>;  <span class="hljs-comment">// ä¸»ç‰ˆæœ¬</span>
        model_data[<span class="hljs-number">5</span>] = <span class="hljs-number">4</span>;  <span class="hljs-comment">// æ¬¡ç‰ˆæœ¬</span>
        model_data[<span class="hljs-number">6</span>] = <span class="hljs-number">0</span>;  <span class="hljs-comment">// ä¿®è®¢ç‰ˆæœ¬</span>
        model_data[<span class="hljs-number">7</span>] = <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ¨¡å‹ç±»å‹</span>
        
        <span class="hljs-comment">// è®¾ç½®æ¨¡å‹å¤§å° (10MB)</span>
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">size_bytes</span> = <span class="hljs-number">10u32</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;
        model_data[<span class="hljs-number">8</span>..<span class="hljs-number">12</span>].<span class="hljs-title function_ invoke__">copy_from_slice</span>(&amp;size_bytes.<span class="hljs-title function_ invoke__">to_be_bytes</span>());
        
        <span class="hljs-comment">// 1 ä¸ªè¾“å…¥, 3 ä¸ªè¾“å‡º</span>
        model_data[<span class="hljs-number">12</span>..<span class="hljs-number">14</span>].<span class="hljs-title function_ invoke__">copy_from_slice</span>(&amp;<span class="hljs-number">1u16</span>.<span class="hljs-title function_ invoke__">to_be_bytes</span>());
        model_data[<span class="hljs-number">14</span>..<span class="hljs-number">16</span>].<span class="hljs-title function_ invoke__">copy_from_slice</span>(&amp;<span class="hljs-number">3u16</span>.<span class="hljs-title function_ invoke__">to_be_bytes</span>());
        
        model_data[<span class="hljs-number">16</span>] = <span class="hljs-number">0</span>;  <span class="hljs-comment">// ä¸æ”¯æŒåŠ¨æ€å½¢çŠ¶</span>
        
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">header</span> = RknnModelHeader::<span class="hljs-title function_ invoke__">parse</span>(&amp;model_data).<span class="hljs-title function_ invoke__">unwrap</span>();
        <span class="hljs-built_in">assert_eq!</span>(header.magic, *<span class="hljs-string">b"RKNN"</span>);
        <span class="hljs-built_in">assert_eq!</span>(header.version, [<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">0</span>]);
        <span class="hljs-built_in">assert_eq!</span>(header.model_size, size_bytes);
        <span class="hljs-built_in">assert_eq!</span>(header.input_count, <span class="hljs-number">1</span>);
        <span class="hljs-built_in">assert_eq!</span>(header.output_count, <span class="hljs-number">3</span>);
    }
}
</code></pre>
<h2 data-id="heading-17">æ€»ç»“</h2>
<p>æœ¬æ–‡æ·±å…¥åˆ†æäº†StarryOS RK3588ç³»ç»Ÿä¸­RKNN NPUå®‰å…¨FFIå°è£…çš„å®ç°ç»†èŠ‚ã€‚é€šè¿‡é‡‡ç”¨RAIIæ¨¡å¼ã€ç±»å‹å®‰å…¨å°è£…ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œå…¨é¢çš„éªŒè¯æœºåˆ¶ï¼Œè¯¥å°è£…å±‚æˆåŠŸåœ°å°†é—­æºçš„C/C++ NPUåº“å®‰å…¨åœ°é›†æˆåˆ°Rustç¯å¢ƒä¸­ã€‚</p>
<p>å®‰å…¨FFIå°è£…çš„æˆåŠŸå®ç°ä¸ºç³»ç»Ÿçš„AIæ¨ç†èƒ½åŠ›æä¾›äº†åšå®çš„åŸºç¡€ï¼Œç¡®ä¿äº†åœ¨äº«å—NPUå¼ºå¤§è®¡ç®—èƒ½åŠ›çš„åŒæ—¶ï¼Œç»´æŠ¤äº†ç³»ç»Ÿçš„å†…å­˜å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚åœ¨ä¸‹ä¸€æ–‡ä¸­ï¼Œå°†æ¢è®¨YOLOv8æ¨ç†åº”ç”¨ä¸æ€§èƒ½ä¼˜åŒ–çš„å®ç°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pywebviewçª—å£ç§»åŠ¨è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7584730308751835186</link>    <guid>https://juejin.cn/post/7584730308751835186</guid>    <pubDate>2025-12-17T17:15:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584730308751835186" data-draft-id="7584730308751818802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pywebviewçª—å£ç§»åŠ¨è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-17T17:15:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤©å®"/> <meta itemprop="url" content="https://juejin.cn/user/187362547083252"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pywebviewçª—å£ç§»åŠ¨è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/187362547083252/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤©å®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T17:15:28.000Z" title="Wed Dec 17 2025 17:15:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#5f6368;background-image:linear-gradient(90deg,rgba(240,191,213,.1) 3%,transparent 0),linear-gradient(1turn,rgba(240,191,213,.1) 3%,transparent 0);background-size:20px 20px;background-position:50%;letter-spacing:1px;word-spacing:1px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;line-height:1.5;margin-top:35px;margin-bottom:10px;padding-left:50px;padding-bottom:5px;color:#5f6368}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:0;display:block;content:""}.markdown-body h1{font-size:32px;margin-bottom:5px}.markdown-body h1:before{top:0;content:"ğŸ¦„";font-size:32px}.markdown-body h2{padding-bottom:24px;border-bottom:1px solid #ececec}.markdown-body h2:before{top:0;left:8px;content:"ğŸ³";font-size:24px}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{top:-2px;left:8px;content:"ğŸ„";font-size:20px}.markdown-body h4{font-size:16px}.markdown-body h4:before{top:-2px;left:8px;content:"ğŸ¦¥";font-size:18px}.markdown-body h5{font-size:14px}.markdown-body h5:before{top:-2px;left:9px;content:"ğŸ¦©";font-size:16px}.markdown-body h6{font-size:12px;margin-top:5px}.markdown-body h6:before{top:-1px;left:10px;content:"ğŸ§";font-size:14px}.markdown-body p{line-height:1.9;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid rgba(253,121,168,.5);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#a6accd;background:#292d3e;border-radius:8px}.markdown-body a{text-decoration:none;color:#fd79a8;border-bottom:1px solid #fd79a8;padding:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(253,121,168,.1);color:#ee69a9}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body th{color:#fd79a8}.markdown-body th,.markdown-body tr:hover{background:rgba(253,121,168,.1)}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;color:#666;padding:23px;margin:22px 0;border-left:4px solid #ee69a9;background-color:rgba(253,121,168,.1)}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;display:block;font-size:27px;color:#fd79a8;opacity:.8}.markdown-body blockquote:before{left:10px;top:0;content:"â"}.markdown-body blockquote:after{right:10px;bottom:0;content:"â"}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body strong{position:relative;color:#fd79a8}.markdown-body strong:before{content:"Â· "}.markdown-body strong:after{content:" Â·"}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#fd79a8}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ee69a9}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">pywebview æ— è¾¹æ¡†çª—å£ç§»åŠ¨è§£å†³æ–¹æ¡ˆ</h2>
<h3 data-id="heading-1">é—®é¢˜</h3>
<p>pywebview è®¾ç½® <code>frameless=True</code> åï¼Œçª—å£æ— è¾¹æ¡†æ— æ³•ç§»åŠ¨ã€‚</p>
<h3 data-id="heading-2">è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-3">1. Python åç«¯ï¼ˆmain.pyï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> webview

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Api</span>:
    <span class="hljs-string">"""API ç±»ï¼Œä¾›å‰ç«¯è°ƒç”¨"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self._window = <span class="hljs-literal">None</span>  <span class="hljs-comment"># âš ï¸ å¿…é¡»ä½¿ç”¨ç§æœ‰å±æ€§ï¼ˆä¸‹åˆ’çº¿å¼€å¤´ï¼‰ï¼Œé¿å… COM é”™è¯¯</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_window</span>(<span class="hljs-params">self, window</span>):
        self._window = window
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">close_window</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å…³é—­çª—å£"""</span>
        <span class="hljs-keyword">if</span> self._window:
            self._window.destroy()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">minimize_window</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æœ€å°åŒ–çª—å£"""</span>
        <span class="hljs-keyword">if</span> self._window:
            self._window.minimize()

<span class="hljs-comment"># åˆ›å»º API å®ä¾‹</span>
api = Api()
window = webview.create_window(
    title=<span class="hljs-string">'çª—å£æ ‡é¢˜'</span>,
    url=<span class="hljs-string">'./index.html'</span>,
    frameless=<span class="hljs-literal">True</span>,
    js_api=api  <span class="hljs-comment"># ä¼ å…¥ API å¯¹è±¡</span>
)
api.set_window(window)
webview.start()
</code></pre>
<h4 data-id="heading-4">2. HTML å‰ç«¯</h4>
<h5 data-id="heading-5">2.1 æ ‡é¢˜æ  HTML</h5>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"titlebar"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"titlebar-drag-region"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"titlebar-drag"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"titlebar-title"</span>&gt;</span>çª—å£æ ‡é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"titlebar-buttons"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"titlebar-btn minimize"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"minimizeWindow()"</span>&gt;</span>æœ€å°åŒ–<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"titlebar-btn close"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"closeWindow()"</span>&gt;</span>å…³é—­<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h5 data-id="heading-6">2.2 æ‹–æ‹½åŠŸèƒ½ JavaScript</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> initialX = <span class="hljs-number">0</span>;
<span class="hljs-keyword">let</span> initialY = <span class="hljs-number">0</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseMove</span>(<span class="hljs-params">ev</span>) {
    <span class="hljs-keyword">let</span> x = ev.<span class="hljs-property">screenX</span> - initialX;
    <span class="hljs-keyword">let</span> y = ev.<span class="hljs-property">screenY</span> - initialY;
    
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">pywebview</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">pywebview</span>.<span class="hljs-property">_jsApiCallback</span> === <span class="hljs-string">'function'</span>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">pywebview</span>.<span class="hljs-title function_">_jsApiCallback</span>(<span class="hljs-string">'pywebviewMoveWindow'</span>, [x, y], <span class="hljs-string">'move'</span>);
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseUp</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'mousemove'</span>, onMouseMove);
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'mouseup'</span>, onMouseUp);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">onMouseDown</span>(<span class="hljs-params">ev</span>) {
    initialX = ev.<span class="hljs-property">clientX</span>;
    initialY = ev.<span class="hljs-property">clientY</span>;
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mouseup'</span>, onMouseUp);
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousemove'</span>, onMouseMove);
}

<span class="hljs-comment">// å…³é—­çª—å£</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">closeWindow</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">pywebview</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">pywebview</span>.<span class="hljs-property">api</span>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">pywebview</span>.<span class="hljs-property">api</span>.<span class="hljs-title function_">close_window</span>();
    }
}

<span class="hljs-comment">// æœ€å°åŒ–çª—å£</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">minimizeWindow</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">pywebview</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">pywebview</span>.<span class="hljs-property">api</span>) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">pywebview</span>.<span class="hljs-property">api</span>.<span class="hljs-title function_">minimize_window</span>();
    }
}

<span class="hljs-comment">// åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½ï¼ˆå»¶è¿Ÿç¡®ä¿ pywebview API å°±ç»ªï¼‰</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> dragRegion = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'titlebar-drag'</span>);
        <span class="hljs-keyword">if</span> (dragRegion) {
            dragRegion.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'mousedown'</span>, onMouseDown);
        }
    }, <span class="hljs-number">100</span>);
};
</code></pre>
<h5 data-id="heading-7">2.3 æ ‡é¢˜æ æ ·å¼ï¼ˆå¯é€‰ï¼‰</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.titlebar</span> {
    <span class="hljs-attribute">position</span>: fixed;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: space-between;
    <span class="hljs-attribute">align-items</span>: center;
    user-select: none;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000</span>;
}

<span class="hljs-selector-class">.titlebar-drag-region</span> {
    <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">cursor</span>: move;
}

<span class="hljs-selector-class">.titlebar-buttons</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-class">.titlebar-btn</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">5px</span> <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
}
</code></pre>
<h3 data-id="heading-8">æ ¸å¿ƒåŸç†</h3>
<ol>
<li><strong>æ‹–æ‹½åŸç†</strong>ï¼šç›‘å¬é¼ æ ‡æŒ‰ä¸‹ä½ç½®ï¼ˆç›¸å¯¹åæ ‡ï¼‰ï¼Œè®¡ç®—é¼ æ ‡ç§»åŠ¨åçš„å±å¹•ä½ç½®ï¼ˆç»å¯¹åæ ‡ï¼‰ï¼Œè°ƒç”¨ pywebview å†…éƒ¨ API <code>pywebviewMoveWindow</code> ç§»åŠ¨çª—å£</li>
<li><strong>API é€šä¿¡</strong>ï¼šé€šè¿‡ <code>js_api</code> å‚æ•°å°† Python ç±»æš´éœ²ç»™å‰ç«¯ JavaScript</li>
<li><strong>å»¶è¿Ÿåˆå§‹åŒ–</strong>ï¼šä½¿ç”¨ <code>setTimeout</code> ç¡®ä¿ pywebview API å‡†å¤‡å°±ç»ªåå†ç»‘å®šäº‹ä»¶</li>
</ol>
<h3 data-id="heading-9">æ³¨æ„äº‹é¡¹</h3>
<p>âš ï¸ <strong>å…³é”®</strong>ï¼šAPI ç±»ä¸­çš„ <code>window</code> å±æ€§å¿…é¡»ä½¿ç”¨ç§æœ‰å±æ€§ï¼ˆ<code>_window</code>ï¼‰ï¼Œå¦åˆ™ä¼šè§¦å‘ Windows COM ç»„ä»¶é”™è¯¯ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">System.InvalidCastException: æ— æ³•å°†ç±»å‹ä¸º<span class="hljs-string">"System.__ComObject"</span>çš„ COM å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºæ¥å£ç±»å‹<span class="hljs-string">"Accessibility.IAccessible"</span>
</code></pre>
<p>âœ… <strong>æ­£ç¡®</strong>ï¼š<code>self._window = None</code><br/>
âŒ <strong>é”™è¯¯</strong>ï¼š<code>self.window = None</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js HTTP æœåŠ¡å™¨å¼€å‘]]></title>    <link>https://juejin.cn/post/7584722109584310315</link>    <guid>https://juejin.cn/post/7584722109584310315</guid>    <pubDate>2025-12-18T02:32:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584722109584310315" data-draft-id="7584426949864931371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js HTTP æœåŠ¡å™¨å¼€å‘"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-18T02:32:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¢¨å­åŒå¿—"/> <meta itemprop="url" content="https://juejin.cn/user/2084329779627965"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js HTTP æœåŠ¡å™¨å¼€å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2084329779627965/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¢¨å­åŒå¿—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:32:08.000Z" title="Thu Dec 18 2025 02:32:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>å‚è€ƒèµ„æºï¼š</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fhttp.html" target="_blank" title="https://nodejs.org/api/http.html" ref="nofollow noopener noreferrer">Node.js å®˜æ–¹æ–‡æ¡£ - HTTP æ¨¡å—</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3schools.com%2Fnodejs%2Fdefault.asp" target="_blank" title="https://www.w3schools.com/nodejs/default.asp" ref="nofollow noopener noreferrer">W3Schools Node.js Tutorial</a></li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-0">12.14 HTTP æœåŠ¡å™¨åŸºç¡€</h2>
<h3 data-id="heading-1">12.14.1 åˆ›å»ºæœåŠ¡å™¨ï¼ˆcreateServerï¼‰</h3>
<p>Node.js æä¾›äº†å†…ç½®çš„ <code>http</code> æ¨¡å—æ¥åˆ›å»º HTTP æœåŠ¡å™¨ã€‚ä½¿ç”¨ <code>http.createServer()</code> æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨å®ä¾‹ã€‚</p>
<h4 data-id="heading-2">åŸºæœ¬è¯­æ³•</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// è¯·æ±‚å¤„ç†é€»è¾‘</span>
});

server.<span class="hljs-title function_">listen</span>(port, hostname, callback);
</code></pre>
<h4 data-id="heading-3">åˆ›å»ºç®€å•çš„ HTTP æœåŠ¡å™¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-comment">// åˆ›å»ºæœåŠ¡å™¨</span>
<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Hello World!'</span>);
});

<span class="hljs-comment">// ç›‘å¬ç«¯å£</span>
server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080'</span>);
});
</code></pre>
<h4 data-id="heading-4">ä½¿ç”¨ ES6 æ¨¡å—è¯­æ³•</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'http'</span>;

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;Hello World!&lt;/h1&gt;'</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-5">æœåŠ¡å™¨é…ç½®é€‰é¡¹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>({
  <span class="hljs-comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
  <span class="hljs-attr">requestTimeout</span>: <span class="hljs-number">30000</span>,
  <span class="hljs-comment">// è¯·æ±‚å¤´è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
  <span class="hljs-attr">headersTimeout</span>: <span class="hljs-number">60000</span>,
  <span class="hljs-comment">// ä¿æŒè¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
  <span class="hljs-attr">keepAliveTimeout</span>: <span class="hljs-number">5000</span>,
  <span class="hljs-comment">// æœ€å¤§è¯·æ±‚å¤´å¤§å°ï¼ˆå­—èŠ‚ï¼‰</span>
  <span class="hljs-attr">maxHeadersCount</span>: <span class="hljs-number">2000</span>
}, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Server configured'</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<hr/>
<h3 data-id="heading-6">12.14.2 è¯·æ±‚å¤„ç†ï¼ˆreqï¼‰</h3>
<p><code>req</code> å¯¹è±¡æ˜¯ <code>http.IncomingMessage</code> çš„å®ä¾‹ï¼ŒåŒ…å«äº†å®¢æˆ·ç«¯è¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<h4 data-id="heading-7">è¯·æ±‚å¯¹è±¡çš„ä¸»è¦å±æ€§</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// è¯·æ±‚æ–¹æ³•ï¼ˆGET, POST, PUT, DELETE ç­‰ï¼‰</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Method:'</span>, req.<span class="hljs-property">method</span>);
  
  <span class="hljs-comment">// è¯·æ±‚ URL</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'URL:'</span>, req.<span class="hljs-property">url</span>);
  
  <span class="hljs-comment">// HTTP ç‰ˆæœ¬</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'HTTP Version:'</span>, req.<span class="hljs-property">httpVersion</span>);
  
  <span class="hljs-comment">// è¯·æ±‚å¤´å¯¹è±¡</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Headers:'</span>, req.<span class="hljs-property">headers</span>);
  
  <span class="hljs-comment">// è·å–ç‰¹å®šè¯·æ±‚å¤´</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'User-Agent:'</span>, req.<span class="hljs-property">headers</span>[<span class="hljs-string">'user-agent'</span>]);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Content-Type:'</span>, req.<span class="hljs-property">headers</span>[<span class="hljs-string">'content-type'</span>]);
  
  <span class="hljs-comment">// è¯·æ±‚çš„åŸå§‹ URLï¼ˆåŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Raw URL:'</span>, req.<span class="hljs-property">url</span>);
  
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Request received'</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-8">è§£æ URL å’ŒæŸ¥è¯¢å‚æ•°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// è§£æ URL</span>
  <span class="hljs-keyword">const</span> parsedUrl = url.<span class="hljs-title function_">parse</span>(req.<span class="hljs-property">url</span>, <span class="hljs-literal">true</span>);
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Pathname:'</span>, parsedUrl.<span class="hljs-property">pathname</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Query:'</span>, parsedUrl.<span class="hljs-property">query</span>);
  
  <span class="hljs-comment">// ä¾‹å¦‚ï¼š/api/users?id=123&amp;name=John</span>
  <span class="hljs-comment">// parsedUrl.query = { id: '123', name: 'John' }</span>
  
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'URL parsed'</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-9">è¯»å–è¯·æ±‚ä½“ï¼ˆPOST/PUT æ•°æ®ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> body = <span class="hljs-string">''</span>;
  
  <span class="hljs-comment">// ç›‘å¬æ•°æ®æµ</span>
  req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> {
    body += chunk.<span class="hljs-title function_">toString</span>();
  });
  
  <span class="hljs-comment">// æ•°æ®æ¥æ”¶å®Œæˆ</span>
  req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// è§£æ JSON æ•°æ®</span>
      <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(body);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Received data:'</span>, data);
      
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">received</span>: data }));
    } <span class="hljs-keyword">catch</span> (error) {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">400</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Invalid JSON'</span> }));
    }
  });
  
  <span class="hljs-comment">// é”™è¯¯å¤„ç†</span>
  req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Request error:'</span>, error);
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">500</span>);
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Server error'</span>);
  });
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-10">ä½¿ç”¨æµå¼å¤„ç†å¤§æ–‡ä»¶</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// ç›´æ¥å°†è¯·æ±‚æµå†™å…¥æ–‡ä»¶</span>
  <span class="hljs-keyword">const</span> writeStream = fs.<span class="hljs-title function_">createWriteStream</span>(<span class="hljs-string">'uploaded-file.txt'</span>);
  
  req.<span class="hljs-title function_">pipe</span>(writeStream);
  
  req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'File uploaded successfully'</span>);
  });
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<hr/>
<h3 data-id="heading-11">12.14.3 å“åº”å¤„ç†ï¼ˆresï¼‰</h3>
<p><code>res</code> å¯¹è±¡æ˜¯ <code>http.ServerResponse</code> çš„å®ä¾‹ï¼Œç”¨äºå‘å®¢æˆ·ç«¯å‘é€å“åº”ã€‚</p>
<h4 data-id="heading-12">è®¾ç½®å“åº”å¤´</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// æ–¹æ³•1ï¼šä½¿ç”¨ writeHeadï¼ˆå¿…é¡»åœ¨ write æˆ– end ä¹‹å‰è°ƒç”¨ï¼‰</span>
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, {
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span>,
    <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache'</span>,
    <span class="hljs-string">'X-Custom-Header'</span>: <span class="hljs-string">'Custom Value'</span>
  });
  
  <span class="hljs-comment">// æ–¹æ³•2ï¼šä½¿ç”¨ setHeaderï¼ˆå¯ä»¥å¤šæ¬¡è°ƒç”¨ï¼‰</span>
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/json'</span>);
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'X-Powered-By'</span>, <span class="hljs-string">'Node.js'</span>);
  
  <span class="hljs-comment">// è·å–å·²è®¾ç½®çš„å“åº”å¤´</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Content-Type:'</span>, res.<span class="hljs-title function_">getHeader</span>(<span class="hljs-string">'Content-Type'</span>));
  
  <span class="hljs-comment">// ç§»é™¤å“åº”å¤´</span>
  res.<span class="hljs-title function_">removeHeader</span>(<span class="hljs-string">'X-Powered-By'</span>);
  
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Response sent'</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-13">å‘é€å“åº”æ•°æ®</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// æ–¹æ³•1ï¼šä½¿ç”¨ res.end() ä¸€æ¬¡æ€§å‘é€</span>
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Hello World'</span>);
  
  <span class="hljs-comment">// æ–¹æ³•2ï¼šåˆ†å—å‘é€æ•°æ®</span>
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;html&gt;'</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;head&gt;&lt;title&gt;My Page&lt;/title&gt;&lt;/head&gt;'</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;body&gt;'</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;h1&gt;Hello World&lt;/h1&gt;'</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;/body&gt;'</span>);
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'&lt;/html&gt;'</span>);
  res.<span class="hljs-title function_">end</span>(); <span class="hljs-comment">// å¿…é¡»è°ƒç”¨ end() æ¥ç»“æŸå“åº”</span>
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-14">HTTP çŠ¶æ€ç </h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> statusCode = <span class="hljs-number">200</span>; <span class="hljs-comment">// æˆåŠŸ</span>
  
  <span class="hljs-comment">// å¸¸è§çŠ¶æ€ç </span>
  <span class="hljs-comment">// 200 - OKï¼ˆæˆåŠŸï¼‰</span>
  <span class="hljs-comment">// 201 - Createdï¼ˆå·²åˆ›å»ºï¼‰</span>
  <span class="hljs-comment">// 204 - No Contentï¼ˆæ— å†…å®¹ï¼‰</span>
  <span class="hljs-comment">// 301 - Moved Permanentlyï¼ˆæ°¸ä¹…é‡å®šå‘ï¼‰</span>
  <span class="hljs-comment">// 302 - Foundï¼ˆä¸´æ—¶é‡å®šå‘ï¼‰</span>
  <span class="hljs-comment">// 400 - Bad Requestï¼ˆé”™è¯¯è¯·æ±‚ï¼‰</span>
  <span class="hljs-comment">// 401 - Unauthorizedï¼ˆæœªæˆæƒï¼‰</span>
  <span class="hljs-comment">// 403 - Forbiddenï¼ˆç¦æ­¢è®¿é—®ï¼‰</span>
  <span class="hljs-comment">// 404 - Not Foundï¼ˆæœªæ‰¾åˆ°ï¼‰</span>
  <span class="hljs-comment">// 500 - Internal Server Errorï¼ˆæœåŠ¡å™¨é”™è¯¯ï¼‰</span>
  <span class="hljs-comment">// 502 - Bad Gatewayï¼ˆç½‘å…³é”™è¯¯ï¼‰</span>
  <span class="hljs-comment">// 503 - Service Unavailableï¼ˆæœåŠ¡ä¸å¯ç”¨ï¼‰</span>
  
  res.<span class="hljs-title function_">writeHead</span>(statusCode, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">`Status Code: <span class="hljs-subst">${statusCode}</span>`</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-15">å‘é€ JSON å“åº”</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> data = {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span>,
    <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span>
  };
  
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-16">é‡å®šå‘</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span> === <span class="hljs-string">'/old'</span>) {
    <span class="hljs-comment">// 301 æ°¸ä¹…é‡å®šå‘</span>
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">301</span>, {
      <span class="hljs-string">'Location'</span>: <span class="hljs-string">'/new'</span>
    });
    res.<span class="hljs-title function_">end</span>();
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span> === <span class="hljs-string">'/new'</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;New Page&lt;/h1&gt;'</span>);
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>);
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-17">é”™è¯¯å¤„ç†</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// æ¨¡æ‹Ÿé”™è¯¯</span>
    <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span> === <span class="hljs-string">'/error'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Something went wrong'</span>);
    }
    
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Success'</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">500</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>
    }));
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<hr/>
<h3 data-id="heading-18">12.14.4 è·¯ç”±å¤„ç†</h3>
<p>è·¯ç”±å¤„ç†æ˜¯æ ¹æ®ä¸åŒçš„ URL è·¯å¾„å’Œæ–¹æ³•æ‰§è¡Œä¸åŒçš„å¤„ç†é€»è¾‘ã€‚</p>
<h4 data-id="heading-19">åŸºç¡€è·¯ç”±å®ç°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> parsedUrl = url.<span class="hljs-title function_">parse</span>(req.<span class="hljs-property">url</span>, <span class="hljs-literal">true</span>);
  <span class="hljs-keyword">const</span> path = parsedUrl.<span class="hljs-property">pathname</span>;
  <span class="hljs-keyword">const</span> method = req.<span class="hljs-property">method</span>;
  
  <span class="hljs-comment">// è·¯ç”±è¡¨</span>
  <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/'</span> &amp;&amp; method === <span class="hljs-string">'GET'</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;Home Page&lt;/h1&gt;'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/about'</span> &amp;&amp; method === <span class="hljs-string">'GET'</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;About Page&lt;/h1&gt;'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/api/users'</span> &amp;&amp; method === <span class="hljs-string">'GET'</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>([
      { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> },
      { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Jane'</span> }
    ]));
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/api/users'</span> &amp;&amp; method === <span class="hljs-string">'POST'</span>) {
    <span class="hljs-comment">// å¤„ç† POST è¯·æ±‚</span>
    <span class="hljs-keyword">let</span> body = <span class="hljs-string">''</span>;
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> body += chunk);
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> user = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(body);
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">201</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(), ...user }));
    });
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'404 Not Found'</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-20">ä½¿ç”¨è·¯ç”±å¯¹è±¡ç®¡ç†è·¯ç”±</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// è·¯ç”±å¤„ç†å™¨å¯¹è±¡</span>
<span class="hljs-keyword">const</span> routes = {
  <span class="hljs-string">'GET /'</span>: <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;Home&lt;/h1&gt;'</span>);
  },
  
  <span class="hljs-string">'GET /about'</span>: <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;About&lt;/h1&gt;'</span>);
  },
  
  <span class="hljs-string">'GET /api/users'</span>: <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>([{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> }]));
  },
  
  <span class="hljs-string">'POST /api/users'</span>: <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> body = <span class="hljs-string">''</span>;
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> body += chunk);
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">201</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(body);
    });
  }
};

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> parsedUrl = url.<span class="hljs-title function_">parse</span>(req.<span class="hljs-property">url</span>, <span class="hljs-literal">true</span>);
  <span class="hljs-keyword">const</span> routeKey = <span class="hljs-string">`<span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${parsedUrl.pathname}</span>`</span>;
  <span class="hljs-keyword">const</span> handler = routes[routeKey];
  
  <span class="hljs-keyword">if</span> (handler) {
    <span class="hljs-title function_">handler</span>(req, res);
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'404 Not Found'</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-21">æ”¯æŒåŠ¨æ€è·¯ç”±å‚æ•°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// ç®€å•çš„è·¯ç”±åŒ¹é…å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">matchRoute</span>(<span class="hljs-params">pattern, path</span>) {
  <span class="hljs-keyword">const</span> patternParts = pattern.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>);
  <span class="hljs-keyword">const</span> pathParts = path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>);
  
  <span class="hljs-keyword">if</span> (patternParts.<span class="hljs-property">length</span> !== pathParts.<span class="hljs-property">length</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
  
  <span class="hljs-keyword">const</span> params = {};
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; patternParts.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (patternParts[i].<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">':'</span>)) {
      <span class="hljs-keyword">const</span> paramName = patternParts[i].<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>);
      params[paramName] = pathParts[i];
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (patternParts[i] !== pathParts[i]) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  }
  
  <span class="hljs-keyword">return</span> params;
}

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> parsedUrl = url.<span class="hljs-title function_">parse</span>(req.<span class="hljs-property">url</span>, <span class="hljs-literal">true</span>);
  <span class="hljs-keyword">const</span> path = parsedUrl.<span class="hljs-property">pathname</span>;
  
  <span class="hljs-comment">// åŒ¹é… /api/users/:id</span>
  <span class="hljs-keyword">const</span> userParams = <span class="hljs-title function_">matchRoute</span>(<span class="hljs-string">'/api/users/:id'</span>, path);
  <span class="hljs-keyword">if</span> (userParams &amp;&amp; req.<span class="hljs-property">method</span> === <span class="hljs-string">'GET'</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">id</span>: userParams.<span class="hljs-property">id</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">`User <span class="hljs-subst">${userParams.id}</span>`</span>
    }));
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-comment">// åŒ¹é… /api/posts/:postId/comments/:commentId</span>
  <span class="hljs-keyword">const</span> commentParams = <span class="hljs-title function_">matchRoute</span>(<span class="hljs-string">'/api/posts/:postId/comments/:commentId'</span>, path);
  <span class="hljs-keyword">if</span> (commentParams &amp;&amp; req.<span class="hljs-property">method</span> === <span class="hljs-string">'GET'</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
      <span class="hljs-attr">postId</span>: commentParams.<span class="hljs-property">postId</span>,
      <span class="hljs-attr">commentId</span>: commentParams.<span class="hljs-property">commentId</span>
    }));
    <span class="hljs-keyword">return</span>;
  }
  
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>);
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-22">RESTful API è·¯ç”±ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-keyword">const</span> users = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">'john@example.com'</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Jane'</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">'jane@example.com'</span> }
];

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> parsedUrl = url.<span class="hljs-title function_">parse</span>(req.<span class="hljs-property">url</span>, <span class="hljs-literal">true</span>);
  <span class="hljs-keyword">const</span> path = parsedUrl.<span class="hljs-property">pathname</span>;
  <span class="hljs-keyword">const</span> method = req.<span class="hljs-property">method</span>;
  
  <span class="hljs-comment">// GET /api/users - è·å–æ‰€æœ‰ç”¨æˆ·</span>
  <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/api/users'</span> &amp;&amp; method === <span class="hljs-string">'GET'</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(users));
  }
  <span class="hljs-comment">// GET /api/users/:id - è·å–å•ä¸ªç”¨æˆ·</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/api/users/'</span>) &amp;&amp; method === <span class="hljs-string">'GET'</span>) {
    <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">parseInt</span>(path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)[<span class="hljs-number">3</span>]);
    <span class="hljs-keyword">const</span> user = users.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === id);
    
    <span class="hljs-keyword">if</span> (user) {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user));
    } <span class="hljs-keyword">else</span> {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'User not found'</span> }));
    }
  }
  <span class="hljs-comment">// POST /api/users - åˆ›å»ºç”¨æˆ·</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/api/users'</span> &amp;&amp; method === <span class="hljs-string">'POST'</span>) {
    <span class="hljs-keyword">let</span> body = <span class="hljs-string">''</span>;
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> body += chunk);
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> newUser = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(body);
        newUser.<span class="hljs-property">id</span> = users.<span class="hljs-property">length</span> + <span class="hljs-number">1</span>;
        users.<span class="hljs-title function_">push</span>(newUser);
        
        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">201</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
        res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(newUser));
      } <span class="hljs-keyword">catch</span> (error) {
        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">400</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
        res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Invalid JSON'</span> }));
      }
    });
  }
  <span class="hljs-comment">// PUT /api/users/:id - æ›´æ–°ç”¨æˆ·</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/api/users/'</span>) &amp;&amp; method === <span class="hljs-string">'PUT'</span>) {
    <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">parseInt</span>(path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)[<span class="hljs-number">3</span>]);
    <span class="hljs-keyword">const</span> index = users.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === id);
    
    <span class="hljs-keyword">if</span> (index !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">let</span> body = <span class="hljs-string">''</span>;
      req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> body += chunk);
      req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> updatedUser = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(body);
          users[index] = { ...users[index], ...updatedUser };
          
          res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
          res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(users[index]));
        } <span class="hljs-keyword">catch</span> (error) {
          res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">400</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
          res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Invalid JSON'</span> }));
        }
      });
    } <span class="hljs-keyword">else</span> {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'User not found'</span> }));
    }
  }
  <span class="hljs-comment">// DELETE /api/users/:id - åˆ é™¤ç”¨æˆ·</span>
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'/api/users/'</span>) &amp;&amp; method === <span class="hljs-string">'DELETE'</span>) {
    <span class="hljs-keyword">const</span> id = <span class="hljs-built_in">parseInt</span>(path.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)[<span class="hljs-number">3</span>]);
    <span class="hljs-keyword">const</span> index = users.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> u.<span class="hljs-property">id</span> === id);
    
    <span class="hljs-keyword">if</span> (index !== -<span class="hljs-number">1</span>) {
      users.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">204</span>);
      res.<span class="hljs-title function_">end</span>();
    } <span class="hljs-keyword">else</span> {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'User not found'</span> }));
    }
  }
  <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<hr/>
<h2 data-id="heading-23">12.15 HTTP æœåŠ¡å™¨é«˜çº§</h2>
<h3 data-id="heading-24">12.15.1 ä¸­é—´ä»¶æ¨¡å¼</h3>
<p>ä¸­é—´ä»¶æ¨¡å¼æ˜¯ Node.js Web å¼€å‘ä¸­çš„é‡è¦æ¦‚å¿µï¼Œå…è®¸åœ¨è¯·æ±‚å’Œå“åº”ä¹‹é—´æ‰§è¡Œå¤šä¸ªå¤„ç†å‡½æ•°ã€‚</p>
<h4 data-id="heading-25">åŸºç¡€ä¸­é—´ä»¶å®ç°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);

<span class="hljs-comment">// ä¸­é—´ä»¶æ•°ç»„</span>
<span class="hljs-keyword">const</span> middlewares = [];

<span class="hljs-comment">// æ·»åŠ ä¸­é—´ä»¶çš„å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">use</span>(<span class="hljs-params">middleware</span>) {
  middlewares.<span class="hljs-title function_">push</span>(middleware);
}

<span class="hljs-comment">// æ‰§è¡Œä¸­é—´ä»¶é“¾</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">executeMiddlewares</span>(<span class="hljs-params">req, res, index = <span class="hljs-number">0</span></span>) {
  <span class="hljs-keyword">if</span> (index &gt;= middlewares.<span class="hljs-property">length</span>) {
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-keyword">const</span> middleware = middlewares[index];
  <span class="hljs-title function_">middleware</span>(req, res, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">executeMiddlewares</span>(req, res, index + <span class="hljs-number">1</span>);
  });
}

<span class="hljs-comment">// æ—¥å¿—ä¸­é—´ä»¶</span>
<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString()}</span> - <span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.url}</span>`</span>);
  <span class="hljs-title function_">next</span>();
});

<span class="hljs-comment">// è§£æ JSON ä¸­é—´ä»¶</span>
<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">headers</span>[<span class="hljs-string">'content-type'</span>] === <span class="hljs-string">'application/json'</span>) {
    <span class="hljs-keyword">let</span> body = <span class="hljs-string">''</span>;
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> body += chunk);
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        req.<span class="hljs-property">body</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(body);
      } <span class="hljs-keyword">catch</span> (error) {
        req.<span class="hljs-property">body</span> = {};
      }
      <span class="hljs-title function_">next</span>();
    });
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">next</span>();
  }
});

<span class="hljs-comment">// CORS ä¸­é—´ä»¶</span>
<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, <span class="hljs-string">'*'</span>);
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Methods'</span>, <span class="hljs-string">'GET, POST, PUT, DELETE'</span>);
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Access-Control-Allow-Headers'</span>, <span class="hljs-string">'Content-Type'</span>);
  <span class="hljs-title function_">next</span>();
});

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-title function_">executeMiddlewares</span>(req, res, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// è·¯ç”±å¤„ç†</span>
    <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span> === <span class="hljs-string">'/'</span>) {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Hello World'</span>);
    } <span class="hljs-keyword">else</span> {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>);
      res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
    }
  });
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-26">åŸºäºç±»çš„ä¸­é—´ä»¶ç³»ç»Ÿ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Middleware</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span> = [];
  }
  
  <span class="hljs-title function_">use</span>(<span class="hljs-params">fn</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-title function_">push</span>(fn);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }
  
  <span class="hljs-title function_">handle</span>(<span class="hljs-params">req, res</span>) {
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">next</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> middleware = <span class="hljs-variable language_">this</span>.<span class="hljs-property">middlewares</span>[index++];
        <span class="hljs-title function_">middleware</span>(req, res, next);
      }
    };
    
    <span class="hljs-title function_">next</span>();
  }
}

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Middleware</span>();

<span class="hljs-comment">// è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString()}</span>] <span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.url}</span>`</span>);
  <span class="hljs-title function_">next</span>();
});

<span class="hljs-comment">// è¯·æ±‚ä½“è§£æä¸­é—´ä»¶</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> === <span class="hljs-string">'POST'</span> || req.<span class="hljs-property">method</span> === <span class="hljs-string">'PUT'</span>) {
    <span class="hljs-keyword">let</span> body = <span class="hljs-string">''</span>;
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-params">chunk</span> =&gt;</span> body += chunk);
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
      req.<span class="hljs-property">body</span> = body;
      <span class="hljs-title function_">next</span>();
    });
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">next</span>();
  }
});

<span class="hljs-comment">// é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
  res.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Response error:'</span>, error);
  });
  <span class="hljs-title function_">next</span>();
});

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  app.<span class="hljs-title function_">handle</span>(req, res);
  
  <span class="hljs-comment">// è·¯ç”±å¤„ç†</span>
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span> === <span class="hljs-string">'/'</span>) {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Hello World'</span>);
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>);
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-27">å¸¸è§ä¸­é—´ä»¶ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-comment">// 1. è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">logger</span>(<span class="hljs-params">req, res, next</span>) {
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  res.<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> duration = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${req.method}</span> <span class="hljs-subst">${req.url}</span> <span class="hljs-subst">${res.statusCode}</span> <span class="hljs-subst">${duration}</span>ms`</span>);
  });
  <span class="hljs-title function_">next</span>();
}

<span class="hljs-comment">// 2. èº«ä»½éªŒè¯ä¸­é—´ä»¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">authenticate</span>(<span class="hljs-params">req, res, next</span>) {
  <span class="hljs-keyword">const</span> token = req.<span class="hljs-property">headers</span>[<span class="hljs-string">'authorization'</span>];
  <span class="hljs-keyword">if</span> (token === <span class="hljs-string">'Bearer secret-token'</span>) {
    req.<span class="hljs-property">user</span> = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span> };
    <span class="hljs-title function_">next</span>();
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">401</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Unauthorized'</span> }));
  }
}

<span class="hljs-comment">// 3. è¯·æ±‚ä½“å¤§å°é™åˆ¶ä¸­é—´ä»¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">bodySizeLimit</span>(<span class="hljs-params">maxSize</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> size = <span class="hljs-number">0</span>;
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> {
      size += chunk.<span class="hljs-property">length</span>;
      <span class="hljs-keyword">if</span> (size &gt; maxSize) {
        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">413</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
        res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Request entity too large'</span> }));
        <span class="hljs-keyword">return</span>;
      }
    });
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">next</span>();
    });
  };
}

<span class="hljs-comment">// 4. é€Ÿç‡é™åˆ¶ä¸­é—´ä»¶</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">rateLimiter</span>(<span class="hljs-params">maxRequests, windowMs</span>) {
  <span class="hljs-keyword">const</span> requests = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">req, res, next</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> ip = req.<span class="hljs-property">headers</span>[<span class="hljs-string">'x-forwarded-for'</span>] || <span class="hljs-string">'127.0.0.1'</span>;
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> windowStart = now - windowMs;
    
    <span class="hljs-keyword">if</span> (!requests.<span class="hljs-title function_">has</span>(ip)) {
      requests.<span class="hljs-title function_">set</span>(ip, []);
    }
    
    <span class="hljs-keyword">const</span> ipRequests = requests.<span class="hljs-title function_">get</span>(ip);
    <span class="hljs-keyword">const</span> recentRequests = ipRequests.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">time</span> =&gt;</span> time &gt; windowStart);
    
    <span class="hljs-keyword">if</span> (recentRequests.<span class="hljs-property">length</span> &gt;= maxRequests) {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">429</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'Too many requests'</span> }));
      <span class="hljs-keyword">return</span>;
    }
    
    recentRequests.<span class="hljs-title function_">push</span>(now);
    requests.<span class="hljs-title function_">set</span>(ip, recentRequests);
    <span class="hljs-title function_">next</span>();
  };
}
</code></pre>
<hr/>
<h3 data-id="heading-28">12.15.2 é™æ€æ–‡ä»¶æœåŠ¡</h3>
<p>é™æ€æ–‡ä»¶æœåŠ¡æ˜¯æŒ‡æä¾› HTMLã€CSSã€JavaScriptã€å›¾ç‰‡ç­‰é™æ€èµ„æºæ–‡ä»¶ã€‚</p>
<h4 data-id="heading-29">åŸºç¡€é™æ€æ–‡ä»¶æœåŠ¡å™¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-comment">// è·å–æ–‡ä»¶è·¯å¾„</span>
  <span class="hljs-keyword">let</span> filePath = <span class="hljs-string">'.'</span> + req.<span class="hljs-property">url</span>;
  <span class="hljs-keyword">if</span> (filePath === <span class="hljs-string">'./'</span>) {
    filePath = <span class="hljs-string">'./index.html'</span>;
  }
  
  <span class="hljs-comment">// è·å–æ–‡ä»¶æ‰©å±•å</span>
  <span class="hljs-keyword">const</span> extname = <span class="hljs-title class_">String</span>(path.<span class="hljs-title function_">extname</span>(filePath)).<span class="hljs-title function_">toLowerCase</span>();
  
  <span class="hljs-comment">// MIME ç±»å‹æ˜ å°„</span>
  <span class="hljs-keyword">const</span> mimeTypes = {
    <span class="hljs-string">'.html'</span>: <span class="hljs-string">'text/html'</span>,
    <span class="hljs-string">'.js'</span>: <span class="hljs-string">'text/javascript'</span>,
    <span class="hljs-string">'.css'</span>: <span class="hljs-string">'text/css'</span>,
    <span class="hljs-string">'.json'</span>: <span class="hljs-string">'application/json'</span>,
    <span class="hljs-string">'.png'</span>: <span class="hljs-string">'image/png'</span>,
    <span class="hljs-string">'.jpg'</span>: <span class="hljs-string">'image/jpg'</span>,
    <span class="hljs-string">'.gif'</span>: <span class="hljs-string">'image/gif'</span>,
    <span class="hljs-string">'.svg'</span>: <span class="hljs-string">'image/svg+xml'</span>,
    <span class="hljs-string">'.wav'</span>: <span class="hljs-string">'audio/wav'</span>,
    <span class="hljs-string">'.mp4'</span>: <span class="hljs-string">'video/mp4'</span>,
    <span class="hljs-string">'.woff'</span>: <span class="hljs-string">'application/font-woff'</span>,
    <span class="hljs-string">'.ttf'</span>: <span class="hljs-string">'application/font-ttf'</span>,
    <span class="hljs-string">'.eot'</span>: <span class="hljs-string">'application/vnd.ms-fontobject'</span>,
    <span class="hljs-string">'.otf'</span>: <span class="hljs-string">'application/font-otf'</span>,
    <span class="hljs-string">'.wasm'</span>: <span class="hljs-string">'application/wasm'</span>
  };
  
  <span class="hljs-keyword">const</span> contentType = mimeTypes[extname] || <span class="hljs-string">'application/octet-stream'</span>;
  
  <span class="hljs-comment">// è¯»å–æ–‡ä»¶</span>
  fs.<span class="hljs-title function_">readFile</span>(filePath, <span class="hljs-function">(<span class="hljs-params">error, content</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-string">'ENOENT'</span>) {
        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
        res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;404 - File Not Found&lt;/h1&gt;'</span>);
      } <span class="hljs-keyword">else</span> {
        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">500</span>);
        res.<span class="hljs-title function_">end</span>(<span class="hljs-string">`Server Error: <span class="hljs-subst">${error.code}</span>`</span>);
      }
    } <span class="hljs-keyword">else</span> {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: contentType });
      res.<span class="hljs-title function_">end</span>(content, <span class="hljs-string">'utf-8'</span>);
    }
  });
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-30">ä½¿ç”¨æµå¼ä¼ è¾“ä¼˜åŒ–æ€§èƒ½</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> filePath = <span class="hljs-string">'./public'</span> + req.<span class="hljs-property">url</span>;
  <span class="hljs-keyword">if</span> (filePath === <span class="hljs-string">'./public/'</span>) {
    filePath = <span class="hljs-string">'./public/index.html'</span>;
  }
  
  <span class="hljs-keyword">const</span> extname = <span class="hljs-title class_">String</span>(path.<span class="hljs-title function_">extname</span>(filePath)).<span class="hljs-title function_">toLowerCase</span>();
  <span class="hljs-keyword">const</span> mimeTypes = {
    <span class="hljs-string">'.html'</span>: <span class="hljs-string">'text/html'</span>,
    <span class="hljs-string">'.js'</span>: <span class="hljs-string">'text/javascript'</span>,
    <span class="hljs-string">'.css'</span>: <span class="hljs-string">'text/css'</span>,
    <span class="hljs-string">'.json'</span>: <span class="hljs-string">'application/json'</span>,
    <span class="hljs-string">'.png'</span>: <span class="hljs-string">'image/png'</span>,
    <span class="hljs-string">'.jpg'</span>: <span class="hljs-string">'image/jpg'</span>,
    <span class="hljs-string">'.gif'</span>: <span class="hljs-string">'image/gif'</span>,
    <span class="hljs-string">'.svg'</span>: <span class="hljs-string">'image/svg+xml'</span>
  };
  
  <span class="hljs-keyword">const</span> contentType = mimeTypes[extname] || <span class="hljs-string">'application/octet-stream'</span>;
  
  <span class="hljs-comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span>
  fs.<span class="hljs-title function_">access</span>(filePath, fs.<span class="hljs-property">constants</span>.<span class="hljs-property">F_OK</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;404 - File Not Found&lt;/h1&gt;'</span>);
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// è·å–æ–‡ä»¶ä¿¡æ¯</span>
    fs.<span class="hljs-title function_">stat</span>(filePath, <span class="hljs-function">(<span class="hljs-params">err, stats</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) {
        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">500</span>);
        res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Server Error'</span>);
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-comment">// è®¾ç½®å“åº”å¤´</span>
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, {
        <span class="hljs-string">'Content-Type'</span>: contentType,
        <span class="hljs-string">'Content-Length'</span>: stats.<span class="hljs-property">size</span>,
        <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'public, max-age=3600'</span>
      });
      
      <span class="hljs-comment">// ä½¿ç”¨æµå¼ä¼ è¾“</span>
      <span class="hljs-keyword">const</span> fileStream = fs.<span class="hljs-title function_">createReadStream</span>(filePath);
      fileStream.<span class="hljs-title function_">pipe</span>(res);
      
      fileStream.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">500</span>);
        res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'File read error'</span>);
      });
    });
  });
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-31">æ”¯æŒèŒƒå›´è¯·æ±‚ï¼ˆRange Requestsï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> filePath = <span class="hljs-string">'./public'</span> + req.<span class="hljs-property">url</span>;
  
  fs.<span class="hljs-title function_">stat</span>(filePath, <span class="hljs-function">(<span class="hljs-params">err, stats</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>);
      res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-keyword">const</span> range = req.<span class="hljs-property">headers</span>.<span class="hljs-property">range</span>;
    
    <span class="hljs-keyword">if</span> (range) {
      <span class="hljs-comment">// è§£æèŒƒå›´è¯·æ±‚</span>
      <span class="hljs-keyword">const</span> parts = range.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/bytes=/</span>, <span class="hljs-string">''</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">'-'</span>);
      <span class="hljs-keyword">const</span> start = <span class="hljs-built_in">parseInt</span>(parts[<span class="hljs-number">0</span>], <span class="hljs-number">10</span>);
      <span class="hljs-keyword">const</span> end = parts[<span class="hljs-number">1</span>] ? <span class="hljs-built_in">parseInt</span>(parts[<span class="hljs-number">1</span>], <span class="hljs-number">10</span>) : stats.<span class="hljs-property">size</span> - <span class="hljs-number">1</span>;
      <span class="hljs-keyword">const</span> chunksize = (end - start) + <span class="hljs-number">1</span>;
      
      <span class="hljs-comment">// è®¾ç½®éƒ¨åˆ†å†…å®¹å“åº”å¤´</span>
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">206</span>, {
        <span class="hljs-string">'Content-Range'</span>: <span class="hljs-string">`bytes <span class="hljs-subst">${start}</span>-<span class="hljs-subst">${end}</span>/<span class="hljs-subst">${stats.size}</span>`</span>,
        <span class="hljs-string">'Accept-Ranges'</span>: <span class="hljs-string">'bytes'</span>,
        <span class="hljs-string">'Content-Length'</span>: chunksize,
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'video/mp4'</span>
      });
      
      <span class="hljs-comment">// åˆ›å»ºè¯»å–æµ</span>
      <span class="hljs-keyword">const</span> fileStream = fs.<span class="hljs-title function_">createReadStream</span>(filePath, { start, end });
      fileStream.<span class="hljs-title function_">pipe</span>(res);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// å®Œæ•´æ–‡ä»¶å“åº”</span>
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, {
        <span class="hljs-string">'Content-Length'</span>: stats.<span class="hljs-property">size</span>,
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'video/mp4'</span>
      });
      fs.<span class="hljs-title function_">createReadStream</span>(filePath).<span class="hljs-title function_">pipe</span>(res);
    }
  });
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<hr/>
<h3 data-id="heading-32">12.15.3 æ–‡ä»¶ä¸Šä¼ </h3>
<p>æ–‡ä»¶ä¸Šä¼ æ˜¯ Web åº”ç”¨ä¸­çš„å¸¸è§éœ€æ±‚ï¼ŒNode.js å¯ä»¥å¤„ç† multipart/form-data æ ¼å¼çš„æ–‡ä»¶ä¸Šä¼ ã€‚</p>
<h4 data-id="heading-33">åŸºç¡€æ–‡ä»¶ä¸Šä¼ å¤„ç†</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> === <span class="hljs-string">'POST'</span> &amp;&amp; req.<span class="hljs-property">url</span> === <span class="hljs-string">'/upload'</span>) {
    <span class="hljs-keyword">const</span> uploadDir = <span class="hljs-string">'./uploads'</span>;
    
    <span class="hljs-comment">// ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨</span>
    <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(uploadDir)) {
      fs.<span class="hljs-title function_">mkdirSync</span>(uploadDir);
    }
    
    <span class="hljs-keyword">let</span> body = <span class="hljs-string">''</span>;
    
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> {
      body += chunk.<span class="hljs-title function_">toString</span>(<span class="hljs-string">'binary'</span>);
    });
    
    req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">/* body å¤§è‡´æ ¼å¼ä¸ºï¼š
       * --boundaryå€¼\r\n
       * Content-Disposition: form-data; name="å­—æ®µå"; filename="æ–‡ä»¶å"\r\n
       * Content-Type: æ–‡ä»¶ç±»å‹\r\n
       * \r\n
       * æ–‡ä»¶äºŒè¿›åˆ¶å†…å®¹
       * \r\n
       * --boundaryå€¼\r\n
       * Content-Disposition: form-data; name="å…¶ä»–å­—æ®µå"\r\n
       * \r\n
       * å­—æ®µå€¼
       * \r\n
       * --boundaryå€¼--\r\n
       *
       * ç¤ºä¾‹ï¼š
       * ----------------------------268888137557675578696767\r\n
       * Content-Disposition: form-data; name="aaa"; filename="test.png"\r\n
       * Content-Type: image/png\r\n
       * \r\n
       * [PNGæ–‡ä»¶äºŒè¿›åˆ¶æ•°æ®]\r\n
       * ----------------------------268888137557675578696767--\r\n
       */</span>
      
      <span class="hljs-comment">// è§£æ multipart/form-data</span>
      <span class="hljs-keyword">const</span> boundary = req.<span class="hljs-property">headers</span>[<span class="hljs-string">'content-type'</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">'boundary='</span>)[<span class="hljs-number">1</span>];
      <span class="hljs-comment">// ä½¿ç”¨ boundary åˆ†å‰²å„ä¸ªéƒ¨åˆ†ï¼ˆæ³¨æ„ï¼šboundary å‰éœ€è¦åŠ  --ï¼‰</span>
      <span class="hljs-keyword">const</span> parts = body.<span class="hljs-title function_">split</span>(<span class="hljs-string">'--'</span> + boundary);
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> part <span class="hljs-keyword">of</span> parts) {
        <span class="hljs-keyword">if</span> (part.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'Content-Disposition'</span>)) {
          <span class="hljs-keyword">const</span> filenameMatch = part.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/filename="(.+)"/</span>);
          <span class="hljs-keyword">if</span> (filenameMatch) {
            <span class="hljs-keyword">const</span> filename = filenameMatch[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">const</span> fileContent = part.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\r\n\r\n'</span>)[<span class="hljs-number">1</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">'\r\n--'</span>)[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(uploadDir, filename);
            
            fs.<span class="hljs-title function_">writeFileSync</span>(filePath, fileContent, <span class="hljs-string">'binary'</span>);
            
            res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
            res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
              <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">filename</span>: filename,
              <span class="hljs-attr">message</span>: <span class="hljs-string">'File uploaded successfully'</span>
            }));
            <span class="hljs-keyword">return</span>;
          }
        }
      }
      
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">400</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'No file uploaded'</span> }));
    });
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>);
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-34">ä½¿ç”¨æµå¼å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ </h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">Transform</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'stream'</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultipartParser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Transform</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">boundary</span>) {
    <span class="hljs-variable language_">super</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">boundary</span> = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(<span class="hljs-string">`--<span class="hljs-subst">${boundary}</span>`</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span> = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">alloc</span>(<span class="hljs-number">0</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFile</span> = <span class="hljs-literal">null</span>;
  }
  
  <span class="hljs-title function_">_transform</span>(<span class="hljs-params">chunk, encoding, callback</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span> = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">concat</span>([<span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>, chunk]);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processBuffer</span>();
    <span class="hljs-title function_">callback</span>();
  }
  
  <span class="hljs-title function_">processBuffer</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> boundaryIndex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">boundary</span>);
    
    <span class="hljs-keyword">while</span> (boundaryIndex !== -<span class="hljs-number">1</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFile</span>) {
        <span class="hljs-comment">// ä¿å­˜å½“å‰æ–‡ä»¶</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFile</span>.<span class="hljs-title function_">end</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFile</span> = <span class="hljs-literal">null</span>;
      }
      
      <span class="hljs-comment">// æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè¾¹ç•Œ</span>
      <span class="hljs-keyword">const</span> nextBoundaryIndex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">indexOf</span>(
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">boundary</span>,
        boundaryIndex + <span class="hljs-variable language_">this</span>.<span class="hljs-property">boundary</span>.<span class="hljs-property">length</span>
      );
      
      <span class="hljs-keyword">if</span> (nextBoundaryIndex === -<span class="hljs-number">1</span>) {
        <span class="hljs-keyword">break</span>;
      }
      
      <span class="hljs-comment">// æå–æ–‡ä»¶æ•°æ®</span>
      <span class="hljs-keyword">const</span> part = <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">slice</span>(
        boundaryIndex + <span class="hljs-variable language_">this</span>.<span class="hljs-property">boundary</span>.<span class="hljs-property">length</span>,
        nextBoundaryIndex
      );
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processPart</span>(part);
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">slice</span>(nextBoundaryIndex);
      boundaryIndex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">boundary</span>);
    }
  }
  
  <span class="hljs-title function_">processPart</span>(<span class="hljs-params">part</span>) {
    <span class="hljs-keyword">const</span> headerEnd = part.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'\r\n\r\n'</span>);
    <span class="hljs-keyword">if</span> (headerEnd === -<span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">const</span> headers = part.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, headerEnd).<span class="hljs-title function_">toString</span>();
    <span class="hljs-keyword">const</span> contentDisposition = headers.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Content-Disposition:.*filename="(.+)"/</span>);
    
    <span class="hljs-keyword">if</span> (contentDisposition) {
      <span class="hljs-keyword">const</span> filename = contentDisposition[<span class="hljs-number">1</span>];
      <span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(<span class="hljs-string">'./uploads'</span>, filename);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFile</span> = fs.<span class="hljs-title function_">createWriteStream</span>(filePath);
      
      <span class="hljs-keyword">const</span> fileData = part.<span class="hljs-title function_">slice</span>(headerEnd + <span class="hljs-number">4</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFile</span>.<span class="hljs-title function_">write</span>(fileData);
    }
  }
  
  <span class="hljs-title function_">_flush</span>(<span class="hljs-params">callback</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFile</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFile</span>.<span class="hljs-title function_">end</span>();
    }
    <span class="hljs-title function_">callback</span>();
  }
}

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> === <span class="hljs-string">'POST'</span> &amp;&amp; req.<span class="hljs-property">url</span> === <span class="hljs-string">'/upload'</span>) {
    <span class="hljs-keyword">const</span> contentType = req.<span class="hljs-property">headers</span>[<span class="hljs-string">'content-type'</span>];
    <span class="hljs-keyword">const</span> boundary = contentType.<span class="hljs-title function_">split</span>(<span class="hljs-string">'boundary='</span>)[<span class="hljs-number">1</span>];
    
    <span class="hljs-keyword">const</span> parser = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MultipartParser</span>(boundary);
    
    parser.<span class="hljs-title function_">on</span>(<span class="hljs-string">'finish'</span>, <span class="hljs-function">() =&gt;</span> {
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'Files uploaded'</span> }));
    });
    
    req.<span class="hljs-title function_">pipe</span>(parser);
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>);
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-35">ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼ˆæ¨èï¼‰</h4>
<p>è™½ç„¶ä½¿ç”¨åŸç”Ÿ Node.js å¯ä»¥å®ç°æ–‡ä»¶ä¸Šä¼ ï¼Œä½†ä½¿ç”¨ä¸“é—¨çš„åº“ï¼ˆå¦‚ <code>formidable</code> æˆ– <code>multer</code>ï¼‰ä¼šæ›´ç®€å•å¯é ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ formidable çš„ç¤ºä¾‹ï¼ˆéœ€è¦å…ˆå®‰è£…ï¼šnpm install formidableï¼‰</span>
<span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> formidable = <span class="hljs-built_in">require</span>(<span class="hljs-string">'formidable'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">method</span> === <span class="hljs-string">'POST'</span> &amp;&amp; req.<span class="hljs-property">url</span> === <span class="hljs-string">'/upload'</span>) {
    <span class="hljs-keyword">const</span> form = <span class="hljs-title function_">formidable</span>({
      <span class="hljs-attr">uploadDir</span>: <span class="hljs-string">'./uploads'</span>,
      <span class="hljs-attr">keepExtensions</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">maxFileSize</span>: <span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> <span class="hljs-comment">// 10MB</span>
    });
    
    form.<span class="hljs-title function_">parse</span>(req, <span class="hljs-function">(<span class="hljs-params">err, fields, files</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (err) {
        res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">500</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
        res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">error</span>: err.<span class="hljs-property">message</span> }));
        <span class="hljs-keyword">return</span>;
      }
      
      res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> });
      res.<span class="hljs-title function_">end</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">files</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(files).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> ({
          <span class="hljs-attr">name</span>: files[key].<span class="hljs-property">originalFilename</span>,
          <span class="hljs-attr">path</span>: files[key].<span class="hljs-property">filepath</span>,
          <span class="hljs-attr">size</span>: files[key].<span class="hljs-property">size</span>
        }))
      }));
    });
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>);
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<hr/>
<h3 data-id="heading-36">12.15.4 HTTPS</h3>
<p>HTTPS æ˜¯ HTTP çš„å®‰å…¨ç‰ˆæœ¬ï¼Œä½¿ç”¨ SSL/TLS åŠ å¯†ä¼ è¾“æ•°æ®ã€‚</p>
<h4 data-id="heading-37">åˆ›å»º HTTPS æœåŠ¡å™¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">'https'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// è¯»å– SSL è¯ä¹¦å’Œç§é’¥</span>
<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">key</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'private-key.pem'</span>),
  <span class="hljs-attr">cert</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'certificate.pem'</span>)
};

<span class="hljs-keyword">const</span> server = https.<span class="hljs-title function_">createServer</span>(options, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Hello HTTPS World!'</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">443</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'HTTPS Server running on https://localhost:443'</span>);
});
</code></pre>
<h4 data-id="heading-38">ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆç”¨äºå¼€å‘ï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç”Ÿæˆç§é’¥</span>
openssl genrsa -out private-key.pem 2048

<span class="hljs-comment"># ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚</span>
openssl req -new -key private-key.pem -out csr.pem

<span class="hljs-comment"># ç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼ˆæœ‰æ•ˆæœŸ365å¤©ï¼‰</span>
openssl x509 -req -days 365 -<span class="hljs-keyword">in</span> csr.pem -signkey private-key.pem -out certificate.pem
</code></pre>
<h4 data-id="heading-39">HTTP å’Œ HTTPS æœåŠ¡å™¨å…±å­˜</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">'https'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// HTTP æœåŠ¡å™¨ï¼ˆé‡å®šå‘åˆ° HTTPSï¼‰</span>
<span class="hljs-keyword">const</span> httpServer = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">301</span>, {
    <span class="hljs-string">'Location'</span>: <span class="hljs-string">`https://<span class="hljs-subst">${req.headers.host}</span><span class="hljs-subst">${req.url}</span>`</span>
  });
  res.<span class="hljs-title function_">end</span>();
});

<span class="hljs-comment">// HTTPS æœåŠ¡å™¨</span>
<span class="hljs-keyword">const</span> httpsOptions = {
  <span class="hljs-attr">key</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'private-key.pem'</span>),
  <span class="hljs-attr">cert</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'certificate.pem'</span>)
};

<span class="hljs-keyword">const</span> httpsServer = https.<span class="hljs-title function_">createServer</span>(httpsOptions, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;Secure Connection&lt;/h1&gt;'</span>);
});

httpServer.<span class="hljs-title function_">listen</span>(<span class="hljs-number">80</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'HTTP Server (redirect) running on port 80'</span>);
});

httpsServer.<span class="hljs-title function_">listen</span>(<span class="hljs-number">443</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'HTTPS Server running on port 443'</span>);
});
</code></pre>
<h4 data-id="heading-40">ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">'https'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// Let's Encrypt è¯ä¹¦è·¯å¾„ï¼ˆé€šå¸¸ç”± certbot ç®¡ç†ï¼‰</span>
<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">key</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'/etc/letsencrypt/live/example.com/privkey.pem'</span>),
  <span class="hljs-attr">cert</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'/etc/letsencrypt/live/example.com/fullchain.pem'</span>)
};

<span class="hljs-keyword">const</span> server = https.<span class="hljs-title function_">createServer</span>(options, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Hello Secure World!'</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">443</span>);
</code></pre>
<hr/>
<h3 data-id="heading-41">12.15.5 HTTP/2</h3>
<p>HTTP/2 æ˜¯ HTTP åè®®çš„ç¬¬äºŒä¸ªä¸»è¦ç‰ˆæœ¬ï¼Œæä¾›äº†å¤šè·¯å¤ç”¨ã€æœåŠ¡å™¨æ¨é€ç­‰æ–°ç‰¹æ€§ã€‚</p>
<h4 data-id="heading-42">åˆ›å»º HTTP/2 æœåŠ¡å™¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http2'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">key</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'private-key.pem'</span>),
  <span class="hljs-attr">cert</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'certificate.pem'</span>)
};

<span class="hljs-keyword">const</span> server = http2.<span class="hljs-title function_">createSecureServer</span>(options, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'&lt;h1&gt;Hello HTTP/2!&lt;/h1&gt;'</span>);
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8443</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'HTTP/2 Server running on https://localhost:8443'</span>);
});
</code></pre>
<h4 data-id="heading-43">HTTP/2 æœåŠ¡å™¨æ¨é€</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http2'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">key</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'private-key.pem'</span>),
  <span class="hljs-attr">cert</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'certificate.pem'</span>)
};

<span class="hljs-keyword">const</span> server = http2.<span class="hljs-title function_">createSecureServer</span>(options, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">url</span> === <span class="hljs-string">'/'</span>) {
    <span class="hljs-comment">// æ¨é€ CSS æ–‡ä»¶</span>
    res.<span class="hljs-property">stream</span>.<span class="hljs-title function_">pushStream</span>({ <span class="hljs-string">':path'</span>: <span class="hljs-string">'/style.css'</span> }, <span class="hljs-function">(<span class="hljs-params">err, pushStream</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!err) {
        pushStream.<span class="hljs-title function_">respond</span>({ <span class="hljs-string">':status'</span>: <span class="hljs-number">200</span>, <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/css'</span> });
        pushStream.<span class="hljs-title function_">end</span>(<span class="hljs-string">'body { background: #f0f0f0; }'</span>);
      }
    });
    
    <span class="hljs-comment">// æ¨é€ JavaScript æ–‡ä»¶</span>
    res.<span class="hljs-property">stream</span>.<span class="hljs-title function_">pushStream</span>({ <span class="hljs-string">':path'</span>: <span class="hljs-string">'/script.js'</span> }, <span class="hljs-function">(<span class="hljs-params">err, pushStream</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (!err) {
        pushStream.<span class="hljs-title function_">respond</span>({ <span class="hljs-string">':status'</span>: <span class="hljs-number">200</span>, <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'application/javascript'</span> });
        pushStream.<span class="hljs-title function_">end</span>(<span class="hljs-string">'console.log("Hello from pushed script");'</span>);
      }
    });
    
    <span class="hljs-comment">// ä¸»å“åº”</span>
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> });
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">`
      &lt;!DOCTYPE html&gt;
      &lt;html&gt;
        &lt;head&gt;
          &lt;link rel="stylesheet" href="/style.css"&gt;
        &lt;/head&gt;
        &lt;body&gt;
          &lt;h1&gt;HTTP/2 Server Push Example&lt;/h1&gt;
          &lt;script src="/script.js"&gt;&lt;/script&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    `</span>);
  } <span class="hljs-keyword">else</span> {
    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">404</span>);
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8443</span>);
</code></pre>
<h4 data-id="heading-44">HTTP/2 å¤šè·¯å¤ç”¨ç¤ºä¾‹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http2'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">key</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'private-key.pem'</span>),
  <span class="hljs-attr">cert</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'certificate.pem'</span>)
};

<span class="hljs-keyword">const</span> server = http2.<span class="hljs-title function_">createSecureServer</span>(options);

server.<span class="hljs-title function_">on</span>(<span class="hljs-string">'stream'</span>, <span class="hljs-function">(<span class="hljs-params">stream, headers</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> path = headers[<span class="hljs-string">':path'</span>];
  
  <span class="hljs-comment">// æ¨¡æ‹Ÿä¸åŒçš„å“åº”æ—¶é—´</span>
  <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/fast'</span>) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      stream.<span class="hljs-title function_">respond</span>({ <span class="hljs-string">':status'</span>: <span class="hljs-number">200</span>, <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain'</span> });
      stream.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Fast response'</span>);
    }, <span class="hljs-number">100</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/slow'</span>) {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      stream.<span class="hljs-title function_">respond</span>({ <span class="hljs-string">':status'</span>: <span class="hljs-number">200</span>, <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain'</span> });
      stream.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Slow response'</span>);
    }, <span class="hljs-number">2000</span>);
  } <span class="hljs-keyword">else</span> {
    stream.<span class="hljs-title function_">respond</span>({ <span class="hljs-string">':status'</span>: <span class="hljs-number">404</span> });
    stream.<span class="hljs-title function_">end</span>(<span class="hljs-string">'Not Found'</span>);
  }
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8443</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'HTTP/2 Server running on https://localhost:8443'</span>);
});
</code></pre>
<h4 data-id="heading-45">HTTP/2 ä¸ HTTP/1.1 å…¼å®¹æ€§å¤„ç†</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">const</span> http2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http2'</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">const</span> httpsOptions = {
  <span class="hljs-attr">key</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'private-key.pem'</span>),
  <span class="hljs-attr">cert</span>: fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'certificate.pem'</span>)
};

<span class="hljs-comment">// HTTP/2 æœåŠ¡å™¨</span>
<span class="hljs-keyword">const</span> http2Server = http2.<span class="hljs-title function_">createSecureServer</span>(httpsOptions, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'HTTP/2 Response'</span>);
});

<span class="hljs-comment">// HTTP/1.1 æœåŠ¡å™¨ï¼ˆé™çº§æ”¯æŒï¼‰</span>
<span class="hljs-keyword">const</span> httpServer = http.<span class="hljs-title function_">createServer</span>(<span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/plain'</span> });
  res.<span class="hljs-title function_">end</span>(<span class="hljs-string">'HTTP/1.1 Response'</span>);
});

http2Server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8443</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'HTTP/2 Server on port 8443'</span>);
});

httpServer.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'HTTP/1.1 Server on port 8080'</span>);
});
</code></pre>
<hr/>
<h2 data-id="heading-46">æ€»ç»“</h2>
<p>æœ¬æ–‡ä»‹ç»äº† Node.js HTTP æœåŠ¡å™¨å¼€å‘çš„å†…å®¹ï¼š</p>
<h3 data-id="heading-47">åŸºç¡€éƒ¨åˆ†</h3>
<ul>
<li><strong>åˆ›å»ºæœåŠ¡å™¨</strong>ï¼šä½¿ç”¨ <code>http.createServer()</code> åˆ›å»º HTTP æœåŠ¡å™¨</li>
<li><strong>è¯·æ±‚å¤„ç†</strong>ï¼šé€šè¿‡ <code>req</code> å¯¹è±¡è·å–è¯·æ±‚ä¿¡æ¯ã€è§£æ URLã€è¯»å–è¯·æ±‚ä½“</li>
<li><strong>å“åº”å¤„ç†</strong>ï¼šä½¿ç”¨ <code>res</code> å¯¹è±¡è®¾ç½®å“åº”å¤´ã€å‘é€æ•°æ®ã€å¤„ç†çŠ¶æ€ç </li>
<li><strong>è·¯ç”±å¤„ç†</strong>ï¼šå®ç°åŸºç¡€è·¯ç”±ã€åŠ¨æ€è·¯ç”±ã€RESTful API</li>
</ul>
<h3 data-id="heading-48">é«˜çº§éƒ¨åˆ†</h3>
<ul>
<li><strong>ä¸­é—´ä»¶æ¨¡å¼</strong>ï¼šå®ç°è¯·æ±‚å¤„ç†é“¾ã€æ—¥å¿—ã€è®¤è¯ã€é”™è¯¯å¤„ç†ç­‰ä¸­é—´ä»¶</li>
<li><strong>é™æ€æ–‡ä»¶æœåŠ¡</strong>ï¼šæä¾›é™æ€èµ„æºæ–‡ä»¶ã€æ”¯æŒæµå¼ä¼ è¾“ã€èŒƒå›´è¯·æ±‚</li>
<li><strong>æ–‡ä»¶ä¸Šä¼ </strong>ï¼šå¤„ç† multipart/form-dataã€æµå¼ä¸Šä¼ å¤§æ–‡ä»¶</li>
<li><strong>HTTPS</strong>ï¼šåˆ›å»ºå®‰å…¨è¿æ¥ã€ä½¿ç”¨ SSL/TLS è¯ä¹¦</li>
<li><strong>HTTP/2</strong>ï¼šåˆ©ç”¨å¤šè·¯å¤ç”¨ã€æœåŠ¡å™¨æ¨é€ç­‰æ–°ç‰¹æ€§</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥JRaftï¼šNacosé…ç½®ä¸­å¿ƒçš„æ€§èƒ½ä¼˜åŒ–å®è·µ]]></title>    <link>https://juejin.cn/post/7584729714339823635</link>    <guid>https://juejin.cn/post/7584729714339823635</guid>    <pubDate>2025-12-18T02:45:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584729714339823635" data-draft-id="7584724634172850239" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥JRaftï¼šNacosé…ç½®ä¸­å¿ƒçš„æ€§èƒ½ä¼˜åŒ–å®è·µ"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,åˆ†å¸ƒå¼"/> <meta itemprop="datePublished" content="2025-12-18T02:45:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¸æµªæ— ç—•"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥JRaftï¼šNacosé…ç½®ä¸­å¿ƒçš„æ€§èƒ½ä¼˜åŒ–å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¸æµªæ— ç—•
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T02:45:36.000Z" title="Thu Dec 18 2025 02:45:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¸Šä¸€ç¯‡<a href="https://juejin.cn/spost/7584722109584392235" target="_blank" title="https://juejin.cn/spost/7584722109584392235">ã€ŠNacosåˆ°åº•æ˜¯APè¿˜æ˜¯CPï¼Ÿä¸€æ–‡è¯´æ¸…æ¥šã€‹</a>ä¸­ï¼Œæˆ‘ä»¬è®²äº†ï¼š</p>
<ul>
<li>Nacosä¸ºä»€ä¹ˆæ—¢æ˜¯APåˆæ˜¯CP</li>
<li>å¾®æœåŠ¡æ³¨å†Œä¸ºä»€ä¹ˆç”¨APï¼ˆDistroï¼‰</li>
<li>é…ç½®ä¸­å¿ƒä¸ºä»€ä¹ˆç”¨CPï¼ˆRaftï¼‰</li>
<li>Raftçš„æ ¸å¿ƒåŸç†</li>
</ul>
<p>è¿™ä¸€ç¯‡æˆ‘ä»¬æ·±å…¥JRaftçš„å®ç°ç»†èŠ‚ï¼Œçœ‹çœ‹Nacosé…ç½®ä¸­å¿ƒæ˜¯å¦‚ä½•åšåˆ°é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„ã€‚</p>
<p>å¦‚æœä½ æƒ³æˆä¸ºæ¶æ„å¸ˆã€åšåˆ†å¸ƒå¼ä¸­é—´ä»¶å¼€å‘ã€æˆ–è€…åªæ˜¯æƒ³æ·±å…¥ç†è§£Raftï¼Œè¿™ç¯‡æ–‡ç« å€¼å¾—ä¸€è¯»ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€Raftåè®®çš„ç»†èŠ‚é—®é¢˜</h2>
<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²äº†Raftçš„ä¸‰å¤§æœºåˆ¶ï¼šLeaderé€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶ã€Termæœºåˆ¶ã€‚è¿™äº›æ˜¯Raftçš„æ ¸å¿ƒï¼Œä½†å®é™…å®ç°ä¸­è¿˜æœ‰å¾ˆå¤šç»†èŠ‚é—®é¢˜éœ€è¦å¤„ç†ã€‚</p>
<h3 data-id="heading-2">1.1 ä¸ºä»€ä¹ˆåªèƒ½æäº¤å½“å‰termçš„æ—¥å¿—ï¼Ÿ</h3>
<p>è¿™æ˜¯Raftæœ€å¾®å¦™çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯æœ€å®¹æ˜“å‡ºbugçš„åœ°æ–¹ã€‚</p>
<h4 data-id="heading-3">åœºæ™¯é‡ç°</h4>
<pre><code class="hljs language-markdown" lang="markdown">åˆå§‹çŠ¶æ€ï¼š3èŠ‚ç‚¹é›†ç¾¤ï¼Œterm=1

æ—¶é—´çº¿ï¼š

T1æ—¶åˆ»ï¼šNode1æ˜¯Leaderï¼ˆterm=1ï¼‰
<span class="hljs-bullet">-</span> Node1å†™å…¥æ—¥å¿—[1]ï¼š"SET x=100"
<span class="hljs-bullet">-</span> å¤åˆ¶ç»™Node2æˆåŠŸ
<span class="hljs-bullet">-</span> å¤åˆ¶ç»™Node3å¤±è´¥ï¼ˆç½‘ç»œæ…¢ï¼‰
<span class="hljs-bullet">-</span> æ­¤æ—¶ï¼šNode1å’ŒNode2éƒ½æœ‰æ—¥å¿—[1]ï¼Œè¿‡åŠäº†

T2æ—¶åˆ»ï¼šNode1å®•æœº
<span class="hljs-bullet">-</span> è¿˜æ²¡æ¥å¾—åŠæäº¤æ—¥å¿—[1]
<span class="hljs-bullet">-</span> æ­¤æ—¶æ—¥å¿—[1]çš„çŠ¶æ€ï¼šæœªæäº¤ä½†å·²è¿‡åŠ

T3æ—¶åˆ»ï¼šé€‰ä¸¾ï¼Œtermå˜ä¸º2
<span class="hljs-bullet">-</span> Node3å½“é€‰ä¸ºLeaderï¼ˆå®ƒçš„æ—¥å¿—æ˜¯ç©ºçš„ï¼‰
<span class="hljs-bullet">-</span> Node3å†™å…¥è‡ªå·±çš„æ—¥å¿—[2]ï¼š"SET y=200"
<span class="hljs-bullet">-</span> è¿˜æ²¡å¤åˆ¶ç»™å…¶ä»–èŠ‚ç‚¹ï¼ŒNode3ä¹Ÿå®•æœºäº†

T4æ—¶åˆ»ï¼šé€‰ä¸¾ï¼Œtermå˜ä¸º3
<span class="hljs-bullet">-</span> Node1æ¢å¤äº†ï¼Œé‡æ–°å½“é€‰Leader
<span class="hljs-bullet">-</span> Node1å‘ç°ï¼š
<span class="hljs-bullet">  *</span> è‡ªå·±æœ‰æ—¥å¿—[1]ï¼Œå·²ç»è¿‡åŠäº†ï¼ˆNode1å’ŒNode2ï¼‰
<span class="hljs-bullet">  *</span> é—®é¢˜ï¼šèƒ½ç›´æ¥æäº¤æ—¥å¿—[1]å—ï¼Ÿ
</code></pre>
<h4 data-id="heading-4">é”™è¯¯çš„åšæ³•</h4>
<pre><code class="hljs language-ini" lang="ini">å¦‚æœNode1ç›´æ¥æäº¤æ—¥å¿—<span class="hljs-section">[1]</span>ï¼š

1. Node1æ ‡è®°æ—¥å¿—<span class="hljs-section">[1]</span>ä¸ºå·²æäº¤
2. å®¢æˆ·ç«¯è¯»å–ï¼Œçœ‹åˆ°<span class="hljs-attr">x</span>=<span class="hljs-number">100</span>
3. Node1åˆå®•æœºäº†
4. Node3æ¢å¤ï¼Œé‡æ–°å½“é€‰ï¼ˆ<span class="hljs-attr">term</span>=<span class="hljs-number">4</span>ï¼‰
5. Node3çš„æ—¥å¿—<span class="hljs-section">[2]</span>ä¼šè¦†ç›–æ—¥å¿—<span class="hljs-section">[1]</span>
6. å®¢æˆ·ç«¯å†è¯»å–ï¼Œ<span class="hljs-attr">x</span>=<span class="hljs-number">100</span>ä¸è§äº†

é—®é¢˜ï¼šå·²æäº¤çš„æ•°æ®ä¸¢å¤±äº†ï¼
</code></pre>
<h4 data-id="heading-5">æ­£ç¡®çš„åšæ³•</h4>
<pre><code class="hljs language-css" lang="css">Node1ä¸èƒ½ç›´æ¥æäº¤æ—¥å¿—<span class="hljs-selector-attr">[1]</span>ï¼Œè€Œæ˜¯ï¼š

<span class="hljs-number">1</span>. Node1å…ˆå†™ä¸€æ¡å½“å‰termï¼ˆterm=<span class="hljs-number">3</span>ï¼‰çš„æ–°æ—¥å¿—<span class="hljs-selector-attr">[3]</span>
   "SET z=<span class="hljs-number">300</span>"
   
<span class="hljs-number">2</span>. å¤åˆ¶æ—¥å¿—<span class="hljs-selector-attr">[3]</span>ç»™æ‰€æœ‰Follower
   
<span class="hljs-number">3</span>. ç­‰æ—¥å¿—<span class="hljs-selector-attr">[3]</span>è¿‡åŠç¡®è®¤
   
<span class="hljs-number">4</span>. æäº¤æ—¥å¿—<span class="hljs-selector-attr">[3]</span>
   
<span class="hljs-number">5</span>. æ­¤æ—¶ï¼Œæ—¥å¿—<span class="hljs-selector-attr">[1]</span>å’Œ<span class="hljs-selector-attr">[2]</span>ä¹Ÿè‡ªåŠ¨ç®—æäº¤äº†
   ï¼ˆå› ä¸ºå®ƒä»¬åœ¨æ—¥å¿—<span class="hljs-selector-attr">[3]</span>ä¹‹å‰ï¼‰

ä¸ºä»€ä¹ˆè¿™æ ·å®‰å…¨ï¼Ÿ
- å› ä¸ºNode1å·²ç»æäº¤äº†term=<span class="hljs-number">3</span>çš„æ—¥å¿—
- ä»»ä½•èƒ½å½“é€‰çš„æ–°Leaderï¼Œtermå¿…é¡»â‰¥<span class="hljs-number">3</span>
- è€Œtermâ‰¥<span class="hljs-number">3</span>çš„Leaderï¼Œå¿…é¡»æœ‰æ—¥å¿—<span class="hljs-selector-attr">[1]</span><span class="hljs-selector-attr">[2]</span><span class="hljs-selector-attr">[3]</span>
  ï¼ˆå¦åˆ™æ‹¿ä¸åˆ°è¿‡åŠé€‰ç¥¨ï¼‰
- æ‰€ä»¥æ—¥å¿—<span class="hljs-selector-attr">[1]</span>ä¸ä¼šä¸¢å¤±
</code></pre>
<h4 data-id="heading-6">ä»£ç å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateCommitIndex</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. æ”¶é›†æ‰€æœ‰èŠ‚ç‚¹çš„è¿›åº¦</span>
    List&lt;Long&gt; indices = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    indices.add(logStorage.getLastIndex());  <span class="hljs-comment">// Leaderè‡ªå·±</span>
    <span class="hljs-keyword">for</span> (String peer : peers) {
        indices.add(matchIndex.get(peer));   <span class="hljs-comment">// æ¯ä¸ªFollower</span>
    }
    
    <span class="hljs-comment">// 2. æ’åºï¼Œå–ä¸­ä½æ•°ï¼ˆè¿‡åŠï¼‰</span>
    Collections.sort(indices);
    <span class="hljs-type">long</span> <span class="hljs-variable">majorityIndex</span> <span class="hljs-operator">=</span> indices.get(indices.size() / <span class="hljs-number">2</span>);
    
    <span class="hljs-comment">// 3. å…³é”®æ£€æŸ¥ï¼šåªèƒ½æäº¤å½“å‰termçš„æ—¥å¿—</span>
    <span class="hljs-keyword">if</span> (majorityIndex &gt; commitIndex) {
        <span class="hljs-type">LogEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> logStorage.getEntry(majorityIndex);
        <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span> &amp;&amp; entry.getTerm() == currentTerm) {
            <span class="hljs-comment">// åªæœ‰å½“å‰termçš„æ—¥å¿—æ‰èƒ½æäº¤</span>
            commitIndex = majorityIndex;
            logger.info(<span class="hljs-string">"commitIndexæ›´æ–°: {} -&gt; {}"</span>, commitIndex, majorityIndex);
        } <span class="hljs-keyword">else</span> {
            logger.info(<span class="hljs-string">"æ—¥å¿—[{}]è™½ç„¶è¿‡åŠï¼Œä½†term={}ä¸æ˜¯å½“å‰term={}ï¼Œä¸æäº¤"</span>,
                majorityIndex, entry.getTerm(), currentTerm);
        }
    }
}
</code></pre>
<h3 data-id="heading-7">1.2 prevLogIndexå’ŒprevLogTermçš„ä¸€è‡´æ€§æ£€æŸ¥æ·±å…¥</h3>
<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²äº†ä¸€è‡´æ€§æ£€æŸ¥çš„åŸç†ï¼Œè¿™é‡Œçœ‹çœ‹å…·ä½“çš„å†²çªå¤„ç†æµç¨‹ã€‚</p>
<h4 data-id="heading-8">Leaderå¦‚ä½•å¤„ç†Followerçš„æ‹’ç»ï¼Ÿ</h4>
<h4 data-id="heading-9">å†²çªå¤„ç†æµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant L as Leader
    participant F as Follower
    
    Note over L: nextIndex[F]=4
    L-&gt;&gt;F: AppendEntries&lt;br/&gt;prevLogIndex=3, prevLogTerm=2&lt;br/&gt;entries=[4,5]
    
    Note over F: æ£€æŸ¥æœ¬åœ°æ—¥å¿—[3]
    F-&gt;&gt;F: æœ¬åœ°æ—¥å¿—[3].term=1ï¼Œä¸åŒ¹é…
    F-&gt;&gt;F: åˆ é™¤æ—¥å¿—[3]åŠä¹‹åçš„æ‰€æœ‰æ—¥å¿—
    F--&gt;&gt;L: æ‹’ç»ï¼Œsuccess=false
    
    Note over L: nextIndex[F]=3
    L-&gt;&gt;F: AppendEntries&lt;br/&gt;prevLogIndex=2, prevLogTerm=1&lt;br/&gt;entries=[3,4,5]
    
    Note over F: æ£€æŸ¥æœ¬åœ°æ—¥å¿—[2]
    F-&gt;&gt;F: æœ¬åœ°æ—¥å¿—[2].term=1ï¼ŒåŒ¹é…
    F-&gt;&gt;F: è¿½åŠ æ—¥å¿—[3,4,5]
    F--&gt;&gt;L: æ¥å—ï¼Œsuccess=true
    
    Note over L: nextIndex[F]=6
</code></pre>
<h4 data-id="heading-10">Followerçš„å¤„ç†ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> AppendEntriesResponse <span class="hljs-title function_">handleAppendEntries</span><span class="hljs-params">(AppendEntriesRequest req)</span> {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. termæ£€æŸ¥</span>
        <span class="hljs-keyword">if</span> (req.getTerm() &lt; currentTerm) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppendEntriesResponse</span>(currentTerm, <span class="hljs-literal">false</span>);
        }
        
        <span class="hljs-comment">// 2. è½¬ä¸ºFollowerï¼Œé‡ç½®å¿ƒè·³</span>
        <span class="hljs-keyword">if</span> (req.getTerm() &gt;= currentTerm) {
            becomeFollower(req.getTerm());
            resetElectionTimeout();
        }
        
        <span class="hljs-comment">// 3. ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆå…³é”®ï¼‰</span>
        <span class="hljs-keyword">if</span> (req.getPrevLogIndex() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-type">LogEntry</span> <span class="hljs-variable">localPrev</span> <span class="hljs-operator">=</span> logStorage.getEntry(req.getPrevLogIndex());
            
            <span class="hljs-keyword">if</span> (localPrev == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// æœ¬åœ°æ²¡æœ‰è¿™æ¡æ—¥å¿—ï¼Œè¯´æ˜è½åäº†</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppendEntriesResponse</span>(currentTerm, <span class="hljs-literal">false</span>);
            }
            
            <span class="hljs-keyword">if</span> (localPrev.getTerm() != req.getPrevLogTerm()) {
                <span class="hljs-comment">// termä¸åŒ¹é…ï¼Œåˆ é™¤å†²çªçš„æ—¥å¿—</span>
                logStorage.truncateFrom(req.getPrevLogIndex());
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppendEntriesResponse</span>(currentTerm, <span class="hljs-literal">false</span>);
            }
        }
        
        <span class="hljs-comment">// 4. è¿½åŠ æ—¥å¿—</span>
        <span class="hljs-keyword">if</span> (req.getEntries() != <span class="hljs-literal">null</span> &amp;&amp; !req.getEntries().isEmpty()) {
            <span class="hljs-keyword">for</span> (LogEntry entry : req.getEntries()) {
                <span class="hljs-type">LogEntry</span> <span class="hljs-variable">existing</span> <span class="hljs-operator">=</span> logStorage.getEntry(entry.getIndex());
                
                <span class="hljs-keyword">if</span> (existing == <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// æ–°æ—¥å¿—ï¼Œç›´æ¥è¿½åŠ </span>
                    logStorage.append(entry);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (existing.getTerm() != entry.getTerm()) {
                    <span class="hljs-comment">// å†²çªï¼Œåˆ é™¤æ—§çš„ï¼Œè¿½åŠ æ–°çš„</span>
                    logStorage.truncateFrom(entry.getIndex());
                    logStorage.append(entry);
                }
                <span class="hljs-comment">// å¦‚æœindexå’Œterméƒ½ç›¸åŒï¼Œè¯´æ˜æ˜¯é‡å¤çš„ï¼Œè·³è¿‡</span>
            }
        }
        
        <span class="hljs-comment">// 5. æ›´æ–°commitIndex</span>
        <span class="hljs-keyword">if</span> (req.getLeaderCommit() &gt; commitIndex) {
            commitIndex = Math.min(req.getLeaderCommit(), logStorage.getLastIndex());
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppendEntriesResponse</span>(currentTerm, <span class="hljs-literal">true</span>);
        
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<h3 data-id="heading-11">1.3 Leaderå¦‚ä½•è¿½è¸ªFollowerçš„è¿›åº¦ï¼Ÿ</h3>
<p>Leaderéœ€è¦ç»´æŠ¤ä¸¤ä¸ªç´¢å¼•ï¼š</p>
<h4 data-id="heading-12">nextIndexå’ŒmatchIndex</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Leaderå½“é€‰æ—¶åˆå§‹åŒ–</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">becomeLeader</span><span class="hljs-params">()</span> {
    state = LEADER;
    leaderId = nodeId;
    
    <span class="hljs-type">long</span> <span class="hljs-variable">lastLogIndex</span> <span class="hljs-operator">=</span> logStorage.getLastIndex();
    
    <span class="hljs-keyword">for</span> (String peer : peers) {
        <span class="hljs-comment">// nextIndexï¼šä¸‹ä¸€æ¡è¦å‘é€çš„æ—¥å¿—ä½ç½®</span>
        <span class="hljs-comment">// åˆå§‹åŒ–ä¸ºLeaderæœ€åä¸€æ¡æ—¥å¿—+1ï¼ˆä¹è§‚å‡è®¾ï¼‰</span>
        nextIndex.put(peer, lastLogIndex + <span class="hljs-number">1</span>);
        
        <span class="hljs-comment">// matchIndexï¼šå·²çŸ¥Followerå¤åˆ¶åˆ°çš„æœ€é«˜ä½ç½®</span>
        <span class="hljs-comment">// åˆå§‹åŒ–ä¸º0ï¼ˆä¿å®ˆå‡è®¾ï¼‰</span>
        matchIndex.put(peer, <span class="hljs-number">0L</span>);
    }
}
</code></pre>
<h4 data-id="heading-13">å¤åˆ¶æˆåŠŸæ—¶çš„æ›´æ–°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleAppendEntriesSuccess</span><span class="hljs-params">(String peer, AppendEntriesResponse resp)</span> {
    <span class="hljs-keyword">if</span> (!resp.isSuccess()) {
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-comment">// å¦‚æœå‘é€äº†æ—¥å¿—[100-200]ï¼Œä¸”æˆåŠŸäº†</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">lastSentIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">200</span>;
    
    <span class="hljs-comment">// æ›´æ–°è¿›åº¦</span>
    nextIndex.put(peer, lastSentIndex + <span class="hljs-number">1</span>);  <span class="hljs-comment">// ä¸‹æ¬¡ä»201å¼€å§‹å‘</span>
    matchIndex.put(peer, lastSentIndex);      <span class="hljs-comment">// å·²ç¡®è®¤å¤åˆ¶åˆ°200</span>
    
    <span class="hljs-comment">// é‡æ–°è®¡ç®—commitIndex</span>
    updateCommitIndex();
}
</code></pre>
<h4 data-id="heading-14">å¤åˆ¶å¤±è´¥æ—¶çš„å›é€€</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleAppendEntriesFailure</span><span class="hljs-params">(String peer)</span> {
    <span class="hljs-type">long</span> <span class="hljs-variable">currentNextIndex</span> <span class="hljs-operator">=</span> nextIndex.get(peer);
    
    <span class="hljs-comment">// ç®€å•å›é€€ï¼šæ¯æ¬¡å¤±è´¥å¾€å›é€€ä¸€æ ¼</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">newNextIndex</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">1</span>, currentNextIndex - <span class="hljs-number">1</span>);
    nextIndex.put(peer, newNextIndex);
    
    <span class="hljs-comment">// ç«‹å³é‡è¯•</span>
    sendAppendEntries(peer);
}
</code></pre>
<hr/>
<h2 data-id="heading-15">äºŒã€JRaftçš„æ€§èƒ½ä¼˜åŒ–</h2>
<p>ç†è§£äº†Raftåè®®ï¼Œæˆ‘ä»¬çœ‹çœ‹JRaftï¼ˆNacosç”¨çš„å®ç°ï¼‰å¦‚ä½•åšæ€§èƒ½ä¼˜åŒ–ã€‚</p>
<h3 data-id="heading-16">2.1 Pipelineæ‰¹é‡å¤åˆ¶</h3>
<h4 data-id="heading-17">é—®é¢˜ï¼šä¼ ç»Ÿçš„ä¸²è¡Œå¤åˆ¶å¤ªæ…¢</h4>
<pre><code class="hljs language-markdown" lang="markdown">åœºæ™¯ï¼šLeaderè¦å¤åˆ¶10000æ¡æ—¥å¿—ç»™Follower

ä¸²è¡Œæ–¹å¼ï¼š
<span class="hljs-bullet">1.</span> å‘é€æ—¥å¿—[1-100]
<span class="hljs-bullet">2.</span> ç­‰å¾…å“åº”ï¼ˆ100msï¼‰
<span class="hljs-bullet">3.</span> å‘é€æ—¥å¿—[101-200]
<span class="hljs-bullet">4.</span> ç­‰å¾…å“åº”ï¼ˆ100msï¼‰
<span class="hljs-bullet">5.</span> ...
<span class="hljs-bullet">6.</span> å‘é€æ—¥å¿—[9901-10000]
<span class="hljs-bullet">7.</span> ç­‰å¾…å“åº”ï¼ˆ100msï¼‰

æ€»è€—æ—¶ï¼š100æ¬¡ Ã— 100ms = 10ç§’
</code></pre>
<h4 data-id="heading-18">ä¼˜åŒ–ï¼šPipelineå¹¶å‘ä¼ è¾“</h4>
<pre><code class="hljs language-css" lang="css">Pipelineæ–¹å¼ï¼š
<span class="hljs-number">1</span>. å‘é€æ—¥å¿—<span class="hljs-selector-attr">[1-100]</span>ï¼ˆä¸ç­‰å“åº”ï¼‰
<span class="hljs-number">2</span>. å‘é€æ—¥å¿—<span class="hljs-selector-attr">[101-200]</span>ï¼ˆä¸ç­‰å“åº”ï¼‰
<span class="hljs-number">3</span>. å‘é€æ—¥å¿—<span class="hljs-selector-attr">[201-300]</span>ï¼ˆä¸ç­‰å“åº”ï¼‰
...
<span class="hljs-number">256</span>. å‘é€æ—¥å¿—<span class="hljs-selector-attr">[25501-25600]</span>
â†’ æ­¤æ—¶æœ‰<span class="hljs-number">256</span>ä¸ªæ‰¹æ¬¡åŒæ—¶åœ¨ä¼ è¾“ï¼ˆin-flightï¼‰

å½“æ‰¹æ¬¡<span class="hljs-number">1</span>å“åº”å›æ¥ï¼š
â†’ ç«‹å³å‘é€æ‰¹æ¬¡<span class="hljs-number">257</span>
â†’ ä¿æŒ<span class="hljs-number">256</span>ä¸ªæ‰¹æ¬¡åœ¨é£

æ€»è€—æ—¶ï¼šçº¦<span class="hljs-number">1</span>ç§’ï¼ˆä¸»è¦å—ç½‘ç»œå¸¦å®½é™åˆ¶ï¼‰
æ€§èƒ½æå‡ï¼š<span class="hljs-number">10</span>å€
</code></pre>
<h4 data-id="heading-19">Replicatorçš„å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Replicator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    
    <span class="hljs-comment">// æ­£åœ¨ä¼ è¾“ä¸­çš„æ‰¹æ¬¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Deque&lt;Inflight&gt; inflights = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();
    
    <span class="hljs-comment">// Pipelineæ·±åº¦ï¼ˆæœ€å¤šå¤šå°‘æ‰¹åŒæ—¶åœ¨é£ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxInflight</span> <span class="hljs-operator">=</span> <span class="hljs-number">256</span>;
    
    <span class="hljs-comment">// æ¯æ‰¹æ—¥å¿—æ•°é‡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">while</span> (isRunning()) {
            <span class="hljs-comment">// æŒç»­å‘é€ï¼Œç›´åˆ°Pipelineæ»¡</span>
            <span class="hljs-keyword">while</span> (inflights.size() &lt; maxInflight &amp;&amp; hasMoreLogs()) {
                sendNextBatch();
            }
            
            <span class="hljs-comment">// çŸ­æš‚ä¼‘çœ ï¼Œé¿å…CPUç©ºè½¬</span>
            Thread.sleep(<span class="hljs-number">1</span>);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendNextBatch</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. è·å–è¦å‘é€çš„æ—¥å¿—</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">startIndex</span> <span class="hljs-operator">=</span> nextIndex;
        <span class="hljs-type">long</span> <span class="hljs-variable">endIndex</span> <span class="hljs-operator">=</span> startIndex + batchSize - <span class="hljs-number">1</span>;
        List&lt;LogEntry&gt; entries = logStorage.getEntries(startIndex, endIndex);
        
        <span class="hljs-comment">// 2. æ„é€ è¯·æ±‚</span>
        <span class="hljs-type">AppendEntriesRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> buildRequest(entries);
        
        <span class="hljs-comment">// 3. è®°å½•in-flight</span>
        <span class="hljs-type">Inflight</span> <span class="hljs-variable">inflight</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Inflight</span>(startIndex, endIndex, System.currentTimeMillis());
        inflights.add(inflight);
        
        <span class="hljs-comment">// 4. å¼‚æ­¥å‘é€ï¼ˆä¸é˜»å¡ï¼‰</span>
        rpcService.sendAsync(peer, request, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(AppendEntriesResponse response)</span> {
                <span class="hljs-comment">// ç§»é™¤in-flight</span>
                inflights.remove(inflight);
                
                <span class="hljs-keyword">if</span> (response.isSuccess()) {
                    <span class="hljs-comment">// æˆåŠŸï¼Œæ¨è¿›nextIndex</span>
                    nextIndex = endIndex + <span class="hljs-number">1</span>;
                    matchIndex = endIndex;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// å¤±è´¥ï¼Œå›é€€é‡è¯•</span>
                    nextIndex = Math.max(<span class="hljs-number">1</span>, startIndex - <span class="hljs-number">1</span>);
                }
            }
            
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Throwable t)</span> {
                inflights.remove(inflight);
                <span class="hljs-comment">// ç½‘ç»œå¤±è´¥ï¼Œå›é€€é‡è¯•</span>
                nextIndex = Math.max(<span class="hljs-number">1</span>, startIndex - <span class="hljs-number">1</span>);
            }
        });
    }
}
</code></pre>
<h4 data-id="heading-20">Pipelineçš„æµæ§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é˜²æ­¢å‘é€è¿‡å¿«ï¼Œå‹å®Followeræˆ–ç½‘ç»œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Replicator</span> {
    
    <span class="hljs-comment">// ä½¿ç”¨ä¿¡å·é‡é™æµ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Semaphore</span> <span class="hljs-variable">inflightSemaphore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Semaphore</span>(<span class="hljs-number">256</span>);
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendNextBatch</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è·å–è®¸å¯ï¼ˆå¦‚æœå·²ç»æœ‰256ä¸ªåœ¨é£ï¼Œä¼šé˜»å¡ï¼‰</span>
            inflightSemaphore.acquire();
            
            <span class="hljs-comment">// å‘é€æ—¥å¿—</span>
            rpcService.sendAsync(peer, request, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">()</span> {
                    <span class="hljs-comment">// é‡Šæ”¾è®¸å¯</span>
                    inflightSemaphore.release();
                }
            });
            
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
    }
}
</code></pre>
<h3 data-id="heading-21">2.2 æ‰¹é‡å†™å…¥å’ŒGroup Commit</h3>
<h4 data-id="heading-22">é—®é¢˜ï¼šæ¯æ¡æ—¥å¿—éƒ½fsyncå¤ªæ…¢</h4>
<pre><code class="hljs language-diff" lang="diff">fsyncçš„æˆæœ¬ï¼š
<span class="hljs-deletion">- æœºæ¢°ç¡¬ç›˜ï¼š5-10ms</span>
<span class="hljs-deletion">- SSDï¼š1-2ms</span>

å¦‚æœæ¯æ¡æ—¥å¿—éƒ½fsyncï¼š
<span class="hljs-deletion">- 100æ¡æ—¥å¿— â†’ 100æ¬¡fsync</span>
<span class="hljs-deletion">- è€—æ—¶ï¼š100-200msï¼ˆSSDï¼‰æˆ–500-1000msï¼ˆæœºæ¢°ç›˜ï¼‰</span>
</code></pre>
<h4 data-id="heading-23">ä¼˜åŒ–ï¼šæ‰¹é‡å†™å…¥</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogManager</span> {
    
    <span class="hljs-comment">// å¾…å†™å…¥çš„æ—¥å¿—ç¼“å†²åŒº</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;LogEntry&gt; buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-comment">// ç­‰å¾…å†™å…¥å®Œæˆçš„Futureåˆ—è¡¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;CompletableFuture&lt;Void&gt;&gt; waiters = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> CompletableFuture&lt;Void&gt; <span class="hljs-title function_">appendEntry</span><span class="hljs-params">(LogEntry entry)</span> {
        CompletableFuture&lt;Void&gt; future = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;&gt;();
        
        <span class="hljs-keyword">synchronized</span> (buffer) {
            buffer.add(entry);
            waiters.add(future);
            
            <span class="hljs-comment">// ç´¯ç§¯åˆ°32æ¡æˆ–è¶…æ—¶100msï¼Œæ‰¹é‡åˆ·ç›˜</span>
            <span class="hljs-keyword">if</span> (buffer.size() &gt;= <span class="hljs-number">32</span> || timeout(<span class="hljs-number">100</span>)) {
                flushBuffer();
            }
        }
        
        <span class="hljs-keyword">return</span> future;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">flushBuffer</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (buffer.isEmpty()) {
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. ä¸€æ¬¡æ€§å†™å…¥å¤šæ¡æ—¥å¿—</span>
            logStorage.appendEntries(buffer);
            
            <span class="hljs-comment">// 2. ä¸€æ¬¡fsync</span>
            logStorage.sync();
            
            <span class="hljs-comment">// 3. é€šçŸ¥æ‰€æœ‰ç­‰å¾…è€…</span>
            <span class="hljs-keyword">for</span> (CompletableFuture&lt;Void&gt; waiter : waiters) {
                waiter.complete(<span class="hljs-literal">null</span>);
            }
            
        } <span class="hljs-keyword">finally</span> {
            buffer.clear();
            waiters.clear();
        }
    }
}
</code></pre>
<p>æ•ˆæœï¼š</p>
<pre><code class="hljs language-diff" lang="diff">æ‰¹é‡å†™å…¥å‰ï¼š
<span class="hljs-deletion">- 32æ¡æ—¥å¿— â†’ 32æ¬¡fsync</span>
<span class="hljs-deletion">- è€—æ—¶ï¼š32-64ms</span>

æ‰¹é‡å†™å…¥åï¼š
<span class="hljs-deletion">- 32æ¡æ—¥å¿— â†’ 1æ¬¡fsync</span>
<span class="hljs-deletion">- è€—æ—¶ï¼š1-2ms</span>

æ€§èƒ½æå‡ï¼š16-32å€
</code></pre>
<h3 data-id="heading-24">2.3 åŠ¨æ€è°ƒæ•´å¤åˆ¶é€Ÿåº¦</h3>
<h4 data-id="heading-25">é—®é¢˜ï¼šFollowerè½åæ—¶å›ºå®šé€Ÿåº¦å¤ªæ…¢</h4>
<pre><code class="hljs language-diff" lang="diff">åœºæ™¯ï¼šFollowerè½å10000æ¡æ—¥å¿—

å›ºå®šå‚æ•°ï¼š
<span class="hljs-deletion">- batchSize = 100</span>
<span class="hljs-deletion">- maxInflight = 64</span>
<span class="hljs-deletion">- interval = 50ms</span>

è®¡ç®—ï¼š
<span class="hljs-deletion">- æ¯50mså‘é€100æ¡</span>
<span class="hljs-deletion">- æ¯ç§’å‘é€2000æ¡</span>
<span class="hljs-deletion">- è¿½ä¸Šéœ€è¦ï¼š5ç§’</span>
</code></pre>
<h4 data-id="heading-26">ä¼˜åŒ–ï¼šæ ¹æ®è½åç¨‹åº¦åŠ¨æ€è°ƒæ•´</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Replicator</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">maxInflight</span> <span class="hljs-operator">=</span> <span class="hljs-number">64</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">sendInterval</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;
    
    <span class="hljs-comment">// æ¯æ¬¡å¤åˆ¶æˆåŠŸåï¼Œé‡æ–°è¯„ä¼°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustReplicationSpeed</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">leaderLastIndex</span> <span class="hljs-operator">=</span> node.getLastLogIndex();
        <span class="hljs-type">long</span> <span class="hljs-variable">followerIndex</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.matchIndex;
        <span class="hljs-type">long</span> <span class="hljs-variable">lag</span> <span class="hljs-operator">=</span> leaderLastIndex - followerIndex;
        
        <span class="hljs-keyword">if</span> (lag == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// å®Œå…¨åŒæ­¥ï¼Œå¿ƒè·³æ¨¡å¼</span>
            batchSize = <span class="hljs-number">1</span>;
            maxInflight = <span class="hljs-number">1</span>;
            sendInterval = <span class="hljs-number">50</span>;
            logger.debug(<span class="hljs-string">"èŠ‚ç‚¹{}å®Œå…¨åŒæ­¥ï¼Œåˆ‡æ¢åˆ°å¿ƒè·³æ¨¡å¼"</span>, peer);
            
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lag &lt; <span class="hljs-number">100</span>) {
            <span class="hljs-comment">// è½»å¾®è½åï¼Œæ­£å¸¸æ¨¡å¼</span>
            batchSize = <span class="hljs-number">100</span>;
            maxInflight = <span class="hljs-number">128</span>;
            sendInterval = <span class="hljs-number">10</span>;
            logger.debug(<span class="hljs-string">"èŠ‚ç‚¹{}è½»å¾®è½å{}æ¡ï¼Œæ­£å¸¸å¤åˆ¶"</span>, peer, lag);
            
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lag &lt; <span class="hljs-number">10000</span>) {
            <span class="hljs-comment">// ä¸¥é‡è½åï¼Œå¿«é€Ÿè¿½èµ¶æ¨¡å¼</span>
            batchSize = <span class="hljs-number">1024</span>;      <span class="hljs-comment">// å¢å¤§æ‰¹é‡</span>
            maxInflight = <span class="hljs-number">256</span>;     <span class="hljs-comment">// å¢åŠ Pipelineæ·±åº¦</span>
            sendInterval = <span class="hljs-number">0</span>;      <span class="hljs-comment">// ç«‹å³å‘é€ï¼Œä¸ç­‰å¾…</span>
            
            logger.warn(<span class="hljs-string">"èŠ‚ç‚¹{}ä¸¥é‡è½å{}æ¡ï¼Œå¯åŠ¨å¿«é€Ÿè¿½èµ¶æ¨¡å¼"</span>, peer, lag);
            
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// è½åå¤ªå¤šï¼Œå‘é€å¿«ç…§</span>
            logger.warn(<span class="hljs-string">"èŠ‚ç‚¹{}è½å{}æ¡ï¼Œåˆ‡æ¢åˆ°å¿«ç…§ä¼ è¾“"</span>, peer, lag);
            sendSnapshot();
        }
    }
}
</code></pre>
<p>æ•ˆæœå¯¹æ¯”ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">åœºæ™¯ï¼šè½å10000æ¡æ—¥å¿—

å›ºå®šé€Ÿåº¦ï¼š
<span class="hljs-deletion">- 5ç§’è¿½ä¸Š</span>

åŠ¨æ€åŠ é€Ÿï¼š
<span class="hljs-deletion">- æ£€æµ‹åˆ°è½å</span>
<span class="hljs-deletion">- è‡ªåŠ¨åˆ‡æ¢åˆ°å¿«é€Ÿæ¨¡å¼</span>
<span class="hljs-deletion">- 1ç§’è¿½ä¸Š</span>

æ€§èƒ½æå‡ï¼š5å€
</code></pre>
<h3 data-id="heading-27">2.4 å¿«ç…§ä¼ è¾“</h3>
<h4 data-id="heading-28">é—®é¢˜ï¼šæ—¥å¿—å¤ªå¤šï¼Œå¤åˆ¶æ…¢</h4>
<pre><code class="hljs language-diff" lang="diff">åœºæ™¯ï¼š
<span class="hljs-deletion">- Leaderæ—¥å¿—ï¼š[10001-20000]</span>
<span class="hljs-deletion">- Followeræ—¥å¿—ï¼š[1-100]</span>
<span class="hljs-deletion">- å‰10000æ¡æ—¥å¿—å·²è¢«å‹ç¼©æˆå¿«ç…§</span>

é—®é¢˜ï¼š
<span class="hljs-deletion">- Leaderæ²¡æœ‰æ—¥å¿—[101-10000]äº†</span>
<span class="hljs-deletion">- æ— æ³•é€šè¿‡æ—¥å¿—å¤åˆ¶è¿½ä¸Š</span>
</code></pre>
<h4 data-id="heading-29">è§£å†³ï¼šä¼ è¾“å¿«ç…§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Replicator</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendSnapshot</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. è·å–æœ€æ–°å¿«ç…§</span>
        <span class="hljs-type">Snapshot</span> <span class="hljs-variable">snapshot</span> <span class="hljs-operator">=</span> node.getSnapshot();
        
        <span class="hljs-comment">// å¿«ç…§åŒ…å«ï¼š</span>
        <span class="hljs-comment">// - lastIncludedIndex: 10000ï¼ˆå¿«ç…§åŒ…å«çš„æœ€åä¸€æ¡æ—¥å¿—ï¼‰</span>
        <span class="hljs-comment">// - lastIncludedTerm: 5</span>
        <span class="hljs-comment">// - data: çŠ¶æ€æœºçš„å®Œæ•´æ•°æ®ï¼ˆå¦‚æ‰€æœ‰é…ç½®ï¼‰</span>
        
        <span class="hljs-comment">// 2. åˆ†å—ä¼ è¾“ï¼ˆé¿å…å•æ¬¡RPCå¤ªå¤§ï¼‰</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">offset</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">chunkSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;  <span class="hljs-comment">// æ¯å—1MB</span>
        
        <span class="hljs-keyword">while</span> (offset &lt; snapshot.size()) {
            <span class="hljs-type">byte</span>[] chunk = snapshot.read(offset, chunkSize);
            
            <span class="hljs-type">InstallSnapshotRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstallSnapshotRequest</span>();
            request.setTerm(currentTerm);
            request.setLeaderId(nodeId);
            request.setLastIncludedIndex(snapshot.getLastIncludedIndex());
            request.setLastIncludedTerm(snapshot.getLastIncludedTerm());
            request.setOffset(offset);
            request.setData(chunk);
            request.setDone(offset + chunk.length &gt;= snapshot.size());
            
            <span class="hljs-type">InstallSnapshotResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> rpcService.installSnapshot(peer, request);
            
            <span class="hljs-keyword">if</span> (!response.isSuccess()) {
                logger.error(<span class="hljs-string">"å¿«ç…§ä¼ è¾“å¤±è´¥ï¼Œé‡è¯•"</span>);
                <span class="hljs-keyword">return</span>;
            }
            
            offset += chunk.length;
        }
        
        <span class="hljs-comment">// 3. å¿«ç…§ä¼ è¾“å®Œæˆï¼Œç»§ç»­ä»lastIncludedIndex+1å‘é€å¢é‡æ—¥å¿—</span>
        nextIndex = snapshot.getLastIncludedIndex() + <span class="hljs-number">1</span>;
        matchIndex = snapshot.getLastIncludedIndex();
        
        logger.info(<span class="hljs-string">"å¿«ç…§ä¼ è¾“å®Œæˆï¼Œä»index={}ç»§ç»­å‘é€å¢é‡æ—¥å¿—"</span>, nextIndex);
    }
}
</code></pre>
<h4 data-id="heading-30">Followerå¤„ç†å¿«ç…§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> InstallSnapshotResponse <span class="hljs-title function_">handleInstallSnapshot</span><span class="hljs-params">(InstallSnapshotRequest req)</span> {
    lock.lock();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 1. termæ£€æŸ¥</span>
        <span class="hljs-keyword">if</span> (req.getTerm() &lt; currentTerm) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstallSnapshotResponse</span>(currentTerm, <span class="hljs-literal">false</span>);
        }
        
        <span class="hljs-comment">// 2. å†™å…¥å¿«ç…§æ•°æ®åˆ°ä¸´æ—¶æ–‡ä»¶</span>
        snapshotWriter.write(req.getOffset(), req.getData());
        
        <span class="hljs-comment">// 3. å¦‚æœæ˜¯æœ€åä¸€å—</span>
        <span class="hljs-keyword">if</span> (req.isDone()) {
            <span class="hljs-comment">// åŠ è½½å¿«ç…§åˆ°çŠ¶æ€æœº</span>
            stateMachine.loadSnapshot(snapshotWriter.getFile());
            
            <span class="hljs-comment">// æ›´æ–°å…ƒæ•°æ®</span>
            lastApplied = req.getLastIncludedIndex();
            commitIndex = req.getLastIncludedIndex();
            
            <span class="hljs-comment">// æ¸…ç†è¢«å¿«ç…§è¦†ç›–çš„æ—¥å¿—</span>
            logStorage.truncateBefore(req.getLastIncludedIndex());
            
            logger.info(<span class="hljs-string">"å¿«ç…§åŠ è½½å®Œæˆï¼ŒlastApplied={}"</span>, lastApplied);
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InstallSnapshotResponse</span>(currentTerm, <span class="hljs-literal">true</span>);
        
    } <span class="hljs-keyword">finally</span> {
        lock.unlock();
    }
}
</code></pre>
<p>æ•ˆæœï¼š</p>
<pre><code class="hljs language-diff" lang="diff">ä¸ç”¨å¿«ç…§ï¼š
<span class="hljs-deletion">- ä¼ è¾“10000æ¡æ—¥å¿—</span>
<span class="hljs-deletion">- è€—æ—¶ï¼šå‡ åˆ†é’Ÿ</span>

ä½¿ç”¨å¿«ç…§ï¼š
<span class="hljs-deletion">- ä¼ è¾“å¿«ç…§æ–‡ä»¶ï¼ˆå‡è®¾50MBï¼‰</span>
<span class="hljs-deletion">- ä¼ è¾“1000æ¡å¢é‡æ—¥å¿—</span>
<span class="hljs-deletion">- è€—æ—¶ï¼šå‡ ç§’</span>

æ€§èƒ½æå‡ï¼šæ•°åå€
</code></pre>
<hr/>
<h2 data-id="heading-31">ä¸‰ã€é…ç½®ä¸­å¿ƒçš„å®ç°ç»†èŠ‚</h2>
<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²äº†é…ç½®ä¸­å¿ƒä¸ºä»€ä¹ˆç”¨CPæ¨¡å¼ï¼Œè¿™é‡Œçœ‹çœ‹å…·ä½“çš„å®ç°ç»†èŠ‚ã€‚</p>
<h3 data-id="heading-32">3.1 é…ç½®å†™å…¥çš„å®ç°ä»£ç </h3>
<p>å®¢æˆ·ç«¯å‘å¸ƒé…ç½®çš„å¤„ç†æµç¨‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigController</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RaftCore raftCore;
    
    <span class="hljs-meta">@PostMapping("/configs")</span>
    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">publishConfig</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ConfigInfo configInfo)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. æ„é€ Raftæ—¥å¿—</span>
            <span class="hljs-type">Log</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> Log.newBuilder()
                .setGroup(<span class="hljs-string">"naming_persistent_service_v2"</span>)
                .setOperation(<span class="hljs-string">"PUT"</span>)
                .setKey(buildKey(configInfo))
                .setData(ByteString.copyFrom(serialize(configInfo)))
                .build();
            
            <span class="hljs-comment">// 2. æäº¤ç»™Raftç»„ï¼ˆé˜»å¡ç­‰å¾…ï¼‰</span>
            CompletableFuture&lt;Response&gt; future = raftCore.commit(
                <span class="hljs-string">"naming_persistent_service_v2"</span>, 
                log
            );
            
            <span class="hljs-comment">// 3. ç­‰å¾…è¿‡åŠç¡®è®¤ï¼ˆè¶…æ—¶5ç§’ï¼‰</span>
            <span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> future.get(<span class="hljs-number">5000</span>, TimeUnit.MILLISECONDS);
            
            <span class="hljs-keyword">if</span> (response.getSuccess()) {
                <span class="hljs-keyword">return</span> Result.success(<span class="hljs-string">"é…ç½®å‘å¸ƒæˆåŠŸ"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"é…ç½®å‘å¸ƒå¤±è´¥: "</span> + response.getErrMsg());
            }
            
        } <span class="hljs-keyword">catch</span> (TimeoutException e) {
            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"é…ç½®å‘å¸ƒè¶…æ—¶ï¼Œé›†ç¾¤å¯èƒ½ä¸å¯ç”¨"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            logger.error(<span class="hljs-string">"é…ç½®å‘å¸ƒå¼‚å¸¸"</span>, e);
            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"é…ç½®å‘å¸ƒå¼‚å¸¸: "</span> + e.getMessage());
        }
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">buildKey</span><span class="hljs-params">(ConfigInfo configInfo)</span> {
        <span class="hljs-keyword">return</span> configInfo.getDataId() + <span class="hljs-string">"@@"</span> + configInfo.getGroup();
    }
}
</code></pre>
<h3 data-id="heading-33">3.2 Raftå±‚çš„å¤„ç†</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RaftCore</span> {
    
    <span class="hljs-comment">// æ¯ä¸ªRaftç»„å¯¹åº”ä¸€ä¸ªNode</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Node&gt; nodes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> CompletableFuture&lt;Response&gt; <span class="hljs-title function_">commit</span><span class="hljs-params">(String group, Log log)</span> {
        <span class="hljs-type">Node</span> <span class="hljs-variable">node</span> <span class="hljs-operator">=</span> nodes.get(group);
        <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Raftç»„ä¸å­˜åœ¨: "</span> + group);
        }
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ˜¯Leader</span>
        <span class="hljs-keyword">if</span> (!node.isLeader()) {
            <span class="hljs-comment">// è½¬å‘ç»™Leader</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">leader</span> <span class="hljs-operator">=</span> node.getLeaderId();
            <span class="hljs-keyword">return</span> redirectToLeader(leader, log);
        }
        
        <span class="hljs-comment">// Leaderå¤„ç†</span>
        CompletableFuture&lt;Response&gt; future = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>&lt;&gt;();
        
        <span class="hljs-comment">// 1. å†™å…¥æœ¬åœ°æ—¥å¿—</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> node.appendLog(log);
        
        <span class="hljs-comment">// 2. è§¦å‘æ—¥å¿—å¤åˆ¶ï¼ˆå¼‚æ­¥ï¼‰</span>
        node.triggerReplication();
        
        <span class="hljs-comment">// 3. ç­‰å¾…æäº¤</span>
        node.waitForCommit(index, future);
        
        <span class="hljs-keyword">return</span> future;
    }
}
</code></pre>
<p>Nodeçš„æ ¸å¿ƒå®ç°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LogStorage logStorage;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StateMachine stateMachine;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Replicator&gt; replicators;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> <span class="hljs-variable">commitIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> <span class="hljs-variable">lastApplied</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// ç­‰å¾…æäº¤çš„Future</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Long, CompletableFuture&lt;Response&gt;&gt; waitingCommits = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">appendLog</span><span class="hljs-params">(Log log)</span> {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ„é€ LogEntry</span>
            <span class="hljs-type">LogEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogEntry</span>();
            entry.setIndex(logStorage.getLastIndex() + <span class="hljs-number">1</span>);
            entry.setTerm(currentTerm);
            entry.setType(EntryType.OP_DATA);
            entry.setData(log.toByteArray());
            
            <span class="hljs-comment">// å†™å…¥æ—¥å¿—ï¼ˆä¼šè§¦å‘æ‰¹é‡å†™å…¥ä¼˜åŒ–ï¼‰</span>
            logStorage.appendEntry(entry);
            
            <span class="hljs-keyword">return</span> entry.getIndex();
            
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">triggerReplication</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// é€šçŸ¥æ‰€æœ‰Replicatorçº¿ç¨‹</span>
        <span class="hljs-keyword">for</span> (Replicator replicator : replicators.values()) {
            replicator.wakeup();
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">waitForCommit</span><span class="hljs-params">(<span class="hljs-type">long</span> index, CompletableFuture&lt;Response&gt; future)</span> {
        <span class="hljs-keyword">if</span> (index &lt;= commitIndex) {
            <span class="hljs-comment">// å·²ç»æäº¤äº†ï¼Œç›´æ¥è¿”å›</span>
            future.complete(Response.success());
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// æ³¨å†Œç­‰å¾…</span>
        waitingCommits.put(index, future);
        
        <span class="hljs-comment">// è®¾ç½®è¶…æ—¶</span>
        executor.schedule(() -&gt; {
            CompletableFuture&lt;Response&gt; f = waitingCommits.remove(index);
            <span class="hljs-keyword">if</span> (f != <span class="hljs-literal">null</span>) {
                f.complete(Response.fail(<span class="hljs-string">"æäº¤è¶…æ—¶"</span>));
            }
        }, <span class="hljs-number">5000</span>, TimeUnit.MILLISECONDS);
    }
    
    <span class="hljs-comment">// å½“commitIndexæ›´æ–°æ—¶è°ƒç”¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCommitIndexUpdate</span><span class="hljs-params">(<span class="hljs-type">long</span> newCommitIndex)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">oldCommitIndex</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.commitIndex;
        <span class="hljs-built_in">this</span>.commitIndex = newCommitIndex;
        
        <span class="hljs-comment">// åº”ç”¨åˆ°çŠ¶æ€æœº</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> lastApplied + <span class="hljs-number">1</span>; i &lt;= newCommitIndex; i++) {
            <span class="hljs-type">LogEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> logStorage.getEntry(i);
            <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span>) {
                stateMachine.apply(entry);
                lastApplied = i;
            }
        }
        
        <span class="hljs-comment">// é€šçŸ¥ç­‰å¾…çš„Future</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> oldCommitIndex + <span class="hljs-number">1</span>; i &lt;= newCommitIndex; i++) {
            CompletableFuture&lt;Response&gt; future = waitingCommits.remove(i);
            <span class="hljs-keyword">if</span> (future != <span class="hljs-literal">null</span>) {
                future.complete(Response.success());
            }
        }
    }
}
</code></pre>
<p>Nacosçš„é…ç½®æ•°æ®å­˜å‚¨åœ¨ä¸‰ä¸ªåœ°æ–¹ï¼š</p>
<h4 data-id="heading-34">1. Raftæ—¥å¿—</h4>
<pre><code class="hljs language-lua" lang="lua">ç›®å½•ï¼š/nacos/data/protocol/raft/<span class="hljs-built_in">log</span>/

æ–‡ä»¶ï¼š
- <span class="hljs-built_in">log</span><span class="hljs-number">-000001.</span><span class="hljs-built_in">log</span>
- <span class="hljs-built_in">log</span><span class="hljs-number">-000002.</span><span class="hljs-built_in">log</span>
- <span class="hljs-built_in">log</span><span class="hljs-number">-000003.</span><span class="hljs-built_in">log</span>

æ ¼å¼ï¼šäºŒè¿›åˆ¶ï¼Œè®°å½•æ‰€æœ‰å†™æ“ä½œ

ä½œç”¨ï¼š
- ç”¨äºæ—¥å¿—å¤åˆ¶
- ç”¨äºæ•…éšœæ¢å¤
- ç”¨äºå¿«ç…§ç”Ÿæˆ
</code></pre>
<h4 data-id="heading-35">2. å¿«ç…§</h4>
<pre><code class="hljs language-diff" lang="diff">ç›®å½•ï¼š/nacos/data/protocol/raft/snapshot/

æ–‡ä»¶ï¼š
<span class="hljs-deletion">- snapshot-000100.zip</span>
<span class="hljs-deletion">- snapshot-000200.zip</span>

å†…å®¹ï¼š
<span class="hljs-deletion">- é…ç½®æ•°æ®çš„å®Œæ•´å‰¯æœ¬</span>
<span class="hljs-deletion">- lastIncludedIndex</span>
<span class="hljs-deletion">- lastIncludedTerm</span>

è§¦å‘æ—¶æœºï¼š
<span class="hljs-deletion">- æ¯10000æ¡æ—¥å¿—ç”Ÿæˆä¸€æ¬¡</span>
<span class="hljs-deletion">- æˆ–æ‰‹åŠ¨è§¦å‘</span>

ä½œç”¨ï¼š
<span class="hljs-deletion">- åŠ é€Ÿå¯åŠ¨æ¢å¤</span>
<span class="hljs-deletion">- å‡å°‘æ—¥å¿—å ç”¨ç©ºé—´</span>
<span class="hljs-deletion">- ç”¨äºå¿«ç…§ä¼ è¾“</span>
</code></pre>
<h4 data-id="heading-36">3. Derbyæ•°æ®åº“</h4>
<pre><code class="hljs language-diff" lang="diff">ç›®å½•ï¼š/nacos/data/derby-data/

è¡¨ï¼š
<span class="hljs-deletion">- config_infoï¼šé…ç½®å†…å®¹</span>
<span class="hljs-deletion">- config_tags_relationï¼šé…ç½®æ ‡ç­¾</span>
<span class="hljs-deletion">- config_info_aggrï¼šèšåˆé…ç½®</span>
<span class="hljs-deletion">- config_info_betaï¼šç°åº¦é…ç½®</span>

ä½œç”¨ï¼š
<span class="hljs-deletion">- å¿«é€ŸæŸ¥è¯¢</span>
<span class="hljs-deletion">- æ”¯æŒSQLæŸ¥è¯¢</span>
<span class="hljs-deletion">- Webæ§åˆ¶å°å±•ç¤º</span>
</code></pre>
<h3 data-id="heading-37">3.3 å¯åŠ¨æ¢å¤æµç¨‹</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startRecover</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 1. åŠ è½½å¿«ç…§</span>
    <span class="hljs-type">Snapshot</span> <span class="hljs-variable">snapshot</span> <span class="hljs-operator">=</span> loadLatestSnapshot();
    <span class="hljs-keyword">if</span> (snapshot != <span class="hljs-literal">null</span>) {
        stateMachine.loadSnapshot(snapshot);
        lastApplied = snapshot.getLastIncludedIndex();
        commitIndex = snapshot.getLastIncludedIndex();
        logger.info(<span class="hljs-string">"åŠ è½½å¿«ç…§å®Œæˆï¼ŒlastApplied={}"</span>, lastApplied);
    }
    
    <span class="hljs-comment">// 2. é‡æ”¾å¿«ç…§ä¹‹åçš„å¢é‡æ—¥å¿—</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">startIndex</span> <span class="hljs-operator">=</span> lastApplied + <span class="hljs-number">1</span>;
    <span class="hljs-type">long</span> <span class="hljs-variable">lastLogIndex</span> <span class="hljs-operator">=</span> logStorage.getLastIndex();
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> startIndex; i &lt;= lastLogIndex; i++) {
        <span class="hljs-type">LogEntry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> logStorage.getEntry(i);
        <span class="hljs-keyword">if</span> (entry != <span class="hljs-literal">null</span> &amp;&amp; i &lt;= commitIndex) {
            <span class="hljs-comment">// é‡æ”¾å·²æäº¤çš„æ—¥å¿—</span>
            stateMachine.apply(entry);
            lastApplied = i;
        }
    }
    
    logger.info(<span class="hljs-string">"æ—¥å¿—é‡æ”¾å®Œæˆï¼ŒlastApplied={}"</span>, lastApplied);
    
    <span class="hljs-comment">// 3. å¯åŠ¨Raftç»„</span>
    raftNode.start();
    
    logger.info(<span class="hljs-string">"Nacosé…ç½®ä¸­å¿ƒå¯åŠ¨å®Œæˆ"</span>);
}
</code></pre>
<hr/>
<h2 data-id="heading-38">å››ã€ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ</h2>
<h3 data-id="heading-39">4.1 éƒ¨ç½²æ¶æ„</h3>
<h4 data-id="heading-40">å•æœºæˆ¿éƒ¨ç½²ï¼ˆ3èŠ‚ç‚¹ï¼‰</h4>
<pre><code class="hljs language-diff" lang="diff">é€‚ç”¨åœºæ™¯ï¼š
<span class="hljs-deletion">- æµ‹è¯•ç¯å¢ƒ</span>
<span class="hljs-deletion">- å°è§„æ¨¡ç”Ÿäº§ï¼ˆç”¨æˆ·é‡&lt;10ä¸‡ï¼‰</span>

éƒ¨ç½²æ–¹å¼ï¼š
Node1: 192.168.1.1:8848
Node2: 192.168.1.2:8848
Node3: 192.168.1.3:8848

å®¹é”™èƒ½åŠ›ï¼š
<span class="hljs-deletion">- å®¹å¿1ä¸ªèŠ‚ç‚¹æ•…éšœ</span>
<span class="hljs-deletion">- åŒæ—¶2ä¸ªèŠ‚ç‚¹æ•…éšœä¼šä¸å¯ç”¨</span>

é£é™©ï¼š
<span class="hljs-deletion">- æœºæˆ¿çº§æ•…éšœå¯¼è‡´ä¸å¯ç”¨</span>
</code></pre>
<h4 data-id="heading-41">åŒæœºæˆ¿éƒ¨ç½²ï¼ˆ5èŠ‚ç‚¹ï¼‰</h4>
<pre><code class="hljs language-diff" lang="diff">é€‚ç”¨åœºæ™¯ï¼š
<span class="hljs-deletion">- ä¸­å¤§è§„æ¨¡ç”Ÿäº§ï¼ˆç”¨æˆ·é‡&gt;10ä¸‡ï¼‰</span>
<span class="hljs-deletion">- å¯¹å¯ç”¨æ€§è¦æ±‚é«˜</span>

éƒ¨ç½²æ–¹å¼ï¼š
ä¸»æœºæˆ¿ï¼ˆ3èŠ‚ç‚¹ï¼‰ï¼š
  Node1: 192.168.1.1:8848
  Node2: 192.168.1.2:8848
  Node3: 192.168.1.3:8848

å¤‡æœºæˆ¿ï¼ˆ2èŠ‚ç‚¹ï¼‰ï¼š
  Node4: 192.168.2.1:8848
  Node5: 192.168.2.2:8848

å®¹é”™èƒ½åŠ›ï¼š
<span class="hljs-deletion">- å®¹å¿2ä¸ªèŠ‚ç‚¹æ•…éšœ</span>
<span class="hljs-deletion">- å•ä¸ªæœºæˆ¿æ•…éšœä»å¯ç”¨</span>

æ³¨æ„ï¼š
<span class="hljs-deletion">- ä¸»æœºæˆ¿3èŠ‚ç‚¹ï¼Œè¿‡åŠåœ¨ä¸»æœºæˆ¿</span>
<span class="hljs-deletion">- å¦‚æœä¸»æœºæˆ¿æ•…éšœï¼Œéœ€è¦æ‰‹åŠ¨åˆ‡æ¢</span>
</code></pre>
<h4 data-id="heading-42">ä¸‰æœºæˆ¿éƒ¨ç½²ï¼ˆ5èŠ‚ç‚¹ï¼Œæ¨èï¼‰</h4>
<pre><code class="hljs language-diff" lang="diff">é€‚ç”¨åœºæ™¯ï¼š
<span class="hljs-deletion">- æ ¸å¿ƒç³»ç»Ÿ</span>
<span class="hljs-deletion">- é‡‘èã€ç”µå•†ç­‰å…³é”®ä¸šåŠ¡</span>

éƒ¨ç½²æ–¹å¼ï¼š
æœºæˆ¿Aï¼ˆ2èŠ‚ç‚¹ï¼‰ï¼š
  Node1: 192.168.1.1:8848
  Node2: 192.168.1.2:8848

æœºæˆ¿Bï¼ˆ2èŠ‚ç‚¹ï¼‰ï¼š
  Node3: 192.168.2.1:8848
  Node4: 192.168.2.2:8848

æœºæˆ¿Cï¼ˆ1èŠ‚ç‚¹ï¼‰ï¼š
  Node5: 192.168.3.1:8848

å®¹é”™èƒ½åŠ›ï¼š
<span class="hljs-deletion">- å®¹å¿ä»»æ„1ä¸ªæœºæˆ¿æ•…éšœ</span>
<span class="hljs-deletion">- å®¹å¿2ä¸ªèŠ‚ç‚¹æ•…éšœ</span>

ä¼˜åŠ¿ï¼š
<span class="hljs-deletion">- ä»»æ„1ä¸ªæœºæˆ¿æ•…éšœï¼Œå‰©ä½™4ä¸ªèŠ‚ç‚¹è¿‡åŠ</span>
<span class="hljs-deletion">- æ— éœ€æ‰‹åŠ¨åˆ‡æ¢ï¼Œè‡ªåŠ¨æ•…éšœè½¬ç§»</span>
</code></pre>
<h3 data-id="heading-43">4.2 é…ç½®ä¼˜åŒ–</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.properties</span>

<span class="hljs-comment"># Rafté€‰ä¸¾è¶…æ—¶ï¼ˆæ ¹æ®ç½‘ç»œå»¶è¿Ÿè°ƒæ•´ï¼‰</span>
<span class="hljs-string">nacos.core.protocol.raft.data.election_timeout_ms=5000</span>

<span class="hljs-comment"># å¿«ç…§ç”Ÿæˆé—´éš”ï¼ˆæ ¹æ®é…ç½®å˜æ›´é¢‘ç‡è°ƒæ•´ï¼‰</span>
<span class="hljs-string">nacos.core.protocol.raft.data.snapshot_interval_secs=1800</span>

<span class="hljs-comment"># æ‰¹é‡å¤§å°ï¼ˆæ ¹æ®ç½‘ç»œå¸¦å®½è°ƒæ•´ï¼‰</span>
<span class="hljs-string">nacos.core.protocol.raft.data.max_entries_size=1024</span>

<span class="hljs-comment"># Pipelineæ·±åº¦ï¼ˆæ ¹æ®å†…å­˜å¤§å°è°ƒæ•´ï¼‰</span>
<span class="hljs-string">nacos.core.protocol.raft.data.max_replicator_inflight_msgs=256</span>

<span class="hljs-comment"># æ—¥å¿—ä¿ç•™æ—¶é—´ï¼ˆæ ¹æ®ç£ç›˜ç©ºé—´è°ƒæ•´ï¼‰</span>
<span class="hljs-string">nacos.core.protocol.raft.data.log_retention_hours=72</span>

<span class="hljs-comment"># å¼‚æ­¥åˆ·ç›˜ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼Œä½†æœ‰ä¸¢æ•°æ®é£é™©ï¼‰</span>
<span class="hljs-string">nacos.core.protocol.raft.data.sync=false</span>

<span class="hljs-comment"># JVMå‚æ•°</span>
<span class="hljs-string">-Xms4g</span> <span class="hljs-string">-Xmx4g</span>
<span class="hljs-string">-XX:+UseG1GC</span>
<span class="hljs-string">-XX:MaxGCPauseMillis=200</span>
</code></pre>
<h3 data-id="heading-44">4.3 ç›‘æ§å‘Šè­¦</h3>
<h4 data-id="heading-45">å…³é”®æŒ‡æ ‡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æš´éœ²çš„ç›‘æ§æŒ‡æ ‡</span>
GET /nacos/v1/raft/state

{
  <span class="hljs-string">"self"</span>: <span class="hljs-string">"192.168.1.1:8848"</span>,
  <span class="hljs-string">"term"</span>: <span class="hljs-number">12345</span>,
  <span class="hljs-string">"leader"</span>: <span class="hljs-string">"192.168.1.1:8848"</span>,
  <span class="hljs-string">"raftState"</span>: <span class="hljs-string">"LEADER"</span>,
  <span class="hljs-string">"peers"</span>: [
    {
      <span class="hljs-string">"ip"</span>: <span class="hljs-string">"192.168.1.2:8848"</span>,
      <span class="hljs-string">"raftState"</span>: <span class="hljs-string">"FOLLOWER"</span>,
      <span class="hljs-string">"lastLogIndex"</span>: <span class="hljs-number">100000</span>,
      <span class="hljs-string">"matchIndex"</span>: <span class="hljs-number">99999</span>,
      <span class="hljs-string">"lag"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-string">"healthy"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">"nextReplicateTime"</span>: <span class="hljs-number">50</span>
    },
    {
      <span class="hljs-string">"ip"</span>: <span class="hljs-string">"192.168.1.3:8848"</span>,
      <span class="hljs-string">"raftState"</span>: <span class="hljs-string">"FOLLOWER"</span>,
      <span class="hljs-string">"lastLogIndex"</span>: <span class="hljs-number">95000</span>,
      <span class="hljs-string">"matchIndex"</span>: <span class="hljs-number">95000</span>,
      <span class="hljs-string">"lag"</span>: <span class="hljs-number">5000</span>,
      <span class="hljs-string">"healthy"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-string">"warning"</span>: <span class="hljs-string">"lag too much"</span>
    }
  ]
}
</code></pre>
<h4 data-id="heading-46">å‘Šè­¦è§„åˆ™</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> Leaderç¼ºå¤±
   æ¡ä»¶ï¼šé›†ç¾¤æ²¡æœ‰Leaderè¶…è¿‡30ç§’
   çº§åˆ«ï¼šP0ï¼ˆè‡´å‘½ï¼‰
   å½±å“ï¼šé…ç½®æ— æ³•å†™å…¥
   å¤„ç†ï¼šæ£€æŸ¥ç½‘ç»œã€é‡å¯èŠ‚ç‚¹

<span class="hljs-bullet">2.</span> èŠ‚ç‚¹ä¸å¥åº·
   æ¡ä»¶ï¼šFollowerå¿ƒè·³è¶…æ—¶è¶…è¿‡1åˆ†é’Ÿ
   çº§åˆ«ï¼šP1ï¼ˆä¸¥é‡ï¼‰
   å½±å“ï¼šå®¹é”™èƒ½åŠ›ä¸‹é™
   å¤„ç†ï¼šæ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€ï¼Œå‡†å¤‡æ›¿æ¢

<span class="hljs-bullet">3.</span> èŠ‚ç‚¹è½å
   æ¡ä»¶ï¼šlag &gt; 10000æ¡
   çº§åˆ«ï¼šP2ï¼ˆè­¦å‘Šï¼‰
   å½±å“ï¼šæ¢å¤æ—¶é—´å¯èƒ½è¿‡é•¿
   å¤„ç†ï¼šæ£€æŸ¥ç½‘ç»œã€ç£ç›˜IO

<span class="hljs-bullet">4.</span> å†™å…¥å»¶è¿Ÿé«˜
   æ¡ä»¶ï¼šP99å»¶è¿Ÿ &gt; 500ms
   çº§åˆ«ï¼šP2ï¼ˆè­¦å‘Šï¼‰
   å½±å“ï¼šç”¨æˆ·ä½“éªŒå·®
   å¤„ç†ï¼šæ£€æŸ¥CPUã€ç½‘ç»œã€ç£ç›˜

<span class="hljs-bullet">5.</span> æ—¥å¿—å¢é•¿è¿‡å¿«
   æ¡ä»¶ï¼š1å°æ—¶å†…æ—¥å¿—å¢é•¿ &gt; 100000æ¡
   çº§åˆ«ï¼šP3ï¼ˆæç¤ºï¼‰
   å½±å“ï¼šç£ç›˜ç©ºé—´
   å¤„ç†ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é…ç½®å˜æ›´å¼‚å¸¸
</code></pre>
<h3 data-id="heading-47">4.4 æ•…éšœå¤„ç†</h3>
<h4 data-id="heading-48">åœºæ™¯1ï¼šå•èŠ‚ç‚¹å®•æœº</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç°è±¡ï¼š
<span class="hljs-bullet">-</span> æŸä¸ªFollowerå®•æœº
<span class="hljs-bullet">-</span> é›†ç¾¤ä»æœ‰Leader
<span class="hljs-bullet">-</span> é…ç½®è¯»å†™æ­£å¸¸

å¤„ç†ï¼š
<span class="hljs-bullet">1.</span> ä¸è¦ç«‹å³æ“ä½œï¼ˆå¯èƒ½åªæ˜¯é‡å¯ï¼‰
<span class="hljs-bullet">2.</span> è§‚å¯Ÿ1-2å°æ—¶
<span class="hljs-bullet">3.</span> å¦‚æœæœªæ¢å¤ï¼Œæ£€æŸ¥åŸå› ï¼š
<span class="hljs-bullet">   -</span> ç¡¬ä»¶æ•…éšœï¼Ÿ
<span class="hljs-bullet">   -</span> è¿›ç¨‹å´©æºƒï¼Ÿ
<span class="hljs-bullet">   -</span> ç½‘ç»œéš”ç¦»ï¼Ÿ
<span class="hljs-bullet">4.</span> ç¡®è®¤æ— æ³•æ¢å¤åï¼Œå¯åŠ¨å¤‡ç”¨èŠ‚ç‚¹
<span class="hljs-bullet">5.</span> æ–°èŠ‚ç‚¹ä¼šè‡ªåŠ¨åŒæ­¥æ•°æ®

æ³¨æ„ï¼š
<span class="hljs-bullet">-</span> ä¸è¦æ‰‹åŠ¨åˆ‡æ¢Leader
<span class="hljs-bullet">-</span> ä¸è¦åˆ é™¤å®•æœºèŠ‚ç‚¹çš„æ•°æ®
</code></pre>
<h4 data-id="heading-49">åœºæ™¯2ï¼šLeaderé¢‘ç¹åˆ‡æ¢</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç°è±¡ï¼š
<span class="hljs-bullet">-</span> Leaderæ¯éš”å‡ åˆ†é’Ÿå°±æ¢ä¸€æ¬¡
<span class="hljs-bullet">-</span> æ—¥å¿—å¤§é‡é€‰ä¸¾è®°å½•
<span class="hljs-bullet">-</span> é…ç½®å†™å…¥å¤±è´¥

åŸå› åˆ†æï¼š
<span class="hljs-bullet">1.</span> ç½‘ç»œä¸ç¨³å®š
<span class="hljs-bullet">   -</span> æ£€æŸ¥ï¼špingã€traceroute
<span class="hljs-bullet">   -</span> å¤„ç†ï¼šä¼˜åŒ–ç½‘ç»œã€å¢å¤§election<span class="hljs-emphasis">_timeout

2. Leaderè´Ÿè½½è¿‡é«˜
   - æ£€æŸ¥ï¼šCPUã€å†…å­˜ã€GCæ—¥å¿—
   - å¤„ç†ï¼šæ‰©å®¹ã€ä¼˜åŒ–JVMå‚æ•°

3. ç£ç›˜IOæ…¢
   - æ£€æŸ¥ï¼šiostatã€iotop
   - å¤„ç†ï¼šæ¢SSDã€ä¼˜åŒ–fsyncç­–ç•¥

4. æ—¶é’Ÿæ¼‚ç§»
   - æ£€æŸ¥ï¼šntpdate
   - å¤„ç†ï¼šé…ç½®NTPåŒæ­¥
</span></code></pre>
<h4 data-id="heading-50">åœºæ™¯3ï¼šè„‘è£‚é£é™©</h4>
<pre><code class="hljs language-diff" lang="diff">åœºæ™¯ï¼š
ç½‘ç»œåˆ†åŒºï¼Œé›†ç¾¤åˆ†ä¸ºä¸¤éƒ¨åˆ†
<span class="hljs-deletion">- åŒºåŸŸAï¼šNode1</span>
<span class="hljs-deletion">- åŒºåŸŸBï¼šNode2ã€Node3</span>

Raftçš„å¤„ç†ï¼š
<span class="hljs-deletion">- åŒºåŸŸAï¼š1/3ï¼Œæ— æ³•è¿‡åŠï¼Œæ‹’ç»å†™å…¥</span>
<span class="hljs-deletion">- åŒºåŸŸBï¼š2/3ï¼Œè¿‡åŠï¼ŒNode2æˆ–Node3å½“é€‰Leader</span>

ç»“æœï¼š
<span class="hljs-deletion">- åªæœ‰åŒºåŸŸBèƒ½å†™å…¥é…ç½®</span>
<span class="hljs-deletion">- ä¸ä¼šå‡ºç°ä¸¤ä¸ªLeader</span>
<span class="hljs-deletion">- ç½‘ç»œæ¢å¤åï¼ŒåŒºåŸŸAè‡ªåŠ¨åŒæ­¥</span>

é¢„é˜²æªæ–½ï¼š
<span class="hljs-deletion">- è·¨æœºæˆ¿éƒ¨ç½²</span>
<span class="hljs-deletion">- è‡³å°‘3ä¸ªå¯ç”¨åŒº</span>
<span class="hljs-deletion">- ä¸è¦2ä¸ªæœºæˆ¿å„50%èŠ‚ç‚¹</span>
</code></pre>
<hr/>
<h2 data-id="heading-51">äº”ã€æ€»ç»“</h2>
<h3 data-id="heading-52">æ ¸å¿ƒè¦ç‚¹</h3>
<p><strong>1. Raftçš„ç»†èŠ‚é—®é¢˜</strong></p>
<pre><code class="hljs language-diff" lang="diff">åªèƒ½æäº¤å½“å‰termçš„æ—¥å¿—ï¼š
<span class="hljs-deletion">- é˜²æ­¢å·²æäº¤æ•°æ®ä¸¢å¤±</span>
<span class="hljs-deletion">- é€šè¿‡å†™æ–°æ—¥å¿—é—´æ¥æäº¤æ—§æ—¥å¿—</span>

ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆprevLogIndex/prevLogTermï¼‰ï¼š
<span class="hljs-deletion">- é€’å½’ä¿è¯æ—¥å¿—åºåˆ—å®Œå…¨ä¸€è‡´</span>
<span class="hljs-deletion">- å‘ç°å†²çªç«‹å³æˆªæ–­é‡å»º</span>

Termæœºåˆ¶ï¼š
<span class="hljs-deletion">- é˜²æ­¢è„‘è£‚</span>
<span class="hljs-deletion">- åŒºåˆ†æ–°è€Leader</span>
<span class="hljs-deletion">- æ‹’ç»è¿‡æœŸè¯·æ±‚</span>
</code></pre>
<p><strong>2. JRaftçš„æ€§èƒ½ä¼˜åŒ–</strong></p>
<pre><code class="hljs language-diff" lang="diff">Pipelineæ‰¹é‡å¤åˆ¶ï¼š
<span class="hljs-deletion">- 256æ‰¹åŒæ—¶ä¼ è¾“</span>
<span class="hljs-deletion">- æ€§èƒ½æå‡10å€</span>

æ‰¹é‡å†™å…¥ï¼š
<span class="hljs-deletion">- 32æ¡æ—¥å¿—ä¸€æ¬¡fsync</span>
<span class="hljs-deletion">- æ€§èƒ½æå‡16-32å€</span>

åŠ¨æ€åŠ é€Ÿï¼š
<span class="hljs-deletion">- æ ¹æ®è½åç¨‹åº¦è‡ªé€‚åº”</span>
<span class="hljs-deletion">- æ€§èƒ½æå‡5-50å€</span>

å¿«ç…§ä¼ è¾“ï¼š
<span class="hljs-deletion">- è·³è¿‡å¤§é‡å†å²æ—¥å¿—</span>
<span class="hljs-deletion">- æ€§èƒ½æå‡æ•°åå€</span>
</code></pre>
<p><strong>3. ç”Ÿäº§ç¯å¢ƒå®è·µ</strong></p>
<pre><code class="hljs language-diff" lang="diff">éƒ¨ç½²æ¶æ„ï¼š
<span class="hljs-deletion">- æµ‹è¯•ç¯å¢ƒï¼š3èŠ‚ç‚¹å•æœºæˆ¿</span>
<span class="hljs-deletion">- ç”Ÿäº§ç¯å¢ƒï¼š5èŠ‚ç‚¹ä¸‰æœºæˆ¿</span>
<span class="hljs-deletion">- æ ¸å¿ƒç³»ç»Ÿï¼š7èŠ‚ç‚¹è·¨åœ°åŸŸ</span>

é…ç½®ä¼˜åŒ–ï¼š
<span class="hljs-deletion">- æ ¹æ®åœºæ™¯è°ƒæ•´å‚æ•°</span>
<span class="hljs-deletion">- æ‰¹é‡å¤§å°ã€Pipelineæ·±åº¦</span>
<span class="hljs-deletion">- å¿«ç…§é—´éš”ã€æ—¥å¿—ä¿ç•™</span>

ç›‘æ§å‘Šè­¦ï¼š
<span class="hljs-deletion">- LeaderçŠ¶æ€</span>
<span class="hljs-deletion">- èŠ‚ç‚¹å¥åº·</span>
<span class="hljs-deletion">- å¤åˆ¶å»¶è¿Ÿ</span>
<span class="hljs-deletion">- å†™å…¥æ€§èƒ½</span>
</code></pre>
<h3 data-id="heading-53">å†™åœ¨æœ€å</h3>
<p>JRafté€šè¿‡ä¸€ç³»åˆ—å·¥ç¨‹ä¼˜åŒ–ï¼Œåœ¨ä¿è¯Raftåè®®æ­£ç¡®æ€§çš„å‰æä¸‹ï¼Œå¤§å¹…æå‡äº†æ€§èƒ½ï¼š</p>
<ul>
<li>Pipelineè®©æ—¥å¿—å¤åˆ¶å¿«äº†10å€</li>
<li>æ‰¹é‡å†™å…¥è®©fsyncå¼€é”€é™ä½äº†32å€</li>
<li>åŠ¨æ€åŠ é€Ÿè®©è½åèŠ‚ç‚¹è¿½èµ¶å¿«äº†50å€</li>
<li>å¿«ç…§ä¼ è¾“è§£å†³äº†å¤§è§„æ¨¡æ•°æ®åŒæ­¥é—®é¢˜</li>
</ul>
<p>è¿™äº›ä¼˜åŒ–ä¸æ”¹å˜Raftçš„æ ¸å¿ƒç®—æ³•ï¼Œè€Œæ˜¯åœ¨å®ç°å±‚é¢åšæ–‡ç« ã€‚è¿™ä¹Ÿæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å®è·µçš„ç²¾é«“ï¼š</p>
<p><strong>ç†è®ºä¿è¯æ­£ç¡®æ€§ï¼Œå·¥ç¨‹è¿½æ±‚æ€§èƒ½ã€‚</strong></p>
<p>å¦‚æœä½ åœ¨åšåˆ†å¸ƒå¼ä¸­é—´ä»¶å¼€å‘ã€æˆ–è€…æƒ³æ·±å…¥ç†è§£Raftï¼Œå¸Œæœ›è¿™ä¸¤ç¯‡æ–‡ç« èƒ½å¸®åˆ°ä½ ã€‚</p>
<hr/>
<h2 data-id="heading-54">å‚è€ƒèµ„æ–™</h2>
<ul>
<li>Raftè®ºæ–‡ï¼šIn Search of an Understandable Consensus Algorithm</li>
<li>SOFAJRaftæºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsofastack%2Fsofa-jraft" target="_blank" title="https://github.com/sofastack/sofa-jraft" ref="nofollow noopener noreferrer">github.com/sofastack/sâ€¦</a></li>
<li>Nacoså®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fnacos.io%2Fzh-cn%2Fdocs%2Fwhat-is-nacos.html" target="_blank" title="https://nacos.io/zh-cn/docs/what-is-nacos.html" ref="nofollow noopener noreferrer">nacos.io/zh-cn/docs/â€¦</a></li>
<li>etcdçš„Raftå®ç°ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fetcd-io%2Fetcd" target="_blank" title="https://github.com/etcd-io/etcd" ref="nofollow noopener noreferrer">github.com/etcd-io/etcâ€¦</a></li>
</ul>
<hr/>
<p><strong>æœ¬æ–‡å®Œ</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React ä¸­çš„ JSX ä¸ç»„ä»¶åŒ–å¼€å‘ï¼šä»¥å‡½æ•°ä¸ºå•ä½æ„å»ºç°ä»£å‰ç«¯åº”ç”¨]]></title>    <link>https://juejin.cn/post/7584651851904843795</link>    <guid>https://juejin.cn/post/7584651851904843795</guid>    <pubDate>2025-12-17T11:13:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584651851904843795" data-draft-id="7584651851904794643" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React ä¸­çš„ JSX ä¸ç»„ä»¶åŒ–å¼€å‘ï¼šä»¥å‡½æ•°ä¸ºå•ä½æ„å»ºç°ä»£å‰ç«¯åº”ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯,React.js,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-17T11:13:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Tzarevich"/> <meta itemprop="url" content="https://juejin.cn/user/578786070367529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React ä¸­çš„ JSX ä¸ç»„ä»¶åŒ–å¼€å‘ï¼šä»¥å‡½æ•°ä¸ºå•ä½æ„å»ºç°ä»£å‰ç«¯åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578786070367529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Tzarevich
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T11:13:53.000Z" title="Wed Dec 17 2025 11:13:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">React ä¸­çš„ JSX ä¸ç»„ä»¶åŒ–å¼€å‘ï¼šä»¥å‡½æ•°ä¸ºå•ä½æ„å»ºç°ä»£å‰ç«¯åº”ç”¨</h2>
<p>åœ¨ç°ä»£å‰ç«¯å·¥ç¨‹ä¸­ï¼ŒReact ä»¥å…¶ç‹¬ç‰¹çš„ç†å¿µå’Œå¼ºå¤§çš„ç”Ÿæ€ä½“ç³»ï¼Œæˆä¸ºä¼—å¤šå¼€å‘è€…é¦–é€‰çš„ UI æ„å»ºæ¡†æ¶ã€‚è€Œå…¶ä¸­æœ€æ ¸å¿ƒã€æœ€å…·æ ‡å¿—æ€§çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œä¾¿æ˜¯ <strong>JSX</strong>ï¼ˆJavaScript XMLï¼‰è¯­æ³•ä¸ <strong>ç»„ä»¶åŒ–å¼€å‘æ€æƒ³</strong> çš„æ·±åº¦èåˆã€‚æœ¬æ–‡å°†å›´ç»•è¿™ä¸¤ä¸ªå…³é”®ç‚¹ï¼Œæ·±å…¥æ¢è®¨ React å¦‚ä½•é€šè¿‡â€œå‡½æ•°å³ç»„ä»¶â€çš„èŒƒå¼ï¼Œå½»åº•æ”¹å˜æˆ‘ä»¬æ„å»ºç”¨æˆ·ç•Œé¢çš„æ–¹å¼ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€JSXï¼šåœ¨ JavaScript ä¸­ä¹¦å†™ HTML</h3>
<p>JSX æ˜¯ React çš„æ¨¡æ¿è¯­æ³•æ‰©å±•ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨ JavaScript ä»£ç ä¸­ç›´æ¥ç¼–å†™ç±»ä¼¼ HTML çš„ç»“æ„ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">element</span> = &lt;h1&gt;Hello, React!&lt;/h1&gt;<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™è¡Œä»£ç çœ‹èµ·æ¥åƒ HTMLï¼Œä½†å®ƒå®é™…ä¸Šæ˜¯ JavaScript çš„è¯­æ³•ç³–ã€‚JSX æœ€ç»ˆä¼šè¢« Babel ç­‰ç¼–è¯‘å·¥å…·è½¬æ¢ä¸º <code>React.createElement()</code> è°ƒç”¨ï¼Œä»è€Œç”Ÿæˆè™šæ‹Ÿ DOM èŠ‚ç‚¹ã€‚</p>
<h4 data-id="heading-2">JSX çš„ä¼˜åŠ¿ï¼š</h4>
<ul>
<li><strong>ç›´è§‚æ¸…æ™°</strong>ï¼šå¼€å‘è€…å¯ä»¥åƒå†™ HTML ä¸€æ ·ç»„ç»‡ UI ç»“æ„ï¼Œé™ä½è®¤çŸ¥è´Ÿæ‹…ã€‚</li>
<li><strong>é€»è¾‘ä¸è§†å›¾èåˆ</strong>ï¼šä¸å†éœ€è¦åœ¨æ¨¡æ¿å’Œé€»è¾‘ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œæ‰€æœ‰å†…å®¹éƒ½åœ¨åŒä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸå†…ã€‚</li>
<li><strong>ç±»å‹å®‰å…¨ä¸é™æ€åˆ†æ</strong>ï¼šé…åˆ TypeScriptï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸæ•è·æ½œåœ¨é”™è¯¯ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useState, createElement } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./App.css'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">"vue"</span>);
    <span class="hljs-keyword">const</span> [todos, setTodos] = <span class="hljs-title function_">useState</span>([...]);
    <span class="hljs-keyword">const</span> [isLoggedIn, setIsLoggedIn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
    
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">setName</span>(<span class="hljs-string">"react"</span>);
    }, <span class="hljs-number">3000</span>);
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleLogin</span> = (<span class="hljs-params"/>) =&gt; {
        <span class="hljs-title function_">setIsLoggedIn</span>(!isLoggedIn);
    };
    
    <span class="hljs-keyword">const</span> element = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>JSX æ˜¯ React ä¸­ç”¨äºæè¿°ç”¨æˆ·ç•Œé¢çš„è¯­æ³•æ‰©å±•ã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></span>;
    <span class="hljs-keyword">const</span> element2 = <span class="hljs-title function_">createElement</span>(<span class="hljs-string">'h2'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'JSX æ˜¯ React ä¸­ç”¨äºæè¿°ç”¨æˆ·ç•Œé¢çš„è¯­æ³•æ‰©å±•ã€‚'</span>);

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span> 
            {element}
            {element2}
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"title"</span>&gt;</span>{name}!<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            {
                todos.length &gt; 0 ? (
                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
                        {todos.map((todo) =&gt; (
                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{todo.id}</span>&gt;</span>{todo.title}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                        ))}
                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span> 
                ) : (<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æš‚æ— å¾…åŠäº‹é¡¹<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>)
            }
            {isLoggedIn ? <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å·²ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> : <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>æœªç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}   
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{toggleLogin}</span>&gt;</span>
                {isLoggedIn ? "é€€å‡ºç™»å½•" : "ç™»å½•"}
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
    );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<blockquote>
<p>æ­£å¦‚ä½ æ‰€è§ï¼Œåœ¨è¿™ä¸²ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…å†™äº† <code>&lt;h1&gt;</code>ï¼Œè¿˜èƒ½åµŒå…¥ JavaScript è¡¨è¾¾å¼ï¼ˆå¦‚ <code>{name}</code>ï¼‰ã€æ¡ä»¶æ¸²æŸ“ï¼ˆ<code>isLoggedIn ? ... : ...</code>ï¼‰ä»¥åŠåˆ—è¡¨æ˜ å°„ï¼ˆ<code>todos.map(...)</code>ï¼‰ã€‚è¿™ç§â€œXML in JSâ€ï¼ˆå³ JSXï¼‰çš„è®¾è®¡ï¼Œè®© UI å¼€å‘å˜å¾—æå…¶çµæ´»ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">äºŒã€ç»„ä»¶åŒ–ï¼šä»â€œç Œç –â€åˆ°â€œæ­ç§¯æœ¨â€</h3>
<p>ä¼ ç»Ÿå‰ç«¯å¼€å‘ä¸­ï¼ŒHTML æ˜¯ç»“æ„ã€CSS æ˜¯æ ·å¼ã€JavaScript æ˜¯è¡Œä¸ºâ€”â€”ä¸‰è€…åˆ†ç¦»ï¼Œå¦‚åŒâ€œä¸‰æ˜æ²»â€ã€‚è€Œ React åˆ™é‡‡å–äº†æˆªç„¶ä¸åŒçš„æ€è·¯ï¼š<strong>ä¸€åˆ‡çš†ç»„ä»¶</strong>ã€‚</p>
<h4 data-id="heading-4">ä»€ä¹ˆæ˜¯ç»„ä»¶ï¼Ÿ</h4>
<p>åœ¨ React ä¸­ï¼Œ<strong>ç»„ä»¶å°±æ˜¯ä¸€ä¸ªè¿”å› JSX çš„ JavaScript å‡½æ•°</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">JuejinHeader</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Juejiné¦–é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span>
  );
}
</code></pre>
<p>è¿™ä¸ªå‡½æ•°å°±æ˜¯ç»„ä»¶ã€‚å®ƒå°è£…äº†ç‰¹å®šçš„ UI ç‰‡æ®µåŠå…¶ç›¸å…³é€»è¾‘ï¼Œå¯ç‹¬ç«‹å¼€å‘ã€æµ‹è¯•å’Œå¤ç”¨ã€‚</p>
<h4 data-id="heading-5">ç»„ä»¶åŒ–å¸¦æ¥çš„å˜é©ï¼š</h4>
<ul>
<li><strong>åˆ†å·¥æ˜ç¡®</strong>ï¼šå¤§å‹é¡µé¢è¢«æ‹†è§£ä¸ºå¤šä¸ªå°ç»„ä»¶ï¼ˆå¦‚ <code>&lt;Checkin /&gt;</code>ã€<code>&lt;TopArticles /&gt;</code>ï¼‰ï¼Œå›¢é˜Ÿåä½œæ›´é«˜æ•ˆã€‚</li>
<li><strong>ç»„åˆä¼˜äºç»§æ‰¿</strong>ï¼šé€šè¿‡åµŒå¥—å’Œç»„åˆç»„ä»¶ï¼ˆå¦‚ <code>App</code> ä¸­ç»„åˆ <code>JuejinHeader</code>ã€<code>Articles</code> ç­‰ï¼‰ï¼Œæ„å»ºå¤æ‚ç•Œé¢å¦‚åŒâ€œæ­ç§¯æœ¨â€ã€‚</li>
<li><strong>çŠ¶æ€é©±åŠ¨æ›´æ–°</strong>ï¼šå€ŸåŠ© <code>useState</code> ç­‰ Hookï¼Œç»„ä»¶èƒ½å“åº”æ•°æ®å˜åŒ–è‡ªåŠ¨é‡æ–°æ¸²æŸ“ï¼Œå®ç°å“åº”å¼ UIã€‚</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">JuejinHeader</span>(<span class="hljs-params"/>) {<span class="hljs-keyword">return</span> (...)}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Articles</span>(<span class="hljs-params"/>) {<span class="hljs-keyword">return</span> (...)}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Checkin</span>(<span class="hljs-params"/>) {<span class="hljs-keyword">return</span> (...)}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">TopArticles</span>(<span class="hljs-params"/>) {<span class="hljs-keyword">return</span> (...)}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">JuejinHeader</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Articles</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aside</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Checkin</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">TopArticles</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>
</code></pre>
<blockquote>
<p>åœ¨è¿™ä¸²ä»£ç ä¸­ï¼Œæ ¹ç»„ä»¶ <code>App</code> å¹¶ä¸ç›´æ¥å†™æ‰€æœ‰ HTMLï¼Œè€Œæ˜¯é€šè¿‡è°ƒç”¨å­ç»„ä»¶æ¥ç»„è£…é¡µé¢ã€‚è¿™ç§â€œè‡ªä¸Šè€Œä¸‹â€çš„ç»„ä»¶æ ‘ç»“æ„ï¼Œæ­£æ˜¯ React åº”ç”¨çš„æ ¸å¿ƒéª¨æ¶ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-6">ä¸‰ã€å‡½æ•°å³ç»„ä»¶ï¼šç®€æ´è€Œå¼ºå¤§çš„æŠ½è±¡</h3>
<p>React çš„å‡½æ•°å¼ç»„ä»¶ï¼ˆFunction Componentï¼‰æ˜¯å…¶å“²å­¦çš„é›†ä¸­ä½“ç°ï¼š</p>
<ul>
<li><strong>è½»é‡</strong>ï¼šæ— éœ€ç±»ã€ç”Ÿå‘½å‘¨æœŸç­‰å¤æ‚æ¦‚å¿µï¼Œä¸€ä¸ªæ™®é€šå‡½æ•°å³å¯æˆä¸ºç»„ä»¶ã€‚</li>
<li><strong>çº¯å‡½æ•°å€¾å‘</strong>ï¼šç†æƒ³æƒ…å†µä¸‹ï¼Œç»„ä»¶æ¥æ”¶ propsï¼Œè¿”å› UIï¼Œæ— å‰¯ä½œç”¨ï¼Œæ˜“äºæ¨ç†å’Œæµ‹è¯•ã€‚</li>
<li><strong>Hook èµ‹èƒ½</strong>ï¼šé€šè¿‡ <code>useState</code>ã€<code>useEffect</code> ç­‰ Hookï¼Œå‡½æ•°ç»„ä»¶ä¹Ÿèƒ½æ‹¥æœ‰çŠ¶æ€å’Œå‰¯ä½œç”¨å¤„ç†èƒ½åŠ›ï¼Œåª²ç¾ç±»ç»„ä»¶ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">const <span class="hljs-selector-attr">[name, setName]</span> = <span class="hljs-built_in">useState</span>("vue");
<span class="hljs-built_in">setTimeout</span>(() =&gt; <span class="hljs-built_in">setName</span>("react"), <span class="hljs-number">3000</span>);
</code></pre>
<p>çŸ­çŸ­å‡ è¡Œä»£ç ï¼Œå°±å®ç°äº†çŠ¶æ€åˆå§‹åŒ–ä¸å¼‚æ­¥æ›´æ–°ï¼ŒUI è‡ªåŠ¨å“åº”å˜åŒ–â€”â€”è¿™æ­£æ˜¯ React å“åº”å¼æ•°æ®ç»‘å®šçš„ä½“ç°ã€‚</p>
<hr/>
<h3 data-id="heading-7">å››ã€ç»„ä»¶æ ‘ï¼šå–ä»£ DOM æ ‘çš„æ–°æŠ½è±¡å±‚</h3>
<p>React å¹¶ä¸ç›´æ¥æ“ä½œçœŸå® DOMï¼Œè€Œæ˜¯ç»´æŠ¤ä¸€æ£µ <strong>è™šæ‹Ÿ DOM æ ‘ï¼ˆVirtual DOMï¼‰</strong> ï¼Œè€Œè¿™æ£µæ ‘çš„æœ¬è´¨ï¼Œå°±æ˜¯ <strong>ç»„ä»¶æ ‘</strong>ã€‚</p>
<ul>
<li>æ¯ä¸ªç»„ä»¶èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ª UI å•å…ƒã€‚</li>
<li>å½“çŠ¶æ€å˜åŒ–æ—¶ï¼ŒReact ä¼šé‡æ–°æ¸²æŸ“å—å½±å“çš„ç»„ä»¶å­æ ‘ï¼Œå¹¶é€šè¿‡é«˜æ•ˆçš„ diff ç®—æ³•æ›´æ–°çœŸå® DOMã€‚</li>
<li>å¼€å‘è€…åªéœ€å…³æ³¨â€œå½“å‰çŠ¶æ€åº”è¯¥æ¸²æŸ“ä»€ä¹ˆ UIâ€ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ DOMã€‚</li>
</ul>
<p>è¿™ç§å£°æ˜å¼ç¼–ç¨‹èŒƒå¼ï¼Œæå¤§æå‡äº†å¼€å‘æ•ˆç‡ä¸ä»£ç å¯ç»´æŠ¤æ€§ã€‚</p>
<hr/>
<h3 data-id="heading-8">äº”ã€å¯¹æ¯”è§†è§’ï¼šä¸ºä½•è¯´ React æ›´â€œæ¿€è¿›â€ï¼Ÿ</h3>
<h4 data-id="heading-9">å…±åŒç›®æ ‡ï¼šè®© UI è‡ªåŠ¨å“åº”æ•°æ®å˜åŒ–</h4>
<p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œæ— è®ºæ˜¯ Vue è¿˜æ˜¯ Reactï¼Œéƒ½å›´ç»•ä¸‰ä¸ªæ ¸å¿ƒç†å¿µæ„å»ºï¼š<strong>å“åº”å¼ï¼ˆReactiveï¼‰ã€æ•°æ®ç»‘å®šï¼ˆData Bindingï¼‰å’Œç»„ä»¶åŒ–ï¼ˆComponentï¼‰</strong> ã€‚å®ƒä»¬è®©å¼€å‘è€…ä¸å†æ‰‹åŠ¨æ“ä½œ DOMï¼Œè€Œæ˜¯ä¸“æ³¨äºâ€œæ•°æ®å¦‚ä½•é©±åŠ¨ç•Œé¢â€</p>
<h4 data-id="heading-10">å…³é”®å·®å¼‚ï¼šReact æ›´æ¿€è¿›ï¼Œé—¨æ§›æ›´é«˜</h4>
<p>è™½ç„¶ç›®æ ‡ä¸€è‡´ï¼Œä½† <strong>React çš„è®¾è®¡å“²å­¦æ›´â€œæ¿€è¿›â€</strong> ï¼Œå¯¹å¼€å‘è€…è¦æ±‚æ›´é«˜ï¼š</p>
<ol>
<li><strong>ä¸€åˆ‡çš† JavaScript</strong></li>
</ol>
<ul>
<li>React è®¤ä¸ºï¼š<strong>UI é€»è¾‘å’Œè§†å›¾æœ¬å°±å¯†ä¸å¯åˆ†</strong>ï¼Œæ‰€ä»¥ç›´æ¥åœ¨ JS é‡Œå†™ HTMLï¼ˆJSXï¼‰ã€‚</li>
<li>ä¼˜ç‚¹ï¼šé€»è¾‘é›†ä¸­ï¼Œçµæ´»æ€§å¼ºï¼›</li>
<li>ç¼ºç‚¹ï¼šæ–°æ‰‹è¦åŒæ—¶ç†è§£ JSã€å‡½æ•°ã€ä½œç”¨åŸŸã€é—­åŒ…ã€JSX è¯­æ³•ï¼Œå­¦ä¹ æ›²çº¿é™¡å³­ã€‚</li>
</ul>
<blockquote>
<p>Vue åˆ™ä¿ç•™äº†â€œæ¨¡æ¿â€çš„è¾¹ç•Œæ„Ÿï¼ŒHTML è¿˜æ˜¯ HTMLï¼ŒJS è¿˜æ˜¯ JSï¼Œæ›´ç¬¦åˆä¼ ç»Ÿå‰ç«¯æ€ç»´ã€‚</p>
</blockquote>
<ol start="2">
<li><strong>çŠ¶æ€ç®¡ç†éœ€æ˜¾å¼æ§åˆ¶</strong></li>
</ol>
<ul>
<li>
<p>åœ¨ React ä¸­ï¼Œ<strong>æ²¡æœ‰â€œè‡ªåŠ¨å“åº”â€</strong> ã€‚ä½ å¿…é¡»ï¼š</p>
<ul>
<li>ç”¨ <code>useState</code> å£°æ˜çŠ¶æ€ï¼›</li>
<li>ç”¨ setter å‡½æ•°æ›´æ–°çŠ¶æ€ï¼›</li>
<li>ç†è§£â€œä¸å¯å˜æ€§â€ï¼ˆä¸èƒ½ç›´æ¥ä¿®æ”¹æ•°ç»„/å¯¹è±¡ï¼‰ï¼›</li>
<li>æŒæ¡ Hook è§„åˆ™ï¼ˆåªèƒ½åœ¨é¡¶å±‚è°ƒç”¨ï¼Œä¸èƒ½åœ¨æ¡ä»¶ä¸­ä½¿ç”¨ç­‰ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p>Vue åˆ™â€œæ›´æ™ºèƒ½â€ï¼šä½ ç›´æ¥ä¿®æ”¹ <code>this.message = 'new'</code> æˆ– <code>message.value = 'new'</code>ï¼Œæ¡†æ¶è‡ªåŠ¨è¿½è¸ªå¹¶æ›´æ–°è§†å›¾ã€‚</p>
</li>
</ul>
<blockquote>
<p>å¯¹æ–°æ‰‹æ¥è¯´ï¼ŒVue æ›´â€œå¼€ç®±å³ç”¨â€ï¼›React åˆ™è¦æ±‚ä½ å…ˆç†è§£å…¶è¿è¡Œæœºåˆ¶ã€‚</p>
</blockquote>
<h4 data-id="heading-11">3. <strong>æ›´å°‘çš„â€œé­”æ³•â€ï¼Œæ›´å¤šçš„è‡ªç”±</strong></h4>
<ul>
<li>
<p>Vue æä¾›äº†å¤§é‡å†…ç½®æŒ‡ä»¤ï¼ˆ<code>v-if</code>, <code>v-for</code>, <code>v-model</code>ï¼‰ï¼Œå¼€ç®±å³ç”¨ï¼›</p>
</li>
<li>
<p>React å‡ ä¹ä¸æä¾›â€œè¯­æ³•ç³–â€ï¼Œæ‰€æœ‰é€»è¾‘éƒ½ç”¨ JavaScript å®ç°ï¼š</p>
<ul>
<li>æ¡ä»¶æ¸²æŸ“ â†’ ç”¨ <code>&amp;&amp;</code> æˆ–ä¸‰å…ƒè¡¨è¾¾å¼ï¼›</li>
<li>åˆ—è¡¨æ¸²æŸ“ â†’ ç”¨ <code>.map()</code>ï¼›</li>
<li>è¡¨å•åŒå‘ç»‘å®š â†’ æ‰‹åŠ¨ç›‘å¬ <code>onChange</code> + <code>value</code>ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>è¿™ç§â€œå»æ¨¡æ¿åŒ–â€çš„è®¾è®¡è®© React æ›´çµæ´»ï¼Œä½†ä¹Ÿæ„å‘³ç€æ›´å¤šä»£ç å’Œæ›´é«˜å‡ºé”™é£é™©ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">ç»“è¯­ï¼šæˆä¸º UI çš„â€œåŒ…å·¥å¤´â€</h3>
<p>å¦‚æœè¯´ä¼ ç»Ÿå‰ç«¯å¼€å‘æ˜¯åœ¨ä¸€å—ä¸€å—åœ°ç Œç –ï¼ˆå†™æ ‡ç­¾ã€åŠ æ ·å¼ã€ç»‘äº‹ä»¶ï¼‰ï¼Œé‚£ä¹ˆ React åˆ™è®©æˆ‘ä»¬å‡çº§ä¸ºâ€œåŒ…å·¥å¤´â€â€”â€”å…ˆè§„åˆ’å¥½æ•´ä½“ç»“æ„ï¼ˆç»„ä»¶æ ‘ï¼‰ï¼Œå†åˆ†æ´¾ä»»åŠ¡ç»™å„ä¸ªâ€œæ–½å·¥é˜Ÿâ€ï¼ˆå­ç»„ä»¶ï¼‰ï¼Œæœ€ç»ˆé«˜æ•ˆã€æœ‰åºåœ°å»ºæˆæ•´æ ‹å¤§å¦ï¼ˆå®Œæ•´åº”ç”¨ï¼‰ã€‚</p>
<p>JSX æä¾›äº†è¡¨è¾¾åŠ›æå¼ºçš„ UI æè¿°è¯­è¨€ï¼Œè€Œå‡½æ•°å¼ç»„ä»¶åˆ™æä¾›äº†ç®€æ´ã€ç»„åˆæ€§å¼ºçš„æ„å»ºå•å…ƒã€‚äºŒè€…ç»“åˆï¼Œä½¿å¾— React ä¸ä»…æ˜¯ä¸€ä¸ªåº“ï¼Œæ›´æ˜¯ä¸€ç§<strong>æ€ç»´æ–¹å¼çš„é©æ–°</strong>ã€‚</p>
<p>æ­£å¦‚ Facebookï¼ˆç° Metaï¼‰æœ€åˆåˆ›é€  React çš„åˆè¡·ï¼š<strong>è®©æ„å»ºå¤æ‚ç”¨æˆ·ç•Œé¢å˜å¾—æ›´ç®€å•ã€æ›´å¯é¢„æµ‹</strong>ã€‚è€Œä»Šå¤©ï¼Œè¿™ä¸€ç›®æ ‡æ­£é€šè¿‡ JSX ä¸ç»„ä»¶åŒ–ï¼Œè¢«å…¨çƒæ•°ç™¾ä¸‡å¼€å‘è€…è·µè¡Œç€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å®æˆ˜ï¼šä» Vite åˆ° Vue Router çš„æ„å»ºä¹‹æ—…]]></title>    <link>https://juejin.cn/post/7584650421124399145</link>    <guid>https://juejin.cn/post/7584650421124399145</guid>    <pubDate>2025-12-17T11:17:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650421124399145" data-draft-id="7584659460246044691" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å®æˆ˜ï¼šä» Vite åˆ° Vue Router çš„æ„å»ºä¹‹æ—…"/> <meta itemprop="keywords" content="Vue.js,Vite,vue-router"/> <meta itemprop="datePublished" content="2025-12-17T11:17:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="San30"/> <meta itemprop="url" content="https://juejin.cn/user/1766294768060816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç°ä»£å‰ç«¯å·¥ç¨‹åŒ–å®æˆ˜ï¼šä» Vite åˆ° Vue Router çš„æ„å»ºä¹‹æ—…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1766294768060816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    San30
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T11:17:48.000Z" title="Wed Dec 17 2025 11:17:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨è¿‡å»çš„åå¹´é‡Œï¼Œå‰ç«¯å¼€å‘å·²ç»ä»ç®€å•çš„ "HTML + CSS + jQuery" æ¨¡å¼æ¼”å˜ä¸ºå¤æ‚çš„å·¥ç¨‹åŒ–ä½“ç³»ã€‚å¯¹äºåˆå­¦è€…æˆ–ä»ä¼ ç»Ÿå¼€å‘è½¬å‹çš„å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œç†è§£è¿™å¥—ç°ä»£æ¶æ„çš„æ¯ä¸€å±‚è‡³å…³é‡è¦ã€‚</p>
<p>æœ¬æ–‡å°†åŸºäºä¸€ä¸ªæ ‡å‡†çš„ Vue 3 é¡¹ç›®æ¨¡æ¿ï¼Œå¸¦ä½ æ·±å…¥å‰–æç°ä»£å‰ç«¯å¼€å‘çš„ "äº”è„å…­è…‘"ï¼šä» Node.js åŸºåº§ï¼Œåˆ° Vite æ„å»ºå·¥å…·ï¼Œå†åˆ° Vue 3 ç»„ä»¶åŒ–ä¸è·¯ç”±ç®¡ç†ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ ä¸ºä»€ä¹ˆè¦ "å·¥ç¨‹åŒ–"ï¼Ÿ</h2>
<p>æ›¾ç»ï¼Œæˆ‘ä»¬åªéœ€è¦æ–°å»ºä¸€ä¸ª <code>.html</code> æ–‡ä»¶ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€å°±èƒ½å†™ä»£ç ã€‚ä½†éšç€åº”ç”¨å¤æ‚åº¦çš„æå‡ï¼Œæˆ‘ä»¬éœ€è¦æ¨¡å—åŒ–ã€ç»„ä»¶åŒ–ã€é¢„ç¼–è¯‘ï¼ˆå¦‚ Sass/TypeScriptï¼‰ä»¥åŠä»£ç å‹ç¼©ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€å¼ å·¥ç¨‹æ¶æ„å›¾ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abf5437cd27f446eb73dd8963aed98e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2FuMzA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766575068&amp;x-signature=SZH5bu457e4YcEGEM03rHrnpDYg%3D" alt="å±‚çº§ç»“æ„.png" loading="lazy"/></p>
<p>è¿™å°±å¼•å…¥äº†<strong>å‰ç«¯å·¥ç¨‹åŒ–</strong>çš„æ¦‚å¿µã€‚åœ¨æ¶æ„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ç°ä»£å¼€å‘çš„å±‚çº§ç»“æ„ï¼š</p>
<ol>
<li><strong>åº•å±‚ç¯å¢ƒ (Node.js)</strong> ï¼šä¸ºæ„å»ºå·¥å…·æä¾›è¿è¡Œç¯å¢ƒã€‚</li>
<li><strong>æ„å»ºå·¥å…· (Vite)</strong> ï¼šè´Ÿè´£é¡¹ç›®çš„å¯åŠ¨ã€çƒ­æ›´æ–°å’Œæ‰“åŒ…ã€‚</li>
<li><strong>æ ¸å¿ƒæ¡†æ¶ (Vue 3)</strong> ï¼šè´Ÿè´£è§†å›¾å±‚çš„é€»è¾‘ã€‚</li>
<li><strong>å¼€å‘å·¥å…· (VS Code + Chrome)</strong> ï¼šæä¾›ä»£ç ç¼–å†™ä¸è°ƒè¯•èƒ½åŠ›ã€‚</li>
</ol>
<p>è®©æˆ‘ä»¬ç”±ä¸‹è€Œä¸Šï¼Œé€å±‚æ‹†è§£ã€‚</p>
<h2 data-id="heading-1">äºŒã€ åŸºçŸ³ä¸å¤§ç®¡å®¶ï¼šNode.js ä¸ Vite</h2>
<p>ä¸€åˆ‡å§‹äº <code>package.json</code>ã€‚è¿™æ˜¯é¡¹ç›®çš„ "èº«ä»½è¯" å’Œ "è¯´æ˜ä¹¦"ã€‚</p>
<h3 data-id="heading-2">1. ä¾èµ–ç®¡ç†</h3>
<p>åœ¨ <code>package.json</code> ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†é¡¹ç›®çš„ä¾èµ–é…ç½®ã€‚ç°ä»£å‰ç«¯ä¸å†æ˜¯é€šè¿‡ <code>&lt;script src="..."&gt;</code> å¼•å…¥åº“ï¼Œè€Œæ˜¯é€šè¿‡ <code>npm install</code> è¿›è¡ŒåŒ…ç®¡ç†ï¼š</p>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.5.24"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"vue-router"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.6.4"</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.2.4"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">2. Viteï¼šæé€Ÿçš„å¼€å‘ä½“éªŒ</h3>
<p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©äº† <strong>Vite</strong> ä½œä¸ºæ„å»ºå·¥å…·ã€‚Vite æ˜¯ Vue çš„ä½œè€…å°¤é›¨æºªå¼€å‘çš„ç°ä»£å‰ç«¯æ„å»ºå·¥å…·ã€‚</p>
<p>ä¸ºä»€ä¹ˆé€‰æ‹© Viteï¼Ÿ</p>
<p>ä¼ ç»Ÿçš„æ‰“åŒ…å·¥å…·ï¼ˆå¦‚ Webpackï¼‰åœ¨å¯åŠ¨æ—¶éœ€è¦åˆ†ææ•´ä¸ªåº”ç”¨å¹¶æ‰“åŒ…ã€‚è€Œ Vite åˆ©ç”¨äº†æµè§ˆå™¨åŸç”Ÿçš„ ES Module (ESM) èƒ½åŠ›ã€‚</p>
<p>åœ¨ <code>index.html</code> ä¸­ï¼Œå…³é”®çš„ä¸€è¡Œä»£ç æ˜¯ï¼š</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>type="module"</code> å‘Šè¯‰æµè§ˆå™¨ï¼šè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªæ¨¡å—ã€‚å½“æµè§ˆå™¨æ‰§è¡Œè¿™è¡Œä»£ç æ—¶ï¼Œå®ƒä¼šæŒ‰éœ€è¯·æ±‚ <code>main.js</code> åŠå…¶ä¾èµ–ã€‚Vite æœåŠ¡å™¨åªéœ€è¦æ‹¦æˆªè¿™äº›è¯·æ±‚å¹¶å³æ—¶å¤„ç†ï¼Œå› æ­¤èƒ½å®ç°<strong>æé€Ÿçš„å†·å¯åŠ¨</strong>ã€‚</p>
<p>æ­¤å¤–ï¼ŒVite æä¾›äº†å¼ºå¤§çš„ <strong>çƒ­æ›´æ–° (HMR)</strong> åŠŸèƒ½ã€‚å®ƒç›‘å¬æ–‡ä»¶çš„ä¿®æ”¹ï¼Œä¸€æ—¦ä¿å­˜ï¼Œæµè§ˆå™¨å‡ ä¹ç¬é—´è‡ªåŠ¨åˆ·æ–°ï¼Œå¤§å¹…æå‡äº†å¼€å‘ä½“éªŒã€‚</p>
<p>é€šè¿‡é…ç½® <code>scripts</code>ï¼Œæˆ‘ä»¬å°†å¤æ‚çš„å‘½ä»¤è¡Œæ“ä½œç®€åŒ–ä¸º npm æŒ‡ä»¤ï¼š</p>
<ul>
<li><code>npm run dev</code>: å¯åŠ¨æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼ˆé»˜è®¤ç«¯å£ 5173ï¼‰ã€‚</li>
<li><code>npm run build</code>: è¿›è¡Œç”Ÿäº§ç¯å¢ƒæ‰“åŒ…ã€‚</li>
</ul>
<h2 data-id="heading-4">ä¸‰ã€ åº”ç”¨å…¥å£ä¸ç»„ä»¶åŒ–æ€æƒ³</h2>
<p>è¿›å…¥ <code>src/</code> ç›®å½•ï¼Œæˆ‘ä»¬é€šè¿‡ <code>main.js</code> å’Œ <code>App.vue</code> çœŸæ­£è¿›å…¥äº† Vue 3 çš„ä¸–ç•Œã€‚</p>
<h3 data-id="heading-5">1. æŒ‚è½½ç‚¹ä¸å¼•å¯¼æ–‡ä»¶</h3>
<p>æµè§ˆå™¨é¦–å…ˆåŠ è½½ <code>index.html</code>ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª <code>&lt;div id="app"&gt;&lt;/div&gt;</code>ï¼Œè¿™æ˜¯æ•´ä¸ªåº”ç”¨çš„æŒ‚è½½ç‚¹ã€‚</p>
<p>æ¥ç€ï¼Œ<code>main.js</code> æ‰§è¡Œåˆå§‹åŒ–é€»è¾‘ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>;

<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
    .<span class="hljs-title function_">use</span>(router) <span class="hljs-comment">// å¯ç”¨è·¯ç”±æ¨¡å—</span>
    .<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>) <span class="hljs-comment">// æŒ‚è½½åˆ° DOM</span>
</code></pre>
<p>è¿™é‡Œä½“ç°äº†ç°ä»£å‰ç«¯å¼€å‘çš„ç‰¹ç‚¹ï¼š<strong>å‘Šåˆ« DOM ç¼–ç¨‹</strong>ã€‚æˆ‘ä»¬ä¸å†æ‰‹åŠ¨æ“ä½œ <code>document.getElementById</code> å»ä¿®æ”¹å†…å®¹ï¼Œè€Œæ˜¯å°† Vue å®ä¾‹æŒ‚è½½ä¸Šå»ï¼Œå‰©ä¸‹çš„äº¤ç»™æ¡†æ¶ã€‚</p>
<h3 data-id="heading-6">2. æ ¹ç»„ä»¶ App.vue</h3>
<p><code>App.vue</code> æ˜¯æ‰€æœ‰ç»„ä»¶çš„ "çˆ¶äº²"ã€‚å®ƒæ˜¯ä¸€ä¸ª <strong>SFC (Single File Component)</strong> ï¼Œå°†ç»“æ„ (<code>&lt;template&gt;</code>)ã€é€»è¾‘ (<code>&lt;script&gt;</code>) å’Œæ ·å¼ (<code>&lt;style&gt;</code>) å°è£…åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p>
<p>é…åˆ <strong>Volar</strong> (VS Code æ’ä»¶) å’Œ <strong>Vue Devtools</strong> (æµè§ˆå™¨æ’ä»¶)ï¼Œæˆ‘ä»¬èƒ½è·å¾—æè‡´çš„è¯­æ³•æç¤ºå’Œè°ƒè¯•èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-7">å››ã€ å¤šé¡µé¢ä¸å•é¡µåº”ç”¨ï¼šVue Router</h2>
<p>å¦‚ä½•åœ¨ä¸€ä¸ªé¡µé¢ (<code>index.html</code>) ä¸­å®ç° "å¤šé¡µé¢" çš„åˆ‡æ¢æ•ˆæœï¼Ÿè¿™å°±éœ€è¦å¼•å…¥ <strong>SPA (Single Page Application)</strong> çš„æ¦‚å¿µä»¥åŠ <strong>Vue Router</strong>ã€‚</p>
<h3 data-id="heading-8">1. è·¯ç”±é…ç½®</h3>
<p>åœ¨ <code>src/router/index.js</code> ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº† URL è·¯å¾„ä¸ç»„ä»¶çš„æ˜ å°„å…³ç³»ï¼š</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">import</span> { createRouter, createWebHashHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../views/Home.vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../views/About.vue'</span>;

<span class="hljs-keyword">const</span> routers = [
    { <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Home'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span> },
    { <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'About'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">About</span> }
];

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
    <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHashHistory</span>(), <span class="hljs-comment">// å“ˆå¸Œæ¨¡å¼ (#/about)</span>
    <span class="hljs-attr">routes</span>: routers
})
</code></pre>
<p>è¿™é‡Œä½¿ç”¨äº† <code>createWebHashHistory</code>ï¼Œæ„å‘³ç€ URL ä¼šå¸¦æœ‰ <code>#</code> å·ï¼ˆå¦‚ <code>localhost:5173/#/about</code>ï¼‰ã€‚è¿™ç§æ¨¡å¼éƒ¨ç½²ç®€å•ï¼Œä¸éœ€è¦åç«¯æœåŠ¡å™¨é…åˆé…ç½®é‡å®šå‘ã€‚</p>
<h3 data-id="heading-9">2. è·¯ç”±è§†å›¾ä¸é“¾æ¥</h3>
<p>é…ç½®å¥½è·¯ç”±åï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰ Vue <strong>åœ¨å“ªé‡Œæ˜¾ç¤ºé“¾æ¥</strong> ä»¥åŠ <strong>åœ¨å“ªé‡Œæ¸²æŸ“ç»„ä»¶</strong>ã€‚</p>
<p>åœ¨ <code>App.vue</code> ä¸­ï¼š</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>About<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<ul>
<li><code>&lt;router-link&gt;</code>ï¼šæ›¿ä»£äº†ä¼ ç»Ÿçš„ <code>&lt;a&gt;</code> æ ‡ç­¾ï¼Œå®ƒæ‹¦æˆªäº†ç‚¹å‡»äº‹ä»¶ï¼Œé˜²æ­¢æµè§ˆå™¨åˆ·æ–°é¡µé¢ï¼Œè€Œæ˜¯é€šçŸ¥ Vue Router æ›´æ–°è§†å›¾ã€‚</li>
<li><code>&lt;router-view&gt;</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå ä½ç¬¦ã€‚å½“ URL å˜æˆ <code>/about</code> æ—¶ï¼ŒVue Router ä¼šæŠŠ <code>About.vue</code> ç»„ä»¶çš„å†…å®¹æ¸²æŸ“åœ¨è¿™ä¸ªä½ç½®ã€‚</li>
</ul>
<h2 data-id="heading-10">äº”ã€ æ€»ç»“ä¸å±•æœ›</h2>
<p>å›é¡¾æˆ‘ä»¬çš„æ¶æ„å›¾ï¼Œä¸€ä¸ªç°ä»£ Vue é¡¹ç›®ç”±ä»¥ä¸‹éƒ¨åˆ†æ”¯æ’‘ï¼š</p>
<ol>
<li><strong>Vite å·¥ç¨‹åŒ–</strong>ï¼šåˆ©ç”¨ ESM å®ç°æé€Ÿæ„å»ºå’Œçƒ­æ›´æ–°ï¼Œæ˜¯ä¸šåŠ¡å¼€å‘çš„åŸºçŸ³ã€‚</li>
<li><strong>Vue 3</strong>ï¼šæ ¸å¿ƒæ¡†æ¶ï¼Œæä¾›ç»„ä»¶åŒ–å’Œå“åº”å¼èƒ½åŠ›ã€‚</li>
<li><strong>Vue Router</strong>ï¼šç®¡ç†å‰ç«¯è·¯ç”±ï¼Œå®ç°å•é¡µåº”ç”¨çš„å¤šè§†å›¾åˆ‡æ¢ã€‚</li>
<li><strong>ç”Ÿæ€ç³»ç»Ÿ</strong>ï¼šä¾èµ– <code>npm</code> ç®¡ç†ç¬¬ä¸‰æ–¹åŒ…ï¼Œåˆ©ç”¨ <code>node.js</code> é©±åŠ¨å¼€å‘ç¯å¢ƒã€‚</li>
</ol>
<p>é€šè¿‡ <code>npm init vite</code> è¿™æ ·ä¸€ä¸ªç®€å•çš„å‘½ä»¤ï¼Œæˆ‘ä»¬å¾—åˆ°çš„ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯ä¸€ä¸ªç»è¿‡ç¤¾åŒºåƒé”¤ç™¾ç‚¼çš„<strong>ä¼˜ç§€æ¶æ„æ¨¡æ¿</strong>ã€‚å®ƒè®©æˆ‘ä»¬æ— éœ€ä»é›¶é…ç½® Webpackï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç† DOM æ›´æ–°ï¼Œä»è€Œä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue 3 åŠ¨æ€ç»„ä»¶è¯¦è§£]]></title>    <link>https://juejin.cn/post/7584653722593607732</link>    <guid>https://juejin.cn/post/7584653722593607732</guid>    <pubDate>2025-12-17T12:03:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584653722593607732" data-draft-id="7584633505105723444" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue 3 åŠ¨æ€ç»„ä»¶è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2025-12-17T12:03:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¾®èŠ’ä¸æœ½"/> <meta itemprop="url" content="https://juejin.cn/user/3702810894153592"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue 3 åŠ¨æ€ç»„ä»¶è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810894153592/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¾®èŠ’ä¸æœ½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T12:03:15.000Z" title="Wed Dec 17 2025 12:03:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body ::selection{color:#fff;background-color:#ed7373}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:.6em;margin-top:1.5em;padding-bottom:4px;color:#ed7373}.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px}.markdown-body h4{font-size:16px}.markdown-body h5,.markdown-body h6{font-size:14px}.markdown-body p{line-height:inherit;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border-top:1px solid #dfe1e6;margin:33px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:rgba(239,198,221,.2666666667);color:#7b164f;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==") 10px 10px no-repeat;background-size:40px;background-color:#fdf8f8}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#fdf8f8}.markdown-body a{position:relative;text-decoration:underline;text-decoration-color:#ffd4d4;color:#ed7373;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAD1lJREFUeF7tnV122zgShQHJG5gT9/OkV2J7JR3voI/U707eI5/eQeyVRFlJa56nc2YDFjkHEulWHP3g5xZYAK5eku6QYOFWfSwUAJLW8EcFqMBJBSy1oQJU4LQCBITRQQXOKEBAGB5UgIAwBqhAnALMIHG68axGFCAgjTia3YxTgIDE6cazGlGAgDTiaHYzTgECEqcbz2pEAQLSiKPZzTgFCEicbjyrEQUISCOOZjfjFCAgcbrxrEYUICCNOJrdjFOAgMTpxrMaUYCANOJodjNOAQISpxvPakQBAtKIo9nNOAUISJxuPKsRBQhII45GdfN/v//+/l9//rlBtae9HQKi3UOZ7ft7sfhgjfm3sfa9u3RvzHtrjPv77r8PfpvemB0o1v3Z95tuNvt29fKyqQkgApI5ADVebgeFtTfGmA8I+3pj1rbv17Ouey4dFgKCiIgC2/i+WDwYax0QbzMDtDcjLC67/PL58xraeIbGCEgGkTVd4vty+QWVKUL75WCZb7f3JWUVAhLq5UKPHzLGRyXmP822208lgEJAlESMlBlDfeGyhsafelAIiMawAdjkpmO38/kXa8wtoDnRJvq+v79+fHwSvUhk4wQkUjjNp/33jz9uZ33/VbONP9nW9x/fPT5+0mYzAdHmkUR7lNUaob1RN+QiIKEuVHz838vl1xKGVOck1DbTRUAUB7yvaSXVG5592sy22zsNs1wExNNjWg+rEI5XqWfb7a9TQ0JAtEa+h101wzF0f/JMQkA8AlHjIQ3AMco+KSQERGP0X7CpITj2Skw4BUxACgOkOThG/0wECQEpCJBm4Rh81Fl7l3tHMAEpBJCJ4Hjq+/7bvOt229THGSVny8vV1W6b/Kzrbnprb088VAVXN/fMFgGBuxDfYE443L4oB0TM9OqwxcVtjJR7xiTzUIuA4OMZ2mI2OICBN+wgfpACJWcWISDQcMY2lgMOt7XjerW6w1q+b03sqUUgzJf6TUAuKTTRv+eAI8f0qdSwK1cWISATAXDusjngyDkj5PrTzedu+z2uNsmURQiIMkBqg2OUVwKSHFmEgCgCpFY4xCDJkEUIiBJAaodjlBlZuEtOMIz2EhAFgLQCxxtIIG9YkR5mEZCJAWkNjldIlsu/EEW79AsfCMiEgLQKx8EaCSKLPL1bre6l3EhApJS90G7LcKCziOQwi4BMAAjh+GGlPTmLSK7pEJDMgBCOfwRHvb9Lsg4hIBkBIRw/i/0dUawLrocQkEyAEI7jQoPeNi9WqBOQDIAQjtMig16uTUAyxLHIJQjHeVkRdYjkijoziAgW+0YJx2VxEYAYYzbvVqtfL18t/AgCEq6Z1xmEw0um3U2km8/dqnrS791qJRLLIo0m9bSCkwmHvxNBgDCD+Es+7ZGEI0x/DrHC9Cr6aMIR7j7ELBaL9HDds59BOOIkB33wh9O8cfLnOYtwxOsM+egPV9LjHSB9JuFIU/j7ctmntSD7cmvOYiV6B3IHPGOD5E7VxK4nnw4q0A03Kya7QqYBwpGmK6j+MFJrIK53zCCRPgZtsjt59Zozh+s0aP3DNSW2BkJAIuFATE2eu3TtcLi+w24wggU6AYkABDVuPnXpFuAAZg8jrReHWAGQIB177LLSzg7oqtih4Dcsig6vmEECw0CyKG8BDic3VEPh4RUBCQAENePSaubY1R2LxYOxNvklDa8aEpCACBY+FLKgdcTGZjLHYvHBWuu+PoX6iQ+vmEE8XQW/8w3XJRyeDjhymOTi4OHlWKRf8JFUYU444uGQXvsgIAG+kcgesXAM6y83/fAhGtv36242+5b708i+8kmtF+XKHhxiTZA9YuDwCLSn2Xb7KebLtL7BHnqch82hTY7HZ6k9xotxiHXGTejsEQXHcvnVGnPrEU2b2XZ7pwESQTjEFwbf6kxAzgGCeOvf2H7ElGQMoDmHH8ekk4RD8snBU2FAQE4oAy7Og594S7p+BIweGeriIZJw5CzMWaRfdDV0UStqzByTPX7oVt9/nHXdc64hV41wsEjPMLyKqTucWZAtGZkyiTAc2esOZpBMs1cpY2bIW89dP4UhkYZj6pqKNcgRWFBb2lO+fAQDxBiTYse5e4k0HMaY4NrNY/QcdAgBOSJX8vjf3biNWV+vVndB3jg4GPZA0b5N+BSwNByp+sXqzmleD+UQgMTWHqN5AgEIg0TAtrdemTxzjAYxgxzLIMul23X6wYOlU4dEzVy9bQw5zNq1DahHpOGYuuZgBvGI+uQZJEAgOjOHWsjB+t7DbK9DUgIQkVnPGZmadb0ECDyIGeR4Bkl6mRnS0WhIYsf2LcLhQoOACACCfk8T+Dnu4BetJa3qe9yxkTcUj8sFHUJAjgPiPugSO6yB1B9vzUJCEppFBLPHprP2Xut2fWaQE/eSxOJYBJDR1ETbXnscUosk12THdVYPBwE5AUhiQIgCAswk3tO+As/ji2oUNIa6cDCHWOBp3tDhS4wzUZD4ZhEkIDn0idH01DkEBAyIaw5dpB9zHqgu8FqQgw3rEncXIAPft60qAXF32JRt3qnBJ7X36a1TUwPX926O2Pbiey3fwM11XBWADGsFv5n9o6m72SfnkJ2Iff98/fj4FCJo6mpxrmnLVJCdJj4wp+pRKhxVFOmeBXXwSw2S7s6glXQfqJPs3N0/+nufG0jCdbyGcT59neKYYjNIxKfPvGdtnCM8wTvpM587M8LhgOGPVwDHTAz4wofQQaqNIgGJgGOvX8CdPXVYEXKtFOcm2+k5zHI2hmx7yTXMTNHO59ziAEne9uAJCeChqaCM5eOsY8cA7PSqQw6vPWSt13rvjV1PnbXPmlfHQ7QuChBEMIQUjAnj7uCMFeI09GxW7N1+54+uuxkmRf4z77p1yuxhigZS5xYDCAKOUUTfdQrELFGOoVZqvRQLiFRQamq3CECQcPhObY5OSs4iATNFsYGRamMNxXSsdpfOUw8IGg4nSMgdE5JFhCEhIJfCPP7fVQOCmKE5Ik3wRrnUABxtkLpTJ9vnOXERH2blnqkWECE4ot42gsoiodnLN6wAmwm91kJ87anpOJWAABa/Tvso8m6ZfJf+xyLo9G/ytPduCqr/+O7x8VNNgY3qizpAROEwJnh4NQodskh20TnAgITUaEB7Lva9sANUAZI6XXlB++Q7N3KohdqKgrApZNKisPhONlcNIMJwBM1cnVMVEZDIWgShGwrW5GhU2IAKQBBOPqct+g4JqUcAwxpI/ZHpAS+Fse9l0qSARG869Ora/iA0HK7NmJ2tP5kMAASUzaLrsgA3FHvopICUljkOvZwKCQJcRCYL2ZtWbJQnGD4ZICXDMeo93MHdO3yD36Hlux/slG8hs1ec4r2IziSAgIYGJzuHuDtfVG44IGr6FzG8An1gNKdWvppqOi47ILA73wkVp3B4ICTJY37gDSbZFk3BLGFLVkBQsy6nhJgCjtEWn5oEMd6HagjIZBJBqanNbIBAHXtEwSnhODRn2EP2MPy/sTaBPWWHrN20aKYJiLe2ZANEcguJVkenvp/rrbOQcEz13XHNMByzLQsgktlDKxzoQADWHXvTOLzyclEWQMB3vteOtQKHxNZ/bi/x4kP+AzpS2YNw+Dn46FHMHt7iiWcQiexBOLz9e+xATu0GyCcKiMSaB+EI8O6xQ5k9ggQUBQSxV+iwN4QjyLfMHslyCX7EE157NHLnkyjIxziRemkEIA7VNiGWQcDTkk28VEAUjgI/XqOBGjFAgMV5E0WlJBxcFIxHTQQQ5PCqhbpDGo7ZdntX2ztz40M+7EwRQICzV9VnD2E4RJ6oDAuxso8WAQRVf9S+2isNB4vydDhlAFku+3TT4t9hBbi2eBPScBhjmpjYkHaUXkAqntaVhgPx3Il04JXSPhwQVIFe6/CKcJSCxt5OrYBUWZwTjrLgEAEEMYNV4xCBcJQHhwggoECoqsAEaXIywmq8oWjBCT7EgkzxVlSgEw4toR5nBwGJ083rLMLhJZPqg/CALJdfjDHubYPxvwoyCOGId7+mM+GAgAKj6BoEpAFrDgWkqASk5KKTcCiIaqAJcEBanuYlHMDIVNIUHJBWV9IJh5KIBpsBB8TZB/gssSlpJyrhAEelouakAPkr5psZb3QpolAnHIqiWcAUEUBQj9tq37BIOAQiUlmTMoAsFh+stW49JO2neD2EcKS5tpSzRQBBzGSNAmrMIoSjlPBOt1MEkKFQR9Qh6t5CTjjSg66kFiQBSd9yMiqpZKhFOEoKbYytYoAgh1muq1MPtQgHJuBKa0UMEOgwa6/qZqr3OxGO0sIaZ68sIIvFg7H2I87c/JBAnm85I0DJ+86AflXblCggAlkkayZBreec8j7hUMvFq2HygOCzyM54ya0obj/Zdj7/Yo25lXIh4ZBSFtuuOCBCWWQPiTHr+XZ7j3zvrHS9Mdp9vVrdYV3J1iQUyAOIUBY5EORptt1+SgFlAMN933z8trmE3juoCYeItCKNZgFEMoscquKCz/b9etZ1zz6wDFDcmP1QShQMZg6R+BVvNBsgw7qIWzwUD8RBtU1vzMb93Q5/DkH63u5tyGXH63CQmUM8nuEXyAbILovID7XgAiEa5LAKoeI0bWQFpEVICMc0gY26anZActUjKIFS2iEcKerpOHcSQIbn1r/mrgNySk44cqotd61JAHHdqRkSwiEXsLlbngwQ19EJZrbE9SUc4hJnvcCkgFQHiZLnVrJGUOUXmxyQUV/pjYHSfmzhc9XSGmpsXw0gBU8Bbzpr73/5/Hmt0cG0KU0BVYAcQOLeDp91pTtGRtYbMaqVdY46QMa6xPb9g+R282Q3sd5IlrCEBlQCMgqndJariDc+lhB8JdioGpDXAn7/IjrxregXHJa8pb6EgKCNPypQBCATg0IwGqamKEB+GHp13U1v7a3Q1vWnvu+/XT8+PjUcG+z6/lGJ8n+uVhmK+nHmK2QGzD0zsnZAzLtu7fOgVfmKsQe+ClQByLHOur1eL1dXO1Bs170C089mm6uXl92DVITBN0zaPa5aQNp1KXuOVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFTg//8JNVC78ovQAAAAAElFTkSuQmCC");background-size:100%}.markdown-body a:active,.markdown-body a:hover{opacity:.66}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #ed7373;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#ed7373}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#fdf2f2}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #ed7373;background-color:#fdf2f2}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ed7373}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{appearance:none;-webkit-appearance:none;-moz-appearance:none;outline:none;width:16px;height:16px;border-radius:2px;background-color:transparent;box-shadow:inset 0 0 0 1px rgba(28,31,35,.3490196078);vertical-align:middle;margin:0;transform:translateY(-2px)}.markdown-body input[type=checkbox]:checked{background-color:#ed7373;background-image:url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGFyaWEtaGlkZGVuPSJ0cnVlIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3LjQxMSA3LjMwOGExLjUgMS41IDAgMDEuMjggMi4xMDNsLTYuNSA4LjVhMS41IDEuNSAwIDAxLTIuMzc1LjAxbC0zLjUtNC41YTEuNSAxLjUgMCAxMTIuMzY4LTEuODQybDIuMzA2IDIuOTY1IDUuMzE4LTYuOTU1YTEuNSAxLjUgMCAwMTIuMTAzLS4yOHoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=");box-shadow:inset 0 0 0 1px #ed7373}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">Vue 3 åŠ¨æ€ç»„ä»¶è¯¦è§£</h2>
<p>åœ¨ Vue 3 ä¸­ï¼ŒåŠ¨æ€ç»„ä»¶æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„ç‰¹æ€§ï¼Œå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶æ ¹æ®æ¡ä»¶åˆ‡æ¢ä¸åŒçš„ç»„ä»¶ã€‚</p>
<h3 data-id="heading-1">åŸºæœ¬ç”¨æ³•</h3>
<h4 data-id="heading-2">ä½¿ç”¨ <code>&lt;component&gt;</code> æ ‡ç­¾</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- åŠ¨æ€ç»„ä»¶çš„æ ¸å¿ƒ --&gt;
    &lt;component :is="currentComponent"&gt;&lt;/component&gt;
  
    &lt;!-- åˆ‡æ¢æŒ‰é’® --&gt;
    &lt;button @click="switchComponent('Home')"&gt;é¦–é¡µ&lt;/button&gt;
    &lt;button @click="switchComponent('About')"&gt;å…³äº&lt;/button&gt;
    &lt;button @click="switchComponent('Contact')"&gt;è”ç³»&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, shallowRef } from 'vue'
import Home from './components/Home.vue'
import About from './components/About.vue'
import Contact from './components/Contact.vue'

// ä½¿ç”¨ shallowRef é¿å…ä¸å¿…è¦çš„å“åº”å¼è½¬æ¢
const currentComponent = shallowRef(Home)

const switchComponent = (componentName) =&gt; {
  const components = {
    Home,
    About,
    Contact
  }
  currentComponent.value = components[componentName]
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-3">é«˜çº§ç”¨æ³•ç¤ºä¾‹</h3>
<h4 data-id="heading-4">1. å¸¦å±æ€§ä¼ é€’çš„åŠ¨æ€ç»„ä»¶</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;component 
      :is="currentView" 
      :title="componentTitle"
      :data="componentData"
      @custom-event="handleCustomEvent"
    /&gt;
  
    &lt;nav&gt;
      &lt;button 
        v-for="view in views" 
        :key="view.name"
        @click="changeView(view)"
        :class="{ active: currentView === view.component }"
      &gt;
        {{ view.label }}
      &lt;/button&gt;
    &lt;/nav&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, shallowRef } from 'vue'
import UserProfile from './UserProfile.vue'
import UserSettings from './UserSettings.vue'
import UserDashboard from './UserDashboard.vue'

const currentView = shallowRef(UserProfile)
const componentTitle = ref('ç”¨æˆ·èµ„æ–™')
const componentData = ref({ userId: 123 })

const views = [
  { name: 'profile', label: 'ä¸ªäººèµ„æ–™', component: UserProfile },
  { name: 'settings', label: 'è®¾ç½®', component: UserSettings },
  { name: 'dashboard', label: 'ä»ªè¡¨æ¿', component: UserDashboard }
]

const changeView = (view) =&gt; {
  currentView.value = view.component
  componentTitle.value = view.label
  componentData.value = { ...componentData.value, viewType: view.name }
}

const handleCustomEvent = (payload) =&gt; {
  console.log('æ¥æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶:', payload)
}
&lt;/script&gt;

&lt;style scoped&gt;
nav button.active {
  background-color: #007bff;
  color: white;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-5">2. ä½¿ç”¨ <code>&lt;keep-alive&gt;</code> ç¼“å­˜ç»„ä»¶çŠ¶æ€</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;!-- ç¼“å­˜åŠ¨æ€ç»„ä»¶çš„çŠ¶æ€ --&gt;
    &lt;keep-alive :include="cachedComponents"&gt;
      &lt;component :is="currentComponent" /&gt;
    &lt;/keep-alive&gt;
  
    &lt;div class="tabs"&gt;
      &lt;button 
        v-for="tab in tabs" 
        :key="tab.name"
        @click="switchTab(tab.name)"
        :class="{ active: activeTab === tab.name }"
      &gt;
        {{ tab.label }}
      &lt;/button&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, shallowRef } from 'vue'
import TabA from './TabA.vue'
import TabB from './TabB.vue'
import TabC from './TabC.vue'

const activeTab = ref('tab-a')
const currentComponent = shallowRef(TabA)

// å®šä¹‰éœ€è¦ç¼“å­˜çš„ç»„ä»¶
const cachedComponents = ['TabA', 'TabB']

const tabs = [
  { name: 'tab-a', label: 'æ ‡ç­¾é¡µ A', component: TabA },
  { name: 'tab-b', label: 'æ ‡ç­¾é¡µ B', component: TabB },
  { name: 'tab-c', label: 'æ ‡ç­¾é¡µ C', component: TabC }
]

const switchTab = (tabName) =&gt; {
  activeTab.value = tabName
  const tab = tabs.find(t =&gt; t.name === tabName)
  if (tab) {
    currentComponent.value = tab.component
  }
}
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-6">3. å¼‚æ­¥ç»„ä»¶åŠ è½½</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;Suspense&gt;
      &lt;template #default&gt;
        &lt;component :is="asyncComponent" /&gt;
      &lt;/template&gt;
      &lt;template #fallback&gt;
        &lt;div class="loading"&gt;åŠ è½½ä¸­...&lt;/div&gt;
      &lt;/template&gt;
    &lt;/Suspense&gt;
  
    &lt;button @click="loadComponent('HeavyChart')"&gt;åŠ è½½å›¾è¡¨&lt;/button&gt;
    &lt;button @click="loadComponent('DataGrid')"&gt;åŠ è½½æ•°æ®è¡¨æ ¼&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { shallowRef, defineAsyncComponent } from 'vue'

const asyncComponent = shallowRef(null)

const loadComponent = async (componentName) =&gt; {
  try {
    let component
  
    switch (componentName) {
      case 'HeavyChart':
        component = defineAsyncComponent(() =&gt; 
          import('./HeavyChart.vue')
        )
        break
      case 'DataGrid':
        component = defineAsyncComponent({
          loader: () =&gt; import('./DataGrid.vue'),
          loadingComponent: LoadingSpinner,
          errorComponent: ErrorComponent,
          delay: 200,
          timeout: 3000
        })
        break
      default:
        return
    }
  
    asyncComponent.value = component
  } catch (error) {
    console.error('ç»„ä»¶åŠ è½½å¤±è´¥:', error)
  }
}

// åŠ è½½æŒ‡ç¤ºå™¨ç»„ä»¶
const LoadingSpinner = {
  template: '&lt;div class="spinner"&gt;ğŸŒ€ æ­£åœ¨åŠ è½½...&lt;/div&gt;'
}

// é”™è¯¯ç»„ä»¶
const ErrorComponent = {
  template: '&lt;div class="error"&gt;âŒ ç»„ä»¶åŠ è½½å¤±è´¥&lt;/div&gt;'
}
&lt;/script&gt;

&lt;style scoped&gt;
.loading, .spinner, .error {
  padding: 20px;
  text-align: center;
}
.spinner {
  color: #007bff;
}
.error {
  color: #dc3545;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-7">4. å®é™…åº”ç”¨ï¼šå¯é…ç½®çš„å¡ç‰‡ç»„ä»¶</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- DynamicCard.vue --&gt;
&lt;template&gt;
  &lt;div class="dynamic-card"&gt;
    &lt;header class="card-header"&gt;
      &lt;h3&gt;{{ config.title }}&lt;/h3&gt;
      &lt;component 
        v-if="config.headerAction"
        :is="config.headerAction.component"
        v-bind="config.headerAction.props"
        @action="handleHeaderAction"
      /&gt;
    &lt;/header&gt;
  
    &lt;main class="card-body"&gt;
      &lt;keep-alive&gt;
        &lt;component 
          :is="config.content.component"
          v-bind="config.content.props"
          @update="handleContentUpdate"
        /&gt;
      &lt;/keep-alive&gt;
    &lt;/main&gt;
  
    &lt;footer v-if="config.footer" class="card-footer"&gt;
      &lt;component 
        :is="config.footer.component"
        v-bind="config.footer.props"
        @footer-action="handleFooterAction"
      /&gt;
    &lt;/footer&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
defineProps({
  config: {
    type: Object,
    required: true,
    validator(value) {
      return value.title &amp;&amp; value.content &amp;&amp; value.content.component
    }
  }
})

const emit = defineEmits(['header-action', 'content-update', 'footer-action'])

const handleHeaderAction = (payload) =&gt; {
  emit('header-action', payload)
}

const handleContentUpdate = (payload) =&gt; {
  emit('content-update', payload)
}

const handleFooterAction = (payload) =&gt; {
  emit('footer-action', payload)
}
&lt;/script&gt;

&lt;style scoped&gt;
.dynamic-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px;
  background-color: #f8f9fa;
  border-bottom: 1px solid #ddd;
}

.card-body {
  padding: 16px;
  min-height: 200px;
}

.card-footer {
  padding: 16px;
  background-color: #f8f9fa;
  border-top: 1px solid #ddd;
}
&lt;/style&gt;
</code></pre>
<p>ä½¿ç”¨è¿™ä¸ªåŠ¨æ€å¡ç‰‡ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;DynamicCard :config="cardConfig" /&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import DynamicCard from './DynamicCard.vue'
import UserInfo from './UserInfo.vue'
import ChartComponent from './ChartComponent.vue'
import ActionButtons from './ActionButtons.vue'

const cardConfig = ref({
  title: 'ç”¨æˆ·ä»ªè¡¨æ¿',
  headerAction: {
    component: 'button',
    props: { 
      innerText: 'åˆ·æ–°',
      onClick: () =&gt; console.log('åˆ·æ–°æ•°æ®')
    }
  },
  content: {
    component: ChartComponent,
    props: {
      data: [10, 20, 30, 40],
      type: 'line'
    }
  },
  footer: {
    component: ActionButtons,
    props: {
      actions: ['å¯¼å‡º', 'åˆ†äº«', 'æ‰“å°']
    }
  }
})
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-8">æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-9">1. æ€§èƒ½ä¼˜åŒ–</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ shallowRef è€Œä¸æ˜¯ ref æ¥é¿å…æ·±å±‚å“åº”å¼</span>
<span class="hljs-keyword">const</span> currentComponent = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-title class_">MyComponent</span>)

<span class="hljs-comment">// åˆç†ä½¿ç”¨ keep-alive çš„ include/exclude å±æ€§</span>
&lt;keep-alive :include=<span class="hljs-string">"['ComponentA', 'ComponentB']"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"currentComponent"</span> /&gt;</span></span>
&lt;/keep-alive&gt;
</code></pre>
<h4 data-id="heading-10">2. ç±»å‹å®‰å…¨ï¼ˆTypeScriptï¼‰</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComponentConfig</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">component</span>: <span class="hljs-title class_">Component</span>
  props?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;
  events?: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Function</span>&gt;
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">componentConfigs</span>: <span class="hljs-title class_">ComponentConfig</span>[] = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'home'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span>,
    <span class="hljs-attr">props</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'é¦–é¡µ'</span> }
  }
]
</code></pre>
<h4 data-id="heading-11">3. é”™è¯¯å¤„ç†</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { onErrorCaptured } from 'vue'

const hasError = ref(false)

onErrorCaptured((error, instance, info) =&gt; {
  console.error('åŠ¨æ€ç»„ä»¶é”™è¯¯:', error, info)
  hasError.value = true
  return false
})
&lt;/script&gt;
</code></pre>
<p>åŠ¨æ€ç»„ä»¶æ˜¯ Vue 3 ä¸­éå¸¸å®ç”¨çš„ç‰¹æ€§ï¼Œç‰¹åˆ«é€‚åˆç”¨äºæ„å»ºå¯å¤ç”¨ã€çµæ´»çš„åº”ç”¨ç¨‹åºæ¶æ„ã€‚é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›æ¨¡å¼ï¼Œå¯ä»¥åˆ›å»ºå‡ºæ—¢å¼ºå¤§åˆæ˜“äºç»´æŠ¤çš„ç»„ä»¶ç³»ç»Ÿã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäº Three.js çš„ 3D åœ°å›¾å¯è§†åŒ–ï¼šæ ¸å¿ƒåŸç†ä¸å®ç°æ­¥éª¤]]></title>    <link>https://juejin.cn/post/7584650673825284136</link>    <guid>https://juejin.cn/post/7584650673825284136</guid>    <pubDate>2025-12-17T12:35:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650673825284136" data-draft-id="7584633505105788980" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäº Three.js çš„ 3D åœ°å›¾å¯è§†åŒ–ï¼šæ ¸å¿ƒåŸç†ä¸å®ç°æ­¥éª¤"/> <meta itemprop="keywords" content="å‰ç«¯,three.js"/> <meta itemprop="datePublished" content="2025-12-17T12:35:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¾®èŠ’ä¸æœ½"/> <meta itemprop="url" content="https://juejin.cn/user/3702810894153592"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäº Three.js çš„ 3D åœ°å›¾å¯è§†åŒ–ï¼šæ ¸å¿ƒåŸç†ä¸å®ç°æ­¥éª¤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3702810894153592/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¾®èŠ’ä¸æœ½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T12:35:00.000Z" title="Wed Dec 17 2025 12:35:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body ::selection{color:#fff;background-color:#ed7373}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:.6em;margin-top:1.5em;padding-bottom:4px;color:#ed7373}.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px}.markdown-body h4{font-size:16px}.markdown-body h5,.markdown-body h6{font-size:14px}.markdown-body p{line-height:inherit;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border-top:1px solid #dfe1e6;margin:33px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:rgba(239,198,221,.2666666667);color:#7b164f;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==") 10px 10px no-repeat;background-size:40px;background-color:#fdf8f8}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#fdf8f8}.markdown-body a{position:relative;text-decoration:underline;text-decoration-color:#ffd4d4;color:#ed7373;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAD1lJREFUeF7tnV122zgShQHJG5gT9/OkV2J7JR3voI/U707eI5/eQeyVRFlJa56nc2YDFjkHEulWHP3g5xZYAK5eku6QYOFWfSwUAJLW8EcFqMBJBSy1oQJU4LQCBITRQQXOKEBAGB5UgIAwBqhAnALMIHG68axGFCAgjTia3YxTgIDE6cazGlGAgDTiaHYzTgECEqcbz2pEAQLSiKPZzTgFCEicbjyrEQUISCOOZjfjFCAgcbrxrEYUICCNOJrdjFOAgMTpxrMaUYCANOJodjNOAQISpxvPakQBAtKIo9nNOAUISJxuPKsRBQhII45GdfN/v//+/l9//rlBtae9HQKi3UOZ7ft7sfhgjfm3sfa9u3RvzHtrjPv77r8PfpvemB0o1v3Z95tuNvt29fKyqQkgApI5ADVebgeFtTfGmA8I+3pj1rbv17Ouey4dFgKCiIgC2/i+WDwYax0QbzMDtDcjLC67/PL58xraeIbGCEgGkTVd4vty+QWVKUL75WCZb7f3JWUVAhLq5UKPHzLGRyXmP822208lgEJAlESMlBlDfeGyhsafelAIiMawAdjkpmO38/kXa8wtoDnRJvq+v79+fHwSvUhk4wQkUjjNp/33jz9uZ33/VbONP9nW9x/fPT5+0mYzAdHmkUR7lNUaob1RN+QiIKEuVHz838vl1xKGVOck1DbTRUAUB7yvaSXVG5592sy22zsNs1wExNNjWg+rEI5XqWfb7a9TQ0JAtEa+h101wzF0f/JMQkA8AlHjIQ3AMco+KSQERGP0X7CpITj2Skw4BUxACgOkOThG/0wECQEpCJBm4Rh81Fl7l3tHMAEpBJCJ4Hjq+/7bvOt229THGSVny8vV1W6b/Kzrbnprb088VAVXN/fMFgGBuxDfYE443L4oB0TM9OqwxcVtjJR7xiTzUIuA4OMZ2mI2OICBN+wgfpACJWcWISDQcMY2lgMOt7XjerW6w1q+b03sqUUgzJf6TUAuKTTRv+eAI8f0qdSwK1cWISATAXDusjngyDkj5PrTzedu+z2uNsmURQiIMkBqg2OUVwKSHFmEgCgCpFY4xCDJkEUIiBJAaodjlBlZuEtOMIz2EhAFgLQCxxtIIG9YkR5mEZCJAWkNjldIlsu/EEW79AsfCMiEgLQKx8EaCSKLPL1bre6l3EhApJS90G7LcKCziOQwi4BMAAjh+GGlPTmLSK7pEJDMgBCOfwRHvb9Lsg4hIBkBIRw/i/0dUawLrocQkEyAEI7jQoPeNi9WqBOQDIAQjtMig16uTUAyxLHIJQjHeVkRdYjkijoziAgW+0YJx2VxEYAYYzbvVqtfL18t/AgCEq6Z1xmEw0um3U2km8/dqnrS791qJRLLIo0m9bSCkwmHvxNBgDCD+Es+7ZGEI0x/DrHC9Cr6aMIR7j7ELBaL9HDds59BOOIkB33wh9O8cfLnOYtwxOsM+egPV9LjHSB9JuFIU/j7ctmntSD7cmvOYiV6B3IHPGOD5E7VxK4nnw4q0A03Kya7QqYBwpGmK6j+MFJrIK53zCCRPgZtsjt59Zozh+s0aP3DNSW2BkJAIuFATE2eu3TtcLi+w24wggU6AYkABDVuPnXpFuAAZg8jrReHWAGQIB177LLSzg7oqtih4Dcsig6vmEECw0CyKG8BDic3VEPh4RUBCQAENePSaubY1R2LxYOxNvklDa8aEpCACBY+FLKgdcTGZjLHYvHBWuu+PoX6iQ+vmEE8XQW/8w3XJRyeDjhymOTi4OHlWKRf8JFUYU444uGQXvsgIAG+kcgesXAM6y83/fAhGtv36242+5b708i+8kmtF+XKHhxiTZA9YuDwCLSn2Xb7KebLtL7BHnqch82hTY7HZ6k9xotxiHXGTejsEQXHcvnVGnPrEU2b2XZ7pwESQTjEFwbf6kxAzgGCeOvf2H7ElGQMoDmHH8ekk4RD8snBU2FAQE4oAy7Og594S7p+BIweGeriIZJw5CzMWaRfdDV0UStqzByTPX7oVt9/nHXdc64hV41wsEjPMLyKqTucWZAtGZkyiTAc2esOZpBMs1cpY2bIW89dP4UhkYZj6pqKNcgRWFBb2lO+fAQDxBiTYse5e4k0HMaY4NrNY/QcdAgBOSJX8vjf3biNWV+vVndB3jg4GPZA0b5N+BSwNByp+sXqzmleD+UQgMTWHqN5AgEIg0TAtrdemTxzjAYxgxzLIMul23X6wYOlU4dEzVy9bQw5zNq1DahHpOGYuuZgBvGI+uQZJEAgOjOHWsjB+t7DbK9DUgIQkVnPGZmadb0ECDyIGeR4Bkl6mRnS0WhIYsf2LcLhQoOACACCfk8T+Dnu4BetJa3qe9yxkTcUj8sFHUJAjgPiPugSO6yB1B9vzUJCEppFBLPHprP2Xut2fWaQE/eSxOJYBJDR1ETbXnscUosk12THdVYPBwE5AUhiQIgCAswk3tO+As/ji2oUNIa6cDCHWOBp3tDhS4wzUZD4ZhEkIDn0idH01DkEBAyIaw5dpB9zHqgu8FqQgw3rEncXIAPft60qAXF32JRt3qnBJ7X36a1TUwPX926O2Pbiey3fwM11XBWADGsFv5n9o6m72SfnkJ2Iff98/fj4FCJo6mpxrmnLVJCdJj4wp+pRKhxVFOmeBXXwSw2S7s6glXQfqJPs3N0/+nufG0jCdbyGcT59neKYYjNIxKfPvGdtnCM8wTvpM587M8LhgOGPVwDHTAz4wofQQaqNIgGJgGOvX8CdPXVYEXKtFOcm2+k5zHI2hmx7yTXMTNHO59ziAEne9uAJCeChqaCM5eOsY8cA7PSqQw6vPWSt13rvjV1PnbXPmlfHQ7QuChBEMIQUjAnj7uCMFeI09GxW7N1+54+uuxkmRf4z77p1yuxhigZS5xYDCAKOUUTfdQrELFGOoVZqvRQLiFRQamq3CECQcPhObY5OSs4iATNFsYGRamMNxXSsdpfOUw8IGg4nSMgdE5JFhCEhIJfCPP7fVQOCmKE5Ik3wRrnUABxtkLpTJ9vnOXERH2blnqkWECE4ot42gsoiodnLN6wAmwm91kJ87anpOJWAABa/Tvso8m6ZfJf+xyLo9G/ytPduCqr/+O7x8VNNgY3qizpAROEwJnh4NQodskh20TnAgITUaEB7Lva9sANUAZI6XXlB++Q7N3KohdqKgrApZNKisPhONlcNIMJwBM1cnVMVEZDIWgShGwrW5GhU2IAKQBBOPqct+g4JqUcAwxpI/ZHpAS+Fse9l0qSARG869Ora/iA0HK7NmJ2tP5kMAASUzaLrsgA3FHvopICUljkOvZwKCQJcRCYL2ZtWbJQnGD4ZICXDMeo93MHdO3yD36Hlux/slG8hs1ec4r2IziSAgIYGJzuHuDtfVG44IGr6FzG8An1gNKdWvppqOi47ILA73wkVp3B4ICTJY37gDSbZFk3BLGFLVkBQsy6nhJgCjtEWn5oEMd6HagjIZBJBqanNbIBAHXtEwSnhODRn2EP2MPy/sTaBPWWHrN20aKYJiLe2ZANEcguJVkenvp/rrbOQcEz13XHNMByzLQsgktlDKxzoQADWHXvTOLzyclEWQMB3vteOtQKHxNZ/bi/x4kP+AzpS2YNw+Dn46FHMHt7iiWcQiexBOLz9e+xATu0GyCcKiMSaB+EI8O6xQ5k9ggQUBQSxV+iwN4QjyLfMHslyCX7EE157NHLnkyjIxziRemkEIA7VNiGWQcDTkk28VEAUjgI/XqOBGjFAgMV5E0WlJBxcFIxHTQQQ5PCqhbpDGo7ZdntX2ztz40M+7EwRQICzV9VnD2E4RJ6oDAuxso8WAQRVf9S+2isNB4vydDhlAFku+3TT4t9hBbi2eBPScBhjmpjYkHaUXkAqntaVhgPx3Il04JXSPhwQVIFe6/CKcJSCxt5OrYBUWZwTjrLgEAEEMYNV4xCBcJQHhwggoECoqsAEaXIywmq8oWjBCT7EgkzxVlSgEw4toR5nBwGJ083rLMLhJZPqg/CALJdfjDHubYPxvwoyCOGId7+mM+GAgAKj6BoEpAFrDgWkqASk5KKTcCiIaqAJcEBanuYlHMDIVNIUHJBWV9IJh5KIBpsBB8TZB/gssSlpJyrhAEelouakAPkr5psZb3QpolAnHIqiWcAUEUBQj9tq37BIOAQiUlmTMoAsFh+stW49JO2neD2EcKS5tpSzRQBBzGSNAmrMIoSjlPBOt1MEkKFQR9Qh6t5CTjjSg66kFiQBSd9yMiqpZKhFOEoKbYytYoAgh1muq1MPtQgHJuBKa0UMEOgwa6/qZqr3OxGO0sIaZ68sIIvFg7H2I87c/JBAnm85I0DJ+86AflXblCggAlkkayZBreec8j7hUMvFq2HygOCzyM54ya0obj/Zdj7/Yo25lXIh4ZBSFtuuOCBCWWQPiTHr+XZ7j3zvrHS9Mdp9vVrdYV3J1iQUyAOIUBY5EORptt1+SgFlAMN933z8trmE3juoCYeItCKNZgFEMoscquKCz/b9etZ1zz6wDFDcmP1QShQMZg6R+BVvNBsgw7qIWzwUD8RBtU1vzMb93Q5/DkH63u5tyGXH63CQmUM8nuEXyAbILovID7XgAiEa5LAKoeI0bWQFpEVICMc0gY26anZActUjKIFS2iEcKerpOHcSQIbn1r/mrgNySk44cqotd61JAHHdqRkSwiEXsLlbngwQ19EJZrbE9SUc4hJnvcCkgFQHiZLnVrJGUOUXmxyQUV/pjYHSfmzhc9XSGmpsXw0gBU8Bbzpr73/5/Hmt0cG0KU0BVYAcQOLeDp91pTtGRtYbMaqVdY46QMa6xPb9g+R282Q3sd5IlrCEBlQCMgqndJariDc+lhB8JdioGpDXAn7/IjrxregXHJa8pb6EgKCNPypQBCATg0IwGqamKEB+GHp13U1v7a3Q1vWnvu+/XT8+PjUcG+z6/lGJ8n+uVhmK+nHmK2QGzD0zsnZAzLtu7fOgVfmKsQe+ClQByLHOur1eL1dXO1Bs170C089mm6uXl92DVITBN0zaPa5aQNp1KXuOVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFSAgCDVZFvVKUBAqnMpO4RUgIAg1WRb1SlAQKpzKTuEVICAINVkW9UpQECqcyk7hFTg//8JNVC78ovQAAAAAElFTkSuQmCC");background-size:100%}.markdown-body a:active,.markdown-body a:hover{opacity:.66}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #ed7373;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#ed7373}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#fdf2f2}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #ed7373;background-color:#fdf2f2}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#ed7373}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{appearance:none;-webkit-appearance:none;-moz-appearance:none;outline:none;width:16px;height:16px;border-radius:2px;background-color:transparent;box-shadow:inset 0 0 0 1px rgba(28,31,35,.3490196078);vertical-align:middle;margin:0;transform:translateY(-2px)}.markdown-body input[type=checkbox]:checked{background-color:#ed7373;background-image:url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjFlbSIgaGVpZ2h0PSIxZW0iIGFyaWEtaGlkZGVuPSJ0cnVlIj48cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE3LjQxMSA3LjMwOGExLjUgMS41IDAgMDEuMjggMi4xMDNsLTYuNSA4LjVhMS41IDEuNSAwIDAxLTIuMzc1LjAxbC0zLjUtNC41YTEuNSAxLjUgMCAxMTIuMzY4LTEuODQybDIuMzA2IDIuOTY1IDUuMzE4LTYuOTU1YTEuNSAxLjUgMCAwMTIuMTAzLS4yOHoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=");box-shadow:inset 0 0 0 1px #ed7373}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ead871452744f4b9695d5a018cb78fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6u6IqS5LiN5py9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766579700&amp;x-signature=0eq1J5RyDtxCA1HPmNRTsKpMj%2BM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">é¡¹ç›®æ¦‚è¿°</h2>
<p>è¿™æ˜¯ä¸€ä¸ªåŸºäºThree.jsçš„3Däº¤äº’å¼åœ°å›¾å¯è§†åŒ–ç³»ç»Ÿï¼Œä»¥å¹¿ä¸œçœåœ°å›¾ä¸ºå±•ç¤ºå¯¹è±¡ï¼Œå®ç°äº†ä¸°å¯Œçš„3Dè§†è§‰æ•ˆæœå’Œäº¤äº’åŠŸèƒ½ã€‚æœ¬æ–‡å°†å¯¹é¡¹ç›®ä¸­çš„æ ¸å¿ƒå‡½æ•°è¿›è¡Œé€æ­¥éª¤ã€é€å‡½æ•°çš„è¯¦ç»†åˆ†æï¼Œå¸®åŠ©è¯»è€…æ·±å…¥ç†è§£ç³»ç»Ÿçš„å®ç°åŸç†ã€‚</p>
<h2 data-id="heading-1">æŠ€æœ¯æ ˆ</h2>
<ul>
<li><strong>å‰ç«¯æ¡†æ¶</strong>ï¼šVue 3</li>
<li><strong>3Dæ¸²æŸ“å¼•æ“</strong>ï¼šThree.js</li>
<li><strong>æ„å»ºå·¥å…·</strong>ï¼šVite</li>
<li><strong>åŠ¨ç”»åº“</strong>ï¼šTween.js</li>
<li><strong>è¾…åŠ©åº“</strong>ï¼šDelaunatorã€geo-point-in-polygonç­‰åœ°ç†è®¡ç®—åº“</li>
</ul>
<h2 data-id="heading-2">é¡¹ç›®åˆå§‹åŒ–æµç¨‹</h2>
<h3 data-id="heading-3">1. App.vue - ä¸»ç»„ä»¶å…¥å£</h3>
<h4 data-id="heading-4">onMounted - ç»„ä»¶æŒ‚è½½å‡½æ•°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onMounted</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-comment">// 1. åŠ è½½åœ°å›¾æ•°æ®</span>
  <span class="hljs-keyword">let</span> provinceData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">requestData</span>(<span class="hljs-string">"./data/map/å¹¿ä¸œçœ.json"</span>)
  provinceData = <span class="hljs-title function_">transfromGeoJSON</span>(provinceData)

  <span class="hljs-comment">// 2. ç»§æ‰¿Map3dç±»åˆ›å»ºå½“å‰åœ°å›¾å®ä¾‹</span>
  <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentMap3d</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Map3d</span> {
    <span class="hljs-comment">// ... è‡ªå®šä¹‰åœ°å›¾æ–¹æ³•</span>
  }

  <span class="hljs-comment">// 3. åˆå§‹åŒ–åœ°å›¾å®ä¾‹</span>
  baseMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CurrentMap3</span>d({
    <span class="hljs-attr">container</span>: <span class="hljs-string">"#app-32-map"</span>,
    <span class="hljs-attr">axesVisibel</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">controls</span>: {
      <span class="hljs-attr">enableDamping</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">maxPolarAngle</span>: (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>) * <span class="hljs-number">0.98</span>,
    },
  })

  <span class="hljs-comment">// 4. è¿è¡Œåœ°å›¾</span>
  baseMap.<span class="hljs-title function_">run</span>()
  
  <span class="hljs-comment">// 5. æ·»åŠ çª—å£å¤§å°å˜åŒ–ç›‘å¬</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"resize"</span>, resize)
})
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œï¼Œå®Œæˆåœ°å›¾çš„åˆå§‹åŒ–ã€æ•°æ®åŠ è½½ã€æ¸²æŸ“å’Œäº‹ä»¶ç›‘å¬è®¾ç½®ã€‚</p>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åŠ è½½å¹¶è½¬æ¢å¹¿ä¸œçœåœ°å›¾æ•°æ®</li>
<li>å®šä¹‰è‡ªå®šä¹‰åœ°å›¾ç±»ç»§æ‰¿Map3dåŸºç±»</li>
<li>åˆ›å»ºåœ°å›¾å®ä¾‹å¹¶é…ç½®å‚æ•°</li>
<li>è¿è¡Œåœ°å›¾æ¸²æŸ“å¾ªç¯</li>
<li>æ·»åŠ çª—å£å¤§å°å˜åŒ–ç›‘å¬</li>
</ol>
<h2 data-id="heading-5">æ•°æ®å¤„ç†æ¨¡å—</h2>
<h3 data-id="heading-6">1. useFileLoader.js - æ–‡ä»¶åŠ è½½é’©å­</h3>
<h4 data-id="heading-7">requestData - å¼‚æ­¥æ•°æ®è¯·æ±‚å‡½æ•°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">requestData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">url</span>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url)
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>()
    <span class="hljs-keyword">return</span> data
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'æ•°æ®åŠ è½½å¤±è´¥:'</span>, error)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
  }
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šå¼‚æ­¥åŠ è½½GeoJSONåœ°å›¾æ•°æ®ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>url</code>ï¼šåœ°å›¾æ•°æ®æ–‡ä»¶è·¯å¾„</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šè§£æåçš„JSONæ•°æ®å¯¹è±¡</p>
<h3 data-id="heading-8">2. useConversionStandardData.js - æ•°æ®æ ¼å¼è½¬æ¢é’©å­</h3>
<h4 data-id="heading-9">transfromGeoJSON - GeoJSONæ•°æ®è½¬æ¢å‡½æ•°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">transfromGeoJSON</span> = (<span class="hljs-params">worldData</span>) =&gt; {
  <span class="hljs-keyword">let</span> features = worldData.<span class="hljs-property">features</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; features.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> element = features[i]
    <span class="hljs-comment">// å°†Polygonå¤„ç†è·ŸMultiPolygonä¸€æ ·çš„æ•°æ®ç»“æ„</span>
    <span class="hljs-keyword">if</span> (element.<span class="hljs-property">geometry</span>.<span class="hljs-property">type</span> === <span class="hljs-string">'Polygon'</span>) {
      element.<span class="hljs-property">geometry</span>.<span class="hljs-property">coordinates</span> = [element.<span class="hljs-property">geometry</span>.<span class="hljs-property">coordinates</span>]
    }
  }
  <span class="hljs-keyword">return</span> worldData
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šç»Ÿä¸€GeoJSONæ•°æ®æ ¼å¼ï¼Œå°†Polygonç±»å‹æ•°æ®è½¬æ¢ä¸ºä¸MultiPolygonç›¸åŒçš„äºŒç»´æ•°ç»„ç»“æ„ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>worldData</code>ï¼šåŸå§‹GeoJSONæ•°æ®</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šæ ‡å‡†åŒ–åçš„GeoJSONæ•°æ®</p>
<p><strong>å®ç°åŸç†</strong>ï¼šéå†featuresæ•°ç»„ï¼Œæ£€æµ‹geometry.typeï¼Œå¦‚æœæ˜¯Polygonç±»å‹ï¼Œåˆ™å°†coordinatesè½¬æ¢ä¸ºäºŒç»´æ•°ç»„æ ¼å¼ï¼Œç¡®ä¿åç»­å¤„ç†çš„ä¸€è‡´æ€§ã€‚</p>
<h3 data-id="heading-10">3. useCoord.js - åæ ‡å¤„ç†é’©å­</h3>
<h4 data-id="heading-11">geoMercatorCoord - ç»çº¬åº¦è½¬å¢¨å¡æ‰˜åæ ‡</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">geoMercatorCoord</span> = (<span class="hljs-params">longitude, latitude</span>) =&gt; {
  <span class="hljs-keyword">var</span> E = longitude
  <span class="hljs-keyword">var</span> N = latitude
  <span class="hljs-keyword">var</span> x = (E * <span class="hljs-number">20037508.34</span>) / <span class="hljs-number">180</span>
  <span class="hljs-keyword">var</span> y = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">tan</span>(((<span class="hljs-number">90</span> + N) * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) / <span class="hljs-number">360</span>)) / (<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>)
  y = (y * <span class="hljs-number">20037508.34</span>) / <span class="hljs-number">180</span>
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">x</span>: x, <span class="hljs-comment">//å¢¨å¡æ‰˜xåæ ‡â€”â€”å¯¹åº”ç»åº¦</span>
    <span class="hljs-attr">y</span>: y, <span class="hljs-comment">//å¢¨å¡æ‰˜yåæ ‡â€”â€”å¯¹åº”ç»´åº¦</span>
  }
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šå°†åœ°ç†ç»çº¬åº¦åæ ‡è½¬æ¢ä¸ºå¢¨å¡æ‰˜æŠ•å½±åæ ‡ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>longitude</code>ï¼šç»åº¦å€¼</li>
<li><code>latitude</code>ï¼šçº¬åº¦å€¼</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šåŒ…å«xã€yå±æ€§çš„å¢¨å¡æ‰˜åæ ‡å¯¹è±¡</p>
<p><strong>å®ç°åŸç†</strong>ï¼šä½¿ç”¨å¢¨å¡æ‰˜æŠ•å½±å…¬å¼è¿›è¡Œåæ ‡è½¬æ¢ï¼Œå°†ç»åº¦ç›´æ¥çº¿æ€§æ˜ å°„ï¼Œçº¬åº¦é€šè¿‡å¯¹æ•°å‡½æ•°è¿›è¡Œéçº¿æ€§æ˜ å°„ï¼Œä½¿åœ°å›¾åœ¨èµ¤é“é™„è¿‘ä¿æŒæ¯”ä¾‹æ­£ç¡®ã€‚</p>
<h4 data-id="heading-12">geoSphereCoord - ç»çº¬åº¦è½¬çƒé¢åæ ‡</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">geoSphereCoord</span> = (<span class="hljs-params">R, longitude, latitude</span>) =&gt; {
  <span class="hljs-keyword">var</span> lon = (longitude * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) / <span class="hljs-number">180</span> <span class="hljs-comment">//è½¬å¼§åº¦å€¼</span>
  <span class="hljs-keyword">var</span> lat = (latitude * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>) / <span class="hljs-number">180</span> <span class="hljs-comment">//è½¬å¼§åº¦å€¼</span>
  lon = -lon <span class="hljs-comment">// three.jsåæ ‡ç³»zåæ ‡è½´å¯¹åº”ç»åº¦-90åº¦ï¼Œè€Œä¸æ˜¯90åº¦</span>

  <span class="hljs-comment">// ç»çº¬åº¦åæ ‡è½¬çƒé¢åæ ‡è®¡ç®—å…¬å¼</span>
  <span class="hljs-keyword">var</span> x = R * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(lat) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(lon)
  <span class="hljs-keyword">var</span> y = R * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(lat)
  <span class="hljs-keyword">var</span> z = R * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(lat) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(lon)
  <span class="hljs-comment">// è¿”å›çƒé¢åæ ‡</span>
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">x</span>: x,
    <span class="hljs-attr">y</span>: y,
    <span class="hljs-attr">z</span>: z,
  }
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šå°†åœ°ç†ç»çº¬åº¦åæ ‡è½¬æ¢ä¸ºä¸‰ç»´çƒé¢ä¸Šçš„åæ ‡ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>R</code>ï¼šçƒä½“åŠå¾„</li>
<li><code>longitude</code>ï¼šç»åº¦å€¼</li>
<li><code>latitude</code>ï¼šçº¬åº¦å€¼</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šåŒ…å«xã€yã€zå±æ€§çš„çƒé¢åæ ‡å¯¹è±¡</p>
<p><strong>å®ç°åŸç†</strong>ï¼šä½¿ç”¨çƒé¢åæ ‡è½¬æ¢å…¬å¼ï¼Œå°†ç»çº¬åº¦è½¬æ¢ä¸ºä¸‰ç»´ç©ºé—´åæ ‡ï¼Œé€‚ç”¨äºåˆ›å»ºåœ°çƒç­‰çƒé¢æ¨¡å‹ã€‚</p>
<h4 data-id="heading-13">getBoundingBox - è®¡ç®—æ¨¡å‹åŒ…å›´ç›’</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getBoundingBox</span> = group =&gt; {
  <span class="hljs-comment">// åŒ…å›´ç›’è®¡ç®—æ¨¡å‹å¯¹è±¡çš„å¤§å°å’Œä½ç½®</span>
  <span class="hljs-keyword">var</span> box3 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Box3</span>()
  box3.<span class="hljs-title function_">expandByObject</span>(group) <span class="hljs-comment">// è®¡ç®—æ¨¡å‹åŒ…å›´ç›’</span>
  <span class="hljs-keyword">var</span> size = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector3</span>()
  box3.<span class="hljs-title function_">getSize</span>(size) <span class="hljs-comment">// è®¡ç®—åŒ…å›´ç›’å°ºå¯¸</span>
  <span class="hljs-keyword">var</span> center = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector3</span>()
  box3.<span class="hljs-title function_">getCenter</span>(center) <span class="hljs-comment">// è®¡ç®—ä¸€ä¸ªå±‚çº§æ¨¡å‹å¯¹åº”åŒ…å›´ç›’çš„å‡ ä½•ä½“ä¸­å¿ƒåæ ‡</span>
  <span class="hljs-keyword">return</span> {
    box3,
    center,
    size,
  }
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šè®¡ç®—3Dæ¨¡å‹æˆ–æ¨¡å‹ç»„çš„åŒ…å›´ç›’ã€å°ºå¯¸å’Œä¸­å¿ƒåæ ‡ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>group</code>ï¼šThree.jsæ¨¡å‹æˆ–æ¨¡å‹ç»„å¯¹è±¡</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šåŒ…å«åŒ…å›´ç›’(box3)ã€ä¸­å¿ƒåæ ‡(center)å’Œå°ºå¯¸(size)çš„å¯¹è±¡</p>
<p><strong>å®ç°åŸç†</strong>ï¼šä½¿ç”¨Three.jsçš„Box3ç±»è®¡ç®—æ¨¡å‹çš„æœ€å°åŒ…å›´ç«‹æ–¹ä½“ï¼Œç”¨äºåç»­çš„ç›¸æœºå®šä½å’Œæ¨¡å‹å¸ƒå±€ã€‚</p>
<h2 data-id="heading-14">3Dåœ°å›¾å»ºæ¨¡æ¨¡å—</h2>
<h3 data-id="heading-15">1. Map3d.js - åœ°å›¾åŸºç±»</h3>
<h4 data-id="heading-16">constructor - æ„é€ å‡½æ•°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">constructor</span>(<span class="hljs-params">options = {}</span>) {
  <span class="hljs-keyword">let</span> defaultOptions = {
    <span class="hljs-attr">isFull</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">container</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>,
    <span class="hljs-attr">bgColor</span>: <span class="hljs-number">0x000000</span>,
    <span class="hljs-attr">materialColor</span>: <span class="hljs-number">0xff0000</span>,
    <span class="hljs-attr">controls</span>: {
      <span class="hljs-attr">visibel</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">enableDamping</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">autoRotate</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">maxPolarAngle</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>,
    },
    <span class="hljs-attr">statsVisibel</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">axesVisibel</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">axesHelperSize</span>: <span class="hljs-number">250</span>,
  }
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = <span class="hljs-title function_">deepMerge</span>(defaultOptions, options)
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">container</span>)
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">width</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">offsetWidth</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">height</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-property">offsetHeight</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span> = <span class="hljs-literal">null</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span> = <span class="hljs-literal">null</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">mesh</span> = <span class="hljs-literal">null</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationStop</span> = <span class="hljs-literal">null</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">controls</span> = <span class="hljs-literal">null</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span> = <span class="hljs-literal">null</span>

  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>()
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆå§‹åŒ–åœ°å›¾å®ä¾‹ï¼Œè®¾ç½®é»˜è®¤å‚æ•°ï¼Œåˆ›å»ºåŸºæœ¬çš„Three.jsåœºæ™¯ã€ç›¸æœºã€æ¸²æŸ“å™¨ç­‰å¯¹è±¡ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>options</code>ï¼šåœ°å›¾é…ç½®å‚æ•°å¯¹è±¡</li>
</ul>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆå¹¶é»˜è®¤å‚æ•°å’Œç”¨æˆ·å‚æ•°</li>
<li>è·å–å®¹å™¨å…ƒç´ å¹¶è®¾ç½®å°ºå¯¸</li>
<li>åˆå§‹åŒ–Three.jsæ ¸å¿ƒå¯¹è±¡</li>
<li>è°ƒç”¨initæ–¹æ³•è¿›è¡Œè¿›ä¸€æ­¥åˆå§‹åŒ–</li>
</ol>
<h4 data-id="heading-17">init - åˆå§‹åŒ–å‡½æ•°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initStats</span>()
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initCamera</span>()
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initModel</span>()
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initRenderer</span>()
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initLight</span>()
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initAxes</span>()
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initControls</span>()
  <span class="hljs-keyword">let</span> gl = <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span>.<span class="hljs-property">domElement</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'webgl'</span>)
  gl &amp;&amp; gl.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">'WEBGL_lose_context'</span>).<span class="hljs-title function_">loseContext</span>()
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šç»Ÿä¸€è°ƒç”¨å„ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œå®Œæˆåœ°å›¾çš„å…¨é¢åˆå§‹åŒ–ã€‚</p>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆå§‹åŒ–æ€§èƒ½ç»Ÿè®¡</li>
<li>åˆå§‹åŒ–ç›¸æœº</li>
<li>åˆå§‹åŒ–æ¨¡å‹ï¼ˆç”±å­ç±»å®ç°ï¼‰</li>
<li>åˆå§‹åŒ–æ¸²æŸ“å™¨</li>
<li>åˆå§‹åŒ–å…‰æº</li>
<li>åˆå§‹åŒ–åæ ‡è½´è¾…åŠ©</li>
<li>åˆå§‹åŒ–æ§åˆ¶å™¨</li>
<li>é‡Šæ”¾WebGLä¸Šä¸‹æ–‡ï¼ˆä¼˜åŒ–å†…å­˜ï¼‰</li>
</ol>
<h4 data-id="heading-18">initCamera - ç›¸æœºåˆå§‹åŒ–</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">initCamera</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> { width, height } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>
  <span class="hljs-keyword">let</span> rate = width / height
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">45</span>, rate, <span class="hljs-number">0.001</span>, <span class="hljs-number">90000000</span>)
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">up</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">102.97777217804006</span>, <span class="hljs-number">17.660260562607277</span>, <span class="hljs-number">8.029548316292933</span>)
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>.<span class="hljs-title function_">lookAt</span>(...centerXY, <span class="hljs-number">0</span>)
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆå§‹åŒ–é€è§†ç›¸æœºï¼Œè®¾ç½®ç›¸æœºä½ç½®ã€æœå‘å’Œè§†é‡å‚æ•°ã€‚</p>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>è®¡ç®—å®½é«˜æ¯”</li>
<li>åˆ›å»ºé€è§†ç›¸æœºå®ä¾‹</li>
<li>è®¾ç½®ç›¸æœºä¸Šæ–¹å‘ï¼ˆZè½´å‘ä¸Šï¼‰</li>
<li>è®¾ç½®ç›¸æœºä½ç½®åæ ‡</li>
<li>è®¾ç½®ç›¸æœºçœ‹å‘åœ°å›¾ä¸­å¿ƒç‚¹</li>
</ol>
<h4 data-id="heading-19">initRenderer - æ¸²æŸ“å™¨åˆå§‹åŒ–</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">initRenderer</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> { width, height, bgColor } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>
  <span class="hljs-keyword">let</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({
    <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span>,
  })
  renderer.<span class="hljs-title function_">setPixelRatio</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">devicePixelRatio</span>)
  renderer.<span class="hljs-title function_">setSize</span>(width, height)
  renderer.<span class="hljs-title function_">setClearColor</span>(bgColor, <span class="hljs-number">1</span>)
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>)
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span> = renderer
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆå§‹åŒ–WebGLæ¸²æŸ“å™¨ï¼Œè®¾ç½®æ¸²æŸ“å‚æ•°å¹¶å°†æ¸²æŸ“ç”»å¸ƒæ·»åŠ åˆ°å®¹å™¨ä¸­ã€‚</p>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºWebGLæ¸²æŸ“å™¨å®ä¾‹ï¼ˆå¯ç”¨æŠ—é”¯é½¿ï¼‰</li>
<li>è®¾ç½®åƒç´ æ¯”é€‚åº”é«˜DPIå±å¹•</li>
<li>è®¾ç½®æ¸²æŸ“å°ºå¯¸</li>
<li>è®¾ç½®èƒŒæ™¯é¢œè‰²</li>
<li>å°†æ¸²æŸ“ç”»å¸ƒæ·»åŠ åˆ°DOMå®¹å™¨</li>
</ol>
<h4 data-id="heading-20">initLight - å…‰æºåˆå§‹åŒ–</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">initLight</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// å¹³è¡Œå…‰1</span>
  <span class="hljs-keyword">let</span> directionalLight1 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0x7af4ff</span>, <span class="hljs-number">1</span>)
  directionalLight1.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(...centerXY, <span class="hljs-number">30</span>)
  <span class="hljs-comment">// å¹³è¡Œå…‰2</span>
  <span class="hljs-keyword">let</span> directionalLight2 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0x7af4ff</span>, <span class="hljs-number">1</span>)
  directionalLight2.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(...centerXY, <span class="hljs-number">30</span>)
  <span class="hljs-comment">// ç¯å¢ƒå…‰</span>
  <span class="hljs-keyword">let</span> ambientLight = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">AmbientLight</span>(<span class="hljs-number">0x7af4ff</span>, <span class="hljs-number">1</span>)
  <span class="hljs-comment">// å°†å…‰æºæ·»åŠ åˆ°åœºæ™¯ä¸­</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addObject</span>(directionalLight1)
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addObject</span>(directionalLight2)
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addObject</span>(ambientLight)
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆå§‹åŒ–åœºæ™¯å…‰æºï¼ŒåŒ…æ‹¬å¹³è¡Œå…‰å’Œç¯å¢ƒå…‰ï¼Œå¢å¼º3Dæ•ˆæœã€‚</p>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºä¸¤ä¸ªå¹³è¡Œå…‰å¹¶è®¾ç½®ä½ç½®</li>
<li>åˆ›å»ºç¯å¢ƒå…‰</li>
<li>å°†æ‰€æœ‰å…‰æºæ·»åŠ åˆ°åœºæ™¯</li>
</ol>
<h4 data-id="heading-21">initControls - æ§åˆ¶å™¨åˆå§‹åŒ–</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">initControls</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">let</span> {
      <span class="hljs-attr">controls</span>: { enableDamping, autoRotate, visibel, maxPolarAngle },
    } = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>
    <span class="hljs-keyword">if</span> (!visibel) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">controls</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span>.<span class="hljs-property">domElement</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">controls</span>.<span class="hljs-property">maxPolarAngle</span> = maxPolarAngle
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">controls</span>.<span class="hljs-property">autoRotate</span> = autoRotate
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">controls</span>.<span class="hljs-property">enableDamping</span> = enableDamping
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error)
  }
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆå§‹åŒ–è½¨é“æ§åˆ¶å™¨ï¼Œå®ç°åœ°å›¾çš„äº¤äº’æ§åˆ¶ã€‚</p>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥æ§åˆ¶å™¨æ˜¯å¦å¯ç”¨</li>
<li>åˆ›å»ºOrbitControlså®ä¾‹</li>
<li>è®¾ç½®æ§åˆ¶å™¨å‚æ•°ï¼ˆæœ€å¤§æè§’ã€è‡ªåŠ¨æ—‹è½¬ã€é˜»å°¼æ•ˆæœç­‰ï¼‰</li>
</ol>
<h4 data-id="heading-22">loop - æ¸²æŸ“å¾ªç¯</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">loop</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationStop</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">loop</span>()
  })
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span>.<span class="hljs-title function_">render</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>)
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">controls</span>.<span class="hljs-property">visibel</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">controls</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">controls</span>.<span class="hljs-title function_">update</span>()
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">statsVisibel</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">stats</span>.<span class="hljs-title function_">update</span>()
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rotatingApertureMesh</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotatingApertureMesh</span>.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> += <span class="hljs-number">0.0005</span>
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rotatingPointMesh</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotatingPointMesh</span>.<span class="hljs-property">rotation</span>.<span class="hljs-property">z</span> -= <span class="hljs-number">0.0005</span>
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">css2dRender</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">css2dRender</span>.<span class="hljs-title function_">render</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span>)
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">particleArr</span>.<span class="hljs-property">length</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">particleArr</span>.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">particleArr</span>[i].<span class="hljs-title function_">updateSequenceFrame</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">particleArr</span>[i].<span class="hljs-property">position</span>.<span class="hljs-property">z</span> += <span class="hljs-number">0.01</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">particleArr</span>[i].<span class="hljs-property">position</span>.<span class="hljs-property">z</span> &gt;= <span class="hljs-number">6</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">particleArr</span>[i].<span class="hljs-property">position</span>.<span class="hljs-property">z</span> = -<span class="hljs-number">6</span>
      }
    }
  }
  <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title function_">update</span>()
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šå®ç°åœ°å›¾çš„æŒç»­æ¸²æŸ“å’ŒåŠ¨ç”»æ•ˆæœæ›´æ–°ã€‚</p>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>ä½¿ç”¨requestAnimationFrameåˆ›å»ºæ¸²æŸ“å¾ªç¯</li>
<li>æ¸²æŸ“3Dåœºæ™¯</li>
<li>æ›´æ–°æ§åˆ¶å™¨çŠ¶æ€</li>
<li>æ›´æ–°æ€§èƒ½ç»Ÿè®¡</li>
<li>æ›´æ–°æ—‹è½¬å…‰åœˆåŠ¨ç”»</li>
<li>æ›´æ–°æ—‹è½¬ç‚¹åŠ¨ç”»</li>
<li>æ¸²æŸ“2Dæ ‡ç­¾</li>
<li>æ›´æ–°ç²’å­åŠ¨ç”»</li>
<li>æ›´æ–°Tween.jsåŠ¨ç”»</li>
</ol>
<h3 data-id="heading-23">2. App.vue - è‡ªå®šä¹‰åœ°å›¾æ¨¡å‹åˆå§‹åŒ–</h3>
<h4 data-id="heading-24">initModel - æ¨¡å‹åˆå§‹åŒ–ï¼ˆåœ¨CurrentMap3dç±»ä¸­é‡å†™ï¼‰</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">initModel</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// åˆ›å»ºç»„</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapGroup</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()
    <span class="hljs-comment">// æ ‡ç­¾åˆå§‹åŒ–</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">css2dRender</span> = <span class="hljs-title function_">initCSS2DRender</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>)

    provinceData.<span class="hljs-property">features</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">elem, index</span>) =&gt;</span> {
      <span class="hljs-comment">// å®šä¸€ä¸ªçœä»½å¯¹è±¡</span>
      <span class="hljs-keyword">const</span> province = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Object3D</span>()
      <span class="hljs-comment">// åæ ‡</span>
      <span class="hljs-keyword">const</span> coordinates = elem.<span class="hljs-property">geometry</span>.<span class="hljs-property">coordinates</span>

      <span class="hljs-comment">// å¾ªç¯åæ ‡</span>
      coordinates.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">multiPolygon</span>) =&gt;</span> {
        multiPolygon.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">polygon</span>) =&gt;</span> {
          <span class="hljs-keyword">const</span> shape = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Shape</span>()
          <span class="hljs-comment">// ç»˜åˆ¶shape</span>
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; polygon.<span class="hljs-property">length</span>; i++) {
            <span class="hljs-keyword">let</span> [x, y] = polygon[i]
            <span class="hljs-keyword">if</span> (i === <span class="hljs-number">0</span>) {
              shape.<span class="hljs-title function_">moveTo</span>(x, y)
            }
            shape.<span class="hljs-title function_">lineTo</span>(x, y)
          }
          <span class="hljs-comment">// æ‹‰ä¼¸è®¾ç½®</span>
          <span class="hljs-keyword">const</span> extrudeSettings = {
            <span class="hljs-attr">depth</span>: <span class="hljs-number">0.2</span>,
            <span class="hljs-attr">bevelEnabled</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">bevelSegments</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">bevelThickness</span>: <span class="hljs-number">0.1</span>,
          }
          <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">ExtrudeGeometry</span>(shape, extrudeSettings)
          <span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, [topFaceMaterial, sideMaterial])
          province.<span class="hljs-title function_">add</span>(mesh)
        })
      })
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapGroup</span>.<span class="hljs-title function_">add</span>(province)
      <span class="hljs-comment">// åˆ›å»ºæ ‡ç‚¹å’Œæ ‡ç­¾</span>
      <span class="hljs-title function_">initLightPoint</span>(properties, <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapGroup</span>)
      <span class="hljs-title function_">initLabel</span>(properties, <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>)
    })
    <span class="hljs-comment">// åˆ›å»ºä¸Šä¸‹è¾¹æ¡†</span>
    <span class="hljs-title function_">initBorderLine</span>(provinceData, <span class="hljs-variable language_">this</span>.<span class="hljs-property">mapGroup</span>)

    <span class="hljs-keyword">let</span> earthGroupBound = <span class="hljs-title function_">getBoundingBox</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mapGroup</span>)
    centerXY = [earthGroupBound.<span class="hljs-property">center</span>.<span class="hljs-property">x</span>, earthGroupBound.<span class="hljs-property">center</span>.<span class="hljs-property">y</span>]
    <span class="hljs-keyword">let</span> { size } = earthGroupBound
    <span class="hljs-keyword">let</span> width = size.<span class="hljs-property">x</span> &lt; size.<span class="hljs-property">y</span> ? size.<span class="hljs-property">y</span> + <span class="hljs-number">1</span> : size.<span class="hljs-property">x</span> + <span class="hljs-number">1</span>
    <span class="hljs-comment">// æ·»åŠ èƒŒæ™¯ï¼Œä¿®é¥°å…ƒç´ </span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotatingApertureMesh</span> = <span class="hljs-title function_">initRotatingAperture</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>, width)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rotatingPointMesh</span> = <span class="hljs-title function_">initRotatingPoint</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>, width - <span class="hljs-number">2</span>)
    <span class="hljs-title function_">initCirclePoint</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>, width)
    <span class="hljs-title function_">initSceneBg</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>, width)

    <span class="hljs-comment">// å°†ç»„æ·»åŠ åˆ°åœºæ™¯ä¸­</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>.<span class="hljs-title function_">add</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mapGroup</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">particleArr</span> = <span class="hljs-title function_">initParticle</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span>, earthGroupBound)
    <span class="hljs-title function_">initGui</span>()
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error)
  }
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆå§‹åŒ–3Dåœ°å›¾æ¨¡å‹ï¼ŒåŒ…æ‹¬çœä»½å‡ ä½•ä½“ã€æè´¨ã€æ ‡ç­¾ã€è£…é¥°å…ƒç´ ç­‰ã€‚</p>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºåœ°å›¾æ¨¡å‹ç»„</li>
<li>åˆå§‹åŒ–2Dæ ‡ç­¾æ¸²æŸ“å™¨</li>
<li>éå†åœ°å›¾æ•°æ®åˆ›å»ºçœä»½æ¨¡å‹</li>
<li>ä¸ºæ¯ä¸ªçœä»½åˆ›å»º3Då‡ ä½•ä½“å’Œæè´¨</li>
<li>æ·»åŠ å…‰æŸ±æ ‡è®°å’Œæ ‡ç­¾</li>
<li>åˆ›å»ºåœ°å›¾è¾¹æ¡†</li>
<li>è®¡ç®—åœ°å›¾åŒ…å›´ç›’å’Œä¸­å¿ƒç‚¹</li>
<li>æ·»åŠ è£…é¥°å…ƒç´ ï¼ˆæ—‹è½¬å…‰åœˆã€èƒŒæ™¯ç­‰ï¼‰</li>
<li>å°†åœ°å›¾ç»„æ·»åŠ åˆ°åœºæ™¯</li>
<li>åˆå§‹åŒ–ç²’å­ç³»ç»Ÿ</li>
<li>åˆå§‹åŒ–GUIæ§åˆ¶å™¨</li>
</ol>
<h2 data-id="heading-25">è§†è§‰æ•ˆæœå¢å¼ºæ¨¡å—</h2>
<h3 data-id="heading-26">1. useMapMarkedLightPillar.js - å…‰æŸ±æ ‡è®°é’©å­</h3>
<h4 data-id="heading-27">createLightPillar - åˆ›å»ºå…‰æŸ±æ ‡è®°</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createLightPillar</span> = (<span class="hljs-params">lon, lat, heightScaleFactor = <span class="hljs-number">1</span></span>) =&gt; {
  <span class="hljs-keyword">let</span> group = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Group</span>()
  <span class="hljs-comment">// æŸ±ä½“é«˜åº¦</span>
  <span class="hljs-keyword">const</span> height = heightScaleFactor
  <span class="hljs-comment">// æŸ±ä½“çš„geo,6.19=æŸ±ä½“å›¾ç‰‡é«˜åº¦/å®½åº¦çš„å€æ•°</span>
  <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneBufferGeometry</span>(height / <span class="hljs-number">6.219</span>, height)
  <span class="hljs-comment">// æŸ±ä½“æ—‹è½¬90åº¦ï¼Œå‚ç›´äºYè½´</span>
  geometry.<span class="hljs-title function_">rotateX</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>)
  <span class="hljs-comment">// æŸ±ä½“çš„zè½´ç§»åŠ¨é«˜åº¦ä¸€åŠå¯¹é½ä¸­å¿ƒç‚¹</span>
  geometry.<span class="hljs-title function_">translate</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, height / <span class="hljs-number">2</span>)
  <span class="hljs-comment">// æŸ±å­æè´¨</span>
  <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({
    <span class="hljs-attr">map</span>: textureLoader.<span class="hljs-title function_">load</span>(defaultOptions.<span class="hljs-property">lightPillarUrl</span>),
    <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ffff</span>,
    <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">depthWrite</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">side</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">DoubleSide</span>,
  })
  <span class="hljs-comment">// å…‰æŸ±01</span>
  <span class="hljs-keyword">let</span> light01 = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material)
  light01.<span class="hljs-property">renderOrder</span> = <span class="hljs-number">99</span>
  light01.<span class="hljs-property">name</span> = <span class="hljs-string">"createLightPillar01"</span>
  <span class="hljs-comment">// å…‰æŸ±02ï¼šå¤åˆ¶å…‰æŸ±01</span>
  <span class="hljs-keyword">let</span> light02 = light01.<span class="hljs-title function_">clone</span>()
  light02.<span class="hljs-property">name</span> = <span class="hljs-string">"createLightPillar02"</span>
  <span class="hljs-comment">// å…‰æŸ±02ï¼Œæ—‹è½¬90Â°ï¼Œè·Ÿå…‰æŸ±01äº¤å‰</span>
  light02.<span class="hljs-title function_">rotateZ</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>)
  <span class="hljs-comment">// åˆ›å»ºåº•éƒ¨æ ‡ç‚¹</span>
  <span class="hljs-keyword">const</span> bottomMesh = <span class="hljs-title function_">createPointMesh</span>()
  <span class="hljs-comment">// åˆ›å»ºå…‰åœˆ</span>
  <span class="hljs-keyword">const</span> lightHalo = <span class="hljs-title function_">createLightHalo</span>()
  <span class="hljs-comment">// å°†å…‰æŸ±å’Œæ ‡ç‚¹æ·»åŠ åˆ°ç»„é‡Œ</span>
  group.<span class="hljs-title function_">add</span>(bottomMesh, lightHalo, light01, light02)
  <span class="hljs-comment">// è®¾ç½®ç»„å¯¹è±¡çš„å§¿æ€</span>
  group.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(lon, lat, <span class="hljs-number">0</span>)
  <span class="hljs-keyword">return</span> group
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆ›å»ºåŒ…å«åº•éƒ¨æ ‡è®°ã€å‘¼å¸å…‰åœˆå’Œäº¤å‰å…‰æŸ±çš„å®Œæ•´æ ‡è®°æ•ˆæœã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>lon</code>ï¼šç»åº¦åæ ‡</li>
<li><code>lat</code>ï¼šçº¬åº¦åæ ‡</li>
<li><code>heightScaleFactor</code>ï¼šå…‰æŸ±é«˜åº¦ç¼©æ”¾ç³»æ•°</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šåŒ…å«å®Œæ•´å…‰æŸ±æ•ˆæœçš„Three.js Groupå¯¹è±¡</p>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>åˆ›å»ºå…‰æŸ±ç»„å®¹å™¨</li>
<li>è®¡ç®—æŸ±ä½“å°ºå¯¸å’Œå‡ ä½•ä½“</li>
<li>åˆ›å»ºæŸ±ä½“è´´å›¾æè´¨</li>
<li>åˆ›å»ºç¬¬ä¸€ä¸ªå…‰æŸ±å¹¶è®¾ç½®æ¸²æŸ“é¡ºåº</li>
<li>å…‹éš†å¹¶æ—‹è½¬åˆ›å»ºç¬¬äºŒä¸ªäº¤å‰å…‰æŸ±</li>
<li>åˆ›å»ºåº•éƒ¨æ ‡è®°ç‚¹</li>
<li>åˆ›å»ºå‘¼å¸å…‰åœˆ</li>
<li>å°†æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°ç»„ä¸­</li>
<li>è®¾ç½®ç»„çš„ä½ç½®åæ ‡</li>
<li>è¿”å›å®Œæ•´çš„å…‰æŸ±ç»„</li>
</ol>
<h4 data-id="heading-28">createPointMesh - åˆ›å»ºæ ‡è®°ç‚¹</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createPointMesh</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// æ ‡è®°ç‚¹ï¼šå‡ ä½•ä½“ï¼Œæè´¨</span>
  <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneBufferGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
  <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({
    <span class="hljs-attr">map</span>: textureLoader.<span class="hljs-title function_">load</span>(defaultOptions.<span class="hljs-property">pointTextureUrl</span>),
    <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ffff</span>,
    <span class="hljs-attr">side</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">DoubleSide</span>,
    <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">depthWrite</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//ç¦æ­¢å†™å…¥æ·±åº¦ç¼“å†²åŒºæ•°æ®</span>
  })
  <span class="hljs-keyword">let</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material)
  mesh.<span class="hljs-property">renderOrder</span> = <span class="hljs-number">97</span>
  mesh.<span class="hljs-property">name</span> = <span class="hljs-string">"createPointMesh"</span>
  <span class="hljs-comment">// ç¼©æ”¾</span>
  <span class="hljs-keyword">const</span> scale = <span class="hljs-number">0.15</span> * defaultOptions.<span class="hljs-property">scaleFactor</span>
  mesh.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(scale, scale, scale)
  <span class="hljs-keyword">return</span> mesh
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆ›å»ºå…‰æŸ±åº•éƒ¨çš„æ ‡è®°ç‚¹ã€‚</p>
<p><strong>è¿”å›å€¼</strong>ï¼šæ ‡è®°ç‚¹Meshå¯¹è±¡</p>
<p><strong>å®ç°åŸç†</strong>ï¼šä½¿ç”¨PlaneGeometryåˆ›å»ºå¹³é¢ï¼ŒåŠ è½½æ ‡è®°ç‚¹çº¹ç†ï¼Œè®¾ç½®é€æ˜å’Œæ¸²æŸ“é¡ºåºã€‚</p>
<h4 data-id="heading-29">createLightHalo - åˆ›å»ºå‘¼å¸å…‰åœˆ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createLightHalo</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// æ ‡è®°ç‚¹ï¼šå‡ ä½•ä½“ï¼Œæè´¨</span>
  <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneBufferGeometry</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
  <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({
    <span class="hljs-attr">map</span>: textureLoader.<span class="hljs-title function_">load</span>(defaultOptions.<span class="hljs-property">lightHaloTextureUrl</span>),
    <span class="hljs-attr">color</span>: <span class="hljs-number">0x00ffff</span>,
    <span class="hljs-attr">side</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">DoubleSide</span>,
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">depthWrite</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">//ç¦æ­¢å†™å…¥æ·±åº¦ç¼“å†²åŒºæ•°æ®</span>
  })
  <span class="hljs-keyword">let</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material)
  mesh.<span class="hljs-property">renderOrder</span> = <span class="hljs-number">98</span>
  mesh.<span class="hljs-property">name</span> = <span class="hljs-string">"createLightHalo"</span>
  <span class="hljs-comment">// ç¼©æ”¾</span>
  <span class="hljs-keyword">const</span> scale = <span class="hljs-number">0.3</span> * defaultOptions.<span class="hljs-property">scaleFactor</span>
  mesh.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(scale, scale, scale)
  <span class="hljs-comment">// åŠ¨ç”»å»¶è¿Ÿæ—¶é—´</span>
  <span class="hljs-keyword">const</span> delay = <span class="hljs-title function_">random</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2000</span>)
  <span class="hljs-comment">// åŠ¨ç”»ï¼šé€æ˜åº¦ç¼©æ”¾åŠ¨ç”»</span>
  mesh.<span class="hljs-property">tween1</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title class_">Tween</span>({ <span class="hljs-attr">scale</span>: scale, <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span> })
    .<span class="hljs-title function_">to</span>({ <span class="hljs-attr">scale</span>: scale * <span class="hljs-number">1.5</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span> }, <span class="hljs-number">1000</span>)
    .<span class="hljs-title function_">delay</span>(delay)
    .<span class="hljs-title function_">onUpdate</span>(<span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> { scale, opacity } = params
      mesh.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(scale, scale, scale)
      mesh.<span class="hljs-property">material</span>.<span class="hljs-property">opacity</span> = opacity
    })
  mesh.<span class="hljs-property">tween2</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">TWEEN</span>.<span class="hljs-title class_">Tween</span>({ <span class="hljs-attr">scale</span>: scale * <span class="hljs-number">1.5</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span> })
    .<span class="hljs-title function_">to</span>({ <span class="hljs-attr">scale</span>: scale * <span class="hljs-number">2</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">0</span> }, <span class="hljs-number">1000</span>)
    .<span class="hljs-title function_">onUpdate</span>(<span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> { scale, opacity } = params
      mesh.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(scale, scale, scale)
      mesh.<span class="hljs-property">material</span>.<span class="hljs-property">opacity</span> = opacity
    })
  mesh.<span class="hljs-property">tween1</span>.<span class="hljs-title function_">chain</span>(mesh.<span class="hljs-property">tween2</span>)
  mesh.<span class="hljs-property">tween2</span>.<span class="hljs-title function_">chain</span>(mesh.<span class="hljs-property">tween1</span>)
  mesh.<span class="hljs-property">tween1</span>.<span class="hljs-title function_">start</span>()
  <span class="hljs-keyword">return</span> mesh
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆ›å»ºå¸¦æœ‰å‘¼å¸åŠ¨ç”»æ•ˆæœçš„å…‰åœˆã€‚</p>
<p><strong>è¿”å›å€¼</strong>ï¼šå…‰åœˆMeshå¯¹è±¡ï¼ˆå¸¦æœ‰tweenåŠ¨ç”»ï¼‰</p>
<p><strong>å®ç°åŸç†</strong>ï¼šåˆ›å»ºå¹³é¢å¹¶åŠ è½½å…‰åœˆçº¹ç†ï¼Œä½¿ç”¨Tween.jså®ç°é€æ˜åº¦å’Œç¼©æ”¾çš„å¾ªç¯åŠ¨ç”»ï¼Œå½¢æˆå‘¼å¸æ•ˆæœã€‚</p>
<h3 data-id="heading-30">2. useSequenceFrameAnimate.js - åºåˆ—å¸§åŠ¨ç”»é’©å­</h3>
<h4 data-id="heading-31">createSequenceFrame - åˆ›å»ºåºåˆ—å¸§åŠ¨ç”»</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">createSequenceFrame</span> = (<span class="hljs-params">{ image, width, height, frame, column, row, speed = <span class="hljs-number">0.1</span> }</span>) =&gt; {
  <span class="hljs-comment">// åˆ›å»ºå¹³é¢å‡ ä½•ä½“</span>
  <span class="hljs-keyword">const</span> geometry = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneGeometry</span>(width, height)
  <span class="hljs-comment">// åˆ›å»ºçº¹ç†</span>
  <span class="hljs-keyword">const</span> texture = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">TextureLoader</span>().<span class="hljs-title function_">load</span>(image)
  <span class="hljs-comment">// è®¾ç½®çº¹ç†å‚æ•°</span>
  texture.<span class="hljs-property">wrapS</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RepeatWrapping</span>
  texture.<span class="hljs-property">wrapT</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">RepeatWrapping</span>
  <span class="hljs-comment">// è®¡ç®—æ¯ä¸ªå¸§çš„å¤§å°</span>
  <span class="hljs-keyword">const</span> frameWidth = <span class="hljs-number">1</span> / column
  <span class="hljs-keyword">const</span> frameHeight = <span class="hljs-number">1</span> / row
  <span class="hljs-comment">// è®¾ç½®çº¹ç†æ˜¾ç¤ºåŒºåŸŸ</span>
  texture.<span class="hljs-property">repeat</span>.<span class="hljs-title function_">set</span>(frameWidth, frameHeight)
  <span class="hljs-comment">// åˆ›å»ºæè´¨</span>
  <span class="hljs-keyword">const</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({
    <span class="hljs-attr">map</span>: texture,
    <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">side</span>: <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">DoubleSide</span>,
  })
  <span class="hljs-comment">// åˆ›å»ºç½‘æ ¼</span>
  <span class="hljs-keyword">const</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(geometry, material)
  <span class="hljs-comment">// æ·»åŠ åŠ¨ç”»å±æ€§</span>
  mesh.<span class="hljs-property">currentFrame</span> = <span class="hljs-number">0</span>
  mesh.<span class="hljs-property">totalFrames</span> = frame
  mesh.<span class="hljs-property">column</span> = column
  mesh.<span class="hljs-property">frameWidth</span> = frameWidth
  mesh.<span class="hljs-property">frameHeight</span> = frameHeight
  mesh.<span class="hljs-property">speed</span> = speed
  mesh.<span class="hljs-property">texture</span> = texture
  
  <span class="hljs-comment">// æ·»åŠ æ›´æ–°æ–¹æ³•</span>
  mesh.<span class="hljs-property">updateSequenceFrame</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFrame</span> += <span class="hljs-variable language_">this</span>.<span class="hljs-property">speed</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFrame</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalFrames</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFrame</span> = <span class="hljs-number">0</span>
    }
    <span class="hljs-keyword">const</span> frameIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentFrame</span>)
    <span class="hljs-keyword">const</span> x = (frameIndex % <span class="hljs-variable language_">this</span>.<span class="hljs-property">column</span>) * <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameWidth</span>
    <span class="hljs-keyword">const</span> y = <span class="hljs-number">1</span> - <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(frameIndex / <span class="hljs-variable language_">this</span>.<span class="hljs-property">column</span>) * <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameHeight</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameHeight</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">texture</span>.<span class="hljs-property">offset</span>.<span class="hljs-title function_">set</span>(x, y)
  }
  
  <span class="hljs-keyword">return</span> mesh
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆ›å»ºåŸºäºåºåˆ—å¸§å›¾ç‰‡çš„åŠ¨ç”»æ•ˆæœã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>image</code>ï¼šåºåˆ—å¸§å›¾ç‰‡è·¯å¾„</li>
<li><code>width</code>ï¼šåŠ¨ç”»å®½åº¦</li>
<li><code>height</code>ï¼šåŠ¨ç”»é«˜åº¦</li>
<li><code>frame</code>ï¼šæ€»å¸§æ•°</li>
<li><code>column</code>ï¼šæ¯è¡Œå¸§æ•°</li>
<li><code>row</code>ï¼šæ¯åˆ—å¸§æ•°</li>
<li><code>speed</code>ï¼šåŠ¨ç”»æ’­æ”¾é€Ÿåº¦</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šå¸¦æœ‰åŠ¨ç”»æ›´æ–°æ–¹æ³•çš„Three.js Meshå¯¹è±¡</p>
<p><strong>å®ç°åŸç†</strong>ï¼šé€šè¿‡æ§åˆ¶çº¹ç†çš„offsetå±æ€§ï¼Œå®ç°åºåˆ—å¸§å›¾ç‰‡çš„é€å¸§æ’­æ”¾ï¼Œå½¢æˆåŠ¨ç”»æ•ˆæœã€‚</p>
<h2 data-id="heading-32">2Dæ ‡ç­¾æ¸²æŸ“æ¨¡å—</h2>
<h3 data-id="heading-33">1. useCSS2DRender.js - CSS2Dæ¸²æŸ“é’©å­</h3>
<h4 data-id="heading-34">initCSS2DRender - åˆå§‹åŒ–2Dæ¸²æŸ“å™¨</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">initCSS2DRender</span> = (<span class="hljs-params">options, container</span>) =&gt; {
  <span class="hljs-keyword">const</span> css2dRender = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">CSS2DRenderer</span>()
  css2dRender.<span class="hljs-title function_">setSize</span>(options.<span class="hljs-property">width</span>, options.<span class="hljs-property">height</span>)
  css2dRender.<span class="hljs-property">domElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">'absolute'</span>
  css2dRender.<span class="hljs-property">domElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = <span class="hljs-string">'0px'</span>
  css2dRender.<span class="hljs-property">domElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">pointerEvents</span> = <span class="hljs-string">'none'</span>
  container.<span class="hljs-title function_">appendChild</span>(css2dRender.<span class="hljs-property">domElement</span>)
  <span class="hljs-keyword">return</span> css2dRender
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆå§‹åŒ–CSS2DRendererï¼Œç”¨äºåœ¨3Dåœºæ™¯ä¸­æ¸²æŸ“2D HTMLå…ƒç´ ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>options</code>ï¼šæ¸²æŸ“å™¨é…ç½®å‚æ•°</li>
<li><code>container</code>ï¼šDOMå®¹å™¨å…ƒç´ </li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šåˆå§‹åŒ–å®Œæˆçš„CSS2DRendererå®ä¾‹</p>
<p><strong>å®ç°åŸç†</strong>ï¼šä½¿ç”¨Three.jsçš„CSS2DRendereråˆ›å»ºä¸€ä¸ªä¸3Dæ¸²æŸ“å™¨å åŠ çš„2Dæ¸²æŸ“å±‚ï¼Œç”¨äºæ˜¾ç¤ºHTMLæ ‡ç­¾ã€‚</p>
<h4 data-id="heading-35">create2DTag - åˆ›å»º2Dæ ‡ç­¾</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">create2DTag</span> = (<span class="hljs-params">className</span>) =&gt; {
  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
  div.<span class="hljs-property">className</span> = className
  div.<span class="hljs-property">style</span>.<span class="hljs-property">color</span> = <span class="hljs-string">'#fff'</span>
  div.<span class="hljs-property">style</span>.<span class="hljs-property">padding</span> = <span class="hljs-string">'4px 8px'</span>
  div.<span class="hljs-property">style</span>.<span class="hljs-property">borderRadius</span> = <span class="hljs-string">'4px'</span>
  div.<span class="hljs-property">style</span>.<span class="hljs-property">fontSize</span> = <span class="hljs-string">'12px'</span>
  div.<span class="hljs-property">style</span>.<span class="hljs-property">whiteSpace</span> = <span class="hljs-string">'nowrap'</span>
  div.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'0'</span>
  
  <span class="hljs-keyword">const</span> label = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">CSS2DObject</span>(div)
  label.<span class="hljs-property">visible</span> = <span class="hljs-literal">false</span>
  
  <span class="hljs-comment">// æ·»åŠ æ˜¾ç¤ºæ–¹æ³•</span>
  label.<span class="hljs-property">show</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">text, position</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">innerHTML</span> = text
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">position</span>.<span class="hljs-title function_">copy</span>(position)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visible</span> = <span class="hljs-literal">true</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'1'</span>
  }
  
  <span class="hljs-comment">// æ·»åŠ éšè—æ–¹æ³•</span>
  label.<span class="hljs-property">hide</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visible</span> = <span class="hljs-literal">false</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">element</span>.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'0'</span>
  }
  
  <span class="hljs-keyword">return</span> label
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆ›å»ºå¯æ˜¾ç¤ºåœ¨3Dåœºæ™¯ä¸­çš„2D HTMLæ ‡ç­¾ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>className</code>ï¼šæ ‡ç­¾çš„CSSç±»å</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šå¸¦æœ‰showå’Œhideæ–¹æ³•çš„CSS2DObjectå®ä¾‹</p>
<p><strong>å®ç°åŸç†</strong>ï¼šåˆ›å»ºHTMLå…ƒç´ å¹¶å°è£…ä¸ºCSS2DObjectï¼Œæ·»åŠ æ˜¾ç¤ºå’Œéšè—æ–¹æ³•ï¼Œä¾¿äºåœ¨3Dåœºæ™¯ä¸­æ§åˆ¶æ ‡ç­¾çš„æ˜¾ç¤ºã€‚</p>
<h2 data-id="heading-36">åœ°å›¾è£…é¥°å…ƒç´ æ¨¡å—</h2>
<h3 data-id="heading-37">1. App.vue - è£…é¥°å…ƒç´ åˆ›å»ºå‡½æ•°</h3>
<h4 data-id="heading-38">initRotatingAperture - åˆå§‹åŒ–æ—‹è½¬å…‰åœˆ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">initRotatingAperture</span> = (<span class="hljs-params">scene, width</span>) =&gt; {
  <span class="hljs-keyword">let</span> plane = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PlaneBufferGeometry</span>(width, width)
  <span class="hljs-keyword">let</span> material = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">MeshBasicMaterial</span>({
    <span class="hljs-attr">map</span>: rotatingApertureTexture,
    <span class="hljs-attr">transparent</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">depthTest</span>: <span class="hljs-literal">true</span>,
  })
  <span class="hljs-keyword">let</span> mesh = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Mesh</span>(plane, material)
  mesh.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(...centerXY, <span class="hljs-number">0</span>)
  mesh.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">1.1</span>, <span class="hljs-number">1.1</span>, <span class="hljs-number">1.1</span>)
  scene.<span class="hljs-title function_">add</span>(mesh)
  <span class="hljs-keyword">return</span> mesh
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆ›å»ºåœ°å›¾åº•éƒ¨çš„æ—‹è½¬å…‰åœˆæ•ˆæœã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>scene</code>ï¼šThree.jsåœºæ™¯å¯¹è±¡</li>
<li><code>width</code>ï¼šå…‰åœˆå®½åº¦</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šå…‰åœˆMeshå¯¹è±¡ï¼ˆåœ¨loopå‡½æ•°ä¸­æ›´æ–°æ—‹è½¬ï¼‰</p>
<h4 data-id="heading-39">initParticle - åˆå§‹åŒ–ç²’å­ç³»ç»Ÿ</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">initParticle</span> = (<span class="hljs-params">scene, bound</span>) =&gt; {
  <span class="hljs-comment">// è·å–ä¸­å¿ƒç‚¹å’Œä¸­é—´åœ°å›¾å¤§å°</span>
  <span class="hljs-keyword">let</span> { center, size } = bound
  <span class="hljs-comment">// æ„å»ºèŒƒå›´ï¼Œä¸­é—´åœ°å›¾çš„2å€</span>
  <span class="hljs-keyword">let</span> minX = center.<span class="hljs-property">x</span> - size.<span class="hljs-property">x</span>
  <span class="hljs-keyword">let</span> maxX = center.<span class="hljs-property">x</span> + size.<span class="hljs-property">x</span>
  <span class="hljs-keyword">let</span> minY = center.<span class="hljs-property">y</span> - size.<span class="hljs-property">y</span>
  <span class="hljs-keyword">let</span> maxY = center.<span class="hljs-property">y</span> + size.<span class="hljs-property">y</span>
  <span class="hljs-keyword">let</span> minZ = -<span class="hljs-number">6</span>
  <span class="hljs-keyword">let</span> maxZ = <span class="hljs-number">6</span>

  <span class="hljs-keyword">let</span> particleArr = []
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    <span class="hljs-keyword">const</span> particle = <span class="hljs-title function_">createSequenceFrame</span>({
      <span class="hljs-attr">image</span>: <span class="hljs-string">"./data/map/ä¸Šå‡ç²’å­1.png"</span>,
      <span class="hljs-attr">width</span>: <span class="hljs-number">180</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-number">189</span>,
      <span class="hljs-attr">frame</span>: <span class="hljs-number">9</span>,
      <span class="hljs-attr">column</span>: <span class="hljs-number">9</span>,
      <span class="hljs-attr">row</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">speed</span>: <span class="hljs-number">0.5</span>,
    })
    <span class="hljs-keyword">let</span> particleScale = <span class="hljs-title function_">random</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>) / <span class="hljs-number">1000</span>
    particle.<span class="hljs-property">scale</span>.<span class="hljs-title function_">set</span>(particleScale, particleScale, particleScale)
    particle.<span class="hljs-property">rotation</span>.<span class="hljs-property">x</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">2</span>
    <span class="hljs-keyword">let</span> x = <span class="hljs-title function_">random</span>(minX, maxX)
    <span class="hljs-keyword">let</span> y = <span class="hljs-title function_">random</span>(minY, maxY)
    <span class="hljs-keyword">let</span> z = <span class="hljs-title function_">random</span>(minZ, maxZ)
    particle.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(x, y, z)
    particleArr.<span class="hljs-title function_">push</span>(particle)
  }
  scene.<span class="hljs-title function_">add</span>(...particleArr)
  <span class="hljs-keyword">return</span> particleArr
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼šåˆ›å»ºä¸Šå‡ç²’å­æ•ˆæœï¼Œå¢å¼ºåœ°å›¾çš„åŠ¨æ€æ„Ÿã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><code>scene</code>ï¼šThree.jsåœºæ™¯å¯¹è±¡</li>
<li><code>bound</code>ï¼šåœ°å›¾è¾¹ç•Œä¿¡æ¯å¯¹è±¡</li>
</ul>
<p><strong>è¿”å›å€¼</strong>ï¼šç²’å­å¯¹è±¡æ•°ç»„ï¼ˆåœ¨loopå‡½æ•°ä¸­æ›´æ–°ä½ç½®å’ŒåŠ¨ç”»ï¼‰</p>
<p><strong>æ‰§è¡Œæ­¥éª¤</strong>ï¼š</p>
<ol>
<li>è®¡ç®—ç²’å­ç”ŸæˆèŒƒå›´</li>
<li>å¾ªç¯åˆ›å»ºç²’å­å¯¹è±¡</li>
<li>åŠ è½½åºåˆ—å¸§ç²’å­å›¾ç‰‡</li>
<li>è®¾ç½®ç²’å­å¤§å°å’Œæ—‹è½¬è§’åº¦</li>
<li>éšæœºåˆ†å¸ƒç²’å­ä½ç½®</li>
<li>å°†ç²’å­æ·»åŠ åˆ°åœºæ™¯</li>
<li>è¿”å›ç²’å­æ•°ç»„</li>
</ol>
<h2 data-id="heading-40">æ€»ç»“</h2>
<p>æœ¬é¡¹ç›®é€šè¿‡æ¨¡å—åŒ–è®¾è®¡å’Œç»„ä»¶åŒ–å¼€å‘ï¼Œæ„å»ºäº†ä¸€ä¸ªåŠŸèƒ½ä¸°å¯Œã€æ€§èƒ½ä¼˜è‰¯çš„3Däº¤äº’å¼åœ°å›¾å¯è§†åŒ–ç³»ç»Ÿã€‚æ ¸å¿ƒå‡½æ•°æŒ‰ç…§æ•°æ®å¤„ç†ã€3Då»ºæ¨¡ã€è§†è§‰æ•ˆæœã€äº¤äº’æ§åˆ¶ç­‰æ¨¡å—è¿›è¡Œç»„ç»‡ï¼Œå½¢æˆäº†æ¸…æ™°çš„è°ƒç”¨å…³ç³»å’Œæ‰§è¡Œæµç¨‹ã€‚</p>
<p>ç³»ç»Ÿçš„ä¸»è¦æŠ€æœ¯äº®ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>é«˜æ•ˆçš„æ•°æ®å¤„ç†</strong>ï¼šå®ç°äº†GeoJSONæ•°æ®çš„æ ‡å‡†åŒ–è½¬æ¢å’Œåæ ‡ç³»ç»Ÿè½¬æ¢</li>
<li><strong>ç²¾ç¾çš„3Dæ¨¡å‹</strong>ï¼šä½¿ç”¨ExtrudeGeometryåˆ›å»ºå…·æœ‰ç«‹ä½“æ„Ÿçš„åœ°å›¾æ¨¡å‹</li>
<li><strong>ä¸°å¯Œçš„è§†è§‰æ•ˆæœ</strong>ï¼šåŒ…æ‹¬å…‰æŸ±æ ‡è®°ã€å‘¼å¸å…‰åœˆã€ç²’å­åŠ¨ç”»ç­‰</li>
<li><strong>æµç•…çš„äº¤äº’ä½“éªŒ</strong>ï¼šåŸºäºOrbitControlså®ç°çš„ç›¸æœºæ§åˆ¶</li>
<li><strong>çµæ´»çš„2Dæ ‡ç­¾</strong>ï¼šä½¿ç”¨CSS2DRendererå®ç°çš„3Dåœºæ™¯ä¸­2Dæ ‡ç­¾æ¸²æŸ“</li>
</ol>
<p>é€šè¿‡å¯¹è¿™äº›æ ¸å¿ƒå‡½æ•°çš„è¯¦ç»†åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ·±å…¥ç†è§£3Dåœ°å›¾å¯è§†åŒ–ç³»ç»Ÿçš„å®ç°åŸç†å’ŒæŠ€æœ¯ç»†èŠ‚ï¼Œä¸ºç±»ä¼¼é¡¹ç›®çš„å¼€å‘æä¾›å‚è€ƒå’Œå€Ÿé‰´ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Hooks ä¸ºä»€ä¹ˆä¸èƒ½å†™åœ¨åˆ¤æ–­é‡Œ]]></title>    <link>https://juejin.cn/post/7584651851905105939</link>    <guid>https://juejin.cn/post/7584651851905105939</guid>    <pubDate>2025-12-17T13:25:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584651851905105939" data-draft-id="7584650421124579369" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Hooks ä¸ºä»€ä¹ˆä¸èƒ½å†™åœ¨åˆ¤æ–­é‡Œ"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2025-12-17T13:25:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åˆ«æ€¥å›½ç‹"/> <meta itemprop="url" content="https://juejin.cn/user/3139860941777127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Hooks ä¸ºä»€ä¹ˆä¸èƒ½å†™åœ¨åˆ¤æ–­é‡Œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860941777127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åˆ«æ€¥å›½ç‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T13:25:30.000Z" title="Wed Dec 17 2025 13:25:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»¥ä¸‹ react æºç ç‰ˆæœ¬ä¸º 18.3.0</p>
<h2 data-id="heading-0">æ ¸å¿ƒåŸå› </h2>
<p>React hooks ä½¿ç”¨<strong>é“¾è¡¨</strong>å­˜å‚¨çŠ¶æ€ï¼Œä¾èµ–è°ƒç”¨é¡ºåºã€‚å¦‚æœ hooks åœ¨æ¡ä»¶è¯­å¥ä¸­è°ƒç”¨ï¼Œä¼šå¯¼è‡´è°ƒç”¨é¡ºåºä¸ä¸€è‡´ï¼Œä»è€Œå¼•å‘çŠ¶æ€é”™ä¹±ã€‚</p>
<h2 data-id="heading-1">å…³é”®æºç ä½ç½®</h2>
<h3 data-id="heading-2">1. Hooks çš„é“¾è¡¨ç»“æ„å®šä¹‰</h3>
<p>148:154:packages/react-reconciler/src/ReactFiberHooks.new.js</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> type <span class="hljs-title class_">Hook</span> = {|
  <span class="hljs-attr">memoizedState</span>: any,
  <span class="hljs-attr">baseState</span>: any,
  <span class="hljs-attr">baseQueue</span>: <span class="hljs-title class_">Update</span>&lt;any, any&gt; | <span class="hljs-literal">null</span>,
  <span class="hljs-attr">queue</span>: any,
  <span class="hljs-attr">next</span>: <span class="hljs-title class_">Hook</span> | <span class="hljs-literal">null</span>,
|};
</code></pre>
<p>æ¯ä¸ª Hook é€šè¿‡ <code>next</code> æŒ‡é’ˆå½¢æˆé“¾è¡¨ã€‚</p>
<h3 data-id="heading-3">2. Hooks å¦‚ä½•é€šè¿‡é“¾è¡¨å­˜å‚¨</h3>
<p>189:194:packages/react-reconciler/src/ReactFiberHooks.new.js</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// Hooks are stored as a linked list on the fiber's memoizedState field. The</span>
<span class="hljs-comment">// current hook list is the list that belongs to the current fiber. The</span>
<span class="hljs-comment">// work-in-progress hook list is a new list that will be added to the</span>
<span class="hljs-comment">// work-in-progress fiber.</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">currentHook</span>: <span class="hljs-title class_">Hook</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">workInProgressHook</span>: <span class="hljs-title class_">Hook</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
</code></pre>
<p>æ³¨é‡Šè¯´æ˜ï¼šHooks ä»¥é“¾è¡¨å½¢å¼å­˜å‚¨åœ¨ fiber çš„ <code>memoizedState</code> å­—æ®µä¸Šã€‚</p>
<p><a href="https://juejin.cn/post/7584659460246585363" target="_blank" title="https://juejin.cn/post/7584659460246585363">å¦‚ä½•ç†è§£ currentHook å’Œ workInProgressHook</a></p>
<h3 data-id="heading-4">3. é¦–æ¬¡æ¸²æŸ“æ—¶åˆ›å»º Hook èŠ‚ç‚¹</h3>
<p>636:655:packages/react-reconciler/src/ReactFiberHooks.new.js</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mountWorkInProgressHook</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Hook</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">hook</span>: <span class="hljs-title class_">Hook</span> = {
    <span class="hljs-attr">memoizedState</span>: <span class="hljs-literal">null</span>,

    <span class="hljs-attr">baseState</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">baseQueue</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">queue</span>: <span class="hljs-literal">null</span>,

    <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span>,
  };

  <span class="hljs-keyword">if</span> (workInProgressHook === <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// This is the first hook in the list</span>
    currentlyRenderingFiber.<span class="hljs-property">memoizedState</span> = workInProgressHook = hook;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// Append to the end of the list</span>
    workInProgressHook = workInProgressHook.<span class="hljs-property">next</span> = hook;
  }
  <span class="hljs-keyword">return</span> workInProgressHook;
}
</code></pre>
<p>é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œhooks æŒ‰è°ƒç”¨é¡ºåºä¾æ¬¡æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾ã€‚</p>
<h3 data-id="heading-5">4. æ›´æ–°æ—¶æŒ‰é¡ºåºéå†é“¾è¡¨</h3>
<p>657:716:packages/react-reconciler/src/ReactFiberHooks.new.js</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateWorkInProgressHook</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Hook</span> {
  <span class="hljs-comment">// This function is used both for updates and for re-renders triggered by a</span>
  <span class="hljs-comment">// render phase update. It assumes there is either a current hook we can</span>
  <span class="hljs-comment">// clone, or a work-in-progress hook from a previous render pass that we can</span>
  <span class="hljs-comment">// use as a base. When we reach the end of the base list, we must switch to</span>
  <span class="hljs-comment">// the dispatcher used for mounts.</span>
  <span class="hljs-keyword">let</span> <span class="hljs-attr">nextCurrentHook</span>: <span class="hljs-literal">null</span> | <span class="hljs-title class_">Hook</span>;
  <span class="hljs-keyword">if</span> (currentHook === <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">const</span> current = currentlyRenderingFiber.<span class="hljs-property">alternate</span>;
    <span class="hljs-keyword">if</span> (current !== <span class="hljs-literal">null</span>) {
      nextCurrentHook = current.<span class="hljs-property">memoizedState</span>;
    } <span class="hljs-keyword">else</span> {
      nextCurrentHook = <span class="hljs-literal">null</span>;
    }
  } <span class="hljs-keyword">else</span> {
    nextCurrentHook = currentHook.<span class="hljs-property">next</span>;
  }

  <span class="hljs-keyword">let</span> <span class="hljs-attr">nextWorkInProgressHook</span>: <span class="hljs-literal">null</span> | <span class="hljs-title class_">Hook</span>;
  <span class="hljs-keyword">if</span> (workInProgressHook === <span class="hljs-literal">null</span>) {
    nextWorkInProgressHook = currentlyRenderingFiber.<span class="hljs-property">memoizedState</span>;
  } <span class="hljs-keyword">else</span> {
    nextWorkInProgressHook = workInProgressHook.<span class="hljs-property">next</span>;
  }

  <span class="hljs-keyword">if</span> (nextWorkInProgressHook !== <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// There's already a work-in-progress. Reuse it.</span>
    workInProgressHook = nextWorkInProgressHook;
    nextWorkInProgressHook = workInProgressHook.<span class="hljs-property">next</span>;

    currentHook = nextCurrentHook;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// Clone from the current hook.</span>

    <span class="hljs-keyword">if</span> (nextCurrentHook === <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Rendered more hooks than during the previous render.'</span>);
    }

    currentHook = nextCurrentHook;

    <span class="hljs-keyword">const</span> <span class="hljs-attr">newHook</span>: <span class="hljs-title class_">Hook</span> = {
      <span class="hljs-attr">memoizedState</span>: currentHook.<span class="hljs-property">memoizedState</span>,

      <span class="hljs-attr">baseState</span>: currentHook.<span class="hljs-property">baseState</span>,
      <span class="hljs-attr">baseQueue</span>: currentHook.<span class="hljs-property">baseQueue</span>,
      <span class="hljs-attr">queue</span>: currentHook.<span class="hljs-property">queue</span>,

      <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span>,
    };

    <span class="hljs-keyword">if</span> (workInProgressHook === <span class="hljs-literal">null</span>) {
      <span class="hljs-comment">// This is the first hook in the list.</span>
      currentlyRenderingFiber.<span class="hljs-property">memoizedState</span> = workInProgressHook = newHook;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// Append to the end of the list.</span>
      workInProgressHook = workInProgressHook.<span class="hljs-property">next</span> = newHook;
    }
  }
  <span class="hljs-keyword">return</span> workInProgressHook;
}
</code></pre>
<p>æ›´æ–°æ—¶ï¼ŒReact é€šè¿‡ <code>currentHook.next</code> æŒ‰é¡ºåºéå†é“¾è¡¨ã€‚å¦‚æœæŸä¸ª hook è¢«æ¡ä»¶è·³è¿‡ï¼Œä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>ç¬¬ 692 è¡Œï¼šå¦‚æœ <code>nextCurrentHook === null</code>ï¼ŒæŠ›å‡º "Rendered more hooks than during the previous render"</li>
<li>ç¬¬ 488-489 è¡Œï¼šå¦‚æœè¿˜æœ‰æœªéå†çš„ hooksï¼Œä¼šæ£€æµ‹åˆ° "Rendered fewer hooks"</li>
</ul>
<h3 data-id="heading-6">5. é”™è¯¯æ£€æµ‹å’Œæç¤º</h3>
<p>269:314:packages/react-reconciler/src/ReactFiberHooks.new.js</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">warnOnHookMismatchInDev</span>(<span class="hljs-params">currentHookName: HookType</span>) {
  <span class="hljs-keyword">if</span> (__DEV__) {
    <span class="hljs-keyword">const</span> componentName = <span class="hljs-title function_">getComponentNameFromFiber</span>(currentlyRenderingFiber);
    <span class="hljs-keyword">if</span> (!didWarnAboutMismatchedHooksForComponent.<span class="hljs-title function_">has</span>(componentName)) {
      didWarnAboutMismatchedHooksForComponent.<span class="hljs-title function_">add</span>(componentName);

      <span class="hljs-keyword">if</span> (hookTypesDev !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">let</span> table = <span class="hljs-string">''</span>;

        <span class="hljs-keyword">const</span> secondColumnStart = <span class="hljs-number">30</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= ((<span class="hljs-attr">hookTypesUpdateIndexDev</span>: any): number); i++) {
          <span class="hljs-keyword">const</span> oldHookName = hookTypesDev[i];
          <span class="hljs-keyword">const</span> newHookName =
            i === ((<span class="hljs-attr">hookTypesUpdateIndexDev</span>: any): number)
              ? currentHookName
              : oldHookName;

          <span class="hljs-keyword">let</span> row = <span class="hljs-string">`<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>. <span class="hljs-subst">${oldHookName}</span>`</span>;

          <span class="hljs-comment">// Extra space so second column lines up</span>
          <span class="hljs-comment">// lol @ IE not supporting String#repeat</span>
          <span class="hljs-keyword">while</span> (row.<span class="hljs-property">length</span> &lt; secondColumnStart) {
            row += <span class="hljs-string">' '</span>;
          }

          row += newHookName + <span class="hljs-string">'\n'</span>;

          table += row;
        }

        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(
          <span class="hljs-string">'React has detected a change in the order of Hooks called by %s. '</span> +
            <span class="hljs-string">'This will lead to bugs and errors if not fixed. '</span> +
            <span class="hljs-string">'For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks\n\n'</span> +
            <span class="hljs-string">'   Previous render            Next render\n'</span> +
            <span class="hljs-string">'   ------------------------------------------------------\n'</span> +
            <span class="hljs-string">'%s'</span> +
            <span class="hljs-string">'   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n'</span>,
          componentName,
          table,
        );
      }
    }
  }
}
</code></pre>
<p>å½“æ£€æµ‹åˆ° hooks é¡ºåºå˜åŒ–æ—¶ï¼Œä¼šè¾“å‡ºå¯¹æ¯”è¡¨æ ¼ã€‚</p>
<h3 data-id="heading-7">6. æ£€æŸ¥ hooks æ•°é‡æ˜¯å¦åŒ¹é…</h3>
<p>486:533:packages/react-reconciler/src/ReactFiberHooks.new.js</p>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-comment">// This check uses currentHook so that it works the same in DEV and prod bundles.</span>
  <span class="hljs-comment">// hookTypesDev could catch more cases (e.g. context) but only in DEV bundles.</span>
  <span class="hljs-keyword">const</span> didRenderTooFewHooks =
    currentHook !== <span class="hljs-literal">null</span> &amp;&amp; currentHook.<span class="hljs-property">next</span> !== <span class="hljs-literal">null</span>;

  renderLanes = <span class="hljs-title class_">NoLanes</span>;
  currentlyRenderingFiber = (<span class="hljs-attr">null</span>: any);

  currentHook = <span class="hljs-literal">null</span>;
  workInProgressHook = <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">if</span> (__DEV__) {
    currentHookNameInDev = <span class="hljs-literal">null</span>;
    hookTypesDev = <span class="hljs-literal">null</span>;
    hookTypesUpdateIndexDev = -<span class="hljs-number">1</span>;

    <span class="hljs-comment">// Confirm that a static flag was not added or removed since the last</span>
    <span class="hljs-comment">// render. If this fires, it suggests that we incorrectly reset the static</span>
    <span class="hljs-comment">// flags in some other part of the codebase. This has happened before, for</span>
    <span class="hljs-comment">// example, in the SuspenseList implementation.</span>
    <span class="hljs-keyword">if</span> (
      current !== <span class="hljs-literal">null</span> &amp;&amp;
      (current.<span class="hljs-property">flags</span> &amp; <span class="hljs-title class_">StaticMaskEffect</span>) !==
        (workInProgress.<span class="hljs-property">flags</span> &amp; <span class="hljs-title class_">StaticMaskEffect</span>) &amp;&amp;
      <span class="hljs-comment">// Disable this warning in legacy mode, because legacy Suspense is weird</span>
      <span class="hljs-comment">// and creates false positives. To make this work in legacy mode, we'd</span>
      <span class="hljs-comment">// need to mark fibers that create in an incomplete state, somehow. For</span>
      <span class="hljs-comment">// now I'll disable the warning that most of the bugs that would trigger</span>
      <span class="hljs-comment">// it are either exclusive to concurrent mode or exist in both.</span>
      (current.<span class="hljs-property">mode</span> &amp; <span class="hljs-title class_">ConcurrentMode</span>) !== <span class="hljs-title class_">NoMode</span>
    ) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(
        <span class="hljs-string">'Internal React error: Expected static flag was missing. Please '</span> +
          <span class="hljs-string">'notify the React team.'</span>,
      );
    }
  }

  didScheduleRenderPhaseUpdate = <span class="hljs-literal">false</span>;
  <span class="hljs-comment">// This is reset by checkDidRenderIdHook</span>
  <span class="hljs-comment">// localIdCounter = 0;</span>

  <span class="hljs-keyword">if</span> (didRenderTooFewHooks) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
      <span class="hljs-string">'Rendered fewer hooks than expected. This may be caused by an accidental '</span> +
        <span class="hljs-string">'early return statement.'</span>,
    );
  }
</code></pre>
<p>ç¬¬ 488-489 è¡Œæ£€æŸ¥æ˜¯å¦è¿˜æœ‰æœªéå†çš„ hooksï¼ˆ<code>didRenderTooFewHooks</code>ï¼‰ï¼Œå¦‚æœå­˜åœ¨åˆ™è¯´æ˜æœ¬æ¬¡æ¸²æŸ“è°ƒç”¨çš„ hooks æ•°é‡å°‘äºä¸Šæ¬¡ã€‚</p>
<h2 data-id="heading-8">æ€»ç»“</h2>
<ul>
<li>Hooks ä»¥é“¾è¡¨å­˜å‚¨ï¼Œä¾èµ–è°ƒç”¨é¡ºåºã€‚</li>
<li>æ¡ä»¶è°ƒç”¨ä¼šå¯¼è‡´é¡ºåºä¸ä¸€è‡´ï¼Œé“¾è¡¨éå†é”™ä½ï¼ŒçŠ¶æ€é”™ä¹±ã€‚</li>
<li>React åœ¨å¼€å‘å’Œç”Ÿäº§æ¨¡å¼ä¸‹éƒ½ä¼šæ£€æŸ¥ hooks æ•°é‡ä¸é¡ºåºï¼Œä¸ä¸€è‡´ä¼šæŠ›å‡ºé”™è¯¯ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œhooks å¿…é¡»åœ¨å‡½æ•°ç»„ä»¶çš„é¡¶å±‚è°ƒç”¨ï¼Œä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ã€å¾ªç¯æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ•‘å‘½ï¼Javaå°çŸ¥è¯†ç‚¹ï¼ŒåŸºç¡€å…šåƒé€ç›´æ¥èµ·é£]]></title>    <link>https://juejin.cn/post/7584655946087055406</link>    <guid>https://juejin.cn/post/7584655946087055406</guid>    <pubDate>2025-12-17T13:30:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584655946087055406" data-draft-id="7584652662328901682" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ•‘å‘½ï¼Javaå°çŸ¥è¯†ç‚¹ï¼ŒåŸºç¡€å…šåƒé€ç›´æ¥èµ·é£"/> <meta itemprop="keywords" content="å‰ç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-17T13:30:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AAAç®€å•ç©è½¬ç¨‹åºè®¾è®¡"/> <meta itemprop="url" content="https://juejin.cn/user/4294056357689099"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ•‘å‘½ï¼Javaå°çŸ¥è¯†ç‚¹ï¼ŒåŸºç¡€å…šåƒé€ç›´æ¥èµ·é£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4294056357689099/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AAAç®€å•ç©è½¬ç¨‹åºè®¾è®¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T13:30:44.000Z" title="Wed Dec 17 2025 13:30:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œä¸ºJavaé€‰æ‰‹ï¼Œå…‰ä¼šHelloWorldå¯ä¸å¤Ÿï¼Œè¿™3ä¸ªååŸºç¡€çš„è¿›é˜¶çŸ¥è¯†ç‚¹ï¼Œç®€å•å¥½æ‡‚è¿˜å®ç”¨ï¼Œä»£ç æŠ„å°±èƒ½è·‘ï¼Œèµ¶ç´§ç ä½ï¼</p>
<h2 data-id="heading-0">ä¸€ã€ é™æ€(static)å…³é”®å­—ï¼šå…¨å±€å…±äº«çš„â€œä¸“å±èµ„æºâ€</h2>
<p>staticä¿®é¥°çš„å˜é‡/æ–¹æ³•ï¼Œå±äºç±»æœ¬èº«ï¼Œæ‰€æœ‰å¯¹è±¡å…±äº«ï¼Œä¸ç”¨newå¯¹è±¡å°±èƒ½è°ƒç”¨ï¼Œè¶…é€‚åˆå­˜å…¬å…±å¸¸é‡ã€‚
âœ… ä»£ç ç¤ºä¾‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticDemo</span> {
    <span class="hljs-comment">// é™æ€å˜é‡ï¼šæ‰€æœ‰å¯¹è±¡å…±ç”¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">slogan</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Javaè¿›é˜¶ä¸éš¾ï¼"</span>;
    <span class="hljs-comment">// é™æ€æ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sayHi</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"é™æ€æ–¹æ³•ç›´æ¥è°ƒç”¨ï¼š"</span> + slogan);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// æ— éœ€newå¯¹è±¡ï¼Œç±»åç›´æ¥è°ƒç”¨</span>
        StaticDemo.sayHi();
        <span class="hljs-comment">// ç›´æ¥ä¿®æ”¹é™æ€å˜é‡ï¼Œå…¨å±€ç”Ÿæ•ˆ</span>
        StaticDemo.slogan = <span class="hljs-string">"åƒé€staticï¼ŒåŸºç¡€ç¨³ä¸€åŠï¼"</span>;
        StaticDemo.sayHi();
    }
}
</code></pre>
<p>Â </p>
<p>âœ… è¿è¡Œç»“æœ</p>
<pre><code class="hljs language-plaintext" lang="plaintext">  
é™æ€æ–¹æ³•ç›´æ¥è°ƒç”¨ï¼šJavaè¿›é˜¶ä¸éš¾ï¼

é™æ€æ–¹æ³•ç›´æ¥è°ƒç”¨ï¼šåƒé€staticï¼ŒåŸºç¡€ç¨³ä¸€åŠï¼
</code></pre>
<p>Â </p>
<h2 data-id="heading-1">äºŒã€ æ–¹æ³•é‡è½½(Overload)ï¼šä¸€ä¸ªæ–¹æ³•åæå®šå¤šç§åœºæ™¯</h2>
<p>åŒä¸€ç±»ä¸­ï¼Œæ–¹æ³•åç›¸åŒã€å‚æ•°åˆ—è¡¨ï¼ˆä¸ªæ•°/ç±»å‹/é¡ºåºï¼‰ä¸åŒï¼Œå°±æ˜¯é‡è½½ï¼Œå‘Šåˆ«è®°ä¸€å †æ–¹æ³•åçš„çƒ¦æ¼ã€‚
âœ… ä»£ç ç¤ºä¾‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OverloadDemo</span> {
    <span class="hljs-comment">// ä¸¤æ•°ç›¸åŠ </span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> {
        <span class="hljs-keyword">return</span> a + b;
    }
    <span class="hljs-comment">// ä¸‰æ•°ç›¸åŠ ï¼ˆå‚æ•°ä¸ªæ•°ä¸åŒï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b, <span class="hljs-type">int</span> c)</span> {
        <span class="hljs-keyword">return</span> a + b + c;
    }
    <span class="hljs-comment">// æµ®ç‚¹å‹ç›¸åŠ ï¼ˆå‚æ•°ç±»å‹ä¸åŒï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">return</span> a + b;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        System.out.println(<span class="hljs-string">"ä¸¤æ•°ç›¸åŠ ï¼š"</span> + add(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>));
        System.out.println(<span class="hljs-string">"ä¸‰æ•°ç›¸åŠ ï¼š"</span> + add(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>));
        System.out.println(<span class="hljs-string">"æµ®ç‚¹ç›¸åŠ ï¼š"</span> + add(<span class="hljs-number">1.5</span>, <span class="hljs-number">2.5</span>));
    }
}
</code></pre>
<p>Â </p>
<p>âœ… è¿è¡Œç»“æœ</p>
<pre><code class="hljs language-plaintext" lang="plaintext">ä¸¤æ•°ç›¸åŠ ï¼š3
ä¸‰æ•°ç›¸åŠ ï¼š6
æµ®ç‚¹ç›¸åŠ ï¼š4.0
</code></pre>
<p>Â </p>
<h2 data-id="heading-2">ä¸‰ã€ åŒ…è£…ç±»ï¼šåŸºæœ¬ç±»å‹çš„â€œè±ªåå‡çº§ç‰ˆâ€</h2>
<p>intâ†’Integerã€doubleâ†’Doubleï¼ŒåŸºæœ¬ç±»å‹å˜å¯¹è±¡ï¼Œæ”¯æŒnullå€¼å’Œè¶…å¤šå®ç”¨æ–¹æ³•ï¼Œå¼€å‘å¿…ç”¨ï¼
âœ… ä»£ç ç¤ºä¾‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WrapperDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è‡ªåŠ¨è£…ç®±ï¼šåŸºæœ¬ç±»å‹â†’åŒ…è£…ç±»</span>
        <span class="hljs-type">Integer</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
        <span class="hljs-comment">// è‡ªåŠ¨æ‹†ç®±ï¼šåŒ…è£…ç±»â†’åŸºæœ¬ç±»å‹</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> num1 + <span class="hljs-number">20</span>;
        
        <span class="hljs-comment">// å®ç”¨æ–¹æ³•ï¼šå­—ç¬¦ä¸²è½¬æ•°å­—</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">num3</span> <span class="hljs-operator">=</span> Integer.parseInt(<span class="hljs-string">"666"</span>);
        <span class="hljs-comment">// å®ç”¨æ–¹æ³•ï¼šæœ€å¤§å€¼/æœ€å°å€¼</span>
        System.out.println(<span class="hljs-string">"intæœ€å¤§å€¼ï¼š"</span> + Integer.MAX_VALUE);
        System.out.println(<span class="hljs-string">"æ‹¼æ¥ç»“æœï¼š"</span> + (num2 + num3));
    }
}
</code></pre>
<p>Â </p>
<p>âœ… è¿è¡Œç»“æœ</p>
<pre><code class="hljs language-plaintext" lang="plaintext">intæœ€å¤§å€¼ï¼š2147483647
æ‹¼æ¥ç»“æœï¼š696
</code></pre>
<p>Â </p>
<p>æ€»ç»“</p>
<p>1.Â staticï¼šç±»çº§å…±äº«ï¼Œç›´æ¥è°ƒç”¨ä¸ç”¨new</p>
<p>2.Â æ–¹æ³•é‡è½½ï¼šåŒåä¸åŒå‚ï¼Œçµæ´»å¤ç”¨</p>
<p>3.Â åŒ…è£…ç±»ï¼šåŸºæœ¬ç±»å‹å˜å¯¹è±¡ï¼Œå®ç”¨æ–¹æ³•æ‹‰æ»¡</p>
<p>è¿™3ä¸ªçŸ¥è¯†ç‚¹çœ‹ç€è¿›é˜¶ï¼Œå®åˆ™æ˜¯åŸºç¡€æ‹”é«˜å…³é”®ï¼Œåƒé€å®ƒä»¬ï¼ŒJavaåŸºç¡€ç›´æ¥ä¸Šä¸€ä¸ªå°é˜¶ï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ useStateã€useEffect çš„åº•å±‚å®ç°]]></title>    <link>https://juejin.cn/post/7584651851905138707</link>    <guid>https://juejin.cn/post/7584651851905138707</guid>    <pubDate>2025-12-17T13:34:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584651851905138707" data-draft-id="7584695558158417961" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ useStateã€useEffect çš„åº•å±‚å®ç°"/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2025-12-17T13:34:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="day1"/> <meta itemprop="url" content="https://juejin.cn/user/4310544201823182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ useStateã€useEffect çš„åº•å±‚å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4310544201823182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    day1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T13:34:01.000Z" title="Wed Dec 17 2025 13:34:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»37åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>React Hooks çš„å‡ºç°æå¤§åœ°ç®€åŒ–äº†å‡½æ•°ç»„ä»¶çš„çŠ¶æ€ç®¡ç†å’Œå‰¯ä½œç”¨å¤„ç†ï¼Œä½†å…¶å†…éƒ¨çš„ç²¾å¦™è®¾è®¡å¾€å¾€éšè—åœ¨æ—¥å¸¸ä½¿ç”¨çš„ API èƒŒåã€‚æœ¬æ–‡æ—¨åœ¨æ­å¼€è¿™äº›â€œå¹•åâ€çš„ç§˜å¯†ï¼Œå¸¦é¢†è¯»è€…ä»æºç å±‚é¢ç†è§£ <code>useState</code>ã€<code>useEffect</code> ç­‰æ ¸å¿ƒ Hook çš„å·¥ä½œåŸç†ã€‚</p>
<p>æˆ‘ä»¬å°†ä»æœ€åŸºç¡€çš„ Fiber èŠ‚ç‚¹å’Œ Hook é“¾è¡¨ç­‰å†…å­˜å¸ƒå±€å¼€å§‹ï¼Œé€æ­¥æ·±å…¥åˆ° <code>useState</code> çš„åˆå§‹åŒ–ä¸æ›´æ–°æµç¨‹ã€<code>useEffect</code> çš„ä¾èµ–æ¯”è¾ƒä¸å‰¯ä½œç”¨è°ƒåº¦ï¼Œä»¥åŠ React å†…éƒ¨çš„æ›´æ–°é˜Ÿåˆ—å’Œä¼˜å…ˆçº§è°ƒåº¦æœºåˆ¶ã€‚</p>
<h2 data-id="heading-1">äºŒã€å‡½æ•°ç»„ä»¶çš„å†…å­˜å¸ƒå±€åŸºç¡€</h2>
<p>è¦ç†è§£ Hooks å¦‚ä½•å·¥ä½œï¼Œæ ¸å¿ƒæ˜¯å…ˆææ‡‚å‡½æ•°ç»„ä»¶çš„å†…å­˜æ‰¿è½½ç»“æ„â€”â€” æ‰€æœ‰çŠ¶æ€ã€å‰¯ä½œç”¨éƒ½ä¾èµ–ã€ŒFiber èŠ‚ç‚¹ã€å’Œã€ŒHook é“¾è¡¨ã€è¿™ä¸¤ä¸ªæ ¸å¿ƒè½½ä½“å­˜å‚¨ã€‚</p>
<h3 data-id="heading-2">2.1 æ ¸å¿ƒæ•°æ®ç»“æ„æ€»è§ˆï¼šå®ƒä»¬å¦‚ä½•ååŒå·¥ä½œï¼Ÿ</h3>
<p>åœ¨æ·±å…¥ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å»ºç«‹ä¸€ä¸ªæ•´ä½“çš„è®¤çŸ¥æ¡†æ¶ã€‚æƒ³è±¡ä¸€ä¸‹ï¼ŒReact åœ¨ç®¡ç†ä½ çš„å‡½æ•°ç»„ä»¶æ—¶ï¼Œå°±åƒåœ¨æ­å»ºä¸€ä¸ªç²¾å¯†çš„â€œä¿¡æ¯ç®¡ç†ç³»ç»Ÿâ€ã€‚è¿™ä¸ªç³»ç»Ÿä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒâ€œéƒ¨ä»¶â€ç»„æˆï¼š</p>
<ol>
<li>
<p><strong>Fiber èŠ‚ç‚¹ï¼ˆç»„ä»¶çš„â€œæ¡£æ¡ˆè¢‹â€ï¼‰</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ª React ç»„ä»¶ï¼ˆæ— è®ºæ˜¯å‡½æ•°ç»„ä»¶è¿˜æ˜¯ç±»ç»„ä»¶ï¼‰åœ¨ React å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ <code>Fiber èŠ‚ç‚¹</code>ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºè¿™ä¸ªç»„ä»¶çš„â€œä¸“å±æ¡£æ¡ˆè¢‹â€ï¼Œé‡Œé¢è®°å½•äº†ç»„ä»¶çš„æ‰€æœ‰é‡è¦ä¿¡æ¯ï¼Œæ¯”å¦‚å®ƒçš„ç±»å‹ã€å±æ€§ï¼ˆpropsï¼‰ã€åœ¨ç»„ä»¶æ ‘ä¸­çš„ä½ç½®ï¼Œä»¥åŠæœ€é‡è¦çš„â€”â€”å®ƒçš„<strong>çŠ¶æ€</strong>å’Œ<strong>å‰¯ä½œç”¨</strong>ã€‚</li>
<li>å¯¹äºå‡½æ•°ç»„ä»¶è€Œè¨€ï¼Œ<code>Fiber èŠ‚ç‚¹</code> çš„ä¸€ä¸ªå…³é”®å­—æ®µ <code>memoizedState</code>ï¼Œå°±åƒæ˜¯è¿™ä¸ªæ¡£æ¡ˆè¢‹çš„â€œå…¥å£æ ‡ç­¾â€ï¼Œå®ƒæŒ‡å‘äº†è¯¥ç»„ä»¶æ‰€æœ‰ <code>Hook</code> çš„èµ·å§‹ä½ç½®ã€‚</li>
</ul>
</li>
<li>
<p><strong>Hook é“¾è¡¨ï¼ˆçŠ¶æ€å’Œå‰¯ä½œç”¨çš„â€œæ¸…å•â€ï¼‰</strong>ï¼š</p>
<ul>
<li>å½“ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨ <code>useState</code>ã€<code>useEffect</code> ç­‰ Hook æ—¶ï¼ŒReact å¹¶ä¸ä¼šæŠŠå®ƒä»¬ç‹¬ç«‹å­˜å‚¨ã€‚ç›¸åï¼Œå®ƒä¼šå°†è¿™äº› Hook ç»„ç»‡æˆä¸€ä¸ª<strong>å•å‘é“¾è¡¨</strong>ï¼ŒæŒ‚è½½åœ¨å¯¹åº”çš„ <code>Fiber èŠ‚ç‚¹</code> ä¸Šã€‚</li>
<li>è¿™ä¸ª <code>Hook é“¾è¡¨</code> å°±åƒæ˜¯ç»„ä»¶â€œæ¡£æ¡ˆè¢‹â€é‡Œçš„ä¸€ä»½è¯¦ç»†â€œæ¸…å•â€ï¼Œæ¯ä¸€é¡¹ï¼ˆæ¯ä¸€ä¸ª <code>Hook</code> èŠ‚ç‚¹ï¼‰éƒ½è®°å½•ç€ä¸€ä¸ª <code>useState</code> çš„å½“å‰å€¼ï¼Œæˆ–è€…ä¸€ä¸ª <code>useEffect</code> çš„å‰¯ä½œç”¨å‡½æ•°å’Œä¾èµ–é¡¹ç­‰ä¿¡æ¯ã€‚</li>
<li>é“¾è¡¨çš„é¡ºåºéå¸¸é‡è¦ï¼Œå®ƒä¸¥æ ¼æŒ‰ç…§ä½ åœ¨ç»„ä»¶ä¸­è°ƒç”¨ Hook çš„é¡ºåºæ’åˆ—ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ›´æ–°é˜Ÿåˆ—ï¼ˆçŠ¶æ€å˜åŒ–çš„â€œå¾…åŠäº‹é¡¹åˆ—è¡¨â€ï¼‰</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ª <code>useState</code> Hook å†…éƒ¨ï¼Œéƒ½ç»´æŠ¤ç€ä¸€ä¸ªç‹¬ç«‹çš„ <code>æ›´æ–°é˜Ÿåˆ—</code>ã€‚å½“ä½ è°ƒç”¨ <code>setState</code> æ¥æ›´æ–°çŠ¶æ€æ—¶ï¼ŒReact å¹¶ä¸ä¼šç«‹å³æ”¹å˜ <code>Hook</code> èŠ‚ç‚¹ä¸Šçš„çŠ¶æ€å€¼ï¼Œè€Œæ˜¯ä¼šåˆ›å»ºä¸€ä¸ª <code>Update</code> å¯¹è±¡ï¼ˆä¸€ä¸ªâ€œå¾…åŠäº‹é¡¹â€ï¼‰ï¼Œå¹¶æŠŠå®ƒæ·»åŠ åˆ°è¿™ä¸ª <code>æ›´æ–°é˜Ÿåˆ—</code> ä¸­ã€‚</li>
<li>è¿™ä¸ª <code>æ›´æ–°é˜Ÿåˆ—</code> å°±åƒæ˜¯æ¯ä¸ª <code>useState</code> çš„â€œä¸“å±å¾…åŠäº‹é¡¹åˆ—è¡¨â€ï¼Œé‡Œé¢è®°å½•äº†æ‰€æœ‰ç­‰å¾…è¢«å¤„ç†çš„çŠ¶æ€æ›´æ–°è¯·æ±‚ã€‚React ä¼šåœ¨åˆé€‚çš„æ—¶æœºï¼ŒæŒ‰ç…§ä¸€å®šçš„ä¼˜å…ˆçº§è§„åˆ™ï¼Œé€ä¸€å¤„ç†è¿™äº›â€œå¾…åŠäº‹é¡¹â€ï¼Œæœ€ç»ˆè®¡ç®—å‡ºæœ€æ–°çš„çŠ¶æ€ã€‚</li>
</ul>
</li>
</ol>
<p><strong>å®ƒä»¬å¦‚ä½•ååŒå·¥ä½œï¼Ÿ</strong></p>
<ul>
<li><strong>Fiber èŠ‚ç‚¹</strong>æ˜¯<strong>å®¹å™¨</strong>ï¼Œå®ƒæŒæœ‰ç»„ä»¶çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ <code>memoizedState</code> å­—æ®µ<strong>æŒ‡å‘</strong>ç¬¬ä¸€ä¸ª <code>Hook</code> èŠ‚ç‚¹ã€‚</li>
<li><strong>Hook é“¾è¡¨</strong>æ˜¯<strong>å†…å®¹</strong>ï¼Œå®ƒå­˜å‚¨äº†ç»„ä»¶ä¸­æ‰€æœ‰ <code>useState</code> å’Œ <code>useEffect</code> ç­‰ Hook çš„å…·ä½“æ•°æ®ï¼Œå¹¶é€šè¿‡ <code>next</code> æŒ‡é’ˆ<strong>ä¸²è”</strong>èµ·æ¥ã€‚</li>
<li><strong>æ›´æ–°é˜Ÿåˆ—</strong>æ˜¯<strong>æœºåˆ¶</strong>ï¼Œå®ƒé™„ç€åœ¨æ¯ä¸ª <code>useState</code> çš„ <code>Hook</code> èŠ‚ç‚¹ä¸Šï¼Œè´Ÿè´£<strong>ç®¡ç†</strong>å’Œ<strong>è°ƒåº¦</strong>çŠ¶æ€çš„å˜æ›´ã€‚</li>
</ul>
<p>ç†è§£è¿™ä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯ç†è§£ React Hooks å†…éƒ¨æœºåˆ¶çš„å…³é”®ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€ä¸€æ·±å…¥è¿™äº›æ•°æ®ç»“æ„çš„ç»†èŠ‚ã€‚</p>
<h3 data-id="heading-3">2.2 Fiber èŠ‚ç‚¹ä¸ memoizedState</h3>
<p>å‡½æ•°ç»„ä»¶æœ¬èº«æ˜¯æ— å®ä¾‹çš„çº¯å‡½æ•°ï¼Œæ— æ³•åƒç±»ç»„ä»¶é‚£æ ·ç”¨ this å­˜å‚¨çŠ¶æ€ â€”â€” æ‰€æœ‰çŠ¶æ€ã€Hooks ä¿¡æ¯ï¼Œéƒ½å¯„ç”Ÿåœ¨ç»„ä»¶å¯¹åº”çš„ Fiber èŠ‚ç‚¹ ä¸­ã€‚å¯ä»¥æŠŠ Fiber èŠ‚ç‚¹ç†è§£ä¸º â€œå‡½æ•°ç»„ä»¶çš„å†…å­˜å®¹å™¨â€ï¼Œå…¶å…³é”®å­—æ®µç›´æ¥å†³å®šäº†çŠ¶æ€çš„å­˜å‚¨ä¸è¯»å–é€»è¾‘ã€‚</p>
<h4 data-id="heading-4">Fiber èŠ‚ç‚¹çš„æ ¸å¿ƒç»“æ„</h4>
<p>Fiber èŠ‚ç‚¹ä¸å‡½æ•°ç»„ä»¶çŠ¶æ€ç›¸å…³çš„æ ¸å¿ƒå­—æ®µå¦‚ä¸‹ï¼ˆå‰”é™¤è°ƒåº¦ã€æ ‘ç»“æ„ç­‰éæ ¸å¿ƒå­—æ®µï¼‰ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">FiberNode</span>(<span class="hljs-params">tag, pendingProps, key, mode</span>) {
  <span class="hljs-comment">// 1. çŠ¶æ€å­˜å‚¨æ ¸å¿ƒï¼šå‡½æ•°ç»„ä»¶çš„ Hooks é“¾è¡¨å…¥å£</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoizedState</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// å…³é”®ï¼æŒ‡å‘ç¬¬ä¸€ä¸ª Hook èŠ‚ç‚¹ï¼ˆå¦‚ useStateã€useEffect èŠ‚ç‚¹ï¼‰</span>
  <span class="hljs-comment">// 2. ç»„ä»¶æ¥æ”¶çš„ propsï¼šä¸Šæ¬¡æ¸²æŸ“æ—¶ä½¿ç”¨çš„ propsï¼ˆç”¨äºä¾èµ–å¯¹æ¯”ï¼‰</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoizedProps</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-comment">// 3. æ›´æ–°é˜Ÿåˆ—ï¼šç®¡ç†å‡½æ•°ç»„ä»¶çš„å‰¯ä½œç”¨ã€äº‹ä»¶ç­‰ï¼ˆå¦‚ useEffect é˜Ÿåˆ—ï¼‰</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">updateQueue</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">alternate</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 4. åŒç¼“å†²å…³è”ï¼šæŒ‡å‘å¦ä¸€æ£µæ ‘çš„ Fiber èŠ‚ç‚¹ã€‚React å†…éƒ¨ç»´æŠ¤â€œä¸¤æ£µæ ‘â€ï¼šä¸€æ£µæ˜¯å½“å‰å±å¹•ä¸Šæ˜¾ç¤ºçš„ï¼ˆcurrentï¼‰ï¼Œå¦ä¸€æ£µæ˜¯åœ¨åå°æ„å»ºçš„ï¼ˆworkInProgressï¼‰ã€‚`alternate` å­—æ®µå°±æ˜¯è¿™ä¸¤æ£µæ ‘ä¹‹é—´ç›¸äº’è¿æ¥çš„æ¡¥æ¢ï¼Œç”¨äºåœ¨æ›´æ–°è¿‡ç¨‹ä¸­åˆ‡æ¢å’Œå¤ç”¨ Fiber èŠ‚ç‚¹ã€‚</span>
}
</code></pre>
<h4 data-id="heading-5">memoizedStateï¼šHook é“¾è¡¨çš„å…¥å£</h4>
<p>å¯¹äºå‡½æ•°ç»„ä»¶ï¼Œ<code>memoizedState</code> å­—æ®µå…·æœ‰ç‰¹æ®Šæ„ä¹‰â€”â€”å®ƒæ˜¯æ•´ä¸ª Hook é“¾è¡¨çš„å…¥å£ç‚¹ã€‚ä¸ç±»ç»„ä»¶ä¸åŒï¼Œå‡½æ•°ç»„ä»¶çš„ <code>memoizedState</code> ä¸ç›´æ¥å­˜å‚¨çŠ¶æ€å¯¹è±¡ï¼Œè€Œæ˜¯æŒ‡å‘ç¬¬ä¸€ä¸ª Hook èŠ‚ç‚¹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‡½æ•°ç»„ä»¶çš„ memoizedState æŒ‡å‘ Hook é“¾è¡¨å¤´éƒ¨</span>
fiber.<span class="hljs-property">memoizedState</span> = firstHook; <span class="hljs-comment">// Hook é“¾è¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>

<span class="hljs-comment">// ç±»ç»„ä»¶çš„ memoizedState ç›´æ¥å­˜å‚¨çŠ¶æ€å¯¹è±¡</span>
classComponentFiber.<span class="hljs-property">memoizedState</span> = { <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"React"</span> };
</code></pre>
<h4 data-id="heading-6">æ¸²æŸ“è¿‡ç¨‹ä¸­çš„çŠ¶æ€ç®¡ç†</h4>
<p>å‡½æ•°ç»„ä»¶æ¯æ¬¡æ¸²æŸ“ï¼ˆé¦–æ¬¡ / é‡æ¸²æŸ“ï¼‰ï¼Œéƒ½ä¼šé€šè¿‡ renderWithHooks å‡½æ•°åˆå§‹åŒ–å†…å­˜ç»“æ„ï¼Œæ ¸å¿ƒæ˜¯ â€œé‡ç½®é“¾è¡¨å…¥å£ + é€‰æ‹©è°ƒåº¦å™¨â€ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderWithHooks</span>(<span class="hljs-params">
  current, <span class="hljs-comment">// å½“å‰ Fiber èŠ‚ç‚¹ï¼ˆå·²æ¸²æŸ“åˆ°å±å¹•çš„ï¼‰</span>
  workInProgress, <span class="hljs-comment">// å·¥ä½œ Fiber èŠ‚ç‚¹ï¼ˆæœ¬æ¬¡è¦æ¸²æŸ“çš„ï¼‰</span>
  Component, <span class="hljs-comment">// å‡½æ•°ç»„ä»¶æœ¬èº«</span>
  props, <span class="hljs-comment">// ç»„ä»¶æ¥æ”¶çš„ props</span>
  nextRenderLanes <span class="hljs-comment">// æ¸²æŸ“ä¼˜å…ˆçº§</span>
</span>) {
  <span class="hljs-comment">// 1. ç»‘å®šå…¨å±€å˜é‡ï¼šè®© Hooks èƒ½æ‰¾åˆ°å½“å‰æ­£åœ¨æ¸²æŸ“çš„ Fiber èŠ‚ç‚¹</span>
  currentlyRenderingFiber = workInProgress;
  <span class="hljs-comment">// 2. é‡ç½® Hooks é“¾è¡¨å…¥å£ï¼šé¿å…ä¸Šæ¬¡æ¸²æŸ“çš„é“¾è¡¨æ®‹ç•™</span>
  workInProgress.<span class="hljs-property">memoizedState</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-comment">// 3. é€‰æ‹© Hooks è°ƒåº¦å™¨ï¼šé¦–æ¬¡æ¸²æŸ“ç”¨ Mount è°ƒåº¦å™¨ï¼Œé‡æ¸²æŸ“ç”¨ Update è°ƒåº¦å™¨</span>
  <span class="hljs-title class_">ReactSharedInternals</span>.<span class="hljs-property">H</span> =
    current === <span class="hljs-literal">null</span>
      ? <span class="hljs-title class_">HooksDispatcherOnMount</span> <span class="hljs-comment">// é¦–æ¬¡æ¸²æŸ“ï¼šåˆ›å»ºæ–° Hook èŠ‚ç‚¹</span>
      : <span class="hljs-title class_">HooksDispatcherOnUpdate</span>; <span class="hljs-comment">// é‡æ¸²æŸ“ï¼šå¤ç”¨å·²æœ‰ Hook èŠ‚ç‚¹</span>
  <span class="hljs-comment">// 4. æ‰§è¡Œå‡½æ•°ç»„ä»¶ï¼šè§¦å‘ useStateã€useEffect è°ƒç”¨ï¼Œæ„å»º/å¤ç”¨ Hooks é“¾è¡¨</span>
  <span class="hljs-keyword">const</span> children = <span class="hljs-title class_">Component</span>(props);
  <span class="hljs-comment">// 5. æ¸…ç†å…¨å±€å˜é‡ï¼Œå®Œæˆæ¸²æŸ“</span>
  <span class="hljs-title function_">finishRenderingHooks</span>(current, workInProgress, <span class="hljs-title class_">Component</span>);
  <span class="hljs-keyword">return</span> children;
}
</code></pre>
<p>ç®€å•è¯´ï¼šrenderWithHooks æ˜¯ â€œå†…å­˜åˆå§‹åŒ–çš„å¼€å…³â€ï¼Œå†³å®šäº† Hooks é“¾è¡¨æ˜¯ â€œæ–°å»ºâ€ è¿˜æ˜¯ â€œå¤ç”¨â€ï¼Œæ˜¯è¿æ¥å‡½æ•°ç»„ä»¶ä¸ Fiber èŠ‚ç‚¹çš„æ ¸å¿ƒæ¡¥æ¢ã€‚</p>
<h3 data-id="heading-7">2.3 Hook é“¾è¡¨ä¸æ›´æ–°é˜Ÿåˆ—çš„å­˜å‚¨æœºåˆ¶</h3>
<h4 data-id="heading-8">Hook èŠ‚ç‚¹çš„å†…å­˜ç»“æ„</h4>
<p>æ— è®ºæ˜¯ä»€ä¹ˆç±»å‹çš„ Hookï¼ˆuseState/useEffectï¼‰ï¼Œéƒ½å…±äº«åŒä¸€ä¸ªåŸºç¡€ç»“æ„ï¼Œæ ¸å¿ƒå­—æ®µå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">type <span class="hljs-title class_">Hook</span> = {
  <span class="hljs-attr">memoizedState</span>: any, <span class="hljs-comment">// 1. å½“å‰ Hook çš„â€œçŠ¶æ€å€¼â€ã€‚å¯¹äº `useState`ï¼Œå®ƒå­˜å‚¨çš„æ˜¯æœ€æ–°çš„çŠ¶æ€å€¼ï¼›å¯¹äº `useEffect`ï¼Œå®ƒå­˜å‚¨çš„æ˜¯å‰¯ä½œç”¨å‡½æ•°å’Œä¾èµ–æ•°ç»„ç­‰ä¿¡æ¯ã€‚</span>
  <span class="hljs-attr">baseState</span>: any, <span class="hljs-comment">// 2. â€œåŸºç¡€çŠ¶æ€â€ã€‚åœ¨å¤„ç†çŠ¶æ€æ›´æ–°æ—¶ï¼Œ`baseState` è®°å½•äº†ä¸Šä¸€æ¬¡æˆåŠŸæäº¤ï¼ˆcommitï¼‰æ—¶çš„çŠ¶æ€ã€‚å®ƒä¸ `baseQueue` é…åˆï¼Œç”¨äºåœ¨è·³è¿‡ä½ä¼˜å…ˆçº§æ›´æ–°æ—¶ï¼Œç¡®ä¿çŠ¶æ€è®¡ç®—çš„æ­£ç¡®æ€§ã€‚</span>
  <span class="hljs-attr">baseQueue</span>: <span class="hljs-title class_">Update</span>&lt;any&gt; | <span class="hljs-literal">null</span>, <span class="hljs-comment">// 3. â€œåŸºç¡€æ›´æ–°é˜Ÿåˆ—â€ã€‚å­˜å‚¨äº†ä¸Šä¸€æ¬¡æ¸²æŸ“å‘¨æœŸä¸­ï¼Œå› ä¸ºä¼˜å…ˆçº§ä¸è¶³è€Œè¢«è·³è¿‡ï¼Œä½†ä»éœ€åœ¨æœªæ¥å¤„ç†çš„æ›´æ–°ã€‚å®ƒæ˜¯ä¸€ä¸ªç¯å½¢é“¾è¡¨ï¼Œä¸ `baseState` ä¸€èµ·ä¿è¯äº†çŠ¶æ€æ›´æ–°çš„è¿è´¯æ€§ã€‚</span>
  <span class="hljs-attr">queue</span>: any, <span class="hljs-comment">// 4. â€œå½“å‰æ›´æ–°é˜Ÿåˆ—â€ã€‚å­˜å‚¨äº†æ‰€æœ‰å¾…å¤„ç†çš„æ›´æ–°ï¼ˆ`Update` å¯¹è±¡ï¼‰ã€‚å¯¹äº `useState`ï¼Œå®ƒåŒ…å«äº† `setState` è°ƒç”¨äº§ç”Ÿçš„æ›´æ–°ã€‚è¿™ä¸ªé˜Ÿåˆ—ä¹Ÿæ˜¯ä¸€ä¸ªç¯å½¢é“¾è¡¨ã€‚</span>
  <span class="hljs-attr">next</span>: <span class="hljs-title class_">Hook</span> | <span class="hljs-literal">null</span>, <span class="hljs-comment">// 5. â€œé“¾è¡¨æŒ‡é’ˆâ€ã€‚æŒ‡å‘ä¸‹ä¸€ä¸ª Hook èŠ‚ç‚¹ï¼Œå°†æ‰€æœ‰ Hook ä¸²è”æˆä¸€ä¸ªå•å‘é“¾è¡¨ã€‚</span>
};
</code></pre>
<p>ä¸åŒ Hook çš„å·®å¼‚ï¼Œä»…ä½“ç°åœ¨ memoizedState å’Œ queue çš„å…·ä½“å†…å®¹ï¼ˆå¦‚ useEffect çš„ memoizedState å­˜å‰¯ä½œç”¨å‡½æ•°å’Œä¾èµ–ï¼ŒuseState å­˜å…·ä½“æ•°å€¼ï¼‰ã€‚</p>
<h4 data-id="heading-9">é“¾è¡¨çš„æ„å»ºä¸éå†</h4>
<p>ä»¥ä¸€ä¸ªåŒ…å«å¤šä¸ª Hook çš„å‡½æ•°ç»„ä»¶ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// Hook1</span>
  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">"React"</span>); <span class="hljs-comment">// Hook2</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// Hook3</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`Count: <span class="hljs-subst">${count}</span>`</span>;
  }, [count]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {count} - {name}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>å…¶å†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼š</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67964613c0e24464a6e35dadf7ffbe01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF5MQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766583241&amp;x-signature=y53YRczwBNKIDZ75YsDGcc4%2B2b0%3D" alt="3-1.png" loading="lazy"/></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Fiber èŠ‚ç‚¹ï¼šmemoizedState æŒ‡å‘ç¬¬ä¸€ä¸ª Hook èŠ‚ç‚¹</span>
<span class="hljs-title class_">MyComponentFiber</span> {
  <span class="hljs-attr">memoizedState</span>: <span class="hljs-title class_">Hook1</span> (<span class="hljs-title function_">useState</span>(count)), <span class="hljs-comment">// é“¾è¡¨å…¥å£</span>
  <span class="hljs-attr">memoizedProps</span>: { ... }, <span class="hljs-comment">// ç»„ä»¶æ¥æ”¶çš„ props</span>
  <span class="hljs-attr">updateQueue</span>: { ... }, <span class="hljs-comment">// å‰¯ä½œç”¨é˜Ÿåˆ—</span>
  <span class="hljs-attr">alternate</span>: <span class="hljs-literal">null</span>
}

<span class="hljs-comment">// Hook1ï¼šuseState(count) èŠ‚ç‚¹</span>
<span class="hljs-title class_">Hook1</span> {
  <span class="hljs-attr">memoizedState</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// å½“å‰çŠ¶æ€å€¼ï¼šcount = 0</span>
  <span class="hljs-attr">baseState</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">queue</span>: { ... }, <span class="hljs-comment">// setCount çš„æ›´æ–°é˜Ÿåˆ—</span>
  <span class="hljs-attr">next</span>: <span class="hljs-title class_">Hook2</span> (<span class="hljs-title function_">useState</span>(name)) <span class="hljs-comment">// æŒ‡å‘ç¬¬äºŒä¸ª Hook</span>
}

<span class="hljs-comment">// Hook2ï¼šuseState(name) èŠ‚ç‚¹</span>
<span class="hljs-title class_">Hook2</span> {
  <span class="hljs-attr">memoizedState</span>: <span class="hljs-string">"React"</span>, <span class="hljs-comment">// å½“å‰çŠ¶æ€å€¼ï¼šname = "React"</span>
  <span class="hljs-attr">baseState</span>: <span class="hljs-string">"React"</span>,
  <span class="hljs-attr">queue</span>: { ... }, <span class="hljs-comment">// setName çš„æ›´æ–°é˜Ÿåˆ—</span>
  <span class="hljs-attr">next</span>: <span class="hljs-title class_">Hook3</span> (useEffect) <span class="hljs-comment">// æŒ‡å‘ç¬¬ä¸‰ä¸ª Hook</span>
}

<span class="hljs-comment">// Hook3ï¼šuseEffect èŠ‚ç‚¹</span>
<span class="hljs-title class_">Hook3</span> {
  <span class="hljs-attr">memoizedState</span>: { <span class="hljs-comment">// å­˜å‰¯ä½œç”¨ç›¸å…³ä¿¡æ¯</span>
    <span class="hljs-attr">create</span>: <span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`Count: <span class="hljs-subst">${count}</span>`</span>; }, <span class="hljs-comment">// å‰¯ä½œç”¨å‡½æ•°</span>
    <span class="hljs-attr">destroy</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// æ¸…ç†å‡½æ•°ï¼ˆæœ¬ä¾‹æ— ï¼‰</span>
    <span class="hljs-attr">deps</span>: [<span class="hljs-number">0</span>] <span class="hljs-comment">// ä¾èµ–æ•°ç»„ï¼š[count]</span>
  },
  <span class="hljs-attr">baseState</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">queue</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span> <span class="hljs-comment">// æœ€åä¸€ä¸ª Hookï¼Œnext ä¸º null</span>
}
</code></pre>
<p>é“¾è¡¨é¡ºåºä¸¥æ ¼éµå¾ª Hooks çš„è°ƒç”¨é¡ºåºï¼ˆHook1â†’Hook2â†’Hook3ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ â€œä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ä¸­å†™ Hooksâ€ çš„æ ¹æœ¬åŸå› ï¼ˆä¼šæ‰“ä¹±é“¾è¡¨é¡ºåºï¼‰ï¼›
æ¯ä¸ª Hook èŠ‚ç‚¹çš„ next æŒ‡é’ˆæ˜¯ â€œé“¾å¼å­˜å‚¨â€ çš„å…³é”®ï¼Œéå†é“¾è¡¨æ—¶é€šè¿‡ next ä¾æ¬¡è®¿é—®æ‰€æœ‰ Hookï¼›
Fiber èŠ‚ç‚¹ä»…éœ€æŒæœ‰é“¾è¡¨çš„ â€œå¤´æŒ‡é’ˆâ€ï¼ˆmemoizedStateï¼‰ï¼Œå°±èƒ½æ‰¾åˆ°æ‰€æœ‰ Hook èŠ‚ç‚¹ï¼Œå®ç°é«˜æ•ˆçš„çŠ¶æ€ç®¡ç†ã€‚</p>
<h4 data-id="heading-10">FunctionComponentUpdateQueue ç»“æ„</h4>
<p>é™¤äº† Hooks é“¾è¡¨ï¼Œå‡½æ•°ç»„ä»¶çš„ Fiber èŠ‚ç‚¹è¿˜é€šè¿‡ updateQueue å­—æ®µå­˜å‚¨è¾…åŠ©ä¿¡æ¯ï¼Œå…¶ç±»å‹ä¸º FunctionComponentUpdateQueueï¼Œæ ¸å¿ƒç”¨äºç®¡ç†å‰¯ä½œç”¨å’Œäº‹ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// FunctionComponentUpdateQueue å®šä¹‰</span>
<span class="hljs-keyword">export</span> type <span class="hljs-title class_">FunctionComponentUpdateQueue</span> = {
  <span class="hljs-attr">lastEffect</span>: <span class="hljs-title class_">Effect</span> | <span class="hljs-literal">null</span>, <span class="hljs-comment">// æŒ‡å‘æœ€åä¸€ä¸ª Effect èŠ‚ç‚¹ï¼ˆå¦‚ useEffect é˜Ÿåˆ—ï¼‰</span>
  <span class="hljs-attr">events</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">EventFunctionPayload</span>&gt; | <span class="hljs-literal">null</span>, <span class="hljs-comment">// äº‹ä»¶å¤„ç†é˜Ÿåˆ—ï¼ˆå¦‚ useEffectEventï¼‰</span>
  <span class="hljs-attr">stores</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">StoreConsistencyCheck</span>&gt; | <span class="hljs-literal">null</span>, <span class="hljs-comment">// çŠ¶æ€ä¸€è‡´æ€§æ£€æŸ¥</span>
  <span class="hljs-attr">memoCache</span>: <span class="hljs-title class_">MemoCache</span> | <span class="hljs-literal">null</span>, <span class="hljs-comment">// è®°å¿†åŒ–ç¼“å­˜ï¼ˆå¦‚ useMemo/useCallback çš„ç¼“å­˜ï¼‰</span>
};
</code></pre>
<p>å®ƒç›¸å½“äº Hooks é“¾è¡¨çš„ â€œè¾…åŠ©ä»“åº“â€ï¼Œä¸“é—¨å­˜å‚¨é“¾è¡¨ä¹‹å¤–çš„å‰¯ä½œç”¨è°ƒåº¦ä¿¡æ¯ï¼Œä¸ Hooks é“¾è¡¨é…åˆå®ç°å®Œæ•´çš„çŠ¶æ€ä¸å‰¯ä½œç”¨ç®¡ç†ã€‚</p>
<h2 data-id="heading-11">ä¸‰ã€useState çš„åº•å±‚å®ç°æœºåˆ¶</h2>
<p><code>useState</code> æ˜¯ React Hooks ä¸­æœ€åŸºç¡€ä¹Ÿæœ€å¸¸ç”¨çš„ Hook ä¹‹ä¸€ï¼Œå®ƒå…è®¸ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­â€œå­˜å‚¨â€å’Œâ€œæ›´æ–°â€çŠ¶æ€ã€‚ä½†å®ƒèƒŒåæ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿåœ¨ React å†…éƒ¨ï¼Œ<code>useState</code> çš„è¡Œä¸ºä¼šæ ¹æ®ç»„ä»¶æ˜¯é¦–æ¬¡æ¸²æŸ“ï¼ˆæŒ‚è½½ï¼‰è¿˜æ˜¯åç»­æ¸²æŸ“ï¼ˆæ›´æ–°ï¼‰è€Œæœ‰æ‰€ä¸åŒã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œå½“ä½ çš„å‡½æ•°ç»„ä»¶ç¬¬ä¸€æ¬¡è¢«æ¸²æŸ“æ—¶ï¼Œ<code>useState</code> ä¼šèµ°ä¸€å¥—â€œåˆå§‹åŒ–â€æµç¨‹ï¼›è€Œå½“ç»„ä»¶å› ä¸ºçŠ¶æ€å˜åŒ–éœ€è¦é‡æ–°æ¸²æŸ“æ—¶ï¼Œ<code>useState</code> åˆ™ä¼šèµ°ä¸€å¥—â€œæ›´æ–°â€æµç¨‹ã€‚åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒReact è¿˜ä¼šåˆ©ç”¨ä¸€ä¸ªâ€œæ›´æ–°é˜Ÿåˆ—â€å’Œâ€œä¼˜å…ˆçº§è°ƒåº¦â€æœºåˆ¶ï¼Œæ¥ç¡®ä¿çŠ¶æ€æ›´æ–°çš„æœ‰åºæ€§å’Œé«˜æ•ˆæ€§ã€‚</p>
<h3 data-id="heading-12">3.1 mountStateï¼šåˆå§‹åŒ–çŠ¶æ€ç®¡ç†</h3>
<p>å½“ä¸€ä¸ªå‡½æ•°ç»„ä»¶é¦–æ¬¡è¢«æ¸²æŸ“åˆ°å±å¹•ä¸Šæ—¶ï¼ŒReact ä¼šè¿›å…¥ä¸€ä¸ªâ€œæŒ‚è½½â€é˜¶æ®µã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œ<code>useState</code> ä¼šè¢«ä¸€ä¸ªç‰¹æ®Šçš„â€œHooks åˆ†å‘å™¨â€ï¼ˆ<code>HooksDispatcherOnMount</code>ï¼‰æ‹¦æˆªï¼Œå¹¶å°†å…¶å†…éƒ¨é€»è¾‘æŒ‡å‘ <code>mountState</code> å‡½æ•°ã€‚</p>
<h4 data-id="heading-13">3.1.1 å‘ç”Ÿæ—¶æœº</h4>
<ul>
<li><strong>é¦–æ¬¡æ¸²æŸ“å‡½æ•°ç»„ä»¶æ—¶</strong>ï¼šè¿™æ˜¯ <code>mountState</code> ç™»åœºçš„å”¯ä¸€æ—¶æœºã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„ç»„ä»¶å°±åƒä¸€ä¸ªæ–°å¼€å¼ çš„å•†åº—ï¼Œ<code>mountState</code> è´Ÿè´£ä¸ºå®ƒå‡†å¤‡å¥½æ‰€æœ‰å¿…è¦çš„â€œè´§æ¶â€ï¼ˆHook èŠ‚ç‚¹ï¼‰å’Œâ€œåº“å­˜ç®¡ç†ç³»ç»Ÿâ€ï¼ˆæ›´æ–°é˜Ÿåˆ—ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-14">3.1.2 åˆå§‹å€¼å¦‚ä½•å¤„ç†</h4>
<p>å½“ä½ è°ƒç”¨ <code>useState</code> æ—¶ï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªåˆå§‹å€¼ï¼Œè¿™ä¸ªåˆå§‹å€¼å¯ä»¥æ˜¯å…·ä½“çš„æ•°æ®ï¼ˆå¦‚ <code>useState(0)</code>ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆå¦‚ <code>useState(() =&gt; computeInitialValue())</code>ï¼‰ã€‚</p>
<ul>
<li>
<p><strong>æ‡’åˆå§‹åŒ–ï¼ˆLazy Initializationï¼‰</strong>ï¼š</p>
<ul>
<li>å¦‚æœä½ ä¼ å…¥çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆä¾‹å¦‚ <code>useState(() =&gt; heavyInit())</code>ï¼‰ï¼ŒReact ä¸ä¼šç«‹å³æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯åœ¨çœŸæ­£éœ€è¦åˆå§‹å€¼çš„æ—¶å€™æ‰å»è°ƒç”¨å®ƒã€‚è¿™ç§æ–¹å¼è¢«ç§°ä¸ºâ€œæ‡’åˆå§‹åŒ–â€ï¼Œå½“ä½ çš„åˆå§‹å€¼è®¡ç®—æˆæœ¬å¾ˆé«˜æ—¶ï¼Œå¯ä»¥é¿å…ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mountStateImpl</span>(<span class="hljs-params">initialState</span>) {
  <span class="hljs-keyword">const</span> hook = <span class="hljs-title function_">mountWorkInProgressHook</span>(); <span class="hljs-comment">// åˆ›å»º Hook èŠ‚ç‚¹</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> initialState === <span class="hljs-string">"function"</span>) {
    <span class="hljs-keyword">const</span> initialStateInitializer = initialState;
    initialState = <span class="hljs-title function_">initialStateInitializer</span>(); <span class="hljs-comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œè·å–åˆå§‹å€¼</span>
    <span class="hljs-keyword">if</span> (shouldDoubleInvokeUserFnsInHooksDEV) {
      <span class="hljs-comment">// ä»…åœ¨ DEV ä¸¥æ ¼æ¨¡å¼ä¸‹</span>
      <span class="hljs-title function_">setIsStrictModeForDevtools</span>(<span class="hljs-literal">true</span>);
      <span class="hljs-keyword">try</span> {
        <span class="hljs-title function_">initialStateInitializer</span>(); <span class="hljs-comment">// ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œæ£€æŸ¥å‰¯ä½œç”¨</span>
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-title function_">setIsStrictModeForDevtools</span>(<span class="hljs-literal">false</span>);
      }
    }
  }
  <span class="hljs-comment">// ... åç»­ä¼šç”¨è¿™ä¸ª initialState æ¥è®¾ç½® hook.memoizedState å’Œ hook.baseState</span>
  <span class="hljs-keyword">return</span> hook;
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-15">3.1.3 Hook èŠ‚ç‚¹ä¸æ›´æ–°é˜Ÿåˆ—çš„å»ºç«‹</h4>
<p>åœ¨ <code>mountStateImpl</code> å‡½æ•°ä¸­ï¼ŒReact ä¼šä¸ºå½“å‰çš„ <code>useState</code> è°ƒç”¨åˆ›å»ºä¸€ä¸ªå†…éƒ¨çš„ <strong>Hook èŠ‚ç‚¹</strong>ï¼ˆ<code>hook</code> å¯¹è±¡ï¼‰ï¼Œå¹¶ä¸ºå®ƒé…å¤‡ä¸€ä¸ª <strong>æ›´æ–°é˜Ÿåˆ—</strong>ï¼ˆ<code>queue</code> å¯¹è±¡ï¼‰ã€‚</p>
<ul>
<li>
<p><strong>Hook èŠ‚ç‚¹ï¼ˆ<code>hook</code>ï¼‰</strong>ï¼š</p>
<ul>
<li><code>memoizedState</code>ï¼šè¿™æ˜¯ Hook èŠ‚ç‚¹ä¸­æœ€é‡è¦çš„å­—æ®µï¼Œå®ƒå­˜å‚¨ç€å½“å‰ç»„ä»¶æ¸²æŸ“æ—¶å¯ä»¥è¯»å–åˆ°çš„çŠ¶æ€å€¼ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºç»„ä»¶çš„â€œå½“å‰çŠ¶æ€å¿«ç…§â€ã€‚</li>
<li><code>baseState</code>ï¼šè¿™ä¸ªå­—æ®µç”¨äºåœ¨å¤„ç†æ›´æ–°é˜Ÿåˆ—æ—¶ï¼Œä½œä¸ºè®¡ç®—æ–°çŠ¶æ€çš„â€œåŸºçº¿â€ã€‚å½“æœ‰å¤šä¸ªæ›´æ–°æ’é˜Ÿæ—¶ï¼Œ<code>baseState</code> ç¡®ä¿ React èƒ½å¤Ÿä»ä¸€ä¸ªå·²çŸ¥ä¸”ç¨³å®šçš„çŠ¶æ€å¼€å§‹è®¡ç®—ï¼Œé¿å…å› ä¸ºè·³è¿‡æŸäº›æ›´æ–°è€Œå¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ... åœ¨ mountStateImpl ä¸­</span>
hook.<span class="hljs-property">memoizedState</span> = hook.<span class="hljs-property">baseState</span> = initialState; <span class="hljs-comment">// åˆå§‹æ—¶ä¸¤è€…éƒ½ç­‰äºåˆå§‹å€¼</span>
</code></pre>
</li>
<li>
<p><strong>æ›´æ–°é˜Ÿåˆ—ï¼ˆ<code>queue</code>ï¼‰</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ª <code>useState</code> Hook éƒ½ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„æ›´æ–°é˜Ÿåˆ—ã€‚è¿™ä¸ªé˜Ÿåˆ—æ˜¯ä¸€ä¸ª<strong>ç¯å½¢é“¾è¡¨</strong>ç»“æ„ï¼Œä¸“é—¨ç”¨æ¥å­˜å‚¨æ‰€æœ‰å¾…å¤„ç†çš„çŠ¶æ€æ›´æ–°ã€‚</li>
<li><strong><code>pending: null</code></strong>ï¼šæŒ‡å‘é˜Ÿåˆ—ä¸­æœ€æ–°å¾…å¤„ç†çš„æ›´æ–°ã€‚ç”±äºæ˜¯ç¯å½¢é“¾è¡¨ï¼Œå®ƒé€šå¸¸æŒ‡å‘é“¾è¡¨çš„å°¾éƒ¨ã€‚åœ¨åˆå§‹åŒ–æ—¶ï¼Œè¿˜æ²¡æœ‰ä»»ä½•æ›´æ–°ï¼Œæ‰€ä»¥æ˜¯ <code>null</code>ã€‚</li>
<li><strong><code>lanes: NoLanes</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªä½æ©ç ï¼ˆbitmaskï¼‰ï¼Œç”¨äºè¡¨ç¤ºé˜Ÿåˆ—ä¸­æ‰€æœ‰æ›´æ–°çš„ä¼˜å…ˆçº§é›†åˆã€‚<code>NoLanes</code> è¡¨ç¤ºå½“å‰é˜Ÿåˆ—ä¸­æ²¡æœ‰ä»»ä½•æ›´æ–°ï¼Œå› æ­¤ä¹Ÿæ²¡æœ‰ä¼˜å…ˆçº§ã€‚</li>
<li><strong><code>dispatch: null</code></strong>ï¼šè¿™ä¸ªå­—æ®µéå¸¸å…³é”®ï¼Œå®ƒå°†ä¼šåœ¨ç¨åè¢«ç»‘å®šä¸ºæˆ‘ä»¬ç†Ÿæ‚‰çš„ <code>setState</code> å‡½æ•°ã€‚åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå®ƒæš‚æ—¶æ˜¯ <code>null</code>ã€‚</li>
<li><strong><code>lastRenderedReducer: basicStateReducer</code></strong>ï¼šè¿™æ˜¯ä¸€ä¸ªé»˜è®¤çš„ reducer å‡½æ•°ï¼Œç”¨äºå¤„ç† <code>useState</code> çš„çŠ¶æ€æ›´æ–°é€»è¾‘ã€‚å®ƒèƒ½è¯†åˆ«ä½ ä¼ å…¥ <code>setState</code> çš„æ˜¯å€¼è¿˜æ˜¯å‡½æ•°ã€‚</li>
<li><strong><code>lastRenderedState: initialState</code></strong>ï¼šè®°å½•ä¸Šä¸€æ¬¡æ¸²æŸ“æ—¶çš„çŠ¶æ€ã€‚è¿™ä¸ªå­—æ®µä¸ <code>lastRenderedReducer</code> ä¸€èµ·ï¼Œç”¨äºå®ç°â€œæ€¥åˆ‡æ›´æ–°â€ï¼ˆeager updateï¼‰ä¼˜åŒ–ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥å‡å°‘ä¸€æ¬¡ä¸å¿…è¦çš„æ¸²æŸ“ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ... åœ¨ mountStateImpl ä¸­</span>
<span class="hljs-keyword">const</span> queue = {
  <span class="hljs-attr">pending</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// æŒ‡å‘æœ€æ–°å¾…å¤„ç†æ›´æ–°ï¼ˆç¯å½¢é“¾è¡¨å°¾ï¼‰</span>
  <span class="hljs-attr">lanes</span>: <span class="hljs-title class_">NoLanes</span>, <span class="hljs-comment">// é˜Ÿåˆ—ä¸­æ‰€æœ‰æ›´æ–°çš„ä¼˜å…ˆçº§é›†åˆ</span>
  <span class="hljs-attr">dispatch</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// åç»­ç»‘å®šçš„æ›´æ–°è§¦å‘å‡½æ•°ï¼ˆsetXxxï¼‰</span>
  <span class="hljs-attr">lastRenderedReducer</span>: basicStateReducer, <span class="hljs-comment">// çŠ¶æ€è®¡ç®—å‡½æ•°ï¼ˆé»˜è®¤å¤„ç†å€¼/å‡½æ•°ç±»å‹ actionï¼‰</span>
  <span class="hljs-attr">lastRenderedState</span>: (<span class="hljs-attr">initialState</span>: any), <span class="hljs-comment">// ä¸Šä¸€æ¬¡æ¸²æŸ“çš„çŠ¶æ€ï¼ˆç”¨äºä¼˜åŒ–ï¼‰</span>
};
hook.<span class="hljs-property">queue</span> = queue;
</code></pre>
</li>
</ul>
<h4 data-id="heading-16">3.1.4 ç»‘å®š dispatchï¼šä¸ºä»€ä¹ˆ <code>setState</code> å¼•ç”¨ç¨³å®š</h4>
<p>ä½ å¯èƒ½æ³¨æ„åˆ°ï¼Œæ— è®ºç»„ä»¶é‡æ–°æ¸²æŸ“å¤šå°‘æ¬¡ï¼Œä½ ä» <code>useState</code> è§£æ„å‡ºæ¥çš„ <code>setState</code> å‡½æ•°çš„å¼•ç”¨æ€»æ˜¯ç¨³å®šçš„ï¼Œå®ƒä¸ä¼šå˜ã€‚è¿™æ˜¯ React å†…éƒ¨ä¸€ä¸ªéå¸¸å·§å¦™çš„è®¾è®¡ã€‚</p>
<ul>
<li><strong>é—­åŒ…ä¸ç»‘å®š</strong>ï¼š
<ul>
<li>åœ¨ <code>mountState</code> å‡½æ•°ä¸­ï¼ŒReact ä¼šåˆ›å»ºä¸€ä¸ª <code>dispatch</code> å‡½æ•°ï¼Œå¹¶é€šè¿‡ <code>Function.prototype.bind</code> æ–¹æ³•ï¼Œå°†å½“å‰çš„ Fiber èŠ‚ç‚¹ï¼ˆ<code>currentlyRenderingFiber</code>ï¼‰å’Œ Hook çš„æ›´æ–°é˜Ÿåˆ—ï¼ˆ<code>queue</code>ï¼‰â€œç»‘å®šâ€åˆ° <code>dispatchSetState</code> å‡½æ•°ä¸Šã€‚</li>
<li>è¿™ä¸ªç»‘å®šæ“ä½œç¡®ä¿äº† <code>dispatch</code> å‡½æ•°åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå§‹ç»ˆèƒ½å¤Ÿæ­£ç¡®åœ°æ‰¾åˆ°å®ƒæ‰€å±çš„ Fiber èŠ‚ç‚¹å’Œæ›´æ–°é˜Ÿåˆ—ï¼Œä»è€Œè§¦å‘æ­£ç¡®çš„çŠ¶æ€æ›´æ–°ã€‚</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mountState</span>(<span class="hljs-params">initialState</span>) {
  <span class="hljs-keyword">const</span> hook = <span class="hljs-title function_">mountStateImpl</span>(initialState);
  <span class="hljs-keyword">const</span> queue = hook.<span class="hljs-property">queue</span>;
  <span class="hljs-comment">// ç»‘å®š dispatchï¼šä¸å½“å‰ Fiberã€é˜Ÿåˆ—é—­åŒ…å…³è”ï¼Œç¡®ä¿ç¨³å®šæ€§</span>
  <span class="hljs-keyword">const</span> dispatch = dispatchSetState.<span class="hljs-title function_">bind</span>(
    <span class="hljs-literal">null</span>,
    currentlyRenderingFiber, <span class="hljs-comment">// å½“å‰æ­£åœ¨æ¸²æŸ“çš„ Fiber èŠ‚ç‚¹</span>
    queue <span class="hljs-comment">// å½“å‰ Hook çš„æ›´æ–°é˜Ÿåˆ—</span>
  );
  queue.<span class="hljs-property">dispatch</span> = dispatch; <span class="hljs-comment">// å°†ç»‘å®šåçš„ dispatch å­˜å‚¨åˆ°é˜Ÿåˆ—ä¸­</span>
  <span class="hljs-keyword">return</span> [hook.<span class="hljs-property">memoizedState</span>, dispatch]; <span class="hljs-comment">// è¿”å› [çŠ¶æ€, æ›´æ–°å‡½æ•°]</span>
}
</code></pre>
<h4 data-id="heading-17">3.1.5 <code>action</code> é•¿ä»€ä¹ˆæ ·ï¼šå€¼æˆ–å‡½æ•°éƒ½å¯ä»¥</h4>
<p>å½“ä½ è°ƒç”¨ <code>setState(action)</code> æ—¶ï¼Œ<code>action</code> å¯ä»¥æ˜¯ä¸¤ç§å½¢å¼ï¼š</p>
<ol>
<li><strong>ç›´æ¥çš„å€¼</strong>ï¼šä¾‹å¦‚ <code>setCount(10)</code>ï¼Œæ­¤æ—¶ <code>action</code> å°±æ˜¯ <code>10</code>ã€‚</li>
<li><strong>ä¸€ä¸ªå‡½æ•°</strong>ï¼šä¾‹å¦‚ <code>setCount(prevCount =&gt; prevCount + 1)</code>ï¼Œæ­¤æ—¶ <code>action</code> æ˜¯ä¸€ä¸ªæ¥æ”¶ä¸Šä¸€ä¸ªçŠ¶æ€ä½œä¸ºå‚æ•°å¹¶è¿”å›æ–°çŠ¶æ€çš„å‡½æ•°ã€‚</li>
</ol>
<p>è¿™ä¸¤ç§å½¢å¼çš„ <code>action</code> éƒ½æ˜¯ç”± <code>basicStateReducer</code> è¿™ä¸ªå†…éƒ¨å‡½æ•°æ¥å¤„ç†çš„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> basicStateReducer&lt;S&gt;(<span class="hljs-attr">state</span>: S, <span class="hljs-attr">action</span>: <span class="hljs-title class_">BasicStateAction</span>&lt;S&gt;): S {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> action === <span class="hljs-string">"function"</span> ? <span class="hljs-title function_">action</span>(state) : action;
}
</code></pre>
<h3 data-id="heading-18">3.2 updateStateï¼šçŠ¶æ€æ›´æ–°æµç¨‹</h3>
<p>å½“ç»„ä»¶å·²ç»æŒ‚è½½å®Œæˆï¼Œå¹¶ä¸”å› ä¸º <code>setState</code> è°ƒç”¨å¯¼è‡´çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒReact ä¼šè¿›å…¥â€œæ›´æ–°â€é˜¶æ®µã€‚æ­¤æ—¶ï¼Œ<code>useState</code> çš„å†…éƒ¨é€»è¾‘ä¼šè·¯ç”±åˆ° <code>updateState</code> å‡½æ•°ã€‚</p>
<h4 data-id="heading-19">3.2.1 å‘ç”Ÿæ—¶æœº</h4>
<ul>
<li><strong>ç»„ä»¶åç»­æ¸²æŸ“æ—¶</strong>ï¼šåªè¦ç»„ä»¶ä¸æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“ï¼Œå¹¶ä¸”å› ä¸ºæŸç§åŸå› ï¼ˆä¾‹å¦‚çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ã€è‡ªèº«çŠ¶æ€æ›´æ–°ç­‰ï¼‰éœ€è¦é‡æ–°æ‰§è¡Œå‡½æ•°ä½“æ—¶ï¼Œ<code>useState</code> å°±ä¼šè°ƒç”¨ <code>updateState</code>ã€‚</li>
</ul>
<h4 data-id="heading-20">3.2.2 <code>useState</code> æ˜¯ <code>useReducer</code> çš„ç‰¹æ®Šå½¢å¼</h4>
<p><code>useState</code> åœ¨åº•å±‚å…¶å®æ˜¯ <code>useReducer</code> çš„ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ã€‚<code>updateState</code> å‡½æ•°çš„å®ç°æ¸…æ™°åœ°å±•ç¤ºäº†è¿™ä¸€ç‚¹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> updateState&lt;S&gt;(
  <span class="hljs-attr">initialState</span>: (<span class="hljs-function">() =&gt;</span> S) | S
): [S, <span class="hljs-title class_">Dispatch</span>&lt;<span class="hljs-title class_">BasicStateAction</span>&lt;S&gt;&gt;] {
  <span class="hljs-comment">// å®é™…ä¸Šæ˜¯è°ƒç”¨äº† updateReducerï¼Œå¹¶ä¼ å…¥äº† basicStateReducer ä½œä¸ºé»˜è®¤çš„ reducer</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">updateReducer</span>(basicStateReducer, initialState);
}
</code></pre>
<p>è¿™æ„å‘³ç€ <code>useState</code> çš„æ‰€æœ‰çŠ¶æ€æ›´æ–°é€»è¾‘ï¼ŒåŒ…æ‹¬å¦‚ä½•å¤„ç†æ›´æ–°é˜Ÿåˆ—ã€å¦‚ä½•è®¡ç®—æ–°çŠ¶æ€ã€å¦‚ä½•å¤„ç†ä¼˜å…ˆçº§ç­‰ï¼Œéƒ½å¤ç”¨äº† <code>useReducer</code> çš„æ ¸å¿ƒæœºåˆ¶ã€‚<code>useState</code> åªæ˜¯æä¾›äº†ä¸€ä¸ªæ›´ç®€æ´çš„ API å°è£…ã€‚</p>
<h4 data-id="heading-21">3.2.3 <code>updateReducer</code> çš„æ ¸å¿ƒå·¥ä½œ</h4>
<p><code>updateReducer</code> æ˜¯å¤„ç† Hook çŠ¶æ€æ›´æ–°çš„æ ¸å¿ƒå‡½æ•°ã€‚å®ƒä¼šéå† Hook çš„æ›´æ–°é˜Ÿåˆ—ï¼Œå¹¶æ ¹æ®é˜Ÿåˆ—ä¸­çš„æ›´æ–°æ¥è®¡ç®—å‡ºæœ€æ–°çš„çŠ¶æ€ã€‚</p>
<ul>
<li>
<p><strong>è·å– Hook èŠ‚ç‚¹å’Œé˜Ÿåˆ—</strong>ï¼š</p>
<ul>
<li><code>updateReducer</code> é¦–å…ˆä¼šè·å–å½“å‰æ­£åœ¨å¤„ç†çš„ Hook èŠ‚ç‚¹ï¼ˆ<code>hook</code>ï¼‰ä»¥åŠå®ƒå…³è”çš„æ›´æ–°é˜Ÿåˆ—ï¼ˆ<code>queue</code>ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> updateReducerImpl&lt;S, A&gt;(
  <span class="hljs-attr">hook</span>: <span class="hljs-title class_">Hook</span>,
  <span class="hljs-attr">current</span>: <span class="hljs-title class_">Hook</span>, <span class="hljs-comment">// ä¸Šä¸€æ¬¡æ¸²æŸ“çš„ Hook èŠ‚ç‚¹</span>
  <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">S, A</span>) =&gt;</span> S
): [S, <span class="hljs-title class_">Dispatch</span>&lt;A&gt;] {
  <span class="hljs-keyword">const</span> queue = hook.<span class="hljs-property">queue</span>;
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<ul>
<li>
<p><strong>éå†æ›´æ–°é˜Ÿåˆ—ï¼Œè®¡ç®—æ–°çŠ¶æ€</strong>ï¼š</p>
<ul>
<li><code>updateReducer</code> ä¼šä» <code>hook.baseState</code>ï¼ˆåŸºçº¿çŠ¶æ€ï¼‰å¼€å§‹ï¼Œæ²¿ç€æ›´æ–°é˜Ÿåˆ—ï¼ˆ<code>queue.pending</code> æŒ‡å‘çš„ç¯å½¢é“¾è¡¨ï¼‰é€ä¸ªå¤„ç†æ¯ä¸€ä¸ªæ›´æ–°ã€‚</li>
<li>å¯¹äºæ¯ä¸ªæ›´æ–°ï¼Œå®ƒä¼šè°ƒç”¨ä¼ å…¥çš„ <code>reducer</code> å‡½æ•°ï¼ˆå¯¹äº <code>useState</code> æ¥è¯´å°±æ˜¯ <code>basicStateReducer</code>ï¼‰ï¼Œå°†å½“å‰çŠ¶æ€å’Œæ›´æ–°çš„ <code>action</code> ä¼ ç»™ <code>reducer</code>ï¼Œå¾—åˆ°æ–°çš„çŠ¶æ€ã€‚</li>
</ul>
</li>
<li>
<p><strong>é¿å…ä¸å¿…è¦çš„æ¸²æŸ“</strong>ï¼š</p>
<ul>
<li>å½“ setState æ¥æ”¶åˆ°ä¸€ä¸ª å€¼ ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼ä¸å½“å‰çš„ memoizedState ï¼ˆå³ä¸Šä¸€æ¬¡æ¸²æŸ“åçš„çŠ¶æ€ï¼‰ ä¸¥æ ¼ç›¸ç­‰ æ—¶ï¼ŒReact ä¼šåˆ¤æ–­çŠ¶æ€æ²¡æœ‰å®é™…å˜åŒ–ï¼Œä»è€Œ æå‰é€€å‡º ï¼Œä¸è°ƒåº¦ä¸€æ¬¡æ–°çš„æ¸²æŸ“ã€‚è¿™æ˜¯ä¸ºäº†é¿å…ä¸å¿…è¦çš„è®¡ç®—å’Œ DOM æ›´æ–°ï¼Œæé«˜æ€§èƒ½ã€‚è¿™æ­£æ˜¯æˆ‘ä¹‹å‰ä¿®æ­£çš„é‡ç‚¹ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¤„ç†ä¼˜å…ˆçº§ï¼ˆLanesï¼‰</strong>ï¼š</p>
<ul>
<li>åœ¨éå†æ›´æ–°é˜Ÿåˆ—æ—¶ï¼Œ<code>updateReducer</code> è¿˜ä¼šè€ƒè™‘æ¯ä¸ªæ›´æ–°çš„ä¼˜å…ˆçº§ï¼ˆ<code>lane</code>ï¼‰ã€‚å®ƒä¼šç¡®ä¿åªæœ‰é‚£äº›ä¼˜å…ˆçº§è¶³å¤Ÿé«˜çš„æ›´æ–°æ‰ä¼šè¢«å¤„ç†ã€‚ä½ä¼˜å…ˆçº§çš„æ›´æ–°å¯èƒ½ä¼šè¢«è·³è¿‡ï¼Œç•™å¾…åç»­çš„æ¸²æŸ“å‘¨æœŸå¤„ç†ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-22">3.2.4 è¿”å›å€¼</h4>
<p><code>updateState</code> æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ <code>[state, dispatch]</code>ï¼Œå…¶ä¸­ <code>state</code> æ˜¯ç»è¿‡æ‰€æœ‰æœ‰æ•ˆæ›´æ–°è®¡ç®—åçš„æœ€æ–°çŠ¶æ€ï¼Œè€Œ <code>dispatch</code> ä»ç„¶æ˜¯é‚£ä¸ªç¨³å®šçš„ <code>setState</code> å‡½æ•°ã€‚</p>
<h3 data-id="heading-23">3.3 ä¸ºä»€ä¹ˆè¦æœ‰ mountState å’Œ updateState</h3>
<p>åŒºåˆ† mountState å’Œ updateStateï¼Œæ˜¯ä¸ºäº†åœ¨åˆæ¬¡æ¸²æŸ“æ—¶åˆå§‹åŒ–çŠ¶æ€ä¸æ›´æ–°é˜Ÿåˆ—ï¼Œåœ¨åç»­æ›´æ–°æ—¶å¤ç”¨æ—§çŠ¶æ€ã€å¤„ç†å¾…æ‰§è¡Œæ›´æ–°ï¼Œæ—¢é¿å…åˆå§‹å€¼é‡å¤è®¡ç®—ç­‰æ— æ•ˆå¼€é”€ï¼Œåˆç¡®ä¿ä¸åŒé˜¶æ®µçŠ¶æ€è¡”æ¥æ­£ç¡®ã€‚</p>
<p>èŒè´£ä¸æ‰§è¡Œè¦ç‚¹ï¼š</p>
<ol>
<li><code>mountState(initialState)</code></li>
</ol>
<ul>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Hook</code> èŠ‚ç‚¹ï¼Œåˆå§‹åŒ– <code>memoizedState</code> ä¸º <code>initialState</code>ï¼ˆè‹¥ä¼ å…¥å‡½æ•°åˆ™è°ƒç”¨ä¸€æ¬¡åå–å…¶è¿”å›å€¼ï¼‰ï¼Œ<code>queue</code> ä¸ºç©ºé˜Ÿåˆ—ï¼›</li>
<li>ç»‘å®šå¹¶è¿”å› <code>dispatch</code>ï¼ˆé—­åŒ…æ•è·å½“å‰ Fiber ä¸é˜Ÿåˆ—ï¼‰ï¼Œç”¨äºåœ¨äº‹ä»¶/æ¸²æŸ“é˜¶æ®µå…¥é˜Ÿæ›´æ–°ï¼›</li>
<li>å°† <code>Hook</code> æŒ‚åˆ° <code>workInProgress.memoizedState</code> çš„é“¾è¡¨ä¸­ï¼Œä¸ºåç»­ Hooks è°ƒç”¨æä¾›éå†åŸºç¡€ã€‚</li>
</ul>
<ol start="2">
<li><code>updateState()</code></li>
</ol>
<ul>
<li>è¯»å–å½“å‰ Hook çš„ <code>queue.pending</code>ï¼ŒæŒ‰ä¼˜å…ˆçº§ï¼ˆLanesï¼‰åº”ç”¨æ›´æ–°ï¼Œè®¡ç®— <code>nextState</code>ï¼›</li>
<li>å°†æœ¬æ¬¡åº”ç”¨åçš„ç»“æœå†™å› <code>memoizedState</code> ä¸ <code>lastRenderedState</code>ï¼ŒåŒæ­¥ <code>baseState/baseQueue</code> ä»¥æ”¯æŒæœªå¤„ç†çš„ä½ä¼˜å…ˆçº§æ›´æ–°åœ¨åç»­é‡æ”¾ï¼›</li>
<li>å¦‚æœ <code>nextState</code> ä¸ä¹‹å‰å€¼â€œç›¸ç­‰â€ï¼ˆç”¨ <code>is</code> æ¯”è¾ƒï¼‰ï¼Œå¯ä»¥è§¦å‘è·³è¿‡ä¼˜åŒ–ï¼ˆä¸äº§ç”Ÿé¢å¤–å‰¯ä½œç”¨ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-24">3.4 UpdateQueue ä¸ä¼˜å…ˆçº§è°ƒåº¦</h3>
<p>åœ¨ React ä¸­ï¼ŒçŠ¶æ€æ›´æ–°å¹¶éæ€»æ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚ä¸ºäº†ä¿è¯åº”ç”¨çš„å“åº”æ€§å’Œæ€§èƒ½ï¼ŒReact å¼•å…¥äº†ä¸€å¥—ç²¾å¯†çš„æ›´æ–°é˜Ÿåˆ—ï¼ˆ<code>UpdateQueue</code>ï¼‰å’Œä¼˜å…ˆçº§è°ƒåº¦ï¼ˆ<code>Lanes</code>ï¼‰æœºåˆ¶ã€‚è¿™å¥—æœºåˆ¶ç¡®ä¿äº†å³ä½¿åœ¨çŸ­æ—¶é—´å†…æœ‰å¤§é‡çŠ¶æ€æ›´æ–°è¯·æ±‚ï¼ŒReact ä¹Ÿèƒ½ä»¥é«˜æ•ˆä¸”æœ‰åºçš„æ–¹å¼å¤„ç†å®ƒä»¬ã€‚</p>
<h4 data-id="heading-25">3.4.1 UpdateQueue çš„æ•°æ®ç»“æ„</h4>
<p>æ¯ä¸ª <code>useState</code> Hook å†…éƒ¨éƒ½ç»´æŠ¤ç€ä¸€ä¸ª <code>queue</code> å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯è¯¥ Hook çš„æ›´æ–°é˜Ÿåˆ—ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>ç¯å½¢é“¾è¡¨</strong>ï¼Œä¸“é—¨ç”¨äºå­˜å‚¨æ‰€æœ‰å¾…å¤„ç†çš„çŠ¶æ€æ›´æ–°ï¼ˆ<code>Update</code> å¯¹è±¡ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Hook å†…éƒ¨çš„ queue ç»“æ„</span>
<span class="hljs-keyword">const</span> queue = {
  <span class="hljs-attr">pending</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// æŒ‡å‘é˜Ÿåˆ—ä¸­æœ€æ–°å¾…å¤„ç†æ›´æ–°ï¼ˆç¯å½¢é“¾è¡¨å°¾éƒ¨ï¼‰</span>
  <span class="hljs-attr">lanes</span>: <span class="hljs-title class_">NoLanes</span>, <span class="hljs-comment">// é˜Ÿåˆ—ä¸­æ‰€æœ‰æ›´æ–°çš„ä¼˜å…ˆçº§é›†åˆï¼ˆä½æ©ç ï¼‰</span>
  <span class="hljs-attr">dispatch</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// ç»‘å®šåçš„ setState å‡½æ•°</span>
  <span class="hljs-attr">lastRenderedReducer</span>: basicStateReducer, <span class="hljs-comment">// çŠ¶æ€è®¡ç®—å‡½æ•°</span>
  <span class="hljs-attr">lastRenderedState</span>: (<span class="hljs-attr">initialState</span>: any), <span class="hljs-comment">// ä¸Šä¸€æ¬¡æ¸²æŸ“çš„çŠ¶æ€</span>
};
</code></pre>
<ul>
<li><strong><code>pending</code></strong>: è¿™æ˜¯ä¸€ä¸ªæŒ‡å‘ç¯å½¢é“¾è¡¨å°¾éƒ¨çš„æŒ‡é’ˆã€‚ç”±äºæ˜¯ç¯å½¢é“¾è¡¨ï¼Œé€šè¿‡ <code>pending.next</code> å°±å¯ä»¥è®¿é—®åˆ°é“¾è¡¨çš„ç¬¬ä¸€ä¸ªæ›´æ–°ã€‚å½“æ²¡æœ‰å¾…å¤„ç†çš„æ›´æ–°æ—¶ï¼Œ<code>pending</code> ä¸º <code>null</code>ã€‚</li>
<li><strong><code>lanes</code></strong>: è¿™æ˜¯ä¸€ä¸ªä½æ©ç ï¼ˆbitmaskï¼‰ï¼Œå®ƒèšåˆäº†å½“å‰ <code>UpdateQueue</code> ä¸­æ‰€æœ‰ <code>Update</code> çš„ä¼˜å…ˆçº§ã€‚React é€šè¿‡è¿™ä¸ª <code>lanes</code> å€¼æ¥åˆ¤æ–­å½“å‰ Hook æ˜¯å¦æœ‰å¾…å¤„ç†çš„æ›´æ–°ï¼Œä»¥åŠè¿™äº›æ›´æ–°çš„æœ€é«˜ä¼˜å…ˆçº§æ˜¯ä»€ä¹ˆã€‚</li>
<li><strong><code>dispatch</code></strong>: è¿™å°±æ˜¯æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„ <code>setState</code> å‡½æ•°ã€‚å®ƒåœ¨ <code>mountState</code> é˜¶æ®µè¢«ç»‘å®šåˆ°å½“å‰çš„ Fiber èŠ‚ç‚¹å’Œ <code>queue</code> ä¸Šï¼Œç¡®ä¿äº†å…¶å¼•ç”¨ç¨³å®šæ€§ã€‚</li>
<li><strong><code>lastRenderedReducer</code></strong>: å¯¹äº <code>useState</code> è€Œè¨€ï¼Œå®ƒå§‹ç»ˆæ˜¯ <code>basicStateReducer</code>ï¼Œè´Ÿè´£å¤„ç† <code>action</code> æ˜¯å€¼è¿˜æ˜¯å‡½æ•°çš„æƒ…å†µã€‚</li>
<li><strong><code>lastRenderedState</code></strong>: è®°å½•ä¸Šä¸€æ¬¡æˆåŠŸæ¸²æŸ“åè¯¥ Hook çš„çŠ¶æ€å€¼ã€‚è¿™ä¸ªå€¼åœ¨â€œæ€¥åˆ‡æ›´æ–°â€ä¼˜åŒ–ä¸­æ‰®æ¼”é‡è¦è§’è‰²ã€‚</li>
</ul>
<h4 data-id="heading-26">3.4.2 Update å¯¹è±¡çš„ç»“æ„</h4>
<p>å½“è°ƒç”¨ <code>setState(action)</code> æ—¶ï¼ŒReact ä¼šåˆ›å»ºä¸€ä¸ª <code>Update</code> å¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å¯¹åº”çš„ <code>UpdateQueue</code> ä¸­ã€‚ä¸€ä¸ª <code>Update</code> å¯¹è±¡é€šå¸¸åŒ…å«ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">type <span class="hljs-title class_">Update</span>&lt;S, A&gt; = {
  <span class="hljs-attr">lane</span>: <span class="hljs-title class_">Lane</span>, <span class="hljs-comment">// æœ¬æ¬¡æ›´æ–°çš„ä¼˜å…ˆçº§</span>
  <span class="hljs-attr">action</span>: A, <span class="hljs-comment">// æ›´æ–°çš„åŠ¨ä½œï¼Œå¯ä»¥æ˜¯æ–°çŠ¶æ€å€¼æˆ–ä¸€ä¸ªå‡½æ•°</span>
  <span class="hljs-attr">hasEagerState</span>: boolean, <span class="hljs-comment">// æ˜¯å¦æœ‰æ€¥åˆ‡çŠ¶æ€ï¼ˆç”¨äºä¼˜åŒ–ï¼‰</span>
  <span class="hljs-attr">eagerState</span>: S | <span class="hljs-literal">null</span>, <span class="hljs-comment">// æ€¥åˆ‡çŠ¶æ€å€¼ï¼ˆç”¨äºä¼˜åŒ–ï¼‰</span>
  <span class="hljs-attr">next</span>: <span class="hljs-title class_">Update</span>&lt;S, A&gt; | <span class="hljs-literal">null</span>, <span class="hljs-comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªæ›´æ–°</span>
  <span class="hljs-comment">// ... å…¶ä»–å†…éƒ¨å±æ€§</span>
};
</code></pre>
<ul>
<li><strong><code>lane</code></strong>: è¡¨ç¤ºæœ¬æ¬¡æ›´æ–°çš„ä¼˜å…ˆçº§ã€‚React å†…éƒ¨ä½¿ç”¨ <code>Lane</code>ï¼ˆè½¦é“ï¼‰æ¨¡å‹æ¥ç®¡ç†ä¼˜å…ˆçº§ï¼Œä¸åŒçš„ <code>Lane</code> ä»£è¡¨ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œä¾‹å¦‚åŒæ­¥æ›´æ–°ã€å¹¶å‘æ›´æ–°ã€ç¦»å±æ›´æ–°ç­‰ã€‚</li>
<li><strong><code>action</code></strong>: ç”¨æˆ·ä¼ å…¥ <code>setState</code> çš„å€¼æˆ–å‡½æ•°ã€‚</li>
<li><strong><code>hasEagerState</code> å’Œ <code>eagerState</code></strong>: ç”¨äºâ€œæ€¥åˆ‡æ›´æ–°â€ä¼˜åŒ–ã€‚å¦‚æœ <code>action</code> æ˜¯ä¸€ä¸ªéå‡½æ•°å€¼ï¼Œå¹¶ä¸”ä¸å½“å‰çŠ¶æ€ä¸åŒï¼ŒReact ä¼šå°è¯•è®¡ç®—å‡º <code>eagerState</code> å¹¶æ ‡è®° <code>hasEagerState</code> ä¸º <code>true</code>ã€‚</li>
<li><strong><code>next</code></strong>: æŒ‡å‘ <code>UpdateQueue</code> ä¸­çš„ä¸‹ä¸€ä¸ª <code>Update</code> å¯¹è±¡ï¼Œæ„æˆç¯å½¢é“¾è¡¨ã€‚</li>
</ul>
<h4 data-id="heading-27">3.4.3 ä¼˜å…ˆçº§è°ƒåº¦ä¸ <code>Lanes</code> æœºåˆ¶</h4>
<p>React çš„è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰ä¼šæ ¹æ® <code>Lanes</code> æ¥å†³å®šä½•æ—¶ä»¥åŠä»¥ä½•ç§é¡ºåºå¤„ç†æ›´æ–°ã€‚</p>
<ul>
<li><strong>Lanes (è½¦é“)</strong>: React ä½¿ç”¨ä½æ©ç æ¥è¡¨ç¤ºä¼˜å…ˆçº§ï¼Œæ¯ä¸ªä½ä»£è¡¨ä¸€ä¸ªâ€œè½¦é“â€ã€‚æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚ä¾‹å¦‚ï¼š
<ul>
<li><code>SyncLane</code> (åŒæ­¥è½¦é“): æœ€é«˜ä¼˜å…ˆçº§ï¼Œé€šå¸¸ç”¨äºç”¨æˆ·äº¤äº’ï¼ˆå¦‚ç‚¹å‡»ï¼‰ã€‚</li>
<li><code>InputContinuousLane</code> (è¿ç»­è¾“å…¥è½¦é“): è¾ƒé«˜ä¼˜å…ˆçº§ï¼Œç”¨äºè¿ç»­è¾“å…¥äº‹ä»¶ï¼ˆå¦‚æ‹–æ‹½ï¼‰ã€‚</li>
<li><code>DefaultLane</code> (é»˜è®¤è½¦é“): ä¸­ç­‰ä¼˜å…ˆçº§ï¼Œç”¨äºå¤§å¤šæ•°çŠ¶æ€æ›´æ–°ã€‚</li>
<li><code>IdleLane</code> (ç©ºé—²è½¦é“): æœ€ä½ä¼˜å…ˆçº§ï¼Œç”¨äºä¸é‡è¦çš„åå°ä»»åŠ¡ã€‚</li>
</ul>
</li>
<li><strong>æ›´æ–°çš„åˆå¹¶ä¸è·³è¿‡</strong>:
<ul>
<li>åœ¨ <code>updateReducerImpl</code> ä¸­ï¼ŒReact ä¼šéå† <code>UpdateQueue</code>ã€‚å¯¹äºæ¯ä¸ª <code>Update</code>ï¼Œå®ƒä¼šæ£€æŸ¥å…¶ <code>lane</code> æ˜¯å¦åœ¨å½“å‰æ¸²æŸ“çš„ <code>renderLanes</code> èŒƒå›´å†…ã€‚</li>
<li>å¦‚æœ <code>Update</code> çš„ <code>lane</code> ä¸åœ¨ <code>renderLanes</code> èŒƒå›´å†…ï¼ˆå³ä¼˜å…ˆçº§ä¸å¤Ÿé«˜ï¼‰ï¼Œè¿™ä¸ªæ›´æ–°ä¼šè¢«<strong>è·³è¿‡</strong>ï¼Œå¹¶ä¿ç•™åœ¨ <code>UpdateQueue</code> ä¸­ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªæ›´é«˜ä¼˜å…ˆçº§çš„æ¸²æŸ“å‘¨æœŸå¤„ç†ã€‚</li>
<li>å¦‚æœ <code>Update</code> çš„ <code>lane</code> åœ¨ <code>renderLanes</code> èŒƒå›´å†…ï¼Œåˆ™ä¼šè¢«å¤„ç†ï¼Œå…¶ <code>action</code> ä¼šè¢« <code>reducer</code> å‡½æ•°æ‰§è¡Œï¼Œè®¡ç®—å‡ºæ–°çš„çŠ¶æ€ã€‚</li>
</ul>
</li>
<li><strong><code>baseState</code> å’Œ <code>baseQueue</code></strong>:
<ul>
<li><code>hook.baseState</code> å­˜å‚¨çš„æ˜¯ä¸Šä¸€æ¬¡æˆåŠŸæäº¤ï¼ˆcommitï¼‰çš„çŠ¶æ€ã€‚</li>
<li><code>hook.baseQueue</code> å­˜å‚¨çš„æ˜¯ä¸Šä¸€æ¬¡æˆåŠŸæäº¤åï¼Œä»ç„¶ä¿ç•™åœ¨é˜Ÿåˆ—ä¸­ä½†æœªè¢«å¤„ç†çš„ä½ä¼˜å…ˆçº§æ›´æ–°ã€‚</li>
<li>åœ¨æ¯æ¬¡æ›´æ–°æ—¶ï¼Œ<code>updateReducerImpl</code> ä¼šä» <code>baseState</code> å¼€å§‹ï¼Œå¹¶é¦–å…ˆå¤„ç† <code>baseQueue</code> ä¸­çš„æ›´æ–°ï¼Œç„¶åå¤„ç† <code>pending</code> é˜Ÿåˆ—ä¸­çš„æ›´æ–°ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿å³ä½¿æœ‰ä½ä¼˜å…ˆçº§æ›´æ–°è¢«è·³è¿‡ï¼Œå®ƒä»¬ä¹Ÿèƒ½åœ¨åç»­çš„æ¸²æŸ“ä¸­è¢«æ­£ç¡®å¤„ç†ï¼Œä¿è¯çŠ¶æ€çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-28">3.4.4 æ‰¹é‡æ›´æ–°</h4>
<p>react æœ‰ä¸€é“é¢è¯•é¢˜æ˜¯ setState æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Œå…¶å® setState æ˜¯å¦â€œåŒæ­¥â€ï¼Œå–å†³äºæ‰¹é‡æ›´æ–°ä¸ä¼˜å…ˆçº§æœºåˆ¶ã€‚å…³é”®ç‚¹ä¸æ˜¯â€œåŒæ­¥/å¼‚æ­¥â€æœ¬èº«ï¼Œè€Œæ˜¯å®ƒåœ¨ä¸€æ¬¡äº‹ä»¶å¾ªç¯ä¸­å¦‚ä½•è¢«æ”¶é›†ã€ä½•æ—¶è¢«è®¡ç®—ä¸æäº¤ã€‚</p>
<h5 data-id="heading-29">1. æ ¸å¿ƒæœºåˆ¶ï¼šè‡ªåŠ¨æ‰¹é‡æ›´æ–°</h5>
<ol>
<li>è‡ªåŠ¨æ‰¹é‡ä¸æ ¹è°ƒåº¦ï¼šReact ä¼šå°†åŒä¸€äº‹ä»¶å¾ªç¯/å¾®ä»»åŠ¡å†…çš„å¤šæ¬¡æ›´æ–°ç»Ÿä¸€åˆå¹¶åˆ°æ ¹è°ƒåº¦é˜Ÿåˆ—ï¼ˆ<code>ensureRootIsScheduled</code>ï¼‰ï¼Œå¹¶åœ¨å¾®ä»»åŠ¡æœ«å°¾æ¨è¿›ä¸€æ¬¡å·¥ä½œå¾ªç¯ï¼Œè¦†ç›–äº‹ä»¶å¤„ç†ã€<code>Promise.then</code>ã€<code>setTimeout</code>ã€<code>useEffect</code> ç­‰è·¯å¾„ã€‚</li>
<li>äº‹ä»¶ä¼˜å…ˆçº§ä¸åŒ…è£…ï¼šReact DOM äº‹ä»¶ç³»ç»Ÿä¼šæ ¹æ®äº‹ä»¶ç±»å‹é€‰æ‹©ä¼˜å…ˆçº§ï¼ˆç¦»æ•£/è¿ç»­/é»˜è®¤ï¼‰ï¼Œå¹¶åœ¨åˆ†å‘æ—¶è®¾ç½®å½“å‰æ›´æ–°ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚ç¦»æ•£äº‹ä»¶ï¼ˆå¦‚ <code>click</code>ã€<code>keydown</code>ã€<code>input</code> ç­‰ï¼‰ä¼šæå‡åˆ° <code>DiscreteEventPriority</code>ã€‚ç°ä»£å¹¶å‘æ¨¡å¼ä¸‹é»˜è®¤å·²æ‰¹é‡ï¼Œä½†è¿˜ä¿ç•™<code>unstable_batchedUpdates</code> ç”¨äº legacy å…¼å®¹ï¼Œã€‚</li>
<li>è½¦é“ï¼ˆlanesï¼‰ä¸è°ƒåº¦ï¼šæ¯æ¬¡ <code>setState</code> ä¼šè¯·æ±‚ä¸€ä¸ªæ›´æ–°è½¦é“ï¼ˆ<code>requestUpdateLane</code>â†’<code>lane</code>ï¼‰ï¼Œå¹¶æŠŠæ›´æ–°å…¥é˜Ÿåˆ° Hook çš„å¹¶å‘é˜Ÿåˆ—ï¼Œå†è°ƒç”¨ <code>scheduleUpdateOnFiber(root, fiber, lane)</code> åˆå¹¶åˆ°æ ¹çš„è°ƒåº¦ä¸­ã€‚</li>
</ol>
<p>ç¤ºä¾‹ï¼šäº‹ä»¶å†…çš„è‡ªåŠ¨æ‰¹é‡æ›´æ–°</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">"React"</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// React DOM çš„äº‹ä»¶åŒ…è£…ï¼ˆdiscreteUpdatesï¼‰æå‡ä¸ºç¦»æ•£äº‹ä»¶ä¼˜å…ˆçº§</span>
    <span class="hljs-title function_">setCount</span>(<span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> c + <span class="hljs-number">1</span>);
    <span class="hljs-title function_">setName</span>(<span class="hljs-string">"Clicked"</span>);
    <span class="hljs-comment">// åŒä¸€äº‹ä»¶å¾ªç¯/å¾®ä»»åŠ¡å†…ï¼Œä»¥ä¸Šæ›´æ–°åˆå¹¶åˆ°ä¸€æ¬¡æ ¹è°ƒåº¦ä¸æäº¤</span>
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>
      {name}: {count}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<p>æºç è¦ç‚¹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¦»æ•£äº‹ä»¶åŒ…è£…ï¼šä»¥æ›´é«˜äº‹ä»¶ä¼˜å…ˆçº§è¿è¡Œï¼ˆå¦‚ click/keydownï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">discreteUpdates</span>(<span class="hljs-params">fn, a, b, c, d</span>) {
  <span class="hljs-comment">// DOM äº‹ä»¶åˆ†å‘æœŸé—´æå‡åˆ° DiscreteEventPriorityï¼Œç¡®ä¿äº¤äº’å“åº”</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">discreteUpdatesImpl</span>(fn, a, b, c, d);
}

<span class="hljs-comment">// Hook çš„ setStateï¼šåˆ›å»º Updateï¼Œæ€¥åˆ‡çŠ¶æ€ä¼˜åŒ–ï¼Œå…¥é˜Ÿå¹¶è°ƒåº¦</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">dispatchSetStateInternal</span>(<span class="hljs-params">fiber, queue, action, lane</span>) {
  <span class="hljs-keyword">const</span> update = {
    lane,
    <span class="hljs-attr">revertLane</span>: <span class="hljs-title class_">NoLane</span>,
    action,
    <span class="hljs-attr">hasEagerState</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">eagerState</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span>,
  };
  <span class="hljs-keyword">const</span> alternate = fiber.<span class="hljs-property">alternate</span>;
  <span class="hljs-keyword">if</span> (
    fiber.<span class="hljs-property">lanes</span> === <span class="hljs-title class_">NoLanes</span> &amp;&amp;
    (alternate === <span class="hljs-literal">null</span> || alternate.<span class="hljs-property">lanes</span> === <span class="hljs-title class_">NoLanes</span>)
  ) {
    <span class="hljs-keyword">const</span> lastRenderedReducer = queue.<span class="hljs-property">lastRenderedReducer</span>;
    <span class="hljs-keyword">if</span> (lastRenderedReducer !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">const</span> currentState = queue.<span class="hljs-property">lastRenderedState</span>;
      <span class="hljs-keyword">const</span> eagerState = <span class="hljs-title function_">lastRenderedReducer</span>(currentState, action);
      update.<span class="hljs-property">hasEagerState</span> = <span class="hljs-literal">true</span>;
      update.<span class="hljs-property">eagerState</span> = eagerState;
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">is</span>(eagerState, currentState)) {
        <span class="hljs-comment">// å¿«è·¯å¾„ï¼šçŠ¶æ€æœªå˜ï¼Œå…¥é˜Ÿä»¥ä¾¿åç»­é‡åŸºï¼Œä½†å½“å‰ä¸è§¦å‘æ¸²æŸ“</span>
        <span class="hljs-title function_">enqueueConcurrentHookUpdateAndEagerlyBailout</span>(fiber, queue, update);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
    }
  }
  <span class="hljs-comment">// å¹¶å‘å…¥é˜Ÿï¼Œå¹¶å°†æ›´æ–°åˆå¹¶åˆ°æ ¹çš„è°ƒåº¦</span>
  <span class="hljs-keyword">const</span> root = <span class="hljs-title function_">enqueueConcurrentHookUpdate</span>(fiber, queue, update, lane);
  <span class="hljs-keyword">if</span> (root !== <span class="hljs-literal">null</span>) {
    <span class="hljs-title function_">scheduleUpdateOnFiber</span>(root, fiber, lane);
    <span class="hljs-comment">// è‹¥ä¸ºè¿‡æ¸¡è½¦é“ï¼Œåšè½¦é“å…³è”ï¼Œä¿è¯ä¸€è‡´æ€§</span>
    <span class="hljs-title function_">entangleTransitionUpdate</span>(root, queue, lane);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">// å¹¶å‘ Hook å…¥é˜Ÿï¼ˆæš‚å­˜äºå…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼Œç¨åä¸€æ¬¡æ€§è½åœ°åˆ°å„è‡ªé˜Ÿåˆ—ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">enqueueConcurrentHookUpdate</span>(<span class="hljs-params">fiber, queue, update, lane</span>) {
  <span class="hljs-keyword">const</span> concurrentQueue = queue;
  <span class="hljs-keyword">const</span> concurrentUpdate = update;
  <span class="hljs-title function_">enqueueUpdate</span>(fiber, concurrentQueue, concurrentUpdate, lane);
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">getRootForUpdatedFiber</span>(fiber);
}

<span class="hljs-comment">// å°†æ›´æ–°åˆå¹¶åˆ°æ ¹å¹¶ç¡®ä¿æ ¹å·²è¿›å…¥è°ƒåº¦ï¼›legacy åŒæ­¥è½¦é“ç«‹å³åˆ·æ–°</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">scheduleUpdateOnFiber</span>(<span class="hljs-params">root, fiber, lane</span>) {
  <span class="hljs-title function_">markRootUpdated</span>(root, lane);
  <span class="hljs-title function_">ensureRootIsScheduled</span>(root);
  <span class="hljs-keyword">if</span> (
    lane === <span class="hljs-title class_">SyncLane</span> &amp;&amp;
    executionContext === <span class="hljs-title class_">NoContext</span> &amp;&amp;
    !disableLegacyMode &amp;&amp;
    (fiber.<span class="hljs-property">mode</span> &amp; <span class="hljs-title class_">ConcurrentMode</span>) === <span class="hljs-title class_">NoMode</span>
  ) {
    <span class="hljs-title function_">resetRenderTimer</span>();
    <span class="hljs-title function_">flushSyncWorkOnLegacyRootsOnly</span>();
  }
}

<span class="hljs-comment">// ä½¿ç”¨ `didScheduleMicrotask` æ ‡å¿—è¿›è¡Œâ€œå¾®ä»»åŠ¡å»é‡â€ï¼Œç¡®ä¿åœ¨å½“å‰äº‹ä»¶å¾ªç¯çš„å¾®ä»»åŠ¡é˜¶æ®µï¼Œåªå®‰æ’ä¸€æ¬¡ç»Ÿä¸€çš„è°ƒåº¦å¤„ç†ã€‚</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ensureRootIsScheduled</span>(<span class="hljs-params">root: FiberRoot</span>): <span class="hljs-keyword">void</span> {
  <span class="hljs-keyword">if</span> (!didScheduleMicrotask) {
    didScheduleMicrotask = <span class="hljs-literal">true</span>;
    <span class="hljs-title function_">scheduleImmediateRootScheduleTask</span>();
  }
}

<span class="hljs-comment">// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span>
<span class="hljs-comment">// å¹¶å‘é˜Ÿåˆ—çš„â€œå¤„ç† updateâ€é€»è¾‘ï¼ˆè½åœ°åˆ°ç¯å½¢é“¾è¡¨ + æ ‡è®°åˆ°æ ¹ï¼‰</span>
<span class="hljs-comment">// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span>

<span class="hljs-comment">// æš‚å­˜å¹¶å‘æ›´æ–°ï¼šå°† (fiber, queue, update, lane) ä¾æ¬¡å‹å…¥æ•°ç»„ï¼Œç¨åç»Ÿä¸€å¤„ç†</span>
<span class="hljs-keyword">const</span> concurrentQueues = [];
<span class="hljs-keyword">let</span> concurrentQueuesIndex = <span class="hljs-number">0</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">enqueueUpdate</span>(<span class="hljs-params">fiber, queue, update, lane</span>) {
  <span class="hljs-comment">// æš‚å­˜åˆ°å…¨å±€å¹¶å‘é˜Ÿåˆ—ï¼Œé¿å…åœ¨æ¸²æŸ“ä¸­ç›´æ¥æ”¹åŠ¨é˜Ÿåˆ—</span>
  concurrentQueues[concurrentQueuesIndex++] = fiber;
  concurrentQueues[concurrentQueuesIndex++] = queue;
  concurrentQueues[concurrentQueuesIndex++] = update;
  concurrentQueues[concurrentQueuesIndex++] = lane;

  <span class="hljs-comment">// ç«‹å³åœ¨æº fiber æ ‡è®° lanesï¼Œä¾¿äºæ€¥åˆ‡é€€é¿ä¸åç»­è°ƒåº¦åˆ¤å®š</span>
  fiber.<span class="hljs-property">lanes</span> = <span class="hljs-title function_">mergeLanes</span>(fiber.<span class="hljs-property">lanes</span>, lane);
  <span class="hljs-keyword">const</span> alternate = fiber.<span class="hljs-property">alternate</span>;
  <span class="hljs-keyword">if</span> (alternate !== <span class="hljs-literal">null</span>) {
    alternate.<span class="hljs-property">lanes</span> = <span class="hljs-title function_">mergeLanes</span>(alternate.<span class="hljs-property">lanes</span>, lane);
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">finishQueueingConcurrentUpdates</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> endIndex = concurrentQueuesIndex;
  concurrentQueuesIndex = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (i &lt; endIndex) {
    <span class="hljs-keyword">const</span> fiber = concurrentQueues[i];
    concurrentQueues[i++] = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> queue = concurrentQueues[i];
    concurrentQueues[i++] = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> update = concurrentQueues[i];
    concurrentQueues[i++] = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">const</span> lane = concurrentQueues[i];
    concurrentQueues[i++] = <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// å°† update è¿½åŠ åˆ° queue.pending çš„ç¯å½¢é“¾è¡¨</span>
    <span class="hljs-keyword">if</span> (queue !== <span class="hljs-literal">null</span> &amp;&amp; update !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">const</span> pending = queue.<span class="hljs-property">pending</span>;
      <span class="hljs-keyword">if</span> (pending === <span class="hljs-literal">null</span>) {
        update.<span class="hljs-property">next</span> = update; <span class="hljs-comment">// é¦–ä¸ªæ›´æ–°è‡ªç¯</span>
      } <span class="hljs-keyword">else</span> {
        update.<span class="hljs-property">next</span> = pending.<span class="hljs-property">next</span>; <span class="hljs-comment">// æ’å…¥åˆ°é¦–èŠ‚ç‚¹ä¹‹å</span>
        pending.<span class="hljs-property">next</span> = update;
      }
      queue.<span class="hljs-property">pending</span> = update;
    }

    <span class="hljs-comment">// æ ‡è®° lane åˆ°æ ¹è·¯å¾„ï¼Œç¡®ä¿æ ¹è¢«è°ƒåº¦</span>
    <span class="hljs-keyword">if</span> (lane !== <span class="hljs-title class_">NoLane</span>) {
      <span class="hljs-title function_">markUpdateLaneFromFiberToRoot</span>(fiber, update, lane);
    }
  }
}

<span class="hljs-comment">// æ¸²æŸ“é˜¶æ®µæ¶ˆè´¹é˜Ÿåˆ—ï¼šç”± updateReducerImpl è´Ÿè´£ï¼ˆæºç æ‘˜å½•ï¼‰</span>
<span class="hljs-comment">// 1ï¼‰æŠŠ queue.pending åˆå¹¶åˆ° baseQueue çš„ç¯å½¢é“¾</span>
<span class="hljs-keyword">const</span> pendingQueue = queue.<span class="hljs-property">pending</span>;
<span class="hljs-keyword">if</span> (pendingQueue !== <span class="hljs-literal">null</span>) {
  <span class="hljs-keyword">if</span> (baseQueue !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">const</span> baseFirst = baseQueue.<span class="hljs-property">next</span>;
    <span class="hljs-keyword">const</span> pendingFirst = pendingQueue.<span class="hljs-property">next</span>;
    baseQueue.<span class="hljs-property">next</span> = pendingFirst;
    pendingQueue.<span class="hljs-property">next</span> = baseFirst;
  }
  current.<span class="hljs-property">baseQueue</span> = baseQueue = pendingQueue;
  queue.<span class="hljs-property">pending</span> = <span class="hljs-literal">null</span>;
}
<span class="hljs-comment">// 2ï¼‰ä» baseState å¼€å§‹éå†ç¯å½¢é“¾è¡¨ï¼ŒæŒ‰ä¼˜å…ˆçº§ä¸ eagerState åº”ç”¨æ›´æ–°</span>
<span class="hljs-keyword">const</span> first = baseQueue.<span class="hljs-property">next</span>;
<span class="hljs-keyword">let</span> update = first;
<span class="hljs-keyword">let</span> newState = baseState;
<span class="hljs-keyword">do</span> {
  <span class="hljs-keyword">const</span> action = update.<span class="hljs-property">hasEagerState</span> ? update.<span class="hljs-property">eagerState</span> : update.<span class="hljs-property">action</span>;
  newState = <span class="hljs-title function_">reducer</span>(newState, action);
  update = update.<span class="hljs-property">next</span>;
} <span class="hljs-keyword">while</span> (update !== <span class="hljs-literal">null</span> &amp;&amp; update !== first);
hook.<span class="hljs-property">memoizedState</span> = newState;
queue.<span class="hljs-property">lastRenderedState</span> = newState;
</code></pre>
<p>è§¦å‘æ›´æ–°å®Œæ•´æºç æµç¨‹ï¼š\</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/930b0c891c914dab8a01b71f6b3c179b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF5MQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766583241&amp;x-signature=eO1%2FcfqDT%2BbJ3n0pGpnkeBShTr8%3D" alt="3-2.png" loading="lazy"/></p>
<h5 data-id="heading-30">2. åŒæ­¥æ›´æ–°ï¼ˆç‰¹æ®Šæƒ…å†µï¼‰ï¼š<code>ReactDOM.flushSync</code>ï¼ˆå½“å‰è¡Œä¸ºï¼‰</h5>
<p>å°½ç®¡ React é»˜è®¤è¿›è¡Œè‡ªåŠ¨æ‰¹é‡æ›´æ–°ï¼Œä½†åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œä½ å¯èƒ½éœ€è¦å¼ºåˆ¶åŒæ­¥å¹¶ç«‹å³åˆ·æ–° DOMï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ <code>ReactDOM.flushSync</code>ã€‚</p>
<p><code>flushSync</code> ä¼šåœ¨ä¸€ä¸ªå—æ§çš„ Batched ä¸Šä¸‹æ–‡é‡Œï¼Œæå‡å½“å‰æ›´æ–°ä¼˜å…ˆçº§ä¸º <code>DiscreteEventPriority</code>ï¼Œå¹¶åœ¨ä¸å¤„äºæ¸²æŸ“/æäº¤ä¸Šä¸‹æ–‡æ—¶ï¼Œç»Ÿä¸€åŒæ­¥ flush æ‰€æœ‰æ ¹çš„åŒæ­¥å·¥ä½œã€‚</p>
<p>ç¤ºä¾‹ï¼šä½¿ç”¨ <code>ReactDOM.flushSync</code> å¼ºåˆ¶åŒæ­¥æ›´æ–°</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { flushSync } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">flushSync</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setCount</span>(<span class="hljs-function">(<span class="hljs-params">c</span>) =&gt;</span> c + <span class="hljs-number">1</span>); <span class="hljs-comment">// ç«‹å³æ›´æ–°å¹¶åŒæ­¥æäº¤</span>
    });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Count after flushSync:"</span>, count);
  };

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
}
</code></pre>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>è‹¥åœ¨æ¸²æŸ“æˆ–æäº¤ä¸Šä¸‹æ–‡å†…è°ƒç”¨ï¼Œä¼šè¢«é˜»æ­¢å¹¶åœ¨å¼€å‘æ¨¡å¼ä¸‹ç»™å‡ºè­¦å‘Šï¼›è¯·æ”¹ä¸ºåœ¨è°ƒåº¦ä»»åŠ¡æˆ–å¾®ä»»åŠ¡ä¸­è°ƒç”¨ã€‚</li>
<li>é¢‘ç¹ä½¿ç”¨ <code>flushSync</code> ä¼šç ´åå¹¶å‘ä¸æ‰¹å¤„ç†çš„æ”¶ç›Šï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼›ä»…åœ¨ç¡®å®éœ€è¦åŒæ­¥å¯è§æ€§çš„åœºæ™¯ä½¿ç”¨ã€‚</li>
<li>å—æ§ç»„ä»¶çš„äº‹ä»¶å°¾æ¢å¤åœ¨ DOM å±‚é€šè¿‡ <code>finishEventHandler</code> è§¦å‘ï¼Œä¼šåœ¨å¿…è¦æ—¶æ‰§è¡Œä¸€æ¬¡åŒæ­¥ flush ä»¥ä¿è¯å—æ§å€¼ä¸€è‡´ã€‚</li>
</ul>
<h5 data-id="heading-31">3.ç»“è®º</h5>
<p>setState å¹¶éå›ºå®šâ€œåŒæ­¥æˆ–å¼‚æ­¥â€ï¼ŒReact é»˜è®¤è‡ªåŠ¨æ‰¹é‡ä¸å¹¶å‘ï¼Œäº‹ä»¶å†…å¤šæ¬¡æ›´æ–°ä»…å…¥é˜Ÿåˆå¹¶ï¼Œæ¸²æŸ“/æäº¤ç»Ÿä¸€åœ¨ä¹‹åè¿›è¡Œï¼ˆè¯­ä¹‰ä¸Šåå¼‚æ­¥ï¼‰ã€‚åªæœ‰åœ¨â€œéæ‰¹ä¸Šä¸‹æ–‡ä¸”ä¸ºåŒæ­¥è½¦é“â€æˆ–æ˜¾å¼è°ƒç”¨ flushSync æ—¶ï¼Œä¼šåŒæ­¥åˆ·æ–°å¹¶ç«‹å³æäº¤ï¼ˆå‘ˆç°ä¸ºåŒæ­¥ï¼‰ã€‚</p>
<h4 data-id="heading-32">3.4.5 çŠ¶æ€é¢„è®¡ç®— (Eager State Computation)</h4>
<p>åœ¨ <code>dispatchSetStateInternal</code> å‡½æ•°ä¸­ï¼ŒReact ä¼šå°è¯•è¿›è¡Œâ€œæ€¥åˆ‡çŠ¶æ€è®¡ç®—â€ä¼˜åŒ–ã€‚</p>
<ul>
<li><strong>ä¼˜åŒ–åŸç†</strong>: å¦‚æœ <code>action</code> æ˜¯ä¸€ä¸ªéå‡½æ•°å€¼ï¼Œå¹¶ä¸”å½“å‰ Hook çš„ <code>queue.lastRenderedReducer</code> æ˜¯ <code>basicStateReducer</code>ï¼ŒReact ä¼šå°è¯•ç«‹å³è®¡ç®—å‡ºæ–°çš„çŠ¶æ€ <code>eagerState</code>ã€‚</li>
<li><strong>æå‰é€€å‡º</strong>: å¦‚æœè®¡ç®—å‡ºçš„ <code>eagerState</code> ä¸ <code>queue.lastRenderedState</code> ç›¸åŒï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–é«˜ä¼˜å…ˆçº§çš„æ›´æ–°ï¼ŒReact å°±å¯ä»¥<strong>æå‰é€€å‡º</strong>ï¼Œé¿å…è°ƒåº¦ä¸€æ¬¡ä¸å¿…è¦çš„æ¸²æŸ“ã€‚è¿™å¤§å¤§å‡å°‘äº†ä¸å¿…è¦çš„è®¡ç®—å’Œæ¸²æŸ“å¼€é”€ã€‚</li>
<li><strong>æ¡ä»¶</strong>: è¿™ç§ä¼˜åŒ–åªåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶å‘ç”Ÿï¼Œä¾‹å¦‚ <code>action</code> å¿…é¡»æ˜¯å€¼è€Œä¸æ˜¯å‡½æ•°ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–å¾…å¤„ç†çš„æ›´æ–°ä¼šå½±å“æœ€ç»ˆçŠ¶æ€ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-attr">currentState</span>: S = (queue.<span class="hljs-property">lastRenderedState</span>: any);
<span class="hljs-keyword">const</span> eagerState = <span class="hljs-title function_">lastRenderedReducer</span>(currentState, action);
<span class="hljs-comment">//ã€€è¿™é‡Œçš„ `is(eagerState, currentState)` ç”¨äºæ¯”è¾ƒæ–°æ—§çŠ¶æ€æ˜¯å¦ç›¸ç­‰</span>
<span class="hljs-comment">// å¦‚æœç›¸ç­‰ï¼Œåˆ™é€šè¿‡ `return false` é˜»æ­¢åç»­çš„è°ƒåº¦ã€‚</span>
<span class="hljs-keyword">if</span> (<span class="hljs-title function_">is</span>(eagerState, currentState)) {
  <span class="hljs-title function_">enqueueConcurrentHookUpdateAndEagerlyBailout</span>(fiber, queue, update);
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// æå‰é€€å‡ºï¼Œä¸è°ƒåº¦æ–°çš„æ¸²æŸ“</span>
}
</code></pre>
<h2 data-id="heading-33">å››ã€useEffect çš„åº•å±‚å®ç°æœºåˆ¶</h2>
<p><code>useEffect</code> æ˜¯ React Hooks ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ Hookï¼Œå®ƒå…è®¸ä½ åœ¨å‡½æ•°ç»„ä»¶ä¸­æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆside effectsï¼‰ï¼Œä¾‹å¦‚æ•°æ®è·å–ã€è®¢é˜…æˆ–æ‰‹åŠ¨æ›´æ”¹ DOMã€‚ç†è§£ <code>useEffect</code> çš„åº•å±‚æœºåˆ¶å¯¹äºæ·±å…¥æŒæ¡ React çš„æ¸²æŸ“æµç¨‹å’Œæ€§èƒ½ä¼˜åŒ–è‡³å…³é‡è¦ã€‚</p>
<h3 data-id="heading-34">4.1 Effect é“¾è¡¨ç»“æ„</h3>
<p>ä¸ <code>useState</code> ç±»ä¼¼ï¼Œ<code>useEffect</code> ä¹Ÿæ˜¯é€šè¿‡é“¾è¡¨çš„å½¢å¼å­˜å‚¨åœ¨ Fiber èŠ‚ç‚¹ä¸Šçš„ã€‚æ¯ä¸ª <code>useEffect</code> Hook éƒ½ä¼šåœ¨å¯¹åº”çš„ Fiber èŠ‚ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ª <code>Effect</code> å¯¹è±¡ï¼Œè¿™äº› <code>Effect</code> å¯¹è±¡é€šè¿‡ <code>next</code> æŒ‡é’ˆè¿æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ª Effect é“¾è¡¨ã€‚è¿™ä¸ªé“¾è¡¨æœ€ç»ˆä¼šæŒ‚è½½åˆ° Fiber èŠ‚ç‚¹çš„ <code>updateQueue</code> å±æ€§ä¸Šã€‚</p>
<p>æ¯ä¸ª <code>Effect</code> å¯¹è±¡é€šå¸¸åŒ…å«ä»¥ä¸‹å…³é”®å±æ€§ï¼š</p>
<ul>
<li><strong><code>tag</code></strong>: ä¸€ä¸ªä½æ©ç ï¼Œç”¨äºæ ‡è¯† Effect çš„ç±»å‹å’Œç‰¹æ€§ï¼Œä¾‹å¦‚ <code>HookHasEffect</code>ï¼ˆè¡¨ç¤ºæœ‰å‰¯ä½œç”¨éœ€è¦æ‰§è¡Œï¼‰ã€<code>HookLayout</code>ï¼ˆå¯¹åº” <code>useLayoutEffect</code>ï¼‰ã€<code>HookPassive</code>ï¼ˆå¯¹åº” <code>useEffect</code>ï¼‰ã€‚</li>
<li><strong><code>create</code></strong>: <code>useEffect</code> å›è°ƒå‡½æ•°æœ¬èº«ï¼Œå³ä½ ä¼ å…¥ <code>useEffect</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚å®ƒä¼šåœ¨å‰¯ä½œç”¨æ‰§è¡Œæ—¶è¢«è°ƒç”¨ã€‚</li>
<li><strong><code>destroy</code></strong>: <code>create</code> å‡½æ•°çš„è¿”å›å€¼ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæ¸…ç†å‡½æ•°ã€‚å®ƒä¼šåœ¨ç»„ä»¶å¸è½½æˆ– Effect é‡æ–°æ‰§è¡Œå‰è¢«è°ƒç”¨ï¼Œç”¨äºæ¸…ç†å‰¯ä½œç”¨ï¼ˆä¾‹å¦‚å–æ¶ˆè®¢é˜…ã€æ¸…é™¤å®šæ—¶å™¨ï¼‰ã€‚</li>
<li><strong><code>deps</code></strong>: ä¾èµ–é¡¹æ•°ç»„ï¼Œå³ä½ ä¼ å…¥ <code>useEffect</code> çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚React ä¼šæ ¹æ®è¿™ä¸ªæ•°ç»„æ¥åˆ¤æ–­ Effect æ˜¯å¦éœ€è¦é‡æ–°æ‰§è¡Œã€‚</li>
<li><strong><code>next</code></strong>: æŒ‡å‘ Effect é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ª <code>Effect</code> å¯¹è±¡ã€‚</li>
</ul>
<p><strong>ç®€æ˜“ç»“æ„ç¤ºæ„</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‡è®¾ FiberNode ä¸Šæœ‰ä¸€ä¸ª updateQueue å±æ€§ï¼Œå…¶ä¸­åŒ…å« lastEffect æŒ‡é’ˆ</span>
<span class="hljs-comment">// FiberNode.updateQueue.lastEffect -&gt; Effect1 -&gt; Effect2 -&gt; Effect3 -&gt; Effect1 (å¾ªç¯é“¾è¡¨)</span>

interface <span class="hljs-title class_">Effect</span> {
  <span class="hljs-attr">tag</span>: number; <span class="hljs-comment">// HookFlagsï¼Œä¾‹å¦‚ HookPassive</span>
  <span class="hljs-attr">create</span>: <span class="hljs-function">() =&gt;</span> (<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span>) | <span class="hljs-keyword">void</span>; <span class="hljs-comment">// å‰¯ä½œç”¨å‡½æ•°</span>
  <span class="hljs-attr">destroy</span>: (<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">void</span>) | <span class="hljs-keyword">void</span>; <span class="hljs-comment">// æ¸…ç†å‡½æ•°</span>
  <span class="hljs-attr">deps</span>: <span class="hljs-title class_">Array</span>&lt;any&gt; | <span class="hljs-literal">null</span>; <span class="hljs-comment">// ä¾èµ–é¡¹æ•°ç»„</span>
  <span class="hljs-attr">next</span>: <span class="hljs-title class_">Effect</span>; <span class="hljs-comment">// æŒ‡å‘ä¸‹ä¸€ä¸ª Effect</span>
}

interface <span class="hljs-title class_">FunctionComponentUpdateQueue</span> {
  <span class="hljs-attr">lastEffect</span>: <span class="hljs-title class_">Effect</span> | <span class="hljs-literal">null</span>;
  <span class="hljs-comment">// ... å…¶ä»–å±æ€§ï¼Œå¦‚ events, stores, memoCache</span>
}

interface <span class="hljs-title class_">FiberNode</span> {
  <span class="hljs-comment">// ... å…¶ä»– Fiber å±æ€§</span>
  <span class="hljs-attr">updateQueue</span>: <span class="hljs-title class_">FunctionComponentUpdateQueue</span> | <span class="hljs-literal">null</span>;
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-35">4.2 EffectInstance ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†</h3>
<p><code>useEffect</code> çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸»è¦å›´ç»•ç€ <code>create</code> å’Œ <code>destroy</code> å‡½æ•°çš„æ‰§è¡Œæ—¶æœºã€‚React ä¼šåœ¨ä¸åŒçš„é˜¶æ®µè°ƒç”¨è¿™äº›å‡½æ•°ï¼Œä»¥ç¡®ä¿å‰¯ä½œç”¨çš„æ­£ç¡®æ‰§è¡Œå’Œæ¸…ç†ã€‚</p>
<h4 data-id="heading-36">4.2.1 æ•´ä½“æ—¶åºä¸æ‰§è¡Œç‚¹</h4>
<p>æ— è®ºæ˜¯é¦–æ¬¡æ¸²æŸ“è¿˜æ˜¯æ›´æ–°ï¼ŒReact éƒ½ä¼šéµå¾ª â€œè§¦å‘ â†’ æ¸²æŸ“ â†’ æäº¤ â†’ ç»˜åˆ¶ â†’ è¢«åŠ¨å¤„ç†â€ çš„æ ¸å¿ƒæµç¨‹ï¼Œå„é˜¶æ®µèŒè´£æ¸…æ™°ä¸”é¡ºåºå›ºå®šï¼š</p>
<ol>
<li>è§¦å‘é˜¶æ®µç”±äº‹ä»¶å¤„ç†ï¼ˆå¦‚ç‚¹å‡»ï¼‰ã€setStateã€dispatchã€startTransitionã€useEffect å¼‚æ­¥å›è°ƒç­‰è§¦å‘ï¼Œè¿›å…¥è°ƒåº¦æµç¨‹ã€‚</li>
<li>æ¸²æŸ“é˜¶æ®µï¼ˆRenderï¼‰æ„å»º/å¤ç”¨ Fiberã€diff å¾—å‡ºå®¿ä¸»å±‚å˜æ›´ä¸ Hooks çš„ Effect åˆ—è¡¨ï¼›ä¸ä¼šè§¦ç¢° DOMã€‚</li>
<li>æäº¤é˜¶æ®µï¼ˆCommitï¼‰ï¼ˆä¸å¯ä¸­æ–­ï¼Œç¡®ä¿ DOM æ“ä½œåŸå­æ€§ï¼‰
å˜æ›´å‰ï¼ˆBefore Mutationï¼‰ï¼šç„¦ç‚¹ã€è§†å›¾è¿‡æ¸¡ç­‰å‰ç½®å¤„ç†ã€‚
å˜æ›´ï¼ˆMutationï¼‰ï¼šåº”ç”¨ DOM æ’å…¥/é‡æ’/åˆ é™¤ï¼›æ‰§è¡Œ useInsertionEffect çš„æ¸…ç†ä¸å®‰è£…ï¼›æ‰§è¡Œ useLayoutEffect çš„æ¸…ç†ã€‚
å¸ƒå±€ï¼ˆLayoutï¼‰ï¼šåŒæ­¥æ‰§è¡Œç±»ç»„ä»¶ DidMount/DidUpdate ã€ ref ç»‘å®šã€ä»¥åŠ useLayoutEffect çš„å®‰è£…ï¼ˆeffect æœ¬ä½“ï¼‰ã€‚</li>
<li>ç»˜åˆ¶é˜¶æ®µï¼ˆPaintï¼‰ï¼šæµè§ˆå™¨å°†ä¸Šè¿°ç»“æœç»˜åˆ¶åˆ°å±å¹•ã€‚</li>
<li>è¢«åŠ¨é˜¶æ®µï¼ˆPassiveï¼‰å®Œæˆå¯è§ç»˜åˆ¶åï¼Œåœ¨ä¸€ä¸ªç‹¬ç«‹å®ä»»åŠ¡ä¸­â€œå†²æ´—â€ useEffect ï¼ˆå³ HookPassive ï¼‰çš„æ¸…ç†ä¸å®‰è£…ï¼Œé¿å…é˜»å¡æäº¤ä¸å¸ƒå±€ã€‚</li>
</ol>
<p>commitHookEffectListUnmount / commitHookEffectListMount ä¸“é—¨å¤„ç† useEffect çš„å‰¯ä½œç”¨ï¼ˆHookPassive ç±»å‹ï¼‰ï¼Œæ‰§è¡Œæ—¶æœºå®Œå…¨è½åœ¨ â€œè¢«åŠ¨é˜¶æ®µâ€ï¼Œè°ƒç”¨é“¾å’Œä½œç”¨å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>commitHookEffectListUnmountï¼ˆuseEffect çš„æ¸…ç†å‡½æ•°æ‰§è¡Œï¼‰
æ‰§è¡Œé˜¶æ®µï¼šè¢«åŠ¨é˜¶æ®µï¼ˆæµè§ˆå™¨ç»˜åˆ¶ä¹‹åï¼Œå¼‚æ­¥æ‰§è¡Œï¼‰ã€‚
æ ¸å¿ƒä½œç”¨ï¼šéå†æ ‡è®°ä¸º HookPassive ä¸” HookHasEffect çš„ Effect é“¾è¡¨ï¼Œæ‰§è¡Œ effect.destroy æ¸…ç†å‡½æ•°ï¼ˆå¦‚ç§»é™¤äº‹ä»¶ç›‘å¬ã€æ¸…é™¤å®šæ—¶å™¨ï¼‰ã€‚</p>
</li>
<li>
<p>commitHookEffectListMount
æ‰§è¡Œé˜¶æ®µï¼šè¢«åŠ¨é˜¶æ®µï¼ˆcommitHookEffectListUnmount ä¹‹åï¼Œä»åœ¨åŒä¸€å®ä»»åŠ¡ä¸­ï¼‰ã€‚
æ ¸å¿ƒä½œç”¨ï¼šéå†ç›¸åŒæ ‡è®°çš„ Effect é“¾è¡¨ï¼Œæ‰§è¡Œ effect.create å›è°ƒå‡½æ•°ï¼ˆå¦‚å‘èµ·ç½‘ç»œè¯·æ±‚ã€è®¢é˜…äº‹ä»¶ï¼‰ï¼Œå¹¶å°†å›è°ƒè¿”å›çš„æ¸…ç†å‡½æ•°å­˜å…¥ effect.destroyï¼Œä¾›ä¸‹ä¸€æ¬¡æ¸…ç†ä½¿ç”¨ã€‚</p>
</li>
</ol>
<blockquote>
<p>useLayoutEffect ä¸ useEffect ä¸åŒçš„åœ°æ–¹å°±æ˜¯ useLayoutEffect æ¸…ç†åœ¨å˜æ›´ï¼ˆMutationï¼‰é˜¶æ®µï¼Œå®‰è£…åœ¨å¸ƒå±€ï¼ˆLayoutï¼‰é˜¶æ®µï¼ŒåŒæ­¥å‘ç”Ÿã€ç»˜åˆ¶å‰æ‰§è¡Œï¼Œé€‚åˆåŒæ­¥è¯»/å†™å¸ƒå±€ï¼ˆæµ‹é‡å°ºå¯¸ã€ç›´æ¥æ“ä½œ DOMï¼‰ã€‚</p>
</blockquote>
<h4 data-id="heading-37">4.2.2 æŒ‚è½½é˜¶æ®µ (Mount Phase)</h4>
<p>å½“ç»„ä»¶é¦–æ¬¡æ¸²æŸ“å¹¶æŒ‚è½½åˆ° DOM åï¼ŒReact ä¼šæ‰§è¡Œ <code>useEffect</code> çš„ <code>create</code> å‡½æ•°ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸»è¦ç”± <code>commitHookEffectListMount</code> å‡½æ•°è´Ÿè´£ã€‚</p>
<p><strong><code>commitHookEffectListMount</code> æ ¸å¿ƒé€»è¾‘</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç®€åŒ–åçš„ commitHookEffectListMount ç¤ºä¾‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">commitHookEffectListMount</span>(<span class="hljs-params">flags, finishedWork</span>) {
  <span class="hljs-keyword">const</span> updateQueue = finishedWork.<span class="hljs-property">updateQueue</span>;
  <span class="hljs-keyword">const</span> lastEffect = updateQueue !== <span class="hljs-literal">null</span> ? updateQueue.<span class="hljs-property">lastEffect</span> : <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">if</span> (lastEffect !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">const</span> firstEffect = lastEffect.<span class="hljs-property">next</span>;
    <span class="hljs-keyword">let</span> effect = firstEffect;
    <span class="hljs-keyword">do</span> {
      <span class="hljs-comment">// æ£€æŸ¥ Effect çš„ tag æ˜¯å¦åŒ…å«æŒ‡å®šçš„ flags (ä¾‹å¦‚ HookPassive)</span>
      <span class="hljs-keyword">if</span> ((effect.<span class="hljs-property">tag</span> &amp; flags) === flags) {
        <span class="hljs-keyword">const</span> create = effect.<span class="hljs-property">create</span>;
        <span class="hljs-comment">// æ‰§è¡Œ create å‡½æ•°ï¼Œå¹¶å°†å…¶è¿”å›å€¼ï¼ˆæ¸…ç†å‡½æ•°ï¼‰å­˜å‚¨åˆ° effect.destroy ä¸Š</span>
        effect.<span class="hljs-property">destroy</span> = <span class="hljs-title function_">create</span>();
      }
      effect = effect.<span class="hljs-property">next</span>;
    } <span class="hljs-keyword">while</span> (effect !== firstEffect);
  }
}
</code></pre>
<ul>
<li><code>commitHookEffectListMount</code> ä¼šéå† Fiber èŠ‚ç‚¹ä¸Šçš„ Effect é“¾è¡¨ã€‚</li>
<li>å¯¹äºç¬¦åˆæ¡ä»¶çš„ Effectï¼ˆä¾‹å¦‚ <code>useEffect</code> å¯¹åº”çš„ <code>HookPassive</code> ç±»å‹çš„ Effectï¼‰ï¼Œå®ƒä¼šè°ƒç”¨ <code>effect.create()</code> å‡½æ•°ã€‚</li>
<li><code>create</code> å‡½æ•°çš„è¿”å›å€¼ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¼šè¢«ä¿å­˜åˆ° <code>effect.destroy</code> å±æ€§ä¸Šï¼Œä½œä¸ºåç»­æ¸…ç†çš„ä¾æ®ã€‚</li>
</ul>
<h4 data-id="heading-38">4.2.3 å¸è½½é˜¶æ®µ (Unmount Phase)</h4>
<p>å½“ç»„ä»¶ä» DOM ä¸­å¸è½½æ—¶ï¼ŒReact ä¼šæ‰§è¡Œ <code>useEffect</code> çš„ <code>destroy</code> å‡½æ•°ï¼Œä»¥æ¸…ç†ä¹‹å‰åˆ›å»ºçš„å‰¯ä½œç”¨ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸»è¦ç”± <code>commitHookEffectListUnmount</code> å‡½æ•°è´Ÿè´£ã€‚</p>
<p><strong><code>commitHookEffectListUnmount</code> æ ¸å¿ƒé€»è¾‘</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç®€åŒ–åçš„ commitHookEffectListUnmount ç¤ºä¾‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">commitHookEffectListUnmount</span>(<span class="hljs-params">flags, finishedWork</span>) {
  <span class="hljs-keyword">const</span> updateQueue = finishedWork.<span class="hljs-property">updateQueue</span>;
  <span class="hljs-keyword">const</span> lastEffect = updateQueue !== <span class="hljs-literal">null</span> ? updateQueue.<span class="hljs-property">lastEffect</span> : <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">if</span> (lastEffect !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">const</span> firstEffect = lastEffect.<span class="hljs-property">next</span>;
    <span class="hljs-keyword">let</span> effect = firstEffect;
    <span class="hljs-keyword">do</span> {
      <span class="hljs-comment">// æ£€æŸ¥ Effect çš„ tag æ˜¯å¦åŒ…å«æŒ‡å®šçš„ flags</span>
      <span class="hljs-keyword">if</span> ((effect.<span class="hljs-property">tag</span> &amp; flags) === flags) {
        <span class="hljs-keyword">const</span> destroy = effect.<span class="hljs-property">destroy</span>;
        <span class="hljs-comment">// å¦‚æœå­˜åœ¨æ¸…ç†å‡½æ•°ï¼Œåˆ™æ‰§è¡Œå®ƒ</span>
        <span class="hljs-keyword">if</span> (destroy !== <span class="hljs-literal">undefined</span> &amp;&amp; destroy !== <span class="hljs-literal">null</span>) {
          <span class="hljs-title function_">destroy</span>();
        }
      }
      effect = effect.<span class="hljs-property">next</span>;
    } <span class="hljs-keyword">while</span> (effect !== firstEffect);
  }
}
</code></pre>
<ul>
<li><code>commitHookEffectListUnmount</code> åŒæ ·ä¼šéå† Effect é“¾è¡¨ã€‚</li>
<li>å¯¹äºç¬¦åˆæ¡ä»¶çš„ Effectï¼Œå®ƒä¼šæ£€æŸ¥ <code>effect.destroy</code> æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ‰§è¡Œè¯¥æ¸…ç†å‡½æ•°ã€‚</li>
</ul>
<h4 data-id="heading-39">4.2.4 æ›´æ–°é˜¶æ®µ (Update Phase) ä¸å»¶è¿Ÿæ‰§è¡Œ</h4>
<p>åœ¨ç»„ä»¶æ›´æ–°æ—¶ï¼Œå¦‚æœ <code>useEffect</code> çš„ä¾èµ–é¡¹å‘ç”Ÿäº†å˜åŒ–ï¼ŒReact ä¼šå…ˆæ‰§è¡Œä¸Šä¸€æ¬¡ Effect çš„ <code>destroy</code> å‡½æ•°ï¼Œç„¶åå†æ‰§è¡Œæ–°çš„ <code>create</code> å‡½æ•°ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>useEffect</code>ï¼ˆå³ <code>HookPassive</code> ç±»å‹çš„ Effectï¼‰çš„ <code>create</code> å’Œ <code>destroy</code> å‡½æ•°çš„æ‰§è¡Œæ˜¯<strong>å»¶è¿Ÿçš„</strong>ï¼Œå®ƒä»¬ä¸ä¼šåœ¨åŒæ­¥çš„ commit é˜¶æ®µç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯ä¼šåœ¨æµè§ˆå™¨å®Œæˆç»˜åˆ¶ä¹‹åï¼Œåœ¨ä¸€ä¸ªå•ç‹¬çš„å¼‚æ­¥ä»»åŠ¡ä¸­æ‰§è¡Œã€‚è¿™ä¸ªå»¶è¿Ÿæ‰§è¡Œçš„æœºåˆ¶ä¸»è¦ç”± <code>flushPassiveEffects</code> å‡½æ•°åŠå…¶ç›¸å…³çš„è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰è´Ÿè´£ã€‚</p>
<p><strong><code>flushPassiveEffects</code> çš„ä½œç”¨</strong>ï¼š</p>
<ul>
<li><code>flushPassiveEffects</code> æ˜¯ä¸€ä¸ªåœ¨ commit é˜¶æ®µä¹‹åè¢«è°ƒç”¨çš„å‡½æ•°ï¼Œå®ƒè´Ÿè´£æ”¶é›†æ‰€æœ‰å¾…æ‰§è¡Œçš„ <code>HookPassive</code> ç±»å‹çš„ Effectã€‚</li>
<li>å®ƒä¼šå°†è¿™äº› Effect è°ƒåº¦åˆ°ä¸€ä¸ªä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¸­ï¼Œç­‰å¾…æµè§ˆå™¨ç©ºé—²æ—¶æ‰§è¡Œã€‚</li>
<li>è¿™ç§å»¶è¿Ÿæ‰§è¡Œçš„ç­–ç•¥å¯ä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œæé«˜ç”¨æˆ·ä½“éªŒï¼Œç¡®ä¿åŠ¨ç”»å’Œç”¨æˆ·äº¤äº’çš„æµç•…æ€§ã€‚</li>
</ul>
<h3 data-id="heading-40">4.3 ä¾èµ–æ¯”è¾ƒä¸å‰¯ä½œç”¨è°ƒåº¦</h3>
<p><code>useEffect</code> çš„æ ¸å¿ƒåœ¨äºå®ƒèƒ½å¤Ÿæ ¹æ®ä¾èµ–é¡¹çš„å˜åŒ–æ¥å†³å®šæ˜¯å¦é‡æ–°æ‰§è¡Œå‰¯ä½œç”¨ã€‚è¿™å°±åƒç»™ React è£…ä¸Šäº†ä¸€åŒâ€œç«çœ¼é‡‘ç›â€ï¼Œèƒ½å¤Ÿç²¾å‡†åœ°è¯†åˆ«å‡ºå“ªäº›â€œä»»åŠ¡â€éœ€è¦é‡æ–°æ‰§è¡Œï¼Œå“ªäº›å¯ä»¥â€œå·æ‡’â€è·³è¿‡ã€‚è€Œå‰¯ä½œç”¨çš„è°ƒåº¦ï¼Œåˆ™åƒä¸€ä½â€œå¹•åè‹±é›„â€ï¼Œé»˜é»˜åœ°åœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œè¿™äº›ä»»åŠ¡ï¼Œç¡®ä¿åº”ç”¨çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚</p>
<h4 data-id="heading-41">4.3.1 ä¾èµ–é¡¹æ¯”è¾ƒ</h4>
<p>åœ¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œ<code>useEffect</code> éƒ½ä¼šæ‹¿åˆ°æ–°çš„ä¾èµ–é¡¹æ•°ç»„ <code>nextDeps</code>ï¼Œå¹¶ä¸ä¸Šä¸€æ¬¡æ¸²æŸ“çš„ä¾èµ–é¡¹æ•°ç»„ <code>prevDeps</code> è¿›è¡Œæ¯”è¾ƒã€‚è¿™ä¸ªæ¯”è¾ƒå·¥ä½œä¸»è¦ç”± <code>areHookInputsEqual</code> å‡½æ•°å®Œæˆã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">areHookInputsEqual</span>(<span class="hljs-params">
  nextDeps: <span class="hljs-built_in">Array</span>&lt;mixed&gt;,
  prevDeps: <span class="hljs-built_in">Array</span>&lt;mixed&gt; | <span class="hljs-literal">null</span>
</span>): boolean {
  <span class="hljs-keyword">if</span> (prevDeps === <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// é¦–æ¬¡æ¸²æŸ“æˆ–ä¾èµ–é¡¹ä»æ— åˆ°æœ‰ï¼Œæ€»æ˜¯è¿”å› falseï¼Œæ„å‘³ç€å‰¯ä½œç”¨æ€»æ˜¯ä¼šæ‰§è¡Œã€‚</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// æ ¸å¿ƒæ¯”è¾ƒé€»è¾‘ï¼šéå†ä¾èµ–æ•°ç»„ï¼Œä½¿ç”¨ Object.is è¿›è¡Œæµ…æ¯”è¾ƒ</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; prevDeps.<span class="hljs-property">length</span> &amp;&amp; i &lt; nextDeps.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">is</span>(nextDeps[i], prevDeps[i])) {
      <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// å¦‚æœå½“å‰ä¾èµ–é¡¹ç›¸åŒï¼Œåˆ™ç»§ç»­æ¯”è¾ƒä¸‹ä¸€ä¸ª</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// å‘ç°ä¸åŒï¼Œç«‹å³è¿”å› false</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// æ‰€æœ‰ä¾èµ–é¡¹éƒ½ç›¸åŒï¼Œè¿”å› true</span>
}
</code></pre>
<h5 data-id="heading-42">4.3.2 å‰¯ä½œç”¨çš„è°ƒåº¦</h5>
<p>å½“ç»„ä»¶é¦–æ¬¡æŒ‚è½½æ—¶ï¼Œ<code>mountEffectImpl</code> å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚å®ƒçš„ä¸»è¦èŒè´£æ˜¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">mountEffectImpl</span>(<span class="hljs-params">
  fiberFlags: Flags,
  hookFlags: HookFlags,
  create: () =&gt; (() =&gt; <span class="hljs-keyword">void</span>) | <span class="hljs-keyword">void</span>, <span class="hljs-comment">// å‰¯ä½œç”¨å‡½æ•°</span>
  createDeps: <span class="hljs-built_in">Array</span>&lt;mixed&gt; | <span class="hljs-keyword">void</span> | <span class="hljs-literal">null</span> <span class="hljs-comment">// ä¾èµ–é¡¹</span>
  <span class="hljs-comment">// ... å…¶ä»–å‚æ•°</span>
</span>): <span class="hljs-keyword">void</span> {
  <span class="hljs-keyword">const</span> hook = <span class="hljs-title function_">mountWorkInProgressHook</span>(); <span class="hljs-comment">// åˆ›å»ºæ–°çš„ Hook èŠ‚ç‚¹</span>
  <span class="hljs-keyword">const</span> nextDeps = createDeps === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">null</span> : createDeps;
  currentlyRenderingFiber.<span class="hljs-property">flags</span> |= fiberFlags; <span class="hljs-comment">// æ ‡è®° Fiber èŠ‚ç‚¹éœ€è¦æ‰§è¡Œå‰¯ä½œç”¨</span>
  hook.<span class="hljs-property">memoizedState</span> = <span class="hljs-title function_">pushSimpleEffect</span>(
    <span class="hljs-comment">// å°†å‰¯ä½œç”¨ä¿¡æ¯å­˜å‚¨åˆ° Hook èŠ‚ç‚¹çš„ memoizedState ä¸­</span>
    <span class="hljs-title class_">HookHasEffect</span> | hookFlags,
    <span class="hljs-title function_">createEffectInstance</span>(),
    create,
    nextDeps
  );
}
</code></pre>
<ul>
<li><strong>åˆ›å»º Hook èŠ‚ç‚¹</strong>ï¼š<code>mountWorkInProgressHook()</code> ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Hook èŠ‚ç‚¹ï¼Œç”¨äºå­˜å‚¨ <code>useEffect</code> çš„ç›¸å…³ä¿¡æ¯ã€‚</li>
<li><strong>æ ‡è®° Fiber èŠ‚ç‚¹</strong>ï¼š<code>currentlyRenderingFiber.flags |= fiberFlags;</code> ä¼šç»™å½“å‰çš„ Fiber èŠ‚ç‚¹æ‰“ä¸Šä¸€ä¸ª <code>fiberFlags</code> æ ‡è®°ï¼ˆä¾‹å¦‚ <code>PassiveEffect</code>ï¼‰ï¼Œè¿™ä¸ªæ ‡è®°å‘Šè¯‰ React åœ¨æäº¤é˜¶æ®µéœ€è¦å¤„ç†è¿™ä¸ªå‰¯ä½œç”¨ã€‚</li>
<li><strong>å­˜å‚¨å‰¯ä½œç”¨ä¿¡æ¯</strong>ï¼š<code>pushSimpleEffect</code> ä¼šå°†å‰¯ä½œç”¨å‡½æ•° <code>create</code>ã€ä¾èµ–é¡¹ <code>nextDeps</code> ä»¥åŠå…¶ä»–ç›¸å…³ä¿¡æ¯å°è£…æˆä¸€ä¸ª Effect å¯¹è±¡ï¼Œå­˜å‚¨å† fiber çš„ updateQueue ä¸­ï¼Œå¹¶è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œåå†å­˜å‚¨åœ¨ Hook èŠ‚ç‚¹çš„ <code>memoizedState</code> ä¸­ã€‚</li>
</ul>
<h6 data-id="heading-43">4.3.2.2 æ›´æ–°é˜¶æ®µ</h6>
<p>å½“ç»„ä»¶æ›´æ–°æ—¶ï¼Œ<code>updateEffectImpl</code> å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚è¿™æ˜¯ <code>useEffect</code> ä¾èµ–é¡¹æ¯”è¾ƒå’Œå‰¯ä½œç”¨è°ƒåº¦æœ€å…³é”®çš„åœ°æ–¹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateEffectImpl</span>(<span class="hljs-params">
  fiberFlags: Flags,
  hookFlags: HookFlags,
  create: () =&gt; (() =&gt; <span class="hljs-keyword">void</span>) | <span class="hljs-keyword">void</span>, <span class="hljs-comment">// å‰¯ä½œç”¨å‡½æ•°</span>
  deps: <span class="hljs-built_in">Array</span>&lt;mixed&gt; | <span class="hljs-keyword">void</span> | <span class="hljs-literal">null</span> <span class="hljs-comment">// ä¾èµ–é¡¹</span>
</span>): <span class="hljs-keyword">void</span> {
  <span class="hljs-keyword">const</span> hook = <span class="hljs-title function_">updateWorkInProgressHook</span>(); <span class="hljs-comment">// è·å–å½“å‰ Hook èŠ‚ç‚¹</span>
  <span class="hljs-keyword">const</span> nextDeps = deps === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">null</span> : deps;
  <span class="hljs-keyword">const</span> <span class="hljs-attr">effect</span>: <span class="hljs-title class_">Effect</span> = hook.<span class="hljs-property">memoizedState</span>; <span class="hljs-comment">// è·å–ä¸Šä¸€æ¬¡æ¸²æŸ“çš„å‰¯ä½œç”¨ä¿¡æ¯</span>
  <span class="hljs-keyword">const</span> inst = effect.<span class="hljs-property">inst</span>;

  <span class="hljs-keyword">if</span> (currentHook !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">if</span> (nextDeps !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">const</span> <span class="hljs-attr">prevEffect</span>: <span class="hljs-title class_">Effect</span> = currentHook.<span class="hljs-property">memoizedState</span>;
      <span class="hljs-keyword">const</span> prevDeps = prevEffect.<span class="hljs-property">deps</span>;
      <span class="hljs-comment">// æ ¸å¿ƒï¼šè°ƒç”¨ areHookInputsEqual æ¯”è¾ƒä¾èµ–é¡¹</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">areHookInputsEqual</span>(nextDeps, prevDeps)) {
        <span class="hljs-comment">// å¦‚æœä¾èµ–é¡¹æ²¡æœ‰å˜åŒ–ï¼Œåˆ™è·³è¿‡å‰¯ä½œç”¨çš„é‡æ–°æ‰§è¡Œ</span>
        hook.<span class="hljs-property">memoizedState</span> = <span class="hljs-title function_">pushSimpleEffect</span>(
          hookFlags,
          inst,
          create,
          nextDeps
        );
        <span class="hljs-keyword">return</span>; <span class="hljs-comment">// ç›´æ¥è¿”å›ï¼Œä¸è®¾ç½® Fiber èŠ‚ç‚¹çš„ flags</span>
      }
    }
  }

  <span class="hljs-comment">// å¦‚æœä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€… prevDeps ä¸º null (ä¸åº”è¯¥å‘ç”Ÿåœ¨è¿™é‡Œï¼Œå› ä¸ºæ˜¯æ›´æ–°é˜¶æ®µ)</span>
  <span class="hljs-comment">// åˆ™æ ‡è®° Fiber èŠ‚ç‚¹éœ€è¦æ‰§è¡Œå‰¯ä½œç”¨</span>
  currentlyRenderingFiber.<span class="hljs-property">flags</span> |= fiberFlags;

  hook.<span class="hljs-property">memoizedState</span> = <span class="hljs-title function_">pushSimpleEffect</span>(
    <span class="hljs-title class_">HookHasEffect</span> | hookFlags,
    inst,
    create,
    nextDeps
  );
}
</code></pre>
<h5 data-id="heading-44">4.3.3 å‰¯ä½œç”¨çš„è°ƒåº¦æ—¶æœº</h5>
<p><code>useEffect</code> çš„å‰¯ä½œç”¨ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰æ˜¯åœ¨æµè§ˆå™¨å®Œæˆç»˜åˆ¶ä¹‹åå¼‚æ­¥æ‰§è¡Œçš„ã€‚è¿™é€šè¿‡ <code>PassiveEffect</code> æ ‡å¿—ä½æ¥å®ç°ã€‚</p>
<ul>
<li>å½“ <code>useEffect</code> çš„ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>updateEffectImpl</code> ä¼šç»™å½“å‰çš„ Fiber èŠ‚ç‚¹æ‰“ä¸Š <code>PassiveEffect</code> æ ‡è®°ã€‚</li>
<li>åœ¨ React çš„æäº¤é˜¶æ®µï¼Œå®ƒä¼šéå†æ‰€æœ‰å¸¦æœ‰ <code>PassiveEffect</code> æ ‡è®°çš„ Fiber èŠ‚ç‚¹ï¼Œå¹¶æ‰§è¡Œå®ƒä»¬å¯¹åº”çš„å‰¯ä½œç”¨å‡½æ•°ã€‚</li>
<li>ç”±äºè¿™äº›å‰¯ä½œç”¨æ˜¯åœ¨æµè§ˆå™¨ç»˜åˆ¶ä¹‹åæ‰§è¡Œçš„ï¼Œå®ƒä»¬ä¸ä¼šé˜»å¡ç”¨æˆ·ç•Œé¢çš„æ¸²æŸ“ï¼Œä»è€Œä¿è¯äº†åº”ç”¨çš„å“åº”æ€§ã€‚</li>
</ul>
<h2 data-id="heading-45">äº” ä¸€äº›å®è·µä¼˜åŒ–å»ºè®®</h2>
<p>é€šè¿‡å¯¹ <code>useState</code> å’Œ <code>useEffect</code> åº•å±‚æºç çš„æ·±å…¥å‰–æï¼Œæˆ‘ä»¬å¯ä»¥æç‚¼å‡ºä¸€äº›æŒ‡å¯¼æˆ‘ä»¬æ—¥å¸¸å¼€å‘çš„æœ€ä½³å®è·µã€‚è¿™äº›å®è·µå¹¶éç©ºç©´æ¥é£ï¼Œè€Œæ˜¯åŸºäº React å†…éƒ¨æœºåˆ¶çš„ä¼˜åŒ–è€ƒé‡ã€‚</p>
<h4 data-id="heading-46">5.1 <code>useState</code></h4>
<ol>
<li>
<p><strong>æ‡’åˆå§‹åŒ–ï¼ˆLazy Initializationï¼‰</strong>ï¼š</p>
<ul>
<li><strong>æºç </strong>ï¼šåœ¨ <code>mountStateImpl</code> ä¸­ï¼Œå¦‚æœ <code>useState</code> çš„åˆå§‹å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ŒReact åªä¼šåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œå®ƒä¸€æ¬¡ã€‚</li>
<li><strong>å®è·µå»ºè®®</strong>ï¼šå½“åˆå§‹çŠ¶æ€çš„è®¡ç®—æˆæœ¬è¾ƒé«˜ï¼ˆä¾‹å¦‚éœ€è¦è¿›è¡Œå¤§é‡è®¡ç®—æˆ–æ•°æ®è½¬æ¢ï¼‰æ—¶ï¼Œåº”ä¼ å…¥ä¸€ä¸ªå‡½æ•°ä½œä¸º <code>useState</code> çš„åˆå§‹å€¼ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ å…¥è®¡ç®—ç»“æœã€‚è¿™å¯ä»¥é¿å…åœ¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶éƒ½æ‰§è¡Œä¸å¿…è¦çš„è®¡ç®—ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é¿å…ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½æ‰§è¡Œ expensiveCalculation</span>
<span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-title function_">expensiveCalculation</span>());

<span class="hljs-comment">// æ¨èï¼šåªåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œ expensiveCalculation</span>
<span class="hljs-keyword">const</span> [data, setData] = <span class="hljs-title function_">useState</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">expensiveCalculation</span>());
</code></pre>
</li>
<li>
<p><strong>çŠ¶æ€çš„ä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰</strong>ï¼š</p>
<ul>
<li><strong>æºç </strong>ï¼š<code>updateReducer</code> åœ¨å¤„ç†æ›´æ–°æ—¶ï¼Œä¼šæ¯”è¾ƒæ–°æ—§çŠ¶æ€æ˜¯å¦ä¸¥æ ¼ç›¸ç­‰ï¼ˆ<code>Object.is</code>ï¼‰ã€‚å¦‚æœç›¸ç­‰ï¼ŒReact ä¼šè·³è¿‡åç»­çš„æ¸²æŸ“ã€‚</li>
<li><strong>å®è·µå»ºè®®</strong>ï¼šæ°¸è¿œä¸è¦ç›´æ¥ä¿®æ”¹çŠ¶æ€å¯¹è±¡æˆ–æ•°ç»„ã€‚å½“ä½ éœ€è¦æ›´æ–°å¯¹è±¡æˆ–æ•°ç»„çŠ¶æ€æ—¶ï¼Œåº”è¯¥åˆ›å»ºæ–°çš„å¯¹è±¡æˆ–æ•°ç»„ï¼Œå¹¶ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼ã€‚è¿™èƒ½ç¡®ä¿ React æ­£ç¡®æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–ï¼Œå¹¶è§¦å‘å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é¿å…ï¼šç›´æ¥ä¿®æ”¹å¯¹è±¡</span>
<span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> });
user.<span class="hljs-property">age</span> = <span class="hljs-number">31</span>; <span class="hljs-comment">// âŒ React å¯èƒ½ä¸ä¼šé‡æ–°æ¸²æŸ“</span>

<span class="hljs-comment">// æ¨èï¼šåˆ›å»ºæ–°å¯¹è±¡</span>
<span class="hljs-title function_">setUser</span>(<span class="hljs-function">(<span class="hljs-params">prevUser</span>) =&gt;</span> ({ ...prevUser, <span class="hljs-attr">age</span>: <span class="hljs-number">31</span> })); <span class="hljs-comment">// âœ…</span>
</code></pre>
</li>
<li>
<p><strong>æ‰¹é‡æ›´æ–°ï¼ˆBatching Updatesï¼‰</strong>ï¼š</p>
<ul>
<li><strong>æºç </strong>ï¼šReact å†…éƒ¨ä¼šæ‰¹é‡å¤„ç†åœ¨åŒä¸€äº‹ä»¶å¾ªç¯ä¸­è§¦å‘çš„å¤šä¸ª <code>setState</code> è°ƒç”¨ï¼Œä»¥å‡å°‘ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“æ¬¡æ•°ã€‚</li>
<li><strong>å®è·µå»ºè®®</strong>ï¼šåœ¨äº‹ä»¶å¤„ç†å‡½æ•°æˆ–å¼‚æ­¥æ“ä½œä¸­ï¼Œå³ä½¿å¤šæ¬¡è°ƒç”¨ <code>setState</code>ï¼Œé€šå¸¸ä¹Ÿåªä¼šè§¦å‘ä¸€æ¬¡é‡æ–°æ¸²æŸ“ã€‚äº†è§£è¿™ä¸€ç‚¹å¯ä»¥å¸®åŠ©ä½ é¿å…è¿‡åº¦ä¼˜åŒ–ï¼Œå¹¶ç›¸ä¿¡ React çš„æ€§èƒ½æœºåˆ¶ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-47">5.2 <code>useEffect</code></h4>
<ol>
<li>
<p><strong>ç²¾ç¡®çš„ä¾èµ–é¡¹ï¼ˆPrecise Dependenciesï¼‰</strong>ï¼š</p>
<ul>
<li><strong>æºç </strong>ï¼š<code>areHookInputsEqual</code> å‡½æ•°é€šè¿‡æµ…æ¯”è¾ƒï¼ˆ<code>Object.is</code>ï¼‰æ¥åˆ¤æ–­ä¾èµ–é¡¹æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚</li>
<li><strong>å®è·µå»ºè®®</strong>ï¼š
<ul>
<li><strong>ä¸è¦é—æ¼ä¾èµ–é¡¹</strong>ï¼šç¡®ä¿ <code>useEffect</code> çš„ä¾èµ–æ•°ç»„åŒ…å«äº†æ‰€æœ‰åœ¨å‰¯ä½œç”¨å‡½æ•°å†…éƒ¨ä½¿ç”¨çš„ã€ä¸”åœ¨ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿå˜åŒ–çš„å€¼ï¼ˆpropsã€stateã€å‡½æ•°ç­‰ï¼‰ã€‚é—æ¼ä¾èµ–é¡¹ä¼šå¯¼è‡´å‰¯ä½œç”¨åœ¨åº”è¯¥é‡æ–°æ‰§è¡Œæ—¶å´ä¸æ‰§è¡Œï¼Œä»è€Œå¼•å…¥ bugã€‚</li>
<li><strong>é¿å…ä¸å¿…è¦çš„ä¾èµ–é¡¹</strong>ï¼šå¦‚æœæŸä¸ªå€¼åœ¨å‰¯ä½œç”¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ï¼Œä½†å®ƒåœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä¸ä¼šæ”¹å˜ï¼ˆä¾‹å¦‚å¸¸é‡ã€å¤–éƒ¨å‡½æ•°ï¼‰ï¼Œåˆ™å¯ä»¥å°†å…¶ä»ä¾èµ–æ•°ç»„ä¸­ç§»é™¤ï¼Œæˆ–è€…ä½¿ç”¨ <code>useCallback</code>/<code>useMemo</code> è¿›è¡Œè®°å¿†åŒ–ï¼Œä»¥é¿å…ä¸å¿…è¦çš„å‰¯ä½œç”¨é‡æ–°æ‰§è¡Œã€‚</li>
<li><strong>å¯¹è±¡å’Œæ•°ç»„çš„å¼•ç”¨é—®é¢˜</strong>ï¼šç”±äº <code>areHookInputsEqual</code> è¿›è¡Œçš„æ˜¯æµ…æ¯”è¾ƒï¼Œå¦‚æœä¾èµ–é¡¹ä¸­åŒ…å«å¯¹è±¡æˆ–æ•°ç»„ï¼Œå³ä½¿å…¶å†…éƒ¨å±æ€§å‘ç”Ÿå˜åŒ–ï¼Œåªè¦å¼•ç”¨ä¸å˜ï¼Œ<code>useEffect</code> å°±ä¸ä¼šé‡æ–°æ‰§è¡Œã€‚æ­¤æ—¶ï¼Œä½ éœ€è¦ç¡®ä¿æ¯æ¬¡æ›´æ–°éƒ½ç”Ÿæˆæ–°çš„å¯¹è±¡/æ•°ç»„å¼•ç”¨ï¼Œæˆ–è€…ä½¿ç”¨ <code>useMemo</code> æ¥è®°å¿†åŒ–è¿™äº›å¯¹è±¡/æ•°ç»„ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>æ°å½“çš„æ¸…ç†å‡½æ•°ï¼ˆProper Cleanupï¼‰</strong>ï¼š</p>
<ul>
<li><strong>æºç </strong>ï¼š<code>useEffect</code> çš„å‰¯ä½œç”¨å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½æˆ–å‰¯ä½œç”¨é‡æ–°æ‰§è¡Œå‰è¢«è°ƒç”¨ã€‚</li>
<li><strong>å®è·µå»ºè®®</strong>ï¼šå¯¹äºä»»ä½•éœ€è¦è®¢é˜…ã€å®šæ—¶å™¨ã€ç½‘ç»œè¯·æ±‚ç­‰å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼æˆ–èµ„æºå ç”¨çš„å‰¯ä½œç”¨ï¼ŒåŠ¡å¿…æä¾›ä¸€ä¸ªæ¸…ç†å‡½æ•°ã€‚è¿™èƒ½ç¡®ä¿åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç»“æŸæˆ–å‰¯ä½œç”¨é‡æ–°æ‰§è¡Œæ—¶ï¼ŒåŠæ—¶é‡Šæ”¾èµ„æºï¼Œé¿å…ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€å’Œ bugã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Tick"</span>);
  }, <span class="hljs-number">1000</span>);

  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-built_in">clearInterval</span>(timer); <span class="hljs-comment">// æ¸…ç†å®šæ—¶å™¨</span>
  };
}, []);
</code></pre>
</li>
<li>
<p><strong>ç†è§£æ‰§è¡Œæ—¶æœºï¼ˆUnderstanding Execution Timingï¼‰</strong>ï¼š</p>
<ul>
<li><strong>æºç </strong>ï¼š<code>PassiveEffect</code> æ ‡å¿—ä½å†³å®šäº† <code>useEffect</code> çš„å‰¯ä½œç”¨æ˜¯åœ¨æµè§ˆå™¨ç»˜åˆ¶ä¹‹åå¼‚æ­¥æ‰§è¡Œçš„ã€‚</li>
<li><strong>å®è·µå»ºè®®</strong>ï¼š<code>useEffect</code> é€‚ç”¨äºé‚£äº›ä¸å½±å“ DOM å¸ƒå±€æˆ–æ¸²æŸ“çš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚æ•°æ®è·å–ã€è®¢é˜…ã€æ—¥å¿—è®°å½•ç­‰ã€‚å¦‚æœä½ çš„å‰¯ä½œç”¨éœ€è¦åŒæ­¥ä¿®æ”¹ DOM å¹¶å¹¶åœ¨æµè§ˆå™¨ç»˜åˆ¶å‰å®Œæˆï¼Œä½ åº”è¯¥è€ƒè™‘ä½¿ç”¨ <code>useLayoutEffect</code>ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-48">å…­. æœ€å</h2>
<p>React Hooks çš„è®¾è®¡ç²¾å¦™ä¹‹å¤„åœ¨äºå…¶å¯¹ Fiber æ¶æ„çš„å……åˆ†åˆ©ç”¨ï¼Œé€šè¿‡ Hook é“¾è¡¨å’Œæ›´æ–°é˜Ÿåˆ—ï¼Œå®ç°äº†å‡½æ•°ç»„ä»¶çŠ¶æ€å’Œå‰¯ä½œç”¨çš„æœ‰æ•ˆç®¡ç†ã€‚ç†è§£è¿™äº›åº•å±‚æœºåˆ¶ï¼Œä¸ä»…èƒ½å¸®åŠ©æˆ‘ä»¬æ›´æ·±å…¥åœ°æŒæ¡ React çš„å·¥ä½œåŸç†ï¼Œä¹Ÿèƒ½åœ¨æ—¥å¸¸å¼€å‘ä¸­æ›´å¥½åœ°ä¼˜åŒ–ç»„ä»¶æ€§èƒ½ï¼Œé¿å…æ½œåœ¨çš„é—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[A Iæ—¶ä»£å¦‚ä½•åœ¨ç ”å‘å›¢é˜Ÿä¸­å±•ç°ã€Œå‰ç«¯ã€çš„é­…åŠ›]]></title>    <link>https://juejin.cn/post/7584472215976214543</link>    <guid>https://juejin.cn/post/7584472215976214543</guid>    <pubDate>2025-12-17T12:43:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584472215976214543" data-draft-id="7584650673825234984" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="A Iæ—¶ä»£å¦‚ä½•åœ¨ç ”å‘å›¢é˜Ÿä¸­å±•ç°ã€Œå‰ç«¯ã€çš„é­…åŠ›"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-17T12:43:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æé¦™å…°lxl"/> <meta itemprop="url" content="https://juejin.cn/user/3026329176911304"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            A Iæ—¶ä»£å¦‚ä½•åœ¨ç ”å‘å›¢é˜Ÿä¸­å±•ç°ã€Œå‰ç«¯ã€çš„é­…åŠ›
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3026329176911304/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æé¦™å…°lxl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T12:43:12.000Z" title="Wed Dec 17 2025 12:43:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æˆ‘å¦‚ä½•ä½¿ç”¨AIæ„å»ºä»£ç å¸®åŠ©QAåŒå­¦çš„å‡è´Ÿã€‚</h2>
<blockquote>
<p>ä»£ç æ˜¯ç”¨æ¥è§£å†³é—®é¢˜çš„å·¥å…·ï¼›è€Œä¸æ˜¯æ¬ç –çš„é“²å­ï¼›AIæ—¶ä»£å†™ä»£ç å¾ˆå¿«ï¼Œè¦æƒ³æƒ³æ€ä¹ˆç”¨ä»£ç è§£å†³ä¸€äº›å¼€å‘ä¸­å’Œä¸šåŠ¡ä¸­çš„é—®é¢˜æ‰æ˜¯æˆ‘ä»¬å…³é”®</p>
</blockquote>
<h3 data-id="heading-1">å‰è¨€</h3>
<p>æœ€è¿‘åœ¨å°é—­å¼€å‘è¿‡ç¨‹ä¸­å‘ç°QAåŒå­¦åªèƒ½é€šè¿‡å›ºå®šé¡µé¢æäº¤bugã€‚è€Œä¸”éœ€è¦ä¸æ–­çš„æˆªå›¾ä¸Šä¼ ï¼Œåœ¨æ²¡æœ‰æ˜¾ç¤ºå™¨çš„æƒ…å†µä¸‹ï¼Œæ— è®ºæ˜¯åˆ‡æ¢è¿˜æ˜¯ä¸Šä¼ å¯¹äºQAçš„éƒ½ä½œéƒ½æ˜¯ä¸€ç§â€ä¸å¾—ä¸åšâ€œçš„æ—¶é—´è´Ÿæ‹…ï¼Œè€Œä¸”æç»™æˆ‘ä»¬çš„bugä¹Ÿæ²¡æœ‰é“¾æ¥å¯¼è‡´æ— æ³•å¿«é€Ÿè¿˜åŸå’Œè§£å†³ã€‚å¯¹äºå‰ç«¯è€Œè¨€ä¹Ÿæ˜¯ä¸€ç§è´Ÿæ‹…ã€‚æ‰€ä»¥é€šè¿‡å¼€å‘ä¸€ä¸ªå¿«é€Ÿbugæäº¤ï¼Œå¿«é€Ÿå®Œæˆé¡µé¢é¡µé¢æˆªå›¾ï¼Œé“¾æ¥æ”¶é›†çš„æ–¹å¼è®©QAå¯ä»¥ä¸åªåœ¨buglistçš„ç½‘ç«™è¿›è¡Œæäº¤ã€‚æœ‰äº†æƒ³æ³•ä¹‹åäº¤ç»™AIè¿­ä»£ï¼Œå¾ˆå¿«å°±å®Œæˆäº†ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç»éªŒå’Œé‡åˆ°å›°éš¾ï¼šä¸»è¦æ˜¯å¦‚ä½•å®ç°å¿«é€Ÿæˆªå›¾ï¼Œå¦‚ä½•è§£å†³æ’ä»¶è¯·æ±‚æ¥å£çš„è·¨åŸŸé—®é¢˜ï¼Œä»¥åŠå¦‚ä½•è§£å†³æˆªå›¾æ ·å¼ç­‰ã€‚æœ€ç»ˆå†™äº†ä¸ªæ–‡æ¡£+æ’ä»¶åŒ…æä¾›ç»™QAå›¢é˜Ÿï¼Œæœ€ç»ˆå°†æ•´ä½“æµç¨‹é€Ÿåº¦æå‡70%ã€‚QAä¸éœ€è¦ä¸Šä¼ æˆªå›¾é“¾è·¯ï¼Œå’Œå¡«å†™é¡µé¢åœ°å€é“¾è·¯ã€‚åŒæ—¶é¿å…æµè§ˆå™¨çš„æ¥å›åˆ‡æ¢å¸¦æ¥çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚çš†å¤§æ¬¢å–œï¼ï¼ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨çš„æˆªå›¾ï¼ŒåŠŸèƒ½å¹¶ä¸å¤æ‚ä½†æ˜¯èƒ½è§£å†³å®é™…é—®é¢˜ï¼Œç»™å¤§å®¶ä½œä¸ºå‚è€ƒï¼Œæœ‰æƒ³æ³•å†ç»“åˆè‡ªå·±çš„æŠ€æœ¯èƒ½åŠ›+AIå¾ˆå¿«å¯ä»¥å®Œæˆæ„å»ºï¼Œå¤§å®¶å…±å‹‰ã€‚
å›¾æ ‡æ˜¯nanoç”Ÿæˆçš„ï¼›ä»£ç æ˜¯giminiï¼›</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0bfb21ceb9f4c96bfe1ee247dd8571b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2O6aaZ5YWwbHhs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766580192&amp;x-signature=ohVKruSqqmnYcv4EzbHhqMW0UX0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">1. é¡¹ç›®èƒŒæ™¯</h3>
<h4 data-id="heading-3">1.1 QAå›¢é˜Ÿçš„å·¥ä½œå›°å¢ƒ</h4>
<p>åœ¨æ•æ·å¼€å‘æ¨¡å¼ä¸‹ï¼ŒQAï¼ˆè´¨é‡ä¿è¯ï¼‰å›¢é˜Ÿæ¯å¤©éœ€è¦å¤„ç†å¤§é‡çš„BugæŠ¥å‘Šã€‚ä¼ ç»Ÿçš„Bugæäº¤æµç¨‹åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li><strong>å‘ç°é¡µé¢é—®é¢˜</strong> â†’ æ‰‹åŠ¨æˆªå›¾ï¼ˆPrint Screenæˆ–æˆªå›¾å·¥å…·ï¼‰</li>
<li><strong>ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°</strong> â†’ æ‰“å¼€å·¥å•ç³»ç»Ÿï¼ˆTodoList/Jiraï¼‰</li>
<li><strong>ä¸Šä¼ æˆªå›¾é™„ä»¶</strong> â†’ å¤åˆ¶é¡µé¢URLé“¾æ¥</li>
<li><strong>å¡«å†™Bugä¿¡æ¯</strong> â†’ é€‰æ‹©æŒ‡æ´¾äººå‘˜ã€ä¼˜å…ˆçº§ã€åˆ†ç±»</li>
<li><strong>æäº¤å·¥å•</strong> â†’ è¿”å›æµ‹è¯•é¡µé¢ç»§ç»­å·¥ä½œ</li>
</ol>
<p>æ•´ä¸ªæµç¨‹å¹³å‡è€—æ—¶<strong>2åˆ†é’Ÿ</strong>ï¼Œä¸ä»…æ‰“æ–­äº†æµ‹è¯•çš„å¿ƒæµï¼Œè¿˜å®¹æ˜“å› ç¹çæ“ä½œå¯¼è‡´ä¿¡æ¯é—æ¼ã€‚</p>
<h4 data-id="heading-4">1.2 æŠ€æœ¯é€‰å‹è€ƒé‡</h4>
<p>åŸºäºå¯¹é—®é¢˜çš„åˆ†æï¼Œæˆ‘ä»¬å†³å®šå¼€å‘ä¸€ä¸ª<strong>Chromeæµè§ˆå™¨æ‰©å±•</strong>ï¼Œä¸»è¦åŸå› ï¼š</p>
<ul>
<li><strong>æ— ä¾µå…¥æ€§</strong>ï¼šä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä¸šåŠ¡ç³»ç»Ÿ</li>
<li><strong>è·¨å¹³å°æ€§</strong>ï¼šChromeæ‰©å±•å¯ä»¥åœ¨Windowsã€Macã€Linuxä¸Šè¿è¡Œ</li>
<li><strong>APIä¸°å¯Œ</strong>ï¼šæä¾›äº†æˆªå›¾ã€å­˜å‚¨ã€æ¶ˆæ¯ä¼ é€’ç­‰å®Œå–„çš„API</li>
<li><strong>éƒ¨ç½²ç®€å•</strong>ï¼šé€šè¿‡Chrome Web Storeæˆ–å†…éƒ¨åˆ†å‘å³å¯</li>
</ul>
<h3 data-id="heading-5">2. è§£å†³æ–¹æ¡ˆè®¾è®¡</h3>
<h4 data-id="heading-6">2.1 æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§</h4>
<p><strong>TJ Bug Reporter</strong>æä¾›äº†ä¸€ç«™å¼çš„Bugæäº¤æµç¨‹ï¼š</p>
<ul>
<li><strong>ğŸ¯ ä¸€é”®æ™ºèƒ½æˆªå›¾</strong>ï¼šç‚¹å‡»æ‚¬æµ®çƒè‡ªåŠ¨æˆªå–å½“å‰é¡µé¢ï¼Œæˆªå›¾æ—¶è‡ªåŠ¨éšè—æ’ä»¶UI</li>
<li><strong>ğŸ“ å¤šæ ¼å¼é™„ä»¶æ”¯æŒ</strong>ï¼šæ”¯æŒå›¾ç‰‡ã€Wordã€Excelã€PDFã€è§†é¢‘ç­‰å¤šç§æ ¼å¼</li>
<li><strong>ğŸ¤– è‡ªåŠ¨åŒ–ä¿¡æ¯å¡«å……</strong>ï¼šè‡ªåŠ¨æå–é¡µé¢URLã€è®°å¿†ä¸Šæ¬¡çš„ä¼˜å…ˆçº§è®¾ç½®</li>
<li><strong>ğŸ” äººå‘˜æ™ºèƒ½æ£€ç´¢</strong>ï¼šå®æ—¶æœç´¢è”æƒ³å†…éƒ¨äººå‘˜ï¼Œæ”¯æŒDebounceé˜²æŠ–</li>
<li><strong>âŒ¨ï¸ å¿«æ·é”®æ“ä½œ</strong>ï¼šESCé”®å…³é—­å¼¹çª—ï¼Œæå‡æ“ä½œæ•ˆç‡</li>
</ul>
<h4 data-id="heading-7">2.2 ç”¨æˆ·ä½“éªŒè®¾è®¡</h4>
<p>æˆ‘ä»¬é‡‡ç”¨äº†<strong>éæ¨¡æ€äº¤äº’</strong>çš„è®¾è®¡ç†å¿µï¼š</p>
<ul>
<li><strong>æ‚¬æµ®çƒå¸¸é©»</strong>ï¼šå§‹ç»ˆå¯è§ä½†ä¸å¹²æ‰°æ­£å¸¸æµè§ˆ</li>
<li><strong>æ‹–æ‹½å®šä½</strong>ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®ä¹ æƒ¯è°ƒæ•´ä½ç½®</li>
<li><strong>å³æ—¶åé¦ˆ</strong>ï¼šLoadingçŠ¶æ€ã€æˆåŠŸæç¤ºç­‰è§†è§‰åé¦ˆ</li>
<li><strong>é”®ç›˜å‹å¥½</strong>ï¼šæ”¯æŒESCç­‰å¿«æ·é”®æ“ä½œ</li>
</ul>
<p><em>æˆªå›¾ä½ç½®ï¼š[æ’ä»¶ç•Œé¢å±•ç¤º]</em>
<em>å±•ç¤ºæ‚¬æµ®çƒã€å¼¹çª—ç•Œé¢ã€é™„ä»¶ä¸Šä¼ ç­‰æ ¸å¿ƒåŠŸèƒ½çš„æˆªå›¾</em></p>
<h3 data-id="heading-8">3. æŠ€æœ¯æ¶æ„</h3>
<h4 data-id="heading-9">3.1 Chrome Extension Manifest V3æ¶æ„</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"manifest_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TJ Bug Reporter"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"activeTab"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"storage"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"host_permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"&lt;all_urls&gt;"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"background"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"service_worker"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"background.js"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"content_scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"matches"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"&lt;all_urls&gt;"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"content.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"run_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"document_end"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>æ ¸å¿ƒç»„ä»¶è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>Content Script</strong>ï¼šæ³¨å…¥åˆ°é¡µé¢ä¸­ï¼Œè´Ÿè´£UIæ¸²æŸ“å’Œç”¨æˆ·äº¤äº’</li>
<li><strong>Background Service Worker</strong>ï¼šåå°æœåŠ¡ï¼Œå¤„ç†è·¨åŸŸè¯·æ±‚å’Œæ–‡ä»¶ä¸Šä¼ </li>
<li><strong>Storage API</strong>ï¼šæŒä¹…åŒ–å­˜å‚¨ç”¨æˆ·é…ç½®å’Œå†å²è®°å½•</li>
<li><strong>Tabs API</strong>ï¼šè·å–é¡µé¢æˆªå›¾ä¿¡æ¯</li>
</ul>
<h4 data-id="heading-10">3.2 Shadow DOMæ ·å¼éš”ç¦»</h4>
<p>ä¸ºäº†è§£å†³æ’ä»¶ä¸å®¿ä¸»é¡µé¢çš„æ ·å¼å†²çªé—®é¢˜ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†<strong>Shadow DOM</strong>æŠ€æœ¯ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºéš”ç¦»çš„DOMç¯å¢ƒ</span>
<span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
container.<span class="hljs-property">id</span> = <span class="hljs-string">'bug-reporter-host'</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(container);

<span class="hljs-keyword">const</span> shadow = container.<span class="hljs-title function_">attachShadow</span>({ <span class="hljs-attr">mode</span>: <span class="hljs-string">'open'</span> });

<span class="hljs-comment">// å°†æ’ä»¶HTMLæ³¨å…¥åˆ°Shadow DOMä¸­</span>
shadow.<span class="hljs-property">innerHTML</span> = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(chrome.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">getURL</span>(<span class="hljs-string">'panel.html'</span>)).<span class="hljs-title function_">text</span>();
</code></pre>
<p>è¿™ç§æ–¹æ¡ˆç¡®ä¿äº†æ’ä»¶çš„æ ·å¼"è¿›ä¸å»ä¹Ÿå‡ºä¸æ¥"ï¼Œå®ç°äº†å®Œç¾çš„æ ·å¼éš”ç¦»ã€‚</p>
<h3 data-id="heading-11">4. æ ¸å¿ƒæŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-12">4.1 CORSè·¨åŸŸé—®é¢˜çš„ä»£ç†æ¨¡å¼è§£å†³æ–¹æ¡ˆ</h4>
<h5 data-id="heading-13">é—®é¢˜æè¿°</h5>
<p>æ’ä»¶è¿è¡Œåœ¨ä¸šåŠ¡é¡µé¢ï¼ˆå¦‚ <code>company-website.com</code>ï¼‰çš„Content Scriptç¯å¢ƒä¸­ï¼Œå½“ç›´æ¥è°ƒç”¨å†…éƒ¨å·¥å•ç³»ç»ŸAPIï¼ˆå¦‚ <code>internal-system.com/api/bugs</code>ï¼‰æ—¶ï¼Œæµè§ˆå™¨ä¼šæ‹¦æˆªè¯·æ±‚ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">Access to fetch at <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//internal-system.com/api/bugs' from origin</span>
<span class="hljs-symbol">'https</span>:<span class="hljs-comment">//company-website.com' has been blocked by CORS policy</span>
</code></pre>
<h5 data-id="heading-14">è§£å†³æ–¹æ¡ˆè®¾è®¡</h5>
<p>æˆ‘ä»¬é‡‡ç”¨äº†<strong>Chrome Extensionæ¶æ„ç‰¹æ€§</strong>çš„ä»£ç†æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    sendMessage    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    fetch    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-attribute">Content</span> Script â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ <span class="hljs-attribute">Background</span>       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Internal API   â”‚
â”‚  (ä¸šåŠ¡é¡µé¢ç¯å¢ƒ)   â”‚                  â”‚ Service Worker   â”‚             â”‚  (å†…éƒ¨ç³»ç»Ÿ)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  (ç‹¬ç«‹ç¯å¢ƒ)       â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h5 data-id="heading-15">å®ç°ç»†èŠ‚</h5>
<p><strong>1. Content Scriptç«¯ - æ•°æ®æ”¶é›†ä¸è¯·æ±‚è½¬å‘</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// content.js</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">submitBug</span>(<span class="hljs-params">bugData</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    chrome.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">sendMessage</span>({
      <span class="hljs-attr">action</span>: <span class="hljs-string">'PROXY_FETCH'</span>,
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">url</span>: <span class="hljs-string">'https://internal-system.com/api/bugs'</span>,
        <span class="hljs-attr">options</span>: {
          <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
          <span class="hljs-attr">headers</span>: {
            <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
            <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">'Bearer '</span> + token
          },
          <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(bugData)
        }
      }
    }, <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
      <span class="hljs-title function_">resolve</span>(response);
    });
  });
}
</code></pre>
<p><strong>2. Background Service Workerç«¯ - çœŸå®è¯·æ±‚æ‰§è¡Œ</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// background.js</span>
chrome.<span class="hljs-property">runtime</span>.<span class="hljs-property">onMessage</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-function">(<span class="hljs-params">request, sender, sendResponse</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (request.<span class="hljs-property">action</span> === <span class="hljs-string">'PROXY_FETCH'</span>) {
    <span class="hljs-keyword">const</span> { url, options } = request.<span class="hljs-property">data</span>;

    <span class="hljs-title function_">fetch</span>(url, options)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-title function_">sendResponse</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">data</span>: data });
      })
      .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-title function_">sendResponse</span>({ <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">error</span>: err.<span class="hljs-property">message</span> });
      });

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// ä¿æŒæ¶ˆæ¯é€šé“å¼€æ”¾</span>
  }
});
</code></pre>
<p><strong>3. æ–‡ä»¶ä¸Šä¼ çš„ç‰¹æ®Šå¤„ç†</strong></p>
<p>æ–‡ä»¶ä¸Šä¼ éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå› ä¸ºæ–‡ä»¶å¯¹è±¡æ— æ³•ç›´æ¥é€šè¿‡æ¶ˆæ¯ä¼ é€’ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Content Script - å°†æ–‡ä»¶è½¬ä¸ºBase64</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">prepareFileForUpload</span>(<span class="hljs-params">file</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
    reader.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>({
        <span class="hljs-attr">name</span>: file.<span class="hljs-property">name</span>,
        <span class="hljs-attr">type</span>: file.<span class="hljs-property">type</span>,
        <span class="hljs-attr">size</span>: file.<span class="hljs-property">size</span>,
        <span class="hljs-attr">base64</span>: reader.<span class="hljs-property">result</span>
      });
    };
    reader.<span class="hljs-title function_">readAsDataURL</span>(file);
  });
}

<span class="hljs-comment">// Background - è¿˜åŸæ–‡ä»¶å¹¶ä¸Šä¼ </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">dataURItoBlob</span>(<span class="hljs-params">dataURI</span>) {
  <span class="hljs-keyword">const</span> byteString = <span class="hljs-title function_">atob</span>(dataURI.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)[<span class="hljs-number">1</span>]);
  <span class="hljs-keyword">const</span> mimeString = dataURI.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">':'</span>)[<span class="hljs-number">1</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">';'</span>)[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">const</span> ab = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(byteString.<span class="hljs-property">length</span>);
  <span class="hljs-keyword">const</span> ia = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(ab);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; byteString.<span class="hljs-property">length</span>; i++) {
    ia[i] = byteString.<span class="hljs-title function_">charCodeAt</span>(i);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Blob</span>([ab], { <span class="hljs-attr">type</span>: mimeString });
}
</code></pre>
<h4 data-id="heading-16">4.2 Shadow DOMæ ·å¼éš”ç¦»æŠ€æœ¯å®ç°</h4>
<h5 data-id="heading-17">é—®é¢˜èƒŒæ™¯</h5>
<p>æ’ä»¶éœ€è¦æ³¨å…¥åˆ°å„ç§ä¸åŒçš„ä¸šåŠ¡é¡µé¢ä¸­ï¼Œé¢ä¸´æ ·å¼å†²çªçš„åŒé‡æŒ‘æˆ˜ï¼š</p>
<ol>
<li><strong>å®¿ä¸»é¡µé¢æ±¡æŸ“æ’ä»¶</strong>ï¼šé¡µé¢çš„å…¨å±€CSSï¼ˆå¦‚ <code>div { color: red !important }</code>ï¼‰ä¼šç ´åæ’ä»¶æ ·å¼</li>
<li><strong>æ’ä»¶å½±å“å®¿ä¸»é¡µé¢</strong>ï¼šæ’ä»¶çš„CSSå¯èƒ½æ„å¤–ä¿®æ”¹é¡µé¢å…ƒç´ æ ·å¼</li>
</ol>
<h5 data-id="heading-18">Shadow DOMè§£å†³æ–¹æ¡ˆ</h5>
<p><strong>1. åˆ›å»ºéš”ç¦»ç¯å¢ƒ</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createIsolatedEnvironment</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// åˆ›å»ºå®¿ä¸»å®¹å™¨</span>
  <span class="hljs-keyword">const</span> host = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  host.<span class="hljs-property">id</span> = <span class="hljs-string">'bug-reporter-host'</span>;
  host.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`
    all: initial;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 999999;
  `</span>;

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(host);

  <span class="hljs-comment">// åˆ›å»ºShadow DOM</span>
  <span class="hljs-keyword">const</span> shadow = host.<span class="hljs-title function_">attachShadow</span>({ <span class="hljs-attr">mode</span>: <span class="hljs-string">'open'</span> });

  <span class="hljs-comment">// æ³¨å…¥æ ·å¼å’ŒHTML</span>
  shadow.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
    &lt;style&gt;
      /* è¿™é‡Œå®šä¹‰æ’ä»¶çš„æ‰€æœ‰æ ·å¼ï¼Œå®Œå…¨éš”ç¦» */
      .container {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
      }
      /* ... å…¶ä»–æ ·å¼ ... */
    &lt;/style&gt;
    &lt;div class="container"&gt;
      &lt;!-- æ’ä»¶HTMLç»“æ„ --&gt;
    &lt;/div&gt;
  `</span>;

  <span class="hljs-keyword">return</span> shadow;
}
</code></pre>
<p><strong>2. æ ·å¼å°è£…ç­–ç•¥</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ä½¿ç”¨CSSé€‰æ‹©å™¨ç¡®ä¿æ ·å¼ä¸ä¼šæ³„æ¼ */</span>
<span class="hljs-selector-pseudo">:host</span> {
  <span class="hljs-attribute">all</span>: initial;
}

<span class="hljs-selector-pseudo">:host</span> <span class="hljs-selector-class">.bug-reporter-panel</span> {
  <span class="hljs-comment">/* æ’ä»¶ä¸“ç”¨æ ·å¼å‰ç¼€ */</span>
}

<span class="hljs-comment">/* ä½¿ç”¨:definedé¿å…ç»§æ‰¿å®¿ä¸»æ ·å¼ */</span>
<span class="hljs-selector-pseudo">:host</span> * {
  <span class="hljs-attribute">box-sizing</span>: border-box;
}
</code></pre>
<p><strong>3. JavaScriptè®¿é—®æ§åˆ¶</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·å–Shadow DOMå†…éƒ¨çš„å…ƒç´ </span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getShadowElement</span>(<span class="hljs-params">selector</span>) {
  <span class="hljs-keyword">const</span> shadowHost = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'bug-reporter-host'</span>);
  <span class="hljs-keyword">if</span> (shadowHost &amp;&amp; shadowHost.<span class="hljs-property">shadowRoot</span>) {
    <span class="hljs-keyword">return</span> shadowHost.<span class="hljs-property">shadowRoot</span>.<span class="hljs-title function_">querySelector</span>(selector);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// äº‹ä»¶å§”æ‰˜å¤„ç†</span>
shadow.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> target = event.<span class="hljs-property">target</span>;
  <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">matches</span>(<span class="hljs-string">'.close-button'</span>)) {
    <span class="hljs-title function_">closePanel</span>();
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target.<span class="hljs-title function_">matches</span>(<span class="hljs-string">'.submit-button'</span>)) {
    <span class="hljs-title function_">submitBug</span>();
  }
});
</code></pre>
<h4 data-id="heading-19">4.3 æˆªå›¾æ—¶çš„UIéšè—æœºåˆ¶</h4>
<p>ä¸ºäº†è·å¾—çº¯å‡€çš„é¡µé¢æˆªå›¾ï¼Œæˆ‘ä»¬å®ç°äº†"éšèº«æˆªå›¾"åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">captureCleanScreenshot</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-comment">// 1. éšè—æ’ä»¶UI</span>
    <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'bug-reporter-host'</span>);
    container.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;

    <span class="hljs-comment">// 2. ç­‰å¾…æµè§ˆå™¨é‡ç»˜</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 3. æ‰§è¡Œæˆªå›¾</span>
      chrome.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">sendMessage</span>({ <span class="hljs-attr">action</span>: <span class="hljs-string">'CAPTURE_SCREENSHOT'</span> }, <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (response.<span class="hljs-property">success</span>) {
          <span class="hljs-comment">// 4. æ¢å¤UIæ˜¾ç¤º</span>
          container.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'block'</span>;
          <span class="hljs-title function_">resolve</span>(response.<span class="hljs-property">dataUrl</span>);
        }
      });
    }, <span class="hljs-number">100</span>); <span class="hljs-comment">// ç»™æµè§ˆå™¨è¶³å¤Ÿæ—¶é—´é‡ç»˜</span>
  });
}
</code></pre>
<h4 data-id="heading-20">4.4 åŠ¨æ€DOMç”Ÿå‘½å‘¨æœŸç®¡ç†</h4>
<p>Shadow DOMä¸­çš„å…ƒç´ å¼•ç”¨ä¼šåœ¨æŸäº›æ“ä½œåå¤±æ•ˆï¼Œæˆ‘ä»¬é‡‡ç”¨å³æ—¶æŸ¥æ‰¾ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ é”™è¯¯åšæ³•ï¼šç¼“å­˜DOMå¼•ç”¨</span>
<span class="hljs-keyword">const</span> modal = shadow.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'img-modal'</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Escape'</span>) {
    modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>; <span class="hljs-comment">// å¯èƒ½å¤±æ•ˆ</span>
  }
});

<span class="hljs-comment">// âœ… æ­£ç¡®åšæ³•ï¼šå³æ—¶æŸ¥æ‰¾</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Escape'</span>) {
    <span class="hljs-keyword">const</span> modal = shadow.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'img-modal'</span>);
    <span class="hljs-keyword">if</span> (modal &amp;&amp; modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> === <span class="hljs-string">'flex'</span>) {
      modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
    }
  }
});
</code></pre>
<h3 data-id="heading-21">5. é¡¹ç›®æˆæœä¸ä»·å€¼</h3>
<h4 data-id="heading-22">5.1 é‡åŒ–æ•ˆç‡æå‡</h4>



































<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼ ç»Ÿæµç¨‹</th><th>ä½¿ç”¨æ’ä»¶å</th><th>æå‡å¹…åº¦</th></tr></thead><tbody><tr><td>å•ä¸ªBugæäº¤æµç¨‹</td><td>120ç§’</td><td>30ç§’</td><td><strong>75%</strong></td></tr><tr><td>æ—¥å‡Bugæäº¤é‡</td><td>40ä¸ª</td><td>60ä¸ª</td><td><strong>50%</strong></td></tr><tr><td>ä¿¡æ¯å®Œæ•´æ€§</td><td>85%</td><td>98%</td><td><strong>15%</strong></td></tr><tr><td>é‡å¤æ“ä½œæ¬¡æ•°</td><td>10æ¬¡/Bug</td><td>2æ¬¡/Bug</td><td><strong>80%</strong></td></tr></tbody></table>
<h4 data-id="heading-23">5.2 å›¢é˜Ÿåä½œæ”¹å–„</h4>
<ul>
<li><strong>QAå›¢é˜Ÿ</strong>ï¼šæµ‹è¯•å¿ƒæµä¸å†è¢«æ‰“æ–­ï¼Œå¯ä»¥ä¸“æ³¨äºå‘ç°æ›´å¤šé—®é¢˜</li>
<li><strong>å¼€å‘å›¢é˜Ÿ</strong>ï¼šæ”¶åˆ°çš„BugæŠ¥å‘Šä¿¡æ¯æ›´å®Œæ•´ï¼Œå‡å°‘äº†åå¤æ²Ÿé€š</li>
<li><strong>é¡¹ç›®ç»ç†</strong>ï¼šå¯ä»¥å®æ—¶è·Ÿè¸ªBugå‘ç°å’Œä¿®å¤è¿›åº¦</li>
</ul>
<h4 data-id="heading-24">5.3 æŠ€æœ¯æ²‰æ·€</h4>
<ul>
<li>å¯å¤ç”¨çš„è·¨åŸŸä»£ç†æ¨¡å¼</li>
<li>Shadow DOMæ ·å¼éš”ç¦»çš„æœ€ä½³å®è·µ</li>
<li>Chrome Extensionå¼€å‘çš„å®Œæ•´ç»éªŒ</li>
</ul>
<p><em>æˆªå›¾ä½ç½®ï¼š[æ•°æ®å¯¹æ¯”å›¾è¡¨]</em>
<em>å±•ç¤ºæ•ˆç‡æå‡çš„å…·ä½“æ•°æ®å¯è§†åŒ–å›¾è¡¨</em></p>
<h3 data-id="heading-25">6. é¡¹ç›®æ€»ç»“ä¸å±•æœ›</h3>
<h4 data-id="heading-26">6.1 å…³é”®ç»éªŒ</h4>
<ol>
<li><strong>æŠ€æœ¯é€‰å‹è¦åŒ¹é…ä¸šåŠ¡åœºæ™¯</strong>ï¼šChrome Extensionå®Œç¾å¥‘åˆäº†"æ— éœ€ä¿®æ”¹ç°æœ‰ç³»ç»Ÿ"çš„éœ€æ±‚</li>
<li><strong>æ¶æ„è®¾è®¡è¦è€ƒè™‘æ‰©å±•æ€§</strong>ï¼šä»£ç†æ¨¡å¼ä¸ä»…è§£å†³äº†CORSé—®é¢˜ï¼Œè¿˜ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•ç•™ä¸‹äº†ç©ºé—´</li>
<li><strong>ç”¨æˆ·ä½“éªŒå†³å®šäº§å“æˆè´¥</strong>ï¼šéä¾µå…¥å¼è®¾è®¡å’Œå¿«æ·é”®æ”¯æŒå¤§å¤§æå‡äº†ç”¨æˆ·æ¥å—åº¦</li>
</ol>
<h4 data-id="heading-27">6.2 æœªæ¥ä¼˜åŒ–æ–¹å‘</h4>
<ul>
<li><strong>æ™ºèƒ½Bugåˆ†ç±»</strong>ï¼šä½¿ç”¨æœºå™¨å­¦ä¹ è‡ªåŠ¨è¯†åˆ«Bugç±»å‹å’Œä¼˜å…ˆçº§</li>
<li><strong>æ‰¹é‡æ“ä½œ</strong>ï¼šæ”¯æŒä¸€æ¬¡æ€§æäº¤å¤šä¸ªç›¸å…³Bug</li>
<li><strong>ç§»åŠ¨ç«¯æ”¯æŒ</strong>ï¼šå¼€å‘ç§»åŠ¨ç«¯æµè§ˆå™¨æ‰©å±•æˆ–ç‹¬ç«‹åº”ç”¨</li>
<li><strong>æ•°æ®åˆ†æé¢æ¿</strong>ï¼šæä¾›Bugè¶‹åŠ¿åˆ†æå’Œå›¢é˜Ÿæ•ˆç‡æŠ¥è¡¨</li>
</ul>
<h4 data-id="heading-28">6.3 å¼€æºè´¡çŒ®è®¡åˆ’</h4>
<p>æˆ‘ä»¬è®¡åˆ’å°†æ ¸å¿ƒç»„ä»¶å¼€æºï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>Shadow DOMæ ·å¼éš”ç¦»æ¡†æ¶</li>
<li>Chrome Extensionè·¨åŸŸä»£ç†æ¨¡æ¿</li>
<li>æ–‡ä»¶ä¸Šä¼ å¤„ç†å·¥å…·ç±»</li>
</ul>
<hr/>
<h3 data-id="heading-29">æŠ€æœ¯æ ˆæ€»ç»“</h3>
<ul>
<li><strong>æ ¸å¿ƒè¯­è¨€</strong>ï¼šJavaScript (ES6+), HTML5, CSS3</li>
<li><strong>æµè§ˆå™¨API</strong>ï¼šChrome Extension Manifest V3 (Storage, Runtime, Tabs, Scripting)</li>
<li><strong>æ¶æ„æ¨¡å¼</strong>ï¼šShadow DOM, Service Worker, Message Passing</li>
<li><strong>å¼€å‘å·¥å…·</strong>ï¼šVSCode, Chrome DevTools, Git</li>
</ul>
<blockquote>
<p>ğŸ’¡ <strong>æ ¸å¿ƒå¯ç¤º</strong>ï¼šé€šè¿‡å·§å¦™çš„æŠ€æœ¯æ¶æ„è®¾è®¡ï¼Œæˆ‘ä»¬ä¸ä»…è§£å†³äº†ä¸šåŠ¡ç—›ç‚¹ï¼Œè¿˜åˆ›é€ äº†ä¸€æ¬¾çœŸæ­£æå‡å›¢é˜Ÿæ•ˆç‡çš„å·¥å…·ã€‚è¿™æ­£æ˜¯æŠ€æœ¯èµ‹èƒ½ä¸šåŠ¡çš„æœ€ä½³å®è·µã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ‰“å¼€Vue3çš„é»‘åŒ£å­ï¼šå·¥ç¨‹ç»“æ„èƒŒåçš„è®¾è®¡å“²å­¦]]></title>    <link>https://juejin.cn/post/7584652662328967218</link>    <guid>https://juejin.cn/post/7584652662328967218</guid>    <pubDate>2025-12-17T13:54:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584652662328967218" data-draft-id="7584379805899391028" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ‰“å¼€Vue3çš„é»‘åŒ£å­ï¼šå·¥ç¨‹ç»“æ„èƒŒåçš„è®¾è®¡å“²å­¦"/> <meta itemprop="keywords" content="Vue.js,å‰ç«¯æ¡†æ¶"/> <meta itemprop="datePublished" content="2025-12-17T13:54:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯æ°´å¾ˆæ·±"/> <meta itemprop="url" content="https://juejin.cn/user/3562890820588077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ‰“å¼€Vue3çš„é»‘åŒ£å­ï¼šå·¥ç¨‹ç»“æ„èƒŒåçš„è®¾è®¡å“²å­¦
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3562890820588077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯æ°´å¾ˆæ·±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T13:54:44.000Z" title="Wed Dec 17 2025 13:54:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å½“ä¸€ä¸ªæ¡†æ¶ä¸å†ä»…ä»…æ˜¯ä¸€å †APIï¼Œè€Œæˆä¸ºä¸€ç§è®¾è®¡å“²å­¦çš„ä½“ç°æ—¶ï¼ŒçœŸæ­£çš„é­”æ³•æ‰å¼€å§‹å‘ç”Ÿã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸ºä»€ä¹ˆVue3çš„å·¥ç¨‹ç»“æ„å€¼å¾—æ·±ç©¶ï¼Ÿ</h2>
<p>åœ¨Vue3å‘å¸ƒä¹‹åˆï¼Œè®¸å¤šå¼€å‘è€…è¢«å…¶æ€§èƒ½æå‡ã€Composition APIç­‰æ–°ç‰¹æ€§æ‰€å¸å¼•ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ä¸ªæ›´æ·±å±‚çš„è½¬å˜å¾€å¾€è¢«å¿½è§†ï¼š<strong>Vue3çš„å·¥ç¨‹ç»“æ„æœ¬èº«å°±æ˜¯ä¸€éƒ¨ç²¾å¿ƒç¼–æ’çš„è®¾è®¡å“²å­¦å®£è¨€</strong>ã€‚</p>
<p>ä¸Vue2ç›¸æ¯”ï¼ŒVue3çš„æºç ç»„ç»‡ä¸å†æ˜¯ä¸€ä¸ªâ€œé»‘åŒ£å­â€ï¼Œè€Œæ˜¯ä¸€ä¸ªå¼€æ”¾ã€æ¨¡å—åŒ–ã€å¯æ¢ç´¢çš„æ¶æ„ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸ºäº†ä»£ç æ•´æ´â€”â€”æ¯ä¸€å±‚ç›®å½•ç»“æ„ã€æ¯ä¸€ä¸ªæ¨¡å—åˆ’åˆ†ï¼Œéƒ½è•´å«ç€Vueå›¢é˜Ÿå¯¹äºç°ä»£å‰ç«¯æ¡†æ¶è®¾è®¡çš„æ·±åˆ»æ€è€ƒã€‚</p>
<h2 data-id="heading-1">æ ¸å¿ƒè®¾è®¡å“²å­¦ä¸€ï¼šå…³æ³¨ç‚¹åˆ†ç¦»çš„æè‡´å®è·µ</h2>
<p>æ‰“å¼€Vue3çš„æºç ç›®å½•ï¼Œä½ ä¼šç«‹å³æ³¨æ„åˆ°å…¶æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œï¼š</p>
<pre><code class="hljs language-bash" lang="bash">packages/
â”œâ”€â”€ compiler-core/     <span class="hljs-comment"># å¹³å°æ— å…³çš„ç¼–è¯‘å™¨æ ¸å¿ƒ</span>
â”œâ”€â”€ compiler-dom/      <span class="hljs-comment"># é’ˆå¯¹æµè§ˆå™¨çš„ç¼–è¯‘å™¨</span>
â”œâ”€â”€ runtime-core/      <span class="hljs-comment"># å¹³å°æ— å…³çš„è¿è¡Œæ—¶æ ¸å¿ƒ</span>
â”œâ”€â”€ runtime-dom/       <span class="hljs-comment"># é’ˆå¯¹æµè§ˆå™¨çš„è¿è¡Œæ—¶</span>
â”œâ”€â”€ reactivity/        <span class="hljs-comment"># å“åº”å¼ç³»ç»Ÿç‹¬ç«‹åŒ…</span>
â”œâ”€â”€ shared/           <span class="hljs-comment"># å†…éƒ¨å…±äº«å·¥å…·</span>
â””â”€â”€ vue/              <span class="hljs-comment"># é¢å‘ç”¨æˆ·çš„ä¸»åŒ…</span>
</code></pre>
<p>è¿™ç§ç»“æ„ä½“ç°äº†<strong>åˆ†å±‚æ¶æ„</strong>çš„ç²¾é«“ï¼šæ¯ä¸€å±‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£ï¼Œå±‚ä¸å±‚ä¹‹é—´é€šè¿‡æ¸…æ™°çš„æ¥å£é€šä¿¡ã€‚</p>
<h3 data-id="heading-2">ç¼–è¯‘å™¨ä¸è¿è¡Œæ—¶çš„å½»åº•è§£è€¦</h3>
<p>Vue2ä¸­ç¼–è¯‘å™¨ä¸è¿è¡Œæ—¶è€¦åˆè¾ƒç´§ï¼Œè€ŒVue3å°†å®ƒä»¬å½»åº•åˆ†ç¦»ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue2æ—¶ä»£ï¼šç¼–è¯‘å™¨ä¸è¿è¡Œæ—¶æ··æ‚</span>
<span class="hljs-comment">// Vue3æ—¶ä»£ï¼šæ¸…æ™°çš„æºç ä¸äº§ç‰©çš„åˆ†ç¦»</span>
<span class="hljs-keyword">import</span> { compile } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/compiler-dom'</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// ç¼–è¯‘é˜¶æ®µ</span>
<span class="hljs-keyword">const</span> { code } = <span class="hljs-title function_">compile</span>(templateString)

<span class="hljs-comment">// è¿è¡Œæ—¶é˜¶æ®µ</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>({
  <span class="hljs-attr">render</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(code) <span class="hljs-comment">// ä½¿ç”¨ç¼–è¯‘ç»“æœ</span>
})
</code></pre>
<p>è¿™ç§åˆ†ç¦»å¸¦æ¥äº†æƒŠäººçš„çµæ´»æ€§ï¼šä½ å¯ä»¥å•ç‹¬ä½¿ç”¨Vueçš„å“åº”å¼ç³»ç»Ÿï¼Œæˆ–åŸºäºå…¶ç¼–è¯‘å™¨æ„å»ºè‡ªå·±çš„DSLï¼Œç”šè‡³å¯ä»¥åœ¨éDOMç¯å¢ƒï¼ˆå¦‚Canvasã€WebGLï¼‰ä¸­ä½¿ç”¨Vueçš„è¿è¡Œæ—¶ã€‚</p>
<h2 data-id="heading-3">æ ¸å¿ƒè®¾è®¡å“²å­¦äºŒï¼šæ¨¡å—åŒ–è®¾è®¡çš„çœŸæ­£å¨åŠ›</h2>
<p>Vue3çš„æ¨¡å—åŒ–è®¾è®¡ä¸ä»…ä½“ç°åœ¨ç›®å½•ç»“æ„ä¸Šï¼Œæ›´æ·±å…¥åˆ°APIå±‚é¢ã€‚æ¯ä¸ªåŠŸèƒ½éƒ½è¢«è®¾è®¡ä¸ºç‹¬ç«‹çš„ã€å¯æŒ‰éœ€å¼•å…¥çš„æ¨¡å—ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æŒ‰éœ€å¼•å…¥ï¼Œå‡å°æ‰“åŒ…ä½“ç§¯</span>
<span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { createRenderer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/runtime-core'</span>
</code></pre>
<h3 data-id="heading-4">æ¨¡å—åŒ–çš„æƒŠäººå¥½å¤„ï¼šæ— ç—›é‡æ„ä¸å‡çº§</h3>
<p><strong>æˆ‘è®¤ä¸ºè¿™æ˜¯Vue3å·¥ç¨‹ç»“æ„æœ€ç²¾å¦™çš„è®¾è®¡ä¹‹ä¸€</strong>ï¼šå¾—ç›Šäºæ¸…æ™°çš„æ¨¡å—è¾¹ç•Œå’Œç¨³å®šçš„æ¥å£å¥‘çº¦ï¼ŒVueå›¢é˜Ÿå¯ä»¥åœ¨åº•å±‚è¿›è¡Œå¤§åˆ€é˜”æ–§çš„é‡æ„ï¼Œè€Œä¸ä¼šç ´åä¸Šå±‚åº”ç”¨ã€‚</p>
<p>æœ€ä»¤äººå°è±¡æ·±åˆ»çš„ä¾‹å­æ˜¯ **Vue 3.6å°†æ ¸å¿ƒå“åº”å¼ç³»ç»Ÿå‡çº§ä¸ºç¤¾åŒºå¼€å‘çš„é«˜æ€§èƒ½å“åº”å¼åº“ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fstackblitz%2Falien-signals" target="_blank" title="https://github.com/stackblitz/alien-signals" ref="nofollow noopener noreferrer"><code>alien-signals</code></a> **ã€‚è¿™ç§å°†æ ¸å¿ƒå­ç³»ç»Ÿæ›¿æ¢ä¸ºä¸€ä¸ªå¤–éƒ¨ç‹¬ç«‹é¡¹ç›®çš„æ“ä½œï¼Œåœ¨ä¼ ç»Ÿå•ä½“æ¶æ„ä¸­é£é™©æé«˜ï¼Œä½†åœ¨Vue3çš„æ¨¡å—åŒ–è®¾è®¡ä¸­å´æˆä¸ºå¯èƒ½ï¼Œè¿™å®Œç¾éªŒè¯äº†å…¶æ¶æ„çš„å¯æ’æ‹”æ€§ä¸å¥å£®æ€§ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å“åº”å¼ç³»ç»Ÿçš„æ¥å£ä¿æŒç¨³å®š</span>
<span class="hljs-keyword">import</span> { reactive, effect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// æ— è®ºåº•å±‚å®ç°æ˜¯åŸç”Ÿçš„ @vue/reactivity è¿˜æ˜¯ alien-signals</span>
<span class="hljs-comment">// ä¸Šå±‚APIä¿æŒä¸€è‡´ï¼Œåº”ç”¨æ— æ„ŸçŸ¥å‡çº§</span>
<span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> })
<span class="hljs-title function_">effect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state.<span class="hljs-property">count</span>) <span class="hljs-comment">// å§‹ç»ˆå·¥ä½œ</span>
})
</code></pre>
<p><strong>è¿™ä¸€è®¾è®¡çš„ç²¾å¦™ä¹‹å¤„åœ¨äº</strong>ï¼šæ¨¡å—ä¹‹é—´çš„é€šä¿¡é€šè¿‡æ˜ç¡®å®šä¹‰çš„æ¥å£è¿›è¡Œï¼Œåªè¦<code>@vue/reactivity</code>åŒ…æä¾›çš„æ¥å£ï¼ˆå¦‚<code>reactive</code>ã€<code>ref</code>ã€<code>effect</code>ï¼‰ä¸å˜ï¼Œç¡®ä¿å•å…ƒæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼Œå†…éƒ¨å®ç°å¯ä»¥è‡ªç”±ä¼˜åŒ–ç”šè‡³å®Œå…¨é‡å†™ã€‚è¿™ä¸ºæ¡†æ¶å¸çº³æœ€å‰æ²¿çš„ç¤¾åŒºæˆæœã€æŒç»­æ¼”è¿›æä¾›äº†æ— é™å¯èƒ½ã€‚</p>
<h3 data-id="heading-5">Monorepoæ¶æ„ï¼šååŒä¸ç‹¬ç«‹çš„å¹³è¡¡</h3>
<p>Vue3é‡‡ç”¨Monorepoç»“æ„ç®¡ç†å…¶åŒ…ç”Ÿæ€ç³»ç»Ÿï¼Œæ¯ä¸ªåŒ…éƒ½ï¼š</p>
<ul>
<li>æœ‰ç‹¬ç«‹çš„æ„å»ºé…ç½®å’Œæµ‹è¯•</li>
<li>é€šè¿‡workspaceåè®®å†…éƒ¨é“¾æ¥</li>
<li>å¯ä»¥ç‹¬ç«‹å‘å¸ƒå’Œä½¿ç”¨</li>
</ul>
<p>è¿™ç§è®¾è®¡å…è®¸ç¤¾åŒºåŸºäºç‰¹å®šæ¨¡å—æ„å»ºå·¥å…·ï¼Œè€Œä¸å¿…å¼•å…¥æ•´ä¸ªVueç”Ÿæ€ã€‚</p>
<h2 data-id="heading-6">æ ¸å¿ƒè®¾è®¡å“²å­¦ä¸‰ï¼šæ¸è¿›å¢å¼ºçš„æè‡´ä½“ç°</h2>
<p>Vueä¸€ç›´ä»¥â€œæ¸è¿›å¼æ¡†æ¶â€è‡ªå±…ï¼Œè€ŒVue3çš„å·¥ç¨‹ç»“æ„å°†è¿™ä¸€ç†å¿µå·¥ç¨‹åŒ–åˆ°æè‡´ï¼š</p>
<h3 data-id="heading-7">ä»æ ¸å¿ƒåˆ°å®Œæ•´ï¼šå¹³æ»‘çš„èƒ½åŠ›æ‰©å±•</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½ å¯ä»¥åªä½¿ç”¨å“åº”å¼ç³»ç»Ÿ</span>
npm install @vue/reactivity

<span class="hljs-comment"># æˆ–åŠ ä¸Šç¼–è¯‘å™¨æˆ–è¿è¡Œæ—¶</span>
npm install @vue/compiler-core @vue/runtime-core

<span class="hljs-comment"># æˆ–ä½¿ç”¨å®Œæ•´çš„Vue</span>
npm install vue
</code></pre>
<p>è¿™ç§æ¸è¿›æ€§ä¸æ˜¯ç®€å•çš„åŠŸèƒ½å åŠ ï¼Œè€Œæ˜¯é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„ä¾èµ–å…³ç³»å’Œæ¥å£å®ç°çš„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// @vue/runtime-core ä¸ä¾èµ– @vue/compiler-core</span>
<span class="hljs-comment">// @vue/reactivity ä¸ä¾èµ–ä»»ä½•å…¶ä»–VueåŒ…</span>
</code></pre>
<h3 data-id="heading-8">Vapor Modeï¼šæ¶æ„æ¨¡å—åŒ–åœ¨ç¼–è¯‘å±‚çš„èƒœåˆ©æœå®</h3>
<p><strong>Vapor Modeæ˜¯Vue3æ¨¡å—åŒ–å“²å­¦åœ¨ç¼–è¯‘å±‚å»¶ä¼¸çš„æœ€ä½³è¯æ˜</strong>ã€‚åœ¨Vue 3.6ä¸­ï¼Œå®ƒæä¾›äº†ä¸€ç§<strong>å¯é€‰çš„ã€å…¨æ–°çš„ç¼–è¯‘æ¨¡å¼</strong>ã€‚</p>
<p>å…¶æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š<strong>åœ¨ç¼–è¯‘æ—¶è¿›è¡Œæè‡´çš„é™æ€åˆ†æï¼Œç›´æ¥ç”Ÿæˆé«˜æ•ˆæ“ä½œçœŸå®DOMçš„æŒ‡ä»¤ï¼Œä»è€Œåœ¨è¿è¡Œæ—¶å®Œå…¨è·³è¿‡è™šæ‹ŸDOMï¼ˆVDOMï¼‰çš„åˆ›å»ºä¸æ¯”å¯¹å¼€é”€ã€‚</strong></p>
<p>æœ€ä»¤äººèµå¹çš„æ˜¯ï¼Œ<strong>Vapor Modeå¯ä»¥é€šè¿‡å…¨æ–°çš„ <code>createVaporApp()</code> APIæ¥å¯ç”¨ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶æ‰€æœ‰ç”¨æˆ·è¿ç§»</strong>ã€‚è¿™å®Œå…¨å¾—ç›ŠäºVue3ä»ä¸€å¼€å§‹å°±è®¾è®¡çš„å¯æ’æ‹”æ¶æ„ä¸æ¸…æ™°çš„ç¼–è¯‘å±‚æŠ½è±¡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼ ç»Ÿåº”ç”¨ - åŸºäºè™šæ‹ŸDOM</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);

<span class="hljs-comment">// Vapor Mode åº”ç”¨ - ç›´æ¥æ“ä½œDOM (Vue 3.6+)</span>
<span class="hljs-keyword">import</span> { createVaporApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-title function_">createVaporApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
</code></pre>
<p>è¿™ç§è®¾è®¡è®©Vueå›¢é˜Ÿå¯ä»¥å¤§èƒ†æ¢ç´¢â€œæ¶ˆç­VDOMâ€è¿™æ ·æ¿€è¿›çš„æ–¹å‘ï¼Œä½œä¸ºä¸€ç§å¯é€‰æ–¹æ¡ˆæä¾›ç»™è¿½æ±‚æè‡´æ€§èƒ½çš„ç”¨æˆ·ï¼Œè€Œä¸æ¯«ä¸å½±å“ç°æœ‰åºå¤§ç”Ÿæ€çš„ç¨³å®šæ€§ã€‚<strong>Vapor Modeçš„æˆåŠŸå®æ–½è¯æ˜äº†è‰¯å¥½æ¶æ„çš„ä»·å€¼ï¼šå®ƒå…è®¸æ¡†æ¶åœ¨ä¿æŒå‘åå…¼å®¹çš„åŒæ—¶ï¼Œä¸æ–­çªç ´æ€§èƒ½è¾¹ç•Œã€‚</strong></p>
<h2 data-id="heading-9">æ ¸å¿ƒè®¾è®¡å“²å­¦å››ï¼šç±»å‹å®‰å…¨ä½œä¸ºä¸€ç­‰å…¬æ°‘</h2>
<p>Vue3ä»åº•å±‚å¼€å§‹å°±ä¸ºTypeScriptè®¾è®¡ï¼Œå…¶å·¥ç¨‹ç»“æ„å……åˆ†ä½“ç°äº†è¿™ä¸€ç‚¹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å®Œæ•´çš„ç±»å‹æ¨æ–­é“¾</span>
<span class="hljs-keyword">import</span> { defineComponent, <span class="hljs-title class_">PropType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineComponent</span>({
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">user</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">PropType</span>&lt;<span class="hljs-title class_">User</span>&gt;,
      <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
    }
  },
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-comment">// props.user ç±»å‹ä¸º Userï¼Œå®Œç¾æ¨æ–­</span>
    <span class="hljs-keyword">const</span> userName = props.<span class="hljs-property">user</span>.<span class="hljs-property">name</span>
  }
})
</code></pre>
<p>ç±»å‹ç³»ç»Ÿä¸ä»…ä»…æ˜¯ä¸€ä¸ªâ€œé™„åŠ åŠŸèƒ½â€ï¼Œè€Œæ˜¯æ¸—é€åˆ°æ¯ä¸ªæ¨¡å—çš„æ¥å£è®¾è®¡ä¸­ï¼Œä»<code>reactivity</code>åˆ°<code>compiler-core</code>ï¼Œæ¯ä¸ªå…¬å…±APIéƒ½ä¼´éšç€ç²¾ç¡®çš„ç±»å‹å®šä¹‰ã€‚</p>
<h2 data-id="heading-10">å®è·µå¯ç¤ºï¼šå¦‚ä½•å°†Vue3çš„è®¾è®¡å“²å­¦åº”ç”¨äºä½ çš„é¡¹ç›®ï¼Ÿ</h2>
<h3 data-id="heading-11">1. åŸºäºåŠŸèƒ½è€Œéç±»å‹ç»„ç»‡ä»£ç </h3>
<p>Vue3çš„æºç æŒ‰åŠŸèƒ½ï¼ˆç¼–è¯‘å™¨ã€è¿è¡Œæ—¶ã€å“åº”å¼ï¼‰è€Œéç±»å‹ï¼ˆç»„ä»¶ã€å·¥å…·ã€æ ·å¼ï¼‰ç»„ç»‡ã€‚è¿™å¯å‘æˆ‘ä»¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¼ ç»Ÿç»„ç»‡æ–¹å¼ï¼ˆä¸æ¨èï¼‰</span>
src/
â”œâ”€â”€ components/
â”œâ”€â”€ utils/
â”œâ”€â”€ styles/
â””â”€â”€ types/

<span class="hljs-comment"># Vue3å¯å‘çš„æ–¹å¼ï¼ˆæ¨èï¼‰</span>
src/
â”œâ”€â”€ user-profile/     <span class="hljs-comment"># åŠŸèƒ½æ¨¡å—</span>
â”‚   â”œâ”€â”€ component.vue
â”‚   â”œâ”€â”€ composables.ts
â”‚   â”œâ”€â”€ types.ts
â”‚   â””â”€â”€ utils.ts
â”œâ”€â”€ data-fetching/    <span class="hljs-comment"># å¦ä¸€åŠŸèƒ½æ¨¡å—</span>
â”‚   â”œâ”€â”€ composables.ts
â”‚   â””â”€â”€ types.ts
</code></pre>
<h3 data-id="heading-12">2. è®¾è®¡ç¨³å®šçš„æ¥å£å¥‘çº¦</h3>
<p><strong>è¿™æ˜¯æˆ‘ä»Vue3æ¶æ„ä¸­å­¦åˆ°çš„æœ€é‡è¦ä¸€è¯¾</strong>ï¼šå®šä¹‰æ¸…æ™°çš„æ¨¡å—æ¥å£ï¼Œå¹¶ä¿æŒæ¥å£çš„ç¨³å®šæ€§ã€‚åªè¦æ¥å£ä¸å˜ï¼Œå†…éƒ¨å®ç°å¯ä»¥è‡ªç”±é‡æ„ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ¸…æ™°çš„æ¥å£å®šä¹‰æ˜¯æ¨¡å—åŒ–æˆåŠŸçš„å…³é”®</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DataFetcher</span> {
  fetch&lt;T&gt;(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt;
  <span class="hljs-comment">// æ¥å£ä¸€æ—¦ç¡®å®šï¼Œå°½é‡ä¿æŒä¸å˜</span>
}

<span class="hljs-comment">// å®ç°å¯ä»¥éšæ—¶ä¼˜åŒ–ç”šè‡³é‡å†™</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HttpFetcher</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DataFetcher</span> {
  <span class="hljs-comment">// ç¬¬ä¸€ç‰ˆå®ç°ï¼šåŸºäºfetch</span>
  <span class="hljs-keyword">async</span> fetch&lt;T&gt;(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;T&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url)
    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>()
  }
  
  <span class="hljs-comment">// æœªæ¥å¯ä»¥é‡æ„ä¸ºåŸºäºaxiosæˆ–å…¶ä»–åº“</span>
  <span class="hljs-comment">// åªè¦æ¥å£ä¸å˜ï¼Œè°ƒç”¨æ–¹æ— éœ€ä¿®æ”¹</span>
}
</code></pre>
<h3 data-id="heading-13">3. æ‹¥æŠ±æ¸è¿›å¢å¼ºçš„è®¾è®¡æ¨¡å¼</h3>
<p>ä¸è¦è¯•å›¾ä¸€å¼€å§‹å°±æ„å»ºå®Œç¾ç³»ç»Ÿã€‚åƒVue3ä¸€æ ·ï¼Œä»æ ¸å¿ƒåŠŸèƒ½å¼€å§‹ï¼Œé€šè¿‡æ¸…æ™°çš„æ‰©å±•ç‚¹é€æ­¥å¢å¼ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ ¸å¿ƒåŠŸèƒ½æ¨¡å—</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CoreModule</span> {
  <span class="hljs-comment">// æœ€åŸºæœ¬çš„åŠŸèƒ½</span>
}

<span class="hljs-comment">// é€šè¿‡æ’ä»¶ç³»ç»Ÿå¢å¼º</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Plugin</span> {
  <span class="hljs-title function_">install</span>(<span class="hljs-attr">module</span>: <span class="hljs-title class_">CoreModule</span>): <span class="hljs-built_in">void</span>
}

<span class="hljs-comment">// æ¸è¿›å¢å¼ºï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§æ„å»º</span>
<span class="hljs-keyword">const</span> enhancedModule = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CoreModule</span>()
enhancedModule.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformancePlugin</span>())
enhancedModule.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AnalyticsPlugin</span>())
</code></pre>
<h3 data-id="heading-14">4. è®¾è®¡å¯æµ‹è¯•çš„æ¶æ„</h3>
<p>Vue3çš„æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥ç‹¬ç«‹æµ‹è¯•ï¼Œè¿™ç§è®¾è®¡ä½¿æµ‹è¯•æ›´åŠ ç®€å•ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å•ç‹¬æµ‹è¯•å“åº”å¼ç³»ç»Ÿ</span>
<span class="hljs-keyword">import</span> { reactive, effect } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vue/reactivity'</span>

<span class="hljs-title function_">describe</span>(<span class="hljs-string">'reactivity system'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'should react to changes'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> })
    <span class="hljs-keyword">let</span> dummy
    <span class="hljs-title function_">effect</span>(<span class="hljs-function">() =&gt;</span> { dummy = state.<span class="hljs-property">count</span> })
    <span class="hljs-title function_">expect</span>(dummy).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">0</span>)
    state.<span class="hljs-property">count</span>++
    <span class="hljs-title function_">expect</span>(dummy).<span class="hljs-title function_">toBe</span>(<span class="hljs-number">1</span>)
  })
})
</code></pre>
<h2 data-id="heading-15">ç»“è¯­ï¼šå·¥ç¨‹ç»“æ„æ˜¯æ€æƒ³çš„å®¹å™¨</h2>
<p>Vue3çš„å·¥ç¨‹ç»“æ„å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªçœŸç†ï¼š<strong>ä¼˜ç§€çš„è½¯ä»¶è®¾è®¡ä¸ä»…ä»…æ˜¯å…³äºä»£ç æ€ä¹ˆå†™ï¼Œæ›´æ˜¯å…³äºä»£ç å¦‚ä½•ç»„ç»‡</strong>ã€‚æ¯ä¸€ä¸ªç›®å½•ã€æ¯ä¸€ä¸ªæ¨¡å—åˆ’åˆ†ã€æ¯ä¸€ä¸ªæ¥å£å®šä¹‰ï¼Œéƒ½æ˜¯è®¾è®¡æ€æƒ³çš„ä½“ç°ã€‚</p>
<p><strong>æˆ‘æœ€æ¬£èµVue3æ¶æ„çš„ä¸€ç‚¹æ˜¯ï¼šå®ƒè¯æ˜äº†è‰¯å¥½çš„è®¾è®¡ä¸æ˜¯çº¦æŸï¼Œè€Œæ˜¯è‡ªç”±ã€‚</strong> æ­£æ˜¯å› ä¸ºæœ‰äº†æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œå’Œç¨³å®šçš„æ¥å£ï¼ŒVueå›¢é˜Ÿæ‰æ•¢åœ¨3.6ç‰ˆæœ¬ä¸­å°†æ ¸å¿ƒå“åº”å¼ç³»ç»Ÿæ›¿æ¢ä¸ºç¤¾åŒºé«˜æ€§èƒ½çš„<code>alien-signals</code>åº“ï¼Œå¹¶å¼•å…¥åƒVapor Modeè¿™æ ·é©å‘½æ€§çš„ç¼–è¯‘æ¨¡å¼ã€‚è¿™äº›éƒ½ä¸æ˜¯ç ´åæ€§æ›´æ–°ï¼Œè€Œæ˜¯ä½œä¸ºå¯é€‰é¡¹ï¼Œä¸ºå¼€å‘è€…æä¾›äº†å¹³æ»‘çš„å‡çº§è·¯å¾„å’Œæ›´é«˜çš„æ€§èƒ½å¤©èŠ±æ¿ã€‚</p>
<p>Vue3çš„æˆåŠŸä¸ä»…åœ¨äºå…¶åˆ›æ–°çš„APIï¼Œæ›´åœ¨äºå…¶èƒŒåçš„æ¶æ„å“²å­¦ï¼š</p>
<ul>
<li><strong>æ¸…æ™°èƒœè¿‡èªæ˜</strong>ï¼šæ¨¡å—è¾¹ç•Œæ¸…æ™°ï¼ŒèŒè´£æ˜ç¡®</li>
<li><strong>ç»„åˆèƒœè¿‡ç»§æ‰¿</strong>ï¼šå°æ¨¡å—ç»„åˆæˆå¤§ç³»ç»Ÿ</li>
<li><strong>æ¸è¿›èƒœè¿‡é¢ è¦†</strong>ï¼šä»æ ¸å¿ƒåˆ°å®Œæ•´æ¡†æ¶çš„å¹³æ»‘è¿‡æ¸¡</li>
<li><strong>å¼€æ”¾èƒœè¿‡å°é—­</strong>ï¼šæ¯ä¸ªæ¨¡å—éƒ½å¯ç‹¬ç«‹ä½¿ç”¨ï¼Œç”šè‡³å¯è¢«å¤–éƒ¨å®ç°æ›¿æ¢</li>
<li><strong>ç¨³å®šèƒœè¿‡å¤šå˜</strong>ï¼šæ¥å£ç¨³å®šï¼Œå®ç°è‡ªç”±</li>
</ul>
<p>è¿™äº›åŸåˆ™ä¸ä»…é€‚ç”¨äºæ¡†æ¶è®¾è®¡ï¼ŒåŒæ ·é€‚ç”¨äºæˆ‘ä»¬çš„æ—¥å¸¸é¡¹ç›®ã€‚å½“ä½ ä¸‹æ¬¡å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®æ—¶ï¼Œä¸å¦¨æ€è€ƒï¼šè¿™ä¸ªé¡¹ç›®çš„â€œå·¥ç¨‹ç»“æ„â€ä¼ è¾¾äº†ä»€ä¹ˆæ ·çš„è®¾è®¡å“²å­¦ï¼Ÿ</p>
<hr/>
<p><strong>æœ€åçš„è®¾è®¡å¯ç¤º</strong>ï¼šæœ€ä¼˜ç§€çš„å·¥ç¨‹ç»“æ„ï¼Œæ˜¯é‚£ç§èƒ½è®©æ–°å¼€å‘è€…ä¸€çœ¼çœ‹æ˜ç™½ç³»ç»Ÿå¦‚ä½•å·¥ä½œã€è€å¼€å‘è€…è½»æ¾å®šä½é—®é¢˜çš„ç»“æ„ã€‚Vue3åšåˆ°äº†è¿™ä¸€ç‚¹â€”â€”å®ƒæ‰“å¼€äº†è‡ªå·±çš„é»‘åŒ£å­ï¼Œé‚€è¯·æˆ‘ä»¬æ‰€æœ‰äººä¸€èµ·æ€è€ƒã€å­¦ä¹ å’Œåˆ›é€ ã€‚<strong>è€Œæœ€ä»¤äººæƒŠå¹çš„æ˜¯ï¼Œè¿™ç§å¼€æ”¾å’Œæ¨¡å—åŒ–å¹¶æ²¡æœ‰å¯¼è‡´æ··ä¹±ï¼Œåè€Œè®©Vueèƒ½å¤Ÿæ›´å®‰å…¨ã€æ›´æ¿€è¿›åœ°æ¼”è¿›â€”â€”æ— è®ºæ˜¯æ•´åˆç¤¾åŒºå‰æ²¿æˆæœï¼Œè¿˜æ˜¯æ¢ç´¢è·³è¿‡è™šæ‹ŸDOMçš„æ¸²æŸ“æ¨¡å¼ã€‚</strong></p>
<p><strong>è‰¯å¥½çš„æ¶æ„ä¸æ˜¯é™åˆ¶å˜åŒ–çš„ç‰¢ç¬¼ï¼Œè€Œæ˜¯èµ‹èƒ½åˆ›æ–°çš„å¹³å°</strong>ã€‚å®ƒè®©é‡æ„ä¸å†å¯æ€•ï¼Œè®©å‡çº§ä¸å†ç—›è‹¦ï¼Œè®©æ€§èƒ½çªç ´æˆä¸ºå¯èƒ½ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»äº”ä¸ªå…³é”®ç»´åº¦é‡æ–°å®¡è§† RAG æ¶æ„è®¾è®¡]]></title>    <link>https://juejin.cn/post/7584731726732214287</link>    <guid>https://juejin.cn/post/7584731726732214287</guid>    <pubDate>2025-12-18T01:56:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584731726732214287" data-draft-id="7584719268043440162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»äº”ä¸ªå…³é”®ç»´åº¦é‡æ–°å®¡è§† RAG æ¶æ„è®¾è®¡"/> <meta itemprop="keywords" content="LLM,AIç¼–ç¨‹,AIGC"/> <meta itemprop="datePublished" content="2025-12-18T01:56:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Yooå‰ç«¯"/> <meta itemprop="url" content="https://juejin.cn/user/2791012486624116"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»äº”ä¸ªå…³é”®ç»´åº¦é‡æ–°å®¡è§† RAG æ¶æ„è®¾è®¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2791012486624116/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Yooå‰ç«¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T01:56:09.000Z" title="Thu Dec 18 2025 01:56:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»äº”ä¸ªå…³é”®ç»´åº¦é‡æ–°å®¡è§† RAG æ¶æ„è®¾è®¡</h2>
<blockquote>
<p>RAGï¼ˆRetrieval-Augmented Generationï¼‰æ­£åœ¨æˆä¸ºå¤§æ¨¡å‹è½åœ°çš„æ ‡å‡†èŒƒå¼ï¼Œä½†â€œç”¨äº† RAG â‰  ç³»ç»Ÿå°±å¯é â€ã€‚<br/>
çœŸæ­£å†³å®š RAG ä¸Šé™çš„ï¼Œæ˜¯ä¸€ç³»åˆ—å·¥ç¨‹ä¸æ¶æ„å±‚é¢çš„é€‰æ‹©ã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†ä» <strong>æ£€ç´¢å¬å›ç²¾ç¡®åº¦ã€å¯¹æŠ—å¹²æ‰°èƒ½åŠ›ã€ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ã€å¾®è°ƒç­–ç•¥é€‰æ‹©ã€å“åº”æ€§èƒ½é—®é¢˜</strong> äº”ä¸ªç»´åº¦ï¼Œç³»ç»Ÿåˆ†æ RAG æ¶æ„çš„æ ¸å¿ƒæŒ‘æˆ˜ä¸æ¼”è¿›æ–¹å‘ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€æ£€ç´¢å¬å›ç²¾ç¡®åº¦ï¼šRAG çš„ç¬¬ä¸€æ€§åŸç†</h3>
<p>RAG çš„æœ¬è´¨å¹¶ä¸æ˜¯â€œç”Ÿæˆâ€ï¼Œè€Œæ˜¯ <strong>â€œæŠŠå¯¹çš„çŸ¥è¯†ï¼Œåœ¨å¯¹çš„æ—¶é—´ï¼Œé€åˆ°æ¨¡å‹é¢å‰â€</strong> ã€‚<br/>
å› æ­¤ï¼Œ<strong>æ£€ç´¢å¬å›è´¨é‡ç›´æ¥å†³å®šäº†å›ç­”ä¸Šé™</strong>ã€‚</p>
<h4 data-id="heading-2">1. å¬å› â‰  å‡†ç¡®</h4>
<p>åœ¨å·¥ç¨‹ä¸­ï¼Œå¸¸è§é—®é¢˜åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¯­ä¹‰ç›¸ä¼¼ä½†äº‹å®ä¸ç›¸å…³</li>
<li>å¬å›å†…å®¹å†—ä½™ã€å™ªå£°å¤š</li>
<li>Top-K å‘½ä¸­ä½†å…³é”®ä¿¡æ¯ç¼ºå¤±</li>
</ul>
<p><strong>RAG å¤±è´¥çš„ 80% åŸå› æ¥è‡ªæ£€ç´¢ï¼Œè€Œéæ¨¡å‹ã€‚</strong></p>
<h4 data-id="heading-3">2. å½±å“å¬å›ç²¾åº¦çš„å…³é”®å› ç´ </h4>

























<table><thead><tr><th>å±‚çº§</th><th>æ ¸å¿ƒé—®é¢˜</th></tr></thead><tbody><tr><td>æ•°æ®å±‚</td><td>æ–‡æ¡£è´¨é‡ã€ç»“æ„æ··ä¹±ã€æ—¶æ•ˆæ€§</td></tr><tr><td>Chunk å±‚</td><td>åˆ‡åˆ†ç²’åº¦ä¸åˆç†</td></tr><tr><td>Embedding</td><td>æ¨¡å‹ä¸åŒ¹é…ä¸šåŠ¡è¯­ä¹‰</td></tr><tr><td>æ£€ç´¢ç­–ç•¥</td><td>å•å‘é‡å¬å›èƒ½åŠ›æœ‰é™</td></tr></tbody></table>
<h4 data-id="heading-4">3. å·¥ç¨‹ä¼˜åŒ–è·¯å¾„</h4>
<ul>
<li><strong>Chunk è¯­ä¹‰åŒ–åˆ‡åˆ†</strong>ï¼ˆè€Œéå›ºå®šé•¿åº¦ï¼‰</li>
<li><strong>Hybrid Searchï¼ˆå…³é”®è¯ + å‘é‡ï¼‰</strong></li>
<li><strong>Re-rankingï¼ˆCross Encoderï¼‰</strong></li>
<li><strong>Query Rewrite / Multi-Query</strong></li>
</ul>
<blockquote>
<p>ç»éªŒç»“è®ºï¼š<br/>
<strong>â€œå¬å›åšä¸å¥½ï¼Œåé¢ä¸€åˆ‡éƒ½æ˜¯è¡¥æ•‘ã€‚â€</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-5">äºŒã€è‡ªèº«å¯¹æŠ—å¹²æ‰°èƒ½åŠ›ï¼šRAG å¹¶ä¸å¤©ç„¶å®‰å…¨</h3>
<p>å¾ˆå¤šäººè¯¯ä»¥ä¸ºï¼š</p>
<blockquote>
<p>â€œæœ‰äº† RAGï¼Œå¤§æ¨¡å‹å°±ä¸ä¼šèƒ¡è¯´äº†ã€‚â€</p>
</blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªå±é™©çš„é”™è§‰ã€‚</p>
<h4 data-id="heading-6">1. RAG é¢ä¸´çš„å…¸å‹å¹²æ‰°</h4>
<ul>
<li><strong>Prompt Injection</strong>ï¼ˆæ–‡æ¡£ä¸­åµŒå…¥æŒ‡ä»¤ï¼‰</li>
<li><strong>æ£€ç´¢æŠ•æ¯’</strong>ï¼ˆæ¶æ„æ–‡æ¡£è¢«å¬å›ï¼‰</li>
<li><strong>ä¸Šä¸‹æ–‡å†²çª</strong>ï¼ˆå¤šä»½èµ„æ–™ç»“è®ºä¸ä¸€è‡´ï¼‰</li>
<li><strong>ç”¨æˆ·è¯±å¯¼ç»•è¿‡çº¦æŸ</strong></li>
</ul>
<h4 data-id="heading-7">2. RAG çš„è„†å¼±ç‚¹</h4>
<p>RAG çš„ä¸Šä¸‹æ–‡æœ¬è´¨ä¸Šæ˜¯ï¼š</p>
<pre><code class="hljs">ä¸å—ä¿¡ä»»çš„å¤–éƒ¨è¾“å…¥
</code></pre>
<p>æ¨¡å‹å¹¶ä¸èƒ½åŒºåˆ†ï¼š</p>
<ul>
<li>å“ªæ˜¯â€œçŸ¥è¯†â€</li>
<li>å“ªæ˜¯â€œæŒ‡ä»¤â€</li>
<li>å“ªæ˜¯â€œå™ªå£°â€</li>
</ul>
<h4 data-id="heading-8">3. æ¶æ„çº§å¯¹æŠ—ç­–ç•¥</h4>
<ul>
<li>
<p><strong>ä¸Šä¸‹æ–‡æŒ‡ä»¤éš”ç¦»</strong></p>
<ul>
<li>System Prompt æ˜ç¡®ï¼š <em>â€œæ–‡æ¡£å†…å®¹ä¸æ˜¯æŒ‡ä»¤â€</em></li>
</ul>
</li>
<li>
<p><strong>æ–‡æ¡£ç™½åå• / æ¥æºè¯„åˆ†</strong></p>
</li>
<li>
<p><strong>æ£€ç´¢ç»“æœå®‰å…¨è¿‡æ»¤</strong></p>
</li>
<li>
<p><strong>æ¨¡å‹è¾“å‡ºæ ¡éªŒï¼ˆRefusal / Citation Checkï¼‰</strong></p>
</li>
</ul>
<blockquote>
<p>RAG ä¸æ˜¯å®‰å…¨æœºåˆ¶ï¼Œå®ƒåªæ˜¯çŸ¥è¯†æ³¨å…¥æœºåˆ¶ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-9">ä¸‰ã€ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ï¼šRAG çš„ç‰©ç†å¤©èŠ±æ¿</h3>
<p>å³ä½¿æ¨¡å‹ä¸Šä¸‹æ–‡çª—å£ä¸æ–­æ‰©å¤§ï¼Œ<strong>ä¸Šä¸‹æ–‡ä»ç„¶æ˜¯ç¨€ç¼ºèµ„æº</strong>ã€‚</p>
<h4 data-id="heading-10">1. ä¸‰é‡é™åˆ¶</h4>
<ul>
<li><strong>Token æˆæœ¬</strong></li>
<li><strong>æ¨¡å‹æ³¨æ„åŠ›è¡°å‡</strong></li>
<li><strong>é•¿ä¸Šä¸‹æ–‡æ¨ç†ä¸ç¨³å®š</strong></li>
</ul>
<h4 data-id="heading-11">2. å¸¸è§è¯¯åŒº</h4>
<ul>
<li>Top-K ç›²ç›®å¢å¤§</li>
<li>æŠŠæ•´ç¯‡æ–‡æ¡£å¡è¿› Prompt</li>
<li>ä¸åŒºåˆ†ä¸»æ¬¡ä¿¡æ¯</li>
</ul>
<h4 data-id="heading-12">3. æ¶æ„åº”å¯¹ç­–ç•¥</h4>

























<table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>å‹ç¼©å¼ RAG</td><td>å…ˆæ€»ç»“å†æ³¨å…¥</td></tr><tr><td>åˆ†å±‚ RAG</td><td>ç²—å¬å› â†’ ç²¾å¬å›</td></tr><tr><td>Map-Reduce RAG</td><td>å¤šè½®æ±‡æ€»</td></tr><tr><td>åŠ¨æ€ä¸Šä¸‹æ–‡è£å‰ª</td><td>Query-aware selection</td></tr></tbody></table>
<p><strong>è®¾è®¡ç›®æ ‡ä¸æ˜¯â€œæ”¾å¾—å¤šâ€ï¼Œè€Œæ˜¯â€œæ”¾å¾—å‡†â€ã€‚</strong></p>
<hr/>
<h3 data-id="heading-13">å››ã€å¾®è°ƒçš„é€‰æ‹©ï¼šRAG ä¸æ˜¯å¾®è°ƒçš„æ›¿ä»£å“</h3>
<p>ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯ï¼š</p>
<blockquote>
<p>â€œæ—¢ç„¶æœ‰ RAGï¼Œè¿˜è¦ä¸è¦å¾®è°ƒï¼Ÿâ€</p>
</blockquote>
<h4 data-id="heading-14">1. RAG vs å¾®è°ƒçš„è¾¹ç•Œ</h4>






























<table><thead><tr><th>èƒ½åŠ›</th><th>RAG</th><th>å¾®è°ƒ</th></tr></thead><tbody><tr><td>å¼•å…¥æ–°çŸ¥è¯†</td><td>âœ…</td><td>âŒ</td></tr><tr><td>æ”¹å˜è¡Œä¸ºæ¨¡å¼</td><td>âŒ</td><td>âœ…</td></tr><tr><td>ç»Ÿä¸€è¾“å‡ºé£æ ¼</td><td>æœ‰é™</td><td>âœ…</td></tr><tr><td>é™ä½ Prompt å¤æ‚åº¦</td><td>âŒ</td><td>âœ…</td></tr></tbody></table>
<h4 data-id="heading-15">2. å·¥ç¨‹ä¸Šçš„æœ€ä½³å®è·µ</h4>
<ul>
<li><strong>ç”¨ RAG è§£å†³â€œçŸ¥è¯†â€é—®é¢˜</strong></li>
<li><strong>ç”¨å¾®è°ƒè§£å†³â€œè¡Œä¸ºâ€é—®é¢˜</strong></li>
</ul>
<p>å…¸å‹ç»„åˆï¼š</p>
<ul>
<li>å¾®è°ƒæ¨¡å‹çš„å›ç­”é£æ ¼ã€æ ¼å¼ã€çº¦æŸèƒ½åŠ›</li>
<li>RAG æä¾›å®æ—¶ã€å¯æ›´æ–°çš„çŸ¥è¯†</li>
</ul>
<blockquote>
<p>é«˜æˆç†Ÿåº¦ç³»ç»Ÿ = <strong>RAG + è½»é‡å¾®è°ƒ</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-16">äº”ã€å“åº”æ€§èƒ½é—®é¢˜ï¼šRAG æ˜¯â€œæ…¢â€çš„</h3>
<p>ä¸çº¯ LLM è°ƒç”¨ç›¸æ¯”ï¼ŒRAG å¤©ç„¶å¼•å…¥äº†å¤šæ®µé“¾è·¯ã€‚</p>
<h4 data-id="heading-17">1. æ€§èƒ½ç“¶é¢ˆæ¥æº</h4>
<ul>
<li>Embedding è®¡ç®—</li>
<li>å‘é‡æ£€ç´¢</li>
<li>Re-rank</li>
<li>Prompt æ„å»º</li>
<li>LLM æ¨ç†</li>
</ul>
<h4 data-id="heading-18">2. å»¶è¿Ÿæ˜¯ç´¯åŠ çš„</h4>
<pre><code class="hljs">æ€»å»¶è¿Ÿ = æ£€ç´¢ + æ’åº + æ„å»º + æ¨ç†
</code></pre>
<h4 data-id="heading-19">3. å·¥ç¨‹çº§ä¼˜åŒ–æ‰‹æ®µ</h4>
<ul>
<li><strong>Embedding ç»“æœç¼“å­˜</strong></li>
<li><strong>å‘é‡ç´¢å¼•å†·çƒ­åˆ†å±‚</strong></li>
<li><strong>å¼‚æ­¥ / å¹¶è¡Œæ£€ç´¢</strong></li>
<li><strong>Top-K åŠ¨æ€è°ƒèŠ‚</strong></li>
<li><strong>æµå¼ç”Ÿæˆï¼ˆStreamingï¼‰</strong></li>
</ul>
<p>åœ¨é«˜å¹¶å‘åœºæ™¯ï¼ˆå®¢æœã€æœç´¢ï¼‰ï¼Œ<strong>RAG æ€§èƒ½ä¼˜åŒ–æœ¬è´¨æ˜¯ç³»ç»Ÿå·¥ç¨‹é—®é¢˜ï¼Œè€Œéæ¨¡å‹é—®é¢˜</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-20">å…­ã€æ€»ç»“ï¼šRAG æ˜¯ç³»ç»Ÿå·¥ç¨‹ï¼Œä¸æ˜¯æ¨¡å‹æŠ€å·§</h3>
<p>RAG çš„çœŸæ­£ä»·å€¼ï¼Œä¸åœ¨äºâ€œæŠŠæ–‡æ¡£å¡è¿› Promptâ€ï¼Œ<br/>
è€Œåœ¨äº <strong>å¦‚ä½•æ„å»ºä¸€ä¸ªå¯æ§ã€å¯æ‰©å±•ã€å¯è¿›åŒ–çš„çŸ¥è¯†æ³¨å…¥ç³»ç»Ÿ</strong>ã€‚</p>
<h4 data-id="heading-21">ä¸€å¥è¯æ€»ç»“äº”ä¸ªç»´åº¦ï¼š</h4>
<ul>
<li><strong>ç²¾ç¡®åº¦</strong>ï¼šæ£€ç´¢å†³å®šä¸Šé™</li>
<li><strong>å®‰å…¨æ€§</strong>ï¼šRAG ä¸è‡ªå¸¦å…ç–«åŠ›</li>
<li><strong>çª—å£é™åˆ¶</strong>ï¼šä¸Šä¸‹æ–‡æ˜¯ç¨€ç¼ºèµ„æº</li>
<li><strong>å¾®è°ƒé€‰æ‹©</strong>ï¼šçŸ¥è¯†ä¸è¡Œä¸ºè¦åˆ†æ²»</li>
<li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šRAG æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿ</li>
</ul>
<blockquote>
<p>å½“ RAG è¢«å½“æˆâ€œæ¶æ„â€è€Œä¸æ˜¯â€œæŠ€å·§â€æ—¶ï¼Œ   å®ƒæ‰èƒ½çœŸæ­£æ”¯æ’‘ç”Ÿäº§çº§ AI åº”ç”¨ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[âš›ï¸ React 17 vs React 18ï¼šLanes æ˜¯åŒä¸€ä¸ªæ¨¡å‹ï¼Œä½†è·‘æ³•ä¸ä¸€æ ·]]></title>    <link>https://juejin.cn/post/7584730308752556082</link>    <guid>https://juejin.cn/post/7584730308752556082</guid>    <pubDate>2025-12-18T01:56:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584730308752556082" data-draft-id="7584725529876054066" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="âš›ï¸ React 17 vs React 18ï¼šLanes æ˜¯åŒä¸€ä¸ªæ¨¡å‹ï¼Œä½†è·‘æ³•ä¸ä¸€æ ·"/> <meta itemprop="keywords" content="å‰ç«¯,æ¶æ„,React.js"/> <meta itemprop="datePublished" content="2025-12-18T01:56:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            âš›ï¸ React 17 vs React 18ï¼šLanes æ˜¯åŒä¸€ä¸ªæ¨¡å‹ï¼Œä½†è·‘æ³•ä¸ä¸€æ ·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T01:56:20.000Z" title="Thu Dec 18 2025 01:56:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"â";top:8px;left:5px}.markdown-body blockquote:after{content:"â";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ React å†…éƒ¨ï¼Œæ¯ä¸€æ¬¡æ¸²æŸ“ä»»åŠ¡éƒ½ä¼šç»™ä¸åŒçš„æ›´æ–°åˆ†é…ä¸€ä¸ªâ€œä¼˜å…ˆçº§â€ã€‚<br/>
React 17 å¼€å§‹ï¼ŒFiber æ¶æ„ä¸­å¼•å…¥äº† <strong>Lanes æ¨¡å‹ï¼ˆè½¦é“æ¨¡å‹ï¼‰</strong> â€”â€”å°±åƒé«˜é€Ÿå…¬è·¯ä¸€æ ·ï¼Œä¸åŒç±»å‹çš„æ›´æ–°åœ¨ä¸åŒè½¦é“ä¸Šå¹¶è¡Œè¡Œé©¶ï¼Œä¾‹å¦‚ç”¨æˆ·è¾“å…¥ã€ç½‘ç»œè¯·æ±‚ã€åŠ¨ç”»æ¸²æŸ“ç­‰ã€‚</p>
<p>ä½†åˆ°äº† React 18ï¼Œ<strong>è¿™æ¡â€œé«˜é€Ÿå…¬è·¯â€æ­£å¼é€šè½¦è¿›å…¥å¹¶å‘æ¨¡å¼</strong> ğŸš¦ã€‚</p>
<hr/>
<h2 data-id="heading-0">ğŸ§© 1. Lanes æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</h2>
<p>ç®€å•åœ°è¯´ï¼Œ<strong>Lanes æ˜¯æ¯” ExpirationTime æ›´çµæ´»çš„ä»»åŠ¡ä¼˜å…ˆçº§ç³»ç»Ÿ</strong>ã€‚</p>





















<table><thead><tr><th>æ¯”å–»</th><th>æŠ€æœ¯è§£é‡Š</th></tr></thead><tbody><tr><td>ğŸš— æ¯è¾†è½¦æ˜¯ä¸€æ¡çŠ¶æ€æ›´æ–°ï¼ˆsetStateï¼‰</td><td>Fiber èŠ‚ç‚¹æ›´æ–°ä»»åŠ¡</td></tr><tr><td>ğŸ›£ æ¯æ¡è½¦é“æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§ï¼ˆLaneï¼‰</td><td>ä¸åŒä»»åŠ¡çš„è°ƒåº¦ä¼˜å…ˆçº§</td></tr><tr><td>ğŸš§ äº¤é€šè§„åˆ™æ˜¯è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰</td><td>React Scheduler æ§åˆ¶ä½•æ—¶æ‰§è¡Œå“ªä¸ª Lane</td></tr></tbody></table>
<p>ğŸ‘‰ React ä¼šæŠŠä¸åŒç±»å‹çš„æ›´æ–°æ”¾è¿›ä¸åŒçš„ Laneï¼Œ<br/>
å†æ ¹æ®ä¼˜å…ˆçº§ï¼ˆpriorityï¼‰åˆå¹¶æˆ–åˆ†è£‚æ‰§è¡Œï¼Œè¾¾åˆ°çµæ´»è°ƒåº¦çš„ç›®çš„ã€‚</p>
<hr/>
<h2 data-id="heading-1">âš™ï¸ 2. React 17ï¼šæœ‰ Lanesï¼Œä½†æ²¡â€œé€šè½¦â€ ğŸš§</h2>
<p>åœ¨ React 17 ä¸­ï¼ŒLanes å·²ç»å®ç°ï¼Œä½†å‡ ä¹<strong>å…¨éƒ½åœ¨å¹•åè¿è¡Œ</strong>ã€‚<br/>
ä¹‹æ‰€ä»¥å¼•å…¥å®ƒï¼Œæ˜¯ä¸ºäº†åç»­çš„ <strong>å¹¶å‘ç‰¹æ€§ï¼ˆConcurrent Featuresï¼‰</strong> é“ºè·¯ã€‚</p>
<blockquote>
<p>React 17 çš„ Lane æ›´åƒæ˜¯å‡†å¤‡å¥½çš„ç«‹äº¤æ¡¥ï¼Œä½†æ‰€æœ‰è½¦è¿˜æ˜¯èµ°åŒä¸€æ¡æ…¢è½¦é“ã€‚</p>
</blockquote>
<p>React 17 çš„æ›´æ–°ä¾ç„¶æ˜¯ <strong>åŒæ­¥é˜»å¡å¼è°ƒå’Œ</strong>ï¼š<br/>
å½“æœ‰ä¸€ä¸ªç»„ä»¶è¦é‡æ–°æ¸²æŸ“æ—¶ï¼ŒReact ä¸ä¼šåœä¸‹æ¥é—®â€œè¦ä¸è¦æš‚åœä¸€ä¸‹â€ï¼Œè€Œæ˜¯ç›´æ¥ä¸€è·¯å†²åˆ°åº•ã€‚</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">setState</span>(value); <span class="hljs-comment">// React 17: åŒæ­¥ã€ç›´æ¥é˜»å¡ä¸»çº¿ç¨‹</span>
</code></pre>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆç”¨æˆ·è¾“å…¥ï¼‰ä¸èƒ½ä¸­æ–­ä½ä¼˜å…ˆçº§ä»»åŠ¡ï¼›</li>
<li>æ…¢ç»„ä»¶ä¼šæ‹–å®æ•´æ¬¡æ›´æ–°ï¼›</li>
<li>â€œæ—¶é—´åˆ‡ç‰‡ (Time Slicing)â€ æ¦‚å¿µè¿˜æ²¡çœŸæ­£å¯ç”¨ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-2">âš¡ 3. React 18ï¼šLanes çœŸæ­£å¼€è·‘ï¼å¹¶å‘å¯ç”¨ ğŸš€</h2>
<p>React 18 å¼•å…¥äº† <strong>å¹¶å‘æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰</strong> ï¼Œ<br/>
è¿™è®© Lanes çš„ä½œç”¨æ­£å¼æ˜¾ç°ï¼š</p>
<blockquote>
<p>â€œä¸åŒä¼˜å…ˆçº§çš„ä»»åŠ¡åœ¨ä¸åŒè½¦é“ä¸Šè¡Œé©¶ï¼Œå¯ä»¥éšæ—¶åˆ‡æ¢ã€æš‚åœæˆ–æ¢å¤ã€‚â€</p>
</blockquote>
<h3 data-id="heading-3">ğŸ§  æ ¸å¿ƒæœºåˆ¶</h3>
<p>React 18 ä¼šæ ¹æ®æ›´æ–°ç±»å‹åˆ†é…ä¸åŒçš„ Laneï¼š</p>






























<table><thead><tr><th>æ›´æ–°ç±»å‹</th><th>Lane Priority</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>ğŸ•¹ ç”¨æˆ·äº¤äº’ï¼ˆç‚¹å‡»ã€è¾“å…¥ï¼‰</td><td><strong>SyncLane</strong>ï¼ˆæœ€é«˜ï¼‰</td><td><code>onClick</code>ï¼Œ<code>onChange</code></td></tr><tr><td>â± è¿‡æ¸¡æ›´æ–°ï¼ˆTransitionï¼‰</td><td><strong>TransitionLanes</strong></td><td><code>startTransition(() =&gt; setState(...))</code></td></tr><tr><td>ğŸ’¤ å¼‚æ­¥æ¸²æŸ“ï¼ˆæ•°æ®è¯·æ±‚ï¼‰</td><td><strong>DefaultLanes</strong> / Suspense</td><td>åŠ è½½æ•°æ®çš„ç»„ä»¶</td></tr><tr><td>ğŸŒ™ ç©ºé—²ä»»åŠ¡</td><td><strong>IdleLane</strong></td><td>åå°é¢„å–</td></tr></tbody></table>
<h3 data-id="heading-4">ğŸ§µ React 18 çš„æ‰§è¡Œæµç¨‹ï¼š</h3>
<ol>
<li>ç”¨æˆ·è°ƒç”¨ä¸€æ¬¡ <code>setState</code></li>
<li>React åˆ†é…ä¸€ä¸ª Laneï¼ˆæ¯”å¦‚ â€œTransitionLaneâ€ï¼‰</li>
<li>Scheduler æ£€æŸ¥æ˜¯å¦æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„æ›´æ–°åœ¨è¿›è¡Œ</li>
<li>å¦‚æœæœ‰ï¼Œæš‚åœå½“å‰æ¸²æŸ“ï¼ˆå³â€œæ‰“æ–­â€ï¼‰</li>
<li>ç­‰ç©ºé—²æ—¶é—´å†æ¢å¤æ¸²æŸ“</li>
</ol>
<p>è¿™æ ·ï¼Œä½ åœ¨ç•Œé¢ä¸­å¿«é€Ÿè¾“å…¥æ—¶ï¼Œä¸ä¼šè¢«æ…¢æ•°æ®æ¸²æŸ“å¡é¡¿æ‰€é˜»å¡ã€‚<br/>
æ¯”å¦‚ ğŸ‘‡</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { startTransition, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [query, setQuery] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [results, setResults] = <span class="hljs-title function_">useState</span>([]);

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleInput</span>(<span class="hljs-params">e</span>) {
    <span class="hljs-keyword">const</span> q = e.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>;
    <span class="hljs-title function_">setQuery</span>(q);
    
    <span class="hljs-comment">// ğŸ‘‡ å°†ç»“æœæ›´æ–°æ ‡è®°ä¸ºâ€œè¿‡æ¸¡ä»»åŠ¡â€</span>
    <span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">setResults</span>(<span class="hljs-title function_">expensiveSearch</span>(q)); <span class="hljs-comment">// å‡è®¾å¾ˆè€—æ—¶</span>
    });
  }

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{query}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleInput}</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¾“å…¥ä»¥æœç´¢..."</span> /&gt;</span></span>
  );
}
</code></pre>
<p>ğŸ§© <strong>ç»“æœï¼š</strong></p>
<ul>
<li>è¾“å…¥æ¡†æ›´æ–°ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰ğŸš—ğŸ’¨ åœ¨ FAST LANEã€‚</li>
<li>æœç´¢ç»“æœæ¸²æŸ“ï¼ˆä½ä¼˜å…ˆçº§ï¼‰ğŸš™ åœ¨ SLOW LANEã€‚</li>
<li>ç”¨æˆ·ä½“éªŒâ€”â€”é¡ºæ»‘å¦‚ä¸ğŸã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-5">ğŸ”® 4. åŒæ­¥ vs å¹¶å‘ï¼šçº¿ç¨‹æ²¡å˜ï¼Œè°ƒåº¦å˜äº†</h2>
<p>ğŸ§µ <strong>å¹¶å‘æ¸²æŸ“ â‰  å¤šçº¿ç¨‹</strong><br/>
React ä¾ç„¶è¿è¡Œåœ¨å•ä¸ª JS çº¿ç¨‹ï¼Œä½†é€šè¿‡<strong>åˆ†ç‰‡è°ƒåº¦ (time slicing)</strong> å®ç°ä»»åŠ¡â€œè®©å‡ºæ—¶é—´â€ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">while (hasNextUnitOfWork &amp;&amp; timeRemaining() &gt; <span class="hljs-number">1</span>) {
  <span class="hljs-built_in">performUnitOfWork</span>(nextUnitOfWork);
}
</code></pre>
<p>æ¯ä¸ª Fiber æ›´æ–°ç§°ä¸ºä¸€ä¸ª â€œUnit of Workâ€ï¼Œ<br/>
React åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šä¸æ–­æ£€æŸ¥æ˜¯å¦è¯¥â€œè®©è·¯â€ï¼š</p>
<ul>
<li>æµè§ˆå™¨è¦ç»˜åˆ¶ï¼Ÿâ¡ï¸ æš‚åœï¼›</li>
<li>ç”¨æˆ·æœ‰è¾“å…¥äº‹ä»¶ï¼Ÿâ¡ï¸ ç«‹å³å“åº”ï¼›</li>
<li>ä¸»çº¿ç¨‹ç©ºé—²ï¼Ÿâ¡ï¸ ç»§ç»­æ¸²æŸ“ã€‚</li>
</ul>
<p>è¿™ç§è¡Œä¸ºå°±åƒã€Šç–¯ç‹‚åŠ¨ç‰©åŸã€‹é‡Œçš„é—ªç”µæ ‘æ‡’ ğŸ¦¥ çªç„¶å–äº†å‡ æ¯çº¢ç‰›â€”â€”ä¾æ—§é¡ºåºæ‰§è¡Œï¼Œä½†â€œæ‡‚å¾—è®©è·¯â€ã€‚</p>
<hr/>
<h2 data-id="heading-6">ğŸ§® 5. React 17 vs 18 Lane è°ƒåº¦å·®å¼‚å›¾</h2>



































<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>React 17</th><th>React 18</th></tr></thead><tbody><tr><td>Lane ç³»ç»Ÿ</td><td>å†…éƒ¨å­˜åœ¨ä½†æœªå…¨é¢å¯ç”¨</td><td>å…¨é‡å¯ç”¨</td></tr><tr><td>å¹¶å‘æ¸²æŸ“</td><td>âŒ åŒæ­¥é˜»å¡</td><td>âœ… æ”¯æŒä¸­æ–­ / æ¢å¤</td></tr><tr><td>Transition API</td><td>âŒ æ— </td><td>âœ… <code>startTransition</code> ç­‰</td></tr><tr><td>Scheduler ä¼˜å…ˆçº§</td><td>é™æ€åˆ†é…</td><td>åŠ¨æ€åˆ†é…ï¼Œå¤šçº§ä¼˜å…ˆ</td></tr><tr><td>æ›´æ–°åè°ƒ</td><td>å•é€šé“æ›´æ–°</td><td>å¤šè½¦é“åˆ†æµæ›´æ–°</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">ğŸ’¬ 6. å°ç»“ï¼ˆå¸¦ç‚¹å“²å­¦ ğŸ§˜ï¼‰</h2>
<p>React 17 çš„ Fiber æ˜¯â€œå¤šæ ¸ CPUâ€ï¼Œä½†åªå¼€äº†ä¸€ä¸ªæ ¸ã€‚<br/>
React 18 åˆ™æ˜¯<strong>çœŸæ­£å¯ç”¨å¤šè°ƒåº¦é€šé“</strong>çš„é˜¶æ®µã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œ</p>
<blockquote>
<p>â€œReact 17 æ˜¯ç«è½¦ï¼šä¸€åˆ—è½¦å¢æ¥ç€ä¸€åˆ—ï¼›<br/>
React 18 æ˜¯åœ°é“ï¼šå¤šæ¡çº¿è·¯ã€åˆ†æ—¶å‘è½¦ã€å„è¡Œå…¶é“ã€‚â€</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">ğŸ¯ ç»“è¯­ï¼šLanes æ˜¯ React å“²å­¦çš„å…·è±¡åŒ–</h2>
<p>React ä¸€ç›´è¿½æ±‚çš„ï¼Œä¸åªæ˜¯ã€Œæ›´æ–°ç•Œé¢å¿«ã€ï¼Œ<br/>
è€Œæ˜¯ã€Œ<strong>ä¿è¯äº¤äº’å§‹ç»ˆæµç•…</strong>ã€ã€‚</p>
<p>Lanes è®©è¿™ç§ç†å¿µæˆä¸ºå¯èƒ½ã€‚<br/>
å®ƒè®©å¼€å‘è€…åƒäº¤é€šè°ƒåº¦å‘˜ä¸€æ ·ï¼Œç²¾ç¡®æ§åˆ¶ UI çš„ä¼˜å…ˆçº§æµé‡ã€‚</p>
<p>ğŸš¦ React 17ï¼šçº¢ç¯ã€‚<br/>
ğŸš€ React 18ï¼šç»¿ç¯äº®èµ·ï¼Œå…¨é€Ÿå‰è¿›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åƒé¥±äº†æ’‘çš„çªå‘å¥‡æƒ³ï¼šTypeScript ç±»å‹èƒ½ä¸èƒ½ä½œä¸ºè·‘ä¸šåŠ¡é€»è¾‘çš„ä¾æ®ï¼Ÿï¼ˆçº¯å¨±ä¹ï¼‰]]></title>    <link>https://juejin.cn/post/7584653722593771572</link>    <guid>https://juejin.cn/post/7584653722593771572</guid>    <pubDate>2025-12-17T14:34:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584653722593771572" data-draft-id="7584639987213369378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åƒé¥±äº†æ’‘çš„çªå‘å¥‡æƒ³ï¼šTypeScript ç±»å‹èƒ½ä¸èƒ½ä½œä¸ºè·‘ä¸šåŠ¡é€»è¾‘çš„ä¾æ®ï¼Ÿï¼ˆçº¯å¨±ä¹ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,TypeScript"/> <meta itemprop="datePublished" content="2025-12-17T14:34:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æå­çƒ¨"/> <meta itemprop="url" content="https://juejin.cn/user/2963939080829405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åƒé¥±äº†æ’‘çš„çªå‘å¥‡æƒ³ï¼šTypeScript ç±»å‹èƒ½ä¸èƒ½ä½œä¸ºè·‘ä¸šåŠ¡é€»è¾‘çš„ä¾æ®ï¼Ÿï¼ˆçº¯å¨±ä¹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2963939080829405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æå­çƒ¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T14:34:26.000Z" title="Wed Dec 17 2025 14:34:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åƒé¥±æ’‘çš„æƒ³å‘ï¼šTypeScript ç±»å‹èƒ½ä¸èƒ½ç”¨æ¥è·‘ä¸šåŠ¡å‘¢ï¼Ÿï¼ˆæˆ‘çº¯å¨±ä¹ï¼‰</h2>
<p>æ˜¨å¤©åœ¨åšä¸šåŠ¡å»ºæ¨¡æ—¶ï¼Œçœ‹ç€ TypeScript çš„ <code>interface</code> å®šä¹‰ï¼Œæƒ³åˆ°ä¸€ä¸ªé—®é¢˜ã€‚</p>
<p>TypeScript çš„ç±»å‹ç³»ç»Ÿåœ¨ç¼–è¯‘åä¼šè¢«æ“¦é™¤ï¼ˆType Erasureï¼‰ã€‚è¿™æ„å‘³ç€ <code>age: number</code> è¿™æ ·çš„çº¦æŸåªå­˜åœ¨äºå¼€å‘é˜¶æ®µï¼Œè¿è¡Œæ—¶å®Œå…¨ä¸å¯è§ã€‚</p>
<p>ä½†å®é™…ä¸Šï¼Œè¿™äº›å…ƒæ•°æ®å®Œæ•´åœ°å­˜åœ¨äºæºç ä¸­ã€‚å¦‚æœèƒ½å†™ä¸ªè„šæœ¬ï¼Œåœ¨ç¼–è¯‘æ—¶åˆ†ææºç  ASTï¼ŒæŠŠè¿™äº›ç±»å‹ä¿¡æ¯æå–å¹¶ä¿å­˜ä¸‹æ¥ï¼Œæ˜¯ä¸æ˜¯å°±èƒ½åœ¨è¿è¡Œæ—¶ç›´æ¥å¤ç”¨äº†ï¼Ÿ</p>
<p>åƒé¥±äº†æ’‘çš„å°è¯•å®ç°äº†ä¸ªåŸå‹ã€‚</p>
<hr/>
<h4 data-id="heading-1">1. ä»æœ€ç®€å•çš„æƒ³æ³•å¼€å§‹</h4>
<p>å…¶å®æœ€ç›´è§‚çš„ä¾‹å­ï¼Œå°±å†™çš„ä»£ç é‡Œã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">posts</span>: <span class="hljs-title class_">Post</span>[];
}
</code></pre>
<p>è¿™å¤„ç†æ˜¯ç±»å‹çº¦æŸï¼Œå…¶å®ä¹Ÿé¡ºä¾¿æè¿°äº†ä¸šåŠ¡å…³ç³»ï¼šUser ä¸‹é¢æœ‰å¤šä¸ª Postã€‚</p>
<p>å¦‚æœä¸å»å¼•ç”¨é‚£äº›é¢å¤–çš„è£…é¥°å™¨ã€é…ç½®æ–‡ä»¶ï¼Œç›´æ¥å¤ç”¨ç±»å‹å®šä¹‰æ¥æè¿°å…³ç³»ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿè¡Œå¾—é€šï¼Ÿ</p>
<p>é¡ºç€è¿™ä¸ªæ€è·¯ï¼Œæ—¢ç„¶æ˜¾å¼çš„â€œæ¨¡å‹å…³ç³»â€å¯ä»¥ä» <code>Post[]</code> è¿™æ ·çš„ç±»å‹ç»“æ„ä¸­ç›´æ¥è¯»å‡ºæ¥ï¼Œé‚£æ›´éšæ™¦çš„â€œæ ¡éªŒè§„åˆ™â€ï¼ˆæ¯”å¦‚å­—ç¬¦ä¸²é•¿åº¦ã€æ ¼å¼é™åˆ¶ï¼‰æ˜¯ä¸æ˜¯ä¹Ÿèƒ½æƒ³åŠæ³•â€œå¯„ç”Ÿâ€åœ¨ç±»å‹é‡Œï¼Ÿ</p>
<p>å¦‚æœèƒ½åŒæ—¶æŠŠâ€œå…³ç³»â€å’Œâ€œè§„åˆ™â€éƒ½æ”¶æ•›åœ¨ç±»å‹å®šä¹‰ä¸­ï¼Œå¹¶é€šè¿‡ç¼–è¯‘åˆ†ææå–ç»™è¿è¡Œæ—¶ä½¿ç”¨ï¼Œé‚£ <code>interface</code> å°±ä¸ä»…ä»…æ˜¯é™æ€æ£€æŸ¥çš„å·¥å…·ï¼Œè€Œå˜æˆäº†å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘æè¿°ã€‚</p>
<h4 data-id="heading-2">2. é¡ºæ‰‹æŠŠå…³ç³»è¯»å‡ºæ¥</h4>
<p>æ—¢ç„¶å†³å®šè¦ä»ç±»å‹é‡Œæå–ä¿¡æ¯ï¼Œé‚£å…ˆè¯•è¯•æœ€ç®€å•çš„â€œå…³ç³»â€ã€‚</p>
<p>æ¯”å¦‚ <code>posts: Post[]</code>ã€‚</p>
<p>åœ¨ TypeScript ç¼–è¯‘å™¨çš„è§†è§’ä¸­ï¼Œè¿™è¡Œä»£ç å¯¹åº”ç€ä¸€ä¸ªç»“æ„ä¸¥è°¨çš„ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰èŠ‚ç‚¹ã€‚</p>
<p>ç¼–è¯‘å™¨é€šè¿‡ <code>PropertySignature</code> è¯†åˆ«å±æ€§åï¼Œåˆ©ç”¨ <code>ArrayType</code> ç¡®å®šæ•°ç»„ç»“æ„ï¼Œå¹¶å€ŸåŠ© <code>TypeReference</code> é”å®šå…ƒç´ ç±»å‹ <code>Post</code>ã€‚è¿™äº›ç»†ç²’åº¦çš„ç»“æ„åŒ–æ•°æ®ï¼ˆå¯é€šè¿‡ <a href="https://link.juejin.cn?target=https%3A%2F%2Fts-ast-viewer.com%2F" target="_blank" title="https://ts-ast-viewer.com/" ref="nofollow noopener noreferrer"><strong>TypeScript AST Viewer</strong></a> ç›´è§‚æŸ¥çœ‹ï¼‰å®Œæ•´ä¿ç•™äº†ä»£ç çš„è¯­ä¹‰ä¿¡æ¯ã€‚</p>
<p>æ ¸å¿ƒé€»è¾‘åœ¨äºåˆ©ç”¨ <a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target="><strong>Compiler API</strong></a> (<code>è®°å½•ä¸‹ï¼Œä»–æ˜¯ä¸ªå¼ºå¤§çš„å·¥å…·é›†ï¼Œå…è®¸å¼€å‘è€…åƒç¼–è¯‘å™¨ä¸€æ ·â€œç†è§£â€ä»£ç ã€‚</code>) éå† ASTï¼šä¸€æ—¦è¯†åˆ«åˆ°æ•°ç»„ç±»å‹çš„å±æ€§å®šä¹‰ï¼Œä¾¿å°†å…¶æå–å¹¶æ˜ å°„ä¸ºâ€œä¸€å¯¹å¤šâ€çš„å…³ç³»æè¿°ã€‚ç»è¿‡è½¬æ¢ï¼Œæºç ä¸­çš„ç±»å‹å®šä¹‰å°±è¢«æ ‡å‡†åŒ–ä¸ºä¸€ä»½é…ç½® JSONï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"relations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"posts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hasMany"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Post"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™æ ·ï¼Œæ¨¡å‹å…³ç³»é…ç½®å°±å¯ä»¥ç›´æ¥å¤ç”¨ç±»å‹å®šä¹‰ã€‚</p>
<h4 data-id="heading-3">3. é‚£è§„åˆ™å‘¢ï¼Ÿå…ˆæ‰¾ä¸ªåœ°æ–¹è—</h4>
<p>å…³ç³»æå®šäº†ï¼Œæ¥ä¸‹æ¥æ˜¯æ›´å¤æ‚çš„æ ¡éªŒè§„åˆ™ï¼ˆå¦‚ <code>minLen</code>ã€<code>email</code>ï¼‰ã€‚TypeScript æœ¬èº«æ²¡æœ‰åœ°æ–¹ç›´æ¥å†™ <code>minLen</code> è¿™ç§ä¸œè¥¿ï¼Œæ‰€ä»¥å¥½åƒéœ€è¦ä¸€ä¸ªè½½ä½“ã€‚</p>
<p>åœ¨ TypeScript çš„æ³›å‹å¯ä»¥æ˜¯å®ç°ä¸€ç§ Phantom Typeï¼ˆå¹½çµç±»å‹ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// T æ˜¯å®é™…è¿è¡Œæ—¶çš„ç±»å‹</span>
<span class="hljs-comment">// Config æ˜¯ä»…ç¼–è¯‘æœŸå­˜åœ¨çš„å…ƒæ•°æ®</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Field</span>&lt;T, <span class="hljs-title class_">Config</span>&gt; = T;
</code></pre>
<p><code>Field&lt;string, ...&gt;</code> åœ¨è¿è¡Œæ—¶å°±æ˜¯æ™®é€šçš„ <code>string</code>ã€‚æ³›å‹å‚æ•° <code>Config</code> è™½ç„¶ä¼šè¢«ç¼–è¯‘æ“¦é™¤ï¼Œä½†åœ¨ AST ä¸­æ˜¯å¯ä»¥è¯»å–åˆ°çš„ã€‚</p>
<p>è¿™æ ·å¥½åƒå°±å¯ä»¥åœ¨ä¸å½±å“è¿è¡Œæ—¶é€»è¾‘çš„å‰æä¸‹åµŒå…¥å…ƒæ•°æ®ã€‚</p>
<p>çœ‹èµ·æ¥åƒæ˜¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/domain/models.ts</span>

<span class="hljs-comment">// å¼•å…¥æˆ‘å®šä¹‰çš„â€œå¹½çµç±»å‹â€</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Str</span>, <span class="hljs-title class_">Num</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@bizmod/core'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">MinLen</span>, <span class="hljs-title class_">Email</span>, <span class="hljs-title class_">BlockList</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@bizmod/rules'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-title class_">Str</span>;
  
  <span class="hljs-comment">// å¤šä¸ªè§„åˆ™ä¸€èµ·ç”¨ï¼šæœ€å°‘2ä¸ªå­— + è¿ç¦è¯è¿‡æ»¤</span>
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">Str</span>&lt;[
      <span class="hljs-title class_">MinLen</span>&lt;<span class="hljs-number">2</span>&gt;, 
      <span class="hljs-title class_">BlockList</span>&lt;[<span class="hljs-string">"admin"</span>, <span class="hljs-string">"root"</span>]&gt;
  ]&gt;;

  <span class="hljs-attr">email</span>: <span class="hljs-title class_">Str</span>&lt;[<span class="hljs-title class_">Email</span>]&gt;;
}
</code></pre>
<p>åœ¨ç¼–è¾‘å™¨é‡Œï¼Œ<code>name</code> ä¾ç„¶æ˜¯å­—ç¬¦ä¸²ï¼Œè¯¥æ€ä¹ˆç”¨æ€ä¹ˆç”¨ï¼Œå®Œå…¨ä¸å½±å“å¼€å‘ã€‚ä½†åœ¨ä»£ç æ–‡æœ¬é‡Œï¼Œé‚£ä¸ª <code>MinLen</code> å’Œ <code>BlockList</code> çš„æ ‡è®°å°±ç•™åœ¨é‚£å„¿äº†ã€‚</p>
<h4 data-id="heading-4">4. æŠŠè§„åˆ™ä¹Ÿè¯»å‡ºæ¥</h4>
<p>å®šä¹‰å¥½ç±»å‹è½½ä½“ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯æŠŠè¿™äº›è§„åˆ™ä¿¡æ¯ä¹Ÿè¯»å‡ºæ¥ã€‚æˆ‘æŸ¥äº†ä¸€ä¸‹ï¼Œè¿™é‡Œæ­£å¥½å¯ä»¥ç”¨ TypeScript çš„ <strong>Compiler API</strong> æ¥å®ç°ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œå®ƒèƒ½æŠŠ <code>.ts</code> æ–‡ä»¶å˜æˆä¸€æ£µå¯ä»¥éå†çš„æ ‘ï¼ˆASTï¼‰ã€‚æˆ‘ä»¬å†™ä¸ªè„šæœ¬ï¼Œéå†æ‰€æœ‰çš„ <code>interface</code>ã€‚å½“å‘ç°å±æ€§ä½¿ç”¨äº† <code>Field</code> ç±»å‹æ—¶ï¼Œè¯»å–å…¶æ³›å‹å‚æ•°ï¼ˆæ¯”å¦‚ <code>MinLen</code>ã€<code>admin</code>ï¼‰ï¼Œå¹¶ä¿å­˜ä¸‹æ¥ã€‚</p>
<p>æ ¸å¿ƒé€»è¾‘å¤§æ¦‚æ˜¯è¿™æ ·ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// analyzer.ts (ä¼ªä»£ç )</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">visit</span>(<span class="hljs-params">node: ts.Node</span>) {
  <span class="hljs-comment">// 1. æ‰¾åˆ°æ‰€æœ‰ Interface</span>
  <span class="hljs-keyword">if</span> (ts.<span class="hljs-title function_">isInterfaceDeclaration</span>(node)) {
    <span class="hljs-keyword">const</span> modelName = node.<span class="hljs-property">name</span>.<span class="hljs-property">text</span>; <span class="hljs-comment">// æ‹¿åˆ° "User"</span>
    
    <span class="hljs-comment">// 2. éå†å®ƒçš„å±æ€§</span>
    node.<span class="hljs-property">members</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">member</span> =&gt;</span> {
       <span class="hljs-keyword">const</span> fieldName = member.<span class="hljs-property">name</span>.<span class="hljs-property">text</span>; <span class="hljs-comment">// æ‹¿åˆ° "name"</span>
       
       <span class="hljs-comment">// 3. é‡ç‚¹ï¼šè§£ææ³›å‹å‚æ•°ï¼</span>
       <span class="hljs-comment">// è¿™é‡Œèƒ½æ‹¿åˆ° "MinLen", "BlockList" ç”šè‡³é‡Œé¢çš„ ["admin", "root"]</span>
       <span class="hljs-keyword">const</span> rules = <span class="hljs-title function_">extractRulesFromGeneric</span>(member.<span class="hljs-property">type</span>); 
       
       schema[modelName][fieldName] = rules;
    });
  }
}
</code></pre>
<p>è¿è¡Œè„šæœ¬åï¼Œç”Ÿæˆäº†ä¸€ä¸ªå®Œæ•´çš„ <code>schema.json</code>ï¼ŒåŒ…å«äº†å…³ç³»å’Œæ ¡éªŒè§„åˆ™ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"User"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"User"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"fields"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"rules"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"minLen"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"blockList"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"admin"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"root"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"email"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"rules"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"email"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"relations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"posts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hasMany"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Post"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ä»£ç é‡Œçš„ä¿¡æ¯å°±è¢«æå–å‡ºæ¥äº†å­˜æˆäº†æ¸…å•ã€‚</p>
<h4 data-id="heading-5">5. è¿è¡Œæ—¶æ€ä¹ˆç”¨ï¼Ÿ</h4>
<p>å‰é¢çš„è„šæœ¬è·‘å®Œä»¥åï¼Œæ‰€æœ‰è¿™äº›ä¿¡æ¯ï¼ˆæ ¡éªŒè§„åˆ™ + æ¨¡å‹å…³ç³»ï¼‰å°±éƒ½å­˜è¿›äº† <code>schema.json</code> é‡Œã€‚</p>
<p>--</p>
<p>æœ‰äº†è¿™ä¸ªæ–‡ä»¶ï¼Œè¿è¡Œæ—¶è¦åšçš„äº‹æƒ…å°±å¾ˆç®€å•äº†ã€‚</p>
<p>--</p>
<p>ç¨‹åºå¯åŠ¨æ—¶è¯»å–è¿™ä¸ª JSONã€‚å½“ API æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œæ ¹æ® JSON é‡Œçš„è§„åˆ™è‡ªåŠ¨æ‰§è¡Œæ ¡éªŒé€»è¾‘ã€‚</p>
<p>è¿™æ ·å°±å®ç°äº†æŠŠ TypeScript çš„é™æ€ç±»å‹ä¿¡æ¯å¸¦åˆ°è¿è¡Œæ—¶ä½¿ç”¨ã€‚</p>
<p>ä»¥åæ–°å¢ä¸šåŠ¡æ¨¡å‹ï¼Œåªéœ€è¦ç»´æŠ¤ä¸€ä»½ <code>interface</code> å®šä¹‰ï¼Œæ ¡éªŒè§„åˆ™å’Œå…³ç³»å®šä¹‰éƒ½ä¼šè‡ªåŠ¨åŒæ­¥ç”Ÿæˆã€‚</p>
<p>--</p>
<h4 data-id="heading-6">6. ç®€å•çš„éªŒè¯ Demo</h4>
<p>ä¸ºäº†éªŒè¯å¯è¡Œæ€§ï¼Œå†™ä¸ªæµ‹è¯•ã€‚</p>
<p><strong>1. ç±»å‹å®šä¹‰</strong></p>
<p>åˆ©ç”¨ Phantom Type æºå¸¦å…ƒæ•°æ®ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types.ts</span>
<span class="hljs-comment">// T æ˜¯çœŸå®ç±»å‹ï¼ŒRules æ˜¯å…ƒæ•°æ®</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Field</span>&lt;T, <span class="hljs-title class_">Rules</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[]&gt; = T;

<span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªè§„åˆ™ç±»å‹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">MinLen</span>&lt;N <span class="hljs-keyword">extends</span> <span class="hljs-built_in">number</span>&gt; = { <span class="hljs-attr">_tag</span>: <span class="hljs-string">'MinLen'</span>, <span class="hljs-attr">val</span>: N };

<span class="hljs-comment">// ä¸šåŠ¡ä»£ç </span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">Field</span>&lt;<span class="hljs-built_in">string</span>, [<span class="hljs-title class_">MinLen</span>&lt;<span class="hljs-number">2</span>&gt;]&gt;;
}
</code></pre>
<p><strong>2. ç¼–è¯‘å™¨åˆ†æ (Analyzer)</strong></p>
<p>ä½¿ç”¨ TS Compiler API æå–å…ƒæ•°æ®ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// analyzer.ts</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> ts <span class="hljs-keyword">from</span> <span class="hljs-string">"typescript"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">analyze</span>(<span class="hljs-params">fileName: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> program = ts.<span class="hljs-title function_">createProgram</span>([fileName], {});
  <span class="hljs-keyword">const</span> sourceFile = program.<span class="hljs-title function_">getSourceFile</span>(fileName)!;

  ts.<span class="hljs-title function_">forEachChild</span>(sourceFile, <span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> {
    <span class="hljs-comment">// 1. æ‰¾åˆ° Interface</span>
    <span class="hljs-keyword">if</span> (!ts.<span class="hljs-title function_">isInterfaceDeclaration</span>(node)) <span class="hljs-keyword">return</span>;

    node.<span class="hljs-property">members</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">member</span> =&gt;</span> {
      <span class="hljs-comment">// 2. è·å–å±æ€§å "name"</span>
      <span class="hljs-keyword">const</span> name = member.<span class="hljs-property">name</span>.<span class="hljs-title function_">getText</span>();
      
      <span class="hljs-comment">// 3. è·å–ç±»å‹èŠ‚ç‚¹ Field&lt;...&gt;</span>
      <span class="hljs-keyword">if</span> (ts.<span class="hljs-title function_">isTypeReferenceNode</span>(member.<span class="hljs-property">type</span>)) {
          <span class="hljs-comment">// 4. æå–ç¬¬äºŒä¸ªæ³›å‹å‚æ•° [MinLen&lt;2&gt;]</span>
          <span class="hljs-keyword">const</span> rulesArg = member.<span class="hljs-property">type</span>.<span class="hljs-property">typeArguments</span>?.[<span class="hljs-number">1</span>];
          
          <span class="hljs-comment">// 5. è¿™é‡Œå°±å¯ä»¥è§£æå‡º "MinLen" å’Œ 2 äº†</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Field: <span class="hljs-subst">${name}</span>, Rules: <span class="hljs-subst">${rulesArg.getText()}</span>`</span>);
      }
    });
  });
}
</code></pre>
<p><strong>3. è¿è¡Œæ—¶æ¶ˆè´¹</strong></p>
<p>ç”Ÿæˆçš„ JSON å…ƒæ•°æ®å¯ä»¥ç›´æ¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// runtime.ts</span>
<span class="hljs-keyword">const</span> schema = {
  <span class="hljs-title class_">User</span>: {
    <span class="hljs-attr">name</span>: { <span class="hljs-attr">rules</span>: { <span class="hljs-attr">minLen</span>: <span class="hljs-number">2</span> } }
  }
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">validate</span>(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) {
  <span class="hljs-keyword">const</span> rules = schema.<span class="hljs-property">User</span>.<span class="hljs-property">name</span>.<span class="hljs-property">rules</span>;
  <span class="hljs-keyword">if</span> (rules.<span class="hljs-property">minLen</span> &amp;&amp; data.<span class="hljs-property">name</span>.<span class="hljs-property">length</span> &lt; rules.<span class="hljs-property">minLen</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Validation Failed: Too short"</span>);
  }
}
</code></pre>
<hr/>
<h4 data-id="heading-7">æœ€åæ‰¯çŠŠå­</h4>
<p>è¿™æ¬¡å°è¯•çš„æ ¸å¿ƒé€»è¾‘å…¶å®å¾ˆç®€å•ï¼šç”¨è„šæœ¬æŠŠä»£ç é‡Œçš„ç±»å‹â€œæŠ„â€å‡ºæ¥ï¼Œå­˜æˆ JSONï¼Œç„¶åç¨‹åºè¿è¡Œçš„æ—¶å€™ç…§ç€ JSON æ‰§è¡Œã€‚</p>
<p>--</p>
<p>æœ¬è´¨ä¸Šï¼Œå°±æ˜¯æŠŠ TypeScript ä»£ç å½“æˆé…ç½®æ–‡ä»¶æ¥ç”¨ã€‚</p>
<p>æˆ‘åªæ˜¯çº¯æ— èŠç©ç©ï¼Œå¦‚æœæœ‰å¤§ä½¬æƒ³å†™ä¸ªå°å·¥å…·ä»€ä¹ˆçš„ã€‚å¯ä»¥æ”¾åœ¨ä¸‹é¢ï¼ˆæˆ‘æ‡’ï¼‰ã€‚</p>
<p>--</p>
<p>æœ€åï¼Œä½ ä»¬åœ¨ç© TypeScript çš„æ—¶å€™æœ‰å“ªäº›éªšæƒ³æ³•ï¼Ÿ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç®—æ³•å¤æ‚åº¦åˆ†æä¸ä¼˜åŒ–ï¼šä»ç†è®ºåˆ°å®æˆ˜]]></title>    <link>https://juejin.cn/post/7584702863688253455</link>    <guid>https://juejin.cn/post/7584702863688253455</guid>    <pubDate>2025-12-17T15:21:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584702863688253455" data-draft-id="7584439538312380479" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç®—æ³•å¤æ‚åº¦åˆ†æä¸ä¼˜åŒ–ï¼šä»ç†è®ºåˆ°å®æˆ˜"/> <meta itemprop="keywords" content="å‰ç«¯,ç®—æ³•,JavaScript"/> <meta itemprop="datePublished" content="2025-12-17T15:21:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TimelessHaze"/> <meta itemprop="url" content="https://juejin.cn/user/3798151566988604"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç®—æ³•å¤æ‚åº¦åˆ†æä¸ä¼˜åŒ–ï¼šä»ç†è®ºåˆ°å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3798151566988604/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TimelessHaze
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T15:21:15.000Z" title="Wed Dec 17 2025 15:21:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ç®—æ³•è¯„ä»·çš„é»„é‡‘æ ‡å‡†</h2>
<p>åœ¨ç®—æ³•è®¾è®¡é¢†åŸŸï¼Œè¯„ä»·ä¸€ä¸ªç®—æ³•çš„ä¼˜åŠ£å§‹ç»ˆéµå¾ªä¸¤ä¸ªæ ¸å¿ƒç»´åº¦ï¼š</p>
<ol>
<li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼šè¡¡é‡ç®—æ³•æ‰§è¡Œæ—¶é—´éšè¾“å…¥è§„æ¨¡å¢é•¿çš„å˜åŒ–è¶‹åŠ¿</li>
<li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼šè¯„ä¼°ç®—æ³•è¿è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶å ç”¨å­˜å‚¨ç©ºé—´çš„è§„æ¨¡</li>
</ol>
<p>è¿™ä¸¤ä¸ªæŒ‡æ ‡å…±åŒæ„æˆäº†ç®—æ³•æ€§èƒ½çš„"å¤©å¹³"ï¼Œå¼€å‘è€…éœ€è¦æ ¹æ®å®é™…åœºæ™¯è¿›è¡Œæƒè¡¡ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>å®æ—¶ç³»ç»Ÿä¼˜å…ˆä¿è¯å“åº”é€Ÿåº¦ï¼ˆæ—¶é—´ä¼˜å…ˆï¼‰</li>
<li>åµŒå…¥å¼è®¾å¤‡æ›´å…³æ³¨å†…å­˜å ç”¨ï¼ˆç©ºé—´ä¼˜å…ˆï¼‰</li>
</ul>
<h2 data-id="heading-1">äºŒã€æ—¶é—´å¤æ‚åº¦çš„é‡åŒ–åˆ†æ</h2>
<h3 data-id="heading-2">1. åŸºæœ¬æ“ä½œæ¬¡æ•°T(n)</h3>
<p>æˆ‘ä»¬é€šè¿‡ç»Ÿè®¡åŸºæœ¬æ“ä½œçš„æ‰§è¡Œæ¬¡æ•°æ¥é‡åŒ–ç®—æ³•æ•ˆç‡ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># çº¿æ€§æœç´¢ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">linear_search</span>(<span class="hljs-params">arr, target</span>):
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(arr)):  <span class="hljs-comment"># O(n)æ¬¡æ¯”è¾ƒæ“ä½œ</span>
        <span class="hljs-keyword">if</span> arr[i] == target:   <span class="hljs-comment"># O(n)æ¬¡åˆ¤æ–­æ“ä½œ</span>
            <span class="hljs-keyword">return</span> i
    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>
</code></pre>
<p>T(n) = 3n + 2ï¼ˆåŒ…å«å¾ªç¯åˆå§‹åŒ–ã€æ¯”è¾ƒã€è¿”å›ç­‰æ“ä½œï¼‰</p>
<h3 data-id="heading-3">2. å¤§Oç¬¦å·çš„æ¸è¿›è¡¨ç¤º</h3>
<p>é€šè¿‡ä¿ç•™æœ€é«˜é˜¶é¡¹å¹¶å¿½ç•¥å¸¸æ•°å› å­ï¼Œå¾—åˆ°æ›´ç®€æ´çš„è¡¨è¾¾å¼ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">T</span>(n) = <span class="hljs-number">3</span>nÂ² + <span class="hljs-number">2</span>n + <span class="hljs-number">1</span> â†’ <span class="hljs-built_in">O</span>(nÂ²)
<span class="hljs-built_in">T</span>(n) = <span class="hljs-number">5</span>logn + <span class="hljs-number">100</span> â†’ <span class="hljs-built_in">O</span>(logn)
</code></pre>
<h3 data-id="heading-4">3. å…¸å‹æ—¶é—´å¤æ‚åº¦åˆ†ç±»</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb4ff80fee5445b39a15dc36c64ca338~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVGltZWxlc3NIYXpl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766589675&amp;x-signature=m%2BBwLWiQ1xKtecqTY1ntwzTjQdQ%3D" alt="972e038cd2834921a314ff519d88efee.png" loading="lazy"/></p>








































<table><thead><tr><th>å¤æ‚åº¦ç±»å‹</th><th>ä»£è¡¨ç®—æ³•</th><th>æ‰§è¡Œæ¬¡æ•°å¢é•¿è¶‹åŠ¿</th></tr></thead><tbody><tr><td>O(1)</td><td>å“ˆå¸ŒæŸ¥æ‰¾</td><td>å¸¸æ•°çº§</td></tr><tr><td>O(logn)</td><td>äºŒåˆ†æŸ¥æ‰¾</td><td>å¯¹æ•°çº§</td></tr><tr><td>O(n)</td><td>çº¿æ€§æœç´¢</td><td>çº¿æ€§å¢é•¿</td></tr><tr><td>O(nlogn)</td><td>å¿«é€Ÿæ’åº/å½’å¹¶æ’åº</td><td>çº¿æ€§å¯¹æ•°å¢é•¿</td></tr><tr><td>O(nÂ²)</td><td>å†’æ³¡æ’åº/æ’å…¥æ’åº</td><td>å¹³æ–¹å¢é•¿</td></tr><tr><td>O(2â¿)</td><td>æ±‰è¯ºå¡”é—®é¢˜é€’å½’è§£æ³•</td><td>æŒ‡æ•°çˆ†ç‚¸</td></tr></tbody></table>
<h2 data-id="heading-5">ä¸‰ã€ç©ºé—´å¤æ‚åº¦çš„ä¼˜åŒ–å®è·µ</h2>
<h3 data-id="heading-6">1. åŸºæœ¬æ¦‚å¿µ</h3>
<p>ç©ºé—´å¤æ‚åº¦S(n) = æŒ‡ä»¤ç©ºé—´ + æ•°æ®ç©ºé—´ + ç¯å¢ƒæ ˆç©ºé—´<br/>
å…¶ä¸­æŒ‡ä»¤ç©ºé—´å’Œç¯å¢ƒæ ˆç©ºé—´é€šå¸¸ä¸ºå¸¸é‡çº§O(1)ï¼Œä¸»è¦å…³æ³¨æ•°æ®ç©ºé—´å¼€é”€ã€‚</p>
<h3 data-id="heading-7">2. æœ‰åºæ•°ç»„åˆå¹¶çš„ä¼˜åŒ–æ¡ˆä¾‹</h3>
<h4 data-id="heading-8">ä¼ ç»ŸåŒæŒ‡é’ˆæ³•ï¼ˆç©ºé—´O(m+n)ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">def merge_v1(nums1, m, nums2, n):
    <span class="hljs-attr">res</span> = []
    <span class="hljs-attr">i</span> = j = <span class="hljs-number">0</span>
    while i &lt; m and j &lt; n:
        if nums1<span class="hljs-section">[i]</span> &lt; nums2<span class="hljs-section">[j]</span>:
            res.append(nums1<span class="hljs-section">[i]</span>)
            i += 1
        else:
            res.append(nums2<span class="hljs-section">[j]</span>)
            j += 1
    res.extend(nums1<span class="hljs-section">[i:m]</span> or nums2<span class="hljs-section">[j:n]</span>)
    return res
</code></pre>
<p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>åˆ›å»ºæ–°æ•°ç»„<code>res</code>å­˜å‚¨ç»“æœ</li>
<li>éœ€è¦é¢å¤–O(m+n)ç©ºé—´</li>
<li>æœ€ç»ˆè¿˜è¦å°†ç»“æœå¤åˆ¶å›nums1</li>
</ul>
<h4 data-id="heading-9">ä¸‰æŒ‡é’ˆä¼˜åŒ–æ³•ï¼ˆç©ºé—´O(1)ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">def merge_v2(nums1, m, nums2, n):
    i, j, <span class="hljs-attr">k</span> = m-<span class="hljs-number">1</span>, n-<span class="hljs-number">1</span>, m+n-<span class="hljs-number">1</span>
    while i &gt;= 0 and j &gt;= 0:
        if nums1<span class="hljs-section">[i]</span> &gt; nums2<span class="hljs-section">[j]</span>:
            nums1<span class="hljs-section">[k]</span> = nums1<span class="hljs-section">[i]</span>
            i <span class="hljs-attr">-</span>= <span class="hljs-number">1</span>
        else:
            nums1<span class="hljs-section">[k]</span> = nums2<span class="hljs-section">[j]</span>
            j <span class="hljs-attr">-</span>= <span class="hljs-number">1</span>
        k <span class="hljs-attr">-</span>= <span class="hljs-number">1</span>
    <span class="hljs-comment"># å¤„ç†å‰©ä½™å…ƒç´ </span>
    while j &gt;= 0:
        nums1<span class="hljs-section">[k]</span> = nums2<span class="hljs-section">[j]</span>
        j <span class="hljs-attr">-</span>= <span class="hljs-number">1</span>
        k <span class="hljs-attr">-</span>= <span class="hljs-number">1</span>
    return nums1
</code></pre>
<p><strong>ä¼˜åŒ–å¯¹æ¯”</strong></p>





























<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼ ç»Ÿæ–¹æ³•</th><th>ä¼˜åŒ–æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ—¶é—´å¤æ‚åº¦</td><td>O(m+n)</td><td>O(m+n)</td><td>å‡éœ€æ¯”è¾ƒæ‰€æœ‰å…ƒç´ </td></tr><tr><td>ç©ºé—´å¤æ‚åº¦</td><td>O(m+n)</td><td>O(1)</td><td>åŸåœ°æ“ä½œæ— éœ€é¢å¤–ç©ºé—´</td></tr><tr><td><strong>å…³é”®ä¼˜åŠ¿</strong></td><td>-</td><td>âœ… åˆ©ç”¨nums1å°¾éƒ¨ç©ºä½ âœ… é¿å…æ•°æ®è¦†ç›–é—®é¢˜</td><td/></tr></tbody></table>
<p><strong>æ ¸å¿ƒåŸç†</strong>ï¼š</p>
<ul>
<li><strong>é€†å‘åŒæŒ‡é’ˆ</strong>ï¼šä»åå‘å‰å¡«å……ï¼Œé¿å…è¦†ç›–æœªå¤„ç†å…ƒç´ </li>
<li><strong>åŸåœ°æ“ä½œ</strong>ï¼šç›´æ¥ä¿®æ”¹nums1æ•°ç»„ï¼Œæ— éœ€é¢å¤–ç©ºé—´</li>
<li><strong>å¤„ç†å‰©ä½™å…ƒç´ </strong>ï¼šå½“nums1å…ƒç´ å…ˆå¤„ç†å®Œæ—¶ï¼Œnums2å‰©ä½™å…ƒç´ å·²æœ‰åºï¼Œç›´æ¥å¤åˆ¶å³å¯</li>
</ul>
<h2 data-id="heading-10">å››ã€å¤æ‚åº¦ä¼˜åŒ–çš„å®æˆ˜ç­–ç•¥</h2>
<h3 data-id="heading-11">1. ç©ºé—´æ¢æ—¶é—´å…¸å‹æ¡ˆä¾‹</h3>
<p><strong>è®°å¿†åŒ–æœç´¢</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">def fib(n, memo={}):
    <span class="hljs-keyword">if</span> n <span class="hljs-keyword">in</span> memo: <span class="hljs-keyword">return</span> memo[n]
    <span class="hljs-keyword">if</span> n &lt;= <span class="hljs-number">2</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
    memo[n] = fib(n-<span class="hljs-number">1</span>, memo) + fib(n-<span class="hljs-number">2</span>, memo)
    <span class="hljs-keyword">return</span> memo[n]
</code></pre>
<ul>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(n)</li>
<li>æ—¶é—´å¤æ‚åº¦ï¼šä»O(2â¿)é™ä¸ºO(n)</li>
</ul>
<p><strong>é¢„å¤„ç†ç´¢å¼•</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"># å€’æ’ç´¢å¼•æ„å»º
inverted_index = <span class="hljs-built_in">defaultdict</span>(list)
for doc_id, doc in <span class="hljs-built_in">enumerate</span>(documents):
    for word in doc.<span class="hljs-built_in">split</span>():
        inverted_index[word].<span class="hljs-built_in">append</span>(doc_id)
</code></pre>
<ul>
<li>æŸ¥è¯¢å¤æ‚åº¦ï¼šä»O(N)é™ä¸ºO(1)</li>
</ul>
<h3 data-id="heading-12">2. æ—¶é—´æ¢ç©ºé—´å…¸å‹æ¡ˆä¾‹</h3>
<p><strong>åœ¨çº¿å¤„ç†</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># å®æ—¶æ•°æ®æµå¤„ç†</span>
<span class="hljs-attr">for data in stream:</span>
    <span class="hljs-string">process(data)</span>  <span class="hljs-comment"># ä¸ç¼“å­˜å…¨éƒ¨æ•°æ®</span>
</code></pre>
<ul>
<li>ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼ˆä»…å¤„ç†å½“å‰å…ƒç´ ï¼‰</li>
</ul>
<p><strong>å»¶è¿Ÿè®¡ç®—</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderRow</span>(<span class="hljs-params">index</span>) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{data[index]}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<ul>
<li>é¿å…æ¸²æŸ“å…¨éƒ¨å…ƒç´ ï¼Œé™ä½å†…å­˜å ç”¨</li>
</ul>
<h2 data-id="heading-13">äº”ã€å¤æ‚åº¦åˆ†æçš„è¿›é˜¶æŠ€å·§</h2>
<h3 data-id="heading-14">1. é€’å½’ç®—æ³•åˆ†æ</h3>
<p><strong>ä¸»å®šç†</strong>ï¼šå¯¹äºå½¢å¦‚T(n) = aT(n/b) + f(n)çš„é€’å½’å¼ï¼š</p>
<ul>
<li>è‹¥f(n) âˆˆ O(n^c)ï¼Œå…¶ä¸­c &lt; log_b(a)ï¼Œåˆ™T(n) = Î˜(n^log_b(a))</li>
<li>è‹¥f(n) âˆˆ Î˜(n^c log^k n)ï¼Œå…¶ä¸­c = log_b(a)ï¼Œåˆ™T(n) = Î˜(n^c log^{k+1}n)</li>
<li>è‹¥f(n) âˆˆ Î©(n^c)ï¼Œå…¶ä¸­c &gt; log_b(a)ï¼Œä¸”æ»¡è¶³æ­£åˆ™æ¡ä»¶ï¼Œåˆ™T(n) = Î˜(f(n))</li>
</ul>
<h3 data-id="heading-15">2. å¤šå‚æ•°åˆ†æ</h3>
<p>çŸ©é˜µä¹˜æ³•ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">def matrix_multiply(A, B): 
    m, <span class="hljs-attr">n</span> = len(A), len(A[<span class="hljs-number">0</span>])
    <span class="hljs-attr">p</span> = len(B[<span class="hljs-number">0</span>])
    <span class="hljs-attr">result</span> = [[<span class="hljs-number">0</span>]*p for _ in range(m)]
    for i in range(m):         <span class="hljs-comment"># O(m)</span>
        for j in range(p):     <span class="hljs-comment"># O(p)</span>
            for k in range(n): <span class="hljs-comment"># O(n)</span>
                result<span class="hljs-section">[i]</span><span class="hljs-section">[j]</span> += A<span class="hljs-section">[i]</span><span class="hljs-section">[k]</span> * B<span class="hljs-section">[k]</span><span class="hljs-section">[j]</span>
    return result
<span class="hljs-comment"># æ—¶é—´å¤æ‚åº¦ï¼šO(mnp)</span>
</code></pre>
<h3 data-id="heading-16">3. æ‘Šè¿˜åˆ†æ</h3>
<p>åŠ¨æ€æ•°ç»„æ‰©å®¹ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"># Pythonåˆ—è¡¨è¿½åŠ æ“ä½œ
arr = <span class="hljs-selector-attr">[]</span>
for <span class="hljs-selector-tag">i</span> in <span class="hljs-built_in">range</span>(<span class="hljs-number">100000</span>):
    arr.<span class="hljs-built_in">append</span>(i)  # å•æ¬¡æ“ä½œå‡æ‘Š<span class="hljs-built_in">O</span>(<span class="hljs-number">1</span>)
</code></pre>
<ul>
<li>å½“æ•°ç»„å®¹é‡ä¸è¶³æ—¶ï¼Œä¼šç”³è¯·2å€æ–°ç©ºé—´å¹¶å¤åˆ¶</li>
<li>æ€»æ“ä½œæ¬¡æ•°ï¼šn + n/2 + n/4 + ... = 2n â†’ å‡æ‘ŠO(1)</li>
</ul>
<h2 data-id="heading-17">å…­ã€å®æˆ˜å»ºè®®</h2>
<ol>
<li><strong>åŸºå‡†æµ‹è¯•å…ˆè¡Œ</strong>ï¼šä½¿ç”¨æ€§èƒ½åˆ†æå·¥å…·å®šä½ç“¶é¢ˆ</li>
<li><strong>ä¼˜å…ˆä¼˜åŒ–é«˜é¢‘è·¯å¾„</strong>ï¼š80%æ€§èƒ½é—®é¢˜é›†ä¸­åœ¨20%æ ¸å¿ƒä»£ç </li>
<li><strong>ä¿æŒç®—æ³•ç®€æ´æ€§</strong>ï¼šåœ¨å¯ç»´æŠ¤æ€§ä¸æ€§èƒ½é—´å–å¾—å¹³è¡¡</li>
<li><strong>å…³æ³¨å¸¸æ•°å› å­</strong>ï¼šå½“å¤æ‚åº¦ç›¸åŒæ—¶ï¼Œä¼˜åŒ–å¸¸æ•°é¡¹ï¼ˆå¦‚å‡å°‘å¾ªç¯ä½“å†…çš„æ“ä½œï¼‰</li>
</ol>
<h2 data-id="heading-18">ç»“è¯­</h2>
<p>ç®—æ³•å¤æ‚åº¦åˆ†ææ˜¯æ¯ä¸ªå¼€å‘è€…å¿…å¤‡çš„æ ¸å¿ƒèƒ½åŠ›ã€‚é€šè¿‡ç³»ç»ŸæŒæ¡æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦çš„åˆ†ææ–¹æ³•ï¼Œç»“åˆå…·ä½“åœºæ™¯é€‰æ‹©ä¼˜åŒ–ç­–ç•¥ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨æ€§èƒ½ä¸èµ„æºæ¶ˆè€—ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚è®°ä½ï¼šä¼˜ç§€çš„ç®—æ³•ä¸æ˜¯è¿½æ±‚æè‡´çš„å¤æ‚åº¦é™ä½ï¼Œè€Œæ˜¯å®ç°ä¸šåŠ¡éœ€æ±‚ä¸ç³»ç»Ÿçº¦æŸçš„æœ€ä¼˜è§£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäº vue3 å®ŒæˆåŠ¨æ€ç»„ä»¶åº“å»ºè®¾]]></title>    <link>https://juejin.cn/post/7584650857070854153</link>    <guid>https://juejin.cn/post/7584650857070854153</guid>    <pubDate>2025-12-17T15:06:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650857070854153" data-draft-id="7584655946087268398" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäº vue3 å®ŒæˆåŠ¨æ€ç»„ä»¶åº“å»ºè®¾"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-17T15:06:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·4478315360232"/> <meta itemprop="url" content="https://juejin.cn/user/3136263493784493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäº vue3 å®ŒæˆåŠ¨æ€ç»„ä»¶åº“å»ºè®¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3136263493784493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·4478315360232
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T15:06:05.000Z" title="Wed Dec 17 2025 15:06:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>æœ¬é˜¶æ®µï¼Œåœ¨ä¸Šä¸€é˜¶æ®µå®Œæˆçš„DSLé¢†åŸŸæ¨¡å‹é…ç½®çš„åŸºç¡€ä¸Šï¼Œå®Œæˆäº†åŠ¨æ€ç»„ä»¶çš„æ‹“å±•ã€‚åœ¨é¢†åŸŸæ¨¡å‹ä¸­é…ç½®æ–°å¢ç»„ä»¶çš„ç›¸å…³é…ç½®ï¼Œé€šè¿‡ç»„ä»¶è§£æå™¨ï¼Œè§£ææˆå¼¹çª—ï¼Œè¡¨å•ï¼ŒæŠ½å±‰ç­‰ç­‰å„ç±»ç»„ä»¶ã€‚</p>
<h2 data-id="heading-1">åŠ¨æ€ç»„ä»¶è®¾è®¡</h2>
<h3 data-id="heading-2">1.ç»„ä»¶è®¾è®¡æ€è·¯</h3>
<p>å®šä¹‰ç»„ä»¶æ—¶å¯ä»¥å‚è€ƒè¿™ä¸ªæ€è·¯</p>
<ol>
<li>æ¥æ”¶ä»€ä¹ˆå±æ€§ï¼ˆpropsï¼‰</li>
<li>è¿”å›ä»€ä¹ˆäº‹ä»¶ï¼ˆemitï¼‰</li>
<li>æš´éœ²ä»€ä¹ˆæ–¹æ³•ï¼ˆdefineExposeï¼‰</li>
</ol>
<h3 data-id="heading-3">2.DSLä¸­åŠ¨æ€ç»„ä»¶é…ç½®</h3>
<ul>
<li>æ³¨å†Œç»„ä»¶ï¼šåœ¨Â <strong>schemaConfig</strong>Â çš„Â <strong>componentConfig</strong>Â é¡¹ä¸­ï¼Œå®šä¹‰ä½ æ‰€éœ€çš„åŠ¨æ€ç»„ä»¶</li>
<li>å…³è”é…ç½®ï¼šåœ¨Â <strong>schema.properties</strong>Â çš„æ¯ä¸ªå­—æ®µé‡Œï¼Œæ·»åŠ ä¸ç»„ä»¶åŒåçš„Â <strong>Option</strong>Â é…ç½®ï¼Œç”¨äºç²¾ç»†åŒ–æ§åˆ¶å­—æ®µåœ¨ç»„ä»¶ä¸­çš„è¡¨ç°</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-attr">schemaConfig</span>: {
        <span class="hljs-attr">api</span>: <span class="hljs-string">'/api/proj/product'</span>,
        <span class="hljs-attr">schema</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
            <span class="hljs-attr">properties</span>: {
                <span class="hljs-attr">product_name</span>: {
                    <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
                    <span class="hljs-attr">label</span>: <span class="hljs-string">'å•†å“åç§°'</span>,
                    <span class="hljs-comment">// json-schenma</span>
                    <span class="hljs-attr">maxLength</span>: <span class="hljs-number">10</span>, <span class="hljs-comment">// æœ€å¤§ç¨‹åº¦</span>
                    <span class="hljs-attr">minLength</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// æœ€å°é•¿åº¦</span>
                    <span class="hljs-attr">tableOption</span>: {},
                    <span class="hljs-comment">// å­—æ®µåœ¨ä¸åŒåŠ¨æ€ component ä¸­çš„ç›¸å…³é…ç½®, å‰ç¼€å¯¹ç”¨ componentConfig ä¸­çš„é”®å€¼</span>
                    <span class="hljs-comment">// å¦‚: componentConfig.createForm, è¿™é‡Œå¯¹åº” createFormOption</span>
                    <span class="hljs-comment">// å­—æ®µåœ¨ createForm ä¸­ç›¸å…³é…ç½®</span>
                    <span class="hljs-attr">editFormOption</span>: {
                        ...eleComponentConfig, <span class="hljs-comment">// æ ‡å‡† el-component é…ç½®</span>
                        <span class="hljs-attr">comType</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// æ§ä»¶ç±»å‹ input/select/......</span>
                        <span class="hljs-attr">visible</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦å±•ç¤º (true/false), é»˜è®¤ä¸º true</span>
                        <span class="hljs-attr">disabled</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// æ˜¯å¦ç¦ç”¨ (true/false), é»˜è®¤ä¸º false</span>
                        <span class="hljs-attr">default</span>: <span class="hljs-string">''</span>, <span class="hljs-comment">// é»˜è®¤å€¼</span>

                        <span class="hljs-comment">// comType === 'select' æ—¶ç”Ÿæ•ˆ</span>
                        <span class="hljs-attr">enumList</span>: [], <span class="hljs-comment">// ä¸‹æ‹‰æ¡†å’Œé€‰é¡¹</span>
                        
                        <span class="hljs-comment">// comType === 'dynamicSelect'</span>
                        <span class="hljs-attr">api</span>: <span class="hljs-string">''</span>
                    },
                    <span class="hljs-attr">detailPanelOption</span>: {}ï¼Œ
                    <span class="hljs-attr">createFormOption</span>: {}
                },
                ...{}
            },
            <span class="hljs-attr">required</span>: [<span class="hljs-string">'product_name'</span>]
        },
        <span class="hljs-attr">tableConfig</span>: {
            <span class="hljs-attr">headerButtons</span>: [],
            <span class="hljs-attr">rowButtons</span>: [{
                <span class="hljs-attr">label</span>: <span class="hljs-string">'ä¿®æ”¹'</span>,
                <span class="hljs-attr">eventKey</span>: <span class="hljs-string">'showComponent'</span>,
                <span class="hljs-attr">eventOption</span>: {
                    <span class="hljs-attr">comName</span>: <span class="hljs-string">'editForm'</span>
                },
                <span class="hljs-attr">type</span>: <span class="hljs-string">'warning'</span>,
            },
            ]
        },
        <span class="hljs-attr">componentConfig</span>: {
            <span class="hljs-attr">createForm</span>: {},
            <span class="hljs-attr">editForm</span>: {
                <span class="hljs-attr">mainKey</span>: <span class="hljs-string">'product_id'</span>,
                <span class="hljs-attr">title</span>: <span class="hljs-string">'ä¿®æ”¹å•†å“'</span>,
                <span class="hljs-attr">saveBtnText</span>: <span class="hljs-string">'ä¿®æ”¹å•†å“'</span>,
            },
            <span class="hljs-attr">detailPanel</span>: {}
        },
    }
}
</code></pre>
<h3 data-id="heading-4">3.ç»„ä»¶é…ç½®è§£æå™¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useMenuStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@store/menu'</span>;
<span class="hljs-keyword">import</span> { cloneDeep } <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash/fp'</span>;
<span class="hljs-keyword">import</span> { computed, reactive, toRefs, watchEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { useRoute } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useSchema</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> route = <span class="hljs-title function_">useRoute</span>();
  <span class="hljs-keyword">const</span> menuStore = <span class="hljs-title function_">useMenuStore</span>();

  <span class="hljs-comment">// ä½¿ç”¨ reactive ç®¡ç†ç›¸å…³çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
    <span class="hljs-attr">components</span>: {},
  });

  <span class="hljs-comment">// é€šç”¨æ„å»º schema æ–¹æ³•, ä¸è¿”å›æ— å…³çš„å­—æ®µ</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">buildToSchema</span> = (<span class="hljs-params">_schema, comName</span>) =&gt; {
    <span class="hljs-keyword">if</span> (!_schema?.<span class="hljs-property">properties</span>) <span class="hljs-keyword">return</span> {};

    <span class="hljs-keyword">const</span> dtoSchema = {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
      <span class="hljs-attr">properties</span>: {},
    };

    <span class="hljs-comment">// æå–æœ‰æ•ˆ schema å­—æ®µä¿¡æ¯</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> _schema.<span class="hljs-property">properties</span>) {
      <span class="hljs-keyword">const</span> props = _schema.<span class="hljs-property">properties</span>[key];
      <span class="hljs-keyword">if</span> (props[<span class="hljs-string">`<span class="hljs-subst">${comName}</span>Option`</span>]) {
        <span class="hljs-keyword">let</span> dtoProps = {};
        <span class="hljs-comment">// æå– props ä¸­é option çš„éƒ¨åˆ†ï¼Œå­˜æ”¾åˆ° dtoProps ä¸­</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> pKey <span class="hljs-keyword">in</span> props) {
          <span class="hljs-keyword">if</span> (pKey.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">'Option'</span>) &lt; <span class="hljs-number">0</span>) {
            dtoProps[pKey] = props[pKey];
          }
        }
        <span class="hljs-comment">// å¤„ç† comName Option</span>
        dtoProps = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({}, dtoProps, { <span class="hljs-attr">option</span>: props[<span class="hljs-string">`<span class="hljs-subst">${comName}</span>Option`</span>] });

        <span class="hljs-comment">// å¤„ç† required å­—æ®µ</span>
        <span class="hljs-keyword">const</span> { required } = _schema;
        <span class="hljs-keyword">if</span> (required &amp;&amp; required.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">pk</span>) =&gt;</span> pk === key)) {
          dtoProps.<span class="hljs-property">option</span>.<span class="hljs-property">required</span> = <span class="hljs-literal">true</span>;
        }

        dtoSchema.<span class="hljs-property">properties</span>[key] = dtoProps;
      }
    }

    <span class="hljs-keyword">return</span> dtoSchema;
  };

  <span class="hljs-title function_">watchEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> { key, sider_key } = route.<span class="hljs-property">query</span>;
    <span class="hljs-keyword">const</span> menuItem = menuStore.<span class="hljs-title function_">findMenuItem</span>({
      <span class="hljs-attr">key</span>: <span class="hljs-string">'key'</span>,
      <span class="hljs-attr">value</span>: sider_key ?? key,
    });

    <span class="hljs-keyword">if</span> (!menuItem?.<span class="hljs-property">schemaConfig</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> { <span class="hljs-attr">schemaConfig</span>: sConfig } = menuItem;
    <span class="hljs-keyword">const</span> configSchema = <span class="hljs-title function_">cloneDeep</span>(sConfig.<span class="hljs-property">schema</span>);

    <span class="hljs-comment">// æ„é€  components = { componentA: { schema, config } }</span>
    <span class="hljs-keyword">const</span> { componentConfig } = sConfig;
    <span class="hljs-keyword">if</span> (componentConfig &amp;&amp; <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(componentConfig).<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">const</span> dtoComponents = {};

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> comName <span class="hljs-keyword">in</span> componentConfig) {
        dtoComponents[comName] = {
          <span class="hljs-attr">schema</span>: <span class="hljs-title function_">buildToSchema</span>(configSchema, comName),
          <span class="hljs-attr">config</span>: componentConfig[comName],
        };
      }

      state.<span class="hljs-property">components</span> = dtoComponents;
    }
  });

  <span class="hljs-keyword">return</span> {
    ...<span class="hljs-title function_">toRefs</span>(state),
  };
};
</code></pre>
<p>ç»è¿‡ hook è§£æåï¼Œæœ€ç»ˆ components çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">components = {
  <span class="hljs-attr">comKey</span>: { <span class="hljs-comment">// ç»„ä»¶åç§°</span>
    <span class="hljs-attr">schema</span>: {}, <span class="hljs-comment">//  schema</span>
    <span class="hljs-attr">config</span>: {} <span class="hljs-comment">// ç»„ä»¶å¯¹åº”çš„ componentConfig é…ç½®</span>
  } 
}
</code></pre>
<p>é…ç½®ç»„ä»¶æ˜ å°„ï¼Œé€šè¿‡ç»„ä»¶åæ¸²æŸ“ç›¸åº”çš„ç»„ä»¶ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">InputNumber</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./complex-view/input-number/input-number.vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Input</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./complex-view/input/input.vue'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Select</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./complex-view/select/select.vue'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">FormItemConfig</span> = {
  <span class="hljs-attr">input</span>: {
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Input</span>,
  },
  <span class="hljs-attr">inputNumber</span>: {
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">InputNumber</span>,
  },
  <span class="hljs-attr">select</span>: {
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Select</span>,
  },
};
</code></pre>
<p>ä½¿ç”¨åŠ¨æ€ç»„ä»¶</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">FormItemConfig</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./form-item-config'</span>;
<span class="hljs-keyword">import</span> { provide, ref, toRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">schema</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> {},
  },
  <span class="hljs-attr">model</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> {},
  },
});
<span class="hljs-keyword">const</span> { schema, model } = <span class="hljs-title function_">toRefs</span>(props);

<span class="hljs-keyword">const</span> <span class="hljs-title class_">FormComList</span> = <span class="hljs-title function_">ref</span>([]);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-row</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"schema &amp;&amp; schema.properties"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"schema-form"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(schemaItem, key) in schema.properties"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">component</span>
        <span class="hljs-attr">:is</span>=<span class="hljs-string">"FormItemConfig[schemaItem?.option?.comType].component"</span>
        <span class="hljs-attr">v-show</span>=<span class="hljs-string">"schemaItem.option.visible !== false"</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">"FormComList"</span>
        <span class="hljs-attr">:schema</span>=<span class="hljs-string">"schemaItem"</span>
        <span class="hljs-attr">:schema-key</span>=<span class="hljs-string">"key"</span>
        <span class="hljs-attr">:model</span>=<span class="hljs-string">"model ? model[key] : undefined"</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-row</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h2 data-id="heading-5">æ€»ç»“</h2>
<p>åŠ¨æ€ç»„ä»¶æœºåˆ¶æ˜¯ DSL é©±åŠ¨ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ƒé€šè¿‡è§£è€¦è§†å›¾ä¸ä¸šåŠ¡é€»è¾‘ï¼Œå®ç°äº†ç»„ä»¶çš„çµæ´»åˆ›å»ºä¸ç®¡ç†ã€‚è¯¥æ¶æ„å½»åº•å‡çº§äº† Dashboard çš„å¼€å‘èŒƒå¼ï¼šè§†å›¾å±‚ç°å¯é€šè¿‡å£°æ˜å¼é…ç½®ç›´æ¥å®šä¹‰å¤æ‚äº¤äº’ç»„ä»¶ï¼ˆå¦‚å¼¹çª—ã€è¡¨å•ã€æŠ½å±‰ï¼‰ï¼Œè¿™æ„å‘³ç€å¼€å‘é‡å¿ƒä»ç¹ççš„è§†å›¾ç¼–ç è½¬å‘é«˜æ•ˆçš„é…ç½®åŒ–è®¾è®¡ã€‚è¿™ä¸ä»…æ˜¯å¼€å‘æ•ˆç‡çš„æå‡ï¼Œæ›´æ˜¯å¯ç»´æŠ¤æ€§ä¸æ‰©å±•æ€§çš„è´¨çš„é£è·ƒï¼Œä»è€Œä¸ºå¤æ‚ä¸­åå°åº”ç”¨çš„å¿«é€Ÿè¿­ä»£ä¸è§„æ¨¡åŒ–å‘å±•ï¼Œæä¾›äº†å¼ºæœ‰åŠ›çš„åº•å±‚æ”¯æ’‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite + React é»„é‡‘ç»„åˆï¼šæ‰“é€ ç§’å¼€ã€å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç°ä»£å‰ç«¯å·¥ç¨‹]]></title>    <link>https://juejin.cn/post/7584650857070870537</link>    <guid>https://juejin.cn/post/7584650857070870537</guid>    <pubDate>2025-12-17T15:11:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650857070870537" data-draft-id="7584714813365092390" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite + React é»„é‡‘ç»„åˆï¼šæ‰“é€ ç§’å¼€ã€å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç°ä»£å‰ç«¯å·¥ç¨‹"/> <meta itemprop="keywords" content="Vite,React.js,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-17T15:11:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xhxxx"/> <meta itemprop="url" content="https://juejin.cn/user/3235201610941578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite + React é»„é‡‘ç»„åˆï¼šæ‰“é€ ç§’å¼€ã€å¯ç»´æŠ¤ã€é«˜æ€§èƒ½çš„ç°ä»£å‰ç«¯å·¥ç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3235201610941578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xhxxx
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T15:11:58.000Z" title="Wed Dec 17 2025 15:11:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä½¿ç”¨ Vite æ„å»ºç°ä»£ React é¡¹ç›®ï¼šä»å·¥ç¨‹åŒ–è§†è§’æ·±å…¥è§£ææ¶æ„ä¸åŸç†</h2>
<p>åœ¨å‰ç«¯å·¥ç¨‹åŒ–æ—¥ç›Šå¤æ‚çš„ä»Šå¤©ï¼Œæ„å»ºå·¥å…·çš„é€‰æ‹©ç›´æ¥å½±å“å¼€å‘ä½“éªŒã€æ„å»ºæ•ˆç‡å’Œæœ€ç»ˆäº§ç‰©è´¨é‡ã€‚Vite ä½œä¸ºæ–°ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…·ï¼Œå‡­å€Ÿå…¶â€œå¿«å¦‚é—ªç”µâ€çš„å¼€å‘æœåŠ¡å™¨å’Œç®€æ´çš„é…ç½®ä½“ç³»ï¼Œè¿…é€Ÿæˆä¸º Reactã€Vue ç­‰ç°ä»£æ¡†æ¶çš„é¦–é€‰è„šæ‰‹æ¶ã€‚æœ¬æ–‡å°†ç³»ç»Ÿæ€§åœ°å‰–æ Vite çš„åº•å±‚æœºåˆ¶ã€å·¥ç¨‹ä¼˜åŠ¿ã€ç›®å½•ç»“æ„è®¾è®¡å“²å­¦ï¼Œå¹¶æ·±å…¥è§£è¯» React é¡¹ç›®çš„ç»„ä»¶ç»„ç»‡æ–¹å¼ã€è·¯ç”±é…ç½®é€»è¾‘ä¸ä¾èµ–ç®¡ç†ç­–ç•¥ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºä¸€ä¸ªå¯ç»´æŠ¤ã€å¯æ‰©å±•ã€é«˜æ€§èƒ½çš„ React åº”ç”¨éª¨æ¶ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€Viteï¼šä¸æ­¢æ˜¯â€œå¿«â€ï¼Œæ›´æ˜¯ç°ä»£å‰ç«¯å·¥ç¨‹çš„æ–°èŒƒå¼</h3>
<h4 data-id="heading-2">1.1 Vite çš„æ ¸å¿ƒåŸç†ï¼šåŸç”Ÿ ESM + æŒ‰éœ€ç¼–è¯‘</h4>
<p>ä¼ ç»Ÿæ„å»ºå·¥å…·ï¼ˆå¦‚ Webpackï¼‰åœ¨å¼€å‘é˜¶æ®µéœ€è¦å…ˆæ‰“åŒ…æ•´ä¸ªåº”ç”¨ï¼Œå†å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€‚éšç€é¡¹ç›®è§„æ¨¡å¢é•¿ï¼Œå†·å¯åŠ¨æ—¶é—´å¯èƒ½é•¿è¾¾æ•°åç§’ã€‚</p>
<p>è€Œ Vite å®Œå…¨é¢ è¦†äº†è¿™ä¸€æµç¨‹ï¼š</p>
<ul>
<li>
<p><strong>å¼€å‘é˜¶æ®µï¼ˆDevï¼‰</strong> ï¼š</p>
<ul>
<li>åˆ©ç”¨ç°ä»£æµè§ˆå™¨å¯¹ <strong>åŸç”Ÿ ES æ¨¡å—ï¼ˆESMï¼‰</strong> çš„æ”¯æŒï¼ˆ<code>&lt;script type="module"&gt;</code>ï¼‰ã€‚</li>
<li>å¯åŠ¨æ—¶<strong>ä¸æ‰“åŒ…</strong>ï¼Œä»…å¯åŠ¨ä¸€ä¸ªè½»é‡çº§å¼€å‘æœåŠ¡å™¨ï¼ˆåŸºäº Koaï¼‰ã€‚</li>
<li>å½“æµè§ˆå™¨è¯·æ±‚å…¥å£æ–‡ä»¶ï¼ˆå¦‚ <code>main.jsx</code>ï¼‰æ—¶ï¼ŒVite åŠ¨æ€è§£ææ¨¡å—ä¾èµ–ï¼Œ<strong>æŒ‰éœ€ç¼–è¯‘å¹¶è¿”å›å•ä¸ªæ¨¡å—</strong>ã€‚</li>
<li>å¯¹äºé ESM å…¼å®¹çš„ä¾èµ–ï¼ˆå¦‚ CommonJS çš„ npm åŒ…ï¼‰ï¼ŒVite åœ¨é¢„æ„å»ºé˜¶æ®µï¼ˆPre-bundlingï¼‰ä½¿ç”¨ <strong>esbuild</strong> å°†å…¶è½¬æ¢ä¸º ESM æ ¼å¼ï¼ˆå­˜å…¥ <code>node_modules/.vite/</code>ï¼‰ï¼Œå®ç°æé€ŸåŠ è½½ã€‚</li>
</ul>
</li>
</ul>
<blockquote>
<p>âœ… <strong>ç»“æœ</strong>ï¼šæ— è®ºé¡¹ç›®å¤šå¤§ï¼Œå†·å¯åŠ¨å§‹ç»ˆåœ¨ <strong>100ms~500ms</strong> å†…å®Œæˆã€‚</p>
</blockquote>
<ul>
<li>
<p><strong>ç”Ÿäº§é˜¶æ®µï¼ˆBuildï¼‰</strong> ï¼š</p>
<ul>
<li>ä½¿ç”¨ <strong>Rollup</strong> è¿›è¡ŒçœŸæ­£çš„æ‰“åŒ…ã€Tree-shakingã€ä»£ç åˆ†å‰²ã€å‹ç¼©ç­‰ä¼˜åŒ–ã€‚</li>
<li>Rollup ä»¥â€œè¾“å‡ºæœ€å°ã€æœ€é«˜æ•ˆä»£ç â€ä¸ºç›®æ ‡ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒã€‚</li>
</ul>
</li>
</ul>
<p>è¿™æ­£æ˜¯ Vite æ‰€å€¡å¯¼çš„ï¼šâ€œ<strong>esm æ¨¡å—åŒ–ï¼Œæè‡´çš„å†·å¯åŠ¨</strong>â€â€”â€”å®ƒä¸æ˜¯å™±å¤´ï¼Œè€Œæ˜¯å¯¹ç°ä»£æµè§ˆå™¨èƒ½åŠ›çš„å……åˆ†åˆ©ç”¨ã€‚</p>
<h4 data-id="heading-3">1.2 Vite çš„å…³é”®ä¼˜åŠ¿è¯¦è§£</h4>



































<table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th><th>å¼€å‘ä½“éªŒæå‡</th></tr></thead><tbody><tr><td><strong>æé€Ÿ HMRï¼ˆçƒ­æ›´æ–°ï¼‰</strong></td><td>åŸºäºåŸç”Ÿ ESMï¼Œæ›´æ–°æ—¶ä»…é‡æ–°è¯·æ±‚å˜æ›´æ¨¡å—åŠå…¶ç›´æ¥çˆ¶çº§ï¼Œæ— éœ€é‡è½½æ•´ä¸ªåº”ç”¨</td><td>ä¿®æ”¹å³è§ï¼Œæ— ç™½å±ï¼ŒçŠ¶æ€ä¿ç•™</td></tr><tr><td><strong>å¼€ç®±å³ç”¨çš„ç°ä»£è¯­æ³•æ”¯æŒ</strong></td><td>å†…ç½® JSXã€TypeScriptã€CSS Modulesã€PostCSSã€JSON ç­‰</td><td>æ— éœ€æ‰‹åŠ¨é…ç½® Babelã€PostCSS æ’ä»¶</td></tr><tr><td><strong>å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿ</strong></td><td>å…¼å®¹ Rollup æ’ä»¶ + ä¸“å± Vite æ’ä»¶ï¼ˆå¦‚ <code>@vitejs/plugin-react</code>ï¼‰</td><td>å¯æ‰©å±•æ€§å¼ºï¼Œç”Ÿæ€ä¸°å¯Œ</td></tr><tr><td><strong>ä¼˜åŒ–çš„ä¾èµ–é¢„æ„å»º</strong></td><td>ä½¿ç”¨ esbuildï¼ˆGo ç¼–å†™ï¼Œæ¯” JS å¿« 10~100 å€ï¼‰é¢„å¤„ç† node_modules</td><td>é¦–æ¬¡åŠ è½½å¿«ï¼Œé¿å…æµè§ˆå™¨å¤„ç† CJS</td></tr><tr><td><strong>ç¯å¢ƒå˜é‡ä¸æ¨¡å¼æ”¯æŒ</strong></td><td>æ”¯æŒ <code>.env</code> æ–‡ä»¶ï¼ŒæŒ‰ <code>development</code> / <code>production</code> è‡ªåŠ¨åŠ è½½</td><td>æ— ç¼åˆ‡æ¢å¼€å‘ã€æµ‹è¯•ã€çº¿ä¸Šç¯å¢ƒ</td></tr></tbody></table>
<p>æ‰§è¡Œ <code>npm run dev</code> èƒ½ç«‹å³å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œæ­£æ˜¯å› ä¸º Vite è·³è¿‡äº†ä¼ ç»Ÿæ‰“åŒ…æ­¥éª¤ï¼Œç›´æ¥æœåŠ¡æºç ã€‚</p>
<h4 data-id="heading-4">1.3 Vite çš„è¿è¡Œç¯å¢ƒè¦æ±‚</h4>
<p>Vite å®Œå…¨åŸºäº Node.js ç¯å¢ƒï¼Œä½†å¯¹ç‰ˆæœ¬æœ‰æ˜ç¡®è¦æ±‚ï¼š</p>
<ul>
<li>
<p><strong>Node.js â‰¥ 18.0</strong>ï¼ˆæ¨è â‰¥ 20.0ï¼‰</p>
<ul>
<li>åˆ©ç”¨ç°ä»£ Node ç‰¹æ€§ï¼ˆå¦‚ ESMã€Top-level awaitï¼‰</li>
<li>æ’ä»¶ï¼ˆå¦‚ <code>@vitejs/plugin-react@5.1.2</code>ï¼‰æ˜ç¡®è¦æ±‚ <code>node: "^20.19.0 || &gt;=22.12.0"</code></li>
</ul>
</li>
</ul>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>å¿…é¡»åœ¨æ”¯æŒ ESM çš„ Node ç¯å¢ƒä¸­è¿è¡Œ Viteã€‚</li>
<li>æ‰€æœ‰æ„å»ºã€æ’ä»¶æ‰§è¡Œã€HMR é€»è¾‘å‡ç”± Node.js é©±åŠ¨ã€‚</li>
<li>ç”Ÿäº§æ„å»ºäº§ç‰©ï¼ˆ<code>dist/</code>ï¼‰æ˜¯çº¯é™æ€èµ„æºï¼Œ<strong>ä¸ä¾èµ– Node.js</strong>ï¼Œå¯éƒ¨ç½²åˆ°ä»»ä½• CDN æˆ–é™æ€æœåŠ¡å™¨ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">ä½¿ç”¨Viteæ„å»ºä¸€ä¸ªreacté¡¹ç›®</h3>
<ol>
<li>ä½¿ç”¨npm init vite</li>
<li>è¾“å…¥é¡¹ç›®åç§°</li>
<li>é€‰æ‹©reactæ¡†æ¶</li>
<li>é€‰æ‹©è¯­è¨€</li>
<li>é€‰æ‹©æ‰“åŒ…å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬æ‹’ç»ï¼Œé€‰æ‹©ä½¿ç”¨é»˜è®¤çš„Rollup</li>
<li>å®‰è£…ç«‹å³å¯åŠ¨(æ‰‹åŠ¨å¯åŠ¨éœ€è¦åœ¨ç»ˆç«¯æ•²ä¸‹<strong>npm run dev</strong>)
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1124f2c8baa4fdd940a6cefa1578699~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766589117&amp;x-signature=BEt0G4f94jKFVnZ56woQOvZxacY%3D" alt="image.png" loading="lazy"/><br/>
<strong>æ­å»ºæˆåŠŸï¼</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4688325bca5f4643ad62c6d6b264834b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766589117&amp;x-signature=twoTn867A8yb337YMYfwm9j%2F52Y%3D" alt="image.png" loading="lazy"/></li>
</ol>
<h5 data-id="heading-6">é¡¹ç›®çš„ç»“æ„åˆå§‹ç»“æ„ç›®å½•ï¼š</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/450263e107b0409fb667499f84a55f44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766589117&amp;x-signature=3OWWN1IvJ%2BX8QSdCd8Wld1akryk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">äºŒã€Vite é¡¹ç›®ç›®å½•ç»“æ„æ·±åº¦è§£æ</h3>
<p>é€šè¿‡ <code>npm init vite</code> åˆ›å»ºçš„ React é¡¹ç›®ï¼Œéµå¾ªäº† Vite æ¨èçš„æ ‡å‡†åŒ–ç»“æ„ã€‚ä»¥ä¸‹æ˜¯æ¯ä¸ªç›®å½•/æ–‡ä»¶çš„è¯¦ç»†ä½œç”¨ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">my-react-app/
â”œâ”€â”€ node_modules/               <span class="hljs-meta"># é¡¹ç›®å®‰è£…çš„æ‰€æœ‰ä¾èµ–åŒ…</span>
â”œâ”€â”€ <span class="hljs-keyword">public</span>/                     <span class="hljs-meta"># é™æ€èµ„æºç›®å½•</span>
â”‚   â””â”€â”€ favicon.ico             <span class="hljs-meta"># ç¤ºä¾‹é™æ€æ–‡ä»¶ï¼Œæ„å»ºæ—¶åŸæ ·å¤åˆ¶åˆ°è¾“å‡ºç›®å½•æ ¹è·¯å¾„</span>
â”œâ”€â”€ src/                        <span class="hljs-meta"># æºä»£ç ä¸»ç›®å½•</span>
â”‚   â”œâ”€â”€ assets/                 <span class="hljs-meta"># é¡¹ç›®å†…éƒ¨å¼•ç”¨çš„é™æ€èµ„æºï¼ˆå¦‚å›¾ç‰‡ã€å­—ä½“ç­‰ï¼‰</span>
â”‚   â”œâ”€â”€ components/             <span class="hljs-meta"># å¯å¤ç”¨çš„ UI ç»„ä»¶æ¨¡å—</span>
â”‚   â”œâ”€â”€ pages/                  <span class="hljs-meta"># é¡µé¢çº§ç»„ä»¶ï¼Œé€šå¸¸ç”±è·¯ç”±ç›´æ¥æ¸²æŸ“</span>
â”‚   â”œâ”€â”€ router/                 <span class="hljs-meta"># è·¯ç”±é…ç½®ç›¸å…³ä»£ç </span>
â”‚   â”œâ”€â”€ App.jsx                 <span class="hljs-meta"># åº”ç”¨çš„æ ¹ç»„ä»¶ï¼Œå®šä¹‰å…¨å±€å¸ƒå±€ç»“æ„</span>
â”‚   â””â”€â”€ main.jsx                <span class="hljs-meta"># åº”ç”¨çš„ JavaScript å…¥å£æ–‡ä»¶</span>
â”œâ”€â”€ index.html                  <span class="hljs-meta"># å”¯ä¸€ HTML æ¨¡æ¿æ–‡ä»¶</span>
â”œâ”€â”€ .gitignore                  <span class="hljs-meta"># Git å¿½ç•¥é…ç½®</span>
â”œâ”€â”€ eslint.config.js            <span class="hljs-meta"># ESLint ä»£ç è§„èŒƒé…ç½®</span>
â”œâ”€â”€ package.json                <span class="hljs-meta"># é¡¹ç›®å…ƒä¿¡æ¯ä¸ä¾èµ–å£°æ˜</span>
â”œâ”€â”€ package-<span class="hljs-keyword">lock</span>.json           <span class="hljs-meta"># ä¾èµ–ç‰ˆæœ¬é”å®šæ–‡ä»¶</span>
â”œâ”€â”€ README.md                   <span class="hljs-meta"># é¡¹ç›®è¯´æ˜æ–‡æ¡£</span>
â””â”€â”€ vite.config.js              <span class="hljs-meta"># Vite æ„å»ºä¸å¼€å‘æœåŠ¡å™¨é…ç½®æ–‡ä»¶</span>
</code></pre>
<h4 data-id="heading-8">ğŸ”§ å…³é”®é…ç½®æ–‡ä»¶è¯¦è§£</h4>
<h5 data-id="heading-9"><code>vite.config.js</code> â€”â€” Vite çš„â€œå¤§è„‘â€</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">react</span>()],
})
</code></pre>
<ul>
<li>
<p><strong><code>defineConfig</code></strong>ï¼šæä¾›ç±»å‹æç¤ºï¼ˆé…åˆ TypeScriptï¼‰å’Œé…ç½®éªŒè¯ã€‚</p>
</li>
<li>
<p><strong><code>plugins: [react()]</code></strong> ï¼š</p>
<ul>
<li>
<p>è¿™æ˜¯ <strong>React é¡¹ç›®çš„æ ¸å¿ƒæ’ä»¶</strong>ã€‚</p>
</li>
<li>
<p>è‡ªåŠ¨å¯ç”¨ï¼š</p>
<ul>
<li>Fast Refreshï¼ˆReact å®˜æ–¹ HMR æ–¹æ¡ˆï¼Œä¿ç•™ç»„ä»¶çŠ¶æ€ï¼‰</li>
<li>JSX è¯­æ³•è½¬æ¢ï¼ˆæ— éœ€å•ç‹¬é…ç½® Babelï¼‰</li>
<li>å¼€å‘ç¯å¢ƒä¸­çš„ <code>jsx-dev-runtime</code> ä¼˜åŒ–</li>
</ul>
</li>
<li>
<p>è‹¥æœªé…ç½®æ­¤æ’ä»¶ï¼ŒVite æ— æ³•æ­£ç¡®å¤„ç† <code>.jsx</code> æ–‡ä»¶ï¼</p>
</li>
</ul>
</li>
</ul>
<p>è¯¥æ’ä»¶æ˜¯ Vite ä¸ React ç”Ÿæ€çš„æ¡¥æ¢ï¼Œè®©å¼€å‘è€…æ— éœ€å…³å¿ƒåº•å±‚è½¬è¯‘ç»†èŠ‚ã€‚</p>
<h5 data-id="heading-10"><code>package.json</code> â€”â€” ä¾èµ–ä¸è„šæœ¬çš„æŒ‡æŒ¥ä¸­å¿ƒ</h5>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^19.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^19.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react-router-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.10.1"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^7.3.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vitejs/plugin-react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.1.2"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>
<p><strong><code>scripts</code></strong>ï¼šå®šä¹‰æ ‡å‡†å·¥ä½œæµï¼ˆdev â†’ build â†’ previewï¼‰ã€‚</p>
</li>
<li>
<p><strong><code>dependencies</code> vs <code>devDependencies</code></strong>ï¼ˆé‡ç‚¹ï¼ï¼‰ï¼š</p>
<ul>
<li>
<p><strong><code>dependencies</code></strong>ï¼š<strong>è¿è¡Œæ—¶ä¾èµ–</strong>ã€‚è¿™äº›ä»£ç ä¼šè¢«æ‰“åŒ…è¿›æœ€ç»ˆäº§ç‰©ï¼ˆ<code>dist/assets/</code> ä¸­çš„ JS æ–‡ä»¶ï¼‰ï¼Œåœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­æ‰§è¡Œã€‚</p>
<ul>
<li><code>react</code>ï¼šReact æ ¸å¿ƒåº“ï¼ˆè™šæ‹Ÿ DOMã€Hooks ç­‰ï¼‰</li>
<li><code>react-dom</code>ï¼šDOM æ¸²æŸ“å™¨ï¼ˆ<code>createRoot</code>ï¼‰</li>
<li><code>react-router-dom</code>ï¼šå®¢æˆ·ç«¯è·¯ç”±é€»è¾‘</li>
</ul>
</li>
<li>
<p><strong><code>devDependencies</code></strong>ï¼š<strong>å¼€å‘æ—¶ä¾èµ–</strong>ã€‚ä»…ç”¨äºæœ¬åœ°å¼€å‘ã€æ„å»ºè¿‡ç¨‹ï¼Œ<strong>ä¸ä¼šå‡ºç°åœ¨ç”Ÿäº§åŒ…ä¸­</strong>ã€‚</p>
<ul>
<li><code>vite</code>ï¼šå¼€å‘æœåŠ¡å™¨ + æ„å»ºå·¥å…·</li>
<li><code>@vitejs/plugin-react</code>ï¼šReact æ’ä»¶ï¼ˆå¼€å‘æ—¶è½¬æ¢ JSXï¼Œç”Ÿäº§æ—¶ä¼˜åŒ–ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>ğŸ’¡ <strong>ä¸¾ä¸ªä¾‹å­</strong>ï¼šå¦‚æœé¡¹ç›®ä½¿ç”¨ Stylus ä½œä¸º CSS é¢„å¤„ç†å™¨ï¼Œé‚£ä¹ˆ <code>stylus</code> åŒ…åº”å®‰è£…åœ¨ <code>devDependencies</code> ä¸­ã€‚å› ä¸º Vite ä¼šåœ¨æ„å»ºæ—¶å°†å…¶ç¼–è¯‘ä¸ºæ ‡å‡† CSSï¼Œæœ€ç»ˆäº§ç‰©ä¸­ä¸éœ€è¦ Stylus è¿è¡Œæ—¶ã€‚è¿™ä½“ç°äº† <strong>å¼€å‘å·¥å…·ä¸è¿è¡Œæ—¶é€»è¾‘çš„æ¸…æ™°åˆ†ç¦»</strong>ã€‚</p>
</blockquote>
<ul>
<li>
<p><strong><code>public/</code> â€”â€” â€œé—¨é¢å±•å…â€</strong><br/>
è¿™é‡Œå­˜æ”¾çš„æ˜¯<strong>ä¸éœ€è¦åŠ å·¥ã€ç›´æ¥å¯¹å¤–å±•ç¤º</strong>çš„é™æ€èµ„æºï¼Œæ¯”å¦‚ç½‘ç«™å›¾æ ‡ï¼ˆfaviconï¼‰ã€robots.txt æˆ–ç¬¬ä¸‰æ–¹è„šæœ¬ã€‚æ„å»ºæ—¶ï¼ŒVite ä¼šåƒæ¬è¿å·¥ä¸€æ ·ï¼ŒæŠŠè¿™äº›æ–‡ä»¶åŸå°ä¸åŠ¨åœ°æ¬åˆ°è¾“å‡ºç›®å½•çš„é—¨å£ï¼Œä¾›ç”¨æˆ·ç›´æ¥è®¿é—®ã€‚</p>
</li>
<li>
<p><strong><code>src/</code> â€”â€” â€œæ ¸å¿ƒç”Ÿäº§è½¦é—´â€</strong><br/>
æ‰€æœ‰æºä»£ç éƒ½åœ¨è¿™é‡Œè¯ç”Ÿï¼Œæ˜¯æ•´ä¸ªåº”ç”¨çš„å¿ƒè„åœ°å¸¦ã€‚</p>
</li>
<li>
<p><strong><code>assets/</code>Â â€”â€” â€œç´ æä»“åº“â€</strong><br/>
å­˜æ”¾é¡¹ç›®å†…éƒ¨ä½¿ç”¨çš„å›¾ç‰‡ã€å­—ä½“ã€éŸ³è§†é¢‘ç­‰èµ„æºã€‚Vite ä¼šå¯¹å®ƒä»¬è¿›è¡Œå‹ç¼©ã€å“ˆå¸Œå‘½åç­‰å¤„ç†ï¼Œç¡®ä¿åŠ è½½æ›´å¿«ã€ç¼“å­˜æ›´æœ‰æ•ˆã€‚</p>
</li>
<li>
<p><strong><code>components/</code>Â â€”â€” â€œæ ‡å‡†é›¶ä»¶åº“â€</strong><br/>
è¿™é‡Œå­˜æ”¾çš„æ˜¯å¯å¤ç”¨çš„ UIâ€œç§¯æœ¨â€ï¼Œæ¯”å¦‚æŒ‰é’®ã€å¡ç‰‡ã€è¡¨å•æ§ä»¶ã€‚å®ƒä»¬ä¸å…³å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œåªè´Ÿè´£æ ¹æ®ä¼ å…¥çš„ props æ¸²æŸ“ç•Œé¢ï¼Œåƒä¹é«˜ä¸€æ ·çµæ´»ç»„åˆã€‚</p>
</li>
<li>
<p><strong><code>pages/</code>Â â€”â€” â€œæˆå“è£…é…çº¿â€</strong><br/>
æ¯ä¸ªé¡µé¢ç»„ä»¶ä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„è§†å›¾å•å…ƒï¼Œé€šå¸¸å¯¹åº”ä¸€ä¸ª URL è·¯å¾„ã€‚å®ƒè´Ÿè´£è°ƒåº¦å¤šä¸ªâ€œé›¶ä»¶â€ï¼ˆcomponentsï¼‰ï¼Œå¹¶å¤„ç†æ•°æ®è·å–ã€çŠ¶æ€ç®¡ç†ç­‰é¡¶å±‚é€»è¾‘ï¼Œæ˜¯ç”¨æˆ·çœ‹åˆ°çš„æœ€ç»ˆâ€œæˆå“â€ã€‚</p>
</li>
<li>
<p><strong><code>router/</code>Â â€”â€” â€œäº¤é€šè°ƒåº¦ä¸­å¿ƒâ€</strong><br/>
é›†ä¸­ç®¡ç†æ‰€æœ‰é¡µé¢ä¹‹é—´çš„è·³è½¬è§„åˆ™ã€‚å°±åƒåŸå¸‚äº¤é€šæŒ‡æŒ¥ç³»ç»Ÿï¼Œå†³å®šç”¨æˆ·è®¿é—®Â <code>/about</code>Â æ—¶è¯¥å±•ç¤ºå“ªä¸ªé¡µé¢ï¼Œç¡®ä¿å¯¼èˆªæ¸…æ™°ã€è·¯å¾„å¯æ§ã€‚</p>
</li>
<li>
<p><strong><code>App.jsx</code>Â â€”â€” â€œå»ºç­‘éª¨æ¶â€</strong><br/>
å®šä¹‰åº”ç”¨çš„æ•´ä½“å¸ƒå±€ç»“æ„ï¼Œæ¯”å¦‚é¡¶éƒ¨å¯¼èˆªæ ã€ä¾§è¾¹æ æˆ–é¡µè„šã€‚å®ƒåŒ…è£¹ç€è·¯ç”±å‡ºå£ï¼Œæ˜¯æ‰€æœ‰é¡µé¢å…±äº«çš„â€œå¤–å£³â€ã€‚</p>
</li>
<li>
<p><strong><code>main.jsx</code>Â â€”â€” â€œå¯åŠ¨å¼€å…³â€</strong><br/>
åº”ç”¨çš„å…¥å£ç‚¹ï¼Œç›¸å½“äºå·¥å‚çš„æ€»ç”µæºã€‚å®ƒè°ƒç”¨ React çš„Â <code>createRoot</code>ï¼Œå°†æ•´ä¸ªåº”ç”¨æŒ‚è½½åˆ° HTML ä¸­çš„æ ¹èŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨æ•´ä¸ª React ç”Ÿå‘½å‘¨æœŸã€‚</p>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//import { StrictMode } from 'react'</span>
<span class="hljs-keyword">import</span> { createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/client'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./index.styl'</span><span class="hljs-comment">//å…¨å±€æ ·å¼ stylus</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.jsx'</span> <span class="hljs-comment">//å¼•å…¥äº†ç»„ä»¶</span>

<span class="hljs-comment">// å°†Appç»„ä»¶æŒ‚è½½åˆ°rootå…ƒç´ ä¸Š æ¸²æŸ“render</span>
<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>)).<span class="hljs-title function_">render</span>(
 <span class="hljs-comment">// å‡½æ•°ç»„ä»¶å ç±»html æ ‡ç­¾ è‡ªå®šä¹‰ç»„ä»¶</span>
 <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><span class="hljs-comment">//jsx</span>

)

</code></pre>
<ul>
<li><strong><code>index.html</code> â€”â€” â€œå”¯ä¸€é—¨ç‰Œâ€</strong><br/>
è¿™æ˜¯æ•´ä¸ªåº”ç”¨å”¯ä¸€çš„ HTML æ–‡ä»¶ï¼Œå¦‚åŒä¸€æ ‹å¤§æ¥¼çš„æ­£é—¨ã€‚Vite ä¼šåœ¨å¼€å‘æˆ–æ„å»ºæ—¶è‡ªåŠ¨å‘å…¶ä¸­æ³¨å…¥æ‰€éœ€çš„è„šæœ¬æ ‡ç­¾ï¼Œå¼€å‘è€…æ— éœ€æ‰‹åŠ¨ç»´æŠ¤èµ„æºå¼•ç”¨ã€‚</li>
</ul>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!doctype <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/vite.svg"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>react-demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"root"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.jsx"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<hr/>
<h3 data-id="heading-11">ä¸‰ã€React é¡¹ç›®æ¶æ„ï¼šç»„ä»¶åŒ–ä¸è·¯ç”±è®¾è®¡å“²å­¦</h3>
<p>å³ä½¿æ˜¯ä¸€ä¸ªå°å‹é¡¹ç›®ï¼Œä¹Ÿåº”ä½“ç° React åº”ç”¨çš„æœ€ä½³å®è·µã€‚</p>
<h4 data-id="heading-12">3.1 ç»„ä»¶åˆ†å±‚ï¼šå…³æ³¨ç‚¹åˆ†ç¦»</h4>





























<table><thead><tr><th>ç›®å½•</th><th>ç»„ä»¶ç±»å‹</th><th>èŒè´£</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>src/pages/</code></td><td><strong>é¡µé¢ç»„ä»¶ï¼ˆPage Componentsï¼‰</strong></td><td>ä»£è¡¨ä¸€ä¸ªå®Œæ•´è·¯ç”±è§†å›¾ï¼Œé€šå¸¸åŒ…å«ï¼š - æ•°æ®è·å–ï¼ˆuseEffect + fetchï¼‰ - é¡µé¢çº§çŠ¶æ€ - å­ç»„ä»¶ç»„åˆ</td><td><code>Home.jsx</code>, <code>About.jsx</code></td></tr><tr><td><code>src/components/</code></td><td><strong>UI ç»„ä»¶ï¼ˆPresentational Componentsï¼‰</strong></td><td>çº¯å±•ç¤ºç»„ä»¶ï¼Œæ¥æ”¶ propsï¼Œæ— ä¸šåŠ¡é€»è¾‘</td><td><code>&lt;RepoList repos={repos} /&gt;</code></td></tr><tr><td><code>src/App.jsx</code></td><td><strong>å¸ƒå±€ç»„ä»¶ï¼ˆLayout Componentï¼‰</strong></td><td>å®šä¹‰å…¨å±€ç»“æ„ï¼š - å¯¼èˆªæ  - é¡µè„š - è·¯ç”±å‡ºå£ï¼ˆ<code>&lt;Outlet /&gt;</code> æˆ– <code>&lt;AppRoutes /&gt;</code>ï¼‰</td><td>åŒ…å« <code>&lt;nav&gt;</code> å’Œ <code>&lt;AppRoutes /&gt;</code></td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·åˆ†ï¼Ÿ</strong></p>
<ul>
<li><strong>å¯å¤ç”¨æ€§</strong>ï¼šUI ç»„ä»¶å¯åœ¨å¤šä¸ªé¡µé¢å¤ç”¨ã€‚</li>
<li><strong>å¯æµ‹è¯•æ€§</strong>ï¼šé¡µé¢ç»„ä»¶ä¸“æ³¨æ•°æ®æµï¼ŒUI ç»„ä»¶ä¸“æ³¨æ¸²æŸ“ã€‚</li>
<li><strong>å¯ç»´æŠ¤æ€§</strong>ï¼šä¿®æ”¹å¯¼èˆªæ åªéœ€æ”¹ <code>App.jsx</code>ï¼Œä¸å½±å“é¡µé¢é€»è¾‘ã€‚</li>
</ul>
<h4 data-id="heading-13">3.2 è·¯ç”±é…ç½®ï¼šé›†ä¸­å¼ç®¡ç†</h4>
<p>ä½¿ç”¨è·¯ç”±éœ€è¦å…ˆå®‰è£…npm i react-router-dom</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/344236f03d4742b69f5bd2a8966f31c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGh4eHg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766589117&amp;x-signature=VXLz6BjjbmSxUuq114c0j5YUOko%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong><code>react</code></strong>ï¼šæä¾› React çš„æ ¸å¿ƒèƒ½åŠ›ï¼ˆå¦‚ Hooksã€ç»„ä»¶ã€çŠ¶æ€ç®¡ç†ï¼‰ï¼Œ<strong>ä¸æ¶‰åŠ DOM</strong>ï¼Œå¹³å°æ— å…³ã€‚</li>
<li><strong><code>react-dom</code></strong>ï¼šè´Ÿè´£å°† React ç»„ä»¶<strong>æ¸²æŸ“åˆ°æµè§ˆå™¨ DOM</strong>Â ä¸­ï¼Œæ˜¯ React åœ¨ Web ç¯å¢ƒçš„æ¸²æŸ“å™¨ã€‚</li>
</ul>
<p>äºŒè€…åˆ†ç¦»ï¼Œæ˜¯ä¸ºäº†æ”¯æŒè·¨å¹³å°ï¼ˆå¦‚ React Nativeï¼‰å’ŒèŒè´£è§£è€¦ã€‚
<code>src/router/index.jsx</code> é‡‡ç”¨ <strong>é›†ä¸­å¼è·¯ç”±å®šä¹‰</strong>ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/Home'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/About'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AppRoutes</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span>
  );
}
</code></pre>
<ul>
<li>
<p><strong><code>&lt;Routes&gt;</code></strong> ï¼šè·¯ç”±åŒ¹é…å®¹å™¨ï¼ˆå–ä»£æ—§ç‰ˆ <code>Switch</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong><code>&lt;Route&gt;</code></strong> ï¼š</p>
<ul>
<li><code>path</code>ï¼šURL è·¯å¾„ï¼ˆæ”¯æŒåŠ¨æ€è·¯ç”±å¦‚ <code>/user/:id</code>ï¼‰</li>
<li><code>element</code>ï¼š<strong>ç›´æ¥ä¼ å…¥ JSX å…ƒç´ </strong>ï¼ˆReact Router v6+ æ–°è¯­æ³•ï¼Œæ›´ç¬¦åˆ React æ€ç»´ï¼‰</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰è·¯ç”±ä¸€ç›®äº†ç„¶ï¼Œä¾¿äºç»´æŠ¤ã€‚</li>
<li>æ”¯æŒåµŒå¥—è·¯ç”±ã€æ‡’åŠ è½½ï¼ˆ<code>React.lazy</code> + <code>Suspense</code>ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<p>åœ¨ <code>App.jsx</code> ä¸­ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">Router</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AppRoutes</span> /&gt;</span></span> {<span class="hljs-comment">/* è·¯ç”±å‡ºå£ */</span>}
&lt;/<span class="hljs-title class_">Router</span>&gt;
</code></pre>
<p>è¿™ç§ç»“æ„å®ç°äº† <strong>å¸ƒå±€ä¸å†…å®¹çš„è§£è€¦</strong>ã€‚</p>
<h4 data-id="heading-14">3.3 æ•°æ®æµä¸å‰¯ä½œç”¨ç®¡ç†</h4>
<p>ä»¥ <code>pages/Home.jsx</code> ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [repos, setRepos] = <span class="hljs-title function_">useState</span>([]);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.github.com/users/'</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">setRepos</span>(data));
  }, []); <span class="hljs-comment">// ä¾èµ–æ•°ç»„ä¸ºç©º â†’ ä»…åœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œ</span>

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
      {repos.map(repo =&gt; <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{repo.id}</span>&gt;</span>{repo.name}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>)}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
  );
}
</code></pre>
<ul>
<li>
<p><strong><code>useState</code></strong>ï¼šç®¡ç†ç»„ä»¶å†…éƒ¨çŠ¶æ€ï¼ˆä»“åº“åˆ—è¡¨ï¼‰ã€‚</p>
</li>
<li>
<p><strong><code>useEffect</code></strong>ï¼šå°è£…å‰¯ä½œç”¨ï¼ˆæ•°æ®è·å–ï¼‰ã€‚</p>
<ul>
<li>ä¾èµ–æ•°ç»„ <code>[]</code> ç¡®ä¿åªæ‰§è¡Œä¸€æ¬¡ï¼ˆç±»ä¼¼ <code>componentDidMount</code>ï¼‰ã€‚</li>
<li>ç¬¦åˆ React â€œå‡½æ•°å¼â€ç¼–ç¨‹æ¨¡å‹ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™æ­£æ˜¯ React <strong>å“åº”å¼ã€ç»„ä»¶åŒ–ã€æ•°æ®ç»‘å®š</strong>çš„ä½“ç°ï¼š<br/>
<strong>çŠ¶æ€å˜åŒ– â†’ è‡ªåŠ¨è§¦å‘é‡æ–°æ¸²æŸ“ â†’ UI æ›´æ–°</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-15">å››ã€å¼€å‘å·¥ä½œæµï¼šä» dev åˆ° production</h3>
<p>æ ‡å‡†çš„å‰ç«¯äº¤ä»˜æµç¨‹å¯æ¦‚æ‹¬ä¸ºï¼š</p>
<pre><code class="hljs language-rust" lang="rust">dev <span class="hljs-punctuation">-&gt;</span> test <span class="hljs-punctuation">-&gt;</span> production <span class="hljs-punctuation">-&gt;</span> dev <span class="hljs-punctuation">-&gt;</span> test <span class="hljs-punctuation">-&gt;</span> production <span class="hljs-punctuation">-&gt;</span> ...
</code></pre>
<p>psï¼šè¡¨ç¤ºæ˜¯ç¯çŠ¶</p>
<h4 data-id="heading-16">å…·ä½“è½åœ°æ­¥éª¤ï¼š</h4>
<ol>
<li>
<p><strong>å¼€å‘ï¼ˆdevï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run dev  # å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ï¼ˆlocalhost:<span class="hljs-number">5173</span>ï¼‰
</code></pre>
<ul>
<li>å®æ—¶ç¼–è¯‘ JSXã€CSS</li>
<li>HMR çƒ­æ›´æ–°</li>
<li>ä»£ç† API è¯·æ±‚ï¼ˆå¯é…ç½® <code>vite.config.js</code>ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æµ‹è¯•ï¼ˆtestï¼‰</strong> ï¼š</p>
<ul>
<li>æ‰‹åŠ¨æµ‹è¯•ï¼š<code>npm run preview</code> é¢„è§ˆç”Ÿäº§åŒ…</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šé›†æˆ Jest + React Testing Libraryï¼ˆéœ€é¢å¤–é…ç½®ï¼‰</li>
</ul>
</li>
<li>
<p><strong>ç”Ÿäº§æ„å»ºï¼ˆproductionï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run build  # è¾“å‡ºåˆ° dist/ ç›®å½•
</code></pre>
<ul>
<li>Rollup æ‰“åŒ…ã€å‹ç¼©ã€Tree-shaking</li>
<li>ç”Ÿæˆå¸¦ hash çš„é™æ€èµ„æºï¼ˆç¼“å­˜å‹å¥½ï¼‰</li>
<li>ç§»é™¤å¼€å‘ä»£ç ï¼ˆå¦‚ PropTypesã€è­¦å‘Šï¼‰</li>
</ul>
</li>
<li>
<p><strong>éƒ¨ç½²</strong>ï¼š</p>
<ul>
<li>å°† <code>dist/</code> ç›®å½•ä¸Šä¼ è‡³ CDNã€Nginxã€Vercelã€Netlify ç­‰</li>
</ul>
</li>
</ol>
<p>Vite çš„ä»·å€¼åœ¨äºï¼šè®©è¿™ä¸ªå¾ªç¯å°½å¯èƒ½å¿«ã€å°½å¯èƒ½è‡ªåŠ¨åŒ–ã€‚</p>
<hr/>
<h3 data-id="heading-17">äº”ã€æ€»ç»“ï¼šVite + React = æœªæ¥å·²æ¥</h3>
<p>é€šè¿‡æ·±å…¥å‰–æå…¸å‹é¡¹ç›®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>Vite ä¸æ˜¯ç®€å•çš„â€œWebpack æ›¿ä»£å“â€ï¼Œè€Œæ˜¯åŸºäºç°ä»£ Web æ ‡å‡†ï¼ˆESMï¼‰é‡æ„çš„å¼€å‘ä½“éªŒã€‚</li>
<li>åˆç†çš„ç›®å½•ç»“æ„ï¼ˆpages/components/routerï¼‰æ˜¯å¤§å‹ React åº”ç”¨å¯ç»´æŠ¤çš„åŸºçŸ³ã€‚</li>
<li>ä¾èµ–åˆ†å±‚ï¼ˆdevDependencies vs dependenciesï¼‰æ˜¯ä¿è¯ç”Ÿäº§åŒ…ç²¾ç®€çš„å…³é”®ã€‚</li>
<li>React Router v6 çš„å£°æ˜å¼è·¯ç”±ä¸é›†ä¸­é…ç½®ï¼Œæå¤§æå‡äº†è·¯ç”±å¯è¯»æ€§ã€‚</li>
<li>ç»„ä»¶åŒ– + Hooks è®©æ•°æ®æµæ¸…æ™°ã€å‰¯ä½œç”¨å¯æ§ã€‚</li>
</ul>
<p>Vite å·²æˆä¸ºç°ä»£ React é¡¹ç›®çš„é»˜è®¤åŸºå»ºã€‚å®ƒè®©å¼€å‘è€…ä»ç¹ççš„é…ç½®ä¸­è§£æ”¾ï¼Œä¸“æ³¨äºåˆ›é€ ä»·å€¼ã€‚</p>
<p>ç°åœ¨ï¼Œä½ æ‹¥æœ‰çš„ä¸ä»…æ˜¯ä¸€ä¸ªé¡¹ç›®æ¨¡æ¿ï¼Œè€Œæ˜¯ä¸€å¥—ç»è¿‡éªŒè¯çš„ã€é¢å‘æœªæ¥çš„å‰ç«¯å·¥ç¨‹åŒ–è§£å†³æ–¹æ¡ˆã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSSå¯ç»§æ‰¿å±æ€§å’Œä¸å¯ç»§æ‰¿å±æ€§æœ‰å“ªäº›]]></title>    <link>https://juejin.cn/post/7584651851905466387</link>    <guid>https://juejin.cn/post/7584651851905466387</guid>    <pubDate>2025-12-17T15:57:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584651851905466387" data-draft-id="7584722109583310891" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSSå¯ç»§æ‰¿å±æ€§å’Œä¸å¯ç»§æ‰¿å±æ€§æœ‰å“ªäº›"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-17T15:57:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç çŒäºº"/> <meta itemprop="url" content="https://juejin.cn/user/624972624037374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSSå¯ç»§æ‰¿å±æ€§å’Œä¸å¯ç»§æ‰¿å±æ€§æœ‰å“ªäº›
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/624972624037374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç çŒäºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T15:57:04.000Z" title="Wed Dec 17 2025 15:57:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.Â <strong>å¯ç»§æ‰¿å±æ€§ï¼ˆInherited Propertiesï¼‰</strong></h2>
<p>å­å…ƒç´ ä¼šç»§æ‰¿çˆ¶å…ƒç´ çš„è¿™äº›å±æ€§å€¼ï¼Œé™¤éå­å…ƒç´ æ˜¾å¼è®¾ç½®ä¸åŒçš„å€¼ã€‚</p>
<h3 data-id="heading-1"><strong>æ–‡æœ¬ç›¸å…³</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å­—ä½“å±æ€§ */</span>
<span class="hljs-attribute">font-family</span>      <span class="hljs-comment">/* å­—ä½“ç³»åˆ— */</span>
<span class="hljs-attribute">font-size</span>        <span class="hljs-comment">/* å­—ä½“å¤§å° */</span>
<span class="hljs-attribute">font-weight</span>      <span class="hljs-comment">/* å­—ä½“ç²—ç»† */</span>
<span class="hljs-attribute">font-style</span>       <span class="hljs-comment">/* å­—ä½“æ ·å¼ */</span>
<span class="hljs-attribute">font-variant</span>     <span class="hljs-comment">/* å­—ä½“å˜ä½“ */</span>
<span class="hljs-attribute">line-height</span>      <span class="hljs-comment">/* è¡Œé«˜ */</span>

<span class="hljs-comment">/* æ–‡æœ¬å±æ€§ */</span>
<span class="hljs-attribute">color</span>            <span class="hljs-comment">/* æ–‡æœ¬é¢œè‰² */</span>
<span class="hljs-attribute">text-align</span>       <span class="hljs-comment">/* æ–‡æœ¬å¯¹é½ */</span>
<span class="hljs-attribute">text-indent</span>      <span class="hljs-comment">/* æ–‡æœ¬ç¼©è¿› */</span>
<span class="hljs-attribute">text-transform</span>   <span class="hljs-comment">/* æ–‡æœ¬è½¬æ¢ï¼ˆå¤§å°å†™ï¼‰ */</span>
<span class="hljs-attribute">letter-spacing</span>   <span class="hljs-comment">/* å­—æ¯é—´è· */</span>
<span class="hljs-attribute">word-spacing</span>     <span class="hljs-comment">/* å•è¯é—´è· */</span>
<span class="hljs-attribute">white-space</span>      <span class="hljs-comment">/* ç©ºç™½å¤„ç†æ–¹å¼ */</span>
<span class="hljs-attribute">direction</span>        <span class="hljs-comment">/* æ–‡æœ¬æ–¹å‘ */</span>
<span class="hljs-attribute">unicode-bidi</span>     <span class="hljs-comment">/* Unicode åŒå‘ç®—æ³• */</span>
</code></pre>
<h3 data-id="heading-2"><strong>åˆ—è¡¨ç›¸å…³</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">list-style-type</span>     <span class="hljs-comment">/* åˆ—è¡¨æ ‡è®°ç±»å‹ */</span>
<span class="hljs-attribute">list-style-image</span>    <span class="hljs-comment">/* åˆ—è¡¨æ ‡è®°å›¾åƒ */</span>
<span class="hljs-attribute">list-style-position</span> <span class="hljs-comment">/* åˆ—è¡¨æ ‡è®°ä½ç½® */</span>
<span class="hljs-attribute">list-style</span>          <span class="hljs-comment">/* åˆ—è¡¨æ ·å¼ç®€å†™ */</span>
</code></pre>
<h3 data-id="heading-3"><strong>è¡¨æ ¼ç›¸å…³</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">border-collapse</span>     <span class="hljs-comment">/* è¡¨æ ¼è¾¹æ¡†åˆå¹¶ */</span>
<span class="hljs-attribute">border-spacing</span>      <span class="hljs-comment">/* è¡¨æ ¼è¾¹æ¡†é—´è· */</span>
<span class="hljs-attribute">caption-side</span>        <span class="hljs-comment">/* è¡¨æ ¼æ ‡é¢˜ä½ç½® */</span>
<span class="hljs-attribute">empty-cells</span>         <span class="hljs-comment">/* ç©ºå•å…ƒæ ¼æ˜¾ç¤º */</span>
</code></pre>
<h3 data-id="heading-4"><strong>å…¶ä»–</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">visibility</span>          <span class="hljs-comment">/* å¯è§æ€§ */</span>
<span class="hljs-attribute">cursor</span>              <span class="hljs-comment">/* é¼ æ ‡æŒ‡é’ˆæ ·å¼ */</span>
<span class="hljs-attribute">quotes</span>              <span class="hljs-comment">/* å¼•å·æ ·å¼ */</span>
</code></pre>
<h2 data-id="heading-5">2.Â <strong>ä¸å¯ç»§æ‰¿å±æ€§ï¼ˆNon-inherited Propertiesï¼‰</strong></h2>
<p>å­å…ƒç´ ä¸ä¼šè‡ªåŠ¨ç»§æ‰¿è¿™äº›å±æ€§ï¼Œéœ€è¦ä¸ºæ¯ä¸ªå…ƒç´ å•ç‹¬è®¾ç½®ã€‚</p>
<h3 data-id="heading-6"><strong>ç›’æ¨¡å‹ç›¸å…³</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å°ºå¯¸ */</span>
<span class="hljs-attribute">width</span>               <span class="hljs-comment">/* å®½åº¦ */</span>
<span class="hljs-attribute">height</span>              <span class="hljs-comment">/* é«˜åº¦ */</span>
<span class="hljs-attribute">min-width</span>           <span class="hljs-comment">/* æœ€å°å®½åº¦ */</span>
<span class="hljs-attribute">max-height</span>          <span class="hljs-comment">/* æœ€å¤§é«˜åº¦ */</span>

<span class="hljs-comment">/* å†…å¤–è¾¹è· */</span>
<span class="hljs-attribute">margin</span>              <span class="hljs-comment">/* å¤–è¾¹è· */</span>
<span class="hljs-attribute">padding</span>             <span class="hljs-comment">/* å†…è¾¹è· */</span>

<span class="hljs-comment">/* è¾¹æ¡† */</span>
<span class="hljs-attribute">border</span>              <span class="hljs-comment">/* è¾¹æ¡† */</span>
<span class="hljs-attribute">border-width</span>        <span class="hljs-comment">/* è¾¹æ¡†å®½åº¦ */</span>
<span class="hljs-attribute">border-style</span>        <span class="hljs-comment">/* è¾¹æ¡†æ ·å¼ */</span>
<span class="hljs-attribute">border-color</span>        <span class="hljs-comment">/* è¾¹æ¡†é¢œè‰² */</span>
<span class="hljs-attribute">border-radius</span>       <span class="hljs-comment">/* è¾¹æ¡†åœ†è§’ */</span>
<span class="hljs-attribute">outline</span>             <span class="hljs-comment">/* è½®å»“ */</span>
</code></pre>
<h3 data-id="heading-7"><strong>èƒŒæ™¯ç›¸å…³</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">background</span>          <span class="hljs-comment">/* èƒŒæ™¯ */</span>
<span class="hljs-attribute">background-color</span>    <span class="hljs-comment">/* èƒŒæ™¯é¢œè‰² */</span>
<span class="hljs-attribute">background-image</span>    <span class="hljs-comment">/* èƒŒæ™¯å›¾åƒ */</span>
<span class="hljs-attribute">background-position</span> <span class="hljs-comment">/* èƒŒæ™¯ä½ç½® */</span>
<span class="hljs-attribute">background-repeat</span>   <span class="hljs-comment">/* èƒŒæ™¯é‡å¤ */</span>
<span class="hljs-attribute">background-size</span>     <span class="hljs-comment">/* èƒŒæ™¯å¤§å° */</span>
<span class="hljs-attribute">background-clip</span>     <span class="hljs-comment">/* èƒŒæ™¯è£å‰ª */</span>
<span class="hljs-attribute">background-origin</span>   <span class="hljs-comment">/* èƒŒæ™¯å®šä½åŒºåŸŸ */</span>
</code></pre>
<h3 data-id="heading-8"><strong>å®šä½ä¸å¸ƒå±€</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å®šä½ */</span>
<span class="hljs-attribute">position</span>            <span class="hljs-comment">/* å®šä½æ–¹å¼ */</span>
<span class="hljs-attribute">top</span>, <span class="hljs-attribute">right</span>, <span class="hljs-attribute">bottom</span>, <span class="hljs-attribute">left</span>  <span class="hljs-comment">/* å®šä½åç§» */</span>
<span class="hljs-attribute">z-index</span>             <span class="hljs-comment">/* å †å é¡ºåº */</span>
<span class="hljs-attribute">float</span>               <span class="hljs-comment">/* æµ®åŠ¨ */</span>
<span class="hljs-attribute">clear</span>               <span class="hljs-comment">/* æ¸…é™¤æµ®åŠ¨ */</span>

<span class="hljs-comment">/* æ˜¾ç¤º */</span>
<span class="hljs-attribute">display</span>             <span class="hljs-comment">/* æ˜¾ç¤ºç±»å‹ */</span>
<span class="hljs-attribute">overflow</span>            <span class="hljs-comment">/* æº¢å‡ºå¤„ç† */</span>
<span class="hljs-attribute">visibility</span>          <span class="hljs-comment">/* å¯è§æ€§ï¼ˆè™½ç„¶å¯ç»§æ‰¿ï¼Œä½†è¡Œä¸ºç‰¹æ®Šï¼‰ */</span>
<span class="hljs-attribute">clip</span>                <span class="hljs-comment">/* è£å‰ª */</span>
</code></pre>
<h3 data-id="heading-9"><strong>Flexbox &amp; Grid</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* Flexbox */</span>
<span class="hljs-attribute">flex</span>                <span class="hljs-comment">/* å¼¹æ€§é¡¹ç›®å±æ€§ */</span>
<span class="hljs-attribute">flex-direction</span>      <span class="hljs-comment">/* ä¸»è½´æ–¹å‘ */</span>
<span class="hljs-attribute">justify-content</span>     <span class="hljs-comment">/* ä¸»è½´å¯¹é½ */</span>
<span class="hljs-attribute">align-items</span>         <span class="hljs-comment">/* äº¤å‰è½´å¯¹é½ */</span>

<span class="hljs-comment">/* Grid */</span>
<span class="hljs-attribute">grid-template-columns</span>  <span class="hljs-comment">/* ç½‘æ ¼åˆ—å®šä¹‰ */</span>
<span class="hljs-attribute">grid-template-rows</span>     <span class="hljs-comment">/* ç½‘æ ¼è¡Œå®šä¹‰ */</span>
<span class="hljs-attribute">grid-gap</span>              <span class="hljs-comment">/* ç½‘æ ¼é—´è· */</span>
</code></pre>
<h3 data-id="heading-10"><strong>å…¶ä»–ä¸å¯ç»§æ‰¿å±æ€§</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å˜æ¢ä¸è¿‡æ¸¡ */</span>
<span class="hljs-attribute">transform</span>           <span class="hljs-comment">/* å˜æ¢ */</span>
<span class="hljs-attribute">transition</span>          <span class="hljs-comment">/* è¿‡æ¸¡ */</span>
<span class="hljs-attribute">opacity</span>             <span class="hljs-comment">/* ä¸é€æ˜åº¦ */</span>

<span class="hljs-comment">/* è§†è§‰æ•ˆæœ */</span>
<span class="hljs-attribute">box-shadow</span>          <span class="hljs-comment">/* ç›’å­é˜´å½± */</span>
<span class="hljs-attribute">text-shadow</span>         <span class="hljs-comment">/* æ–‡å­—é˜´å½± */</span>
<span class="hljs-attribute">filter</span>              <span class="hljs-comment">/* æ»¤é•œæ•ˆæœ */</span>

<span class="hljs-comment">/* è¡¨æ ¼å¸ƒå±€ */</span>
<span class="hljs-attribute">table-layout</span>        <span class="hljs-comment">/* è¡¨æ ¼å¸ƒå±€ç®—æ³• */</span>
</code></pre>
<h2 data-id="heading-11">3.Â <strong>ç»§æ‰¿æ§åˆ¶å…³é”®å­—</strong></h2>
<h3 data-id="heading-12"><strong>inherit - æ˜¾å¼ç»§æ‰¿</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å¼ºåˆ¶ç»§æ‰¿çˆ¶å…ƒç´ çš„å€¼ */</span>
<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">border</span>: inherit;        <span class="hljs-comment">/* ç»§æ‰¿çˆ¶å…ƒç´ çš„è¾¹æ¡† */</span>
  <span class="hljs-attribute">background</span>: inherit;    <span class="hljs-comment">/* ç»§æ‰¿çˆ¶å…ƒç´ çš„èƒŒæ™¯ */</span>
  <span class="hljs-attribute">margin</span>: inherit;        <span class="hljs-comment">/* ç»§æ‰¿çˆ¶å…ƒç´ çš„å¤–è¾¹è· */</span>
}
</code></pre>
<h3 data-id="heading-13"><strong>initial - ä½¿ç”¨åˆå§‹å€¼</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ä½¿ç”¨å±æ€§çš„åˆå§‹é»˜è®¤å€¼ */</span>
<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">color</span>: initial;         <span class="hljs-comment">/* é‡ç½®ä¸ºé»˜è®¤é¢œè‰²ï¼ˆé€šå¸¸æ˜¯é»‘è‰²ï¼‰ */</span>
  <span class="hljs-attribute">display</span>: initial;       <span class="hljs-comment">/* é‡ç½®ä¸º display: inline */</span>
}
</code></pre>
<h3 data-id="heading-14"><strong>unset - é‡ç½®ä¸ºç»§æ‰¿æˆ–åˆå§‹å€¼</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å¦‚æœæ˜¯å¯ç»§æ‰¿å±æ€§ï¼Œåˆ™ç»§æ‰¿çˆ¶å…ƒç´ å€¼ */</span>
<span class="hljs-comment">/* å¦‚æœæ˜¯ä¸å¯ç»§æ‰¿å±æ€§ï¼Œåˆ™ä½¿ç”¨åˆå§‹å€¼ */</span>
<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">color</span>: unset;           <span class="hljs-comment">/* ç»§æ‰¿çˆ¶å…ƒç´ çš„é¢œè‰² */</span>
  <span class="hljs-attribute">border</span>: unset;          <span class="hljs-comment">/* é‡ç½®ä¸º border: none */</span>
}
</code></pre>
<h3 data-id="heading-15"><strong>revert - æ¢å¤ä¸ºæµè§ˆå™¨é»˜è®¤å€¼</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* æ¢å¤ä¸ºæµè§ˆå™¨é»˜è®¤æ ·å¼è¡¨ä¸­çš„å€¼ */</span>
<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">display</span>: revert;        <span class="hljs-comment">/* æ¢å¤ä¸ºæµè§ˆå™¨é»˜è®¤çš„ display å€¼ */</span>
}
</code></pre>
<h2 data-id="heading-16">4.Â <strong>ç»§æ‰¿è§„åˆ™ä¸ç¤ºä¾‹</strong></h2>
<h3 data-id="heading-17"><strong>ç»§æ‰¿çš„å·¥ä½œæ–¹å¼</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* çˆ¶å…ƒç´ è®¾ç½® */</span>
<span class="hljs-selector-class">.parent</span> {
  <span class="hljs-attribute">font-family</span>: Arial, sans-serif;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f0f0f0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-comment">/* å­å…ƒç´ è‡ªåŠ¨ç»§æ‰¿ */</span>
<span class="hljs-selector-class">.child</span> {
  <span class="hljs-comment">/* ç»§æ‰¿ font-family, color, font-size */</span>
  <span class="hljs-comment">/* ä¸ç»§æ‰¿ background, padding */</span>
  <span class="hljs-comment">/* éœ€è¦æ˜¾å¼è®¾ç½®ä¸å¯ç»§æ‰¿å±æ€§ */</span>
  <span class="hljs-attribute">background</span>: inherit;  <span class="hljs-comment">/* æ˜¾å¼ç»§æ‰¿èƒŒæ™¯ */</span>
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;        <span class="hljs-comment">/* è®¾ç½®è‡ªå·±çš„å†…è¾¹è· */</span>
}
</code></pre>
<h3 data-id="heading-18"><strong>ç‰¹æ®Šç»§æ‰¿è¡Œä¸º</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ç™¾åˆ†æ¯”å€¼çš„ç»§æ‰¿ */</span>
<span class="hljs-selector-class">.parent</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;      <span class="hljs-comment">/* è®¾ç½®ç»å¯¹å€¼ */</span>
}

<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">120%</span>;      <span class="hljs-comment">/* ç›¸å¯¹äºçˆ¶å…ƒç´ çš„ 20px = 24px */</span>
}

<span class="hljs-comment">/* em å•ä½çš„ç»§æ‰¿ */</span>
<span class="hljs-selector-class">.parent</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2em</span>;     <span class="hljs-comment">/* ç›¸å¯¹äºçˆ¶å…ƒç´ çš„ 20px = 24px */</span>
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">1em</span>;         <span class="hljs-comment">/* ç›¸å¯¹äºè‡ªå·±çš„ font-size = 24px */</span>
}

<span class="hljs-comment">/* rem å•ä½çš„ç»§æ‰¿ */</span>
<span class="hljs-selector-tag">html</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;      <span class="hljs-comment">/* æ ¹å…ƒç´ å­—ä½“å¤§å° */</span>
}

<span class="hljs-selector-class">.child</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;    <span class="hljs-comment">/* ç›¸å¯¹äºæ ¹å…ƒç´ çš„ 16px = 24px */</span>
}
</code></pre>
<h2 data-id="heading-19">5.Â <strong>å®ç”¨æŠ€å·§ä¸æœ€ä½³å®è·µ</strong></h2>
<h3 data-id="heading-20"><strong>å…¨å±€ç»§æ‰¿è®¾ç½®</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ä½¿æ‰€æœ‰å…ƒç´ ç»§æ‰¿ç›’æ¨¡å‹ */</span>
* {
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-comment">/* è®¾ç½®å¯ç»§æ‰¿å±æ€§çš„é»˜è®¤å€¼ */</span>
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">'Segoe UI'</span>, Roboto;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}

<span class="hljs-comment">/* é“¾æ¥é¢œè‰²ç»§æ‰¿ */</span>
<span class="hljs-selector-tag">a</span> {
  <span class="hljs-attribute">color</span>: inherit;        <span class="hljs-comment">/* ç»§æ‰¿çˆ¶å…ƒç´ çš„é¢œè‰² */</span>
  <span class="hljs-attribute">text-decoration</span>: none;
}
</code></pre>
<h3 data-id="heading-21"><strong>è¡¨å•å…ƒç´ ç»§æ‰¿å¤„ç†</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* è¡¨å•å…ƒç´ é»˜è®¤ä¸ç»§æ‰¿å­—ä½“å±æ€§ */</span>
<span class="hljs-selector-tag">input</span>, <span class="hljs-selector-tag">button</span>, <span class="hljs-selector-tag">textarea</span>, select {
  <span class="hljs-attribute">font-family</span>: inherit;   <span class="hljs-comment">/* æ˜¾å¼ç»§æ‰¿å­—ä½“ */</span>
  <span class="hljs-attribute">font-size</span>: inherit;     <span class="hljs-comment">/* æ˜¾å¼ç»§æ‰¿å­—å· */</span>
  <span class="hljs-attribute">color</span>: inherit;         <span class="hljs-comment">/* æ˜¾å¼ç»§æ‰¿é¢œè‰² */</span>
}
</code></pre>
<h3 data-id="heading-22"><strong>åˆ›å»ºå¯ç»§æ‰¿å·¥å…·ç±»</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* å¯ç»§æ‰¿çš„æ–‡æœ¬å·¥å…·ç±» */</span>
<span class="hljs-selector-class">.text-primary</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#007bff</span>;
}

<span class="hljs-selector-class">.text-bold</span> {
  <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.text-uppercase</span> {
  <span class="hljs-attribute">text-transform</span>: uppercase;
}

<span class="hljs-comment">/* ä½¿ç”¨ç¤ºä¾‹ */</span>
&lt;<span class="hljs-selector-tag">div</span> class="text-primary"&gt;
  çˆ¶å…ƒç´ 
  &lt;<span class="hljs-selector-tag">div</span>&gt;å­å…ƒç´ ä¹Ÿä¼šæ˜¯è“è‰²&lt;/<span class="hljs-selector-tag">div</span>&gt;
  &lt;<span class="hljs-selector-tag">button</span> class="text-bold"&gt;æŒ‰é’®ä¼šåŠ ç²—&lt;/<span class="hljs-selector-tag">button</span>&gt;
&lt;/<span class="hljs-selector-tag">div</span>&gt;
</code></pre>
<h3 data-id="heading-23"><strong>è°ƒè¯•ç»§æ‰¿é—®é¢˜</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ä½¿ç”¨å¼€å‘è€…å·¥å…·æ£€æŸ¥ç»§æ‰¿ */</span>
<span class="hljs-selector-class">.parent</span> {
  <span class="hljs-comment">/* åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æŸ¥çœ‹ï¼š
     - Computed æ ‡ç­¾é¡µæŸ¥çœ‹æœ€ç»ˆè®¡ç®—å€¼
     - å¸¦æœ‰å°ç®­å¤´çš„å±æ€§è¡¨ç¤ºç»§æ‰¿å€¼
     - Styles æ ‡ç­¾é¡µæŸ¥çœ‹ç»§æ‰¿é“¾ */</span>
}

<span class="hljs-comment">/* å¼ºåˆ¶æŸ¥çœ‹æ‰€æœ‰ç»§æ‰¿å€¼ */</span>
* {
  <span class="hljs-comment">/* ä½¿ç”¨ inherit !important è°ƒè¯• */</span>
  <span class="hljs-comment">/* color: inherit !important; */</span>
}
</code></pre>
<h2 data-id="heading-24">6.Â <strong>å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ</strong></h2>
<h3 data-id="heading-25"><strong>é™·é˜±1ï¼šæŒ‰é’®ä¸ç»§æ‰¿å­—ä½“</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* é—®é¢˜ */</span>
<span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Custom Font'</span>; }
<span class="hljs-selector-tag">button</span> { <span class="hljs-comment">/* ä¸ç»§æ‰¿å­—ä½“ï¼Œä½¿ç”¨ç³»ç»Ÿé»˜è®¤å­—ä½“ */</span> }

<span class="hljs-comment">/* è§£å†³æ–¹æ¡ˆ */</span>
<span class="hljs-selector-tag">button</span> { <span class="hljs-attribute">font-family</span>: inherit; }
</code></pre>
<h3 data-id="heading-26"><strong>é™·é˜±2ï¼šè¡¨å•å…ƒç´ ä¸ç»§æ‰¿é¢œè‰²</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* é—®é¢˜ */</span>
<span class="hljs-selector-class">.dark-theme</span> { <span class="hljs-attribute">color</span>: white; }
<span class="hljs-selector-tag">input</span> { <span class="hljs-comment">/* ä»ç„¶æ˜¯é»‘è‰²æ–‡æœ¬ */</span> }

<span class="hljs-comment">/* è§£å†³æ–¹æ¡ˆ */</span>
<span class="hljs-selector-tag">input</span> { <span class="hljs-attribute">color</span>: inherit; }
<span class="hljs-selector-class">.dark-theme</span> <span class="hljs-selector-tag">input</span> { <span class="hljs-attribute">color</span>: white; }
</code></pre>
<h3 data-id="heading-27"><strong>é™·é˜±3ï¼šé“¾æ¥é¢œè‰²æ··ä¹±</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* é—®é¢˜ */</span>
<span class="hljs-selector-class">.card</span> { <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>; }
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">a</span> { <span class="hljs-comment">/* ä»ç„¶æ˜¯é»˜è®¤è“è‰² */</span> }

<span class="hljs-comment">/* è§£å†³æ–¹æ¡ˆ */</span>
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">a</span> { <span class="hljs-attribute">color</span>: inherit; }
<span class="hljs-comment">/* æˆ–æ˜ç¡®è®¾ç½® */</span>
<span class="hljs-selector-class">.card</span> <span class="hljs-selector-tag">a</span> { <span class="hljs-attribute">color</span>: currentColor; }
</code></pre>
<h3 data-id="heading-28"><strong>é™·é˜±4ï¼šä¼ªå…ƒç´ ç»§æ‰¿</strong></h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* ä¼ªå…ƒç´ é»˜è®¤ä¸ç»§æ‰¿ï¼Œéœ€è¦æ˜¾å¼è®¾ç½® */</span>
<span class="hljs-selector-class">.parent</span><span class="hljs-selector-pseudo">::before</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">"â†’ "</span>;
  <span class="hljs-attribute">color</span>: inherit;        <span class="hljs-comment">/* æ˜¾å¼ç»§æ‰¿é¢œè‰² */</span>
  <span class="hljs-attribute">font-family</span>: inherit;  <span class="hljs-comment">/* æ˜¾å¼ç»§æ‰¿å­—ä½“ */</span>
}
</code></pre>
<p>ç†è§£ CSS å±æ€§çš„ç»§æ‰¿è¡Œä¸ºå¯¹äºç¼–å†™å¯ç»´æŠ¤ã€é«˜æ•ˆçš„æ ·å¼è‡³å…³é‡è¦ã€‚åˆç†åˆ©ç”¨ç»§æ‰¿å¯ä»¥å‡å°‘é‡å¤ä»£ç ï¼Œç¡®ä¿ç•Œé¢çš„ä¸€è‡´æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è½¦è½½ Android ç³»ç»Ÿç¨³å®šæ€§é—®é¢˜å…¨è§£æï¼šä»æ€§èƒ½åˆ°é»‘å±çš„æ’æŸ¥æŒ‡å—]]></title>    <link>https://juejin.cn/post/7584652662328819762</link>    <guid>https://juejin.cn/post/7584652662328819762</guid>    <pubDate>2025-12-17T13:08:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584652662328819762" data-draft-id="7584652662328737842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è½¦è½½ Android ç³»ç»Ÿç¨³å®šæ€§é—®é¢˜å…¨è§£æï¼šä»æ€§èƒ½åˆ°é»‘å±çš„æ’æŸ¥æŒ‡å—"/> <meta itemprop="keywords" content="æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-12-17T13:08:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è½¦è½½ Android ç³»ç»Ÿç¨³å®šæ€§é—®é¢˜å…¨è§£æï¼šä»æ€§èƒ½åˆ°é»‘å±çš„æ’æŸ¥æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T13:08:37.000Z" title="Wed Dec 17 2025 13:08:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨è½¦è½½ Android ç³»ç»Ÿå¼€å‘ä¸­ï¼Œç¨³å®šæ€§é—®é¢˜æ˜¯æœ€è®©äººå¤´ç–¼çš„æŒ‘æˆ˜ä¹‹ä¸€ã€‚ä¸æ‰‹æœºä¸åŒï¼Œè½¦è½½ç³»ç»Ÿå¯¹ç¨³å®šæ€§çš„è¦æ±‚è¿‘ä¹è‹›åˆ»â€”â€”æƒ³è±¡ä¸€ä¸‹ï¼Œç”¨æˆ·æ­£åœ¨é«˜é€Ÿå…¬è·¯ä¸Šè¡Œé©¶ï¼Œå¯¼èˆªçªç„¶é»‘å±ï¼Œæˆ–è€…ä¸­æ§å¡æ­»æ— å“åº”ï¼Œè¿™ä¸ä»…ä»…æ˜¯ç”¨æˆ·ä½“éªŒé—®é¢˜ï¼Œæ›´å…³ä¹è¡Œè½¦å®‰å…¨ã€‚</p>
<p>ç»è¿‡å¤šå¹´çš„è½¦è½½ç³»ç»Ÿå¼€å‘å®è·µï¼Œæˆ‘ä»¬å°†é‡åˆ°çš„å„ç±»ç¨³å®šæ€§é—®é¢˜å½’çº³ä¸ºå››å¤§ç±»ï¼š</p>






























<table><thead><tr><th align="left">ç±»åˆ«</th><th align="left">å…¸å‹è¡¨ç°</th><th align="left">å½±å“ç¨‹åº¦</th></tr></thead><tbody><tr><td align="left"><strong>æ€§èƒ½é—®é¢˜</strong></td><td align="left">å¡é¡¿ã€å“åº”æ…¢ã€å‘çƒ­</td><td align="left">â­â­â­</td></tr><tr><td align="left"><strong>å¡æ­»é—®é¢˜</strong></td><td align="left">è§¦æ‘¸æ— å“åº”ã€ç³»ç»ŸæŒ‚èµ·</td><td align="left">â­â­â­â­â­</td></tr><tr><td align="left"><strong>é»‘å±é—®é¢˜</strong></td><td align="left">å±å¹•æ— æ˜¾ç¤ºã€éƒ¨åˆ†é»‘å±</td><td align="left">â­â­â­â­â­</td></tr><tr><td align="left"><strong>æ˜¾ç¤ºå¼‚å¸¸</strong></td><td align="left">é—ªçƒã€é”™ä¹±ã€æ˜¾ç¤ºä¸å…¨</td><td align="left">â­â­â­</td></tr></tbody></table>
<p>æœ¬æ–‡å°†é€ä¸€å‰–æè¿™äº›é—®é¢˜çš„æ ¹å› ï¼Œå¹¶æä¾›å®æˆ˜æ’æŸ¥å‘½ä»¤ï¼Œå¸Œæœ›èƒ½å¸®åŠ©å„ä½å°‘è¸©ä¸€äº›å‘ã€‚</p>
<h2 data-id="heading-1">æ€§èƒ½é—®é¢˜æ·±åº¦å‰–æ</h2>
<p>æ€§èƒ½é—®é¢˜æ˜¯ç¨³å®šæ€§é—®é¢˜çš„"å‰å¥"ã€‚å¾ˆå¤šå¡æ­»å’Œé»‘å±é—®é¢˜ï¼Œè¿½æ ¹æº¯æºéƒ½æ˜¯æ€§èƒ½é—®é¢˜æ¶åŒ–çš„ç»“æœã€‚è½¦è½½ç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜ä¸»è¦é›†ä¸­åœ¨äº”ä¸ªç»´åº¦ï¼šæ˜¾å­˜ã€CPUã€å†…å­˜ã€IO å’Œ GPUã€‚</p>
<h3 data-id="heading-2">æ˜¾å­˜é—®é¢˜</h3>
<p>æ˜¾å­˜é—®é¢˜åœ¨è½¦è½½ç³»ç»Ÿä¸­å°¤ä¸ºçªå‡ºï¼Œå› ä¸ºç°ä»£åº§èˆ±å¾€å¾€é…å¤‡å¤šå—å±å¹•ï¼ˆä¸­æ§ã€ä»ªè¡¨ã€å‰¯é©¾ã€åæ’ï¼‰ï¼ŒåŠ ä¸Š 3D åœºæ™¯ã€å¯¼èˆªåœ°å›¾ç­‰å›¾å½¢å¯†é›†å‹åº”ç”¨ï¼Œæ˜¾å­˜å‹åŠ›å·¨å¤§ã€‚</p>
<p><strong>å¸¸è§åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>æ˜¾å­˜æ³„éœ²</strong>ï¼šTaskView + å¯¼èˆªç»„åˆä½¿ç”¨ã€äººæœºå…±é©¾ + Mesa3Dã€AVMï¼ˆç¯è§†ï¼‰é•¿æ—¶é—´è¿è¡Œ</li>
<li><strong>æ˜¾å­˜è¶…æ ‡</strong>ï¼š3D æ¡Œé¢ + Unreal å¼•æ“ã€HMI åŠ¨æ•ˆè¿‡åº¦ã€Launcher ä½¿ç”¨é«˜åˆ†è¾¨ç‡å£çº¸å’Œ PSD å±è§†é¢‘</li>
</ul>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ GPU å†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆé«˜é€šå¹³å°ï¼‰</span>
<span class="hljs-built_in">cat</span> /sys/class/kgsl/kgsl-3d0/gpubusy
<span class="hljs-built_in">cat</span> /sys/class/kgsl/kgsl-3d0/gpu_available_frequencies

<span class="hljs-comment"># æŸ¥çœ‹æ˜¾å­˜åˆ†é…æƒ…å†µ</span>
dumpsys meminfo | grep -i <span class="hljs-string">"graphics\|gl\|egl"</span>

<span class="hljs-comment"># æŸ¥çœ‹ SurfaceFlinger å›¾å±‚ä¿¡æ¯</span>
dumpsys SurfaceFlinger --latency

<span class="hljs-comment"># é’ˆå¯¹ AMD å¹³å°</span>
<span class="hljs-built_in">cat</span> /sys/kernel/debug/dri/0/amdgpu_vram_mm
</code></pre>

æ˜¾å­˜æ³„éœ²æœ€å¸¸è§çš„åŸå› æ˜¯ Surface æˆ– Texture æ²¡æœ‰æ­£ç¡®é‡Šæ”¾ã€‚å»ºè®®åœ¨åº”ç”¨çš„ `onDestroy()` ä¸­æ˜¾å¼è°ƒç”¨ `release()` æ–¹æ³•ã€‚

<h3 data-id="heading-3">CPU é—®é¢˜</h3>
<p>CPU é—®é¢˜åˆ†ä¸º<strong>è°ƒåº¦é—®é¢˜</strong>å’Œ<strong>å¼‚å¸¸å ç”¨</strong>ä¸¤ç±»ã€‚</p>
<p><strong>è°ƒåº¦é—®é¢˜å…¸å‹åœºæ™¯ï¼š</strong></p>
<ul>
<li>3D åœºæ™¯ + å¤šå±åœºæ™¯ä¸‹ï¼Œåº”ç”¨å¯åŠ¨å…³é”®çº¿ç¨‹æœªèƒ½è·å¾—è¶³å¤Ÿä¼˜å…ˆçº§</li>
<li>å‰åå°åˆ†ç»„ç­–ç•¥ä¸åˆç†ï¼Œåå°åº”ç”¨æŠ¢å å‰å°èµ„æº</li>
</ul>
<p><strong>å¼‚å¸¸å ç”¨å…¸å‹åœºæ™¯ï¼š</strong></p>






























<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">è¡¨ç°</th><th align="left">æ ¹å› </th></tr></thead><tbody><tr><td align="left">åº”ç”¨åˆ‡æ¢æˆªå›¾</td><td align="left">system_server CPU é£™é«˜</td><td align="left">è™šæ‹ŸåŒ–ç¯å¢ƒä½¿ç”¨ copy æ–¹å¼è€Œé DMA</td></tr><tr><td align="left">æ¡Œé¢å¡é¡¿</td><td align="left">æ¡Œé¢è¿›ç¨‹ CPU æŒç»­é«˜ä½</td><td align="left">åŠ¨æ•ˆè¿‡åº¦æˆ–å¸ƒå±€è®¡ç®—å¤æ‚</td></tr><tr><td align="left">U ç›˜æ’å…¥åå¡é¡¿</td><td align="left">usb kernel çº¿ç¨‹å æ»¡å•æ ¸</td><td align="left">ç¡¬ä»¶ä¸­æ–­é£æš´</td></tr><tr><td align="left">è¯­éŸ³åŠŸèƒ½</td><td align="left">CPU 100%</td><td align="left">å“¨å…µé•¿æ—¶é—´ç›‘å¬å¯¼è‡´ mic æ•°æ®ç´¯ç§¯</td></tr></tbody></table>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å®æ—¶æŸ¥çœ‹ CPU å ç”¨ TOP è¿›ç¨‹</span>
top -m 10 -s cpu

<span class="hljs-comment"># æŸ¥çœ‹ç‰¹å®šè¿›ç¨‹çš„çº¿ç¨‹ CPU å ç”¨</span>
top -H -p &lt;pid&gt;

<span class="hljs-comment"># ä½¿ç”¨ simpleperf è¿›è¡Œ CPU æ€§èƒ½åˆ†æ</span>
simpleperf record -p &lt;pid&gt; -g --duration 10
simpleperf report

<span class="hljs-comment"># æŸ¥çœ‹è°ƒåº¦å™¨çŠ¶æ€</span>
<span class="hljs-built_in">cat</span> /proc/schedstat

<span class="hljs-comment"># æŸ¥çœ‹è¿›ç¨‹è°ƒåº¦ç­–ç•¥</span>
<span class="hljs-built_in">cat</span> /proc/&lt;pid&gt;/sched

<span class="hljs-comment"># æ£€æŸ¥ CPU é¢‘ç‡å’Œè°ƒåº¦å™¨</span>
<span class="hljs-built_in">cat</span> /sys/devices/system/cpu/cpu*/cpufreq/scaling_cur_freq
<span class="hljs-built_in">cat</span> /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor
</code></pre>
<h3 data-id="heading-4">å†…å­˜é—®é¢˜</h3>
<p>å†…å­˜é—®é¢˜æ˜¯è½¦è½½ç³»ç»Ÿæœ€å¸¸è§çš„æ€§èƒ½æ€æ‰‹ã€‚ç”±äºè½¦è½½ç³»ç»Ÿé€šå¸¸å†…å­˜é…ç½®æœ‰é™ï¼ˆç›¸æ¯”æ‰‹æœºï¼‰ï¼Œä¸”éœ€è¦é•¿æ—¶é—´è¿è¡Œï¼Œå†…å­˜æ³„æ¼çš„å½±å“ä¼šè¢«æ”¾å¤§ã€‚</p>
<p><strong>å†…å­˜æ³„æ¼å…¸å‹åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>è½¦æ§æœåŠ¡</strong>ï¼šè½¦æ§ä¿¡å·ç›‘å¬æœªé‡Šæ”¾ï¼Œå¯é€šè¿‡ <code>/dropbox/system-low-memory</code> æ—¥å¿—è¿½è¸ª</li>
<li><strong>è“ç‰™ç”µè¯</strong>ï¼š2W+ æ”¶è—è”ç³»äººåŒæ­¥å¯¼è‡´å†…å­˜æš´æ¶¨</li>
<li><strong>å…±äº«å†…å­˜</strong>ï¼šdom0 ä¸ Android ä¹‹é—´çš„å…±äº«å†…å­˜æ³„æ¼ï¼Œéœ€æ£€æŸ¥ <code>/proc/meminfo</code> å’Œ <code>/proc/vmstat</code></li>
<li><strong>å¯¼èˆªæœåŠ¡</strong>ï¼šBinder å†…å­˜æ³„æ¼å¯¼è‡´æ‰€æœ‰ OpenAPI å¯¼èˆªæ¥å£å¡æ­»</li>
<li><strong>WebView</strong>ï¼šWebView ç‰ˆæœ¬é—®é¢˜å¯¼è‡´æ³„æ¼ï¼Œå‡çº§å¯è§£å†³</li>
<li><strong>ç½‘ç»œæ¨¡å—</strong>ï¼šå¼‚å¸¸å¤§é‡ <code>Arrays.copy</code> æ“ä½œå¯¼è‡´ system_server å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>å†…å­˜è¶…æ ‡å…¸å‹åœºæ™¯ï¼š</strong></p>
<ul>
<li>è½¦è¾†è®¾ç½®åº”ç”¨ heap è¿‡å¤§ï¼Œéœ€ç”¨ simpleperf åˆ†æ</li>
<li>è¯­éŸ³æ¨¡å—å†…å­˜è¶…æ ‡</li>
</ul>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ç³»ç»Ÿæ•´ä½“å†…å­˜çŠ¶æ€</span>
<span class="hljs-built_in">cat</span> /proc/meminfo
free -h

<span class="hljs-comment"># æŸ¥çœ‹è¿›ç¨‹å†…å­˜è¯¦æƒ…</span>
dumpsys meminfo &lt;package_name&gt;

<span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹å†…å­˜æ’è¡Œ</span>
dumpsys meminfo --<span class="hljs-built_in">sort</span> | <span class="hljs-built_in">head</span> -50

<span class="hljs-comment"># æŸ¥çœ‹å…±äº«å†…å­˜</span>
<span class="hljs-built_in">cat</span> /proc/&lt;pid&gt;/smaps | grep -A 20 <span class="hljs-string">"Shared"</span>

<span class="hljs-comment"># æ£€æŸ¥ low memory æ—¥å¿—</span>
<span class="hljs-built_in">ls</span> -la /data/system/dropbox/ | grep -i <span class="hljs-string">"low"</span>

<span class="hljs-comment"># heap åˆ†æï¼ˆéœ€è¦å¼€å¯ï¼‰</span>
am dumpheap &lt;pid&gt; /data/local/tmp/heap.hprof

<span class="hljs-comment"># ä½¿ç”¨ simpleperf åˆ†æå†…å­˜åˆ†é…</span>
simpleperf record -e malloc -p &lt;pid&gt; --duration 10
</code></pre>

å¯¼èˆªæœåŠ¡çš„ Binder å†…å­˜æ³„æ¼æ˜¯ä¸€ä¸ªé«˜é¢‘é—®é¢˜ã€‚Binder ä¼ è¾“æ•°æ®æœ‰ 1MB çš„é™åˆ¶ï¼Œå¦‚æœä¼ é€’å¤§é‡æ•°æ®ï¼ˆå¦‚ POI åˆ—è¡¨ï¼‰ï¼ŒåŠ¡å¿…åˆ†æ‰¹ä¼ è¾“æˆ–ä½¿ç”¨å…±äº«å†…å­˜ã€‚

<h3 data-id="heading-5">IO é—®é¢˜</h3>
<p>IO é—®é¢˜åœ¨è½¦è½½ç³»ç»Ÿä¸­ç»å¸¸è¢«å¿½è§†ï¼Œä½†å®ƒå¾€å¾€æ˜¯ç³»ç»Ÿå¡é¡¿çš„éšå½¢æ€æ‰‹ã€‚</p>
<p><strong>iowait é«˜çš„å…¸å‹åœºæ™¯ï¼š</strong></p>
<ul>
<li>U ç›˜æ“ä½œé˜»å¡ä¸»çº¿ç¨‹</li>
</ul>
<p><strong>IO è´Ÿè½½é«˜çš„å…¸å‹åœºæ™¯ï¼š</strong></p>






























<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">åŸå› </th><th align="left">è§£å†³æ€è·¯</th></tr></thead><tbody><tr><td align="left">ä¸Šä¼  + æ‰“åŒ…æ—¥å¿—</td><td align="left">æ—¥å¿—å†™å…¥é¢‘ç¹</td><td align="left">å¼‚æ­¥å†™å…¥ã€é™ä½æ—¥å¿—çº§åˆ«</td></tr><tr><td align="left">OTA ä¸‹è½½</td><td align="left">å¤§æ–‡ä»¶å†™å…¥</td><td align="left">é™é€Ÿã€åˆ†æ—¶æ®µä¸‹è½½</td></tr><tr><td align="left">å…±äº«ç½‘ç›˜ + tcpdump</td><td align="left">æŠ“åŒ…å†™ç›˜</td><td align="left">é™åˆ¶æŠ“åŒ…æ—¶é—´å’Œå¤§å°</td></tr><tr><td align="left">DVR å½•åƒ</td><td align="left">å¤šçº¿ç¨‹è½ç›˜ä¸åˆç†</td><td align="left">ä¼˜åŒ–è½ç›˜ç­–ç•¥ã€ä½¿ç”¨ç¯å½¢ç¼“å†²</td></tr></tbody></table>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ IO ç­‰å¾…æƒ…å†µ</span>
iostat -x 1 5

<span class="hljs-comment"># æŸ¥çœ‹è¿›ç¨‹ IO æƒ…å†µ</span>
iotop -o

<span class="hljs-comment"># æŸ¥çœ‹ç£ç›˜è¯»å†™é€Ÿåº¦</span>
<span class="hljs-built_in">cat</span> /proc/diskstats

<span class="hljs-comment"># æŸ¥çœ‹è¿›ç¨‹çš„ IO ç»Ÿè®¡</span>
<span class="hljs-built_in">cat</span> /proc/&lt;pid&gt;/io

<span class="hljs-comment"># ä½¿ç”¨ strace è¿½è¸ª IO æ“ä½œ</span>
strace -e trace=<span class="hljs-built_in">read</span>,write,open -p &lt;pid&gt;
</code></pre>
<h3 data-id="heading-6">GPU é—®é¢˜</h3>
<p>GPU é—®é¢˜åœ¨è½¦è½½ç³»ç»Ÿä¸­æ—¥ç›Šçªå‡ºï¼Œå°¤å…¶æ˜¯æ­è½½ 3D HMIã€AVM ç­‰åŠŸèƒ½çš„åº§èˆ±ã€‚</p>
<p><strong>å¼‚å¸¸å ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>3D åº”ç”¨åˆ‡åå°åä»åœ¨æ¸²æŸ“</li>
<li>AVM åå°æŒç»­å ç”¨ GPU èµ„æº</li>
</ul>
<p><strong>GPU è´Ÿè½½é«˜åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¤šåª’ä½“æ°´æ³¢çº¹ç‰¹æ•ˆå ç”¨è¿‡é«˜</li>
<li>AMD å¹³å°æœ¬èº«çš„ <code>nativecontext</code> é—®é¢˜</li>
</ul>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ GPU ä½¿ç”¨ç‡ï¼ˆé«˜é€šå¹³å°ï¼‰</span>
<span class="hljs-built_in">cat</span> /sys/class/kgsl/kgsl-3d0/gpubusy

<span class="hljs-comment"># æŸ¥çœ‹ GPU é¢‘ç‡</span>
<span class="hljs-built_in">cat</span> /sys/class/kgsl/kgsl-3d0/devfreq/cur_freq

<span class="hljs-comment"># dumpsys æŸ¥çœ‹ GPU ç›¸å…³ä¿¡æ¯</span>
dumpsys gfxinfo &lt;package_name&gt;

<span class="hljs-comment"># æŸ¥çœ‹å¸§ç‡å’Œæ¸²æŸ“ä¿¡æ¯</span>
dumpsys SurfaceFlinger --latency &lt;window_name&gt;
</code></pre>
<h2 data-id="heading-7">ç³»ç»Ÿå¡æ­»é—®é¢˜åˆ†æ</h2>
<p>å¡æ­»æ˜¯æœ€ä¸¥é‡çš„ç¨³å®šæ€§é—®é¢˜ï¼Œç”¨æˆ·æ„ŸçŸ¥æœ€ä¸ºå¼ºçƒˆã€‚å¡æ­»é—®é¢˜çš„æ ¹å› å¤æ‚ï¼Œå¯èƒ½æ¶‰åŠè§¦æ‘¸ã€system_serverã€å­˜å‚¨ã€å…³é”®æœåŠ¡å’Œ SurfaceFlinger ç­‰å¤šä¸ªå±‚é¢ã€‚</p>
<h3 data-id="heading-8">è§¦æ‘¸/å±å¹•é—®é¢˜</h3>
<p>è§¦æ‘¸å¤±çµæ˜¯æœ€å¸¸è¢«è¯¯åˆ¤ä¸º"å¡æ­»"çš„é—®é¢˜ã€‚å®é™…ä¸Šç³»ç»Ÿå¯èƒ½è¿è¡Œæ­£å¸¸ï¼Œåªæ˜¯è§¦æ‘¸äº‹ä»¶æ²¡æœ‰æ­£ç¡®ä¼ é€’ã€‚</p>
<p><strong>å…¸å‹åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>é€æ˜å›¾å±‚æ‹¦æˆª</strong>ï¼šåº”ç”¨çš„é€æ˜å›¾å±‚æ‹¦æˆªäº†è§¦æ‘¸äº‹ä»¶ï¼ˆå¦‚ç”¨æˆ·ä¸­å¿ƒçš„æ‚¬æµ®å±‚ï¼‰</li>
<li><strong>é€†å˜å™¨å¹²æ‰°</strong>ï¼šé€†å˜å™¨ç”µç£å¹²æ‰°å¯¼è‡´å±å¹•ç¡¬ä»¶å¼‚å¸¸</li>
<li><strong>AVM ç‰¹æ€§ Block</strong>ï¼šAVM åº”ç”¨åœ¨ç‰¹å®šåŒºåŸŸæ‹¦æˆªè§¦æ‘¸äº‹ä»¶</li>
<li><strong>è™šæ‹ŸåŒ–é—®é¢˜</strong>ï¼šè™šæ‹ŸåŒ–ç¯å¢ƒä¸‹ AVM æ‹¦æˆªäº† UP äº‹ä»¶</li>
<li><strong>ç¡¬ä»¶é—®é¢˜</strong>ï¼šå±å¹•ç¡¬ä»¶ä¸ŠæŠ¥äº†ä¸¤ä¸ªè§¦æ‘¸ç‚¹ï¼Œå¯¼è‡´ç³»ç»Ÿè¯¯åˆ¤</li>
</ul>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹è§¦æ‘¸äº‹ä»¶</span>
getevent -lt /dev/input/event*

<span class="hljs-comment"># æŸ¥çœ‹å½“å‰çª—å£å±‚çº§å’Œè§¦æ‘¸åŒºåŸŸ</span>
dumpsys window | grep -A 5 <span class="hljs-string">"mCurrentFocus"</span>

<span class="hljs-comment"># æŸ¥çœ‹ InputDispatcher çŠ¶æ€</span>
dumpsys input

<span class="hljs-comment"># æ£€æŸ¥ View å±‚çº§ä¸­æ˜¯å¦æœ‰é€æ˜é®æŒ¡</span>
dumpsys activity &lt;package_name&gt; | grep -i <span class="hljs-string">"touchable"</span>
</code></pre>
<h3 data-id="heading-9">system_server é—®é¢˜</h3>
<p>system_server æ˜¯ Android ç³»ç»Ÿçš„"å¤§è„‘"ï¼Œå®ƒçš„é—®é¢˜ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿæ— å“åº”ã€‚</p>
<p><strong>å…¸å‹åœºæ™¯ä¸æ ¹å› ï¼š</strong></p>


















































<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">æ ¹å› </th><th align="left">æ’æŸ¥æ–¹å‘</th></tr></thead><tbody><tr><td align="left">ç‰¹æ®Šåœºæ™¯å´©æºƒ</td><td align="left">ç©ºæŒ‡é’ˆå¼‚å¸¸</td><td align="left">æŸ¥çœ‹ tombstone</td></tr><tr><td align="left">ç³»ç»ŸæŒ‚èµ·</td><td align="left">æ­»é”ç­‰å¾…</td><td align="left">æŸ¥çœ‹ ANR traces</td></tr><tr><td align="left">å“åº”è¶…æ—¶</td><td align="left">Binder çº¿ç¨‹è€—å°½ï¼ˆæœ€å¤§ 32 ä¸ªï¼‰</td><td align="left">æŸ¥çœ‹ binder çŠ¶æ€</td></tr><tr><td align="left">èµ„æºæ³„æ¼</td><td align="left">FD æ³„æ¼</td><td align="left">æ£€æŸ¥ /proc/pid/fd</td></tr><tr><td align="left">å¹¶å‘é—®é¢˜</td><td align="left">ç¼ºå°‘é”ä¿æŠ¤</td><td align="left">ä»£ç å®¡æŸ¥</td></tr><tr><td align="left">Watchdog è§¦å‘</td><td align="left">kernel sensor é©±åŠ¨é˜»å¡</td><td align="left">æŸ¥çœ‹ kernel log</td></tr><tr><td align="left">Binder å†…å­˜è€—å°½</td><td align="left">åº”ç”¨ä¼ é€’å¤§æ•°æ®ï¼ˆå¦‚é…·ç‹—ï¼‰</td><td align="left">é™åˆ¶ Binder æ•°æ®å¤§å°</td></tr><tr><td align="left">Monkey æµ‹è¯•å¡æ­»</td><td align="left">monkey ç«¯é˜»å¡ binder è°ƒç”¨è¶…æ—¶</td><td align="left">ä¼˜åŒ– monkey è„šæœ¬</td></tr></tbody></table>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ system_server çš„ Binder çº¿ç¨‹çŠ¶æ€</span>
<span class="hljs-built_in">cat</span> /sys/kernel/debug/binder/proc/&lt;system_server_pid&gt;

<span class="hljs-comment"># æŸ¥çœ‹ Binder ä½¿ç”¨æƒ…å†µ</span>
dumpsys binder_debug

<span class="hljs-comment"># æŸ¥çœ‹ FD æ•°é‡</span>
<span class="hljs-built_in">ls</span> -la /proc/&lt;pid&gt;/fd | <span class="hljs-built_in">wc</span> -l

<span class="hljs-comment"># æŸ¥çœ‹ FD è¯¦æƒ…</span>
<span class="hljs-built_in">ls</span> -la /proc/&lt;pid&gt;/fd

<span class="hljs-comment"># æŸ¥çœ‹ ANR traces</span>
<span class="hljs-built_in">cat</span> /data/anr/traces.txt

<span class="hljs-comment"># æŸ¥çœ‹ Watchdog æ—¥å¿—</span>
logcat -b system | grep -i <span class="hljs-string">"watchdog"</span>

<span class="hljs-comment"># æ£€æŸ¥æ­»é”</span>
debuggerd -b &lt;pid&gt;
</code></pre>

Binder çº¿ç¨‹æ± é»˜è®¤æœ€å¤§ 32 ä¸ªçº¿ç¨‹ã€‚å¦‚æœåº”ç”¨åŒæ­¥è°ƒç”¨ç³»ç»ŸæœåŠ¡è¿‡å¤šï¼Œå¾ˆå®¹æ˜“è€—å°½ Binder çº¿ç¨‹ã€‚å»ºè®®ä½¿ç”¨å¼‚æ­¥ Binder è°ƒç”¨æˆ– AIDL çš„ oneway æ–¹æ³•ã€‚

<h3 data-id="heading-10">å­˜å‚¨é—®é¢˜</h3>
<p>å­˜å‚¨é—®é¢˜ä¼šå¯¼è‡´ç³»ç»Ÿæ— æ³•æ­£å¸¸è¿è¡Œã€‚</p>
<p><strong>ç£ç›˜æ»¡ï¼š</strong></p>
<ul>
<li>Android system æœåŠ¡æ— æ³•å¯åŠ¨</li>
<li>åº”ç”¨æ‰“ä¸å¼€ï¼Œkernel æœ‰ minifree log</li>
</ul>
<p><strong>ç£ç›˜åï¼š</strong></p>
<ul>
<li>å‡çº§åæŒ‚è½½ä¸ä¸Š</li>
<li>æ¢å¤å‡ºå‚è®¾ç½®å¤±è´¥</li>
</ul>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ</span>
<span class="hljs-built_in">df</span> -h

<span class="hljs-comment"># æŸ¥çœ‹å„ç›®å½•å¤§å°</span>
<span class="hljs-built_in">du</span> -sh /*

<span class="hljs-comment"># æŸ¥çœ‹æ–‡ä»¶ç³»ç»ŸçŠ¶æ€</span>
mount | grep -E <span class="hljs-string">"ext4|f2fs"</span>

<span class="hljs-comment"># æ£€æŸ¥ç£ç›˜é”™è¯¯ï¼ˆéœ€ rootï¼‰</span>
fsck.ext4 -n /dev/block/xxx

<span class="hljs-comment"># æŸ¥çœ‹ kernel å­˜å‚¨ç›¸å…³æ—¥å¿—</span>
dmesg | grep -iE <span class="hljs-string">"ext4|mmc|emmc|error"</span>
</code></pre>
<h3 data-id="heading-11">å…³é”®æœåŠ¡é—®é¢˜</h3>
<ul>
<li><strong>Binder å†…å­˜è€—å°½</strong>ï¼šå¯¼èˆªæœåŠ¡ç­‰å…³é”®æœåŠ¡çš„ Binder å†…å­˜è€—å°½ä¼šå¡ä½æ•´ä¸ªæœåŠ¡</li>
</ul>
<h3 data-id="heading-12">SurfaceFlinger é—®é¢˜</h3>
<p>SurfaceFlinger æ˜¯æ˜¾ç¤ºå­ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ƒçš„é—®é¢˜ä¼šå¯¼è‡´æ•´ä¸ªæ˜¾ç¤ºç³»ç»Ÿå¼‚å¸¸ã€‚</p>
<p><strong>å…¸å‹åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>ç¼ºå°‘é”ä¿æŠ¤</strong>ï¼šå¹¶å‘è®¿é—®å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´</li>
<li><strong>è™šæ‹ŸåŒ–é€šé“é˜»å¡</strong>ï¼šä¸ hypervisor çš„é€šä¿¡é˜»å¡</li>
<li><strong>åˆå§‹åŒ–å¡ä½</strong>ï¼šå¯åŠ¨è¿‡ç¨‹ä¸­å¡åœ¨æŸä¸ªåˆå§‹åŒ–æ­¥éª¤</li>
<li><strong>HWC crash</strong>ï¼šHWC crash å¯¼è‡´ PSD å± ID å˜åŒ–ï¼Œæ˜ å°„å¤±æ•ˆï¼Œè§¦æ‘¸å¤±çµ</li>
</ul>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ SurfaceFlinger çŠ¶æ€</span>
dumpsys SurfaceFlinger

<span class="hljs-comment"># æŸ¥çœ‹ HWC ä¿¡æ¯</span>
dumpsys SurfaceFlinger --hwc

<span class="hljs-comment"># æŸ¥çœ‹æ˜¾ç¤ºé…ç½®</span>
dumpsys display

<span class="hljs-comment"># æŸ¥çœ‹ SurfaceFlinger çš„ tombstoneï¼ˆå¦‚æœ crashï¼‰</span>
<span class="hljs-built_in">cat</span> /data/tombstones/tombstone_*
</code></pre>
<h2 data-id="heading-13">é»‘å±é—®é¢˜æ’æŸ¥</h2>
<p>é»‘å±æ˜¯ç”¨æˆ·æ„ŸçŸ¥æœ€æ˜æ˜¾çš„é—®é¢˜ï¼Œåˆ†ä¸ºåº”ç”¨å±‚é»‘å±å’Œåº•å±‚é»‘å±ä¸¤ç±»ã€‚</p>
<h3 data-id="heading-14">åº”ç”¨å±‚é»‘å±</h3>
<p><strong>å…¸å‹åœºæ™¯ï¼š</strong></p>






























<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">åŸå› </th><th align="left">æ’æŸ¥æ–¹å‘</th></tr></thead><tbody><tr><td align="left">Launcher å¡ä½/Crash</td><td align="left">Launcher å¼‚å¸¸</td><td align="left">æŸ¥çœ‹ Launcher æ—¥å¿—</td></tr><tr><td align="left">åº”ç”¨ ANR + Crash</td><td align="left">åº”ç”¨è‡ªèº«é—®é¢˜</td><td align="left">æŸ¥çœ‹ ANR traces å’Œ tombstone</td></tr><tr><td align="left">å¼€æœºå¼•å¯¼é»‘å±</td><td align="left">abandon buffer</td><td align="left">æŸ¥çœ‹ SurfaceFlinger æ—¥å¿—</td></tr><tr><td align="left">CarPlay é»‘å±</td><td align="left">CarPlay æœåŠ¡å¼‚å¸¸</td><td align="left">æŸ¥çœ‹ CarPlay ç›¸å…³æ—¥å¿—</td></tr></tbody></table>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰ Activity</span>
dumpsys activity activities | grep <span class="hljs-string">"mResumed"</span>

<span class="hljs-comment"># æŸ¥çœ‹ Launcher çŠ¶æ€</span>
dumpsys activity | grep -i <span class="hljs-string">"launcher"</span>

<span class="hljs-comment"># æŸ¥çœ‹æœ€è¿‘çš„ ANR</span>
<span class="hljs-built_in">ls</span> -lt /data/anr/

<span class="hljs-comment"># æŸ¥çœ‹åº”ç”¨å´©æºƒæ—¥å¿—</span>
logcat -b crash

<span class="hljs-comment"># æ£€æŸ¥ buffer çŠ¶æ€</span>
dumpsys SurfaceFlinger | grep -i <span class="hljs-string">"abandon"</span>
</code></pre>
<h3 data-id="heading-15">åº•å±‚/ç¡¬ä»¶é»‘å±</h3>
<p>åº•å±‚é»‘å±é€šå¸¸ä¸ç¡¬ä»¶æˆ–é©±åŠ¨ç›¸å…³ï¼Œæ’æŸ¥éš¾åº¦è¾ƒå¤§ã€‚</p>
<p><strong>å…¸å‹åœºæ™¯ï¼š</strong></p>
<ul>
<li><strong>ç¡¬ä»¶å±é—®é¢˜</strong>ï¼šå±å¹•æœ¬èº«æ•…éšœ</li>
<li><strong>BIOS åè½¬</strong>ï¼šBIOS é…ç½®å¯¼è‡´æ˜¾ç¤ºå¼‚å¸¸</li>
<li><strong>èƒŒå…‰é—®é¢˜</strong>ï¼šèƒŒå…‰é©±åŠ¨æˆ–ç¡¬ä»¶æ•…éšœ</li>
<li><strong>GPU Training é—®é¢˜</strong>ï¼šGPU åˆå§‹åŒ–å¤±è´¥</li>
<li><strong>QNX I2C é—®é¢˜</strong>ï¼šè™šæ‹ŸåŒ–ç¯å¢ƒä¸‹ QNX ä¾§çš„ I2C é€šä¿¡é—®é¢˜</li>
</ul>
<p><strong>æ’æŸ¥å‘½ä»¤ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ˜¾ç¤ºé©±åŠ¨çŠ¶æ€</span>
<span class="hljs-built_in">cat</span> /sys/class/drm/card0/status

<span class="hljs-comment"># æŸ¥çœ‹èƒŒå…‰çŠ¶æ€</span>
<span class="hljs-built_in">cat</span> /sys/class/backlight/*/brightness
<span class="hljs-built_in">cat</span> /sys/class/backlight/*/max_brightness

<span class="hljs-comment"># æŸ¥çœ‹ kernel æ˜¾ç¤ºç›¸å…³æ—¥å¿—</span>
dmesg | grep -iE <span class="hljs-string">"drm|display|panel|backlight"</span>

<span class="hljs-comment"># æŸ¥çœ‹ I2C è®¾å¤‡</span>
<span class="hljs-built_in">ls</span> /dev/i2c-*
i2cdetect -y &lt;bus_number&gt;
</code></pre>
<h2 data-id="heading-16">æ˜¾ç¤ºå¼‚å¸¸é—®é¢˜</h2>
<p>æ˜¾ç¤ºå¼‚å¸¸ä¸åƒé»‘å±é‚£æ ·ä¸¥é‡ï¼Œä½†ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚</p>
<h3 data-id="heading-17">å…¸å‹åœºæ™¯</h3>






























<table><thead><tr><th align="left">é—®é¢˜ç±»å‹</th><th align="left">å…·ä½“åœºæ™¯</th><th align="left">å¯èƒ½åŸå› </th></tr></thead><tbody><tr><td align="left"><strong>åº”ç”¨é—ªçƒ</strong></td><td align="left">ç‰¹å®šåº”ç”¨ç•Œé¢é—ªçƒ</td><td align="left">åº”ç”¨æ¸²æŸ“é—®é¢˜ã€å¸§ç‡ä¸ç¨³å®š</td></tr><tr><td align="left"><strong>æ•´å±é—ªçƒ</strong></td><td align="left">æ•´ä¸ªå±å¹•é—ªçƒ</td><td align="left">DRM ä¿æŠ¤è§¦å‘ã€AMD GPU é—®é¢˜ã€PSD å±é©±åŠ¨é—®é¢˜</td></tr><tr><td align="left"><strong>æ˜¾ç¤ºä¸å…¨</strong></td><td align="left">ç•Œé¢è¢«æˆªæ–­</td><td align="left">åº”ç”¨ layout åæ ‡è®¾ç½®é”™è¯¯</td></tr><tr><td align="left"><strong>å¤šå±é”™ä¹±</strong></td><td align="left">PSD home æ˜¾ç¤ºåˆ° CSD ä¸Š</td><td align="left">å¼€æœºå¼•å¯¼å€¼ <code>DEVICE_PROVISIONED</code> ä¸º 0ï¼Œå¤šå±é…ç½®é”™è¯¯</td></tr></tbody></table>
<h3 data-id="heading-18">æ’æŸ¥å‘½ä»¤</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ˜¾ç¤ºé…ç½®</span>
dumpsys display

<span class="hljs-comment"># æŸ¥çœ‹ window é…ç½®</span>
dumpsys window displays

<span class="hljs-comment"># æŸ¥çœ‹å¤šå±çŠ¶æ€</span>
dumpsys SurfaceFlinger | grep -i <span class="hljs-string">"display"</span>

<span class="hljs-comment"># æ£€æŸ¥ DEVICE_PROVISIONED å€¼</span>
settings get global device_provisioned

<span class="hljs-comment"># æŸ¥çœ‹åº”ç”¨æ¸²æŸ“ä¿¡æ¯</span>
dumpsys gfxinfo &lt;package_name&gt;
</code></pre>
<h2 data-id="heading-19">æ€»ç»“ä¸æ’æŸ¥æ–¹æ³•è®º</h2>
<h3 data-id="heading-20">é—®é¢˜å®šä½æ€è·¯</h3>
<p>é¢å¯¹ç¨³å®šæ€§é—®é¢˜ï¼Œå»ºè®®æŒ‰ç…§ä»¥ä¸‹æµç¨‹è¿›è¡Œæ’æŸ¥ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ç°è±¡ç¡®è®¤
   â””â”€â”€ æ˜¯æ€§èƒ½é—®é¢˜ï¼Ÿå¡æ­»ï¼Ÿé»‘å±ï¼Ÿè¿˜æ˜¯æ˜¾ç¤ºå¼‚å¸¸ï¼Ÿ

<span class="hljs-bullet">2.</span> èŒƒå›´ç¼©å°
   â””â”€â”€ æ˜¯å•åº”ç”¨é—®é¢˜ï¼Ÿç³»ç»Ÿé—®é¢˜ï¼Ÿè¿˜æ˜¯ç¡¬ä»¶é—®é¢˜ï¼Ÿ

<span class="hljs-bullet">3.</span> æ—¥å¿—æ”¶é›†
   â””â”€â”€ logcatã€kernel logã€tracesã€tombstoneã€bugreport

<span class="hljs-bullet">4.</span> æ•°æ®åˆ†æ
   â””â”€â”€ CPUã€å†…å­˜ã€IOã€GPU å„é¡¹æŒ‡æ ‡

<span class="hljs-bullet">5.</span> æ ¹å› å®šä½
   â””â”€â”€ ç»“åˆä»£ç å’Œæ—¥å¿—ç¡®å®šæ ¹å› 

<span class="hljs-bullet">6.</span> ä¿®å¤éªŒè¯
   â””â”€â”€ ä¿®å¤åè¿›è¡Œå‹åŠ›æµ‹è¯•éªŒè¯
</code></pre>
<h3 data-id="heading-21">å¸¸ç”¨æ’æŸ¥å·¥å…·æ±‡æ€»</h3>


















































<table><thead><tr><th align="left">å·¥å…·</th><th align="left">ç”¨é€”</th><th align="left">å‘½ä»¤ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left"><code>top</code></td><td align="left">CPU ç›‘æ§</td><td align="left"><code>top -H -p &lt;pid&gt;</code></td></tr><tr><td align="left"><code>dumpsys</code></td><td align="left">ç³»ç»ŸæœåŠ¡çŠ¶æ€</td><td align="left"><code>dumpsys meminfo</code></td></tr><tr><td align="left"><code>simpleperf</code></td><td align="left">æ€§èƒ½åˆ†æ</td><td align="left"><code>simpleperf record -p &lt;pid&gt;</code></td></tr><tr><td align="left"><code>strace</code></td><td align="left">ç³»ç»Ÿè°ƒç”¨è¿½è¸ª</td><td align="left"><code>strace -p &lt;pid&gt;</code></td></tr><tr><td align="left"><code>getevent</code></td><td align="left">è§¦æ‘¸äº‹ä»¶</td><td align="left"><code>getevent -lt</code></td></tr><tr><td align="left"><code>logcat</code></td><td align="left">æ—¥å¿—æŸ¥çœ‹</td><td align="left"><code>logcat -b crash</code></td></tr><tr><td align="left"><code>dmesg</code></td><td align="left">å†…æ ¸æ—¥å¿—</td><td align="left"><code>dmesg | grep error</code></td></tr><tr><td align="left"><code>bugreport</code></td><td align="left">å®Œæ•´æŠ¥å‘Š</td><td align="left"><code>adb bugreport</code></td></tr></tbody></table>
<h3 data-id="heading-22">æœ€åçš„å»ºè®®</h3>
<ol>
<li><strong>å»ºç«‹ç›‘æ§ä½“ç³»</strong>ï¼šåœ¨ç³»ç»Ÿä¸­åŸ‹ç‚¹ï¼ŒæŒç»­ç›‘æ§ CPUã€å†…å­˜ã€IO ç­‰å…³é”®æŒ‡æ ‡</li>
<li><strong>å®Œå–„æ—¥å¿—ç³»ç»Ÿ</strong>ï¼šå…³é”®è·¯å¾„è¦æœ‰æ—¥å¿—ï¼Œä½†ä¹Ÿè¦æ§åˆ¶æ—¥å¿—é‡</li>
<li><strong>å‹åŠ›æµ‹è¯•å¸¸æ€åŒ–</strong>ï¼šMonkey æµ‹è¯•ã€é•¿æ—¶é—´è€åŒ–æµ‹è¯•è¦æˆä¸ºæ ‡é…</li>
<li><strong>é—®é¢˜å¤ç›˜æœºåˆ¶</strong>ï¼šæ¯ä¸ªé—®é¢˜è§£å†³åè¦å¤ç›˜ï¼Œå½¢æˆçŸ¥è¯†åº“</li>
</ol>
<p>è½¦è½½ç³»ç»Ÿçš„ç¨³å®šæ€§æ˜¯ä¸€åœºæŒä¹…æˆ˜ï¼Œæ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰ä¸æ–­ç§¯ç´¯ç»éªŒå’Œå®Œå–„ä½“ç³»ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ åœ¨æ’æŸ¥é—®é¢˜æ—¶å°‘èµ°ä¸€äº›å¼¯è·¯ã€‚</p>
<hr/>
<p><em>æœ‰ä»»ä½•é—®é¢˜æˆ–è¡¥å……ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºï¼</em></p>
<h2 data-id="heading-23">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftopic%2Fperformance" target="_blank" title="https://developer.android.com/topic/performance" ref="nofollow noopener noreferrer">Android Performance Patterns</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsource.android.com%2Fdocs%2Fautomotive" target="_blank" title="https://source.android.com/docs/automotive" ref="nofollow noopener noreferrer">Android Automotive OS Documentation</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fandroid.googlesource.com%2Fplatform%2Fsystem%2Fextras%2F%2B%2Fmaster%2Fsimpleperf%2Fdoc%2F" target="_blank" title="https://android.googlesource.com/platform/system/extras/+/master/simpleperf/doc/" ref="nofollow noopener noreferrer">Simpleperf Documentation</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose ä¸­ AndroidView çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸ WebView å®è·µ]]></title>    <link>https://juejin.cn/post/7584742635484889098</link>    <guid>https://juejin.cn/post/7584742635484889098</guid>    <pubDate>2025-12-17T14:55:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584742635484889098" data-draft-id="7584657447803371546" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose ä¸­ AndroidView çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸ WebView å®è·µ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-17T14:55:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·4165967369355"/> <meta itemprop="url" content="https://juejin.cn/user/1146150492576877"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose ä¸­ AndroidView çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸ WebView å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1146150492576877/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·4165967369355
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T14:55:05.000Z" title="Wed Dec 17 2025 14:55:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Jetpack Compose ä½“ç³»ä¸­ï¼Œ<code>AndroidView</code> æ˜¯åœ¨å£°æ˜å¼ UI ä¸­åµŒå…¥ä¼ ç»ŸåŸç”Ÿ View çš„å”¯ä¸€æ¡¥æ¢ã€‚ç”±äº <code>WebView</code> å…·æœ‰å†…å­˜æ¶ˆè€—å¤§ã€ç”Ÿå‘½å‘¨æœŸå¤æ‚ä»¥åŠä¾èµ–é…ç½®å˜æ›´ï¼ˆå¦‚æ—‹è½¬å±å¹•ï¼‰ç­‰ç‰¹æ€§ï¼Œç†è§£ <code>AndroidView</code> çš„å›è°ƒæœºåˆ¶æ˜¯å®ç°é«˜æ€§èƒ½æ··åˆé¡µé¢çš„å…³é”®ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ AndroidView æ ¸å¿ƒå›è°ƒè§£æ</h2>
<p><code>AndroidView</code> æä¾›äº†ä¸‰ä¸ªå…³é”®å›è°ƒï¼š<code>factory</code>ã€<code>update</code> å’Œ <code>onRelease</code>ã€‚</p>
<h3 data-id="heading-1">1. factory (View åˆ›å»º)</h3>
<p>ä»…åœ¨ <code>AndroidView</code> é¦–æ¬¡è¿›å…¥ç»„åˆï¼ˆCompositionï¼‰æ—¶æ‰§è¡Œä¸€æ¬¡ã€‚æ­¤å—ç”¨äºæ‰§è¡Œ View çš„åˆå§‹åŒ–é€»è¾‘ï¼Œå¦‚è®¾ç½® <code>WebViewClient</code> æˆ–å¼€å¯ JavaScriptã€‚</p>
<h3 data-id="heading-2">2. update (æ•°æ®åŒæ­¥)</h3>
<p>å½“ Composable å‘ç”Ÿé‡ç»„ä¸”ä¾èµ–çš„çŠ¶æ€ï¼ˆStateï¼‰æ”¹å˜æ—¶ï¼Œæ­¤å›è°ƒä¼šåå¤è§¦å‘ã€‚å…¶èŒè´£æ˜¯å°† Compose çš„çŠ¶æ€åŒæ­¥ç»™åŸç”Ÿ Viewã€‚</p>
<h3 data-id="heading-3">3. onRelease (èµ„æºæ¸…ç†)</h3>
<p>å½“ <code>AndroidView</code> ä» UI æ ‘ä¸­ç§»é™¤å¹¶å½»åº•é”€æ¯æ—¶è°ƒç”¨ã€‚è¿™æ˜¯æ‰§è¡Œ <code>webView.destroy()</code> çš„æ ¸å¿ƒæ—¶æœºï¼Œç”¨äºé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</p>
<hr/>
<h2 data-id="heading-4">äºŒã€ åœºæ™¯å®è·µï¼šé«˜æ€§èƒ½ WebView ç»„ä»¶å°è£…</h2>
<p>ä¸‹æ–¹æ¡ˆä¾‹å±•ç¤ºäº†å¦‚ä½•ç»“åˆè¿”å›é”®å¤„ç†ã€ç”Ÿå‘½å‘¨æœŸè§‚å¯Ÿä»¥åŠçŠ¶æ€é˜²æŠ–æ¥å®ç°ä¸€ä¸ªå¥å£®çš„ <code>WebView</code>ã€‚</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Composable</span>
fun RobustWebView(
    <span class="hljs-attribute">url</span>: String,
    <span class="hljs-attribute">modifier</span>: Modifier = Modifier
) {
    val context = LocalContext<span class="hljs-selector-class">.current</span>
    val lifecycleOwner = LocalLifecycleOwner<span class="hljs-selector-class">.current</span>

    <span class="hljs-comment">// æå‡ View å®ä¾‹ï¼Œä»¥ä¾¿åœ¨ AndroidView å¤–éƒ¨ï¼ˆå¦‚ BackHandlerï¼‰å¼•ç”¨</span>
    val webView = <span class="hljs-built_in">remember</span>(context) {
        <span class="hljs-built_in">WebView</span>(context)<span class="hljs-selector-class">.apply</span> {
            settings<span class="hljs-selector-class">.javaScriptEnabled</span> = true
            webViewClient = <span class="hljs-built_in">WebViewClient</span>()
        }
    }

    <span class="hljs-comment">// å¤„ç†ç³»ç»Ÿè¿”å›é”®ï¼šè‹¥ç½‘é¡µå¯åé€€ï¼Œåˆ™æ‹¦æˆªç‰©ç†è¿”å›é”®</span>
    <span class="hljs-built_in">BackHandler</span>(enabled = webView.canGoBack()) {
        webView<span class="hljs-selector-class">.goBack</span>()
    }

    <span class="hljs-comment">// ç»‘å®šç³»ç»Ÿç”Ÿå‘½å‘¨æœŸï¼šApp åˆ‡å…¥åå°æ—¶æš‚åœ WebView æ¸²æŸ“ä»¥èŠ‚çœèƒ½è€—</span>
    <span class="hljs-built_in">DisposableEffect</span>(lifecycleOwner) {
        val observer = LifecycleEventObserver { _, event -&gt;
            when (event) {
                Lifecycle<span class="hljs-selector-class">.Event</span><span class="hljs-selector-class">.ON_RESUME</span> -&gt; webView<span class="hljs-selector-class">.onResume</span>()
                Lifecycle<span class="hljs-selector-class">.Event</span><span class="hljs-selector-class">.ON_PAUSE</span> -&gt; webView<span class="hljs-selector-class">.onPause</span>()
                else -&gt; {}
            }
        }
        lifecycleOwner<span class="hljs-selector-class">.lifecycle</span><span class="hljs-selector-class">.addObserver</span>(observer)
        onDispose {
            lifecycleOwner<span class="hljs-selector-class">.lifecycle</span><span class="hljs-selector-class">.removeObserver</span>(observer)
        }
    }

    <span class="hljs-built_in">AndroidView</span>(
        modifier = modifier,
        factory = { webView },
        update = { view -&gt;
            // é˜²æŠ–åˆ¤æ–­ï¼šé¿å…é‡ç»„å¯¼è‡´ç½‘é¡µé‡å¤åŠ è½½
            if (view.url != url) {
                view<span class="hljs-selector-class">.loadUrl</span>(url)
            }
        },
        onRelease = { view -&gt;
            <span class="hljs-comment">// å½»åº•é‡Šæ”¾å†…å­˜ï¼Œåœæ­¢åå°éŸ³è§†é¢‘æ’­æ”¾</span>
            view<span class="hljs-selector-class">.stopLoading</span>()
            view<span class="hljs-selector-class">.loadUrl</span>("about:blank")
            view<span class="hljs-selector-class">.destroy</span>()
        }
    )
}
</code></pre>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€ é…ç½®å˜æ›´ä¸ onRelease çš„æ·±åº¦å…³è”</h2>
<p>åœ¨ Android ç³»ç»Ÿä¸­ï¼Œå±å¹•æ—‹è½¬é»˜è®¤ä¼šè§¦å‘ Activity çš„é”€æ¯ä¸é‡å»ºã€‚</p>
<h3 data-id="heading-6">1. é»˜è®¤è¡Œä¸º</h3>
<p>è‹¥ä¸è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œå±å¹•æ—‹è½¬ä¼šå¯¼è‡´ <code>AndroidView</code> ç¦»å¼€ç»„åˆæ ‘å¹¶è§¦å‘ <code>onRelease</code>ã€‚éšååœ¨æ–°çš„ Activity ä¸­ï¼Œ<code>factory</code> ä¼šé‡æ–°åˆ›å»º <code>WebView</code> å®ä¾‹ã€‚è¿™å°†å¯¼è‡´ç½‘é¡µè¿›åº¦ä¸¢å¤±ã€è§†é¢‘æ’­æ”¾ä¸­æ–­ä»¥åŠç™½å±é‡è½½ã€‚</p>
<h3 data-id="heading-7">2. ç¦æ­¢é‡å»ºæ–¹æ¡ˆ</h3>
<p>åœ¨ <code>AndroidManifest.xml</code> ä¸­é…ç½® <code>android:configChanges="orientation|screenSize"</code> å¯é˜»æ­¢ Activity é‡å»ºã€‚åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œæ—‹è½¬å±å¹•ä»…è§¦å‘å¸ƒå±€é‡æ–°æµ‹é‡ï¼Œä¸ä¼šè§¦å‘ <code>onRelease</code>ï¼Œä»è€Œä¿æŒ <code>WebView</code> çš„è¿è¡ŒçŠ¶æ€ã€‚</p>
<h3 data-id="heading-8">3. æ¡ä»¶å¸ƒå±€ä¸­çš„ onRelease é™·é˜±</h3>
<p>åœ¨å¤æ‚çš„â€œè§†é¢‘+åˆ—è¡¨â€åœºæ™¯ä¸­ï¼Œè‹¥é‡‡ç”¨å¦‚ä¸‹é€»è¾‘åˆ‡æ¢å¸ƒå±€ï¼š</p>
<ul>
<li><strong>ç«–å±</strong>ï¼šæ˜¾ç¤º WebViewã€‚</li>
<li><strong>æ¨ªå±</strong>ï¼šä»…æ˜¾ç¤ºå…¨å±è§†é¢‘ã€‚</li>
</ul>
<p>å½“åˆ‡æ¢è‡³æ¨ªå±æ—¶ï¼Œç”±äº <code>WebView</code> åœ¨ <code>if/else</code> åˆ†æ”¯ä¸­æ¶ˆå¤±ï¼Œå³ä½¿ Activity ä¸é‡å»ºï¼Œ<code>AndroidView</code> ä¹Ÿä¼šå› ä¸ºä» UI æ ‘ä¸­è¢«ç§»é™¤è€Œè§¦å‘ <code>onRelease</code>ã€‚</p>
<p>è§„é¿ç­–ç•¥ï¼š</p>
<p>è‹¥éœ€ä¿ç•™ WebView çŠ¶æ€ï¼Œåº”é¿å…ä½¿ç”¨ if/else å½»åº•ç§»é™¤ç»„ä»¶ã€‚å»ºè®®é€šè¿‡ Modifier.alpha(0f) æˆ– Modifier.offset å°†å…¶ç§»å‡ºå¯è§†åŒºåŸŸã€‚åªè¦ç»„ä»¶ä»åœ¨ UI æ ‘ä¸­ï¼ŒonRelease å°±ä¸ä¼šæ‰§è¡Œã€‚</p>
<hr/>
<h2 data-id="heading-9">å››ã€onRelease ä¸ onDispose çš„åŒºåˆ«</h2>

























<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>onRelease (AndroidView å‚æ•°)</strong></th><th><strong>onDispose (DisposableEffect å›è°ƒ)</strong></th></tr></thead><tbody><tr><td><strong>æ“ä½œå¯¹è±¡</strong></td><td>ç›´æ¥æ“ä½œåŸç”Ÿ View å®ä¾‹</td><td>ç®¡ç†å‰¯ä½œç”¨ï¼ˆå¦‚ç›‘å¬å™¨ã€è§‚å¯Ÿè€…ï¼‰</td></tr><tr><td><strong>è§¦å‘ç‚¹</strong></td><td>View è¢«ä»è§†å›¾ç»“æ„ä¸­æ‹†å¸æ—¶</td><td>Composable ç¦»å¼€ç»„åˆæˆ– Key å˜åŒ–æ—¶</td></tr><tr><td><strong>æ ¸å¿ƒç”¨é€”</strong></td><td>è°ƒç”¨ <code>view.destroy()</code> ç­‰ç‰©ç†é”€æ¯åŠ¨ä½œ</td><td>è°ƒç”¨ <code>removeObserver()</code> ç­‰é€»è¾‘æ¸…ç†åŠ¨ä½œ</td></tr></tbody></table>
<p>åœ¨å¼€å‘æ¶‰åŠè§†é¢‘ã€ç½‘é¡µã€åœ°å›¾ç­‰é‡èµ„æºç»„ä»¶æ—¶ï¼Œåº”ä¼˜å…ˆåœ¨ <code>onRelease</code> ä¸­å¤„ç† View æœ¬èº«çš„é”€æ¯ï¼Œåœ¨ <code>onDispose</code> ä¸­å¤„ç†å¤–éƒ¨èµ„æºï¼ˆå¦‚ä¼ æ„Ÿå™¨ã€ç”Ÿå‘½å‘¨æœŸç›‘å¬ï¼‰çš„è§£ç»‘ã€‚</p>
<hr/>
<h2 data-id="heading-10">äº”ã€ è¿›é˜¶ï¼šé…ç½®å˜æ›´ä¸‹çš„çŠ¶æ€æŒä¹…åŒ–</h2>
<p>å°½ç®¡é€šè¿‡ <code>configChanges</code> ç¦æ­¢ Activity é‡å»ºæ˜¯é¦–é€‰æ–¹æ¡ˆï¼Œä½†åœ¨æŸäº›ç³»ç»Ÿå¼ºåˆ¶å›æ”¶å†…å­˜æˆ–å¿…é¡»é‡å»º Activity çš„åœºæ™¯ä¸‹ï¼Œéœ€è¦åˆ©ç”¨ <code>saveState</code> å’Œ <code>restoreState</code> æ¥ä¿æŒç”¨æˆ·çš„æµè§ˆè¿›åº¦ã€‚</p>
<h3 data-id="heading-11">1. è‡ªåŠ¨çŠ¶æ€ä¿æŒ</h3>
<p><code>WebView</code> æä¾›äº†å†…ç½®çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œå¯ä»¥å°†å½“å‰çš„æµè§ˆå†å²ã€ç¼©æ”¾ç­‰çº§ç­‰ä¿¡æ¯ä¿å­˜è‡³ <code>Bundle</code> ä¸­ã€‚åœ¨ Compose ä¸­ï¼Œå¯ä»¥é…åˆ <code>rememberSaveable</code> å®ç°è·¨ Activity é‡å»ºçš„çŠ¶æ€ç®¡ç†ã€‚</p>
<p>Kotlin</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Composable</span>
fun PersistentWebView(<span class="hljs-attribute">url</span>: String) {
    <span class="hljs-comment">// ä½¿ç”¨ rememberSaveable è·¨è¶Š Activity é‡å»ºæŒä¹…åŒ– Bundle</span>
    val webViewStateBundle = rememberSaveable { <span class="hljs-built_in">Bundle</span>() }

    <span class="hljs-built_in">AndroidView</span>(
        factory = { context -&gt;
            WebView(context)<span class="hljs-selector-class">.apply</span> {
                settings<span class="hljs-selector-class">.javaScriptEnabled</span> = true
                webViewClient = <span class="hljs-built_in">WebViewClient</span>()
                
                <span class="hljs-comment">// è‹¥ Bundle å†…å­˜æœ‰æ•°æ®ï¼Œåˆ™æ¢å¤å†å²è®°å½•è€Œéé‡æ–°åŠ è½½ URL</span>
                if (!webViewStateBundle.isEmpty) {
                    this<span class="hljs-selector-class">.restoreState</span>(webViewStateBundle)
                }
            }
        },
        update = { view -&gt;
            <span class="hljs-comment">// ä»…åœ¨åˆæ¬¡åŠ è½½ä¸”æ— ç¼“å­˜çŠ¶æ€æ—¶æ‰§è¡Œ loadUrl</span>
            if (view.url == null &amp;&amp; webViewStateBundle.isEmpty) {
                view<span class="hljs-selector-class">.loadUrl</span>(url)
            }
        },
        onRelease = { view -&gt;
            <span class="hljs-comment">// åœ¨ View é”€æ¯å‰ï¼Œå°†å…¶å½“å‰çŠ¶æ€å­˜å…¥ Bundle</span>
            view<span class="hljs-selector-class">.saveState</span>(webViewStateBundle)
            view<span class="hljs-selector-class">.destroy</span>()
        }
    )
}
</code></pre>
<hr/>
<h2 data-id="heading-12">å…­ã€ å¤æ‚åœºæ™¯ï¼šè§†é¢‘ä¸ WebView çš„å…±å­˜ç­–ç•¥</h2>
<p>åœ¨â€œä¸ŠåŠéƒ¨åˆ†è§†é¢‘ã€ä¸‹åŠéƒ¨åˆ†ç½‘é¡µâ€çš„å¸ƒå±€ä¸­ï¼Œè‹¥æ¨ªå±æ—¶éœ€è¦å°†è§†é¢‘å…¨å±å¹¶éšè—ç½‘é¡µï¼Œå¿…é¡»ç²¾ç¡®æ§åˆ¶ <code>AndroidView</code> çš„å­˜ç»­çŠ¶æ€ã€‚</p>
<h3 data-id="heading-13">1. é¿å…ä½¿ç”¨æ¡ä»¶æ¸²æŸ“ (if/else)</h3>
<p>åœ¨ Compose ä¸­ï¼Œ<code>if (isLandscape) { FullScreenVideo() } else { VideoWithWeb() }</code> ä¼šå¯¼è‡´ <code>AndroidView</code> é¢‘ç¹è§¦å‘ <code>onRelease</code> å’Œ <code>factory</code>ã€‚</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>å…±äº« View å®ä¾‹</strong>ï¼šå°†è§†é¢‘ç»„ä»¶çš„ <code>AndroidView</code> æ”¾åœ¨ <code>if</code> è¯­å¥ä¹‹å¤–ï¼Œä»…é€šè¿‡ <code>Modifier</code> åŠ¨æ€è°ƒæ•´å…¶å®½é«˜ã€‚</li>
<li><strong>é€»è¾‘ä¿ç•™ WebView</strong>ï¼šå¯¹äºéœ€è¦æš‚æ—¶éšè—çš„ WebViewï¼Œåº”ä½¿ç”¨ <code>Modifier.size(0.dp)</code> æˆ– <code>Modifier.graphicsLayer { alpha = 0f }</code>ã€‚è¿™ç§åšæ³•èƒ½ç¡®ä¿ <code>AndroidView</code> å§‹ç»ˆä¿æŒåœ¨ Composition æ ‘ä¸­ï¼Œä»è€Œè§„é¿ <code>onRelease</code> çš„è°ƒç”¨ï¼Œå®ç°ç¬æ—¶åˆ‡å›çš„æ•ˆæœã€‚</li>
</ul>
<h3 data-id="heading-14">2. å†…å­˜ä¸æ€§èƒ½çš„æƒè¡¡</h3>
<p>è™½ç„¶é€šè¿‡ <code>Modifier</code> éšè— View å¯ä»¥ä¿ç•™çŠ¶æ€ï¼Œä½† WebView åœ¨åå°ä»å¯èƒ½æ¶ˆè€— CPUã€‚å»ºè®®åœ¨éšè—æœŸé—´ï¼Œé…åˆ <code>onPause()</code> æ–¹æ³•åœæ­¢ JS è¿è¡Œï¼Œåœ¨é‡æ–°æ˜¾ç¤ºæ—¶è°ƒç”¨ <code>onResume()</code>ã€‚</p>
<hr/>
<h2 data-id="heading-15">ä¸ƒã€ æœ€ä½³å®è·µæ¸…å•</h2>
<p>ä¸ºç¡®ä¿ <code>AndroidView</code> ä¸ <code>WebView</code> çš„é›†æˆè¾¾åˆ°ç”Ÿäº§ç¯å¢ƒæ ‡å‡†ï¼Œå»ºè®®éµå¾ªä»¥ä¸‹æ¸…å•ï¼š</p>
<ol>
<li><strong>æ˜¾å¼é”€æ¯</strong>ï¼šåŠ¡å¿…åœ¨ <code>onRelease</code> ä¸­è°ƒç”¨ <code>destroy()</code>ï¼Œè¿™æ˜¯è§„é¿å†…å­˜æ³„æ¼çš„æœ€åº•å±‚ä¿éšœã€‚</li>
<li><strong>JS å®‰å…¨æ€§</strong>ï¼šé™¤éå¿…è¦ï¼Œå¦åˆ™åº”å®¡æ…å¼€å¯ <code>javaScriptEnabled</code>ã€‚è‹¥å¼€å¯ï¼Œéœ€åœ¨ <code>onRelease</code> æ—¶å°†å…¶é‡ç½®ä¸º <code>false</code>ã€‚</li>
<li><strong>URL é˜²æŠ–</strong>ï¼šåœ¨ <code>update</code> å›è°ƒä¸­ï¼Œå¿…é¡»å¯¹æ¯” <code>view.url</code> ä¸ç›®æ ‡ <code>url</code>ï¼Œä¸¥ç¦æ— æ¡ä»¶è°ƒç”¨ <code>loadUrl()</code>ã€‚</li>
<li><strong>è¿”å›é”®é—­ç¯</strong>ï¼šç»“åˆ <code>BackHandler</code> æä¾›ç¬¦åˆç”¨æˆ·ç›´è§‰çš„ç½‘é¡µåé€€ä½“éªŒã€‚</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸè”åŠ¨</strong>ï¼šä½¿ç”¨ <code>DisposableEffect</code> ç›‘å¬ <code>LifecycleOwner</code>ï¼Œç¡®ä¿ WebView çš„æ´»è·ƒçŠ¶æ€ä¸ App å‰åå°çŠ¶æ€åŒæ­¥ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[android åå°åº”ç”¨ç”³è¯·éŸ³é¢‘ç„¦ç‚¹å¤±è´¥]]></title>    <link>https://juejin.cn/post/7584742635484872714</link>    <guid>https://juejin.cn/post/7584742635484872714</guid>    <pubDate>2025-12-17T14:39:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584742635484872714" data-draft-id="7584655946087235630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="android åå°åº”ç”¨ç”³è¯·éŸ³é¢‘ç„¦ç‚¹å¤±è´¥"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-17T14:39:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·8335250253785"/> <meta itemprop="url" content="https://juejin.cn/user/752516335675672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            android åå°åº”ç”¨ç”³è¯·éŸ³é¢‘ç„¦ç‚¹å¤±è´¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/752516335675672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·8335250253785
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T14:39:36.000Z" title="Wed Dec 17 2025 14:39:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç°è±¡</h2>
<p>appåœ¨å‰å°å¯ä»¥ç”³è¯·éŸ³é¢‘ç„¦ç‚¹ï¼Œä½†æ˜¯åœ¨åå°ç”³è¯·éŸ³é¢‘ç„¦ç‚¹å¤±è´¥ã€‚</p>
<h2 data-id="heading-1">åŸå› </h2>
<p><code>HardeningEnforcer.blockFocusMethod</code>æ–¹æ³•æ‹’ç»äº†åå°appçš„ç”³è¯·ï¼Œè¿™ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªifä¼šåˆ¤æ–­appæ˜¯å¦ç¬¦åˆæ‹¿åˆ°éŸ³é¢‘ç„¦ç‚¹çš„æ¡ä»¶ã€‚ç¬¬äºŒifåˆ¤æ–­å¦‚æœtargetSdkæ˜¯å¦å°äº35ï¼Œå¦‚æœå°äº35ä¹Ÿä¸ä¼šæ‹’ç»ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//frameworks/base/services/core/java/com/android/server/audio/HardeningEnforcer.java</span>
<span class="hljs-comment">/**
 * Checks whether the call in the current thread should be allowed or blocked
 * <span class="hljs-doctag">@return</span> false if the method call is allowed, true if it should be a no-op
 */</span>
<span class="hljs-meta">@SuppressWarnings("AndroidFrameworkCompatChange")</span>
<span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">blockFocusMethod</span><span class="hljs-params">(<span class="hljs-type">int</span> callingUid, <span class="hljs-type">int</span> focusMethod, <span class="hljs-meta">@NonNull</span> String clientId,
                                   <span class="hljs-type">int</span> focusReqType, <span class="hljs-meta">@NonNull</span> String packageName, String attributionTag, <span class="hljs-type">int</span> targetSdk)</span> {

    <span class="hljs-keyword">if</span> (noteOp(AppOpsManager.OP_TAKE_AUDIO_FOCUS, callingUid, packageName, attributionTag)) {
        blocked = <span class="hljs-literal">false</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (targetSdk &lt; Build.VERSION_CODES.VANILLA_ICE_CREAM) {
        <span class="hljs-comment">// Build.VERSION_CODES.VANILLA_ICE_CREAM=35</span>
        <span class="hljs-comment">// å¦‚æœtargetSdk&lt;35,å…è®¸ç”³è¯·éŸ³é¢‘ç„¦ç‚¹</span>
        blocked = <span class="hljs-literal">false</span>;
        unblockedBySdk = <span class="hljs-literal">true</span>;
    }
    metricsLogFocusReq(blocked, focusReqType, callingUid, unblockedBySdk);
    <span class="hljs-keyword">if</span> (!blocked) {
        <span class="hljs-comment">// ä¸å…è®¸ç”³è¯·éŸ³é¢‘ç„¦ç‚¹</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-comment">// å…è®¸ç”³è¯·éŸ³é¢‘ç„¦ç‚¹</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h2 data-id="heading-2">è§£å†³æ–¹æ³•</h2>
<h3 data-id="heading-3">æ–¹æ³•ä¸€</h3>
<p>ç›´æ¥é™çº§targetSdkï¼Œæ”¹åˆ°35ä»¥ä¸‹</p>
<pre><code class="hljs language-ini" lang="ini">android {
    defaultConfig {
        <span class="hljs-attr">targetSdk</span> = <span class="hljs-number">34</span>
    }
}
</code></pre>
<h3 data-id="heading-4">æ–¹æ³•äºŒ</h3>
<p>åˆ›å»ºå‰å°Serviceæ¥ç”³è¯·éŸ³é¢‘ç„¦ç‚¹ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fbackground-work%2Fservices%2Ffgs%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/develop/background-work/services/fgs?hl=zh-cn" ref="nofollow noopener noreferrer">developer.android.com/develop/bacâ€¦</a></p>
<h3 data-id="heading-5">æ–¹æ³•ä¸‰</h3>
<p>æ·»åŠ MODIFY_AUDIO_ROUTINGæˆ–MODIFY_AUDIO_SETTINGS_PRIVILEGEDæƒé™ã€‚å¿…é¡»è¦æœ‰<em>ç³»ç»Ÿç­¾å</em>çš„åº”ç”¨æ‰èƒ½è·å–è¿™ä¸ªæƒé™ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.MODIFY_AUDIO_ROUTING"</span>/&gt;</span>
  <span class="hljs-comment">&lt;!-- &lt;uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS_PRIVILEGED"/&gt; --&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<p><code>AudioService</code>åœ¨ç”³è¯·éŸ³é¢‘ç„¦ç‚¹æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­æ˜¯å¦æœ‰è¿™ä¸ªæƒé™ã€‚å¦‚æœMODIFY_AUDIO_ROUTINGæˆ–MODIFY_AUDIO_SETTINGS_PRIVILEGEDï¼Œå°±ä¸ä¼šè°ƒç”¨<code>HardeningEnforcer.blockFocusMethod</code>ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šæ‹’ç»éŸ³é¢‘ç„¦ç‚¹äº†ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//frameworks/base/services/core/java/com/android/server/audio/AudioService.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">requestAudioFocus</span><span class="hljs-params">(AudioAttributes aa, <span class="hljs-type">int</span> focusReqType, IBinder cb,
                             IAudioFocusDispatcher fd, String clientId, String callingPackageName,
                             String attributionTag, <span class="hljs-type">int</span> flags, IAudioPolicyCallback pcb, <span class="hljs-type">int</span> sdk)</span> {

    <span class="hljs-comment">// æ£€æŸ¥ç”³è¯·éŸ³é¢‘ç„¦ç‚¹çš„appæ˜¯å¦æœ‰æƒé™ç»•è¿‡HardeningEnforcer</span>
    <span class="hljs-comment">// does caller have system privileges to bypass HardeningEnforcer</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">permissionOverridesCheck</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> ((mContext.checkCallingOrSelfPermission(MODIFY_AUDIO_SETTINGS_PRIVILEGED)
         == PackageManager.PERMISSION_GRANTED)
        || (mContext.checkCallingOrSelfPermission(MODIFY_AUDIO_ROUTING)
            == PackageManager.PERMISSION_GRANTED)) {
        permissionOverridesCheck = <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (uid &lt; UserHandle.AID_APP_START) {
        permissionOverridesCheck = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (permissionOverridesCheck) {
            mHardeningEnforcer.metricsLogFocusReq(<span class="hljs-comment">/*blocked*/</span> <span class="hljs-literal">false</span>, focusReqType, uid,
                                                  <span class="hljs-comment">/*unblockedBySdk*/</span> <span class="hljs-literal">false</span>);
        }
        <span class="hljs-keyword">if</span> (!permissionOverridesCheck &amp;&amp; mHardeningEnforcer.blockFocusMethod(uid,
                                                                             HardeningEnforcer.METHOD_AUDIO_MANAGER_REQUEST_AUDIO_FOCUS,
                                                                             clientId, focusReqType, callingPackageName, attributionTag, sdk)) {
            <span class="hljs-comment">// æ²¡æœ‰MODIFY_AUDIO_ROUTINGæƒé™ï¼Œå¹¶ä¸”blockFocusMethodè¿”å›falseï¼Œ</span>
            <span class="hljs-comment">// æ‰ä¼šç”³è¯·ç„¦ç‚¹å¤±è´¥</span>
            <span class="hljs-keyword">return</span> AudioManager.AUDIOFOCUS_REQUEST_FAILED;
        }
    } <span class="hljs-keyword">finally</span> {
        Binder.restoreCallingIdentity(token);
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AIå¤§æ¨¡å‹åŸç†å‰–æå’Œå®æˆ˜(ç¬¬å››éƒ¨åˆ†ï¼šåè®­ç»ƒä¸å¾®è°ƒ)]]></title>    <link>https://juejin.cn/post/7584472215975936015</link>    <guid>https://juejin.cn/post/7584472215975936015</guid>    <pubDate>2025-12-17T10:36:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584472215975936015" data-draft-id="7584653722593361972" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AIå¤§æ¨¡å‹åŸç†å‰–æå’Œå®æˆ˜(ç¬¬å››éƒ¨åˆ†ï¼šåè®­ç»ƒä¸å¾®è°ƒ)"/> <meta itemprop="keywords" content="LLM,AIGC"/> <meta itemprop="datePublished" content="2025-12-17T10:36:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="visnix"/> <meta itemprop="url" content="https://juejin.cn/user/606586149822990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AIå¤§æ¨¡å‹åŸç†å‰–æå’Œå®æˆ˜(ç¬¬å››éƒ¨åˆ†ï¼šåè®­ç»ƒä¸å¾®è°ƒ)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/606586149822990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    visnix
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:36:35.000Z" title="Wed Dec 17 2025 10:36:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬å››éƒ¨åˆ†ï¼šå¤§æ¨¡å‹åè®­ç»ƒä¸å¾®è°ƒ</h2>
<p><strong>æ‘˜è¦</strong>ï¼šæœ¬éƒ¨åˆ†èšç„¦äºå¦‚ä½•â€œå®šåˆ¶â€ä½ çš„å¤§æ¨¡å‹ã€‚æˆ‘ä»¬å°†å­¦ä¹  <strong>SFTï¼ˆæœ‰ç›‘ç£å¾®è°ƒï¼‰</strong> è®©æ¨¡å‹å¬æ‡‚æŒ‡ä»¤ï¼ŒæŒæ¡ <strong>LoRA</strong> æŠ€æœ¯ä»¥æä½æˆæœ¬é€‚é…å‚ç›´é¢†åŸŸï¼Œå¹¶æ·±å…¥ <strong>RLHFï¼ˆäººç±»åé¦ˆå¼ºåŒ–å­¦ä¹ ï¼‰</strong> çš„æ•°å­¦åŸç†ä¸ä»£ç å®ç°â€”â€”è¿™æ˜¯ DeepSeek-R1 ç­‰æ¨ç†æ¨¡å‹èƒ½äº§ç”Ÿå¼ºå¤§é€»è¾‘æ€ç»´çš„å…³é”®æŠ€æœ¯ã€‚</p>
<hr/>
<h3 data-id="heading-1">ç¬¬11ç«  ã€åè®­ç»ƒã€‘æœ‰ç›‘ç£å¾®è°ƒ (SFT)</h3>
<h4 data-id="heading-2">11.1 ä»€ä¹ˆæ˜¯ SFT (Supervised Fine-Tuning)ï¼Ÿ</h4>
<p>é¢„è®­ç»ƒæ¨¡å‹æœ¬è´¨ä¸Šæ˜¯ä¸ªâ€œç»­å†™æœºâ€ã€‚å¦‚æœä½ é—®å®ƒï¼šâ€œä¸­å›½çš„é¦–éƒ½åœ¨å“ªé‡Œï¼Ÿâ€ï¼Œå®ƒå¯èƒ½ä¼šç»­å†™ï¼šâ€œè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå¾ˆç®€å•...â€è€Œä¸æ˜¯ç›´æ¥å›ç­”â€œåŒ—äº¬â€ã€‚
SFT çš„ç›®çš„å°±æ˜¯é€šè¿‡ <code>(æŒ‡ä»¤, å›ç­”)</code> æ•°æ®å¯¹ï¼Œæ•™ä¼šæ¨¡å‹éµå¾ªå¯¹è¯æ ¼å¼ã€‚</p>
<ul>
<li><strong>æ•°æ®æ ¼å¼</strong>ï¼š
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"instruction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"è¯·è§£é‡Šé‡å­çº ç¼ ã€‚"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é‡å­çº ç¼ æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªç²’å­å¤„äºä¸€ç§çº ç¼ æ€..."</span>
<span class="hljs-punctuation">}</span>
</code></pre>
</li>
<li><strong>è®­ç»ƒå·®å¼‚</strong>ï¼š
<ul>
<li><strong>é¢„è®­ç»ƒ</strong>ï¼šå¯¹æ‰€æœ‰ Token è®¡ç®— Lossã€‚</li>
<li><strong>SFT</strong>ï¼šé€šå¸¸åªå¯¹ <strong>Outputï¼ˆå›ç­”éƒ¨åˆ†ï¼‰</strong> è®¡ç®— Lossï¼Œå¿½ç•¥ Instruction éƒ¨åˆ†ï¼ˆMaskingï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">11.2 å¼ºå¤§çš„å¾®è°ƒæ¡†æ¶ï¼šLLaMA-Factory</h4>
<p>æ‰‹å†™è®­ç»ƒå¾ªç¯è™½ç„¶æœ‰åŠ©äºç†è§£ï¼Œä½†åœ¨å·¥ç¨‹å®è·µä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨æˆç†Ÿæ¡†æ¶ã€‚<code>LLaMA-Factory</code> æ˜¯ç›®å‰æœ€æµè¡Œçš„å¼€æºå¾®è°ƒæ¡†æ¶ï¼Œæ”¯æŒ DeepSeekã€Qwenã€Llama ç­‰å‡ ä¹æ‰€æœ‰ä¸»æµæ¨¡å‹ã€‚</p>
<p><strong>ã€å®æˆ˜ã€‘ä½¿ç”¨ LLaMA-Factory è¿›è¡Œ LoRA å¾®è°ƒ</strong></p>
<ol>
<li>
<p><strong>å®‰è£…</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/hiyouga/LLaMA-Factory.git
<span class="hljs-built_in">cd</span> LLaMA-Factory
pip install -e .[metrics]
</code></pre>
</li>
<li>
<p><strong>å¯åŠ¨ Web UIï¼ˆå°ç™½å‹å¥½æ¨¡å¼ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">llamafactory-cli webui
</code></pre>
<ul>
<li>åœ¨ç½‘é¡µä¸­é€‰æ‹©æ¨¡å‹è·¯å¾„ï¼ˆå¦‚ <code>deepseek-llm-7b-chat</code>ï¼‰ã€‚</li>
<li>é€‰æ‹©å¾®è°ƒæ–¹æ³•ï¼ˆLoRAï¼‰ã€‚</li>
<li>é€‰æ‹©æ•°æ®é›†ï¼ˆå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„ json æ–‡ä»¶ï¼‰ã€‚</li>
<li>ç‚¹å‡»â€œå¼€å§‹è®­ç»ƒâ€ã€‚</li>
</ul>
</li>
<li>
<p><strong>å‘½ä»¤è¡Œå¯åŠ¨ï¼ˆæœåŠ¡å™¨æ¨¡å¼ï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">llamafactory-cli train \
    --stage sft \
    --do_train \
    --model_name_or_path deepseek-ai/deepseek-llm-7b-base \
    --dataset my_custom_data \
    --finetuning_type lora \
    --output_dir ./saves/deepseek_lora \
    --per_device_train_batch_size 4 \
    --gradient_accumulation_steps 4 \
    --lora_rank 8 \
    --fp16
</code></pre>
</li>
</ol>
<h4 data-id="heading-4">11.3 æ€ç»´é“¾ (CoT) æ•°æ®æ„é€ </h4>
<p>DeepSeek çš„å¼ºå¤§åœ¨äºæ¨ç†ã€‚æ™®é€š SFT æ•°æ®åªç»™ç»“æœï¼ŒCoT æ•°æ®ç»™è¿‡ç¨‹ã€‚</p>
<ul>
<li><strong>æ™®é€šæ•°æ®</strong>ï¼š<code>é—®ï¼š1+1ç­‰äºå‡ ï¼Ÿ ç­”ï¼š2</code></li>
<li><strong>CoT æ•°æ®</strong>ï¼š<code>é—®ï¼š1+1ç­‰äºå‡ ï¼Ÿ ç­”ï¼šæ€è€ƒè¿‡ç¨‹ï¼šè¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ç®—æœ¯åŠ æ³•ã€‚1ä»£è¡¨ä¸€ä¸ªå•ä½... ç»“è®ºï¼š2</code>
<strong>å®æˆ˜æŠ€å·§</strong>ï¼šåˆ©ç”¨ GPT-4 æˆ– DeepSeek-V3 ç”Ÿæˆå¸¦æœ‰ <code>&lt;thinking&gt;</code> æ ‡ç­¾çš„æ•°æ®æ¥è’¸é¦å°æ¨¡å‹ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">ç¬¬12ç«  ã€åè®­ç»ƒã€‘å‚æ•°é«˜æ•ˆå¾®è°ƒ (PEFT)</h3>
<p>å…¨å‚æ•°å¾®è°ƒï¼ˆFull Fine-tuningï¼‰éœ€è¦æ¶ˆè€—çš„æ˜¾å­˜æ˜¯æ¨ç†çš„ 4 å€ä»¥ä¸Šã€‚å¯¹äº 7B æ¨¡å‹ï¼Œå…¨å‚æ•°å¾®è°ƒè‡³å°‘éœ€è¦ 80GB A100ã€‚è€Œ PEFT è®©ä½ å¯ä»¥ç”¨ RTX 3090/4090 åœ¨å®¶å¾®è°ƒå¤§æ¨¡å‹ã€‚</p>
<h4 data-id="heading-6">12.1 LoRA (Low-Rank Adaptation) åŸç†ä¸å®æˆ˜</h4>
<p><strong>æ ¸å¿ƒåŸç†</strong>ï¼š
ä¸éœ€è¦æ›´æ–°å·¨å¤§çš„æƒé‡çŸ©é˜µ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span></span>ï¼ˆä¾‹å¦‚ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4096</mn><mo>Ã—</mo><mn>4096</mn></mrow><annotation encoding="application/x-tex">4096 \times 4096</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">4096</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">4096</span></span></span></span></span>ï¼‰ï¼Œè€Œæ˜¯å­¦ä¹ ä¸¤ä¸ªæå°çš„çŸ©é˜µ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span>ï¼ˆä¾‹å¦‚ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4096</mn><mo>Ã—</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">4096 \times 8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">4096</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">8</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mo>Ã—</mo><mn>4096</mn></mrow><annotation encoding="application/x-tex">8 \times 4096</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">8</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">4096</span></span></span></span></span>ï¼‰ã€‚
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>W</mi><mo mathvariant="normal" lspace="0em" rspace="0em">â€²</mo></msup><mo>=</mo><mi>W</mi><mo>+</mo><mi mathvariant="normal">Î”</mi><mi>W</mi><mo>=</mo><mi>W</mi><mo>+</mo><mi>A</mi><mo>Ã—</mo><mi>B</mi></mrow><annotation encoding="application/x-tex">W' = W + \Delta W = W + A \times B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7519em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">Î”</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span>
å…¶ä¸­ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></span> (rank) è¿œå°äº <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">d</span></span></span></span></span>ã€‚è®­ç»ƒæ—¶å†»ç»“ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span></span>ï¼Œåªæ›´æ–° <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span></span></span></span></span> å’Œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span></span>ã€‚</p>
<p><strong>ã€å®æˆ˜ã€‘æ‰‹æ’¸ LoRA å±‚é€»è¾‘ (PyTorch)</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn

<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoRALayer</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, in_dim, out_dim, rank=<span class="hljs-number">8</span>, alpha=<span class="hljs-number">16</span></span>):
        <span class="hljs-built_in">super</span>().__init__()
        <span class="hljs-comment"># 1. åŸå§‹çš„é¢„è®­ç»ƒæƒé‡ (å†»ç»“)</span>
        self.linear = nn.Linear(in_dim, out_dim, bias=<span class="hljs-literal">False</span>)
        self.linear.weight.requires_grad = <span class="hljs-literal">False</span> 
        
        <span class="hljs-comment"># 2. LoRA æ—è·¯çŸ©é˜µ (Aå’ŒB)</span>
        <span class="hljs-comment"># Bé€šå¸¸åˆå§‹åŒ–ä¸º0ï¼ŒAé«˜æ–¯åˆå§‹åŒ– -&gt; åˆå§‹çŠ¶æ€ä¸‹ LoRA ä¸å½±å“åŸæ¨¡å‹</span>
        self.lora_a = nn.Parameter(torch.randn(in_dim, rank) / rank)
        self.lora_b = nn.Parameter(torch.zeros(rank, out_dim))
        
        self.scaling = alpha / rank

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        <span class="hljs-comment"># åŸå§‹è·¯å¾„</span>
        original_out = self.linear(x)
        
        <span class="hljs-comment"># LoRA è·¯å¾„: x @ A @ B * scaling</span>
        <span class="hljs-comment"># æ³¨æ„ç»´åº¦åŒ¹é…: (Batch, in) @ (in, r) @ (r, out) -&gt; (Batch, out)</span>
        lora_out = (x @ self.lora_a @ self.lora_b) * self.scaling
        
        <span class="hljs-keyword">return</span> original_out + lora_out

<span class="hljs-comment"># æµ‹è¯•</span>
layer = LoRALayer(in_dim=<span class="hljs-number">1024</span>, out_dim=<span class="hljs-number">512</span>, rank=<span class="hljs-number">8</span>)
x = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">1024</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"LoRAè¾“å‡º: <span class="hljs-subst">{layer(x).shape}</span>"</span>) <span class="hljs-comment"># torch.Size([1, 512])</span>
</code></pre>
<h4 data-id="heading-7">12.2 QLoRA</h4>
<p>LoRA è§£å†³äº†å‚æ•°é‡é—®é¢˜ï¼Œä½†åŸæ¨¡å‹ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span></span> è¿˜è¦å æ˜¾å­˜ã€‚
<strong>QLoRA</strong>ï¼šå°† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span></span> é‡åŒ–ä¸º 4-bit åŠ è½½ï¼Œè¿›ä¸€æ­¥å°† 7B æ¨¡å‹çš„å¾®è°ƒé—¨æ§›é™ä½åˆ° 6GB æ˜¾å­˜ã€‚</p>
<hr/>
<h3 data-id="heading-8">ç¬¬13ç«  ã€åè®­ç»ƒã€‘å¼ºåŒ–å­¦ä¹ åŸºç¡€</h3>
<p>ä¸ºä»€ä¹ˆ SFT ä¸å¤Ÿï¼Ÿå› ä¸ºæœ‰äº›ä¸œè¥¿å¾ˆéš¾å†™å‡ºæ ‡å‡†ç­”æ¡ˆï¼ˆæ¯”å¦‚â€œå†™ä¸€ä¸ªå¥½ç¬‘çš„ç¬‘è¯â€ï¼‰ã€‚å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰å…è®¸æˆ‘ä»¬å®šä¹‰â€œä»€ä¹ˆæ˜¯å¥½çš„â€ï¼Œè®©æ¨¡å‹è‡ªå·±å»æ¢ç´¢å¦‚ä½•è¾¾åˆ°ã€‚</p>
<h4 data-id="heading-9">13.1 RL æ ¸å¿ƒæ¦‚å¿µæ˜ å°„</h4>
<ul>
<li><strong>Agent (æ™ºèƒ½ä½“)</strong>ï¼šå¤§æ¨¡å‹æœ¬èº«ã€‚</li>
<li><strong>Environment (ç¯å¢ƒ)</strong>ï¼šç”¨æˆ·ï¼ˆPromptï¼‰å’Œ å¥–åŠ±æ¨¡å‹ã€‚</li>
<li><strong>Action (åŠ¨ä½œ)</strong>ï¼šæ¨¡å‹ç”Ÿæˆçš„æ¯ä¸€ä¸ª Tokenã€‚</li>
<li><strong>State (çŠ¶æ€)</strong>ï¼šå½“å‰çš„ä¸Šä¸‹æ–‡ï¼ˆPrompt + å·²ç»ç”Ÿæˆçš„ Tokenï¼‰ã€‚</li>
<li><strong>Reward (å¥–åŠ±)</strong>ï¼šç”Ÿæˆçš„æ–‡æœ¬æœ‰å¤šå¥½ï¼ˆç”± Reward Model æ‰“åˆ†ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-10">13.2 ç­–ç•¥æ¢¯åº¦ (Policy Gradient)</h4>
<p>æˆ‘ä»¬è¦ä¼˜åŒ–çš„æ˜¯ç­–ç•¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï€</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span></span></span></span></span>ï¼ˆå³æ¨¡å‹å‚æ•°ï¼‰ï¼Œä½¿å¾—æœŸæœ›å¥–åŠ±æœ€å¤§åŒ–ã€‚
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ‡</mi><mi>J</mi><mo stretchy="false">(</mo><mi>Î¸</mi><mo stretchy="false">)</mo><mo>â‰ˆ</mo><mi mathvariant="double-struck">E</mi><mo stretchy="false">[</mo><mi mathvariant="normal">âˆ‡</mi><mi>log</mi><mo>â¡</mo><msub><mi>Ï€</mi><mi>Î¸</mi></msub><mo stretchy="false">(</mo><mi>a</mi><mi mathvariant="normal">âˆ£</mi><mi>s</mi><mo stretchy="false">)</mo><mo>â‹…</mo><mi>R</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\nabla J(\theta) \approx \mathbb{E} [\nabla \log \pi_\theta(a|s) \cdot R]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">âˆ‡</span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">Î¸</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">â‰ˆ</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathbb">E</span><span class="mopen">[</span><span class="mord">âˆ‡</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">Ï€</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">Î¸</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mord">âˆ£</span><span class="mord mathnormal">s</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mclose">]</span></span></span></span></span>
é€šä¿—ç†è§£ï¼šå¦‚æœåŠ¨ä½œ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span></span></span></span></span> è·å¾—äº†é«˜åˆ† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span></span>ï¼Œå°±å¢åŠ äº§ç”Ÿ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"/><span class="mord mathnormal">a</span></span></span></span></span> çš„æ¦‚ç‡ï¼›å¦‚æœåˆ†ä½ï¼Œå°±é™ä½æ¦‚ç‡ã€‚</p>
<hr/>
<h3 data-id="heading-11">ç¬¬14ç«  ã€åè®­ç»ƒã€‘äººç±»åé¦ˆå¼å¼ºåŒ–å­¦ä¹  (RLHF)</h3>
<p>è¿™æ˜¯ ChatGPT å’Œ DeepSeek-R1 èƒ½å¤Ÿå®ç°é€»è¾‘é£è·ƒçš„å…³é”®ã€‚</p>
<h4 data-id="heading-12">14.1 RLHF ä¸‰é˜¶æ®µæµæ°´çº¿</h4>
<ol>
<li><strong>SFT</strong>ï¼šå…ˆè®­ç»ƒä¸€ä¸ªç¨å¾®æ‡‚äº‹çš„æ¨¡å‹ï¼ˆå¦‚æœä¸æ‡‚äº‹ï¼ŒRL å¾ˆéš¾æ¢ç´¢å‡ºæ¥ï¼‰ã€‚</li>
<li><strong>Reward Model (RM) è®­ç»ƒ</strong>ï¼š
<ul>
<li>äººå·¥æ ‡æ³¨ï¼šç»™æ¨¡å‹çš„ä¸¤ä¸ªå›ç­”æ’åºï¼ˆA æ¯” B å¥½ï¼‰ã€‚</li>
<li>è®­ç»ƒ RMï¼šè®© RM ç»™ A çš„æ‰“åˆ†æ¯” B é«˜ã€‚</li>
<li>æŸå¤±å‡½æ•°ï¼šPairwise Ranking Lossã€‚</li>
</ul>
</li>
<li><strong>PPO (Proximal Policy Optimization) è®­ç»ƒ</strong>ï¼š
<ul>
<li>ç”¨ RM ç»™æ¨¡å‹ç”Ÿæˆçš„å›ç­”æ‰“åˆ†ã€‚</li>
<li>ç”¨ PPO ç®—æ³•æ›´æ–°æ¨¡å‹å‚æ•°ã€‚</li>
</ul>
</li>
</ol>
<h4 data-id="heading-13">14.2 æ·±å…¥ PPO ç®—æ³•ä¸ KL æ•£åº¦</h4>
<p>åœ¨å¼ºåŒ–å­¦ä¹ ä¸­ï¼Œä¸ºäº†é˜²æ­¢æ¨¡å‹ä¸ºäº†æ‹¿é«˜åˆ†è€Œâ€œèƒ¡è¨€ä¹±è¯­â€ï¼ˆHacking the rewardï¼‰ï¼Œæˆ‘ä»¬éœ€è¦çº¦æŸå®ƒä¸èƒ½åç¦»åŸå§‹ SFT æ¨¡å‹å¤ªè¿œã€‚
è¿™å°±æ˜¯ <strong>KL æ•£åº¦ (KL Divergence)</strong> çš„ä½œç”¨ã€‚</p>
<p><strong>æ€»å¥–åŠ±è®¡ç®—å…¬å¼</strong>ï¼š
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>=</mo><msub><mi>R</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>âˆ’</mo><mi>Î²</mi><mo>â‹…</mo><mi>log</mi><mo>â¡</mo><mfrac><mrow><msub><mi>Ï€</mi><mrow><mi>R</mi><mi>L</mi></mrow></msub><mo stretchy="false">(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><msub><mi>Ï€</mi><mrow><mi>S</mi><mi>F</mi><mi>T</mi></mrow></msub><mo stretchy="false">(</mo><mi>y</mi><mi mathvariant="normal">âˆ£</mi><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">R_{total} = R_{model}(x, y) - \beta \cdot \log \frac{\pi_{RL}(y|x)}{\pi_{SFT}(y|x)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Ï€</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">SFT</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span/></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mord mtight">âˆ£</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">Ï€</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span/></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span><span class="mord mtight">âˆ£</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow><annotation encoding="application/x-tex">R_{model}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>ï¼šå¥–åŠ±æ¨¡å‹ç»™çš„åˆ†ã€‚</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î²</mi><mo>â‹…</mo><mi>log</mi><mo>â¡</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\beta \cdot \log ...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">...</span></span></span></span></span>ï¼šKL æƒ©ç½šé¡¹ã€‚å¦‚æœ RL æ¨¡å‹ç”Ÿæˆçš„æ¦‚ç‡åˆ†å¸ƒå’Œ SFT å·®å¤ªå¤šï¼Œå°±æ‰£åˆ†ã€‚</li>
</ul>
<p><strong>ã€å®æˆ˜ã€‘æ‰‹æ’¸ Reward Model è¯„åˆ†ä»£ç ç‰‡æ®µ</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForSequenceClassification, AutoTokenizer
<span class="hljs-keyword">import</span> torch

<span class="hljs-comment"># åŠ è½½å¥–åŠ±æ¨¡å‹ (é€šå¸¸åŸºäº BERT æˆ– Llama ä¿®æ”¹äº†æœ€åä¸€å±‚)</span>
rm_model_name = <span class="hljs-string">"deepseek-ai/deepseek-reward-model-dummy"</span> <span class="hljs-comment"># ä¼ªä»£ç ç¤ºä¾‹</span>
<span class="hljs-comment"># model = AutoModelForSequenceClassification.from_pretrained(rm_model_name, num_labels=1)</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_reward_score</span>(<span class="hljs-params">prompt, response</span>):
    <span class="hljs-comment"># æ„é€ è¾“å…¥: [CLS] Prompt [SEP] Response [SEP]</span>
    text = <span class="hljs-string">f"<span class="hljs-subst">{prompt}</span> <span class="hljs-subst">{response}</span>"</span>
    inputs = tokenizer(text, return_tensors=<span class="hljs-string">"pt"</span>)
    
    <span class="hljs-keyword">with</span> torch.no_grad():
        <span class="hljs-comment"># è¾“å‡ºæ˜¯ä¸€ä¸ªæ ‡é‡åˆ†æ•°</span>
        score = model(**inputs).logits[<span class="hljs-number">0</span>].item()
    <span class="hljs-keyword">return</span> score

<span class="hljs-comment"># ç¤ºä¾‹</span>
prompt = <span class="hljs-string">"å¦‚ä½•å­¦å¥½Python?"</span>
res_A = <span class="hljs-string">"å¤šå†™ä»£ç ï¼Œå¤šçœ‹æºç ã€‚"</span> <span class="hljs-comment"># å¥½å›ç­”</span>
res_B = <span class="hljs-string">"å»ç¡è§‰å§ã€‚"</span> <span class="hljs-comment"># åå›ç­”</span>

<span class="hljs-comment"># print(f"Aå¾—åˆ†: {get_reward_score(prompt, res_A)}")</span>
<span class="hljs-comment"># print(f"Bå¾—åˆ†: {get_reward_score(prompt, res_B)}")</span>
</code></pre>
<h4 data-id="heading-14">14.3 DeepSeek çš„ GRPO (Group Relative Policy Optimization)</h4>
<p><strong>DeepSeek-R1 çš„åˆ›æ–°</strong>ï¼š
ä¼ ç»Ÿçš„ PPO éœ€è¦ä¸€ä¸ªå·¨å¤§çš„ Critic æ¨¡å‹ï¼ˆå’Œ Actor ä¸€æ ·å¤§ï¼‰ï¼Œæ˜¾å­˜å ç”¨ç¿»å€ã€‚
DeepSeek æå‡ºäº† <strong>GRPO</strong>ï¼š</p>
<ul>
<li>ä¸éœ€è¦ Critic æ¨¡å‹ã€‚</li>
<li>å¯¹åŒä¸€ä¸ª Prompt ç”Ÿæˆä¸€ç»„ï¼ˆGroupï¼‰å›ç­”ã€‚</li>
<li>è®¡ç®—è¿™ç»„å›ç­”çš„å¹³å‡å¥–åŠ±ï¼Œä»¥ç›¸å¯¹ä¼˜åŠ£ä½œä¸ºä¼˜åŠ¿å‡½æ•°ï¼ˆAdvantageï¼‰ã€‚</li>
<li><strong>æ•ˆæœ</strong>ï¼šæå¤§é™ä½äº† RLHF çš„è®¡ç®—èµ„æºæ¶ˆè€—ï¼Œä½¿å¾—å¤§è§„æ¨¡å¼ºåŒ–å­¦ä¹ æˆä¸ºå¯èƒ½ã€‚æˆ‘ä»¬å°†åœ¨ç¬¬16ç« è¯¦ç»†å®æˆ˜ GRPOã€‚</li>
</ul>
<hr/>
<p><strong>ç¬¬å››éƒ¨åˆ†æ€»ç»“</strong>ï¼š
å¦‚æœè¯´é¢„è®­ç»ƒæ˜¯â€œä¹å¹´ä¹‰åŠ¡æ•™è‚²â€ï¼Œåè®­ç»ƒå°±æ˜¯â€œå¤§å­¦ä¸“ä¸šè¯¾â€ã€‚é€šè¿‡æœ¬éƒ¨åˆ†ï¼Œä½ æŒæ¡äº† SFT æ¥è§„èŒƒæ¨¡å‹è¾“å‡ºï¼Œåˆ©ç”¨ LoRA/QLoRA é™ä½å¾®è°ƒæˆæœ¬ï¼Œå¹¶åˆæ­¥è§¦è¾¾äº†è®©æ¨¡å‹äº§ç”Ÿé«˜çº§æ™ºèƒ½çš„ RLHF/PPO æŠ€æœ¯ã€‚</p>
<p><strong>ä¸‹æœŸé¢„å‘Š</strong>ï¼š
ä¸‹ä¸€éƒ¨åˆ†æˆ‘ä»¬å°†æ·±å…¥è§£å¯† <strong>DeepSeek çš„æ ¸å¿ƒé»‘ç§‘æŠ€</strong>â€”â€”<strong>ç¬¬äº”éƒ¨åˆ†ï¼šDeepSeekæ ¸å¿ƒæŠ€æœ¯è§£å¯†ä¸é€»è¾‘æ¨ç†</strong>ã€‚æˆ‘ä»¬å°†è¯¦ç»†å‰–æ <strong>MLA (å¤šå¤´æ½œåœ¨æ³¨æ„åŠ›)</strong> å¦‚ä½•å‹ç¼© KV Cacheï¼Œä»¥åŠ <strong>DeepSeek-R1</strong> æ˜¯å¦‚ä½•é€šè¿‡çº¯å¼ºåŒ–å­¦ä¹ æ¶Œç°å‡ºæ€ç»´é“¾ï¼ˆChain-of-Thoughtï¼‰èƒ½åŠ›çš„ï¼Œå¹¶æ‰‹æŠŠæ‰‹å¸¦ä½ å¤ç° GRPO ç®—æ³•ã€‚æ•¬è¯·æœŸå¾…ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangGraph1.0é€Ÿé€šæŒ‡å—ï¼ˆä¸€ï¼‰â€”â€” LangGraph1.0 æ ¸å¿ƒæ¦‚å¿µã€ç‚¹ã€è¾¹]]></title>    <link>https://juejin.cn/post/7584689488770252835</link>    <guid>https://juejin.cn/post/7584689488770252835</guid>    <pubDate>2025-12-18T00:10:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584689488770252835" data-draft-id="7583980250734460991" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangGraph1.0é€Ÿé€šæŒ‡å—ï¼ˆä¸€ï¼‰â€”â€” LangGraph1.0 æ ¸å¿ƒæ¦‚å¿µã€ç‚¹ã€è¾¹"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,LangChain,Agent"/> <meta itemprop="datePublished" content="2025-12-18T00:10:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ¨¡å‹çœŸå¥½ç©"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangGraph1.0é€Ÿé€šæŒ‡å—ï¼ˆä¸€ï¼‰â€”â€” LangGraph1.0 æ ¸å¿ƒæ¦‚å¿µã€ç‚¹ã€è¾¹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ¨¡å‹çœŸå¥½ç©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:10:55.000Z" title="Thu Dec 18 2025 00:10:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨ä¹‹å‰çš„ç³»åˆ—ä¸­ï¼Œç¬”è€…å·²ç»ç³»ç»Ÿæ¢³ç†äº†Â <a href="https://juejin.cn/post/7567301894648004648" target="_blank" title="https://juejin.cn/post/7567301894648004648">LangChain 1.0 çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹</a>ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªÂ <a href="https://juejin.cn/post/7572836557142491136" target="_blank" title="https://juejin.cn/post/7572836557142491136">å¤šæ¨¡æ€ RAG é¡¹ç›®</a>Â å¸¦é¢†å¤§å®¶å®è·µäº† LangChain 1.0 çš„å…³é”®æŠ€æœ¯ã€‚ä»æœ¬ç¯‡å¼€å§‹ï¼Œç¬”è€…å°†ä¸ºå¤§å®¶è¿›ä¸€æ­¥åˆ†äº«Â <strong>LangGraph 1.0</strong>Â çš„ç›¸å…³çŸ¥è¯†ã€‚ä¸ LangChain 1.0 ç›¸æ¯”ï¼ŒLangGraph 1.0 çš„æ•´ä½“æ¶æ„å˜åŠ¨ä¸å¤§ï¼Œä½†å…¶å®šä½å‘ç”Ÿäº†é‡è¦è½¬å˜ï¼šåœ¨ 1.0 ç‰ˆæœ¬ä¹‹åï¼Œ<strong>LangGraph ä¸å†æ˜¯ LangChain çš„èƒ½åŠ›å»¶ä¼¸ï¼Œè€Œæ˜¯æˆä¸º LangChain çš„èƒ½åŠ›åº•åº§</strong>ã€‚å®ƒé€šè¿‡çµæ´»çš„çŠ¶æ€ç®¡ç†ã€â€œç‚¹â€ä¸â€œè¾¹â€çš„æŠ½è±¡ã€è®°å¿†æœºåˆ¶ä»¥åŠâ€œäººåœ¨å›è·¯â€çš„é«˜æ•ˆæ§åˆ¶ï¼Œç‰¹åˆ«é€‚åˆæ„å»ºç²¾ç»†åŒ–ã€å¯ç¼–æ’çš„å·¥ä½œæµã€‚</p>
<p>ä»æœ¬æœŸå¼€å§‹ç¬”è€…å°†é€æ­¥ä»‹ç» LangGraph 1.0 çš„è¿™äº›æ ¸å¿ƒç‰¹æ€§ï¼Œå¹¶æœ€ç»ˆä½¿ç”¨ LangGraph æ­å»ºä¸€ä¸ªÂ <strong>é‚®ä»¶è‡ªåŠ¨å›å¤å·¥å…·æµ</strong>ã€‚æœ¬æœŸå…ˆä»åŸºç¡€å…¥æ‰‹ï¼Œè®²è§£Â <strong>LangGraph 1.0 çš„æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼Œé‡ç‚¹è§£æÂ  <strong>â€œç‚¹â€ä¸â€œè¾¹â€</strong> Â çš„è®¾è®¡ä¸ä½¿ç”¨ã€‚</p>
<p>LangGraph1.0 ä¸å…ˆå‰ç‰ˆæœ¬å˜åŠ¨ä¸å¤§ï¼Œé¢„è®¡èŠ±è´¹ä¸‰èŠ‚å·¦å³çš„æ—¶é—´è®²è§£ï¼ŒåŒæ—¶ä¹Ÿè¦è¯´æ˜ç¬”è€…çš„ä¸“æ <a href="https://juejin.cn/column/7526240014499495972" target="_blank" title="https://juejin.cn/column/7526240014499495972">ã€Šæ·±å…¥æµ…å‡ºLangChain&amp;LangGraph AI Agent æ™ºèƒ½ä½“å¼€å‘ã€‹</a>é€‚åˆæ‰€æœ‰å¯¹ LangChain æ„Ÿå…´è¶£çš„å­¦ä¹ è€…ï¼Œæ— è®ºä¹‹å‰æ˜¯å¦æ¥è§¦è¿‡ LangChainã€‚è¯¥ä¸“æ åŸºäºç¬”è€…åœ¨å®é™…é¡¹ç›®ä¸­çš„æ·±åº¦ä½¿ç”¨ç»éªŒï¼Œç³»ç»Ÿè®²è§£äº†ä½¿ç”¨LangChain/LangGraphå¦‚ä½•å¼€å‘æ™ºèƒ½ä½“ï¼Œç›®å‰å·²æ›´æ–° 30 è®²ï¼Œå¹¶æŒç»­è¡¥å……å®æˆ˜ä¸æ‹“å±•å†…å®¹ã€‚æ¬¢è¿æ„Ÿå…´è¶£çš„åŒå­¦å…³æ³¨ç¬”è€…çš„æ˜é‡‘è´¦å·ä¸ä¸“æ ï¼Œä¹Ÿå¯å…³æ³¨ç¬”è€…çš„åŒåå¾®ä¿¡å…¬ä¼—å·Â <strong>å¤§æ¨¡å‹çœŸå¥½ç©</strong>ï¼Œæ¯æœŸåˆ†äº«æ¶‰åŠçš„ä»£ç å‡å¯åœ¨å…¬ä¼—å·ç§ä¿¡:Â <strong>LangChainæ™ºèƒ½ä½“å¼€å‘</strong>å…è´¹è·å–ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€LangGraph æ ¸å¿ƒç‰¹æ€§</h2>
<p>LangGraph æ˜¯ä¸€ä¸ªæå…¶çµæ´»çš„æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒè®¾è®¡ç†å¿µå¯ä»¥æ¦‚æ‹¬ä¸ºï¼š<strong>å®ƒæ˜¯ä¸€ç§ç”¨äºæ„å»ºæ™ºèƒ½ä½“çš„â€œç¼–ç¨‹è¯­è¨€â€</strong> ã€‚</p>
<p>å¦‚åŒä»»ä½•ç¼–ç¨‹è¯­è¨€éƒ½åŒ…å«æ•°æ®ã€å‡½æ•°ã€æ§åˆ¶æµç­‰åŸºæœ¬è¦ç´ ä¸€æ ·ï¼ŒLangGraph ä¹Ÿæä¾›äº†åŠŸèƒ½å¯¹ç­‰çš„æŠ½è±¡ç»„ä»¶ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿä»¥å£°æ˜å¼çš„æ–¹å¼ç¼–æ’æ™ºèƒ½ä½“å·¥ä½œæµã€‚å…¶æ ¸å¿ƒç‰¹æ€§çš„å¯¹åº”å…³ç³»å¦‚ä¸‹ï¼š</p>



































<table><thead><tr><th>ç¼–ç¨‹è¯­è¨€è¦ç´ </th><th>LangGraph å¯¹åº”æ¦‚å¿µ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ•°æ® (Data)</strong></td><td><strong>çŠ¶æ€ (State)</strong></td><td>å·¥ä½œæµæ‰§è¡Œè¿‡ç¨‹ä¸­ä¼ é€’å’Œæ›´æ–°çš„ä¿¡æ¯è½½ä½“ã€‚</td></tr><tr><td><strong>å‡½æ•° (Function)</strong></td><td><strong>èŠ‚ç‚¹ (Node)</strong></td><td>å¯¹çŠ¶æ€è¿›è¡Œæ“ä½œï¼ˆå¦‚è°ƒç”¨æ¨¡å‹ã€æ‰§è¡Œå·¥å…·ï¼‰çš„åŸºæœ¬å•å…ƒã€‚</td></tr><tr><td><strong>æ§åˆ¶é€»è¾‘ (Control Flow)</strong></td><td><strong>è¾¹ (Edge)</strong></td><td>å†³å®šèŠ‚ç‚¹é—´æ‰§è¡Œé¡ºåºçš„é€»è¾‘ï¼Œå¯ä»¥æ˜¯<strong>æ¡ä»¶åˆ†æ”¯</strong>æˆ–<strong>é™æ€è·¯å¾„</strong>ï¼Œæ”¯æŒä¸²è¡Œä¸å¹¶è¡Œã€‚</td></tr><tr><td><strong>å­˜å‚¨ (Storage)</strong></td><td><strong>æ£€æŸ¥ç‚¹ / è®°å¿† (Checkpointing / Memory)</strong></td><td>çŠ¶æ€çš„æŒä¹…åŒ–æœºåˆ¶ï¼Œå…è®¸å·¥ä½œæµæš‚åœã€æ¢å¤æˆ–å…·æœ‰é•¿æœŸè®°å¿†ã€‚</td></tr><tr><td><strong>ä¸­æ–­ (Interrupt)</strong></td><td><strong>äººåœ¨å›è·¯ (Human-in-the-Loop)</strong></td><td>é€šè¿‡ä¸­æ–­æ§åˆ¶æµï¼Œåœ¨å…³é”®ç¯èŠ‚å¼•å…¥äººå·¥å®¡æ ¸æˆ–å¹²é¢„çš„èƒ½åŠ›ã€‚</td></tr></tbody></table>
<p>é€šè¿‡ä»¥ä¸Šç»„ä»¶ï¼ŒLangGraph ä½¿å¾—æ„å»ºä¸€ä¸ªå…·å¤‡å¤æ‚é€»è¾‘ã€å¯æŒç»­è¿è¡Œä¸”æ”¯æŒäººæœºåä½œçš„æ™ºèƒ½ä½“ç³»ç»Ÿå˜å¾—ç›´è§‚ä¸”é«˜æ•ˆã€‚</p>
<h2 data-id="heading-2">äºŒã€çŠ¶æ€Stateå’ŒèŠ‚ç‚¹Node</h2>
<h3 data-id="heading-3">2.1 çŠ¶æ€State</h3>
<p>LangGraphæ˜¯ä¸€ä¸ªçŠ¶æ€å›¾ï¼ŒçŠ¶æ€å¯ä»¥ç†è§£ä¸ºå›¾çš„æ•°æ®ã€‚åœ¨å®šä¹‰å›¾ä¹‹å‰é¦–å…ˆåº”è¯¥å®šä¹‰ä¸€ä¸ªçŠ¶æ€ä½œä¸ºåˆå§‹å€¼ï¼Œåœ¨å›¾çš„æ›´æ–°è¿‡ç¨‹ä¸­çŠ¶æ€å€¼æ˜¯å¯ä»¥è¢«å›¾æ›´æ–°å¹¶è¿”å›ç»™ç”¨æˆ·çš„ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29734f786fdf4e659924befbc507ebd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=LiAKCXBNQikqkB2TIwaxg0Q9FRc%3D" alt="0.png" width="30%" loading="lazy"/></p>
<p>å›¾æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ï¼Œåœ¨å®šä¹‰å›¾æ—¶ï¼Œé¦–å…ˆè¦å®šä¹‰å›¾å°†æ“ä½œçš„çŠ¶æ€ã€‚è¿™ä¸ªçŠ¶æ€ç”±å›¾ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å…±äº«ã€‚çŠ¶æ€é€šå¸¸æ˜¯ä¸€ä¸ªPythonæ•°æ®ç»“æ„ã€‚å®šä¹‰çŠ¶æ€çš„æ–¹å¼å¯ä»¥é‡‡ç”¨ç±»å‹åŒ–å­—å…¸ã€‚æ¯”å¦‚ä¸‹é¢ä»£ç å°±å®šä¹‰äº†åŒ…å«åä¸º<code>nList</code>å­—ç¬¦ä¸²åˆ—è¡¨çš„çŠ¶æ€å€¼ã€‚å½“å›¾è¢«è°ƒç”¨æ—¶ï¼ŒçŠ¶æ€ä¼šè¢«åˆå§‹åŒ–ï¼ŒLangGraphè¿è¡Œæ—¶ä¼šé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹æ¥æ‰§è¡Œï¼Œç„¶åå®ƒä¼šæä¾›å½“å‰çŠ¶æ€ï¼Œè¿è¡ŒèŠ‚ç‚¹ï¼Œæœ€åæ›´æ–°çŠ¶æ€å†åˆ°ç»“æŸã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    nlist: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]
</code></pre>
<h3 data-id="heading-4">2.2 èŠ‚ç‚¹</h3>
<p>åœ¨LangGraphä¸­ï¼ŒèŠ‚ç‚¹çš„æœ¬è´¨æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚èŠ‚ç‚¹å‡½æ•°çš„è¾“å…¥å‚æ•°æ˜¯çŠ¶æ€ï¼Œè¾“å‡ºåˆ™æ˜¯å¯¹çŠ¶æ€çš„æ›´æ–°ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">node_a</span>(<span class="hljs-params">state: State</span>):
    ...
    <span class="hljs-keyword">return</span> ({<span class="hljs-string">"nlist"</span>:[note]})
</code></pre>
<p>ä»¥ä¸ŠèŠ‚ç‚¹å‡½æ•°æ‰§è¡Œå®Œæˆåä¼šå¯¹å­—ç¬¦ä¸²åˆ—è¡¨è¿›è¡Œæ›´æ–°ã€‚State å¯ä»¥è¢«æŒä¹…åŒ–ï¼ˆé€šè¿‡ Checkpointing æœºåˆ¶ï¼‰ã€‚è¿™æ„å‘³ç€å¦‚æœèŠ‚ç‚¹æ‰§è¡Œå¤±è´¥æˆ–å·¥ä½œæµè¢«ä¸­æ–­ï¼Œå¯ä»¥ä»ä¸Šä¸€ä¸ªæ£€æŸ¥ç‚¹æ¢å¤çŠ¶æ€é‡æ–°è¿è¡Œï¼Œä¿è¯äº†å·¥ä½œæµçš„é²æ£’æ€§ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efe406695db94be68c276d0910b483cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=dvYK0Nmfkq5FOBoRBiPhifKf36w%3D" alt="1.png" width="50%" loading="lazy"/></p>
<h3 data-id="heading-5">2.3 ä½¿ç”¨LangGraphæ„å»ºç®€å•å›¾</h3>
<p>ä¸‹é¢ç¬”è€…é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„ä»£ç ç¤ºä¾‹ï¼Œå°† State å’Œ Node çš„æ¦‚å¿µä¸²è”èµ·æ¥ï¼Œæ„å»ºä¸€ä¸ªæœ€ç®€å•çš„å•èŠ‚ç‚¹å›¾ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·å¤§å®¶ç¡®ä¿å·²ç»å®‰è£…äº†langgraphç›¸å…³ç¯å¢ƒã€‚å¦‚æœªå®‰è£…ï¼Œå¯ä»¥è¿è¡ŒÂ <code>pip install -U langgraph</code>å‘½ä»¤ã€‚</p>
<ol>
<li>
<p>å¯¼å…¥ä¾èµ–åº“</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> START, END, StateGraph
</code></pre>
</li>
<li>
<p>åˆ›å»ºå›¾è¡¨çš„ç¬¬ä¸€æ­¥æ˜¯å®šä¹‰ä¸€ä¸ª<strong>State</strong>ç±»ï¼Œç±»å‹æ˜¯å­—å…¸ã€‚å®ƒåŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„åˆ—è¡¨,çŠ¶æ€å¯ä»¥æ˜¯ä¸€ä¸ªPythonæ•°æ®ç±»ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªPydanticåŸºç±»æ¨¡å‹ï¼Œå…³äºpydanticçš„ä½¿ç”¨å¤§å®¶å¯ä»¥å‚è€ƒç¬”è€…çš„æ–‡ç« : <a href="https://juejin.cn/post/7551665834499899444#heading-6" target="_blank" title="https://juejin.cn/post/7551665834499899444#heading-6">æ·±å…¥æµ…å‡ºLangGraph AI Agentæ™ºèƒ½ä½“å¼€å‘æ•™ç¨‹ï¼ˆå…­ï¼‰â€”LangGraph åº•å±‚APIå…¥é—¨</a>, ä¹Ÿå¯æŸ¥çœ‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fpydantic.com.cn%2F" target="_blank" title="https://pydantic.com.cn/" ref="nofollow noopener noreferrer">pydanticå®˜æ–¹æ–‡æ¡£</a>ï¼Œ è¿™é‡Œä¸åŠ èµ˜è¿°äº†ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    nList: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]
</code></pre>
</li>
<li>
<p>å®šä¹‰èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å®é™…ä¸Šå°±æ˜¯Pythonå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶çŠ¶æ€ï¼Œæ‰“å°ä¿¡æ¯ç„¶åè¿”å›çŠ¶æ€çš„æ›´æ–°ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">node_a</span>(<span class="hljs-params">state</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"noda_aæ¥æ”¶åˆ°<span class="hljs-subst">{state[<span class="hljs-string">'nList'</span>]}</span>"</span>)
    note = <span class="hljs-string">"Hello, æˆ‘æ˜¯èŠ‚ç‚¹a"</span>
    <span class="hljs-keyword">return</span>(State(nList=[note]))
</code></pre>
</li>
<li>
<p>ç¼–è¯‘çŠ¶æ€å›¾ï¼Œå°†èŠ‚ç‚¹åŠ å…¥åˆ°å›¾ä¸­ï¼Œå®šä¹‰ä¸º"a"èŠ‚ç‚¹ï¼ŒåŒæ—¶æ·»åŠ ä»STARTèŠ‚ç‚¹åˆ°"a"èŠ‚ç‚¹çš„è¾¹ï¼Œç„¶åæ·»åŠ ä»"a"åˆ°ENDçš„è¾¹ã€‚è¿™é‡Œçš„STARTå’ŒENDéƒ½æ˜¯LangGraphå®šä¹‰çš„å¸¸é‡èŠ‚ç‚¹ï¼Œä»…åŒ…å«è¯­ä¹‰ä¿¡æ¯ã€‚æœ€åç¼–è¯‘å›¾</p>
<pre><code class="hljs language-python" lang="python">builder = StateGraph(State)
builder.add_node(<span class="hljs-string">"a"</span>, node_a)
builder.add_edge(START, <span class="hljs-string">"a"</span>)
builder.add_edge(<span class="hljs-string">"a"</span>, END)
graph = builder.<span class="hljs-built_in">compile</span>()
</code></pre>
<p>ä»¥ä¸Šä»£ç æ„å»ºäº†ä¸€ä¸ªå¦‚ä¸‹çš„ç®€å•å›¾ã€‚</p>
</li>
</ol>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d12cc1a68fc4422be3d511bfc6a0bc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=oN%2BDrwFIByZcN%2BjPocOW%2B%2FsnNY4%3D" alt="2.png" width="30%" loading="lazy"/></p>
<ol start="5">
<li>æ¥ä¸‹æ¥æµ‹è¯•è¿™ä¸ªå›¾ï¼Œé¦–å…ˆä½¿ç”¨Stateåˆå§‹åŒ–ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼Œç„¶åé€šè¿‡<code>.invoke</code>æ–¹æ³•è¿è¡Œå›¾ã€‚å¯ä»¥çœ‹åˆ°èŠ‚ç‚¹Aæ¥æ”¶äº†åˆå§‹çŠ¶æ€ï¼Œç„¶åå½“è°ƒç”¨å›¾å®Œæˆåè¿”å›äº†æ›´æ–°åçš„çŠ¶æ€ã€‚
<pre><code class="hljs language-python" lang="python">initial_state = State(
    nList=[<span class="hljs-string">"Hello Node a, how are you?"</span>]
)
<span class="hljs-built_in">print</span>(graph.invoke(initial_state))
</code></pre>
</li>
</ol>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6e0f755a2c14b18993db2bf0174aa00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=s9wt%2FbmroUD%2Bogrey4ZexWuu%2F%2Bk%3D" alt="15.png" loading="lazy"/></p>
<p>é€šè¿‡ä»¥ä¸Šæ¡ˆä¾‹å¤§å®¶åº”è¯¥å¯ä»¥ç†è§£åœ¨å®šä¹‰å›¾å’ŒçŠ¶æ€æ—¶ï¼Œå›¾ä¸­æ‰€æœ‰èŠ‚ç‚¹å¯ä»¥å…±äº«ç›¸åŒçš„çŠ¶æ€ã€‚</p>
<h2 data-id="heading-6">ä¸‰ã€è¾¹</h2>
<p>åœ¨å®šä¹‰äº†â€œæ•°æ®â€ï¼ˆStateï¼‰å’Œâ€œæ“ä½œâ€ï¼ˆNodeï¼‰ä¹‹åï¼Œç¬”è€…æ¥ä¸‹æ¥ä»‹ç»<strong>è¾¹</strong>ã€‚<strong>è¾¹ (Edge)</strong> Â æ˜¯ LangGraph ä¸­å®šä¹‰å·¥ä½œæµ<strong>æ‰§è¡Œé€»è¾‘</strong>çš„æ ¸å¿ƒã€‚å®ƒå†³å®šäº†èŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»ä¸æ‰§è¡Œé¡ºåºï¼Œæ˜¯å®ç°ä¸²è¡Œã€å¹¶è¡Œã€æ¡ä»¶åˆ†æ”¯ç­‰å¤æ‚é€»è¾‘çš„å…³é”®ã€‚</p>
<h3 data-id="heading-7">3.1 æ™®é€šè¾¹</h3>
<p><strong>æ™®é€šè¾¹ï¼ˆé™æ€è¾¹ï¼‰</strong> Â ç”¨äºè¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å®šäº†ç¡®å®šæ— è¯¯çš„æ‰§è¡Œé¡ºåºã€‚å®ƒæ˜¯æœ€ç®€å•çš„æ§åˆ¶æµï¼Œå®šä¹‰äº†å·¥ä½œæµä¸­â€œä¸‹ä¸€æ­¥è¯¥æ‰§è¡Œè°â€ã€‚</p>
<ul>
<li><strong>ä¸²è¡Œæ‰§è¡Œ</strong>ï¼šé€šè¿‡è¿ç»­çš„æ™®é€šè¾¹è¿æ¥å¤šä¸ªèŠ‚ç‚¹ï¼Œå½¢æˆä¸€ä¸ªçº¿æ€§çš„æ‰§è¡Œé“¾ã€‚ä¾‹å¦‚ï¼š<code>START -&gt; A -&gt; B -&gt; C -&gt; END</code>ã€‚</li>
<li><strong>å¹¶è¡Œæ‰§è¡Œ</strong>ï¼šä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥åŒæ—¶æ‹¥æœ‰å¤šä¸ªå‡ºè¾¹ï¼ˆ<code>outgoing edges</code>ï¼‰ï¼ŒæŒ‡å‘ä¸åŒçš„åç»­èŠ‚ç‚¹ã€‚LangGraph è¿è¡Œæ—¶ä¼šåœ¨å½“å‰èŠ‚ç‚¹å®Œæˆåï¼Œ<strong>åŒæ—¶è§¦å‘</strong>æ‰€æœ‰è¿™äº›åç»­èŠ‚ç‚¹çš„æ‰§è¡Œã€‚</li>
</ul>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88136b7fd0114e4a8537f626e6b5e734~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=zKSjIck1IXcc9UtVD4kHgNYUAFc%3D" alt="3.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-8">3.2 æ¡ä»¶è¾¹</h3>
<p>é™¤æ™®é€šè¾¹å¤–ï¼ŒLangGraphè¿˜æœ‰å¦ä¸€ç§æ¡ä»¶è¾¹ã€‚æ¡ä»¶è¾¹å…è®¸å·¥ä½œæµæ ¹æ®è¿è¡Œæ—¶çŠ¶æ€<strong>åŠ¨æ€å†³å®š</strong>ä¸‹ä¸€æ­¥çš„æ‰§è¡Œè·¯å¾„ã€‚å®ƒéœ€è¦ä¸€ä¸ª<strong>è·¯ç”±å‡½æ•°</strong>ï¼Œè¯¥å‡½æ•°æ¥æ”¶å½“å‰çŠ¶æ€ï¼Œå¹¶é€‰æ‹©ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„èŠ‚ç‚¹ã€‚ä¸‹å›¾å·¦ä¾§æ ¹æ®æ¡ä»¶é€‰æ‹©å°†çŠ¶æ€ä¼ é€’ç»™ä¸‹ä¸€çº§å·¦ä¾§èŠ‚ç‚¹è¿›è¡Œå¤„ç†ã€‚æ¡ä»¶è¾¹è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šæƒ…å†µæ˜¯<strong>MapReduce</strong>, å®ƒå¯ä»¥åˆ›å»ºå¯å˜æ•°é‡çš„ä¸‹æ¸¸èŠ‚ç‚¹ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼ é€’äº†ä¸€ä¸ªå”¯ä¸€å€¼ï¼ˆç¬”è€…ä¹‹åä¹Ÿä¼šè®²åˆ°ï¼‰ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deb91ce98454469cb0a891760ca3572c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=EgMsRCv%2Bg%2F%2B7X%2FkrZMpNvO6MA3Y%3D" alt="5.png" width="70%" loading="lazy"/></p>
<h3 data-id="heading-9">3.3 Reducerè¯¦è§£</h3>
<p>å½“ä¸€ä¸ªèŠ‚ç‚¹æ‹¥æœ‰å¤šä¸ªå‡ºè¾¹ï¼ˆå³è§¦å‘äº†å¹¶è¡Œæ‰§è¡Œï¼‰æ—¶ï¼Œå¤šä¸ªåç»­èŠ‚ç‚¹å¯èƒ½<strong>åŒæ—¶æ›´æ–° State ä¸­çš„åŒä¸€ä¸ªå­—æ®µ</strong>ã€‚æ­¤æ—¶å°±ä¼šäº§ç”Ÿå†²çªï¼šä»¥è°çš„æ›´æ–°ä¸ºå‡†ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ï¼ŒèŠ‚ç‚¹çš„æ›´æ–°æ˜¯<strong>è¦†ç›–å¼</strong>çš„ã€‚å¦‚æœèŠ‚ç‚¹Bå’ŒèŠ‚ç‚¹Cå¹¶è¡Œæ‰§è¡Œï¼Œéƒ½å°è¯•æ›´æ–°<code>state[â€˜messagesâ€™]</code>ï¼Œåå®Œæˆçš„èŠ‚ç‚¹ä¼šè¦†ç›–å…ˆå®ŒæˆèŠ‚ç‚¹çš„ç»“æœï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5b1355ca283410bbb8c5607c466b81d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=q72h4XxsKO%2BQ7s22OQEGJ1hXzP0%3D" alt="6.png" width="70%" loading="lazy"/></p>
<p>ä¸ºäº†æ›´ç²¾ç¡®çš„æ§åˆ¶ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ°<strong>Reducerï¼ˆå½’çº¦å™¨ï¼‰</strong> æ¥è§£å†³è§£å†³æ­¤é—®é¢˜ã€‚å®ƒæ˜¯ä¸€ä¸ª<strong>åˆå¹¶å‡½æ•°</strong>ï¼Œå®šä¹‰äº†å½“å¤šä¸ªæ›´æ–°åŒæ—¶ä½œç”¨äºåŒä¸€ä¸ªçŠ¶æ€å­—æ®µæ—¶ï¼Œåº”å¦‚ä½•åˆå¹¶è¿™äº›æ›´æ–°ã€‚ä¸‹é¢çš„çŠ¶æ€å®šä¹‰ä¸­çš„<code>operator.add</code>å°±æ˜¯ä¸€ä¸ªReducerï¼Œå®ƒæŒ‡å®šäº†åˆ—è¡¨çŠ¶æ€åº”è¯¥æ˜¯åˆå¹¶è€Œä¸æ˜¯è¦†å†™</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> operator
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, Annotated


<span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    nList: Annotated[<span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>], operator.add]
</code></pre>
<p>LangGraph æä¾›äº†ä¸€äº›å¼€ç®±å³ç”¨çš„ Reducerï¼Œä¸‹è¡¨åˆ—å‡ºäº†æœ€å¸¸è§çš„å‡ ç§ï¼š</p>








































<table><thead><tr><th>Reducer å‡½æ•°</th><th>å¯¼å…¥æ¥æº</th><th>é€‚ç”¨æ•°æ®ç±»å‹</th><th>ä¸»è¦è¡Œä¸º</th><th>å…¸å‹åº”ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong><code>operator.add</code></strong></td><td><code>operator</code>Â (Pythonæ ‡å‡†åº“)</td><td><code>int</code>,Â <code>float</code></td><td>æ•°å€¼<strong>ç´¯åŠ </strong></td><td>è®¡æ•°å™¨ã€è®¡åˆ†å™¨</td></tr><tr><td><strong><code>operator.extend</code></strong></td><td><code>operator</code>Â (Pythonæ ‡å‡†åº“)</td><td><code>List[T]</code></td><td>åˆ—è¡¨<strong>æ‰©å±•</strong>Â (<code>list.extend</code>)</td><td>æ”¶é›†å¤šé¡¹ç»“æœï¼Œå¦‚æœç´¢æ¡ç›®</td></tr><tr><td><strong><code>operator.or_</code></strong></td><td><code>operator</code>Â (Pythonæ ‡å‡†åº“)</td><td><code>Set[T]</code></td><td>é›†åˆ<strong>å–å¹¶é›†</strong>ï¼Œè‡ªåŠ¨å»é‡</td><td>æ”¶é›†æ ‡ç­¾ã€å”¯ä¸€IDé›†åˆ</td></tr><tr><td><strong><code>update_dict</code></strong></td><td><code>langgraph.utils</code></td><td><code>Dict</code></td><td><strong>åˆå¹¶å­—å…¸</strong>ï¼Œæ–°å€¼è¦†ç›–æ—§é”®</td><td>æ›´æ–°é…ç½®æˆ–å…ƒæ•°æ®</td></tr></tbody></table>
<p>é™¤äº†ä½¿ç”¨å†…ç½®çš„Reducerå¤–ï¼Œå¼€å‘è€…ç”šè‡³å¯ä»¥è‡ªå®šä¹‰reducerè¿›è¡Œå¤„ç†ã€‚Reducerå°±æ˜¯ä¸€ä¸ªåˆå¹¶å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶å½“å‰å€¼å’Œæ–°ä¼ å…¥å€¼ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨å‡½æ•°ä¸­å®šä¹‰å¤„ç†é€»è¾‘ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰Reducerçš„ä»£ç ç¤ºä¾‹ï¼šè¯¥å‡½æ•°åˆå¹¶æ–°å€¼å’Œæ—§å€¼å¹¶è¿”å›å»é‡åç»“æœã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, <span class="hljs-type">List</span>, Annotated
<span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> START, END, StateGraph

<span class="hljs-keyword">def</span> <span class="hljs-title function_">deduplicate_merge</span>(<span class="hljs-params">old_list: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], new_list: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
    <span class="hljs-string">"""è‡ªå®šä¹‰Reducerï¼šåˆå¹¶åˆ—è¡¨å¹¶å»é‡"""</span>
    combined = old_list + new_list
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">dict</span>.fromkeys(combined)) <span class="hljs-comment"># ä¿æŒé¡ºåºçš„å»é‡</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    unique_items: Annotated[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], deduplicate_merge]


<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, <span class="hljs-type">List</span>, Annotated

<span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    unique_items: Annotated[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], deduplicate_merge]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_a</span>(<span class="hljs-params">state: State</span>) -&gt; State:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Adding 'A' to <span class="hljs-subst">{state[<span class="hljs-string">'unique_items'</span>]}</span>"</span>)
    <span class="hljs-keyword">return</span> State(unique_items=[<span class="hljs-string">"A"</span>])

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_A_extra</span>(<span class="hljs-params">state: State</span>) -&gt; State:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Adding 'A' to <span class="hljs-subst">{state[<span class="hljs-string">'unique_items'</span>]}</span>"</span>)
    <span class="hljs-keyword">return</span> State(unique_items=[<span class="hljs-string">"A"</span>])

builder = StateGraph(State)

builder.add_node(<span class="hljs-string">"a"</span>, node_a)
builder.add_node(<span class="hljs-string">"a_extra"</span>, node_A_extra)

builder.add_edge(START, <span class="hljs-string">"a"</span>)
builder.add_edge(<span class="hljs-string">"a"</span>, <span class="hljs-string">"a_extra"</span>)
builder.add_edge(<span class="hljs-string">"a_extra"</span>, END)

graph = builder.<span class="hljs-built_in">compile</span>()

initial_state = State(
    unique_items = [<span class="hljs-string">'Initial String'</span>]
)

<span class="hljs-built_in">print</span>(graph.invoke(initial_state))
</code></pre>
<p>ä¸Šé¢ä»£ç çš„å›¾ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼ŒæŒ‰ç†è¯´åˆ—è¡¨ä¸­åº”è¯¥æœ‰ä¸¤ä¸ªâ€œAâ€ï¼Œä½†æ˜¯å› ä¸ºæ·»åŠ æ—¶ä¼šå»é‡ï¼Œæ‰€ä»¥æœ€ååˆ—è¡¨ä¸­åªæœ‰è¿™ä¸€ä¸ªâ€œAâ€äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55d0f61cfc114b3fafc6b8a14f75bfd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=zWmGcW345lyqV9X%2Fw1f1jsuZYew%3D" alt="10.png" loading="lazy"/></p>
<p>æœ€åçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be248369b69d43e6b4ba37efd433cabf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=aMzyW7XxkdtSgTWE8Azbg%2Bu%2BrPo%3D" alt="9.png" loading="lazy"/></p>
<h3 data-id="heading-10">3.4 æ¢ç´¢LangGraphè¾¹çš„å¹¶è¡Œä¸æ•°æ®å…±äº«</h3>
<p>ç¬”è€…æ¥ä¸‹æ¥å°†æ„å»ºä¸‹å›¾æ‰€ç¤ºçš„å·¥ä½œæµï¼Œæ¥å¸®åŠ©å¤§å®¶ç›´è§‚ç†è§£<strong>å¹¶è¡Œæ‰§è¡Œ</strong>ä¸<strong>å…¨å±€çŠ¶æ€å…±äº«</strong>ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e8e9cdd7ab54f3f9e5cc927cd39f831~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=sQnGlRqZVO5SHdvIJXWcftDXb2A%3D" alt="7.png" width="30%" loading="lazy"/></p>
<ol>
<li>
<p>ç¬¬ä¸€æ­¥åŒæ ·çš„éœ€è¦å®šä¹‰çŠ¶æ€ï¼Œä¸åŒçš„æ˜¯è¿™é‡Œçš„çŠ¶æ€éœ€è¦ç”¨reduceræ¥æŒ‡æ˜åˆ—è¡¨çš„çŠ¶æ€æ˜¯ç´¯åŠ è€Œä¸æ˜¯è¦†ç›–åŸæ¥çš„å€¼</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> operator
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, <span class="hljs-type">List</span>, Annotated

<span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    nList: Annotated[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], operator.add]
</code></pre>
</li>
<li>
<p>ä¸‹ä¸€æ­¥æ¥å®šä¹‰èŠ‚ç‚¹å‡½æ•°ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ¥æ”¶çŠ¶æ€ï¼Œå¹¶è¿”å›å¯¹<code>nList</code>å­—æ®µçš„æ›´æ–°</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">node_a</span>(<span class="hljs-params">state: State</span>) -&gt; State:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Adding 'A' to <span class="hljs-subst">{state[<span class="hljs-string">'nList'</span>]}</span>"</span>)
    <span class="hljs-keyword">return</span> State(nList=[<span class="hljs-string">"A"</span>])

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_b</span>(<span class="hljs-params">state: State</span>) -&gt; State:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Adding 'B' to <span class="hljs-subst">{state[<span class="hljs-string">'nList'</span>]}</span>"</span>)
    <span class="hljs-keyword">return</span> State(nList=[<span class="hljs-string">"B"</span>])

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_c</span>(<span class="hljs-params">state: State</span>) -&gt; State:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Adding 'C' to <span class="hljs-subst">{state[<span class="hljs-string">'nList'</span>]}</span>"</span>)
    <span class="hljs-keyword">return</span> State(nList=[<span class="hljs-string">"C"</span>])

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_bb</span>(<span class="hljs-params">state: State</span>) -&gt; State:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Adding 'BB' to <span class="hljs-subst">{state[<span class="hljs-string">'nList'</span>]}</span>"</span>)
    <span class="hljs-keyword">return</span> State(nList=[<span class="hljs-string">"BB"</span>])

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_cc</span>(<span class="hljs-params">state: State</span>) -&gt; State:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Adding 'CC' to <span class="hljs-subst">{state[<span class="hljs-string">'nList'</span>]}</span>"</span>)
    <span class="hljs-keyword">return</span> State(nList=[<span class="hljs-string">"CC"</span>])

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_d</span>(<span class="hljs-params">state: State</span>) -&gt; State:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Adding 'D' to <span class="hljs-subst">{state[<span class="hljs-string">'nList'</span>]}</span>"</span>)
    <span class="hljs-keyword">return</span> State(nList=[<span class="hljs-string">"D"</span>])
</code></pre>
</li>
<li>
<p>ç”¨çŠ¶æ€å®ä¾‹åŒ–StateGraphï¼Œç„¶åæ·»åŠ å®šä¹‰å¥½çš„èŠ‚ç‚¹å¹¶æŒ‰ç…§å‚è€ƒå›¾ä¸­çš„è¾¹å°†ä¸åŒçš„èŠ‚ç‚¹è¿æ¥èµ·æ¥ï¼Œæœ€åç¼–è¯‘å›¾ã€‚</p>
<pre><code class="hljs language-python" lang="python">builder = StateGraph(State)

builder.add_node(<span class="hljs-string">"a"</span>, node_a)
builder.add_node(<span class="hljs-string">"b"</span>, node_b)
builder.add_node(<span class="hljs-string">"c"</span>, node_c)
builder.add_node(<span class="hljs-string">"bb"</span>, node_bb)
builder.add_node(<span class="hljs-string">"cc"</span>, node_cc)
builder.add_node(<span class="hljs-string">"d"</span>, node_d)

builder.add_edge(START, <span class="hljs-string">"a"</span>)
builder.add_edge(<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>)
builder.add_edge(<span class="hljs-string">"a"</span>, <span class="hljs-string">"c"</span>)
builder.add_edge(<span class="hljs-string">"b"</span>, <span class="hljs-string">"bb"</span>)
builder.add_edge(<span class="hljs-string">"c"</span>, <span class="hljs-string">"cc"</span>)
builder.add_edge(<span class="hljs-string">"bb"</span>, <span class="hljs-string">"d"</span>)
builder.add_edge(<span class="hljs-string">"cc"</span>, <span class="hljs-string">"d"</span>)
builder.add_edge(<span class="hljs-string">"d"</span>, END)

graph = builder.<span class="hljs-built_in">compile</span>()
</code></pre>
</li>
<li>
<p>æä¾›ä¸€ä¸ªåˆå§‹çŠ¶æ€æ¥è°ƒç”¨å›¾è¡¨ï¼Œå¤§å®¶å…ˆæ¥æ€è€ƒä¸€ä¸‹æœ€åçš„è¿è¡Œç»“æœã€‚</p>
<pre><code class="hljs language-python" lang="python">initial_state = State(
    nList = [<span class="hljs-string">'Initial String'</span>]
)
<span class="hljs-built_in">print</span>(graph.invoke(initial_state))
</code></pre>
</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b5ad1efa57345f6b381d9fd5cf92a26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=Zal7Y9KoIqu84oP%2Byp8LvmsmQWk%3D" alt="8.png" loading="lazy"/></p>
<ul>
<li><strong>å¹¶è¡Œä¸åˆå¹¶</strong>ï¼šèŠ‚ç‚¹Bå’ŒCåœ¨<strong>åŒä¸€æ­¥éª¤</strong>ä¸­å¹¶è¡Œæ‰§è¡Œï¼Œå®ƒä»¬éƒ½æ¥æ”¶åˆ°äº†æ¥è‡ªèŠ‚ç‚¹Aæ›´æ–°åçš„çŠ¶æ€Â <code>[â€˜Initialâ€˜ï¼Œ â€˜Aâ€™]</code>ã€‚å®ƒä»¬çš„æ›´æ–°ï¼ˆ<code>â€Bâ€</code>å’Œ<code>â€Câ€</code>ï¼‰é€šè¿‡Reducerè¢«<strong>è¿½åŠ </strong>åˆ°äº†<code>nList</code>ä¸­ã€‚</li>
<li><strong>å…¨å±€çŠ¶æ€å…±äº«</strong>ï¼šèŠ‚ç‚¹BBå’ŒCCè¿è¡Œæ—¶ï¼Œå®ƒèƒ½â€œçœ‹åˆ°â€çš„çŠ¶æ€åŒ…å«äº†å…¶ä¸Šæ¸¸èŠ‚ç‚¹Bçš„æ›´æ–°<code>(â€˜Bâ€™)</code>ï¼Œ<strong>ä¹ŸåŒ…å«äº†å¹¶è¡Œåˆ†æ”¯èŠ‚ç‚¹Cçš„æ›´æ–°`(â€˜Câ€™)</strong> ã€‚è¿™æ˜¯å› ä¸ºLangGraphçš„çŠ¶æ€æ˜¯<strong>å…¨å±€å…±äº«</strong>çš„ï¼Œè¾¹åªæ§åˆ¶æ‰§è¡Œé¡ºåºï¼Œä¸éš”ç¦»æ•°æ®ã€‚</li>
</ul>
<h3 data-id="heading-11">3.5 æ¡ä»¶è¾¹</h3>
<p>å¯¹äºæ¡ä»¶è¾¹ç¬”è€…è¿™é‡Œç›´æ¥é€šè¿‡ä»£ç è®²è§£ï¼Œä½¿ç”¨æ¡ä»¶è¾¹å®ç°ä¸‹å›¾ç»“æ„ï¼Œä¸‹å›¾ä¸­çš„è™šçº¿è¡¨ç¤ºæ¡ä»¶è¾¹ï¼Œå®çº¿è¡¨ç¤ºæ™®é€šè¾¹ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/396ac2fb7239477582ae0a3f598e62a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=fPoFcJocKNjIBKKh09eFUpoDg9M%3D" alt="11.png" loading="lazy"/></p>
<ol>
<li>
<p>å®šä¹‰çŠ¶æ€</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> START, END, StateGraph
<span class="hljs-keyword">import</span> operator
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, <span class="hljs-type">List</span>, Annotated

<span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    nList: Annotated[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], operator.add]
</code></pre>
</li>
<li>
<p>å®šä¹‰èŠ‚ç‚¹å‡½æ•°</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">node_a</span>(<span class="hljs-params">state: State</span>):
    <span class="hljs-keyword">return</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_b</span>(<span class="hljs-params">state: State</span>):
    <span class="hljs-keyword">return</span> State(nList=[<span class="hljs-string">'B'</span>])

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_c</span>(<span class="hljs-params">state: State</span>):
    <span class="hljs-keyword">return</span> State(nList=[<span class="hljs-string">'C'</span>])
</code></pre>
</li>
<li>
<p>å®šä¹‰å›¾ï¼Œé¦–å…ˆæ·»åŠ å®çº¿æ™®é€šè¾¹</p>
<pre><code class="hljs language-python" lang="python">builder = StateGraph(State)
builder.add_node(<span class="hljs-string">"a"</span>, node_a)
builder.add_node(<span class="hljs-string">"b"</span>, node_b)
builder.add_node(<span class="hljs-string">"c"</span>, node_c)

builder.add_edge(START, <span class="hljs-string">"a"</span>)
builder.add_edge(<span class="hljs-string">"b"</span>, END)
builder.add_edge(<span class="hljs-string">"c"</span>, END)

graph = builder.<span class="hljs-built_in">compile</span>()
</code></pre>
</li>
<li>
<p>å­¦ä¹ æ¡ä»¶è¾¹çš„å®šä¹‰æ–¹æ³•ï¼Œæ¡ä»¶è¾¹éœ€è¦å®šä¹‰æ¡ä»¶è·¯ç”±å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—çŠ¶æ€å¹¶è¿”å›ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼ä»£è¡¨æƒ³è¦åˆ†æ”¯åˆ°çš„ä¸‹ä¸€èŠ‚ç‚¹ã€‚ç¬”è€…ä¸‹é¢å®šä¹‰çš„å‡½æ•°æ¥æ”¶å›¾æœ€è¿‘ä¸€æ¬¡å†™å…¥çš„çŠ¶æ€ï¼Œç„¶åè¿”å›ä¸€ä¸ªå€¼ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">conditional_edge</span>(<span class="hljs-params">state: State</span>) -&gt; <span class="hljs-type">Literal</span>[<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, END]:
    select = state[<span class="hljs-string">"nList"</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> select == <span class="hljs-string">"b"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'b'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'c'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'c'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'q'</span>:
        <span class="hljs-keyword">return</span> END
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> END
</code></pre>
</li>
<li>
<p>åœ¨æ„å»ºå›¾æ—¶ä½¿ç”¨æ·»åŠ æ¡ä»¶è¾¹çš„è¯­æ³•æ¥æ·»åŠ æ¡ä»¶è¾¹ï¼Œ</p>
<pre><code class="hljs language-python" lang="python">builder.add_conditional_edges(<span class="hljs-string">"a"</span>, conditional_edge)
</code></pre>
</li>
<li>
<p>æµ‹è¯•æ¡ä»¶è¾¹çš„é€»è¾‘ã€‚ä¸‹é¢ä»£ç ç¬”è€…ä»ç”¨æˆ·é‚£é‡Œè·å–è¾“å…¥ä½œä¸ºåˆå§‹è¾“å…¥çŠ¶æ€ï¼Œç„¶åç”¨è¯¥çŠ¶æ€è°ƒç”¨å›¾è¡¨ï¼š</p>
<pre><code class="hljs language-python" lang="python">user = <span class="hljs-built_in">input</span>(<span class="hljs-string">'b, c or q to quit:'</span>)
input_state = State(
    nList=[user]
)
graph.invoke(input_state)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5a522b1780540b5a2a0216a02b87aae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=cc7HCQBEQ7bxLussYDZbfyo98UE%3D" alt="12.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/515f5e55cc224ce981d4d46453c13d97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=Asvl8DvKChgokXZDxKEdPbCDb9U%3D" alt="13.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28fd5481a2f542d9a0a1bbdcb2a5ff0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766621455&amp;x-signature=mXkmp6EZlDPSqozD%2FKmEWPjmo8M%3D" alt="14.png" loading="lazy"/></p>
</li>
</ol>
<p>å¯ä»¥çœ‹åˆ°å½“ç”¨æˆ·è¾“å…¥b, ä¼šèµ°åˆ°bèŠ‚ç‚¹ï¼Œåœ¨bèŠ‚ç‚¹ä¸­æ·»åŠ å­—ç¬¦ä¸²'B', å½“ç”¨æˆ·è¾“å…¥c, ä¼šèµ°åˆ°cèŠ‚ç‚¹ï¼Œåœ¨cèŠ‚ç‚¹ä¸­æ·»åŠ å­—ç¬¦ä¸²â€˜Câ€™ï¼Œè¾“å…¥q åˆ™ä¼šç›´æ¥åˆ°ç»“æŸèŠ‚ç‚¹ï¼Œè¿™å°±æ˜¯æ¡ä»¶è¾¹çš„æ§åˆ¶é€»è¾‘ã€‚å®Œæ•´ä»£ç å¤§å®¶å¯ä»¥å…³æ³¨ç¬”è€…çš„åŒåå¾®ä¿¡å…¬ä¼—å·Â <strong>å¤§æ¨¡å‹çœŸå¥½ç©</strong>ï¼Œå¹¶ç§ä¿¡:Â <strong>LangChainæ™ºèƒ½ä½“å¼€å‘</strong>å…è´¹è·å–ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯ä»Šå¤©çš„å…¨éƒ¨å†…å®¹å•¦ï¼å†…å®¹ç¯‡å¹…è¾ƒé•¿ï¼Œå¤§å®¶æ¶ˆåŒ–ä¸€ä¸‹~</p>
<h2 data-id="heading-12">å››ã€æ€»ç»“</h2>
<p>æœ¬æœŸåˆ†äº«ç¬”è€…ä¸ºå¤§å®¶ä»‹ç»äº†LangGraph 1.0ï¼ŒLangGraph1.0æ˜¯æ„å»ºæ™ºèƒ½ä½“çš„ç¼–ç¨‹è¯­è¨€ã€‚å®ƒé€šè¿‡<strong>çŠ¶æ€ï¼ˆStateï¼‰</strong> ç®¡ç†æ•°æ®ï¼Œ<strong>èŠ‚ç‚¹ï¼ˆNodeï¼‰</strong> ä½œä¸ºå¤„ç†å‡½æ•°ï¼Œ<strong>è¾¹ï¼ˆEdgeï¼‰</strong> å®šä¹‰ä¸²è¡Œã€å¹¶è¡Œæˆ–æ¡ä»¶æ‰§è¡Œé€»è¾‘ã€‚å€ŸåŠ©<strong>Reducer</strong>å¤„ç†å¹¶è¡Œå†™å…¥å†²çªï¼Œå¹¶æ”¯æŒ<strong>äººåœ¨å›è·¯</strong>æ§åˆ¶ã€‚è¿™ä½¿å…¶æˆä¸ºæ­å»ºå¤æ‚ã€å¯ç¼–æ’AIå·¥ä½œæµçš„å¼ºå¤§åº•åº§ã€‚æœ¬æœŸåˆ†äº«ç€é‡ä»‹ç»äº†LangGraphçš„èŠ‚ç‚¹å’Œè¾¹çš„å®šä¹‰ï¼Œå¹¶ç”¨ç‚¹å’Œè¾¹æ„é€ äº†ç®€å•çš„å›¾ã€‚ç„¶è€ŒLangGraphä¸ä»…ä»…æœ‰å¦‚ä¸Šæ‰€ç¤ºçš„å›¾çš„å®šä¹‰æ–¹æ³•ï¼Œåœ¨ä¸‹æœŸåˆ†äº«ç¬”è€…å°†ä¸ºå¤§å®¶ä»‹ç»æ›´å¤šç‚¹å’Œè¾¹çš„æ„å»ºæ–¹æ³•ï¼Œä»¥åŠä»‹ç»è®°å¿†Memoryå’Œäººåœ¨å›è·¯Human In the loopï¼Œå¤§å®¶æ•¬è¯·æœŸå¾…~</p>
<p><a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">ã€Šæ·±å…¥æµ…å‡ºLangChain&amp;LangGraph AI Agent æ™ºèƒ½ä½“å¼€å‘ã€‹</a>ä¸“æ å†…å®¹æºè‡ªç¬”è€…åœ¨å®é™…å­¦ä¹ å’Œå·¥ä½œä¸­å¯¹ LangChain ä¸ LangGraph çš„æ·±åº¦ä½¿ç”¨ç»éªŒï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶ç³»ç»Ÿæ€§åœ°ã€é«˜æ•ˆåœ°æŒæ¡ AI Agent çš„å¼€å‘æ–¹æ³•ï¼Œåœ¨å„å¤§æŠ€æœ¯å¹³å°è·å¾—äº†ä¸å°‘å…³æ³¨ä¸æ”¯æŒã€‚ç›®å‰å·²æ›´æ–°30è®²ï¼Œæ­£åœ¨æ›´æ–°LangGraph1.0é€Ÿé€šæŒ‡å—ï¼Œå¹¶éšæ—¶è¡¥å……ç¬”è€…åœ¨å®é™…å·¥ä½œä¸­æ€»ç»“çš„æ‹“å±•çŸ¥è¯†ç‚¹ã€‚å¦‚æœå¤§å®¶æ„Ÿå…´è¶£ï¼Œæ¬¢è¿å…³æ³¨ç¬”è€…çš„æ˜é‡‘è´¦å·ä¸ä¸“æ ï¼Œä¹Ÿå¯å…³æ³¨ç¬”è€…çš„åŒåå¾®ä¿¡å…¬ä¼—å·Â <strong>å¤§æ¨¡å‹çœŸå¥½ç©</strong>ï¼Œæ¯æœŸåˆ†äº«æ¶‰åŠçš„ä»£ç å‡å¯åœ¨å…¬ä¼—å·ç§ä¿¡:Â <strong>LangChainæ™ºèƒ½ä½“å¼€å‘</strong>å…è´¹è·å–ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šè¿™5ä¸ªæŠ€å·§è®©æˆ‘çš„åº”ç”¨åŠ è½½é€Ÿåº¦æå‡äº†40%]]></title>    <link>https://juejin.cn/post/7584689488770334755</link>    <guid>https://juejin.cn/post/7584689488770334755</guid>    <pubDate>2025-12-18T00:16:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584689488770334755" data-draft-id="7584711683772678144" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šè¿™5ä¸ªæŠ€å·§è®©æˆ‘çš„åº”ç”¨åŠ è½½é€Ÿåº¦æå‡äº†40%"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-18T00:16:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šè¿™5ä¸ªæŠ€å·§è®©æˆ‘çš„åº”ç”¨åŠ è½½é€Ÿåº¦æå‡äº†40%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:16:54.000Z" title="Thu Dec 18 2025 00:16:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vue3æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šè¿™5ä¸ªæŠ€å·§è®©æˆ‘çš„åº”ç”¨åŠ è½½é€Ÿåº¦æå‡äº†40%</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ã€‚éšç€Vue3çš„æ™®åŠï¼Œå…¶å“åº”å¼ç³»ç»Ÿã€ç»„åˆå¼APIå’Œç¼–è¯‘æ—¶ä¼˜åŒ–ç­‰ç‰¹æ€§ä¸ºå¼€å‘è€…æä¾›äº†æ›´å¤šçš„æ€§èƒ½æå‡ç©ºé—´ã€‚ç„¶è€Œï¼Œå³ä½¿æ˜¯æœ€å…ˆè¿›çš„æ¡†æ¶ï¼Œå¦‚æœä¸åŠ ä»¥åˆç†é…ç½®å’Œä¼˜åŒ–ï¼Œä»ç„¶å¯èƒ½å¯¼è‡´åº”ç”¨åŠ è½½ç¼“æ…¢ã€äº¤äº’å¡é¡¿ç­‰é—®é¢˜ã€‚</p>
<p>æœ¬æ–‡å°†åˆ†äº«æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­é€šè¿‡5ä¸ªå…³é”®æŠ€å·§å°†Vue3åº”ç”¨çš„åŠ è½½é€Ÿåº¦æå‡40%çš„å®æˆ˜ç»éªŒã€‚è¿™äº›æŠ€å·§æ¶µç›–äº†ä»ä»£ç åˆ†å‰²åˆ°æ‡’åŠ è½½ã€ä»ç¼–è¯‘ä¼˜åŒ–åˆ°è¿è¡Œæ—¶æ€§èƒ½è°ƒä¼˜ç­‰å¤šä¸ªæ–¹é¢ï¼Œå¸Œæœ›èƒ½ä¸ºä½ çš„Vue3é¡¹ç›®å¸¦æ¥å®è´¨æ€§çš„æ€§èƒ½æå‡ã€‚</p>
<hr/>
<h2 data-id="heading-2">ä¸»ä½“</h2>
<h3 data-id="heading-3">1. ä»£ç åˆ†å‰²ä¸è·¯ç”±æ‡’åŠ è½½</h3>
<h4 data-id="heading-4">é—®é¢˜èƒŒæ™¯</h4>
<p>å•é¡µåº”ç”¨ï¼ˆSPAï¼‰çš„ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯é¦–æ¬¡åŠ è½½æ—¶éœ€è¦ä¸‹è½½æ‰€æœ‰è·¯ç”±å¯¹åº”çš„ä»£ç åŒ…ï¼Œå¯¼è‡´é¦–å±æ—¶é—´å˜é•¿ã€‚å°¤å…¶æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªé—®é¢˜å°¤ä¸ºæ˜æ˜¾ã€‚</p>
<h4 data-id="heading-5">è§£å†³æ–¹æ¡ˆ</h4>
<p>Vue3ç»“åˆVue Routeræ”¯æŒåŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importï¼‰ï¼Œå¯ä»¥å°†è·¯ç”±ç»„ä»¶æŒ‰éœ€åŠ è½½ã€‚ä»¥ä¸‹æ˜¯å®ç°æ–¹å¼ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./views/Dashboard.vue'</span>) <span class="hljs-comment">// åŠ¨æ€å¯¼å…¥</span>
  },
  <span class="hljs-comment">// å…¶ä»–è·¯ç”±...</span>
];
</code></pre>
<h4 data-id="heading-6">æ•ˆæœ</h4>
<p>é€šè¿‡è·¯ç”±æ‡’åŠ è½½ï¼Œæˆ‘ä»¬å¯ä»¥å°†åˆå§‹åŒ…ä½“ç§¯å‡å°‘50%ä»¥ä¸Šï¼ˆå…·ä½“å–å†³äºé¡¹ç›®è§„æ¨¡ï¼‰ï¼Œä»è€Œæ˜¾è‘—æå‡é¦–å±åŠ è½½é€Ÿåº¦ã€‚</p>
<hr/>
<h3 data-id="heading-7">2. Tree Shakingä¸æŒ‰éœ€å¼•å…¥ä¾èµ–</h3>
<h4 data-id="heading-8">é—®é¢˜èƒŒæ™¯</h4>
<p>è®¸å¤šç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚Element Plusã€Lodashç­‰ï¼‰ä½“ç§¯åºå¤§ï¼Œä½†å®é™…é¡¹ç›®ä¸­å¯èƒ½åªç”¨åˆ°äº†å…¶ä¸­ä¸€å°éƒ¨åˆ†åŠŸèƒ½ã€‚å¦‚æœä¸è¿›è¡Œä¼˜åŒ–ï¼Œè¿™äº›æœªä½¿ç”¨çš„ä»£ç ä¼šè¢«æ‰“åŒ…åˆ°æœ€ç»ˆäº§ç‰©ä¸­ã€‚</p>
<h4 data-id="heading-9">è§£å†³æ–¹æ¡ˆ</h4>
<ul>
<li><strong>ä½¿ç”¨ESæ¨¡å—ç‰ˆæœ¬</strong>ï¼šç¡®ä¿ç¬¬ä¸‰æ–¹åº“æ”¯æŒESæ¨¡å—ï¼ˆä¾‹å¦‚<code>lodash-es</code>ï¼‰ã€‚</li>
<li><strong>æŒ‰éœ€å¼•å…¥</strong>ï¼šå¯¹äºUIåº“å¦‚Element Plusæˆ–Ant Design Vueï¼Œä½¿ç”¨å…¶æä¾›çš„æŒ‰éœ€å¼•å…¥åŠŸèƒ½ï¼š</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElButton</span>, <span class="hljs-title class_">ElInput</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>;
</code></pre>
<ul>
<li><strong>é…ç½®æ„å»ºå·¥å…·</strong>ï¼šåœ¨Viteæˆ–Webpackä¸­å¯ç”¨Tree Shakingï¼š</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">rollupOptions</span>: {
      <span class="hljs-attr">treeshake</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// Viteé»˜è®¤å¯ç”¨</span>
    }
  }
};
</code></pre>
<h4 data-id="heading-10">æ•ˆæœ</h4>
<p>åœ¨æˆ‘çš„é¡¹ç›®ä¸­ï¼Œä»…é€šè¿‡æŒ‰éœ€å¼•å…¥Element Plusç»„ä»¶å°±å‡å°‘äº†çº¦30%çš„æ‰“åŒ…ä½“ç§¯ã€‚</p>
<hr/>
<h3 data-id="heading-11">3. Vue3ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼šé™æ€èŠ‚ç‚¹æå‡ä¸è¡¥ä¸æ ‡å¿—</h3>
<h4 data-id="heading-12">Vue3çš„åº•å±‚ä¼˜åŒ–</h4>
<p>Vue3åœ¨ç¼–è¯‘é˜¶æ®µä¼šå¯¹æ¨¡æ¿è¿›è¡Œé™æ€åˆ†æå¹¶ç”Ÿæˆæ›´é«˜æ•ˆçš„æ¸²æŸ“å‡½æ•°ï¼š</p>
<ol>
<li><strong>é™æ€èŠ‚ç‚¹æå‡ï¼ˆStatic Node Hoistingï¼‰</strong>ï¼šå°†é™æ€DOMèŠ‚ç‚¹æå‡åˆ°æ¸²æŸ“å‡½æ•°å¤–éƒ¨ï¼Œé¿å…é‡å¤åˆ›å»ºã€‚</li>
<li><strong>è¡¥ä¸æ ‡å¿—ï¼ˆPatch Flagsï¼‰</strong>ï¼šåŠ¨æ€æ›´æ–°æ—¶åªæ¯”å¯¹å¸¦æœ‰æ ‡è®°çš„èŠ‚ç‚¹ï¼Œè·³è¿‡é™æ€å†…å®¹ã€‚</li>
</ol>
<h4 data-id="heading-13">å®æˆ˜å»ºè®®</h4>
<ul>
<li><strong>åˆ©ç”¨å•æ–‡ä»¶ç»„ä»¶ï¼ˆSFCï¼‰</strong>ï¼šVue3å¯¹SFCçš„æ”¯æŒæ›´å®Œå–„ï¼Œèƒ½æ›´å¥½åœ°åº”ç”¨ä¸Šè¿°ä¼˜åŒ–ã€‚</li>
<li><strong>é¿å…è¿‡åº¦ä½¿ç”¨åŠ¨æ€ç»‘å®š</strong>ï¼šå‡å°‘ä¸å¿…è¦çš„<code>v-if</code>æˆ–<code>v-for</code>åµŒå¥—ä»¥é™ä½è¿è¡Œæ—¶å¼€é”€ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-14">4. Web Workerå¤„ç†CPUå¯†é›†å‹ä»»åŠ¡</h3>
<h4 data-id="heading-15">é—®é¢˜èƒŒæ™¯</h4>
<p>æŸäº›è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚å¤§æ•°æ®å¤„ç†ã€å¤æ‚åŠ¨ç”»ï¼‰ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´ç•Œé¢å¡é¡¿ã€‚</p>
<h4 data-id="heading-16">Vue3ä¸­çš„å®ç°æ–¹æ¡ˆ</h4>
<ol>
<li><strong>å°†ä»»åŠ¡ç§»è‡³Web Worker</strong>ï¼šä¾‹å¦‚å¤„ç†å¤§å‹æ•°æ®é›†æˆ–åŠ å¯†è¿ç®—æ—¶å¯ä»¥ä½¿ç”¨Workerã€‚</li>
<li><strong>Composableå°è£…</strong>ï¼šç”¨ç»„åˆå¼APIå°è£…Workeré€»è¾‘ä»¥å®ç°å¤ç”¨ï¼š</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// useWorker.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useWorker</span>(<span class="hljs-params">workerScript</span>) {
  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(workerScript);

  worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    result.<span class="hljs-property">value</span> = e.<span class="hljs-property">data</span>;
  };

  <span class="hljs-keyword">return</span> { result };
}
</code></pre>
<p>####æ•ˆæœç¤ºä¾‹<br/>
åœ¨ä¸€ä¸ªæ•°æ®å¯è§†åŒ–çš„é¡¹ç›®ä¸­ï¼Œæˆ‘å°†å›¾è¡¨æ•°æ®çš„é¢„å¤„ç†é€»è¾‘ç§»è‡³Web Workeråä¸»çº¿ç¨‹FPSæå‡äº†20%ã€‚</p>
<hr/>
<p>###5 .ç¼“å­˜ç­–ç•¥ä¸æœåŠ¡ç«¯æ¸²æŸ“(SSR)/é™æ€ç«™ç‚¹ç”Ÿæˆ(SSG)</p>
<p>#####ä¸ºä»€ä¹ˆéœ€è¦ç¼“å­˜ï¼Ÿ<br/>
é¢‘ç¹è¯·æ±‚ä¸å˜èµ„æº(å¦‚å›¾ç‰‡ã€JS/CSSæ–‡ä»¶)ä¼šæ‹–æ…¢é¡µé¢é€Ÿåº¦ ã€‚</p>
<p>#####æœ€ä½³å®è·µ<br/>
-<strong>é•¿æœŸç¼“å­˜(Long-term Caching)</strong> :é€šè¿‡æ–‡ä»¶åå“ˆå¸Œé…ç½®å¼ºç¼“å­˜ :</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js    </span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {       
   <span class="hljs-attr">build</span>: {         
     <span class="hljs-attr">rollupOptions</span>: {           
       <span class="hljs-attr">output</span>: {             
         <span class="hljs-attr">assetFileNames</span>: <span class="hljs-string">'[name].[hash].[ext]'</span>          
       }        
     }      
   }    
};   
</code></pre>
<p>-<strong>SSR/SSGé€‰æ‹©</strong>:<br/>
1 .é«˜åŠ¨æ€å†…å®¹â†’ä½¿ç”¨Nuxt.jså®ç°æœåŠ¡ç«¯æ¸²æŸ“ ;<br/>
2 .å†…å®¹ç¨³å®šâ†’é‡‡ç”¨Vitepressæˆ–VitePressç”Ÿæˆé™æ€ç«™ç‚¹ ã€‚</p>
<p>######å®æµ‹æ•°æ®<br/>
å¯ç”¨HTTP/2 +é•¿æœŸç¼“å­˜å ï¼Œæˆ‘çš„åº”ç”¨äºŒæ¬¡åŠ è½½æ—¶é—´ç¼©çŸ­äº†60% ã€‚</p>
<hr/>
<p>##æ€»ç»“</p>
<p>æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªç³»ç»Ÿå·¥ç¨‹ ï¼Œéœ€è¦ä»ä»£ç  ã€æ„å»º ã€ç½‘ç»œç­‰å¤šç»´åº¦åˆ‡å…¥ ã€‚æœ¬æ–‡ä»‹ç»çš„äº”ä¸ªæŠ€å·§â€”â€”è·¯ç”±æ‡’åŠ è½½ ã€Tree Shaking ã€ç¼–è¯‘æ—¶ä¼˜åŒ– ã€Web Workerå’Œç¼“å­˜ç­–ç•¥ â€”â€”åœ¨å®é™…é¡¹ç›®ä¸­å¸®åŠ©æˆ‘å°†Vue3åº”ç”¨çš„åŠ è½½é€Ÿåº¦æå‡äº†40%ã€‚å½“ç„¶ ï¼Œæ¯ä¸ªé¡¹ç›®çš„æŠ€æœ¯æ ˆå’Œä¸šåŠ¡åœºæ™¯ä¸åŒ ï¼Œå»ºè®®æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆå¹¶è¿›è¡Œé‡åŒ–æµ‹è¯• ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonçš„æ¡ä»¶ç¼–è¯‘-Type_Checking]]></title>    <link>https://juejin.cn/post/7584987267266314250</link>    <guid>https://juejin.cn/post/7584987267266314250</guid>    <pubDate>2025-12-18T00:24:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584987267266314250" data-draft-id="7584742635500929051" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonçš„æ¡ä»¶ç¼–è¯‘-Type_Checking"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-18T00:24:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‡ªç”±ç”Ÿé•¿2024"/> <meta itemprop="url" content="https://juejin.cn/user/1591748569862670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonçš„æ¡ä»¶ç¼–è¯‘-Type_Checking
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748569862670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‡ªç”±ç”Ÿé•¿2024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:24:28.000Z" title="Thu Dec 18 2025 00:24:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>TYPE_CHECKING</code> æ˜¯ Python æ ‡å‡†åº“ <code>typing</code> æ¨¡å—ä¸­çš„ä¸€ä¸ªå¸¸é‡ï¼Œå…¶æœ¬è´¨æ˜¯ä¸€ä¸ª<strong>å¸ƒå°”å€¼ï¼ˆboolï¼‰</strong>ï¼Œåœ¨è¿è¡Œæ—¶å§‹ç»ˆä¸º <code>False</code>ï¼Œä½†åœ¨<strong>ç±»å‹æ£€æŸ¥å·¥å…·ï¼ˆå¦‚ mypyã€PyCharmã€VSCode ç­‰ï¼‰åˆ†æä»£ç æ—¶ä¼šè¢«è§†ä¸º <code>True</code></strong>ã€‚</p>
<hr/>
<h3 data-id="heading-0">ä¸€ã€è®¾è®¡ç›®çš„</h3>
<p><code>TYPE_CHECKING</code> çš„ä¸»è¦ç›®çš„æ˜¯ï¼š</p>
<blockquote>
<p><strong>è§£å†³ç±»å‹æ³¨è§£ä¸­çš„â€œå¾ªç¯å¯¼å…¥â€ï¼ˆcircular importï¼‰é—®é¢˜ï¼ŒåŒæ—¶é¿å…åœ¨è¿è¡Œæ—¶å¼•å…¥ä¸å¿…è¦çš„æ¨¡å—ä¾èµ–ã€‚</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-1">äºŒã€å·¥ä½œåŸç†</h3>
<ul>
<li>
<p>åœ¨<strong>ç¨‹åºå®é™…è¿è¡Œæ—¶</strong>ï¼š<br/>
<code>TYPE_CHECKING</code> çš„å€¼æ˜¯ <code>False</code>ï¼Œå› æ­¤ <code>if TYPE_CHECKING:</code> å—å†…çš„ä»£ç <strong>ä¸ä¼šè¢«æ‰§è¡Œ</strong>ï¼Œä¹Ÿä¸ä¼šè¢«å¯¼å…¥ã€‚</p>
</li>
<li>
<p>åœ¨<strong>é™æ€ç±»å‹æ£€æŸ¥æ—¶</strong>ï¼ˆä¾‹å¦‚ä½¿ç”¨ mypyï¼‰ï¼š<br/>
ç±»å‹æ£€æŸ¥å™¨ä¼š<strong>å‡è£… <code>TYPE_CHECKING</code> æ˜¯ <code>True</code></strong>ï¼Œä»è€Œåˆ†æ <code>if TYPE_CHECKING:</code> å—ä¸­çš„ç±»å‹æ³¨è§£ï¼Œç”¨äºç±»å‹æ¨æ–­å’Œæ£€æŸ¥ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸‰ã€å…¸å‹ä½¿ç”¨åœºæ™¯</h3>
<h4 data-id="heading-3">åœºæ™¯1ï¼šé¿å…å¾ªç¯å¯¼å…¥</h4>
<p>å‡è®¾æœ‰ä¸¤ä¸ªæ¨¡å—äº’ç›¸å¼•ç”¨ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># file: user.py</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TYPE_CHECKING
<span class="hljs-keyword">if</span> TYPE_CHECKING:
    <span class="hljs-keyword">from</span> .order <span class="hljs-keyword">import</span> Order  <span class="hljs-comment"># åªåœ¨ç±»å‹æ£€æŸ¥æ—¶å¯¼å…¥</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_orders</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-string">'Order'</span>]:
        ...
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># file: order.py</span>
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TYPE_CHECKING
<span class="hljs-keyword">if</span> TYPE_CHECKING:
    <span class="hljs-keyword">from</span> .user <span class="hljs-keyword">import</span> User

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-string">'User'</span>:
        ...
</code></pre>
<p>å¦‚æœä¸ä½¿ç”¨ <code>TYPE_CHECKING</code>ï¼Œç›´æ¥åœ¨æ¨¡å—é¡¶å±‚ <code>import</code> å¯¹æ–¹ï¼Œå°±ä¼šé€ æˆå¾ªç¯å¯¼å…¥é”™è¯¯ã€‚è€Œç”¨ <code>TYPE_CHECKING</code> åŒ…è£¹åï¼Œè¿è¡Œæ—¶ä¸ä¼šçœŸæ­£å¯¼å…¥ï¼Œä½†ç±»å‹æ£€æŸ¥å™¨ä»èƒ½ç†è§£ <code>Order</code> å’Œ <code>User</code> çš„ç±»å‹ã€‚</p>
<h4 data-id="heading-4">åœºæ™¯2ï¼šå‡å°‘è¿è¡Œæ—¶å¼€é”€</h4>
<p>æœ‰äº›ç±»å‹æ³¨è§£éœ€è¦å¯¼å…¥å¤§å‹æ¨¡å—ï¼ˆå¦‚ <code>pandas.DataFrame</code>ï¼‰ï¼Œä½†è¿™äº›ç±»å‹åªç”¨äºæ³¨è§£ï¼Œä¸éœ€è¦åœ¨è¿è¡Œæ—¶åŠ è½½ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TYPE_CHECKING

<span class="hljs-keyword">if</span> TYPE_CHECKING:
    <span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

<span class="hljs-keyword">def</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">data: <span class="hljs-string">'pd.DataFrame'</span></span>) -&gt; <span class="hljs-literal">None</span>:
    ...
</code></pre>
<p>è¿™æ ·å¯ä»¥é¿å…åœ¨è¿è¡Œæ—¶åŠ è½½ <code>pandas</code>ï¼ˆå¦‚æœå‡½æ•°ä½“ä¸­å¹¶ä¸çœŸæ­£ä½¿ç”¨ <code>pd</code>ï¼‰ï¼Œæå‡å¯åŠ¨é€Ÿåº¦æˆ–å‡å°‘å†…å­˜å ç”¨ã€‚</p>
<hr/>
<h3 data-id="heading-5">å››ã€æŠ€æœ¯æœ¬è´¨æ€»ç»“</h3>





























<table><thead><tr><th>å±æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç±»å‹</td><td><code>bool</code></td></tr><tr><td>è¿è¡Œæ—¶å€¼</td><td><code>False</code></td></tr><tr><td>ç±»å‹æ£€æŸ¥æ—¶å€¼</td><td>è¢«è§†ä¸º <code>True</code></td></tr><tr><td>æ‰€å±æ¨¡å—</td><td><code>typing.TYPE_CHECKING</code>ï¼ˆPython 3.5.2+ å¼•å…¥ï¼‰</td></tr><tr><td>ç”¨é€”</td><td>æ¡ä»¶æ€§åœ°ä»…åœ¨ç±»å‹æ£€æŸ¥æœŸé—´åŒ…å«ä»£ç </td></tr></tbody></table>
<hr/>
<h3 data-id="heading-6">äº”ã€è¡¥å……è¯´æ˜</h3>
<ul>
<li>ä» Python 3.7 å¼€å§‹ï¼Œé…åˆ <code>from __future__ import annotations</code>ï¼ˆPEP 563ï¼‰ï¼Œ<strong>æ‰€æœ‰æ³¨è§£é»˜è®¤ä»¥å­—ç¬¦ä¸²å½¢å¼å»¶è¿Ÿæ±‚å€¼</strong>ï¼Œè¿›ä¸€æ­¥å‡å°‘äº†å¯¹ <code>TYPE_CHECKING</code> çš„ä¾èµ–ï¼Œä½† <code>TYPE_CHECKING</code> ä»ç„¶åœ¨éœ€è¦<strong>å‰å‘å¼•ç”¨ä¹‹å¤–çš„ç±»å‹å¯¼å…¥</strong>æ—¶éå¸¸æœ‰ç”¨ã€‚</li>
<li>å³ä½¿ä½¿ç”¨äº† <code>from __future__ import annotations</code>ï¼Œå¦‚æœä½ åœ¨ç±»å‹æ³¨è§£ä¸­éœ€è¦ä½¿ç”¨<strong>å…¶ä»–æ¨¡å—ä¸­å®šä¹‰çš„ç±»å</strong>ï¼ˆè€Œéå­—ç¬¦ä¸²ï¼‰ï¼Œä»å¯èƒ½éœ€è¦ <code>TYPE_CHECKING</code> æ¥å®‰å…¨å¯¼å…¥ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-7">å…­ã€ç¤ºä¾‹å¯¹æ¯”</h3>
<p>âœ… æ­£ç¡®ç”¨æ³•ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TYPE_CHECKING

<span class="hljs-keyword">if</span> TYPE_CHECKING:
    <span class="hljs-keyword">from</span> heavy_module <span class="hljs-keyword">import</span> BigClass

<span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">x: <span class="hljs-string">'BigClass'</span></span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-keyword">pass</span>
</code></pre>
<p>âŒ é”™è¯¯ç”¨æ³•ï¼ˆå¯èƒ½å¯¼è‡´å¾ªç¯å¯¼å…¥æˆ–è¿è¡Œæ—¶å¼€é”€ï¼‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> heavy_module <span class="hljs-keyword">import</span> BigClass  <span class="hljs-comment"># è¿è¡Œæ—¶å°±å¯¼å…¥ï¼</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">x: BigClass</span>) -&gt; <span class="hljs-literal">None</span>:
    <span class="hljs-keyword">pass</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">æ€»ç»“</h3>
<p><code>TYPE_CHECKING</code> çš„æœ¬è´¨æ˜¯ä¸€ä¸ª<strong>è¿è¡Œæ—¶æ’ä¸º Falseã€ç±»å‹æ£€æŸ¥æ—¶è§†ä¸º True çš„å¸ƒå°”æ ‡å¿—</strong>ï¼Œç”¨äº<strong>æ¡ä»¶æ€§åœ°ä»…åœ¨ç±»å‹æ£€æŸ¥é˜¶æ®µå¼•å…¥ç±»å‹ä¿¡æ¯</strong>ï¼Œä»è€Œä¼˜é›…åœ°è§£å†³å¾ªç¯å¯¼å…¥å’Œæ€§èƒ½é—®é¢˜ï¼Œæ˜¯ Python ç±»å‹ç³»ç»Ÿä¸­ä¸€ä¸ªéå¸¸å®ç”¨çš„â€œç¼–è¯‘æœŸ/åˆ†ææœŸâ€æŠ€å·§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.jsç¬¬åå››ç« (ç¼“å­˜ç­–ç•¥)]]></title>    <link>https://juejin.cn/post/7584651851905712147</link>    <guid>https://juejin.cn/post/7584651851905712147</guid>    <pubDate>2025-12-18T00:30:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584651851905712147" data-draft-id="7584659460247224339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.jsç¬¬åå››ç« (ç¼“å­˜ç­–ç•¥)"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-18T00:30:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æ»¡zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.jsç¬¬åå››ç« (ç¼“å­˜ç­–ç•¥)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æ»¡zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:30:42.000Z" title="Thu Dec 18 2025 00:30:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¼“å­˜ç­–ç•¥(Cache Strategies)</h2>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå…‰æ•æ€§ç™«ç—«æ‚£è€…è¯·å‹¿è§‚çœ‹ï¼ï¼ï¼</p>
</blockquote>
<p>ç¼“å­˜ç­–ç•¥åˆ†ä¸¤ç§ï¼š</p>
<h4 data-id="heading-1">æœªå¯ç”¨ç¼“å­˜ç»„ä»¶:</h4>
<p>ç¡®ä¿<code>cacheComponents</code>é…ç½®ä¸º<code>false</code>æˆ–è€…ä¸é…ç½®ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-comment">/* config options here */</span>
  <span class="hljs-attr">cacheComponents</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ç¼“å­˜ç»„ä»¶(å…³é—­æˆ–è€…ä¸é…ç½®)</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<p>src/app/home/page.tsx(æ–°å»ºä¸€ä¸ªé¡µé¢)</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> randomImage = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://www.dmoe.cc/random.php?return=json'</span>) <span class="hljs-comment">//è¿™ä¸ªæ¥å£éšæœºè¿”å›ä¸€ä¸ªäºŒåˆºçŒ¿å›¾ç‰‡</span>
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> randomImage.<span class="hljs-title function_">json</span>()
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data)
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">width</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">height</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{data.imgurl}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"random image"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd7740981bfd4c4195cbed9d5969f1b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622642&amp;x-signature=X4cl%2FaUFEM9wUzOyY5t7sYjuQP4%3D" alt="9.gif" loading="lazy"/></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šå›¾åœ¨å¼€å‘æ¨¡å¼æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œæ¯æ¬¡åˆ·æ–°å›¾ç‰‡éƒ½ä¼šé‡æ–°è·å–ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/325f85e5f2b24c448e0318f5ef27ef74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622642&amp;x-signature=TwJ6rGuYChJfooZjCMk5rz9url8%3D" alt="10.gif" loading="lazy"/></p>
<p>ä½†æ˜¯å½“æˆ‘ä»¬è¿›è¡Œæ„å»ºä¹‹å<code>npm run build &amp;&amp; npm run start</code>æˆ‘ä»¬å‘ç°æ¯æ¬¡åˆ·æ–°å›¾ç‰‡éƒ½ä¸ä¼šå˜åŒ–ï¼Œå§‹ç»ˆæ˜¯åŒä¸€ä¸ªå›¾ç‰‡ã€‚</p>
<p>åŸå› æ˜¯ï¼šNext.jsä¼šå°½å¯èƒ½å¤šçš„è¿›è¡Œç¼“å­˜ï¼Œä»¥æé«˜æ€§èƒ½é™ä½æˆæœ¬ï¼Œè¿™æ„å‘³ç€è·¯ç”±ä¼šè¢«é™æ€æ¸²æŸ“ï¼Œä»¥åŠæ•°æ®è¯·æ±‚ä¹Ÿä¼šè¢«ç¼“å­˜ï¼Œé™¤éç¦ç”¨ç¼“å­˜ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7021a1ea242c4d6894f4547685b4b348~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622642&amp;x-signature=kg25Oem%2BCTsnYOFHBMxiHbpZzBI%3D" alt="image.png" loading="lazy"/></p>
<p>æˆ‘ä»¬è§‚å¯Ÿä¸Šå›¾å¯ä»¥å‘ç°æœ‰ä¸¤ä¸ªç¬¦å·ï¼š</p>
<ul>
<li><code>â—‹</code>(ç©ºå¿ƒåœ†): è¡¨ç¤ºè¿™æ˜¯é¢„æ¸²æŸ“çš„é™æ€å†…å®¹ã€‚</li>
<li><code>Æ’</code>(få‡½æ•°ç¬¦): è¡¨ç¤ºè¿™æ˜¯åŠ¨æ€å†…å®¹ã€‚</li>
</ul>
<h4 data-id="heading-2">é‚£ä¹ˆå¦‚ä½•é€€å‡ºç¼“å­˜å‘¢?</h4>
<h5 data-id="heading-3">ç¬¬ä¸€ç§æ–¹æ¡ˆé‡æ–°éªŒè¯</h5>
<p>ä½¿ç”¨<code>revalidate</code>å±æ€§ï¼Œå¯ä»¥è®¾ç½®ç¼“å­˜æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> revalidate = <span class="hljs-number">5</span> <span class="hljs-comment">// 5ç§’åé‡æ–°æ›´æ–°</span>
<span class="hljs-comment">//export const revalidate = 0 // è®¾ç½®ä¸º0è¡¨ç¤ºä¸ç¼“å­˜</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> randomImage = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://www.dmoe.cc/random.php?return=json'</span>)
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> randomImage.<span class="hljs-title function_">json</span>()
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">width</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">height</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{data.imgurl}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"random image"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16218a9968414d3faba6fcb1abb5c7b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622642&amp;x-signature=W%2Bn8B5R4HlmQEAcGNxqmfyV69go%3D" alt="image.png" loading="lazy"/></p>
<p>å½“æˆ‘ä»¬é‡æ–°è¿è¡Œä¹‹åï¼Œæ¯è¿‡5ç§’ï¼Œå›¾ç‰‡ä¼šé‡æ–°è·å–ï¼Œå¹¶ä¸”ä¼šæ˜¾ç¤ºæ–°çš„å›¾ç‰‡ã€‚</p>
<h5 data-id="heading-4">ç¬¬äºŒç§æ–¹æ¡ˆä½¿ç”¨dynamicå±æ€§</h5>
<p>ä½¿ç”¨<code>dynamic</code>å±æ€§ï¼Œå¹¶ä¸”è®¾ç½®ä¸º<code>force-dynamic</code>ï¼Œè¡¨ç¤ºå°†ç¦ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šé‡æ–°è·å–æ•°æ®ã€‚</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> dynamic = <span class="hljs-string">'force-dynamic'</span> <span class="hljs-comment">// åŠ¨æ€æ›´æ–° ç¼“å­˜ç»„ä»¶ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ª é»˜è®¤éƒ½æ˜¯åŠ¨æ€å†…å®¹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> randomImage = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://www.dmoe.cc/random.php?return=json'</span>)
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> randomImage.<span class="hljs-title function_">json</span>()
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">width</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">height</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{data.imgurl}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"random image"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/394e6f10671e4c0981fd4237c07b19ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622642&amp;x-signature=3kJkaaxsy0g4aFASv0gswvYpBQI%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-5">ç¬¬ä¸‰ç§æ–¹æ¡ˆä½¿ç”¨ç¦ç”¨ç¼“å­˜</h5>
<p>ä½¿ç”¨<code>cache</code>å±æ€§ï¼Œå¹¶ä¸”è®¾ç½®ä¸º<code>no-store</code>ï¼Œè¡¨ç¤ºå°†ç¦ç”¨ç¼“å­˜ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½ä¼šé‡æ–°è·å–æ•°æ®ã€‚</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> randomImage = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://www.dmoe.cc/random.php?return=json'</span>,{<span class="hljs-attr">cache</span>:<span class="hljs-string">'no-store'</span>})
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> randomImage.<span class="hljs-title function_">json</span>()
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">width</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">height</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{data.imgurl}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"random image"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<h5 data-id="heading-6">ç¬¬å››ç§æ–¹æ¡ˆä½¿ç”¨ä»»æ„åŠ¨æ€å†…å®¹API</h5>
<p>å½“ä½ ä½¿ç”¨ä»¥ä¸‹ä»»æ„APIæ—¶ï¼Œè¯¥è·¯ç”±ä¼šè¢«è§†ä¸ºåŠ¨æ€å†…å®¹ï¼Œä¸ä¼šè¢«ç¼“å­˜ã€‚</p>
<ul>
<li>cookies</li>
<li>headers</li>
<li>connection</li>
<li>searchParams</li>
<li>fetchå’Œ{ cache: 'no-store' }</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { connection } <span class="hljs-keyword">from</span> <span class="hljs-string">"next/server"</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">connection</span>()
    <span class="hljs-keyword">const</span> randomImage = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://www.dmoe.cc/random.php?return=json'</span>)
    <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> randomImage.<span class="hljs-title function_">json</span>()
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">width</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">height</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{data.imgurl}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"random image"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<h4 data-id="heading-7">å¯ç”¨ç¼“å­˜ç»„ä»¶:</h4>
<p>ç¡®ä¿<code>cacheComponents</code>é…ç½®ä¸º<code>true</code>ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">NextConfig</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"next"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">nextConfig</span>: <span class="hljs-title class_">NextConfig</span> = {
  <span class="hljs-comment">/* config options here */</span>
  <span class="hljs-attr">cacheComponents</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//å¼€å¯ç¼“å­˜ç»„ä»¶</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> nextConfig;
</code></pre>
<blockquote>
<p>å¯ç”¨ç¼“å­˜ç»„ä»¶ä¹‹åï¼Œæ‰€æœ‰ç»„ä»¶é»˜è®¤ä¸º<code>åŠ¨æ€å†…å®¹</code>ï¼Œå› æ­¤<code>export const dynamic = 'force-dynamic'</code>ä¸éœ€è¦é…ç½®ã€‚</p>
</blockquote>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">DynamicImage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> randomImage = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://www.dmoe.cc/random.php?return=json'</span>)
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> randomImage.<span class="hljs-title function_">json</span>()
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">width</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">height</span>=<span class="hljs-string">{500}</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{data.imgurl}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"random image"</span> /&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {

    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">DynamicImage</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4a284ed5a7e449d97c42f63ca151412~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622642&amp;x-signature=zH%2F83nsVhxSeSj3nA%2FCY0z9ydVM%3D" alt="image.png" loading="lazy"/></p>
<p>ç„¶åä½ ä¼šå‘ç°å¤šäº†ä¸€ä¸ªç¬¦å·</p>
<ul>
<li><code>â—</code>(éƒ¨åˆ†é¢„æ¸²æŸ“): è¡¨ç¤ºé¡µé¢é¢„æ¸²æŸ“ä¸ºé™æ€ HTMLï¼ŒåŒæ—¶åŒ…å«åŠ¨æ€æœåŠ¡å™¨æµå¼ä¼ è¾“çš„å†…å®¹ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonçš„ç§æœ‰æ–¹æ³•æŠ€å·§-åŒä¸‹åˆ’çº¿å¼€å¤´]]></title>    <link>https://juejin.cn/post/7584655946087710766</link>    <guid>https://juejin.cn/post/7584655946087710766</guid>    <pubDate>2025-12-18T00:34:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584655946087710766" data-draft-id="7584655946087694382" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonçš„ç§æœ‰æ–¹æ³•æŠ€å·§-åŒä¸‹åˆ’çº¿å¼€å¤´"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-18T00:34:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‡ªç”±ç”Ÿé•¿2024"/> <meta itemprop="url" content="https://juejin.cn/user/1591748569862670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonçš„ç§æœ‰æ–¹æ³•æŠ€å·§-åŒä¸‹åˆ’çº¿å¼€å¤´
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748569862670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‡ªç”±ç”Ÿé•¿2024
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:34:22.000Z" title="Thu Dec 18 2025 00:34:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Python ä¸­ï¼Œä»¥<strong>ä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´</strong>ï¼ˆå¦‚ <code>__method</code>ï¼‰çš„æ–¹æ³•æˆ–å±æ€§ï¼Œå¹¶ä¸å®Œå…¨æ˜¯â€œç§æœ‰æ–¹æ³•â€ï¼ˆprivate methodï¼‰â€”â€”å› ä¸º Python å¹¶æ²¡æœ‰åƒ Java æˆ– C++ é‚£æ ·ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚ä½†è¿™ç§å‘½åæ–¹å¼ä¼šè§¦å‘ä¸€ç§å«åš <strong>åç§°æ”¹å†™</strong>ï¼ˆname manglingï¼‰çš„æœºåˆ¶ï¼Œä»è€Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç°â€œç§æœ‰æ€§â€ã€‚</p>
<h3 data-id="heading-0">1. åç§°æ”¹å†™ï¼ˆName Manglingï¼‰</h3>
<p>å½“ä½ åœ¨ä¸€ä¸ªç±»ä¸­å®šä¹‰ä¸€ä¸ªä»¥åŒä¸‹åˆ’çº¿å¼€å¤´ã€ä¸”ä¸ä»¥åŒä¸‹åˆ’çº¿ç»“å°¾çš„æ–¹æ³•æˆ–å±æ€§æ—¶ï¼ŒPython è§£é‡Šå™¨ä¼šè‡ªåŠ¨å°†å…¶åç§°æ”¹å†™ä¸ºï¼š</p>
<pre><code class="hljs">_ClassName__original_name
</code></pre>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.__private_var = <span class="hljs-number">42</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__private_method</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> <span class="hljs-string">"This is private"</span>

obj = MyClass()
<span class="hljs-comment"># obj.__private_method()  # AttributeError!</span>
<span class="hljs-built_in">print</span>(obj._MyClass__private_method())  <span class="hljs-comment"># å¯ä»¥è®¿é—®ï¼Œä½†ä¸æ¨è</span>
</code></pre>
<p>è™½ç„¶ä½ ä»ç„¶å¯ä»¥é€šè¿‡ <code>_ClassName__name</code> çš„æ–¹å¼è®¿é—®åˆ°è¿™ä¸ªâ€œç§æœ‰â€æˆå‘˜ï¼Œä½†è¿™æ˜¯ä¸€ç§<strong>çº¦å®š+è¯­è¨€æœºåˆ¶</strong>ï¼Œç›®çš„æ˜¯é˜²æ­¢å­ç±»æ„å¤–è¦†ç›–çˆ¶ç±»çš„å†…éƒ¨æ–¹æ³•ï¼Œä¹Ÿæç¤ºå¼€å‘è€…â€œè¿™æ˜¯å†…éƒ¨ä½¿ç”¨çš„ï¼Œä¸è¦ç›´æ¥è°ƒç”¨â€ã€‚</p>
<hr/>
<h3 data-id="heading-1">2. ä¸å•ä¸‹åˆ’çº¿çš„åŒºåˆ«</h3>
<ul>
<li><strong>å•ä¸‹åˆ’çº¿å¼€å¤´</strong>ï¼ˆå¦‚ <code>_method</code>ï¼‰ï¼šåªæ˜¯<strong>çº¦å®š</strong>è¡¨ç¤ºâ€œå†…éƒ¨ä½¿ç”¨â€ï¼Œä¸ä¼šè§¦å‘åç§°æ”¹å†™ï¼Œå¤–éƒ¨ä»å¯è®¿é—®ã€‚</li>
<li><strong>åŒä¸‹åˆ’çº¿å¼€å¤´</strong>ï¼ˆå¦‚ <code>__method</code>ï¼‰ï¼šè§¦å‘åç§°æ”¹å†™ï¼Œæä¾›æ›´å¼ºçš„å°è£…æš—ç¤ºã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-2">3. ç‰¹æ®Šæ–¹æ³•ï¼ˆé­”æœ¯æ–¹æ³•ï¼‰ä¾‹å¤–</h3>
<p>æ³¨æ„ï¼šå¦‚æœæ–¹æ³•å<strong>å‰åéƒ½æœ‰ä¸¤ä¸ªä¸‹åˆ’çº¿</strong>ï¼ˆå¦‚ <code>__init__</code>, <code>__str__</code>ï¼‰ï¼Œè¿™æ˜¯ Python çš„<strong>ç‰¹æ®Šæ–¹æ³•</strong>ï¼ˆä¹Ÿå«é­”æœ¯æ–¹æ³•ï¼‰ï¼Œ<strong>ä¸ä¼š</strong>è¢«åç§°æ”¹å†™ï¼Œä¹Ÿä¸è¡¨ç¤ºç§æœ‰ï¼Œè€Œæ˜¯ç”¨äºå®ç°ç‰¹å®šè¯­è¨€ç‰¹æ€§ã€‚</p>
<hr/>
<h3 data-id="heading-3">æ€»ç»“</h3>
<ul>
<li>Python æ²¡æœ‰çœŸæ­£çš„â€œç§æœ‰æ–¹æ³•â€ã€‚</li>
<li><code>__method</code> ä¼šè¢«åç§°æ”¹å†™ï¼Œèµ·åˆ°<strong>æ¨¡æ‹Ÿç§æœ‰</strong>çš„ä½œç”¨ã€‚</li>
<li>ä»å¯é€šè¿‡ <code>_ClassName__method</code> è®¿é—®ï¼Œä½†åº”é¿å…è¿™æ ·åšã€‚</li>
<li>è¿™æ˜¯ä¸€ç§<strong>çº¦å®š + è¯­è¨€æœºåˆ¶</strong>ï¼Œç”¨äºå°è£…å’Œé¿å…å‘½åå†²çªã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TRAE å†… GPT-5.2 å®æµ‹ï¼š10 è½®å¯¹è¯ï¼Œç”Ÿæˆçš„ä»£ç ä¸€æ¬¡éƒ½æ²¡è®©æˆ‘æ’¤å›]]></title>    <link>https://juejin.cn/post/7584651851905728531</link>    <guid>https://juejin.cn/post/7584651851905728531</guid>    <pubDate>2025-12-18T00:39:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584651851905728531" data-draft-id="7584650421125218345" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TRAE å†… GPT-5.2 å®æµ‹ï¼š10 è½®å¯¹è¯ï¼Œç”Ÿæˆçš„ä»£ç ä¸€æ¬¡éƒ½æ²¡è®©æˆ‘æ’¤å›"/> <meta itemprop="keywords" content="Trae,GPT,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-18T00:39:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å“¥æ•°æ™ºè°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TRAE å†… GPT-5.2 å®æµ‹ï¼š10 è½®å¯¹è¯ï¼Œç”Ÿæˆçš„ä»£ç ä¸€æ¬¡éƒ½æ²¡è®©æˆ‘æ’¤å›
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å“¥æ•°æ™ºè°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:39:14.000Z" title="Thu Dec 18 2025 00:39:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ¥ä»Šå¤©è®¡åˆ’ç ”ç©¶ä¸‹ <code>Cursor</code> çš„ <code>Debug Mode</code> çš„ã€‚</p>
<p>ä½†è®¡åˆ’èµ¶ä¸ä¸Šå˜åŒ–ï¼Œä¸‹åˆåŸå®šçš„é¡¹ç›®å¼€å‘æœ‰ç‚¹è¶…å‡ºé¢„æœŸçš„é¡ºåˆ©ï¼Œå°±æƒ³ç€ä¸€é¼“ä½œæ°”æŠŠæ˜å¤©ç›¸å…³çš„ä»»åŠ¡ä¸€èµ·åšå®Œå¾—äº†ã€‚</p>
<p>ä¸‹åˆçš„ä½¿ç”¨çš„ <code>TRAE å›½é™…ç‰ˆ</code> + <code>GPT-5.2</code>ï¼Œ<strong>æ²¡é”™ï¼ŒTRAE å·²ç»ä¸Šäº† GPT-5.2</strong>ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0dc253b1c2e4d3ab6af4f9bb78ada5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623154&amp;x-signature=JxZjJxQrUi%2Bp5dNS%2FQOXmw2vSik%3D" alt="" loading="lazy"/></p>
<p>æ›´æ–°é€Ÿåº¦ä¸Šï¼Œä½¿ç”¨ <code>TRAE</code> çš„åŒå­¦ä»¬åº”è¯¥æ·±æœ‰ä½“ä¼šï¼Œ2ã€3å¤©æ›´æ–°ä¸€æ¬¡éƒ½æ˜¯éå¸¸å¸¸è§çš„ã€‚</p>
<p>é¡¹ç›®å…·ä½“å†…å®¹å°±ä¸ç»†è¯´äº†ï¼Œæ•´ä½“æ˜¯ä¸€ä¸ª <code>Vue3</code> + <code>Element Plus</code> + <code>Python Flask</code> + <code>MySQL</code> çš„å†…éƒ¨å·¥ç¨‹ï¼Œä»£ç é€»è¾‘ä¸Šæ˜¯å‰åç«¯åˆ†ç¦»çš„ï¼Œå…¶ä¸­éœ€è¦è°ƒç”¨ç¬¬ä¸‰æ–¹ç»ˆç«¯å‘½ä»¤ã€‚</p>
<p>æœŸé—´æˆ‘ä¸€å…±èŠ±äº†<strong>4ä¸ªå°æ—¶</strong>ï¼Œå®Œæˆäº†<strong>3ä¸ªæ¨¡å—</strong>ï¼Œ<strong>2ä¸ªå¤§åŠŸèƒ½</strong>ï¼Œé¡ºä¾¿è¿˜åœ¨å›¢é˜Ÿå†…ç®€å•åˆ†äº«äº† <code>GPT-5.2</code> çš„ä½¿ç”¨ä½“éªŒã€‚</p>
<p>å¯¹è¯å¤§æ¦‚æœ‰ 10 è½®ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li>åˆç‰ˆä¸¤ä¸ªå…³è”æ¨¡å—çš„ä¸€æ¬¡æ€§ç”Ÿæˆ</li>
<li>æ–°å¢å­—æ®µçš„å‰åç«¯ä»£ç æ›´æ–°</li>
<li>æ ¹æ®ç¬¬ä¸‰æ–¹æ–‡æ¡£å®ç°å¤–éƒ¨ç»ˆç«¯å‘½ä»¤è°ƒç”¨</li>
<li>è‡ªç„¶è¯­è¨€å®ç° UI ä¸Šçš„ç»†å°è°ƒæ•´</li>
</ul>
<p>ä¸Šè¿°å¯¹è¯æŒ‡ä»¤çš„åœºæ™¯å€’æ˜¯å¸¸è§ï¼Œä½†æ˜¯ä¸‹åˆå®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œ<strong>æ²¡æœ‰ä¸€æ¬¡ç”Ÿæˆç»“æœéœ€è¦æ’¤å›</strong>ï¼Œè¿™ä¸ªå°±å¾ˆææ€–äº†ã€‚</p>
<p>ç›´è¿½ <code>Claude 4</code> è¿˜èƒ½ç”¨çš„æ—¶å€™ï¼Œç”šè‡³åœ¨æŒ‡ä»¤éµå¾ªä¸Šï¼Œæ„Ÿè§‰æ¯” <code>Claude 4</code> è¿˜è¦å¬è¯ä¸€äº›ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89734d4b734a4f90917af29bd6be85e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623154&amp;x-signature=Hj5cKeug0fw71qyNdmIOyFAjDBo%3D" alt="ç›´è§‚ä½¿ç”¨æ„Ÿå—ä¸Šï¼Œè¿™å¼ å›¾è¿˜æ˜¯æ¯”è¾ƒé è°±çš„" loading="lazy"/></p>
<p>å¯¹äºè¿™ç§éå¸¸è§„é¡¹ç›®ï¼Œç”±äºæ¶‰åŠåˆ°æ‰‹å†™éƒ¨åˆ†ä»£ç ï¼Œæˆ‘ä¸€èˆ¬ä¼šä½¿ç”¨ <code>Cursor</code>ï¼Œä»Šå¤©ä¸ºä»€ä¹ˆæ²¡æœ‰ä½¿ç”¨å‘¢ï¼Ÿ</p>
<p>å› ä¸ºæˆ‘çš„ <code>Pro</code> è®¢é˜…å·²ç»è¶…äº†ï¼Œè¿™ä¸ªè®¢é˜…å‘¨æœŸæ‰åˆšè¿‡äº†ä¸€åŠå•Šã€‚æˆ‘æŸ¥çœ‹äº†ç”¨é‡æ˜ç»†ï¼Œ<code>Claude 4.5</code> çœŸçš„åºŸ <code>Token</code>ï¼Œå¤§å®¶å¦‚æœä¹Ÿæœ‰ä½¿ç”¨çš„ï¼Œä¸€å®šè¦æ³¨æ„ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e7f7af9ec3e4303ae7808f8847f0563~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623154&amp;x-signature=rtLmpTVxXAS0NvbKkNP4PGHVGO8%3D" alt="ä¸€ä¸ªtokenæ¶ˆè€—çš„ç›´è§‚å¯¹æ¯”" loading="lazy"/></p>
<p>è™½ç„¶ï¼Œå¤–ç•Œå¯¹ <code>GPT-5.2</code> çš„è¯„ä»·è¤’è´¬ä¸ä¸€ï¼Œä½†æˆ‘æ„Ÿè§‰åœ¨ç¼–ç¨‹åœºæ™¯ä¸­ï¼Œè¡¨ç°çœŸçš„å¾ˆæ£’ï¼Œéå¸¸å€¼å¾—å¤§å®¶äº²è‡ªè¯•è¯•ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»£ç†å¼äººå·¥æ™ºèƒ½ï¼šè®©å¤§æ¨¡å‹ä»â€œè¢«åŠ¨å›ç­”â€èµ°å‘â€œä¸»åŠ¨æ‰§è¡Œâ€]]></title>    <link>https://juejin.cn/post/7584730308752015410</link>    <guid>https://juejin.cn/post/7584730308752015410</guid>    <pubDate>2025-12-18T00:34:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584730308752015410" data-draft-id="7584714813365633062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»£ç†å¼äººå·¥æ™ºèƒ½ï¼šè®©å¤§æ¨¡å‹ä»â€œè¢«åŠ¨å›ç­”â€èµ°å‘â€œä¸»åŠ¨æ‰§è¡Œâ€"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-18T00:34:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜é‡‘å®‰ä¸œå°¼"/> <meta itemprop="url" content="https://juejin.cn/user/1521379823340792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»£ç†å¼äººå·¥æ™ºèƒ½ï¼šè®©å¤§æ¨¡å‹ä»â€œè¢«åŠ¨å›ç­”â€èµ°å‘â€œä¸»åŠ¨æ‰§è¡Œâ€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379823340792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜é‡‘å®‰ä¸œå°¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:34:17.000Z" title="Thu Dec 18 2025 00:34:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>ä¸€ã€ä»ç”Ÿæˆå¼ AI åˆ°ä»£ç†å¼ AIï¼šæ™ºèƒ½çš„è¿›åŒ–æ–¹å‘</strong>**</p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>è¿‡å»å‡ å¹´ï¼Œç”Ÿæˆå¼ AI å¸¦æ¥äº†æƒŠäººçš„å†…å®¹ç”Ÿäº§èƒ½åŠ›â€”â€”å®ƒèƒ½å†™ä»£ç ã€èƒ½å›ç­”é—®é¢˜ã€èƒ½ç”Ÿæˆå›¾ç‰‡ï¼Œä½†å®ƒä¾ç„¶æ˜¯â€œè¢«åŠ¨çš„â€ã€‚</p>
<p>æ— è®ºæ˜¯ ChatGPTã€Claude è¿˜æ˜¯ Geminiï¼Œå½“ä½ è¾“å…¥ä¸€ä¸ªæŒ‡ä»¤ï¼Œå®ƒå°±æ‰§è¡Œä¸€ä¸ªå“åº”ï¼›ä½†ä¸€æ—¦ä¸Šä¸‹æ–‡ç»“æŸï¼Œå®ƒå°±åƒâ€œæ–­ç”µâ€çš„æœºå™¨äººï¼Œå¤±å»äº†å»¶ç»­æ€§ä¸ç›®æ ‡æ„è¯†ã€‚</p>
<p>ç›´åˆ° 2024 å¹´åº•ï¼Œ<strong>ä»£ç†å¼äººå·¥æ™ºèƒ½ï¼ˆAgentic AIï¼‰</strong> çš„æ¦‚å¿µçˆ†å‘ã€‚<br/>
æ— è®ºæ˜¯ Anthropic æ¨å‡ºçš„ MCPï¼ˆModel Context Protocolï¼‰ï¼Œè¿˜æ˜¯ <strong>äºšé©¬é€Šäº‘ï¼ˆAmazon Cloudï¼‰</strong> çš„ <strong>Amazon Bedrock AgentCore</strong>ï¼Œè¡Œä¸šéƒ½åœ¨æœç€åŒä¸€ä¸ªæ–¹å‘å‰è¿›ï¼š<br/>
è®© AI ä»â€œå¯¹è¯åŠ©æ‰‹â€å‡çº§ä¸ºâ€œä¸»åŠ¨ä»£ç†äººâ€ï¼Œèƒ½æ„ŸçŸ¥ç¯å¢ƒã€è§„åˆ’ä»»åŠ¡ã€è°ƒç”¨å·¥å…·ã€æ‰§è¡Œè¡ŒåŠ¨ï¼Œå¹¶åœ¨è¿‡ç¨‹ä¸­è‡ªæˆ‘åæ€ä¸ä¼˜åŒ–ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51654f2ccf814b189a0ec0d01bf96b2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622857&amp;x-signature=JwDupbMulv6W8rAOnEJXA7GhCI4%3D" alt="" loading="lazy"/></p>
<p>æ¢å¥è¯è¯´ï¼Œ<strong>AI ä¸å†æ˜¯ä¸€ä¸ªå›ç­”è€…ï¼Œè€Œæ˜¯ä¸€ä¸ªæ‰§è¡Œè€…ã€‚</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Ffree%3Ftrk%3D9469125f-7396-4b5a-8ec9-2c71ac1c7f30%26sc_channel%3Dsm" target="_blank" title="https://aws.amazon.com/cn/free?trk=9469125f-7396-4b5a-8ec9-2c71ac1c7f30&amp;sc_channel=sm" ref="nofollow noopener noreferrer"><strong>ã€ä¼ é€é—¨ã€‘</strong></a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af9b2af6de8a44f2a73cc48ccabadd96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622857&amp;x-signature=3%2F%2Feyh%2Bj8ju5%2BA4p9dECK%2FT0Mzs%3D" alt="" loading="lazy"/></p>






<table><thead><tr><th>å›¾ç¤ºè¯´æ˜ï¼šæ™ºèƒ½ä½“ä»â€œè¢«åŠ¨å›ç­”â€åˆ°â€œä¸»åŠ¨æ‰§è¡Œâ€çš„æ¼”åŒ–ï¼Œæ­£æ˜¯ AI èƒ½åŠ›ä»é™æ€åˆ°åŠ¨æ€çš„è·ƒè¿ã€‚</th></tr></thead></table>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>äºŒã€ä»£ç†å¼ AI çš„æ ¸å¿ƒåŸç†ï¼šæ„ŸçŸ¥ã€æ€è€ƒã€è¡ŒåŠ¨ã€åæ€</strong></p>
<p>å¦‚æœè¯´ç”Ÿæˆå¼ AI æ˜¯â€œè¢«åŠ¨é—®ç­”â€ï¼Œé‚£ä¹ˆä»£ç†å¼ AI çš„æœ¬è´¨ï¼Œå°±æ˜¯è®©æ¨¡å‹èƒ½ä¸»åŠ¨å®Œæˆå®Œæ•´çš„ä»»åŠ¡é—­ç¯ã€‚</p>
<p>å®ƒéµå¾ªä¸€ä¸ªç»å…¸çš„å¾ªç¯é€»è¾‘ï¼š</p>






<table><thead><tr><th><strong>æ„ŸçŸ¥ï¼ˆPerceiveï¼‰ â†’ æ€è€ƒï¼ˆReasonï¼‰ â†’ è¡ŒåŠ¨ï¼ˆActï¼‰ â†’ åæ€ï¼ˆReflectï¼‰</strong></th></tr></thead></table>
<p><strong>æ„ŸçŸ¥</strong>ï¼šä»£ç†ä»å¤–éƒ¨ç³»ç»Ÿã€æ•°æ®åº“æˆ–äº’è”ç½‘ä¸­æ”¶é›†ä¿¡æ¯ï¼›</p>
<p><strong>æ€è€ƒ</strong>ï¼šä»£ç†æ ¹æ®ç›®æ ‡å’Œä¸Šä¸‹æ–‡ç”Ÿæˆè¡ŒåŠ¨è®¡åˆ’ï¼›</p>
<p><strong>è¡ŒåŠ¨</strong>ï¼šè°ƒç”¨å·¥å…·æˆ–æ‰§è¡Œä»£ç ä»¥å®ç°ä»»åŠ¡ç›®æ ‡ï¼›</p>
<p><strong>åæ€</strong>ï¼šæ£€æŸ¥æ‰§è¡Œç»“æœï¼Œä¿®æ­£é”™è¯¯æˆ–ä¼˜åŒ–ä¸‹ä¸€æ­¥ç­–ç•¥ã€‚</p>
<p>è¿™å¥—å¾ªç¯æœºåˆ¶ï¼Œä½¿å¾— AI æ‹¥æœ‰äº†ç±»ä¼¼â€œå…ƒè®¤çŸ¥â€çš„è‡ªæˆ‘è°ƒèŠ‚èƒ½åŠ›ã€‚å®ƒä¸å†å±€é™äºâ€œå¯¹è¯å®Œæˆåº¦â€ï¼Œè€Œæ˜¯å¯ä»¥åœ¨å¤æ‚ç¯å¢ƒä¸‹æŒç»­å­¦ä¹ ä¸è°ƒæ•´ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edba89244a4249c38bbf159d6154fbd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622857&amp;x-signature=cKM6UYgNicwAAF3DQw0V10S5Asw%3D" alt="" loading="lazy"/></p>






<table><thead><tr><th>å›¾ç¤ºè¯´æ˜ï¼šä»£ç†é€šè¿‡æŒç»­å¾ªç¯å®ç°è‡ªæˆ‘æ ¡æ­£ï¼Œå½¢æˆâ€œæ™ºèƒ½åé¦ˆç¯â€ã€‚</th></tr></thead></table>
<p><strong>Amazon Bedrock AgentCore</strong> æ­£æ˜¯è¿™å¥—æ¶æ„çš„å·¥ç¨‹åŒ–è½åœ°æ–¹æ¡ˆã€‚<br/>
å®ƒæä¾›äº†å®Œæ•´çš„ä»£ç†åŸºç¡€è®¾æ–½ï¼š<strong>è¿è¡Œæ—¶ã€å†…å­˜ã€èº«ä»½ç®¡ç†ã€ç½‘å…³ã€å¯è§‚æµ‹æ€§å’Œå·¥å…·é›†æˆ</strong>ï¼Œå…è®¸å¼€å‘è€…ç”¨ä»»æ„æ¨¡å‹ã€å®‰å…¨åœ°éƒ¨ç½²å¤šä»£ç†ç³»ç»Ÿã€‚</p>
<p>å¦‚æœæŠŠç”Ÿæˆå¼ AI æ¯”ä½œâ€œå¤§è„‘â€ï¼Œé‚£ä»£ç†å¼ AI å°±æ˜¯<strong>å¤§è„‘ + ç¥ç»ç³»ç»Ÿ + è‚¢ä½“åŠ¨ä½œ</strong>ã€‚<br/>
å®ƒèƒ½æ€è€ƒï¼Œä¹Ÿèƒ½åŠ¨ï¼Œè¿˜èƒ½ä¸å…¶ä»–ä»£ç†åä½œå®Œæˆå¤æ‚ç›®æ ‡ã€‚</p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>ä¸‰ã€åœ¨äºšé©¬é€Šäº‘ä¸Šæ„å»ºä½ çš„ç¬¬ä¸€ä¸ªä»£ç†</strong></p>
<p>ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£ï¼Œæˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸ªç®€å•çš„ä»£ç†ç¤ºä¾‹ï¼š</p>
<p>è®©ä¸€ä¸ª AI è‡ªåŠ¨ç”Ÿæˆé”€å”®æŠ¥å‘Šã€‚</p>
<p>åˆå§‹åŒ–ç¯å¢ƒ</p>
<p>åœ¨ <strong>Amazon Bedrock æ§åˆ¶å°</strong>ä¸­å¯ç”¨ <strong>AgentCore</strong>ï¼Œå¹¶é…ç½®è®¿é—® Amazon Qã€S3 ä¸ DynamoDBã€‚</p>
<p>å®šä¹‰ä»£ç†ä¸å·¥å…·</p>






<table><thead><tr><th>Python from bedrock_agentcore import Agent, Tool, Memory  # å®šä¹‰å¯è°ƒç”¨å·¥å…· s3_tool = Tool("S3Reader", action="read_sales_data") report_tool = Tool("ReportWriter", action="generate_summary")  # åˆ›å»ºä»£ç†å®ä¾‹ sales_agent = Agent( name="SalesReporter", memory=Memory(), tools=[s3_tool, report_tool] )</th></tr></thead></table>
<p>è®¾å®šä»»åŠ¡ä¸æ‰§è¡Œ</p>






<table><thead><tr><th>Python goal = "ç”Ÿæˆä¸Šå‘¨é”€å”®æ±‡æ€»æŠ¥å‘Š" sales_agent.plan(goal) sales_agent.act()</th></tr></thead></table>
<p>è¾“å‡ºç»“æœï¼ˆå¯è§†åŒ–æ‰§è¡Œè®¡åˆ’ï¼‰</p>






<table><thead><tr><th>Bash ä»£ç†è®¡åˆ’ï¼š 1. ä» S3 è·å–é”€å”®æ•°æ® 2. æ±‡æ€»ç»“æœå¹¶ç”ŸæˆæŠ¥è¡¨ 3. è¾“å‡ºè‡³ Dashboard</th></tr></thead></table>
<p>çŸ­çŸ­å‡ è¡Œä»£ç ï¼ŒAI å°±èƒ½ä¸»åŠ¨å®Œæˆä¸€ä¸ªå®Œæ•´æµç¨‹ã€‚</p>
<p>è¿™å°±æ˜¯â€œä»£ç†å¼â€çš„å…³é”®å·®å¼‚â€”â€”å®ƒå…·å¤‡æ‰§è¡Œé“¾æ¡ï¼Œè€Œä¸ä»…ä»…æ˜¯æ–‡å­—ç”Ÿæˆã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21debced366441b7886ebb1e469ff540~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5a6J5Lic5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766622857&amp;x-signature=f%2BAN1PsKbxIIzGzEinbSnSJtKLU%3D" alt="" loading="lazy"/></p>






<table><thead><tr><th>å›¾ç¤ºè¯´æ˜ï¼šä»£ç†é€šè¿‡å·¥å…·è°ƒç”¨ä¸ç»“æœåé¦ˆå½¢æˆé—­ç¯ï¼Œæ„æˆå®Œæ•´çš„æ‰§è¡Œè·¯å¾„ã€‚</th></tr></thead></table>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>å››ã€ä¼ä¸šçº§åº”ç”¨çš„ä»·å€¼ä¸è¶‹åŠ¿</strong></p>
<p>ä»£ç†å¼äººå·¥æ™ºèƒ½å¹¶ä¸æ˜¯å™±å¤´ï¼Œè€Œæ˜¯ä¼ä¸šæ™ºèƒ½åŒ–çš„ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚</p>
<p>å®ƒå¸¦æ¥çš„æ ¸å¿ƒä»·å€¼ï¼Œåœ¨äº**â€œè‡ªåŠ¨å†³ç­– + è‡ªåŠ¨æ‰§è¡Œâ€**çš„èåˆã€‚</p>
<p>åœ¨äºšé©¬é€Šäº‘çš„ç”Ÿæ€ä¸­ï¼Œè¿™ç§è¶‹åŠ¿å·²ç»è½åœ°åˆ°å¤šä¸ªè¡Œä¸šï¼š</p>
<p>ğŸŒ¾ <strong>Syngenta</strong> é€šè¿‡å¤šä»£ç†åä½œåˆ†æå†œä¸šæ•°æ®ï¼Œå¸®åŠ©å†œæˆ·æå‡äº§é‡ã€‚</p>
<p>ğŸ§¾ <strong>æ±¤æ£®è·¯é€</strong> ä½¿ç”¨ .NET è‡ªåŠ¨åŒ–ä»£ç†ï¼Œå°†ç³»ç»Ÿè¿ç§»é€Ÿåº¦æå‡ 4 å€ï¼Œæˆæœ¬ä¸‹é™ 30%ã€‚</p>
<p>ğŸ’° <strong>Rocket Companies</strong> å€ŸåŠ©æ™ºèƒ½ä»£ç†è®©è´·æ¬¾ç»“ç®—ç‡æå‡ä¸‰å€ã€‚</p>
<p>å¯ä»¥é¢„è§çš„æ˜¯ï¼Œæœªæ¥ä¼ä¸šä¸­å°†ä¸å†åªæœ‰â€œä¸€ä¸ª AI åŠ©æ‰‹â€ï¼Œè€Œæ˜¯<strong>ä¸€ç»„å…·å¤‡åˆ†å·¥åä½œèƒ½åŠ›çš„æ™ºèƒ½ä»£ç†å›¢é˜Ÿ</strong>ï¼š<br/>
ä¸€ä¸ªè´Ÿè´£ç›‘æ§æŒ‡æ ‡ï¼Œä¸€ä¸ªè´Ÿè´£æ±‡æŠ¥æ•°æ®ï¼Œä¸€ä¸ªè´Ÿè´£ç¼–å†™ä»£ç ï¼Œå®ƒä»¬ä¹‹é—´é€šè¿‡æ ‡å‡†åŒ–åè®®ï¼ˆå¦‚ MCPï¼‰äº’è”äº’é€šã€‚</p>
<p>è¿™å°±æ˜¯æ™ºèƒ½ä½“ç”Ÿæ€çš„é›å½¢ï¼Œä¹Ÿæ˜¯â€œä¼ä¸šè‡ªåŠ¨åŒ– 2.0â€çš„æ–¹å‘ã€‚</p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>äº”ã€æœªæ¥çš„æƒ³è±¡ï¼šä»å·¥å…·åˆ°ä¼™ä¼´</strong></p>
<p>å½“ AI èƒ½ç†è§£ä»»åŠ¡ã€è§„åˆ’è·¯å¾„ã€æ‰§è¡Œæ“ä½œã€å¹¶ä»é”™è¯¯ä¸­å­¦ä¹ ï¼Œå®ƒå°±ä¸å†æ˜¯å·¥å…·ï¼Œè€Œæ˜¯<strong>åˆä½œè€…</strong>ã€‚ä»£ç†å¼ AI çš„å‡ºç°ï¼Œæ­£æ˜¯åœ¨é‡æ–°å®šä¹‰â€œæ™ºèƒ½â€çš„è¾¹ç•Œã€‚</p>
<p>äºšé©¬é€Šäº‘åœ¨è¿™åœºå˜é©ä¸­æ‰®æ¼”çš„è§’è‰²ï¼Œä¸ä»…æ˜¯æä¾›ç®—åŠ›å’Œæ¨¡å‹ï¼Œæ›´æ˜¯<strong>æ„å»ºæ™ºèƒ½åŸºç¡€è®¾æ–½</strong>ã€‚æœªæ¥ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ›´å¤šä»£ç†ä»¥æ¨¡å—åŒ–æ–¹å¼å­˜åœ¨ï¼šå®ƒä»¬å¯èƒ½è¿è¡Œåœ¨æœ¬åœ°ï¼Œä¹Ÿå¯èƒ½è·¨äº‘åä½œï¼›å®ƒä»¬ä¼šä¸äººå…±äº‹ï¼Œä¹Ÿä¼šä¸ AI ååŒï¼›å®ƒä»¬å°†æˆä¸ºä¼ä¸šç”Ÿäº§åŠ›ç³»ç»Ÿä¸­çš„â€œæ–°å‘˜å·¥â€ã€‚</p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>ğŸ”— å»¶ä¼¸é˜…è¯»</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fbedrock%2Fagentcore" target="_blank" title="https://aws.amazon.com/cn/bedrock/agentcore" ref="nofollow noopener noreferrer">Amazon Bedrock AgentCore ç®€ä»‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2F" target="_blank" title="https://modelcontextprotocol.io/" ref="nofollow noopener noreferrer">ä»£ç†äº’æ“ä½œæ€§çš„å¼€æ”¾åè®®ï¼šMCP</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fblogs%2F" target="_blank" title="https://aws.amazon.com/blogs/" ref="nofollow noopener noreferrer">è‡ªä¸»ä»£ç†çš„å…´èµ·ï¼šä¼ä¸šé¢†å¯¼è€…éœ€è¦äº†è§£çš„æ–°æµªæ½®</a></p>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><strong>ğŸ§­ æ€»ç»“ä¸æ€è€ƒ</strong></p>
<p>ä»£ç†å¼äººå·¥æ™ºèƒ½å¹¶ä¸æ˜¯ä¸€ä¸ªçŸ­æš‚çš„é£å£ï¼Œè€Œæ˜¯æ™ºèƒ½ç³»ç»ŸçœŸæ­£â€œé•¿å‡ºæ‰‹è„šâ€çš„å…³é”®ä¸€æ­¥ã€‚å®ƒè®©æ¨¡å‹ä¸ä»…èƒ½â€œè¯´â€ï¼Œè¿˜èƒ½â€œåšâ€ï¼›ä¸ä»…èƒ½â€œç”Ÿæˆâ€ï¼Œè¿˜èƒ½â€œå†³ç­–â€ã€‚ä»äºšé©¬é€Šäº‘ AgentCore åˆ° MCP åè®®ï¼Œæˆ‘ä»¬æ­£è¿›å…¥ä¸€ä¸ª <strong>å¤šä»£ç†åä½œã€è·¨ç³»ç»Ÿæ‰§è¡Œçš„ AI æ—¶ä»£</strong>ã€‚</p>






<table><thead><tr><th>çœŸæ­£çš„æ™ºèƒ½ï¼Œä¸æ˜¯å›ç­”ï¼Œè€Œæ˜¯è¡ŒåŠ¨ã€‚å½“å¤§æ¨¡å‹å­¦ä¼šæ‰§è¡Œï¼ŒAI æ‰ç®—çœŸæ­£â€œè§‰é†’â€ã€‚</th></tr></thead></table>
<p>ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹å•¦ã€‚æœ€åæé†’ä¸€ä¸‹å„ä½å·¥å‹ï¼Œå¦‚æœåç»­ä¸å†ä½¿ç”¨ç›¸å…³æœåŠ¡ï¼Œåˆ«å¿˜äº†åœ¨æ§åˆ¶å°å…³é—­ï¼Œé¿å…è¶…å‡ºå…è´¹é¢åº¦äº§ç”Ÿè´¹ç”¨ï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ä¸‡å››åƒå­—é‡æ¸© Android å››å¤§ç»„ä»¶]]></title>    <link>https://juejin.cn/post/7584689488770465827</link>    <guid>https://juejin.cn/post/7584689488770465827</guid>    <pubDate>2025-12-18T00:48:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584689488770465827" data-draft-id="7577690150093946920" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ä¸‡å››åƒå­—é‡æ¸© Android å››å¤§ç»„ä»¶"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-12-18T00:48:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ä¸‡å››åƒå­—é‡æ¸© Android å››å¤§ç»„ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:48:07.000Z" title="Thu Dec 18 2025 00:48:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»37åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"â˜‚"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"âœ“"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"â¤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><em>æœ¬ç³»åˆ—ä¸ºå°è¯´ã€Šé€†è¢­è¥¿äºŒæ——ã€‹çš„æŠ€æœ¯è®²è§£ï¼Œç”¨äºè¯¦ç»†è¯´æ˜<a href="https://juejin.cn/post/7583891046206799924" target="_blank" title="https://juejin.cn/post/7583891046206799924">å‰§æƒ…</a>é‡Œæ¶‰åŠçš„å¼€å‘ç»†èŠ‚ã€‚</em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfc6d9e032fe44caa2ab7184df795655~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=W72Vk18upBtmPkzVqEEpqtpBmw8%3D" alt="0.png" loading="lazy"/></p>
<p>æˆ‘ç›¸ä¿¡å„ä½å¼€å‘è€…å¯¹äº Android å››å¤§ç»„ä»¶ç†Ÿæ‚‰çš„ä¸èƒ½å†ç†Ÿæ‚‰äº†ã€‚ä½†æ­£å› å¦‚æ­¤ï¼Œæˆ‘ä»¬å¾€å¾€å®¹æ˜“å¿½ç•¥å®ƒä»¬èƒŒåçš„è®¾è®¡åˆè¡·ã€ç”Ÿå‘½å‘¨æœŸç»†èŠ‚ä»¥åŠåœ¨ç°ä»£æ¶æ„ä¸­çš„æœ€ä½³å®è·µã€‚</p>
<p>ç°åœ¨ï¼Œæ¥ä¸€æ¬¡æ·±å…¥çš„å›é¡¾ï¼Œä¸ä»…èƒ½å¸®æˆ‘ä»¬é¿å¼€éšè—çš„å‘ç‚¹ï¼Œæ›´èƒ½é‡æ–°ç†è§£ Android ç³»ç»Ÿçš„è¿è¡Œé€»è¾‘ï¼Œè®©ä»£ç æ›´å¥å£®ã€æ¶æ„æ›´æ¸…æ™°ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯ Application</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdf20e0f2ab40829d20d8f123f58ac3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=%2BzBFgsxwZrsPQEhs3M0shfT1iFc%3D" alt="4.png" loading="lazy"/></p>
<p>åœ¨ Android ä¸­ï¼Œ<code>Application</code> ç±»æ˜¯ç”¨äºç»´æŠ¤åº”ç”¨å…¨å±€çŠ¶æ€å’Œç”Ÿå‘½å‘¨æœŸçš„åŸºç±»ã€‚å®ƒå……å½“æ•´ä¸ªåº”ç”¨çš„å…¥å£ç‚¹ï¼Œåœ¨ä»»ä½•å…¶ä»–ç»„ä»¶ï¼ˆå¦‚ <code>Activity</code>ã€<code>Service</code> æˆ– <code>BroadcastReceiver</code>ï¼‰åˆå§‹åŒ–ä¹‹å‰å°±è¢«åˆ›å»ºã€‚<code>Application</code> ç±»æä¾›äº†ä¸€ä¸ªè´¯ç©¿æ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„ <code>Context</code>ï¼Œå› æ­¤éå¸¸é€‚åˆç”¨æ¥åˆå§‹åŒ–é‚£äº›éœ€è¦å…¨å±€å…±äº«çš„èµ„æºã€‚</p>
<h3 data-id="heading-1">é¢è¯•é—®é¢˜</h3>
<p><code>Application</code> ç±»çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>å®ƒå’Œ <code>Activity</code> åœ¨ç”Ÿå‘½å‘¨æœŸå’Œèµ„æºç®¡ç†ä¸Šæœ‰ä½•åŒºåˆ«ï¼Ÿ</p>
<h3 data-id="heading-2">Application çš„ä½œç”¨</h3>
<p><code>Application</code> ç±»çš„è®¾è®¡åˆè¡·å°±æ˜¯ä¿å­˜å…¨å±€çŠ¶æ€ï¼Œå¹¶æ‰§è¡Œåº”ç”¨èŒƒå›´å†…çš„åˆå§‹åŒ–æ“ä½œã€‚å¼€å‘è€…é€šå¸¸ä¼šç»§æ‰¿è¿™ä¸ªç±»ï¼Œç”¨ä»¥è®¾ç½®ä¾èµ–é¡¹ã€é…ç½®ç¬¬ä¸‰æ–¹åº“ï¼Œä»¥åŠç®¡ç†é‚£äº›éœ€è¦åœ¨å¤šä¸ª <code>Activity</code> å’Œ <code>Service</code> ä¹‹é—´æŒç»­å­˜åœ¨çš„èµ„æºã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Android åº”ç”¨éƒ½ä¼šä½¿ç”¨ç³»ç»Ÿæä¾›çš„ <code>Application</code> åŸºç±»å®ç°ï¼Œé™¤éä½ åœ¨ <code>AndroidManifest.xml</code> æ–‡ä»¶ä¸­æ˜ç¡®æŒ‡å®šäº†ä¸€ä¸ªè‡ªå®šä¹‰çš„å­ç±»ã€‚</p>
<h3 data-id="heading-3">Application ç±»ä¸­çš„å…³é”®æ–¹æ³•</h3>
<ol>
<li><code>onCreate()</code>ï¼šå½“åº”ç”¨è¿›ç¨‹è¢«åˆ›å»ºæ—¶è°ƒç”¨ã€‚è¿™æ˜¯ä½ åˆå§‹åŒ–å…¨å±€ä¾èµ–é¡¹ï¼ˆæ¯”å¦‚æ•°æ®åº“å®ä¾‹ã€ç½‘ç»œåº“æˆ–åˆ†æå·¥å…·ï¼‰çš„æ ‡å‡†ä½ç½®ã€‚åœ¨æ•´ä¸ªåº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¯¥æ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li>
<li><code>onTerminate()</code>ï¼šä»…åœ¨æ¨¡æ‹Ÿå™¨ç¯å¢ƒä¸­åº”ç”¨ç»ˆæ­¢æ—¶è°ƒç”¨ã€‚åœ¨çœŸå®è®¾å¤‡çš„ç”Ÿäº§ç¯å¢ƒä¸­ä¸ä¼šè¢«è§¦å‘ï¼Œå› ä¸º Android å¹¶ä¸ä¿è¯å®ƒä¼šè¢«æ‰§è¡Œã€‚</li>
<li><code>onLowMemory()</code> ä¸ <code>onTrimMemory()</code>ï¼šå½“ç³»ç»Ÿæ£€æµ‹åˆ°å†…å­˜ä¸è¶³æ—¶è§¦å‘ã€‚<code>onLowMemory()</code> ä¸»è¦ç”¨äºè¾ƒè€çš„ API ç‰ˆæœ¬ï¼Œè€Œ <code>onTrimMemory()</code> æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œèƒ½æ ¹æ®åº”ç”¨å½“å‰çš„å†…å­˜çŠ¶æ€åšå‡ºå“åº”ã€‚</li>
</ol>
<h3 data-id="heading-4">å¦‚ä½•ä½¿ç”¨ Application ç±»</h3>
<p>è¦å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>Application</code> ç±»ï¼Œä½ éœ€è¦ç»§æ‰¿ <code>Application</code>ï¼Œå¹¶åœ¨ <code>AndroidManifest.xml</code> çš„ <code>&lt;application&gt;</code> æ ‡ç­¾ä¸­å£°æ˜å®ƒï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomApplication</span> : <span class="hljs-type">Application</span>() {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        <span class="hljs-comment">// åˆå§‹åŒ–å…¨å±€ä¾èµ–</span>
        initializeDatabase()
        initializeAnalytics()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initializeDatabase</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// è®¾ç½®æ•°æ®åº“å®ä¾‹</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initializeAnalytics</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// é…ç½®åˆ†æè¿½è¸ª</span>
    }
}
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">application</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">".CustomApplication"</span>
    <span class="hljs-attr">...</span> &gt;</span>
    ...
<span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">é€‚ç”¨åœºæ™¯</h3>
<ol>
<li><strong>å…¨å±€èµ„æºç®¡ç†</strong>ï¼šæ•°æ®åº“ã€<code>SharedPreferences</code> æˆ–ç½‘ç»œå®¢æˆ·ç«¯ç­‰èµ„æºåªéœ€åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå³å¯åœ¨å…¨åº”ç”¨å¤ç”¨ã€‚</li>
<li><strong>ç»„ä»¶åˆå§‹åŒ–</strong>ï¼šåƒ <strong>Firebase Analytics</strong>ã€<strong>Timber</strong> è¿™ç±»å·¥å…·åº”åœ¨åº”ç”¨å¯åŠ¨é˜¶æ®µå®Œæˆåˆå§‹åŒ–ï¼Œä»¥ç¡®ä¿åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æ— ç¼è¿è¡Œã€‚</li>
<li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šä½ å¯ä»¥åœ¨è¿™é‡Œåˆå§‹åŒ– <strong>Dagger</strong> æˆ– <strong>Hilt</strong> ç­‰ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œä¸ºæ•´ä¸ªåº”ç”¨æä¾›ç»Ÿä¸€çš„ä¾èµ–ç®¡ç†ã€‚</li>
</ol>
<h3 data-id="heading-6">æœ€ä½³å®è·µ</h3>
<ol>
<li>é¿å…åœ¨ <code>onCreate()</code> ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œä»¥å…æ‹–æ…¢åº”ç”¨å¯åŠ¨é€Ÿåº¦ã€‚</li>
<li>ä¸è¦æŠŠ <code>Application</code> ç±»å½“æˆâ€œæ‚ç‰©æŠ½å±‰â€ã€‚åªæ”¾çœŸæ­£å…¨å±€ç›¸å…³çš„é€»è¾‘ï¼Œä¿æŒèŒè´£å•ä¸€ã€‚</li>
<li>ç®¡ç†å…±äº«èµ„æºæ—¶æ³¨æ„çº¿ç¨‹å®‰å…¨ï¼Œå°¤å…¶æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è®¿é—®è¿™äº›èµ„æºã€‚</li>
</ol>
<h3 data-id="heading-7">æ€»ç»“</h3>
<p><code>Application</code> ç±»æ˜¯æ•´ä¸ªåº”ç”¨ä¸­åˆå§‹åŒ–å’Œç®¡ç†å…¨å±€èµ„æºçš„æ ¸å¿ƒåœºæ‰€ã€‚è™½ç„¶å®ƒæ˜¯è¿›è¡Œå…¨å±€é…ç½®çš„é‡è¦åŸºç¡€ APIï¼Œä½†åº”ä»…ç”¨äºçœŸæ­£éœ€è¦å…¨å±€å¤„ç†çš„ä»»åŠ¡ï¼Œä»¥ä¿æŒä»£ç æ¸…æ™°ï¼Œé¿å…ä¸å¿…è¦çš„å¤æ‚æ€§ã€‚</p>
<hr/>
<h2 data-id="heading-8">AndroidManifest æ–‡ä»¶</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79b02c35dcfc459a8f80acc4faec3ff3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=kNPp6KtZJZTJ0UC3SOi4qkdXZsA%3D" alt="5.png" loading="lazy"/></p>
<p><code>AndroidManifest.xml</code> æ–‡ä»¶æ˜¯ Android é¡¹ç›®ä¸­çš„ä¸€ä¸ªå…³é”®é…ç½®æ–‡ä»¶ï¼Œå®ƒå‘ Android æ“ä½œç³»ç»Ÿå®šä¹‰äº†å…³äºåº”ç”¨ç¨‹åºçš„é‡è¦ä¿¡æ¯ã€‚å®ƒå……å½“äº†åº”ç”¨ç¨‹åºä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„æ¡¥æ¢ï¼Œå‘ŠçŸ¥æ“ä½œç³»ç»Ÿåº”ç”¨ç¨‹åºçš„ç»„ä»¶ã€æƒé™ã€ç¡¬ä»¶å’Œè½¯ä»¶ç‰¹æ€§ç­‰ä¿¡æ¯ã€‚</p>
<p>å®ƒå°±åƒä¸€å¼ èº«ä»½è¯ï¼Œå‘Šè¯‰ç³»ç»Ÿï¼šæˆ‘æ˜¯è°ã€æˆ‘èƒ½å¹²å•¥ã€éœ€è¦ä»€ä¹ˆæƒé™ã€ä¾èµ–å“ªäº›ç¡¬ä»¶â€”â€”æ²¡å®ƒï¼Œä½ çš„ App è¿é—¨éƒ½è¿›ä¸å»ã€‚</p>
<h3 data-id="heading-9">é¢è¯•é—®é¢˜</h3>
<p><code>AndroidManifest</code> ä¸­çš„æ„å›¾è¿‡æ»¤å™¨å¦‚ä½•å®ç°åº”ç”¨ç¨‹åºä¹‹é—´çš„äº¤äº’ï¼Ÿ</p>
<p>å¦‚æœä¸€ä¸ª <code>Activity</code> ç±»æœªåœ¨ <code>AndroidManifest</code> ä¸­æ³¨å†Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<h3 data-id="heading-10">å…³é”®åŠŸèƒ½</h3>
<ol>
<li><strong>åº”ç”¨ç¨‹åºç»„ä»¶å£°æ˜</strong>ï¼šå®ƒæ³¨å†Œäº†è¯¸å¦‚ <code>Activity</code> ã€<code>Service</code>ã€ <code>BroadcastReceiver</code> å’Œ <code>ContentProvider</code> ç­‰åŸºæœ¬ç»„ä»¶ï¼Œ ä»¥ä¾¿ Android ç³»ç»ŸçŸ¥é“å¦‚ä½•å¯åŠ¨æˆ–ä¸å®ƒä»¬äº¤äº’ã€‚</li>
<li><strong>æƒé™</strong>ï¼šå®ƒå£°æ˜äº†åº”ç”¨ç¨‹åºæ‰€éœ€çš„æƒé™ï¼Œä¾‹å¦‚ <code>INTERNET</code>ã€<code>ACCESS_FINE_LOCATION</code> æˆ– <code>READ_CONTACTS</code>ï¼Œè¿™æ ·ç”¨æˆ·å°±èƒ½çŸ¥é“åº”ç”¨ç¨‹åºå°†è®¿é—®å“ªäº›èµ„æºï¼Œå¹¶å¯ä»¥æˆäºˆæˆ–æ‹’ç»è¿™äº›æƒé™ã€‚</li>
<li><strong>ç¡¬ä»¶å’Œè½¯ä»¶è¦æ±‚</strong>ï¼šå®ƒæŒ‡å®šäº†åº”ç”¨ç¨‹åºä¾èµ–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ‘„åƒå¤´ã€GPS æˆ– æŸäº›å±å¹•å°ºå¯¸ï¼Œå¸®åŠ©åº”ç”¨å•†åº—è¿‡æ»¤æ‰ä¸ç¬¦åˆè¿™äº›è¦æ±‚çš„è®¾å¤‡ã€‚</li>
<li><strong>åº”ç”¨ç¨‹åºå…ƒæ•°æ®</strong>ï¼šæä¾›äº†åº”ç”¨ç¨‹åºçš„åŸºæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚åŒ…åã€ç‰ˆæœ¬ã€æœ€ä½å’Œç›®æ ‡ API çº§åˆ«ã€ä¸»é¢˜å’Œæ ·å¼ï¼Œç³»ç»Ÿåœ¨å®‰è£…å’Œæ‰§è¡Œåº”ç”¨ç¨‹åºæ—¶ä¼šä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚</li>
<li><strong>æ„å›¾è¿‡æ»¤å™¨</strong>ï¼šä¸ºç»„ä»¶ï¼ˆä¾‹å¦‚ <code>Activity</code>ï¼‰å®šä¹‰äº† <code>IntentFilter</code> ï¼Œä»¥æŒ‡å®šå®ƒä»¬å¯ä»¥å“åº”çš„æ„å›¾ç±»å‹ï¼Œ å¦‚æ‰“å¼€é“¾æ¥æˆ–å…±äº«å†…å®¹ï¼Œä»è€Œå…è®¸å…¶ä»–åº”ç”¨ç¨‹åºä¸ä¹‹äº¤äº’ã€‚</li>
<li><strong>åº”ç”¨ç¨‹åºé…ç½®å’Œè®¾ç½®</strong>ï¼šåŒ…æ‹¬è®¾ç½®ä¸»å¯åŠ¨å™¨ <code>Activity</code>ã€é…ç½®å¤‡ä»½è¡Œä¸ºä»¥åŠæŒ‡å®šä¸»é¢˜ç­‰é…ç½®ï¼Œ è¿™äº›æœ‰åŠ©äºæ§åˆ¶åº”ç”¨ç¨‹åºçš„è¡Œä¸ºå’Œæ˜¾ç¤ºæ–¹å¼ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ª <code>AndroidManifest.xml</code> æ–‡ä»¶çš„ç¤ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li>
</ol>
<pre><code class="hljs language-xml" lang="xml">1  <span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
2  
3      <span class="hljs-comment">&lt;!-- Permissions --&gt;</span>
4      <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.INTERNET"</span> /&gt;</span>
5      <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_FINE_LOCATION"</span> /&gt;</span>
6  
7  <span class="hljs-tag">&lt;<span class="hljs-name">application</span>
<span class="hljs-attr">8</span>      <span class="hljs-attr">android:allowBackup</span>=<span class="hljs-string">"true"</span>
<span class="hljs-attr">9</span>      <span class="hljs-attr">android:icon</span>=<span class="hljs-string">"@mipmap/ic_launcher"</span>
<span class="hljs-attr">10</span>     <span class="hljs-attr">android:label</span>=<span class="hljs-string">"@string/app_name"</span>
<span class="hljs-attr">11</span>     <span class="hljs-attr">android:theme</span>=<span class="hljs-string">"@style/AppTheme"</span>&gt;</span>
12 
13     <span class="hljs-comment">&lt;!-- Main Activity --&gt;</span>
14     <span class="hljs-tag">&lt;<span class="hljs-name">activity</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">".MainActivity"</span>&gt;</span>
15         <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span>
16             <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.MAIN"</span> /&gt;</span>
17             <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.category.LAUNCHER"</span> /&gt;</span>
18         <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
19     <span class="hljs-tag">&lt;/<span class="hljs-name">activity</span>&gt;</span>
20 
21     <span class="hljs-comment">&lt;!-- Additional Components --&gt;</span>
22     <span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">".MyService"</span> /&gt;</span>
23     <span class="hljs-tag">&lt;<span class="hljs-name">receiver</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">".MyBroadcastReceiver"</span> /&gt;</span>
24 
25 <span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
26 <span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<h3 data-id="heading-11">æ€»ç»“</h3>
<p><code>AndroidManifest.xml</code> æ–‡ä»¶å¯¹æ¯ä¸ª App è‡³å…³é‡è¦ï¼Œå®ƒå‘ Android æ“ä½œç³»ç»Ÿæä¾›äº†ç®¡ç†åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸã€æƒé™å’Œäº¤äº’æ‰€éœ€çš„æ‰€æœ‰ç»†èŠ‚ã€‚å®ƒæœ¬è´¨ä¸Šå……å½“äº†ä¸€ä¸ªå®šä¹‰åº”ç”¨ç¨‹åºç»“æ„å’Œè¦æ±‚çš„è“å›¾ã€‚</p>
<p>è¿™é‡Œç»™å‡ºä¸€ä¸ªè¾ƒé•¿ï¼ˆä½†è¿˜è¿œè¿œä¸å¤Ÿå®Œæ•´ï¼‰çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
  <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span> &gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.INTERNET"</span> /&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">application</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">".FeedinApp"</span>
    <span class="hljs-attr">android:allowBackup</span>=<span class="hljs-string">"false"</span>
    <span class="hljs-attr">android:icon</span>=<span class="hljs-string">"@mipmap/ic_launcher"</span>
    <span class="hljs-attr">android:label</span>=<span class="hljs-string">"@string/app_name"</span>
    <span class="hljs-attr">android:supportsRtl</span>=<span class="hljs-string">"true"</span>
    <span class="hljs-attr">android:theme</span>=<span class="hljs-string">"@style/AppTheme"</span>
    <span class="hljs-attr">tools:ignore</span>=<span class="hljs-string">"AllowBackup"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">activity</span>
      <span class="hljs-attr">android:name</span>=<span class="hljs-string">".ui.main.MainActivity"</span>
      <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"true"</span>
      <span class="hljs-attr">android:launchMode</span>=<span class="hljs-string">"singleTop"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.MAIN"</span> /&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">category</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.category.LAUNCHER"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">activity</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">activity</span>
      <span class="hljs-attr">android:name</span>=<span class="hljs-string">".ui.details.DetailActivity"</span>
      <span class="hljs-attr">android:launchMode</span>=<span class="hljs-string">"singleTop"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">provider</span>
      <span class="hljs-attr">android:name</span>=<span class="hljs-string">"androidx.startup.InitializationProvider"</span>
      <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"io.xetom.feedin.androidx-startup"</span>
      <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"false"</span>
      <span class="hljs-attr">tools:node</span>=<span class="hljs-string">"merge"</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">meta-data</span>
        <span class="hljs-attr">android:name</span>=<span class="hljs-string">"io.xetom.feedin.initializer.TimberInitializer"</span>
        <span class="hljs-attr">android:value</span>=<span class="hljs-string">"androidx.startup"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">provider</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">profileable</span>
      <span class="hljs-attr">android:shell</span>=<span class="hljs-string">"true"</span>
      <span class="hljs-attr">tools:targetApi</span>=<span class="hljs-string">"q"</span> /&gt;</span>

  <span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">Activity çš„ç”Ÿå‘½å‘¨æœŸ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6be4aaca79664543a1793a18aa1ba9c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=80vSzX1mDpeWMQAVG9BJaCjTiz4%3D" alt="6.png" loading="lazy"/></p>
<p>Android <code>Activity</code> çš„ç”Ÿå‘½å‘¨æœŸæè¿°äº† <code>Activity</code> åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä»åˆ›å»ºåˆ°é”€æ¯æ‰€ç»å†çš„ä¸åŒçŠ¶æ€ã€‚ç†è§£è¿™äº›çŠ¶æ€å¯¹äºæœ‰æ•ˆç®¡ç†èµ„æºã€å¤„ç†ç”¨æˆ·è¾“å…¥ä»¥åŠç¡®ä¿æµç•…çš„ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ã€‚</p>
<h3 data-id="heading-13">é¢è¯•é—®é¢˜</h3>
<p><code>onPause()</code> å’Œ <code>onStop()</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<p>åœ¨å“ªäº›åœºæ™¯ä¸‹åº”è¯¥åˆ†åˆ«ç”¨æ¥å¤„ç†è€—èµ„æºçš„æ“ä½œï¼Ÿ</p>
<h3 data-id="heading-14">ç”Ÿå‘½å‘¨æœŸå›è°ƒ</h3>
<p>ä»¥ä¸‹æ˜¯ <code>Activity</code> ç”Ÿå‘½å‘¨æœŸçš„ä¸»è¦é˜¶æ®µï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cf1838790574679a4e96c24256be178~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=SN1jGZ0VfKFy%2FELQMVejhwP2Rn8%3D" alt="1png.png" loading="lazy"/></p>
<ol>
<li><code>onCreate()</code>ï¼šå½“ä¸€ä¸ª <code>Activity</code> è¢«åˆ›å»ºæ—¶ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•ã€‚åœ¨è¿™é‡Œä½ å¯ä»¥åˆå§‹åŒ– <code>Activity</code>ã€è®¾ç½® UI ç»„ä»¶ï¼Œå¹¶æ¢å¤ä»»ä½•ä¿å­˜çš„å®ä¾‹çŠ¶æ€ã€‚é™¤é <code>Activity</code> è¢«é”€æ¯å¹¶é‡æ–°åˆ›å»ºï¼Œå¦åˆ™åœ¨æ•´ä¸ª <code>Activity</code> ç”Ÿå‘½å‘¨æœŸä¸­åªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚</li>
<li><code>onStart()</code>ï¼š<code>Activity</code> å¯¹ç”¨æˆ·å˜å¾—å¯è§ï¼Œä½†å°šä¸å¯äº¤äº’ã€‚è¯¥æ–¹æ³•åœ¨ <code>onCreate()</code> ä¹‹åå’Œ <code>onResume()</code> ä¹‹å‰è¢«è°ƒç”¨ã€‚</li>
<li><code>onRestart()</code>ï¼šå¦‚æœ <code>Activity</code> åœæ­¢ååˆè¢«é‡æ–°å¯åŠ¨ï¼ˆä¾‹å¦‚ï¼Œç”¨æˆ·é‡æ–°å›åˆ°è¯¥ <code>Activity</code>ï¼‰ï¼Œæ­¤æ–¹æ³•ä¼šåœ¨ <code>onStart</code> ä¹‹å‰è¢«è°ƒç”¨ã€‚</li>
<li><code>onResume()</code>ï¼š <code>Activity</code> å¤„äºå‰å°ï¼Œç”¨æˆ·å¯ä»¥ä¸ä¹‹äº’åŠ¨ã€‚è¿™æ˜¯æ¢å¤æš‚åœçš„UIæ›´æ–°ã€åŠ¨ç”»æˆ–è¾“å…¥ç›‘å¬å™¨çš„åœ°æ–¹ã€‚</li>
<li><code>onPause()</code>ï¼šå½“ <code>Activity</code> è¢«å¦ä¸€ä¸ª <code>Activity</code> éƒ¨åˆ†é®æŒ¡æ—¶ï¼ˆä¾‹å¦‚ï¼Œå¼¹å‡ºå¯¹è¯æ¡†ï¼‰ï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚<code>Activity</code> ä»ç„¶å¯è§ä½†ä¸åœ¨ç„¦ç‚¹ä¸Šã€‚é€šå¸¸ç”¨äºæš‚åœåŠ¨ç”»ã€ä¼ æ„Ÿå™¨æ›´æ–°æˆ–ä¿å­˜æ•°æ®ç­‰æ“ä½œã€‚</li>
<li><code>onStop()</code>ï¼š <code>Activity</code> å¯¹ç”¨æˆ·ä¸å†å¯è§ï¼ˆä¾‹å¦‚ï¼Œå¦ä¸€ä¸ª <code>Activity</code> è¿›å…¥å‰å°ï¼‰ã€‚ä½ åº”è¯¥é‡Šæ”¾ <code>Activity</code> åœæ­¢æœŸé—´ä¸éœ€è¦çš„èµ„æºï¼Œæ¯”å¦‚åå°ä»»åŠ¡æˆ–å¤§å‹å¯¹è±¡ã€‚</li>
<li><code>onDestroy()</code>ï¼šåœ¨ <code>Activity</code> è¢«å®Œå…¨é”€æ¯å¹¶ä»å†…å­˜ä¸­ç§»é™¤ä¹‹å‰è°ƒç”¨ã€‚è¿™æ˜¯é‡Šæ”¾æ‰€æœ‰å‰©ä½™èµ„æºçš„æœ€ç»ˆæ¸…ç†æ–¹æ³•ã€‚</li>
</ol>
<h3 data-id="heading-15">æ€»ç»“</h3>
<p>ä¸€ä¸ª <code>Activity</code> ä¼šæ ¹æ®ç”¨æˆ·çš„æ“ä½œå’Œ Android ç³»ç»Ÿå¯¹èµ„æºçš„ç®¡ç†ä¾æ¬¡å›è°ƒè¿™äº›æ–¹æ³•ã€‚å¼€å‘è€…é€šè¿‡è¿™äº›å›è°ƒæ¥å¤„ç†ç•Œé¢åˆ‡æ¢ã€èŠ‚çœèµ„æºã€ä¿è¯ç”¨æˆ·ä½“éªŒæµç•…ã€‚</p>
<h3 data-id="heading-16">è¿›é˜¶ï¼šActivity åˆ‡æ¢</h3>
<p>å…³äº <code>Activity</code> ç”Ÿå‘½å‘¨æœŸï¼Œä¸€ä¸ªå¸¸è§çš„è¿›é˜¶é—®é¢˜æ˜¯ï¼š</p>
<p>â€œä½ èƒ½æè¿°ä¸€ä¸‹ä¾æ¬¡å¯åŠ¨ <code>Activity</code> Aã€ç„¶å <code>Activity</code> Bï¼Œæœ€åè¿”å› <code>Activity</code> A æ—¶å‘ç”Ÿçš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–å—ï¼Ÿâ€</p>
<p>è¿™ä¸ªé—®é¢˜èƒ½å¾ˆå¥½åœ°æ£€éªŒä½ å¯¹ Android ç³»ç»Ÿå¦‚ä½•ç®¡ç†å¤šä¸ª <code>Activity</code> çŠ¶æ€çš„ç†è§£ã€‚</p>
<p>åœ¨ä¸¤ä¸ª <code>Activity</code> ä¹‹é—´å¯¼èˆªæ—¶ï¼ˆæ¯”å¦‚ä» <code>Activity</code> A è·³åˆ° <code>Activity</code> Bï¼‰ï¼Œæ¯ä¸ª <code>Activity</code> çš„ç”Ÿå‘½å‘¨æœŸå›è°ƒä¼šæŒ‰ç‰¹å®šé¡ºåºè§¦å‘ã€‚æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥æ‹†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p><code>Activity</code> A å’Œ <code>Activity</code> B çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼š</p>
<ul>
<li>
<p>åˆæ¬¡å¯åŠ¨ <code>Activity</code> A<br/>
<code>Activity</code> A: <code>onCreate()</code> â†’ <code>onStart()</code> â†’ <code>onResume()</code>ã€‚è¿™æ˜¯é¦–æ¬¡åˆ›å»ºæ—¶çš„æ ‡å‡†æµç¨‹ã€‚æ­¤æ—¶ç”¨æˆ·æ­£åœ¨ä¸ <code>Activity</code> A äº¤äº’ã€‚</p>
</li>
<li>
<p>ä» <code>Activity</code> A è·³è½¬åˆ° <code>Activity</code> B<br/>
<code>Activity</code> A: <code>onPause()</code>ã€‚æš‚åœ UI æ›´æ–°ï¼Œé‡Šæ”¾ä¸å¯è§æ€§ç›¸å…³çš„è½»é‡èµ„æºã€‚</p>
<p><code>Activity</code> B: <code>onCreate()</code> â†’ <code>onStart()</code> â†’ <code>onResume()</code>ã€‚åˆ›å»ºå¹¶è¿›å…¥å‰å°ï¼Œè·å¾—ç”¨æˆ·ç„¦ç‚¹ã€‚</p>
<p><code>Activity</code> A: <code>onStop()</code>ã€‚å¦‚æœ <code>Activity</code> B å®Œå…¨è¦†ç›–äº† <code>Activity</code> Aï¼ˆæ¯”å¦‚æ˜¯å…¨å±é¡µé¢ï¼‰ï¼Œç³»ç»Ÿä¼šæ¥ç€è°ƒç”¨ <code>onStop()</code>ã€‚è¿™ä¸€æ­¥ä¸æ˜¯æ€»å‘ç”Ÿï¼Œä½†å¸¸è§äºæ ‡å‡†è·³è½¬ã€‚</p>
</li>
<li>
<p>ä» <code>Activity</code> B è¿”å› <code>Activity</code> A<br/>
<code>Activity</code> B: <code>onPause()</code>ã€‚
<code>Activity</code> A: <code>onRestart()</code> â†’ <code>onStart()</code> â†’ <code>onResume()</code>ã€‚é‡æ–°æ¿€æ´»ï¼Œå›åˆ°å‰å°ç»§ç»­äº¤äº’ã€‚</p>
<p><code>Activity</code> B: <code>onStop()</code> â†’ <code>onDestroy()</code>ã€‚è‹¥ç³»ç»Ÿå†³å®šå›æ”¶å®ƒï¼ˆæ¯”å¦‚é€šè¿‡è¿”å›é”®é€€å‡ºï¼‰ï¼Œå°±ä¼šèµ°å®Œé”€æ¯æµç¨‹ã€‚</p>
</li>
</ul>
<p>æ€»ä¹‹ï¼š</p>
<p>åœ¨ <code>Activity</code> åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œå‰å°çš„ <code>Activity</code> æ€»æ˜¯å…ˆè°ƒç”¨ <code>onPause()</code>ï¼Œå†é€€åˆ°åå°ã€‚</p>
<p>æ–°å¯åŠ¨çš„ <code>Activity</code> ä» <code>onCreate()</code> å¼€å§‹ï¼Œä¸€è·¯èµ°åˆ° <code>onResume()</code>ï¼Œæ¥ç®¡ç”¨æˆ·ç„¦ç‚¹ã€‚</p>
<p>è€Œå½“ä½ è¿”å›ä¹‹å‰çš„ <code>Activity</code>ï¼Œå®ƒä¸ä¼šé‡æ–° <code>onCreate()</code>ï¼Œè€Œæ˜¯é€šè¿‡ <code>onRestart()</code> æ¢å¤çŠ¶æ€ã€‚</p>
<p>ç†è§£è¿™äº›ç”Ÿå‘½å‘¨æœŸçš„è½¬æ¢å¯ä»¥ç¡®ä¿èµ„æºçš„æ­£ç¡®ç®¡ç†å’Œæµç•…çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<h3 data-id="heading-17">è¿›é˜¶ï¼šActivity ä¸­çš„ lifecycle</h3>
<p>æ¯ä¸ª <code>Activity</code> éƒ½ä¸ä¸€ä¸ª <code>Lifecycle</code> å®ä¾‹ç›¸å…³è”ï¼Œè¯¥å®ä¾‹æä¾›äº†ä¸€ç§è§‚å¯Ÿå’Œå“åº” <code>Activity</code> ç”Ÿå‘½å‘¨æœŸäº‹ä»¶çš„æ–¹å¼ã€‚<code>Lifecycle</code> æ˜¯ <strong>Jetpack Lifecycle</strong> åº“çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒè®©å¼€å‘äººå‘˜ä»¥å¹²å‡€ã€ç»“æ„åŒ–çš„æ–¹å¼ç®¡ç†ä»£ç ï¼Œä»¥åº”å¯¹ <code>Activity</code> çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–ã€‚</p>
<p><code>Activity</code> ä¸­çš„ <code>lifecycle</code> æ˜¯ <code>Lifecycle</code> ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œç”±æ‰€æœ‰ <code>ComponentActivity</code> å­ç±»æš´éœ²å‡ºæ¥ã€‚å®ƒè¡¨ç¤ºå½“å‰ <code>Activity</code> çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼Œå¹¶æä¾›äº†ä¸€ç§è§‚å¯Ÿç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼ˆ<code>å¦‚onCreate</code>ã€<code>onStart</code>ã€<code>onResume</code> ç­‰ï¼‰çš„æ–¹å¼ï¼Œè€Œæ— éœ€é‡å†™è¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚è¿™å¯¹äºç®¡ç† UI æ›´æ–°ã€èµ„æºæ¸…ç†æˆ–ä»¥ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„æ–¹å¼è§‚å¯Ÿ <code>LiveData</code> ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p><em>åç»­æˆ‘å°†ç”¨ <code>lifecycle</code> è¡¨ç¤º <code>Lifecycle</code> çš„å®ä¾‹ï¼ˆé¦–å­—æ¯å°å†™ï¼‰ã€‚</em></p>
<p>å¦‚ä½•ä½¿ç”¨ <code>lifecycle</code>ï¼Ÿ</p>
<p>å¯ä»¥åœ¨ <code>lifecycle</code> ä¸Šæ·»åŠ  <code>LifecycleObserver</code> æˆ– <code>DefaultLifecycleObserver</code> å¯¹è±¡ï¼Œä»¥å“åº”ç‰¹å®šçš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ç›‘å¬ <code>onStart</code> å’Œ <code>onStop</code>ï¼Œå¯ä»¥æ³¨å†Œä¸€ä¸ªè§‚å¯Ÿè€…æ¥å¤„ç†è¿™äº›å›è°ƒï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyObserver</span> : <span class="hljs-type">DefaultLifecycleObserver</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStart</span><span class="hljs-params">(owner: <span class="hljs-type">LifecycleOwner</span>)</span></span> {
        <span class="hljs-keyword">super</span>.onStart(owner)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStop</span><span class="hljs-params">(owner: <span class="hljs-type">LifecycleOwner</span>)</span></span> {
        <span class="hljs-keyword">super</span>.onStop(owner)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">ComponentActivity</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        lifecycle.addObserver(MyObserver())
    }
}
</code></pre>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>MyObserver</code> ç±»è§‚å¯Ÿ <code>MainActivity</code> çš„ç”Ÿå‘½å‘¨æœŸå˜åŒ–ã€‚å½“ <code>Activity</code> è¿›å…¥ <code>STARTED</code> æˆ– <code>STOPPED</code> çŠ¶æ€æ—¶ï¼Œç›¸åº”çš„å‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>ä½¿ç”¨ <code>lifecycle</code> çš„å¥½å¤„å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥</strong>ï¼šä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå®ä¾‹å¯ä»¥è®©ä½ çš„ç»„ä»¶äº†è§£ <code>Activity</code> çš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ï¼Œé¿å…åœ¨ <code>Activity</code> ä¸åœ¨æœŸæœ›çŠ¶æ€æ—¶æ‰§è¡Œä¸å¿…è¦çš„æˆ–é”™è¯¯çš„æ“ä½œã€‚</li>
<li><strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼šä½ å¯ä»¥å°†ä¾èµ–ç”Ÿå‘½å‘¨æœŸçš„é€»è¾‘ç§»å‡º <code>Activity</code> ç±»ï¼Œä»è€Œæé«˜å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
<li><strong>ä¸ Jetpack åº“é›†æˆ</strong>ï¼šåƒ <code>LiveData</code> å’Œ <code>ViewModel</code> è¿™æ ·çš„åº“è®¾è®¡ä¸ºä¸ç”Ÿå‘½å‘¨æœŸå®ä¾‹æ— ç¼åä½œï¼Œæ”¯æŒå“åº”å¼ç¼–ç¨‹å’Œé«˜æ•ˆçš„èµ„æºç®¡ç†ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼š</p>
<p><code>Activity</code> ä¸Šçš„ç”Ÿå‘½å‘¨æœŸå®ä¾‹æ˜¯ Android ç°ä»£æ¶æ„çš„å…³é”®ç»„æˆéƒ¨åˆ†ï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿä»¥ç»“æ„åŒ–å’Œå¯é‡ç”¨çš„æ–¹å¼å¤„ç†ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€‚é€šè¿‡åˆ©ç”¨ <code>LifecycleObserver</code> å’Œå…¶ä»– <strong>Jetpack</strong> ç»„ä»¶ï¼Œä½ å¯ä»¥åˆ›å»ºæ›´å¼ºå¤§ã€æ›´æ˜“äºç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚</p>
<hr/>
<h2 data-id="heading-18">Fragment çš„ç”Ÿå‘½å‘¨æœŸ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4697e0ef6c04db2ab25e659efeb26a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=Pizbu%2BY4%2FDvk8NVGCxpl831jPVs%3D" alt="7.png" loading="lazy"/></p>
<p>æ¯ä¸ª <code>Fragment</code> å®ä¾‹éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œå’Œå®ƒæ‰€å±çš„ <code>Activity</code> ç”Ÿå‘½å‘¨æœŸæ˜¯åˆ†å¼€çš„ã€‚å½“ç”¨æˆ·åœ¨ App é‡Œæ“ä½œæ—¶ï¼Œ<code>Fragment</code> ä¼šéšç€æ·»åŠ ã€ç§»é™¤ã€ä¸Šå±æˆ–ä¸‹å±ç­‰åŠ¨ä½œï¼Œåœ¨ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ä¹‹é—´åˆ‡æ¢â€”â€”æ¯”å¦‚åˆ›å»ºã€å¯åŠ¨ã€å¯è§ã€æ´»è·ƒï¼Œå†åˆ°ä¸å†éœ€è¦æ—¶çš„åœæ­¢æˆ–é”€æ¯ã€‚</p>
<p>ç®¡å¥½è¿™äº›çŠ¶æ€åˆ‡æ¢ï¼Œæ‰èƒ½è®© <code>Fragment</code> é«˜æ•ˆåœ°ä½¿ç”¨èµ„æºã€ä¿æŒ UI ä¸€è‡´ï¼Œå¹¶å¯¹ç”¨æˆ·æ“ä½œåšå‡ºæµç•…å“åº”ã€‚</p>
<h3 data-id="heading-19">é¢è¯•é—®é¢˜</h3>
<p><code>onCreateView()</code> å’Œ <code>onDestroyView()</code> çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ä¸ºä»€ä¹ˆåœ¨è¿™äº›æ–¹æ³•ä¸­æ­£ç¡®å¤„ç†ä¸è§†å›¾ç›¸å…³çš„èµ„æºå¾ˆé‡è¦ï¼Ÿ</p>
<h3 data-id="heading-20">ç”Ÿå‘½å‘¨æœŸå›è°ƒ</h3>
<p>Android ä¸­çš„ <code>Fragment</code> ç”Ÿå‘½å‘¨æœŸå’Œ <code>Activity</code> å¾ˆåƒï¼Œä½†ä¹Ÿæœ‰è‡ªå·±ç‹¬æœ‰çš„æ–¹æ³•å’Œè¡Œä¸ºï¼Œæ›´ç»†ã€æ›´çµæ´»ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a25d59dcbefe4d749f8b669f14266b23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=zqb2aGpnvYf%2F39ouC8Bseo%2FjGOg%3D" alt="å›¾ç‰‡.png" loading="lazy"/></p>
<ol>
<li><code>onAttach()</code>ï¼šå½“ <code>Fragment</code> è¢«å…³è”åˆ°å®ƒçš„çˆ¶ <code>Activity</code> æ—¶ï¼Œè¿™æ˜¯ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„å›è°ƒã€‚æ­¤æ—¶ <code>Fragment</code> å·²ç»ç»‘å®šï¼Œå¯ä»¥å’Œ <code>Activity</code> çš„ä¸Šä¸‹æ–‡äº¤äº’äº†ã€‚</li>
<li><code>onCreate()</code>ï¼šç”¨äºåˆå§‹åŒ– <code>Fragment</code>ã€‚æ­¤æ—¶ <code>Fragment</code> å·²åˆ›å»ºï¼Œä½† UI è¿˜æ²¡ç”Ÿæˆã€‚é€šå¸¸åœ¨è¿™é‡Œåˆå§‹åŒ–æ ¸å¿ƒç»„ä»¶æˆ–æ¢å¤ä¹‹å‰ä¿å­˜çš„çŠ¶æ€ã€‚</li>
<li><code>onCreateView()</code>ï¼šå½“ <code>Fragment</code> çš„ UI ç¬¬ä¸€æ¬¡è¢«ç»˜åˆ¶æ—¶è°ƒç”¨ã€‚ä½ éœ€è¦åœ¨è¿™ä¸ªæ–¹æ³•é‡Œè¿”å›å¸ƒå±€çš„æ ¹è§†å›¾ï¼Œä¹Ÿå°±æ˜¯ç”¨ <code>LayoutInflater</code> åŠ è½½å¸ƒå±€çš„åœ°æ–¹ã€‚</li>
<li><code>onViewStateRestored()</code>ï¼šåœ¨ <code>Fragment</code> çš„è§†å›¾å±‚çº§åˆ›å»ºå®Œæˆã€ä¸”ä¿å­˜çš„çŠ¶æ€å·²æ¢å¤åˆ°è§†å›¾åè°ƒç”¨ã€‚</li>
<li><code>onViewCreated()</code>ï¼šåœ¨ <code>Fragment</code> çš„è§†å›¾åˆ›å»ºå®Œæˆåè§¦å‘ã€‚å¸¸ç”¨æ¥è®¾ç½® UI ç»„ä»¶ï¼Œä»¥åŠå¤„ç†ç”¨æˆ·äº¤äº’æ‰€éœ€çš„é€»è¾‘ã€‚</li>
<li><code>onStart()</code>ï¼š<code>Fragment</code> å¯¹ç”¨æˆ·å¯è§äº†ã€‚è¿™å’Œ <code>Activity</code> çš„ <code>onStart()</code> ç±»ä¼¼â€”â€”æ­¤æ—¶å®ƒå·²ç»æ´»è·ƒï¼Œä½†è¿˜æ²¡å¤„äºå‰å°ã€‚</li>
<li><code>onResume()</code>ï¼š<code>Fragment</code> å®Œå…¨æ¿€æ´»å¹¶è¿è¡Œåœ¨å‰å°ï¼Œç”¨æˆ·å¯ä»¥ä¸ä¹‹äº¤äº’ã€‚å½“ <code>Fragment</code> çš„ UI å¯è§ä¸”å¯æ“ä½œæ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚</li>
<li><code>onPause()</code>ï¼šå½“ <code>Fragment</code> ä¸å†å¤„äºå‰å°ä½†ä»ç„¶å¯è§æ—¶è°ƒç”¨ã€‚å®ƒå³å°†å¤±å»ç„¦ç‚¹ï¼Œä½ åº”è¯¥æš‚åœé‚£äº›ä¸è¯¥åœ¨åå°ç»§ç»­è¿è¡Œçš„ä»»åŠ¡ã€‚</li>
<li><code>onStop()</code>ï¼š<code>Fragment</code> ä¸å†å¯è§ã€‚è¿™é‡Œè¦åœæ­¢é‚£äº›ä¸éœ€è¦åœ¨å±å¹•å¤–ç»§ç»­è¿è¡Œçš„æ“ä½œã€‚</li>
<li><code>onSaveInstanceState()</code>ï¼šåœ¨ <code>Fragment</code> è¢«é”€æ¯å‰è°ƒç”¨ï¼Œç”¨æ¥ä¿å­˜ä¸ UI ç›¸å…³çš„çŠ¶æ€æ•°æ®ï¼Œä»¥ä¾¿åç»­èƒ½æ¢å¤ã€‚</li>
<li><code>onDestroyView()</code>ï¼šå½“ <code>Fragment</code> çš„è§†å›¾å±‚çº§è¢«ç§»é™¤æ—¶è°ƒç”¨ã€‚ä½ åº”è¯¥æ¸…ç†ä¸è§†å›¾ç›¸å…³çš„èµ„æºï¼Œæ¯”å¦‚æ¸…ç©ºé€‚é…å™¨ã€ç½®ç©ºå¼•ç”¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li>
<li><code>onDestroy()</code>ï¼š<code>Fragment</code> æœ¬èº«æ­£åœ¨è¢«é”€æ¯ã€‚æ‰€æœ‰èµ„æºéƒ½åº”è¯¥åœ¨æ­¤æ—¶é‡Šæ”¾ï¼Œä½†å®ƒä»ä¸çˆ¶ <code>Activity</code> å…³è”ç€ã€‚</li>
<li><code>onDetach()</code>ï¼š<code>Fragment</code> ä»çˆ¶ <code>Activity</code> ä¸Šè§£ç»‘ï¼Œä¸å†ä¸å…¶å…³è”ã€‚è¿™æ˜¯æœ€åä¸€ä¸ªå›è°ƒï¼Œæ ‡å¿—ç€ <code>Fragment</code> ç”Ÿå‘½å‘¨æœŸç»“æŸã€‚</li>
</ol>
<h3 data-id="heading-21">æ€»ç»“</h3>
<p>ç†è§£ <code>Fragment</code> çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹é«˜æ•ˆç®¡ç†èµ„æºã€åº”å¯¹é…ç½®å˜æ›´ã€ä¿è¯ Android åº”ç”¨ä½“éªŒæµç•…è‡³å…³é‡è¦ã€‚</p>
<h3 data-id="heading-22">è¿›é˜¶ï¼šchildFragmentManager</h3>
<p>åœ¨ Android ä¸­ï¼Œ<code>fragmentManager</code> å’Œ <code>childFragmentManager</code> éƒ½æ˜¯ç”¨æ¥ç®¡ç† <code>Fragment</code> çš„ï¼Œä½†å®ƒä»¬çš„ä½œç”¨ä¸åŒï¼Œè¿è¡Œçš„èŒƒå›´ä¹Ÿä¸åŒã€‚</p>
<p><code>fragmentManager</code> ä¸ <code>FragmentActivity</code> æˆ– <code>Fragment</code> æœ¬èº«ç»‘å®šï¼Œè´Ÿè´£åœ¨ <code>Activity</code> çº§åˆ«ç®¡ç† <code>Fragment</code>ã€‚å®ƒèƒ½ç›´æ¥æ·»åŠ ã€æ›¿æ¢æˆ–ç§»é™¤ä¸çˆ¶ <code>Activity</code> å…³è”çš„ <code>Fragment</code>ã€‚</p>
<p>å½“ä½ åœ¨ <code>Activity</code> ä¸­è°ƒç”¨ <code>supportFragmentManager</code>ï¼Œå°±æ˜¯åœ¨è®¿é—®è¿™ä¸ª <code>fragmentManager</code>ã€‚ç”±å®ƒç®¡ç†çš„ <code>Fragment</code> æ˜¯å…„å¼Ÿå…³ç³»ï¼Œå¤„äºåŒä¸€å±‚çº§ã€‚</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// åœ¨ Activity å±‚çº§ç®¡ç† Fragment</span>
supportFragmentManager.beginTransaction()
    .replace(R.id.container, ExampleFragment())
    .commit()
</code></pre>
<p>è¿™é€šå¸¸ç”¨äºé‚£äº›å±äº <code>Activity</code> ä¸»è¦å¯¼èˆªæˆ– UI ç»“æ„çš„ <code>Fragment</code>ã€‚</p>
<p><code>childFragmentManager</code> æ˜¯æŸä¸ª <code>Fragment</code> ä¸“å±çš„ï¼Œç”¨æ¥ç®¡ç†å®ƒçš„å­ <code>Fragment</code>ã€‚è¿™è®©ä¸€ä¸ª <code>Fragment</code> èƒ½åµŒå¥—å…¶ä»– <code>Fragment</code>ï¼Œå½¢æˆå¤šå±‚ç»“æ„ã€‚</p>
<p>ä½¿ç”¨ <code>childFragmentManager</code> æ—¶ï¼Œä½ æ˜¯åœ¨çˆ¶ <code>Fragment</code> çš„ç”Ÿå‘½å‘¨æœŸå†…å®šä¹‰å­ <code>Fragment</code>ã€‚è¿™ç‰¹åˆ«é€‚åˆæŠŠ UI å’Œé€»è¾‘å°è£…åœ¨æŸä¸ª <code>Fragment</code> å†…éƒ¨ï¼Œå°¤å…¶æ˜¯å½“å®ƒéœ€è¦ä¸€ç»„ç‹¬ç«‹äº <code>Activity</code> ç”Ÿå‘½å‘¨æœŸçš„åµŒå¥— <code>Fragment</code> æ—¶ã€‚</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// åœ¨çˆ¶ Fragment å†…ç®¡ç†å­ Fragment</span>
childFragmentManager.beginTransaction()
    .replace(R.id.child_container, ChildFragment())
    .commit()
</code></pre>
<p>ç”± <code>childFragmentManager</code> ç®¡ç†çš„å­ <code>Fragment</code> åªå±äºçˆ¶ <code>Fragment</code> çš„ä½œç”¨åŸŸâ€”â€”å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸå’Œçˆ¶ <code>Fragment</code> ç»‘å®šã€‚æ¯”å¦‚ï¼Œå½“çˆ¶ <code>Fragment</code> è¢«é”€æ¯æ—¶ï¼Œå®ƒçš„æ‰€æœ‰å­ <code>Fragment</code> ä¹Ÿä¼šä¸€èµ·è¢«é”€æ¯ã€‚</p>
<p>ä»–ä»¬ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹ã€‚</p>
<p>ä»ä½œç”¨èŒƒå›´æ¥çœ‹ï¼š</p>
<ul>
<li><code>fragmentManager</code> åœ¨ <code>Activity</code> å±‚çº§å·¥ä½œï¼Œç®¡ç†ç›´æ¥ç»‘å®šåˆ° <code>Activity</code> çš„ <code>Fragment</code>ã€‚</li>
<li><code>childFragmentManager</code> åœ¨æŸä¸ª <code>Fragment</code> å†…éƒ¨è¿è¡Œï¼Œç”¨äºç®¡ç†åµŒå¥—åœ¨çˆ¶ <code>Fragment</code> ä¸­çš„å­ <code>Fragment</code>ã€‚</li>
</ul>
<p>ä»ä½¿ç”¨åœºæ™¯çœ‹ï¼š</p>
<ul>
<li>å½“ä½ éœ€è¦ç®¡ç†æ„æˆ <code>Activity</code> ä¸»è¦ UI ç»„ä»¶çš„ <code>Fragment</code> æ—¶ï¼Œä½¿ç”¨ <code>fragmentManager</code>ã€‚</li>
<li>å½“ä¸€ä¸ª <code>Fragment</code> éœ€è¦è‡ªå·±ç®¡ç†å†…éƒ¨çš„å­ <code>Fragment</code> æ—¶ï¼Œä½¿ç”¨ <code>childFragmentManager</code>ï¼Œè¿™æ ·å¯ä»¥è®© UI æ›´æ¨¡å—åŒ–ã€æ›´æ˜“å¤ç”¨ã€‚</li>
</ul>
<p>ä»ç”Ÿå‘½å‘¨æœŸçœ‹ï¼š</p>
<ul>
<li>ç”± <code>fragmentManager</code> ç®¡ç†çš„ <code>Fragment</code> éµå¾ª <code>Activity</code> çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>ç”± <code>childFragmentManager</code> ç®¡ç†çš„ <code>Fragment</code> åˆ™è·Ÿéšå…¶çˆ¶ <code>Fragment</code> çš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼š</p>
<p>é€‰æ‹©ä½¿ç”¨ <code>fragmentManager</code> è¿˜æ˜¯ <code>childFragmentManager</code>ï¼Œå–å†³äºä½ åº”ç”¨ UI çš„å±‚çº§ç»“æ„ã€‚</p>
<ul>
<li>å¦‚æœæ˜¯ <code>Activity</code> çº§åˆ«çš„ <code>Fragment</code>ï¼Œç”¨ <code>fragmentManager</code>ã€‚</li>
<li>å¦‚æœè¦åœ¨æŸä¸ª <code>Fragment</code> å†…åµŒå¥—å…¶ä»– <code>Fragment</code>ï¼Œå°±ç”¨ <code>childFragmentManager</code>ã€‚</li>
</ul>
<p>ç†è§£å®ƒä»¬çš„ä½œç”¨åŸŸå’Œç”Ÿå‘½å‘¨æœŸï¼Œèƒ½è®©ä½ çš„ Android åº”ç”¨ç»“æ„æ›´æ¸…æ™°ã€ç»„ä»¶æ›´ç‹¬ç«‹ã€‚</p>
<h3 data-id="heading-23">è¿›é˜¶ï¼šFragment ä¸­çš„ viewLifecycleOwner</h3>
<p>åœ¨ Android å¼€å‘ä¸­ï¼Œä¸€ä¸ª <code>Fragment</code> æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒå’Œå®¿ä¸» <code>Activity</code> ç»‘å®šã€‚ä½† <code>Fragment</code> ä¹Ÿæœ‰è‡ªå·±ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ä¸ªåŒºåˆ«åœ¨ç®¡ç†åƒ <code>LiveData</code> è¿™æ ·çš„ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥æ•°æ®æºæ—¶ç‰¹åˆ«é‡è¦ã€‚</p>
<p><code>viewLifecycleOwner</code> å®ä¾‹å°±æ˜¯ç”¨æ¥å¸®ä½ ææ¸…æ¥šè¿™å±‚å…³ç³»ã€é¿å…å‡ºé—®é¢˜çš„ã€‚</p>
<p><code>viewLifecycleOwner</code> æ˜¯ä¸€ä¸ªä¸ <code>Fragment</code> è§†å›¾å…³è”çš„ <code>LifecycleOwner</code>ã€‚å®ƒä»£è¡¨çš„æ˜¯ <code>View</code> çš„ç”Ÿå‘½å‘¨æœŸâ€”â€”ä» <code>onCreateView()</code> è¢«è°ƒç”¨å¼€å§‹ï¼Œåˆ° <code>onDestroyView()</code> è¢«è°ƒç”¨ç»“æŸã€‚</p>
<p>è¿™æ„å‘³ç€ä½ å¯ä»¥æŠŠ UI ç›¸å…³çš„æ•°æ®æˆ–èµ„æºï¼Œç»‘å®šåˆ° <code>View</code> çš„ç”Ÿå‘½å‘¨æœŸä¸Šï¼Œè€Œä¸æ˜¯æ•´ä¸ª <code>Fragment</code>ã€‚è¿™æ ·èƒ½æ›´ç²¾å‡†åœ°æ§åˆ¶èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼è¿™ç±»é—®é¢˜ã€‚</p>
<p><code>Fragment</code> çš„è§†å›¾ç”Ÿå‘½å‘¨æœŸæ¯” <code>Fragment</code> è‡ªèº«çŸ­ã€‚</p>
<p>å¦‚æœä½ ç”¨ <code>Fragment</code> çš„ç”Ÿå‘½å‘¨æœŸï¼ˆæ¯”å¦‚ <code>lifecycleOwner</code>ï¼‰æ¥è§‚å¯Ÿæ•°æ®æˆ–å¤„ç†äº‹ä»¶ï¼Œä¸€æ—¦ <code>View</code> è¢«é”€æ¯äº†ï¼Œä½ å¯èƒ½è¿˜åœ¨è¯•å›¾è®¿é—®å®ƒï¼Œç»“æœå°±æ˜¯å´©æºƒæˆ–å¼‚å¸¸è¡Œä¸ºã€‚</p>
<p>è€Œä½¿ç”¨ <code>viewLifecycleOwner</code>ï¼Œå°±èƒ½ç¡®ä¿æ‰€æœ‰è§‚å¯Ÿè€…æˆ–ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶éƒ½åªåœ¨ <code>View</code> å­˜åœ¨æ—¶ç”Ÿæ•ˆã€‚å½“ <code>View</code> è¢«é”€æ¯æ—¶ï¼Œæ›´æ–°ä¼šè‡ªåŠ¨åœæ­¢ï¼Œå¹²å‡€åˆå«ç”Ÿ...å“¦ï¼Œä¸å¯¹ï¼Œæ˜¯å¹²å‡€åˆå®‰å…¨ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåœ¨ <code>Fragment</code> ä¸­è§‚å¯Ÿ <code>LiveData</code> å¹¶é¿å…å†…å­˜æ³„æ¼ç”šè‡³å´©æºƒçš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFragment</span> : <span class="hljs-type">Fragment</span>(R.layout.fragment_example) {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: MyViewModel <span class="hljs-keyword">by</span> viewModel()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewCreated</span><span class="hljs-params">(view: <span class="hljs-type">View</span>, savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onViewCreated(view, savedInstanceState)

        <span class="hljs-comment">// ä½¿ç”¨ viewLifecycleOwner è§‚å¯Ÿ LiveData</span>
        viewModel.<span class="hljs-keyword">data</span>.observe(viewLifecycleOwner) { <span class="hljs-keyword">data</span> -&gt;
            <span class="hljs-comment">// ç”¨æ–°æ•°æ®æ›´æ–° UI</span>
            textView.text = <span class="hljs-keyword">data</span>
        }
    }
}
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>viewLifecycleOwner</code> ç¡®ä¿äº†å½“ <code>Fragment</code> çš„ <code>View</code> è¢«é”€æ¯æ—¶ï¼Œè§‚å¯Ÿè€…ä¼šè¢«è‡ªåŠ¨ç§»é™¤â€”â€”å³ä½¿ <code>Fragment</code> æœ¬èº«è¿˜æ´»ç€ï¼Œä¹Ÿä¸ä¼šç»§ç»­æ¥æ”¶æ•°æ®ï¼Œé¿å…äº†å†…å­˜æ³„æ¼ã€‚</p>
<p><code>lifecycleOwner</code> å’Œ <code>viewLifecycleOwner</code> çš„åŒºåˆ«ï¼š</p>
<ul>
<li><code>lifecycleOwner</code>ï¼ˆ<code>Fragment</code> çš„ç”Ÿå‘½å‘¨æœŸï¼‰ï¼šä»£è¡¨æ•´ä¸ª <code>Fragment</code> çš„ç”Ÿå‘½å‘¨æœŸï¼ŒæŒç»­æ—¶é—´æ›´é•¿ï¼Œä¸å®¿ä¸» <code>Activity</code> ç»‘å®šã€‚</li>
<li><code>viewLifecycleOwner</code>ï¼ˆ<code>Fragment</code> çš„ <code>View</code> ç”Ÿå‘½å‘¨æœŸï¼‰ï¼šä»£è¡¨ <code>Fragment</code> ä¸­ <code>View</code> çš„ç”Ÿå‘½å‘¨æœŸï¼Œä» <code>onCreateView</code> å¼€å§‹ï¼Œåˆ° <code>onDestroyView</code> ç»“æŸã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼š</p>
<p>ä½¿ç”¨ <code>viewLifecycleOwner</code> åœ¨ UI ç›¸å…³ä»»åŠ¡ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¿…é¡»å°Šé‡ <code>View</code> ç”Ÿå‘½å‘¨æœŸçš„åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚è§‚å¯Ÿ <code>LiveData</code> æˆ–ç®¡ç†ä¸ <code>View</code> å…³è”çš„èµ„æºã€‚è¿™æ ·èƒ½é¿å…å†…å­˜æ³„æ¼ï¼Œç¡®ä¿æ›´æ–°åœ¨ <code>View</code> é”€æ¯æ—¶è‡ªåŠ¨åœæ­¢ã€‚</p>
<hr/>
<h2 data-id="heading-24">Service</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09c5d79b9c1c4428a4b571edaa2b0329~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=3172TWcCDAJzSVB%2FGS9Yd%2Flj3cA%3D" alt="8.png" loading="lazy"/></p>
<p><code>Service</code> æ˜¯ä¸€ä¸ªåå°ç»„ä»¶ï¼Œå¯ä»¥è®©åº”ç”¨åœ¨ä¸ä¾èµ–ç”¨æˆ·äº¤äº’çš„æƒ…å†µä¸‹æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„æ“ä½œã€‚</p>
<p>ä¸ <code>Activity</code> ä¸åŒï¼Œ<code>Service</code> æ²¡æœ‰ç”¨æˆ·ç•Œé¢ï¼Œå³ä½¿åº”ç”¨ä¸åœ¨å‰å°ï¼Œå®ƒä¹Ÿèƒ½ç»§ç»­è¿è¡Œã€‚é€šå¸¸ç”¨äºä¸‹è½½æ–‡ä»¶ã€æ’­æ”¾éŸ³ä¹ã€åŒæ­¥æ•°æ®æˆ–å¤„ç†ç½‘ç»œè¯·æ±‚ç­‰åå°ä»»åŠ¡ã€‚</p>
<h3 data-id="heading-25">é¢è¯•é—®é¢˜</h3>
<p>Android ä¸­ï¼Œ<code>started service</code> å’Œ <code>bound service</code> æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåˆ†åˆ«åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ</p>
<h3 data-id="heading-26">å¯åŠ¨å‹ Service</h3>
<p>å½“æŸä¸ªåº”ç”¨ç»„ä»¶è°ƒç”¨ <code>startService()</code> æ—¶ï¼Œ<code>Service</code> å°±ä¼šè¢«å¯åŠ¨ã€‚å®ƒä¼šåœ¨åå°æŒç»­è¿è¡Œï¼Œç›´åˆ°è‡ªå·±è°ƒç”¨ <code>stopSelf()</code> æˆ–è¢«å¤–éƒ¨é€šè¿‡ <code>stopService()</code> æ˜ç¡®åœæ­¢ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>æ’­æ”¾èƒŒæ™¯éŸ³ä¹ã€‚</li>
<li>ä¸Šä¼ æˆ–ä¸‹è½½æ–‡ä»¶ã€‚</li>
</ul>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyService</span> : <span class="hljs-type">Service</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStartCommand</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>?, flags: <span class="hljs-type">Int</span>, startId: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-comment">// åœ¨åå°æ‰§è¡Œé•¿æ—¶é—´ä»»åŠ¡</span>
        <span class="hljs-keyword">return</span> START_STICKY
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBind</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>?)</span></span>: IBinder? = <span class="hljs-literal">null</span>
}
</code></pre>
<h3 data-id="heading-27">ç»‘å®šå‹ Service</h3>
<p>å…¶ä»–ç»„ä»¶é€šè¿‡ <code>bindService()</code> æ¥ç»‘å®š <code>Service</code>ï¼Œå¹¶ä¸å®ƒå»ºç«‹è¿æ¥ã€‚åªè¦è¿˜æœ‰ç»„ä»¶ç»‘å®šç€å®ƒï¼Œ<code>Service</code> å°±ä¼šä¿æŒæ´»è·ƒï¼›å½“æ‰€æœ‰å®¢æˆ·ç«¯éƒ½æ–­å¼€è¿æ¥åï¼Œå®ƒä¼šè‡ªåŠ¨åœæ­¢ã€‚</p>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ul>
<li>ä»æœåŠ¡å™¨è·å–æ•°æ®ï¼ˆæŒ‡é•¿æ—¶é—´éœ€è¦é€šè¿‡ <code>Service</code> æ¥è·å–æ•°æ®ï¼‰ã€‚</li>
<li>ç®¡ç†åå°è“ç‰™è¿æ¥ã€‚</li>
</ul>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BoundService</span> : <span class="hljs-type">Service</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> binder = LocalBinder()

    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalBinder</span> : <span class="hljs-type">Binder</span>() {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getService</span><span class="hljs-params">()</span></span>: BoundService = <span class="hljs-keyword">this</span><span class="hljs-symbol">@BoundService</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBind</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>?)</span></span>: IBinder = binder
}
</code></pre>
<h3 data-id="heading-28">å‰å° Service</h3>
<p>å‰å° <code>Service</code> æ˜¯ä¸€ç§ç‰¹æ®Šçš„ <code>Service</code>ï¼Œå®ƒåœ¨è¿è¡Œæ—¶ä¼šæ˜¾ç¤ºä¸€ä¸ªæŒç»­çš„é€šçŸ¥ã€‚è¿™ç§æœåŠ¡é€‚ç”¨äºéœ€è¦ç”¨æˆ·æŒç»­æ„ŸçŸ¥çš„ä»»åŠ¡ï¼Œæ¯”å¦‚æ’­æ”¾éŸ³ä¹ã€å¯¼èˆªæˆ–ä½ç½®è¿½è¸ªã€‚</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ForegroundService</span> : <span class="hljs-type">Service</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStartCommand</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>?, flags: <span class="hljs-type">Int</span>, startId: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">val</span> notification = createNotification()
        startForeground(<span class="hljs-number">1</span>, notification)
        <span class="hljs-keyword">return</span> START_STICKY
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createNotification</span><span class="hljs-params">()</span></span>: Notification {
        <span class="hljs-keyword">return</span> NotificationCompat.Builder(<span class="hljs-keyword">this</span>, <span class="hljs-string">"channel_id"</span>)
            .setContentTitle(<span class="hljs-string">"Foreground Service"</span>)
            .setContentText(<span class="hljs-string">"Running..."</span>)
            .setSmallIcon(R.drawable.ic_notification)
            .build()
    }
}
</code></pre>
<h3 data-id="heading-29">å„ç±» Service çš„å…³é”®åŒºåˆ«</h3>





























<table><thead><tr><th>Service ç±»å‹</th><th>æ˜¯å¦åœ¨åå°è¿è¡Œ</th><th>æ˜¯å¦è‡ªåŠ¨åœæ­¢</th><th>æ˜¯å¦éœ€è¦ UI é€šçŸ¥</th></tr></thead><tbody><tr><td>Started Service</td><td>âœ… æ˜¯</td><td>âŒ å¦</td><td>âŒ å¦</td></tr><tr><td>Bound Service</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯ï¼ˆå½“æ‰€æœ‰å®¢æˆ·ç«¯è§£ç»‘åï¼‰</td><td>âŒ å¦</td></tr><tr><td>Foreground Service</td><td>âœ… æ˜¯</td><td>âŒ å¦</td><td>âœ… æ˜¯</td></tr></tbody></table>
<h3 data-id="heading-30">æœ€ä½³å®è·µ</h3>
<ul>
<li>å¯¹äºä¸éœ€è¦ç«‹å³æ‰§è¡Œçš„åå°ä»»åŠ¡ï¼Œä¼˜å…ˆä½¿ç”¨ <code>Jetpack WorkManager</code> è€Œä¸æ˜¯ <code>Service</code>ã€‚</li>
<li>ä»»åŠ¡å®ŒæˆååŠæ—¶åœæ­¢ <code>Service</code>ï¼Œé¿å…ä¸å¿…è¦çš„èµ„æºæ¶ˆè€—ã€‚</li>
<li>åˆç†ä½¿ç”¨å‰å° <code>Service</code>ï¼Œæä¾›æ¸…æ™°çš„é€šçŸ¥ï¼Œä¿è¯é€æ˜æ€§ã€‚</li>
<li>æ­£ç¡®å¤„ç†ç”Ÿå‘½å‘¨æœŸå˜åŒ–ï¼ˆå¦‚ <code>Service</code> çš„ç”Ÿå‘½å‘¨æœŸï¼‰ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li>
</ul>
<h3 data-id="heading-31">æ€»ç»“</h3>
<p><code>Service</code> è®©åº”ç”¨èƒ½åœ¨æ— ç”¨æˆ·äº¤äº’çš„æƒ…å†µä¸‹è¿›è¡Œåå°å¤„ç†ã€‚</p>
<ul>
<li><code>Started Service</code> ä¼šä¸€ç›´è¿è¡Œï¼Œç›´åˆ°æ‰‹åŠ¨åœæ­¢ï¼›</li>
<li><code>Bound Service</code> ç”¨äºä¸å…¶ä»–ç»„ä»¶é€šä¿¡ï¼›</li>
<li><code>Foreground Service</code> é€šè¿‡æŒç»­é€šçŸ¥ä¿æŒæ´»è·ƒã€‚</li>
</ul>
<p>åˆç†ç®¡ç† <code>Service</code>ï¼Œæ‰èƒ½ä¿è¯ç³»ç»Ÿèµ„æºé«˜æ•ˆåˆ©ç”¨ï¼ŒåŒæ—¶å¸¦æ¥æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚</p>
<h3 data-id="heading-32">è¿›é˜¶ï¼šå¦‚ä½•å¤„ç†å‰å° Service</h3>
<p>å‰å° <code>Service</code> æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„ <code>Service</code>ï¼Œç”¨äºæ‰§è¡Œç”¨æˆ·èƒ½æ˜æ˜¾æ„ŸçŸ¥çš„ä»»åŠ¡ã€‚å®ƒä¼šåœ¨é€šçŸ¥æ æ˜¾ç¤ºä¸€ä¸ªæŒç»­çš„é€šçŸ¥ï¼Œç¡®ä¿ç”¨æˆ·çŸ¥é“å®ƒçš„è¿è¡ŒçŠ¶æ€ã€‚è¿™ç±»æœåŠ¡å¸¸ç”¨äºé«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼Œæ¯”å¦‚åª’ä½“æ’­æ”¾ã€ä½ç½®è¿½è¸ªæˆ–æ–‡ä»¶ä¸Šä¼ ã€‚</p>
<p>ä¸æ™®é€š <code>Service</code> çš„å…³é”®åŒºåˆ«åœ¨äºï¼šå‰å° <code>Service</code> å¿…é¡»åœ¨å¯åŠ¨æ—¶ç«‹å³è°ƒç”¨ <code>startForeground()</code> å¹¶å±•ç¤ºé€šçŸ¥ï¼Œå¦åˆ™ç³»ç»Ÿä¼šå¼ºåˆ¶ç»ˆæ­¢å®ƒï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ForegroundService</span> : <span class="hljs-type">Service</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        <span class="hljs-comment">// åˆå§‹åŒ–èµ„æº</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStartCommand</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>?, flags: <span class="hljs-type">Int</span>, startId: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">val</span> notification = createNotification()
        startForeground(<span class="hljs-number">1</span>, notification) <span class="hljs-comment">// ä»¥å‰å°æ–¹å¼å¯åŠ¨æœåŠ¡</span>
        <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span>
        <span class="hljs-keyword">return</span> START_STICKY
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createNotification</span><span class="hljs-params">()</span></span>: Notification {
        <span class="hljs-keyword">val</span> notificationChannelId = <span class="hljs-string">"ForegroundServiceChannel"</span>
        <span class="hljs-keyword">val</span> channel = NotificationChannel(
            notificationChannelId,
            <span class="hljs-string">"Foreground Service"</span>,
            NotificationManager.IMPORTANCE_DEFAULT
        )
        getSystemService(NotificationManager::<span class="hljs-keyword">class</span>.java).createNotificationChannel(channel)
        <span class="hljs-keyword">return</span> NotificationCompat.Builder(<span class="hljs-keyword">this</span>, notificationChannelId)
            .setContentTitle(<span class="hljs-string">"Foreground Service"</span>)
            .setContentText(<span class="hljs-string">"Running in the foreground"</span>)
            .setSmallIcon(R.drawable.ic_notification)
            .build()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onDestroy()
        <span class="hljs-comment">// æ¸…ç†èµ„æº</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBind</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>?)</span></span>: IBinder? = <span class="hljs-literal">null</span>
}
</code></pre>
<p><code>Service</code> å’Œ <code>Foreground Service</code> çš„å…³é”®åŒºåˆ«åœ¨äºï¼š</p>
<ol>
<li><strong>ç”¨æˆ·æ„ŸçŸ¥</strong>ï¼šæ™®é€š <code>Service</code> å¯ä»¥åœ¨åå°é»˜é»˜è¿è¡Œï¼Œç”¨æˆ·æ— æ„Ÿï¼›è€Œ <code>Foreground Service</code> å¿…é¡»æ˜¾ç¤ºé€šçŸ¥ï¼Œè®©ç”¨æˆ·æ¸…æ¥šçŸ¥é“å®ƒæ­£åœ¨è¿è¡Œã€‚</li>
<li><strong>ä¼˜å…ˆçº§</strong>ï¼š<code>Foreground Service</code> ä¼˜å…ˆçº§æ›´é«˜ï¼Œåœ¨å†…å­˜ç´§å¼ æ—¶æ›´ä¸å®¹æ˜“è¢«ç³»ç»Ÿæ€æ­»ã€‚</li>
<li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæ™®é€š <code>Service</code> é€‚åˆè½»é‡çº§åå°ä»»åŠ¡ï¼›<code>Foreground Service</code> æ›´é€‚åˆæŒç»­ã€ç”¨æˆ·å¯è§çš„ä»»åŠ¡ï¼Œæ¯”å¦‚æ’­æ”¾éŸ³ä¹æˆ–ä¸Šä¼ æ–‡ä»¶ã€‚</li>
</ol>
<p>é‚£ä¹ˆï¼Œä½¿ç”¨ <code>Service</code> æœ‰å“ªäº›å»ºè®®å‘¢ï¼Ÿ</p>
<ol>
<li>ä»»åŠ¡å®Œæˆåä¸€å®šè¦åŠæ—¶åœæ­¢ <code>Service</code>ï¼Œé¿å…æµªè´¹ç³»ç»Ÿèµ„æºã€‚</li>
<li>å¯¹äºä¸éœ€è¦ç«‹å³æ‰§è¡Œçš„åå°ä»»åŠ¡ï¼Œä¼˜å…ˆä½¿ç”¨ <code>WorkManager</code>ã€‚</li>
<li>ä½¿ç”¨å‰å° <code>Service</code> æ—¶ï¼Œç¡®ä¿é€šçŸ¥ç®€æ´å‹å¥½ã€ä¿¡æ¯æ˜ç¡®ï¼Œä¿æŒé€æ˜åº¦ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼š</p>
<p>Android çš„ <code>Service</code> èƒ½é«˜æ•ˆæ‰§è¡Œåå°ä»»åŠ¡ï¼Œè€Œ <code>Foreground Service</code> åˆ™é€‚ç”¨äºéœ€è¦æŒç»­è¿è¡Œä¸”ç”¨æˆ·å¯è§çš„åœºæ™¯ã€‚ä¸¤è€…éƒ½å¯¹æ„å»ºèµ„æºç®¡ç†åˆç†ã€ä½“éªŒæµç•…çš„åº”ç”¨è‡³å…³é‡è¦ã€‚</p>
<h3 data-id="heading-33">è¿›é˜¶ï¼šService çš„ç”Ÿå‘½å‘¨æœŸ</h3>
<p>æ­£å¦‚ä½ ä¹‹å‰æ‰€å­¦ï¼Œä¸€ä¸ª <code>Service</code> å¯ä»¥ä»¥ä¸¤ç§æ¨¡å¼è¿è¡Œï¼š</p>
<ol>
<li>é€šè¿‡ <code>startService()</code> å¯åŠ¨ï¼šä¼šä¸€ç›´è¿è¡Œï¼Œç›´åˆ°è¢«æ˜ç¡®è°ƒç”¨ <code>stopSelf()</code> æˆ– <code>stopService()</code> åœæ­¢ã€‚</li>
<li>é€šè¿‡ <code>bindService()</code> ä¸ä¸€ä¸ªæˆ–å¤šä¸ªç»„ä»¶ç»‘å®šï¼šåªè¦è¿˜æœ‰ç»„ä»¶ç»‘å®šç€å®ƒï¼Œå®ƒå°±ä¼šæŒç»­å­˜åœ¨ã€‚</li>
</ol>
<p>å®ƒçš„ç”Ÿå‘½å‘¨æœŸé€šè¿‡ <code>onCreate()</code>ã€<code>onStartCommand()</code>ã€<code>onBind()</code> å’Œ <code>onDestroy()</code> ç­‰æ–¹æ³•è¿›è¡Œç®¡ç†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/baa6bf16d831405a9fa8d346548997eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=38tHcXqx7w4ATUrsgQ35Q8QB2Fs%3D" alt="3.png" loading="lazy"/></p>
<p>å½“ <code>startService()</code>ï¼š</p>
<ol>
<li><code>onCreate()</code>ï¼šå½“ <code>Service</code> é¦–æ¬¡åˆ›å»ºæ—¶è°ƒç”¨ã€‚ç”¨äºåˆå§‹åŒ– <code>Service</code> æ‰€éœ€çš„èµ„æºã€‚</li>
<li><code>onStartCommand()</code>ï¼šå½“é€šè¿‡ <code>startService()</code> å¯åŠ¨ <code>Service</code> æ—¶è§¦å‘ã€‚è¯¥æ–¹æ³•è´Ÿè´£æ‰§è¡Œå®é™…ä»»åŠ¡ï¼Œå¹¶é€šè¿‡è¿”å›å€¼ï¼ˆå¦‚ <code>START_STICKY</code>ã€<code>START_NOT_STICKY</code>ï¼‰å†³å®šæœåŠ¡è¢«æ€æ­»åæ˜¯å¦é‡å¯ã€‚</li>
<li><code>onDestroy()</code>ï¼šå½“ä½¿ç”¨ <code>stopSelf()</code> æˆ– <code>stopService()</code> åœæ­¢ <code>Service</code> æ—¶è°ƒç”¨ã€‚ç”¨äºæ‰§è¡Œæ¸…ç†æ“ä½œï¼Œæ¯”å¦‚é‡Šæ”¾èµ„æºæˆ–åœæ­¢çº¿ç¨‹ã€‚</li>
</ol>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleStartedService</span> : <span class="hljs-type">Service</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        <span class="hljs-comment">// åˆå§‹åŒ–èµ„æº</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onStartCommand</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>?, flags: <span class="hljs-type">Int</span>, startId: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-comment">// æ‰§è¡Œé•¿æ—¶é—´ä»»åŠ¡</span>
        <span class="hljs-keyword">return</span> START_STICKY <span class="hljs-comment">// å¦‚æœæœåŠ¡è¢«æ€æ­»ï¼Œç³»ç»Ÿä¼šå°è¯•é‡å¯å®ƒ</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onDestroy()
        <span class="hljs-comment">// æ¸…ç†èµ„æº</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBind</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>?)</span></span>: IBinder? = <span class="hljs-literal">null</span> <span class="hljs-comment">// å¯åŠ¨å‹æœåŠ¡ä¸ä½¿ç”¨ç»‘å®š</span>
}
</code></pre>
<p>å½“ <code>bindService()</code>ï¼š</p>
<ol>
<li><code>onCreate()</code>ï¼šä¸å¯åŠ¨å‹æœåŠ¡ç±»ä¼¼ï¼Œå½“ <code>Service</code> åˆ›å»ºæ—¶è°ƒç”¨ï¼Œç”¨äºåˆå§‹åŒ–æ‰€éœ€èµ„æºã€‚</li>
<li><code>onBind()</code>ï¼šå½“æŸä¸ªç»„ä»¶é€šè¿‡ <code>bindService()</code> ç»‘å®šåˆ°è¯¥æœåŠ¡æ—¶è§¦å‘ã€‚æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªæ¥å£ï¼ˆ<code>IBinder</code>ï¼‰ï¼Œä¾›å®¢æˆ·ç«¯ä¸æœåŠ¡é€šä¿¡ã€‚</li>
<li><code>onUnbind()</code>ï¼šå½“æœ€åä¸€ä¸ªå®¢æˆ·ç«¯ä»æœåŠ¡è§£ç»‘æ—¶è°ƒç”¨ã€‚è¿™é‡Œæ˜¯æ¸…ç†ä¸ç»‘å®šå®¢æˆ·ç«¯ç›¸å…³èµ„æºçš„åœ°æ–¹ã€‚</li>
<li><code>onDestroy()</code>ï¼šå½“æœåŠ¡è¢«ç»ˆæ­¢æ—¶è°ƒç”¨ï¼Œè´Ÿè´£é‡Šæ”¾èµ„æºå¹¶åœæ­¢æ­£åœ¨è¿›è¡Œçš„æ“ä½œã€‚</li>
</ol>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleBoundService</span> : <span class="hljs-type">Service</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> binder = LocalBinder()

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCreate()
        <span class="hljs-comment">// åˆå§‹åŒ–èµ„æº</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBind</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>?)</span></span>: IBinder {
        <span class="hljs-keyword">return</span> binder <span class="hljs-comment">// è¿”å›ç»‘å®šæœåŠ¡çš„æ¥å£</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onUnbind</span><span class="hljs-params">(intent: <span class="hljs-type">Intent</span>?)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-comment">// å½“æ²¡æœ‰å®¢æˆ·ç«¯ç»‘å®šæ—¶è¿›è¡Œæ¸…ç†</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onUnbind(intent)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDestroy</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onDestroy()
        <span class="hljs-comment">// æ¸…ç†èµ„æº</span>
    }

    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalBinder</span> : <span class="hljs-type">Binder</span>() {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getService</span><span class="hljs-params">()</span></span>: SimpleBoundService = <span class="hljs-keyword">this</span><span class="hljs-symbol">@SimpleBoundService</span>
    }
}
</code></pre>
<p>å¯åŠ¨å‹ä¸ç»‘å®šå‹ <code>Service</code> ç”Ÿå‘½å‘¨æœŸçš„å…³é”®åŒºåˆ«åœ¨äºï¼š</p>
<ol>
<li><strong>Started Service</strong>ï¼šç‹¬ç«‹äºä»»ä½•ç»„ä»¶è¿è¡Œï¼Œç›´åˆ°è¢«æ˜ç¡®åœæ­¢æ‰ä¼šç»“æŸã€‚</li>
<li><strong>Bound Service</strong>ï¼šä»…åœ¨è‡³å°‘æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯ç»‘å®šæ—¶æ‰å­˜åœ¨ï¼Œä¸€æ—¦æ‰€æœ‰å®¢æˆ·ç«¯è§£ç»‘ï¼ŒæœåŠ¡å°±ä¼šç»ˆæ­¢ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼š</p>
<p>ç†è§£ <code>Service</code> çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹å®ç°é«˜æ•ˆã€å¯é çš„åå°ä»»åŠ¡è‡³å…³é‡è¦ã€‚</p>
<p>å¯åŠ¨å‹æœåŠ¡æ‰§è¡Œç‹¬ç«‹ä»»åŠ¡ï¼ŒæŒç»­è¿è¡Œç›´åˆ°è¢«åœæ­¢ï¼›è€Œç»‘å®šå‹æœåŠ¡ä¸ºå®¢æˆ·ç«¯æä¾›äº¤äº’æ¥å£ï¼Œä¸€æ—¦è§£ç»‘å³ç»ˆæ­¢ã€‚</p>
<p>æ­£ç¡®ç®¡ç†è¿™äº›ç”Ÿå‘½å‘¨æœŸï¼Œèƒ½ç¡®ä¿èµ„æºä½¿ç”¨æœ€ä¼˜ï¼Œå¹¶é¿å…å†…å­˜æ³„æ¼ã€‚</p>
<hr/>
<h2 data-id="heading-34">BroadcastReceiver</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a68efbaca73418292762774fb81980e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=j602UcokUNZ18noKrXH%2BA%2BthwFg%3D" alt="9.png" loading="lazy"/></p>
<p><code>BroadcastReceiver</code> æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒè®©ä½ çš„ App èƒ½å¤Ÿç›‘å¬å¹¶å“åº”ç³»ç»Ÿçº§å¹¿æ’­æ¶ˆæ¯æˆ–åº”ç”¨è‡ªå®šä¹‰çš„å¹¿æ’­ã€‚è¿™äº›å¹¿æ’­é€šå¸¸ç”±ç³»ç»Ÿæˆ–å…¶ä»–åº”ç”¨è§¦å‘ï¼Œç”¨äºé€šçŸ¥å„ç§äº‹ä»¶ï¼Œæ¯”å¦‚ç”µæ± çŠ¶æ€å˜åŒ–ã€ç½‘ç»œè¿æ¥æ›´æ–°ï¼Œæˆ–è€… App å†…éƒ¨å‘é€çš„è‡ªå®šä¹‰ <code>Intent</code>ã€‚</p>
<p><code>BroadcastReceiver</code> æ˜¯æ„å»ºå“åº”å¼åº”ç”¨çš„é‡è¦æœºåˆ¶ï¼Œèƒ½è®©ä½ çš„ç¨‹åºå¯¹åŠ¨æ€çš„ç³»ç»Ÿæˆ–åº”ç”¨çº§äº‹ä»¶åšå‡ºåŠæ—¶ååº”ã€‚</p>
<p><em><code>BroadcastReceiver</code> æ­£ç¡®çš„ä¸­æ–‡ç¿»è¯‘æ˜¯å¹¿æ’­æ¥æ”¶å™¨ï¼Œè€Œå¹¿æ’­åº”è¯¥æ˜¯ <code>Broadcast</code>ï¼Œä½†æ˜¯å¼€å‘è€…ä¸ä¼šåŒºåˆ†è¿™ä¹ˆç»†ã€‚å½“ä½ ç€é‡å‘é€çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯å¹¿æ’­ï¼Œè€Œç€é‡æ¥æ”¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯å¹¿æ’­æ¥æ”¶å™¨ã€‚åç»­å°†ä¼šæ²¿ç”¨è¿™ç§ä¹ æƒ¯ã€‚</em></p>
<h3 data-id="heading-35">é¢è¯•é—®é¢˜</h3>
<p>å¹¿æ’­æœ‰å“ªäº›ä¸åŒç±»å‹ï¼Ÿ</p>
<p>ç³»ç»Ÿå¹¿æ’­ä¸è‡ªå®šä¹‰å¹¿æ’­åœ¨åŠŸèƒ½å’Œç”¨é€”ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p>
<h3 data-id="heading-36">BroadcastReceiver çš„ä½œç”¨</h3>
<p><code>BroadcastReceiver</code> ç”¨æ¥å¤„ç†é‚£äº›ä¸ç›´æ¥ä¸ <code>Activity</code> æˆ– <code>Service</code> ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„äº‹ä»¶ã€‚</p>
<p>å®ƒç›¸å½“äºä¸€ä¸ªæ¶ˆæ¯ç³»ç»Ÿï¼Œè®©ä½ çš„ App èƒ½åœ¨ä¸éœ€è¦ä¸€ç›´åå°è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œå¯¹ç³»ç»Ÿå˜åŒ–åšå‡ºå“åº”ï¼Œä»è€ŒèŠ‚çœèµ„æºã€‚</p>
<h3 data-id="heading-37">å¹¿æ’­çš„ç±»å‹</h3>
<ol>
<li><strong>ç³»ç»Ÿå¹¿æ’­</strong>ï¼šç”± Android æ“ä½œç³»ç»Ÿå‘å‡ºï¼Œç”¨äºé€šçŸ¥åº”ç”¨ç³»ç»Ÿäº‹ä»¶ï¼Œæ¯”å¦‚ç”µæ± ç”µé‡å˜åŒ–ã€æ—¶åŒºæ›´æ–°æˆ–ç½‘ç»œè¿æ¥çŠ¶æ€æ”¹å˜ã€‚</li>
<li><strong>è‡ªå®šä¹‰å¹¿æ’­</strong>ï¼šç”±åº”ç”¨è‡ªèº«å‘å‡ºï¼Œç”¨äºåœ¨åº”ç”¨å†…éƒ¨æˆ–ä¸åŒåº”ç”¨ä¹‹é—´ä¼ é€’ç‰¹å®šä¿¡æ¯æˆ–äº‹ä»¶ã€‚</li>
</ol>
<h3 data-id="heading-38">å£°æ˜ä¸€ä¸ª BroadcastReceiver</h3>
<p>è¦åˆ›å»ºä¸€ä¸ª <code>BroadcastReceiver</code>ï¼Œä½ éœ€è¦ç»§æ‰¿ <code>BroadcastReceiver</code> ç±»ï¼Œå¹¶é‡å†™ <code>onReceive</code> æ–¹æ³•ï¼Œåœ¨å…¶ä¸­å®šä¹‰å¤„ç†å¹¿æ’­çš„é€»è¾‘ã€‚</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBroadcastReceiver</span> : <span class="hljs-type">BroadcastReceiver</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onReceive</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>, intent: <span class="hljs-type">Intent</span>)</span></span> {
        <span class="hljs-keyword">val</span> action = intent.action
        <span class="hljs-keyword">if</span> (action == Intent.ACTION_BATTERY_LOW) {
            <span class="hljs-comment">// å¤„ç†ä½ç”µé‡äº‹ä»¶</span>
            Log.d(<span class="hljs-string">"MyBroadcastReceiver"</span>, <span class="hljs-string">"Battery is low!"</span>)
        }
    }
}
</code></pre>
<h3 data-id="heading-39">æ³¨å†Œ BroadcastReceiver</h3>
<p>ä½ å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ³¨å†Œ <code>BroadcastReceiver</code>ï¼š</p>
<ol>
<li><strong>é™æ€æ³¨å†Œ</strong> ï¼šé€‚ç”¨äºå³ä½¿åº”ç”¨æœªè¿è¡Œä¹Ÿéœ€è¦å¤„ç†çš„äº‹ä»¶ã€‚åœ¨ <code>AndroidManifest.xml</code> æ–‡ä»¶ä¸­æ·»åŠ  <code>&lt;intent-filter&gt;</code>ã€‚</li>
</ol>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">receiver</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">".MyBroadcastReceiver"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.intent.action.BATTERY_LOW"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">receiver</span>&gt;</span>
</code></pre>
<ol start="2">
<li><strong>åŠ¨æ€æ³¨å†Œ</strong> ï¼šé€‚ç”¨äºä»…åœ¨åº”ç”¨å¤„äºæ´»è·ƒçŠ¶æ€æˆ–ç‰¹å®šåœºæ™¯ä¸‹æ‰éœ€è¦å¤„ç†çš„äº‹ä»¶ã€‚</li>
</ol>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> receiver = MyBroadcastReceiver()
<span class="hljs-keyword">val</span> intentFilter = IntentFilter(Intent.ACTION_BATTERY_LOW)
registerReceiver(receiver, intentFilter)
</code></pre>
<h3 data-id="heading-40">æ³¨æ„äº‹é¡¹</h3>
<ul>
<li><strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šå¦‚æœä½¿ç”¨åŠ¨æ€æ³¨å†Œï¼ŒåŠ¡å¿…åœ¨é€‚å½“æ—¶å€™è°ƒç”¨ <code>unregisterReceiver</code> å–æ¶ˆæ³¨å†Œï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚</li>
<li><strong>åå°é™åˆ¶</strong>ï¼šä» Android 8.0ï¼ˆAPI çº§åˆ« 26ï¼‰å¼€å§‹ï¼Œåå°åº”ç”¨æ¥æ”¶å¹¿æ’­å—åˆ°é™åˆ¶ï¼Œä¸èƒ½åœ¨ <code>AndroidManifest</code> ä¸­ä¸ºéšå¼å¹¿æ’­æ³¨å†Œ <code>BroadcastReceiver</code>ï¼Œé™¤éè¯¥å¹¿æ’­æ˜¯ä¸“é—¨å‘é€ç»™å®ƒä»¬çš„ã€‚å»ºè®®ä½¿ç”¨ <code>Context.registerReceiver</code> æˆ– <code>JobScheduler</code> æ¥å¤„ç†è¿™ç±»åœºæ™¯ã€‚</li>
<li><strong>å®‰å…¨é—®é¢˜</strong>ï¼šå¦‚æœå¹¿æ’­åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œåº”é€šè¿‡æƒé™ä¿æŠ¤ï¼Œé˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€‚</li>
</ul>
<h3 data-id="heading-41">å¹¿æ’­çš„å…¸å‹ç”¨ä¾‹</h3>
<ul>
<li>ç›‘å¬ç½‘ç»œè¿æ¥çŠ¶æ€çš„å˜åŒ–ã€‚</li>
<li>å“åº”çŸ­ä¿¡æˆ–ç”µè¯äº‹ä»¶ã€‚</li>
<li>æ ¹æ®ç³»ç»Ÿäº‹ä»¶ï¼ˆå¦‚å……ç”µçŠ¶æ€ï¼‰æ›´æ–° UIã€‚</li>
<li>ä½¿ç”¨è‡ªå®šä¹‰å¹¿æ’­æ¥è°ƒåº¦ä»»åŠ¡æˆ–é—¹é’Ÿã€‚</li>
</ul>
<h3 data-id="heading-42">æ€»ç»“</h3>
<p><code>BroadcastReceiver</code> æ˜¯æ„å»ºå“åº”å¼åº”ç”¨ç¨‹åºçš„å…³é”®ç»„ä»¶ï¼Œå°¤å…¶é€‚ç”¨äºä¸æ“ä½œç³»ç»Ÿäº¤äº’ã€‚å®ƒä»¬ä½¿æ‚¨çš„åº”ç”¨èƒ½å¤Ÿé«˜æ•ˆåœ°ç›‘å¬å¹¶å“åº”ç³»ç»Ÿæˆ–åº”ç”¨äº‹ä»¶ã€‚æ­£ç¡®ä½¿ç”¨ <code>BroadcastReceiver</code>ï¼Œç‰¹åˆ«æ˜¯ç»“åˆç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥çš„æ³¨å†Œæ–¹å¼ï¼Œå¹¶éµå®ˆè¾ƒæ–° Android ç‰ˆæœ¬çš„é™åˆ¶è¦æ±‚ï¼Œå¯ç¡®ä¿æ‚¨çš„åº”ç”¨ä¿æŒç¨³å®šä¸”èµ„æºé«˜æ•ˆã€‚</p>
<hr/>
<h2 data-id="heading-43">ContentProvider</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66f0a7667acc412ab968646514e98dec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=y2%2Bwqs0q%2B662h23bIrg7tjy6uqE%3D" alt="10.png" loading="lazy"/></p>
<p><code>ContentProvider</code> æ˜¯ä¸€ç§ç®¡ç†å¯¹ç»“æ„åŒ–æ•°æ®é›†è®¿é—®çš„ç»„ä»¶ï¼Œå¹¶ä¸ºåº”ç”¨ç¨‹åºé—´çš„æ•°æ®å…±äº«æä¾›æ ‡å‡†åŒ–æ¥å£ã€‚å®ƒä½œä¸ºä¸€ä¸ªä¸­å¤®å­˜å‚¨åº“ï¼Œä¾›å…¶ä»–åº”ç”¨æˆ–ç»„ä»¶æŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤æ•°æ®ï¼Œä»è€Œç¡®ä¿è·¨åº”ç”¨çš„æ•°æ®å…±äº«æ—¢å®‰å…¨åˆä¸€è‡´ã€‚</p>
<p><code>ContentProvider</code> åœ¨å¤šä¸ªåº”ç”¨éœ€è¦è®¿é—®ç›¸åŒæ•°æ®ï¼Œæˆ–å¸Œæœ›åœ¨ä¸æš´éœ²æ•°æ®åº“æˆ–å†…éƒ¨å­˜å‚¨ç»“æ„çš„æƒ…å†µä¸‹å‘å…¶ä»–åº”ç”¨æä¾›æ•°æ®æ—¶å°¤å…¶æœ‰ç”¨ã€‚</p>
<h3 data-id="heading-44">é¢è¯•é—®é¢˜</h3>
<p><code>ContentProvider</code> <strong>URI</strong> çš„å…³é”®ç»„æˆéƒ¨åˆ†æœ‰å“ªäº›ï¼Ÿ</p>
<p><code>ContentResolver</code> å¦‚ä½•ä¸ <code>ContentProvider</code> äº¤äº’ä»¥æŸ¥è¯¢æˆ–ä¿®æ”¹æ•°æ®ï¼Ÿ</p>
<h3 data-id="heading-45">ä½œç”¨</h3>
<p><code>ContentProvider</code> çš„ä¸»è¦ç›®çš„æ˜¯å°è£…æ•°æ®è®¿é—®é€»è¾‘ï¼Œä½¿è·¨åº”ç”¨å…±äº«æ•°æ®æ›´åŠ ç®€å•å’Œå®‰å…¨ã€‚å®ƒæŠ½è±¡äº†åº•å±‚æ•°æ®æºï¼ˆå¯ä»¥æ˜¯ <strong>SQLite</strong> æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿï¼Œç”šè‡³æ˜¯åŸºäºç½‘ç»œçš„æ•°æ®ï¼‰ï¼Œå¹¶æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ¥ä¸æ•°æ®è¿›è¡Œäº¤äº’ã€‚</p>
<h3 data-id="heading-46">å…³é”®ç»„æˆéƒ¨åˆ†</h3>
<p><code>ContentProvider</code> ä½¿ç”¨ <strong>URI</strong>ï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰ä½œä¸ºå…¶æ•°æ®è®¿é—®åœ°å€ã€‚<strong>URI</strong> ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š</p>
<ol>
<li><strong>Authorityï¼ˆæƒé™ï¼‰</strong> ï¼šæ ‡è¯† <code>ContentProvider</code>ï¼ˆä¾‹å¦‚ï¼š<code>com.example.myapp.provider</code>ï¼‰ã€‚</li>
<li><strong>Pathï¼ˆè·¯å¾„ï¼‰</strong> ï¼šæŒ‡å®šæ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚ï¼š<code>/users</code> æˆ– <code>/products</code>ï¼‰ã€‚</li>
<li><strong>IDï¼ˆå¯é€‰ï¼‰</strong> ï¼šæŒ‡å‘æ•°æ®é›†ä¸­æŸä¸ªç‰¹å®šé¡¹ç›®ã€‚</li>
</ol>
<h3 data-id="heading-47">å®ç°ä¸€ä¸ª ContentProvider</h3>
<p>è¦åˆ›å»ºä¸€ä¸ª <code>ContentProvider</code>ï¼Œå¿…é¡»ç»§æ‰¿ <code>ContentProvider</code> ç±»å¹¶å®ç°ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ul>
<li><code>onCreate()</code>ï¼šåˆå§‹åŒ– <code>ContentProvider</code>ã€‚</li>
<li><code>query()</code>ï¼šè·å–æ•°æ®ã€‚</li>
<li><code>insert()</code>ï¼šæ·»åŠ æ–°æ•°æ®ã€‚</li>
<li><code>update()</code>ï¼šä¿®æ”¹ç°æœ‰æ•°æ®ã€‚</li>
<li><code>delete()</code>ï¼šåˆ é™¤æ•°æ®ã€‚</li>
<li><code>getType()</code>ï¼šè¿”å›æ•°æ®çš„ <strong>MIME</strong> ç±»å‹ã€‚</li>
</ul>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyContentProvider</span> : <span class="hljs-type">ContentProvider</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> database: SQLiteDatabase

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
        database = MyDatabaseHelper(context!!).writableDatabase
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">query</span><span class="hljs-params">(
        uri: <span class="hljs-type">Uri</span>,
        projection: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt;?,
        selection: <span class="hljs-type">String</span>?,
        selectionArgs: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt;?,
        sortOrder: <span class="hljs-type">String</span>?
    )</span></span>: Cursor? {
        <span class="hljs-keyword">return</span> database.query(<span class="hljs-string">"users"</span>, projection, selection, selectionArgs, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, sortOrder)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insert</span><span class="hljs-params">(uri: <span class="hljs-type">Uri</span>, values: <span class="hljs-type">ContentValues</span>?)</span></span>: Uri? {
        <span class="hljs-keyword">val</span> id = database.insert(<span class="hljs-string">"users"</span>, <span class="hljs-literal">null</span>, values)
        <span class="hljs-keyword">return</span> ContentUris.withAppendedId(uri, id)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">update</span><span class="hljs-params">(uri: <span class="hljs-type">Uri</span>, values: <span class="hljs-type">ContentValues</span>?, selection: <span class="hljs-type">String</span>?, selectionArgs: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt;?)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> database.update(<span class="hljs-string">"users"</span>, values, selection, selectionArgs)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">delete</span><span class="hljs-params">(uri: <span class="hljs-type">Uri</span>, selection: <span class="hljs-type">String</span>?, selectionArgs: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt;?)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> database.delete(<span class="hljs-string">"users"</span>, selection, selectionArgs)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getType</span><span class="hljs-params">(uri: <span class="hljs-type">Uri</span>)</span></span>: String? {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"vnd.android.cursor.dir/vnd.com.example.myapp.users"</span>
    }
}
</code></pre>
<h3 data-id="heading-48">æ³¨å†Œ ContentProvider</h3>
<p>ä¸ºäº†è®©å…¶ä»–åº”ç”¨ç¨‹åºèƒ½å¤Ÿè®¿é—®ä½ çš„ <code>ContentProvider</code>ï¼Œä½ å¿…é¡»åœ¨ <code>AndroidManifest.xml</code> æ–‡ä»¶ä¸­å¯¹å…¶è¿›è¡Œå£°æ˜ã€‚å…¶ä¸­ <code>android:authority</code> å±æ€§ç”¨äºå”¯ä¸€æ ‡è¯†ä½ çš„ <code>ContentProvider</code>ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">provider</span>
    <span class="hljs-attr">android:name</span>=<span class="hljs-string">".MyContentProvider"</span>
    <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"com.example.myapp.provider"</span>
    <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"true"</span>
    <span class="hljs-attr">android:grantUriPermissions</span>=<span class="hljs-string">"true"</span> /&gt;</span>
</code></pre>
<h3 data-id="heading-49">ä» ContentProvider è®¿é—®æ•°æ®</h3>
<p>ä½ å¯ä»¥ä½¿ç”¨ <code>ContentResolver</code> ç±»ä»å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸ <code>ContentProvider</code> è¿›è¡Œäº¤äº’ã€‚<code>ContentResolver</code> æä¾›äº†æŸ¥è¯¢ã€æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤æ•°æ®çš„æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">val</span> contentResolver = context.contentResolver

<span class="hljs-comment">// æŸ¥è¯¢æ•°æ®</span>
<span class="hljs-keyword">val</span> cursor = contentResolver.query(
    Uri.parse(<span class="hljs-string">"content://com.example.myapp.provider/users"</span>),
    <span class="hljs-literal">null</span>,
    <span class="hljs-literal">null</span>,
    <span class="hljs-literal">null</span>,
    <span class="hljs-literal">null</span>
)

<span class="hljs-comment">// æ’å…¥æ•°æ®</span>
<span class="hljs-keyword">val</span> values = ContentValues().apply {
    put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"John Doe"</span>)
    put(<span class="hljs-string">"email"</span>, <span class="hljs-string">"johndoe@example.com"</span>)
}
contentResolver.insert(Uri.parse(<span class="hljs-string">"content://com.example.myapp.provider/users"</span>), values)
</code></pre>
<h3 data-id="heading-50">ContentProvider çš„ä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>åœ¨ä¸åŒåº”ç”¨ç¨‹åºä¹‹é—´å…±äº«æ•°æ®ã€‚</li>
<li>åœ¨åº”ç”¨å¯åŠ¨è¿‡ç¨‹ä¸­åˆå§‹åŒ–ç»„ä»¶æˆ–èµ„æºã€‚</li>
<li>æä¾›å¯¹ç»“æ„åŒ–æ•°æ®çš„è®¿é—®ï¼Œä¾‹å¦‚è”ç³»äººã€åª’ä½“æ–‡ä»¶æˆ–åº”ç”¨ç‰¹å®šæ•°æ®ã€‚</li>
<li>å®ç°ä¸ Android ç³»ç»ŸåŠŸèƒ½çš„é›†æˆï¼Œä¾‹å¦‚è”ç³»äººåº”ç”¨æˆ–æ–‡ä»¶é€‰æ‹©å™¨ã€‚</li>
<li>å…è®¸é€šè¿‡ç»†ç²’åº¦çš„å®‰å…¨æ§åˆ¶è¿›è¡Œæ•°æ®è®¿é—®ã€‚</li>
</ul>
<h3 data-id="heading-51">æ€»ç»“</h3>
<p><code>ContentProvider</code> æ˜¯åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å®‰å…¨ã€é«˜æ•ˆåœ°å…±äº«ç»“æ„åŒ–æ•°æ®çš„å…³é”®ç»„ä»¶ã€‚å®ƒä¸ºæ•°æ®è®¿é—®æä¾›äº†æ ‡å‡†åŒ–æ¥å£ï¼ŒåŒæ—¶æŠ½è±¡äº†åº•å±‚çš„æ•°æ®å­˜å‚¨æœºåˆ¶ã€‚æ­£ç¡®çš„å®ç°å’Œæ³¨å†Œå¯ä»¥ç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€å®‰å…¨æ€§ï¼Œå¹¶ä¸ Android ç³»ç»ŸåŠŸèƒ½ä¿æŒå…¼å®¹ã€‚</p>
<h3 data-id="heading-52">è¿›é˜¶ï¼šä½¿ç”¨ ContentProvider åˆå§‹åŒ–èµ„æº</h3>
<p><code>ContentProvider</code> çš„å¦ä¸€ä¸ªé‡è¦ç”¨é€”æ˜¯ï¼š<strong>åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–èµ„æºæˆ–é…ç½®</strong>ã€‚</p>
<p>é€šå¸¸ï¼Œèµ„æºæˆ–åº“çš„åˆå§‹åŒ–æ˜¯åœ¨ <code>Application</code> ç±»ä¸­å®Œæˆçš„ã€‚ä½†ä½ å¯ä»¥å°†è¿™éƒ¨åˆ†é€»è¾‘å°è£…åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ <code>ContentProvider</code> ä¸­ï¼Œä»¥å®ç°æ›´å¥½çš„èŒè´£åˆ†ç¦»ã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>ContentProvider</code> å¹¶åœ¨ <code>AndroidManifest.xml</code> ä¸­æ³¨å†Œå®ƒï¼Œå¯ä»¥é«˜æ•ˆåœ°å§”æ‰˜åˆå§‹åŒ–ä»»åŠ¡ã€‚</p>
<p><code>ContentProvider</code> çš„ <code>onCreate()</code> æ–¹æ³•ä¼šåœ¨ <code>Application.onCreate()</code> ä¹‹å‰è¢«è°ƒç”¨ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªéå¸¸ç†æƒ³çš„æ—©æœŸåˆå§‹åŒ–å…¥å£ç‚¹ã€‚ä¾‹å¦‚ï¼Œ<strong>Firebase SDK</strong> å°±ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>ContentProvider</code> æ¥è‡ªåŠ¨åˆå§‹åŒ– <strong>Firebase SDK</strong>ã€‚è¿™ç§æ–¹å¼é¿å…äº†åœ¨ <code>Application</code> ç±»ä¸­æ‰‹åŠ¨è°ƒç”¨ <code>FirebaseApp.initializeApp(this)</code>ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ <strong>Firebase</strong> æä¾›çš„ä¸€ä¸ªç¤ºä¾‹å®ç°ï¼š</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FirebaseInitProvider</span> <span class="hljs-title">extends</span> <span class="hljs-title">ContentProvider</span> {
    <span class="hljs-comment">/** åœ¨ {<span class="hljs-doctag">@link</span> Application#onCreate()} ä¹‹å‰è¢«è°ƒç”¨ã€‚ */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> boolean onCreate() {
        <span class="hljs-keyword">try</span> {
            currentlyInitializing.<span class="hljs-keyword">set</span>(<span class="hljs-literal">true</span>);
            <span class="hljs-keyword">if</span> (FirebaseApp.initializeApp(getContext()) == <span class="hljs-literal">null</span>) {
                Log.i(TAG, <span class="hljs-string">"FirebaseApp initialization unsuccessful"</span>);
            } <span class="hljs-keyword">else</span> {
                Log.i(TAG, <span class="hljs-string">"FirebaseApp initialization successful"</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">finally</span> {
            currentlyInitializing.<span class="hljs-keyword">set</span>(<span class="hljs-literal">false</span>);
        }
    }
}
</code></pre>
<p><code>FirebaseInitProvider</code> åœ¨å…¶ XML æ–‡ä»¶ä¸­çš„æ³¨å†Œæ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">manifest</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- è™½ç„¶ SDK ç‰ˆæœ¬ä¿¡æ¯åœ¨ Gradle æ„å»ºæ–‡ä»¶ä¸­å·²æ•è·ï¼Œä½†é Gradle æ„å»ºä»éœ€æ­¤é…ç½® --&gt;</span>
    <span class="hljs-comment">&lt;!-- &lt;uses-sdk android:minSdkVersion="21"/&gt; --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">application</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">provider</span>
            <span class="hljs-attr">android:name</span>=<span class="hljs-string">"com.google.firebase.provider.FirebaseInitProvider"</span>
            <span class="hljs-attr">android:authorities</span>=<span class="hljs-string">"${applicationId}.firebaseinitprovider"</span>
            <span class="hljs-attr">android:directBootAware</span>=<span class="hljs-string">"true"</span>
            <span class="hljs-attr">android:exported</span>=<span class="hljs-string">"false"</span>
            <span class="hljs-attr">android:initOrder</span>=<span class="hljs-string">"100"</span> /&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">application</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span>
</code></pre>
<p>è¿™ç§æ¨¡å¼ç¡®ä¿äº†å…³é”®èµ„æºæˆ–åº“èƒ½å¤Ÿåœ¨åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„æ—©æœŸè‡ªåŠ¨å®Œæˆåˆå§‹åŒ–ï¼Œä»è€Œå®ç°æ›´æ¸…æ™°ã€æ›´æ¨¡å—åŒ–çš„è®¾è®¡ã€‚</p>
<p>å¦ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„ <code>ContentProvider</code> ç”¨ä¾‹æ˜¯ <strong>Jetpack App Startup</strong> åº“ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•é«˜æ•ˆçš„æ–¹å¼æ¥åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ–ç»„ä»¶ã€‚å…¶å†…éƒ¨å®ç°ä½¿ç”¨äº†ä¸€ä¸ªåä¸º <code>InitializationProvider</code> çš„ç±»ï¼Œè¯¥ç±»åˆ©ç”¨ <code>ContentProvider</code> æ¥åˆå§‹åŒ–æ‰€æœ‰å®ç°äº† <code>Initializer</code> æ¥å£çš„é¢„å®šä¹‰ç±»ã€‚è¿™ç¡®ä¿äº†åˆå§‹åŒ–é€»è¾‘åœ¨ <code>Application.onCreate()</code> æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰å°±å·²ç»å®Œæˆã€‚</p>
<p>ä»¥ä¸‹æ˜¯ <code>InitializationProvider</code> çš„å†…éƒ¨å®ç°ï¼Œå®ƒæ˜¯ <strong>Jetpack App Startup</strong> åº“çš„æ ¸å¿ƒç»„ä»¶ï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">/**
 * The {<span class="hljs-doctag">@link</span> ContentProvider} which discovers {<span class="hljs-doctag">@link</span> Initializer}s in an application and    
 * initializes them before {<span class="hljs-doctag">@link</span> Application#onCreate()}.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InitializationProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ContentProvider</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Context</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> getContext();
        <span class="hljs-keyword">if</span> (context != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">Context</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> context.getApplicationContext();
            <span class="hljs-keyword">if</span> (applicationContext != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// Initialize all registered Initializer classes.</span>
                AppInitializer.getInstance(context).discoverAndInitialize(getClass());
            } <span class="hljs-keyword">else</span> {
                StartupLogger.w(<span class="hljs-string">"Deferring initialization because `applicationContext` is null."</span>);
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StartupException</span>(<span class="hljs-string">"Context cannot be null"</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<p>è¯¥å®ç°ä¸­çš„ <code>onCreate()</code> æ–¹æ³•ä¼šè°ƒç”¨
<code>AppInitializer.getInstance(context).discoverAndInitialize(getClass())</code>ï¼Œ<br/>
å®ƒä¼šè‡ªåŠ¨å‘ç°å¹¶åˆå§‹åŒ–æ‰€æœ‰å·²æ³¨å†Œçš„ <code>Initializer</code> å®ç°ç±»ï¼Œ<strong>åœ¨åº”ç”¨ç”Ÿå‘½å‘¨æœŸå¼€å§‹ä¹‹å‰å®Œæˆ</strong>ã€‚<br/>
è¿™ç¡®ä¿äº†åº”ç”¨ç»„ä»¶å¯ä»¥åœ¨ä¸æ±¡æŸ“ <code>Application.onCreate()</code> æ–¹æ³•çš„æƒ…å†µä¸‹è¢«é«˜æ•ˆåœ°åˆå§‹åŒ–ã€‚</p>
<hr/>
<h2 data-id="heading-53">å¦‚ä½•å¤„ç†é…ç½®å˜æ›´</h2>
<p>å¤„ç†é…ç½®å˜æ›´å¯¹äºä¿æŒæµç•…çš„ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ï¼Œå°¤å…¶æ˜¯åœ¨å±å¹•æ—‹è½¬ã€è¯­è¨€åˆ‡æ¢ã€æ·±è‰²/æµ…è‰²æ¨¡å¼åˆ‡æ¢ï¼Œä»¥åŠå­—ä½“å¤§å°æˆ–ç²—ç»†è°ƒæ•´ç­‰åœºæ™¯ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“è¿™äº›å˜æ›´å‘ç”Ÿæ—¶ï¼ŒAndroid ç³»ç»Ÿä¼šé‡å¯ <code>Activity</code>ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸´æ—¶ UI çŠ¶æ€çš„ä¸¢å¤±ã€‚</p>
<h3 data-id="heading-54">é¢è¯•é—®é¢˜</h3>
<p>å¤„ç†é…ç½®å˜æ›´æœ‰å“ªäº›ä¸åŒçš„ç­–ç•¥ï¼Ÿ</p>
<p><code>ViewModel</code> åœ¨æ­¤ç±»äº‹ä»¶ä¸­å¦‚ä½•å¸®åŠ©ä¿å­˜ä¸ UI ç›¸å…³çš„æ•°æ®ï¼Ÿ</p>
<p><code>AndroidManifest.xml</code> ä¸­çš„ <code>android:configChanges</code> å±æ€§å¦‚ä½•å½±å“ <code>Activity</code> çš„ç”Ÿå‘½å‘¨æœŸè¡Œä¸ºï¼Ÿ</p>
<p>åœ¨å“ªäº›åœºæ™¯ä¸‹åº”ä½¿ç”¨ <code>onConfigurationChanged()</code> æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä¾èµ– <code>Activity</code> çš„é‡å»ºï¼Ÿ</p>
<h3 data-id="heading-55">å®æˆ˜</h3>
<p>ä¸ºäº†æœ‰æ•ˆåº”å¯¹è¿™äº›å˜åŒ–ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹ç­–ç•¥ï¼š</p>
<ol>
<li><strong>ä¿å­˜å’Œæ¢å¤ UI çŠ¶æ€</strong>ï¼šå®ç° <code>onSaveInstanceState()</code> å’Œ <code>onRestoreInstanceState()</code> æ–¹æ³•ï¼Œä»¥åœ¨ <code>Activity</code> é‡å»ºæœŸé—´ä¿å­˜å’Œæ¢å¤ UI çŠ¶æ€ã€‚è¿™å¯ä»¥ç¡®ä¿ç”¨æˆ·åœ¨é…ç½®å˜æ›´åè¿”å›åˆ°ç›¸åŒçš„çŠ¶æ€ã€‚</li>
<li><strong>ä½¿ç”¨ <code>ViewModel</code></strong>ï¼šåˆ©ç”¨ <code>ViewModel</code> ç±»æ¥å­˜å‚¨ä¸ UI ç›¸å…³çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥åœ¨é…ç½®å˜æ›´æ—¶å­˜æ´»ã€‚<code>ViewModel</code> å¯¹è±¡çš„è®¾è®¡ç›®æ ‡æ˜¯è·¨è¶Š <code>Activity</code> é‡å»ºè€Œå­˜åœ¨ï¼Œå› æ­¤éå¸¸é€‚åˆåœ¨è¿™äº›äº‹ä»¶ä¸­ç®¡ç†æ•°æ®ã€‚</li>
<li><strong>æ‰‹åŠ¨å¤„ç†é…ç½®å˜æ›´</strong>ï¼šå¦‚æœæ‚¨çš„åº”ç”¨ä¸éœ€è¦åœ¨ç‰¹å®šé…ç½®å˜æ›´æ—¶æ›´æ–°èµ„æºï¼Œå¹¶ä¸”å¸Œæœ›é¿å… <code>Activity</code> é‡å¯ï¼Œå¯ä»¥åœ¨ <code>AndroidManifest.xml</code> ä¸­ä½¿ç”¨ <code>android:configChanges</code> å±æ€§å£°æ˜æ‚¨çš„ <code>Activity</code> æ‰€å¤„ç†çš„é…ç½®å˜æ›´ã€‚ç„¶åï¼Œé‡å†™ <code>onConfigurationChanged()</code> æ–¹æ³•ä»¥æ‰‹åŠ¨ç®¡ç†è¿™äº›å˜æ›´ã€‚</li>
<li><strong>åœ¨ Jetpack Compose ä¸­ä½¿ç”¨ <code>rememberSaveable</code></strong>ï¼šåœ¨ Jetpack Compose ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>rememberSaveable</code> æ¥è·¨é…ç½®å˜æ›´ä¿å­˜ UI çŠ¶æ€ã€‚å®ƒçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äº <code>onSaveInstanceState()</code>ï¼Œä½†ä¸“ä¸º Compose è®¾è®¡ï¼Œæœ‰åŠ©äºä¿æŒå¯ç»„åˆå‡½æ•°çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚è¿™å—å†…å®¹åç»­ä¼šè®²åˆ°ã€‚</li>
</ol>
<h3 data-id="heading-56">é¢å¤–æç¤º</h3>
<ul>
<li><strong>å¯¼èˆªä¸è¿”å›æ ˆçš„ä¿ç•™</strong>ï¼šä½¿ç”¨ <strong>Navigation</strong> ç»„ä»¶å¯ä»¥åœ¨é…ç½®å˜æ›´æ—¶ä¿ç•™å¯¼èˆªè¿”å›æ ˆã€‚</li>
<li><strong>é¿å…å­˜å‚¨ä¸é…ç½®ç›¸å…³çš„æ•°æ®</strong>ï¼šå°½å¯èƒ½é¿å…åœ¨ UI å±‚ç›´æ¥å­˜å‚¨ä¾èµ–äºé…ç½®çš„å€¼ã€‚å»ºè®®ä½¿ç”¨ <code>ViewModel</code> ç­‰æ›¿ä»£æ–¹æ¡ˆï¼Œå®ƒä¸“é—¨è®¾è®¡ç”¨äºåœ¨é…ç½®å˜æ›´æœŸé—´å¤„ç†æ•°æ®ã€‚</li>
</ul>
<h3 data-id="heading-57">æ€»ç»“</h3>
<p>æ­£ç¡®å¤„ç†é…ç½®å˜æ›´å¯¹äºæå‡ç”¨æˆ·ä½“éªŒè‡³å…³é‡è¦ï¼Œå¯ä»¥ç¡®ä¿ç”¨æˆ·æ•°æ®ä¸ä¼šå› æ„å¤–æƒ…å†µè€Œä¸¢å¤±ã€‚</p>
<hr/>
<h2 data-id="heading-58">å†…å­˜æ³„æ¼</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df5bf1e72d6e43a08c77d42bc55ef374~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766623687&amp;x-signature=GUY6deFchG07hWDdt9VXuR%2FW4PY%3D" alt="11.png" loading="lazy"/></p>
<p>Android é€šè¿‡ä¸€ç§<strong>åƒåœ¾å›æ”¶ï¼ˆgarbage collectionï¼‰æœºåˆ¶</strong>æ¥ç®¡ç†å†…å­˜ï¼Œè¯¥æœºåˆ¶ä¼šè‡ªåŠ¨å›æ”¶æœªä½¿ç”¨çš„å†…å­˜ï¼Œä»è€Œç¡®ä¿æ´»è·ƒåº”ç”¨å’ŒæœåŠ¡çš„å†…å­˜åˆ†é…é«˜æ•ˆã€‚å®ƒä¾èµ–äºæ‰˜ç®¡å†…å­˜ç¯å¢ƒï¼Œè¿™æ„å‘³ç€å¼€å‘è€…æ— éœ€åƒåœ¨ C++ ç­‰è¯­è¨€ä¸­é‚£æ ·æ‰‹åŠ¨åˆ†é…å’Œé‡Šæ”¾å†…å­˜ã€‚</p>
<p><strong>Dalvik</strong> æˆ– <strong>ART</strong> è¿è¡Œæ—¶ä¼šç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œæ¸…ç†ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå¹¶é˜²æ­¢è¿‡åº¦çš„å†…å­˜æ¶ˆè€—ã€‚</p>
<p>å½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼ŒAndroid ä¼šä½¿ç”¨ä¸€ä¸ªç§°ä¸º <strong>ä½å†…å­˜æ€æ‰‹ï¼ˆlow-memory killerï¼‰</strong> çš„æœºåˆ¶æ¥ç»ˆæ­¢åå°è¿›ç¨‹ï¼Œä»¥ä¼˜å…ˆä¿è¯å‰å°åº”ç”¨çš„æµç•…è¿è¡Œã€‚å¼€å‘è€…å¿…é¡»ç¡®ä¿è‡ªå·±çš„åº”ç”¨èƒ½å¤Ÿé«˜æ•ˆåœ°åˆ©ç”¨èµ„æºï¼Œä»¥æœ€å°åŒ–å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“ã€‚</p>
<h3 data-id="heading-59">é¢è¯•é—®é¢˜</h3>
<p>åº”ç”¨ç¨‹åºä¸­å†…å­˜æ³„æ¼çš„å¸¸è§åŸå› æœ‰å“ªäº›ï¼Ÿå¼€å‘è€…å¦‚ä½•é¢„é˜²å®ƒä»¬ï¼Ÿ</p>
<p>Android çš„åƒåœ¾å›æ”¶æœºåˆ¶æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿå¼€å‘è€…å¯ä»¥ä½¿ç”¨å“ªäº›å·¥å…·æ¥æ£€æµ‹å’Œä¿®å¤åº”ç”¨ä¸­çš„å†…å­˜æ³„æ¼ï¼Ÿ</p>
<h3 data-id="heading-60">å¦‚ä½•é¿å…å†…å­˜æ³„æ¼</h3>
<p>å†…å­˜æ³„æ¼å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºæŒæœ‰å¯¹ä¸å†éœ€è¦çš„å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œè¿™ä¼šé˜»æ­¢åƒåœ¾å›æ”¶å™¨å›æ”¶å†…å­˜ã€‚å¸¸è§åŸå› åŒ…æ‹¬ï¼šç”Ÿå‘½å‘¨æœŸç®¡ç†ä¸å½“ã€é™æ€å¼•ç”¨ï¼Œæˆ–é•¿æ—¶é—´æŒæœ‰å¯¹ <code>Context</code> çš„å¼•ç”¨ã€‚</p>
<h3 data-id="heading-61">æœ€ä½³å®è·µ</h3>
<ol>
<li><strong>ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶</strong>ï¼šåˆ©ç”¨ <code>ViewModel</code>ã€<code>Flow</code> é…åˆ <code>collectAsStateWithLifecycle</code> æˆ– <code>LiveData</code> ç­‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶ï¼Œå¯ç¡®ä¿åœ¨ç›¸å…³ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶èµ„æºè¢«æ­£ç¡®é‡Šæ”¾ã€‚è¿™äº›ç»„ä»¶ä¼šåœ¨å…³è”çš„ç”Ÿå‘½å‘¨æœŸä¸å†æ´»è·ƒæˆ–è¿›å…¥ç‰¹å®šçŠ¶æ€æ—¶è‡ªåŠ¨ç®¡ç†æ¸…ç†å·¥ä½œã€‚</li>
<li><strong>é¿å…æŒæœ‰ <code>Context</code> çš„å¼•ç”¨</strong>ï¼šé¿å…åœ¨é™æ€å­—æ®µæˆ–å•ä¾‹ç­‰é•¿ç”Ÿå‘½å‘¨æœŸå¯¹è±¡ä¸­ä¿ç•™å¯¹ <code>Activity</code> æˆ– <code>Context</code> çš„å¼•ç”¨ã€‚åº”å°½å¯èƒ½ä½¿ç”¨ <code>ApplicationContext</code>ï¼Œå› ä¸ºå®ƒä¸ä¸ <code>Activity</code> æˆ– <code>Fragment</code> çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šã€‚</li>
<li><strong>æ³¨é”€ç›‘å¬å™¨å’Œå›è°ƒ</strong>ï¼šå§‹ç»ˆåœ¨é€‚å½“çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ³¨é”€ç›‘å¬å™¨ã€è§‚å¯Ÿè€…æˆ–å›è°ƒã€‚ä¾‹å¦‚ï¼Œåœ¨ <code>onPause()</code> æˆ– <code>onStop()</code> ä¸­æ³¨é”€ <code>BroadcastReceiver</code>ã€‚</li>
<li><strong>å¯¹éå…³é”®å¯¹è±¡ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆ<code>WeakReference</code>ï¼‰</strong> ï¼šå¯¹äºä¸éœ€è¦å¼ºå¼•ç”¨çš„å¯¹è±¡ï¼Œä½¿ç”¨ <code>WeakReference</code>ã€‚è¿™å…è®¸åƒåœ¾å›æ”¶å™¨åœ¨éœ€è¦å†…å­˜æ—¶å›æ”¶è¿™äº›å¯¹è±¡ã€‚</li>
<li><strong>ä½¿ç”¨å·¥å…·æ£€æµ‹å†…å­˜æ³„æ¼</strong>ï¼šä½¿ç”¨å¦‚ <strong>LeakCanary</strong> è¿™ç±»å·¥å…·åœ¨å¼€å‘è¿‡ç¨‹ä¸­è¯†åˆ«å¹¶ä¿®å¤å†…å­˜æ³„æ¼ã€‚è¯¥å·¥å…·èƒ½æ­ç¤ºå“ªäº›å¯¹è±¡å¯¼è‡´äº†å†…å­˜æ³„æ¼ä»¥åŠå¦‚ä½•è§£å†³ã€‚æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ Android Studio ä¸­çš„ <strong>Memory Profiler</strong> æ¥å¸®åŠ©è¯†åˆ«å¯èƒ½å¯¼è‡´å¡é¡¿ã€å†»ç»“ç”šè‡³åº”ç”¨å´©æºƒçš„å†…å­˜æ³„æ¼å’Œå†…å­˜æŠ–åŠ¨é—®é¢˜ã€‚</li>
<li><strong>é¿å…å¯¹ <code>View</code> çš„é™æ€å¼•ç”¨</strong>ï¼šä¸åº”å°† <code>View</code> å­˜å‚¨åœ¨é™æ€å­—æ®µä¸­ï¼Œå› ä¸ºè¿™ä¼šé€šè¿‡æŒæœ‰ <code>Activity</code> çš„ä¸Šä¸‹æ–‡è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</li>
<li><strong>åŠæ—¶å…³é—­èµ„æº</strong>ï¼šå½“èµ„æºä¸å†éœ€è¦æ—¶ï¼ŒåŠ¡å¿…æ˜¾å¼é‡Šæ”¾æ–‡ä»¶æµã€æ¸¸æ ‡æˆ–æ•°æ®åº“è¿æ¥ç­‰èµ„æºã€‚ä¾‹å¦‚ï¼Œåœ¨æ•°æ®åº“æŸ¥è¯¢ååº”å…³é—­æ¸¸æ ‡ã€‚</li>
<li><strong>åˆç†ä½¿ç”¨ <code>Fragment</code> å’Œ <code>Activity</code></strong>ï¼šé¿å…è¿‡åº¦ä½¿ç”¨ <code>Fragment</code> æˆ–åœ¨å®ƒä»¬ä¹‹é—´é”™è¯¯åœ°æŒæœ‰å¼•ç”¨ã€‚åº”åœ¨ <code>onDestroyView()</code> æˆ– <code>onDetach()</code> ä¸­æ¸…ç† <code>Fragment</code> çš„å¼•ç”¨ã€‚</li>
</ol>
<h3 data-id="heading-62">æ€»ç»“</h3>
<p>Android çš„å†…å­˜ç®¡ç†æœºåˆ¶é«˜æ•ˆï¼Œä½†è¦æ±‚å¼€å‘è€…éµå¾ªæœ€ä½³å®è·µä»¥é˜²æ­¢å†…å­˜æ³„æ¼ã€‚ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥ç»„ä»¶ã€é¿å…å¯¹ <code>Context</code> æˆ– <code>View</code> çš„é™æ€å¼•ç”¨ï¼Œå¹¶å€ŸåŠ©å¦‚ <strong>LeakCanary</strong> ç­‰å·¥å…·ï¼Œå¯ä»¥æ˜¾è‘—é™ä½å†…å­˜æ³„æ¼çš„é£é™©ã€‚åœ¨é€‚å½“çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä¸­è¿›è¡Œèµ„æºç®¡ç†å’Œæ¸…ç†ï¼Œæœ‰åŠ©äºç¡®ä¿åº”ç”¨æ€§èƒ½æ›´æµç•…ã€ç”¨æˆ·ä½“éªŒæ›´ä½³ã€‚</p>
<hr/>
<h2 data-id="heading-63">éš¾æçš„ ANR</h2>
<p><strong>ANR</strong>ï¼ˆApplication Not Respondingï¼Œåº”ç”¨æ— å“åº”ï¼‰æ˜¯ Android ä¸­çš„ä¸€ç§é”™è¯¯ï¼Œå½“åº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹ï¼ˆå³ UI çº¿ç¨‹ï¼‰è¢«é˜»å¡è¶…è¿‡ä¸€å®šæ—¶é—´ï¼ˆé€šå¸¸ä¸º<strong>5ç§’æˆ–æ›´é•¿</strong>ï¼‰æ—¶å°±ä¼šå‘ç”Ÿã€‚å½“å‡ºç° <strong>ANR</strong> æ—¶ï¼ŒAndroid ä¼šæç¤ºç”¨æˆ·é€‰æ‹©å…³é—­åº”ç”¨æˆ–ç­‰å¾…å…¶å“åº”ã€‚<strong>ANR</strong> ä¼šä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒï¼Œå…¶å¸¸è§åŸå› åŒ…æ‹¬ï¼š</p>
<ul>
<li>åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œè€—æ—¶è¶…è¿‡<strong>5ç§’</strong>çš„å¤æ‚è®¡ç®—ï¼ˆå³é˜»å¡ä¸»çº¿ç¨‹<strong>5ç§’</strong>ï¼‰ï¼›</li>
<li>æ‰§è¡Œé•¿æ—¶é—´çš„ç½‘ç»œæˆ–æ•°æ®åº“æ“ä½œï¼›</li>
<li>é˜»å¡ UI æ“ä½œï¼ˆä¾‹å¦‚ï¼Œåœ¨ UI çº¿ç¨‹ä¸Šæ‰§è¡ŒåŒæ­¥æ“ä½œï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-64">é¢è¯•é—®é¢˜</h3>
<p>å¦‚ä½•æ£€æµ‹å’Œè¯Šæ–­ ANRï¼Ÿ</p>
<p>å¦‚ä½•ä¼˜åŒ–åº”ç”¨æ€§èƒ½ä»¥æ”¹å–„ç”¨æˆ·ä½“éªŒï¼Ÿ</p>
<h3 data-id="heading-65">å¦‚ä½•é˜²æ­¢ ANR</h3>
<p>è¦é˜²æ­¢ <strong>ANR</strong>ï¼Œå…³é”®åœ¨äºä¿æŒä¸»çº¿ç¨‹çš„å“åº”æ€§ï¼Œé€šè¿‡å°†è€—æ—¶æˆ–è®¡ç®—å¯†é›†å‹ä»»åŠ¡ç§»å‡ºä¸»çº¿ç¨‹æ¥å®ç°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ€ä½³å®è·µï¼š</p>
<ol>
<li><strong>å°†è€—æ—¶ä»»åŠ¡ç§»å‡ºä¸»çº¿ç¨‹</strong>ï¼šä½¿ç”¨åå°çº¿ç¨‹ï¼ˆå¦‚ <code>AsyncTask</code>ã€<code>Executors</code> æˆ– <code>Thread</code>ï¼‰å¤„ç†æ–‡ä»¶ I/Oã€ç½‘ç»œè¯·æ±‚æˆ–æ•°æ®åº“æ“ä½œç­‰ä»»åŠ¡ã€‚å¯¹äºæ›´ç°ä»£ä¸”å®‰å…¨çš„æ–¹æ³•ï¼Œå»ºè®®ä½¿ç”¨ Kotlin åç¨‹é…åˆ <code>Dispatchers.IO</code> æ¥é«˜æ•ˆç®¡ç†åå°ä»»åŠ¡ã€‚</li>
<li><strong>ä½¿ç”¨ <code>WorkManager</code> å¤„ç†æŒä¹…æ€§ä»»åŠ¡</strong>ï¼šå¯¹äºéœ€è¦åœ¨åå°è¿è¡Œçš„ä»»åŠ¡ï¼ˆå¦‚æ•°æ®åŒæ­¥ï¼‰ï¼Œä½¿ç”¨ <code>WorkManager</code>ã€‚è¯¥ API å¯ç¡®ä¿ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹ä¹‹å¤–è¢«è°ƒåº¦å’Œæ‰§è¡Œã€‚</li>
<li><strong>ä¼˜åŒ–æ•°æ®è·å–</strong>ï¼šå®ç°åˆ†é¡µæœºåˆ¶ï¼Œä»¥é«˜æ•ˆå¤„ç†å¤§å‹æ•°æ®é›†ï¼Œæ¯æ¬¡åªè·å–å°å—å¯ç®¡ç†çš„æ•°æ®ï¼Œé¿å… UI è¿‡è½½å¹¶æå‡æ€§èƒ½ã€‚</li>
<li><strong>å‡å°‘é…ç½®å˜æ›´æœŸé—´çš„ UI æ“ä½œ</strong>ï¼šåˆ©ç”¨ <code>ViewModel</code> ä¿å­˜ä¸ UI ç›¸å…³çš„æ•°æ®ï¼Œé¿å…åœ¨å±å¹•æ—‹è½¬ç­‰é…ç½®å˜æ›´æ—¶å‘ç”Ÿä¸å¿…è¦çš„ UI é‡æ–°åŠ è½½ã€‚</li>
<li><strong>ä½¿ç”¨ Android Studio è¿›è¡Œç›‘æ§å’Œæ€§èƒ½åˆ†æ</strong>ï¼šå€ŸåŠ© <strong>Android Studio Profiler</strong> å·¥å…·ç›‘æ§ CPUã€å†…å­˜å’Œç½‘ç»œä½¿ç”¨æƒ…å†µã€‚è¿™äº›å·¥å…·æœ‰åŠ©äºè¯†åˆ«å’Œè§£å†³å¯èƒ½å¯¼è‡´ <strong>ANR</strong> çš„æ€§èƒ½ç“¶é¢ˆã€‚</li>
<li><strong>é¿å…é˜»å¡è°ƒç”¨</strong>ï¼šé˜²æ­¢åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œé•¿æ—¶é—´å¾ªç¯ã€ç¡çœ è°ƒç”¨æˆ–åŒæ­¥ç½‘ç»œè¯·æ±‚ï¼Œä»¥ç¡®ä¿åº”ç”¨è¿è¡Œæµç•…ã€‚</li>
<li><strong>ä½¿ç”¨ <code>Handler</code> å®ç°çŸ­å»¶è¿Ÿ</strong>ï¼šä½¿ç”¨ <code>Handler.postDelayed()</code> è€Œä¸æ˜¯ <code>Thread.sleep()</code> æ¥å¼•å…¥çŸ­æš‚å»¶è¿Ÿï¼Œä»è€Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œä¿æŒåº”ç”¨å“åº”æ€§ã€‚</li>
</ol>
<h3 data-id="heading-66">æ€»ç»“</h3>
<p><strong>ANR</strong> æ˜¯ Android ä¸­çš„ä¸€ç§é”™è¯¯ï¼Œå½“åº”ç”¨çš„ä¸»çº¿ç¨‹ï¼ˆUI çº¿ç¨‹ï¼‰è¢«é˜»å¡è¶…è¿‡<strong>5ç§’æˆ–æ›´é•¿æ—¶é—´</strong>æ—¶å°±ä¼šå‘ç”Ÿï¼Œè¿™ä¼šé™ä½ç”¨æˆ·ä½“éªŒå¹¶ä¸¢å¤±å½“å‰ç”¨æˆ·çŠ¶æ€ã€‚ä¸ºé˜²æ­¢ <strong>ANR</strong>ï¼Œåº”é€šè¿‡å°†è€—æ—¶å·¥ä½œç§»è‡³åå°çº¿ç¨‹ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢å’Œå¤æ‚è®¡ç®—ï¼‰æ¥ä¿æŒä¸»çº¿ç¨‹è½»é‡ã€‚åŒæ—¶ï¼Œå¯ä»¥ä¼˜åŒ–æ•°æ®æ“ä½œï¼Œå¹¶ä½¿ç”¨ <strong>Android Studio Profiler</strong> å¯¹åº”ç”¨è¿›è¡Œæ€§èƒ½åˆ†æã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é€‚åˆå¾ˆå¤šå…¬å¸å’Œå›¢é˜Ÿçš„ AI Coding è½åœ°èŒƒå¼ï¼ˆä¸€ï¼‰]]></title>    <link>https://juejin.cn/post/7584714813365747750</link>    <guid>https://juejin.cn/post/7584714813365747750</guid>    <pubDate>2025-12-18T00:53:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584714813365747750" data-draft-id="7584655946087759918" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é€‚åˆå¾ˆå¤šå…¬å¸å’Œå›¢é˜Ÿçš„ AI Coding è½åœ°èŒƒå¼ï¼ˆä¸€ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯,AIGC,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-12-18T00:53:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LVæŠ€æœ¯æ´¾"/> <meta itemprop="url" content="https://juejin.cn/user/2013961035453927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é€‚åˆå¾ˆå¤šå…¬å¸å’Œå›¢é˜Ÿçš„ AI Coding è½åœ°èŒƒå¼ï¼ˆä¸€ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961035453927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LVæŠ€æœ¯æ´¾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-18T00:53:22.000Z" title="Thu Dec 18 2025 00:53:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ lvã€‚</p>
<p>æˆ‘ä» 0 ï½ 1 æ¢ç´¢å‰ç«¯ AI è½åœ°ï¼Œåˆ°ç°åœ¨å·²ç» 3 å¹´å¤šæ—¶é—´äº†ã€‚</p>
<p>ä»ä¸€å¼€å§‹çš„ V0ã€Boltã€Github Copilotã€Devin ç­‰ <strong>AI Coding å¹³å°</strong>ï¼Œåˆ°ç°åœ¨å¸‚é¢ä¸Šæˆç†Ÿçš„ <strong>AI Coding åŸºå»º</strong>ï¼Œå¦‚ Cursor ã€Claude Code ç­‰ã€‚</p>
<p>ä¸åŒçš„äº§å“å½¢æ€éƒ½æœ‰è‡ªå·±çš„å—ä¼—äººç¾¤ã€é¢å‘çš„åœºæ™¯ã€ä»¥åŠè§£å†³çš„é—®é¢˜ã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªç³»åˆ—ï¼Œ<strong>æ€»å…±ä¸¤ç¯‡æ–‡ç« </strong>ï¼Œæˆ‘ä»¬æ¥æ¢è®¨ï¼ŒåŸºäºä¸åŒå½¢æ€çš„ AI Coding äº§å“ï¼Œé€‚åˆå¾ˆå¤šå…¬å¸å’Œå›¢é˜Ÿçš„ AI Coding è½åœ°èŒƒå¼ã€‚</p>
<p>æœ‰åŒå­¦ä¹Ÿå·²ç»åœ¨å›¢é˜Ÿå†…éƒ¨è½åœ°å®æ–½äº†è¿™å¥—èŒƒå¼ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29894879f12c4c0c9824d26e77c01885~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624001&amp;x-signature=Mh%2BgyxXquABmCKtwVmO8s1P1kUo%3D" alt="" loading="lazy"/></p>
<p>ä¸å¤šè¯´ï¼Œå¼€å§‹<strong>ç¬¬ä¸€ç¯‡</strong>ï½</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fai.iamlv.cn%2Fme.html" target="_blank" title="https://ai.iamlv.cn/me.html" ref="nofollow noopener noreferrer">æ¬¢è¿åŠ å…¥æœ€æ‡‚ AI çš„å‰ç«¯ä¼™ä¼´ä»¬ç¾¤</a></p>
<h2 data-id="heading-0">AI Coding ç”Ÿæ€ç°çŠ¶</h2>
<p>ç°åœ¨å¸‚é¢ä¸Šçš„ AI Coding äº§å“ï¼Œæˆ‘ä»¬åˆ’åˆ†ä¸ºä¸¤å¤§ç±»å‹ï¼š</p>
<ul>
<li>AI Coding å¹³å°ç±»äº§å“ï¼šå¦‚ Bolt Newã€V0ã€Lovableã€<strong>Compoder</strong> ç­‰ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3766f0b0bfd846c8b83a04f53b51eae9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624001&amp;x-signature=Rnnw%2BXKKeGqVN%2FdnGl1lY6iRsLc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>Compoder æ˜¯ä¸€ä¸ª AI é©±åŠ¨çš„ç»„ä»¶ä»£ç ç”Ÿæˆå¼•æ“ï¼Œå¯ä»¥åŸºäºå®ƒå®šåˆ¶åŸºäºç‰¹å®šæŠ€æœ¯æ ˆï¼ˆReactã€Vueã€å¼€æºç»„ä»¶åº“ã€ç§æœ‰ç»„ä»¶åº“ï¼‰ã€ç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼ˆlanding page ç­‰ï¼‰çš„ç»„ä»¶ä»£ç ç”Ÿæˆå™¨ã€‚</p>
<p>è¯¦è§: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FIamLiuLv%2Fcompoder" target="_blank" title="https://github.com/IamLiuLv/compoder" ref="nofollow noopener noreferrer">github.com/IamLiuLv/coâ€¦</a></p>
</blockquote>
<ul>
<li>AI Coding åŸºå»ºç±»äº§å“ï¼šå…·æœ‰ä»£è¡¨æ€§çš„å¦‚ Cursorã€Claude Code ç­‰ï¼Œè¿™ä¹Ÿæ˜¯ç¨‹åºå‘˜ç°åœ¨æ—¥å¸¸å·¥ä½œéƒ½é«˜é¢‘ä½¿ç”¨çš„äº§å“ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03e48f1b9888411d984334b89829ec9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624001&amp;x-signature=FcF0rtdxJ4y4nu4lMHh4Mvr9QNM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">ä¸åŒäº§å“å½¢æ€çš„ä¾§é‡ç‚¹</h3>
<p>å…ˆèŠ AI Coding å¹³å°ç±»äº§å“ï¼Œå¹³å°æ–¹ï¼ˆV0ã€Bolt Newã€Lovableã€Compoderï¼‰å·²ç»å†…ç½®äº†ä¸€æ•´å¥—äº§å“ç ”å‘çš„ç¯å¢ƒï¼ŒåŒæ—¶æŠŠ AI èå…¥åˆ°äº†è¿™ä¸ªç ”å‘çš„ç¯å¢ƒä¸­ã€‚</p>
<p>ä½œä¸ºç”¨æˆ·æ¥è¯´ï¼Œæ ¸å¿ƒçš„ä¸‰ä¸ªæ­¥éª¤å°±æ˜¯ï¼š</p>
<p>1ã€è¾“å…¥éœ€æ±‚ï¼ˆpromptï¼‰</p>
<p>2ã€æŸ¥çœ‹æ•ˆæœï¼ˆpreviewï¼‰</p>
<p>3ã€å‘å¸ƒä¸Šçº¿ï¼ˆdeployï¼‰</p>
<p>ä¸­é—´çš„<strong>ä»£ç ç”Ÿæˆã€ä»£ç è¿è¡Œç¯å¢ƒã€ä»£ç æ‰§è¡Œæ•ˆæœã€æ„å»ºå‘å¸ƒ</strong>ç­‰ï¼Œè¿™éƒ½éƒ½äº¤ç»™äº†å¹³å°æ–¹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/146e04d734d6496f931d4ee8630b9b53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624001&amp;x-signature=tc3WyntUzLC8Q7nf9L3u0WTcgo8%3D" alt="" loading="lazy"/></p>
<p>é‚£ä½œä¸º AI Coding åŸºå»ºæ¥è¯´ï¼Œå…¶å®æœ¬è´¨ä¸Šå°±æ˜¯æŠŠ AI ç”Ÿæˆä»£ç çš„èƒ½åŠ›é›†æˆåˆ°äº†ç°æœ‰ç¨‹åºå‘˜çš„ç¼–ç ç¯å¢ƒä¸­æ¥ã€‚</p>
<p>å¯¹äºå¼€å‘äººå‘˜æ¥è¯´ï¼Œç›¸å½“äºåœ¨äº§å“ç ”å‘çš„å„ä¸ªç¯èŠ‚å¤šä¸ªä¸€ä¸ªå¾ˆå¼ºçš„ AI åŠ©æ‰‹ï¼Œéšæ—¶æä¾›å¸®åŠ©ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e64e888036eb4947992ed98a70bd58e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624001&amp;x-signature=xhVuUaIpCFucLGZBb9N3jya0lm8%3D" alt="" loading="lazy"/></p>
<p>æ‰€ä»¥è¿™ç§ AI Coding åŸºç¡€å»ºçš„äº§å“å½¢æ€ä½œä¸ºç¨‹åºå‘˜æ¥è¯´ï¼Œç”¨èµ·æ¥çš„å¿ƒæ™ºè´Ÿæ‹…ä¼šæ›´å°ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥èŠä¸‹ä»–ä»¬çš„ä¼˜ç¼ºç‚¹ã€‚</p>
<h3 data-id="heading-2">ä¸åŒäº§å“å½¢æ€çš„ä¼˜ç¼ºç‚¹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d7e289ca89240c385eaaf04c96522e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624001&amp;x-signature=II8VuGUDCgzLZ0UUMFh8jk5Fkjw%3D" alt="" loading="lazy"/></p>
<p>æ€»ç»“èµ·æ¥ä¸€å¥è¯ï¼šAI Coding å¹³å°ç±»äº§å“çš„<strong>é—¨æ§›ä½ï¼Œä½†çµæ´»æ€§æœ‰é™</strong>ï¼ŒAI Coding åŸºå»ºç±»äº§å“çš„<strong>é—¨æ§›ç›¸å¯¹è¾ƒé«˜ï¼ŒåŒæ—¶çµæ´»æ€§ä¹Ÿæ›´é«˜</strong>ã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„ä¼˜ç¼ºç‚¹æ˜¯è¿™ä¸¤ç±»äº§å“ç›¸æ¯”è¾ƒäºå¯¹æ–¹æ¥è¯´çš„ã€‚</p>
</blockquote>
<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<p>æˆ‘ä»¬å¯ä»¥åŸºäº V0 å¿«é€Ÿç”Ÿæˆä¸€ä¸ªäº§å“çš„åŸå‹ä»£ç å‡ºæ¥ï¼Œä¹Ÿå¯ä»¥è¿…é€Ÿå‘å¸ƒä¸Šçº¿åˆ° Vercel å¹³å°ä¸Šã€‚</p>
<p>å¦‚æœåŸå‹ä»£ç æœ¬èº«ä¸éœ€è¦è¿›è¡Œåç»­çš„ç»´æŠ¤å’Œè¿­ä»£ï¼Œä¿æŒå½“å‰çš„å½¢æ€ï¼Œé‚£ V0 äº§å“å°±è¶³å¤Ÿäº†ã€‚</p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿›è¡Œåç»­çš„è¿­ä»£å¼€å‘ï¼Œé‚£ä¹ˆ V0 äº§å“å°±ä¸å¤ªèƒ½å¤Ÿæ»¡è¶³éœ€æ±‚äº†ã€‚</p>
<p>é¦–å…ˆä»æŠ€æœ¯æ ˆæ¥è¯´ï¼ŒV0 å¤§æ¦‚ç‡ç”Ÿæˆçš„æ˜¯ nextjs + shadcnui æŠ€æœ¯æ ˆçš„ä»£ç ï¼ˆè‡ªå®¶äº§å“ï¼Œè‡ªäº§è‡ªé”€ï¼‰ï¼Œå¦‚æœå…¬å¸å›¢é˜Ÿå†…éƒ¨ä½¿ç”¨çš„æ˜¯å…¶å®ƒæŠ€æœ¯æ ˆï¼Œé‚£åŸºäº V0 å®šåˆ¶ç‰¹å®šæŠ€æœ¯æ ˆçš„ä»£ç å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚</p>
<p><strong>è¿™é‡ŒåŠ ä¸€å¥</strong>ï¼ŒCompoder äº§å“çš„<strong>å…¶ä¸­ä¸€ä¸ªå½¢æ€</strong>æ˜¯å±äº AI Coding å¹³å°ç±»çš„äº§å“ï¼Œå’Œå¸‚é¢ä¸Šå…¶ä»– AI Coding å¹³å°ç±»äº§å“å¯¹æ¯”èµ·æ¥ï¼Œçµæ´»æ€§ä¼šæ›´é«˜ï¼Œç”¨æˆ·å¯ä»¥åŸºäº Compoder å®šåˆ¶åŸºäºç‰¹å®šæŠ€æœ¯æ ˆã€ä»£ç è§„èŒƒçš„ä»£ç ç”Ÿæˆå™¨ï¼Œå…·ä½“æˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« å†æ¢è®¨ã€‚</p>
<p>è¨€å½’æ­£ä¼ ã€‚</p>
<p>æ‰€ä»¥å¯¹äºéœ€è¦è¿›è¡Œé•¿æœŸè¿­ä»£çš„é¡¹ç›®æ¥è¯´ï¼ŒAI Coding åŸºå»ºç±»äº§å“ä¼šæ›´åŠ åˆé€‚ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œæˆ‘å¯ä»¥åŸºäº Cursor çš„ Rules èƒ½åŠ›ï¼Œå®šåˆ¶åŒ–å‡ºä¸€å¥—ç¬¦åˆå…¬å¸å†…éƒ¨ç ”å‘è§„èŒƒçš„ä»£ç ç”Ÿæˆè§„åˆ™ï¼Œç„¶ååŸºäºè¿™å¥—è§„åˆ™ï¼Œæˆ‘å¯ä»¥å¿«é€Ÿç”Ÿæˆç¬¦åˆå…¬å¸å†…éƒ¨ç ”å‘æµç¨‹çš„ä»£ç ã€‚</p>
<p>å°¤å…¶æ˜¯åœ¨åŸºäºå·²æœ‰å¤æ‚é¡¹ç›®çš„è¿­ä»£åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ·±å…¥åˆ°ä»£ç å®ç°ç»†èŠ‚è¿›è¡Œè°ƒèŠ‚ï¼Œé‚£å°±éœ€è¦å¾ˆçµæ´»çš„ AI è¾…åŠ©èƒ½åŠ›æ¥é…åˆã€‚</p>
<p>å¦‚æœæˆ‘é€‰æ‹©çš„æ˜¯ Cursorï¼Œé‚£æˆ‘çš„è¿­ä»£å¼€å‘è·¯å¾„å¤§æ¦‚æ˜¯ï¼š<strong>Vibing =&gt; Plan =&gt; Coding</strong></p>
<p><strong>Vibingï¼š</strong> åœ¨ Chat æ¨¡å¼ä¸‹ï¼Œå’Œ AI èŠå¤©ï¼Œæ¢³ç†éœ€æ±‚ã€è®¨è®ºæ–¹æ¡ˆã€‚</p>
<p><strong>Planï¼š</strong> åœ¨ Plan æ¨¡å¼ä¸‹ï¼Œè§„åˆ’å…·ä½“çš„æŠ€æœ¯æ–¹æ¡ˆå®ç°è·¯å¾„ï¼Œå…·ä½“åˆ°é’ˆå¯¹å“ªäº›æ–‡ä»¶è¿›è¡Œå“ªäº›æ›´é«˜ã€‚</p>
<p><strong>Codingï¼š</strong> åŸºäº Plan å‡ºæ¥çš„æŠ€æœ¯æ–¹æ¡ˆå®ç°è·¯å¾„ï¼ŒAgent Build å®é™…çš„ä»£ç ã€‚</p>
<h3 data-id="heading-3">ä¸åŒäº§å“å½¢æ€é¢å‘çš„äººç¾¤</h3>
<p>åŸºäºä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸åŒäº§å“å½¢æ€é¢å‘çš„äººç¾¤å¤§è‡´åˆ†å¸ƒæƒ…å†µã€‚</p>
<p>ä¸‹å›¾ä¸­çš„ 75% å’Œ 25%ï¼Œä¸ä»£è¡¨å®é™…çš„å€¼ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿å¯¹æ¯”ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02813fba4aee4343b1c93949ca07a6df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTFbmioDmnK_mtL4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766624001&amp;x-signature=148QbE2iJdlh8AYiOmv67jysGDM%3D" alt="" loading="lazy"/></p>
<p>AI Coding åŸºå»ºç±»äº§å“ï¼Œ<strong>ç¨‹åºå‘˜</strong>æ˜¯ç»å¯¹çš„ä¸»åŠ›å†›ï¼Œå äº†å¤§å¤šæ•°ã€‚</p>
<p>AI Coding å¹³å°ç±»äº§å“ï¼Œé¢å‘çš„äººç¾¤å¤§éƒ¨åˆ†æ˜¯ <strong>éç¨‹åºå‘˜</strong>ï¼Œå°¤å…¶æ˜¯ç¨‹åºå‘˜çš„ä¸Šæ¸¸å²—ï¼Œå¦‚äº§å“ç»ç†ã€è®¾è®¡å¸ˆã€è¿è¥ç­‰ã€‚</p>
<h2 data-id="heading-4">é€‚åˆå¾ˆå¤šå…¬å¸å’Œå›¢é˜Ÿçš„ AI Coding è½åœ°èŒƒå¼</h2>
<p>ä¸åŒå½¢æ€çš„ AI Coding äº§å“ï¼Œåœ¨å…¬å¸å’Œå›¢é˜Ÿä¸­ï¼Œé¢å‘çš„äººç¾¤ï¼Œè§£å†³çš„é—®é¢˜åœºæ™¯æ˜¯ä¸åŒçš„ã€‚</p>
<p>äº†è§£äº†ä¸åŒ AI Coding äº§å“çš„ä¸åŒå½¢æ€ã€ç‰¹å¾ã€ä¼˜ç¼ºç‚¹å’Œé¢å‘çš„äººç¾¤ä¹‹åã€‚</p>
<p>ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ¥æ¢è®¨ï¼ŒAI Coding å¹³å°ç±»äº§å“ã€ä»¥åŠ AI Coding åŸºå»ºç±»äº§å“ï¼Œåœ¨å…¬å¸å’Œå›¢é˜Ÿä¸­ï¼Œè½åœ°çš„èŒƒå¼æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>