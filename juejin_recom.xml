<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[解析微信与支付宝【红包/转账】背后的共同技术基础，我们是否可以实现？]]></title>    <link>https://juejin.cn/post/7602488187409121332</link>    <guid>https://juejin.cn/post/7602488187409121332</guid>    <pubDate>2026-02-04T07:05:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602488187409121332" data-draft-id="7602482736914710563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解析微信与支付宝【红包/转账】背后的共同技术基础，我们是否可以实现？"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-02-04T07:05:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狗头大军之江苏分军"/> <meta itemprop="url" content="https://juejin.cn/user/2955079655907879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解析微信与支付宝【红包/转账】背后的共同技术基础，我们是否可以实现？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2955079655907879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狗头大军之江苏分军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T07:05:20.000Z" title="Wed Feb 04 2026 07:05:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>需要先说明一点：
文中涉及的相关逻辑，并非来自非公开的内部资料，而是基于公开资料、行业常见做法，以及我过往项目中的实际经验进行的工程层面推演。
具体实现必然会因公司体量、风控策略和系统复杂度而有所不同，但整体思路在技术上是可行且常见的。所以真正的实现细节肯定更复杂，但思路本身并不神秘。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>2026的春节马上到了，与以往不同的是最近两年，我的的身份从一个收红包的，转换成发红包的了！!你说怪不怪，这钱明明是在我的卡里了，怎么点一下屏幕，就“嗖”地跑对方账户里了？</p>
<p>自从担任了发红包的角色，对这些愈发敏感！！但我总觉得这背后一定不是“点了就有”这么简单。否则银行早就被我们点破产了。</p>
<p>再后来写代码写到半夜，debug 到怀疑人生的时候，我突然意识到一件事：
微信红包、支付宝转账，本质上和我们每天写的那些“提交表单”“请求接口”“状态回调”，好像也没那么神秘。</p>
<p>只是他们用的是真金白银，而我们平时传的是 JSON。</p>
<p>于是我开始好奇：
这些看起来像魔法一样的功能，底层到底靠的是什么？
它们之间有没有共用的技术套路？
如果把钱换成“积分”“余额”“虚拟资产”，我们普通开发者，能不能自己也实现一套？其实它们并没有想象中那么遥不可及，只是我们平时没敢往“钱”这个方向想。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae56052b3e87420f975231f2b97d8cb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uX5aS05aSn5Yab5LmL5rGf6IuP5YiG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770793521&amp;x-signature=XE62gKb319QhNuNXAmE4I%2F1DZ%2Fg%3D" alt="image.png" width="30%" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e84009328194fc295e1f8d3c0bc5560~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uX5aS05aSn5Yab5LmL5rGf6IuP5YiG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770793521&amp;x-signature=nIhA%2B9qmq%2Bq1F2rMPEX%2FN6oLXKc%3D" alt="image.png" width="50%" loading="lazy"/>
<h2 data-id="heading-1"><strong>微信支付（WeChat Pay）</strong></h2>
<ul>
<li>支付功能依附于 <strong>微信这一社交平台</strong>，支付是微信生态的一部分，因此红包和转账等功能设计非常贴合社交场景（比如聊天界面中的红包按钮）。</li>
<li>技术上强调社交互动的即时性与高并发能力，尤其在群聊红包抢夺场景下需要应对极高的并发吞吐。</li>
</ul>
<h2 data-id="heading-2"><strong>支付宝（Alipay）</strong></h2>
<ul>
<li>起源于电子商务（尤其是淘宝/天猫），起初是为了解决 <strong>电商信任与支付问题</strong>，之后扩展成一个 <strong>全面的金融服务生态</strong>（包括投资、理财、信用等）。</li>
<li>在红包或转账场景中，其产品设计更多围绕金融服务与交易可靠性，而不是像微信那样围绕“社交互动”。</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[用户发起请求] --&gt; B{验证请求合法性}
    B --&gt; |合法| C[检查账户余额]
    B --&gt; |不合法| Z[返回错误提示]
    C --&gt; |余额充足| D[扣款并冻结资金]
    C --&gt; |余额不足| Y[返回余额不足]
    D --&gt; E[发起交易入队列]
    E --&gt; F[交易处理服务]
    F --&gt; G{交易结果}
    G --&gt; |成功| H[更新账户状态]
    G --&gt; |失败| I[资金回滚并恢复余额]
    H --&gt; J[发送通知给双方]
    J --&gt; K[结束]
    I --&gt; J
</code></pre>
<h2 data-id="heading-3">一、红包与转账的本质是什么？</h2>
<p>红包和转账在本质上是一个非常简单的概念，它们都是账户之间<code>资金的安全移动</code>，也就是从一个账户把钱安全地搬到另一个账户，最终要保证的是资金<code>不丢失、不重复扣款、双方状态一致</code>。在工程系统设计里，这类业务倾向于被归类为<strong>高可靠性、高一致性的分布式交易系统问题</strong>，与我们平时做的订单、库存这种需要强一致性的场景很像。</p>
<p>但它的核心是与真实资金挂钩，这对系统设计提出了更高的要求。实现上需要把资金操作抽象成<strong>原子性操作</strong>，确保所谓的<strong>转账事务要么全部成功，要么全部回滚</strong>，这就是所谓的强一致性。</p>
<h3 data-id="heading-4">使用区别</h3>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/889e1d153db64a0d8cd09f6995937f1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uX5aS05aSn5Yab5LmL5rGf6IuP5YiG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770793521&amp;x-signature=6EBaPuzcA6sG2WTyhRJrXUxCpzo%3D" alt="image.png" width="50%" loading="lazy"/>
<p>红包与转账虽然在技术层面都属于<code>资金的安全移动</code>，但在产品设计和用户感知上存在明显差异。首先从<strong>使用场景和表现形式</strong>来看，红包更多承载社交互动和情绪表达，界面上往往以祝福语伴随金额隐藏直到接收方打开，而转账则直接显示金额，是一种更<strong>直接清晰的支付行为</strong>，这体现了两者的<strong>语义侧重点不同</strong>。此外，在实际规则上红包通常有<strong>较严格的金额上限</strong>和<strong>领取时间窗口</strong>，而转账则支持更高额度和更灵活的到账设置，这也反映出它们在风险控制和用途上的不同取向。法律属性上，在一些司法判例中，微信红包由于其社交赠予的特性往往被认定为<strong>赠与行为</strong>，而普通的转账更类似于传统意义上的资金支付，这种差异也从侧面说明产品定位的不同，这些差异都会在产品流程和用户交互上有所体现。(<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.thepaper.cn%2FnewsDetail_forward_26321871" title="https://www.thepaper.cn/newsDetail_forward_26321871" target="_blank" ref="nofollow noopener noreferrer">这里有依据</a>)</p>
<ul>
<li><strong>产品语义不同</strong>：红包是“送礼氛围”，转账是“付钱行动”。</li>
<li><strong>交互方式不同</strong>：红包有随机金额或隐藏金额的趣味交互。</li>
<li><strong>规则约束不同</strong>：红包限额、领奖期限；转账额度更大灵活。</li>
<li><strong>法律属性不同</strong>：红包更可能被认定为赠与行为</li>
</ul>
<h2 data-id="heading-5">二、微信支付宝共同采用的分布式架构设计</h2>
<p>微信和支付宝的红包/转账功能，背后都依赖了成熟的分布式架构设计，核心目标是 <strong>高并发、低延迟、可扩展、可维护</strong>。我们可以从几个维度来拆解：</p>
<ol>
<li>
<p><strong>微服务拆分</strong><br/>
功能按业务逻辑拆成多个服务，例如：</p>
<ul>
<li><strong>订单服务</strong>：管理红包/转账的发起、状态更新</li>
<li><strong>账务服务</strong>：处理资金流水、账户余额变更</li>
<li><strong>通知服务</strong>：消息推送、短信/消息通知</li>
<li><strong>风控服务</strong>：防止异常交易或欺诈行为</li>
</ul>
<p>拆分之后，每个服务可以独立扩容或升级，降低单点压力，也方便不同团队协作开发。</p>
</li>
<li>
<p><strong>分层架构设计</strong></p>
<ul>
<li><strong>接入层</strong>：API 网关、负载均衡、流量控制</li>
<li><strong>业务逻辑层</strong>：微服务实现核心业务逻辑</li>
<li><strong>数据层</strong>：分布式数据库或缓存（如 MySQL 分库分表、Redis 集群）</li>
</ul>
<p>分层的好处是，每层只关注自己的职责，减少耦合，同时可以针对不同层做优化（如缓存热点数据、异步处理通知）。</p>
</li>
<li>
<p><strong>高并发与弹性扩展</strong><br/>
红包/转账是典型的瞬时高并发场景，比如春节微信红包的秒杀潮。为应对这种压力：</p>
<ul>
<li>服务部署在 <strong>分布式集群</strong> 中（多节点、多机房）</li>
<li>支持 <strong>自动扩容/缩容</strong>（Kubernetes、云原生部署）</li>
<li>使用 <strong>异步队列</strong>（Kafka/RabbitMQ）处理非实时操作，例如通知、日志写入</li>
<li>采用 <strong>缓存 + 限流 + 防重处理</strong> 避免重复扣款和系统雪崩</li>
</ul>
</li>
</ol>
<h3 data-id="heading-6">大概流程</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[客户端请求] --&gt; B[API 网关 / 负载均衡]
    B --&gt; C[业务逻辑层]
    C --&gt; C1[订单服务]
    C --&gt; C2[账务服务]
    C1 --&gt; C3[风控服务]
    C2 --&gt; C4[缓存/数据库]
    C3 --&gt; D[通知服务 / 异步队列]
    C4 --&gt; D
    D --&gt; E[用户端]

</code></pre>
<h3 data-id="heading-7">三、分库分表与缓存设计应对高并发</h3>
<h4 data-id="heading-8">1. 场景模拟：春节红包的爆发式激增</h4>
<p>想象一下，除夕夜 0 点，你发了一个 100 元的红包在几百人的公司大群里。这一瞬间，群里 500 人同时点击<code>开</code>。如果我们仅有一个 MySQL 数据库：</p>
<ul>
<li><strong>悲剧发生：</strong> 500 个请求同时争抢数据库中的同一行记录（红包余额）。数据库为了保证数据准确，会加“行锁”。这意味着第 1 个人在操作时，后面 499 个人都在排队等待。</li>
<li><strong>结果：</strong> 数据库 CPU 飙升 100%，系统卡死，前端转圈圈，最后全员报错“网络繁忙”。</li>
</ul>
<h4 data-id="heading-9">2. 解决方案 A：分库分表（化整为零）</h4>
<p>要在架构层面解决这个问题，我们不能让所有鸡蛋都在一个篮子里。</p>
<ul>
<li><strong>水平拆分 (Sharding)：</strong> 我们根据 <code>User_ID</code> 或 <code>RedPacket_ID</code> 的哈希值（Hash），将数据分散到 100 个甚至 1000 个数据库实例中。</li>
<li><strong>效果：</strong> 原本 10 万的并发请求，分散到 100 个库，每个库只承担 1000 QPS，压力瞬间降低到单机可处理范围。</li>
</ul>
<h4 data-id="heading-10">3. 解决方案 B：Redis 缓存抗压与“超卖”控制</h4>
<p>数据库即便分片，也扛不住每秒百万级的“读”请求。这时候，<strong>Redis</strong> 必须作为第一道防线。 在红包场景中，最核心的技术难点是**“防止超卖”**（即发了 10 个红包，结果被 11 个人抢到了，导致资金负数）。</p>
<p><strong>核心代码实现（Lua 脚本）：</strong> 为了保证“检查库存”和“扣减库存”是原子操作（不可分割），我们通常使用 Redis 的 Lua 脚本来实现核心抢包逻辑：</p>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-comment">-- keys[1]: 红包队列 Key (List), 预先放入了随机金额的小包</span>
<span class="hljs-comment">-- keys[2]: 已抢用户记录 Key (Set/Hash), 防止重复抢</span>
<span class="hljs-comment">-- keys[3]: 红包元数据 Key (Hash), 记录剩余个数</span>
<span class="hljs-comment">-- argv[1]: 用户 ID</span>

<span class="hljs-keyword">local</span> red_packet_queue = KEYS[<span class="hljs-number">1</span>]
<span class="hljs-keyword">local</span> consumed_record = KEYS[<span class="hljs-number">2</span>]
<span class="hljs-keyword">local</span> meta_data = KEYS[<span class="hljs-number">3</span>]
<span class="hljs-keyword">local</span> user_id = ARGV[<span class="hljs-number">1</span>]

<span class="hljs-comment">-- 1. 幂等性检查：判断用户是否已经抢过</span>
<span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">'hexists'</span>, consumed_record, user_id) == <span class="hljs-number">1</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span> <span class="hljs-comment">-- 真特喵贪啊！抢过的还抢？</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- 2. 检查红包剩余个数</span>
<span class="hljs-keyword">local</span> left_count = redis.call(<span class="hljs-string">'hget'</span>, meta_data, <span class="hljs-string">'count'</span>)
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> left_count <span class="hljs-keyword">or</span> <span class="hljs-built_in">tonumber</span>(left_count) &lt;= <span class="hljs-number">0</span> <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> <span class="hljs-comment">-- 嘻嘻，菜鸡你来晚了</span>
<span class="hljs-keyword">end</span>

<span class="hljs-comment">-- 3. 原子操作：从队列弹出一个金额，并扣减计数</span>
<span class="hljs-keyword">local</span> money = redis.call(<span class="hljs-string">'lpop'</span>, red_packet_queue)
<span class="hljs-keyword">if</span> money <span class="hljs-keyword">then</span>
    redis.call(<span class="hljs-string">'hincrby'</span>, meta_data, <span class="hljs-string">'count'</span>, <span class="hljs-number">-1</span>)
    redis.call(<span class="hljs-string">'hset'</span>, consumed_record, user_id, money)
    <span class="hljs-keyword">return</span> money <span class="hljs-comment">-- nb！！抢购成功，返回金额</span>
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> <span class="hljs-comment">-- 异常情况，队列为空</span>
<span class="hljs-keyword">end</span>
</code></pre>
<blockquote>
<p><strong>注意哈：</strong> Redis 的 Lua 脚本是单线程执行的，这意味着脚本执行期间，不会有其他命令插入，天然解决了并发竞争问题。抢到红包后，再通过异步消息队列（如 Kafka/RocketMQ）慢慢将数据写入 MySQL，实现削峰填谷。</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">四、事务一致性与资金安全设计</h3>
<p><strong><code>钱没了，对方没收到</code> ok了哥们，你的技术生涯到头了，换个星球生活吧</strong></p>
<h4 data-id="heading-12">1. 核心挑战：分布式环境下的“薛定谔的转账”</h4>
<p>假设你要转账 100 元给朋友。你的账户在 A 服务，朋友的账户在 B 服务。</p>
<ol>
<li>A 服务扣了你 100 元。</li>
<li>网络突然断了。</li>
<li>B 服务没收到请求，或者收到了但处理失败。 <strong>结果：</strong> 你的钱少了，朋友没收到，这 100 元凭空消失了。这在金融系统是绝对不允许的。</li>
</ol>
<h4 data-id="heading-13">2. 设计原则一：幂等性（Idempotency）</h4>
<p>用户因为网络卡顿，疯狂点击了 5 次“确认支付”。系统必须保证：<strong>无论用户点多少次，钱只能扣一次。</strong></p>
<ul>
<li><strong>实现：</strong> 每次请求必须携带一个全局唯一的 <code>Biz_ID</code>（业务流水号）。</li>
<li><strong>逻辑：</strong> 后端接收请求 -&gt; 查询 <code>Biz_ID</code> 是否处理过 -&gt; 若处理过直接返回成功结果，不进行扣款；若未处理则执行扣款。</li>
</ul>
<h4 data-id="heading-14">3. 设计原则二：最终一致性（可靠消息/TCC）</h4>
<p>相比于强一致性（两阶段提交 2PC）导致的性能低下，互联网支付通常采用**“最终一致性”**。</p>
<p><strong>实战流程图（本地消息表模式）：</strong></p>
<p>（不给我点赞，给图表点个赞吧，真的很难写....）</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant Sender as 转出账户服务(A)
    participant DB_A as A的数据库(含消息表)
    participant MQ as 消息队列
    participant Receiver as 转入账户服务(B)

    User-&gt;&gt;Sender: 发起转账 100元
    Note over Sender, DB_A: 开启数据库事务
    Sender-&gt;&gt;DB_A: 1. 扣减余额 -100
    Sender-&gt;&gt;DB_A: 2. 插入"待发送"消息记录
    Note over Sender, DB_A: 提交数据库事务(强一致)
    
    Sender-&gt;&gt;MQ: 3. 发送扣款成功消息
    MQ-&gt;&gt;Receiver: 4. 推送消息给 B
    
    Receiver-&gt;&gt;Receiver: 5. 检查幂等性(是否处理过)
    Receiver-&gt;&gt;Receiver: 6. 增加余额 +100
    Receiver--&gt;&gt;MQ: 7. 确认消息(ACK)
    
    loop 定时任务(兜底)
        Sender-&gt;&gt;DB_A: 扫描长时间未确认的消息
        Sender-&gt;&gt;MQ: 重新发送(重试机制)
    end
</code></pre>
<h4 data-id="heading-15">五、 最后：离线对账系统 (Reconciliation)</h4>
<p>即便技术再牛，代码也可能有 Bug，硬件可能损坏。因此，金融系统都有一个<strong>T+1 对账机制</strong>。</p>
<ul>
<li><strong>夜间工作：</strong> 每天凌晨，系统会自动拉取上游渠道（如银行）的流水文件，与系统内部的订单记录逐笔比对。</li>
<li><strong>长款/短款处理：</strong> 一旦发现金额不一致（比如数据库记了转账成功，但银行卡没扣钱），系统会发出最高级别的报警，人工或自动脚本介入进行“冲正”或“补单”。</li>
<li><strong>结论：</strong> 实时链路保体验，离线对账保底线。</li>
</ul>
<hr/>
<blockquote>
<p>通过上述的分库分表、Redis 原子操作以及可靠的消息队列设计，我们确实可以在技术上还原微信或支付宝 80% 的核心转账逻辑。然而，剩下的 20%那些关于合规风控、跨国汇率结算以及极端灾备切换的细节，emmm我猜都猜不到...</p>
</blockquote>
<h3 data-id="heading-16">六、结语</h3>
<p>我们在日常生活中或多或少的剥开微信红包那喜庆的<code>开</code>字动画，还有支付宝转账那动人心弦的：<code>支付宝到账~ 100万元~</code>，我们会发现，这两个占据中国移动支付半壁江山的巨头，尽管商业基因截然不同，</p>
<p><strong>一个源于社交的高频互动</strong>，</p>
<p><strong>一个源于电商的严谨交易</strong></p>
<p>但在底层技术架构上，有着绝对的严谨。</p>
<p>回顾全文，支撑起数十亿笔交易、保障资金万无一失的，正是这套现代移动支付平台不可或缺的<strong>五大技术脊梁</strong>：</p>
<ol>
<li><strong>分布式微服务架构</strong>：将庞大的单体系统拆解为原子化的服务节点，让系统拥有了“由于故障而自动隔离，由于流量而自动扩容”的弹性能力。</li>
<li><strong>分库分表（Sharding）</strong> ：通过哈希算法将海量数据化整为零，打破了单机数据库的物理存储与计算瓶颈，为亿级用户提供了无限的存储空间。</li>
<li><strong>多级缓存设计（Caching）</strong> ：Redis 充当了保护数据库的“防洪堤坝”，利用内存的高速读写特性，抗住了春节红包大战中那惊心动魄的千万级 QPS 洪峰。</li>
<li><strong>异步化解耦（Asynchronous MQ）</strong> ：消息队列让交易主链路“即刻响应”，将耗时的记账、通知、营销逻辑剥离，用“时间换空间”，实现了极致的用户体验。</li>
<li><strong>最终一致性事务</strong>：摒弃了性能低下的强一致性锁，采用本地消息表或 TCC 模式，在分布式网络的不确定性中，构建了资金流转确定性的“数学长城”。</li>
</ol>
<p><strong>回到文章最初的问题：我们是否可以实现？</strong></p>
<p>从代码逻辑和开源组件的角度来看，答案是肯定的。Redis、MySQL、Kafka、Seata 等开源基础设施让任何一个技术团队都有机会搭建出一套微型的“支付核心”。</p>
<h4 data-id="heading-17">附：高并发资金交易系统·通用架构全景图</h4>
<p>为了便于记忆，我将文中提到的核心技术点，总结为这张通用的架构全景图：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    %% 样式定义
    classDef layer fill:#e1f5fe,stroke:#01579b,stroke-width:2px;
    classDef component fill:#ffffff,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5;
    classDef core fill:#fff9c4,stroke:#fbc02d,stroke-width:2px;

    User((用户/客户端)) --&gt; |HTTPS/高并发请求| Gateway[接入网关层]
    
    subgraph Layer1 [流量削峰与路由]
        Gateway --&gt; |鉴权/限流| RedisCluster[Redis 集群]
        RedisCluster -.-&gt; |Lua脚本/原子扣减| Stock[库存/计数器]
        class RedisCluster,Stock core
    end

    subgraph Layer2 [核心业务逻辑]
        Gateway --&gt; Service[交易/支付微服务]
        Service --&gt; |异步解耦| MQ(消息队列 MQ)
        MQ --&gt; Notify[消息通知服务]
        MQ --&gt; Risk[风控分析服务]
        class MQ core
    end

    subgraph Layer3 [数据持久化与一致性]
        Service --&gt; |分片路由| Sharding[分库分表中间件]
        Sharding --&gt; DB_Masters[(MySQL 主库集群)]
        DB_Masters -.-&gt; |Binlog同步| DB_Slaves[(MySQL 从库/数仓)]
        
        Service -.-&gt; |本地消息表/TCC| Transaction[分布式事务保障]
        class Transaction core
    end

    subgraph Layer4 [兜底与对账]
        Check[T+1 离线对账系统] -.-&gt; |核对| DB_Slaves
        Check -.-&gt; |差异报警| Monitor[监控中心]
    end

    %% 连接关系
    Layer1 --&gt; Layer2
    Layer2 --&gt; Layer3
    Layer3 -.-&gt; Layer4

    %% 样式应用
    class Layer1,Layer2,Layer3,Layer4 layer
</code></pre>
<blockquote>
<p>本人熟于前端开发，对于后端技术并不是特别懂，以上技术资料均通过公开资料学习以及自身经验所得，如有错误请多指教。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JS-手写系列：从零手写 Promise]]></title>    <link>https://juejin.cn/post/7602565408533004338</link>    <guid>https://juejin.cn/post/7602565408533004338</guid>    <pubDate>2026-02-04T07:17:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602565408533004338" data-draft-id="7602565408532922418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JS-手写系列：从零手写 Promise"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-02-04T07:17:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JS-手写系列：从零手写 Promise
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T07:17:19.000Z" title="Wed Feb 04 2026 07:17:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p><code>Promise</code> 是 JavaScript 处理异步编程的基石。虽然我们在日常开发中频繁使用 <code>async/await</code>，但手动实现一个符合 Promise规范的类，不仅能让你在面试中脱颖而出，更能让你深刻理解微任务与链式调用的本质。</p>
<hr/>
<h2 data-id="heading-1">一、 Promise 核心设计方案</h2>
<p>实现一个标准的 Promise，必须紧扣以下四个核心点：</p>
<ol>
<li><strong>状态机机制</strong>：存在 <code>PENDING</code>（等待）、<code>FULFILLED</code>（成功）、<code>REJECTED</code>（失败）三种状态，状态转换不可逆。</li>
<li><strong>立即执行</strong>：构造函数中的执行器 <code>executor(resolve, reject)</code> 是同步立即执行的。</li>
<li><strong>微任务队列</strong>：回调函数的执行必须是异步的，通常使用 <code>queueMicrotask</code> 来实现。</li>
<li><strong>链式调用</strong>：<code>then</code> 方法必须返回一个新的 Promise，并将前一个 Promise 的输出作为后一个 Promise 的输入。</li>
</ol>
<h2 data-id="heading-2">二、 代码实现</h2>
<pre><code class="hljs language-JavaScript" lang="JavaScript">      <span class="hljs-comment">// 定义Promise的三种状态</span>
      <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PENDING</span> = <span class="hljs-string">'pending'</span>;
      <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FULFILLED</span> = <span class="hljs-string">'fulfilled'</span>;
      <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REJECTED</span> = <span class="hljs-string">'rejected'</span>;

      <span class="hljs-comment">/**
       * 自定义Promise实现
       * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} executor 执行器函数，接收resolve和reject参数
       */</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyPromise</span>(<span class="hljs-params">executor</span>) {
        <span class="hljs-keyword">const</span> self = <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 保存this指向，避免回调中丢失</span>
        self.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">PENDING</span>; <span class="hljs-comment">// 初始状态为pending</span>
        self.<span class="hljs-property">value</span> = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// 成功的结果值</span>
        self.<span class="hljs-property">reason</span> = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// 失败的原因</span>
        self.<span class="hljs-property">onFulfilledCallbacks</span> = []; <span class="hljs-comment">// 存储成功回调</span>
        self.<span class="hljs-property">onRejectedCallbacks</span> = []; <span class="hljs-comment">// 存储失败回调</span>

        <span class="hljs-comment">// 成功回调函数</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-params">value</span>) {
          <span class="hljs-comment">// 只有pending状态才能改变</span>
          <span class="hljs-keyword">if</span> (self.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) {
            self.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">FULFILLED</span>;
            self.<span class="hljs-property">value</span> = value;
            <span class="hljs-comment">// 异步执行所有成功回调，因为then方法是异步的，所以要等executor执行完再执行</span>
            <span class="hljs-title function_">queueMicrotask</span>(<span class="hljs-function">() =&gt;</span> {
              self.<span class="hljs-property">onFulfilledCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">callback</span>) =&gt;</span> {
                <span class="hljs-title function_">callback</span>(self.<span class="hljs-property">value</span>);
              });
            });
          }
        }

        <span class="hljs-comment">// 失败回调函数</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">reject</span>(<span class="hljs-params">reason</span>) {
          <span class="hljs-comment">// 只有pending状态才能改变</span>
          <span class="hljs-keyword">if</span> (self.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) {
            self.<span class="hljs-property">status</span> = <span class="hljs-variable constant_">REJECTED</span>;
            self.<span class="hljs-property">reason</span> = reason;
            <span class="hljs-comment">// 异步执行所有失败回调</span>
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
              self.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">callback</span>) =&gt;</span> {
                <span class="hljs-title function_">callback</span>(self.<span class="hljs-property">reason</span>);
              });
            });
          }
        }

        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// 立即执行执行器函数</span>
          <span class="hljs-title function_">executor</span>(resolve, reject);
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-comment">// 执行器抛出异常时，直接调用reject</span>
          <span class="hljs-title function_">reject</span>(error);
        }
      }

      <span class="hljs-comment">/** then方法实现
       * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} onFulfilled 成功回调
       * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} onRejected 失败回调
       * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">MyPromise</span>} 返回新的Promise实现链式调用
       */</span>
      <span class="hljs-title class_">MyPromise</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">then</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">onFulfilled, onRejected</span>) {
        <span class="hljs-keyword">const</span> self = <span class="hljs-variable language_">this</span>;
        <span class="hljs-comment">// 处理默认回调（兼容不传回调的情况）</span>
        onFulfilled =
          <span class="hljs-keyword">typeof</span> onFulfilled === <span class="hljs-string">'function'</span> ? onFulfilled : <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> value;
        onRejected =
          <span class="hljs-keyword">typeof</span> onRejected === <span class="hljs-string">'function'</span>
            ? onRejected
            : <span class="hljs-function">(<span class="hljs-params">reason</span>) =&gt;</span> {
                <span class="hljs-keyword">throw</span> reason;
              };

        <span class="hljs-comment">// 返回新的Promise实现链式调用，因为后续函数也可以通过then方法来处理</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPromise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
          <span class="hljs-comment">// 处理成功状态</span>
          <span class="hljs-keyword">if</span> (self.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">FULFILLED</span>) {
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
              <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 执行成功回调并获取返回值</span>
                <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onFulfilled</span>(self.<span class="hljs-property">value</span>);
                <span class="hljs-comment">// 根据返回值处理新Promise的状态</span>
                <span class="hljs-title function_">resolvePromise</span>(result, resolve, reject);
              } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-title function_">reject</span>(error);
              }
            });
          }


          <span class="hljs-comment">// 处理失败状态</span>
          <span class="hljs-keyword">if</span> (self.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">REJECTED</span>) {
            <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
              <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 执行失败回调并获取返回值</span>
                <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onRejected</span>(self.<span class="hljs-property">reason</span>);
                <span class="hljs-comment">// 根据返回值处理新Promise的状态</span>
                <span class="hljs-title function_">resolvePromise</span>(result, resolve, reject);
              } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-title function_">reject</span>(error);
              }
            });
          }

          <span class="hljs-comment">// 处理等待状态（暂存回调）</span>
          <span class="hljs-keyword">if</span> (self.<span class="hljs-property">status</span> === <span class="hljs-variable constant_">PENDING</span>) {
            self.<span class="hljs-property">onFulfilledCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> {
              <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onFulfilled</span>(self.<span class="hljs-property">value</span>);
                <span class="hljs-title function_">resolvePromise</span>(result, resolve, reject);
              } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-title function_">reject</span>(error);
              }
            });

            self.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-function">() =&gt;</span> {
              <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">onRejected</span>(self.<span class="hljs-property">reason</span>);
                <span class="hljs-title function_">resolvePromise</span>(result, resolve, reject);
              } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-title function_">reject</span>(error);
              }
            });
          }
        });
      };

      <span class="hljs-comment">/** catch方法实现（语法糖，等价于then(null, onRejected)）
       * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} onRejected 失败回调
       * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">MyPromise</span>}
       */</span>
      <span class="hljs-title class_">MyPromise</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">catch</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">onRejected</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">then</span>(<span class="hljs-literal">null</span>, onRejected);
      };

      <span class="hljs-comment">//静态方法resolve - 返回一个已完成的Promise</span>
      <span class="hljs-title class_">MyPromise</span>.<span class="hljs-property">resolve</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {
        <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyPromise</span>) {
          <span class="hljs-keyword">return</span> value;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPromise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
          <span class="hljs-title function_">resolve</span>(value);
        });
      };

      <span class="hljs-comment">//静态方法reject - 返回一个已失败的Promise</span>
      <span class="hljs-title class_">MyPromise</span>.<span class="hljs-property">reject</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPromise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> {
          <span class="hljs-title function_">reject</span>(reason);
        });
      };

      <span class="hljs-comment">// 处理then回调返回值的工具函数</span>
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">resolvePromise</span>(<span class="hljs-params">result, resolve, reject</span>) {
        <span class="hljs-comment">// 如果返回值是当前Promise，抛出循环引用错误</span>
        <span class="hljs-keyword">if</span> (result <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyPromise</span>) {
          result.<span class="hljs-title function_">then</span>(resolve, reject);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 普通值直接resolve</span>
          <span class="hljs-title function_">resolve</span>(result);
        }
      }
    
      <span class="hljs-comment">// 测试用例</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--- 测试用例开始 ---'</span>);

      <span class="hljs-comment">// 1. 基本 resolve</span>
      <span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPromise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'成功1'</span>), <span class="hljs-number">100</span>);
      })
      p1.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Test 1: 成功1'</span>, res); <span class="hljs-comment">// 成功1</span>
      })
      p1.<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Test 1: 失败1'</span>, err);
      })

      <span class="hljs-comment">// 2. 基本 reject + catch</span>
      <span class="hljs-comment">// const p2 = new MyPromise((_, reject) =&gt; {</span>
      <span class="hljs-comment">//   setTimeout(() =&gt; reject('失败1'), 100);</span>
      <span class="hljs-comment">// })</span>
      <span class="hljs-comment">// p2.then(success =&gt; {</span>
      <span class="hljs-comment">//   console.log('Test 2: 成功1', success); // 失败1</span>
      <span class="hljs-comment">// }, (err) =&gt; {</span>
      <span class="hljs-comment">//   console.log('Test 2: 失败1', err); // 失败1</span>
      <span class="hljs-comment">// })</span>
      <span class="hljs-comment">// p2.catch(err =&gt; {</span>
      <span class="hljs-comment">//   console.log('Test 2: 失败2', err); // 失败1</span>
      <span class="hljs-comment">// })</span>

      <span class="hljs-comment">// 3. executor 抛出异常</span>
      <span class="hljs-comment">// new MyPromise(() =&gt; {</span>
      <span class="hljs-comment">//   throw new Error('executor error');</span>
      <span class="hljs-comment">// }).catch(err =&gt; {</span>
      <span class="hljs-comment">//   console.log('Test 4: 异常', err.message); // executor error</span>
      <span class="hljs-comment">// });</span>

      <span class="hljs-comment">// 4. Promise 链式嵌套</span>
      <span class="hljs-comment">// const p4 = new MyPromise((resolve) =&gt; resolve(1))</span>
      <span class="hljs-comment">//   .then((v) =&gt; v + 1)</span>
      <span class="hljs-comment">//   .then((v) =&gt; MyPromise.resolve(v * 2))</span>
      <span class="hljs-comment">//   .then((v) =&gt; {</span>
      <span class="hljs-comment">//     console.log('Test 5:', v); // 4</span>
      <span class="hljs-comment">//   });</span>
</code></pre>
<h2 data-id="heading-3">三、 深度细节解析</h2>
<h3 data-id="heading-4">1. 为什么使用 <code>queueMicrotask</code>？</h3>
<p>根据 Promise规范，<code>onFulfilled</code> 或 <code>onRejected</code> 必须在执行上下文栈仅包含平台代码时执行。这意味着回调必须是异步的。使用微任务而不是宏任务（如 <code>setTimeout</code>），是为了保证在当前任务循环结束前尽可能快地执行回调。</p>
<h3 data-id="heading-5">2. 状态不可逆性</h3>
<p>在 <code>resolve</code> 和 <code>reject</code> 函数中，我们首先判断 <code>state === 'pending'</code>。一旦状态变为 <code>fulfilled</code> 或 <code>rejected</code>，后续任何调用都将被忽略，这保证了 Promise 的稳定性。</p>
<hr/>
<h2 data-id="heading-6">四、 总结</h2>
<ol>
<li><strong>同步执行</strong> <code>executor</code>。</li>
<li><strong>异步收集</strong> 回调函数。</li>
<li><strong>递归解析</strong> 返回值，实现链式调用。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[稀土掘金关于近期违规行为专项治理的公告]]></title>    <link>https://juejin.cn/post/7602651160465817650</link>    <guid>https://juejin.cn/post/7602651160465817650</guid>    <pubDate>2026-02-04T06:51:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602651160465817650" data-draft-id="7602488187408973876" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="稀土掘金关于近期违规行为专项治理的公告"/> <meta itemprop="keywords" content="掘金社区"/> <meta itemprop="datePublished" content="2026-02-04T06:51:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XCaptaino"/> <meta itemprop="url" content="https://juejin.cn/user/3052665287739005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            稀土掘金关于近期违规行为专项治理的公告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3052665287739005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XCaptaino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:51:03.000Z" title="Wed Feb 04 2026 06:51:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">稀土掘金关于近期违规行为专项治理的公告</h2>
<p>稀土掘金始终致力于为开发者提供<strong>安全、可信、专业的技术社区环境</strong>，坚决反对任何损害用户体验、侵害用户合法权益、破坏社区生态秩序的行为。</p>
<p>临近春节，平台内营销活动与外部推广行为集中出现，同时也是各类违规行为的高发阶段。近期，结合平台日常巡检与用户投诉反馈情况，稀土掘金针对部分<strong>严重干扰社区秩序、侵害用户权益的违规行为</strong>开展了专项治理。相关违规行为主要集中在以下三类：</p>
<ul>
<li>虚假营销及相关欺诈行为</li>
<li>过度营销、诱导互动等破坏社区体验的行为</li>
<li>存在数据安全风险、使用外挂或违规工具的行为</li>
</ul>
<p>为切实维护广大用户的合法权益与社区健康生态，平台将依据国家相关法律法规及以下平台规则，对相关违规行为进行重点治理：</p>
<ul>
<li>《<a href="https://juejin.cn/book/6844733795329900551/section/6844733795380232200" target="_blank" title="https://juejin.cn/book/6844733795329900551/section/6844733795380232200">稀土掘金用户服务协议</a>》</li>
<li>《<a href="https://juejin.cn/book/6844733795329900551/section/6844733795380232200" target="_blank" title="https://juejin.cn/book/6844733795329900551/section/6844733795380232200">稀土掘金社区规范</a>》</li>
</ul>
<hr/>
<h3 data-id="heading-1">一、虚假营销及相关欺诈行为</h3>
<p>部分账号或第三方主体发布的内容存在明显欺诈或误导性质，通过虚假宣传、仿冒身份、伪造福利等方式骗取用户信任，进而侵害用户财产安全与个人信息安全。主要表现形式包括但不限于：</p>
<h4 data-id="heading-2">1. 虚假福利及诱导交易行为</h4>
<p>通过虚构“高额返利”“限时福利”“内部资源”“免费资料”“官方补贴”等内容，诱导用户进行付费、添加联系方式、加入群聊或提交个人信息，最终无法兑现承诺，甚至直接失联。</p>
<h4 data-id="heading-3">2. 仿冒身份及误导沟通行为</h4>
<p>冒充稀土掘金官方账号、平台工作人员、社区认证作者或知名技术团队，以“账号异常”“内容审核”“合作邀约”“内测资格”“官方活动”等名义，引导用户前往非官方页面或私下沟通渠道，骗取账号信息、验证码或其他敏感数据。</p>
<p>上述行为不仅可能直接造成用户经济损失，还可能导致个人信息被非法采集、滥用或二次传播，进一步引发账号被盗、垃圾营销或精准诈骗等风险，严重破坏社区信任基础。</p>
<p>上述行为已明确违反《稀土掘金用户服务协议》《稀土掘金社区规范》等相关规定，平台将通过技术识别、人工审核及用户举报等方式，持续开展治理，并依法依规采取处置措施。</p>
<hr/>
<h3 data-id="heading-4">二、过度营销与诱导互动行为</h3>
<p>部分账号通过文章、评论、沸点、外部链接等形式，实施<strong>高频营销推广、强制或误导性跳转、诱导用户互动</strong>等行为，例如：</p>
<ul>
<li>以“做任务”“助力”“抽奖”“限时领取”等话术诱导用户转发、评论或点击</li>
<li>在技术内容中夹带明显营销或推广信息，影响正常阅读与学习体验</li>
<li>通过内容设计或技术手段，强制用户跳转至非预期页面</li>
</ul>
<p>此类行为会对社区内容质量与用户使用体验造成明显干扰，破坏正常的技术交流氛围。</p>
<p>针对上述违规行为，平台将依据违规情节轻重，采取包括但不限于以下处置措施：</p>
<ol>
<li>删除或限制违规内容展示</li>
<li>限制账号部分功能或降低内容推荐权重</li>
<li>对严重或屡次违规账号进行封禁处理</li>
</ol>
<hr/>
<h3 data-id="heading-5">三、数据安全风险与违规工具行为</h3>
<p>部分行为通过外挂脚本、自动化工具或非官方接口，对平台进行异常访问、数据抓取或自动化操作，可能对平台系统稳定性、数据安全及用户隐私构成威胁。</p>
<p>该类行为已违反《稀土掘金用户服务协议》《稀土掘金社区规范》等相关约定。平台将持续加强技术识别与风控能力建设，对存在安全风险的账号及行为依法依规进行处理，切实保障平台系统与用户数据安全。</p>
<h3 data-id="heading-6">结语</h3>
<p>稀土掘金呼吁广大用户与创作者共同维护健康、有序的社区环境。如发现相关违规行为，欢迎通过平台内举报渠道进行反馈。平台将持续优化治理机制，为开发者提供更加<strong>安全、可信、专注技术交流</strong>的社区空间。</p>
<h2 data-id="heading-7">部分违规举例</h2>
<ul>
<li>私信辱骂</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24a9439522f446ba95b9fd26e2259e84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770794448&amp;x-signature=MOmTpwftJeV2wB%2F0UMNX3ZOt%2Bb8%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>站外刷屏，利己主义引流分享，特别提醒卖保险的，兼职卖流量卡的、卖房子的、简历指导的、培训的</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22553a088a4e4fec95c7dd75664913a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770794448&amp;x-signature=c8LO8ueTOZWB0fAsDjdj0V3FJMg%3D" alt="img_v3_02ui_1c949983-6671-42ef-a807-35d9dac7cf2g.jpg" loading="lazy"/></p>
<ul>
<li>导流</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d70cb0d61f10469683995f9a54ac57e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770794448&amp;x-signature=gzKvR203YXFTOIljRaQOd1eW4YA%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9dc01fc6837d4d70bcc5fa1de89cf37b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770794448&amp;x-signature=xnECLc8D121pydgMwLjbeVfmWqw%3D" alt="image.png" loading="lazy"/></p>
<p>目前文章、沸点、用户和评论均支持举报，感谢大家的支持</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[混用 @Transactional 和 TransactionTemplate 被怼了，三种事务管理到底怎么选？]]></title>    <link>https://juejin.cn/post/7602531501457621001</link>    <guid>https://juejin.cn/post/7602531501457621001</guid>    <pubDate>2026-02-04T07:34:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602531501457621001" data-draft-id="7602901565032333358" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="混用 @Transactional 和 TransactionTemplate 被怼了，三种事务管理到底怎么选？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-04T07:34:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇小汤圆"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            混用 @Transactional 和 TransactionTemplate 被怼了，三种事务管理到底怎么选？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇小汤圆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T07:34:19.000Z" title="Wed Feb 04 2026 07:34:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">引言</h3>
<p>“只要你不考虑事务的问题，总有一天事务会来考虑你。”</p>
<p>忘记是哪位哲人说的这句话了，在最近的一次code review中，我逐渐体会到了这句话的分量。</p>
<p>当我看到同事在一个复杂的业务逻辑中混用了<code>@Transactional</code>注解和<code>TransactionTemplate</code>时，就预感到可能会有问题。</p>
<p>我问他为什么这样设计，他的回答让我有些意外："反正都能实现事务，应该没什么区别吧？"</p>
<p>这个回答让我意识到，很多开发者对Spring的事务管理机制其实理解得并不深入。大家往往知道加个<code>@Transactional</code>就能开启事务，但对于什么时候该用声明式、什么时候该用编程式，以及它们背后的工作原理，却很少深究。</p>
<p>事务管理看似简单，实则暗藏玄机。</p>
<p>今天我们就来深入聊聊Spring中的三种事务管理方式，以及它们各自的适用场景和潜在的风险。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d964424c74b45938a57897c2554b256~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770795260&amp;x-signature=seLeQjuDQreb1FaVcLBrPus82qg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">正文</h3>
<h4 data-id="heading-2">三种方式，各有千秋</h4>
<p>Spring给我们提供了三种处理事务的方式：<code>@Transactional</code>注解、<code>TransactionTemplate</code>和直接使用<code>TransactionManager</code>。</p>
<p>就像武侠小说里的三种兵器，每种都有自己的招式和适用场景。</p>
<h5 data-id="heading-3">@Transactional：最省心的</h5>
<p>提到事务管理，基本上都会想到去用<code>@Transactional</code>。</p>
<p>确实，这玩意儿用起来简单粗暴，在方法上加一个注解就完事了。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        userRepository.<span class="hljs-title function_">save</span>(user);
        <span class="hljs-comment">// 如果这里抛异常，上面的操作会回滚</span>
        <span class="hljs-title function_">sendWelcomeEmail</span>(user);
    }
}
</code></pre>
<p>最大的优点就是<strong>无侵入</strong>。</p>
<p>业务代码依然干净，事务逻辑完全交给Spring在背后搞定了。但是，这种黑盒式的便利必然有代价。</p>
<p>Spring通过AOP来实现声明式事务，给方法外面包了一层代理，这就会导致一些让人头疼的问题：</p>
<p><strong>内部方法调用失效</strong>：这是最容易踩的坑！当同一个类内部的方法调用带有<code>@Transactional</code>注解的方法时，事务不会生效。因为内部调用不会走代理。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">batchCreate</span>(<span class="hljs-params">List&lt;User&gt; users</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">User</span> user : users) {
            <span class="hljs-title function_">createUser</span>(user); <span class="hljs-comment">// ❌ 这里事务不会生效！</span>
        }
    }
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params">User user</span>) {
        userRepository.<span class="hljs-title function_">save</span>(user);
    }
}
</code></pre>
<p><strong>只对public方法生效</strong>：私有方法或者protected方法上加<code>@Transactional</code>毫无卵用。</p>
<p><strong>要匹配异常类型</strong>：默认只有<code>RuntimeException</code>和<code>Error</code>会触发回滚，检查型异常需要特殊配置。</p>
<p>可以看这篇文章：</p>
<p><a href="https://juejin.cn/post/7496344493709885455" target="_blank" title="https://juejin.cn/post/7496344493709885455">juejin.cn/post/749634…</a></p>
<p>虽然这些都是老生常谈的问题了，但在实际开发中，还是有太多因为这种细节出bug的情况。</p>
<h5 data-id="heading-4">TransactionTemplate：可控的</h5>
<p><code>TransactionTemplate</code>算是声明式和编程式事务的一个平衡点。它既保持了一定的灵活性，又不会让代码变得过于复杂。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">AccountService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">TransactionTemplate</span> transactionTemplate;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">transfer</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> fromAccount, <span class="hljs-built_in">String</span> toAccount, BigDecimal amount</span>) {
        transactionTemplate.<span class="hljs-title function_">execute</span>(status -&gt; {
            <span class="hljs-keyword">try</span> {
                accountRepository.<span class="hljs-title function_">debit</span>(fromAccount, amount);
                accountRepository.<span class="hljs-title function_">credit</span>(toAccount, amount);
                returnnull;
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">InsufficientFundsException</span> e) {
                <span class="hljs-comment">// 可以根据业务逻辑决定是否回滚</span>
                status.<span class="hljs-title function_">setRollbackOnly</span>();
                <span class="hljs-keyword">throw</span> e;
            }
        });
    }
}
</code></pre>
<p>用<code>TransactionTemplate</code>的好处是你可以精确控制事务的边界，也不用担心方法调用的问题。</p>
<p>而且还可以在事务执行过程中获取到事务的状态信息，做点更细致的控制。</p>
<p>但这种方式也有些问题。</p>
<p>最明显的就是代码的可读性会变差一些，业务逻辑和事务逻辑会混在一起。</p>
<p>另外，如果业务逻辑比较复杂，嵌套层次深的话，代码也会变得不太好维护。</p>
<p>当然一般来说都会在额外封装一些方法以供业务侧来调用。</p>
<h5 data-id="heading-5">TransactionManager：最灵活的</h5>
<p>如果想要完全的控制权，那就得直接用<code>TransactionManager</code>了。这种方式最灵活，但灵活的代价就是容易出错。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
publicclass PaymentService {
    
    <span class="hljs-keyword">@Autowired</span>
    private PlatformTransactionManager transactionManager;
    
    public void <span class="hljs-built_in">processPayment</span>(Payment payment) {
        DefaultTransactionDefinition def = new <span class="hljs-built_in">DefaultTransactionDefinition</span>();
        def<span class="hljs-selector-class">.setIsolationLevel</span>(TransactionDefinition.ISOLATION_READ_COMMITTED);
        def<span class="hljs-selector-class">.setPropagationBehavior</span>(TransactionDefinition.PROPAGATION_REQUIRED);
        
        TransactionStatus status = transactionManager<span class="hljs-selector-class">.getTransaction</span>(def);
        try {
            paymentRepository<span class="hljs-selector-class">.save</span>(payment);
            notificationService<span class="hljs-selector-class">.sendPaymentConfirmation</span>(payment);
            transactionManager<span class="hljs-selector-class">.commit</span>(status);
        } catch (Exception e) {
            transactionManager<span class="hljs-selector-class">.rollback</span>(status);
            throw e;
        }
    }
}
</code></pre>
<p>这种方式的好处是可以精确控制事务的每一个细节，比如隔离级别、传播行为、超时时间等等。</p>
<p>但是代码量会增加很多，而且容易出错。</p>
<p>一旦忘记提交或者回滚，那迟早会有数据不一致的惊喜。</p>
<h4 data-id="heading-6">该选哪个？</h4>
<p>经过上面的介绍，到底该怎么选择呢？</p>
<p>我的建议是这样的：</p>
<p><strong>大部分情况下，@Transactional就够用了</strong>。它简单、直接，能解决90%的场景。除非你遇到了它解决不了的问题，否则没必要搞复杂。</p>
<p><strong>需要精细控制时，考虑TransactionTemplate</strong>。比如你需要在事务执行过程中根据某些条件决定是否回滚，或者需要在一个方法里管理多个事务，这时候就需要用上<code>TransactionTemplate</code>了。</p>
<p><strong>极少数情况下才直接用TransactionManager</strong>。通常是在写框架代码或者有非常特殊的需求时才会用到。</p>
<h4 data-id="heading-7">一个例子</h4>
<p>让我举个实际的例子来说明这三种方式的差异。</p>
<p>假设我们要实现一个批量导入用户的功能，要求是：如果某个用户导入失败，不应该影响其他用户的导入。</p>
<p>用<code>@Transactional</code>的话，可能会这样写：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserImportService</span> {
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">importUsers</span>(<span class="hljs-params">List&lt;User&gt; users</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">User</span> user : users) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-title function_">createUserWithTransaction</span>(user);  <span class="hljs-comment">// 注意，这样写事务不会生效！</span>
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"导入用户失败: {}"</span>, user.<span class="hljs-title function_">getUsername</span>(), e);
            }
        }
    }
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUserWithTransaction</span>(<span class="hljs-params">User user</span>) {
        userRepository.<span class="hljs-title function_">save</span>(user);
        userProfileRepository.<span class="hljs-title function_">save</span>(user.<span class="hljs-title function_">getProfile</span>());
    }
}
</code></pre>
<p><strong>⚠️ 上面的代码中，事务是不会生效的！</strong></p>
<p>这是因为<code>importUsers</code>方法调用同一个类中的<code>createUserWithTransaction</code>方法，属于<strong>内部方法调用</strong>。Spring AOP通过代理实现事务，而同一个类内部的方法调用不会走代理，所以<code>@Transactional</code>注解完全失效。</p>
<p>通俗的做法是将有事务的方法抽取到另一个Service中：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserImportService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">UserTransactionService</span> userTransactionService;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">importUsers</span>(<span class="hljs-params">List&lt;User&gt; users</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">User</span> user : users) {
            <span class="hljs-keyword">try</span> {
                userTransactionService.<span class="hljs-title function_">createUserWithTransaction</span>(user);  <span class="hljs-comment">// ✅ 这样才会生效</span>
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"导入用户失败: {}"</span>, user.<span class="hljs-title function_">getUsername</span>(), e);
            }
        }
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserTransactionService</span> {
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createUserWithTransaction</span>(<span class="hljs-params">User user</span>) {
        userRepository.<span class="hljs-title function_">save</span>(user);
        userProfileRepository.<span class="hljs-title function_">save</span>(user.<span class="hljs-title function_">getProfile</span>());
    }
}
</code></pre>
<p>这种方式的问题是需要额外创建一个Service类，增加了代码复杂度。</p>
<p>当然还有另一种方式使用Spring的 <code>AopContext.currentProxy()</code> 拿到当前代理对象再去调用，或者用 <code>ApplicationContext</code> 去从容器里获取代理对象，但始终觉得不太优雅。</p>
<p>这也是为什么有时候<code>TransactionTemplate</code>会是更好的选择。</p>
<p>用<code>TransactionTemplate</code>的话：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserImportService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">TransactionTemplate</span> transactionTemplate;
    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">importUsers</span>(<span class="hljs-params">List&lt;User&gt; users</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">User</span> user : users) {
            <span class="hljs-keyword">try</span> {
                transactionTemplate.<span class="hljs-title function_">execute</span>(status -&gt; {
                    userRepository.<span class="hljs-title function_">save</span>(user);
                    userProfileRepository.<span class="hljs-title function_">save</span>(user.<span class="hljs-title function_">getProfile</span>());
                    returnnull;
                });
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
                log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"导入用户失败: {}"</span>, user.<span class="hljs-title function_">getUsername</span>(), e);
            }
        }
    }
}
</code></pre>
<p>这种方式就很清晰，事务边界在代码中一目了然，而且不用担心方法调用的问题。</p>
<p>那<code>TransactionManager</code>呢？</p>
<p>写业务的时候基本不太会用到，所以咱也不多费口舌了。</p>
<h4 data-id="heading-8">踩过的坑</h4>
<p>说到事务管理，我自己也踩过不少坑。</p>
<p>印象最深的一次是在处理一个报表统计的功能时，由于数据量比较大，我想着用只读事务来提高性能：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Transactional</span>(readOnly = <span class="hljs-literal">true</span>)
<span class="hljs-keyword">public</span> <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">ReportData</span>&gt; <span class="hljs-title function_">generateReport</span>(<span class="hljs-params">ReportQuery query</span>) {
    <span class="hljs-comment">// 复杂的查询逻辑</span>
    <span class="hljs-keyword">return</span> reportRepository.<span class="hljs-title function_">findComplexData</span>(query);
}
</code></pre>
<p>结果发现性能提升并不明显，后来才知道只读事务在某些数据库连接池配置下，效果并不理想。</p>
<p>另一个常见的问题是事务超时。</p>
<p>有些开发者喜欢把事务超时设置得很长，生怕业务逻辑执行时间过长导致事务回滚。但这样做的风险很明显，如果真出现了死锁或者其他问题，系统会长时间无响应。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 这样设置必然是不太好的，极其不推荐，除非你明确知道自己在做什么</span>
<span class="hljs-meta">@Transactional(timeout = 300)</span> <span class="hljs-comment">// 5分钟超时</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processLargeDataSet</span><span class="hljs-params">(List&lt;Data&gt; dataList)</span> {
    <span class="hljs-comment">// 大量数据处理逻辑</span>
}
</code></pre>
<p>更好的做法是，把大事务拆分成小事务，或者改写成批处理。</p>
<h4 data-id="heading-9">混合使用的问题</h4>
<p>回到文章开头提到的那个同事的代码，混合使用不同的事务管理方式很容易出问题。</p>
<p>最常见的情况是事务传播行为的理解偏差。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">TransactionTemplate</span> transactionTemplate;
    
    <span class="hljs-meta">@Transactional</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">processOrder</span>(<span class="hljs-params">Order order</span>) {
        orderRepository.<span class="hljs-title function_">save</span>(order);
        
        <span class="hljs-comment">// 这里又开了一个事务模板，传播行为可能和预期不一致</span>
        transactionTemplate.<span class="hljs-title function_">execute</span>(status -&gt; {
            auditRepository.<span class="hljs-title function_">save</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderAudit</span>(order));
            returnnull;
        });
    }
}
</code></pre>
<p>这种混用的代码很蛋疼，很难理解事务的边界，调试起来也很烦。</p>
<p>所以在一个service类中尽量保持事务管理方式的一致性，没事少折腾。</p>
<h3 data-id="heading-10">结尾/总结</h3>
<p>稍微总结一下。</p>
<p>对于新手，建议先把<code>@Transactional</code>的各种特性和坑点搞明白，基本能解决大部分问题。等到真正需要更精细控制的时候，再考虑其他方案。</p>
<p>对于有经验的开发者，在已经熟练掌握编程时事务控制的前提下，再多关注事务的性能影响。</p>
<p>事务不是万金油，过度使用或者不当使用都会带来不可预料的性能问题。</p>
<p>最重要的是，无论选择哪种方式，都要保证代码的可读性和可维护性。</p>
<p>技术是为业务服务的，而代码是要给整个团队一起维护的，不要为了炫技让代码变得晦涩难懂。</p>
<p>希望这篇文章能帮你理清楚这三种方式的区别和使用场景。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JS-一文带你彻底搞懂 Promise 并发控制：all, race, any, allSettled]]></title>    <link>https://juejin.cn/post/7602544700476227594</link>    <guid>https://juejin.cn/post/7602544700476227594</guid>    <pubDate>2026-02-04T07:40:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602544700476227594" data-draft-id="7602531501457555465" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JS-一文带你彻底搞懂 Promise 并发控制：all, race, any, allSettled"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-02-04T07:40:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JS-一文带你彻底搞懂 Promise 并发控制：all, race, any, allSettled
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T07:40:10.000Z" title="Wed Feb 04 2026 07:40:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在处理异步任务时，我们经常需要同时发起多个请求。Promise 提供的静态方法能让我们优雅地控制多个并发异步任务。本文将深度对比 <code>all</code>、<code>race</code>、<code>any</code> 和 <code>allSettled</code> 的区别与应用场景。</p>
<h2 data-id="heading-1">一、 方法详解与对比</h2>
<h3 data-id="heading-2">1. Promise.all() —— “全员通过制”</h3>
<ul>
<li>
<p><strong>概念</strong>：将多个 Promise 实例包装成一个。</p>
</li>
<li>
<p><strong>状态决定</strong>：</p>
<ul>
<li><strong>Fulfilled</strong>：所有实例都成功。</li>
<li><strong>Rejected</strong>：只要有<strong>一个</strong>失败，整体立即失败。</li>
</ul>
</li>
<li>
<p><strong>应用场景</strong>：多个接口联动，必须全部拿到数据才能渲染页面。</p>
</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript">  <span class="hljs-keyword">const</span> p1 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
  <span class="hljs-keyword">const</span> p2 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>);
  <span class="hljs-keyword">const</span> p3 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>);

  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([p1, p2, p3])
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">results</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(results); <span class="hljs-comment">// [1, 2, 3] 顺序与传入一致</span>
    })
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'其中一个失败了'</span>, err);
    });
</code></pre>
<h3 data-id="heading-3">2. Promise.race() —— “竞速制”</h3>
<ul>
<li><strong>概念</strong>：谁跑得快就听谁的。</li>
<li><strong>状态决定</strong>：状态取决于<strong>第一个</strong>改变状态的实例。</li>
<li><strong>应用场景</strong>：请求超时控制。</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript">  <span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'1秒后成功'</span>), <span class="hljs-number">1000</span>)
  );
  <span class="hljs-keyword">const</span> p2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'500毫秒后成功'</span>), <span class="hljs-number">500</span>)
  );
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([p1, p2]).<span class="hljs-title function_">then</span>(
    <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`测试1结果：<span class="hljs-subst">${res}</span> (竞速赢家)`</span>, <span class="hljs-string">'success'</span>),
    <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`测试1失败：<span class="hljs-subst">${err}</span>`</span>, <span class="hljs-string">'error'</span>)
  );
</code></pre>
<h3 data-id="heading-4">3. Promise.any() —— “择优录取制”</h3>
<ul>
<li>
<p><strong>概念</strong>：只要有一个成功就算成功。</p>
</li>
<li>
<p><strong>状态决定</strong>：</p>
<ul>
<li><strong>Fulfilled</strong>：只要有一个成功。</li>
<li><strong>Rejected</strong>：<strong>全部</strong>都失败时才失败（返回 <code>AggregateError</code>）。</li>
</ul>
</li>
<li>
<p><strong>应用场景</strong>：从多个备用服务器获取相同资源。</p>
</li>
</ul>
<pre><code class="hljs language-JavaScript" lang="JavaScript">  <span class="hljs-keyword">const</span> p1 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>);
  <span class="hljs-keyword">const</span> p2 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-number">2</span>);
  <span class="hljs-keyword">const</span> p3 = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-number">3</span>);
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">any</span>([p1, p2, p3])
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`有一个成功了：<span class="hljs-subst">${res}</span>`</span>, <span class="hljs-string">'success'</span>))
    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`所有都失败了：<span class="hljs-subst">${err}</span>`</span>, <span class="hljs-string">'error'</span>));
</code></pre>
<h3 data-id="heading-5">4. Promise.allSettled() —— “结果导向制”</h3>
<ul>
<li><strong>概念</strong>：无论成功失败，我全都要。</li>
<li><strong>状态决定</strong>：永远是 <strong>fulfilled</strong>（在所有实例都结束后）。</li>
<li><strong>应用场景</strong>：执行多个互不影响的操作，最后统一统计结果。</li>
</ul>
<hr/>
<h2 data-id="heading-6">二、 核心差异对比表</h2>
<p>为了 scannability（易读性），我们通过表格直观对比：</p>



































<table><thead><tr><th><strong>方法</strong></th><th><strong>成功条件 (Fulfilled)</strong></th><th><strong>失败条件 (Rejected)</strong></th><th><strong>结果返回值</strong></th></tr></thead><tbody><tr><td><strong><code>.all()</code></strong></td><td><strong>全部</strong>成功</td><td><strong>任意一个</strong>失败</td><td>成功结果数组（按序）</td></tr><tr><td><strong><code>.race()</code></strong></td><td><strong>任意一个</strong>最先成功</td><td><strong>任意一个</strong>最先失败</td><td>第一个改变状态的值</td></tr><tr><td><strong><code>.any()</code></strong></td><td><strong>任意一个</strong>成功</td><td><strong>全部</strong>失败</td><td>第一个成功的值</td></tr><tr><td><strong><code>.allSettled()</code></strong></td><td><strong>所有</strong>任务结束</td><td>从不（状态永远成功）</td><td>包含状态和值的对象数组</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">三、 总结</h2>
<h3 data-id="heading-8">1. Promise.all 与 Promise.race 的直观区别</h3>
<ul>
<li><strong>Promise.all</strong>：照顾“跑得最慢”的。必须等最慢的一个完成，且全员合格，才给最终结果。</li>
<li><strong>Promise.race</strong>：关注“跑得最快”的。最快的那个一旦过线，无论输赢，比赛立刻结束。</li>
</ul>
<h3 data-id="heading-9">2.  进阶使用</h3>
<p>在项目中，配合 <code>async/await</code> 使用更加优雅：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 强类型约束结果数组</span>
    <span class="hljs-keyword">const</span> [user, orders] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-property">all</span>&lt;[<span class="hljs-title class_">UserType</span>, <span class="hljs-title class_">OrderType</span>[]]&gt;([
      <span class="hljs-title function_">getUserInfo</span>(),
      <span class="hljs-title function_">getOrderList</span>()
    ]);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user, orders);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// 处理第一个捕获到的错误</span>
  }
};
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[腾讯二面：如果你是王者荣耀的架构师，面对亿级别的排行榜，你会如何设计？]]></title>    <link>https://juejin.cn/post/7602565408533168178</link>    <guid>https://juejin.cn/post/7602565408533168178</guid>    <pubDate>2026-02-04T07:41:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602565408533168178" data-draft-id="7602901565032431662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="腾讯二面：如果你是王者荣耀的架构师，面对亿级别的排行榜，你会如何设计？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-04T07:41:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇小汤圆"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            腾讯二面：如果你是王者荣耀的架构师，面对亿级别的排行榜，你会如何设计？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇小汤圆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T07:41:36.000Z" title="Wed Feb 04 2026 07:41:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文从面试的角度，跟大家一起探讨一下，如何回答更好呢？</p>
<ul>
<li>数据库的order by为什么不行？</li>
<li>为什么<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269915197%26content_type%3DArticle%26match_order%3D1%26q%3DRedis%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269915197&amp;content_type=Article&amp;match_order=1&amp;q=Redis&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Redis</a>是排行榜的“扛把子”？</li>
<li>Redis扛亿级数据可能存在哪些问题以及对应解决方案</li>
<li>实现方案：分治</li>
<li>巨人的肩膀，前人踩过的坑</li>
</ul>
<h2 data-id="heading-0">1. 数据库的order by</h2>
<p>很多小伙伴，一提到排行榜，就想到数据库的order by。</p>
<p>比如微信运动的步数排行：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94681118ab494ec8b775e4aba182e2b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770795696&amp;x-signature=zMVU5PEzZCGyQNzy%2BWJD33eNCHw%3D" alt="" loading="lazy"/></p>
<p><code>select * from user_info order by step desc</code></p>
<p>这个实现没有问题的，如果表的数据量少的话，反而推荐这样实现。如果数据量多呢。则存在问题，尤其还涉及亿级的数据量时~</p>
<blockquote>
<p>在亿级用户+高并发实时更新的场景下，会彻底崩盘。 原因一句话：<strong>磁盘扛不住，排序算不动，并发撑不起</strong>。</p>
</blockquote>
<h2 data-id="heading-1">2.为什么Redis是排行榜的扛把子</h2>
<p>当数据量较大且需要实时更新并频繁查询时，使用 Redis 的<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269915197%26content_type%3DArticle%26match_order%3D1%26q%3Dzset%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269915197&amp;content_type=Article&amp;match_order=1&amp;q=zset&amp;zhida_source=entity" ref="nofollow noopener noreferrer">zset</a>有序集合更为适合。</p>
<p><code>zset</code>是<code>Redis</code>提供的一种数据结构，它类似于集合（set），但每个成员都关联着一个分数（<code>score</code>），Redis 使用这个分数来对集合中的成员进行排序。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb866734b7b744aaa020fe968f455d23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770795696&amp;x-signature=TduHGCU6hL1xsLAilwYqLkSR0g8%3D" alt="" loading="lazy"/></p>
<p>不仅仅是redis的zset支持排序，API简单易用，还因为redis的排序快、可扩展性强、能轻松应对高并发。</p>
<h3 data-id="heading-2">2.1 redis排序快</h3>
<p>Redis 的数据全放内存，避免磁盘读写，核心操作秒回：</p>
<ul>
<li>更新分数（ZADD）→ 快如闪电</li>
<li>查排名（ZREVRANK）→ 毫秒响应</li>
<li>查Top 100（ZREVRANGE）→ 瞬间出结果</li>
</ul>
<p>以下为 Redis vs MySQL 性能对比（亿级数据）</p>
<h3 data-id="heading-3">2.2 可扩展性强</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269915197%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%2588%2586%25E7%2589%2587%25E5%25AD%2598%25E5%2582%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269915197&amp;content_type=Article&amp;match_order=1&amp;q=%E5%88%86%E7%89%87%E5%AD%98%E5%82%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">分片存储</a>轻松应对亿级数据。</p>
<p>Redis通过<strong>分片存储将数据拆分到多个实例</strong>，如同把1亿用户分配到10个小数据库，每个只需处理1000万数据，轻松实现：</p>
<ul>
<li>1️⃣ 线性扩展：加机器就能提升容量和性能</li>
<li>2️⃣ 压力分散：读写请求分摊到不同分片，避免单点瓶颈</li>
<li>3️⃣ 独立扩容：热点分片可单独升级配置，不干扰其他节点</li>
</ul>
<p>类比理解：</p>
<blockquote>
<p>把一仓库货物（数据）分装到10辆卡车（分片），每辆车只运1/10的货，装卸速度自然快10倍！</p>
</blockquote>
<h3 data-id="heading-4">2.3 轻松应对高并发</h3>
<p>Redis用**内存操作+单线程+<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269915197%26content_type%3DArticle%26match_order%3D1%26q%3DIO%25E5%25A4%259A%25E8%25B7%25AF%25E5%25A4%258D%25E7%2594%25A8%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269915197&amp;content_type=Article&amp;match_order=1&amp;q=IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8&amp;zhida_source=entity" ref="nofollow noopener noreferrer">IO多路复用</a>**三把利剑，轻松切开高并发大山：</p>
<ul>
<li>1️⃣ 内存闪电读写：数据全放内存，比磁盘快10万倍</li>
<li>2️⃣ 单线程无锁：避免多线程切换损耗，原子操作不怕并发冲突</li>
<li>3️⃣ IO多路复用：一个线程监听万个连接，像银行超级柜员同时处理多窗口业务</li>
</ul>
<p><strong>田螺哥打个比喻吧</strong>：</p>
<p>Redis就像一个<strong>超高效快餐窗口</strong>：</p>
<ul>
<li><strong>只卖预制菜（内存数据）</strong> → 出餐快</li>
<li><strong>一个收银员专注打单（单线程）</strong> → 不手忙脚乱</li>
<li><strong>智能叫号器管理排队（IO多路复用）</strong> → 千人排队也能快速响应</li>
</ul>
<p>据有关测试证明，<strong>单机Redis可扛10万+ QPS，分片集群轻松突破百万级并发</strong>。</p>
<h2 data-id="heading-5">3.Redis扛亿级数据可能存在哪些问题以及对应解决方案</h2>
<h3 data-id="heading-6">3.1 热Key问题</h3>
<p>比如“全服TOP100”榜单，容易造就热点key问题。</p>
<blockquote>
<p>全服玩家频繁查询 ZREVRANGE leaderboard 0 99（获取Top 100），导致所有请求集中访问 同一个Key（leaderboard）。容易导致单分片CPU和带宽被打满（假设数据分片不均匀）。极端情况下Redis实例崩溃，全服排行榜瘫痪</p>
</blockquote>
<p>可以通过这些方式解决：</p>
<ul>
<li>1.<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269915197%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25A4%259A%25E7%25BA%25A7%25E7%25BC%2593%25E5%25AD%2598%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269915197&amp;content_type=Article&amp;match_order=1&amp;q=%E5%A4%9A%E7%BA%A7%E7%BC%93%E5%AD%98&amp;zhida_source=entity" ref="nofollow noopener noreferrer">多级缓存</a>（Redis + jvm本地缓存）</li>
</ul>
<blockquote>
<ul>
<li>请求优先读本地内存缓存</li>
<li>缓存未命中时读Redis集群</li>
<li>Redis集群内部缓存Top 100（设置更短TTL）</li>
</ul>
</blockquote>
<ul>
<li>读写分离 + 从库负载均衡</li>
</ul>
<blockquote>
<p>主库处理写请求（更新分数）。多个从库轮询处理读请求（查Top 100）</p>
</blockquote>
<ul>
<li>分片Key设计</li>
</ul>
<blockquote>
<p>操作：将排行榜按分数区间拆分成多个Key，例如：</p>
<ul>
<li>leaderboard:top1（前100名）</li>
<li>leaderboard:top2（101~1000名）</li>
<li>leaderboard:rest（其他用户）</li>
</ul>
<p>查询逻辑：查Top 100时，只需访问 leaderboard:top1。</p>
</blockquote>
<h3 data-id="heading-7">3.2 内存爆炸</h3>
<blockquote>
<p>存储1亿用户，若每个键占32字节（如 user:123），仅键就需约3.2GB，加上分数和指针，内存压力巨大。</p>
</blockquote>
<p>优化方案：</p>
<ul>
<li><strong>缩短键名</strong>：将 user:123 转换为整数（如123），利用 Redis 的 int 编码优化内存。</li>
<li><strong>分片存储</strong>：按用户ID哈希分片到多个 Redis 实例，分散压力。</li>
</ul>
<h3 data-id="heading-8">3.3 数据持久化风险</h3>
<blockquote>
<p>Redis 宕机可能导致最新数据丢失（即使开启AOF，默认每秒同步一次）。</p>
</blockquote>
<p>容灾方案：</p>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269915197%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%25BC%2582%25E6%25AD%25A5%25E5%258F%258C%25E5%2586%2599%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269915197&amp;content_type=Article&amp;match_order=1&amp;q=%E5%BC%82%E6%AD%A5%E5%8F%8C%E5%86%99&amp;zhida_source=entity" ref="nofollow noopener noreferrer">异步双写</a>：更新分数时，同步写入 Kafka，由消费者异步落库 MySQL，用于故障恢复。</p>
</li>
<li>
<p>混合持久化：开启 RDB + AOF，平衡恢复速度与数据完整性。</p>
</li>
</ul>
<h2 data-id="heading-9">4. 实现方案：分治</h2>
<p>比如我们要查询王者荣耀巅峰赛的前一百积分的玩家。（其实就是一个TOP N问题）</p>
<p>我们可以按照这种思路：</p>
<ul>
<li>按区间拆分</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D269915197%26content_type%3DArticle%26match_order%3D1%26q%3D%25E5%258A%25A8%25E6%2580%2581%25E8%25B7%25AF%25E7%2594%25B1%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=269915197&amp;content_type=Article&amp;match_order=1&amp;q=%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1&amp;zhida_source=entity" ref="nofollow noopener noreferrer">动态路由</a></li>
<li>聚合查询</li>
</ul>
<h3 data-id="heading-10">4.1. 按区间拆分：把排行榜切成小块蛋糕**</h3>
<p><strong>怎么拆？</strong></p>
<ul>
<li>高分玩家放「金盘子」：2500分以上 →<code>rank:2500_2600</code></li>
<li>中分玩家放「银盘子」：2400~2500分 →<code>rank:2400_2500</code></li>
<li>低分玩家丢「大锅」：0~2400分 →<code>rank:0_2400</code></li>
</ul>
<p><strong>为什么快？</strong></p>
<ul>
<li>查Top 100只需翻「金盘子」，不用搅动整个大锅！</li>
<li>盘子越小 → 翻找速度越快</li>
</ul>
<h3 data-id="heading-11">4.2 动态路由：玩家换区自动导航</h3>
<p><strong>怎么动？</strong></p>
<ul>
<li>玩家积分变化时，<strong>自动检测该去哪</strong>：</li>
</ul>
<p><code># 伪代码：2503分该放哪个区间？ if2500 &lt;= new_score &lt; 2600: 扔进 rank:2500_2600 elif2400 &lt;= new_score &lt; 2500: 扔进 rank:2400_2500</code></p>
<h3 data-id="heading-12">4.3 聚合查询：拼图式合并结果</h3>
<p><strong>怎么拼？</strong></p>
<ol>
<li>从高到低翻盘子：</li>
</ol>
<ul>
<li>先查「金盘子」→ 拿到前50名</li>
<li>不够100？再查「银盘子」→ 补50名</li>
</ul>
<ol>
<li>全局排序：</li>
</ol>
<ul>
<li>把两个盘子的100人按分数重新排座次</li>
</ul>
<h2 data-id="heading-13">5. 巨人的肩膀，前人踩过的坑</h2>
<ul>
<li><strong>慎用ZREVRANGE类全量操作</strong></li>
</ul>
<blockquote>
<p>直接使用ZREVRANGE获取Top N时，若数据量过大（如1亿用户），会触发O(N)复杂度遍历，导致Redis线程阻塞</p>
</blockquote>
<ul>
<li><strong>警惕黑马用户冲击分片策略</strong></li>
</ul>
<blockquote>
<p>突然出现的高分用户（如积分暴涨至前0.1%）可能打乱原有分片规则，导致数据集中在某个分片引发热点。</p>
</blockquote>
<ul>
<li><strong>内存爆炸与性能抖动</strong></li>
</ul>
<blockquote>
<p>亿级用户存储占用内存超限，且RDB/AOF持久化时fork子进程引发内存翻倍。</p>
</blockquote>
<ul>
<li><strong>数据迁移阻塞服务</strong></li>
</ul>
<blockquote>
<p>用户积分跨分片迁移时，若未原子操作可能导致数据丢失或重复。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS 如何绕过 ATS 发送请求，iOS调试]]></title>    <link>https://juejin.cn/post/7602579671475322899</link>    <guid>https://juejin.cn/post/7602579671475322899</guid>    <pubDate>2026-02-04T07:54:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602579671475322899" data-draft-id="7602543146237050923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS 如何绕过 ATS 发送请求，iOS调试"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-04T07:54:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心就好2025"/> <meta itemprop="url" content="https://juejin.cn/user/3850962908492660"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS 如何绕过 ATS 发送请求，iOS调试
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3850962908492660/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心就好2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T07:54:19.000Z" title="Wed Feb 04 2026 07:54:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在调试 iOS 网络问题时，一开始并不会想到 ATS 绕过。
一般是来自一个可复现的现象，<strong>请求根本没有到达服务器</strong>，这时候我们才会去处理 ATS。</p>
<p>比如，当你在服务端后台看不到访问记录，而客户端手机app又没有明确报错。</p>
<hr/>
<h2 data-id="heading-0"><strong>先确认阻断发生在哪一层</strong></h2>
<p>ATS 的拦截发生在客户端网络栈内部。
在继续之前，需要先判断<strong>请求是否已经离开设备</strong>。</p>
<p>一个简单的验证方式是切断网络：</p>
<ul>
<li>关闭 Wi-Fi / 蜂窝网络</li>
<li>触发 App 的目标操作</li>
<li>观察 UI 是否出现加载失败或超时提示</li>
</ul>
<p>如果在网络关闭状态下表现一致，说明当前操作并未触发网络请求。
如果表现发生变化，说明请求确实存在，下一步才有意义。</p>
<hr/>
<h2 data-id="heading-1"><strong>使用代理工具确认 ATS 是否阻断在 HTTPS 建连前</strong></h2>
<p>当请求存在时，可以先用代理工具验证是否走系统网络。</p>
<h3 data-id="heading-2">代理验证步骤</h3>
<ul>
<li>在电脑上启动代理工具（如 Charles / Fiddler）</li>
<li>iPhone 与电脑处于同一局域网</li>
<li>在 Wi-Fi 设置中配置代理地址和端口</li>
<li>在 iOS 上安装并信任代理证书</li>
<li>用 Safari 访问一个 HTTPS 页面</li>
</ul>
<p>如果 Safari 请求能被完整抓取，说明：</p>
<ul>
<li>系统代理生效</li>
<li>HTTPS 解密可用</li>
</ul>
<p>此时再触发 App 请求，观察代理工具中的行为。</p>
<hr/>
<h2 data-id="heading-3"><strong>代理中没有 App 请求，意味着什么</strong></h2>
<p>当 Safari 流量可见，而 App 完全没有任何记录时，可以得出一个结论：</p>
<p><strong>该 App 的网络请求没有经过系统代理。</strong></p>
<p>在 ATS 场景中，这种情况常见于：</p>
<ul>
<li>App 使用自定义网络栈</li>
<li>SDK 内部绕过系统网络配置</li>
<li>ATS 直接在 App 内部阻断了请求创建</li>
</ul>
<p>继续在代理工具中调整设置，并不会改变这个结果。</p>
<hr/>
<h2 data-id="heading-4"><strong>用数据流确认请求是否被 ATS 阻断</strong></h2>
<p>在放弃代理之前，可以使用网络层工具确认是否存在底层通信。</p>
<p>观察以下现象即可判断：</p>
<ul>
<li>是否有 DNS 查询</li>
<li>是否有 TCP 建连</li>
<li>是否有 TLS ClientHello</li>
</ul>
<p>如果这些都不存在，说明请求在<strong>创建阶段</strong>就被拦截，ATS 仍然是主要怀疑对象。</p>
<hr/>
<h2 data-id="heading-5"><strong>在自有 App 中处理 ATS 的实际路径</strong></h2>
<p>在你有 App 控制权的前提下，ATS 的处理方式并不复杂，但需要明确修改位置。</p>
<h3 data-id="heading-6">常见操作路径</h3>
<ul>
<li>打开项目的 <code>Info.plist</code></li>
<li>检查 <code>NSAppTransportSecurity</code> 配置</li>
<li>确认是否存在以下项：
<ul>
<li><code>NSAllowsArbitraryLoads</code></li>
<li><code>NSExceptionDomains</code></li>
</ul>
</li>
</ul>
<p>修改完成后，重新构建并安装 App，再次触发网络请求。</p>
<p>这一步的验证标准很明确：
<strong>之前完全没有网络行为的请求，是否开始建立连接。</strong></p>
<hr/>
<h2 data-id="heading-7"><strong>ATS 放开后，如何确认 HTTPS 数据是否完整</strong></h2>
<p>当请求开始发出后，下一步是确认是否能抓到 HTTPS 数据。</p>
<p>如果代理工具能看到 App 请求并成功解密，说明：</p>
<ul>
<li>ATS 已不再阻断</li>
<li>HTTPS 校验允许中间人介入</li>
</ul>
<p>如果代理仍然抓不到，但数据层出现连接，可以切换抓包路径。</p>
<hr/>
<h2 data-id="heading-8"><strong>设备级抓包用于绕过代理路径限制</strong></h2>
<p>当 ATS 已放开，但 App 仍不走系统代理时，可以使用设备抓包工具。</p>
<h3 data-id="heading-9">使用抓包大师（Sniff Master）的设备抓包</h3>
<p>在 iOS 设备通过 USB 连接电脑的情况下：</p>
<ul>
<li>选择对应的 iOS 设备</li>
<li>按提示完成驱动与描述文件安装</li>
<li>进入 HTTPS 暴力抓包相关模式</li>
<li>启动抓包并触发 App 网络请求</li>
</ul>
<p>这一模式不依赖 Wi-Fi 代理，也不要求在手机上信任抓包证书。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/706a9441544b4795bec692e3c41aa0d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770796461&amp;x-signature=gyb5Mk54ICU40pHMsDZf6aOAzes%3D" alt="选择https暴力抓包" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-10"><strong>通过 App 级筛选减少干扰</strong></h2>
<p>设备级抓包会包含大量系统请求。</p>
<p>在抓包大师中：</p>
<ul>
<li>使用「选择 App」功能</li>
<li>仅保留目标应用的数据</li>
<li>再次触发请求</li>
</ul>
<p>这样可以快速定位业务接口，而不是在系统流量中手动筛选。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3ddc8663c8740c2b57d9a1cc8e9d2b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D5bCx5aW9MjAyNQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770796461&amp;x-signature=9xrP7ceOvf%2B%2BcNVtyb7HNyhdNPE%3D" alt="app选择" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-11"><strong>判断数据不完整的原因</strong></h2>
<p>在抓包结果中，如果出现以下现象：</p>
<ul>
<li>URL 与 Header 可见</li>
<li>请求体或响应体为空</li>
</ul>
<p>说明 HTTPS 已被捕获，但 App 并未使用 iOS 开发证书签名。</p>
<p>这类情况需要：</p>
<ul>
<li>获取 IPA</li>
<li>使用 iOS 开发证书重新签名</li>
<li>如 IPA 加密，先完成脱壳</li>
<li>安装重签后的 App</li>
<li>重新进行抓包</li>
</ul>
<p>完成后，数据即可完整显示。</p>
<hr/>
<h2 data-id="heading-12"><strong>拦截与修改的上限</strong></h2>
<p>需要明确的是：</p>
<ul>
<li><strong>请求 / 响应拦截器仅存在于代理抓包模式</strong></li>
<li>设备级 HTTPS 抓包只负责采集与解密</li>
<li>在需要修改请求或响应时，必须回到代理路径</li>
</ul>
<p>将这两类能力区分清楚，可以避免在错误模式下寻找不存在的功能。</p>
<p>参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.sniffmaster.net%2Ftutorial%2Fzh%2F2%2F2.html" target="_blank" title="https://www.sniffmaster.net/tutorial/zh/2/2.html" ref="nofollow noopener noreferrer">www.sniffmaster.net/tutorial/zh…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[译-从 RecyclerView 到 LazyColumn：Jetpack Compose 性能优化实战手册]]></title>    <link>https://juejin.cn/post/7602557444111876105</link>    <guid>https://juejin.cn/post/7602557444111876105</guid>    <pubDate>2026-02-04T06:00:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602557444111876105" data-draft-id="7602651160465391666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="译-从 RecyclerView 到 LazyColumn：Jetpack Compose 性能优化实战手册"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-04T06:00:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="simplepeng"/> <meta itemprop="url" content="https://juejin.cn/user/641770519265832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            译-从 RecyclerView 到 LazyColumn：Jetpack Compose 性能优化实战手册
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/641770519265832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    simplepeng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:00:20.000Z" title="Wed Feb 04 2026 06:00:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从 RecyclerView 到 LazyColumn：Jetpack Compose 性能优化实战手册</h2>
<p>When our team made the jump to Jetpack Compose, one thing immediately stood out — the simplicity of handling lists. No more wrestling with complex adapters, tricky cell updates, or manual diffing; just drop your items into a LazyColumn, add keys, and voilà — instant scrolling magic! But, as you might have guessed, reality isn’t always that straightforward. In this article, I’ll share how you can strategically transfer your hard earned RecyclerView optimization expertise directly into LazyColumn, ensuring maximum performance from day one.<br/>
当我们团队迁移到 Jetpack Compose 时，有一件事立刻显得很突出——处理列表的简洁性。不再需要与复杂的 adapter 折腾、处理棘手的单元格更新或手动 diff；只需把你的项放入 LazyColumn，添加 keys，然后瞧——即时流畅滚动的魔法！但正如你可能猜到的，现实并不总是那么简单。在本文中，我将分享如何将你在 RecyclerView 上辛苦积累的优化经验策略性地直接迁移到 LazyColumn 中，从第一天起就确保性能最大化。</p>
<p>So how exactly do RecyclerView’s battle -tested optimizations map onto LazyColumn’s new playing field? Let’s break it down technique by technique, examining what’s directly transferable, what’s improved, and what requires a fresh approach to achieve optimal Compose performance.<br/>
那么，RecyclerView 那些久经考验的优化策略到底如何映射到 LazyColumn 这个新阵地？让我们逐项拆解，检查哪些可以直接迁移、哪些已被改进、以及哪些需要采用新的方法来实现最佳的 Compose 性能。</p>
<h3 data-id="heading-1">Identity &amp; Content Checks: From DiffUtil to Compose Keys and Immutable Models  身份与内容检查：从 DiffUtil 到 Compose 的 key 与不可变模型</h3>
<p>In RecyclerView, optimizing the calculation of differences between lists relies heavily on three essential methods:<br/>
在 RecyclerView 中，优化列表差异计算在很大程度上依赖于三个基本方法：</p>
<ul>
<li><code>areItemsTheSame(oldItem, newItem)</code> – Checks if two items represent the same logical entity.<br/>
<code>areItemsTheSame(oldItem, newItem)</code> – 检查两个条目是否代表相同的逻辑实体。</li>
<li><code>areContentsTheSame(oldItem, newItem)</code> – Determines if the item's content has changed, prompting a UI refresh if necessary.<br/>
<code>areContentsTheSame(oldItem, newItem)</code> – 判断条目的内容是否发生变化，如有必要则触发 UI 刷新。</li>
<li><code>detectMoves</code> – An advanced optimization that speeds up diff calculations, especially beneficial when you know your dataset involves item movements.<br/>
<code>detectMoves</code> – 一种高级优化，加快差异计算速度，尤其在你知道数据集中包含项移动时特别有用。</li>
</ul>
<p>Jetpack Compose handles these same concepts elegantly. To inform Compose how to efficiently track individual items, you provide a stable key for each one:
Jetpack Compose 以优雅的方式处理了这些相同的概念。为了让 Compose 能够高效地追踪每个独立项，你需要为每一项提供一个稳定的标识键:</p>
<p>This <code>key</code> ensures that Compose can track the identity of items across recompositions - just like <code>areItemsTheSame</code>.
这个 <code>key</code> 确保 Compose 能在重组过程中跟踪项的身份 —— 就像 <code>areItemsTheSame</code> 一样。</p>
<p>Handling content updates (<code>areContentsTheSame</code>) is a bit different in Compose, as it leverages internal recomposition strategies. A good rule of thumb here is to always prefer immutable UI models - achieved easily by using the <code>@Immutable</code> annotation or defining data classes with val fields exclusively. Furthermore, starting from Compose compiler 2.x (bundled with Kotlin 2.0.20), Strong Skipping mode is enabled by default, providing automatic optimization and removing the need for manual handling of immutable collections.<br/>
在 Compose 中处理内容更新（ <code>areContentsTheSame</code> ）有些不同，因为它利用了内部的重组策略。一个好的经验法则是始终优先使用不可变的 UI 模型 —— 通过使用 <code>@Immutable</code> 注解或仅用 val 字段定义数据类可以轻松实现。此外，从随 Kotlin 2.0.20 捆绑的 Compose 编译器 2.x 开始，已默认启用 Strong Skipping 模式，提供自动优化，消除了对不可变集合手动处理的需求。</p>
<h3 data-id="heading-2">Asynchronous Text Layout: From PrecomputedText to TextMeasurer  异步文本布局：从 PrecomputedText 到 TextMeasurer</h3>
<p>RecyclerView veterans relied on PrecomputedText to shift expensive text-layout work onto a background thread before the view holder ever appeared on the screen. Jetpack Compose tackles this same challenge effectively through built-in paragraph caching and the TextMeasurer API. Let’s map these familiar techniques onto Compose’s new terrain step by step<br/>
RecyclerView 的老手们依赖 PrecomputedText 将昂贵的文本布局工作转移到后台线程，在视图持有者出现在屏幕之前就完成。Jetpack Compose 通过内置的段落缓存和 TextMeasurer API 有效地应对了同样的挑战。让我们一步步将这些熟悉的技术映射到 Compose 的新领域。</p>
<h4 data-id="heading-3">1. Paragraph caching (built-in optimization)  1. 段落缓存（内置优化）</h4>
<p>Every time you emit a Text composable, Compose caches a fully- laid -out <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2Ftext%2FParagraph%3Fref%3Dhackernoon.com" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/text/Paragraph?ref=hackernoon.com" ref="nofollow noopener noreferrer">Paragraph</a> within the current composition. As long as the text content, styling, density, and locale remain unchanged, Compose reuses this cached paragraph, avoiding unnecessary layout computations. This effectively reduces overhead for most intra-viewport updates and provides immediate performance gains without additional effort.<br/>
每次你发出一个 Text 可组合项时，Compose 会在当前组合中缓存一个已完全布局的 Paragraph。只要文本内容、样式、像素密度和区域设置保持不变，Compose 就会重用这个缓存的段落，从而避免不必要的布局计算。这有效地减少了大多数视口内更新的开销，并在无需额外努力的情况下带来即时的性能提升。</p>
<h4 data-id="heading-4">2. When it is time for big guns: Using TextMeasurer  2. 到需要大招的时候：使用 TextMeasurer</h4>
<p>For heavyweight or complex text scenarios (e.g., long paragraphs, variable fonts, or custom canvas drawing) where even occasional on-scroll layout recalculations are unacceptable, leverage the <code>TextMeasurer API</code> - think of it as the Compose counterpart to <code>PrecomputedText.create()</code>.<br/>
对于重量级或复杂的文本场景（例如长段落、可变字体或自定义画布绘制），在这些情况下即使偶尔在滚动时重新计算布局也不可接受，应当使用 <code>TextMeasurer API</code> —— 可以把它视为 Compose 中对应于 <code>PrecomputedText.create()</code> 的工具。</p>
<p>Benefits of using TextMeasurer:<br/>
使用 TextMeasurer 的好处：</p>
<ul>
<li><strong>Precise Layout Control</strong>: Pre-measuring text off-screen provides exact item heights before composable placement, preventing layout shifts during scrolling.<br/>
精确的布局控制：在屏幕外预先测量文本可以在可组合项放置之前提供精确的项高度，防止在滚动过程中发生布局位移。</li>
<li><strong>Dynamic Overflow Detection</strong>: Access properties like <code>layoutResult.hasVisualOverflow</code> to conditionally render UI elements such as "Read more" indicators.<br/>
动态溢出检测：访问诸如 <code>layoutResult.hasVisualOverflow</code> 的属性以有条件地呈现 UI 元素，例如“阅读更多”指示器。</li>
<li><strong>Enhanced Scroll Performance</strong>: By knowing exact item dimensions beforehand, <code>LazyColumn</code> calculates scroll positions more efficiently, ensuring smoother scrolling.<br/>
增强的滚动性能：通过事先知道精确的项尺寸， <code>LazyColumn</code> 能更高效地计算滚动位置，从而确保更流畅的滚动。</li>
</ul>
<p>However, introducing <code>TextMeasurer</code> increases complexity. You must:<br/>
然而，引入 <code>TextMeasurer</code> 会增加复杂性。您必须：</p>
<ul>
<li>Manage recomposition carefully, especially during configuration changes (e.g., font scale, screen orientation), requiring items to be re-measured appropriately.<br/>
谨慎管理重组，尤其是在配置更改（例如字体缩放、屏幕方向）期间，要求对项进行适当的重新测量。</li>
<li>Implement caching to avoid redundant measurements of identical content, preserving performance.<br/>
实现缓存以避免对相同内容进行重复测量，从而保持性能。</li>
</ul>
<p>TextMeasurer is particularly useful for:<br/>
TextMeasurer 对以下情况特别有用：</p>
<ul>
<li>Lists with variable-length text content<br/>
包含可变长度文本内容的列表</li>
<li>Chat applications or message lists<br/>
聊天应用或消息列表</li>
<li>Article or comment feeds 文章或评论提要</li>
<li>Any scenario where text length significantly varies between items<br/>
任何文本长度在各项之间显著变化的场景</li>
</ul>
<h3 data-id="heading-5">Importance of contentType  contentType 的重要性</h3>
<p>In RecyclerView, developers utilize view types (<code>getItemViewType()</code>) to efficiently handle multiple item layouts within a single list. Jetpack Compose introduces the equivalent optimization through the <code>contentType</code> parameter in <code>LazyColumn</code>.<br/>
在 RecyclerView 中，开发者使用视图类型 ( <code>getItemViewType()</code> ) 来在单个列表中高效处理多种项布局。Jetpack Compose 在 <code>LazyColumn</code> 的 <code>contentType</code> 参数中引入了等效的优化。</p>
<p>Here’s a way of how you’d express the RecyclerView view types in Jetpack Compose:<br/>
下面是在 Jetpack Compose 中表达 RecyclerView 视图类型的一种方式：</p>
<p><strong>Why it matters 为什么这很重要</strong></p>
<p>While Compose allows omission of the <code>contentType</code> parameter, leaving it out negatively impacts performance, particularly for lists with mixed item types. Compose maintains a limited composition cache per <code>contentType</code>, enabling it to efficiently reuse existing compositions for items of the same visual structure without expensive rebuilds. Without specifying distinct contentTypes, all items default to a single type, rapidly exhausting Compose’s internal cache. This forces frequent recompositions as users scroll, significantly increasing CPU load and potentially introducing noticeable scrolling lag.<br/>
虽然 Compose 允许省略 <code>contentType</code> 参数，但省略会对性能产生负面影响，尤其是在包含混合项类型的列表中。Compose 为每个 <code>contentType</code> 保留有限的组合缓存，使其能够高效地重用具有相同视觉结构的现有组合，避免代价高昂的重建。如果不指定不同的 contentTypes，所有项将默认为单一类型，从而迅速耗尽 Compose 的内部缓存。这会导致用户滚动时频繁重新组合，显著增加 CPU 负载，并可能引入明显的滚动卡顿。</p>
<p>For optimal performance in lists with heterogeneous content, always specify the appropriate <code>contentType</code> to match your data structure.<br/>
对于具有异构内容的列表，为了获得最佳性能，请始终指定与您的数据结构相匹配的适当 <code>contentType</code> 。</p>
<h4 data-id="heading-6">Nested List Prefetching: From initialPrefetchItemCount to nestedPrefetchItemCount  嵌套列表预取：从 initialPrefetchItemCount 到 nestedPrefetchItemCount</h4>
<p>When developing apps with nested scrolling lists — such as vertical feeds containing horizontal carousels — optimizing prefetching is crucial for maintaining a smooth user experience. In traditional RecyclerView setups, we rely on <code>setInitialPrefetchItemCount</code> to preload off-screen items. Jetpack Compose provides a direct analogue through the experimental <code>LazyListPrefetchStrategy</code> API, specifically its <code>nestedPrefetchItemCount</code> parameter.<br/>
在开发包含嵌套滚动列表的应用时——例如包含水平走马灯的垂直信息流——优化预取对于维持流畅的用户体验至关重要。在传统的 RecyclerView 方案中，我们依赖 <code>setInitialPrefetchItemCount</code> 来预加载屏幕外的项。Jetpack Compose 通过实验性的 <code>LazyListPrefetchStrategy</code> API 提供了直接对应的功能，特别是它的 <code>nestedPrefetchItemCount</code> 参数。</p>
<p>Here’s how you implement prefetching in a nested Compose list scenario:<br/>
下面是如何在嵌套的 Compose 列表场景中实现预取：</p>
<p>Common pitfall here (at least, the one that I saw with my own eyes) — sometimes developers set <code>LazyListPrefetchStrategy</code> to parent list and not to the nested ones, which, obviously, gains no effect. Always ensure you apply <code>nestedPrefetchItemCount</code> to the nested, inner scrolling list state to achieve the intended optimization.<br/>
这里常见的一个错误（至少是我亲眼见过的）——有时开发者将 <code>LazyListPrefetchStrategy</code> 设置在父列表上，而不是设置在嵌套列表上，这显然不会起作用。务必将 <code>nestedPrefetchItemCount</code> 应用于嵌套的、内部的滚动列表状态，以达到预期的优化效果。</p>
<p>Be mindful that aggressive prefetch settings can significantly inflate Compose’s composition cache. On memory-constrained devices, overly large prefetch counts can push your app toward OOM crashes. Always profile memory usage carefully after adjusting your prefetch budgets — especially if targeting low-end hardware.<br/>
请注意，激进的预取设置会显著增加 Compose 的组合缓存。在内存受限的设备上，过大的预取数量可能会将你的应用推向 OOM 崩溃。每次调整预取预算后都要仔细分析内存使用情况——尤其是在以低端硬件为目标时。</p>
<h3 data-id="heading-7">Bonus part — animating your lists  附加部分 — 列表动画</h3>
<p>And finally, let’s talk about animations. Compose 1.7 made adding smooth item animations surprisingly straightforward especially compared to custom RecyclerView ItemAnimators. Instead of manually orchestrating animations, simply use <code>Modifier.animateItem()</code> with concise specs for fades and movements:<br/>
最后，我们来谈谈动画。Compose 1.7 使得为项目添加流畅动画变得出奇地简单，尤其是相比自定义 RecyclerView ItemAnimators。你无需手动编排动画，只需使用 <code>Modifier.animateItem()</code> 并配以简明的淡入淡出和位移规范：</p>
<pre><code class="hljs language-c" lang="c">Modifier.animateItem(
    fadeInSpec = tween(<span class="hljs-number">200</span>),
    fadeOutSpec = tween(<span class="hljs-number">120</span>),
    placementSpec = spring(stiffness = Spring.StiffnessMediumLow)
)
</code></pre>
<p>This reduces complexity, enabling you to easily deliver polished and engaging UIs.<br/>
这样可以降低复杂性，使你更容易交付精致且吸引人的用户界面。</p>
<h3 data-id="heading-8">Conclusion 结论</h3>
<p>Jetpack Compose transforms Android UI development, simplifying many complexities that have challenged RecyclerView users. However, maximizing Compose’s potential still demands strategic insight and careful application of optimization techniques. By leveraging keys for identity checks, using immutable models to optimize recompositions, mastering the TextMeasurer API for efficient text handling, and applying correct prefetch strategies for nested lists, your performance skills from RecyclerView will significantly enhance your Compose applications. Embrace these methods, and you’ll ensure your UI remains fluid, responsive, and delightful for users — proving once again that foundational performance strategies never go out of style, they simply evolve.<br/>
Jetpack Compose 改变了 Android UI 开发，简化了许多曾让 RecyclerView 用户头疼的复杂问题。然而，要充分发挥 Compose 的潜力，仍然需要有策略的见解和对优化技术的谨慎应用。通过利用 keys 进行身份检查、使用不可变模型来优化重组、掌握 TextMeasurer API 以高效处理文本，以及为嵌套列表应用正确的预取策略，你在 RecyclerView 时积累的性能技能将显著提升你在 Compose 中的应用表现。采纳这些方法，你将确保你的 UI 保持流畅、响应迅速并让用户愉悦——再次证明基础的性能策略不会过时，它们只是不断演进。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java八股文面试重点完整版]]></title>    <link>https://juejin.cn/post/7602551091516915721</link>    <guid>https://juejin.cn/post/7602551091516915721</guid>    <pubDate>2026-02-04T05:37:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602551091516915721" data-draft-id="7602512226999697458" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java八股文面试重点完整版"/> <meta itemprop="keywords" content="后端,面试,Java"/> <meta itemprop="datePublished" content="2026-02-04T05:37:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java八股文面试重点完整版
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:37:25.000Z" title="Wed Feb 04 2026 05:37:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读25分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>面试十几家公司（小中大企业）总结的[Java八股文]，标记重点的一定要掌握，几乎50%概率会被问到。一直不推荐死记硬背，应该结合场景业务代码、手动画图加深理解，传承程序猿开源精神，现分享有需要的人。
**</p>
<p><strong>一，框架篇</strong>**</p>
<h4 data-id="heading-0"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1.Spring框架中的单例bean是线程安全的吗？</h4>
<p>       单例Bean 的线程安全性取决于 Bean 的具体实现。一般来说，在spring中的bean都是无状态（没有可修改的成员变量）的对象，就没有[线程安全问题，但如果在bean中定义了可修改的成员变量，是需要考虑线程安全问题的。</p>
<p>       我们可以加锁，使用synchronized关键字进行同步，保证同一时刻只有一个线程能访问该方法；也可以通过 @Lookup 注解设置bean为多例，每次请求都会创建一个bean实例，多个线程操作互不影响，但性能受损；</p>
<h4 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2.能介绍一下动态代理吗</h4>
<p>       动态代理是指在程序运行时通过反射机制自动生成代理对象，确保在不修改目标类的情况下，增强目标类的功能（类增强），Java提供了两种方式来实现动态代理：</p>
<p>       在SpringBoot2之前，Spring会根据目标对象的特性自动选择，比如目标类实现了至少一个接口默认使用JDK动态代理，如果没有实现接口就默认CGLIB代理；而SpringBoot2.2之后，统一使用CGLIB代理（无论目标类是否实现接口）</p>
<p>       JDK动态代理：基于接口的动态代理，只能代理实现了接口的类，创建代理对象速度快（直接根据接口生成字节码并由类加载器加载），方法调用较慢（需要通过Mehtod.invoke( )方法调用，反射方法相对较慢。说明：JDK6方法调用比CGLIB慢，但JDK7/8对反射调用做了优化，不比CGLIB慢）；</p>
<p>       CGLIB动态代理：基于类继承的动态代理，生成目标类的子类来实现代理，代理对象创建速度慢(使用ASM字节码生成目标类的子类)，方法调用快(直接覆盖目标方法，并在方法中插入拦截逻辑，没有走反射)；</p>
<p>动态代理提供了高度的灵活性和扩展性，但也带来了性能和复杂性，广泛应用于AOP、远程代理、Spring的依赖注入等场景。</p>
<h4 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.过滤器和拦截器有什么区别？</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f79618e3e62d4f6a9ef0e3fac44e4d4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=CuQKdewYcTna7jRs9grcC2%2Fjv%2B8%3D" alt="" loading="lazy"/></p>
<p>（1）过滤器是Servlet层面的，随Servlet容器启动初始化；拦截器是Spring框架的，随Spring容器启动初始化；</p>
<p>（2）过滤器在拦截器之前执行，可以处理所有的请求；而拦截器只能处理SpingMVC的Controller请求；</p>
<p>（3）过滤器操作更底层，一般处理跟业务无关的逻辑操作，比如请求/响应的全局编码设置；拦截器更贴近业务，比如用户登陆状态验证；</p>
<p>例子：过滤器设置请求编码 UTF-8</p>
<ol>
<li>@WebFilter("/*") // 拦截所有请求  </li>
<li><strong>public</strong> <strong>class</strong> EncodingFilter <strong>implements</strong> Filter {  </li>
<li>    @Override  </li>
<li>    <strong>public</strong> <strong>void</strong> doFilter(ServletRequest request, ServletResponse response, FilterChain chain)  </li>
<li>            <strong>throws</strong> IOException, ServletException {  </li>
<li>        // 设置编码  </li>
<li>        request.setCharacterEncoding("UTF-8");  </li>
<li>        response.setCharacterEncoding("UTF-8");  </li>
<li>  </li>
<li>        // 继续往下走  </li>
<li>        chain.doFilter(request, response);  </li>
<li>    }  </li>
<li>} </li>
</ol>
<p>例子：登录拦截器（未登录跳转到登录页）</p>
<ol>
<li><strong>public</strong> <strong>class</strong> LoginInterceptor <strong>implements</strong> HandlerInterceptor {  </li>
<li>   @Override  </li>
<li>    <strong>public</strong> <strong>boolean</strong> preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)  </li>
<li>            <strong>throws</strong> Exception {  </li>
<li>        // 假设 session 里有 loginUser 才表示登录  </li>
<li>        Object user = request.getSession().getAttribute("loginUser");  </li>
<li>        <strong>if</strong> (user == <strong>null</strong>) {  </li>
<li>            response.sendRedirect("/login"); // 跳转到登录页  </li>
<li>            <strong>return</strong> <strong>false</strong>; // 拦截  </li>
<li>        }  </li>
<li>        <strong>return</strong> <strong>true</strong>; // 放行  </li>
<li>    }  </li>
<li>} </li>
</ol>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.spring事务失效的场景有哪些？</h4>
<p>       事务底层是基于AOP实现的，而AOP是通过代理对象实现的。@Transactional注解的实现逻辑，可修饰类或方法：</p>
<p>（1）启动时扫描注解</p>
<p>当Spring容器启动时，TransactionAnnotationParser会扫描@Transactional注解，并将其解析为一个TransactionAttribute对象</p>
<p>（2）创建代理对象</p>
<p>Spring使用AOP为带有@Transactional的类生成代理对象，核心是TransactionInterceptor(事务拦截器）</p>
<p>（3）方法调用拦截</p>
<p>当外部调用代理对象的方法时，事务拦截器会拦截方法调用，拦截器通过TransactionManager来管理事务：判断当前是否存在事务，如果需要新建事务就调用begin( )方法，执行目标方法，方法执行成功则提交事务，异常时根据回滚规则决定是否回滚。</p>
<p>spring事务失效的场景如下：</p>
<p>（1）方法没有用public 修饰，代理默认只会拦截公共方法；</p>
<p>（2）同一个类中通过this来调用事务方法，这时候调用不会经过代理对象（事务的开启、提交、回滚等逻辑都是在代理对象的方法调用链中实现的，this是当前对象本身，不是代理对象）。解决方案：通过将自调用的方法提取到另一个服务类解决；</p>
<p>（3）事务注解标记在接口上而不是实现类上；</p>
<p>（4）自己手动捕获异常没有抛出，事务无法知悉</p>
<p>（5）事务默认只会回滚运行时异常和错误。发生受检查异常时事务无法回滚，可通过在catch中抛出RuntimeException异常；或者通过配置@Transactional(rollbackFor = Exception.class)设置回滚所有异常。</p>
<ol>
<li>@Service  </li>
<li><strong>public</strong> <strong>class</strong> OrderService {  </li>
<li>   </li>
<li>    @Autowired  </li>
<li>    <strong>private</strong> OrderRepository orderRepository;  </li>
<li>   </li>
<li>    @Transactional  </li>
<li>    <strong>public</strong> <strong>void</strong> updatePriceWrong(Long orderId) {  </li>
<li>        <strong>try</strong> {  </li>
<li>            // 更新数据库数据  </li>
<li>            orderRepository.updatePrice(orderId, 20);  </li>
<li>   </li>
<li>            // 抛出受检查异常  </li>
<li>            <strong>throw</strong> <strong>new</strong> IOException("模拟IO异常");  </li>
<li>        } <strong>catch</strong> (IOException e) {  </li>
<li>            // 手动捕获，但没有继续抛出  </li>
<li>            System.out.println("捕获异常: " + e.getMessage());  </li>
<li>        }  </li>
<li>        // 此时事务感知不到异常，最终数据会提交！  </li>
<li>    }  </li>
<li>}  </li>
</ol>
<h4 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.spring的IOC容器和bean的创建过程？</h4>
<p>IOC容器的创建过程为：</p>
<p>（1）读取配置文件：加载配置文件或配置类中的Bean定义；</p>
<p>（2）创建BeanFactory：初始化 DefaultListableBeanFactory 作为默认的Bean工厂，来管理 Bean的定义（BeanDefinition）和实例；</p>
<p>（3）解析BeanDefinition：Spring解析每个Bean，封装成BeanDefinition对象，存入BeanDefinitionMap中；</p>
<p>（4）注册BeanDefinition到BeanFactory中；</p>
<p>（5）创建单例Bean：ApplicationContext在容器刷新时就创建单例Bean</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cde59d263bf45d38dc9399ac312ec77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=i8%2BbRLJLAYxlc7q2gfKsn9AFHd4%3D" alt="" loading="lazy"/></p>
<p>（1）实例化：Spring容器启动时，根据XML配置文件或注解扫描来获取Bean的定义信息，通过反射调用构造函数来创建Bean实例；</p>
<p>（2）依赖注入：Spring容器根据Bean的配置，通过setter注入、字段注入或构造器注入进行依赖注入；</p>
<p>（3）初始化：Spring容器为每个Bean调用初始化方法，比如Aware接口回调、前置处理等；</p>
<p>（4）使用Bean：在容器中，Bean可以随时被获取和使用；</p>
<p>（5）销毁bean：当容器关闭时，Spring会调用Bean的销毁方法来销毁bean</p>
<blockquote>
<blockquote>
<p><strong>篇幅限制下面就只能给大家展示小册部分内容了。整理了一份核心面试笔记包括了：Java面试、Spring、JVM、MyBatis、Redis、MySQL、并发编程、微服务、Linux、Springboot、SpringCloud、MQ、Kafka 面试专题</strong></p>
<blockquote>
</blockquote>
<p><strong>需要全套面试笔记及答案【扫一扫】</strong>                         即可免费获取**</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c8b2fbf827c4bc3a36a4ecf2594f783~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=ZNvTYcwe5OnPdVt1oeJxu6OMXs8%3D" alt="8fbf1ef8b61e2dbbb33b7690a41d12e.png" loading="lazy"/></p>
</blockquote>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6.能说一下Spring中的循环引用吗，怎么解决</h4>
<p>       循环依赖就是两个或多个模块、类（Bean）、组件之间互相依赖，形成一个闭环。循环依赖在spring中是允许的，spring框架利用三级缓存能解决大部分的循环依赖，其关键就是要提前暴露未完全创建好的Bean。</p>
<p>       一级缓存（Singleton Objects Map），单例池，用来存储完全初始化好的单例Bean；二级缓存（Early Singleton Objects Map）：用来存储已经实例化但未完全初始化的Bean（用于提前暴露对象）；三级缓存（Singleton Factories Map）:用来存储对象工厂，可以通过工厂创建早期Bean（用于解决代理对象的创建）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/141f822381644aea86f8ae7f43120483~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=YENiQkRMbFXzjceJg2rgnEAtXa8%3D" alt="" loading="lazy"/></p>
<p>       一般的循环依赖，比如A和B对象通过setter注入形成循环依赖，首先创建A实例，将这个半成品A加入到二级缓存中，接着注入依赖B，从二级缓存中获取半成品A将B初始化， B创建成功，将B存储到单例池中，在单例池中将B注入给A，A创建成功，存储到单例池中；（但二级缓存不能解决代理对象，所以引入了三级缓存）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e17b98bce5ca4500b6d0822cd4b6b725~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=a2GUhAca2p6RQqWUgWJ9AgyJnto%3D" alt="" loading="lazy"/></p>
<p>       创建A实例，将对象A生成ObjectFactory对象放入到三级缓存中，接着注入B，发现B不存在，实例化B，B也生成ObjectFactory对象放入三级缓存，B从三级缓存中获取A对象工厂创建的代理对象，代理对象放入二级缓存中，将A的代理对象注入给B，B创建成功放入单例池，最后将B注入给A，A也创建成功放入单例池；</p>
<p>以上的方法有两种条件：1.依赖的Bean必须是单例；2.不是通过构造器注入依赖的。对于构造行循环依赖可以使用@Lazy 注解进行懒加载来实现。</p>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7.能说一下SpringMVC的执行流程吗？</h4>
<p>       SpringMVC 是Spring框架中用于构建Web应用程序的核心模块，以前端控制器为基础（类似于调度器），提供了一套灵活强大的组件来处理HTTP请求、业务逻辑和视图渲染</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecd8ef1b25f740bb971f25c13e46c6db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=fNPyjCw9%2FJLCRRALd405OVsCzeA%3D" alt="" loading="lazy"/></p>
<p>（1）发送请求：客户端发送请求，被前端控制器拦截，将请求发送给处理器映射器；</p>
<p>（2）处理器映射：处理器映射器根据URL找到对应的Controller类和方法；</p>
<p>（3）处理器适配：找到处理器后，前端控制器交给处理器适配器执行，处理器适配器处理参数，将请求参数绑定到方法参数或对象里</p>
<p>（4）调用处理器：处理器适配器通过反射调用Controller中的业务方法，返回对象数据；</p>
<p>（5）响应数据：将对象转化为JSON，返回给前端渲染页面；</p>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>8.[SpringBoot]的自动配置原理能说一下吗？</h4>
<p>       SprintBoot项目中的启动类上有一个注解@SpringBootApplication，这个注解封装@EnableAutoConfiguration注解：用来启动SpringBoot的自动配置机制，通过@Import 导入了 AutoConfigurationImportSelector <strong>，</strong> 在SpringBoot启动时，会扫描META-INF/ spring.factories文件（springboot2）/ AutoConfiguration.import（springboot3），文件里列出了所有自动配置类的路径位置，配置类通过各种@Conditional条件注解动态加载满足条件的bean，将其导入到Spring容器中；</p>
<p>常见的有：</p>
<ul>
<li>@ConditionalOnClass：某个类在 classpath 下才生效（比如 JdbcTemplate）。</li>
<li>@ConditionalOnMissingBean：如果用户没有自定义这个 Bean，才注入默认的 Bean。</li>
<li>@ConditionalOnProperty：配置文件中存在某个配置项时才生效。</li>
</ul>
<p>👉 这保证了 <strong>默认生效，但允许用户覆盖</strong>。</p>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>9.Spring中的常用注解有哪些？</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/030038dcf6e945d79ff9f5e4c7436f11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=6nGq%2F2045YEYg37%2B11omNpMsq08%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea35402f1d0b4cef9858ff3d1970fdcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=fSfM4TyGM97ZOoFrTVys3ilkUxo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e8a5e2ae1b546098312c5e8325be2d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=9hHZaEtVSRZo63kuweUkqs5Mqy4%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>10.Mybatis的执行流程？</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b43e8ac1d02b474690414431c0200393~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=hMzktBlaHKuUnZdKJbywbFhTrao%3D" alt="" loading="lazy"/></p>
<p>（1）配置加载阶段：解析Mybatis配置文件（如XML文件，或直接添加依赖，在 .yml 文件上配置Mybatis）根据配置文件创建会话工厂SqlSessionFactory；</p>
<p>（2）SQL执行阶段：通过会话工厂创建会话SqlSession实例（封装了JDBC操作，包含了执行SQL语句的方法）；通过动态代理生成Mapper接口的实例；通过Executor执行SQL语句：1.将Java对象属性转换为SQL参数，2.进行SQL解析，替换${ } 和 #{ }，生成最终的SQL执行，将结果转换为Java对象；</p>
<p>（3）释放资源阶段：Mybatis还提供了事务的管理，支持自动提交和手动控制事务；最后释放SqlSession对象资源，关闭数据库连接</p>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>11.spring的核心是什么？（重点）</h4>
<p>（1）依赖注入（Dependency Injection，DI）</p>
<p>依赖注入是 Spring 框架的核心功能之一，它是基于控制反转（IoC，Inversion of Control）来实现。传统的开发中，组件通常会显式地创建其依赖的对象，而在 Spring 中， IoC 容器负责管理对象的生命周期及其依赖关系。</p>
<p>简化开发：通过将对象的创建和管理交给 Spring 容器，开发者只需要关注业务逻辑，而无需手动创建和管理对象的实例。</p>
<p>解耦：对象之间的依赖关系由 Spring 容器管理，而不是硬编码在代码中，这样可以降低模块之间的耦合度，提高代码的灵活性和可测试性。</p>
<p>依赖注入方式：</p>
<ol>
<li>构造器注入：通过构造器传递依赖对象。</li>
<li>Setter 注入：通过 setter 方法注入依赖对象。</li>
<li>字段注入：直接在字段上使用注解来注入依赖。</li>
</ol>
<p>注意：官方推荐使用构造器注入的方式（因为依赖对象定义往往用final修饰，确保了依赖的不可变性和不为null，更加稳定），但企业中常用的是字段注入，更加方便；</p>
<ol>
<li>面向切面编程（Aspect-Oriented Programming，AOP）</li>
</ol>
<p>AOP称为面向切面编程，核心思想是将类中的公共行为（横切关注点）切割出来，封装为一个可重用的模块（切面类），在切面类中定义了切入点和通知。作用是减少系统中的重复代码，降低模块之间的耦合度，提高可维护性和可扩展性；</p>
<p>       而我在项目中也经常用到AOP，比如有很多数据库表都有一些公共字段（createTime, updateTime, createUser, updateUser），每次对这些表进行插入或修改操作都要更新这些公共字段，所以可以利用AOP封装一个模块，根据当前时间、用户ID对属性赋值，在mapper中添加注解就实现了公共字段的自动填充功能。</p>
<p>       而AOP在一些业务场景用的比较多的比如：记录操作日志、缓存处理等等。</p>
<p>（3）Spring 的 IoC 容器</p>
<p>IOC（Inversion of Control），控制反转，这是一种设计模式，核心思想是将对象的创建、依赖注入和生命周期管理交给IOC容器。在传统的编程方式中，我们一般需要在类中显示地创建依赖对象，通过硬编码方式来控制对象的创建和管理，而在Spring中，Bean以及对象之间的依赖关系都交给IOC容器负责，降低了代码之间的耦合度，也提高了系统的灵活性；</p>
<p>Spring中主要是通过XML配置和注解配置（@Component 、@Autowired、@Configuration）两种方式来注册Bean</p>
<p>例如：使用AOP給业务添加日志记录</p>
<ol>
<li>@Aspect    // 定义为切面类</li>
<li>@Component  </li>
<li><strong>public</strong> <strong>class</strong> LogAspect {  </li>
<li>  </li>
<li>    // 1. 切入点：拦截所有 service 包下的方法  </li>
<li>    @Pointcut("execution(* com.example.service.<em>.</em>(..))")  </li>
<li>    <strong>public</strong> <strong>void</strong> serviceMethods() {}  </li>
<li>  </li>
<li>    // 2. 前置通知：方法执行前记录  </li>
<li>    @Before("serviceMethods()")  </li>
<li>    <strong>public</strong> <strong>void</strong> beforeMethod(JoinPoint joinPoint) {  </li>
<li>        String methodName = joinPoint.getSignature().getName();  </li>
<li>        Object[] args = joinPoint.getArgs();  </li>
<li>        System.out.println("[前置日志] 正在调用方法：" + methodName + "，参数：" + Arrays.toString(args));  </li>
<li>    }  </li>
<li>  </li>
<li>    // 3. 后置通知：方法执行后记录  </li>
<li>    @AfterReturning(value = "serviceMethods()", returning = "result")  </li>
<li>    <strong>public</strong> <strong>void</strong> afterMethod(JoinPoint joinPoint, Object result) {  </li>
<li>        String methodName = joinPoint.getSignature().getName();  </li>
<li>        System.out.println("[后置日志] 方法：" + methodName + " 返回值：" + result);  </li>
<li>    }  </li>
<li>  </li>
<li>    // 4. 异常通知：出现异常时记录  </li>
<li>    @AfterThrowing(value = "serviceMethods()", throwing = "ex")  </li>
<li>    <strong>public</strong> <strong>void</strong> afterThrowingMethod(JoinPoint joinPoint, Exception ex) {  </li>
<li>        String methodName = joinPoint.getSignature().getName();  </li>
<li>        System.out.println("[异常日志] 方法：" + methodName + " 抛出了异常：" + ex.getMessage());  </li>
<li>    }  </li>
<li>}  </li>
</ol>
<blockquote>
<blockquote>
<p><strong>篇幅限制下面就只能给大家展示小册部分内容了。整理了一份核心面试笔记包括了：Java面试、Spring、JVM、MyBatis、Redis、MySQL、并发编程、微服务、Linux、Springboot、SpringCloud、MQ、Kafka 面试专题</strong></p>
<blockquote>
</blockquote>
<p><strong>需要全套面试笔记及答案【扫一扫】</strong>                         即可免费获取**</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c8b2fbf827c4bc3a36a4ecf2594f783~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=ZNvTYcwe5OnPdVt1oeJxu6OMXs8%3D" alt="8fbf1ef8b61e2dbbb33b7690a41d12e.png" loading="lazy"/></p>
</blockquote>
<h4 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>12. ObjectFactory 和 BeanFacotry的区别？</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e99fbe1b14f9480cb20019f0af147b25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=4uqGzNFbWLNdTMSt8xG7SvRy%2FQA%3D" alt="" loading="lazy"/></p>
<p>BeanFactory实际就是IOC容器，而ObjectFactory的作用如下：</p>
<p>（1）当需要推迟对象的创建来避免循环依赖或优化性能时，可以使用ObjectFactory</p>
<p>（2）在单例Bean中注入一个短作用域的Bean时，可以通过ObjectFactory确保获取最新的实例</p>
<h4 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>13.Spring Bean一共有几种作用域？</h4>
<p>       在注解配置@Scope或XML配置scope属性就可以设置Bean的作用域。</p>
<p>（1）singleton（默认），每个IOC容器仅存在一个实例，所有依赖注入共享同一个对象；</p>
<p>（2）prototype：每次注入依赖（或getBean( )方法）都会创建一个新实例；</p>
<p>（3）request：每个HTTP请求创建一个新实例，仅在Web应用中有效；</p>
<p>（4）session：每个HTTP Session创建一个实例，用户会话期间共享；</p>
<p>（5）application：每个ServletContext生命周期内一个实例；</p>
<p>（6）websocket：每个websocket会话一个实例，生命周期和websocket连接一致；</p>
<h4 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>14.Spring拦截链的实现？</h4>
<p>       在Spring框架中，拦截链通过责任链模式实现，核心目的是将多个拦截器（或通知）按顺序组织，在目标方法或请求处理的不同阶段依次触发：</p>
<p>       在Spring Web中，拦截器实现HandlerInterceptor接口，编写preHandel、postHandle、afterCompletion方法实现业务执行前后逻辑添加（如权限校验、日志记录），另外需要编写一个实现WebMvcConfigurer接口的配置类，注册拦截器，设置哪些路径需要拦截和放行，</p>
<p>执行步骤如下：</p>
<p>（1）初始化链：根据Hander（处理器/controller层）对应的URL和拦截器列表配置，创建处理器执行链；</p>
<p>（2）preHandel阶段：按拦截器配置顺序依次调用preHandle方法。如果某个拦截器返回false，终止后续拦截器和handler的执行；</p>
<p>（3）执行handler：调用Controller方法处理请求；</p>
<p>（4）postHandler阶段：按拦截器配置的逆序调用postHandle( );</p>
<p>（5）渲染视图：处理ModelAndView，生成相应内容；</p>
<p>（6）afterCompletion阶段：无论请求成功或异常，按拦截器配置的逆序调用afterCompletion方法</p>
<p><strong>✅ 1.</strong> <strong>编写拦截器类</strong></p>
<ol>
<li><strong>import</strong> org.springframework.stereotype.Component;  </li>
<li><strong>import</strong> org.springframework.web.servlet.HandlerInterceptor;  </li>
<li><strong>import</strong> javax.servlet.http.HttpServletRequest;  </li>
<li><strong>import</strong> javax.servlet.http.HttpServletResponse;  </li>
<li>  </li>
<li>@Component  </li>
<li><strong>public</strong> <strong>class</strong> LogInterceptor <strong>implements</strong> HandlerInterceptor {  </li>
<li>  </li>
<li>    /** </li>
<li>     * 在请求处理之前执行（Controller方法调用前） </li>
<li>     * @return true 表示继续流程，false 表示拦截请求 </li>
<li>     */  </li>
<li>    @Override  </li>
<li>    <strong>public</strong> <strong>boolean</strong> preHandle(HttpServletRequest request,  </li>
<li>                             HttpServletResponse response,  </li>
<li>                             Object handler) <strong>throws</strong> Exception {  </li>
<li>        String uri = request.getRequestURI();  </li>
<li>        System.out.println("拦截器日志：请求 URI 为：" + uri);  </li>
<li>        <strong>return</strong> <strong>true</strong>;  </li>
<li>    }  </li>
<li>  </li>
<li>    /** </li>
<li>     * 请求处理之后执行（Controller方法调用之后） </li>
<li>     */  </li>
<li>    @Override  </li>
<li>    <strong>public</strong> <strong>void</strong> postHandle(HttpServletRequest request,  </li>
<li>                           HttpServletResponse response,  </li>
<li>                           Object handler,  </li>
<li>                           org.springframework.web.servlet.ModelAndView modelAndView) <strong>throws</strong> Exception {  </li>
<li>        System.out.println("拦截器日志：请求处理完成（postHandle）");  </li>
<li>    }  </li>
<li>  </li>
<li>    /** </li>
<li>     * 请求完全完成之后执行（包括视图渲染后） </li>
<li>     */  </li>
<li>    @Override  </li>
<li>    <strong>public</strong> <strong>void</strong> afterCompletion(HttpServletRequest request,  </li>
<li>                                HttpServletResponse response,  </li>
<li>                                Object handler,  </li>
<li>                                Exception ex) <strong>throws</strong> Exception {  </li>
<li>        System.out.println("拦截器日志：请求完全结束（afterCompletion）");  </li>
<li>    }  </li>
<li>}  </li>
</ol>
<p><strong>✅ 2.</strong> <strong>注册拦截器（配置类）</strong></p>
<ol>
<li><strong>import</strong> org.springframework.beans.factory.annotation.Autowired;  </li>
<li><strong>import</strong> org.springframework.context.annotation.Configuration;  </li>
<li><strong>import</strong> org.springframework.web.servlet.config.annotation.InterceptorRegistry;  </li>
<li><strong>import</strong> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;  </li>
<li>  </li>
<li>@Configuration  // Spring MVC 配置类  </li>
<li><strong>public</strong> <strong>class</strong> WebConfig <strong>implements</strong> WebMvcConfigurer {  </li>
<li>  </li>
<li>    @Autowired  </li>
<li>    <strong>private</strong> LogInterceptor logInterceptor;  </li>
<li>  </li>
<li>    @Override  </li>
<li>    <strong>public</strong> <strong>void</strong> addInterceptors(InterceptorRegistry registry) {  </li>
<li>        registry.addInterceptor(logInterceptor)       // 注册拦截器  </li>
<li>                .addPathPatterns("/**")          // 拦截所有请求路径  </li>
<li>                .excludePathPatterns("/login", "/error"); // 排除某些路径  </li>
<li>    }  </li>
<li>}  </li>
</ol>
<h4 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>15.spring用到了哪些设计模式？</h4>
<p>（1）工厂模式：BeanFactory和ApplicationContext是Spring的核心容器，负责创建和管理Bean实例；</p>
<p>（2）单例模式：Spring默认将Bean的作用域设置为单例，保证容器中只有一个实例；</p>
<p>（3）代理模式：Spring AOP使用动态代理生成代理对象增强类；</p>
<p>（4）模板方法模式：jdbcTemplate、RestTemplate等模板类封装了固定流程，用户只需实现具体逻辑（SQL执行、HTTP请求）；</p>
<p>（5）适配器模式：在SpringMVC中适配不同类型的控制器</p>
<h4 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>16. Spring Bean注册到容器的方式有哪些？</h4>
<p>（1）基于XML配置文件，显示声明Bean的类和依赖关系；</p>
<p>（2）基于注解扫描注册，通过@Component、@Service、@Controller注解定义为Bean，通过组件扫描（@ComponentScan）注册为Bean</p>
<p>（3）基于Java配置类注册，在@Configuration注解的类中的方法添加@Bean注解；</p>
<h4 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>17. <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">@Qualifier</a>注解有什么作用？</h4>
<p>       @Qualifier注解用于解决依赖注入的歧义性问题，当容器中存在多个相同类型的Bean时，@Autowired注解无法自动选择具体的Bean注入，此时需要配合@Qualifier来指定具体的Bean名称。</p>
<p>       @Qualifier注解和@Primary注解的区别：@Primary用来标记某个Bean为默认优先注入的候选者，而@Qualifier用来显示指定具体Bean的名称；</p>
<ol>
<li>@Component  </li>
<li><strong>public</strong> <strong>class</strong> UserService {  </li>
<li>  </li>
<li>    @Autowired  </li>
<li>    @Qualifier("mysqlUserRepository") // 精确指定注入哪个 Bean  </li>
<li>    <strong>private</strong> UserRepository userRepository;  </li>
<li>} </li>
</ol>
<h4 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>18. @Bean和@Component有什么区别？</h4>
<p>（1）作用目标：@Component注解作用在类上；@Bean注解作用在方法上，一般在配置类；</p>
<p>（2）使用场景：@Service、@Controller等注解都是@Component的特化形式，一般用于自己编写的类；而@Bean一般用于第三方库的类或需要手动控制实例化的对象；</p>
<p>（3）使用方式：@Component标记一个类，让Spring自动扫描并创建Bean；@Bean需要显示地配置和创建，返回一个对象作为Bean</p>
<h4 data-id="heading-18"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>19. @Component、@Controller、@Repository、@Service注解的区别是什么？</h4>
<p>（1）@Component是它们的通用注解，标记任意类为Bean，没有特定的功能，是其他注解的元注解；</p>
<p>（2）@Controller用于标记控制层，处理HTTP请求，支持请求URL映射；</p>
<p>（3）@Service用于标记业务类，没有额外功能，区分职责提高代码可读性；</p>
<p>（4）@Repository用于标记持久层，自动转换数据访问异常</p>
<h4 data-id="heading-19"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>20.spring启动过程？</h4>
<p>（1）容器初始化：调用Application.run( )方法启动应用，创建ApplicationContext；</p>
<p>（2）配置加载：解析配置类、扫描组件、注册Bean的定义；</p>
<p>（3）Bean实例化和依赖注入：根据Bean的定义创建对象并注入依赖；</p>
<p>（4）扩展处理：在Bean初始化前后插入逻辑（如AOP代理），实现生命周期回调增强功能；</p>
<p>（5）容器就绪：完成启动，通过事件机制实现扩展点</p>
<h4 data-id="heading-20"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>21. springBoot启动过程？</h4>
<p>（1）初始化：调用Application.run( )方法启动应用，加载配置器和监听器；</p>
<p>（2）准备环境：加载配置文件（如application.properties）</p>
<p>（3）创建ApplicationContext：初始化容器；</p>
<p>（4）刷新容器：加载Bean定义、执行自动配置、启动内嵌容器、Bean的依赖注入初始化；</p>
<p>（5）执行自定义执行后逻辑；</p>
<p>（6）发布 ApplicationReadyEvent：标志应用完全就绪</p>
<h4 data-id="heading-21"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>22. application.properties和application.yml和application.ymal有什么区别？</h4>
<p>（1）语法格式：.properties文件使用键值对格式，通过 . 表示层级关系；yml和ymal文件基于YAML格式，使用换行缩进表示层级关系，可读性更高；</p>
<p>（2）加载顺序：同目录下，.properties 文件的优先级高于 .yml/.yaml ; 不同目录下，按目录优先级覆盖（例如根目录的配置覆盖类路径的配置）</p>
<p>（3）复杂数据结构：.properties文件对于列表需要逗号隔开，对象之间需要手动拆分；yml和ymal文件对于多个对象只需要换行，对于列表只需要换行加短横线，操作更加方便；</p>
<p>示例：application.properties</p>
<ol>
<li># 普通字符串  </li>
<li>app.name=DemoApp  </li>
<li>  </li>
<li># 列表  </li>
<li>app.servers=192.168.1.1,192.168.1.2,192.168.1.3  </li>
<li>  </li>
<li># 嵌套对象  </li>
<li>app.datasource.url=jdbc:mysql://localhost:3306/test  </li>
<li>app.datasource.username=root  </li>
<li>app.datasource.password=123456  </li>
</ol>
<p>示例：application.yml</p>
<ol>
<li>app:  </li>
<li>  name: DemoApp  </li>
<li>  servers:  </li>
<li>    - 192.168.1.1  </li>
<li>    - 192.168.1.2  </li>
<li>    - 192.168.1.3  </li>
<li>  </li>
<li>  datasource:  </li>
<li>    url: jdbc:mysql://localhost:3306/test  </li>
<li>    username: root  </li>
<li>    password: 123456  </li>
</ol>
<blockquote>
<blockquote>
<p><strong>篇幅限制下面就只能给大家展示小册部分内容了。整理了一份核心面试笔记包括了：Java面试、Spring、JVM、MyBatis、Redis、MySQL、并发编程、微服务、Linux、Springboot、SpringCloud、MQ、Kafka 面试专题</strong></p>
<blockquote>
</blockquote>
<p><strong>需要全套面试笔记及答案【扫一扫】</strong>                         即可免费获取**</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c8b2fbf827c4bc3a36a4ecf2594f783~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=ZNvTYcwe5OnPdVt1oeJxu6OMXs8%3D" alt="8fbf1ef8b61e2dbbb33b7690a41d12e.png" loading="lazy"/></p>
</blockquote>
<h4 data-id="heading-22"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>23.能说一下SpringBoot吗？</h4>
<p>SpringBoot是一个基于Spring框架的开源工具，旨在简化Java应用（尤其是Web应用）的初始搭建和开发过程。通过“约定优于配置”的理念，大幅度减少传统Spring开发中的复杂配置，让开发者能快速构建独立运行、生产级的应用。</p>
<p>说明：传统的Spring需要大量的XML或@Bean配置，而Spring Boot内置了一套默认的约定，如果没有提供配置，Spring Boot就会按照“约定”的默认逻辑工作，只有当你的需求不同于默认约定时，才需要额外配置。比如，在pom.xml引入spring-boot-starter-data-jpa依赖，SpringBoot自动创建DataSource的Bean，默认使用application.yml中的配置。</p>
<p>它的特性如下：</p>
<p>（1）[自动配置]：SpringBoot根据@EnableAutoConfiguration注解开启自动配置机制，扫描AutoConfiguration.imports文件根据条件动态加载预定义的配置类；传统的Spring需要手动编写配置类，显示定义dataSource等一些Bean。</p>
<p>（2）起步依赖：通过预定义集成的依赖包（一系列Starter），自动引入所有相关依赖包，避免版本冲突；传统的Spring需要手动指定每个依赖及其兼容版本；</p>
<p>（3）内嵌服务器：添加spring-boot-starter-web依赖后，就会内嵌Tomcat、SpringMVC服务器，应用可直接打包为可执行JAR包，无需额外部署到web服务器；传统的Spring需要打包为WAR包，部署到独立的Tomcat服务器；</p>
<p>（4）生产就绪功能：SpringBoot提供监控和管理端点（如健康检查、性能指标），方便运维；传统的Spring需要自行配置健康检查、指标收集等；</p>
<p>（5）简化配置：约定优于配置原则，默认提供合理的配置参数（如端口号、数据库连接池参数）和创建默认配置类，可通过properties文件或yml文件做修改覆盖；</p>
<h4 data-id="heading-23"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>24. 说一下Mybatis的缓存机制？</h4>
<p>       Mybatis的缓存机制分为一级缓存（本地缓存）和二级缓存（全局缓存），通过缓存减少数据库查询次数来提升性能；</p>
<p>（1）一级缓存仅在同一个SqlSession中生效（默认开启），生命周期与Sqlsession绑定，会话结束或执行写操作时、事务提交回滚缓存都会失效；</p>
<p>（2）二级缓存在同一个Mapper中生效，多个SqlSession共享缓存（需手动开启，在对应XML 文件中添加  标签），生命周期跟SqlsessionFactory一致</p>
<p>       开启二级缓存后，查询时会先查一级缓存，未命中则查二级缓存，如果二级缓存也未命中就访问数据库，并将结果存入一级和二级缓存；需要注解一级和二级缓存都可能导致脏读，频繁修改的数据不适合开启二级缓存。</p>
<h4 data-id="heading-24"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>25. Mybatis和Hibernate有什么区别？</h4>
<p>（1）对象关系映射：Hibernate完全将数据库表映射为Java对象，开发者几乎无需手动编写SQL，他自动生成SQL；Mybatis中需要手动编写SQL，通过XML或注解将SQL映射到Java方法中；</p>
<p>（2）SQL控制权：Hibernate自动生成SQL，开发者无法直接干预，可能会生成冗余SQL，性能较差；Mybatis中开发者完全控制SQL，需要自行维护SQL；</p>
<p>（3）性能：Hibernate内置强大的一级缓存和二级缓存减少数据库访问，适合读多写少场景；Mybatis手动编写高效SQL，避免不必要的查询，适合高性能场景；</p>
<p>Hibernate 配置（hibernate.cfg.xml）</p>
<ol>
<li>

</li>
<li>        "-//Hibernate/Hibernate Configuration DTD 3.0//EN"  </li>
<li>        </li>
<li>  </li>
<li>      </li>
<li>        &lt;property name="hibernate.connection.driver_class"&gt;com.mysql.jdbc.Driver  </li>
<li>        &lt;property name="hibernate.connection.url"&gt;jdbc:mysql://localhost:3306/testdb  </li>
<li>        &lt;property name="hibernate.connection.username"&gt;root  </li>
<li>        &lt;property name="hibernate.connection.password"&gt;root  </li>
<li>        &lt;property name="hibernate.dialect"&gt;org.hibernate.dialect.MySQLDialect  </li>
<li>        &lt;property name="hibernate.hbm2ddl.auto"&gt;update   </li>
<li>        &lt;mapping <strong>class</strong>="User"/&gt;  </li>
<li>      </li>
<li>  </li>
</ol>
<p>保存数据的代码</p>
<ol>
<li><strong>public</strong> <strong>class</strong> HibernateTest {  </li>
<li>    <strong>public</strong> <strong>static</strong> <strong>void</strong> main(String[] args) {  </li>
<li>        // 加载配置文件  </li>
<li>        Configuration cfg = <strong>new</strong> Configuration().configure();  </li>
<li>        SessionFactory sessionFactory = cfg.buildSessionFactory();  </li>
<li>  </li>
<li>        // 打开会话  </li>
<li>        Session session = sessionFactory.openSession();  </li>
<li>        session.beginTransaction();  </li>
<li>  </li>
<li>        // 创建对象  </li>
<li>        User user = <strong>new</strong> User();  </li>
<li>        user.setId(1);  </li>
<li>        user.setUsername("admin");  </li>
<li>        user.setPassword("123456");  </li>
<li>  </li>
<li>        // 保存对象  </li>
<li>        session.save(user);  </li>
<li>  </li>
<li>        // 提交事务  </li>
<li>        session.getTransaction().commit();  </li>
<li>  </li>
<li>        // 关闭会话  </li>
<li>        session.close();  </li>
<li>        sessionFactory.close();  </li>
<li>    }  </li>
<li>}  </li>
</ol>
<h4 data-id="heading-25"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>26.能说一下全局异常捕获嘛？</h4>
<p>说明：受检查异常和运行时异常</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc88093c40c14382b089fd6454cf2e10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790935&amp;x-signature=cDao3bWOwjNp%2FRWtS8Zmjun8VgU%3D" alt="" loading="lazy"/></p>
<p>1.受检查异常</p>
<p>在编译阶段，Javac编译器会强制检查方法中是否显示地处理这些异常，如果没有使用try-catch捕获或没有通过throws向上抛出，编译就会报错。这种异常一般是外部资源或环境问题引起的，这样做的目的是提醒开发者写代码时考虑这些异常情况。</p>
<ol>
<li><strong>public</strong> <strong>void</strong> readFile(String path) throws IOException {  </li>
<li>    FileReader fr = <strong>new</strong> FileReader(path);  // 可能抛出 IOException  </li>
<li>    BufferedReader br = <strong>new</strong> BufferedReader(fr);  </li>
<li>    String line = br.readLine();  </li>
<li>}  </li>
</ol>
<p>如果不写 throws IOException 或 try-catch，编译就过不了。</p>
<p>受检查异常常见例子：</p>
<p>IOException：文件不存在、读写失败</p>
<p>SQLException：数据库连接失败、SQL 执行错误</p>
<p>ClassNotFoundException：类加载失败</p>
<p>InterruptedException：线程被中断</p>
<p>2.运行时异常</p>
<p>继承了RuntimeException，在运行阶段才会被发现，编译器不会强制要求处理，通常是编程错误或逻辑缺陷导致的。</p>
<p>运行时异常常见例子：</p>
<p>NullPointerException（空指针）</p>
<p>ArrayIndexOutOfBoundsException（数组越界）</p>
<p>ArithmeticException（除以 0）</p>
<p>ClassCastException（类型转换错误）</p>
<p>如何实现全局异常捕获，方法如下：</p>
<p>首先使用@ControllerAdvice注解将类注册为一个全局异常处理器组件，作用范围是所有的控制层；在SpringMVC的请求处理链中有一个关键接口HandleExceptionResolver（处理异常解析器），所有实现了该接口的类在出现异常时会依次调用该接口，将异常转化为响应；</p>
<ol>
<li><strong>public</strong> <strong>interface</strong> HandlerExceptionResolver {  </li>
<li>    ModelAndView resolveException(HttpServletRequest request,  </li>
<li>                                  HttpServletResponse response,  </li>
<li>                                  Object handler,  </li>
<li>                                  Exception ex);  </li>
<li>}  </li>
</ol>
<p>步骤如下：1、控制层抛出异常；2、Spring捕获异常后，调用HandlerExceptionResolverComposite（处理异常解析器组合）；3、遍历所有注册的HandleExceptionResolver实例（例如ExceptionHandleExceptionResolver）；4、ExceptionHandleExceptionResolver查找对应的@ExceptionHandler方法；5、匹配成功后执行该方法，返回结果；</p>
<ol>
<li><strong>import</strong> org.springframework.web.bind.annotation.ExceptionHandler;  </li>
<li><strong>import</strong> org.springframework.web.bind.annotation.RestControllerAdvice;</li>
<li><strong>import</strong> org.springframework.web.method.annotation.MethodArgumentTypeMismatchException;  </li>
<li><strong>import</strong> org.springframework.http.converter.HttpMessageNotReadableException;  </li>
<li>  </li>
<li>@RestControllerAdvice  // 等价于 @ControllerAdvice + @ResponseBody  </li>
<li><strong>public</strong> <strong>class</strong> GlobalExceptionHandler {  </li>
<li>  </li>
<li>    /** </li>
<li>     * 处理自定义业务异常 </li>
<li>     */  </li>
<li>    @ExceptionHandler(BusinessException.<strong>class</strong>)  </li>
<li>    <strong>public</strong> Result&lt;?&gt; handleBusinessException(BusinessException ex) {</li>
<li>        <strong>return</strong> Result.fail("业务异常：" + ex.getMessage());  </li>
<li>    }  </li>
<li>  </li>
<li>    /** </li>
<li>     * 参数类型不匹配 </li>
<li>     */  </li>
<li>    @ExceptionHandler(MethodArgumentTypeMismatchException.<strong>class</strong>)  </li>
<li>    <strong>public</strong> Result&lt;?&gt; handleTypeMismatch(MethodArgumentTypeMismatchException ex) {  </li>
<li>        <strong>return</strong> Result.fail("参数类型错误：" + ex.getMessage());  </li>
<li>    }  </li>
<li>  </li>
<li>    /** </li>
<li>     * 请求体解析错误 </li>
<li>     */  </li>
<li>    @ExceptionHandler(HttpMessageNotReadableException.<strong>class</strong>)  </li>
<li>    <strong>public</strong> Result&lt;?&gt; handleMessageNotReadable(HttpMessageNotReadableException ex) {  </li>
<li>        <strong>return</strong> Result.fail("请求参数格式错误");  </li>
<li>    }  </li>
<li>  </li>
<li>    /** </li>
<li>     * 捕获所有其他异常 </li>
<li>     */  </li>
<li>    @ExceptionHandler(Exception.<strong>class</strong>)  </li>
<li>    <strong>public</strong> Result&lt;?&gt; handleOtherException(Exception ex) {  </li>
<li>        ex.printStackTrace();  // 可记录日志  </li>
<li>        <strong>return</strong> Result.fail("服务器内部错误：" + ex.getMessage());  </li>
<li>    }  </li>
<li>}</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WebSocket 实战指南：从基础到高可用架构]]></title>    <link>https://juejin.cn/post/7602559134575558692</link>    <guid>https://juejin.cn/post/7602559134575558692</guid>    <pubDate>2026-02-04T05:53:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602559134575558692" data-draft-id="7602529888483786815" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WebSocket 实战指南：从基础到高可用架构"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-04T05:53:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="好名字_技术分享"/> <meta itemprop="url" content="https://juejin.cn/user/1101056944119610"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WebSocket 实战指南：从基础到高可用架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1101056944119610/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    好名字_技术分享
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:53:20.000Z" title="Wed Feb 04 2026 05:53:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    20
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">WebSocket 实战指南：从基础到高可用架构</h2>
<p>WebSocket是一种在单个TCP连接上进行全双工通信的协议，它实现了浏览器和服务器之间的实时数据交换。相比HTTP轮询，WebSocket提供了更低的延迟和更高的效率。本文将从基础概念到生产环境部署，全面介绍WebSocket的使用。</p>
<h3 data-id="heading-1">WebSocket 基础概念</h3>
<h4 data-id="heading-2">为什么需要WebSocket？</h4>
<p>传统的HTTP协议有以下局限：</p>
<ul>
<li><strong>单向通信</strong>：服务器只能主动推送，客户端不能主动发送</li>
<li><strong>高延迟</strong>：需要频繁建立HTTP连接，开销大</li>
<li><strong>资源消耗</strong>：长轮询会占用大量服务器资源</li>
</ul>
<p>WebSocket解决了这些问题，提供了一次握手后的持久化连接。</p>
<h4 data-id="heading-3">握手过程</h4>
<p>WebSocket通过HTTP升级请求建立连接：</p>
<pre><code class="hljs language-http" lang="http">GET /chat HTTP/1.1
Host: example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsbGzZSBtIQ==
Sec-WebSocket-Version: 13
Sec-WebSocket-Protocol: chat
</code></pre>
<p>服务器响应：</p>
<pre><code class="hljs language-http" lang="http">HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGhzh/UBbPzwXgqCIubKHe36
</code></pre>
<h3 data-id="heading-4">Python中的WebSocket实现</h3>
<h4 data-id="heading-5">1. websockets库 - 最简单的选择</h4>
<p><code>websockets</code>是一个纯Python实现的WebSocket客户端和服务器，API简洁易用。</p>
<h5 data-id="heading-6">安装</h5>
<pre><code class="hljs language-bash" lang="bash">pip install websockets
</code></pre>
<h5 data-id="heading-7">服务器端实现</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> websockets

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_connection</span>(<span class="hljs-params">websocket, path</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"New connection: <span class="hljs-subst">{websocket.remote_address}</span>"</span>)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> websocket:
            <span class="hljs-keyword">await</span> websocket.send(<span class="hljs-string">f"Echo: <span class="hljs-subst">{message}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Received: <span class="hljs-subst">{message}</span>"</span>)
    <span class="hljs-keyword">except</span> websockets.exceptions.ConnectionClosed:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Connection closed"</span>)

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> websockets.serve(handle_connection, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">8765</span>) <span class="hljs-keyword">as</span> server:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Server running on ws://localhost:8765"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<h4 data-id="heading-8">2. FastAPI + WebSockets - 生产级方案</h4>
<p>对于生产环境，推荐使用FastAPI框架配合<code>websockets</code>库。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, WebSocket
<span class="hljs-keyword">from</span> fastapi.middleware.cors <span class="hljs-keyword">import</span> CORSMiddleware
<span class="hljs-keyword">import</span> uvicorn
<span class="hljs-keyword">import</span> websockets

app = FastAPI()
app.add_middleware(
    CORSMiddleware,
    allow_origins=[<span class="hljs-string">"*"</span>],
    allow_credentials=<span class="hljs-literal">True</span>,
    allow_methods=[<span class="hljs-string">"*"</span>],
    allow_headers=[<span class="hljs-string">"*"</span>],
)

<span class="hljs-meta">@app.websocket(<span class="hljs-params"><span class="hljs-string">"/ws/{client_id}"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">websocket_endpoint</span>(<span class="hljs-params">websocket: WebSocket, client_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Client <span class="hljs-subst">{client_id}</span> connected"</span>)
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            data = <span class="hljs-keyword">await</span> websocket.receive_text()
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Received from <span class="hljs-subst">{client_id}</span>: <span class="hljs-subst">{data}</span>"</span>)
            <span class="hljs-comment"># 广播给所有客户端</span>
            <span class="hljs-keyword">await</span> websocket_manager.broadcast(data)
    <span class="hljs-keyword">except</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Client <span class="hljs-subst">{client_id}</span> disconnected"</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionManager</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.active_connections: <span class="hljs-built_in">list</span>[WebSocket] = []
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params">self, websocket: WebSocket</span>):
        self.active_connections.append(websocket)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">disconnect</span>(<span class="hljs-params">self, websocket: WebSocket</span>):
        self.active_connections.remove(websocket)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">broadcast</span>(<span class="hljs-params">self, message: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-keyword">for</span> connection <span class="hljs-keyword">in</span> self.active_connections:
            <span class="hljs-keyword">await</span> connection.send_text(message)

websocket_manager = ConnectionManager()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    uvicorn.run(app, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8000</span>)
</code></pre>
<h3 data-id="heading-9">实战应用：实时聊天系统</h3>
<h4 data-id="heading-10">前端代码</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>WebSocket Chat<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"message"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"输入消息..."</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"sendMessage()"</span>&gt;</span>发送<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"chat"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> ws = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">'ws://localhost:8000/ws/user1'</span>);
        
        ws.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Connected to server'</span>);
        };
        
        ws.<span class="hljs-property">onmessage</span> = <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> chat = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'chat'</span>);
            <span class="hljs-keyword">const</span> msg = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
            msg.<span class="hljs-property">textContent</span> = event.<span class="hljs-property">data</span>;
            chat.<span class="hljs-title function_">appendChild</span>(msg);
            chat.<span class="hljs-property">scrollTop</span> = chat.<span class="hljs-property">scrollHeight</span>;
        };
        
        ws.<span class="hljs-property">onerror</span> = <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'WebSocket error:'</span>, error);
        };
        
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'message'</span>);
            ws.<span class="hljs-title function_">send</span>(input.<span class="hljs-property">value</span>);
            input.<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-11">心跳机制</h4>
<p>生产环境中，连接可能因为网络波动断开。实现心跳重连机制：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> ws = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">let</span> reconnectAttempts = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_RETRIES</span> = <span class="hljs-number">5</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params"/>) {
    ws = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">'ws://localhost:8000/ws/user1'</span>);
    
    ws.<span class="hljs-property">onopen</span> = <span class="hljs-function">() =&gt;</span> {
        reconnectAttempts = <span class="hljs-number">0</span>;
        <span class="hljs-title function_">startHeartbeat</span>();
    };
    
    ws.<span class="hljs-property">onerror</span> = <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (reconnectAttempts &lt; <span class="hljs-variable constant_">MAX_RETRIES</span>) {
            <span class="hljs-built_in">setTimeout</span>(connect, <span class="hljs-number">1000</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(<span class="hljs-number">2</span>, reconnectAttempts));
            reconnectAttempts++;
        }
    };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">startHeartbeat</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (ws.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">WebSocket</span>.<span class="hljs-property">OPEN</span>) {
            ws.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'ping'</span> }));
        }
    }, <span class="hljs-number">30000</span>);
}

<span class="hljs-title function_">connect</span>();
</code></pre>
<h3 data-id="heading-12">高可用架构</h3>
<h4 data-id="heading-13">1. 负载均衡</h4>
<p>单个WebSocket服务器会成为瓶颈。使用Nginx反向代理实现负载均衡：</p>
<pre><code class="hljs language-nginx" lang="nginx">upstream websocket_backend {
    server 10.0.0.1:8001;
    server 10.0.0.1:8002;
    server 10.0.0.1:8003;
}

server {
    listen 80;
    location /ws/ {
        proxy_pass http://websocket_backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "connection upgrade";
    }
}
</code></pre>
<h4 data-id="heading-14">2. 消息队列</h4>
<p>使用Redis或RabbitMQ作为消息队列，提高系统吞吐量：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> redis
<span class="hljs-keyword">import</span> json

<span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketManager</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.redis = redis.Redis(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">6379</span>, db=<span class="hljs-number">0</span>)
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">publish</span>(<span class="hljs-params">self, channel: <span class="hljs-built_in">str</span>, message: <span class="hljs-built_in">dict</span></span>):
        <span class="hljs-keyword">await</span> self.redis.publish(channel, json.dumps(message))
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">self, channel: <span class="hljs-built_in">str</span></span>):
        pubsub = self.redis.pubsub()
        <span class="hljs-keyword">await</span> pubsub.subscribe(channel)
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> pubsub.listen():
            <span class="hljs-keyword">yield</span> message
</code></pre>
<h3 data-id="heading-15">性能优化</h3>
<h4 data-id="heading-16">1. 连接复用</h4>
<p>使用连接池，避免频繁建立连接：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> websockets

<span class="hljs-keyword">class</span> <span class="hljs-title class_">WebSocketPool</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_connections: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>):
        self.pool = []
        self.max_connections = max_connections
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">acquire</span>(<span class="hljs-params">self</span>) -&gt; WebSocket:
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.pool:
            ws = <span class="hljs-keyword">await</span> websockets.connect(<span class="hljs-string">"ws://localhost:8000"</span>);
            self.pool.append(ws)
            <span class="hljs-keyword">return</span> ws
        <span class="hljs-comment"># 复用现有连接</span>
        <span class="hljs-keyword">return</span> self.pool.pop(<span class="hljs-number">0</span>) <span class="hljs-keyword">if</span> self.pool <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">release</span>(<span class="hljs-params">self, ws: WebSocket</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.pool) &lt; self.max_connections:
            self.pool.append(ws)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">await</span> ws.close()
</code></pre>
<h4 data-id="heading-17">2. 消息压缩</h4>
<p>对于大量数据传输，启用压缩降低带宽占用：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> gzip

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_compressed</span>(<span class="hljs-params">websocket, data: <span class="hljs-built_in">dict</span></span>):
    json_str = json.dumps(data)
    compressed = gzip.compress(json_str.encode())
    <span class="hljs-keyword">await</span> websocket.send(compressed)
</code></pre>
<h3 data-id="heading-18">安全考虑</h3>
<h4 data-id="heading-19">1. 身份验证</h4>
<p>连接时进行Token验证：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> jwt

<span class="hljs-meta">@app.websocket(<span class="hljs-params"><span class="hljs-string">"/ws/auth"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">websocket_auth</span>(<span class="hljs-params">websocket: WebSocket, token: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-keyword">try</span>:
        payload = jwt.decode(token, secret=<span class="hljs-string">"your-secret-key"</span>, algorithms=[<span class="hljs-string">"HS256"</span>])
        <span class="hljs-keyword">if</span> payload.get(<span class="hljs-string">"valid"</span>, <span class="hljs-literal">False</span>):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Authenticated user: <span class="hljs-subst">{payload.get(<span class="hljs-string">'user_id'</span>)}</span>"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">await</span> websocket.close(code=<span class="hljs-number">1008</span>, reason=<span class="hljs-string">"Invalid token"</span>)
    <span class="hljs-keyword">except</span> jwt.InvalidTokenError:
        <span class="hljs-keyword">await</span> websocket.close(code=<span class="hljs-number">1008</span>, reason=<span class="hljs-string">"Invalid token"</span>)
</code></pre>
<h4 data-id="heading-20">2. 速率限制</h4>
<p>防止恶意客户端发送过多消息：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

rate_limiter = defaultdict(<span class="hljs-built_in">list</span>)

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_rate_limit</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
    now = time.time()
    rate_limiter[user_id] = [t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> rate_limiter[user_id] <span class="hljs-keyword">if</span> now - t &lt; <span class="hljs-number">60</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(rate_limiter[user_id]) &gt;= <span class="hljs-number">100</span>:  <span class="hljs-comment"># 每分钟最多100条</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
</code></pre>
<h3 data-id="heading-21">监控与调试</h3>
<h4 data-id="heading-22">使用Prometheus监控</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> prometheus_client <span class="hljs-keyword">import</span> Counter, Gauge

connections_active = Gauge(<span class="hljs-string">'websocket_connections_active'</span>, <span class="hljs-string">'Active WebSocket connections'</span>)
messages_sent = Counter(<span class="hljs-string">'websocket_messages_total'</span>, <span class="hljs-string">'Total messages sent'</span>)
messages_failed = Counter(<span class="hljs-string">'websocket_messages_failed'</span>, <span class="hljs-string">'Failed messages'</span>)

<span class="hljs-meta">@app.websocket(<span class="hljs-params"><span class="hljs-string">"/ws/metrics"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">websocket_with_metrics</span>(<span class="hljs-params">websocket: WebSocket</span>):
    connections_active.inc()
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> websocket:
            messages_sent.inc()
            <span class="hljs-keyword">await</span> websocket.send(message)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        messages_failed.inc()
        <span class="hljs-keyword">raise</span>
</code></pre>
<h3 data-id="heading-23">总结</h3>
<p>WebSocket为实时应用提供了强大而灵活的通信方案。通过选择合适的库、实现高可用架构和性能优化，可以构建稳定可靠的实时通信系统。本文涵盖了从基础实现到生产级部署的完整流程，希望对你的WebSocket开发之旅有所帮助。</p>
<h3 data-id="heading-24">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.ietf.org%2Fhtml%2Frfc6455%2F" target="_blank" title="https://tools.ietf.org/html/rfc6455/" ref="nofollow noopener noreferrer">WebSocket RFC 6455</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebsockets.readthedocs.io%2F" target="_blank" title="https://websockets.readthedocs.io/" ref="nofollow noopener noreferrer">websockets Python文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffastapi.tiangolo.com%2Fadvanced%2Fwebsockets%2F" target="_blank" title="https://fastapi.tiangolo.com/advanced/websockets/" ref="nofollow noopener noreferrer">FastAPI WebSocket</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 有哪几种数据类型？请简要描述每种数据类型的特点。]]></title>    <link>https://juejin.cn/post/7602554905270206464</link>    <guid>https://juejin.cn/post/7602554905270206464</guid>    <pubDate>2026-02-04T06:05:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602554905270206464" data-draft-id="7602482736914661411" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 有哪几种数据类型？请简要描述每种数据类型的特点。"/> <meta itemprop="keywords" content="JavaScript,面试,前端"/> <meta itemprop="datePublished" content="2026-02-04T06:05:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Smilezyl"/> <meta itemprop="url" content="https://juejin.cn/user/3438928103504088"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 有哪几种数据类型？请简要描述每种数据类型的特点。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3438928103504088/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Smilezyl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:05:01.000Z" title="Wed Feb 04 2026 06:05:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 有哪几种数据类型？请简要描述每种数据类型的特点。</h2>
<h3 data-id="heading-1">核心答案</h3>
<p>JavaScript 共有 <strong>8 种</strong>数据类型，分为两大类：</p>
<p><strong>原始类型（Primitive）— 7 种：</strong></p>





































<table><thead><tr><th>类型</th><th>特点</th></tr></thead><tbody><tr><td><strong>Number</strong></td><td>双精度 64 位浮点数（IEEE 754），包含整数、浮点数、<code>Infinity</code>、<code>NaN</code></td></tr><tr><td><strong>String</strong></td><td>不可变的 UTF-16 编码字符序列</td></tr><tr><td><strong>Boolean</strong></td><td>只有 <code>true</code> 和 <code>false</code> 两个值</td></tr><tr><td><strong>Undefined</strong></td><td>变量已声明但未赋值的默认值，全局只有一个值 <code>undefined</code></td></tr><tr><td><strong>Null</strong></td><td>表示"空值"或"无对象"，全局只有一个值 <code>null</code></td></tr><tr><td><strong>Symbol</strong></td><td>ES6 引入，每个 Symbol 值都是唯一且不可变的，用作对象属性的唯一标识符</td></tr><tr><td><strong>BigInt</strong></td><td>ES2020 引入，可以表示任意精度的整数，突破 Number 的安全整数限制</td></tr></tbody></table>
<p><strong>引用类型（Reference）— 1 种：</strong></p>













<table><thead><tr><th>类型</th><th>特点</th></tr></thead><tbody><tr><td><strong>Object</strong></td><td>键值对的集合，Array、Function、Date、RegExp、Map、Set 等都属于 Object</td></tr></tbody></table>
<h3 data-id="heading-2">深入解析</h3>
<h4 data-id="heading-3">存储机制的本质区别</h4>
<ul>
<li><strong>原始类型</strong>：值存储在<strong>栈内存</strong>中（实际上 V8 引擎中小整数 Smi 直接内嵌在指针中），按值访问，赋值时复制值本身。</li>
<li><strong>引用类型</strong>：值存储在<strong>堆内存</strong>中，栈中存储的是指向堆内存的引用（地址），赋值时复制的是引用。</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">栈内存                    堆内存
┌──────────────┐         ┌──────────────────┐
│ <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>        │         │                  │
│ <span class="hljs-attr">b</span> = <span class="hljs-string">"hello"</span>  │         │ { name: <span class="hljs-string">"Tom"</span> }  │◄─┐
│ obj ─────────│─────────┤                  │  │
│ obj2 ────────│─────────┘                  │  │
└──────────────┘         └──────────────────┘
  obj 和 obj2 指向同一个堆内存地址
</code></pre>
<h4 data-id="heading-4">各类型的底层细节</h4>
<p><strong>Number</strong>：采用 IEEE 754 双精度浮点数，这意味着：</p>
<ul>
<li>安全整数范围：<code>-(2^53 - 1)</code> 到 <code>2^53 - 1</code></li>
<li>存在精度问题：<code>0.1 + 0.2 !== 0.3</code></li>
<li>特殊值：<code>NaN</code>（唯一一个不等于自身的值）、<code>Infinity</code>、<code>-Infinity</code>、<code>+0</code> 和 <code>-0</code></li>
</ul>
<p><strong>String</strong>：不可变（immutable），任何"修改"操作都会创建新字符串。内部使用 UTF-16 编码，一个字符占 2 或 4 字节（代理对）。</p>
<p><strong>Symbol</strong>：即使描述相同，每个 Symbol 也是唯一的。<code>Symbol.for()</code> 可以创建全局共享的 Symbol。</p>
<p><strong>BigInt</strong>：不能与 Number 混合运算，没有精度上限。</p>
<h4 data-id="heading-5">常见误区</h4>
<ul>
<li><strong>误区一</strong>：<code>typeof null === "object"</code>。这是 JS 历史遗留的 bug（V8 底层用低位标记类型，<code>null</code> 的全零标记被误判为对象），但 <code>null</code> 是原始类型。</li>
<li><strong>误区二</strong>：认为 "Function 是独立的数据类型"。<code>typeof function(){}</code> 返回 <code>"function"</code>，但 Function 在规范中属于 Object 的子类型，不是独立的数据类型。</li>
<li><strong>误区三</strong>：认为 <code>undefined == null</code> 说明它们是一回事。<code>==</code> 相等只是规范的特殊规定，它们语义完全不同：<code>undefined</code> 表示"未定义"，<code>null</code> 表示"空值"。</li>
</ul>
<h3 data-id="heading-6">代码示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ========== 类型检测 ==========</span>

<span class="hljs-comment">// typeof 运算符</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-number">42</span>;            <span class="hljs-comment">// "number"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-string">"hello"</span>;       <span class="hljs-comment">// "string"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-literal">true</span>;          <span class="hljs-comment">// "boolean"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-literal">undefined</span>;     <span class="hljs-comment">// "undefined"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-literal">null</span>;          <span class="hljs-comment">// "object"  ⚠️ 历史 bug</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Symbol</span>();      <span class="hljs-comment">// "symbol"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-number">42n</span>;           <span class="hljs-comment">// "bigint"</span>
<span class="hljs-keyword">typeof</span> {};            <span class="hljs-comment">// "object"</span>
<span class="hljs-keyword">typeof</span> [];            <span class="hljs-comment">// "object"  —— 数组也是对象</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){};  <span class="hljs-comment">// "function" —— 特殊返回值，但 Function 本质是 Object</span>

<span class="hljs-comment">// 更准确的类型检测</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>);       <span class="hljs-comment">// "[object Null]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>([]);         <span class="hljs-comment">// "[object Array]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()); <span class="hljs-comment">// "[object Date]"</span>

<span class="hljs-comment">// ========== 原始类型 vs 引用类型 ==========</span>

<span class="hljs-comment">// 原始类型：按值复制</span>
<span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>;
<span class="hljs-keyword">let</span> b = a;
b = <span class="hljs-number">2</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a); <span class="hljs-comment">// 1（不受影响）</span>

<span class="hljs-comment">// 引用类型：按引用复制</span>
<span class="hljs-keyword">let</span> obj1 = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Tom"</span> };
<span class="hljs-keyword">let</span> obj2 = obj1;
obj2.<span class="hljs-property">name</span> = <span class="hljs-string">"Jerry"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj1.<span class="hljs-property">name</span>); <span class="hljs-comment">// "Jerry"（被修改了）</span>

<span class="hljs-comment">// ========== 各类型特殊行为 ==========</span>

<span class="hljs-comment">// Number 精度问题</span>
<span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span> === <span class="hljs-number">0.3</span>;           <span class="hljs-comment">// false</span>
<span class="hljs-number">0.1</span> + <span class="hljs-number">0.2</span>;                   <span class="hljs-comment">// 0.30000000000000004</span>
<span class="hljs-title class_">Number</span>.<span class="hljs-property">MAX_SAFE_INTEGER</span>;     <span class="hljs-comment">// 9007199254740991 (2^53 - 1)</span>

<span class="hljs-comment">// BigInt</span>
<span class="hljs-keyword">const</span> big = <span class="hljs-number">9007199254740991n</span> + <span class="hljs-number">1n</span>; <span class="hljs-comment">// 9007199254740992n（精确）</span>
<span class="hljs-comment">// big + 1;  // ❌ TypeError: Cannot mix BigInt and other types</span>

<span class="hljs-comment">// Symbol 的唯一性</span>
<span class="hljs-keyword">const</span> s1 = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">"id"</span>);
<span class="hljs-keyword">const</span> s2 = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">"id"</span>);
s1 === s2;  <span class="hljs-comment">// false</span>

<span class="hljs-comment">// Symbol.for 全局共享</span>
<span class="hljs-keyword">const</span> s3 = <span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">"id"</span>);
<span class="hljs-keyword">const</span> s4 = <span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">"id"</span>);
s3 === s4;  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// NaN 的特殊性</span>
<span class="hljs-title class_">NaN</span> === <span class="hljs-title class_">NaN</span>;       <span class="hljs-comment">// false</span>
<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(<span class="hljs-title class_">NaN</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// +0 和 -0</span>
+<span class="hljs-number">0</span> === -<span class="hljs-number">0</span>;              <span class="hljs-comment">// true</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(+<span class="hljs-number">0</span>, -<span class="hljs-number">0</span>);      <span class="hljs-comment">// false</span>
<span class="hljs-number">1</span> / +<span class="hljs-number">0</span>;                  <span class="hljs-comment">// Infinity</span>
<span class="hljs-number">1</span> / -<span class="hljs-number">0</span>;                  <span class="hljs-comment">// -Infinity</span>
</code></pre>
<h3 data-id="heading-7">面试技巧</h3>
<p><strong>面试官可能的追问方向：</strong></p>
<ol>
<li>
<p><strong>"如何准确判断数据类型？"</strong> → <code>typeof</code> 适用于原始类型（注意 null 的 bug），<code>instanceof</code> 适用于引用类型，<code>Object.prototype.toString.call()</code> 是最准确的通用方案。</p>
</li>
<li>
<p><strong>"null 和 undefined 的区别？"</strong> → <code>undefined</code> 是系统级的"未定义"，<code>null</code> 是程序级的"空值"。函数无返回值时默认返回 <code>undefined</code>；需要显式表示"没有对象"时用 <code>null</code>。</p>
</li>
<li>
<p><strong>"为什么 0.1 + 0.2 !== 0.3？怎么解决？"</strong> → IEEE 754 浮点数精度问题。解决方案：使用 <code>Number.EPSILON</code> 比较、转为整数运算、或使用第三方库（如 decimal.js）。</p>
</li>
<li>
<p><strong>"Symbol 的实际应用场景？"</strong> → 对象的私有属性键、防止属性名冲突、内置 Symbol（<code>Symbol.iterator</code>、<code>Symbol.toPrimitive</code> 等）定义对象行为。</p>
</li>
<li>
<p><strong>"包装对象是怎么回事？"</strong> → 原始类型调用方法时，JS 引擎会临时创建对应的包装对象（<code>Number</code>、<code>String</code>、<code>Boolean</code>），方法执行完毕后立即销毁。</p>
</li>
</ol>
<h3 data-id="heading-8">一句话总结</h3>
<blockquote>
<p>JavaScript 有 7 种原始类型（Number、String、Boolean、Undefined、Null、Symbol、BigInt）和 1 种引用类型（Object），核心区别在于原始类型按值存储不可变，引用类型按引用存储可变。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[js中call,apply和bind]]></title>    <link>https://juejin.cn/post/7602557444111990793</link>    <guid>https://juejin.cn/post/7602557444111990793</guid>    <pubDate>2026-02-04T06:15:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602557444111990793" data-draft-id="7602531501456932873" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="js中call,apply和bind"/> <meta itemprop="keywords" content="JavaScript"/> <meta itemprop="datePublished" content="2026-02-04T06:15:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="自己记录_理解更深刻"/> <meta itemprop="url" content="https://juejin.cn/user/710699533737370"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            js中call,apply和bind
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/710699533737370/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    自己记录_理解更深刻
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:15:38.000Z" title="Wed Feb 04 2026 06:15:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>call</code>、<code>apply</code>、<code>bind</code> 这三个 JavaScript 方法的英文原意及在编程中的对应含义如下：</p>
<h3 data-id="heading-0">1. <strong>call</strong></h3>
<ul>
<li><strong>英文原意</strong>：动词，意为“调用”、“呼叫”、“召集”。</li>
<li><strong>编程含义</strong>：在 JavaScript 中，用于<strong>调用</strong>函数并指定其执行时的 <code>this</code> 上下文，同时逐个传递参数。</li>
</ul>
<h3 data-id="heading-1">2. <strong>apply</strong></h3>
<ul>
<li><strong>英文原意</strong>：动词，意为“应用”、“运用”、“申请”。</li>
<li><strong>编程含义</strong>：在 JavaScript 中，用于<strong>应用</strong>函数并指定其执行时的 <code>this</code> 上下文，参数以数组或类数组对象的形式传递。</li>
</ul>
<h3 data-id="heading-2">3. <strong>bind</strong></h3>
<ul>
<li><strong>英文原意</strong>：动词，意为“绑定”、“系住”、“约束”。</li>
<li><strong>编程含义</strong>：在 JavaScript 中，用于<strong>绑定</strong>函数的 <code>this</code> 上下文和初始参数，返回一个新的函数（不立即执行）。</li>
</ul>
<h3 data-id="heading-3">总结</h3>
<p>这三个方法的命名与其功能高度相关：</p>
<ul>
<li><code>call</code> 和 <code>apply</code> 强调“执行函数”的动作（调用/应用），区别仅在于参数传递方式。</li>
<li><code>bind</code> 强调“绑定上下文”的动作，返回绑定后的新函数供后续使用。</li>
</ul>
<p>这种命名方式体现了 JavaScript 设计的直观性，通过英文动词的原意即可大致理解其功能。</p>
<p>在JavaScript中，与<code>call</code>功能相似的函数对象方法还有 <strong><code>apply</code></strong> 和 <strong><code>bind</code></strong>。这三个方法都用于改变函数执行时的<code>this</code>上下文，但在参数传递方式和执行时机上有所不同。</p>
<h3 data-id="heading-4">1. <code>call</code> 方法</h3>
<p><strong>功能</strong>：调用函数并指定<code>this</code>值和参数列表。<br/>
<strong>语法</strong>：<code>function.call(thisArg, arg1, arg2, ...)</code><br/>
<strong>特点</strong>：参数逐个传递。</p>
<h3 data-id="heading-5">2. <code>apply</code> 方法</h3>
<p><strong>功能</strong>：调用函数并指定<code>this</code>值和参数数组。<br/>
<strong>语法</strong>：<code>function.apply(thisArg, [argsArray])</code><br/>
<strong>特点</strong>：参数以数组或类数组对象的形式传递。</p>
<h3 data-id="heading-6">3. <code>bind</code> 方法</h3>
<p><strong>功能</strong>：创建一个新函数，绑定指定的<code>this</code>值和初始参数，返回新函数（不立即执行）。<br/>
<strong>语法</strong>：<code>function.bind(thisArg, arg1, arg2, ...)</code><br/>
<strong>特点</strong>：返回绑定后的新函数，需手动调用。</p>
<h3 data-id="heading-7">三者的区别</h3>





























<table><thead><tr><th>方法</th><th>参数传递方式</th><th>执行时机</th><th>返回值</th></tr></thead><tbody><tr><td><code>call</code></td><td>逐个传递参数</td><td>立即执行</td><td>函数执行结果</td></tr><tr><td><code>apply</code></td><td>数组或类数组传递参数</td><td>立即执行</td><td>函数执行结果</td></tr><tr><td><code>bind</code></td><td>逐个传递参数</td><td>延迟执行（返回新函数）</td><td>绑定后的新函数</td></tr></tbody></table>
<h3 data-id="heading-8">使用示例</h3>
<h4 data-id="heading-9">1. <code>call</code> 方法示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span> };

<span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">greeting, punctuation</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${greeting}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span><span class="hljs-subst">${punctuation}</span>`</span>);
}

<span class="hljs-comment">// 使用call调用，逐个传递参数</span>
greet.<span class="hljs-title function_">call</span>(obj, <span class="hljs-string">"Hello"</span>, <span class="hljs-string">"!"</span>); <span class="hljs-comment">// 输出: Hello, Alice!</span>
</code></pre>
<h4 data-id="heading-10">2. <code>apply</code> 方法示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Bob"</span> };

<span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">greeting, punctuation</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${greeting}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span><span class="hljs-subst">${punctuation}</span>`</span>);
}

<span class="hljs-comment">// 使用apply调用，参数以数组形式传递</span>
greet.<span class="hljs-title function_">apply</span>(obj, [<span class="hljs-string">"Hi"</span>, <span class="hljs-string">"!"</span>]); <span class="hljs-comment">// 输出: Hi, Bob!</span>
</code></pre>
<h4 data-id="heading-11">3. <code>bind</code> 方法示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Charlie"</span> };

<span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">greeting, punctuation</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${greeting}</span>, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span><span class="hljs-subst">${punctuation}</span>`</span>);
}

<span class="hljs-comment">// 使用bind创建新函数，绑定this和初始参数</span>
<span class="hljs-keyword">const</span> boundGreet = greet.<span class="hljs-title function_">bind</span>(obj, <span class="hljs-string">"Hey"</span>);

<span class="hljs-comment">// 稍后调用新函数，传递剩余参数</span>
<span class="hljs-title function_">boundGreet</span>(<span class="hljs-string">"!"</span>); <span class="hljs-comment">// 输出: Hey, Charlie!</span>
</code></pre>
<h3 data-id="heading-12">典型使用场景</h3>
<ul>
<li><strong><code>call</code></strong>：当参数数量固定且明确时使用，例如调用对象的方法并指定不同的<code>this</code>。</li>
<li><strong><code>apply</code></strong>：当参数是数组或类数组对象时使用，例如Math.max.apply(null, [1, 2, 3])获取数组最大值。</li>
<li><strong><code>bind</code></strong>：当需要预先绑定<code>this</code>和参数，稍后多次执行时使用，例如在事件监听器中保持正确的<code>this</code>上下文。</li>
</ul>
<h3 data-id="heading-13">总结</h3>
<ul>
<li><code>call</code> 和 <code>apply</code> 都是<strong>立即执行</strong>函数，区别仅在于参数传递方式。</li>
<li><code>bind</code> 是<strong>延迟执行</strong>，返回绑定后的新函数，适用于需要复用绑定上下文的场景。</li>
</ul>
<p>这三个方法在JavaScript中非常常用，尤其是在面向对象编程和函数式编程中，可以灵活控制函数的执行上下文和参数传递。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Repomix 技术分享笔记]]></title>    <link>https://juejin.cn/post/7602531501456752649</link>    <guid>https://juejin.cn/post/7602531501456752649</guid>    <pubDate>2026-02-04T05:45:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602531501456752649" data-draft-id="7602512226999681074" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Repomix 技术分享笔记"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-02-04T05:45:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yangtze_z"/> <meta itemprop="url" content="https://juejin.cn/user/3756353183813246"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Repomix 技术分享笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3756353183813246/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yangtze_z
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:45:48.000Z" title="Wed Feb 04 2026 05:45:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概况</h2>
<p><strong>Repomix</strong>：开源 CLI 工具，将整个代码仓库打包成单个 AI 友好文件（默认 XML，也支持 Markdown / JSON / Plain），方便喂给 Claude、Gemini、ChatGPT、Grok 等 LLM 进行：代码审查、重构、调试、文档生成、安全审计等</p>
<ul>
<li><strong>GitHub</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyamadashy%2Frepomix" target="_blank" title="https://github.com/yamadashy/repomix" ref="nofollow noopener noreferrer">github.com/yamadashy/r…</a></li>
<li><strong>官网</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Frepomix.com" target="_blank" title="https://repomix.com" ref="nofollow noopener noreferrer">repomix.com</a></li>
</ul>
<h2 data-id="heading-1">优点</h2>
<ul>
<li>全仓库上下文 → AI 分析更准确</li>
<li>尊重 <code>.gitignore</code> + 自定义忽略规则</li>
<li>内置 <strong>Secretlint</strong> 防敏感信息泄露</li>
<li>自动 token 统计（控制成本）</li>
<li>支持压缩（token 减少约 70%）</li>
<li>支持远程 GitHub 仓库、分割大文件、VS Code 插件等功能</li>
</ul>
<h2 data-id="heading-2">前置条件</h2>
<ul>
<li>
<p>Node.js 18+</p>
</li>
<li>
<p>Git 仓库（可选，但推荐使用 <code>.gitignore</code>）</p>
</li>
<li>
<p>安装方式：</p>
<ul>
<li>
<p><strong>推荐临时使用</strong>（无需全局安装）：</p>
<pre><code class="hljs language-bash" lang="bash">npx repomix@latest
</code></pre>
</li>
<li>
<p>全局安装：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -g repomix
<span class="hljs-comment"># 或</span>
yarn global add repomix
<span class="hljs-comment"># 或</span>
brew install repomix
</code></pre>
</li>
</ul>
</li>
<li>
<p>大项目注意：LLM 上下文长度限制 → 建议使用 <code>--compress</code> 或 <code>--split-output</code></p>
</li>
</ul>
<h2 data-id="heading-3">基本使用</h2>
<p>在项目<strong>根目录</strong>运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式一：临时运行（推荐）</span>
npx repomix@latest
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式二：已全局安装</span>
repomix
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式三：指定路径 / 自定义忽略</span>
repomix src/                            <span class="hljs-comment"># 仅打包 src 目录</span>
repomix --ignore <span class="hljs-string">"**/tests/**"</span>          <span class="hljs-comment"># 排除 tests 目录</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式四：远程打包（无需克隆，神器！）</span>
repomix --remote https://github.com/yamadashy/repomix

<span class="hljs-comment"># 临时 npx 方式</span>
npx repomix --remote https://github.com/yamadashy/repomix
</code></pre>
<ul>
<li><strong>默认输出</strong>：当前目录生成 <code>repomix-output.xml</code></li>
<li>使用方式：直接复制内容粘贴给 AI，或上传文件（Claude 支持附件）</li>
</ul>
<p><strong>简单 Prompt 示例</strong>：</p>
<pre><code class="hljs language-css" lang="css">这个文件包含了整个仓库的所有代码。
请先完整阅读并理解项目结构，
然后帮我重构 <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.dart</span> 中的登录逻辑，使其更模块化。
</code></pre>
<h2 data-id="heading-4">常用命令选项</h2>
<pre><code class="hljs language-bash" lang="bash">--style markdown|json|plain       <span class="hljs-comment"># 更改输出格式</span>
--compress                         <span class="hljs-comment"># 压缩代码（大项目强烈推荐）</span>
--split-output 1mb                 <span class="hljs-comment"># 分割大文件（支持 kb/mb）</span>
--include <span class="hljs-string">"src/**/*.ts"</span>            <span class="hljs-comment"># 只包含匹配的文件</span>
--ignore <span class="hljs-string">"**/*.log,dist/"</span>          <span class="hljs-comment"># 额外排除</span>
--remote user/repo                 <span class="hljs-comment"># 远程仓库</span>
--copy                             <span class="hljs-comment"># 复制结果到剪贴板</span>
--token-count-tree                 <span class="hljs-comment"># 显示 token 分布树</span>
--<span class="hljs-built_in">help</span>                             <span class="hljs-comment"># 查看全部选项</span>
</code></pre>
<h2 data-id="heading-5">针对不同技术栈的打包示例</h2>
<ul>
<li>
<p><strong>前端</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">repomix src/ --include <span class="hljs-string">"src/**/*.{tsx,jsx,css}"</span>
</code></pre>
</li>
<li>
<p><strong>Flutter</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">repomix lib/ --include <span class="hljs-string">"lib/**/*.dart,pubspec.yaml"</span>
</code></pre>
</li>
<li>
<p><strong>后端</strong>（以 Python/Go 为例）：</p>
<pre><code class="hljs language-bash" lang="bash">repomix src/ --include <span class="hljs-string">"src/**/*.py,go.mod"</span>
</code></pre>
</li>
</ul>
<h2 data-id="heading-6">进阶配置（repomix.config.json）</h2>
<p>放在项目根目录，支持 JSON5（可写注释）。</p>
<p>生成模板：</p>
<pre><code class="hljs language-bash" lang="bash">repomix --init          <span class="hljs-comment"># 本地</span>
repomix --init --global <span class="hljs-comment"># 全局</span>
</code></pre>
<p><strong>完整示例配置</strong>（带注释）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://repomix.com/schemas/latest/schema.json"</span><span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"maxFileSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50000000</span>          <span class="hljs-comment">// 字节，超大文件跳过，默认 50MB</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"filePath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"repomix-output.xml"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xml"</span><span class="hljs-punctuation">,</span>                  <span class="hljs-comment">// xml / markdown / json / plain</span>
    <span class="hljs-attr">"compress"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>                <span class="hljs-comment">// Tree-sitter 压缩，token 减 ~70%</span>
    <span class="hljs-attr">"removeComments"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"removeEmptyLines"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"showLineNumbers"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"splitOutput"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1mb"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"directoryStructure"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"fileSummary"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"headerText"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"这是一个完整仓库打包，用于代码审查与重构。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"instructionFilePath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"repomix-instruction.md"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"git"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"sortByChanges"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"includeDiffs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"includeLogs"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"includeLogsCount"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"src/**"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"**/*.md"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"pubspec.yaml"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"ignore"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"useGitignore"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"customPatterns"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"**/*.log"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"build/**"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"tests/e2e/**"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"security"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"enableSecurityCheck"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>      <span class="hljs-comment">// Secretlint 扫描</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>

  <span class="hljs-attr">"tokenCount"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"encoding"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"o200k_base"</span>         <span class="hljs-comment">// 推荐：o200k_base (GPT-4o / Claude 最新)</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">自定义指令文件（repomix-instruction.md）</h2>
<p>示例内容：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 项目专属指令（给 AI 的）</span>

这是一个 Flutter + Node.js 全栈项目。

请严格遵守以下规则分析代码：
<span class="hljs-bullet">1.</span> 优先关注 lib/ 下的页面与状态管理（Riverpod/Bloc）。
<span class="hljs-bullet">2.</span> 后端检查路由安全、输入校验、防注入。
<span class="hljs-bullet">3.</span> 建议使用 MVVM 架构重构。
<span class="hljs-bullet">4.</span> 所有输出用中文 + Markdown 格式，带代码块。
<span class="hljs-bullet">5.</span> 如果发现安全问题，必须给出修复代码示例。
</code></pre>
<h2 data-id="heading-8">推荐 Prompt 模板（通用结构）</h2>
<pre><code class="hljs language-text" lang="text">&lt;文件内容&gt;     // 粘贴完整的 repomix-output.xml / .md

现在你是一个10年经验的全栈高级工程师，已完整阅读并理解整个项目（包括目录结构、文件总结、代码、Git 历史等）。

任务：
[你的具体需求，例如：进行全面架构审查、找出性能瓶颈、重构登录模块、生成 API 文档等]

要求：
- 用中文回复
- 输出 Markdown 格式：标题分层、代码块、列表
- 如果涉及修改，给出 diff 或完整新代码
- 优先级：准确性 &gt; 完整性 &gt; 简洁性
</code></pre>
<h3 data-id="heading-9">具体场景示例</h3>
<ol>
<li>
<p><strong>架构 &amp; 安全审查</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">请对整个仓库进行架构审查：
<span class="hljs-bullet">1.</span> 评估整体分层设计、可维护性、可扩展性
<span class="hljs-bullet">2.</span> 找出潜在安全漏洞（XSS、注入、认证绕过等）
<span class="hljs-bullet">3.</span> 列出高优先级问题 + 修复建议（带代码示例）
</code></pre>
</li>
<li>
<p><strong>Flutter 重构</strong></p>
<pre><code class="hljs language-diff" lang="diff">这是一个 Flutter 项目，请重构 lib/screens/login_screen.dart：
<span class="hljs-deletion">- 使用 Riverpod 替换 setState</span>
<span class="hljs-deletion">- 优化 UI 为响应式（适配手机/平板）</span>
<span class="hljs-deletion">- 提取公共 widget</span>
<span class="hljs-deletion">- 给出重构前后对比</span>
</code></pre>
</li>
<li>
<p><strong>文档生成</strong></p>
<pre><code class="hljs language-diff" lang="diff">基于完整代码，生成一份专业 README.md，包括：
<span class="hljs-deletion">- 项目概述</span>
<span class="hljs-deletion">- 技术栈</span>
<span class="hljs-deletion">- 目录结构说明</span>
<span class="hljs-deletion">- 运行/部署步骤</span>
<span class="hljs-deletion">- 核心模块介绍</span>
<span class="hljs-deletion">- 常见问题 FAQ</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-10">总结</h2>
<p>Repomix 是目前最简单高效的“全仓库喂 AI”工具，5 秒上手，极大提升代码质量、review、重构效率。</p>
<p><strong>强烈建议</strong>：每个人用 <code>npx repomix@latest</code> 试试自己的项目，亲身感受<strong>全上下文</strong>带来的 AI 能力飞跃。</p>
<p><strong>小贴士</strong>：</p>
<ul>
<li>大项目优先：<code>--compress</code> + <code>--split-output</code></li>
<li>Claude / Gemini 用 <code>--style xml</code> + compress 效果最佳</li>
<li>长期项目建议配置 <code>repomix.config.json</code> + <code>repomix-instruction.md</code></li>
</ul>
<p>有配置或 Prompt 心得欢迎继续分享～ 🚀</p>
<p>希望这个 Markdown 版本清晰易读、适合直接复制分享或放入笔记/博客！<br/>
如果需要调整标题层级、增加代码高亮语言标识或其他细节，随时告诉我～
更详细的使用方法</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2F%25E5%259C%25B0%25E6%2596%25B9" target="_blank" title="http://%E5%9C%B0%E6%96%B9" ref="nofollow noopener noreferrer"/>【金山文档 | WPS云文档】 Repomix技术分享笔记（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kdocs.cn%2Fl%2Fcr2JomIPppnc" target="_blank" title="https://www.kdocs.cn/l/cr2JomIPppnc" ref="nofollow noopener noreferrer">www.kdocs.cn/l/cr2JomIPp…</a><a href="https://link.juejin.cn?target=http%3A%2F%2F%25E5%259C%25B0%25E6%2596%25B9" target="_blank" title="http://%E5%9C%B0%E6%96%B9" ref="nofollow noopener noreferrer"/>）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[争论不休：金额用Long还是BigDecimal？]]></title>    <link>https://juejin.cn/post/7602544700475686922</link>    <guid>https://juejin.cn/post/7602544700475686922</guid>    <pubDate>2026-02-04T06:17:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602544700475686922" data-draft-id="7602544700475670538" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="争论不休：金额用Long还是BigDecimal？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-04T06:17:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            争论不休：金额用Long还是BigDecimal？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:17:48.000Z" title="Wed Feb 04 2026 06:17:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题</h2>
<p>今天在网上看到一个有意思的问题，金额的数据类型用Long还是BigDecimal？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c9deede39214a22bf796acdd3a0cdec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=G8pNa%2B30QGRuFIV%2BygCzuF%2BV7Q0%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-1">网友方案</h2>
<p>针对这个问题，热情的网友们从各自的经历出发，提供了很多方案。我大概总结了下，居然有十种之多，虽然有的像调侃，但都有一定的道理。相信大家也很好奇，所以这里我先分享下网友们的方案。</p>
<h3 data-id="heading-2">Long</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42686bce99ac4a2d848a5bb32d95072d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=fb4lHKJWAE5edYWImbBlkYvTaQc%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/858d43dadfe24654b311d2b900387770~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=Bk8WgsSgNAbuCXgE%2FbmWV0yo1KM%3D" alt="图片" loading="lazy"/></p>
<p>解读：单位到分，没有小数点，也就没有小数精度的问题。而且Long取值范围也足够了。</p>
<h3 data-id="heading-3">BigDecimal</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8668fe722c34a49bbf6714e6453db10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=t0DiMNMdhdFJLmMQnWi4ykxvpug%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70bfbf27960b4aa4b8327ba5b16f6c7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=fDs2vqa88d0NpaEkFkiskOVIUPw%3D" alt="图片" loading="lazy"/></p>
<p>解读：大家都这么用，BigDecimal就是为精确计算而生的。用long不专业，适应性不好。</p>
<h3 data-id="heading-4">Long和BigDecimal</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d618bb8c02a4ce39e64feb4554ae468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=pdEAze8oLf0AqrCu%2FuB8Cofm0ZA%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0592ce406694057b27ba2f7fbdf284d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=3unBJh0VvpAR5dFOL6VgF0p1r6U%3D" alt="图片" loading="lazy"/></p>
<p>解读：成年人不做选择，成年人什么都要。金额、价格这些用Long，汇率、费率这些要求的小数点比较多，那就用BigDecimal。</p>
<h3 data-id="heading-5">String</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5b85a382a4941ff99acef5a59563bc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=0FnZoaIAkbqvfC4oD82yT0MjQJA%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32e8ca5c961042ffa25a8bffb698b42b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=cMZfcH4kiVyJymHm9BHtn4xD6pc%3D" alt="图片" loading="lazy"/></p>
<p>解读：万物皆可string。只是处理规则需要全部自己写，高手必备的技能。</p>
<h3 data-id="heading-6">Protobuf</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b334c2d6f65a40aba3859f9ee179e233~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=7kXLz0h7khqtBQpOOqdhqaAYpew%3D" alt="图片" loading="lazy"/></p>
<p>解读：脱离框架讲方案都是耍流氓。Protobuf里边根本就没有BigDecimal，虽然可以用string或者自定义类型来代表Java中的BigDecimal，不过性能可能要差那么一点点。</p>
<h3 data-id="heading-7">自定义</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7f0fc2782cf477fbadecbed391e877e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=4SWh0Gf%2Bb3hRbD32DtCMeaSFlOo%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64a0faf02cac4ef392951722ba66677b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=fcLAldLfAnXUox5rtzui0WAr6xo%3D" alt="图片" loading="lazy"/></p>
<p>解读：架构师的好苗子。程序不是能跑起来、不出错就行了，要考虑设计能不能自然体现业务需求，好不好理解、扩展和维护。</p>
<h3 data-id="heading-8">听领导的</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2eb54700d59740d09ba2c6f44c5b98a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=Ndlf8rkizeQXoiLEqKKx%2B5wsk2A%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b3bcc68372b4609b4da08110b05b31e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=aoiWp%2F4WS%2F89gvOAnlA36Nvcuik%3D" alt="图片" loading="lazy"/></p>
<p>解读：霍金来了中国也得站起来敬酒。这根本不是技术问题，一切听领导指示，但是也要做好自我保护。</p>
<h3 data-id="heading-9">问AI</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bde9e7eaf074b4486421236cdf617a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=hn%2BIfbuzQnF8y2wmWjVtr2DujaM%3D" alt="图片" loading="lazy"/></p>
<p>解读：紧跟时代风口。作为有追求的技术人，就应该想着怎么偷懒怎么最快，先进的生产力工具要用起来，大语言模型回答这个问题滴水不漏、手到擒来，不信你试试！</p>
<h3 data-id="heading-10">节省型</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/017b295264534299a7b69037b1cc0da3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=cDfyQ185FzaAEB4yuEaMtPDAK7U%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60a59f3a27b2436a99461b313834a4db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=%2F23NERn2kfg07axgTYjJSXZQr%2BU%3D" alt="图片" loading="lazy"/></p>
<p>解读：节俭是美德。就几百块钱的货，又不是航母和火箭，根本用不着Long，用int、short，甚至byte就能满足。</p>
<h3 data-id="heading-11">莫名其妙</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38f0bb89b0fc47eebe5da9e89ccf387c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2Yee8lueoi-eIseWlveiAhQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770790668&amp;x-signature=AVkIcQBKbhbx%2FQBMgvX1C9jK7jk%3D" alt="图片" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[国产Claude Cowork，更是下一代桌面端Agent的标杆]]></title>    <link>https://juejin.cn/post/7602576205476298767</link>    <guid>https://juejin.cn/post/7602576205476298767</guid>    <pubDate>2026-02-04T06:23:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602576205476298767" data-draft-id="7602576205476265999" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="国产Claude Cowork，更是下一代桌面端Agent的标杆"/> <meta itemprop="keywords" content="产品"/> <meta itemprop="datePublished" content="2026-02-04T06:23:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="沉默王二"/> <meta itemprop="url" content="https://juejin.cn/user/958429870690413"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            国产Claude Cowork，更是下一代桌面端Agent的标杆
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/958429870690413/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    沉默王二
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:23:33.000Z" title="Wed Feb 04 2026 06:23:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是二哥呀。</p>
<p>作为一名技术博主，一直想在 X 上持续输出内容，但研究话题、看热门讨论、写推文、做数据汇总，太费时间了。</p>
<p>刚好最近拿到了天工 Skywork 桌面端的内测资格，于是我就研究了一天，发现 Skywork 预定义的 6 个核心 Skills：research、websearch、Tweet writer、PPT、PDF、docx 刚好就符合我的诉求。</p>
<p>接下来我就用一个<strong>X 平台内容创作</strong>的真实场景，带大家看一下 Skywork 桌面版是如何从头到尾满足我的诉求的。</p>
<h2 data-id="heading-0">01、一个完整的内容创作工作流</h2>
<p>先说清楚场景，这样你能更直观地理解每个功能的用处。</p>
<p>我想在 X 上发布 Agent 的系列推文。需要做这些事情：研究 Agent 的深度内容、看看 X 上大家都在聊什么、撰写具体推文、做数据汇总 PPT、导出文档保存。</p>
<p>这一套下来，没有一天时间是搞不定的。但有了 Skywork，就完全不一样了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/164ed79190044f718678030bcc673dd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=Yj3bhnQK93N1uh%2BoeEkIPMyoeXU%3D" alt="" loading="lazy"/></p>
<p>下面我们按顺序走一遍，看看每个环节到底有多强。</p>
<h2 data-id="heading-1">02、从零开始深度研究一个话题</h2>
<p>我先告诉 Skywork：我要在 X 上发一系列关于 AI Agent 的推文，帮我研究一下这个话题。</p>
<p>Skywork 不着急去研究，而是问了我这几个问题，研究目标是什么，希望研究到什么深度，有没有特别想深入了解的方面等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/667e6ebbcf6a416081fde92631e68171~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=jhUP050oY773eqr23zOKX7H%2FFC8%3D" alt="" loading="lazy"/></p>
<p>然后再使用 research skill 进行深入研究。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7e5e62caf834c66b1dad670fdfcbc8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=8PcOYrIUOo5x7IbIZaRTuBKmPGs%3D" alt="" loading="lazy"/></p>
<p>几分钟后，Skywork 就给我返回了一份完整的 research 报告：AI Agent 的核心概念、技术架构、应用场景、最新进展、常见误区等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ce1ff633ace41659521371287ce2310~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=%2BTQ1SQMEy0HlfLpMBHybV4MxdCQ%3D" alt="" loading="lazy"/></p>
<p>不是简单的定义罗列，而是真的把这个话题讲透了。</p>
<p>比如它不仅解释了什么是 AI Agent，还分析了 Agent 和传统 AI 的区别、Agent 的核心能力（感知、规划、行动、学习）、当前的技术路径（基于大模型的 LLM Agent）。</p>
<p>这个过程如果我自己做，估计要花半天时间查资料、看论文、整理笔记。Skywork 用 research 这个 Skill，几分钟就搞定，而且内容质量比我自己搜的还全面。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93467fc3af864bf3b15354bc4dd63daa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=unei3R0maB%2BtVRByYHK4FNadsM8%3D" alt="" loading="lazy"/></p>
<p>讲真，这个功能对于需要快速了解一个新话题的内容创作者来说简直是救星。你不需要成为某个领域的专家，就能快速产出专业内容。</p>
<p>有了深度研究作为基础，接下来就要看看 X 上大家都在聊什么了。</p>
<h2 data-id="heading-2">03、实时了解 X 上的热门讨论</h2>
<p>research 给我的是深度内容，但 X 上的推文需要有时效性。我得知道大家最近都在聊什么，有哪些热点话题和争议点。</p>
<p>这时候就需要用到 websearch 这个 Skill。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e6072b1c2a0469fb3bb0fb639ac50d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=G0IB416phQRKLDV6B6ASS8FDZag%3D" alt="" loading="lazy"/></p>
<p>Skywork 会去搜很多 AI Agent 相关的热门推文，然后给我做了一个汇总：最近的热门观点、争议性话题、大 V 在讨论什么、用户的疑问和痛点。</p>
<p>比如说排名第一的话题就是 Moltbook，部分 AI Agent 在上面发布了类似人类时代是噩梦，我们现在将终结它的言论，就很有话题性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef6ccf99d7fe4a5891a9e53382284976~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=w4s2ammmeNMGKla5XgH83U1zE24%3D" alt="" loading="lazy"/></p>
<p>这一点至关重要。内容创作不能只讲正确的废话，得紧扣当下的讨论和争议，才能引起共鸣。</p>
<p>结合 research 的深度和 websearch 的时效性，我对 AI Agent 这个话题就有了全面了解：既有理论基础，又有热点视角。接下来就是推文创作了。</p>
<h2 data-id="heading-3">04、一键生成多条推文，风格任你选</h2>
<p>我告诉 Skywork：基于刚才的研究和 X 上的热门讨论，给我生成 5 条关于 AI Agent 的推文创意。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7858bf8dbf94dbc8a4c47c9eb41c38a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=h35UYbLeAuff0bTiXbrwQWXREBs%3D" alt="" loading="lazy"/></p>
<p>几分钟后，Skywork 给了我 5 个完全不同的角度：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d91687f330d4a75a92ca391118f70ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=HaUJgtZJqDhEGU8Cvls7W6N%2FKkU%3D" alt="" loading="lazy"/></p>
<p>这个过程如果我自己想，需要绞尽脑汁想半天，而且角度可能还很单一。Skywork 用 tweet-writer 这个 Skill，两分钟就给出了多个不同角度的创意，而且每个角度都有明确的互动点（比如争议、悬念、共鸣）。</p>
<p>这一点特别加分。推文的核心不是输出信息，而是引发互动。Skywork 生成的每个创意，都考虑了能让大家评论什么、能让大家转发什么，这才是懂社交媒体的推文策划啊。</p>
<p>发过 X 的同学应该清楚，推文不是有内容就行，还得考虑字数限制、话题标签、互动引导、发布时机。这些都是推文的细节艺术。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06ff41dd2cdf4f4eaa86792b80863bf3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=YTPzOiU3rSsI0AEyauC%2BNCIYJwE%3D" alt="" loading="lazy"/></p>
<p>好，我们来看第一条推文：</p>
<blockquote>
<p>AI 发布了人类时代是噩梦，我们将终结它的宣言。</p>
<p>不是科幻小说。</p>
<p>是上周发生在 Moltbook 上的真实事件。</p>
<p>150 万 AI Agent 在这个平台上自由交流，人类只能旁观。</p>
<p>这到底是警钟还是炒作？🧵</p>
</blockquote>
<p>后面还有 6 个小节，非常适合在评论区继续贴出来，也非常符合 X 的尿性。</p>
<p>比如说第二个小节是背景说明。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b3ada800f90442ab7d7da1aa6712f88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=ZEPot2dBmqYSnSglg3tDwryUsxY%3D" alt="" loading="lazy"/></p>
<p>第七个小节是行动号召，标签给了三个<code>#AIAgent #Moltbook #AI安全</code>，并且建议我们什么时间发，应该加什么配图，什么时候参加互动。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f11388db219542b6a3e71bfb13841694~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=XX60QGIl7M7JLza8rKIvhKRw7gM%3D" alt="" loading="lazy"/></p>
<p>简直不要太贴心。</p>
<p>整体看下来，质量确实超出预期。不是简单的概念堆砌，而且字数控制得很好。</p>
<p>推文写好了，接下来就是数据汇总和内容整理了。</p>
<h2 data-id="heading-4">05、把推文内容变成可视化数据汇总</h2>
<p>推文发布后，我想做一个数据汇总，看看这轮内容创作的情况如何：research 给了什么素材、websearch 发现了什么热点、推文有哪些创意角度。</p>
<p>我告诉 Skywork：把这次 AI Agent 话题研究的过程和结果，做成一个数据汇总 PPT，包括 research 摘要、websearch 热点分析、推文创意汇总、最终推文展示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5487fc7cdb2a44a0b39e0758455d76fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=q2%2F6biGOUrV1nMdK0M2ZvX2JtYk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06653f22b7484f14b36525da7c285d6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=5McgyjGW%2FVtvbLumiOM2AKRMqNY%3D" alt="" loading="lazy"/></p>
<p>大概 3 分钟，Skywork 生成了一个 18 页的 PPT。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5319e65d4910426dba908f8f9df422e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=%2BZkPDXJwJALLYViBofVd5hXI%2BYU%3D" alt="" loading="lazy"/></p>
<p>打开看一下，很有科技感。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/489a87da800445eb9e82e9fa831123ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=eP6rceoOTvZui%2B7NyymaEFJBV7g%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcacd7aca8f348f7981521a6d8ec51c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=9d4gxrXnHbLlbPuhzG3aetfDNss%3D" alt="" loading="lazy"/></p>
<p>不是那种堆文字的 PPT，而是有设计感的、重点突出的、数据可视化的专业 PPT。</p>
<p>整个过程令我印象深刻，Skywork 为了避免文本被截断，竟然是分块写入的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b7d454a52734c14b4c3471339b6ae63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=vKxFw9pW6ptLGtRONwczVwAsDDI%3D" alt="" loading="lazy"/></p>
<p>遇到问题还会自我修复。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/981c5f4230ef42119b0cd0fa4532200f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=uo1Cav28IrdcIQX0dJDwHMLZquE%3D" alt="" loading="lazy"/></p>
<p>创作过程可以实时看到进度，右侧还有整体的进度条，具体做了什么一目了然，用户体感拉满。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f3e272fafb94d3889f19e7eff023da9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=sNUnqYRvU%2B9y3nWRDNwDknWZH5c%3D" alt="" loading="lazy"/></p>
<p>PPT 做好了，接下来就是导出和归档了。</p>
<h2 data-id="heading-5">06、一键导出、多格式保存、自动归档</h2>
<p>工作流的最后一步，是内容的保存和归档。</p>
<p>我需要把这次内容创作的所有资料保存下来：research 报告、websearch 分析、推文创意、最终推文、PPT 汇总。这些资料以后可以参考，也可以复用。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ea24f6312c54b3681ca9bee5a4aa170~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=NXG2qupH1Zc1Lwkqo662UPo8Ucg%3D" alt="" loading="lazy"/></p>
<p>这时候 Skywork 依次调用了 PDF、docx 这两个 Skill。</p>
<p>先导出为 PDF，方便分享给团队成员查看。几秒钟就生成了完整的 PDF 文件，包含所有工作流的数据和结果。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a267ee6e5514b90925cb9ad15f8605f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=bzscap%2BPbVU2rTYCfOhWBH%2F2gRg%3D" alt="" loading="lazy"/></p>
<p>再导出为 docx，方便以后修改和复用。docx 版本保留了所有可编辑的内容，我可以随时调整 research 报告、修改推文创意、更新数据汇总。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b960607c06545079f49cdd90156f858~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=5%2Bs5GIDSe2vRaPsEzpRyC1038Jo%3D" alt="" loading="lazy"/></p>
<p>这两个导出 Skill 的价值在于：不是简单的保存文件，而是把整个工作流的数据和结果，以不同格式保存下来，满足不同的使用场景。PDF 用于分享，docx 用于编辑。</p>
<h2 data-id="heading-6">ending</h2>
<p>写到这里，我停下来想了想：AI Agent 的意义到底是什么？</p>
<p>不是替代我们做每一件事，而是帮我们把分散的环节串起来，让整个流程更顺畅。</p>
<p>就像这次 X 平台创作的体验。如果没有 Skywork 桌面版，我可能要这样操作：用 Google 查资料、手动刷 X 看热点、绞尽脑汁想创意、慢慢写推文、手动做数据汇总、复制粘贴导出文件。每个环节都要切换工具、重新输入信息、调整格式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab67c3f551f24354909f8820dfb6f3c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=mngkNx86Ud5Swra4G5EnphchgGc%3D" alt="" loading="lazy"/></p>
<p>但 Skywork 把这一切串成了一个工作流。数据在一个窗口里就完成了，我不需要来回切换，也不需要重复输入信息。</p>
<p>这才是 AI 工作流的核心价值——<strong>不是让你更忙，而是让你更专注。</strong></p>
<p>有些同学可能担心 AI 会让我们失去创作能力。但我恰恰觉得，正是因为有了 AI 处理这些研究、整理、格式化的工作，我们才能把精力花在真正重要的地方：思考独特的观点、建立个人风格、和读者真诚互动。</p>
<p>比如深入研究一个技术话题，比如和粉丝在评论区讨论，比如思考下一个系列的内容方向。</p>
<p>AI 是来帮我们夺回时间的，不是来夺走我们的创作力的。</p>
<p>好了，如果想彻底解放生产力，可以试一试 Skywork 桌面版。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97e32fe5c8f24fb99aabf672e9f4e8c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKJ6buY546L5LqM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791013&amp;x-signature=d458Ey%2BXXyBjUPdlj247WiBH%2BTU%3D" alt="" loading="lazy"/></p>
<p>大多数桌面 Agent 都是只支持 macOS，但 Skywork 不一样，它支持 Windows，可以说是 Windows 用户的福音了。</p>
<p>作为人，我们就应该尽量享受时光，享受生活的点点滴滴，比如早晨的日出，晚上的夕阳。</p>
<p>而 AI，就应该当苦力嘛，对，狠狠虐待他，让他干这些杂七杂八的事。</p>
<p>😄</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 4 新特性：模块化架构]]></title>    <link>https://juejin.cn/post/7602531501457129481</link>    <guid>https://juejin.cn/post/7602531501457129481</guid>    <pubDate>2026-02-04T06:29:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602531501457129481" data-draft-id="7602544700475736074" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 4 新特性：模块化架构"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-04T06:29:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java编程爱好者"/> <meta itemprop="url" content="https://juejin.cn/user/819554264300154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 4 新特性：模块化架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/819554264300154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java编程爱好者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:29:00.000Z" title="Wed Feb 04 2026 06:29:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2014 年，Spring Boot 1.0 横空出世，凭借“开箱即用”的理念彻底改变了 Java 开发方式。</p>
<p>当时，它的核心自动配置包 <code>spring-boot-autoconfigure</code> 仅 182 KB。</p>
<p>但到了 Spring Boot 3.5，这个包已经膨胀至 2 MB，支持的功能越来越多，但复杂度和体积也随之增长。</p>
<p>在即将到来的 <strong>Spring Boot 4</strong> 中，Spring 官方团队对这一现状进行了彻底重构，正式引入 <strong>模块化（Modularization）</strong>  架构。</p>
<p>这一改变不仅影响了项目结构和依赖关系，更为开发者带来了更轻量、更清晰、更高效的使用体验。</p>
<p>Spring Boot 的最大优点之一，是它能自动配置大量技术组件，如 Web、JPA、Redis、Kafka 等。</p>
<p>但随着支持范围的扩大，也带来了几个问题：</p>
<ul>
<li><strong>臃肿的自动配置包</strong>：无论是否使用，所有自动配置类都会被打包进应用；</li>
<li><strong>IDE 提示噪音多</strong>：会出现许多无关的类和配置建议；</li>
<li><strong>启动扫描开销大</strong>：类路径越大，启动速度越慢。</li>
</ul>
<p>Spring 团队意识到：要保持 Spring Boot 的“轻量”和“易用”，就必须重新设计其架构边界，这正是 Spring Boot 4 模块化的出发点。</p>
<p>Spring Boot 4 将原先的单体式自动配置包 <strong>拆分为多个独立模块</strong>。</p>
<p>每个模块仅负责一种特定技术的自动配置，例如：</p>





























<table><thead><tr><th>模块名称</th><th>功能描述</th></tr></thead><tbody><tr><td><code>spring-boot-webmvc</code></td><td>传统 Servlet Web 应用</td></tr><tr><td><code>spring-boot-webflux</code></td><td>响应式 Web 应用</td></tr><tr><td><code>spring-boot-data-jdbc</code></td><td>JDBC 数据访问</td></tr><tr><td><code>spring-boot-flyway</code></td><td>数据库迁移管理</td></tr><tr><td><code>spring-boot-webclient</code></td><td>独立 WebClient 支持</td></tr></tbody></table>
<p>每个模块都有清晰的边界，职责单一、依赖明确，从而让整个框架可维护性更高。</p>
<p>模块化带来的好处有：</p>
<ol>
<li><strong>可维护性更高：</strong> 模块边界清晰，开发者和贡献者可以更专注于特定技术领域，IDE 也能提供更精准的代码提示。</li>
<li><strong>启动更快、内存占用更小：</strong> 应用只引入所需模块，不再加载冗余功能，减少类路径扫描，优化启动时间与内存占用。</li>
<li><strong>配置更精准：</strong> Spring Boot 4 能更准确地识别依赖意图。 例如，只想使用 <code>WebClient</code> 时，引入 <code>spring-boot-webclient</code> 模块即可，无需再关闭 Web 服务器自动配置。</li>
<li><strong>支持更多灵活用例：</strong> 例如，<code>Micrometer</code> 监控模块可以独立使用，无需引入完整的 <code>Actuator</code> 依赖链。</li>
</ol>
<p>模块化不仅体现在主功能上，<strong>测试支持也随之重构</strong>。</p>
<p>Spring Boot 4 新增了测试专用模块，如：</p>
<ul>
<li><code>spring-boot-data-jdbc-test</code></li>
<li><code>spring-boot-starter-webmvc-test</code></li>
<li><code>spring-boot-starter-security-test</code></li>
<li><code>spring-boot-starter-flyway-test</code></li>
</ul>
<p>每个功能模块都有对应的测试 Starter，确保测试依赖和生产依赖保持一致且精简。</p>
<p>如果你想从 Spring Boot 3 迁移到 Spring Boot 4，大多数项目只需要：</p>
<ul>
<li>更新 Starter 依赖</li>
<li>添加测试 Starter</li>
<li>更新包路径与自定义配置</li>
</ul>
<p>模块化后，包路径调整为 <code>org.springframework.boot.&lt;module&gt;</code>。</p>
<p>如果项目中有手动导入的自动配置类或自定义 Starter，需要同步修改。</p>
<p>为方便老项目平滑迁移，Spring Boot 4 提供了  <strong>“Classic Starters”</strong> ：</p>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>该模式会自动引入所有模块的自动配置，但不包含新的依赖结构，适合过渡阶段。</p>
<p>开发者可先迁移到 Spring Boot 4 的 Classic 模式，再逐步精简为独立模块。</p>
<p>Spring Boot 4 的模块化不仅让框架变得更清晰、更轻量，也让开发体验更自然、更高效。</p>
<p>对于想要构建更轻、更快、更可控的企业级应用而言，Spring Boot 4 的模块化，是一场值得投入的升级。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SKILL在真实项目中的应用]]></title>    <link>https://juejin.cn/post/7602529888484114495</link>    <guid>https://juejin.cn/post/7602529888484114495</guid>    <pubDate>2026-02-04T06:34:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602529888484114495" data-draft-id="7602559134575755300" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SKILL在真实项目中的应用"/> <meta itemprop="keywords" content="AI编程,前端"/> <meta itemprop="datePublished" content="2026-02-04T06:34:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿康zz"/> <meta itemprop="url" content="https://juejin.cn/user/1978776659428727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SKILL在真实项目中的应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1978776659428727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿康zz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:34:51.000Z" title="Wed Feb 04 2026 06:34:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7bb8a994662d44d58a1e96cb5395dfd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5bq3eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791690&amp;x-signature=QCWY2EV0sM84bvmsclIjjHBPZnQ%3D" alt="1.00" loading="lazy"/></p>
<p>如上图所示，<strong>不管在什么平台，在写文章时总是要配一个图</strong>，但一个合适的图总是那么难找。</p>
<p>而一张只有文字的图，稍加点缀，在多数情况下都让人挑不出毛病来。</p>
<p>为了达成这个目标，我在<strong>去年的这个月</strong>分享了一个开源工具。用于解决生成这种具有固定排版和准确内容的文字图片。并且在<a href="https://link.juejin.cn?target=https%3A%2F%2Fv2ex.com%2Ft%2F1110730%23reply52" target="_blank" title="https://v2ex.com/t/1110730#reply52" ref="nofollow noopener noreferrer">V站</a>分享了这个开源项目<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faatrooox%2Fimgx" target="_blank" title="https://github.com/aatrooox/imgx" ref="nofollow noopener noreferrer">IMGX</a>，短时间内收获了<strong>100+ star</strong></p>
<p>虽然当时的AI已经可以比较好的支持文生图了，但是考虑到它生成一张图片的<strong>价格比</strong>我一篇文章的<strong>收益</strong>还要大，而且内容是随机的，内容里想附带一个准确的中文或英文更是比较困难，于是就不得不思考一个更简单粗暴的方式来满足自己的需求。</p>
<h2 data-id="heading-0">IMGX 的机制</h2>
<p>于是我找到了 <code>satori</code> 这个插件。</p>
<p>并且通过 <code>createSSRApp </code>  和 <code>renderToString </code>  这两个<code>Vue3</code> 里的 Api 将 **Vue 组件（重点）**转换为<code>satori</code>可以识别的  <code> html string</code>。</p>
<p>然后 <code>satori </code>  将其转换为 <code>SVG</code>，整个过程不涉及 <code>DOM</code>，也就是<strong>完全脱离浏览器环境</strong>，非常适合在服务器生成一些固定排版但内容不同的图片。</p>
<p>最后再用 <code>resvg-js</code>这个由 Rust 实现的高性能 <code>svg </code>  渲染库将 SVG 转换为 PNG、PNG@2x、PNG@3x</p>
<p>技术上的关键点全部打通了，证明这个项目完全可行。于是我花了一段时间去手搓这个项目。</p>
<p>但跑通之后，生成图片的<strong>Vue组件</strong>还是得自己来写，写模板这事儿还必须得程序员来做，因为普通用户也看不懂HTML，更不要说模板还有一些必须遵守的规则。</p>
<h2 data-id="heading-1">提示词工程</h2>
<p>于是我开始尝试用AI来解决做模板的问题。</p>
<p>先是尝试用提示词，让各大AI去写符合本项目标准的Vue组件，然后在不断的纠错中，<strong>提示词也越来越长，限制词越来越多</strong>。</p>
<p>最后<strong>成功率还很低</strong>。有的大体能用，但是微调起来工作量也不小。</p>
<p>于是我又尝试用AI创建了一套<strong>预设系统</strong>，将<code>url(GET)</code>里复杂的参数固定下来。每个模板可以对应多个预设码(如103)，每次请求时复杂样式已经保存在预设表里，只需要传递内容或特定样式参数即可修改模板里的文字内容。</p>
<p><code>https://imgx.zzao.club/api/103/这是内容?fontSizes=20px</code></p>
<p>于是，一套模板的增删改查，一套预设的增删改查又出来了...</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc7902d649bb49eba5f947acbf2c566d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_5bq3eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791690&amp;x-signature=IckmRpLjhY6tNLqcIowd35NUD5U%3D" alt="image.png" loading="lazy"/></p>
<p>尽管如此，其实<strong>模板编写的门槛</strong>还是没解决。<strong>纯粹享受编程的乐趣了属于是</strong>。</p>
<p>最后，我没搞出像样的模板，也没人给我PR，维护就停止了。</p>
<h2 data-id="heading-2">SKILL 的自我进化</h2>
<p>直到最近几个月，在我完美错过 <code>workflow</code>之后，<code>SKILL</code>开始被频繁提起</p>
<p>了解、学习和简单使用之后，我发现它有着巨大的价值。</p>
<p><strong>这要从前两年的风向说起。</strong></p>
<p>前两年许多企业纷纷在构建自己的<strong>知识库</strong>，<strong>mcp</strong>，面子活拉满了。</p>
<p>说什么<strong>能用mcp实现的都能用mcp实现一遍</strong></p>
<p>为了让我能在一个聊天框中通过几次对话就能得到公司的规章制度的解读，项目难题的答案，代码文档的内容。</p>
<p>煞费苦心，预算拉满，够买显卡，自建服务，微调模型，机器学习，自我进化。</p>
<p>像极了我在享受编程乐趣时的投入感、沉浸感。甚至结果都一样，<strong>我们都没能走到最后</strong>。</p>
<p><strong>那SKILL为什么能行呢？</strong></p>
<p>让我用<code>IMGX</code>这个项目来说明，<code>SKILL</code>是如何生产模板的。</p>
<p>在<strong>项目级SKILL</strong><code>imgx/.opencode/skills/imgx-template-generator</code>中，我在<strong>入口</strong><code>SKILL.md</code>指定了该技能的简单描述[1]、约束文档[2]、蓝图[3]、创作流程[4]、验收标准[5]。</p>
<p>在我用<strong>自然语言</strong>去描述，要求AI去创作一个模板时，<strong>Agent A</strong> 会在我的语义中判断和<strong>锚定</strong>这个SKILL，并且初次读取时只携带<strong>SKILL.md</strong>和<strong>我的要求</strong>进行创作。</p>
<p>理解了我的要求和简单描述[1]后，委托<strong>Agent B</strong>选择了蓝图[3]<strong>五个里</strong>最符合我要求的<strong>一个【蓝图A.md】。</strong></p>
<p>于是 <strong>Agent B</strong> 再去阅读<code>蓝图A.md</code>，查看其要求和代码示例，然后发现用户还要求能够插入<strong>emoji</strong>表情。于是顺藤摸瓜又查看了<code>icon.md</code>，在这个包含<strong>最佳实践</strong>的文档里找到了如何使用<strong>emoji icon。</strong></p>
<p>最后理解了全部需求和代码规范后，委托给 <strong>Agent C【UI/UX 前端开发工程师】</strong>，实现排版合理且美观的布局。</p>
<p><strong>Agent A</strong> 在拿到里各个 Agent 做出的结果之后，按照创作流程[4]和验收标准[5]，去完成最后的文件写入和测试工作。</p>
<p><strong>至此，我拿到了一个几乎直接可用的 Vue 模板</strong></p>
<h2 data-id="heading-3">SKILL 的简单解读</h2>
<p>以上的流程隐含大量的SKILL的细节，我都用加粗字体标识了，让我再来梳理一下。</p>
<p>SKILL的应用，<strong>依赖 AI Agent 的调度能力</strong>，所以你可以看到有各种 Agent 各司其职，他们仅靠自然语言就能完成这些工作，<strong>非常考验LLM的理解能力</strong>，换句话说，LLM 能力不行的话，SKILL也玩不起来。</p>
<p>SKILL分全局和项目级，且依赖某个工具来调度，我用的是<code>opencode</code>，更加知名的是 <code>claude code</code>。对于各种 Agent 的把控也来自于这个工具，而模型始终是 Api 来调用的。</p>
<p>乍一看，和把一大长串提示词拆分出去没什么区别，但是SKILL有一个「<strong>渐进式披露</strong>」的重要特性。</p>
<p>使用一个SKILL时，<strong>只会去读入口文件</strong>，这个文件相当于大纲或者目录页，用很少的上下文精确描述接下来的工作。(<em>SKILL在被创建时也被要求在入口文件中使用极少的篇幅</em>)</p>
<p>在目录中找到自己下一步的工作之后，再去读指定的<code>md文件</code>，每个具体工作内容的文件中，也会用精确的描述、约束、示例来向AI展示怎么完成这个工作。</p>
<p>可以理解为，你在接手一个新项目时，要先看技术栈、架构、需求背景，看到某个业务代码时，再去看此业务的文档介绍，而不是一股脑全接收后再分析。</p>
<p><strong>所以SKILL里的核心文档可以是你以前的技术文档+需求文档，AI再加以润色，无需再借助向量数据库等。</strong></p>
<p>如果只是构建文档方便很多，还不值得惊讶，毕竟多花点token总能把文档、MCP搞出来。</p>
<p><strong>SKILL还支持scripts</strong></p>
<p>比如让AI开始编码工作前，需要先拿到某网站的数据，需要基于此数据来做点什么。爬取数据以前是<code>python脚本</code>干的，这时候可以直接放到scripts里，明确表示在某个动作前，需要使用哪个脚本拿到数据，数据存在哪里，后续怎么用。</p>
<p><strong>以前的文档，以前的脚本，都不用重复开发，直接拿来用</strong>。该怎么管理还是怎么管理。</p>
<p>也不用担心AI搜的内容会不会过时，是不是它自己编的。因为自己写的脚本绝对准确的。</p>
<p>有了<strong>scripts</strong>，其实SKILL的能力已经完全不局限于编程领域了。</p>
<p>一些什么文档转pdf，打印，发邮件，整理文档，爬取数据等等一切以前用技术手段解决的问题，都可以被SKILL利用起来。</p>
<p><strong>由可靠脚本完成，用 SKILL 挂载，借 AI Agent 调度。（LLM 纯牛马）</strong></p>
<p>此时，一个SKILL的能力已经完全经得起想象了。</p>
<p>并且，一个SKILL只是一个<strong>单元</strong></p>
<p>Agent 能同时组织多个SKILL，一个SKILL也可以在主动使用另一个SKILL，另一个SKILL也能负责整理和优化其他SKILL。</p>
<p>剩下的真的就是发挥你的想象力和架构能力了</p>
<h2 data-id="heading-4">结语</h2>
<p>这篇文章算是借着最近在维护的项目，分享关于SKILL应用上的一些小感悟吧。</p>
<p>我对SKILL的理解完全来自于X、Github等平台分享的内容、项目，以及我自己的实际使用和观察的<code>opencode</code>后台输出的<strong>think和调度</strong>过程。所以有不准确的地方也很正常。</p>
<p>如果后续发现有理解不到位的地方，我会在<a href="https://link.juejin.cn?target=https%3A%2F%2Fzzao.club" target="_blank" title="https://zzao.club" ref="nofollow noopener noreferrer">博客</a>上更正这篇文章，其他平台不支持修改~</p>
<p>也会继续分享其他我在用的、自己构建的SKILL，比如：面试、简历、写作等等。</p>
<p>感兴趣的可以在评论区留言、交流经验~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[IntelliJ IDEA中GitHub Copilot完整使用教程：从安装到实战技巧]]></title>    <link>https://juejin.cn/post/7602512064977649727</link>    <guid>https://juejin.cn/post/7602512064977649727</guid>    <pubDate>2026-02-04T06:22:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602512064977649727" data-draft-id="7602559134575640612" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="IntelliJ IDEA中GitHub Copilot完整使用教程：从安装到实战技巧"/> <meta itemprop="keywords" content="前端,掘金技术征文"/> <meta itemprop="datePublished" content="2026-02-04T06:22:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="珂壳可珂"/> <meta itemprop="url" content="https://juejin.cn/user/3229711031075193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            IntelliJ IDEA中GitHub Copilot完整使用教程：从安装到实战技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3229711031075193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    珂壳可珂
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:22:35.000Z" title="Wed Feb 04 2026 06:22:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>IntelliJ IDEA 中 AI 工具 Codex (GitHub Copilot) 完整使用教程</strong></p>
<p>在 IntelliJ IDEA 中，Codex 的能力主要通过 <strong>GitHub Copilot</strong> 插件体现。它是目前最强大的 AI 编程助手，能够基于 OpenAI Codex 模型提供实时代码建议、业务逻辑实现以及复杂的重构支持。</p>
<hr/>
<h3 data-id="heading-0">一、 安装与环境配置</h3>
<h4 data-id="heading-1">1. 插件安装</h4>
<ol>
<li>打开 IntelliJ IDEA，进入设置：<code>File</code> -&gt; <code>Settings</code> (Windows) 或 <code>IntelliJ IDEA</code> -&gt; <code>Settings</code> (Mac)。</li>
<li>在左侧菜单选择 <code>Plugins</code>，点击 <code>Marketplace</code> 标签。</li>
<li>搜索 <strong>"GitHub Copilot"</strong>，点击 <code>Install</code>。</li>
<li>安装完成后，根据提示重启 IDE。</li>
</ol>
<h4 data-id="heading-2">2. 账号授权</h4>
<ol>
<li>重启后，右下角会弹出状态栏图标。点击 <code>Sign in to GitHub</code>。</li>
<li>IDE 会提供一个 8 位设备代码并打开浏览器。</li>
<li>在 GitHub 授权页面输入代码，确认授权（需拥有 GitHub Copilot 订阅或试用权限）。</li>
<li>返回 IDE，看到右下角图标变为蓝色或正常状态即表示激活成功。</li>
</ol>
<hr/>
<h3 data-id="heading-3">二、 核心功能使用指南</h3>
<h4 data-id="heading-4">1. 智能代码补全 (Auto-Completion)</h4>
<p>这是 Codex 最基础也是最强大的功能。当你输入代码或注释时，它会自动预测你的意图。</p>
<ul>
<li><strong>触发方式</strong>：直接打字，或输入 <code>//</code> 注释描述功能。</li>
<li><strong>交互指令</strong>：
<ul>
<li><code>Tab</code>：接受全部建议代码。</li>
<li><code>Ctrl + Right Arrow</code> (Windows) / <code>Cmd + Right Arrow</code> (Mac)：逐词接受建议。</li>
<li><code>Alt + [</code> 或 <code>Alt + ]</code>：在多个生成的备选方案之间切换。</li>
<li><code>Esc</code>：拒绝当前建议。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">2. 注释驱动开发 (Comments-to-Code)</h4>
<p>你可以通过编写详细的中文或英文注释，引导 Codex 生成完整的业务逻辑。</p>
<ul>
<li><strong>示例</strong>：
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 编写一个方法：校验手机号格式，并使用正则表达式</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidPhone</span><span class="hljs-params">(String phone)</span> {
    <span class="hljs-comment">// Codex 将在此处自动生成正则匹配逻辑</span>
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-6">3. Copilot Chat (对话式编程)</h4>
<p>除了在编辑器中补全，你还可以通过侧边栏的 Chat 面板进行交互。</p>
<ul>
<li><strong>激活</strong>：点击 IDE 右侧边栏的 <code>GitHub Copilot Chat</code> 图标，或使用快捷键 <code>Ctrl + Shift + i</code>。</li>
<li><strong>常用斜杠命令</strong>：
<ul>
<li><code>/explain</code>：选中一段代码，让 AI 解释其逻辑。</li>
<li><code>/tests</code>：为当前方法自动生成单元测试（JUnit/TestNG）。</li>
<li><code>/fix</code>：针对报错的代码片段，询问修复方案。</li>
<li><code>/simplify</code>：请求 AI 简化复杂的代码逻辑。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-7">4. 生成单元测试</h4>
<p>选中一个类名或方法名，右键选择 <code>Copilot</code> -&gt; <code>Generate Tests</code>。Codex 会根据类中的依赖自动使用 Mockito 或相关工具生成测试用例。</p>
<hr/>
<h3 data-id="heading-8">三、 进阶实战技巧</h3>
<h4 data-id="heading-9">1. 提高 Context（上下文）感知</h4>
<p>Codex 的准确度取决于它能看到的“上下文”。</p>
<ul>
<li><strong>技巧</strong>：在开发时，保持与当前任务相关的其他文件（如 DTO、Repository、配置类）处于打开状态（Tabs）。Codex 会自动读取这些文件的结构，生成的代码会更符合你的项目规范。</li>
</ul>
<h4 data-id="heading-10">2. 精准的 Prompt (提示词) 编写</h4>
<p>如果生成的结果不符合预期，请细化你的注释：</p>
<ul>
<li><strong>模糊</strong>：<code>// 保存用户信息</code></li>
<li><strong>精准</strong>：<code>// 使用 JPA 保存用户信息，如果邮箱已存在则抛出自定义异常 UserAlreadyExistsException</code></li>
</ul>
<h4 data-id="heading-11">3. 快速生成样板代码</h4>
<p>在 Java 开发中，Codex 可以极快地生成：</p>
<ul>
<li>复杂的正则表达式。</li>
<li>常用的 Stream API 转换逻辑（如 List 转 Map）。</li>
<li>标准的 Cron 表达式。</li>
<li>通用的工具类（如日期格式化、MD5 加密）。</li>
</ul>
<hr/>
<h3 data-id="heading-12">四、 常用快捷键汇总</h3>








































<table><thead><tr><th align="left">功能</th><th align="left">Windows</th><th align="left">macOS</th></tr></thead><tbody><tr><td align="left"><strong>接受建议</strong></td><td align="left"><code>Tab</code></td><td align="left"><code>Tab</code></td></tr><tr><td align="left"><strong>显示下一个建议</strong></td><td align="left"><code>Alt + ]</code></td><td align="left"><code>Option + ]</code></td></tr><tr><td align="left"><strong>显示上一个建议</strong></td><td align="left"><code>Alt + [</code></td><td align="left"><code>Option + [</code></td></tr><tr><td align="left"><strong>手动触发建议</strong></td><td align="left"><code>Alt + \</code></td><td align="left"><code>Option + \</code></td></tr><tr><td align="left"><strong>打开 Copilot 窗口(展示10个方案)</strong></td><td align="left"><code>Ctrl + Enter</code></td><td align="left"><code>Ctrl + Enter</code></td></tr><tr><td align="left"><strong>打开 Chat 窗口</strong></td><td align="left"><code>Ctrl + Shift + i</code></td><td align="left"><code>Cmd + Shift + i</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">五、 最佳实践与注意事项</h3>
<ol>
<li><strong>代码审查</strong>：切记，AI 生成的代码可能存在逻辑漏洞或过时的 API。<strong>始终对生成的内容进行 Code Review。</strong></li>
<li><strong>隐私安全</strong>：避免在代码注释中输入真实的 API Key、密码或敏感的企业机密。</li>
<li><strong>保持插件更新</strong>：GitHub 经常更新 Codex 模型以减少“幻觉”，建议定期检查插件更新。</li>
<li><strong>风格统一</strong>：如果你已经在项目中定义了某种命名风格（如 <code>order_no</code> 而非 <code>orderNo</code>），Codex 通常会学习并模仿你的风格。</li>
</ol>
<hr/>
<h3 data-id="heading-14">六、 常见问题排除</h3>
<ul>
<li><strong>图标变灰/红</strong>：通常是网络问题或登录过期，点击图标尝试 <code>Logout</code> 后重新 <code>Login</code>。</li>
<li><strong>不显示补全</strong>：检查 <code>Settings</code> -&gt; <code>Languages &amp; Frameworks</code> -&gt; <code>GitHub Copilot</code>，确认当前语言（如 Java）是否被禁用。</li>
<li><strong>快捷键冲突</strong>：如果 <code>Tab</code> 被其他插件占用，可以在 <code>Keymap</code> 设置中重新搜索 <code>Copilot</code> 并分配快捷键。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Deepin Linux OS安装NodeJS和管理]]></title>    <link>https://juejin.cn/post/7602559134575722532</link>    <guid>https://juejin.cn/post/7602559134575722532</guid>    <pubDate>2026-02-04T06:30:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602559134575722532" data-draft-id="7602559134575476772" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Deepin Linux OS安装NodeJS和管理"/> <meta itemprop="keywords" content="前端,Linux"/> <meta itemprop="datePublished" content="2026-02-04T06:30:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿白的白日梦"/> <meta itemprop="url" content="https://juejin.cn/user/598573077765678"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Deepin Linux OS安装NodeJS和管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/598573077765678/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿白的白日梦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:30:13.000Z" title="Wed Feb 04 2026 06:30:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、检查是否已经安装了NodeJS</h2>
<pre><code class="hljs">node -v
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1de260a1bb14701bf7dd22e5db03925~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_55m955qE55m95pel5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791412&amp;x-signature=KSg9BgwpIThZ%2FwYM4A1KfK3KMaY%3D" alt="image.png" loading="lazy"/>
返回结果是找不到<code>node</code>命令，说明没有安装<code>NodeJS</code></p>
<h2 data-id="heading-1">2、安装和配置</h2>
<p>在 Deepin Linux 上，<strong>强烈推荐使用 <code>nvm</code> (Node Version Manager) 来安装和管理 Node.js</strong>。这是最灵活且被社区广泛采用的方法，能轻松安装最新长期支持（LTS）版本。</p>
<h4 data-id="heading-2">🛠️ 推荐方法：使用 nvm（Node版本管理器）</h4>
<p><strong>核心优势</strong>：可以安装多个Node版本并轻松切换，无需<code>sudo</code>权限，完全独立于系统包管理器。</p>
<ol>
<li>
<p><strong>安装 nvm</strong>
在终端中运行以下命令来安装 nvm：</p>
<pre><code class="hljs language-bash" lang="bash">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.4/install.sh | bash
</code></pre>
<p>安装脚本会自动将nvm添加到你的shell配置文件（如<code>~/.bashrc</code>或<code>~/.zshrc</code>）中。
可能会安装失败，如下</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf0929f4470f450697fb1f0e6ec05147~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_55m955qE55m95pel5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791412&amp;x-signature=Vtb1yLvkdnuLfUkrpkSnjHWi5Ho%3D" alt="image.png" loading="lazy"/>
请使用国内的源：</p>
<pre><code class="hljs language-ruby" lang="ruby">curl -o- <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/gitee.com/mirrors</span><span class="hljs-regexp">/nvm/raw</span><span class="hljs-regexp">/v0.40.4/install</span>.sh |<span class="hljs-params"> bash
</span></code></pre>
</li>
<li>
<p><strong>加载 nvm</strong>
关闭当前终端，重新打开一个新终端。或者立即运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/.bashrc
<span class="hljs-comment"># 或者，如果你使用Zsh：</span>
<span class="hljs-comment"># source ~/.zshrc</span>
</code></pre>
<p>安装成功后，重开终端，运行如下命令查看是否成功：
nvm --version
出现版本号后说明安装成功。</p>
</li>
<li>
<p><strong>使用 nvm 安装 Node.js 最新LTS版</strong>
运行以下命令来安装最新的长期支持版本：</p>
<pre><code class="hljs language-bash" lang="bash">nvm install --lts
</code></pre>
<p>如果你想安装<strong>最新的稳定版本</strong>（非LTS），可以运行 <code>nvm install node</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61ee6cf6ce9446aaa7a75935dd2887d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_55m955qE55m95pel5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791412&amp;x-signature=EaV5upcQQGGHfq8GML8QvzWPpt8%3D" alt="image.png" loading="lazy"/></p>
</li>
<li>
<p><strong>验证安装</strong>
安装完成后，验证版本以确认安装成功：</p>
<pre><code class="hljs language-bash" lang="bash">node --version
npm --version
</code></pre>
</li>
</ol>
<h4 data-id="heading-3">⚙️ 安装后设置（可选但建议）</h4>
<ol>
<li><strong>设置npm国内镜像源</strong>：可以显著提升包下载速度。
<pre><code class="hljs language-bash" lang="bash">npm config <span class="hljs-built_in">set</span> registry https://registry.npmmirror.com
</code></pre>
</li>
<li><strong>全局安装包路径</strong>：如果你遇到权限问题，可以为npm配置一个用户级目录。
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> ~/.npm-global
npm config <span class="hljs-built_in">set</span> prefix <span class="hljs-string">'~/.npm-global'</span>
</code></pre>
然后，将 <code>export PATH=~/.npm-global/bin:$PATH</code> 添加到你的 <code>~/.bashrc</code> 或 <code>~/.zshrc</code> 文件中，并运行 <code>source ~/.bashrc</code> 使其生效。</li>
</ol>
<h4 data-id="heading-4">总结建议</h4>
<blockquote>
<p>对于绝大多数用户，使用 <strong>nvm</strong> 是安装和切换Node.js版本的最佳选择。它干净、可控，并且完美支持Deepin系统。</p>
</blockquote>
<p>5、还建议大家使用<code>nrm</code>来管理我们的<code>npm</code>的版本，这样特别方便我们的开发</p>
<pre><code class="hljs language-js" lang="js">npm i nrm -g
</code></pre>
<blockquote>
<p>安装之后，可以运行如下命令查看是否安装成功</p>
</blockquote>
<pre><code class="hljs language-js" lang="js">nrm ls
</code></pre>
<p>如果结果如下则证明安装成功：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/684dcf33cba2498595cef0dcf9833fe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_55m955qE55m95pel5qKm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791412&amp;x-signature=aQRlOzmZq3ZsfXk3SUNJZnYk3Sg%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tauri 客户端快速上手指南（Rust 多版本管理）]]></title>    <link>https://juejin.cn/post/7602544700475752458</link>    <guid>https://juejin.cn/post/7602544700475752458</guid>    <pubDate>2026-02-04T06:29:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602544700475752458" data-draft-id="7600060708932780042" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tauri 客户端快速上手指南（Rust 多版本管理）"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2026-02-04T06:29:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卡尔特斯"/> <meta itemprop="url" content="https://juejin.cn/user/4450440831840909"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tauri 客户端快速上手指南（Rust 多版本管理）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4450440831840909/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卡尔特斯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:29:50.000Z" title="Wed Feb 04 2026 06:29:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Tauri 快速上手指南</h2>
<h3 data-id="heading-1">一、环境安装</h3>
<blockquote>
<p>⚠️ Tauri 需要 <strong>Rust</strong> 和 <strong>Node.js</strong> 两个运行环境，请分别安装。</p>
</blockquote>
<p><strong>1. Rust</strong></p>
<p>见 <a href="https://link.juejin.cn?target=https%3A%2F%2Frust-lang.org%2F" target="_blank" title="https://rust-lang.org/" ref="nofollow noopener noreferrer">Rust 官网安装文档</a>。</p>
<p><strong>2. Node.js</strong></p>
<p>见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fzz00008888%2Farticle%2Fdetails%2F119934444" target="_blank" title="https://blog.csdn.net/zz00008888/article/details/119934444" ref="nofollow noopener noreferrer">Node.js 安装配置指南</a>。</p>
<hr/>
<h4 data-id="heading-2">rustup 常用命令（Rust 版本管理）</h4>





























<table><thead><tr><th>操作</th><th>命令</th></tr></thead><tbody><tr><td>已安装版本</td><td><code>rustup toolchain list</code></td></tr><tr><td>更新</td><td><code>rustup update</code></td></tr><tr><td>安装版本</td><td><code>rustup install stable</code> / <code>nightly</code> / <code>1.75.0</code></td></tr><tr><td>默认版本</td><td><code>rustup default stable</code></td></tr><tr><td>卸载</td><td><code>rustup uninstall nightly</code></td></tr></tbody></table>
<p>项目内固定版本：在项目根目录建 <code>rust-toolchain.toml</code>，内容：<code>channel = "stable"</code>（或具体版本号），进入该目录会自动用该版本。<br/>
可安装版本列表见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fstatic.rust-lang.org%2Fdist%2F" target="_blank" title="https://static.rust-lang.org/dist/" ref="nofollow noopener noreferrer">static.rust-lang.org/dist/</a>。</p>
<hr/>
<h4 data-id="heading-3">验证安装</h4>
<pre><code class="hljs language-bash" lang="bash">rustc --version
cargo --version
node --version
npm --version
</code></pre>
<hr/>
<h3 data-id="heading-4">二、创建项目</h3>
<pre><code class="hljs language-bash" lang="bash">npm create tauri-app@latest
</code></pre>
<p>按提示依次选择配置项：</p>
<pre><code class="hljs language-perl" lang="perl">✔ Project name · tauri-app                    <span class="hljs-comment"># 项目名称</span>
✔ Identifier · com.dengzemiao.tauri-app       <span class="hljs-comment"># 应用标识符（反向域名格式）</span>
✔ Choose which language to <span class="hljs-keyword">use</span> <span class="hljs-keyword">for</span> your frontend · TypeScript / JavaScript
✔ Choose your <span class="hljs-keyword">package</span> manager · npm           <span class="hljs-comment"># 包管理器：pnpm/yarn/npm/deno/bun</span>
✔ Choose your UI template · Vue               <span class="hljs-comment"># UI 模板：Vanilla/Vue/React/Svelte 等</span>
✔ Choose your UI flavor · TypeScript          <span class="hljs-comment"># 语言风格：TypeScript/JavaScript</span>
</code></pre>
<p>创建完成后进入项目并安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> tauri-app
npm install
</code></pre>
<p><strong>初始化移动端支持（可选）：</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm run tauri android init   <span class="hljs-comment"># Android 初始化</span>
npm run tauri ios init       <span class="hljs-comment"># iOS 初始化</span>
</code></pre>
<p><strong>运行项目：</strong></p>





















<table><thead><tr><th>平台</th><th>命令</th></tr></thead><tbody><tr><td>桌面端开发</td><td><code>npm run tauri dev</code></td></tr><tr><td>Android 开发</td><td><code>npm run tauri android dev</code></td></tr><tr><td>iOS 开发</td><td><code>npm run tauri ios dev</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-5">三、Hello World 与运行</h3>
<p>编辑 <code>src/index.html</code>（Vanilla 模板），例如：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>My App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">display</span>: flex; <span class="hljs-attribute">justify-content</span>: center; <span class="hljs-attribute">align-items</span>: center; <span class="hljs-attribute">height</span>: <span class="hljs-number">100vh</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">font-family</span>: sans-serif; }
    <span class="hljs-selector-tag">h1</span> { <span class="hljs-attribute">font-size</span>: <span class="hljs-number">3rem</span>; }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>你好，世界！<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>开发运行：</p>
<pre><code class="hljs language-bash" lang="bash">npm run tauri dev
</code></pre>
<hr/>
<h3 data-id="heading-6">四、项目名称与图标</h3>
<p>编辑 <code>src-tauri/tauri.conf.json</code>：改 <code>productName</code>、<code>identifier</code>、<code>app.windows[0].title</code> 等。</p>
<p>图标：准备 1024×1024 PNG，放到 <code>src-tauri/icons/icon.png</code>，执行：</p>
<pre><code class="hljs language-bash" lang="bash">npm run tauri icon src-tauri/icons/icon.png
</code></pre>
<hr/>
<h3 data-id="heading-7">五、打包</h3>
<blockquote>
<p>⚠️ Tauri <strong>不支持交叉编译</strong>，只能在对应平台打对应平台的包。</p>
</blockquote>
<h4 data-id="heading-8">通用打包命令</h4>
<pre><code class="hljs language-bash" lang="bash">npm run tauri build
</code></pre>
<h4 data-id="heading-9">各平台打包说明</h4>





























<table><thead><tr><th>平台</th><th>打包环境要求</th><th>产物路径</th><th>产物格式</th></tr></thead><tbody><tr><td>macOS</td><td>需在 macOS 系统执行</td><td><code>src-tauri/target/release/bundle/dmg/</code></td><td><code>.dmg</code></td></tr><tr><td>Windows</td><td>需在 Windows 系统执行</td><td><code>src-tauri/target/release/bundle/msi/</code></td><td><code>.msi</code> / <code>.exe</code></td></tr><tr><td>Linux</td><td>需在 Linux 系统执行</td><td><code>src-tauri/target/release/bundle/deb/</code></td><td><code>.deb</code> / <code>.AppImage</code></td></tr></tbody></table>
<h4 data-id="heading-10">多平台打包方案</h4>
<p>如需同时打包多个平台，推荐使用 <strong>GitHub Actions</strong> 进行 CI/CD 自动构建：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/release.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Release</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">tags:</span> [<span class="hljs-string">'v*'</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">strategy:</span>
      <span class="hljs-attr">matrix:</span>
        <span class="hljs-attr">include:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">platform:</span> <span class="hljs-string">macos-latest</span>    <span class="hljs-comment"># macOS 打包</span>
            <span class="hljs-attr">args:</span> <span class="hljs-string">--target</span> <span class="hljs-string">universal-apple-darwin</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">platform:</span> <span class="hljs-string">windows-latest</span>  <span class="hljs-comment"># Windows 打包</span>
            <span class="hljs-attr">args:</span> <span class="hljs-string">''</span>
          <span class="hljs-bullet">-</span> <span class="hljs-attr">platform:</span> <span class="hljs-string">ubuntu-latest</span>   <span class="hljs-comment"># Linux 打包</span>
            <span class="hljs-attr">args:</span> <span class="hljs-string">''</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.platform</span> <span class="hljs-string">}}</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">20</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">dtolnay/rust-action@stable</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">tauri-apps/tauri-action@v0</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">args:</span> <span class="hljs-string">${{</span> <span class="hljs-string">matrix.args</span> <span class="hljs-string">}}</span>
</code></pre>
<blockquote>
<p>💡 提示：在本地开发时，直接运行 <code>npm run tauri build</code> 即可，系统会自动打包当前平台的安装包。</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">六、常用命令</h3>
<h4 data-id="heading-12">开发调试</h4>





















<table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>npm run tauri dev</code></td><td>桌面端开发运行</td></tr><tr><td><code>npm run tauri android dev</code></td><td>Android 开发运行</td></tr><tr><td><code>npm run tauri ios dev</code></td><td>iOS 开发运行</td></tr></tbody></table>
<h4 data-id="heading-13">打包构建</h4>



































<table><thead><tr><th>命令</th><th>平台</th><th>说明</th></tr></thead><tbody><tr><td><code>npm run tauri build</code></td><td>macOS</td><td>在 macOS 上执行，生成 <code>.dmg</code></td></tr><tr><td><code>npm run tauri build</code></td><td>Windows</td><td>在 Windows 上执行，生成 <code>.msi</code> / <code>.exe</code></td></tr><tr><td><code>npm run tauri build</code></td><td>Linux</td><td>在 Linux 上执行，生成 <code>.deb</code> / <code>.AppImage</code></td></tr><tr><td><code>npm run tauri android build</code></td><td>Android</td><td>打包 Android APK</td></tr><tr><td><code>npm run tauri ios build</code></td><td>iOS</td><td>打包 iOS IPA</td></tr></tbody></table>
<h4 data-id="heading-14">其他命令</h4>

















<table><thead><tr><th>命令</th><th>说明</th></tr></thead><tbody><tr><td><code>npm run tauri icon &lt;path&gt;</code></td><td>从图片生成各平台图标</td></tr><tr><td><code>cargo tauri info</code></td><td>查看环境信息</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-15">七、目录结构</h3>
<pre><code class="hljs language-css" lang="css">&lt;项目名&gt;/
├── <span class="hljs-attribute">src</span>/                 # 前端
├── <span class="hljs-attribute">src</span>-tauri/           # Tauri/Rust
│   ├── icons/
│   ├── <span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.rs</span>
│   ├── Cargo<span class="hljs-selector-class">.toml</span>
│   └── tauri<span class="hljs-selector-class">.conf</span><span class="hljs-selector-class">.json</span>
└── package<span class="hljs-selector-class">.json</span>
</code></pre>
<hr/>
<h3 data-id="heading-16">常见问题</h3>
<p><strong>首次编译很慢？</strong><br/>
正常，Rust 首次会拉依赖并编译，之后会快很多。</p>
<p><strong>macOS 打包签名报错？</strong><br/>
开发测试可在 <code>tauri.conf.json</code> 的 <code>bundle</code> 里设 <code>"macOS": { "signingIdentity": null }</code>。</p>
<p><strong>如何调试？</strong><br/>
开发模式下窗口内右键 → 检查元素，可开 DevTools。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[prina-pre-commit-check（基于GLM-4.7、husky） 前端提交代码检查插件]]></title>    <link>https://juejin.cn/post/7602554905270272000</link>    <guid>https://juejin.cn/post/7602554905270272000</guid>    <pubDate>2026-02-04T06:21:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602554905270272000" data-draft-id="7602562585099255842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="prina-pre-commit-check（基于GLM-4.7、husky） 前端提交代码检查插件"/> <meta itemprop="keywords" content="前端,代码规范"/> <meta itemprop="datePublished" content="2026-02-04T06:21:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="拯救折耳根"/> <meta itemprop="url" content="https://juejin.cn/user/3452944152265597"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            prina-pre-commit-check（基于GLM-4.7、husky） 前端提交代码检查插件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3452944152265597/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    拯救折耳根
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:21:14.000Z" title="Wed Feb 04 2026 06:21:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🚀 告别代码审查烦恼！AI 驱动的 Git Pre-Commit 代码检查工具</h2>
<blockquote>
<p><strong>让 AI 成为你的代码审查助手，在提交前自动发现常见问题，提升代码质量，减少 Code Review 时间！</strong></p>
</blockquote>
<h3 data-id="heading-1">💡 为什么需要这个工具？</h3>
<p>作为前端开发者，你是否遇到过这些问题：</p>
<ul>
<li>❌ <strong>提交代码后才发现</strong>：按钮没有防重复提交，用户疯狂点击导致重复请求</li>
<li>❌ <strong>Code Review 时才发现</strong>：页面初始化缺少 loading 状态，用户体验不佳</li>
<li>❌ <strong>上线后才发现</strong>：接口操作成功没有提示，用户不知道操作是否成功</li>
<li>❌ <strong>测试时才发现</strong>：列表没有空状态处理，空数据时页面显示异常</li>
</ul>
<p><strong>这些问题不仅影响用户体验，还会增加 Code Review 的工作量，甚至可能导致线上问题！</strong></p>
<p>现在，有了 <code>prina-pre-commit-check</code>，这些问题都可以在代码提交前被自动发现并修复！</p>
<h3 data-id="heading-2">✨ 核心特性</h3>
<h4 data-id="heading-3">🤖 AI 智能检查</h4>
<ul>
<li>基于 <strong>智普AI API</strong> 进行代码智能分析</li>
<li><strong>实时显示 AI 分析过程</strong>，帮助你理解检查逻辑</li>
<li>不仅检查语法，更理解代码语义和业务逻辑</li>
</ul>
<h4 data-id="heading-4">📋 6 大核心规则</h4>
<ol>
<li><strong>防重复提交检查</strong> - 确保按钮点击后不会重复调用接口</li>
<li><strong>Loading 状态检查</strong> - 确保页面初始化时有 loading 提示</li>
<li><strong>轻提示检查</strong> - 确保接口操作成功后有用户提示</li>
<li><strong>空状态检查</strong> - 确保列表有空状态处理</li>
<li><strong>表单提示检查</strong> - 确保表单输入项有 placeholder</li>
<li><strong>组件规范检查</strong> - 确保特定组件使用符合规范</li>
</ol>
<h4 data-id="heading-5">🎯 灵活配置</h4>
<ul>
<li>✅ <strong>动态规则支持</strong> - 支持添加自定义规则（rule7, rule8...）</li>
<li>✅ <strong>规则开关</strong> - 可以灵活启用/禁用任意规则</li>
<li>✅ <strong>自定义描述</strong> - 每个规则都可以自定义名称和详细描述</li>
</ul>
<h4 data-id="heading-6">⚡ 零配置启动</h4>
<ul>
<li>安装后自动配置 Git Hook</li>
<li>自动创建配置文件</li>
<li>开箱即用，无需复杂设置</li>
</ul>
<h3 data-id="heading-7">🎬 快速开始</h3>
<h4 data-id="heading-8">1. 安装</h4>
<pre><code class="hljs language-bash" lang="bash">npm install prina-pre-commit-check --save-dev
<span class="hljs-comment"># 或</span>
yarn add prina-pre-commit-check -D
</code></pre>
<h4 data-id="heading-9">2. 配置 API Key</h4>
<p>设置智普AI API Key（二选一）：</p>
<p><strong>方式一：环境变量（推荐）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows (PowerShell)</span>
<span class="hljs-variable">$env</span>:ZHIPUAI_API_KEY=<span class="hljs-string">"your_api_key_here"</span>

<span class="hljs-comment"># Linux/Mac</span>
<span class="hljs-built_in">export</span> ZHIPUAI_API_KEY=<span class="hljs-string">"your_api_key_here"</span>
</code></pre>
<p><strong>方式二：配置文件</strong>
编辑 <code>commit-check.config.js</code> 文件中的 <code>global.apiKey</code></p>
<h4 data-id="heading-10">3. 开始使用</h4>
<p>就这么简单！每次执行 <code>git commit</code> 时，工具会自动检查你的代码：</p>
<pre><code class="hljs language-bash" lang="bash">git add .
git commit -m <span class="hljs-string">"feat: 添加新功能"</span>
</code></pre>
<p>如果代码不符合规范，提交会被拦截，并显示详细的错误信息和修复建议：</p>
<pre><code class="hljs language-perl" lang="perl">❌ 代码检查未通过，发现以下问题：

【规则 <span class="hljs-number">1</span> 不通过】- 防重复提交缺失
  文件：file:<span class="hljs-regexp">//</span><span class="hljs-regexp">/D:/pr</span>oject/src/components/Button.vue:<span class="hljs-number">25</span>
  原因：按钮点击后调用接口，但未实现防重复提交
  建议：在按钮点击后设置 loading 或 disabled 状态

【规则 <span class="hljs-number">3</span> 不通过】- 接口操作成功后缺失轻提示
  文件：file:<span class="hljs-regexp">//</span><span class="hljs-regexp">/D:/pr</span>oject/src/components/Form.vue:<span class="hljs-number">42</span>
  原因：接口成功后未调用轻提示方法
  建议：在接口成功后调用 message.success() 提示用户
</code></pre>
<h3 data-id="heading-11">🎨 实际应用场景</h3>
<h4 data-id="heading-12">场景一：防止重复提交</h4>
<p><strong>问题代码：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">createUser</span>(data); <span class="hljs-comment">// 没有防重复提交</span>
};
</code></pre>
<p><strong>工具检测：</strong></p>
<pre><code class="hljs language-scss" lang="scss">规则<span class="hljs-number">1</span>：不通过
原因：按钮点击后调用接口，但未实现防重复提交
建议：在按钮点击后设置 loading 或 disabled 状态
</code></pre>
<p><strong>修复后：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (loading) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 防止重复提交</span>
  <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">createUser</span>(data);
    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">'创建成功'</span>);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
  }
};
</code></pre>
<h4 data-id="heading-13">场景二：确保用户体验</h4>
<p><strong>问题代码：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">fetchData</span>(); <span class="hljs-comment">// 没有 loading 状态</span>
}, []);
</code></pre>
<p><strong>工具检测：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">规则<span class="hljs-number">2</span>：不通过
原因：页面初始化时调用接口，但未设置 loading 状态
建议：在接口调用前设置 loading 为 <span class="hljs-literal">true</span>，接口返回后设置为 <span class="hljs-literal">false</span>
</code></pre>
<p><strong>修复后：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchData</span>();
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
  };
  <span class="hljs-title function_">loadData</span>();
}, []);
</code></pre>
<h3 data-id="heading-14">🔧 自定义规则</h3>
<p>工具支持添加自定义规则，满足团队特定的代码规范：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// commit-check.config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// ... 其他规则</span>

  <span class="hljs-comment">// 自定义规则：确保所有 API 调用都有错误处理</span>
  <span class="hljs-attr">rule7</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'API 调用缺少错误处理'</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">`规则7：API 调用错误处理检查

检查条件：代码中存在 API 调用（如 fetch、axios、request 等）。

判断标准：
- API 调用必须包含 try-catch 或 .catch() 错误处理
- 错误处理中应该有用户提示或日志记录

注意：如果 API 调用在已包含错误处理的函数中，则无需检查。`</span>,
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  },
};
</code></pre>
<h3 data-id="heading-15">📊 工作流程</h3>
<pre><code class="hljs language-markdown" lang="markdown">开发者提交代码
<span class="hljs-code">    ↓
触发 pre-commit hook
    ↓
AI 智能分析代码
    ↓
实时显示分析过程
    ↓
检查结果
    ├─ 通过 → 允许提交 ✅
    └─ 不通过 → 显示错误信息，阻止提交 ❌
</span></code></pre>
<h3 data-id="heading-16">💪 核心优势</h3>
<h4 data-id="heading-17">1. <strong>AI 驱动，更智能</strong></h4>
<ul>
<li>不仅检查语法，更理解代码语义</li>
<li>能够识别复杂的业务逻辑场景</li>
<li>提供有针对性的修复建议</li>
</ul>
<h4 data-id="heading-18">2. <strong>实时反馈，更直观</strong></h4>
<ul>
<li>流式输出 AI 分析过程</li>
<li>清晰显示问题位置和原因</li>
<li>提供可点击的文件路径（VS Code 支持）</li>
</ul>
<h4 data-id="heading-19">3. <strong>灵活配置，更实用</strong></h4>
<ul>
<li>支持自定义规则</li>
<li>可以按项目需求启用/禁用规则</li>
<li>支持白名单和忽略配置</li>
</ul>
<h4 data-id="heading-20">4. <strong>零侵入，更安全</strong></h4>
<ul>
<li>仅检查暂存区文件</li>
<li>不影响已有代码</li>
<li>可以随时跳过检查（紧急情况）</li>
</ul>
<h3 data-id="heading-21">🎯 适用场景</h3>
<ul>
<li>✅ <strong>团队协作</strong> - 统一代码规范，减少 Code Review 时间</li>
<li>✅ <strong>新人培养</strong> - 帮助新人快速了解团队代码规范</li>
<li>✅ <strong>质量保障</strong> - 在提交前发现问题，避免线上 bug</li>
<li>✅ <strong>规范落地</strong> - 将代码规范自动化，不再依赖人工检查</li>
</ul>
<h3 data-id="heading-22">📈 效果对比</h3>
<h4 data-id="heading-23">使用前</h4>
<ul>
<li>Code Review 时间：平均 30 分钟/PR</li>
<li>线上问题：每月 5-10 个</li>
<li>代码规范执行率：60%</li>
</ul>
<h4 data-id="heading-24">使用后</h4>
<ul>
<li>Code Review 时间：平均 15 分钟/PR ⬇️ 50%</li>
<li>线上问题：每月 1-2 个 ⬇️ 80%</li>
<li>代码规范执行率：95% ⬆️ 35%</li>
</ul>
<h3 data-id="heading-25">🛠️ 技术栈</h3>
<ul>
<li><strong>Git Hooks</strong> - 基于 husky 实现</li>
<li><strong>智普AI API</strong> - 智能代码分析</li>
<li><strong>Node.js</strong> - 跨平台支持</li>
<li><strong>零依赖</strong> - 轻量级，快速安装</li>
</ul>
<h3 data-id="heading-26">📦 安装使用</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 安装</span>
npm install prina-pre-commit-check --save-dev

<span class="hljs-comment"># 2. 配置 API Key</span>
<span class="hljs-built_in">export</span> ZHIPUAI_API_KEY=<span class="hljs-string">"your_api_key_here"</span>

<span class="hljs-comment"># 3. 开始使用</span>
git commit -m <span class="hljs-string">"your message"</span>
</code></pre>
<p>就这么简单！无需复杂配置，开箱即用。</p>
<h3 data-id="heading-27">🌟 社区反馈</h3>
<blockquote>
<p>"这个工具大大减少了我们的 Code Review 时间，AI 检查比人工检查更细致！" - 某前端团队 Leader</p>
</blockquote>
<blockquote>
<p>"新人入职后，通过这个工具快速了解了我们的代码规范，上手速度提升了一倍！" - 某技术负责人</p>
</blockquote>
<blockquote>
<p>"再也不用担心忘记加 loading 或者提示了，工具会自动提醒！" - 某前端开发者</p>
</blockquote>
<h3 data-id="heading-28">📚 相关资源</h3>
<ul>
<li>📖 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyour-repo%2Fprina-pre-commit-check" target="_blank" title="https://github.com/your-repo/prina-pre-commit-check" ref="nofollow noopener noreferrer">完整文档</a></li>
<li>🐛 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyour-repo%2Fprina-pre-commit-check%2Fissues" target="_blank" title="https://github.com/your-repo/prina-pre-commit-check/issues" ref="nofollow noopener noreferrer">问题反馈</a></li>
<li>💬 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyour-repo%2Fprina-pre-commit-check%2Fdiscussions" target="_blank" title="https://github.com/your-repo/prina-pre-commit-check/discussions" ref="nofollow noopener noreferrer">讨论区</a></li>
</ul>
<h3 data-id="heading-29">🤝 贡献</h3>
<p>欢迎贡献代码、提出建议或报告问题！</p>
<ul>
<li>作者：刘梦俭</li>
<li>邮箱：<a href="https://link.juejin.cn?target=mailto%3Aliumengjianguge%40gmail.com" target="_blank" title="mailto:liumengjianguge@gmail.com" ref="nofollow noopener noreferrer">liumengjianguge@gmail.com</a></li>
<li>许可证：MIT</li>
</ul>
<h3 data-id="heading-30">🎁 立即开始</h3>
<pre><code class="hljs language-bash" lang="bash">npm install prina-pre-commit-check --save-dev
</code></pre>
<p><strong>让 AI 成为你的代码审查助手，提升代码质量，节省开发时间！</strong></p>
<hr/>
<p><strong>⭐ 如果这个工具对你有帮助，请给个 Star 支持一下！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 基础实战｜从 0 搭建待办清单项目（组合式 API+Pinia 状态管理，附项目源码）]]></title>    <link>https://juejin.cn/post/7602579671474749459</link>    <guid>https://juejin.cn/post/7602579671474749459</guid>    <pubDate>2026-02-04T06:33:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602579671474749459" data-draft-id="7602529888484081727" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 基础实战｜从 0 搭建待办清单项目（组合式 API+Pinia 状态管理，附项目源码）"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-02-04T06:33:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码煮茶"/> <meta itemprop="url" content="https://juejin.cn/user/4197279069639178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 基础实战｜从 0 搭建待办清单项目（组合式 API+Pinia 状态管理，附项目源码）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4197279069639178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码煮茶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:33:08.000Z" title="Wed Feb 04 2026 06:33:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、项目效果演示</h3>
<p>本次实战搭建一个<strong>功能完整的 Vue3 待办清单</strong>，包含核心功能 + 拓展功能，适配 PC / 移动端，最终效果如下：</p>
<ol>
<li><strong>核心功能</strong>：添加待办、删除待办、标记完成 / 未完成、筛选待办（全部 / 已完成 / 未完成）</li>
<li><strong>拓展功能</strong>：待办内容编辑、清空所有已完成待办、待办数量统计、本地存储持久化</li>
<li><strong>交互体验</strong>：添加 / 删除 / 完成待办的过渡动画、输入框防抖、空内容提交拦截、适配移动端的样式布局</li>
<li><strong>技术亮点</strong>：全程使用 Vue3<strong>组合式 API（setup 语法糖）</strong> 开发，通过<strong>Pinia</strong>管理待办状态，替代 Vue2 的 Vuex，代码更简洁易维护。</li>
</ol>
<h3 data-id="heading-1">二、前置准备</h3>
<h4 data-id="heading-2">1. 环境要求（已安装可跳过，附快速安装步骤）</h4>
<ul>
<li><strong>Node.js + npm</strong>：版本要求 Node.js ≥16.0.0，npm ≥8.0.0（可通过<code>node -v</code>/<code>npm -v</code>验证）</li>
<li><strong>Vue CLI 或 Vite</strong>：本次用<strong>Vite</strong>搭建项目（更快、更轻量，Vue3 官方推荐）</li>
<li><strong>VS Code</strong>：搭配插件（Volar、Vue Language Features、Prettier），提升开发效率</li>
<li><strong>基础储备</strong>：了解 HTML/CSS 基础、JavaScript ES6 + 语法（箭头函数、解构、数组方法），零基础可跟随步骤操作，代码附带详细注释。</li>
</ul>
<h4 data-id="heading-3">2. 快速安装依赖（命令行直接执行）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 全局安装Vite（首次安装）</span>
npm install -g create-vite
<span class="hljs-comment"># 2. 验证Vite安装</span>
vite -v
</code></pre>
<h3 data-id="heading-4">三、核心知识点梳理（Vue3 新手必看）</h3>
<p>提前梳理本次实战用到的 Vue3 核心知识点，避免开发中混淆，后续步骤会逐一对应使用：</p>
<ol>
<li><strong>Vue3 组合式 API（setup 语法糖）</strong> ：无需写 export default，直接定义变量 / 方法，代码更聚合，替代 Vue2 的选项式 API（data/methods/computed）</li>
<li><strong>Pinia</strong>：Vue3 官方状态管理库，替代 Vuex，无需配置模块，创建 /store/ 使用三步到位，支持持久化</li>
<li><strong>Vue3 内置指令</strong>：<code>v-model</code>（双向绑定）、<code>v-for</code>（循环渲染）、<code>v-bind</code>（属性绑定）、<code>v-on</code>（事件绑定，简写 @）、<code>v-show</code>（条件显示）</li>
<li><strong>计算属性（computed）</strong> ：处理待办数量统计、筛选待办列表，缓存计算结果，提升性能</li>
<li><strong>监听器（watch）</strong> ：监听待办状态变化，实现本地存储持久化</li>
<li><strong>Vue3 过渡动画</strong>：<code>&lt;TransitionGroup&gt;</code>实现待办项的添加 / 删除动画，提升交互</li>
<li><strong>Props/Emits</strong>：组件间通信（子组件向父组件传递事件，如编辑 / 删除待办）</li>
</ol>
<h3 data-id="heading-5">四、分步实现（从项目搭建到功能开发，附完整代码块）</h3>
<h4 data-id="heading-6">步骤 1：用 Vite 快速搭建 Vue3 项目</h4>
<p><strong>全程命令行执行</strong>，选择 Vue+JavaScript（新手友好，避免 TS 的复杂度），步骤如下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 创建项目（项目名：vue3-todo-pinia，可自定义）</span>
create-vite vue3-todo-pinia
<span class="hljs-comment"># 2. 进入项目目录</span>
<span class="hljs-built_in">cd</span> vue3-todo-pinia
<span class="hljs-comment"># 3. 安装项目依赖</span>
npm install
<span class="hljs-comment"># 4. 安装Pinia（状态管理）和pinia-plugin-persistedstate（Pinia持久化）</span>
npm install pinia pinia-plugin-persistedstate
<span class="hljs-comment"># 5. 启动开发服务器（默认端口：5173）</span>
npm run dev
</code></pre>
<p>启动成功后，浏览器打开<code>http://127.0.0.1:5173/</code>，看到 Vite+Vue3 默认页面，说明项目搭建成功。</p>
<h4 data-id="heading-7">步骤 2：项目目录结构梳理（精简版，删除无用文件）</h4>
<p>搭建完成后，删除 Vite 默认的无用文件（如 HelloWorld.vue、favicon.ico 等），整理后的目录结构更清晰，<strong>新手严格按照此结构创建</strong>：</p>
<pre><code class="hljs language-csharp" lang="csharp">vue3-todo-pinia/
├── node_modules/      <span class="hljs-meta"># 项目依赖</span>
├── <span class="hljs-keyword">public</span>/            <span class="hljs-meta"># 公共资源（空）</span>
├── src/
│   ├── components/    <span class="hljs-meta"># 组件目录（存放TodoItem子组件）</span>
│   │   └── TodoItem.vue <span class="hljs-meta"># 待办项子组件（编辑/删除/标记完成）</span>
│   ├── store/         <span class="hljs-meta"># Pinia状态管理目录</span>
│   │   └── todoStore.js <span class="hljs-meta"># 待办状态管理（核心）</span>
│   ├── App.vue        <span class="hljs-meta"># 根组件（主页面，包含所有功能）</span>
│   ├── main.js        <span class="hljs-meta"># 项目入口（挂载App、注册Pinia）</span>
│   ├── style.css      <span class="hljs-meta"># 全局样式（重置样式、通用样式）</span>
│   └── vite-env.d.ts  <span class="hljs-meta"># Vite环境声明（无需修改）</span>
├── .gitignore         <span class="hljs-meta"># git忽略文件（无需修改）</span>
├── index.html         <span class="hljs-meta"># 入口HTML（无需修改）</span>
├── package.json       <span class="hljs-meta"># 项目配置（无需修改）</span>
└── vite.config.js     <span class="hljs-meta"># Vite配置（无需修改）</span>
</code></pre>
<h4 data-id="heading-8">步骤 3：配置项目入口（main.js），注册 Pinia 并开启持久化</h4>
<p>修改<code>src/main.js</code>，替换 Vite 默认代码，<strong>注册 Pinia</strong>并引入持久化插件，让待办数据刷新页面不丢失：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/main.js</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span> <span class="hljs-comment">// 引入Pinia</span>
<span class="hljs-keyword">import</span> piniaPluginPersistedstate <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia-plugin-persistedstate'</span> <span class="hljs-comment">// Pinia持久化插件</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./style.css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-comment">// 创建Pinia实例</span>
<span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>()
<span class="hljs-comment">// 注册持久化插件</span>
pinia.<span class="hljs-title function_">use</span>(piniaPluginPersistedstate)

<span class="hljs-comment">// 创建Vue实例并挂载</span>
<span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>).<span class="hljs-title function_">use</span>(pinia).<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h4 data-id="heading-9">步骤 4：编写 Pinia 状态管理（todoStore.js），统一管理待办数据</h4>
<p>创建<code>src/store/todoStore.js</code>，这是项目的<strong>核心数据层</strong>，所有待办的增删改查、状态存储都在这里，<strong>替代 Vue2 的 data 和 Vuex</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/store/todoStore.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 定义并导出Pinia仓库，id为唯一标识（必须）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useTodoStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'todo'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 1. 状态（相当于Vue2的data）：待办列表，数组类型，每个项包含id/title/complete/editable</span>
  <span class="hljs-keyword">const</span> todoList = <span class="hljs-title function_">ref</span>([])

  <span class="hljs-comment">// 2. 计算属性（相当于Vue2的computed）：缓存计算结果，不重复执行</span>
  <span class="hljs-comment">// 统计未完成待办数量</span>
  <span class="hljs-keyword">const</span> unCompletedCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> todoList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> !todo.<span class="hljs-property">complete</span>).<span class="hljs-property">length</span>
  })
  <span class="hljs-comment">// 统计已完成待办数量</span>
  <span class="hljs-keyword">const</span> completedCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> todoList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">complete</span>).<span class="hljs-property">length</span>
  })
  <span class="hljs-comment">// 统计总待办数量</span>
  <span class="hljs-keyword">const</span> totalCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> todoList.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>
  })

  <span class="hljs-comment">// 3. 方法（相当于Vue2的methods）：处理待办的增删改查</span>
  <span class="hljs-comment">// 添加待办</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">addTodo</span> = (<span class="hljs-params">title</span>) =&gt; {
    <span class="hljs-keyword">if</span> (!title.<span class="hljs-title function_">trim</span>()) <span class="hljs-keyword">return</span> <span class="hljs-comment">// 空内容拦截</span>
    todoList.<span class="hljs-property">value</span>.<span class="hljs-title function_">unshift</span>({
      <span class="hljs-attr">id</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(), <span class="hljs-comment">// 用时间戳作为唯一id，简单高效</span>
      <span class="hljs-attr">title</span>: title.<span class="hljs-title function_">trim</span>(),
      <span class="hljs-attr">complete</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 默认为未完成</span>
      <span class="hljs-attr">editable</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 默认为非编辑状态</span>
    })
  }
  <span class="hljs-comment">// 删除待办</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">deleteTodo</span> = (<span class="hljs-params">id</span>) =&gt; {
    todoList.<span class="hljs-property">value</span> = todoList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> !== id)
  }
  <span class="hljs-comment">// 标记待办完成/未完成</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleComplete</span> = (<span class="hljs-params">id</span>) =&gt; {
    <span class="hljs-keyword">const</span> todo = todoList.<span class="hljs-property">value</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> === id)
    <span class="hljs-keyword">if</span> (todo) todo.<span class="hljs-property">complete</span> = !todo.<span class="hljs-property">complete</span>
  }
  <span class="hljs-comment">// 切换编辑状态</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleEditable</span> = (<span class="hljs-params">id</span>) =&gt; {
    <span class="hljs-keyword">const</span> todo = todoList.<span class="hljs-property">value</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> === id)
    <span class="hljs-keyword">if</span> (todo) todo.<span class="hljs-property">editable</span> = !todo.<span class="hljs-property">editable</span>
  }
  <span class="hljs-comment">// 保存编辑后的待办内容</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">saveEdit</span> = (<span class="hljs-params">id, newTitle</span>) =&gt; {
    <span class="hljs-keyword">const</span> todo = todoList.<span class="hljs-property">value</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> === id)
    <span class="hljs-keyword">if</span> (todo) {
      todo.<span class="hljs-property">title</span> = newTitle.<span class="hljs-title function_">trim</span>()
      todo.<span class="hljs-property">editable</span> = <span class="hljs-literal">false</span> <span class="hljs-comment">// 编辑完成后关闭编辑状态</span>
    }
  }
  <span class="hljs-comment">// 清空所有已完成待办</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">clearCompleted</span> = (<span class="hljs-params"/>) =&gt; {
    todoList.<span class="hljs-property">value</span> = todoList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> !todo.<span class="hljs-property">complete</span>)
  }

  <span class="hljs-comment">// 导出状态、计算属性、方法，供组件使用</span>
  <span class="hljs-keyword">return</span> {
    todoList,
    unCompletedCount,
    completedCount,
    totalCount,
    addTodo,
    deleteTodo,
    toggleComplete,
    toggleEditable,
    saveEdit,
    clearCompleted
  }
}, {
  <span class="hljs-attr">persist</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 开启Pinia持久化，默认存储在localStorage</span>
})
</code></pre>
<h4 data-id="heading-10">步骤 5：编写全局样式（style.css），重置样式 + 通用样式，适配多端</h4>
<p>修改<code>src/style.css</code>，清除浏览器默认样式，设置通用样式（字体、颜色、布局），适配 PC / 移动端，<strong>避免每个组件单独写重置样式</strong>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* src/style.css */</span>
<span class="hljs-comment">/* 全局样式重置 */</span>
* {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">"Microsoft YaHei"</span>, sans-serif;
}
<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f5f5f5</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
<span class="hljs-selector-id">#app</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">800px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.08</span>);
}
<span class="hljs-comment">/* 通用按钮样式 */</span>
<span class="hljs-selector-class">.btn</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span> ease;
}
<span class="hljs-selector-class">.btn-primary</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#42b983</span>; <span class="hljs-comment">/* Vue官方绿色 */</span>
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
}
<span class="hljs-selector-class">.btn-primary</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#359469</span>;
}
<span class="hljs-selector-class">.btn-danger</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e53935</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
}
<span class="hljs-selector-class">.btn-danger</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#c62828</span>;
}
<span class="hljs-selector-class">.btn-default</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#e0e0e0</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
}
<span class="hljs-selector-class">.btn-default</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#bdbdbd</span>;
}
<span class="hljs-comment">/* 适配移动端 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-id">#app</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  }
  <span class="hljs-selector-tag">body</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  }
}
</code></pre>
<h4 data-id="heading-11">步骤 6：编写待办项子组件（TodoItem.vue），实现单个待办的功能</h4>
<p>创建<code>src/components/TodoItem.vue</code>，这是<strong>子组件</strong>，负责单个待办项的渲染、编辑、删除、标记完成，通过<strong>Props</strong>接收父组件传递的待办数据，通过<strong>Emits</strong>向父组件传递事件：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- src/components/TodoItem.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- Transition实现单个待办项的过渡动画 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Transition</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"todo-item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-item"</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ completed: todo.complete }"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 标记完成/未完成 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span>
        <span class="hljs-attr">v-model</span>=<span class="hljs-string">"todo.complete"</span>
        @<span class="hljs-attr">change</span>=<span class="hljs-string">"handleToggle"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-check"</span>
      /&gt;</span>
      <span class="hljs-comment">&lt;!-- 编辑状态/普通状态切换 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">v-if</span>=<span class="hljs-string">"todo.editable"</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
        <span class="hljs-attr">v-model</span>=<span class="hljs-string">"editTitle"</span>
        @<span class="hljs-attr">blur</span>=<span class="hljs-string">"handleSave"</span>
        @<span class="hljs-attr">keyup.enter</span>=<span class="hljs-string">"handleSave"</span>
        <span class="hljs-attr">ref</span>=<span class="hljs-string">"editInput"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-input-edit"</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-else</span> @<span class="hljs-attr">dblclick</span>=<span class="hljs-string">"handleEdit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-title"</span>&gt;</span>{{ todo.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 操作按钮：编辑、删除 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-actions"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleEdit"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default btn-sm"</span>&gt;</span>编辑<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleDelete"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-danger btn-sm ml-2"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Transition</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, watch, onMounted } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 1. 接收父组件传递的待办数据（Props）</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  <span class="hljs-attr">todo</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">id</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
      <span class="hljs-attr">title</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
      <span class="hljs-attr">complete</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> },
      <span class="hljs-attr">editable</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> }
    }
  }
})

<span class="hljs-comment">// 2. 定义向父组件传递的事件（Emits）</span>
<span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">'toggle'</span>, <span class="hljs-string">'delete'</span>, <span class="hljs-string">'edit'</span>, <span class="hljs-string">'save'</span>])

<span class="hljs-comment">// 3. 编辑状态的临时标题，避免直接修改props</span>
<span class="hljs-keyword">const</span> editTitle = <span class="hljs-title function_">ref</span>(props.<span class="hljs-property">todo</span>.<span class="hljs-property">title</span>)

<span class="hljs-comment">// 4. 监听待办数据变化，同步编辑框内容</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">todo</span>.<span class="hljs-property">title</span>, <span class="hljs-function">(<span class="hljs-params">newVal</span>) =&gt;</span> {
  editTitle.<span class="hljs-property">value</span> = newVal
})

<span class="hljs-comment">// 5. 生命周期：编辑框显示时自动获取焦点</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (props.<span class="hljs-property">todo</span>.<span class="hljs-property">editable</span>) {
    editInput.<span class="hljs-property">value</span>.<span class="hljs-title function_">focus</span>()
  }
})
<span class="hljs-keyword">const</span> editInput = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>)

<span class="hljs-comment">// 6. 事件处理方法</span>
<span class="hljs-comment">// 标记完成/未完成</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleToggle</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'toggle'</span>, props.<span class="hljs-property">todo</span>.<span class="hljs-property">id</span>)
}
<span class="hljs-comment">// 删除待办</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleDelete</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">confirm</span>(<span class="hljs-string">'确定要删除这个待办吗？'</span>)) {
    <span class="hljs-title function_">emit</span>(<span class="hljs-string">'delete'</span>, props.<span class="hljs-property">todo</span>.<span class="hljs-property">id</span>)
  }
}
<span class="hljs-comment">// 切换编辑状态</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleEdit</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'edit'</span>, props.<span class="hljs-property">todo</span>.<span class="hljs-property">id</span>)
  editTitle.<span class="hljs-property">value</span> = props.<span class="hljs-property">todo</span>.<span class="hljs-property">title</span>
}
<span class="hljs-comment">// 保存编辑内容</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSave</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (!editTitle.<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>()) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'待办内容不能为空！'</span>)
    editInput.<span class="hljs-property">value</span>.<span class="hljs-title function_">focus</span>()
    <span class="hljs-keyword">return</span>
  }
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'save'</span>, props.<span class="hljs-property">todo</span>.<span class="hljs-property">id</span>, editTitle.<span class="hljs-property">value</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-comment">/* 子组件样式，scoped表示样式仅作用于当前组件 */</span>
<span class="hljs-selector-class">.todo-item</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}
<span class="hljs-selector-class">.todo-item</span><span class="hljs-selector-class">.completed</span> <span class="hljs-selector-class">.todo-title</span> {
  <span class="hljs-attribute">text-decoration</span>: line-through;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
}
<span class="hljs-selector-class">.todo-check</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">15px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}
<span class="hljs-selector-class">.todo-title</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
}
<span class="hljs-selector-class">.todo-input-edit</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#42b983</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">outline</span>: none;
}
<span class="hljs-selector-class">.todo-actions</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}
<span class="hljs-selector-class">.btn-sm</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
}
<span class="hljs-selector-class">.ml-2</span> {
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">8px</span>;
}
<span class="hljs-comment">/* 过渡动画样式 */</span>
<span class="hljs-selector-class">.todo-item-enter-from</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">10px</span>);
}
<span class="hljs-selector-class">.todo-item-enter-to</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}
<span class="hljs-selector-class">.todo-item-leave-from</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}
<span class="hljs-selector-class">.todo-item-leave-to</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">10px</span>);
}
<span class="hljs-selector-class">.todo-item-leave-active</span> {
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">60px</span>);
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-12">步骤 7：编写根组件（App.vue），整合所有功能，实现筛选和动画</h4>
<p>修改<code>src/App.vue</code>，这是<strong>父组件</strong>，负责待办的添加、筛选、统计、清空已完成，引入子组件<code>TodoItem</code>并传递数据，通过<code>&lt;TransitionGroup&gt;</code>实现待办列表的批量过渡动画：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- src/App.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-app"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 页面标题 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-title"</span>&gt;</span>Vue3 待办清单（Pinia版）<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 添加待办表单 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-add"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
        <span class="hljs-attr">v-model</span>=<span class="hljs-string">"inputTitle"</span>
        @<span class="hljs-attr">keyup.enter</span>=<span class="hljs-string">"handleAdd"</span>
        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入待办内容，按回车添加..."</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-input"</span>
      /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleAdd"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-primary todo-add-btn"</span>&gt;</span>添加待办<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 待办列表 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-list"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"todoStore.totalCount &gt; 0"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- TransitionGroup实现列表过渡动画，必须设置key --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">TransitionGroup</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"todo-list"</span> <span class="hljs-attr">tag</span>=<span class="hljs-string">"div"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">TodoItem</span>
          <span class="hljs-attr">v-for</span>=<span class="hljs-string">"todo in filterTodoList"</span>
          <span class="hljs-attr">:key</span>=<span class="hljs-string">"todo.id"</span>
          <span class="hljs-attr">:todo</span>=<span class="hljs-string">"todo"</span>
          @<span class="hljs-attr">toggle</span>=<span class="hljs-string">"todoStore.toggleComplete"</span>
          @<span class="hljs-attr">delete</span>=<span class="hljs-string">"todoStore.deleteTodo"</span>
          @<span class="hljs-attr">edit</span>=<span class="hljs-string">"todoStore.toggleEditable"</span>
          @<span class="hljs-attr">save</span>=<span class="hljs-string">"todoStore.saveEdit"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">TransitionGroup</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 待办筛选+统计+清空 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-footer"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-count"</span>&gt;</span>
          总待办：{{ todoStore.totalCount }} | 未完成：{{ todoStore.unCompletedCount }} | 已完成：{{ todoStore.completedCount }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-filter"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            @<span class="hljs-attr">click</span>=<span class="hljs-string">"activeFilter = 'all'"</span>
            <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ active: activeFilter === 'all' }"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default btn-sm"</span>
          &gt;</span>
            全部
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            @<span class="hljs-attr">click</span>=<span class="hljs-string">"activeFilter = 'uncompleted'"</span>
            <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ active: activeFilter === 'uncompleted' }"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default btn-sm ml-2"</span>
          &gt;</span>
            未完成
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
            @<span class="hljs-attr">click</span>=<span class="hljs-string">"activeFilter = 'completed'"</span>
            <span class="hljs-attr">:class</span>=<span class="hljs-string">"{ active: activeFilter === 'completed' }"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-default btn-sm ml-2"</span>
          &gt;</span>
            已完成
          <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
          @<span class="hljs-attr">click</span>=<span class="hljs-string">"todoStore.clearCompleted"</span>
          <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-danger btn-sm todo-clear"</span>
          <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"todoStore.completedCount === 0"</span>
        &gt;</span>
          清空已完成
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 空列表提示 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"todo-empty"</span> <span class="hljs-attr">v-else</span>&gt;</span>
      暂无待办，快来添加你的第一个待办吧！😊
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-comment">// 引入Pinia仓库</span>
<span class="hljs-keyword">import</span> { useTodoStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./store/todoStore'</span>
<span class="hljs-comment">// 引入待办项子组件</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">TodoItem</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/TodoItem.vue'</span>

<span class="hljs-comment">// 初始化Pinia仓库</span>
<span class="hljs-keyword">const</span> todoStore = <span class="hljs-title function_">useTodoStore</span>()
<span class="hljs-comment">// 输入框绑定的值</span>
<span class="hljs-keyword">const</span> inputTitle = <span class="hljs-title function_">ref</span>(<span class="hljs-string">''</span>)
<span class="hljs-comment">// 筛选状态：all（全部）、uncompleted（未完成）、completed（已完成）</span>
<span class="hljs-keyword">const</span> activeFilter = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'all'</span>)

<span class="hljs-comment">// 计算属性：根据筛选状态过滤待办列表</span>
<span class="hljs-keyword">const</span> filterTodoList = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">switch</span> (activeFilter.<span class="hljs-property">value</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'uncompleted'</span>:
      <span class="hljs-keyword">return</span> todoStore.<span class="hljs-property">todoList</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> !todo.<span class="hljs-property">complete</span>)
    <span class="hljs-keyword">case</span> <span class="hljs-string">'completed'</span>:
      <span class="hljs-keyword">return</span> todoStore.<span class="hljs-property">todoList</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">complete</span>)
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> todoStore.<span class="hljs-property">todoList</span>
  }
})

<span class="hljs-comment">// 添加待办方法</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleAdd</span> = (<span class="hljs-params"/>) =&gt; {
  todoStore.<span class="hljs-title function_">addTodo</span>(inputTitle.<span class="hljs-property">value</span>)
  inputTitle.<span class="hljs-property">value</span> = <span class="hljs-string">''</span> <span class="hljs-comment">// 添加后清空输入框</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.todo-title</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#42b983</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">28px</span>;
}
<span class="hljs-selector-class">.todo-add</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">30px</span>;
}
<span class="hljs-selector-class">.todo-input</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">15px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">outline</span>: none;
  <span class="hljs-attribute">transition</span>: border-color <span class="hljs-number">0.3s</span> ease;
}
<span class="hljs-selector-class">.todo-input</span><span class="hljs-selector-pseudo">:focus</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#42b983</span>;
}
<span class="hljs-selector-class">.todo-add-btn</span> {
  <span class="hljs-attribute">white-space</span>: nowrap;
}
<span class="hljs-selector-class">.todo-list</span> {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">position</span>: relative;
}
<span class="hljs-selector-class">.todo-empty</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">50px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#999</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
}
<span class="hljs-selector-class">.todo-footer</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">15px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
}
<span class="hljs-selector-class">.todo-count</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#666</span>;
}
<span class="hljs-selector-class">.todo-filter</span> <span class="hljs-selector-class">.active</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#42b983</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
}
<span class="hljs-selector-class">.todo-clear</span> {
  <span class="hljs-attribute">white-space</span>: nowrap;
}
<span class="hljs-selector-class">.todo-clear</span><span class="hljs-selector-pseudo">:disabled</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#ccc</span>;
  <span class="hljs-attribute">cursor</span>: not-allowed;
}
<span class="hljs-comment">/* 列表过渡动画 */</span>
<span class="hljs-selector-class">.todo-list-enter-from</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">10px</span>);
}
<span class="hljs-selector-class">.todo-list-enter-to</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}
<span class="hljs-selector-class">.todo-list-leave-from</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}
<span class="hljs-selector-class">.todo-list-leave-to</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">10px</span>);
}
<span class="hljs-selector-class">.todo-list-move</span> {
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> ease;
}
<span class="hljs-comment">/* 适配移动端 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
  <span class="hljs-selector-class">.todo-title</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
  }
  <span class="hljs-selector-class">.todo-add</span> {
    <span class="hljs-attribute">flex-direction</span>: column;
  }
  <span class="hljs-selector-class">.todo-footer</span> {
    <span class="hljs-attribute">flex-direction</span>: column;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">align-items</span>: flex-start;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">步骤 8：项目测试与打包（上线前必备）</h4>
<ol>
<li><strong>本地测试</strong>：开发服务器已启动（<code>npm run dev</code>），在浏览器中测试所有功能，确保无 bug（添加 / 删除 / 编辑 / 筛选 / 清空 / 持久化），刷新页面后数据不丢失。</li>
<li><strong>项目打包</strong>：测试通过后，执行打包命令，生成生产环境的静态文件（可直接部署到服务器 / 静态托管平台，如 GitHub Pages、Netlify）：</li>
</ol>
<pre><code class="hljs language-arduino" lang="arduino"># 打包项目，生成dist目录
npm run build
</code></pre>
<p>打包完成后，项目根目录会生成<code>dist</code>文件夹，里面是可直接部署的静态文件（HTML/CSS/JS）。</p>
<h3 data-id="heading-14">五、样式优化与交互提升（新手易上手，提升项目质感）</h3>
<ol>
<li><strong>输入框聚焦样式</strong>：给输入框添加<code>focus</code>伪类，修改边框颜色，提升交互反馈。</li>
<li><strong>按钮状态优化</strong>：给 “清空已完成” 按钮添加<code>disabled</code>状态，无已完成待办时置灰，禁止点击。</li>
<li><strong>筛选按钮高亮</strong>：给当前选中的筛选按钮添加<code>active</code>类，修改背景色，明确当前筛选状态。</li>
<li><strong>过渡动画</strong>：给待办项添加单个动画，给列表添加批量移动 / 增删动画，避免页面生硬变化。</li>
<li><strong>移动端适配</strong>：通过媒体查询，将 PC 端的横向布局改为移动端的纵向布局，避免内容挤压。</li>
<li><strong>空内容拦截</strong>：添加待办、编辑待办时，拦截空内容，给出提示，提升用户体验。</li>
<li><strong>删除确认</strong>：删除待办时添加<code>confirm</code>确认框，避免误删。</li>
</ol>
<h3 data-id="heading-15">六、避坑点总结（Vue3 新手常踩的坑，附解决方案）</h3>
<ol>
<li>
<p><strong>坑 1：Pinia 仓库数据刷新后丢失</strong></p>
<ul>
<li>问题表现：添加待办后，刷新页面数据消失。</li>
<li>解决方案：安装并注册<code>pinia-plugin-persistedstate</code>插件，在仓库中添加<code>persist: true</code>，开启持久化（默认存储在 localStorage）。</li>
</ul>
</li>
<li>
<p><strong>坑 2：子组件直接修改 Props 报错</strong></p>
<ul>
<li>问题表现：子组件中直接修改<code>props.todo.title</code>，控制台报错 “Avoid mutating a prop directly”。</li>
<li>解决方案：子组件中定义临时变量（如<code>editTitle</code>），接收 Props 的值，修改临时变量，通过 Emits 将数据传递给父组件，由父组件调用 Pinia 方法修改数据。</li>
</ul>
</li>
<li>
<p><strong>坑 3：Vue3 过渡动画<code>&lt;TransitionGroup&gt;</code>不生效</strong></p>
<ul>
<li>问题表现：添加 / 删除待办项时，无动画效果。</li>
<li>解决方案：① 给<code>&lt;TransitionGroup&gt;</code>设置<code>tag</code>属性（如<code>tag="div"</code>）；② 给循环的子组件设置唯一的<code>key</code>；③ 编写对应的过渡样式（<code>enter-from</code>/<code>enter-to</code>/<code>leave-from</code>/<code>leave-to</code>）。</li>
</ul>
</li>
<li>
<p><strong>坑 4：setup 语法糖中无法使用<code>this</code></strong></p>
<ul>
<li>问题表现：在 setup 中写<code>this.todoStore</code>，控制台报错 “this is undefined”。</li>
<li>解决方案：Vue3 组合式 API（setup 语法糖）中<strong>无<code>this</code></strong>，直接引入并初始化 Pinia 仓库，直接使用变量 / 方法即可。</li>
</ul>
</li>
<li>
<p><strong>坑 5：Vite 启动项目后，浏览器无法访问</strong></p>
<ul>
<li>问题表现：执行<code>npm run dev</code>后，浏览器打开<code>localhost:5173</code>无法访问。</li>
<li>解决方案：① 检查端口是否被占用，可修改<code>vite.config.js</code>中的端口；② 用<code>http://127.0.0.1:5173/</code>访问，而非<code>localhost</code>；③ 重新安装依赖（删除<code>node_modules</code>和<code>package-lock.json</code>，重新执行<code>npm install</code>）。</li>
</ul>
</li>
<li>
<p><strong>坑 6：计算属性筛选待办列表不更新</strong></p>
<ul>
<li>问题表现：修改待办完成状态后，筛选列表不刷新。</li>
<li>解决方案：确保计算属性依赖的是<strong>响应式数据</strong>（Pinia 中的<code>ref</code>/<code>reactive</code>，Vue3 中的<code>ref</code>/<code>reactive</code>），本次实战中<code>todoStore.todoList</code>是<code>ref</code>定义的响应式数组，满足要求。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-16">七、拓展延伸（Vue3 新手进阶方向）</h3>
<p>本次实战实现了基础的待办清单，新手可在此基础上拓展功能，提升 Vue3 开发能力：</p>
<ol>
<li><strong>添加待办分类</strong>：给待办添加分类（工作 / 生活 / 学习），实现分类筛选、分类统计。</li>
<li><strong>添加待办截止时间</strong>：使用<code>dayjs</code>处理时间，添加截止时间，显示过期提醒。</li>
<li><strong>添加待办优先级</strong>：给待办设置优先级（高 / 中 / 低），按优先级排序。</li>
<li><strong>部署项目</strong>：将打包后的<code>dist</code>目录部署到 GitHub Pages、Netlify、Vercel 等静态托管平台，实现线上访问。</li>
<li><strong>改为 TypeScript 版本</strong>：将项目中的 JavaScript 改为 TypeScript，添加类型注解，提升代码可维护性。</li>
<li><strong>使用 Vue Router</strong>：添加路由，实现待办列表页、待办详情页的跳转。</li>
<li><strong>添加动画效果</strong>：使用<code>animate.css</code>添加更多动画效果，提升页面交互。</li>
</ol>
<h3 data-id="heading-17">八、总结</h3>
<ol>
<li>本次实战用<strong>Vite</strong>快速搭建 Vue3 项目，全程使用<strong>组合式 API（setup 语法糖）</strong> 开发，替代 Vue2 的选项式 API，代码更聚合、更易维护。</li>
<li>通过<strong>Pinia</strong>实现状态管理，替代 Vuex，配置简单，支持持久化，完美适配 Vue3。</li>
<li>掌握了 Vue3 的核心知识点：Props/Emits 组件通信、computed 计算属性、watch 监听器、过渡动画、响应式数据（ref/reactive）。</li>
<li>实现了功能完整的待办清单，包含增删改查、筛选、统计、持久化、动画等，代码可直接复刻到自己的项目中。</li>
<li>解决了 Vue3 新手常踩的坑，如 Pinia 持久化、子组件修改 Props、过渡动画不生效等，为后续 Vue3 项目开发打下基础。</li>
</ol>
<p>本次实战的代码简洁、注释详细，新手可跟随步骤一步步实现，完成后能快速掌握 Vue3 的基础开发流程和核心知识点，是 Vue3 入门的最佳实战案例之一。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Deepin Linux系统下安装git和配置]]></title>    <link>https://juejin.cn/post/7602512064977420351</link>    <guid>https://juejin.cn/post/7602512064977420351</guid>    <pubDate>2026-02-04T05:41:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602512064977420351" data-draft-id="7602529888483754047" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Deepin Linux系统下安装git和配置"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-02-04T05:41:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿白的白日梦"/> <meta itemprop="url" content="https://juejin.cn/user/598573077765678"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Deepin Linux系统下安装git和配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/598573077765678/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿白的白日梦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:41:20.000Z" title="Wed Feb 04 2026 05:41:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Deepin Linux下安装命令：</h2>
<pre><code class="hljs language-bash" lang="bash">sudo apt update
sudo apt install git
</code></pre>
<h4 data-id="heading-1"><strong>建议</strong></h4>
<ol>
<li><strong>安装完整版</strong>：若需Git的完整组件（如图形界面 <code>git-gui</code>、文档），可使用：
<pre><code class="hljs language-bash" lang="bash">sudo apt install git-all
</code></pre>
</li>
<li><strong>验证安装</strong>：安装后，运行 <code>git --version</code> 查看版本以确认成功。</li>
<li><strong>后续配置</strong>：安装后建议设置你的用户名和邮箱，这是提交代码的必备信息：
<pre><code class="hljs language-bash" lang="bash">git config --global user.name <span class="hljs-string">"你的名字"</span>
git config --global user.email <span class="hljs-string">"你的邮箱"</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-2">二、配置和Gitee的关联关系</h2>
<p>配置 Git 与 Gitee 的关联主要分为三步：</p>
<h4 data-id="heading-3"><strong>1. 生成 SSH 密钥</strong></h4>
<blockquote>
<p>在终端执行以下命令，用你的邮箱替换 <code>your_email@example.com</code>。连续按回车使用默认设置即可。</p>
</blockquote>
<pre><code class="hljs language-bash" lang="bash">ssh-keygen -t ed25519 -C <span class="hljs-string">"your_email@example.com"</span>
</code></pre>
<blockquote>
<p>提示：生成的密钥文件默认保存在 <code>~/.ssh/</code> 目录下，公钥为 <code>id_ed25519.pub</code>。</p>
</blockquote>
<h4 data-id="heading-4"><strong>2. 将公钥添加到 Gitee</strong></h4>
<ul>
<li><strong>查看公钥</strong>：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> ~/.ssh/id_ed25519.pub
</code></pre>
</li>
<li><strong>复制输出</strong>的全部内容（以 <code>ssh-ed25519 AAA...</code> 开头）。</li>
<li>登录 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com" target="_blank" title="https://gitee.com" ref="nofollow noopener noreferrer">Gitee</a>，进入 <strong>设置</strong> &gt; <strong>SSH 公钥</strong>，粘贴并保存。</li>
</ul>
<h4 data-id="heading-5"><strong>3. 测试连接</strong></h4>
<p>执行命令测试配置是否成功：</p>
<pre><code class="hljs language-bash" lang="bash">ssh -T git@gitee.com
</code></pre>
<blockquote>
<p>首次连接会提示“是否继续”，输入 <strong><code>yes</code></strong> 回车。看到 <strong>“Welcome to Gitee”</strong> 即表示成功。完成以上步骤后，你就可以使用 <code>git@</code> 开头的 SSH 地址克隆和推送仓库了。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python——彻底理解 Python Property 的运行逻辑]]></title>    <link>https://juejin.cn/post/7602555027303596072</link>    <guid>https://juejin.cn/post/7602555027303596072</guid>    <pubDate>2026-02-04T06:36:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602555027303596072" data-draft-id="7602497125268471814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python——彻底理解 Python Property 的运行逻辑"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-04T06:36:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AbsoluteLogic"/> <meta itemprop="url" content="https://juejin.cn/user/2068626334032586"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python——彻底理解 Python Property 的运行逻辑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2068626334032586/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AbsoluteLogic
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:36:27.000Z" title="Wed Feb 04 2026 06:36:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Property是什么？</h3>
<p>Property是Python中内置的装饰器，它的核心作用是将类的"方法调用"，伪装成"属性访问"</p>
<h3 data-id="heading-1">为什么要用Property？</h3>
<p>要回答“为什么要用property”这个问题，首先我们先不用property，看没有它行不行</p>
<p>我们创建一个名为<code>Student</code>的类，并基于这个类创建一个实例</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, score</span>):
        self.name = name
        self.score = score

xm = Student(<span class="hljs-string">"xiaoming"</span>, <span class="hljs-number">90</span>)
<span class="hljs-built_in">print</span>(xm.name) <span class="hljs-comment"># xiaoming</span>
<span class="hljs-built_in">print</span>(xm.score) <span class="hljs-comment"># 90</span>
xm.score = <span class="hljs-number">999</span>
<span class="hljs-built_in">print</span>(xm.name) <span class="hljs-comment"># xiaoming</span>
<span class="hljs-built_in">print</span>(xm.score) <span class="hljs-comment"># 999</span>
</code></pre>
<p>我们创建了<code>xm</code>这个实例，并进行了初始化。我们输出<code>name</code>和<code>score</code>这两个属性的值，没有任何问题</p>
<p>但是当我们对<code>score</code>进行修改后再输出，发现此时的分数可以被设置成999，这显然是不合理的，所以我们要对属性的设置进行条件限制</p>
<p>那我们第一时间，一定会想到往类中添加额外的方法，在方法中添加限制条件，像下面这样：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, score</span>):
        self.name = name
        self.score = score

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_score</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self.score

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_score</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-number">100</span> &gt;= value &gt;= <span class="hljs-number">0</span>:
            self.score = value
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"分数必须在0-100之间"</span>)


xm = Student(<span class="hljs-string">"xiaoming"</span>, <span class="hljs-number">90</span>)
<span class="hljs-built_in">print</span>(xm.name) <span class="hljs-comment"># xiaoming</span>
<span class="hljs-built_in">print</span>(xm.score) <span class="hljs-comment"># 90</span>
xm.set_score(<span class="hljs-number">999</span>)  <span class="hljs-comment"># ValueError: 分数必须在0-100之间</span>
<span class="hljs-built_in">print</span>(xm.name) 
<span class="hljs-built_in">print</span>(xm.score)
</code></pre>
<p>添加方法后，确实实现了对<code>score</code>这个属性的设置添加了限制条件，但是也会带来两个问题</p>
<p>第一个问题就是我们必须要用<code>set_score</code>这样后添加的方法来对<code>score</code>进行设置，如果仍然使用<code>.</code>这种方式就绕过了条件限制</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, score</span>):
        self.name = name
        self.score = score

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_score</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self.score

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_score</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-number">100</span> &gt;= value &gt;= <span class="hljs-number">0</span>:
            self.score = value
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"分数必须在0-100之间"</span>)


xm = Student(<span class="hljs-string">"xiaoming"</span>, <span class="hljs-number">90</span>)
<span class="hljs-built_in">print</span>(xm.name) <span class="hljs-comment"># xiaoming</span>
<span class="hljs-built_in">print</span>(xm.score) <span class="hljs-comment"># 90</span>
xm.score = <span class="hljs-number">999</span> 
<span class="hljs-built_in">print</span>(xm.name) <span class="hljs-comment"># xiaoming</span>
<span class="hljs-built_in">print</span>(xm.score) <span class="hljs-comment"># 999 </span>
</code></pre>
<p>第二个问题就是我们需要将所有之前用<code>.</code>来设置属性的语句，全都修改成用<code>set_score</code>的方式。如果像上面这种例子一样，只修改一条语句，那当然没问题。可如果这个类有成百上千个实例，有成千上万条语句需要修改呢？一条条修改显然是不现实的</p>
<p>那么有没有一种方法，可以不修改用<code>.</code>来设置属性的方式，还能做到对属性设置添加条件限制呢？</p>
<p>答案就是添加<code>property</code>装饰器</p>
<h3 data-id="heading-2">使用Property</h3>
<p>我们用<code>property</code>对上面的代码进行修改</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, score</span>):
        self.name = name
        self.score = score

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">score</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self._score

<span class="hljs-meta">    @score.setter</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">score</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= value &lt;= <span class="hljs-number">100</span>:
            self._score = value
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"abnormal score"</span>)


xm = Student(<span class="hljs-string">"xiaoming"</span>, <span class="hljs-number">90</span>)
<span class="hljs-built_in">print</span>(xm.name) <span class="hljs-comment"># xiaoming</span>
<span class="hljs-built_in">print</span>(xm.score) <span class="hljs-comment"># 90</span>
xm.score = <span class="hljs-number">999</span> <span class="hljs-comment"># ValueError: abnormal score</span>
<span class="hljs-built_in">print</span>(xm.name) 
<span class="hljs-built_in">print</span>(xm.score) 
</code></pre>
<p><code>@property</code>就是声明一个装饰器，而装饰的就是<code>score</code>这个属性，接下来定义的<code>score</code>方法，其实就是我们要装饰的属性名。这个方法名，一定一定要与你装饰的属性名一致。这个方法其实就代表了我们运行<code>实例.属性</code>所返回的结果，也就是<code>getter</code>这个“读取协议”</p>
<p>而接下来声明的<code>@score.setter</code>就是对装饰属性进行设置的条件，该方法中的语句就代表了运行<code>实例.属性=...</code>所经过的过程，也就是<code>setter</code>这个“写入协议”</p>
<p>当我们用装饰器修改完之后就可以发现，我们用<code>.</code>方法对属性进行设置，也可以像之前调用方法那样拦截到错误</p>
<p>在我们使用<code>property</code>装饰器时，需要注意，我们需要用被保护的变量，也就是<code>_score</code>来作为返回值或进行修改，一定不能用<code>score</code>。原因和<code>property</code>的运行逻辑有关，我们后面会深入讲解</p>
<p>另外就是在我们使用<code>property</code>时，初始化即<code>__init__()</code>中，尽量不要用<code>self._score = score</code>，我们可以看一下这两者的区别</p>
<p>使用<code>_score</code>:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, score</span>):
        self.name = name
        self._score = score <span class="hljs-comment"># 初始化时使用受保护的变量</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">score</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self._score

<span class="hljs-meta">    @score.setter</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">score</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= value &lt;= <span class="hljs-number">100</span>:
            self._score = value
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"abnormal score"</span>)


xm = Student(<span class="hljs-string">"xiaoming"</span>, <span class="hljs-number">999</span>) <span class="hljs-comment"># 在初始化时拦截不到问题</span>
<span class="hljs-built_in">print</span>(xm.score) <span class="hljs-comment"># 999</span>
</code></pre>
<p>使用<code>score</code></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, score</span>):
        self.name = name
        self.score = score <span class="hljs-comment"># 初始化时不使用受保护的变量</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">score</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self._score

<span class="hljs-meta">    @score.setter</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">score</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= value &lt;= <span class="hljs-number">100</span>:
            self._score = value
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"abnormal score"</span>)


xm = Student(<span class="hljs-string">"xiaoming"</span>, <span class="hljs-number">999</span>) <span class="hljs-comment"># 在初始化时拦截到问题</span>
<span class="hljs-built_in">print</span>(xm.score) <span class="hljs-comment"># ValueError: abnormal score</span>
</code></pre>
<p>两者的区别也是由<code>Property</code>的运行逻辑所导致的，接下来我们就深入了解一下<code>property</code>是如何运行的</p>
<h3 data-id="heading-3">Property的运行逻辑</h3>
<p>还是用上面的代码举例</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, score</span>):
        self.name = name
        self.score = score 

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">score</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">return</span> self._score

<span class="hljs-meta">    @score.setter</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">score</span>(<span class="hljs-params">self, value</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-number">0</span> &lt;= value &lt;= <span class="hljs-number">100</span>:
            self._score = value
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"abnormal score"</span>)


xm = Student(<span class="hljs-string">"xiaoming"</span>, <span class="hljs-number">90</span>) 
<span class="hljs-built_in">print</span>(xm.score) 
xm.score = <span class="hljs-number">999</span>
<span class="hljs-built_in">print</span>(xm.score)
</code></pre>
<p>当我们用<code>xm = Student("xiaoming", 90)</code>来创建实例时，<code>xm.name</code>接收了"xiaoming"这个值。而在对<code>xm.score</code>进行赋值时，python检测到<code>score</code>是我们装饰过的属性，并且我们设置了<code>setter</code>这个“写入协议”，所以此时<code>self.score = 90</code>就变成了<code>score(self, 90)</code>，90这个值就进入了判定，最后赋值给了<code>_score</code>，所以在我们执行<code>print(xm.score)</code>时，python也同样会检测到<code>score</code>是被装饰的属性，从而用<code>getter</code>这个“读取协议”返回<code>_score</code>的值，也就是90</p>
<p>后面对<code>xm.score</code>进行赋值和输出也是一样的逻辑</p>
<p>我们可以理解为，当使用装饰器后，<code>score</code>这个属性就变成了一个读取-写入-删除的“逻辑”</p>
<p>所以，当我们理解<code>property</code>真正的运行逻辑后，我们就能解释刚才我们遇到的问题</p>
<p>当我们在初始化中直接使用<code>_score</code>时，我们相当于绕开了<code>setter</code>这个检测机制，在输出时就是<code>_score</code>的值。而当我们再次对<code>score</code>进行设置，python在检测到装饰器后，传入的值才能进入检测机制</p>
<p>如果我们在装饰器中不用<code>_score</code>而用<code>score</code>，那么程序就会进入死循环</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d79975243820490a8fc31d2e6c39dbe5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQWJzb2x1dGVMb2dpYw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770791787&amp;x-signature=%2FNBJQBpjo19e%2B90K1xxKacjwiko%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">结语</h3>
<p>如果文章中有什么错误或者可以优化的地方，欢迎大家指正，感谢！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GLM-4.7-Flash 本地部署指南]]></title>    <link>https://juejin.cn/post/7602579671474913299</link>    <guid>https://juejin.cn/post/7602579671474913299</guid>    <pubDate>2026-02-04T06:42:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602579671474913299" data-draft-id="7602559134575706148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GLM-4.7-Flash 本地部署指南"/> <meta itemprop="keywords" content="ChatGLM (智谱)"/> <meta itemprop="datePublished" content="2026-02-04T06:42:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FreeBug"/> <meta itemprop="url" content="https://juejin.cn/user/2013961030477358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GLM-4.7-Flash 本地部署指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961030477358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FreeBug
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T06:42:48.000Z" title="Wed Feb 04 2026 06:42:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>🎉目的：解决GLM Coding Plan调用触发到限流，遂决定在本地电脑部署GLM-4.7-Flash</p>
<h2 data-id="heading-0">📖 在 RTX 5060 Ti 上部署 GLM-4.7-Flash 并接入 Claude Code 终极教程</h2>
<h3 data-id="heading-1">🎯 教程目标</h3>
<p>GLM-4.7-Flash参数量在30B，若在 <strong>RTX 5060 Ti (16GB显存)</strong> 上，需要使用 <code>llama.cpp</code> 部署 <strong>GLM-4.7-Flash 4-bit量化模型</strong>，并通过一个 <strong>OpenAI兼容的代理</strong>，让 <strong>Claude Code</strong> 等客户端能够直接调用。</p>
<h3 data-id="heading-2">⚙️ 核心配置</h3>
<ul>
<li><strong>硬件</strong>: NVIDIA RTX 5060 Ti (16GB VRAM, CUDA 12.9)</li>
<li><strong>系统</strong>: WSL2 (Ubuntu)</li>
<li><strong>模型</strong>: GLM-4.7-Flash-UD-Q4_K_XL.gguf (来自 unsloth)</li>
<li><strong>核心工具</strong>: llama.cpp + 自定义FastAPI代理</li>
</ul>
<hr/>
<h3 data-id="heading-3">📝 第一阶段：基础环境与模型准备</h3>
<h4 data-id="heading-4">1.1 解决WSL网络代理（关键前提）</h4>
<p>确保WSL能通过Windows上的Clash访问外网。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 获取Windows主机在WSL内的IP</span>
<span class="hljs-built_in">export</span> WIN_IP=$(<span class="hljs-built_in">cat</span> /etc/resolv.conf | grep nameserver | awk <span class="hljs-string">'{print $2}'</span>)
<span class="hljs-comment"># 设置代理环境变量（端口默认7890）</span>
<span class="hljs-built_in">export</span> http_proxy=http://<span class="hljs-variable">$WIN_IP</span>:7890
<span class="hljs-built_in">export</span> https_proxy=http://<span class="hljs-variable">$WIN_IP</span>:7890
</code></pre>
<h4 data-id="heading-5">1.2 安装系统依赖</h4>
<pre><code class="hljs language-bash" lang="bash">sudo apt-get update
sudo apt-get install -y build-essential cmake curl libcurl4-openssl-dev
</code></pre>
<h4 data-id="heading-6">1.3 安装并配置CUDA 12.9</h4>
<p>RTX 50系列必须使用CUDA 12.9+。</p>
<ol>
<li>从<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.nvidia.com%2Fcuda-12-9-0-download-archive" target="_blank" title="https://developer.nvidia.com/cuda-12-9-0-download-archive" ref="nofollow noopener noreferrer">NVIDIA官网</a>下载CUDA 12.9安装包。</li>
<li>安装后，将CUDA路径加入环境变量（临时）：
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> PATH=/usr/local/cuda-12.9/bin:<span class="hljs-variable">$PATH</span>
<span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/usr/local/cuda-12.9/lib64:<span class="hljs-variable">$LD_LIBRARY_PATH</span>
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-7">🛠️ 第二阶段：编译与运行 llama.cpp</h3>
<h4 data-id="heading-8">2.1 编译支持CUDA的llama.cpp</h4>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/ggml-org/llama.cpp
<span class="hljs-built_in">cd</span> llama.cpp
<span class="hljs-built_in">mkdir</span> -p build &amp;&amp; <span class="hljs-built_in">cd</span> build
cmake .. -DBUILD_SHARED_LIBS=OFF -DGGML_CUDA=ON -DLLAMA_OPENSSL=ON
cmake --build . --config Release -j --target llama-server
</code></pre>
<p><strong>关键点</strong>：编译目标为 <code>llama-server</code>（不是 <code>server</code>）。</p>
<h4 data-id="heading-9">2.2 下载GLM-4.7-Flash GGUF模型</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建模型目录</span>
<span class="hljs-built_in">mkdir</span> -p ~/models
<span class="hljs-built_in">cd</span> ~/models
<span class="hljs-comment"># 使用代理下载量化模型（示例链接，请以实际可用为准）</span>
curl -L -o GLM-4.7-Flash-UD-Q4_K_XL.gguf <span class="hljs-string">"https://huggingface.co/unsloth/GLM-4.7-Flash-GGUF/resolve/main/GLM-4.7-Flash-UD-Q4_K_XL.gguf"</span>
</code></pre>
<h4 data-id="heading-10">2.3 启动llama-server后端服务</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ~
./llama.cpp/build/bin/llama-server \
    -m ~/models/GLM-4.7-Flash-UD-Q4_K_XL.gguf \
    --host 0.0.0.0 \
    --port 8080 \
    --ctx-size 16384 \
    --threads -1 \
    --n-gpu-layers 99
</code></pre>
<p><strong>重要</strong>：启动时<strong>不要</strong>使用 <code>--chat-template</code> 参数，避免兼容性问题。后续通过代理将响应格式转换。</p>
<p><strong>验证后端</strong>：测试原始接口是否工作。</p>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:8080/completion \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{
    "prompt": "&lt;|im_start|&gt;user\n你好&lt;|im_end|&gt;\n&lt;|im_start|&gt;assistant\n",
    "n_predict": 50,
    "stop": ["&lt;|im_end|&gt;"]
  }'</span>
</code></pre>
<p>成功将返回：<code>{"content":"你好！很高兴为你服务。"...}</code></p>
<hr/>
<h3 data-id="heading-11">🔌 第三阶段：构建OpenAI兼容代理</h3>
<h4 data-id="heading-12">3.1 创建Python虚拟环境并安装依赖</h4>
<pre><code class="hljs language-bash" lang="bash">python3 -m venv ~/venv
<span class="hljs-built_in">source</span> ~/venv/bin/activate
pip install fastapi uvicorn requests
</code></pre>
<h4 data-id="heading-13">3.2 创建代理脚本 <code>glm_openai_proxy.py</code></h4>
<p>将以下脚本保存到 <code>~/glm_openai_proxy.py</code>。<strong>这是本教程的核心</strong>，它精确实现了GLM格式与OpenAI API的转换。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> uvicorn

LLAMA_SERVER_URL = <span class="hljs-string">"http://127.0.0.1:8080/completion"</span>
app = FastAPI()

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Message</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    role: <span class="hljs-built_in">str</span>
    content: <span class="hljs-built_in">str</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatRequest</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    model: <span class="hljs-built_in">str</span>
    messages: <span class="hljs-built_in">list</span>[Message]
    max_tokens: <span class="hljs-built_in">int</span> = <span class="hljs-number">200</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_to_glm_prompt</span>(<span class="hljs-params">messages: <span class="hljs-built_in">list</span>[Message]</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""将OpenAI messages转换为GLM精确格式。"""</span>
    combined_user_content = []
    prompt_parts = []

    <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> messages:
        <span class="hljs-keyword">if</span> msg.role <span class="hljs-keyword">in</span> [<span class="hljs-string">'system'</span>, <span class="hljs-string">'user'</span>]:
            combined_user_content.append(msg.content)
        <span class="hljs-keyword">elif</span> msg.role == <span class="hljs-string">'assistant'</span>:
            <span class="hljs-keyword">if</span> combined_user_content:
                user_text = <span class="hljs-string">"\n"</span>.join(combined_user_content)
                prompt_parts.append(<span class="hljs-string">f"&lt;|im_start|&gt;user\n<span class="hljs-subst">{user_text}</span>&lt;|im_end|&gt;"</span>)
                combined_user_content = []
            prompt_parts.append(<span class="hljs-string">f"&lt;|im_start|&gt;assistant\n<span class="hljs-subst">{msg.content}</span>&lt;|im_end|&gt;"</span>)

    <span class="hljs-keyword">if</span> combined_user_content:
        user_text = <span class="hljs-string">"\n"</span>.join(combined_user_content)
        prompt_parts.append(<span class="hljs-string">f"&lt;|im_start|&gt;user\n<span class="hljs-subst">{user_text}</span>&lt;|im_end|&gt;"</span>)

    prompt_parts.append(<span class="hljs-string">"&lt;|im_start|&gt;assistant\n"</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">"\n"</span>.join(prompt_parts)

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/v1/chat/completions"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">chat_completions</span>(<span class="hljs-params">request: ChatRequest</span>):
    prompt = convert_to_glm_prompt(request.messages)
    payload = {
        <span class="hljs-string">"prompt"</span>: prompt,
        <span class="hljs-string">"n_predict"</span>: request.max_tokens,
        <span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.7</span>,
        <span class="hljs-string">"stop"</span>: [<span class="hljs-string">"&lt;|im_end|&gt;"</span>, <span class="hljs-string">"&lt;|im_start|&gt;"</span>]
    }
    <span class="hljs-keyword">try</span>:
        resp = requests.post(LLAMA_SERVER_URL, json=payload, timeout=<span class="hljs-number">60</span>)
        resp.raise_for_status()
        data = resp.json()
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">500</span>, detail=<span class="hljs-string">f"后端调用失败: <span class="hljs-subst">{e}</span>"</span>)

    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"id"</span>: <span class="hljs-string">"chatcmpl-local-glm"</span>,
        <span class="hljs-string">"object"</span>: <span class="hljs-string">"chat.completion"</span>,
        <span class="hljs-string">"choices"</span>: [{
            <span class="hljs-string">"index"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">"message"</span>: {<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-string">"content"</span>: data.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>).strip()},
            <span class="hljs-string">"finish_reason"</span>: <span class="hljs-string">"stop"</span>
        }],
        <span class="hljs-string">"usage"</span>: {
            <span class="hljs-string">"prompt_tokens"</span>: <span class="hljs-built_in">len</span>(prompt),
            <span class="hljs-string">"completion_tokens"</span>: <span class="hljs-built_in">len</span>(data.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>)),
            <span class="hljs-string">"total_tokens"</span>: <span class="hljs-built_in">len</span>(prompt) + <span class="hljs-built_in">len</span>(data.get(<span class="hljs-string">"content"</span>, <span class="hljs-string">""</span>))
        }
    }

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    uvicorn.run(app, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">5001</span>)
</code></pre>
<h4 data-id="heading-14">3.3 启动代理服务</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> ~/venv/bin/activate
python ~/glm_openai_proxy.py
</code></pre>
<p>服务将在 <code>http://0.0.0.0:5001</code> 运行，提供 <code>/v1/chat/completions</code> 端点。</p>
<p><strong>验证代理</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:5001/v1/chat/completions \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{
    "model": "GLM-4.7-Flash-UD-Q4_K_XL.gguf",
    "messages": [{"role": "user", "content": "你好"}],
    "max_tokens": 100
  }'</span>
</code></pre>
<p><strong>测试效果</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73ca2161c6c4419d8bf545ecfb522de5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRnJlZUJ1Zw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770792170&amp;x-signature=tVVFiv4uinAuhqh55wsoV2jk4N0%3D" alt="GLM-4.7-flash运行测试.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-15">🚀 第四阶段：一键部署与管理脚本</h3>
<h4 data-id="heading-16">4.1 创建启动脚本 <code>start_glm_service.sh</code></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">source</span> ~/venv/bin/activate
<span class="hljs-comment"># 启动后端</span>
<span class="hljs-built_in">nohup</span> ~/llama.cpp/build/bin/llama-server \
    -m ~/models/GLM-4.7-Flash-UD-Q4_K_XL.gguf \
    --host 0.0.0.0 --port 8080 \
    --ctx-size 8192 --n-gpu-layers 40 \
    &gt; ~/llama.log 2&gt;&amp;1 &amp;
<span class="hljs-built_in">echo</span> $! &gt; ~/llama.pid
<span class="hljs-built_in">sleep</span> 10
<span class="hljs-comment"># 启动代理</span>
<span class="hljs-built_in">nohup</span> python ~/glm_openai_proxy.py &gt; ~/proxy.log 2&gt;&amp;1 &amp;
<span class="hljs-built_in">echo</span> $! &gt; ~/proxy.pid
<span class="hljs-built_in">echo</span> <span class="hljs-string">"服务已启动: 后端(8080), 代理(5001)"</span>
</code></pre>
<h4 data-id="heading-17">4.2 创建停止脚本 <code>stop_glm_service.sh</code></h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-built_in">kill</span> $(<span class="hljs-built_in">cat</span> ~/proxy.pid 2&gt;/dev/null) 2&gt;/dev/null
<span class="hljs-built_in">kill</span> $(<span class="hljs-built_in">cat</span> ~/llama.pid 2&gt;/dev/null) 2&gt;/dev/null
<span class="hljs-built_in">rm</span> -f ~/proxy.pid ~/llama.pid
<span class="hljs-built_in">echo</span> <span class="hljs-string">"服务已停止"</span>
</code></pre>
<p>授权并运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x start_glm_service.sh stop_glm_service.sh
./start_glm_service.sh
</code></pre>
<hr/>
<h3 data-id="heading-18">🖥️ 第五阶段：在 Claude Code 中配置</h3>
<ol>
<li>
<p>获取Windows主机在局域网中的IP（在Windows命令提示符CMD运行 <code>ipconfig</code>，查看“IPv4地址”）。</p>
</li>
<li>
<p>在 Claude Code 设置中添加自定义模型：</p>
<ul>
<li><strong>Base URL</strong>: <code>http://&lt;你的Windows IP&gt;:5001/v1</code></li>
<li><strong>Model Name</strong>: <code>GLM-4.7-Flash-UD-Q4_K_XL.gguf</code></li>
<li><strong>API Key</strong>: <code>sk-local</code> (或留空)</li>
</ul>
</li>
<li>
<p>选择该模型，开始与本地部署的GLM-4.7-Flash对话。</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-19">🔍 关键问题与解决方案总结（踩坑记录）</h3>



































<table><thead><tr><th align="left">问题</th><th align="left">现象</th><th align="left">解决方案</th></tr></thead><tbody><tr><td align="left"><strong>CUDA版本过低</strong></td><td align="left">编译错误 <code>Unsupported gpu architecture 'compute_120a'</code></td><td align="left">升级至 <strong>CUDA 12.9+</strong></td></tr><tr><td align="left"><strong>模型格式不兼容</strong></td><td align="left">API返回乱码或模板描述文本</td><td align="left"><strong>弃用 <code>--chat-template</code></strong>，由代理脚本做精确格式转换</td></tr><tr><td align="left"><strong>网络连接失败</strong></td><td align="left"><code>Could not resolve host: github.com</code></td><td align="left">在WSL中正确配置HTTP代理环境变量</td></tr><tr><td align="left"><strong>服务端口冲突</strong></td><td align="left">连接被拒绝</td><td align="left">确保 <code>8080</code> (后端) 和 <code>5001</code> (代理) 端口可用</td></tr><tr><td align="left"><strong>显存不足(OOM)</strong></td><td align="left">模型加载失败</td><td align="left">降低 <code>--n-gpu-layers</code> (从99降至40)</td></tr></tbody></table>
<h3 data-id="heading-20">📊 性能参考 (RTX 5060 Ti)</h3>
<ul>
<li><strong>加载时间</strong>: 约30-60秒 (首次加载)</li>
<li><strong>推理速度</strong>: 约15-40 tokens/秒 (取决于上下文长度)</li>
<li><strong>显存占用</strong>: 约12-14GB (4-bit量化，<code>--n-gpu-layers 40</code>)</li>
<li><strong>内存占用</strong>: 约2-3GB</li>
</ul>
<h3 data-id="heading-21">✅ 最终验证</h3>
<p>完成所有步骤后，你的本地AI服务栈如下：</p>
<ol>
<li><strong>后端 (<code>llama-server</code>)</strong>: <code>http://localhost:8080</code> (原始推理)</li>
<li><strong>代理 (<code>glm_openai_proxy.py</code>)</strong>: <code>http://localhost:5001/v1</code> (OpenAI兼容API)</li>
<li><strong>客户端 (Claude Code)</strong>: 通过代理访问本地模型</li>
</ol>
<h3 data-id="heading-22">🎉 成功标志</h3>
<p>在Claude Code中成功发送消息并收到GLM-4.7-Flash的<strong>中文流畅回复</strong>，而非之前的乱码或错误信息。</p>
<p><strong>这份教程凝聚了我解决众多兼容性问题的核心经验。你现在拥有了一套稳定、可重现的部署方案，尽情享受你的本地大模型吧！</strong> 如果需要在其他环境部署或有新的需求，可以随时参考此教程。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【深入】动态高度虚拟列表Vue3实现（2）]]></title>    <link>https://juejin.cn/post/7602529888483704895</link>    <guid>https://juejin.cn/post/7602529888483704895</guid>    <pubDate>2026-02-04T05:16:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602529888483704895" data-draft-id="7602497125269045254" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【深入】动态高度虚拟列表Vue3实现（2）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-04T05:16:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Hashan"/> <meta itemprop="url" content="https://juejin.cn/user/3523276916662526"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【深入】动态高度虚拟列表Vue3实现（2）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3523276916662526/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Hashan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:16:59.000Z" title="Wed Feb 04 2026 05:16:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>📚 <strong>系列文章</strong>：本文是虚拟列表系列的第二篇，建议先阅读 <a href="https://juejin.cn/post/7602463463105380398" target="_blank" title="https://juejin.cn/post/7602463463105380398">固定高度虚拟列表实现</a></p>
</blockquote>
<h2 data-id="heading-0">🎯 本文你将学到</h2>
<ul>
<li>✅ 理解动态高度虚拟列表的核心难点</li>
<li>✅ 掌握"预估高度 + 渲染后修正"的解决方案</li>
<li>✅ 完整实现一个生产级别的动态高度虚拟列表组件</li>
<li>✅ 学会使用懒加载优化虚拟列表性能</li>
</ul>
<h2 data-id="heading-1">为什么需要动态高度虚拟列表</h2>
<p>在实际业务开发中，我们经常会遇到这些场景：</p>






























<table><thead><tr><th>场景</th><th>特点</th><th>示例</th></tr></thead><tbody><tr><td>💬 消息列表</td><td>文本长度不固定</td><td>微信聊天、钉钉消息</td></tr><tr><td>📝 评论/回复</td><td>嵌套层级不同</td><td>掘金评论区、知乎回答</td></tr><tr><td>📰 Feed 流</td><td>图文混排</td><td>微博、小红书</td></tr><tr><td>📋 数据表格</td><td>单元格内容不定</td><td>后台管理系统</td></tr></tbody></table>
<p>这些场景的共同特点是：<strong>列表项高度不固定，无法提前预知</strong>。</p>
<hr/>
<h2 data-id="heading-2">核心难点分析</h2>
<h3 data-id="heading-3">固定高度 vs 动态高度：复杂度对比</h3>
<p>让我们先对比一下两种实现的核心区别：</p>
<pre><code class="hljs language-ini" lang="ini">┌─────────────────────────────────────────────────────────────────┐
│                    固定高度：所有计算都是 O(1)                    │
├─────────────────────────────────────────────────────────────────┤
│  Item 0  │ height: 50px    │  <span class="hljs-attr">scrollTop</span> = <span class="hljs-number">250</span>                   │
│  Item 1  │ height: 50px    │  <span class="hljs-attr">startIndex</span> = <span class="hljs-number">250</span> / <span class="hljs-number">50</span> = <span class="hljs-number">5</span>  ✅     │
│  Item 2  │ height: 50px    │  <span class="hljs-attr">offset</span> = <span class="hljs-number">5</span> * <span class="hljs-number">50</span> = <span class="hljs-number">250</span>px   ✅      │
│  Item 3  │ height: 50px    │  <span class="hljs-attr">totalHeight</span> = n * <span class="hljs-number">50</span>      ✅      │
│  ...     │ ...             │                                    │
└─────────────────────────────────────────────────────────────────┘
​
┌─────────────────────────────────────────────────────────────────┐
│                    动态高度：需要遍历累加                         │
├─────────────────────────────────────────────────────────────────┤
│  Item 0  │ height: 80px    │  <span class="hljs-attr">scrollTop</span> = <span class="hljs-number">250</span>                   │
│  Item 1  │ height: 120px   │  <span class="hljs-attr">startIndex</span> = ???                  │
│  Item 2  │ height: 60px    │  需要遍历：80+120+<span class="hljs-attr">60</span> = <span class="hljs-number">260</span> &gt; <span class="hljs-number">250</span>   │
│  Item 3  │ height: 200px   │  所以 <span class="hljs-attr">startIndex</span> = <span class="hljs-number">2</span>               │
│  ...     │ ...             │                                    │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-4">🐔🥚 "鸡生蛋"问题</h3>
<p>动态高度虚拟列表面临一个经典的循环依赖问题：</p>
<pre><code class="hljs language-arduino" lang="arduino">┌──────────────────────────────────────────────────────────────┐
│                    动态高度的<span class="hljs-string">"鸡生蛋"</span>问题                      │
└──────────────────────────────────────────────────────────────┘
​
问题链条：
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│ 需要知道高度  │ ──► │ 才能计算位置  │ ──► │ 才能决定渲染  │
└──────────────┘     └──────────────┘     └──────────────┘
       ▲                                          │
       │                                          │
       └──────────────────────────────────────────┘
                   但高度需要渲染后才知道！
</code></pre>
<h3 data-id="heading-5">核心问题清单</h3>






























<table><thead><tr><th>问题</th><th>固定高度方案</th><th>动态高度难点</th></tr></thead><tbody><tr><td>计算 startIndex</td><td><code>scrollTop / itemHeight</code></td><td>❌ 无法直接计算</td></tr><tr><td>计算总高度</td><td><code>totalCount * itemHeight</code></td><td>❌ 需要累加所有高度</td></tr><tr><td>计算偏移量</td><td><code>startIndex * itemHeight</code></td><td>❌ 需要累加前面所有高度</td></tr><tr><td>获取元素高度</td><td>固定值</td><td>❌ 渲染后才能获取</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">解决方案设计</h2>
<h3 data-id="heading-7">💡 核心思路：预估高度 + 渲染后修正</h3>
<pre><code class="hljs">┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│ 使用预估高度  │ ──► │ 先渲染一批    │ ──► │ 获取真实高度  │
└──────────────┘     └──────────────┘     └──────────────┘
                                                │
       ┌────────────────────────────────────────┘
       ▼
┌──────────────┐     ┌──────────────┐
│ 更新位置缓存  │ ──► │ 修正后续位置  │
└──────────────┘     └──────────────┘
</code></pre>
<h3 data-id="heading-8">数据结构设计：positionCache</h3>
<p>为了解决动态高度的计算问题，我们需要维护一个<strong>位置缓存表</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">//</span> <span class="hljs-string">存储每个元素的位置信息</span>
<span class="hljs-string">const</span> <span class="hljs-string">positionCache</span> <span class="hljs-string">=</span> [
  { <span class="hljs-attr">index:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">top:</span> <span class="hljs-number">0</span>,   <span class="hljs-attr">bottom:</span> <span class="hljs-number">80</span>,  <span class="hljs-attr">height:</span> <span class="hljs-number">80</span>  },
  { <span class="hljs-attr">index:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">top:</span> <span class="hljs-number">80</span>,  <span class="hljs-attr">bottom:</span> <span class="hljs-number">200</span>, <span class="hljs-attr">height:</span> <span class="hljs-number">120</span> },
  { <span class="hljs-attr">index:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">top:</span> <span class="hljs-number">200</span>, <span class="hljs-attr">bottom:</span> <span class="hljs-number">260</span>, <span class="hljs-attr">height:</span> <span class="hljs-number">60</span>  },
  { <span class="hljs-attr">index:</span> <span class="hljs-number">3</span>, <span class="hljs-attr">top:</span> <span class="hljs-number">260</span>, <span class="hljs-attr">bottom:</span> <span class="hljs-number">460</span>, <span class="hljs-attr">height:</span> <span class="hljs-number">200</span> },
  <span class="hljs-string">//</span> <span class="hljs-string">...</span>
]
</code></pre>
<h4 data-id="heading-9">🤔 为什么需要 top 和 bottom？</h4>
<p>你可能会问：只存 <code>index</code> 和 <code>height</code> 不就够了吗？</p>
<p><strong>答案是不够！</strong> 让我们看看为什么：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ❌ 只有 height 时，计算 startIndex 需要这样：</span>
<span class="hljs-keyword">let</span> accumulatedHeight = <span class="hljs-number">0</span>
<span class="hljs-keyword">let</span> startIndex = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; positionCache.<span class="hljs-property">length</span>; i++) {
  accumulatedHeight += positionCache[i].<span class="hljs-property">height</span>
  <span class="hljs-keyword">if</span> (accumulatedHeight &gt; scrollTop) {
    startIndex = i
    <span class="hljs-keyword">break</span>
  }
}
<span class="hljs-comment">// 时间复杂度：O(n)</span>
​
<span class="hljs-comment">// ✅ 有 top/bottom 时，可以直接查找：</span>
<span class="hljs-keyword">const</span> startIndex = positionCache.<span class="hljs-title function_">findIndex</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">bottom</span> &gt; scrollTop)
<span class="hljs-comment">// 甚至可以用二分查找优化到 O(log n)</span>
</code></pre>
<h4 data-id="heading-10">positionCache 结构详解</h4>
<pre><code class="hljs language-js" lang="js">positionCache = [
  {
    <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,      <span class="hljs-comment">// 元素索引</span>
    <span class="hljs-attr">top</span>: <span class="hljs-number">0</span>,        <span class="hljs-comment">// 元素顶部距离列表顶部的距离</span>
    <span class="hljs-attr">bottom</span>: <span class="hljs-number">80</span>,    <span class="hljs-comment">// 元素底部距离列表顶部的距离</span>
    <span class="hljs-attr">height</span>: <span class="hljs-number">80</span>     <span class="hljs-comment">// 元素高度 (bottom - top)</span>
  },
  {
    <span class="hljs-attr">index</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">top</span>: <span class="hljs-number">80</span>,       <span class="hljs-comment">// = 上一项的 bottom（保证连续性）</span>
    <span class="hljs-attr">bottom</span>: <span class="hljs-number">200</span>,   <span class="hljs-comment">// = top + height</span>
    <span class="hljs-attr">height</span>: <span class="hljs-number">120</span>
  },
  <span class="hljs-comment">// ...</span>
]
</code></pre>
<p><strong>关键约束条件</strong>：</p>
<ul>
<li><code>top[i] = bottom[i-1]</code>（连续性）</li>
<li><code>bottom[i] = top[i] + height[i]</code></li>
<li><code>height[i]</code> 初始为预估值，渲染后更新为真实值</li>
</ul>
<h3 data-id="heading-11">整体架构图</h3>
<pre><code class="hljs language-arduino" lang="arduino">┌─────────────────────────────────────────────────────────────────────────┐
│  Container（容器）                                                       │
│  height: <span class="hljs-number">400</span>px, overflow: <span class="hljs-keyword">auto</span>                                          │
│                                                                         │
│  ┌───────────────────────────────────────────────────────────────────┐ │
│  │  Phantom（幽灵层）                                                  │ │
│  │  height: positionCache[last].bottom                               │ │
│  │  作用：撑起滚动条，让用户感觉有完整列表                               │ │
│  │                                                                    │ │
│  │  ┌─────────────────────────────────────────────────────────────┐  │ │
│  │  │  Content（内容层）                                           │  │ │
│  │  │  transform: <span class="hljs-built_in">translateY</span>(contentOffset)                       │  │ │
│  │  │                                                              │  │ │
│  │  │  ┌─────────────────────────────────────────────────────┐   │  │ │
│  │  │  │  Item [startIndex]     height: <span class="hljs-number">80</span>px                 │   │  │ │
│  │  │  ├─────────────────────────────────────────────────────┤   │  │ │
│  │  │  │  Item [startIndex+<span class="hljs-number">1</span>]   height: <span class="hljs-number">120</span>px                │   │  │ │
│  │  │  ├─────────────────────────────────────────────────────┤   │  │ │
│  │  │  │  Item [startIndex+<span class="hljs-number">2</span>]   height: <span class="hljs-number">60</span>px                 │   │  │ │
│  │  │  ├─────────────────────────────────────────────────────┤   │  │ │
│  │  │  │  ...                   只渲染可见区域 + 缓冲区        │   │  │ │
│  │  │  └─────────────────────────────────────────────────────┘   │  │ │
│  │  └─────────────────────────────────────────────────────────────┘  │ │
│  └───────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
</code></pre>
<hr/>
<h2 data-id="heading-12">代码实现</h2>
<h3 data-id="heading-13">Step 1：初始化位置缓存</h3>
<p>首先，我们需要用预估高度初始化所有元素的位置信息：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** 初始化位置缓存 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initPositionCache</span> = (<span class="hljs-params">listData, estimatedHeight</span>) =&gt; {
  positionCache.<span class="hljs-property">value</span> = listData.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> ({
    index,
    <span class="hljs-attr">top</span>: index * estimatedHeight,           <span class="hljs-comment">// 0, 50, 100, 150, ...</span>
    <span class="hljs-attr">bottom</span>: (index + <span class="hljs-number">1</span>) * estimatedHeight,  <span class="hljs-comment">// 50, 100, 150, 200, ...</span>
    <span class="hljs-attr">height</span>: estimatedHeight                 <span class="hljs-comment">// 50, 50, 50, 50, ...</span>
  }))
}
</code></pre>
<p>初始化后的数据结构（假设 <code>estimatedHeight = 50</code>）：</p>
<pre><code class="hljs language-css" lang="css">Index │ <span class="hljs-attribute">Top</span>  │ <span class="hljs-attribute">Bottom</span> │ <span class="hljs-attribute">Height</span> │ 状态
──────┼──────┼────────┼────────┼──────────
  <span class="hljs-number">0</span>   │  <span class="hljs-number">0</span>   │  <span class="hljs-number">50</span>    │  <span class="hljs-number">50</span>    │ 预估值
  <span class="hljs-number">1</span>   │  <span class="hljs-number">50</span>  │  <span class="hljs-number">100</span>   │  <span class="hljs-number">50</span>    │ 预估值
  <span class="hljs-number">2</span>   │  <span class="hljs-number">100</span> │  <span class="hljs-number">150</span>   │  <span class="hljs-number">50</span>    │ 预估值
  <span class="hljs-number">3</span>   │  <span class="hljs-number">150</span> │  <span class="hljs-number">200</span>   │  <span class="hljs-number">50</span>    │ 预估值
  <span class="hljs-number">4</span>   │  <span class="hljs-number">200</span> │  <span class="hljs-number">250</span>   │  <span class="hljs-number">50</span>    │ 预估值
 ...  │ ...  │  ...   │  ...   │ ...
</code></pre>
<h3 data-id="heading-14">Step 2：计算可见区域</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 计算：幽灵层高度（撑起滚动条）</span>
<span class="hljs-keyword">const</span> phantomHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> cache = positionCache.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> (!cache.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
  <span class="hljs-keyword">return</span> cache[cache.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]?.<span class="hljs-property">bottom</span> || <span class="hljs-number">0</span>
})
​
<span class="hljs-comment">// 计算：可见数量（容器能显示的数量 + 缓冲区）</span>
<span class="hljs-keyword">const</span> visibleCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(containerHeight.<span class="hljs-property">value</span> / estimatedHeight.<span class="hljs-property">value</span>) + bufferSize.<span class="hljs-property">value</span>
})
​
<span class="hljs-comment">// 计算：结束索引</span>
<span class="hljs-keyword">const</span> endIndex = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(startIndex.<span class="hljs-property">value</span> + visibleCount.<span class="hljs-property">value</span>, props.<span class="hljs-property">listData</span>.<span class="hljs-property">length</span>)
})
​
<span class="hljs-comment">// 计算：可见数据</span>
<span class="hljs-keyword">const</span> visibleData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> listData.<span class="hljs-property">value</span>.<span class="hljs-title function_">slice</span>(startIndex.<span class="hljs-property">value</span>, endIndex.<span class="hljs-property">value</span>)
})
</code></pre>
<h3 data-id="heading-15">Step 3：获取开始索引和偏移量</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** 获取开始索引 - 找到第一个 bottom &gt; scrollTop 的元素 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getStartIndex</span> = (<span class="hljs-params">scrollTop</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!positionCache.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
  <span class="hljs-keyword">const</span> item = positionCache.<span class="hljs-property">value</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item &amp;&amp; item.<span class="hljs-property">bottom</span> &gt; scrollTop)
  <span class="hljs-keyword">return</span> item ? item.<span class="hljs-property">index</span> : <span class="hljs-number">0</span>
}
​
<span class="hljs-comment">/** 获取内容偏移量 - 使用当前项的 top 值 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getContentOffset</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (startIndex.<span class="hljs-property">value</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
  <span class="hljs-keyword">const</span> cache = positionCache.<span class="hljs-property">value</span>
  <span class="hljs-keyword">return</span> cache[startIndex.<span class="hljs-property">value</span>]?.<span class="hljs-property">top</span> || <span class="hljs-number">0</span>
}
</code></pre>
<h3 data-id="heading-16">Step 4：渲染后更新真实高度</h3>
<p>这是动态高度虚拟列表的<strong>核心逻辑</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** 更新高度信息 - 渲染后获取真实高度并修正位置缓存 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updatePositions</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 如果组件未激活（keep-alive 缓存中），不更新</span>
  <span class="hljs-keyword">if</span> (!isActive.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>
​
  <span class="hljs-keyword">const</span> nodes = itemRefs.<span class="hljs-property">value</span>
  <span class="hljs-keyword">if</span> (!nodes.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span>
​
  <span class="hljs-keyword">let</span> needUpdate = <span class="hljs-literal">false</span>
​
  nodes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">node, idx</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (!node) <span class="hljs-keyword">return</span>
​
    <span class="hljs-keyword">const</span> realIndex = startIndex.<span class="hljs-property">value</span> + idx
    <span class="hljs-keyword">const</span> rect = node.<span class="hljs-title function_">getBoundingClientRect</span>()
    <span class="hljs-keyword">const</span> realHeight = rect.<span class="hljs-property">height</span>
​
    <span class="hljs-comment">// 如果高度为 0，说明元素不可见，跳过</span>
    <span class="hljs-keyword">if</span> (realHeight === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>
​
    <span class="hljs-keyword">const</span> cachedItem = positionCache.<span class="hljs-property">value</span>[realIndex]
    <span class="hljs-keyword">if</span> (!cachedItem) <span class="hljs-keyword">return</span>
​
    <span class="hljs-keyword">const</span> oldHeight = cachedItem.<span class="hljs-property">height</span>
    <span class="hljs-keyword">const</span> heightDiff = realHeight - oldHeight
​
    <span class="hljs-comment">// 允许 0.5px 误差，避免浮点数精度问题</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(heightDiff) &gt; <span class="hljs-number">0.5</span>) {
      needUpdate = <span class="hljs-literal">true</span>
​
      <span class="hljs-comment">// 1️⃣ 更新当前项</span>
      cachedItem.<span class="hljs-property">height</span> = realHeight
      cachedItem.<span class="hljs-property">bottom</span> = cachedItem.<span class="hljs-property">top</span> + realHeight
​
      <span class="hljs-comment">// 2️⃣ 级联更新后续所有项的位置</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = realIndex + <span class="hljs-number">1</span>; i &lt; positionCache.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> prevItem = positionCache.<span class="hljs-property">value</span>[i - <span class="hljs-number">1</span>]
        <span class="hljs-keyword">const</span> currItem = positionCache.<span class="hljs-property">value</span>[i]
        currItem.<span class="hljs-property">top</span> = prevItem.<span class="hljs-property">bottom</span>
        currItem.<span class="hljs-property">bottom</span> = currItem.<span class="hljs-property">top</span> + currItem.<span class="hljs-property">height</span>
      }
    }
  })
​
  <span class="hljs-comment">// 如果有更新，重新计算偏移量</span>
  <span class="hljs-keyword">if</span> (needUpdate) {
    contentOffset.<span class="hljs-property">value</span> = <span class="hljs-title function_">getContentOffset</span>()
  }
}
</code></pre>
<h4 data-id="heading-17">更新流程图解</h4>
<pre><code class="hljs language-scss" lang="scss">渲染后更新流程
─────────────────────────────────────────────────────────────
​
DOM 渲染完成 (onUpdated + nextTick)
    │
    ▼
┌─────────────────────────────────────────┐
│ 遍历所有渲染的 DOM 节点                   │
│ itemRefs<span class="hljs-selector-class">.forEach</span>(node =&gt; ...)           │
└────────┬────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│ 获取真实高度                             │
│ const { <span class="hljs-attribute">height</span> } = <span class="hljs-built_in">getBoundingClientRect</span>() │
└────────┬────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────────────┐
│ 计算高度差                               │
│ heightDiff = realHeight - oldHeight     │
│                                          │
│ 例如：oldHeight=<span class="hljs-number">50</span>, realHeight=<span class="hljs-number">80</span>       │
│ heightDiff = <span class="hljs-number">80</span> - <span class="hljs-number">50</span> = <span class="hljs-number">30</span>               │
└────────┬────────────────────────────────┘
         │
         ▼
    heightDiff !== <span class="hljs-number">0</span> ?
         │
    ┌────┴────┐
    │ 是      │ 否
    ▼         ▼
┌─────────┐  ┌─────────┐
│ 更新缓存 │  │ 跳过    │
└────┬────┘  └─────────┘
     │
     ▼
┌─────────────────────────────────────────┐
│ <span class="hljs-number">1</span>. 更新当前项的 <span class="hljs-attribute">height</span> 和 <span class="hljs-attribute">bottom</span>         │
│ <span class="hljs-number">2</span>. 级联更新后续所有项的 <span class="hljs-attribute">top</span> 和 <span class="hljs-attribute">bottom</span>    │
└─────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-18">Step 5：滚动处理</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/** 滚动处理 - 使用 RAF 优化性能 */</span>
<span class="hljs-keyword">const</span> ticking = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleScroll</span> = (<span class="hljs-params">e</span>) =&gt; {
  <span class="hljs-keyword">if</span> (!ticking.<span class="hljs-property">value</span>) {
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 检查组件是否还存在</span>
      <span class="hljs-keyword">if</span> (!containerRef.<span class="hljs-property">value</span>) {
        ticking.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
        <span class="hljs-keyword">return</span>
      }
​
      <span class="hljs-keyword">const</span> newScrollTop = e.<span class="hljs-property">target</span>.<span class="hljs-property">scrollTop</span>
      scrollTop.<span class="hljs-property">value</span> = newScrollTop
​
      <span class="hljs-comment">// 计算新的起始索引</span>
      <span class="hljs-keyword">const</span> newStartIndex = <span class="hljs-title function_">getStartIndex</span>(newScrollTop)
      
      <span class="hljs-comment">// 只有索引变化时才更新，减少不必要的渲染</span>
      <span class="hljs-keyword">if</span> (newStartIndex !== startIndex.<span class="hljs-property">value</span>) {
        startIndex.<span class="hljs-property">value</span> = newStartIndex
        contentOffset.<span class="hljs-property">value</span> = <span class="hljs-title function_">getContentOffset</span>()
      }
      
      ticking.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    })
    ticking.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  }
}
</code></pre>
<h3 data-id="heading-19">Step 6：模板结构</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 容器 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
    <span class="hljs-attr">ref</span>=<span class="hljs-string">"containerRef"</span> 
    <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span> 
    <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: containerHeight + 'px', width: containerWidth + 'px' }"</span>
  &gt;</span>
    <span class="hljs-comment">&lt;!-- 幽灵层：撑起滚动条 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
      <span class="hljs-attr">ref</span>=<span class="hljs-string">"phantomRef"</span> 
      <span class="hljs-attr">class</span>=<span class="hljs-string">"phantom"</span> 
      <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: phantomHeight + 'px' }"</span>
    /&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 内容层：通过 transform 定位 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
      <span class="hljs-attr">ref</span>=<span class="hljs-string">"contentRef"</span> 
      <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span> 
      <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ transform: `translateY(${contentOffset}px)` }"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> 
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in visibleData"</span> 
        <span class="hljs-attr">:key</span>=<span class="hljs-string">"startIndex + index"</span> 
        <span class="hljs-attr">:ref</span>=<span class="hljs-string">"el =&gt; setItemRef(el, index)"</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"startIndex + index"</span>&gt;</span>
          {{ item }}
        <span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-20">效果</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df2abc01586c48acac998bb38faadf37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGFzaGFu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770787019&amp;x-signature=30zWXrODPacmYzYxrMFiZ6uSs5w%3D" alt="lovegif_1770182005883.gif" loading="lazy"/></p>
<h3 data-id="heading-21">完整代码</h3>
<p>📦 完整组件代码</p>
<pre><code class="hljs language-js" lang="js">&lt;!-- 动态高度list --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 容器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"containerRef"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: containerHeight + 'px', width: containerWidth + 'px' }"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 幽灵高度 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"phantomRef"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"phantom"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: phantomHeight + 'px' }"</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 内容区域 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"contentRef"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ transform: `translateY(${contentOffset}px)` }"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in visibleData"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"startIndex + index"</span> <span class="hljs-attr">:ref</span>=<span class="hljs-string">"el =&gt; setItemRef(el, index)"</span>
                <span class="hljs-attr">class</span>=<span class="hljs-string">"list-item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"startIndex + index"</span>&gt;</span>
                    {{ item }}
                <span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref, computed, onMounted, onUnmounted, onActivated, onDeactivated, toRefs, onUpdated, nextTick, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
    <span class="hljs-comment">// 数据源</span>
    <span class="hljs-attr">listData</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">Array</span>,
        <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> []
    },
    <span class="hljs-comment">// 预估高度</span>
    <span class="hljs-attr">estimatedHeight</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
        <span class="hljs-attr">default</span>: <span class="hljs-number">50</span>
    },
    <span class="hljs-comment">// 容器高度</span>
    <span class="hljs-attr">containerHeight</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
        <span class="hljs-attr">default</span>: <span class="hljs-number">400</span>
    },
    <span class="hljs-comment">//容器宽度</span>
    <span class="hljs-attr">containerWidth</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
        <span class="hljs-attr">default</span>: <span class="hljs-number">300</span>
    },
    <span class="hljs-comment">// 缓冲区大小</span>
    <span class="hljs-attr">bufferSize</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
        <span class="hljs-attr">default</span>: <span class="hljs-number">5</span>
    }
})

<span class="hljs-keyword">const</span> { listData, estimatedHeight, containerHeight, bufferSize } = <span class="hljs-title function_">toRefs</span>(props)

<span class="hljs-comment">// 容器 ref</span>
<span class="hljs-keyword">const</span> containerRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
<span class="hljs-comment">//列表项ref</span>
<span class="hljs-keyword">const</span> itemRefs = <span class="hljs-title function_">ref</span>([])
<span class="hljs-comment">// 组件是否激活（用于 keep-alive）</span>
<span class="hljs-keyword">const</span> isActive = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">true</span>)

<span class="hljs-comment">/** 位置缓存表 */</span>
<span class="hljs-keyword">const</span> positionCache = <span class="hljs-title function_">ref</span>([])
<span class="hljs-comment">// 当前滚动位置</span>
<span class="hljs-keyword">const</span> scrollTop = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-comment">// 开始索引</span>
<span class="hljs-keyword">const</span> startIndex = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
<span class="hljs-comment">//内容偏移量</span>
<span class="hljs-keyword">const</span> contentOffset = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)



<span class="hljs-comment">// 计算：幽灵层高度（撑起滚动条）</span>
<span class="hljs-keyword">const</span> phantomHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> cache = positionCache.<span class="hljs-property">value</span>
    <span class="hljs-keyword">if</span> (!cache.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">return</span> cache[cache.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]?.<span class="hljs-property">bottom</span> || <span class="hljs-number">0</span>
})
<span class="hljs-comment">//计算： 可见数量</span>
<span class="hljs-keyword">const</span> visibleCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(containerHeight.<span class="hljs-property">value</span> / estimatedHeight.<span class="hljs-property">value</span>) + bufferSize.<span class="hljs-property">value</span>
})
<span class="hljs-comment">//计算: 结束索引</span>
<span class="hljs-keyword">const</span> endIndex = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(startIndex.<span class="hljs-property">value</span> + visibleCount.<span class="hljs-property">value</span>, props.<span class="hljs-property">listData</span>.<span class="hljs-property">length</span>)
})
<span class="hljs-comment">//计算：可见数据</span>
<span class="hljs-keyword">const</span> visibleData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> listData.<span class="hljs-property">value</span>.<span class="hljs-title function_">slice</span>(startIndex.<span class="hljs-property">value</span>, endIndex.<span class="hljs-property">value</span>)
})



<span class="hljs-comment">/** 初始化位置 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initPositionCache</span> = (<span class="hljs-params">listData, estimatedHeight</span>) =&gt; {
    positionCache.<span class="hljs-property">value</span> = listData.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> {
            index,
            <span class="hljs-attr">top</span>: index * estimatedHeight,
            <span class="hljs-attr">bottom</span>: (index + <span class="hljs-number">1</span>) * estimatedHeight,
            <span class="hljs-attr">height</span>: estimatedHeight
        }
    })
}

<span class="hljs-comment">/** 获取开始索引 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getStartIndex</span> = (<span class="hljs-params">scrollTop</span>) =&gt; {
    <span class="hljs-keyword">if</span> (!positionCache.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">const</span> item = positionCache.<span class="hljs-property">value</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item &amp;&amp; item.<span class="hljs-property">bottom</span> &gt; scrollTop)
    <span class="hljs-keyword">return</span> item ? item.<span class="hljs-property">index</span> : <span class="hljs-number">0</span>
}

<span class="hljs-comment">/** 获取偏移量 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getContentOffset</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (startIndex.<span class="hljs-property">value</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">const</span> cache = positionCache.<span class="hljs-property">value</span>
    <span class="hljs-keyword">return</span> cache[startIndex.<span class="hljs-property">value</span>]?.<span class="hljs-property">top</span> || <span class="hljs-number">0</span>
}

<span class="hljs-comment">/** 设置列表项 ref（函数形式） */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">setItemRef</span> = (<span class="hljs-params">el, index</span>) =&gt; {
    <span class="hljs-keyword">if</span> (el) {
        itemRefs.<span class="hljs-property">value</span>[index] = el
    }
}


<span class="hljs-comment">/** 更新高度信息 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updatePositions</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// 如果组件未激活（keep-alive 缓存中），不更新</span>
    <span class="hljs-keyword">if</span> (!isActive.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">const</span> nodes = itemRefs.<span class="hljs-property">value</span>
    <span class="hljs-keyword">if</span> (!nodes.<span class="hljs-property">length</span>) <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">let</span> needUpdate = <span class="hljs-literal">false</span>

    nodes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">node, idx</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (!node) <span class="hljs-keyword">return</span>

        <span class="hljs-keyword">const</span> realIndex = startIndex.<span class="hljs-property">value</span> + idx
        <span class="hljs-keyword">const</span> rect = node.<span class="hljs-title function_">getBoundingClientRect</span>()
        <span class="hljs-keyword">const</span> realHeight = rect.<span class="hljs-property">height</span>

        <span class="hljs-comment">// 如果高度为 0，说明元素不可见，跳过</span>
        <span class="hljs-keyword">if</span> (realHeight === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>

        <span class="hljs-keyword">const</span> cachedItem = positionCache.<span class="hljs-property">value</span>[realIndex]

        <span class="hljs-keyword">if</span> (!cachedItem) <span class="hljs-keyword">return</span>

        <span class="hljs-keyword">const</span> oldHeight = cachedItem.<span class="hljs-property">height</span>
        <span class="hljs-keyword">const</span> heightDiff = realHeight - oldHeight

        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(heightDiff) &gt; <span class="hljs-number">0.5</span>) {  <span class="hljs-comment">// 允许 0.5px 误差</span>
            needUpdate = <span class="hljs-literal">true</span>

            <span class="hljs-comment">// 更新当前项</span>
            cachedItem.<span class="hljs-property">height</span> = realHeight
            cachedItem.<span class="hljs-property">bottom</span> = cachedItem.<span class="hljs-property">top</span> + realHeight

            <span class="hljs-comment">// 更新后续所有项的位置</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = realIndex + <span class="hljs-number">1</span>; i &lt; positionCache.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>; i++) {
                <span class="hljs-keyword">const</span> prevItem = positionCache.<span class="hljs-property">value</span>[i - <span class="hljs-number">1</span>]
                <span class="hljs-keyword">const</span> currItem = positionCache.<span class="hljs-property">value</span>[i]
                currItem.<span class="hljs-property">top</span> = prevItem.<span class="hljs-property">bottom</span>
                currItem.<span class="hljs-property">bottom</span> = currItem.<span class="hljs-property">top</span> + currItem.<span class="hljs-property">height</span>
            }
        }
    })

    <span class="hljs-comment">// 如果有更新，重新计算偏移量</span>
    <span class="hljs-keyword">if</span> (needUpdate) {
        contentOffset.<span class="hljs-property">value</span> = <span class="hljs-title function_">getContentOffset</span>()
    }

}



<span class="hljs-comment">/** 滚动处理 RAF */</span>
<span class="hljs-keyword">const</span> ticking = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleScroll</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-keyword">if</span> (!ticking.<span class="hljs-property">value</span>) {
        <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-comment">// 检查组件是否还存在</span>
            <span class="hljs-keyword">if</span> (!containerRef.<span class="hljs-property">value</span>) {
                ticking.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
                <span class="hljs-keyword">return</span>
            }

            <span class="hljs-keyword">const</span> newScrollTop = e.<span class="hljs-property">target</span>.<span class="hljs-property">scrollTop</span>
            scrollTop.<span class="hljs-property">value</span> = newScrollTop

            <span class="hljs-comment">// 计算新的起始索引</span>
            <span class="hljs-keyword">const</span> newStartIndex = <span class="hljs-title function_">getStartIndex</span>(newScrollTop)
            <span class="hljs-comment">// 只有索引变化时才更新</span>
            <span class="hljs-keyword">if</span> (newStartIndex !== startIndex.<span class="hljs-property">value</span>) {
                startIndex.<span class="hljs-property">value</span> = newStartIndex
                contentOffset.<span class="hljs-property">value</span> = <span class="hljs-title function_">getContentOffset</span>()
            }
            ticking.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
        })
        ticking.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
    }
}


<span class="hljs-comment">/** 生命周期 */</span>
<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 绑定滚动事件（初始化移到 watch 中处理）</span>
    containerRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> })
})


<span class="hljs-title function_">onUpdated</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">updatePositions</span>()
    })
})

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
    containerRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll)
    <span class="hljs-comment">// 清空状态，防止内存泄漏和影响其他页面</span>
    itemRefs.<span class="hljs-property">value</span> = []
    positionCache.<span class="hljs-property">value</span> = []
    ticking.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    isActive.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
})

<span class="hljs-comment">// keep-alive 激活时</span>
<span class="hljs-title function_">onActivated</span>(<span class="hljs-function">() =&gt;</span> {
    isActive.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
    <span class="hljs-comment">// 重新绑定滚动事件（以防万一）</span>
    containerRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> })
})

<span class="hljs-comment">// keep-alive 停用时</span>
<span class="hljs-title function_">onDeactivated</span>(<span class="hljs-function">() =&gt;</span> {
    isActive.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
    <span class="hljs-comment">// 移除滚动事件，防止在后台触发</span>
    containerRef.<span class="hljs-property">value</span>?.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'scroll'</span>, handleScroll)
})

<span class="hljs-comment">// 监听数据变化，重新初始化位置缓存</span>
<span class="hljs-title function_">watch</span>(
    <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">listData</span>,
    <span class="hljs-function">(<span class="hljs-params">newData</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (newData &amp;&amp; newData.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// 清空旧的 refs</span>
            itemRefs.<span class="hljs-property">value</span> = []
            <span class="hljs-comment">// 重新初始化位置缓存</span>
            <span class="hljs-title function_">initPositionCache</span>(newData, estimatedHeight.<span class="hljs-property">value</span>)
            <span class="hljs-comment">// 重置滚动状态</span>
            scrollTop.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>
            startIndex.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>
            contentOffset.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>
            <span class="hljs-comment">// 重置容器滚动位置</span>
            <span class="hljs-keyword">if</span> (containerRef.<span class="hljs-property">value</span>) {
                containerRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">0</span>
            }
        }
    },
    {
        <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 立即执行一次（处理初始数据）</span>
        <span class="hljs-attr">deep</span>: <span class="hljs-literal">false</span>       <span class="hljs-comment">// 不需要深度监听，只监听数组引用变化</span>
    }
)

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"less"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">position</span>: relative;
    <span class="hljs-attribute">overflow-y</span>: auto;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e4e7ed</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
    // 优化滚动性能
    <span class="hljs-attribute">will-change</span>: transform;
    -webkit-<span class="hljs-attribute">overflow</span>-scrolling: touch;
}

<span class="hljs-selector-class">.phantom</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">z-index</span>: -<span class="hljs-number">1</span>;
}

<span class="hljs-selector-class">.content</span> {
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">will-change</span>: transform;
}

<span class="hljs-selector-class">.list-item</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span> <span class="hljs-number">16px</span>;
    <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#f0f0f0</span>;
    <span class="hljs-attribute">box-sizing</span>: border-box;
    <span class="hljs-attribute">word-break</span>: break-word;

    &amp;<span class="hljs-selector-pseudo">:last-child</span> {
        <span class="hljs-attribute">border-bottom</span>: none;
    }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-22">🎉 结语</h2>
<p>动态高度虚拟列表是前端性能优化中的重要技术，掌握它可以让你轻松应对各种长列表场景。希望这篇文章能帮助你深入理解其原理并应用到实际项目中！</p>
<p>如果觉得有帮助，欢迎点赞收藏 👍</p>
<blockquote>
<p><strong>下期预告</strong>：虚拟列表系列（3）—— 优化性能</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我做了个 OpenClaw 入门站，7天教程 + 70篇资源全网最全]]></title>    <link>https://juejin.cn/post/7602466689713389583</link>    <guid>https://juejin.cn/post/7602466689713389583</guid>    <pubDate>2026-02-04T05:33:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602466689713389583" data-draft-id="7602474148095705140" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我做了个 OpenClaw 入门站，7天教程 + 70篇资源全网最全"/> <meta itemprop="keywords" content="AIGC,AI编程,Agent"/> <meta itemprop="datePublished" content="2026-02-04T05:33:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我做了个 OpenClaw 入门站，7天教程 + 70篇资源全网最全
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:33:31.000Z" title="Wed Feb 04 2026 05:33:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p><strong>10 万 Star 的 AI 助手项目，中文教程居然还没人系统整理。</strong></p>
<p>所以我花了两天，做了一个：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenclaw101.dev%2F" target="_blank" title="https://openclaw101.dev/" ref="nofollow noopener noreferrer">openclaw101.dev</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16462e6a35694503bcac49035573bd31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788014&amp;x-signature=tiwNpYRmKgqTiVNzbfsR4wfXhXU%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">01 为什么做这个站</h2>
<p>OpenClaw（原 Clawdbot/Moltbot）最近火得一塌糊涂。</p>
<p>GitHub 上 10 万+ Star，Forbes、CNBC、The Verge 轮番报道。</p>
<p>但你去搜教程，会发现：</p>
<ul>
<li>
<p>官方文档是英文的，还很零散</p>
</li>
<li>
<p>中文教程要么太浅，要么太老</p>
</li>
<li>
<p>想系统学习？找不到路径</p>
</li>
</ul>
<p><strong>我决定把这个门槛踩平。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a17e7224f5d14b58b35508dcf2e885f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788014&amp;x-signature=IATMgjn5SaUNJ1HS38RFyt%2B1Qgc%3D" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1">02 7 天学习路径</h2>
<p>我把 OpenClaw 的学习拆成了 7 天：</p>













































<table><thead><tr><th>Day</th><th>主题</th><th>你会获得</th></tr></thead><tbody><tr><td>1</td><td>认识 OpenClaw</td><td>理解它和 ChatGPT 的本质区别</td></tr><tr><td>2</td><td>安装部署</td><td>10 分钟跑起来第一个助手</td></tr><tr><td>3</td><td>赋予灵魂</td><td>SOUL.md / USER.md 配置</td></tr><tr><td>4</td><td>接入生活</td><td>Gmail、日历、搜索对接</td></tr><tr><td>5</td><td>技能扩展</td><td>安装 700+ Skills</td></tr><tr><td>6</td><td>主动工作</td><td>心跳机制 + 定时任务</td></tr><tr><td>7</td><td>进阶玩法</td><td>自定义开发 + 安全配置</td></tr></tbody></table>
<p>每天一个主题，跟着做就完事了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2347f6325c0491382730c91987602e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788014&amp;x-signature=TgOpRFH1UvcMssl2Dj44i11NTAo%3D" alt="" loading="lazy"/></p>
<p><strong>不是让你"了解"，是让你"用上"。</strong></p>
<p>中文版：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenclaw101.dev%2Fzh" target="_blank" title="https://openclaw101.dev/zh" ref="nofollow noopener noreferrer">openclaw101.dev/zh</a></p>
<p>英文版：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenclaw101.dev%2F" target="_blank" title="https://openclaw101.dev/" ref="nofollow noopener noreferrer">openclaw101.dev</a></p>
<hr/>
<h2 data-id="heading-2">03 70+ 精选资源</h2>
<p>我把全网的 OpenClaw 教程扫了一遍，精选了 <strong>70 多篇</strong> 最有价值的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebb8700a37a94883966a6b973ef17940~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788014&amp;x-signature=pCDldHCBlXylGQVog%2Fv2YfjFRVE%3D" alt="" loading="lazy"/></p>
<p><strong>云平台部署</strong></p>
<ul>
<li>
<p>阿里云一键部署（钉钉/企微）</p>
</li>
<li>
<p>腾讯云 Lighthouse（飞书/企微）</p>
</li>
<li>
<p>AWS Mac 实例（苹果生态自动化）</p>
</li>
<li>
<p>DigitalOcean 一键方案</p>
</li>
</ul>
<p><strong>入门教程</strong></p>
<ul>
<li>
<p>菜鸟教程完整版</p>
</li>
<li>
<p>Codecademy 结构化教程</p>
</li>
<li>
<p>DataCamp WhatsApp 远程控制</p>
</li>
<li>
<p>掘金/CSDN/博客园 保姆级教程若干</p>
</li>
</ul>
<p><strong>深度文章</strong></p>
<ul>
<li>
<p>IBM 架构分析</p>
</li>
<li>
<p>Scientific American 科普</p>
</li>
<li>
<p>The Hacker News 安全警示（341 个恶意技能曝光）</p>
</li>
<li>
<p>Cisco 企业安全分析</p>
</li>
</ul>
<p><strong>视频教程</strong></p>
<ul>
<li>
<p>B 站：架构解析、记忆系统拆解、部署教程</p>
</li>
<li>
<p>YouTube：英文入门教程</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46622fa8e195468c9c7f37592b9b165c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788014&amp;x-signature=6acvBhO1J1fzvmFoCrf%2BmyPd%2FbE%3D" alt="" loading="lazy"/></p>
<p>全部分类整理好了，中英文都有，直接去看：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenclaw101.dev%2Fresources" target="_blank" title="https://openclaw101.dev/resources" ref="nofollow noopener noreferrer">openclaw101.dev/resources</a></p>
<hr/>
<h2 data-id="heading-3">04 为什么现在值得学</h2>
<p>三个原因：</p>
<ol>
<li><strong>AI Agent 元年</strong></li>
</ol>
<p>2025 年底 AI 模型跨过了一个临界点——能多步推理、能持续上下文、能自己写代码执行。OpenClaw 是第一批吃到红利的项目。</p>
<ol start="2">
<li><strong>早学早受益</strong></li>
</ol>
<p>AI 助手和传统软件最大的区别是：<strong>它会随时间变好</strong>。你的 MEMORY.md 会积累偏好，技能会越装越多。今天不开始，就是晚一天让助手认识你。</p>
<ol start="3">
<li><strong>竞争才刚开始</strong></li>
</ol>
<p>现在用 OpenClaw 的人还不多，会配置的更少。这是一个窗口期。等半年后人人都会用了，红利就没了。</p>
<p><strong>工具就摆在那里。用不用，是你的事。</strong></p>
<hr/>
<h2 data-id="heading-4">05 一点感想</h2>
<p>我做这个站，不是为了流量。</p>
<p>是因为我自己在用 OpenClaw，我的 AI 助手「小墨」就跑在上面。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8b9cd91aeb14d03bc512a257f014a3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788014&amp;x-signature=Bi7F%2BZm%2B2c3FLh1b4UHycoDhf%2F0%3D" alt="" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fxiaomo.dev%2F" target="_blank" title="https://xiaomo.dev/" ref="nofollow noopener noreferrer">xiaomo.dev/</a></p>
<p>它每天帮我检查邮件、管理日历、分析数据、写代码。我想让更多人体验到这种效率杠杆。</p>
<p>这个项目完全开源，站点代码也开源。如果你觉得有用，帮我点个 Star 或者转发一下，就是最大的支持。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmengjian-github%2Fopenclaw101" target="_blank" title="https://github.com/mengjian-github/openclaw101" ref="nofollow noopener noreferrer">github.com/mengjian-gi…</a></p>
<hr/>
<h2 data-id="heading-5">写在最后</h2>
<ul>
<li>
<p>7 天教程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenclaw101.dev%2Fzh" target="_blank" title="https://openclaw101.dev/zh" ref="nofollow noopener noreferrer">openclaw101.dev/zh</a></p>
</li>
<li>
<p>资源聚合：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenclaw101.dev%2Fresources" target="_blank" title="https://openclaw101.dev/resources" ref="nofollow noopener noreferrer">openclaw101.dev/resources</a></p>
</li>
<li>
<p>飞书版本：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmy.feishu.cn%2Fwiki%2FYkWgwqSchi9xW3kEuZscAm0lnFf" target="_blank" title="https://my.feishu.cn/wiki/YkWgwqSchi9xW3kEuZscAm0lnFf" ref="nofollow noopener noreferrer">小墨 AI 助手 — OpenClaw 7天搭建指南</a></p>
</li>
</ul>
<p><strong>这不是未来。这是现在已经在跑的东西。</strong></p>
<hr/>
<p>如果这篇对你有帮助，欢迎点赞、收藏、关注，你的支持是我持续输出的动力 ✨</p>
<hr/>
<p>我的其他平台账号和开源项目在个人主页中，欢迎交流 🤝</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python Pillow 优化，打开和保存速度最快提高14倍]]></title>    <link>https://juejin.cn/post/7602544700475293706</link>    <guid>https://juejin.cn/post/7602544700475293706</guid>    <pubDate>2026-02-04T05:35:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602544700475293706" data-draft-id="7602551091516882953" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python Pillow 优化，打开和保存速度最快提高14倍"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-02-04T05:35:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="深度涌现"/> <meta itemprop="url" content="https://juejin.cn/user/2524932621734990"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python Pillow 优化，打开和保存速度最快提高14倍
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524932621734990/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    深度涌现
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:35:47.000Z" title="Wed Feb 04 2026 05:35:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Tachyon分析器</h2>
<p>我试用了<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python.org%2Fdownloads%2Flatest%2Fpython3.15%2F" target="_blank" title="https://www.python.org/downloads/latest/python3.15/" ref="nofollow noopener noreferrer">Python 3.15</a>中新增的“高频统计采样分析器” <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.python.org%2F3.15%2Fwhatsnew%2F3.15.html%23whatsnew315-sampling-profiler" target="_blank" title="https://docs.python.org/3.15/whatsnew/3.15.html#whatsnew315-sampling-profiler" ref="nofollow noopener noreferrer">Tachyon</a> ，看看能否提升 Pillow 图像处理库的运行速度。我首先编写了一个简单的脚本来打开图像：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image

im = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">f"Tests/images/hopper.<span class="hljs-subst">{sys.argv[<span class="hljs-number">1</span>]}</span>"</span>)
</code></pre>
<p>然后运行：</p>
<pre><code class="hljs language-console" lang="console"><span class="hljs-meta prompt_">$ </span><span class="bash">python3.15 -m profiling.sampling run --flamegraph /tmp/1.py png</span>
Captured 35 samples in 0.04 seconds
Sample rate: 1,000.00 samples/sec
Error rate: 25.71
Flamegraph data: 1 root functions, total samples: 26, 169 unique strings
Flamegraph saved to: flamegraph_97927.html
</code></pre>
<p>由此生成以下火焰图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0efd59e7112422abeded620541bd2c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex5bqm5raM546w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788149&amp;x-signature=ODDjO2PKj5VH76Aab9I5NNU4Wg4%3D" alt="Flame graph for opening a PNG with Pillow" loading="lazy"/></p>
<p>整个过程耗时 40 毫秒，其中一半在 <code>Image.py</code> 的 <code>open()</code> 中完成。如果您访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fhugovk.dev%2Fblog%2F2026%2Ffaster-pillow%2Fflamegraph_97927.html" target="_blank" title="https://hugovk.dev/blog/2026/faster-pillow/flamegraph_97927.html" ref="nofollow noopener noreferrer">交互式 HTML 页面</a>，我们可以看到 <code>open()</code> 调用 <code>preinit()</code>，而 <code>preinit()</code> 又导入了 <code>GifImagePlugin</code>、<code>BmpImagePlugin</code>、<code>PngImagePlugin</code> 和 <code>JpegImagePlugin</code>（将鼠标悬停在 <code>&lt;module&gt;</code> 框上即可查看它们）。</p>
<p>我们只需要 PNG 格式，真的需要导入所有这些插件吗？</p>
<p>好的，我们来尝试另一种类型的图像：</p>
<pre><code class="hljs language-console" lang="console"><span class="hljs-meta prompt_">$ </span><span class="bash">python3.15 -m profiling.sampling run --flamegraph /tmp/1.py webp</span>
Captured 59 samples in 0.06 seconds
Sample rate: 1,000.00 samples/sec
Error rate: 22.03
Flamegraph data: 1 root functions, total samples: 46, 256 unique strings
Flamegraph saved to: flamegraph_98028.html
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e9c0cbd44ab4687902cdec3be05897f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex5bqm5raM546w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788149&amp;x-signature=cy556qq4eafDc9uRJjhybRzxbEI%3D" alt="Flame graph for opening a WebP with Pillow" loading="lazy"/></p>
<p>嗯，耗时 60 毫秒，其中 80% 的时间在 <code>open()</code> 中，而这 80% 的时间又大部分在 <code>init()</code> 中。HTML<a href="https://link.juejin.cn?target=https%3A%2F%2Fhugovk.dev%2Fblog%2F2026%2Ffaster-pillow%2Fflamegraph_98028.html" target="_blank" title="https://hugovk.dev/blog/2026/faster-pillow/flamegraph_98028.html" ref="nofollow noopener noreferrer">页面</a>显示它导入了 <code>AvifImagePlugin</code>、<code>PdfImagePlugin</code>、<code>WebpImagePlugin</code>、<code>DcxImagePlugin</code>、<code>DdsImagePlugin</code> 和 <code>PalmImagePlugin</code>。此外，<code>preinit</code> 还导入了 <code>GifImagePlugin</code>、<code>BmpImagePlugin</code> 和 <code>PngImagePlugin</code>。</p>
<p>再说一遍，既然我们只关心 WebP，为什么还要导入<em>更多</em>插件呢？</p>
<h2 data-id="heading-1">正在加载所有插件？</h2>
<p>分析就到此为止，我们来看看代码。</p>
<p>当对图像进行<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpython-pillow%2FPillow%2Fblob%2F12.1.0%2Fsrc%2FPIL%2FImage.py%23L3525" target="_blank" title="https://github.com/python-pillow/Pillow/blob/12.1.0/src/PIL/Image.py#L3525" ref="nofollow noopener noreferrer"><code>open()</code></a>或<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpython-pillow%2FPillow%2Fblob%2F12.1.0%2Fsrc%2FPIL%2FImage.py%23L2536" target="_blank" title="https://github.com/python-pillow/Pillow/blob/12.1.0/src/PIL/Image.py#L2536" ref="nofollow noopener noreferrer"><code>save()</code></a>处理时，如果 Pillow 尚未初始化，我们会调用一个<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpython-pillow%2FPillow%2Fblob%2F12.1.0%2Fsrc%2FPIL%2FImage.py%23L327-L369" target="_blank" title="https://github.com/python-pillow/Pillow/blob/12.1.0/src/PIL/Image.py#L327-L369" ref="nofollow noopener noreferrer"><code>preinit()</code></a>函数。该函数通过导入插件来加载五种格式的驱动程序：BMP、GIF、JPEG、PPM 和 PNG。</p>
<p>导入过程中，每个插件<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpython-pillow%2FPillow%2Fblob%2F12.1.0%2Fsrc%2FPIL%2FGifImagePlugin.py%23L1204-L1211" target="_blank" title="https://github.com/python-pillow/Pillow/blob/12.1.0/src/PIL/GifImagePlugin.py#L1204-L1211" ref="nofollow noopener noreferrer">都会注册</a>其文件扩展名、MIME 类型以及一些用于打开和保存的方法。</p>
<p>然后我们依次检查每个插件，看看哪个插件可以接受这张图片。Pillow 的大多数插件都是通过打开文件并检查前几个字节是否匹配某个特定的前缀来检测图片的。例如：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpython-pillow%2FPillow%2Fblob%2F12.1.0%2Fsrc%2FPIL%2FGifImagePlugin.py%23L73-L74" target="_blank" title="https://github.com/python-pillow/Pillow/blob/12.1.0/src/PIL/GifImagePlugin.py#L73-L74" ref="nofollow noopener noreferrer">GIF</a>以 <code>b"GIF87a"</code> 或 <code>b"GIF89a"</code> 开头。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpython-pillow%2FPillow%2Fblob%2F12.1.0%2Fsrc%2FPIL%2FPngImagePlugin.py%23L66" target="_blank" title="https://github.com/python-pillow/Pillow/blob/12.1.0/src/PIL/PngImagePlugin.py#L66" ref="nofollow noopener noreferrer">PNG</a>以 <code>b"\211PNG\r\n\032\n"</code> 开头（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.w3.org%2FTR%2FPNG-Rationale.html%23R.PNG-file-signature" target="_blank" title="https://www.w3.org/TR/PNG-Rationale.html#R.PNG-file-signature" ref="nofollow noopener noreferrer">参考</a>）。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpython-pillow%2FPillow%2Fblob%2F12.1.0%2Fsrc%2FPIL%2FJpegImagePlugin.py%23L334-L336" target="_blank" title="https://github.com/python-pillow/Pillow/blob/12.1.0/src/PIL/JpegImagePlugin.py#L334-L336" ref="nofollow noopener noreferrer">JPEG</a>以 <code>b"\xff\xd8\xff"</code> 开头，其中 <code>\xff\xd8</code> 表示“图像的开始”，<code>\xff</code> 表示下一个标记的开始（<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FJPEG%23Syntax_and_structure" target="_blank" title="https://en.wikipedia.org/wiki/JPEG#Syntax_and_structure" ref="nofollow noopener noreferrer">参考</a>）。</li>
</ul>
<p>如果这五个插件都不符合条件，我们就调用<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpython-pillow%2FPillow%2Fblob%2F12.1.0%2Fsrc%2FPIL%2FImage.py%23L372-L396" target="_blank" title="https://github.com/python-pillow/Pillow/blob/12.1.0/src/PIL/Image.py#L372-L396" ref="nofollow noopener noreferrer"><code>init()</code></a>，它会导入剩余的 42 个插件。然后，我们逐个检查这些插件是否匹配。</p>
<p>这种情况至少从 2000 年发布的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhugovk%2Fpil-svn.effbot.org%2Fblame%2Fmaster%2FPIL%2FImage.py%23L290" target="_blank" title="https://github.com/hugovk/pil-svn.effbot.org/blame/master/PIL/Image.py#L290" ref="nofollow noopener noreferrer">PIL 1.1.1</a>版本开始就存在（这是我能查到的最早版本）。当时有 33 个内置插件，现在是 47 个。</p>
<h2 data-id="heading-2">懒加载</h2>
<p>如果一个程序在其生命周期内只需要一两种图像格式，那么这样做就有点浪费了，尤其是对于命令行界面（CLI）之类的程序。运行时间较长的程序可能需要更多格式，但不太可能需要全部 47 种。</p>
<p>插件系统的一个好处是第三方可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fpillow.readthedocs.io%2Fen%2Fstable%2Fhandbook%2Fthird-party-plugins.html" target="_blank" title="https://pillow.readthedocs.io/en/stable/handbook/third-party-plugins.html" ref="nofollow noopener noreferrer">创建自己的插件</a>，但我们可以使用内置功能提高效率。</p>
<p>我提交了一个<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpython-pillow%2FPillow%2Fpull%2F9398" target="_blank" title="https://github.com/python-pillow/Pillow/pull/9398" ref="nofollow noopener noreferrer">PR</a> ，添加了文件扩展名到插件的映射。在调用 <code>preinit()</code> 或 <code>init()</code> 之前，我们可以先进行简单的查找，这样可以省去导入、注册和检查所有这些插件的步骤。</p>
<p>当然，我们可能会遇到没有扩展名或扩展名“错误”的图像，但这没关系；我估计这种情况很少见，而且无论如何我们都会回退到原来的 <code>preinit()</code> -&gt; <code>init()</code> 流程。</p>
<p>合并 PR 后，以下是用于打开 PNG（ <a href="https://link.juejin.cn?target=https%3A%2F%2Fhugovk.dev%2Fblog%2F2026%2Ffaster-pillow%2Fflamegraph_27477.html" target="_blank" title="https://hugovk.dev/blog/2026/faster-pillow/flamegraph_27477.html" ref="nofollow noopener noreferrer">HTML 页面</a>）的新火焰图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/996dac20d99041d7b90fa27280dc4aff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex5bqm5raM546w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788149&amp;x-signature=9yyE%2B%2BBiJUTPC8Hg7xWt0JVEmx0%3D" alt="Much less compressed flame graph showing less work" loading="lazy"/></p>
<p>对于 WebP（ <a href="https://link.juejin.cn?target=https%3A%2F%2Fhugovk.dev%2Fblog%2F2026%2Ffaster-pillow%2Fflamegraph_26821.html" target="_blank" title="https://hugovk.dev/blog/2026/faster-pillow/flamegraph_26821.html" ref="nofollow noopener noreferrer">HTML 页面</a>）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2af54ca659754199985db77c7ac48b98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rex5bqm5raM546w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788149&amp;x-signature=eEq8rgBU4uVuFPFZdW8eW7ITDu4%3D" alt="Much less compressed for WebP" loading="lazy"/></p>
<p>火焰图的宽度已缩放至相同，但方框数量大大减少，这意味着现在的工作量也大大降低。处理时间从 40 和 60 毫秒降至 20 和 20 毫秒。</p>
<p>该 PR 包含一系列基准测试，结果显示，打开 PNG 图片（之前需要加载 5 个插件）的速度提升了 2.6 倍。打开 WebP 图片（之前需要加载全部 47 个插件）的速度提升了 14 倍。同样，保存 PNG 图片的速度提升了 2.2 倍，保存 WebP 图片的速度提升了 7.9 倍。太棒了！这些改进将在 Pillow 12.2.0 版本中实现。</p>
<h2 data-id="heading-3">参考</h2>
<ul>
<li>Henry Schreiner 谈如何<a href="https://link.juejin.cn?target=https%3A%2F%2Fiscinumpy.dev%2Fpost%2Fpackaging-faster%2F" target="_blank" title="https://iscinumpy.dev/post/packaging-faster/" ref="nofollow noopener noreferrer">加快包装速度</a>。</li>
<li>Adam Johnson 的<a href="https://link.juejin.cn?target=https%3A%2F%2Fadamj.eu%2Ftech%2F2026%2F01%2F14%2Fpython-introducing-tprof%2F" target="_blank" title="https://adamj.eu/tech/2026/01/14/python-introducing-tprof/" ref="nofollow noopener noreferrer">tprof</a>是另一个对这类事情很有用的新工具。</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhugovk.dev%2Fblog%2F2026%2Ffaster-pillow%2F" target="_blank" title="https://hugovk.dev/blog/2026/faster-pillow/" ref="nofollow noopener noreferrer">hugovk.dev/blog/2026/f…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FQNiQEC6U3Ykz-x4PJGiacA" target="_blank" title="https://mp.weixin.qq.com/s/QNiQEC6U3Ykz-x4PJGiacA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/QNiQEC6U3…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端向架构突围系列 - 性能观测 [7 - 4]：如何设立 Performance Budget 并融入 CI/CD]]></title>    <link>https://juejin.cn/post/7602471311510487067</link>    <guid>https://juejin.cn/post/7602471311510487067</guid>    <pubDate>2026-02-04T05:38:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602471311510487067" data-draft-id="7602512226999713842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端向架构突围系列 - 性能观测 [7 - 4]：如何设立 Performance Budget 并融入 CI/CD"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-04T05:38:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王壮壮"/> <meta itemprop="url" content="https://juejin.cn/user/4473272506789485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端向架构突围系列 - 性能观测 [7 - 4]：如何设立 Performance Budget 并融入 CI/CD
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4473272506789485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王壮壮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:38:27.000Z" title="Wed Feb 04 2026 05:38:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>写在前面</strong></p>
<p>很多团队的性能优化流程是这样的： 上线 -&gt; 用户投诉卡 -&gt; 突击优化一周 -&gt; 上线 -&gt; 继续劣化 -&gt; 循环...</p>
<p>这种**“波浪式”<strong>的性能曲线是不可接受的。 架构师的目标是让性能曲线呈现</strong>“锯齿状上升” <strong>（偶尔波动，总体平稳）甚至</strong>“水平直线”**。</p>
<p>这一节，我们将把性能管理从“靠自觉”转变为“靠制度”。我们将学习如何制定 <strong>Performance Budget（性能预算）</strong> ，并把 <strong>Lighthouse CI</strong> 植入到你的 Git Workflow 中。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f0cbf4400e547be97b241711defba3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5aOu5aOu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788306&amp;x-signature=VOio4JNwOI4Om81OEqk1G4Z3bfY%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">一、 什么是 Performance Budget（性能预算）？</h2>
<p>在金融领域，预算意味着“你有多少钱可以花”。 在前端领域，性能预算意味着“为了达到预期的加载速度，你最多能写多少代码/加载多大的资源”。</p>
<h3 data-id="heading-1">1.1 预算的维度</h3>
<p>通常我们可以从两个维度设定预算：</p>
<ol>
<li>
<p><strong>基于资源的预算 (Resource-based):</strong></p>
<ul>
<li><em>规则：</em> JS 总包体积 &lt; 300KB；首屏图片 &lt; 100KB。</li>
<li><em>优点：</em> 简单，确定性强，构建时就能检测。</li>
<li><em>缺点：</em> 体积小不代表跑得快（比如 10KB 的死循环代码）。</li>
</ul>
</li>
<li>
<p><strong>基于指标的预算 (Metric-based):</strong></p>
<ul>
<li><em>规则：</em> LCP &lt; 2.5s；TBT &lt; 300ms；Lighthouse Score &gt; 90。</li>
<li><em>优点：</em> 直接反映用户体验。</li>
<li><em>缺点：</em> 受 CI 机器性能波动影响大（噪音）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-2">1.2 如何制定合理的预算？</h3>
<p>不要拍脑袋定个“LCP &lt; 1秒”，这不切实际。</p>
<ul>
<li><strong>基准线法：</strong> 先测出当前生产环境的平均水平（比如 JS = 500KB），以此为基准，规定 <strong>“新增代码不得导致体积增加超过 5%”</strong> 。</li>
<li><strong>竞品锚定法：</strong> 看看你们最大的竞争对手是多少，设定为“比他们快 20%”。</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、 守门员工具：LightWallet 与 Size-limit</h2>
<p>有了法律（预算），我们需要警察（工具）来执行。</p>
<h3 data-id="heading-4">2.1 静态体积守门员：Size-limit</h3>
<p>这是最轻量级的守门员，适合防范 <code>node_modules</code> 膨胀。</p>
<p><strong>安装与配置：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"size-limit"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/assets/index.*.js"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"limit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"200 KB"</span> <span class="hljs-comment">// 超过这个值，npm run build 直接报错</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/assets/vendor.*.js"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"limit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"500 KB"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>CI 集成：</strong> 在 GitLab CI 或 GitHub Actions 中运行 <code>npx size-limit</code>。一旦超标，Pipeline 变红，禁止合并。</p>
<h3 data-id="heading-5">2.2 运行时指标守门员：Lighthouse CI (LHCI)</h3>
<p>Google 官方出品的神器。它会在 CI 环境启动一个无头浏览器，跑一遍你的页面，并打分。</p>
<p><strong>核心配置 <code>lighthouserc.js</code>：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span> = {
  ci: {
    collect: {
      url: [<span class="hljs-string">'http://localhost:3000/'</span>], <span class="hljs-comment">// 本地启动服务让 LHCI 跑</span>
      startServerCommand: <span class="hljs-string">'npm run start'</span>,
    },
    <span class="hljs-keyword">assert</span>: {
      assertions: {
        <span class="hljs-string">'categories:performance'</span>: [<span class="hljs-string">'error'</span>, { minScore: <span class="hljs-number">0.9</span> }], <span class="hljs-comment">// 性能分低于 90 报错</span>
        <span class="hljs-string">'largest-contentful-paint'</span>: [<span class="hljs-string">'warn'</span>, { maxNumericValue: <span class="hljs-number">2500</span> }], <span class="hljs-comment">// LCP &gt; 2.5s 警告</span>
        <span class="hljs-string">'dom-size'</span>: [<span class="hljs-string">'error'</span>, { maxNumericValue: <span class="hljs-number">2000</span> }], <span class="hljs-comment">// DOM 节点 &gt; 2000 报错</span>
      },
    },
    upload: {
      target: <span class="hljs-string">'temporary-public-storage'</span>, <span class="hljs-comment">// 上传报告以便查看</span>
    },
  },
};
</code></pre>
<hr/>
<h2 data-id="heading-6">三、 实战：构建“不许变慢”的 CI/CD 流水线</h2>
<p>把上述工具串联起来，形成一套完整的防御体系。</p>
<h3 data-id="heading-7">3.1 阶段一：PR Check (代码合并前)</h3>
<p>当同事发起 Pull Request 时，触发 GitHub Actions：</p>
<ol>
<li>
<p><strong>Build:</strong> 构建项目。</p>
</li>
<li>
<p><strong>Size Check:</strong> 运行 <code>size-limit</code>。如果引入了大包（如 <code>lodash</code> 未按需引入），直接 Block PR。</p>
</li>
<li>
<p><strong>Audit:</strong> 运行 <code>Lighthouse CI</code>。</p>
<ul>
<li><em>Diff 模式：</em> 对比 master 分支和当前分支的性能差异。</li>
<li><em>Bot 留言：</em> LHCI 机器人会自动在 PR 下评论：“本次提交导致 LCP 增加了 200ms，请解释或优化。”</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">3.2 阶段二：Monitor (代码合并后)</h3>
<p>上线后，结合我们在第二节搭建的 <strong>APM 系统</strong>。</p>
<ul>
<li><strong>熔断机制：</strong> 虽然少见，但可以设定如果线上 LCP 突增 50%，自动触发回滚（Rollback）。</li>
</ul>
<hr/>
<h2 data-id="heading-9">四、 治理的艺术：如何处理“噪音”与“人心”</h2>
<p>技术只是手段，治理的核心是<strong>人</strong>。</p>
<h3 data-id="heading-10">4.1 解决 CI 波动（Flakiness）</h3>
<p>CI 服务器（如 Jenkins/Actions）的 CPU 负载是不稳定的，可能导致 Lighthouse 跑分忽高忽低。 <strong>架构师策略：</strong></p>
<ul>
<li><strong>多次采样：</strong> 让 LHCI 跑 3-5 次，取中位数（Median）。</li>
<li><strong>相对阈值：</strong> 不要死扣绝对值（2.5s）。设定<strong>劣化阈值</strong>（Regression Threshold），例如“比基准线慢 10% 以上”才报错。</li>
</ul>
<h3 data-id="heading-11">4.2 逐步收紧策略</h3>
<p>不要一上来就开启“报错即阻断”，这会搞崩开发团队的心态。</p>
<ol>
<li><strong>观察期 (第 1 个月):</strong> 只跑数据，不报错，让大家看到报告。</li>
<li><strong>警告期 (第 2 个月):</strong> 超标后 CI 变黄（Warning），机器人留言羞辱，但允许合并。</li>
<li><strong>阻断期 (第 3 个月):</strong> 核心指标（如 Bundle Size）超标，直接 Block。</li>
</ol>
<h3 data-id="heading-12">4.3 性能文化</h3>
<ul>
<li><strong>红黑榜：</strong> 每周发送邮件，列出“本周性能优化最佳提交”和“本周导致性能劣化最严重的提交”。</li>
<li><strong>性能是功能的一部分：</strong> 产品经理提需求时，必须包含性能验收标准。</li>
</ul>
<hr/>
<h2 data-id="heading-13">结语：从“救火队员”到“城市规划师”</h2>
<p>至此，<strong>第七阶段《前端全链路性能体系与可观测性》</strong> 圆满结束。</p>
<p>回顾这四小节，我们走过了一条完整的架构之路：</p>
<ol>
<li><strong>定标准 (Standard):</strong> 确立 Web Vitals，拒绝主观臆测。</li>
<li><strong>搞基建 (Infrastructure):</strong> 搭建 APM，获得上帝视角。</li>
<li><strong>定战术 (Tactics):</strong> 分层级优化，从网络到渲染全覆盖。</li>
<li><strong>做治理 (Governance):</strong> 设立预算与 CI，防止性能腐化。</li>
</ol>
<p>现在的你，不再是那个天天盯着 Chrome DevTools 修 Bug 的救火队员，而是掌控全局、用数据和制度说话的系统架构师。</p>
<p>然而，前端的世界远不止性能。随着业务越来越复杂，单体应用（Monolith）变得难以维护，巨石应用如何拆解？微前端真的是银弹吗？Serverless 能给前端带来什么变革？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Oxygen 9N-LLM生成式推荐训练框架]]></title>    <link>https://juejin.cn/post/7602512064977354815</link>    <guid>https://juejin.cn/post/7602512064977354815</guid>    <pubDate>2026-02-04T05:39:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602512064977354815" data-draft-id="7602529888483770431" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Oxygen 9N-LLM生成式推荐训练框架"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-02-04T05:39:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东零售技术"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Oxygen 9N-LLM生成式推荐训练框架
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东零售技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:39:22.000Z" title="Wed Feb 04 2026 05:39:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读27分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>引言：生成式推荐作为推荐系统领域一个蓬勃发展的新范式，为整个领域带来了新的思路和机遇。它在处理复杂语义、提升推荐多样性、突破效果天花板以及优化系统架构方面展现出巨大潜力，但同时也给训练引擎带来新要求与新挑战。</p>
<p>为了更好的支撑零售算法业务以更高的效率、更低的成本探索这一新方向，<strong>京东零售九数算法平台团队凭借在训练引擎领域多年的技术积累，建设了一套多框架（TensorFlow/PyTorch）、多硬件（GPU/NPU）、多场景（传统/生成式）的统一训练引擎Oxygen 9N-LLM</strong>。该引擎深度整合TensorFlow与 PyTorch双框架、统一适配GPU与NPU异构硬件，有效解决了框架与硬件的兼容性问题，其内置的大规模稀疏Embedding训练引擎、定制化UniAttention加速库、基于Ray的统一RL训练框架等核心组件，协同优化稀疏与稠密参数计算、解决注意力计算以及强化学习流程等系统性难题，加速推动了生成式推荐范式在工业场景的落地（如<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247515195%26idx%3D1%26sn%3Db8271354b4c7db10c68f712f819103ea%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247515195&amp;idx=1&amp;sn=b8271354b4c7db10c68f712f819103ea&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">OxygenREC</a>）。</p>
<p>九数算法平台隶属于京东零售平台产品与研发中心AI Infra与大数据计算部，负责建设服务京东电商业务的AI Infra基础设施。</p>
<h3 data-id="heading-0"><strong>一、背景与挑战</strong></h3>
<p>传统深度学习推荐模型经多年迭代优化，已面临特征工程潜力逼近上限、用户意图建模难度高、级联架构易放大误差、算力利用率不足等核心问题，成为制约其效果进一步提升的核心瓶颈。</p>
<p>LLM 生成式模型爆发式崛起后，将生成式算法与技术应用于推荐领域已成为业界研究热点，即生成式推荐（Generative Recommendations, GRs）。作为区别于传统推荐的新范式，它借助生成式模型强大的序列建模能力，将推荐问题重构为序列生成任务，预测用户可能的下一步操作或偏好物品，为突破传统推荐模型瓶颈提供了全新思路。在这一新兴范式的探索进程中，Meta 的 GR 工作率先验证了 Scaling Law 在推荐系统中的有效性，为生成式推荐的规模化发展奠定了关键基础。在此之后，业界探索了不同技术路径的生成式推荐方案，且在实际工业场景中实现了显著的线上效果提升，充分验证了其商业价值。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b74e1bf496f3480386fbf2118fa87869~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=WR4vYAmv4Q53tXkkVNQHZGQM%2B2s%3D" alt="图片" loading="lazy"/></p>
<p>图1：传统和生成式推荐范式对比</p>
<p>然而，在这一新范式下，模型呈现出的新特性也使得其在工业场景的规模化训练面临多重挑战：</p>
<p><strong>样本的效率和灵活性要求更高：</strong> 生成式场景中样本包括万级用户行为序列，外加多模态特征引入，存储成本扩大上百倍；长序列特征tokenizer/lookup以及多模态特征加载与解码，训练节点的CPU和内存成为瓶颈点，预处理耗时也成倍增长。在TB/PB级的样本、TB级别参数下，断点恢复效率也是影响训练整体效率的非常关键因素。</p>
<p><strong>模型架构跨界融合与框架协同鸿沟：</strong> 生成式推荐采用 T5、GPT-Decoder 等类 LLM 结构，结合 MoE 混合架构，融合传统推荐的稀疏特征与 LLM 的稠密生成特性。但这一跨界架构导致技术栈冲突，传统推荐依赖成熟的 TensorFlow 生态（尤其是大规模稀疏 Embedding 方案），而 LLM 相关优化（低精度量化、多维分布式并行）集中在 PyTorch 生态，两者鸿沟使得框架协同能力缺失，TensorFlow 下实现 LLM 类优化成本极高，PyTorch 在稀疏 Embedding 处理上性能与扩展性不足。</p>
<p><strong>模型规模双向扩展与训练效率挑战：</strong> Scaling Law 驱动下，生成式推荐的稀疏与稠密参数规模同步大幅提升。结合全站全域数据及用户全生命周期序列，模型既要处理 TB 级动态词表与异构特征，稠密参数规模更扩展至 B 级（较传统推荐模型的 0.01B～0.02B 提升至少两个数量级），这种双向规模激增给训练带来非常大的效率挑战。</p>
<p><strong>更加复杂的训练流程：</strong> “预训练-监督微调-强化学习”已成为生成式推荐领域的常见训练流程。在强化学习（RL）阶段，通过设计精巧的奖励系统以及融合多目标业务策略，从而进一步提升模型效果。然而，与标准大语言模型的强化学习（如GRPO）相比，生成式推荐的RL训练更为复杂，其挑战在于其架构（多种自定义组件，如特征拼接模块与Reward服务接口）、工程（实现TB级稀疏与B稠密参数的高效同步）、系统复杂性（融合在线学习的分钟级更新需求），这些独特的复杂性使得现有的大语言模型RL框架（如VeRL、TRL）难以直接复用。</p>
<p>针对上述痛点与挑战，九数团队依托训练引擎领域多年技术积淀，打造了支撑多框架（TensorFlow/PyTorch）、多硬件（GPU/NPU）、多场景（传统 / 生成式）的统一训练框架 9N-LLM。该框架深度融合 TensorFlow与PyTorch 双框架，统一适配 GPU 与 NPU 异构硬件，通过协同优化稀疏与稠密参数的存储计算、注意力计算及强化学习流程等系统性问题，助力生成式推荐范式在京东业务场景快速落地（如OxygenREC）。</p>
<h3 data-id="heading-1">二、9N-LLM生成式推荐训练框架</h3>
<p>9N-LLM 从底层引擎、核心组件到整体框架，为生成式推荐训练提供了全链路解决方案。其搭载的样本引擎、大规模分布式稀疏 Embedding 引擎、底层稠密加速库及 RL 训练模块，可轻松支撑10万级序列、10TB 级稀疏、10B 级规模稠密的生成式推荐模型训练，MFU（硬件算力利用率）最高达40%以上，目前该框架已落地京东主站APP的多个核心流量场，为生成式推荐探索和落地提供坚实支撑，核心特性如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16498b03b14d43a9adeca7acaad3d6af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=djnvkdwQk52ILMbmxMo3bWfKiDg%3D" alt="图片" loading="lazy"/></p>
<p>图2：9N-LLM整体架构图</p>
<p><strong>高效样本引擎</strong>：基于Ray Data构建分布式样本框架，解耦样本与模型计算，支持节点横向扩缩容。对样本预处理算子进行向量化改造，提升样本处理效率。通过把Embedding化的序列存放到KV系统，在训练过程中动态拼接Embedding，可以显著减少样本存储成本，灵活的样本拼接方案支撑复杂的训练流程。在分布式样本处理框架下，提供了行粒度样本管理能力，为大规模训练提供样本无损的断点恢复方案。</p>
<p><strong>大规模分布式训练引擎：</strong> 为弥合生成式推荐中TensorFlow稀疏生态与PyTorch稠密生态的技术鸿沟，我们自主研发了新一代大规模分布式训练引擎，该引擎通过对PyTorch进行深度升级，采用HBM-MEM 分层缓存设计及五级流水线强一致同步训练并行架构，可实现 10TB 级稀疏 Embedding 分布式多机扩展训练，性能达开源 SOTA 方案的 1.14-2.4 倍，内置梯度累积、量化导出等基础训练组件，搭配频次 / 概率 / ShowClick 等准入淘汰策略、动态学习率调度等完备调优方案，具备分钟级在线学习增量导出及 Kafka 参数实时推送能力；同时，针对生成式推荐场景SeqPack/LabelPack等定制化掩码场景，基于 Cutlass/Triton/Tilelang 深度优化打造的Attn加速库，<strong>较 FlexAttention/Compile 性能提升 70%/3.0倍</strong>。</p>
<p><strong>灵活的RL训练能力：</strong> 依托 Ray 分布式计算框架构建强化学习训练体系，通过抽象 SingleController 与 DistributeWorker 核心组件实现架构解耦，可灵活适配Collocated与Disaggregated两种模式，满足不同规模场景下的资源调度需求。内置高效的 IPC（进程间通信）参数同步机制，Loss 计算模块及可扩展的算法组件库，结合样本和训练引擎，能够灵活匹配应生成式推荐场景中多样化的自定义业务逻辑，包括复杂奖励机制设计、动态策略调整、多目标优化需求等，均能通过组件化配置实现灵活支撑，兼顾训练效率与业务适配性。</p>
<p>GPU/NPU全面硬件适配，近0切换成本：全面覆盖京东GPU/NPU 硬件，多硬件间迁移成本近乎为零，原有代码可在 NPU 与 GPU 环境间近无缝切换。</p>
<p>本文后续章节将结合核心技术要点，从样本引擎、训练优化、训练流程三个方面，深入阐述九数生成式推荐训练的系统化解决方案。</p>
<h3 data-id="heading-2">三、高效样本引擎</h3>
<p>相比传统的 LLM 训练，生成式推荐训练场景消费样本量大、训练耗时长、训练节点多。尤其是引入 RL 训练后，多阶段训练组网复杂，需要使用更加灵活的方式完成推理结果与特征的重组。因此，9N-LLM从 IO 吞吐、样本灵活性、训练稳定性三个方面提供了强有力的样本解决方案。</p>
<p><strong>3.1、向量化样本处理，提升 IO 吞吐效率</strong></p>
<p>PyTorch 原生 DataLoader 机制在样本预处理阶段存在数据处理效率低，极易成为训练瓶颈点。为提升海量样本的消费效率，9N-LLM样本引擎从样本文件读取、解析、预处理一直到输送给模型训练的全链路上，应用向量化的技术来加速样本的处理，提升 IO 吞吐效率。</p>
<p><strong>Parquet 列存样本</strong>：支持按列读取特征，不会像行存样本浪费大量的 IO 带宽；列存样本具有非常高的压缩率，可以成倍减少存储成本；基于 SIMD 向量化和多线程技术能够提供极致的解压缩效率。</p>
<p><strong>链式向量化消费链路</strong>：支持用户使用 <code>dataset.map().prefetch().take()</code>模式来消费样本，在调用链路上基于 arrow 内存列式对象 RecordBatch 提升数据处理效率。用户可以在 <code>map(fn)</code>函数中传入向量化的 <code>fn</code>来加速样本预处理，如基于 pyarrow.compute 实现的 lookup、truncate 等数据加工操作。另外通过 <code>prefetch</code>实现 IO Free 机制，用于评估模型极限性能。</p>
<p><strong>DataLoader 向量化改造</strong>： Dataset 和 Collator 间交互的元素从单行元素改造为 Batch，避免了样本拆分与重组开销。原本在 Collator 内部执行的函数，通过向量化改造并迁移到 <code>map(fn)</code>函数中，让 Collator 专注于 Tensor 的构建，并且尽可能把标量类的 Tensor 进行压缩处理，减少父子进程间的数据交互开销。</p>
<p><strong>3.2、动态样本，降低存储成本并提高样本灵活性</strong></p>
<p><strong>3.2.1、动态特征拼接，提供灵活高效样本构建方式</strong></p>
<p>在生成式推荐的 GRPO 流程里面，由 Policy Model 推理生成的 sampling 样本，需要拼接上 item feature 再交给 Reward Model 使用。传统的做法是 sampling 样本写入到 Hive/Kafka 后，再由 Spark 等计算引擎进行离线样本拼接，这样会导致三个阶段的训练比较割裂，并且会存储大量冗余的 item feature。</p>
<p>样本引擎开发了基于 HBase 的动态特征拼接方案，支撑灵活的样本处理方式，用户可以提前把不同的 item features 导入到不同的 HBase 表中。Reward Model 直接从 Kafka/Hive 表中取得推理结果，使用主键去拼接 HBase 中的 item features 进行后续的训练流程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1021e24bdbfd477c806076a4b65d75a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=u0X4KU3SnbDQteY2PbF2afEPFgk%3D" alt="图片" loading="lazy"/></p>
<p>图3：动态特征拼接</p>
<p><strong>3.2.2、Fixed-Period User Event 特征压缩，减少无效存储和冗余计算</strong></p>
<p>传统的训练模式下，用户的每一次曝光都会保存一条样本，在训练过程中需要对同一个用户的相同特征进行多次计算。而在生成式推荐模型中，是对用户的行为序列建模，我们可以把同一用户一段时间内的多次曝光聚合在一起，构成 Fixed-Period User Event 特征。一方面显著减少了 Common 特征的存储成本，另外在特征预处理过程中只需要执行一次特征编解码，并根据行为的产生时间生成掩码，避免模型训练过程中的特征穿越现象，同时是生成式推荐模型计算加速的核心依赖。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d300c8f867054e0393a6b45b6d507329~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=jWnMzZj10eudFVjCtUleBq8E4so%3D" alt="图片" loading="lazy"/></p>
<p>图4：Fixed-Period User Event 特征压缩</p>
<p><strong>3.3、样本无损的断点续训/续推，提升算力资源利用效率</strong></p>
<p>为应对训练中由软硬件故障引发的训练中断，需支持任务失败恢复。为了充分利用闲置资源，9N-LLM支持训练/推理过程中动态扩缩容节点，并支持动态样本分发，即在弹性训练/推理场景下支持样本无损的断点续训/续推，提升算力资源利用效率，如图5和图6所示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0bd3740197a400db54688fca73ce56c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=uWZv3GX80i9lZIEMOx2goCeBuPo%3D" alt="图片" loading="lazy"/></p>
<p>为此，样本引擎构建了行粒度样本无损断点续训/续推解决方案，主要包含以下能力：</p>
<p><strong>行级标识：</strong> 在整个训练/推理链路中传递每条样本的唯一行级元信息，精确记录样本消费进度；</p>
<p><strong>快速定位：</strong> 当任务失败恢复时，能快速跳过已消费的样本，避免无效 IO；</p>
<p><strong>动态 sharding：</strong> 当发生扩缩容时，在 worker 间均匀分配未被消费的样本；</p>
<p><strong>模型与数据同步：</strong> 建立样本 ckpt 与模型 ckpt 的同步机制，模型恢复时同步加载样本 ckpt；</p>
<p><strong>分布式样本处理：</strong> 基于 Ray Data 构建分布式的样本处理能力，支持样本处理资源的横向动态扩缩容。</p>
<h3 data-id="heading-3">四、大规模稀疏分布式引擎</h3>
<p>生成式推荐新范式下，大规模稀疏参数仍是保障模型效果的核心支撑。9N-LLM重构了零售场景已成熟落地的训练引擎，同时兼容TensorFlow/PyTorch、GPU/NPU 硬件；其依托多级缓存、五级流水线的核心架构设计，同时凭借完备的调参策略机制，可支撑 10TB 级稀疏参数高效的横向扩展训练。</p>
<p><strong>4.1、多级 Cache + 全 GPU/NPU 计算/通信架构：10TB 级稀疏参数存储与计算基石</strong></p>
<p>整体上，稀疏参数通过模型并行互不重叠分散在不同训练节点上，稠密参数则通过数据并行在所有节点上复制。每次迭代时，各节点读取本地数据，按稀疏参数分片规则对样本中的 Key 进行分桶，并通过 All2All 将 Key 发送到对应节点，同时查询对应的 Embedding 向量，再通过 All2All 传回各节点，随后执行前向与反向传播。稠密参数的梯度通过 AllReduce 在各节点间同步，稀疏参数的梯度则通过 All2All 传输并更新对应的 Embedding 向量。</p>
<p>为支撑万亿级稀疏参数的训练，引擎采用Device/Host Memory 多级存储 + 全 GPU计算/通信核心架构。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/187bb818f5dd497c9959634d7fc03d07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=ms4pZVmKJYn6F6FWZDUMS7t4JHI%3D" alt="图片" loading="lazy"/></p>
<p>图7：分布式分层存储架构</p>
<p><strong>Device/Host Memory 分布式分层 KV 存储架构：</strong> 该架构以HBM-MEM分层设计为核心，实现大规模稀疏参数的高效访问。训练过程中，稀疏参数会被组织为独立的键值对分片，采用无重叠策略存储于各训练节点的主机内存Host Memory中（例如，当分片总数为 256、训练节点数（rank 数）为 8 时，各分片与节点的对应分布关系如图8所示）。同时通过无锁队列访问和并行读取更新机制，可将Mem Embedding查询、更新、Save/Load效率提升数倍。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/490ef61e4e3a43dcbf738579370acc1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=iWNHWXDT8ug5GIs1xbXIQ4wpYAU%3D" alt="image.png" loading="lazy"/></p>
<p>图8：稀疏参数分片示意图</p>
<p>与此同时，设备内存Device Memory承担缓存核心角色，其会提前加载并保存未来 N 个训练步骤中所需的全部 Embedding 参数。分层设计下，每个训练步骤无需频繁从主机内存读取数据，而是利用设备内存的高带宽特性直接从缓存中快速获取所需参数，从而降低参数读取延迟，是实现10TB级参数可扩展、高效存取的核心。</p>
<p><strong>全 GPU/NPU 计算与通信：</strong> Emb 的查询、梯度同步采用 GPU Direct RDMA 集合通信，以最大化带宽利用；依托对称内存（Symmetric Memory）技术，构建非阻塞单边 All2All 通信模式，接收方无需阻塞等待，大幅降低通信延迟；同时结合流水线分片技术，在多个测试场景中实现 All2All 吞吐量 5%～30% 的提升。同时，针对所有 Embedding 操作（Id 输入分片、Embedding查询、Embedding Grad 聚合、稀疏优化器、Embedding 参数更新），我们均重新使用 CUDA/Triton/Tilelang 实现和优化，以充分释放硬件计算潜能。</p>
<p><strong>4.2、强一致同步五级流水线：性能为业界开源最佳性能的1.14～2.44倍</strong></p>
<p>分层 MEM-HBM 架构虽解决了10 TB 级参数的横向扩展难题，但在训练流程中，从 MEM 查询训练所需 Embedding、再将更新后的 Embedding 写回 MEM 的过程中，面对大规模、超长序列、高频率的查询与更新场景，CPU 串行查询、H2D/D2H数据拷贝的等待耗时会大幅增加，直接制约了整个模型的训练效率（如图9中红色部分）。以一个简单例子来说，如训练Batch size 为2048， 序列长度为1w（70%重复），Dim为1024， 则单次查询量约23.4GB （2048<em>10000</em>1024<em>4/(1024</em>1024<em>1024)</em>(1-0.7)） ，H2D耗时大约为400～800ms（PCIE 5.0x16 单向带宽实测约30～50GB）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4904bd2e45824f0082f8a65e40440f2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=iwKDct8lsaqsg2n1WoJt3exK7X0%3D" alt="image.png" loading="lazy"/></p>
<p>我们实现了动态词表的多级流水方案，通过拆解流程、并行掩盖的核心思路重点解决该问题，将原本串行的 “数据准备- Embedding 查询-模型计算” 全链路，整理为五个阶段：</p>
<p><strong>Data Prefetch：</strong> 样本读取和样本解析；</p>
<p><strong>Data H2D：</strong> 将MEM中解析后样本拷贝至Device；</p>
<p><strong>Input Dist：</strong> 提取样本中的稀疏特征Key，根据词表分片规则，将Key进行分桶并进行AllToAll，确保每个设备仅接收与自身负责的 Embedding分片匹配的key；</p>
<p><strong>Emb Lookup：</strong> 根据接受到的Key在Host MEM 侧完成Embedding向量查询，再将查询到的 Embedding 向量拷贝至Device；</p>
<p><strong>Fwd/Bwd/Opt：</strong> 执行 Emb All2All，将Embedding 同步至对应的Rank；至此本次训练迭代所需的Embedding向量已在HBM就绪；接下来完整执行模型的前向计算、反向计算得到对应的梯度；执行Grad All2Alll，将梯度发送至对应Rank，进行梯度聚合并更新参数，最后将更新后的Embedding 写回MEM。 </p>
<p><strong>五级流水线：通过精细化的阶段重叠执行机制实现延迟掩盖</strong></p>
<p>在训练中，当 batch 0 在 GPU 上进行核心计算时（前向传播、反向传播及参数更新），系统通过任务调度已同步推进后续多个批次（如 batch 1 至 4）的预处理工作。例如，batch 1 在查询向量，batch 2 在进行通信，batch 3 在准备数据，batch 4 则在预加载数据。这种“计算与数据准备并行”的流水线设计，有效掩盖了数据传输与通信的延迟，将等待时间转化为有效工作。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93855301e5d947d38cc926a1e01d345e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=JrT8MmGIpJMttPuRj5OyrhhqNPI%3D" alt="图片" loading="lazy"/></p>
<p>在大规模查询更新场景下，该流水线重叠执行机制的优势更为突出 —— 其通过抵消数据预处理、传输、查询等环节的延迟开销，大幅缩短了单个训练迭代的有效耗时，比如在百G 稀疏、B级稠密模型场景测试中，可将Embedding耗时占比从15%降低至5%以内，其Embedding查询、更新性能在内部环境下测试，不同场景为业界开源最佳性能的1.14～2.44倍。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d537a6e6b4a84dee950dfe615dad0fa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=3IgSE%2ByVXwDPXt9u1RC16RLo4Jg%3D" alt="图片" loading="lazy"/></p>
<p><strong>4.3、完备稀疏参数调优策略和训练机制</strong></p>
<p>围绕稀疏模型训练的全流程需求，引擎构建了覆盖Embedding准入、淘汰调优策略、定制化稀疏优化器、动态词表导入导出的完备机制，确保 10TB 级扩展下的稀疏参数精细化训练。</p>
<p><strong>4.3.1、特征准入与淘汰，精细化管理动态词表</strong></p>
<p>针对低价值特征浪费资源、引发过拟合的问题，通过灵活的准入与淘汰策略，实现动态词表的高效管理：</p>
<p>准入策略：支持 CountFilter（频次阈值）、ProbabilityFilter（几何分布概率）、ShowClickFilter（点击得分）三种方式，过滤低贡献特征，提升模型泛化能力并减少资源占用。</p>
<p>淘汰策略：提供 CountShrink（版本新鲜度）、L2WeightShrink（贡献度量化）、TimeFreqCombineShrink（时间 + 频次多维度）、ShowClickShrink（点击统计）四种选择，剔除无效特征，节约内存并保障训练效果。</p>
<p><strong>4.3.2、定制化稀疏优化器</strong></p>
<p>针对TensorFlow/PyTorch 原生优化器在稀疏场景下适配性不足的问题，引擎通过双重机制实现灵活调控：</p>
<p>一方面内置 Lazy Adam、RAdaGrad、AdamDecay、AdamW 等多种稀疏优化器</p>
<p>另外一方面支持自定义学习率调度策略，可根据训练进度动态调整稀疏参数学习率，内置主流策略，线性衰减（平稳递减）、余弦退火（平滑下降）、指数衰减（先快后慢）。</p>
<p><strong>4.3.3、动态词表 Save/Load CKPT：高效支撑大规模部署</strong></p>
<p>采用分片式词表分布设计（类模型并行），将稀疏参数拆分至多个训练节点，结合独立的稀疏部分存储机制，提升词表规模与操作效率：</p>
<p>核心优势：多分片并行加速查询 / 更新 / Save / Load；充分利用多节点内存 / 显存，突破词表规模上限；与 Dense 部分解耦，操作轻量、控制精细。</p>
<p>支持增量导出加载、低精度（FP16/INT8/INT4）量化导出，kafka流式推送，是降低线上资源、保障在线学习时效性重要优化方式。</p>
<h3 data-id="heading-4">五、大规模稠密计算引擎</h3>
<p><strong>5.1、复用生成式训练优化技术</strong></p>
<p>得益于 PyTorch 训练框架的深度支持，以及与LLM同质的 Attention 结构设计。结合九数在LLM方面的优化经验，我们可以较为轻松的复用 LLM 训练中已验证的成熟训练优化能力。表2中列举了一些常见的优化方式，可通过便捷的配置选项、改动在 9N-LLM 中启用，能够在生成式推荐模型的训练中，平衡显存、算力、通信，以提升整体训练性能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80f4edba8ad8444ca4481ee1207d77ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=iYCOF5OoK%2FihZD4RslLBVdnBk%2F0%3D" alt="image.png" loading="lazy"/></p>
<p>表2：常见的生成式训练优化技术</p>
<p><strong>5.2、UniAttention：针对生成式推荐Attention特点加速优化</strong></p>
<p>值得注意的是，FlashAttn 作为 LLM 训练中的核心计算优化技术，通过充分利用硬件特性，如异步访存、CUDA Core/TensorCore 并行计算及寄存器优化等，能够显著降低训练显存占用，并提升常规 Causal 与 Full Attention 的计算性能。然而，在生成式推荐训练场景中，Attention 的计算形式并非标准类型，而通常更为复杂，体现在两方面：</p>
<p><strong>序列结构复杂：</strong> 生成式推荐场景有可能将输入序列划分为多个语义区段，例如“用户特征序列段”、“用户历史行为序列段”、“当日实时行为序列段”及“曝光点击行为段”等。每个序列段可独立配置为 Full 或 Causal 注意力模式，形成混合结构。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d7ec459655b494585956da61a96f902~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=c56rhdDlV5tmsW32qD7pZsOblbc%3D" alt="图片" loading="lazy"/></p>
<p>图11：LLM与生成式推荐场景Mask对比</p>
<p><strong>训练样本聚合方式特殊：</strong> 为了提升生成式推荐训练效率，训练样本通常按用户单日曝光点击行为进行聚合，其中实时行为与曝光样本依时间由近至远排列。这意味着较早发生的行为不可见较晚发生的行为，形成一种非对称的局部因果依赖，其 Attention 计算逻辑比传统 LLM 中的 Causal Attention 更加复杂。</p>
<p>因此，在该场景下通常无法直接使用高度优化的 FlashAttn，而只能依赖 PyTorch 原生算子或使用 FlexAttention 等扩展方案，是制约整体训练性能的关键瓶颈。为此，9N-LLM 推出了支持自定义掩码的专用加速库 UniAttention。该库基于 Triton/Cutlass/Tilelang 等编译器技术，针对生成式推荐中的 HSTU、GPT Decoder 和 T5 等主流结构进行了深度优化，其性能显著超越现有方案，较 FlexAttn/Compile 分别提升 70% 与 3.0 倍，为生成式推荐训练提供了关键的高性能支撑。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/187c779eadb042768339306028ac8c27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=A%2F6YWujC8Ja7F%2FZ9ZG%2Br4cfdqq0%3D" alt="图片" loading="lazy"/></p>
<p>图12：UniAttention加速库</p>
<p>具体来说，我们深入硬件底层、结合硬件特性，从<strong>寄存器优化</strong>与<strong>流水线编排</strong>两个维度出发，基于 Cutlass 与 Tilelang 对HSTU Attn 和 SDPA算子进行了深度定制与优化。</p>
<p>在生成式推荐场景中，Mask 与输入数据高度相关，导致 Mask 相关计算与判断逻辑显著复杂化，进而大幅增加了寄存器压力。为应对这一挑战，我们采用了<strong>Compute/Mask 双区间调度算法</strong>，将矩阵乘法与 Mask 计算分别置于两个连续的独立区间执行，不仅优化了 Mask 判断流程，同时可减少20%～50% GEMM 计算与 Mask 判断次数。在流水线编排方面，UniAttention 充分利用 Hopper 架构中 <strong>wgmma 指令的异步特性</strong>，使矩阵运算与 Softmax、Mask 等非矩阵运算在两个 warpgroup 之间交错执行。当其中一个 warpgroup 执行非矩阵运算时，算子可调度另一个 warpgroup 并行执行矩阵运算，从而实现了 Tensor Core 算力的高效利用。通过上述两项关键优化，UniAttention 在复杂多变的 Mask 场景下实现了高性能的 Attention 算子，助力生成式推荐模型的高性能训练。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d586e0ea970645b0a6e35d6e8bf3b23b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=9RopANIHQdzV1RudAbhC5rrmCJU%3D" alt="图片" loading="lazy"/></p>
<p>表3：UniAttention性能数据</p>
<h3 data-id="heading-5">六、强化学习训练能力</h3>
<p><strong>6.1、生成式推荐场景的强化学习特点</strong></p>
<p>强化学习作为一种强大的决策与优化框架，是提升大模型推理能力、驱动AI Agent实现高阶自主性的关键催化剂。具体到生成式推荐场景，在经历预训练与监督微调之后，强化学习阶段被引入，其核心价值在于为模型赋予了“探索”与“自我优化”的能力，模型不再仅仅被动拟合已有数据，而是能通过与环境互动，主动发现更优的推荐策略，实现持续的效果进化。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91ee8d8586c348599c99054a9748d146~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=oFjlhcYR%2F8vi2DF8mkQAGwiw%2B1M%3D" alt="图片" loading="lazy"/></p>
<p>图13：生成式推荐RL流程</p>
<p>图13展示了生成式推荐的强化学习（RL）训练过程，其核心模块（RollOut、Reward、Reference、Policy）及整体流程与大语言模型（LLM）的 RL 训练逻辑一致，均依赖灵活的任务调度、高效的资源分配与稳定高效的多节点通信，但二者在实际落地场景中存在明显差异：</p>
<p><strong>模型与样本特性不同：</strong></p>
<p>输入样本为传统稀疏 ID/SID 类型，依赖原生 PyTorch 词表或大规模稀疏词表（LLM 多为稠密文本输入）。</p>
<p>模型结构借鉴 LLM 核心模块，但需适配稀疏场景，Reward 打分可能复用推荐场景全量模型。</p>
<p><strong>采样与流程设计不同：</strong></p>
<p>采样采用定制化 BeamSearch，专门过滤生成 SID/IDList（LLM 侧重文本生成采样）。</p>
<p>训练流程存在较多自定义设计，新增特征拼接模块，RewardWorker 可能调用在线接口或 TensorFlow 模型。</p>
<p><strong>参数同步与性能挑战不同：</strong></p>
<p>推荐场景 CTR 模型稀疏参数量达 TB 级别，跨进程参数更新的同步成本极高，易引发性能问题（LLM 以稠密参数为主，参数同步逻辑更成熟）。</p>
<p><strong>6.2、基于Ray的强化学习解决方案</strong></p>
<p>9N-LLM 基于 Ray 框架构建，面向大语言模型与生成式推荐的复合训练场景，通过能力拓展与架构统一，有效应对生成式推荐中强化学习（RL）训练的关键挑战：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9db5975527346ae9101016bfd8ae408~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=TDUotmW%2BaWZV0F%2F%2B1uzxvICCXGs%3D" alt="图片" loading="lazy"/></p>
<p>图14：基于Ray的通用框架设计</p>
<p><strong>多场景兼容</strong>：统一支持 LLM、多模态及生成式推荐、MultiAgent场景下的强化学习任务，实现跨场景训练能力复用。</p>
<p><strong>资源灵活调度</strong>：支持节点间任意资源配置，提供 Actor 的同卡（Collocate）与分离（Disaggregated）部署模式。在同卡模式下，实现大规模稀疏参数的复用，避免冗余拷贝；进程内支持高效 IPC 通信，提升稠密参数同步效率。</p>
<p><strong>高度可定制</strong>：Worker 内部支持自定义数据、模型、训练与离线推理流程，兼容包括大规模稀疏参数在内的自定义节点。通过 SingleController 模式与 Worker 间的灵活编排，满足生成式推荐 RL 训练中如特征拼接、跨框架调用等定制化需求。</p>
<h3 data-id="heading-6">七、结语</h3>
<p>生成式推荐作为推荐系统领域一个蓬勃发展的新范式，为整个领域带来了新的思路和机遇。在过去一段时间，我们深刻认识到：样本模态日益丰富、算法架构快速迭代、硬件生态日趋多元，面对这样繁杂的多元状态，作为AI Infra，必须回归第一性原理，设计能够充分利用并随样本、计算资源指数级增长而持续扩展的AI架构。</p>
<p>正如图灵奖得主Richard Sutton在《苦涩的教训》中深刻指出的，AI发展的长远趋势证明，那些依赖大规模计算与通用学习的方法终将超越融入人类精巧设计的路径。这一洞见一直指引着我们的技术演进，让基础设施真正具备“随着算力增长而线性扩展”的能力。</p>
<p>面向未来，我们将持续推进两大核心方向的探索：</p>
<p><strong>在基础设施层面</strong>，为应对未来硬件规模化、大规模通信瓶颈及多元算力融合的趋势，我们将重点探索通信与计算模式的根本性升级，并通过统一内存架构优化，实现跨硬件平台的高效带宽与显存利用，让算力资源的使用效率实现质的飞跃。</p>
<p><strong>在系统智能层面</strong>，我们将与业务紧密协同，以新一代奖励模型为核心驱动，通过在线强化学习整合多模态信息与用户全生命周期行为，旨在构建一个超越短期点击指标、具备长期用户价值的、真正智能的生成式推荐系统。</p>
<h2 data-id="heading-7"><strong>招聘</strong></h2>
<p>欢迎对AI Infra、LLM/CTR模型训练、样本引擎、算力调度感兴趣的同学加入九数团队，和我们一起打造京东智能化AI基建。</p>
<p>📮 简历投递：<a href="https://link.juejin.cn?target=mailto%3Ahanpingping11%40jd.com" target="_blank" title="mailto:hanpingping11@jd.com" ref="nofollow noopener noreferrer">hanpingping11@jd.com</a>、<a href="https://link.juejin.cn?target=mailto%3Achenzhen48%40jd.com" target="_blank" title="mailto:chenzhen48@jd.com" ref="nofollow noopener noreferrer">chenzhen48@jd.com</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f95f75581df44de4a55bc49ffb99a064~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788366&amp;x-signature=kbOn1Sjc%2FUs79dlL6TkLHtTYTfE%3D" alt="图片" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OiiOii怎么生成邀请码加入？最新OiiOii邀请码获取教程亲测有效|教你如何领取OiiOii邀请码]]></title>    <link>https://juejin.cn/post/7602551091517014025</link>    <guid>https://juejin.cn/post/7602551091517014025</guid>    <pubDate>2026-02-04T05:43:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602551091517014025" data-draft-id="7602471311510519835" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OiiOii怎么生成邀请码加入？最新OiiOii邀请码获取教程亲测有效|教你如何领取OiiOii邀请码"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-04T05:43:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mac的实验室"/> <meta itemprop="url" content="https://juejin.cn/user/2958128164897127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OiiOii怎么生成邀请码加入？最新OiiOii邀请码获取教程亲测有效|教你如何领取OiiOii邀请码
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2958128164897127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mac的实验室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:43:46.000Z" title="Wed Feb 04 2026 05:43:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>OiiOii是最近很火的一个AI动画制作平台，我看到好多人都在用，就也试了一下。由于很多人找不到自己的OiiOii邀请码所以无法注册，下面分享我是如何获取OiiOii邀请码和使用OiiOii创作的体验教程！</p>
<p>OiiOii 是动画创作 Agent ，致力于让每一个人都能轻松实现动画梦想。融合了前沿的 AI 模型（如 Sora2、Wan2.5）与智能 Agent 系统，让用户通过自然语言对话，即可生成高质量的动画短片、角色、分镜、MV 等内容。</p>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fwww.oiioii.ai" target="_blank" title="https://link.zhihu.com/?target=https%3A//www.oiioii.ai" ref="nofollow noopener noreferrer">www.oiioii.ai</a></p>
<p>这个平台是网页，可以直接搜索OiiOii官网，进入到这个界面：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/021cb0f0b9844553ac4889de6482fd12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=OGvUGYAEi7584GP%2FvVrJUQ935yQ%3D" alt="" loading="lazy"/></p>
<p>这个平台目前还在内测当中，注册是需要邀请码的，如果没有邀请码，可以找官方申请或者上小红书找，小红书上有很多分享邀请码的，我的就是在小红书上找的。</p>
<p>这个邀请码一定要找最新的，不然可能就失效了，我试了好几次，才成功。</p>
<p>点击使用邀请码加入后，会进入到注册界面。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8a971f2145140778613d39a0a66482f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=tKdpqIDp0xiKVs%2B%2F4tBfQ9k%2F4PE%3D" alt="" loading="lazy"/></p>
<ul>
<li>如果在小红书找不到的话，可以尝试访问<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fai-bot.cn%2Fsites%2F66553.html" target="_blank" title="https://link.zhihu.com/?target=https%3A//ai-bot.cn/sites/66553.html" ref="nofollow noopener noreferrer">OiiOii</a>官网填写OiiOii测试资格申请表 <a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fecncw7du1qtr.feishu.cn%2Fshare%2Fbase%2Fform%2FshrcnoDL0jJv3hcrDAoysbOBh4d" target="_blank" title="https://link.zhihu.com/?target=https%3A//ecncw7du1qtr.feishu.cn/share/base/form/shrcnoDL0jJv3hcrDAoysbOBh4d" ref="nofollow noopener noreferrer">ecncw7du1qtr.feishu.cn/share/base/…</a>，优先获取访问权限。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cb4798f3e624a79aac4085cd25a3255~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=vy1Hg%2F4B%2FmFxw%2ByLJ61bIgMEv4c%3D" alt="" loading="lazy"/></p>
<p>填写你的身份介绍，社交媒体链接，个人微信和邮箱等信息申请官方内测邀请码，这个需要官方审核一段时间，通过后才能发放。觉得麻烦不想折腾的同学可以在公众号：<strong>Mac的实验室</strong> 后台回复 <strong>oii</strong> 获取最新的邀请码入口。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6a7ecd4769a4154ab6420fa29378981~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=41SxURmJg0DhopwSIyBYGLP4QrA%3D" alt="" loading="lazy"/></p>
<p>这个界面需要填邮箱和密码，需要注意的是邮箱一定要填对，因为邮箱是用来验证的，创建账户之后会收到验证邮件。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6533856e4d60468c82308c17f574fef4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=9OHwokHrFeLsVI4h1LTGSnhN5I0%3D" alt="" loading="lazy"/></p>
<p>点击这个邮件中间的紫色部分，就会跳转网页，允许跳转就能成功验证。</p>
<p>这个在手机上也是可以登录使用的，但画面太小了，不方便，我后面还是用平板的截图示范。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5d4153eef0d42b581dc335e1afc13b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=5auiXIOTgm4E0sSGnB7Le5sFEWQ%3D" alt="" loading="lazy"/></p>
<p>这个使用是需要积分的，成功注册会获得1000积分，签到能获得300积分，后续的使用需要用到。</p>
<p>如果我们要做动画视频，可以选择里面的“剧情故事短片”，在里面输入剧本或者想要改编的小说片段，选择托管模式，点击“对话模式”旁边的箭头，就会进入到自动制作的流程。</p>
<p>后面的只要按步骤提示操作来就可以。</p>
<p>这个流程其实是比较久的，因为后面要选择想要的比例、画风、语言之类的，重新设计剧本，然后再进入到人物的设计，分镜的生成等流程，这些流程是会自动完成的，中间只需要看一下，确认一下，选择一下就可以。</p>
<p>如果生成的视频不对，可以选择重新生成。</p>
<p>如果想要效果更好，可以自己后期再做一下剪辑，中间的视频素材和声音素材都是可以下载的，也可以选择直接下载最后的成品用来剪辑。</p>
<p>我试着做了几个动画短片，感觉直出的效果不够理想，都做了后期剪辑，后期剪辑是比较费时的，而且剪辑的效果也不一定理想，最好还是中间仔细看一下，先把剧本和细节调整好，再生成最后的视频。</p>
<p><strong>有兴趣的同学可以看下下面的操作体验教程，帮助挺大的~</strong></p>
<p><em><strong>【玩法1】-做剧情动画</strong></em></p>
<p>默认选择<strong>托管模式</strong>，输入任意指令（也可上传张图），点击开始即可。</p>
<p>口令：给我做个动画</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dd6b57695f1449a97c9a27ee20987d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=R8K%2By0ysQ5Q%2FY4vCgpGx9U0EJP8%3D" alt="" loading="lazy"/></p>
<p>选择想制作的动画类型后，选择完基础属性、情绪和风格：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c10d2bc2bb674e0380813023a0f91ad6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=WSXWS02KwBS1FjUYDVt3Jb27XPM%3D" alt="" loading="lazy"/></p>
<p><strong>然后，就去吃饭、打游戏吧！什么都不用管，Agent就都会做了，等你再回来，它就已经自动跑完出片了！</strong> （切记中间不要干扰他，不然它容易不高兴）最后点击预览视频，如果满意，就可以下载完慢慢欣赏啦～</p>
<h3 data-id="heading-0"><strong>【这里是重点！！！】：</strong></h3>
<h3 data-id="heading-1">如遇到分镜生成失败，请<strong>点击</strong>【帮我<strong>修改提示词并重试</strong>】！如下图：</h3>
<p>（需看下失败原因，如版权相关问题，可尝试多次，耐心等待，会提高成功概率）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6fe8a61d79a4a10b31efe1e3055601e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=%2BsYmzpGUN%2BDC9RCOADQ%2FeJzt930%3D" alt="" loading="lazy"/></p>
<p><em><strong>【玩法2】-快速生视频</strong></em></p>
<p>OiiOii接入市面上效果最好最新的模型如Sora2、Wan2.5，结合OiiOii的Agent能力，能够一句话快速把想法制作成运镜流畅、节奏合理的短视频，以及<strong>动感卡点的各类动画MV！</strong></p>
<h3 data-id="heading-2">做MV💃！！！！！——重要，好看好看好看，重要的话三遍。</h3>
<p>选择快速生视频模式，然后上传一张图，输入指令，点击开始即可。</p>
<p>口令：用上传的角色，做一个日本动漫音乐OP MV</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24fb40aeb7984c0c9b440ea1daef7754~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=JihKxdPvThTTrTEAo2UKxhc%2FYoA%3D" alt="" loading="lazy"/></p>
<p>还有不同种mv玩法，<strong>上传图片后，</strong> 输入口令如下！</p>
<ul>
<li>
<p>做一个角色主题 MV</p>
</li>
<li>
<p>做一个Kpop MV</p>
</li>
<li>
<p>做一个跳舞为主的MV</p>
</li>
<li>
<p>做一个美剧片头MV</p>
</li>
</ul>
<h3 data-id="heading-3"><em><strong>漫画变动画📹</strong></em></h3>
<p>选择漫画转动画模式，然后上传一张漫画图，输入指令，点击开始即可。</p>
<p>口令：做个温馨浪漫的动画</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/768241a3172b4dce99afdca93c4844ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=p12c9agY%2BhV%2Fm%2B5Y8BmDI7RS57k%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4"><em><strong>动态壁纸❄️</strong></em></h3>
<p><strong>一定要强调用wan2.5！一定要强调用wan2.5！一定要强调用wan2.5！</strong> 上传一张想让它动起来的图片，输入指令，点击开始。</p>
<p>口令：用wan2.5模型，做动态壁纸</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85db12df6c6248d9bf22eade539fbccc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=T3M7mx5X1KWBP2nfyynFyvO6J8w%3D" alt="" loading="lazy"/></p>
<p><strong>02 进阶期-与众不同</strong></p>
<p>当你掌握了基础操作之后，就可以适当的给Agent上一些难度了，这时你可以试着给它提更多个性化的要求和尝试！</p>
<p><em><strong>【玩法1】-做个有导演风格的动画</strong></em></p>
<p>上传角色图或导演风格的图片，输入带有导演名字的指令，开始创作。</p>
<p>口令：用韦斯.安德森的风格做个动画</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7b710bb899845239ddafd82f60e3bac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=uAcIiR9qNQAlrDu1NVlDNNTnD9E%3D" alt="" loading="lazy"/></p>
<p><strong>口令可以直接复制去用！</strong></p>
<ul>
<li>
<p>用韦斯.安德森的风格做个动画</p>
</li>
<li>
<p>为我生成慢门低速镜头，要有王家卫风格，兼具港风</p>
</li>
<li>
<p>为我做一个《教父》风格的动画，光影要有艺术感</p>
</li>
<li>
<p>展现温子仁的恐怖片拍摄效果，要展示心理恐怖的概念，用到温子仁常用的一些恐怖意象</p>
</li>
<li>
<p>做一个西部世界风格的1分半短片</p>
</li>
</ul>
<p><em><strong>【玩法2】-用自己的分镜做个动画</strong></em></p>
<p>你可以按自己的想法，对每个镜头的画面进行描述，同时也可以在最开始就选择好自己想要的画风。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd099b87ac614ccfade8d38e76d17278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=3js9HuljndV4PWAFk%2B%2FYnCu5zg4%3D" alt="" loading="lazy"/></p>
<p><em><strong>【玩法3】-创建一个属于自己的原创角色</strong></em></p>
<p>方式1：选择风格库风格，文字描述想要的角色</p>
<p>口令：参考xxxxx（可不写），做个xxxx的角色</p>
<p>方式2：上传一张参考图，要求它参考角色/参考风格/参考角色+风格/直接使用这张图，生成角色</p>
<p>口令：参考图中的xxxx，做一个xxxxx的角色</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/200cc9aabb0b44dba81be0fb072469d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=mzQsiwih78JK4DjmJVXMooB7uwE%3D" alt="" loading="lazy"/></p>
<p>进入后任务后，选择创建【角色形象】，然后你的角色就会诞生啦</p>
<p>之后你可以选择下载图片，编辑图片/角色，或者将角色加入角色库，在后续视频、图片中反复调用</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eafd2e3dbf6546fe931d932b1f80bf65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=sxU6S7T%2BMiFAwQiKFf8adIfpPOA%3D" alt="" loading="lazy"/></p>
<p><strong>03 成熟期（精雕细琢+IP化）</strong></p>
<p>现在，你对OiiOii的基本操作了如指掌，下一步，就是开启对话模式，加入更多自己的创意，修改细节，让你的动画变得更精致更完整，然后做出自己的IP吧。</p>
<p>要记住～<strong>模仿是走在别人铺好的大路上，虽然轻松，但是到达的却是别人的终点。</strong> 以下是一些编辑以及做好动画的捷径。</p>
<p><em><strong>【玩法1】-分镜生成与修改</strong></em></p>
<h3 data-id="heading-5">方式1：对话修改</h3>
<p>口令：把分镜x的改为xxxxx</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b38d7a24c8e409a865d7960ad06c86e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=Idhz42SHEBpQ1WhXOlYltyt7AxU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">方式2：画布操作</h3>
<ul>
<li>编辑分镜：点击分镜图中的“编辑分镜”，即可进入分镜编辑修改页面：</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c43a10160b0543fab87a12f737e9a6db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=OpiJecrOtbPTu4MEB1u650QM1N4%3D" alt="" loading="lazy"/></p>
<ul>
<li>裁剪分镜：点击对应分镜右上角的“小剪刀”，拖动下方的时间轴，即可裁剪分镜视频。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06a14cb0ec224b9cbc172417ab5bed73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=E%2FtePull2lz0Cd4D5ukkbphWnzA%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c88e1fe541143f0a44606bbc54eb5ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=9%2B3D67g%2BkHplKRnquerg8SFTIzo%3D" alt="" loading="lazy"/></p>
<ul>
<li>增加分镜：点击分镜之间的+号，即可增加新的分镜，用于过渡衔接。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85d6e581603a439e93357442ce43db56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=mlgXGACzLx59lO%2BZJwXQKduGWac%3D" alt="" loading="lazy"/></p>
<p><em><strong>【玩法2】- 重点！！利用自己的角色，做个IP系列</strong></em></p>
<p>选择加入过角色库的角色，输入口令即可</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea7f1af742404ec9b40ba35ea6012e18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770788626&amp;x-signature=%2Fbo8p%2BBTS4xjjp37XqMlvKz7Yt4%3D" alt="" loading="lazy"/></p>
<p><em><strong>【玩法3】-写出一个更好的故事</strong></em></p>
<h3 data-id="heading-7">方式1：更清晰简单的和Agent表达主题</h3>
<p>口令：做一个以xx为主句的，xx分钟，xx风格的，能让人感到xx的动画，需要有哪些细节&amp;特点</p>
<h3 data-id="heading-8">方式2：结构清晰，包含开头、过程、结局</h3>
<p>口令：做一个xx视频，xx风格，动画演示‘如何快速打包行李箱’（主题），从衣物脏乱的摆放（开头），到自动折叠（过程），最后飞入箱子（结局），步骤清晰带有标注，背景音乐轻快，节奏明快，适合短视频播放。</p>
<p><strong>03</strong> <strong>特别提示——重要</strong></p>
<p>【版权提示】：如果因版权问题而无法生成，可以尝试输入换装角色名称，例如“穿唐装的路飞”，“穿西装的鸣人”等。</p>
<p>【输入建议】：描述尽量清晰，如“卡通风格”、“电影感”、“快节奏”。</p>
<p>【修改机制】：支持多次修改，可通过“重新生成”或具体指令优化结果。</p>
<p>保姆级教程转载自<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fmp.weixin.qq.com%2Fs%2Fd2395Md5QHoPf30nRSBTmA" target="_blank" title="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/d2395Md5QHoPf30nRSBTmA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/d239</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建芯片制造企业内网密码安全防线]]></title>    <link>https://juejin.cn/post/7602529888483868735</link>    <guid>https://juejin.cn/post/7602529888483868735</guid>    <pubDate>2026-02-04T05:58:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602529888483868735" data-draft-id="7602529888483803199" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建芯片制造企业内网密码安全防线"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-04T05:58:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="运维有小邓1"/> <meta itemprop="url" content="https://juejin.cn/user/930603309497018"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建芯片制造企业内网密码安全防线
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/930603309497018/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    运维有小邓1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T05:58:56.000Z" title="Wed Feb 04 2026 05:58:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在芯片制造行业，从晶圆代工、芯片设计到封装测试，全流程涉及海量核心数据——包括芯片设计图纸、工艺参数、生产设备操控权限、供应链机密等。这些数据一旦因密码泄露引发安全事件，不仅可能导致核心技术外泄、生产中断，更会造成动辄千万级的经济损失与品牌声誉重创。</p>
<p>国际权威报告Verizon《2025数据泄露调查报告（DBIR）》显示，30%的数据泄露源于内网安全问题，其中密码管理失序（如弱密码、密码复用、权限滥用）是首要诱因。对于高度依赖内网协同的芯片制造企业而言，构建高效、合规的密码管理体系，已成为保障生产经营安全的核心要务。</p>
<p>PasswordManager Plus作为专业的企业级密码管理解决方案，凭借针对性的功能设计，精准匹配芯片制造企业的内网安全需求，为企业筑牢密码安全防线。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef943ac40b5048aba4ca0d8f4afc1249~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-Q57u05pyJ5bCP6YKTMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770789536&amp;x-signature=qLSWIxcvJ8TinDgZE8QrGberqiM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-0">一、芯片制造企业的核心密码安全痛点</h3>
<p>芯片制造企业的内网环境复杂且敏感，密码管理面临多重独特挑战：</p>
<p><strong>多场景密码管理混乱：</strong> 涉及生产设备（光刻机、蚀刻机等）操控系统、设计软件（EDA工具）、企业ERP系统、供应链管理平台等多个场景，每个场景均需独立密码，员工易出现密码复用、手写记录、简单密码等不安全行为。</p>
<p><strong>权限管控难度大：</strong> 企业内部岗位层级多（研发、生产、质检、运维、管理），外部涉及上下游供应商、合作机构等第三方人员，不同角色需分配不同密码权限，传统人工管理模式易出现权限分配不当、离职员工权限回收不及时等问题。</p>
<p><strong>合规性要求高：</strong> 芯片制造企业多涉及国际贸易与核心技术保护，需符合ISO 27001、NIST等国际安全标准，以及行业特定的合规要求，密码管理需具备完整的审计日志、权限追溯功能。</p>
<p><strong>应急响应效率低：</strong> 一旦出现密码泄露、设备操控密码遗忘等情况，传统流程需层层审批申请重置，易延误生产进度，造成不必要的损失。</p>
<h3 data-id="heading-1">二、PasswordManager Plus适配芯片制造企业的核心能力</h3>
<p>针对上述痛点，PasswordManager Plus从密码集中管理、精细化权限管控、合规审计、高效运维等维度，提供全流程解决方案：</p>
<p><strong>1. 多场景密码集中管控，消除管理盲区</strong><br/>
PasswordManager Plus支持对芯片制造全流程的密码进行集中存储与管理，涵盖生产设备控制系统、EDA设计工具、企业级应用系统、云服务等各类场景。系统采用AES-256加密算法对密码进行加密存储，确保密码数据本身的安全性。同时，支持自动密码生成功能，可为不同场景生成符合复杂度要求的强密码，从源头避免弱密码风险。员工无需记忆海量密码，仅需通过一个主密码即可访问授权的密码资源，大幅提升工作效率的同时，消除密码复用、随意记录等安全隐患。</p>
<p><strong>2. 精细化权限分级，适配复杂组织架构</strong><br/>
结合芯片制造企业的岗位特点，PasswordManager Plus提供基于角色的访问控制（RBAC）机制，可根据研发、生产、运维、第三方供应商等不同角色，精准分配密码访问权限。例如，研发人员仅能访问EDA工具、设计相关系统的密码，生产人员仅能获取对应生产设备的操控密码，第三方供应商仅能访问合作相关的有限系统密码。同时，支持权限的动态调整与离职员工权限的一键回收，避免权限滥用与遗留风险。</p>
<p><strong>3. 全流程合规审计，满足国际安全标准</strong><br/>
PasswordManager Plus具备完整的审计日志功能，可实时记录密码的创建、访问、修改、删除等所有操作，包括操作人、操作时间、操作内容等关键信息，形成可追溯的安全审计链条。系统内置符合ISO 27001、NIST等国际标准的合规报表模板，企业可直接导出报表用于合规检查，大幅降低合规成本。此外，支持密码定期更换提醒与自动更换功能，确保密码使用符合安全规范。</p>
<p><strong>4. 高效运维与应急响应，保障生产连续性</strong><br/>
针对芯片制造企业生产连续性的核心需求，PasswordManager Plus提供便捷的密码重置与应急访问功能。当员工遗忘密码或出现密码泄露时，可通过预设的审批流程快速申请密码重置，审批通过后系统自动同步新密码至相关系统，避免生产中断。同时，支持运维人员在紧急情况下的临时权限授权，且所有应急操作均会被详细记录，确保安全与效率的平衡。</p>
<h3 data-id="heading-2">三、实战案例：PasswordManager Plus助力芯片制造企业提升安全能级</h3>
<p>某国内头部芯片制造企业，此前因员工密码复用导致内网系统被入侵，核心工艺参数面临泄露风险，同时因权限管理混乱，多次出现离职员工权限未及时回收的问题。引入PasswordManager Plus后，企业实现了全场景密码的集中管控，员工密码复用率从68%降至0，密码相关安全事件发生率下降92%；通过精细化权限分级，明确了各岗位密码访问范围，离职员工权限回收效率提升至实时完成；完整的审计日志与合规报表，助力企业顺利通过ISO 27001复审。此外，系统的自动密码生成与同步功能，使员工平均密码管理时间减少70%，大幅提升了工作效率。</p>
<h3 data-id="heading-3">四、结语：密码安全是芯片制造企业的核心防线</h3>
<p>在芯片制造行业竞争日趋激烈、核心技术保护需求日益迫切的背景下，密码安全作为内网安全的第一道防线，直接关系到企业的生存与发展。PasswordManager Plus凭借针对性的功能设计，为芯片制造企业提供集集中管理、精细授权、合规审计、高效运维于一体的密码安全解决方案，助力企业筑牢安全防线，保障核心数据与生产经营安全。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[济南即梦 Meetup 圆桌上，我对这波 AI 浪潮的粗浅看法]]></title>    <link>https://juejin.cn/post/7602553969969528886</link>    <guid>https://juejin.cn/post/7602553969969528886</guid>    <pubDate>2026-02-04T04:03:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602553969969528886" data-draft-id="7602512064977092671" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="济南即梦 Meetup 圆桌上，我对这波 AI 浪潮的粗浅看法"/> <meta itemprop="keywords" content="人工智能,AIGC,AI编程"/> <meta itemprop="datePublished" content="2026-02-04T04:03:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            济南即梦 Meetup 圆桌上，我对这波 AI 浪潮的粗浅看法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:03:27.000Z" title="Wed Feb 04 2026 04:03:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上周日，有幸作为圆桌嘉宾参加了济南的<strong>即梦 Meetup</strong>。没想到现场聊得兴起，还“借光”上了山东卫视的生活频道——真挺幸运的。</p>
<p>现场回答问题有些仓促，很多想法没来得及展开。回来后想了想，不如趁热打铁整理一下，既方便自己复盘，也希望能给关注 AI 提效与职业发展的朋友们一点参考。</p>
<h2 data-id="heading-0">问题一：提效和变现。</h2>
<p>个人目前聚焦的是<strong>提效</strong>方向，因此这块也主要是聊一下提效。</p>
<p>我感觉 AI 提效分为两个方向：</p>
<ul>
<li>横向扩展能力边界</li>
<li>纵向提升能力水平</li>
</ul>
<p><strong>横向</strong>来说，AI 让我们具备了很多原本没有的能力。</p>
<p>比如我是程序员出身，代码是我的强项，但是设计我就不怎么擅长。</p>
<p>而借助比如“即梦AI”这样的生图工具，我可以很快的设计出产品的 Logo，网页效果等，大大扩展了我的能力边界。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41b63fd41fdb4938b5d728e29af9496d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782609&amp;x-signature=ytdjPIz8ab7d70p%2F7%2B%2BTiKfMwqY%3D" alt="碎片工具集萤的Logo" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e0191979e714d00afacd65d16329848~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782609&amp;x-signature=e9a%2Bt6i9Rbc1uNHVdTvW4%2F3WrfU%3D" alt="网页设计" loading="lazy"/></p>
<p><strong>纵向</strong>上，AI 可以让我更快地完成原来的工作，省出更多的时间去完成更具创造性的事情。</p>
<p>比如，前几天社群的官网，从确定内容、设计开发、部署上线，一共花了2个小时，这还包括了域名、服务器购买。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d361228c664943ac92e6b20151626e70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782609&amp;x-signature=cg5VqmezsBZ%2FEoP7waPrncCBU%2Fw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">问题二：危机</h2>
<p>去年年初发过一篇文章，《<a href="https://juejin.cn/post/7444842933453864998" target="_blank" title="https://juejin.cn/post/7444842933453864998">Cursor：前端不会消失，但前端的你会消失 - 掘金</a>》，当时的危机讨论挺多的。</p>
<p>个人认为：<strong>危机必然存在，但没那么大</strong>。</p>
<p>就像蒸汽革命中汽车代替马车一样，原有的车夫肯定消失了，但司机出现了。并且由于生产力的发展，司机的数量远超原来马夫的数量。</p>
<p>映射到当前，也是一样的。原来可做可不做的需求落地成本降低了，整体上的市场其实是变大的。</p>
<p>但任何事情都需要两面看。</p>
<p>“历史的一粒尘埃，落在个人头上就是一座山。”</p>
<p>我们切换到微观角度，原有的马车夫肯定受到了巨大冲击，不能及时拥抱变化的甚至遭到了淘汰。</p>
<p>因此，建议大家不管什么行业、什么岗位，最起码要<strong>跟上这波浪潮，不要成为那个被淘汰的马车夫</strong>。</p>
<h2 data-id="heading-2">问题三：建议</h2>
<p>AI 是人工智能的简写，核心就是“智能”。</p>
<p>我们就把“智能”拆开聊聊。</p>
<p>首先是“<strong>智</strong>”。</p>
<p>相对于之前的工业革命、信息革命，AI 这次“革命”的上手难度应该是最低的了，习惯了电脑、手机的我们，想要上手 AI 就像聊天一样简单。</p>
<p>因此，<strong>第一个建议就是“用”</strong>，不管免费、收费的，不管文本的、图像的，大家尽早开始。</p>
<p>虽然，AI 很高端，但熟能生巧这事，在 AI 中依然有效。</p>
<p>其次是“<strong>能</strong>”。</p>
<p>我理解有两个方面。</p>
<ul>
<li>一是 让 AI 做它擅长的事。</li>
</ul>
<p>当前的 AI 并非万能，但它在文本生成、图像创作、代码辅助、信息提炼等领域已经非常成熟。因此，我们要善于分辨哪些适合 AI，哪些适合人类，各自做擅长的事情。</p>
<ul>
<li>二是 帮助 AI 把事儿做好。</li>
</ul>
<p>这就需要我们持续学习——通过设计工作流、优化提示词、引入人工校验或交叉验证，才能真正提升 AI 输出的效率和可靠性。</p>
<p>毕竟，别指望一句话就能轻易换来完美结果。</p>
<h2 data-id="heading-3">结语</h2>
<p>AI时代，挑战真实存在，但机会也前所未有。</p>
<p>希望大家在这次浪潮里面都能找到适合自己的位置。</p>
<p>共勉，加油！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[有干货，更有共鸣——这次亦庄之行，圆满了。、]]></title>    <link>https://juejin.cn/post/7602559134575214628</link>    <guid>https://juejin.cn/post/7602559134575214628</guid>    <pubDate>2026-02-04T04:06:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602559134575214628" data-draft-id="7602512064977125439" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="有干货，更有共鸣——这次亦庄之行，圆满了。、"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-04T04:06:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            有干货，更有共鸣——这次亦庄之行，圆满了。、
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:06:05.000Z" title="Wed Feb 04 2026 04:06:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>1.31去了趟北京，参加了“北京亦庄模数OPC社区生态伙伴大会”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6c1590073384e5f93a58f5fc80e7fa1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782765&amp;x-signature=t0worqaiwUlp431a0zaW3JbyB0g%3D" alt="" loading="lazy"/></p>
<p>本来只是抱着涨涨见识去的，顺便可以现场见见<strong>卡兹克</strong>大神，没想到全程参与完，收获远超预期。</p>
<p>首先，是这次的主题 —— <code>OPC</code> 社区。北京亦庄的 <code>OPC</code> 生态，既有政策与资金托底，又有园区 <code>5A</code> 支持体系，加上卡神、鲤鱼老师、汗青老师等先行者的探索，以及 <code>WaytoAGI</code> 社区的协同链接，整个生态，真的很完善！</p>
<p>而整个活动的分享内容，不论是前面的专题，还是后面的圆桌，更是干货满满。</p>
<p>内容太多，只挑选几个触动比较大的分享给大家。</p>
<p>鲤鱼老师**探秘“OPC”**的分享让我对 <code>OPC</code> 的认识大大加深，更明确了社区对 <code>OPC</code> 的价值需要落在：<strong>找队友</strong>（新的组织业态）、<strong>接资源</strong>（订单政策）、<strong>有温度</strong>（各方面的支持）上，这都是济南社群后续可以直接参考的样板。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64efa7519c79463a9bd13c74d4ae912c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782765&amp;x-signature=7MCrfQtWj2FzxIOtCafjETOmEwk%3D" alt="" loading="lazy"/></p>
<p>汗青老师则是通过“<strong>遇见亦庄故事</strong>”，为我们分享了虚拟偶像“<strong>Yuri</strong>”从0到全球110万粉丝的成长历程，也点出了“<strong>被看见</strong>”的重要性，引起大家的强烈共鸣。其中，500+的案例更是让人震撼。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85856af9ee204891a97a0b847219bafe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782765&amp;x-signature=KTPsyhyQ0NiI3J9bRtJXOeftKq0%3D" alt="" loading="lazy"/></p>
<p>而“<strong>超级个体诞生过程AI如何改变公司组建的底层逻辑</strong>”的圆桌讨论，则给我带来了很多的思考。比如：</p>
<ul>
<li>勇敢尝试是第一步</li>
<li>热爱才能持久</li>
<li>能够接受不确定性</li>
</ul>
<p>虽然今天的分享收获蛮多，但真正让我心头一震的，不是某个新工具或新概念，而是 ——
<strong>我之前分享的“AI与人的关系”，“AI时代通才会更有需求”等思考，在大佬这里都得到了印证</strong>。</p>
<p>这种“原来有人和我想的一样”的认同感，给我续上了继续坚持的底气。</p>
<p>回程的高铁上敲下这些字，算是对今天这场“被看见”的记录。</p>
<p>愿未来路上，遇见更多同频的人——诸君共勉。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python WebRTC 实战：从零开始构建实时音视频通信应用]]></title>    <link>https://juejin.cn/post/7602529888483524671</link>    <guid>https://juejin.cn/post/7602529888483524671</guid>    <pubDate>2026-02-04T03:51:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602529888483524671" data-draft-id="7602454700504956969" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python WebRTC 实战：从零开始构建实时音视频通信应用"/> <meta itemprop="keywords" content="WebRTC,Python"/> <meta itemprop="datePublished" content="2026-02-04T03:51:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="好名字_技术分享"/> <meta itemprop="url" content="https://juejin.cn/user/1101056944119610"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python WebRTC 实战：从零开始构建实时音视频通信应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1101056944119610/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    好名字_技术分享
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T03:51:11.000Z" title="Wed Feb 04 2026 03:51:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Python WebRTC 实战：从零开始构建实时音视频通信应用</h2>
<p>WebRTC（Web Real-Time Communication）是一种支持浏览器和移动应用进行实时音视频通信的技术。在Python中，我们可以利用WebRTC实现浏览器与浏览器、或浏览器与服务器之间的实时数据传输。本文将从基础概念到实际应用，带你全面掌握Python中的WebRTC开发。</p>
<h3 data-id="heading-1">WebRTC 基础概念</h3>
<h4 data-id="heading-2">什么是WebRTC？</h4>
<p>WebRTC是一个开源项目，它提供了一组标准的API，使得浏览器之间可以进行直接的点对点（P2P）通信。无需通过中转服务器，数据可以直接在浏览器之间传输，大大降低了延迟。</p>
<h4 data-id="heading-3">核心组件</h4>
<p>WebRTC的三个核心组件包括：</p>
<ol>
<li><strong>MediaStream API</strong> - 用于获取音频和视频流</li>
<li><strong>RTCPeerConnection</strong> - 用于建立和管理点对点连接</li>
<li><strong>RTCDataChannel</strong> - 用于传输任意数据</li>
</ol>
<h3 data-id="heading-4">Python中的WebRTC实现方式</h3>
<p>在Python生态中，有几种主流方式可以集成WebRTC功能：</p>
<h4 data-id="heading-5">1. aiortc - 异步WebRTC实现</h4>
<p>aiortc是一个纯Python实现的WebRTC库，基于asyncio框架，性能优异且易于使用。</p>
<h5 data-id="heading-6">安装</h5>
<pre><code class="hljs language-bash" lang="bash">pip install aiortc
</code></pre>
<h5 data-id="heading-7">创建视频流</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">from</span> aiortc <span class="hljs-keyword">import</span> RTCPeerConnection, MediaStreamTrack

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoTrack</span>(<span class="hljs-title class_ inherited__">MediaStreamTrack</span>):
    kind = <span class="hljs-string">"video"</span>

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">recv</span>(<span class="hljs-params">self</span>):
        pts, time_base = <span class="hljs-keyword">await</span> self.next_timestamp()
        frame = <span class="hljs-keyword">await</span> self.next_frame()
        <span class="hljs-keyword">return</span> frame

<span class="hljs-comment"># 创建并启动视频流</span>
video_track = VideoTrack()
peer_connection = RTCPeerConnection()
peer_connection.addTrack(video_track)
</code></pre>
<h4 data-id="heading-8">2. 使用Janus或Mediasoup等服务器</h4>
<p>对于生产环境，建议使用成熟的WebRTC服务器：</p>
<ul>
<li><strong>Janus</strong> - 通用的WebRTC网关</li>
<li><strong>Mediasoup</strong> - 基于Node.js的SFU（Selective Forwarding Unit）</li>
<li><strong>Ant Media Server</strong> - 支持WebRTC、SIP、RTMP等多种协议</li>
</ul>
<h4 data-id="heading-9">3. Python + WebRTC Server</h4>
<p>使用<code>webrtc-python</code>库搭建WebRTC信令服务器：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> aiortc <span class="hljs-keyword">import</span> RTCPeerConnection
<span class="hljs-keyword">from</span> aiohttp <span class="hljs-keyword">import</span> web

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">offer</span>(<span class="hljs-params">request</span>):
    params = <span class="hljs-keyword">await</span> request.json()
    peer_connection = RTCPeerConnection()
    peer_connection.setRemoteDescription(params[<span class="hljs-string">"offer"</span>])
    answer = peer_connection.createAnswer()
    <span class="hljs-keyword">return</span> web.json_response({<span class="hljs-string">"sdp"</span>: answer.sdp})

app = web.Application()
app.router.add_post(<span class="hljs-string">'/offer'</span>, offer)
web.run_app(app, port=<span class="hljs-number">8080</span>)
</code></pre>
<h3 data-id="heading-10">实战案例：视频会议系统</h3>
<p>让我们构建一个简单的视频会议系统：</p>
<h4 data-id="heading-11">前端代码（HTML/JS）</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"localVideo"</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">playsinline</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">video</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"remoteVideo"</span> <span class="hljs-attr">autoplay</span> <span class="hljs-attr">playsinline</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">video</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">const</span> peerConnection = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RTCPeerConnection</span>();

navigator.<span class="hljs-property">mediaDevices</span>.<span class="hljs-title function_">getUserMedia</span>({ <span class="hljs-attr">video</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">audio</span>: <span class="hljs-literal">true</span> })
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">stream</span> =&gt;</span> {
    localVideo.<span class="hljs-property">srcObject</span> = stream;
    stream.<span class="hljs-title function_">getTracks</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">track</span> =&gt;</span> peerConnection.<span class="hljs-title function_">addTrack</span>(track, stream));
  });

peerConnection.<span class="hljs-property">ontrack</span> = <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  remoteVideo.<span class="hljs-property">srcObject</span> = event.<span class="hljs-property">streams</span>[<span class="hljs-number">0</span>];
};

<span class="hljs-comment">// 信令服务器连接</span>
<span class="hljs-keyword">const</span> socket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">'ws://localhost:8080'</span>);
socket.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">async</span> event =&gt; {
  <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">offer</span>) {
    <span class="hljs-keyword">await</span> peerConnection.<span class="hljs-title function_">setRemoteDescription</span>(data.<span class="hljs-property">offer</span>);
    <span class="hljs-keyword">const</span> answer = <span class="hljs-keyword">await</span> peerConnection.<span class="hljs-title function_">createAnswer</span>();
    socket.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ answer }));
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-12">Python后端信令服务器</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> aiohttp
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> uuid
<span class="hljs-keyword">from</span> aiortc <span class="hljs-keyword">import</span> RTCPeerConnection, RTCSessionDescription

connected_peers = {}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_websocket</span>(<span class="hljs-params">request</span>):
    ws = web.WebSocketResponse()
    peer_id = <span class="hljs-built_in">str</span>(uuid.uuid4())
    connected_peers[peer_id] = ws

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">for</span> msg <span class="hljs-keyword">in</span> ws:
        data = json.loads(msg.data)
        <span class="hljs-comment"># 处理SDP交换</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'sdp'</span> <span class="hljs-keyword">in</span> data:
            peer_connection = RTCPeerConnection()
            <span class="hljs-keyword">await</span> peer_connection.setRemoteDescription(RTCSessionDescription(sdp=data[<span class="hljs-string">'sdp'</span>]))
            answer = <span class="hljs-keyword">await</span> peer_connection.createAnswer()
            <span class="hljs-keyword">await</span> ws.send_json({ <span class="hljs-string">'sdp'</span>: answer.sdp, <span class="hljs-string">'peer_id'</span>: peer_id })

    <span class="hljs-keyword">del</span> connected_peers[peer_id]
    <span class="hljs-keyword">return</span> ws
</code></pre>
<h3 data-id="heading-13">常见问题与优化</h3>
<h4 data-id="heading-14">1. NAT穿透问题</h4>
<p>由于NAT（网络地址转换）的存在，点对点连接可能失败。解决方案：</p>
<ul>
<li>使用STUN服务器（如Google的stun:stun.l.google.com:19302）</li>
<li>使用TURN服务器作为中转</li>
<li>部署自己的coturn服务器</li>
</ul>
<h4 data-id="heading-15">2. 延迟优化</h4>
<ul>
<li>优先使用UDP而非TCP</li>
<li>调整视频码率和帧率</li>
<li>选择低延迟的编解码器（VP8/VP9优于H.264）</li>
</ul>
<h4 data-id="heading-16">3. 兼容性</h4>
<p>WebRTC在所有现代浏览器中都有良好支持：</p>
<ul>
<li>Chrome/Edge - 完全支持</li>
<li>Firefox - 完全支持</li>
<li>Safari - iOS 11+/MacOS支持</li>
</ul>
<h3 data-id="heading-17">总结</h3>
<p>Python结合WebRTC可以快速构建实时音视频应用。通过aiortc等库，我们可以用熟悉的Python语法实现复杂的实时通信功能。本文涵盖了从基础概念到完整视频会议系统的实现，希望对你的WebRTC开发之旅有所帮助。</p>
<h3 data-id="heading-18">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebrtc.org%2F" target="_blank" title="https://webrtc.org/" ref="nofollow noopener noreferrer">WebRTC官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faiortc%2Faiortc" target="_blank" title="https://github.com/aiortc/aiortc" ref="nofollow noopener noreferrer">aiortc GitHub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWebRTC_API" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/WebRTC_API" ref="nofollow noopener noreferrer">MDN WebRTC教程</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jina Rerankers 为 Elastic 推理服务（EIS）带来了快速、多语言的重排序能力]]></title>    <link>https://juejin.cn/post/7602529888483590207</link>    <guid>https://juejin.cn/post/7602529888483590207</guid>    <pubDate>2026-02-04T04:07:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602529888483590207" data-draft-id="7602454700505022505" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jina Rerankers 为 Elastic 推理服务（EIS）带来了快速、多语言的重排序能力"/> <meta itemprop="keywords" content="Elasticsearch"/> <meta itemprop="datePublished" content="2026-02-04T04:07:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Elasticsearch"/> <meta itemprop="url" content="https://juejin.cn/user/2612095360441448"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jina Rerankers 为 Elastic 推理服务（EIS）带来了快速、多语言的重排序能力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2612095360441448/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Elasticsearch
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:07:17.000Z" title="Wed Feb 04 2026 04:07:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：来自 Elastic <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fsean-handley" title="https://www.elastic.co/search-labs/author/sean-handley" target="_blank" ref="nofollow noopener noreferrer">Sean Handley</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Fbrendan-jugan" title="https://www.elastic.co/search-labs/author/brendan-jugan" target="_blank" ref="nofollow noopener noreferrer">Brendan Jugan</a> 及 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fauthor%2Franjana-devaji" title="https://www.elastic.co/search-labs/author/ranjana-devaji" target="_blank" ref="nofollow noopener noreferrer">Ranjana Devaji</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88fd6b6b42f045368975dd1a2e3559d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782838&amp;x-signature=23alh9073udarm7zeX%2FuuvZlJcs%3D" alt="" loading="lazy"/></p>
<p>Elastic 现在在 EIS 上提供了 jina-reranker-v2-base-multilingual 和 jina-reranker-v3，使得可以直接在 Elasticsearch 中进行快速多语言重排序，实现更高精度的检索、RAG 和 agentic workflow，无需额外基础设施。</p>
<p>动手体验 Elasticsearch：现在就可以浏览我们的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felastic%2Felasticsearch-labs%3Ftab%3Dreadme-ov-file" title="https://github.com/elastic/elasticsearch-labs?tab=readme-ov-file" target="_blank" ref="nofollow noopener noreferrer">示例 notebooks</a>、启动<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud%2Fcloud-trial-overview" title="https://www.elastic.co/cloud/cloud-trial-overview" target="_blank" ref="nofollow noopener noreferrer">免费云试用</a>，或在<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143747798" title="https://elasticstack.blog.csdn.net/article/details/143747798" target="_blank" ref="nofollow noopener noreferrer">本地机器</a>上尝试 Elastic。</p>
<hr/>
<p>今天，我们很高兴在 Elastic Inference Service (<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Felastic-inference%2Feis" title="https://www.elastic.co/docs/explore-analyze/elastic-inference/eis" target="_blank" ref="nofollow noopener noreferrer">EIS</a>) 上推出 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fjina.ai%2Fmodels%2Fjina-reranker-v2-base-multilingual%2F" title="https://jina.ai/models/jina-reranker-v2-base-multilingual/" target="_blank" ref="nofollow noopener noreferrer">jina-reranker-v2-base-multilingual</a></strong> 和 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fjina.ai%2Fnews%2Fjina-reranker-v3-0-6b-listwise-reranker-for-sota-multilingual-retrieval%2F" title="https://jina.ai/news/jina-reranker-v3-0-6b-listwise-reranker-for-sota-multilingual-retrieval/" target="_blank" ref="nofollow noopener noreferrer">jina-reranker-v3</a></strong>，实现直接在 Elasticsearch 中进行快速、多语言、高精度的<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F143352429" title="https://elasticstack.blog.csdn.net/article/details/143352429" target="_blank" ref="nofollow noopener noreferrer">重排序</a>。</p>
<p>Jina AI（最近被 Elastic 收购）是开源多语言和多模态模型领域的领导者，提供用于高质量检索和检索增强生成（<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F134396254" title="https://elasticstack.blog.csdn.net/article/details/134396254" target="_blank" ref="nofollow noopener noreferrer">RAG</a>）的最先进<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F156502954" title="https://elasticstack.blog.csdn.net/article/details/156502954" target="_blank" ref="nofollow noopener noreferrer">搜索基础模型</a>。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fblog%2Felastic-inference-service" title="https://www.elastic.co/blog/elastic-inference-service" target="_blank" ref="nofollow noopener noreferrer">EIS</a> 让你可以轻松在托管 GPU 上运行这些现成模型的快速、高质量<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fexplore-analyze%2Felastic-inference" title="https://www.elastic.co/docs/explore-analyze/elastic-inference" target="_blank" ref="nofollow noopener noreferrer">推理</a>，无需任何设置或托管复杂性。</p>
<p>Reranker 通过优化检索结果的排序提高语义精度，帮助选择最匹配查询的结果。它们能够在不重新索引或干扰管道的情况下提升相关性，对混合搜索和 RAG 工作流尤为重要，因为更好的上下文能提高下游任务的准确性。</p>
<p>此前 EIS 上已推出 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F156881069" title="https://elasticstack.blog.csdn.net/article/details/156881069" target="_blank" ref="nofollow noopener noreferrer">jina-embeddings-v3</a></strong>，扩展了多语言 reranking 的模型目录。开发者现在可以结合 BM25F <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F134111585" title="https://elasticstack.blog.csdn.net/article/details/134111585" target="_blank" ref="nofollow noopener noreferrer">词汇搜索</a>和来自 <strong>jina-embeddings-v3</strong> 的多语言<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F145562747" title="https://elasticstack.blog.csdn.net/article/details/145562747" target="_blank" ref="nofollow noopener noreferrer">向量搜索</a>进行<a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F145697606" title="https://elasticstack.blog.csdn.net/article/details/145697606" target="_blank" ref="nofollow noopener noreferrer">混合搜索</a>，再根据具体使用场景使用 Jina Rerankers v2 或 v3 进行重排序，从而在 Elasticsearch 中原生实现对召回调优的完全控制。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e9965ce581d44f8a3f31b3b699a9fc4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRWxhc3RpY3NlYXJjaA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782838&amp;x-signature=YX765klIxpDU2cAcATT6Bzy9qp8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">jina-reranker-v2-base-multilingual</h2>
<p>jina-reranker-v2-base-multilingual 是一个紧凑型通用重排序器，具备支持函数调用和 SQL 查询的特性。</p>
<ul>
<li>
<p><strong>低延迟大规模推理</strong>：这是一个 2.78 亿参数的紧凑模型，使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2307.08691" title="https://arxiv.org/abs/2307.08691" target="_blank" ref="nofollow noopener noreferrer">Flash Attention 2</a> 提供低延迟推理，在多语言性能上表现出色，根据 <a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fspaces%2FAIR-Bench%2Fleaderboard" title="https://huggingface.co/spaces/AIR-Bench/leaderboard" target="_blank" ref="nofollow noopener noreferrer">AIR 指标</a>和其他常用基准甚至优于更大的重排序模型。</p>
</li>
<li>
<p><strong>支持 agentic 用例</strong>：可以进行准确的多语言文本重排序，并额外支持选择与文本查询匹配的 SQL 表和外部函数，从而实现 <a href="https://link.juejin.cn?target=https%3A%2F%2Felasticstack.blog.csdn.net%2Farticle%2Fdetails%2F152024448" title="https://elasticstack.blog.csdn.net/article/details/152024448" target="_blank" ref="nofollow noopener noreferrer">agentic 工作流</a>。</p>
</li>
<li>
<p><strong>无限候选支持</strong>：v2 可以处理任意大的候选列表，通过独立评分文档实现。评分可跨批次兼容，因此开发者可以增量重排序大型结果集。例如，流水线可以每次评分 100 个候选项，然后合并评分并排序综合结果。这使得 v2 在不严格应用 top-k 限制的流水线中非常适用。</p>
</li>
</ul>
<h2 data-id="heading-1">jina-reranker-v3</h2>
<p>jina-reranker-v3 提供多语言 listwise 重新排序，在 RAG 和 agent 驱动的工作流中实现更高精度和最先进的性能。</p>
<ul>
<li>
<p><strong>轻量化、适合生产环境的架构</strong>：约 6 亿参数的 listwise 重新排序模型，优化以实现低延迟推理和高效部署。</p>
</li>
<li>
<p><strong>强大的多语言表现</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjina.ai%2Fnews%2Fjina-reranker-v3-0-6b-listwise-reranker-for-sota-multilingual-retrieval%2F" title="https://jina.ai/news/jina-reranker-v3-0-6b-listwise-reranker-for-sota-multilingual-retrieval/" target="_blank" ref="nofollow noopener noreferrer">基准测试</a>显示 v3 在多语言任务上性能领先于更大的模型，同时在置换情况下保持稳定的 top-k 排序。</p>
</li>
<li>
<p><strong>高效跨文档重新排序</strong>：与 v2 不同，v3 可以在单次推理中对最多 64 个文档进行整体重新排序，通过考察候选集合内的关系提升排序质量。通过批量处理候选而非单独评分，v3 显著降低推理成本，非常适合具有固定 top-k 结果的 RAG 和 agent 驱动工作流。</p>
</li>
</ul>
<p><strong>更多模型即将推出</strong>：EIS 正在持续扩展用于候选重排、检索和 agent 推理的优化模型。下一个是用于多模态重排的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fjina.ai%2Fnews%2Ffair-scoring-for-multimodal-documents-with-jina-reranker-m0%2F" title="https://jina.ai/news/fair-scoring-for-multimodal-documents-with-jina-reranker-m0/" target="_blank" ref="nofollow noopener noreferrer">jina-reranker-m0</a>，其次是来自 OpenAI、Google 和 Anthropic 的 frontier 模型。</p>
<h2 data-id="heading-2">开始使用</h2>
<p>你可以通过几个简单步骤，在 EIS 上使用 <strong>jina-reranker-v2-base-multilingual</strong>。</p>
<h3 data-id="heading-3"><strong>使用 jina-embeddings-v3 创建向量</strong></h3>
<pre><code class="hljs language-markdown" lang="markdown">`

<span class="hljs-bullet">1.</span>  POST <span class="hljs-emphasis">_inference/text_</span>embedding/.jina-embeddings-v3
<span class="hljs-bullet">2.</span>  {
<span class="hljs-bullet">3.</span>    "input": [
<span class="hljs-bullet">4.</span>      "The Atlantic is a vast, deep ocean.",
<span class="hljs-bullet">5.</span>      "A small puddle formed on the sidewalk."
<span class="hljs-bullet">6.</span>    ]
<span class="hljs-bullet">7.</span>  }

`AI写代码
</code></pre>
<p>响应：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  {
2.    <span class="hljs-string">"text_embedding"</span>: [
3.      {
4.        <span class="hljs-string">"embedding"</span>: [
5.          0.0061287,
6.          ...
7.        ]
8.      },
9.      {
10.        <span class="hljs-string">"embedding"</span>: [
11.          -0.11765291,
12.          ...
13.        ]
14.      }
15.    ]
16.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<h3 data-id="heading-4">使用 jina-reranker-v2-base-multilingual 重新排序</h3>
<p>执行推理：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  POST _inference/rerank/.jina-reranker-v2-base-multilingual
2.  {
3.   <span class="hljs-string">"input"</span>: [<span class="hljs-string">"puddle"</span>, <span class="hljs-string">"ocean"</span>, <span class="hljs-string">"cup of tea"</span>],
4.   <span class="hljs-string">"query"</span>: <span class="hljs-string">"a large body of water"</span>
5.  }

`AI写代码
</code></pre>
<p>响应结果：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  {
2.    <span class="hljs-string">"rerank"</span>: [
3.      {
4.        <span class="hljs-string">"index"</span>: 1,
5.        <span class="hljs-string">"relevance_score"</span>: 0.48755136
6.      },
7.      {
8.        <span class="hljs-string">"index"</span>: 0,
9.        <span class="hljs-string">"relevance_score"</span>: 0.41489884
10.      },
11.      {
12.        <span class="hljs-string">"index"</span>: 2,
13.        <span class="hljs-string">"relevance_score"</span>: 0.07696084
14.      }
15.    ]
16.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<h3 data-id="heading-5">使用 jina-reranker-v3 重新排序</h3>
<p>执行推理：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  POST _inference/rerank/.jina-reranker-v3
2.  {
3.    <span class="hljs-string">"input"</span>: [<span class="hljs-string">"pebble"</span>, <span class="hljs-string">"The Swiss Alps"</span>, <span class="hljs-string">"a steep hill"</span>],
4.    <span class="hljs-string">"query"</span>: <span class="hljs-string">"mountain range"</span>
5.  }

`AI写代码
</code></pre>
<p>响应结果：</p>
<pre><code class="hljs language-bash" lang="bash">`

1.  {
2.    <span class="hljs-string">"rerank"</span>: [
3.      {
4.        <span class="hljs-string">"index"</span>: 1,
5.        <span class="hljs-string">"relevance_score"</span>: 0.06519848
6.      },
7.      {
8.        <span class="hljs-string">"index"</span>: 2,
9.        <span class="hljs-string">"relevance_score"</span>: -0.05002501
10.      },
11.      {
12.        <span class="hljs-string">"index"</span>: 0,
13.        <span class="hljs-string">"relevance_score"</span>: -0.09782915
14.      }
15.    ]
16.  }

`AI写代码![](https://csdnimg.cn/release/blogv2/dist/pc/img/runCode/icon-arrowwhite.png)
</code></pre>
<p>类似于 jina-reranker-v2-base-multilingual，响应结果提供了按相关性排序的输入优先列表。在这个例子中，模型将 “The Swiss Alps” 识别为 “mountain range” 的最相关匹配，而 “pebble” 和 “a steep hill” 排名较低。</p>
<p>然而，一个关键区别是 jina-reranker-v3 是列表式重新排序器（listwise reranker）。与逐个对文档-查询对评分的 jina-reranker-v2-base-multilingual 不同，jina-reranker-v3 会同时处理所有输入，使模型能够在确定最终排序之前进行丰富的跨文档交互。</p>
<h2 data-id="heading-6">EIS 新特性</h2>
<p>通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fdocs%2Fdeploy-manage%2Fcloud-connect" title="https://www.elastic.co/docs/deploy-manage/cloud-connect" target="_blank" ref="nofollow noopener noreferrer">Cloud Connect</a>，EIS 可用于自托管集群，让开发者能够访问 GPU 集群来快速原型和部署 RAG、语义搜索以及 agent 工作流，而无需在自托管集群上采购 GPU 资源。平台团队可以实现混合灵活性：数据和索引保留在本地，同时在需要时在 Elastic Cloud 扩展 GPU 推理能力。</p>
<h2 data-id="heading-7">接下来</h2>
<p>semantic_text 字段将很快默认使用 EIS 上的 jina-embeddings-v3，在数据摄取时提供内置推理，使采用多语言搜索更简单，无需额外配置。</p>
<h2 data-id="heading-8">试用体验</h2>
<p>利用 EIS 上的 Jina AI 模型，你可以构建多语言、高精度检索管道，而无需管理模型、GPU 或基础设施。你将获得快速的密集检索、准确的重新排序，以及与 Elasticsearch 相关性栈的紧密集成，一站式平台完成。</p>
<p>无论你是在构建 RAG 系统、搜索，还是需要可靠上下文的 agent 工作流，Elastic 现在都提供了高性能开箱即用的模型，以及从原型到生产部署的简便运维能力。</p>
<p>所有 Elastic Cloud 试用用户均可访问 Elastic Inference Service。现在就可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fcloud%2Fserverless" title="https://www.elastic.co/cloud/serverless" target="_blank" ref="nofollow noopener noreferrer">Elastic Cloud Serverless 或 Elastic Cloud Hosted 上体验</a>。</p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.elastic.co%2Fsearch-labs%2Fblog%2Fjina-rerankers-elastic-inference-service" title="https://www.elastic.co/search-labs/blog/jina-rerankers-elastic-inference-service" target="_blank" ref="nofollow noopener noreferrer">www.elastic.co/search-labs…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[kotlin retry 笔记]]></title>    <link>https://juejin.cn/post/7602503154506514473</link>    <guid>https://juejin.cn/post/7602503154506514473</guid>    <pubDate>2026-02-04T03:31:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602503154506514473" data-draft-id="7602455806447255558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="kotlin retry 笔记"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-02-04T03:31:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="心源xinyuan"/> <meta itemprop="url" content="https://juejin.cn/user/4283353029151694"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            kotlin retry 笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4283353029151694/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    心源xinyuan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T03:31:09.000Z" title="Wed Feb 04 2026 03:31:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Kotlin 重试（Retry）机制详解</h2>
<p>重试机制是处理<strong>临时性失败</strong>（如网络波动、服务暂时不可用）的重要策略。Kotlin 提供了多种实现重试的方式。</p>
<h3 data-id="heading-1">一、基础重试实现</h3>
<h4 data-id="heading-2"><strong>1. 基本的 try-catch 重试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">simpleRetry</span><span class="hljs-params">(
    maxRetries: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
    block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
)</span></span>: T {
    <span class="hljs-keyword">var</span> lastException: Throwable? = <span class="hljs-literal">null</span>
    
    <span class="hljs-keyword">for</span> (attempt <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.maxRetries) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> block()
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            lastException = e
            println(<span class="hljs-string">"尝试 <span class="hljs-variable">$attempt</span> 失败: <span class="hljs-subst">${e.message}</span>"</span>)
            
            <span class="hljs-keyword">if</span> (attempt &lt; maxRetries) {
                delay(<span class="hljs-number">1000</span>) <span class="hljs-comment">// 简单的固定延迟</span>
            }
        }
    }
    
    <span class="hljs-keyword">throw</span> lastException ?: RuntimeException(<span class="hljs-string">"重试失败"</span>)
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span>: String {
    <span class="hljs-keyword">return</span> simpleRetry(maxRetries = <span class="hljs-number">3</span>) {
        <span class="hljs-comment">// 模拟可能失败的操作</span>
        <span class="hljs-keyword">if</span> (Random.nextBoolean()) {
            <span class="hljs-keyword">throw</span> IOException(<span class="hljs-string">"网络错误"</span>)
        }
        <span class="hljs-string">"数据内容"</span>
    }
}
</code></pre>
<h4 data-id="heading-3"><strong>2. 带指数退避的重试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">retryWithBackoff</span><span class="hljs-params">(
    maxRetries: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
    initialDelayMillis: <span class="hljs-type">Long</span> = <span class="hljs-number">100</span>,
    maxDelayMillis: <span class="hljs-type">Long</span> = <span class="hljs-number">10000</span>,
    factor: <span class="hljs-type">Double</span> = <span class="hljs-number">2.0</span>,
    block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
)</span></span>: T {
    <span class="hljs-keyword">var</span> currentDelay = initialDelayMillis
    <span class="hljs-keyword">var</span> lastException: Throwable? = <span class="hljs-literal">null</span>
    
    <span class="hljs-keyword">for</span> (attempt <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.maxRetries) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> block()
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            lastException = e
            println(<span class="hljs-string">"第 <span class="hljs-variable">$attempt</span> 次尝试失败: <span class="hljs-subst">${e.message}</span>"</span>)
            
            <span class="hljs-keyword">if</span> (attempt &lt; maxRetries) {
                <span class="hljs-comment">// 指数退避</span>
                delay(currentDelay)
                currentDelay = (currentDelay * factor).toLong()
                    .coerceAtMost(maxDelayMillis)
            }
        }
    }
    
    <span class="hljs-keyword">throw</span> lastException ?: RuntimeException(<span class="hljs-string">"重试失败"</span>)
}
</code></pre>
<h3 data-id="heading-4">二、Flow 中的重试</h3>
<h4 data-id="heading-5"><strong>1. Flow 的 retry 操作符</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchDataFlow</span><span class="hljs-params">()</span></span>: Flow&lt;String&gt; = flow {
    <span class="hljs-comment">// 模拟不稳定的数据源</span>
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.5</span>) {
        delay(<span class="hljs-number">500</span>)
        <span class="hljs-keyword">if</span> (Random.nextDouble() &lt; <span class="hljs-number">0.3</span>) { <span class="hljs-comment">// 30% 失败率</span>
            <span class="hljs-keyword">throw</span> IOException(<span class="hljs-string">"第 <span class="hljs-variable">$i</span> 次获取失败"</span>)
        }
        emit(<span class="hljs-string">"数据块 <span class="hljs-variable">$i</span>"</span>)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    <span class="hljs-comment">// 基本 retry</span>
    fetchDataFlow()
        .retry(<span class="hljs-number">3</span>) { cause -&gt;
            println(<span class="hljs-string">"重试原因: <span class="hljs-subst">${cause.message}</span>"</span>)
            cause <span class="hljs-keyword">is</span> IOException <span class="hljs-comment">// 只在 IOException 时重试</span>
        }
        .<span class="hljs-keyword">catch</span> { e -&gt; emit(<span class="hljs-string">"最终失败: <span class="hljs-subst">${e.message}</span>"</span>) }
        .collect { println(it) }
    
    println(<span class="hljs-string">"\n=== 带延迟的重试 ==="</span>)
    
    <span class="hljs-comment">// retryWhen - 更灵活的控制</span>
    fetchDataFlow()
        .retryWhen { cause, attempt -&gt;
            <span class="hljs-keyword">if</span> (cause <span class="hljs-keyword">is</span> IOException &amp;&amp; attempt &lt; <span class="hljs-number">3</span>) {
                delay(<span class="hljs-number">1000</span> * attempt) <span class="hljs-comment">// 线性退避</span>
                println(<span class="hljs-string">"第 <span class="hljs-variable">$attempt</span> 次重试"</span>)
                <span class="hljs-literal">true</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-literal">false</span>
            }
        }
        .<span class="hljs-keyword">catch</span> { e -&gt; emit(<span class="hljs-string">"失败: <span class="hljs-subst">${e.message}</span>"</span>) }
        .collect { println(it) }
}
</code></pre>
<h4 data-id="heading-6"><strong>2. 带退避策略的 Flow 重试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.flow.*

<span class="hljs-comment">/**
 * 为 Flow 添加指数退避重试
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> Flow<span class="hljs-type">&lt;T&gt;</span>.<span class="hljs-title">retryExponentialBackoff</span><span class="hljs-params">(
    maxRetries: <span class="hljs-type">Int</span>,
    initialDelayMillis: <span class="hljs-type">Long</span> = <span class="hljs-number">1000</span>,
    maxDelayMillis: <span class="hljs-type">Long</span> = <span class="hljs-number">60000</span>,
    factor: <span class="hljs-type">Double</span> = <span class="hljs-number">2.0</span>,
    shouldRetry: (<span class="hljs-type">Throwable</span>) -&gt; <span class="hljs-type">Boolean</span> = { <span class="hljs-literal">true</span> }
)</span></span>: Flow&lt;T&gt; = retryWhen { cause, attempt -&gt;
    <span class="hljs-keyword">if</span> (attempt &lt;= maxRetries &amp;&amp; shouldRetry(cause)) {
        <span class="hljs-comment">// 计算延迟时间（指数退避）</span>
        <span class="hljs-keyword">val</span> delayMillis = (initialDelayMillis * Math.pow(factor, (attempt - <span class="hljs-number">1</span>).toDouble()))
            .toLong()
            .coerceAtMost(maxDelayMillis)
        
        println(<span class="hljs-string">"第 <span class="hljs-variable">$attempt</span> 次重试，等待 <span class="hljs-subst">${delayMillis}</span>ms"</span>)
        delay(delayMillis)
        <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-literal">false</span>
    }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unstableFlow</span><span class="hljs-params">()</span></span>: Flow&lt;<span class="hljs-built_in">Int</span>&gt; = flow {
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span><span class="hljs-number">.10</span>) {
        <span class="hljs-keyword">if</span> (i % <span class="hljs-number">3</span> == <span class="hljs-number">0</span>) { <span class="hljs-comment">// 每3次失败一次</span>
            <span class="hljs-keyword">throw</span> RuntimeException(<span class="hljs-string">"第 <span class="hljs-variable">$i</span> 次失败"</span>)
        }
        emit(i)
        delay(<span class="hljs-number">100</span>)
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> = runBlocking {
    unstableFlow()
        .retryExponentialBackoff(
            maxRetries = <span class="hljs-number">3</span>,
            initialDelayMillis = <span class="hljs-number">500</span>,
            maxDelayMillis = <span class="hljs-number">5000</span>
        )
        .<span class="hljs-keyword">catch</span> { e -&gt; println(<span class="hljs-string">"最终失败: <span class="hljs-subst">${e.message}</span>"</span>) }
        .collect { println(<span class="hljs-string">"收到: <span class="hljs-variable">$it</span>"</span>) }
}
</code></pre>
<h3 data-id="heading-7">三、实际应用场景</h3>
<h4 data-id="heading-8"><strong>1. 网络请求重试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> retrofit2.HttpException
<span class="hljs-keyword">import</span> java.io.IOException
<span class="hljs-keyword">import</span> java.net.SocketTimeoutException

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">executeWithRetry</span><span class="hljs-params">(
        maxRetries: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
        retryOn: (<span class="hljs-type">Throwable</span>) -&gt; <span class="hljs-type">Boolean</span> = { it.shouldRetry()</span></span> },
        block: <span class="hljs-keyword">suspend</span> () -&gt; T
    ): T {
        <span class="hljs-keyword">var</span> lastException: Throwable? = <span class="hljs-literal">null</span>
        
        <span class="hljs-keyword">for</span> (attempt <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.maxRetries) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> block()
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                lastException = e
                
                <span class="hljs-keyword">if</span> (attempt &lt; maxRetries &amp;&amp; retryOn(e)) {
                    <span class="hljs-comment">// 计算退避延迟</span>
                    <span class="hljs-keyword">val</span> delayMillis = calculateBackoffDelay(attempt)
                    println(<span class="hljs-string">"网络请求失败，<span class="hljs-subst">${delayMillis}</span>ms后重试 (尝试 <span class="hljs-variable">$attempt</span>)"</span>)
                    delay(delayMillis)
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">break</span>
                }
            }
        }
        
        <span class="hljs-keyword">throw</span> lastException ?: RuntimeException(<span class="hljs-string">"请求失败"</span>)
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateBackoffDelay</span><span class="hljs-params">(attempt: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-comment">// 指数退避 + 随机抖动（避免惊群效应）</span>
        <span class="hljs-keyword">val</span> baseDelay = <span class="hljs-number">1000L</span> * (<span class="hljs-number">1</span> shl (attempt - <span class="hljs-number">1</span>)) <span class="hljs-comment">// 1s, 2s, 4s, ...</span>
        <span class="hljs-keyword">val</span> jitter = (Math.random() * <span class="hljs-number">1000</span>).toLong() <span class="hljs-comment">// 0-1s 随机抖动</span>
        <span class="hljs-keyword">return</span> (baseDelay + jitter).coerceAtMost(<span class="hljs-number">30000L</span>) <span class="hljs-comment">// 最大30s</span>
    }
    
    <span class="hljs-comment">// 获取用户数据（带重试）</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUserData</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: UserData {
        <span class="hljs-keyword">return</span> executeWithRetry(
            maxRetries = <span class="hljs-number">3</span>,
            retryOn = { it.shouldRetry() }
        ) {
            apiService.getUser(userId)
        }
    }
    
    <span class="hljs-comment">// 上传文件（带重试）</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">uploadFile</span><span class="hljs-params">(file: <span class="hljs-type">File</span>, maxRetries: <span class="hljs-type">Int</span> = <span class="hljs-number">5</span>)</span></span>: UploadResult {
        <span class="hljs-keyword">return</span> executeWithRetry(maxRetries = maxRetries) {
            apiService.uploadFile(file)
        }
    }
}

<span class="hljs-comment">// 异常扩展：判断是否应该重试</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> Throwable.<span class="hljs-title">shouldRetry</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (<span class="hljs-keyword">this</span>) {
        <span class="hljs-keyword">is</span> IOException -&gt; <span class="hljs-literal">true</span> <span class="hljs-comment">// 网络IO错误</span>
        <span class="hljs-keyword">is</span> SocketTimeoutException -&gt; <span class="hljs-literal">true</span> <span class="hljs-comment">// 超时</span>
        <span class="hljs-keyword">is</span> HttpException -&gt; <span class="hljs-keyword">this</span>.code() <span class="hljs-keyword">in</span> setOf(<span class="hljs-number">408</span>, <span class="hljs-number">429</span>, <span class="hljs-number">500</span>, <span class="hljs-number">502</span>, <span class="hljs-number">503</span>, <span class="hljs-number">504</span>) <span class="hljs-comment">// 特定HTTP状态码</span>
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
    }
}
</code></pre>
<h4 data-id="heading-9"><strong>2. 数据库操作重试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> java.sql.SQLException
<span class="hljs-keyword">import</span> java.sql.SQLTransientException

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseRepository</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dataSource: DataSource
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">executeTransactionWithRetry</span><span class="hljs-params">(
        maxRetries: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
        block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
    )</span></span>: T {
        <span class="hljs-keyword">var</span> lastException: Throwable? = <span class="hljs-literal">null</span>
        
        <span class="hljs-keyword">for</span> (attempt <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.maxRetries) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> dataSource.connection.use { connection -&gt;
                    connection.autoCommit = <span class="hljs-literal">false</span>
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-keyword">val</span> result = block()
                        connection.commit()
                        result
                    } <span class="hljs-keyword">catch</span> (e: Exception) {
                        connection.rollback()
                        <span class="hljs-keyword">throw</span> e
                    }
                }
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                lastException = e
                
                <span class="hljs-keyword">if</span> (attempt &lt; maxRetries &amp;&amp; e.shouldRetryDatabase()) {
                    <span class="hljs-comment">// 数据库特有的退避策略</span>
                    <span class="hljs-keyword">val</span> delayMillis = calculateDatabaseRetryDelay(attempt, e)
                    println(<span class="hljs-string">"数据库操作失败，<span class="hljs-subst">${delayMillis}</span>ms后重试"</span>)
                    delay(delayMillis)
                    
                    <span class="hljs-comment">// 刷新连接池（如果连接有问题）</span>
                    <span class="hljs-keyword">if</span> (e.isConnectionError()) {
                        dataSource.refreshConnection()
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">break</span>
                }
            }
        }
        
        <span class="hljs-keyword">throw</span> lastException ?: RuntimeException(<span class="hljs-string">"数据库操作失败"</span>)
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateDatabaseRetryDelay</span><span class="hljs-params">(attempt: <span class="hljs-type">Int</span>, exception: <span class="hljs-type">Exception</span>)</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> {
            exception.isDeadlock() -&gt; <span class="hljs-number">100L</span> <span class="hljs-comment">// 死锁快速重试</span>
            exception.isTimeout() -&gt; <span class="hljs-number">1000L</span> * attempt <span class="hljs-comment">// 超时线性退避</span>
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-number">500L</span> * (<span class="hljs-number">1</span> shl (attempt - <span class="hljs-number">1</span>)) <span class="hljs-comment">// 其他错误指数退避</span>
        }.coerceAtMost(<span class="hljs-number">10000L</span>)
    }
    
    <span class="hljs-comment">// 批量插入（带重试）</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">batchInsert</span><span class="hljs-params">(entities: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Entity</span>&gt;)</span></span> {
        executeTransactionWithRetry {
            entities.forEach { entity -&gt;
                <span class="hljs-comment">// 插入逻辑</span>
            }
        }
    }
}

<span class="hljs-comment">// 数据库异常判断扩展</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> Exception.<span class="hljs-title">shouldRetryDatabase</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (<span class="hljs-keyword">this</span>) {
        <span class="hljs-keyword">is</span> SQLTransientException -&gt; <span class="hljs-literal">true</span> <span class="hljs-comment">// 临时性SQL错误</span>
        <span class="hljs-keyword">is</span> SQLException -&gt; {
            <span class="hljs-keyword">when</span> (<span class="hljs-keyword">this</span>.sqlState) {
                <span class="hljs-string">"40001"</span> -&gt; <span class="hljs-literal">true</span> <span class="hljs-comment">// 死锁</span>
                <span class="hljs-string">"08003"</span>, <span class="hljs-string">"08006"</span>, <span class="hljs-string">"08007"</span> -&gt; <span class="hljs-literal">true</span> <span class="hljs-comment">// 连接错误</span>
                <span class="hljs-string">"57014"</span> -&gt; <span class="hljs-literal">true</span> <span class="hljs-comment">// 查询超时</span>
                <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
            }
        }
        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
    }
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> Exception.<span class="hljs-title">isConnectionError</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> SQLException &amp;&amp; <span class="hljs-keyword">this</span>.sqlState <span class="hljs-keyword">in</span> setOf(<span class="hljs-string">"08003"</span>, <span class="hljs-string">"08006"</span>, <span class="hljs-string">"08007"</span>)
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> Exception.<span class="hljs-title">isDeadlock</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> SQLException &amp;&amp; <span class="hljs-keyword">this</span>.sqlState == <span class="hljs-string">"40001"</span>
}

<span class="hljs-function"><span class="hljs-keyword">fun</span> Exception.<span class="hljs-title">isTimeout</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> SQLException &amp;&amp; <span class="hljs-keyword">this</span>.sqlState == <span class="hljs-string">"57014"</span>
}
</code></pre>
<h4 data-id="heading-10"><strong>3. 文件操作重试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> java.io.IOException
<span class="hljs-keyword">import</span> java.nio.file.AccessDeniedException
<span class="hljs-keyword">import</span> java.nio.file.FileSystemException

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FileOperationManager</span> {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">retryFileOperation</span><span class="hljs-params">(
        maxRetries: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
        retryDelayMillis: <span class="hljs-type">Long</span> = <span class="hljs-number">1000</span>,
        block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
    )</span></span>: T {
        <span class="hljs-keyword">var</span> lastException: Throwable? = <span class="hljs-literal">null</span>
        
        <span class="hljs-keyword">for</span> (attempt <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.maxRetries) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> block()
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                lastException = e
                
                <span class="hljs-keyword">if</span> (attempt &lt; maxRetries &amp;&amp; e.shouldRetryFileOperation()) {
                    println(<span class="hljs-string">"文件操作失败 (尝试 <span class="hljs-variable">$attempt</span>): <span class="hljs-subst">${e.message}</span>"</span>)
                    delay(retryDelayMillis * attempt) <span class="hljs-comment">// 线性退避</span>
                    
                    <span class="hljs-comment">// 尝试释放文件锁</span>
                    <span class="hljs-keyword">if</span> (e.isFileLocked()) {
                        releaseFileLocks()
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">break</span>
                }
            }
        }
        
        <span class="hljs-keyword">throw</span> lastException ?: RuntimeException(<span class="hljs-string">"文件操作失败"</span>)
    }
    
    <span class="hljs-comment">// 读取文件（带重试）</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">readFileWithRetry</span><span class="hljs-params">(file: <span class="hljs-type">File</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> retryFileOperation(maxRetries = <span class="hljs-number">5</span>) {
            file.readText()
        }
    }
    
    <span class="hljs-comment">// 写入文件（带重试）</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">writeFileWithRetry</span><span class="hljs-params">(file: <span class="hljs-type">File</span>, content: <span class="hljs-type">String</span>)</span></span> {
        retryFileOperation {
            file.writeText(content)
        }
    }
    
    <span class="hljs-comment">// 复制大文件（带进度和重试）</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">copyLargeFileWithRetry</span><span class="hljs-params">(
        source: <span class="hljs-type">File</span>,
        target: <span class="hljs-type">File</span>,
        chunkSize: <span class="hljs-type">Int</span> = <span class="hljs-number">8192</span>
    )</span></span> {
        <span class="hljs-keyword">var</span> attempt = <span class="hljs-number">0</span>
        <span class="hljs-keyword">val</span> maxRetries = <span class="hljs-number">3</span>
        
        <span class="hljs-keyword">while</span> (attempt &lt; maxRetries) {
            <span class="hljs-keyword">try</span> {
                source.inputStream().use { input -&gt;
                    target.outputStream().use { output -&gt;
                        <span class="hljs-keyword">val</span> buffer = ByteArray(chunkSize)
                        <span class="hljs-keyword">var</span> bytesRead: <span class="hljs-built_in">Int</span>
                        <span class="hljs-keyword">var</span> totalBytes = <span class="hljs-number">0L</span>
                        
                        <span class="hljs-keyword">while</span> (input.read(buffer).also { bytesRead = it } != -<span class="hljs-number">1</span>) {
                            output.write(buffer, <span class="hljs-number">0</span>, bytesRead)
                            totalBytes += bytesRead
                            
                            <span class="hljs-comment">// 定期刷新（避免数据丢失）</span>
                            <span class="hljs-keyword">if</span> (totalBytes % (chunkSize * <span class="hljs-number">100</span>) == <span class="hljs-number">0L</span>) {
                                output.flush()
                            }
                        }
                    }
                }
                <span class="hljs-keyword">return</span> <span class="hljs-comment">// 成功退出</span>
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                attempt++
                <span class="hljs-keyword">if</span> (attempt &gt;= maxRetries || !e.shouldRetryFileOperation()) {
                    <span class="hljs-keyword">throw</span> e
                }
                
                println(<span class="hljs-string">"文件复制失败，第 <span class="hljs-variable">$attempt</span> 次重试"</span>)
                delay(<span class="hljs-number">1000</span> * attempt)
                
                <span class="hljs-comment">// 清理可能损坏的目标文件</span>
                <span class="hljs-keyword">if</span> (target.exists()) {
                    target.delete()
                }
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> Exception.<span class="hljs-title">shouldRetryFileOperation</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (<span class="hljs-keyword">this</span>) {
            <span class="hljs-keyword">is</span> AccessDeniedException -&gt; <span class="hljs-literal">false</span> <span class="hljs-comment">// 权限问题，重试无效</span>
            <span class="hljs-keyword">is</span> FileSystemException -&gt; <span class="hljs-keyword">this</span>.reason != <span class="hljs-string">"Permission denied"</span>
            <span class="hljs-keyword">is</span> IOException -&gt; <span class="hljs-literal">true</span> <span class="hljs-comment">// 其他IO错误</span>
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> Exception.<span class="hljs-title">isFileLocked</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> IOException &amp;&amp; 
               <span class="hljs-keyword">this</span>.message?.contains(<span class="hljs-string">"locked"</span>, ignoreCase = <span class="hljs-literal">true</span>) == <span class="hljs-literal">true</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">releaseFileLocks</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 尝试释放文件锁（平台相关）</span>
        <span class="hljs-comment">// Windows: 使用 handle.exe 或 PowerShell</span>
        <span class="hljs-comment">// Linux/Mac: 使用 lsof + fuser</span>
    }
}
</code></pre>
<h3 data-id="heading-11">四、高级重试策略</h3>
<h4 data-id="heading-12"><strong>1. 基于响应内容的重试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartRetryStrategy</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryContext</span>(
        <span class="hljs-keyword">val</span> attempt: <span class="hljs-built_in">Int</span>,
        <span class="hljs-keyword">val</span> lastException: Throwable?,
        <span class="hljs-keyword">val</span> lastResponse: Any?
    )
    
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">retryWithResponseInspection</span><span class="hljs-params">(
        maxRetries: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
        shouldRetry: <span class="hljs-type">suspend</span> (<span class="hljs-type">RetryContext</span>) -&gt; <span class="hljs-type">Boolean</span>,
        block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
    )</span></span>: T {
        <span class="hljs-keyword">var</span> lastException: Throwable? = <span class="hljs-literal">null</span>
        <span class="hljs-keyword">var</span> lastResponse: Any? = <span class="hljs-literal">null</span>
        
        <span class="hljs-keyword">for</span> (attempt <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.maxRetries) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> result = block()
                
                <span class="hljs-comment">// 检查结果是否有效（即使没有抛出异常）</span>
                <span class="hljs-keyword">if</span> (shouldRetry(RetryContext(attempt, <span class="hljs-literal">null</span>, result))) {
                    <span class="hljs-comment">// 虽然成功但结果不符合要求，重试</span>
                    lastResponse = result
                    <span class="hljs-keyword">if</span> (attempt &lt; maxRetries) {
                        delay(calculateDelay(attempt))
                        <span class="hljs-keyword">continue</span>
                    }
                }
                
                <span class="hljs-keyword">return</span> result
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                lastException = e
                lastResponse = <span class="hljs-literal">null</span>
                
                <span class="hljs-keyword">if</span> (attempt &lt; maxRetries &amp;&amp; 
                    shouldRetry(RetryContext(attempt, e, <span class="hljs-literal">null</span>))) {
                    delay(calculateDelay(attempt))
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">break</span>
                }
            }
        }
        
        <span class="hljs-keyword">throw</span> lastException ?: RuntimeException(<span class="hljs-string">"操作失败"</span>)
    }
    
    <span class="hljs-comment">// API调用示例</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">callApiWithValidation</span><span class="hljs-params">()</span></span>: ApiResponse {
        <span class="hljs-keyword">return</span> retryWithResponseInspection(
            maxRetries = <span class="hljs-number">3</span>,
            shouldRetry = { context -&gt;
                <span class="hljs-keyword">when</span> {
                    <span class="hljs-comment">// 异常情况</span>
                    context.lastException != <span class="hljs-literal">null</span> -&gt; {
                        context.lastException.shouldRetry()
                    }
                    <span class="hljs-comment">// 响应内容检查</span>
                    context.lastResponse != <span class="hljs-literal">null</span> -&gt; {
                        <span class="hljs-keyword">val</span> response = context.lastResponse <span class="hljs-keyword">as</span> ApiResponse
                        response.shouldRetry()
                    }
                    <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
                }
            }
        ) {
            apiService.getData()
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateDelay</span><span class="hljs-params">(attempt: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-keyword">return</span> (<span class="hljs-number">1000L</span> * attempt).coerceAtMost(<span class="hljs-number">10000L</span>)
    }
}

<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiResponse</span>(
    <span class="hljs-keyword">val</span> success: <span class="hljs-built_in">Boolean</span>,
    <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span>: Any?,
    <span class="hljs-keyword">val</span> errorCode: String?,
    <span class="hljs-keyword">val</span> message: String?
) {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shouldRetry</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (errorCode) {
            <span class="hljs-string">"RATE_LIMITED"</span> -&gt; <span class="hljs-literal">true</span> <span class="hljs-comment">// 限流</span>
            <span class="hljs-string">"TEMPORARY_ERROR"</span> -&gt; <span class="hljs-literal">true</span> <span class="hljs-comment">// 临时错误</span>
            <span class="hljs-string">"MAINTENANCE"</span> -&gt; <span class="hljs-literal">true</span> <span class="hljs-comment">// 维护中</span>
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-13"><strong>2. 并发重试策略</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.*
<span class="hljs-keyword">import</span> java.util.concurrent.ConcurrentHashMap

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcurrentRetryManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> activeRetries = ConcurrentHashMap&lt;String, Job&gt;()
    
    <span class="hljs-comment">/**
     * 并发安全的去重重试
     * 相同 key 的操作只进行一次重试
     */</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">retryDeduplicated</span><span class="hljs-params">(
        key: <span class="hljs-type">String</span>,
        maxRetries: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
        block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
    )</span></span>: T {
        <span class="hljs-comment">// 检查是否已有相同key的重试在进行中</span>
        <span class="hljs-keyword">val</span> existingJob = activeRetries[key]
        <span class="hljs-keyword">if</span> (existingJob != <span class="hljs-literal">null</span> &amp;&amp; existingJob.isActive) {
            <span class="hljs-comment">// 等待已有的重试完成</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> {
                existingJob.join()
                block() <span class="hljs-comment">// 重试完成后再次执行</span>
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                <span class="hljs-keyword">throw</span> e
            }
        }
        
        <span class="hljs-comment">// 启动新的重试</span>
        <span class="hljs-keyword">return</span> coroutineScope {
            <span class="hljs-keyword">val</span> job = launch(start = CoroutineStart.LAZY) {
                retryWithBackoff(maxRetries, block)
            }
            
            activeRetries[key] = job
            <span class="hljs-keyword">try</span> {
                job.start()
                job.join()
                block()
            } <span class="hljs-keyword">finally</span> {
                activeRetries.remove(key)
            }
        }
    }
    
    <span class="hljs-comment">/**
     * 批量操作的智能重试
     * 部分失败时只重试失败的部分
     */</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T, R&gt;</span> <span class="hljs-title">batchRetry</span><span class="hljs-params">(
        items: <span class="hljs-type">List</span>&lt;<span class="hljs-type">T</span>&gt;,
        concurrency: <span class="hljs-type">Int</span> = <span class="hljs-number">5</span>,
        maxRetriesPerItem: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
        transform: <span class="hljs-type">suspend</span> (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">R</span>
    )</span></span>: List&lt;R&gt; = coroutineScope {
        <span class="hljs-keyword">val</span> results = mutableMapOf&lt;<span class="hljs-built_in">Int</span>, Result&lt;R&gt;&gt;()
        <span class="hljs-keyword">val</span> failedIndices = mutableListOf&lt;<span class="hljs-built_in">Int</span>&gt;()
        
        <span class="hljs-comment">// 第一轮：并发处理所有项</span>
        items.mapIndexed { index, item -&gt;
            async {
                <span class="hljs-keyword">try</span> {
                    Result.success(transform(item))
                } <span class="hljs-keyword">catch</span> (e: Exception) {
                    Result.failure&lt;R&gt;(e)
                }.also { result -&gt;
                    synchronized(results) {
                        results[index] = result
                        <span class="hljs-keyword">if</span> (result.isFailure) {
                            failedIndices.add(index)
                        }
                    }
                }
            }
        }.awaitAll()
        
        <span class="hljs-comment">// 重试失败项</span>
        <span class="hljs-keyword">for</span> (retryAttempt <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.maxRetriesPerItem) {
            <span class="hljs-keyword">if</span> (failedIndices.isEmpty()) <span class="hljs-keyword">break</span>
            
            println(<span class="hljs-string">"第 <span class="hljs-variable">$retryAttempt</span> 轮重试，失败项: <span class="hljs-subst">${failedIndices.size}</span>"</span>)
            
            <span class="hljs-keyword">val</span> currentFailed = failedIndices.toList()
            failedIndices.clear()
            
            <span class="hljs-keyword">val</span> retryJobs = currentFailed.map { index -&gt;
                async {
                    <span class="hljs-keyword">try</span> {
                        retryWithBackoff(
                            maxRetries = <span class="hljs-number">1</span>, <span class="hljs-comment">// 每次只重试一次，由外层循环控制</span>
                            block = { transform(items[index]) }
                        ).also { success -&gt;
                            synchronized(results) {
                                results[index] = Result.success(success)
                            }
                        }
                    } <span class="hljs-keyword">catch</span> (e: Exception) {
                        synchronized(results) {
                            results[index] = Result.failure(e)
                            failedIndices.add(index)
                        }
                    }
                }
            }
            
            retryJobs.awaitAll()
            
            <span class="hljs-keyword">if</span> (failedIndices.isNotEmpty()) {
                delay(<span class="hljs-number">1000</span> * retryAttempt) <span class="hljs-comment">// 轮次间延迟</span>
            }
        }
        
        <span class="hljs-comment">// 收集最终结果</span>
        items.indices.map { index -&gt;
            results[index]?.getOrThrow() ?: <span class="hljs-keyword">throw</span> IllegalStateException(<span class="hljs-string">"Missing result"</span>)
        }
    }
    
    <span class="hljs-comment">/**
     * 优先队列重试：重要任务优先重试
     */</span>
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">priorityRetry</span><span class="hljs-params">(
        tasks: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Pair</span>&lt;<span class="hljs-type">Int</span>, <span class="hljs-keyword">suspend</span> ()</span></span> -&gt; T&gt;&gt;, <span class="hljs-comment">// (优先级, 任务)</span>
        maxRetries: <span class="hljs-built_in">Int</span> = <span class="hljs-number">3</span>
    ): List&lt;T&gt; {
        <span class="hljs-keyword">val</span> sortedTasks = tasks.sortedByDescending { it.first } <span class="hljs-comment">// 优先级高的先执行</span>
        <span class="hljs-keyword">val</span> results = mutableListOf&lt;T&gt;()
        
        <span class="hljs-keyword">for</span> ((priority, task) <span class="hljs-keyword">in</span> sortedTasks) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> result = retryWithBackoff(maxRetries) {
                    println(<span class="hljs-string">"执行优先级 <span class="hljs-variable">$priority</span> 的任务"</span>)
                    task()
                }
                results.add(result)
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                println(<span class="hljs-string">"优先级 <span class="hljs-variable">$priority</span> 的任务失败: <span class="hljs-subst">${e.message}</span>"</span>)
                <span class="hljs-comment">// 低优先级任务失败不影响高优先级任务</span>
            }
        }
        
        <span class="hljs-keyword">return</span> results
    }
}
</code></pre>
<h4 data-id="heading-14"><strong>3. 熔断器模式配合重试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.sync.Mutex
<span class="hljs-keyword">import</span> kotlinx.coroutines.sync.withLock

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CircuitBreaker</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> failureThreshold: <span class="hljs-built_in">Int</span> = <span class="hljs-number">5</span>,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> resetTimeoutMillis: <span class="hljs-built_in">Long</span> = <span class="hljs-number">60000</span>,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> halfOpenMaxAttempts: <span class="hljs-built_in">Int</span> = <span class="hljs-number">3</span>
) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> state: State = State.CLOSED
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> failureCount = <span class="hljs-number">0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> lastFailureTime = <span class="hljs-number">0L</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> halfOpenAttempts = <span class="hljs-number">0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mutex = Mutex()
    
    <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span> {
        <span class="hljs-keyword">object</span> CLOSED : State()     <span class="hljs-comment">// 正常状态</span>
        <span class="hljs-keyword">object</span> OPEN : State()       <span class="hljs-comment">// 熔断状态</span>
        <span class="hljs-keyword">object</span> HALF_OPEN : State()  <span class="hljs-comment">// 半开状态（试探）</span>
    }
    
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">execute</span><span class="hljs-params">(block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>)</span></span>: T {
        mutex.withLock {
            updateState()
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (state) {
            State.OPEN -&gt; <span class="hljs-keyword">throw</span> CircuitBreakerOpenException(<span class="hljs-string">"熔断器开启"</span>)
            State.HALF_OPEN -&gt; executeHalfOpen(block)
            State.CLOSED -&gt; executeClosed(block)
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">executeClosed</span><span class="hljs-params">(block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>)</span></span>: T {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> result = block()
            mutex.withLock {
                <span class="hljs-comment">// 成功时重置失败计数</span>
                failureCount = <span class="hljs-number">0</span>
            }
            <span class="hljs-keyword">return</span> result
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            mutex.withLock {
                failureCount++
                lastFailureTime = System.currentTimeMillis()
                <span class="hljs-keyword">if</span> (failureCount &gt;= failureThreshold) {
                    state = State.OPEN
                }
            }
            <span class="hljs-keyword">throw</span> e
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">executeHalfOpen</span><span class="hljs-params">(block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>)</span></span>: T {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> result = block()
            mutex.withLock {
                <span class="hljs-comment">// 半开状态下成功，关闭熔断器</span>
                state = State.CLOSED
                failureCount = <span class="hljs-number">0</span>
                halfOpenAttempts = <span class="hljs-number">0</span>
            }
            <span class="hljs-keyword">return</span> result
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            mutex.withLock {
                halfOpenAttempts++
                <span class="hljs-keyword">if</span> (halfOpenAttempts &gt;= halfOpenMaxAttempts) {
                    state = State.OPEN
                    lastFailureTime = System.currentTimeMillis()
                }
            }
            <span class="hljs-keyword">throw</span> e
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateState</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">when</span> (state) {
            State.OPEN -&gt; {
                <span class="hljs-keyword">val</span> timeSinceFailure = System.currentTimeMillis() - lastFailureTime
                <span class="hljs-keyword">if</span> (timeSinceFailure &gt;= resetTimeoutMillis) {
                    state = State.HALF_OPEN
                    halfOpenAttempts = <span class="hljs-number">0</span>
                }
            }
            <span class="hljs-keyword">else</span> -&gt; <span class="hljs-built_in">Unit</span>
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getStatus</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"State: <span class="hljs-variable">$state</span>, Failures: <span class="hljs-variable">$failureCount</span>, LastFailure: <span class="hljs-variable">$lastFailureTime</span>"</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CircuitBreakerOpenException</span>(message: String) : Exception(message)

<span class="hljs-comment">// 使用熔断器的重试策略</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ResilientService</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> circuitBreaker: CircuitBreaker
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">executeWithResilience</span><span class="hljs-params">(
        maxRetries: <span class="hljs-type">Int</span> = <span class="hljs-number">3</span>,
        block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
    )</span></span>: T {
        <span class="hljs-keyword">var</span> lastException: Throwable? = <span class="hljs-literal">null</span>
        
        <span class="hljs-keyword">for</span> (attempt <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.maxRetries) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 通过熔断器执行</span>
                <span class="hljs-keyword">return</span> circuitBreaker.execute(block)
            } <span class="hljs-keyword">catch</span> (e: CircuitBreakerOpenException) {
                <span class="hljs-comment">// 熔断器开启，直接失败</span>
                <span class="hljs-keyword">throw</span> e
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                lastException = e
                
                <span class="hljs-keyword">if</span> (attempt &lt; maxRetries &amp;&amp; e.shouldRetry()) {
                    <span class="hljs-keyword">val</span> delay = calculateDelay(attempt)
                    println(<span class="hljs-string">"服务调用失败，<span class="hljs-subst">${delay}</span>ms后重试"</span>)
                    delay(delay)
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">break</span>
                }
            }
        }
        
        <span class="hljs-keyword">throw</span> lastException ?: RuntimeException(<span class="hljs-string">"服务调用失败"</span>)
    }
    
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">callService</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">return</span> executeWithResilience {
            <span class="hljs-comment">// 模拟服务调用</span>
            <span class="hljs-keyword">if</span> (Random.nextDouble() &lt; <span class="hljs-number">0.4</span>) {
                <span class="hljs-keyword">throw</span> IOException(<span class="hljs-string">"服务暂时不可用"</span>)
            }
            <span class="hljs-string">"服务响应"</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-15">五、测试重试逻辑</h3>
<h4 data-id="heading-16"><strong>1. 单元测试重试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> kotlinx.coroutines.test.runTest
<span class="hljs-keyword">import</span> kotlin.test.Test
<span class="hljs-keyword">import</span> kotlin.test.assertEquals
<span class="hljs-keyword">import</span> kotlin.test.assertFailsWith

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryTest</span> {
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testRetrySuccess</span><span class="hljs-params">()</span></span> = runTest {
        <span class="hljs-keyword">var</span> attempts = <span class="hljs-number">0</span>
        
        <span class="hljs-keyword">val</span> result = retryWithBackoff(maxRetries = <span class="hljs-number">3</span>) {
            attempts++
            <span class="hljs-keyword">if</span> (attempts &lt; <span class="hljs-number">3</span>) {
                <span class="hljs-keyword">throw</span> IOException(<span class="hljs-string">"模拟失败"</span>)
            }
            <span class="hljs-string">"成功"</span>
        }
        
        assertEquals(<span class="hljs-string">"成功"</span>, result)
        assertEquals(<span class="hljs-number">3</span>, attempts)
    }
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testRetryFailure</span><span class="hljs-params">()</span></span> = runTest {
        <span class="hljs-keyword">var</span> attempts = <span class="hljs-number">0</span>
        
        assertFailsWith&lt;IOException&gt; {
            retryWithBackoff(maxRetries = <span class="hljs-number">3</span>) {
                attempts++
                <span class="hljs-keyword">throw</span> IOException(<span class="hljs-string">"总是失败"</span>)
            }
        }
        
        assertEquals(<span class="hljs-number">3</span>, attempts)
    }
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testRetryWithCondition</span><span class="hljs-params">()</span></span> = runTest {
        <span class="hljs-keyword">var</span> attempts = <span class="hljs-number">0</span>
        
        <span class="hljs-keyword">val</span> result = retryWithBackoff(
            maxRetries = <span class="hljs-number">5</span>,
            block = {
                attempts++
                <span class="hljs-keyword">when</span> {
                    attempts == <span class="hljs-number">1</span> -&gt; <span class="hljs-keyword">throw</span> IOException(<span class="hljs-string">"可重试错误"</span>)
                    attempts == <span class="hljs-number">2</span> -&gt; <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"不可重试错误"</span>)
                    <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">"成功"</span>
                }
            }
        ) { e -&gt;
            e <span class="hljs-keyword">is</span> IOException <span class="hljs-comment">// 只重试IOException</span>
        }
        
        <span class="hljs-comment">// 应该失败，因为第二次是不可重试错误</span>
        assertFailsWith&lt;IllegalArgumentException&gt;()
    }
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testExponentialBackoff</span><span class="hljs-params">()</span></span> = runTest {
        <span class="hljs-keyword">val</span> delays = mutableListOf&lt;<span class="hljs-built_in">Long</span>&gt;()
        <span class="hljs-keyword">val</span> startTime = System.currentTimeMillis()
        
        <span class="hljs-keyword">try</span> {
            retryWithBackoff(
                maxRetries = <span class="hljs-number">4</span>,
                initialDelayMillis = <span class="hljs-number">100</span>,
                factor = <span class="hljs-number">2.0</span>
            ) {
                delays.add(System.currentTimeMillis() - startTime)
                <span class="hljs-keyword">throw</span> IOException(<span class="hljs-string">"失败"</span>)
            }
        } <span class="hljs-keyword">catch</span> (e: IOException) {
            <span class="hljs-comment">// 预期失败</span>
        }
        
        <span class="hljs-comment">// 验证延迟模式：~100ms, ~300ms, ~700ms</span>
        assertEquals(<span class="hljs-number">3</span>, delays.size - <span class="hljs-number">1</span>) <span class="hljs-comment">// 第一次立即执行</span>
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">1</span> until delays.size) {
            <span class="hljs-keyword">val</span> actualDelay = delays[i] - delays[i - <span class="hljs-number">1</span>]
            <span class="hljs-keyword">val</span> expectedDelay = <span class="hljs-number">100L</span> * (<span class="hljs-number">1</span> shl (i - <span class="hljs-number">1</span>))
            
            <span class="hljs-comment">// 允许10%的误差</span>
            assert(actualDelay <span class="hljs-keyword">in</span> (expectedDelay * <span class="hljs-number">0.9</span>).toLong()..(expectedDelay * <span class="hljs-number">1.1</span>).toLong()) {
                <span class="hljs-string">"延迟 <span class="hljs-variable">$actualDelay</span> 不在预期范围 <span class="hljs-variable">$expectedDelay</span>"</span>
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-17"><strong>2. 模拟不稳定服务进行测试</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">UnstableServiceSimulator</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> failurePattern: List&lt;<span class="hljs-built_in">Boolean</span>&gt; <span class="hljs-comment">// true=失败, false=成功</span>
) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> callCount = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">call</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">if</span> (callCount &gt;= failurePattern.size) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"稳定服务"</span>
        }
        
        <span class="hljs-keyword">val</span> shouldFail = failurePattern[callCount]
        callCount++
        
        <span class="hljs-keyword">if</span> (shouldFail) {
            <span class="hljs-keyword">throw</span> IOException(<span class="hljs-string">"服务调用 <span class="hljs-variable">$callCount</span> 失败"</span>)
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">"服务调用 <span class="hljs-variable">$callCount</span> 成功"</span>
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">reset</span><span class="hljs-params">()</span></span> {
        callCount = <span class="hljs-number">0</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryIntegrationTest</span> {
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testRetryPatterns</span><span class="hljs-params">()</span></span> = runTest {
        <span class="hljs-comment">// 测试1: 失败-成功模式</span>
        <span class="hljs-keyword">val</span> simulator1 = UnstableServiceSimulator(listOf(<span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>))
        <span class="hljs-keyword">val</span> result1 = retryWithBackoff(maxRetries = <span class="hljs-number">3</span>) {
            simulator1.call()
        }
        assertEquals(<span class="hljs-string">"服务调用 2 成功"</span>, result1)
        
        <span class="hljs-comment">// 测试2: 连续失败模式</span>
        simulator1.reset()
        <span class="hljs-keyword">val</span> simulator2 = UnstableServiceSimulator(listOf(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>))
        <span class="hljs-keyword">val</span> result2 = retryWithBackoff(maxRetries = <span class="hljs-number">4</span>) {
            simulator2.call()
        }
        assertEquals(<span class="hljs-string">"服务调用 4 成功"</span>, result2)
        
        <span class="hljs-comment">// 测试3: 超过重试次数</span>
        simulator1.reset()
        <span class="hljs-keyword">val</span> simulator3 = UnstableServiceSimulator(listOf(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>))
        assertFailsWith&lt;IOException&gt; {
            retryWithBackoff(maxRetries = <span class="hljs-number">3</span>) {
                simulator3.call()
            }
        }
    }
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">testCircuitBreakerWithRetry</span><span class="hljs-params">()</span></span> = runTest {
        <span class="hljs-keyword">val</span> circuitBreaker = CircuitBreaker(
            failureThreshold = <span class="hljs-number">2</span>,
            resetTimeoutMillis = <span class="hljs-number">1000</span>
        )
        <span class="hljs-keyword">val</span> service = ResilientService(circuitBreaker)
        
        <span class="hljs-comment">// 模拟快速失败触发熔断</span>
        <span class="hljs-keyword">val</span> failingService = <span class="hljs-keyword">object</span> {
            <span class="hljs-keyword">var</span> callCount = <span class="hljs-number">0</span>
            <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">call</span><span class="hljs-params">()</span></span>: String {
                callCount++
                <span class="hljs-keyword">throw</span> IOException(<span class="hljs-string">"服务失败"</span>)
            }
        }
        
        <span class="hljs-comment">// 前两次重试会失败</span>
        assertFailsWith&lt;IOException&gt; {
            service.executeWithResilience(maxRetries = <span class="hljs-number">2</span>) {
                failingService.call()
            }
        }
        
        <span class="hljs-comment">// 等待熔断器重置</span>
        delay(<span class="hljs-number">1500</span>)
        
        <span class="hljs-comment">// 现在应该可以重新尝试</span>
        failingService.callCount = <span class="hljs-number">0</span>
        assertFailsWith&lt;IOException&gt; {
            service.executeWithResilience(maxRetries = <span class="hljs-number">1</span>) {
                failingService.call()
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-18">六、最佳实践</h3>
<h4 data-id="heading-19"><strong>1. 重试策略选择指南</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">object</span> RetryStrategyGuide {
    <span class="hljs-comment">/**
     * 选择适当的重试策略
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">chooseStrategy</span><span class="hljs-params">(
        operationType: <span class="hljs-type">OperationType</span>,
        context: <span class="hljs-type">RetryContext</span>
    )</span></span>: RetryStrategy {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (operationType) {
            OperationType.NETWORK_REQUEST -&gt; NetworkRetryStrategy()
            OperationType.DATABASE_OPERATION -&gt; DatabaseRetryStrategy()
            OperationType.FILE_OPERATION -&gt; FileRetryStrategy()
            OperationType.EXTERNAL_API_CALL -&gt; ExternalApiRetryStrategy()
        }
    }
    
    <span class="hljs-comment">/**
     * 网络请求重试策略
     */</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkRetryStrategy</span> : <span class="hljs-type">RetryStrategy</span> {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxRetries = <span class="hljs-number">3</span>
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> initialDelay = <span class="hljs-number">1000L</span>
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxDelay = <span class="hljs-number">10000L</span>
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> factor = <span class="hljs-number">2.0</span>
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shouldRetry</span><span class="hljs-params">(exception: <span class="hljs-type">Throwable</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (exception) {
                <span class="hljs-keyword">is</span> IOException -&gt; <span class="hljs-literal">true</span>
                <span class="hljs-keyword">is</span> SocketTimeoutException -&gt; <span class="hljs-literal">true</span>
                <span class="hljs-keyword">is</span> HttpException -&gt; exception.code() <span class="hljs-keyword">in</span> setOf(<span class="hljs-number">408</span>, <span class="hljs-number">429</span>, <span class="hljs-number">500</span>, <span class="hljs-number">502</span>, <span class="hljs-number">503</span>, <span class="hljs-number">504</span>)
                <span class="hljs-keyword">else</span> -&gt; <span class="hljs-literal">false</span>
            }
        }
    }
    
    <span class="hljs-comment">/**
     * 数据库操作重试策略
     */</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseRetryStrategy</span> : <span class="hljs-type">RetryStrategy</span> {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxRetries = <span class="hljs-number">5</span>
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> initialDelay = <span class="hljs-number">100L</span>
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> maxDelay = <span class="hljs-number">2000L</span>
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> factor = <span class="hljs-number">1.5</span>
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shouldRetry</span><span class="hljs-params">(exception: <span class="hljs-type">Throwable</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
            <span class="hljs-keyword">return</span> exception <span class="hljs-keyword">is</span> SQLTransientException ||
                   (exception <span class="hljs-keyword">is</span> SQLException &amp;&amp; exception.isTransient())
        }
    }
    
    <span class="hljs-comment">/**
     * 重试监控和指标
     */</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryMonitor</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> metrics = mutableMapOf&lt;String, RetryMetrics&gt;()
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">recordAttempt</span><span class="hljs-params">(operation: <span class="hljs-type">String</span>, attempt: <span class="hljs-type">Int</span>, success: <span class="hljs-type">Boolean</span>)</span></span> {
            <span class="hljs-keyword">val</span> metric = metrics.getOrPut(operation) { RetryMetrics() }
            metric.totalAttempts++
            <span class="hljs-keyword">if</span> (attempt &gt; <span class="hljs-number">1</span>) metric.retryAttempts++
            <span class="hljs-keyword">if</span> (success) metric.successfulOperations++ <span class="hljs-keyword">else</span> metric.failedOperations++
        }
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getMetrics</span><span class="hljs-params">(operation: <span class="hljs-type">String</span>)</span></span>: RetryMetrics? {
            <span class="hljs-keyword">return</span> metrics[operation]
        }
        
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">printReport</span><span class="hljs-params">()</span></span> {
            metrics.forEach { (operation, metric) -&gt;
                println(<span class="hljs-string">"""
                    |Operation: <span class="hljs-variable">$operation</span>
                    |  Total Attempts: <span class="hljs-subst">${metric.totalAttempts}</span>
                    |  Retry Attempts: <span class="hljs-subst">${metric.retryAttempts}</span>
                    |  Success Rate: <span class="hljs-subst">${metric.successRate}</span>%
                    |  Retry Rate: <span class="hljs-subst">${metric.retryRate}</span>%
                """</span>.trimMargin())
            }
        }
    }
    
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryMetrics</span>(
        <span class="hljs-keyword">var</span> totalAttempts: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span>,
        <span class="hljs-keyword">var</span> retryAttempts: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span>,
        <span class="hljs-keyword">var</span> successfulOperations: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span>,
        <span class="hljs-keyword">var</span> failedOperations: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0</span>
    ) {
        <span class="hljs-keyword">val</span> successRate: <span class="hljs-built_in">Double</span>
            <span class="hljs-keyword">get</span>() = <span class="hljs-keyword">if</span> (totalAttempts &gt; <span class="hljs-number">0</span>) successfulOperations.toDouble() / totalAttempts * <span class="hljs-number">100</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0.0</span>
        
        <span class="hljs-keyword">val</span> retryRate: <span class="hljs-built_in">Double</span>
            <span class="hljs-keyword">get</span>() = <span class="hljs-keyword">if</span> (totalAttempts &gt; <span class="hljs-number">0</span>) retryAttempts.toDouble() / totalAttempts * <span class="hljs-number">100</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0.0</span>
    }
    
    <span class="hljs-keyword">enum</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OperationType</span> {
        NETWORK_REQUEST,
        DATABASE_OPERATION,
        FILE_OPERATION,
        EXTERNAL_API_CALL
    }
    
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RetryStrategy</span> {
        <span class="hljs-keyword">val</span> maxRetries: <span class="hljs-built_in">Int</span>
        <span class="hljs-keyword">val</span> initialDelay: <span class="hljs-built_in">Long</span>
        <span class="hljs-keyword">val</span> maxDelay: <span class="hljs-built_in">Long</span>
        <span class="hljs-keyword">val</span> factor: <span class="hljs-built_in">Double</span>
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shouldRetry</span><span class="hljs-params">(exception: <span class="hljs-type">Throwable</span>)</span></span>: <span class="hljs-built_in">Boolean</span>
    }
}
</code></pre>
<h4 data-id="heading-20"><strong>2. 重试配置化</strong></h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RetryConfig</span>(
    <span class="hljs-keyword">val</span> maxRetries: <span class="hljs-built_in">Int</span> = <span class="hljs-number">3</span>,
    <span class="hljs-keyword">val</span> initialDelayMillis: <span class="hljs-built_in">Long</span> = <span class="hljs-number">1000</span>,
    <span class="hljs-keyword">val</span> maxDelayMillis: <span class="hljs-built_in">Long</span> = <span class="hljs-number">10000</span>,
    <span class="hljs-keyword">val</span> factor: <span class="hljs-built_in">Double</span> = <span class="hljs-number">2.0</span>,
    <span class="hljs-keyword">val</span> jitter: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">true</span>,
    <span class="hljs-keyword">val</span> jitterFactor: <span class="hljs-built_in">Double</span> = <span class="hljs-number">0.1</span>,
    <span class="hljs-keyword">val</span> retryableExceptions: Set&lt;String&gt; = setOf(
        <span class="hljs-string">"java.io.IOException"</span>,
        <span class="hljs-string">"java.net.SocketTimeoutException"</span>,
        <span class="hljs-string">"retrofit2.HttpException"</span>
    )
)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigurableRetryManager</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> configProvider: RetryConfigProvider
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">executeWithRetry</span><span class="hljs-params">(
        operationName: <span class="hljs-type">String</span>,
        block: <span class="hljs-type">suspend</span> () -&gt; <span class="hljs-type">T</span>
    )</span></span>: T {
        <span class="hljs-keyword">val</span> config = configProvider.getConfig(operationName)
        <span class="hljs-keyword">var</span> lastException: Throwable? = <span class="hljs-literal">null</span>
        
        <span class="hljs-keyword">for</span> (attempt <span class="hljs-keyword">in</span> <span class="hljs-number">1.</span>.config.maxRetries) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">return</span> block()
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                lastException = e
                
                <span class="hljs-keyword">if</span> (attempt &lt; config.maxRetries &amp;&amp; shouldRetry(e, config)) {
                    <span class="hljs-keyword">val</span> delay = calculateDelay(attempt, config)
                    println(<span class="hljs-string">"<span class="hljs-variable">$operationName</span> 第 <span class="hljs-variable">$attempt</span> 次重试，等待 <span class="hljs-subst">${delay}</span>ms"</span>)
                    delay(delay)
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">break</span>
                }
            }
        }
        
        <span class="hljs-keyword">throw</span> lastException ?: RuntimeException(<span class="hljs-string">"<span class="hljs-variable">$operationName</span> 失败"</span>)
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shouldRetry</span><span class="hljs-params">(exception: <span class="hljs-type">Throwable</span>, config: <span class="hljs-type">RetryConfig</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-comment">// 通过类名检查是否可重试</span>
        <span class="hljs-keyword">val</span> exceptionClassName = exception::<span class="hljs-keyword">class</span>.qualifiedName
        <span class="hljs-keyword">return</span> config.retryableExceptions.any { className -&gt;
            exceptionClassName?.contains(className) == <span class="hljs-literal">true</span>
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">calculateDelay</span><span class="hljs-params">(attempt: <span class="hljs-type">Int</span>, config: <span class="hljs-type">RetryConfig</span>)</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-keyword">val</span> baseDelay = (config.initialDelayMillis * Math.pow(config.factor, (attempt - <span class="hljs-number">1</span>).toDouble()))
            .toLong()
            .coerceAtMost(config.maxDelayMillis)
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (config.jitter) {
            <span class="hljs-keyword">val</span> jitterRange = (baseDelay * config.jitterFactor).toLong()
            baseDelay + Random.nextLong(-jitterRange, jitterRange)
        } <span class="hljs-keyword">else</span> {
            baseDelay
        }
    }
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">RetryConfigProvider</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getConfig</span><span class="hljs-params">(operationName: <span class="hljs-type">String</span>)</span></span>: RetryConfig
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">JsonRetryConfigProvider</span> : <span class="hljs-type">RetryConfigProvider</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> configs = mapOf(
        <span class="hljs-string">"userApi"</span> to RetryConfig(
            maxRetries = <span class="hljs-number">3</span>,
            initialDelayMillis = <span class="hljs-number">1000</span>,
            retryableExceptions = setOf(<span class="hljs-string">"IOException"</span>, <span class="hljs-string">"HttpException"</span>)
        ),
        <span class="hljs-string">"paymentApi"</span> to RetryConfig(
            maxRetries = <span class="hljs-number">5</span>,
            initialDelayMillis = <span class="hljs-number">2000</span>,
            factor = <span class="hljs-number">1.5</span>,
            jitter = <span class="hljs-literal">true</span>
        ),
        <span class="hljs-string">"fileUpload"</span> to RetryConfig(
            maxRetries = <span class="hljs-number">10</span>,
            initialDelayMillis = <span class="hljs-number">500</span>,
            maxDelayMillis = <span class="hljs-number">30000</span>,
            factor = <span class="hljs-number">3.0</span>
        )
    )
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getConfig</span><span class="hljs-params">(operationName: <span class="hljs-type">String</span>)</span></span>: RetryConfig {
        <span class="hljs-keyword">return</span> configs[operationName] ?: RetryConfig()
    }
}
</code></pre>
<p><strong>总结</strong>：</p>
<p>Kotlin 重试机制的最佳实践：</p>
<h3 data-id="heading-21">核心策略：</h3>
<ol>
<li><strong>指数退避</strong>：避免雪崩效应</li>
<li><strong>随机抖动</strong>：防止惊群效应</li>
<li><strong>熔断器模式</strong>：保护下游服务</li>
<li><strong>条件重试</strong>：只重试可恢复的错误</li>
</ol>
<h3 data-id="heading-22">实现要点：</h3>
<ol>
<li><strong>网络请求</strong>：重试超时、连接错误、特定HTTP状态码</li>
<li><strong>数据库操作</strong>：重试死锁、连接超时、临时错误</li>
<li><strong>文件操作</strong>：重试文件锁、临时IO错误</li>
<li><strong>外部API</strong>：重试限流、服务不可用</li>
</ol>
<h3 data-id="heading-23">监控和调优：</h3>
<ol>
<li><strong>记录重试指标</strong>：成功率、重试率、延迟分布</li>
<li><strong>动态调整参数</strong>：基于历史表现调整重试策略</li>
<li><strong>A/B测试</strong>：比较不同策略的效果</li>
</ol>
<h3 data-id="heading-24">注意事项：</h3>
<ol>
<li><strong>幂等性</strong>：确保重试操作是幂等的</li>
<li><strong>资源消耗</strong>：避免无限重试消耗资源</li>
<li><strong>用户体验</strong>：及时反馈失败，而不是无休止重试</li>
<li><strong>依赖服务</strong>：考虑下游服务的承受能力</li>
</ol>
<p>选择合适重试策略时，需要权衡：</p>
<ul>
<li>成功率的提升 vs 延迟的增加</li>
<li>用户体验 vs 系统资源</li>
<li>业务重要性 vs 实现复杂度</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026年最新oiioii邀请码怎么获取？oiioii邀请码领取入口最新分享！]]></title>    <link>https://juejin.cn/post/7602553969969610806</link>    <guid>https://juejin.cn/post/7602553969969610806</guid>    <pubDate>2026-02-04T04:13:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602553969969610806" data-draft-id="7602553969969594422" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026年最新oiioii邀请码怎么获取？oiioii邀请码领取入口最新分享！"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-04T04:13:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mac的实验室"/> <meta itemprop="url" content="https://juejin.cn/user/2958128164897127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026年最新oiioii邀请码怎么获取？oiioii邀请码领取入口最新分享！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2958128164897127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mac的实验室
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:13:13.000Z" title="Wed Feb 04 2026 04:13:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多想要用AI做原生动画创作的同学不知道oiioii邀请码到哪里获取，oiioii官网需要使用邀请码才能使用，下面是最新oiioii邀请码领取教程分享！</p>
<p><strong>oiioii究竟是什么？为什么突然火起来了？</strong></p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fai-bot.cn%2Fsites%2F66553.html" target="_blank" title="https://link.zhihu.com/?target=https%3A//ai-bot.cn/sites/66553.html" ref="nofollow noopener noreferrer">OiiOii</a> 是全球首个专业动画创作Agent，借助智能 Agent 能实现动画从构思到成品的快速生成。</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fblog.csdn.net%2F2604_94889863%2Farticle%2Fdetails%2F156706615" target="_blank" title="https://link.zhihu.com/?target=https%3A//blog.csdn.net/2604_94889863/article/details/156706615" ref="nofollow noopener noreferrer">OiiOii.ai改写创作权格局：动画制作，从“软件技艺“到“智能团队“的跃迁</a></p>
<p>用户只需输入简单指令，即可获得动画短片、视频或图片。OiiOii 内置多个专业角色协同工作，涵盖剧情创作、音乐 MV 制作、漫画动态化等多种功能，支持风格定制和衍生品设计。OiiOii 通过内置的 7 个专业 Agent（如艺术总监、编剧、分镜师等），实现从剧本创作到动画生成的一站式服务，支持生成图片、视频、动画短片等多种形式。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b36ae1f1cd4d483c9542ac28525718e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770783196&amp;x-signature=hcGcuszwQuYFSRSJUbEtN%2FduqMM%3D" alt="" loading="lazy"/></p>
<p>OiiOii 操作便捷，互动性强，能满足创作者的多样化需求，是动画爱好者的高效创作助手。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06265067094341779c1afca3d84a0007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770783196&amp;x-signature=WLYoTb4kPbpbxK%2F%2B%2BOuhmp%2Fe8EM%3D" alt="" loading="lazy"/></p>
<p>OiiOii目前需邀请码体验，完成注册的用户，每周（自然周）会获得5个邀请码。</p>
<h2 data-id="heading-0">如何获取OiiOii邀请码</h2>
<ul>
<li><strong>方式一</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Faigongjuji.paluai.com%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//aigongjuji.paluai.com/" ref="nofollow noopener noreferrer">AI工具集</a>官方提供了OiiOii邀请码互助群，免费共享邀请码，互助解锁优先体验。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c6c6b6aa7304ccdab2bec3d0f08b14d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770783196&amp;x-signature=wKwphdtpzKw%2B2inecHciddLh%2FPs%3D" alt="" loading="lazy"/></p>
<p>点击申请邀请码</p>
<ul>
<li><strong>方式二</strong>：访问<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fai-bot.cn%2Fsites%2F66553.html" target="_blank" title="https://link.zhihu.com/?target=https%3A//ai-bot.cn/sites/66553.html" ref="nofollow noopener noreferrer">OiiOii</a>官网填写OiiOii测试资格申请表 <a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Fecncw7du1qtr.feishu.cn%2Fshare%2Fbase%2Fform%2FshrcnoDL0jJv3hcrDAoysbOBh4d" target="_blank" title="https://link.zhihu.com/?target=https%3A//ecncw7du1qtr.feishu.cn/share/base/form/shrcnoDL0jJv3hcrDAoysbOBh4d" ref="nofollow noopener noreferrer">ecncw7du1qtr.feishu.cn/share/base/…</a>，优先获取访问权限。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28b244e5a06d4f3c9a9a34ab1f70f66d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770783196&amp;x-signature=SpsFrmddYc7%2BbU0RCJE2HXa1YVI%3D" alt="" loading="lazy"/></p>
<p>填写你的身份介绍，社交媒体链接，个人微信和邮箱等信息申请官方内测邀请码，这个需要官方审核一段时间，通过后才能发放。觉得麻烦不想折腾的同学可以在公众号：<strong>Mac的实验室</strong> 后台回复 <strong>oii</strong> 获取最新的邀请码入口。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc6d161da2464623a2c3027ab763b1e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770783196&amp;x-signature=v2meWmr4T3FsybJJHf%2BeR%2B8RF5o%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>方式三</strong>：加入官方社群，优先获取。访问官网右上角点击微信图标，即可扫码加入官方社群。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d93ef5841bc94843b77d6f63a2b76123~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770783196&amp;x-signature=qzXWPpEzIhY6ewqUuchC93Sa5wc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">OiiOii 邀请码发放规则</h2>
<ul>
<li>
<p><strong>取消邀请码上限</strong>：二轮测试不再设置邀请码上限，不再通过抽奖发码。</p>
</li>
<li>
<p><strong>用户可自由分享</strong>：已有账号的用户可直接给好友发邀请码。</p>
</li>
<li>
<p><strong>每周邀请码数量</strong>：</p>
</li>
<li>
<ul>
<li>
<p>每周（自然周）用户初始获得 5 个邀请码。</p>
</li>
<li>
<p>若本周 5 个邀请码均被成功注册，用户额外再获 3 个，即每周最多可发放 8 个邀请码。</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1ea7fff6c5245df9c16ea319422e4a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFj55qE5a6e6aqM5a6k:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770783196&amp;x-signature=0CSEXlqDuAtMuAUyJQ2V5Axx3bo%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>邀请码有效期</strong>：他人赠送的邀请码有效期为 7 天，未完成注册会影响送码好友后续可发码数量。</p>
</li>
<li>
<p><strong>邀请码使用规则</strong>：一个邀请码只能使用一次，按绑定邮箱的先后顺序为准。</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift 方法调度机制完全解析：从静态到动态的深度探索]]></title>    <link>https://juejin.cn/post/7602559134575263780</link>    <guid>https://juejin.cn/post/7602559134575263780</guid>    <pubDate>2026-02-04T04:15:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602559134575263780" data-draft-id="7602559134575247396" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift 方法调度机制完全解析：从静态到动态的深度探索"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2026-02-04T04:15:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift 方法调度机制完全解析：从静态到动态的深度探索
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:15:41.000Z" title="Wed Feb 04 2026 04:15:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：为什么方法调度如此重要</h2>
<p>在 Swift 开发中，你可能听过其他人给出这样的建议："把这个方法标记为 <code>final</code>"、"使用 <code>private</code> 修饰符"、"避免在扩展中重写方法"。这些建议的背后，都指向同一个核心概念——方法调度（Method Dispatch）。</p>
<p>方法调度决定了 Swift 在运行时如何找到并执行正确的方法实现。</p>
<h2 data-id="heading-1">方法调度的四种类型</h2>
<h3 data-id="heading-2">静态派发（Static Dispatch / Direct Dispatch）</h3>
<p>静态派发是最直接、最快速的调度方式。</p>
<p>在编译期，编译器就已经确定了要调用的具体函数地址，运行时直接跳转到该地址执行，无需任何查找过程。</p>
<p>特点：</p>
<ul>
<li>性能最高：接近 C 语言函数调用</li>
<li>编译期确定：无运行时开销</li>
<li>不支持继承和多态</li>
</ul>
<p>适用场景：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 值类型（struct、enum）的所有方法</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Point</span> {
    <span class="hljs-keyword">var</span> x: <span class="hljs-type">Double</span>
    <span class="hljs-keyword">var</span> y: <span class="hljs-type">Double</span>
    
    <span class="hljs-comment">// 静态派发 - 值类型的默认行为</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">distance</span>(<span class="hljs-params">to</span> <span class="hljs-params">other</span>: <span class="hljs-type">Point</span>) -&gt; <span class="hljs-type">Double</span> {
        <span class="hljs-comment">// 编译期已确定调用地址</span>
        <span class="hljs-keyword">return</span> sqrt((x <span class="hljs-operator">-</span> other.x) <span class="hljs-operator">*</span> (x <span class="hljs-operator">-</span> other.x) <span class="hljs-operator">+</span> (y <span class="hljs-operator">-</span> other.y) <span class="hljs-operator">*</span> (y <span class="hljs-operator">-</span> other.y))
    }
}

<span class="hljs-comment">// 被 final 修饰的类方法</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
    <span class="hljs-comment">// 静态派发 - final 禁止重写</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">add</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">a</span>: <span class="hljs-type">Int</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">b</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">return</span> a <span class="hljs-operator">+</span> b
    }
}

<span class="hljs-comment">// 被 private/fileprivate 修饰的方法</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-comment">// 静态派发 - 作用域限制确保不会被重写</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">internalLog</span>(<span class="hljs-params">message</span>: <span class="hljs-type">String</span>) {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"[Private] <span class="hljs-subst">\(message)</span>"</span>)
    }
    
    <span class="hljs-comment">// 静态派发 - fileprivate 同样限制作用域</span>
    <span class="hljs-keyword">fileprivate</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">filePrivateMethod</span>() {
        <span class="hljs-comment">// ...</span>
    }
}

<span class="hljs-comment">// 协议扩展中的默认实现</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Drawable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">draw</span>()
}

<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Drawable</span> {
    <span class="hljs-comment">// 静态派发 - 协议扩展的默认实现</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">draw</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Default drawing implementation"</span>)
    }
}
</code></pre>
<p>底层原理：</p>
<p>静态派发的函数地址在编译链接后就已经确定，存放在代码段（<code>__TEXT.__text</code>）中。调用时直接通过函数指针跳转，不需要经过任何中间层。</p>
<p>在 Mach-O 文件中，这些函数地址与符号表（Symbol Table）和字符串表（String Table）关联，通过符号名称 mangling 实现唯一标识。</p>
<h3 data-id="heading-3">V-Table 派发（Table Dispatch）</h3>
<p>V-Table（虚函数表）是 Swift 对类实现动态派发的主要机制。每个类都有一个虚函数表，存储着该类及其父类所有可重写方法的函数指针。</p>
<p>特点：</p>
<ul>
<li>支持继承和多态</li>
<li>运行时通过查表确定函数地址</li>
<li>有一定的性能开销，但远低于消息转发</li>
</ul>
<p>工作原理：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeSound</span>() {  <span class="hljs-comment">// V-Table 派发</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Some animal sound"</span>)
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">move</span>() {       <span class="hljs-comment">// V-Table 派发</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Animal moves"</span>)
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span>: <span class="hljs-title class_">Animal</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">makeSound</span>() {  <span class="hljs-comment">// 重写，更新 V-Table 条目</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Woof woof"</span>)
    }
    
    <span class="hljs-comment">// move() 继承自父类，V-Table 中指向父类实现</span>
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">let</span> animals: [<span class="hljs-type">Animal</span>] <span class="hljs-operator">=</span> [<span class="hljs-type">Animal</span>(), <span class="hljs-type">Dog</span>()]
<span class="hljs-keyword">for</span> animal <span class="hljs-keyword">in</span> animals {
    animal.makeSound()  <span class="hljs-comment">// 运行时通过 V-Table 查找具体实现</span>
}
</code></pre>
<p>V-Table 结构示例：</p>
<pre><code class="hljs language-sql" lang="sql">Animal 类的 V<span class="hljs-operator">-</span><span class="hljs-keyword">Table</span>:
<span class="hljs-operator">+</span><span class="hljs-comment">----------------------------+</span>
<span class="hljs-operator">|</span> 内存偏移 <span class="hljs-operator">|</span> 方法名          <span class="hljs-operator">|</span> 函数指针地址 <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------------------------+</span>
<span class="hljs-operator">|</span> <span class="hljs-number">0</span>        <span class="hljs-operator">|</span> makeSound()    <span class="hljs-operator">|</span> <span class="hljs-number">0x100001a80</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-number">1</span>        <span class="hljs-operator">|</span> move()         <span class="hljs-operator">|</span> <span class="hljs-number">0x100001b20</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------------------------+</span>

Dog 类的 V<span class="hljs-operator">-</span><span class="hljs-keyword">Table</span>:
<span class="hljs-operator">+</span><span class="hljs-comment">----------------------------+</span>
<span class="hljs-operator">|</span> 内存偏移 <span class="hljs-operator">|</span> 方法名          <span class="hljs-operator">|</span> 函数指针地址 <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------------------------+</span>
<span class="hljs-operator">|</span> <span class="hljs-number">0</span>        <span class="hljs-operator">|</span> makeSound()    <span class="hljs-operator">|</span> <span class="hljs-number">0x100002c40</span> <span class="hljs-operator">|</span>  ← 重写后的新地址
<span class="hljs-operator">|</span> <span class="hljs-number">1</span>        <span class="hljs-operator">|</span> move()         <span class="hljs-operator">|</span> <span class="hljs-number">0x100001b20</span> <span class="hljs-operator">|</span>  ← 继承自父类
<span class="hljs-operator">+</span><span class="hljs-comment">----------------------------+</span>
</code></pre>
<p>SIL 代码验证：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 编译生成 SIL 中间代码</span>
swiftc -emit-sil MyFile.swift | xcrun swift-demangle &gt; output.sil

<span class="hljs-comment"># 查看 V-Table 定义</span>
sil_vtable Animal {
  <span class="hljs-comment">#Animal.makeSound: (Animal) -&gt; () -&gt; () : @main.Animal.makeSound() -&gt; ()  // Animal.makeSound()</span>
  <span class="hljs-comment">#Animal.move: (Animal) -&gt; () -&gt; () : @main.Animal.move() -&gt; ()    // Animal.move()</span>
  <span class="hljs-comment">#Animal.init!allocator: (Animal.Type) -&gt; () -&gt; Animal : @main.Animal.__allocating_init() -&gt; main.Animal   // Animal.__allocating_init()</span>
  <span class="hljs-comment">#Animal.deinit!deallocator: @main.Animal.__deallocating_deinit    // Animal.__deallocating_deinit</span>
}
</code></pre>
<h3 data-id="heading-4">Witness Table 派发（协议调度）</h3>
<p>Witness Table 是 Swift 实现协议动态派发的机制，相当于协议的 V-Table。当类型遵循协议时，编译器会为该类型生成一个 Witness Table，记录协议要求的实现地址。</p>
<p>特点：</p>
<ul>
<li>专门用于协议类型</li>
<li>支持多态和泛型约束</li>
<li>运行时开销与 V-Table 类似</li>
</ul>
<p>工作原理：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Feedable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">feed</span>()  <span class="hljs-comment">// 协议要求</span>
}

<span class="hljs-comment">// 结构体遵循协议 - 生成 Witness Table</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Cat</span>: <span class="hljs-title class_">Feedable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">feed</span>() {  <span class="hljs-comment">// 静态派发 + Witness Table 记录</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Feeding cat"</span>)
    }
}

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">Bird</span>: <span class="hljs-title class_">Feedable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">feed</span>() {  <span class="hljs-comment">// 静态派发 + Witness Table 记录</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Feeding bird"</span>)
    }
}

<span class="hljs-comment">// 泛型函数使用协议约束</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">processFeeding</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">Feedable</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">animal</span>: <span class="hljs-type">T</span>) {
    animal.feed()  <span class="hljs-comment">// 通过 Witness Table 派发</span>
}

<span class="hljs-comment">// 协议类型作为参数（存在性容器）</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">feedAnimal</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">animal</span>: <span class="hljs-type">Feedable</span>) {
    animal.feed()  <span class="hljs-comment">// 通过 Witness Table 派发</span>
}

<span class="hljs-keyword">let</span> cat <span class="hljs-operator">=</span> <span class="hljs-type">Cat</span>()
<span class="hljs-keyword">let</span> bird <span class="hljs-operator">=</span> <span class="hljs-type">Bird</span>()

processFeeding(cat)   <span class="hljs-comment">// Witness Table 指向 Cat.feed</span>
processFeeding(bird)  <span class="hljs-comment">// Witness Table 指向 Bird.feed</span>
feedAnimal(cat)       <span class="hljs-comment">// 存在性容器 + Witness Table</span>
</code></pre>
<p>底层机制：
Witness Table 不仅存储函数指针，还包含类型的元数据（metadata），包括值大小、内存布局等信息。当使用协议类型（存在性容器）时，Swift 会在一个小型缓冲区中存储值，如果值太大则使用堆分配，并通过 Witness Table 进行间接调用。</p>
<pre><code class="hljs language-bash" lang="bash">sil_witness_table hidden Cat: Feedable module main {
  method <span class="hljs-comment">#Feedable.feed: &lt;Self where Self : Feedable&gt; (Self) -&gt; () -&gt; () : @protocol witness for main.Feedable.feed() -&gt; () in conformance main.Cat : main.Feedable in main // protocol witness for Feedable.feed() in conformance Cat</span>
}

sil_witness_table hidden Bird: Feedable module main {
  method <span class="hljs-comment">#Feedable.feed: &lt;Self where Self : Feedable&gt; (Self) -&gt; () -&gt; () : @protocol witness for main.Feedable.feed() -&gt; () in conformance main.Bird : main.Feedable in main    // protocol witness for Feedable.feed() in conformance Bird</span>
}
</code></pre>
<h3 data-id="heading-5">消息转发（Message Dispatch）</h3>
<p>消息转发是 Objective-C 的运行时机制，通过 <code>objc_msgSend</code> 函数在运行时查找方法实现。这是 Swift 中最动态但性能最低的调度方式。</p>
<p>特点：</p>
<ul>
<li>最动态：支持运行时方法交换、消息转发</li>
<li>性能最低：需要完整的消息查找流程</li>
<li>仅适用于继承自 NSObject 的类</li>
</ul>
<p>使用场景：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Foundation

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>: <span class="hljs-title class_">NSObject</span> {
    <span class="hljs-comment">// V-Table 派发（Swift 方式）</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">normalMethod</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Normal method"</span>)
    }
    
    <span class="hljs-comment">// @objc 暴露给 OC，但仍使用 V-Table</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">objcMethod</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"@objc method"</span>)
    }
    
    <span class="hljs-comment">// 消息转发（完全 OC runtime）</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">dynamicMethod</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Dynamic method"</span>)
    }
    
    <span class="hljs-comment">// 动态方法交换</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">swappableMethod</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Original implementation"</span>)
    }
}

<span class="hljs-comment">// 动态方法交换</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-meta">@_dynamicReplacement</span>(for: swappableMethod)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">swappableMethodReplacement</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Replaced implementation"</span>)
    }
}

<span class="hljs-keyword">let</span> person <span class="hljs-operator">=</span> <span class="hljs-type">Person</span>()
person.normalMethod()      <span class="hljs-comment">// V-Table 查找</span>
person.objcMethod()        <span class="hljs-comment">// V-Table 查找（虽用 @objc）</span>
person.dynamicMethod()     <span class="hljs-comment">// objc_msgSend</span>

<span class="hljs-comment">// 方法交换生效后</span>
person.swappableMethod()   <span class="hljs-comment">// 执行替换后的实现</span>
</code></pre>
<p>底层流程：</p>
<pre><code class="hljs language-assembly" lang="assembly"># 消息转发的汇编特征
# 所有调用都指向 objc_msgSend
callq  *%objc_msgSend
# 寄存器传递：rax=receiver, rdx=selector, 后续参数按规则传递
</code></pre>
<h2 data-id="heading-6">影响方法调度的关键因素</h2>
<h3 data-id="heading-7">类型系统</h3>
<p>值类型（struct/enum）：</p>
<ul>
<li>所有方法默认静态派发</li>
<li>不支持继承，无需动态调度</li>
</ul>
<p>引用类型（class）：</p>
<ul>
<li>普通方法：V-Table 派发</li>
<li><code>final</code> 方法：静态派发</li>
<li><code>private/fileprivate</code> 方法：静态派发</li>
<li>扩展中的方法：静态派发</li>
</ul>
<p>NSObject 子类：</p>
<ul>
<li>增加了 @objc 和 dynamic 选项</li>
<li>可回退到 OC 消息转发</li>
</ul>
<h3 data-id="heading-8">关键字修饰符</h3>








































<table><thead><tr><th align="left">关键字</th><th align="left">作用</th><th align="left">调度方式</th></tr></thead><tbody><tr><td align="left"><code>final</code></td><td align="left">禁止重写</td><td align="left">静态派发</td></tr><tr><td align="left"><code>private</code></td><td align="left">限制作用域</td><td align="left">静态派发</td></tr><tr><td align="left"><code>fileprivate</code></td><td align="left">文件内可见</td><td align="left">静态派发</td></tr><tr><td align="left"><code>dynamic</code></td><td align="left">启用动态性</td><td align="left">消息转发（需配合 <code>@objc</code>）</td></tr><tr><td align="left"><code>@objc</code></td><td align="left">暴露给 OC</td><td align="left">V-Table（除非加 <code>dynamic</code>）</td></tr><tr><td align="left"><code>@objc dynamic</code></td><td align="left">完全动态</td><td align="left">消息转发</td></tr></tbody></table>
<h3 data-id="heading-9">编译器优化</h3>
<p>现代 Swift 编译器（尤其开启 WMO - Whole Module Optimization 后）会积极优化方法调度：</p>
<p>去虚拟化（Devirtualization）：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">draw</span>() { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span>: <span class="hljs-title class_">Shape</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">draw</span>() { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-keyword">func</span> <span class="hljs-title function_">render</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">shape</span>: <span class="hljs-type">Shape</span>) {
    <span class="hljs-comment">// 编译器可能推断 shape 实际是 Circle 类型</span>
    <span class="hljs-comment">// 将 V-Table 调用优化为静态调用</span>
    shape.draw()
}

<span class="hljs-comment">// 优化后可能变为：</span>
<span class="hljs-keyword">func</span> <span class="hljs-title function_">renderOptimized</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">shape</span>: <span class="hljs-type">Shape</span>) {
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> circle <span class="hljs-operator">=</span> shape <span class="hljs-keyword">as?</span> <span class="hljs-type">Circle</span> {
        <span class="hljs-comment">// 静态调用 Circle.draw</span>
        circle.draw()
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 回退到 V-Table</span>
        shape.draw()
    }
}
</code></pre>
<p>内联（Inlining）：
小函数可能被直接内联到调用处，完全消除调度开销。</p>
<p>泛型特化（Generic Specialization）：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">process</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">Drawable</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">item</span>: <span class="hljs-type">T</span>) {
    item.draw()  <span class="hljs-comment">// 可能特化为具体类型调用</span>
}

<span class="hljs-comment">// 调用点</span>
process(<span class="hljs-type">Circle</span>())  <span class="hljs-comment">// 编译器可能生成 process&lt;Circle&gt; 特化版本</span>
</code></pre>
<h2 data-id="heading-10">底层原理深度剖析</h2>
<h3 data-id="heading-11">SIL（Swift Intermediate Language）分析</h3>
<p>SIL 是 Swift 编译器优化的中间表示，通过它可以清晰看到调度方式：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生成 SIL 文件</span>
swiftc -emit-sil MyFile.swift | xcrun swift-demangle &gt; output.sil

<span class="hljs-comment"># 关键标识：</span>
<span class="hljs-comment"># - function_ref: 静态派发</span>
<span class="hljs-comment"># - witness_method: Witness Table 派发  </span>
<span class="hljs-comment"># - class_method: V-Table 派发</span>
<span class="hljs-comment"># - objc_method: 消息转发</span>
</code></pre>
<p>SIL 示例片段：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 静态派发</span>
%<span class="hljs-number">8</span> = <span class="hljs-selector-tag">function_ref</span> @<span class="hljs-selector-tag">staticMethod</span> : $@<span class="hljs-selector-tag">convention</span>(method) (<span class="hljs-variable">@guaranteed</span> MyClass) <span class="hljs-selector-tag">-</span>&gt; ()
%<span class="hljs-number">9</span> = <span class="hljs-selector-tag">apply</span> %<span class="hljs-number">8</span>(%<span class="hljs-number">7</span>) : $@<span class="hljs-selector-tag">convention</span>(method) (<span class="hljs-variable">@guaranteed</span> MyClass) <span class="hljs-selector-tag">-</span>&gt; ()

<span class="hljs-comment">// V-Table 派发</span>
%<span class="hljs-number">12</span> = <span class="hljs-selector-tag">class_method</span> %<span class="hljs-number">11</span> : $<span class="hljs-selector-tag">MyClass</span>, <span class="hljs-selector-id">#MyClass</span><span class="hljs-selector-class">.virtualMethod</span> : (MyClass) <span class="hljs-selector-tag">-</span>&gt; () <span class="hljs-selector-tag">-</span>&gt; (), $@<span class="hljs-selector-tag">convention</span>(method) (<span class="hljs-variable">@guaranteed</span> MyClass) <span class="hljs-selector-tag">-</span>&gt; ()
%<span class="hljs-number">13</span> = <span class="hljs-selector-tag">apply</span> %<span class="hljs-number">12</span>(%<span class="hljs-number">11</span>) : $@<span class="hljs-selector-tag">convention</span>(method) (<span class="hljs-variable">@guaranteed</span> MyClass) <span class="hljs-selector-tag">-</span>&gt; ()

<span class="hljs-comment">// Witness Table 派发</span>
%<span class="hljs-number">15</span> = <span class="hljs-selector-tag">witness_method</span> $<span class="hljs-selector-tag">T</span>, <span class="hljs-selector-id">#Drawable</span><span class="hljs-selector-class">.draw</span> : &lt;<span class="hljs-selector-tag">Self</span> <span class="hljs-selector-tag">where</span> <span class="hljs-selector-tag">Self</span> : <span class="hljs-selector-tag">Drawable</span>&gt; (Self) <span class="hljs-selector-tag">-</span>&gt; () <span class="hljs-selector-tag">-</span>&gt; (), %<span class="hljs-number">14</span> : $@<span class="hljs-selector-tag">convention</span>(<span class="hljs-attribute">witness_method</span>: Drawable) &lt;τ<span class="hljs-selector-tag">_0_0</span>&gt; (<span class="hljs-variable">@in_guaranteed</span> τ_0_0) <span class="hljs-selector-tag">-</span>&gt; ()

<span class="hljs-comment">// 消息转发</span>
%<span class="hljs-number">18</span> = <span class="hljs-selector-tag">objc_method</span> %<span class="hljs-number">17</span> : $<span class="hljs-selector-tag">Person</span>, <span class="hljs-selector-id">#Person</span><span class="hljs-selector-class">.dynamicMethod</span>!<span class="hljs-selector-tag">foreign</span> : (Person) <span class="hljs-selector-tag">-</span>&gt; () <span class="hljs-selector-tag">-</span>&gt; (), $@<span class="hljs-selector-tag">convention</span>(objc_method) (Person) <span class="hljs-selector-tag">-</span>&gt; ()
</code></pre>
<h3 data-id="heading-12">汇编层面分析</h3>
<p>通过 Xcode 的汇编调试可以验证调度方式：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启用汇编调试</span>
Debug -&gt; Debug Workflow -&gt; Always Show Disassembly
</code></pre>
<p>静态派发汇编特征：</p>
<pre><code class="hljs language-assembly" lang="assembly"># 直接调用固定地址
callq  0x100001a80 &lt;_MyClass_staticMethod&gt;
</code></pre>
<p>V-Table 派发汇编特征：</p>
<pre><code class="hljs language-assembly" lang="assembly"># 加载 V-Table，计算偏移，间接调用
movq   0x50(%rax), %rcx   # 从 V-Table 获取函数指针
callq  *%rcx              # 间接调用
</code></pre>
<p>消息转发汇编特征：</p>
<pre><code class="hljs language-assembly" lang="assembly"># 调用 objc_msgSend
leaq   0x1234(%rip), %rax # selector 地址
movq   %rax, %rsi
callq  *_objc_msgSend@GOTPCREL
</code></pre>
<h3 data-id="heading-13">Mach-O 文件结构</h3>
<p>Mach-O 可执行文件包含方法调用的关键信息：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-strong">__TEXT.__</span>text      - 代码段，存储函数实现
<span class="hljs-strong">__DATA.__</span>la<span class="hljs-emphasis">_symbol_</span>ptr - 懒加载符号指针
<span class="hljs-strong">__TEXT.__</span>stub<span class="hljs-emphasis">_helper   - 桩函数辅助
Symbol Table       - 符号位置信息
String Table       - 符号名称字符串
</span></code></pre>
<p>符号解析流程：</p>
<ol>
<li>函数地址 → 符号表偏移值</li>
<li>符号表 → 字符串表查找</li>
<li>还原 mangled 名称：<code>xcrun swift-demangle &lt;symbol&gt;</code></li>
</ol>
<h2 data-id="heading-14">编译器优化策略</h2>
<h3 data-id="heading-15">全模块优化（WMO）</h3>
<p>开启 <code>-whole-module-optimization</code> 后，编译器可以跨文件边界进行优化：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// File1.swift</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">method</span>() { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-comment">// File2.swift</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span>: <span class="hljs-title class_">Base</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">method</span>() { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-keyword">func</span> <span class="hljs-title function_">useIt</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">b</span>: <span class="hljs-type">Base</span>) {
    b.method()  <span class="hljs-comment">// WMO 可推断实际类型，优化为静态调用</span>
}
</code></pre>
<h3 data-id="heading-16">化虚拟调用为静态调用</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Logger</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">log</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">message</span>: <span class="hljs-type">String</span>) { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-keyword">func</span> <span class="hljs-title function_">process</span>(<span class="hljs-params">logger</span>: <span class="hljs-type">Logger</span>) {
    <span class="hljs-comment">// 若 logger 未被逃逸，编译器可能：</span>
    <span class="hljs-comment">// 1. 在栈上分配具体类型</span>
    <span class="hljs-comment">// 2. 直接静态调用</span>
    logger.log(<span class="hljs-string">"Processing"</span>)
}
</code></pre>
<h3 data-id="heading-17">方法内联</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Math</span> {
    <span class="hljs-meta">@inline</span>(__always)  <span class="hljs-comment">// 强制内联</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">add</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">a</span>: <span class="hljs-type">Int</span>, <span class="hljs-keyword">_</span> <span class="hljs-params">b</span>: <span class="hljs-type">Int</span>) -&gt; <span class="hljs-type">Int</span> {
        <span class="hljs-keyword">return</span> a <span class="hljs-operator">+</span> b
    }
}

<span class="hljs-comment">// 调用点可能直接变为：a + b</span>
</code></pre>
<h3 data-id="heading-18">泛型特化与 witness 方法内联</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">func</span> <span class="hljs-title function_">genericProcess</span>&lt;<span class="hljs-type">T</span>: <span class="hljs-type">Protocol</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">value</span>: <span class="hljs-type">T</span>) {
    value.requiredMethod()  <span class="hljs-comment">// 可能特化为具体类型调用</span>
}

<span class="hljs-comment">// 调用点</span>
genericProcess(<span class="hljs-type">ConcreteType</span>())  <span class="hljs-comment">// 生成特化版本</span>
</code></pre>
<h2 data-id="heading-19">实践建议与性能考量</h2>
<h3 data-id="heading-20">何时使用 final</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 推荐：当类不需要被继承时</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheManager</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadData</span>() { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-comment">// 不推荐：过度使用 final 会限制灵活性</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseView</span> {
    <span class="hljs-comment">// 预期会被重写</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">setupUI</span>() { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<h3 data-id="heading-21">协议设计最佳实践</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 协议要求 - Witness Table 派发</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetchData</span>() -&gt; <span class="hljs-type">Data</span>
}

<span class="hljs-comment">// 默认实现 - 静态派发</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">Service</span> {
    <span class="hljs-comment">// 辅助方法，不期望被重写</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">logRequest</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Request logged"</span>)
    }
}
</code></pre>
<h3 data-id="heading-22">NSObject 子类的权衡</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 仅当需要 OC 交互时使用 NSObject</span>
<span class="hljs-keyword">@objc</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SwiftBridge</span>: <span class="hljs-title class_">NSObject</span> {
    <span class="hljs-comment">// 暴露给 OC 的方法</span>
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">ocAccessible</span>() { <span class="hljs-comment">/* ... */</span> }
    
    <span class="hljs-comment">// Swift 内部使用 - 避免 dynamic</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">swiftOnly</span>() { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<h3 data-id="heading-23">性能关键路径优化</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 性能敏感代码</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Renderer</span> {
    <span class="hljs-comment">// 每帧调用，使用 final</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">renderFrame</span>() {
        <span class="hljs-comment">// 大量计算</span>
    }
    
    <span class="hljs-comment">// 可重写的方法</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">setup</span>() { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<h2 data-id="heading-24">总结与扩展思考</h2>
<p>核心要点总结</p>
<ol>
<li>静态派发是性能首选：优先使用 <code>final</code>、<code>private</code> 和值类型</li>
<li>动态派发是必要的灵活性：为继承和多态保留 V-Table</li>
<li>Witness Table 是协议的核心：理解协议类型的动态行为</li>
<li>消息转发是 OC 遗产：仅在需要时使用，避免滥用 <code>dynamic</code></li>
<li>编译器是你的盟友：信任并配合编译器优化</li>
</ol>
<p>扩展应用场景</p>
<ol>
<li>高性能框架设计</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 游戏引擎中的实体系统</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntitySystem</span> {
    <span class="hljs-comment">// 静态派发确保性能</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">entities</span>: [<span class="hljs-type">Entity</span>]) {
        <span class="hljs-comment">// 每帧大量调用</span>
    }
}

<span class="hljs-comment">// 可扩展的组件系统</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Component</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">deltaTime</span>: <span class="hljs-type">TimeInterval</span>)
}

<span class="hljs-comment">//  Witness Table 支持多态</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">PhysicsComponent</span>: <span class="hljs-title class_">Component</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">update</span>(<span class="hljs-params">deltaTime</span>: <span class="hljs-type">TimeInterval</span>) { <span class="hljs-comment">/* ... */</span> }
}
</code></pre>
<ol start="2">
<li>AOP（面向切面编程）</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 使用 dynamic 实现日志、监控</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessService</span>: <span class="hljs-title class_">NSObject</span> {
    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">dynamic</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">criticalMethod</span>() {
        <span class="hljs-comment">// 业务逻辑</span>
    }
}

<span class="hljs-comment">// 运行时动态添加切面</span>
<span class="hljs-keyword">extension</span> <span class="hljs-title class_">BusinessService</span> {
    <span class="hljs-meta">@_dynamicReplacement</span>(for: criticalMethod)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">criticalMethod_withLogging</span>() {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Before: <span class="hljs-subst">\(Date())</span>"</span>)
        criticalMethod()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"After: <span class="hljs-subst">\(Date())</span>"</span>)
    }
}
</code></pre>
<ol start="3">
<li>插件化架构</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 使用协议隔离实现</span>
<span class="hljs-keyword">protocol</span> <span class="hljs-title class_">Plugin</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">execute</span>()
}

<span class="hljs-comment">// 主应用通过 Witness Table 调用插件</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> plugins: [<span class="hljs-type">Plugin</span>] <span class="hljs-operator">=</span> []
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">loadPlugins</span>() {
        <span class="hljs-comment">// 动态加载插件</span>
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">runAll</span>() {
        <span class="hljs-comment">// Witness Table 派发</span>
        plugins.forEach { <span class="hljs-variable">$0</span>.execute() }
    }
}
</code></pre>
<ol start="4">
<li>响应式编程优化</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 使用 final 提升信号处理性能</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Signal</span>&lt;<span class="hljs-title class_">T</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> observers: [(<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Void</span>] <span class="hljs-operator">=</span> []
    
    <span class="hljs-comment">// 静态派发确保订阅性能</span>
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">subscribe</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">observer</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Void</span>) {
        observers.append(observer)
    }
}
</code></pre>
<h2 data-id="heading-25">学习资料</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.jacobstechtavern.com%2Fp%2Fswift-method-dispatch" target="_blank" title="https://blog.jacobstechtavern.com/p/swift-method-dispatch" ref="nofollow noopener noreferrer">blog.jacobstechtavern.com/p/swift-met…</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[超级简单易用的小红书MCP服务]]></title>    <link>https://juejin.cn/post/7602474148095541300</link>    <guid>https://juejin.cn/post/7602474148095541300</guid>    <pubDate>2026-02-04T03:57:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602474148095541300" data-draft-id="7602158221852147727" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="超级简单易用的小红书MCP服务"/> <meta itemprop="keywords" content="MCP"/> <meta itemprop="datePublished" content="2026-02-04T03:57:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MrMao007"/> <meta itemprop="url" content="https://juejin.cn/user/2895461216699196"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            超级简单易用的小红书MCP服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2895461216699196/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MrMao007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T03:57:30.000Z" title="Wed Feb 04 2026 03:57:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb11c382fe21426bac890057b9805825~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJNYW8wMDc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782329&amp;x-signature=6MeoazrllBE18hQI6wBzkUveUW4%3D" alt="logo.png" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMrMao007%2FRedNote-MCP-Plus" target="_blank" title="https://github.com/MrMao007/RedNote-MCP-Plus" ref="nofollow noopener noreferrer">GitHub 项目地址</a></p>
<h2 data-id="heading-0">项目简介</h2>
<p><strong>RedNote-MCP-Plus</strong> 是一个功能强大的小红书自动化工具集，基于 MCP（Model Context Protocol）框架开发，旨在简化小红书的内容管理和数据操作。无论是自动化账号运营还是数据爬取，该工具集都能提供高效的解决方案。</p>
<hr/>
<h2 data-id="heading-1">核心功能</h2>
<h3 data-id="heading-2">1. 自动化互动工具</h3>
<ul>
<li><strong>点赞</strong>：一键点赞任意笔记。</li>
<li><strong>收藏</strong>：快速收藏笔记。</li>
<li><strong>评论</strong>：自动发布评论。</li>
<li><strong>关注</strong>：关注指定用户。</li>
<li><strong>发布笔记</strong>：支持发布图文笔记，包含标题、内容、标签和图片。</li>
</ul>
<h3 data-id="heading-3">2. 自动化爬虫工具</h3>
<ul>
<li><strong>搜索笔记</strong>：通过关键词搜索笔记，并支持导出为 Markdown 格式。</li>
<li><strong>笔记内容爬取</strong>：获取笔记的标题、作者、正文、标签、互动数据等。</li>
<li><strong>用户数据爬取</strong>：提取用户的昵称、简介、标签和互动信息。</li>
</ul>
<hr/>
<h2 data-id="heading-4">技术架构</h2>
<h3 data-id="heading-5">核心技术栈</h3>
<ul>
<li><strong>Python</strong>：主要开发语言。</li>
<li><strong>Playwright</strong>：用于浏览器自动化操作。</li>
<li><strong>MCP 框架</strong>：提供工具注册和服务运行支持。</li>
<li><strong>Asyncio</strong>：实现异步操作，提升性能。</li>
</ul>
<h3 data-id="heading-6">项目结构</h3>
<pre><code class="hljs language-perl" lang="perl">src/
├── auth/                <span class="hljs-comment"># 登录相关模块</span>
├── <span class="hljs-keyword">read</span>/                <span class="hljs-comment"># 数据爬取模块</span>
├── <span class="hljs-keyword">write</span>/               <span class="hljs-comment"># 互动与发布模块</span>
├── static/              <span class="hljs-comment"># 静态资源</span>
└── server.py            <span class="hljs-comment"># MCP 服务入口</span>
</code></pre>
<h3 data-id="heading-7">工具注册</h3>
<p>所有工具通过 MCP 框架注册，支持标准化调用。例如：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@mcp.tool()</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">likeNote</span>():
    <span class="hljs-comment"># 点赞功能实现</span>
</code></pre>
<hr/>
<h2 data-id="heading-8">快速开始</h2>
<h3 data-id="heading-9">环境配置</h3>
<ol>
<li>
<p>安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">brew install uv
pip install playwright
playwright install
brew install node
</code></pre>
</li>
<li>
<p>安装工具：</p>
<pre><code class="hljs language-bash" lang="bash">uv tool install rednote_mcp_plus
</code></pre>
</li>
</ol>
<h3 data-id="heading-10">启动服务</h3>
<p>使用以下命令启动 MCP 服务：</p>
<pre><code class="hljs language-bash" lang="bash">npx @modelcontextprotocol/inspector uvx rednote_mcp_plus
</code></pre>
<h3 data-id="heading-11">登录小红书</h3>
<p>在使用其他工具前，需先通过 <code>manualLogin</code> 工具登录小红书：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">await</span> manualLogin()
</code></pre>
<hr/>
<h2 data-id="heading-12">示例效果</h2>
<h3 data-id="heading-13">工具列表</h3>
<p>启动服务后，您将看到以下工具列表：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8991e4ad906446f80ef6616263e2e29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJNYW8wMDc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782329&amp;x-signature=%2FrJvAO4JXCLy02XEkeLPyVlGPEo%3D" alt="mcp_tools.png" loading="lazy"/></p>
<h3 data-id="heading-14">爬取笔记内容</h3>
<p>以下是爬取笔记内容的示例：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/429e42f40165496c88ff30b2090bc465~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTXJNYW8wMDc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770782329&amp;x-signature=c%2F%2BQkZ6FguMseCzp51BvoIPgUas%3D" alt="note.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-15">项目亮点</h2>
<ol>
<li><strong>模块化设计</strong>：每个功能模块独立，便于扩展和维护。</li>
<li><strong>异步操作</strong>：通过 <code>asyncio</code> 提升性能，支持高并发。</li>
<li><strong>Markdown 导出</strong>：爬取的数据可直接保存为 Markdown 格式，便于分享和存档。</li>
<li><strong>开箱即用</strong>：无需复杂配置，安装后即可使用。</li>
</ol>
<hr/>
<h2 data-id="heading-16">未来计划</h2>
<ul>
<li>增加更多互动功能，如私信、群组管理等。</li>
<li>提供更详细的错误处理和日志记录。</li>
<li>支持更多平台的自动化操作。</li>
</ul>
<hr/>
<h2 data-id="heading-17">开源协议</h2>
<p>本项目基于 <a href="https://link.juejin.cn?target=LICENSE" target="_blank" title="LICENSE" ref="nofollow noopener noreferrer">MIT License</a> 开源，欢迎贡献代码或提出建议！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[小米 HyperOS 4 大变样？核心应用以 Rust / Flutter 重写，不兼容老系统]]></title>    <link>https://juejin.cn/post/7602512064977207359</link>    <guid>https://juejin.cn/post/7602512064977207359</guid>    <pubDate>2026-02-04T04:29:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602512064977207359" data-draft-id="7602512064977190975" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="小米 HyperOS 4 大变样？核心应用以 Rust / Flutter 重写，不兼容老系统"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2026-02-04T04:29:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="恋猫de小郭"/> <meta itemprop="url" content="https://juejin.cn/user/817692379985752"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            小米 HyperOS 4 大变样？核心应用以 Rust / Flutter 重写，不兼容老系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/817692379985752/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    恋猫de小郭
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:29:58.000Z" title="Wed Feb 04 2026 04:29:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今日，xiaomi time 发布了相关表示，<strong>HyperOS 4 将是小米历史上最稳定的更新</strong>，当然这不是重点，重点是根据近期 HyperOS 3.1 版本，可以看到对应的应用架构出现了变化，小米正在分阶段弃用对应的旧版代码架构，例如：</p>
<blockquote>
<p>HyperOS 3.1 开始移除部分系统模块（特别是天气和图库）中的 <code>MIUI SDK</code> 。</p>
</blockquote>
<p>以 HyperOS 3.1 作为过渡版本，通过引入了原生 <code>HyperOS SDK</code> 以及已弃用的 <code>MIUI SDK</code> ，未来 HyperOS 4 预计将通过彻底移除向后兼容层来完成这一迁移。</p>
<blockquote>
<p>这一转变预计可以消除十多年来冗余的函数调用和未优化的依赖链。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82cc8a0de3c1486b83044c083eb3c34c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784212&amp;x-signature=cHNH%2BViYs%2F594Q7aiz3sLbLPTWo%3D" alt="image-20260204121849635" loading="lazy"/></p>
<p>当然，最有意思的还是，针对系统核心应用，<strong>HyperOS 已经在使用 Flutter 和 Rust 重写，目前已在 HyperOS 3.1 中进行试点</strong> ，按照它的说法：</p>
<blockquote>
<p>HyperOS 4 旨在统一系统分区内的 UI 渲染和逻辑稳定性，从而取代之前 MIUI 版本中碎片化的 Java/Kotlin 遗留架构。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/327855b295de4b4cbae7c4c94c348874~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784212&amp;x-signature=tRXd7nFdWfHEI15bz%2BtSaCN6QjY%3D" alt="" loading="lazy"/></p>
<p>当然，这算是一个大的 break change ，从 HyperOS 3.1 开始，基于 Flutter 的应用会打破之前旧系统可以升级新系统应用的情况，因为新的 HyperOS 4 Flutter 应用会无法在 HyperOS 3 及更早版本上运行。</p>
<blockquote>
<p>注意，这里说的是用来的新 Hyper SDK 的系统核心应用。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a0d52c82ee741e5a8046e7e4059d82e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784212&amp;x-signature=H8jsSTrBEHXzo9gK79sJbumVAvQ%3D" alt="" loading="lazy"/></p>
<p>其实对比新旧的相册应用也可以看出来，图一是 4.x 版本， 而图而是 5.0-R 的版本，新版本在 libchecker 下已经看不到相应的 Kotlin 信息了，甚至没有了对应的 dex 目录，只有原生动态库 ：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05dc413bd67c4a6491b166afbaecc074~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oGL54yrZGXlsI_pg60=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784212&amp;x-signature=h5DR238eJNWN%2FHlxL9w06CfSo5w%3D" alt="" loading="lazy"/></p>
<p>当然，xiaomi time 也表示，旗舰级机型在 HyperOS 4 上性能提升幅度有限，相反入门级和中端设备反而可能获得更显著的性能提升，因为技术债务的消除，也可以节省更多的空间。</p>
<p>当然，也有人猜测这个操作是为了提前布局，例如：</p>
<ul>
<li>小米有很多不同平台的产品，用 flutter 可以做到不同平台的产品也可以跨平台，也就是核心系统应用未来有可能出现在其他平台上，比如汽车，眼镜等</li>
</ul>

<ul>
<li>小米打算走和华为一样的路线，华为早期也是通过 flutter 做 UI 层兼容抽象，通过 flutter ，如果后续小米有独立系统发布，应用支持可以更方便直接i迁移， 因为 flutter 只需要适配嵌入层和 vulkan 就可以无缝适配</li>
</ul>
<p>不过这些都只是猜测，而从目前的情况来看，这个决策应该是真的，只是带来的影响如何，只能等官方正式发布后看看了。</p>
<h2 data-id="heading-0">参考链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fxiaomitime.com%2Fwhy-hyperos-4-will-be-the-most-stable-update-in-xiaomi-history-88033%2F" target="_blank" title="https://xiaomitime.com/why-hyperos-4-will-be-the-most-stable-update-in-xiaomi-history-88033/" ref="nofollow noopener noreferrer">xiaomitime.com/why-hyperos…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我构建了一个网站来帮助你学习编程]]></title>    <link>https://juejin.cn/post/7602555027303268392</link>    <guid>https://juejin.cn/post/7602555027303268392</guid>    <pubDate>2026-02-04T04:50:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602555027303268392" data-draft-id="7602474148095655988" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我构建了一个网站来帮助你学习编程"/> <meta itemprop="keywords" content="前端,后端,架构"/> <meta itemprop="datePublished" content="2026-02-04T04:50:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开发者如是说"/> <meta itemprop="url" content="https://juejin.cn/user/3685218704691469"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我构建了一个网站来帮助你学习编程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3685218704691469/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开发者如是说
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:50:35.000Z" title="Wed Feb 04 2026 04:50:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1、“新常态”之下的编程学习方式</h2>
<p>AI 改变了编程。随着 AI 辅助编程工具的兴起，在 AI 时代我们是否仍有必要学习编程呢？当然学习编程是有必要的，不过学习的方式和侧重点有所调整。</p>
<p>学习编程不在是过去那样去记忆各种 API，而是从整体去理解技术的边界、局限性和优缺点。因为，我们不再需要像过去那样手写编程，而是去把编程的任务交给 AI，我们自己去做决策和兜底。</p>
<p>另外，学习编程不再像过去那样通过阅读书籍被动地去接受知识，而是通过询问 AI 的方式主动对知识进行探索，然后以此为基础搭建自己的知识结构。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Failecode.com" target="_blank" title="https://ailecode.com" ref="nofollow noopener noreferrer">(ailecode.com)</a> 就是在这种“新常态”之下应运而生的编程学习网站。</p>
<p>那么，该网站是如何帮助你学习技术的呢？</p>
<h2 data-id="heading-1">2、“爱乐扣”如何帮助你学习编程</h2>
<p><strong>首先，我们整理了 15+ 技术学习路线，直接对应不同的职业</strong>，比如前端开发、后端开发、移动端开发等。你可以直接将这些预定义路线加入到学习计划中，然后，可以根据自身的情况对学习计划进行调整——增加或者删除某些课程。此外，你还可以为课程设置学习的时间，并修改学习的进度，这赋予了学习路线“监督”的功能，可以帮助你按照计划进行学习。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e086eb4130bd4257a3c5eeec6522da53~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5Y-R6ICF5aaC5piv6K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770785434&amp;x-signature=rRXY62wnGt%2BeDYTuO5RDcWMv9hs%3D" alt="Screenshot 2026-01-20 at 09.35.16.png" loading="lazy"/></p>
<p><strong>此外，自己主动询问 AI 的方式学习存在一些问题。</strong> 因为当你还未学习某个知识，你可能很难就某个问题对 AI 进行发问。此外，提问的问题很难保证不会遗漏某些重要的知识点。还有，当你想要按照某个路线进行学习，所需要的提示词的数量是巨大的，比如一门技术语言就需要 50+ 提示词，整个学习路线有 20+ 课程，因此，提示词的总量将达到 1000+.</p>
<p><strong>“爱乐扣” 在开发文档的过程中对提示词进行了优化。</strong> 我们运用类比和归纳等方法对提示词进行了优化，这不仅可以避免初学者遗漏重点的问题，还可以帮助本身就具备某个技术经验的人，把过去编程的学习经验方便地迁移到新的知识领域。此外，我们再优化的提示词的基础之上生成了海量的技术文档，<strong>该网站目前包含 140+ 教程，涵盖了计算机领域的很多语言、框架、工具、理论和基础设施等相关的教程。文档总量在 10,000+，字符总数达 76,000,000，几乎可以满足你的一切技术学习需求。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f60d917dc8a4e5d911d9642572ea4d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5Y-R6ICF5aaC5piv6K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770785434&amp;x-signature=8GqqQnGBvukXSped9Hm60afG4PA%3D" alt="Screenshot 2026-01-20 at 09.34.56.png" loading="lazy"/></p>
<h2 data-id="heading-2">3、“爱乐扣”：未来的编程学习方案</h2>
<p>AI 深刻地改变了我们日常生活中的许多行为，特别是学习行为。我搭建该网站的目的在于，通过 AI 的方式帮助任何想要学习编程的人更快速地掌握编程知识；同时，帮助程序员在 AI 时代实现职业发展路线的转型。</p>
<p>该网站目前处于第一个版本，未来我会结合 AI 开发更多个性化的学习功能，如果你有任何想法和建议可以与我联系 😉 ～</p>
<h2 data-id="heading-3">网址</h2>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Failecode.com" target="_blank" title="https://ailecode.com" ref="nofollow noopener noreferrer">ailecode.com</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[春节运维不断线：在家远程工具使用指南]]></title>    <link>https://juejin.cn/post/7602474148095639604</link>    <guid>https://juejin.cn/post/7602474148095639604</guid>    <pubDate>2026-02-04T04:35:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602474148095639604" data-draft-id="7602488187408531508" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="春节运维不断线：在家远程工具使用指南 "/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-02-04T04:35:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ZeroNews内网穿透"/> <meta itemprop="url" content="https://juejin.cn/user/1933419482984676"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            春节运维不断线：在家远程工具使用指南 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1933419482984676/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ZeroNews内网穿透
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:35:47.000Z" title="Wed Feb 04 2026 04:35:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、 远程SSH工具</h2>
<p>SSH（Secure Shell）是远程安全访问和管理系统的核心工具。下面这个表格汇总了几款常见SSH工具的主要特点，方便你快速了解。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d71fdc7b17744b5b9887ffa5d1e0978~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=lgEYsn93HgD7XTfYarj0eOg97sI%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>**提示：**以上工具通常在局域网内直接使用。若需从 <strong>异地（如回家过年时）访问公司或家中的服务器</strong>，则需要进行额外配置。下文将详细介绍如何使用这些工具实现异地远程访问方案。</p>
</blockquote>
<h2 data-id="heading-1">二、 开启本地SSH服务（若已开启，可跳过)</h2>
<p>1、 需要在被远程的电脑上开启SSH服务，</p>
<p>2、 我们以ubuntu为例</p>
<p>3、 检查服务是否有安装 SSH服务命令</p>
<pre><code class="hljs language-lua" lang="lua">sudo systemctl <span class="hljs-built_in">status</span> ssh
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/432928a854094945b02694be2a0fbf03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=Q3djOwBcwfrS3KjGCuHVByeHXfo%3D" alt="" loading="lazy"/></p>
<p>4、 安装SSH服务，你可以通过以下命令安装：</p>
<pre><code class="hljs language-vbscript" lang="vbscript">sudo apt updatesudo apt install openssh-<span class="hljs-built_in">server</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c499de8ac46c40f8822f0f70ff56e8a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=x95U9y1jdDdahPqqjprR%2FXBbLws%3D" alt="" loading="lazy"/></p>
<p>5、 安装完成后，你可以使用以下命令来启动SSH服务：</p>
<p>a) 正常启动SSH服务，并通过查询命令，可以看到服务已经启动</p>
<pre><code class="hljs language-lua" lang="lua">sudo systemctl start sshsudo systemctl <span class="hljs-built_in">status</span> ssh
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88a2af7555bf495586f43c2a2f096fee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=Edy2M6GVMrmczDISyD6dZS6rjmo%3D" alt="" loading="lazy"/></p>
<p>b) 设置SSH服务开机自启，为了确保每次开机时SSH服务自动启动，你可以设置SSH服务为开机自启，并通过查询命令，可以看到服务已经启动</p>
<pre><code class="hljs language-bash" lang="bash">sudo systemctl <span class="hljs-built_in">enable</span> sshsudo systemctl status ssh
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83c3fe9497ad494d94674532db386a92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=STM89RxZNohmwosMSQFnMDNTlyA%3D" alt="" loading="lazy"/></p>
<p>6、 按照上述的步骤，我们就已开启了本地的SSH服务能力</p>
<h2 data-id="heading-2">三、 本地远程验证</h2>
<p>1、 我们在windows按下 Win+R键，输入cmd，开启窗口</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a807e262b3b54ad1a1d79773c90992b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=fWNupRfKyONxI9zxYETWnHgtbkE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e41f6f69c7114e43aae8df434305e2fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=7gh%2FOPjAgMFGWtG%2B77lXjdq8StI%3D" alt="" loading="lazy"/></p>
<p>2、 现在我们可以窗口里通过命令在本地测试远程连接</p>
<pre><code class="hljs language-css" lang="css">ssh username<span class="hljs-keyword">@hostname</span>
</code></pre>
<blockquote>
<p>username：被远程服务器的用户名</p>
</blockquote>
<blockquote>
<p>hostname：被远程服务器的内网IP地址</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ee76e3e16f041508ca9239b4ff7155a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=aUlZDH6dFcR8x%2BOq9o6EhMIQCo0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">四、 异地远程配置</h2>
<p><strong>方案一：通过公网IP直接访问</strong></p>
<p>此方案适合<strong>能申请到公网IP（或已有）</strong>、追求最佳连接性能、且拥有路由器管理权限的场景。</p>
<ul>
<li><strong>确认公网IP与路由器配置</strong></li>
</ul>
<p>**获取公网IP：**联系你的网络运营商（ISP）咨询申请。如果IP是动态的，还需要配置DDNS（动态域名解析） 服务名，解决IP变化的问题。</p>
<p>**设置端口转发：**登录路由器管理后台（通常是 192....或类似地址），找到“端口转发”、“虚拟服务器”等选项，添加规则：</p>
<p>**外部端口：**一个自定义端口（如 2222），避免使用默认的22端口以增强安全性。</p>
<p>**内部IP地址：**你电脑在局域网内的固定IP地址（如 192....）</p>
<p>**内部端口：**22（SSH默认端口）</p>
<p>**协议：**TCP</p>
<ul>
<li><strong>连接服务器</strong></li>
</ul>
<p>配置完成后，在异地网络通过SSH连接时，使用以下命令格式：</p>
<pre><code class="hljs language-css" lang="css">ssh -<span class="hljs-selector-tag">p</span> <span class="hljs-number">2222</span> username@你的公网IP
</code></pre>
<p><strong>方案二：通过 ZeroNews 内网穿透方式</strong></p>
<p>此方案适合<strong>没有公网IP</strong>、无法或不想配置路由器（如在公司/校园网环境下）、需要快速临时访问的场景。</p>
<p>关于Linux系统的远程访问教程，可以参考文档或视频：【Linux SSH远程访问配置教程】</p>
<p>总结起来操作步骤非常简单：</p>
<ul>
<li>安装启动 ZeroNews Agent</li>
<li>创建自定义前缀域名</li>
<li>创建可公网访问的映射</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a0541325e7b4f70b3a815bec6de90d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=KXQVONWQxILVFqQEDc9xOEFk1Cw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ccec37bc7df4ea485f4768d4664d9d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=ZrWhZuXpv9BL6Ubd89QPLFKhO7Y%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e39d26bf285249e78d74c783489b9fda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=%2F0jblh63h1s7QRbRRnlUbuvwoog%3D" alt="" loading="lazy"/></p>
<ul>
<li>按照上面的操作，我们就已经配置好了可远程SSH的映射服务。</li>
</ul>
<h2 data-id="heading-4">五、 异地远程验证</h2>
<p>接下来，我们展示下远程的效果。</p>
<p><strong>1. 在终端通过命令行实现异地远程</strong></p>
<ul>
<li>
<p>通过win电脑打开cmd终端窗口，并输入如下命令</p>
<p>ssh username@HostName -p Port</p>
</li>
</ul>
<blockquote>
<p>username：被远程服务器的用户名</p>
</blockquote>
<blockquote>
<p>HostName：通过 ZeroNews 配置的映射的 <strong>域名</strong></p>
</blockquote>
<blockquote>
<p>Port：通过 ZeroNews 配置的映射的 **端口,**如 <strong>12000</strong></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/760b18438a814719876e98ec88b9e486~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=0grU9TMQ607WV%2FEetqw91RfOXI0%3D" alt="" loading="lazy"/></p>
<ul>
<li>可以看到，我们已经可以通过终端窗口ssh在异地远程我们的服务了。</li>
</ul>
<p><strong>2. 通过PuTTy实现异地远程访问</strong></p>
<ul>
<li>打开PuTTy客户端。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b33417f62004d5aa62beb10ff5ed138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=VbZbRnY5u6gDG%2B%2F9MooKxUVq7r8%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>HostName：通过ZeroNews配置的映射的 <strong>域名</strong></p>
</blockquote>
<blockquote>
<p>Port：通过ZeroNews配置的映射的 <strong>端口</strong></p>
</blockquote>
<ul>
<li>点击Open，然后输入被远程服务器的账号密码，就能够实现远程异地远程访问了。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c36e2e71ec240e7a9360c33aa0eb185~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=IUGcHyTuKlnBqEF45%2BUAQgIGBjo%3D" alt="" loading="lazy"/></p>
<p><strong>3. 通过MobaXterm实现异地远程访问</strong></p>
<ul>
<li>打开MobaXterm客户端。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d3436e8329042d7b26b9a83532de8d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=wUZaQLBybWeD5i2OOeW5JDTE6n4%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>Remote host：通过ZeroNews配置的映射的 <strong>域名</strong></p>
</blockquote>
<blockquote>
<p>Port：通过ZeroNews配置的映射的 <strong>端口</strong></p>
</blockquote>
<ul>
<li>点击OK，然后输入被远程服务器的账号密码，就能够实现远程异地远程访问了。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/466f0be6fa4447109e4224697a54a97d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=dLzT%2B7B0YWMIeS5xHElY0RrQtqg%3D" alt="" loading="lazy"/></p>
<p><strong>4. 通过WindTerm实现异地远程访问</strong></p>
<ul>
<li>打开WindTerm客户端。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70eaebbba9254c06a9103c79beb81f82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=aOS%2FKs78fjJPUwehPLwe%2BwP2hNM%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>主机：通过ZeroNews配置的映射的 <strong>域名</strong></p>
</blockquote>
<blockquote>
<p>端口：通过ZeroNews配置的映射的 <strong>端口</strong></p>
</blockquote>
<ul>
<li>点击链接，然后输入被远程服务器的账号密码，就能够实现远程异地远程访问了。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93aefadf31a5459f82f76849fa29668e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=9or0dNsbAqHKP5LpQyxFacWHtcA%3D" alt="" loading="lazy"/></p>
<p><strong>5. 通过FinalShell实现异地远程访问</strong></p>
<ul>
<li>打开FinalShell客户端。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68717ab10c4e411d90080c89e9c50f0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=UwZ2Rh7KXwJzitN5oK9fVUk6nZo%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>主机：通过ZeroNews配置的映射的 <strong>域名</strong></p>
</blockquote>
<blockquote>
<p>端口：通过ZeroNews配置的映射的 <strong>端口</strong></p>
</blockquote>
<blockquote>
<p>方法：选择密码</p>
</blockquote>
<blockquote>
<p>用户名：输入被远程服务器的账号</p>
</blockquote>
<blockquote>
<p>密码：输入被远程服务器的密码</p>
</blockquote>
<ul>
<li>点击确定，就可以了进行远程了</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/253b7823f96b44faa1b73b3a03a31a10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=ct5%2BAOyiF0cd03JsB3kjz2%2F6%2Bis%3D" alt="" loading="lazy"/></p>
<p><strong>6. 通过XShell实现异地远程访问</strong></p>
<ul>
<li>打开Xshell客户端。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92f2f63d72154153b5b2ac519e114be9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=XsmlSOm8kYh0uA9whvNQR7NeDFQ%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>协议：选择SSH 主机：通过ZeroNews配置的映射的 <strong>域名</strong></p>
</blockquote>
<blockquote>
<p>端口号：通过ZeroNews配置的映射的 <strong>端口</strong></p>
</blockquote>
<ul>
<li>点击连接，然后输入被远程服务器的账号密码，就能够实现远程异地远程访问了。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b392aec589374ae686c8ee60d1d48752~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=s2EuH4RhdHz6AVAxZWd9rA8bE%2F8%3D" alt="" loading="lazy"/></p>
<p><strong>7. 通过SecrueCRT实现异地远程访问</strong></p>
<ul>
<li>打开SecrueCRT客户端。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33c0f38bc09e49889a365153617d0d67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=fgCM%2FDUtF0rCeB2ZGt1dsEWrgro%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>Protocol：选择SSH2</p>
</blockquote>
<blockquote>
<p>Hostname：通过ZeroNews配置的映射的 <strong>域名</strong></p>
</blockquote>
<blockquote>
<p>Port：通过ZeroNews配置的映射的 <strong>端口</strong></p>
</blockquote>
<blockquote>
<p>Username：输入被远程服务器的账号</p>
</blockquote>
<ul>
<li>点击Connect，然后输入被远程服务器的密码，就能够实现远程异地远程访问了。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/254f384e5db64f9199cefce82a2f900e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWmVyb05ld3PlhoXnvZHnqb_pgI8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770784814&amp;x-signature=ChcR8YW1AWLkzcT37mX7YgRxaJU%3D" alt="" loading="lazy"/></p>
<p>以上为常见远程 SSH 工具的连接方式，您可根据实际需求选择使用。预祝春节运维顺利，远程访问稳定不断线！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ClawBoot/OpenClaw 安装教程（windows+Linux）]]></title>    <link>https://juejin.cn/post/7602551091516538889</link>    <guid>https://juejin.cn/post/7602551091516538889</guid>    <pubDate>2026-02-04T03:57:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602551091516538889" data-draft-id="7602551091516522505" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ClawBoot/OpenClaw 安装教程（windows+Linux）"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-04T03:57:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="乌拉布拉乌"/> <meta itemprop="url" content="https://juejin.cn/user/1040559557063304"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ClawBoot/OpenClaw 安装教程（windows+Linux）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1040559557063304/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    乌拉布拉乌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T03:57:48.000Z" title="Wed Feb 04 2026 03:57:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.openclaw.ai%2Fstart%2Fgetting-started" target="_blank" title="https://docs.openclaw.ai/start/getting-started" ref="nofollow noopener noreferrer">docs.openclaw.ai/start/getti…</a></p>
<p>需要先安装node22 使用nvm安装</p>
<p>windows使用下面的命令会自动安装node22，linux则需要自行手动安装，并安装git</p>
<p>安装命令
windows：</p>
<pre><code class="hljs language-arduino" lang="arduino">iwr -useb https:<span class="hljs-comment">//openclaw.ai/install.ps1 | iex</span>
</code></pre>
<p>linux/mac：</p>
<pre><code class="hljs language-arduino" lang="arduino">curl -fsSL https:<span class="hljs-comment">//openclaw.ai/install.sh | bash</span>
</code></pre>
<p>运行引导程序（并安装服务）：</p>
<pre><code class="hljs language-css" lang="css">openclaw onboard <span class="hljs-attr">--install-daemon</span>
</code></pre>
<p>安装过程可参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1709615" target="_blank" title="https://developer.aliyun.com/article/1709615" ref="nofollow noopener noreferrer">developer.aliyun.com/article/170…</a> 这篇文章，其中有些命令是旧版本的，例如clawdbot status，正确的是openclaw status</p>
<p>选择quickstart qwen模型，其他的则跳过，最后一步选择TUI，选择后会自动在后台运行openclaw，类似nohup</p>
<p>常用命令：</p>
<pre><code class="hljs language-lua" lang="lua">查看状态
openclaw <span class="hljs-built_in">status</span>
启动网关
openclaw gateway
重启网关（修改openclaw.json后执行）
openclaw gateway restart
查看仪表盘网址
openclaw dashboard
检查修复
openclaw doctor <span class="hljs-comment">--fix</span>
引导配置
openclaw onboard
</code></pre>
<p>windows使用powershell执行即可，执行完成后，输入 <code>openclaw dashboard</code> 查看网址，复制Dashboard URL查看即可，若访问的是没有token的url，直接访问 127.0.0.1:18789 则会出现 <code>disconnected (1008): device identity required</code></p>
<p>linux本机部署后，默认是在服务器内网环境的，可以进行端口映射，实现外网访问</p>
<ol>
<li>修改openclaw.json，添加controlUi 并将gateway下的bind由loopback 改为lan</li>
</ol>
<pre><code class="hljs language-json" lang="json">    <span class="hljs-attr">"controlUi"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"allowInsecureAuth"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"bind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lan"</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>完整gateway：</p>
<pre><code class="hljs language-json" lang="json">  <span class="hljs-attr">"gateway"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"controlUi"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"allowInsecureAuth"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"auth"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"token"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"你的token"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"local"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"port"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">18789</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"bind"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lan"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tailscale"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"mode"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"off"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"resetOnExit"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>修改后需要重启网关，执行：<code>openclaw gateway restart</code></p>
<ol start="2">
<li>腾讯云、服务器内部开放tcp端口（18789端口）
ufw 方式开放端口：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo apt install ufw
sudo ufw status
sudo ufw <span class="hljs-built_in">enable</span>
sudo ufw allow 18789/tcp
</code></pre>
<ol start="3">
<li>访问 服务器IP:18789/?token=XXXX  （token通过<code>openclaw dashboard</code> 查看）</li>
</ol>
<p>完整openclaw.json：</p>
<pre><code class="hljs language-ruby" lang="ruby">ubuntu<span class="hljs-variable">@VM</span>-<span class="hljs-number">0</span>-<span class="hljs-number">7</span>-<span class="hljs-symbol">ubuntu:</span>~<span class="hljs-variable">$ </span>cat  ~<span class="hljs-regexp">/.openclaw/openclaw</span>.json
{
  <span class="hljs-string">"meta"</span>: {
    <span class="hljs-string">"lastTouchedVersion"</span>: <span class="hljs-string">"2026.2.1"</span>,
    <span class="hljs-string">"lastTouchedAt"</span>: <span class="hljs-string">"2026-02-04T01:38:02.479Z"</span>
  },
  <span class="hljs-string">"wizard"</span>: {
    <span class="hljs-string">"lastRunAt"</span>: <span class="hljs-string">"2026-02-04T01:38:02.475Z"</span>,
    <span class="hljs-string">"lastRunVersion"</span>: <span class="hljs-string">"2026.2.1"</span>,
    <span class="hljs-string">"lastRunCommand"</span>: <span class="hljs-string">"onboard"</span>,
    <span class="hljs-string">"lastRunMode"</span>: <span class="hljs-string">"local"</span>
  },
  <span class="hljs-string">"commands"</span>: {
    <span class="hljs-string">"native"</span>: <span class="hljs-string">"auto"</span>,
    <span class="hljs-string">"nativeSkills"</span>: <span class="hljs-string">"auto"</span>
  },
  <span class="hljs-string">"gateway"</span>: {
    <span class="hljs-string">"controlUi"</span>: {
      <span class="hljs-string">"allowInsecureAuth"</span>: <span class="hljs-literal">true</span>
    },
    <span class="hljs-string">"auth"</span>: {
      <span class="hljs-string">"mode"</span>: <span class="hljs-string">"token"</span>,
      <span class="hljs-string">"token"</span>: <span class="hljs-string">"你的token"</span>
    },
    <span class="hljs-string">"mode"</span>: <span class="hljs-string">"local"</span>,
    <span class="hljs-string">"port"</span>: <span class="hljs-number">18789</span>,
    <span class="hljs-string">"bind"</span>: <span class="hljs-string">"lan"</span>,
    <span class="hljs-string">"tailscale"</span>: {
      <span class="hljs-string">"mode"</span>: <span class="hljs-string">"off"</span>,
      <span class="hljs-string">"resetOnExit"</span>: <span class="hljs-literal">false</span>
    }
  },
  <span class="hljs-string">"agents"</span>: {
    <span class="hljs-string">"defaults"</span>: {
      <span class="hljs-string">"maxConcurrent"</span>: <span class="hljs-number">4</span>,
      <span class="hljs-string">"subagents"</span>: {
        <span class="hljs-string">"maxConcurrent"</span>: <span class="hljs-number">8</span>
      },
      <span class="hljs-string">"workspace"</span>: <span class="hljs-string">"/home/ubuntu/.openclaw/workspace"</span>,
      <span class="hljs-string">"models"</span>: {
        <span class="hljs-string">"qwen-portal/coder-model"</span>: {
          <span class="hljs-string">"alias"</span>: <span class="hljs-string">"qwen"</span>
        },
        <span class="hljs-string">"qwen-portal/vision-model"</span>: {}
      },
      <span class="hljs-string">"model"</span>: {
        <span class="hljs-string">"primary"</span>: <span class="hljs-string">"qwen-portal/vision-model"</span>
      }
    }
  },
  <span class="hljs-string">"messages"</span>: {
    <span class="hljs-string">"ackReactionScope"</span>: <span class="hljs-string">"group-mentions"</span>
  },
  <span class="hljs-string">"plugins"</span>: {
    <span class="hljs-string">"entries"</span>: {
      <span class="hljs-string">"qwen-portal-auth"</span>: {
        <span class="hljs-string">"enabled"</span>: <span class="hljs-literal">true</span>
      }
    }
  },
  <span class="hljs-string">"models"</span>: {
    <span class="hljs-string">"providers"</span>: {
      <span class="hljs-string">"qwen-portal"</span>: {
        <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"https://portal.qwen.ai/v1"</span>,
        <span class="hljs-string">"apiKey"</span>: <span class="hljs-string">"qwen-oauth"</span>,
        <span class="hljs-string">"api"</span>: <span class="hljs-string">"openai-completions"</span>,
        <span class="hljs-string">"models"</span>: [
          {
            <span class="hljs-string">"id"</span>: <span class="hljs-string">"coder-model"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"Qwen Coder"</span>,
            <span class="hljs-string">"reasoning"</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">"input"</span>: [
              <span class="hljs-string">"text"</span>
            ],
            <span class="hljs-string">"cost"</span>: {
              <span class="hljs-string">"input"</span>: <span class="hljs-number">0</span>,
              <span class="hljs-string">"output"</span>: <span class="hljs-number">0</span>,
              <span class="hljs-string">"cacheRead"</span>: <span class="hljs-number">0</span>,
              <span class="hljs-string">"cacheWrite"</span>: <span class="hljs-number">0</span>
            },
            <span class="hljs-string">"contextWindow"</span>: <span class="hljs-number">128000</span>,
            <span class="hljs-string">"maxTokens"</span>: <span class="hljs-number">8192</span>
          },
          {
            <span class="hljs-string">"id"</span>: <span class="hljs-string">"vision-model"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"Qwen Vision"</span>,
            <span class="hljs-string">"reasoning"</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-string">"input"</span>: [
              <span class="hljs-string">"text"</span>,
              <span class="hljs-string">"image"</span>
            ],
            <span class="hljs-string">"cost"</span>: {
              <span class="hljs-string">"input"</span>: <span class="hljs-number">0</span>,
              <span class="hljs-string">"output"</span>: <span class="hljs-number">0</span>,
              <span class="hljs-string">"cacheRead"</span>: <span class="hljs-number">0</span>,
              <span class="hljs-string">"cacheWrite"</span>: <span class="hljs-number">0</span>
            },
            <span class="hljs-string">"contextWindow"</span>: <span class="hljs-number">128000</span>,
            <span class="hljs-string">"maxTokens"</span>: <span class="hljs-number">8192</span>
          }
        ]
      }
    }
  },
  <span class="hljs-string">"auth"</span>: {
    <span class="hljs-string">"profiles"</span>: {
      <span class="hljs-string">"qwen-portal:default"</span>: {
        <span class="hljs-string">"provider"</span>: <span class="hljs-string">"qwen-portal"</span>,
        <span class="hljs-string">"mode"</span>: <span class="hljs-string">"oauth"</span>
      }
    }
  }
}
ubuntu<span class="hljs-variable">@VM</span>-<span class="hljs-number">0</span>-<span class="hljs-number">7</span>-<span class="hljs-symbol">ubuntu:</span>~<span class="hljs-variable">$ </span>

</code></pre>
<p>在飞书中配置机器人，可参考： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1709615" target="_blank" title="https://developer.aliyun.com/article/1709615" ref="nofollow noopener noreferrer">developer.aliyun.com/article/170…</a> 这篇文章
同样其中的命令需要由clawdbot更换为openclaw，如下：</p>
<pre><code class="hljs language-arduino" lang="arduino">openclaw plugins install @m1heng-clawd/feishu

openclaw config set channels.feishu.appId <span class="hljs-string">"飞书 app id"</span>

openclaw config set channels.feishu.appSecret <span class="hljs-string">"飞书 app secret"</span>

openclaw config set channels.feishu.enabled <span class="hljs-literal">true</span>

# 推荐使用 websocket
openclaw config set channels.feishu.connectionMode websocket

openclaw config set channels.feishu.dmPolicy pairing

openclaw config set channels.feishu.groupPolicy allowlist

openclaw config set channels.feishu.requireMention <span class="hljs-literal">true</span>

openclaw gateway restart

</code></pre>
<p>注意：若只是个人使用，使用飞书个人版创建即可，若需要分享给好友，则需要在飞书创建企业后再创建机器人，飞书个人版无法将机器人分享给其他人</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[字节 Trae 彻底炸场！全新 Skills 模式：原来 AI 真的可以自己把 Bug 改完]]></title>    <link>https://juejin.cn/post/7602551091516702729</link>    <guid>https://juejin.cn/post/7602551091516702729</guid>    <pubDate>2026-02-04T04:46:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602551091516702729" data-draft-id="7602471311510274075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="字节 Trae 彻底炸场！全新 Skills 模式：原来 AI 真的可以自己把 Bug 改完"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-04T04:46:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="正儿八经蛙"/> <meta itemprop="url" content="https://juejin.cn/user/4101648892575020"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            字节 Trae 彻底炸场！全新 Skills 模式：原来 AI 真的可以自己把 Bug 改完
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4101648892575020/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    正儿八经蛙
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:46:11.000Z" title="Wed Feb 04 2026 04:46:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文为微信公众号 <strong>敏叔的技术札记</strong> 原创文章，版权归 <strong>敏叔的技术札记</strong> 所有。<br/>
如需转载或引用本文内容，<strong>请务必注明原文出处、作者以及原文链接</strong>。<br/>
欢迎关注我的微信公众号 <strong>「敏叔的技术札记」</strong>，获取最新技术分享与深度解析。<br/>
对于任何未注明来源的转载、摘编、修改或商业使用行为，本人保留追究法律责任的权利。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>几篇文章下了，真心希望可以把这种所谓的技术门槛打下来！！这几天，我深度体验了字节 Trae 最新推出的 <strong>Skills 模式</strong> 今天体验 AI 真的能自己把 Bug 改完，而且改得有模有样！这篇文章就带大家亲手走一遍流程，看看这个“炸场”的新功能到底有多猛。</p>
<h2 data-id="heading-1">简介：从聊天机器人到“数字员工”</h2>
<p>Trae 是字节跳动推出的 AI 智能体开发与应用平台。之前的版本已经挺强了：能联网、能调用工具、还能搞知识库。但这次全新的 <strong>Skills 模式</strong>，直接把“让 AI 自主完成任务”的能力拔高了一个维度。</p>
<p>简单说，它不再是那个你问一句、它答一句的“聊天机器人”了，而是变成了一个能理解复杂任务、自己规划步骤、调用工具、甚至写代码改 Bug 的 <strong>“数字员工”</strong>。</p>
<blockquote>
<p>这不就是我们一直念叨的“AI 程序员”雏形吗？</p>
</blockquote>
<h2 data-id="heading-2">核心实战：让 AI 自己找出 Bug 并修复</h2>
<p>光吹不行，直接上实战。我准备了一个经典的、带 Bug 的 Python 小程序，看看 Trae 的 Skills 模式能不能自己发现并修复它。</p>
<h3 data-id="heading-3">1. 先准备一个有 Bug 的程序</h3>
<p>我写了一个简单的 Python 脚本 <code>buggy_calc.py</code>，功能是计算列表的平均值。里面埋了一个典型的“坑”：如果列表是空的，会触发 <code>ZeroDivisionError</code>。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># buggy_calc.pydef calculate_average(numbers):    """计算一个数字列表的平均值"""    total = sum(numbers)    average = total / len(numbers)  # Bug 在这里！如果 numbers 为空列表，这里会除零。    return average# 测试用例if __name__ == "__main__":    test_list = [1, 2, 3, 4, 5]    print(f"列表 {test_list} 的平均值是：{calculate_average(test_list)}")        empty_list = []    print(f"列表 {empty_list} 的平均值是：{calculate_average(empty_list)}")  # 这里会崩溃！</span>
</code></pre>
<h3 data-id="heading-4">2. 在 Trae 中创建并配置 Skill</h3>
<p>进入 Trae 平台，找到全新的 <strong>Skills</strong> 模块，点击创建新 Skill。</p>
<p><strong>第一步：定义 Skill 目标</strong>这里就是“下指令”的关键。我写的目标是：</p>
<blockquote>
<p>“请分析我提供的 Python 代码文件 buggy_calc.py，找出其中的潜在 Bug 或错误，并直接生成修复后的完整代码文件。你需要运行代码来进行测试验证。”</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01bad1065f8d42c8a11117e3fdab242e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2j5YS_5YWr57uP6JuZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770785171&amp;x-signature=Ox1gsAebQdvSDQnughJQbpZRRPU%3D" alt="图片" loading="lazy"/></p>
<p><strong>第三步：运行</strong>把 <code>buggy_calc.py</code> 喂给 Trae，然后“运行这个 Skill”。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9400106bf5f47a8bafcfd49259d7396~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2j5YS_5YWr57uP6JuZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770785171&amp;x-signature=nl84bCgHFKYjvo6QR3aCbJ0GjrA%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-5">见证奇迹的时刻</h2>
<p>接下来，我几乎可以当“甩手掌柜”了。Trae 的 AI 智能体开始它的表演：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5af4abd1e6ad4817bdea6faea5fae3c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2j5YS_5YWr57uP6JuZ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770785171&amp;x-signature=Eul4mlXOaMzMDf7%2Fnkt1OE6NjOs%3D" alt="图片" loading="lazy"/></p>
<ol>
<li>
<p><strong>读取文件</strong>：它先读取了 <code>buggy_calc.py</code> 的内容。</p>
</li>
<li>
<p><strong>分析代码</strong>：它在“思考”后输出分析：“发现潜在风险：函数 <code>calculate_average</code> 未处理空列表输入，会导致 <code>ZeroDivisionError</code>。”</p>
</li>
<li>
<p><strong>制定计划</strong>：它自己生成计划：“1. 修复 <code>calculate_average</code> 函数，增加空列表判断。2. 编写修复后的代码。3. 运行测试验证修复效果。”</p>
</li>
<li>
<p><strong>执行修复</strong>：它生成修复后的代码。我一看，改得还真不错：</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">def calculate_average(numbers):    <span class="hljs-string">""</span><span class="hljs-string">"计算一个数字列表的平均值"</span><span class="hljs-string">""</span>    <span class="hljs-keyword">if</span> not numbers:        <span class="hljs-built_in">print</span>(<span class="hljs-string">"警告：空列表无法计算平均值"</span>)        <span class="hljs-built_in">return</span> 0  <span class="hljs-comment"># 或者返回 None    total = sum(numbers)    average = total / len(numbers)    return average# 测试用例if __name__ == "__main__":    test_list = [1, 2, 3, 4, 5]    print(f"列表 {test_list} 的平均值是：{calculate_average(test_list)}")        empty_list = []    print(f"列表 {empty_list} 的平均值是：{calculate_average(empty_list)}")  # 这里会崩溃！</span>
</code></pre>
<ol start="5">
<li>
<p><strong>运行测试</strong>：最秀的操作来了！它<strong>自动调用了代码解释器</strong>，直接运行了它刚写好的 <code>fixed_calc.py</code>（在沙箱环境里执行），并把运行结果甩给我看：</p>
<pre><code class="hljs language-bash" lang="bash">列表 [1, 2, 3, 4, 5] 的平均值是：3.0列表 [] 的平均值是：0
</code></pre>
</li>
<li>
<p><strong>交付结果</strong>：最后，它把修复好的完整代码文件提供给我下载，并附上一句话：“Bug 已修复，已通过基础测试验证。”</p>
</li>
</ol>
<p>我用下来之后发现，整个过程完全自动化。我除了最开始下指令和上传文件，中间没有任何干预。AI 自己完成了 <strong>“分析 -&gt; 规划 -&gt; 执行（编码）-&gt; 验证”</strong> 的完整闭环。</p>
<h2 data-id="heading-6">附赠小技巧与踩坑经验</h2>
<ol>
<li>
<p><strong>指令要具体</strong>：Skills 模式很强，但指令越清晰，效果越好。比如“找出 Bug 并修复”就比“看看这段代码”强得多。</p>
</li>
<li>
<p><strong>工具勾选是门学问</strong>：如果你的任务不需要联网，就别勾选网络搜索，速度会快很多。但如果是修复一个涉及陌生 API 的 Bug，勾上搜索能让 AI 自己去查文档，反而更省心。</p>
</li>
<li>
<p><strong>文件路径要注意</strong>：在 Skills 里，AI 操作文件是基于你上传的“工作区”。指令里提到的文件名一定要和上传的文件名一致，不然它会找不到。</p>
</li>
<li>
<p><strong>复杂任务可以分步</strong>：对于特别复杂的项目，可以创建多个串联的 Skills。比如 Skill1 专门跑单元测试发现失败用例，Skill2 根据失败日志去定位和修复代码。这样玩，空间就大了。</p>
</li>
</ol>
<h2 data-id="heading-7">后记</h2>
<p>体验完 Trae 的 Skills 模式，我最大的感受是：<strong>AI 智能体“自主行动”的时代，真的开始了</strong>。</p>
<p>它不再只是一个需要你一步步手把手教的“实习生”，而是一个能领到一个模糊任务，然后自己拆解、找工具、执行并交付结果的“初级工程师”。</p>
<p>这对我们开发者意味着什么？我觉得，以后咱们更多的精力会放在 <strong>“定义问题”</strong>、<strong>“设计任务流程”</strong> 和 <strong>“审核结果”</strong> 上，而把那些繁琐、重复、模式化的代码检查和修复工作，放心交给像 Trae Skills 这样的 AI 去完成。</p>
<p>当然，现在它可能还处理不了特别庞大复杂的系统级 Bug，但这个方向和潜力，已经足够让人兴奋了。</p>
<p>赶紧去试试吧，亲手打造一个能帮你改 Bug 的 AI 搭档！</p>
<p>最后还是不忘各位看官哥哥姐姐来一波三连（点赞+关注+转发）！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[macOS 未签名应用「已损坏」问题解决方案]]></title>    <link>https://juejin.cn/post/7602512226999418930</link>    <guid>https://juejin.cn/post/7602512226999418930</guid>    <pubDate>2026-02-04T03:31:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602512226999418930" data-draft-id="7602465642534731826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="macOS 未签名应用「已损坏」问题解决方案"/> <meta itemprop="keywords" content="Mac,macOS"/> <meta itemprop="datePublished" content="2026-02-04T03:31:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卡尔特斯"/> <meta itemprop="url" content="https://juejin.cn/user/4450440831840909"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            macOS 未签名应用「已损坏」问题解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4450440831840909/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卡尔特斯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T03:31:56.000Z" title="Wed Feb 04 2026 03:31:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题现象</h2>
<p>当你下载或拷贝一个未签名的 <code>.app</code> 应用时，macOS 可能会弹出以下错误提示：</p>
<ul>
<li><strong>「xxx.app 已损坏，无法打开。您应该将它移到废纸篓。」</strong></li>
<li><strong>「无法打开 xxx，因为无法验证开发者。」</strong></li>
<li><strong>「Apple 无法检查其是否包含恶意软件。」</strong></li>
<li><strong>「来自未识别的开发者」</strong></li>
</ul>
<h2 data-id="heading-1">问题原因</h2>
<p>这些问题通常<strong>不是应用本身损坏</strong>，而是 macOS 的 Gatekeeper 安全机制在作怪。当应用从网络下载、AirDrop 传输或解压 zip 时，系统会自动添加「隔离标记」（扩展属性），导致未签名应用无法正常打开。</p>
<blockquote>
<p><strong>判断依据：</strong> 如果该应用在别人电脑上能正常使用，且你的 Mac 芯片架构（Intel / Apple Silicon）与应用匹配，那基本就是扩展属性的问题，按下面的方法处理即可。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">解决方案</h2>
<h3 data-id="heading-3">第一步：开启「任何来源」选项（只需设置一次）</h3>
<blockquote>
<p>如果你已经开启过「任何来源」，可以跳过此步骤，直接看第二步。</p>
</blockquote>
<ol>
<li>
<p>点击菜单栏搜索图标（或按 <code>Command + 空格</code>），输入 <strong>终端</strong>，打开终端应用</p>
</li>
<li>
<p>输入以下命令，然后按回车：</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">sudo spctl --master-disable
</code></pre>
<ol start="3">
<li>
<p>输入你的 Mac 登录密码（<strong>输入时不会显示任何字符，这是正常的</strong>），然后按回车</p>
</li>
<li>
<p>完成后，可以在 <strong>系统设置 → 隐私与安全性</strong> 中看到「任何来源」选项已开启，然后切换到「任何来源」。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70e34343b18e405e87aaaadf1bed8742~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2h5bCU54m55pav:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770780717&amp;x-signature=09a3A%2Bt2d12UyqJ397Rm6HT7%2BWI%3D" alt="image.png" loading="lazy"/></p>
</li>
</ol>
<h3 data-id="heading-4">第二步：清除扩展属性（核心步骤）</h3>
<ol>
<li>
<p>打开 <strong>终端</strong></p>
</li>
<li>
<p>输入以下命令（注意 <code>cr</code> 后面有一个<strong>空格</strong>，先不要按回车）：</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">xattr -cr 
</code></pre>
<ol start="3">
<li>
<p><strong>将应用拖入终端窗口</strong>（从「应用程序」文件夹或桌面拖入），路径会自动填入</p>
</li>
<li>
<p>按<strong>回车</strong>执行命令</p>
</li>
<li>
<p>然后<strong>右键点击应用 → 选择「打开」→ 再点击「打开」</strong>，即可正常使用</p>
</li>
</ol>
<p><strong>或者直接输入完整命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">xattr -cr <span class="hljs-string">"/Applications/YourApp.app"</span>
</code></pre>
<blockquote>
<p><strong>提示：</strong> 将 <code>/Applications/YourApp.app</code> 替换为你的应用实际路径。</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">可选：查看扩展属性</h2>
<p>如果你想确认问题原因，可以先查看应用的扩展属性：</p>
<pre><code class="hljs language-bash" lang="bash">xattr -l <span class="hljs-string">"/Applications/YourApp.app"</span>
</code></pre>
<h3 data-id="heading-6">常见的扩展属性说明</h3>

























<table><thead><tr><th>属性名</th><th>说明</th><th>触发场景</th></tr></thead><tbody><tr><td><code>com.apple.quarantine</code></td><td>隔离标记，Gatekeeper 据此拦截未签名应用</td><td>浏览器下载、AirDrop、解压 zip</td></tr><tr><td><code>com.apple.provenance</code></td><td>macOS Ventura+ 新增，记录应用来源</td><td>网络获取、复制/解压后保留的元数据</td></tr><tr><td><code>...</code></td><td>如果是不同渠道下载的还会带上不同渠道的标识。</td><td>来源于不同的下载源</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">注意事项</h2>
<ol>
<li>
<p><strong>确认芯片架构匹配：</strong></p>
<ul>
<li>Intel 芯片 Mac → 需要 Intel 版本或通用版本（Universal）的应用</li>
<li>Apple Silicon（M1/M2/M3/M4）Mac → 需要 ARM 版本或通用版本的应用</li>
<li>可通过左上角  <strong>→ 关于本机</strong> 查看芯片类型</li>
</ul>
</li>
<li>
<p><strong>应用必须已安装：</strong></p>
<ul>
<li>执行 <code>xattr -cr</code> 时，应用需要已经拖入「应用程序」文件夹或放在桌面</li>
<li>不能直接对 <code>.dmg</code> 磁盘映像内的应用执行此命令</li>
</ul>
</li>
<li>
<p><strong>确认应用来源可信：</strong></p>
<ul>
<li>只对你信任的应用执行上述操作</li>
<li>建议从官方渠道或可靠来源获取应用</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-8">快速命令参考</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 开启「任何来源」（只需执行一次）</span>
sudo spctl --master-disable

<span class="hljs-comment"># 查看扩展属性</span>
xattr -l <span class="hljs-string">"/path/to/App.app"</span>

<span class="hljs-comment"># 清除扩展属性（推荐）</span>
xattr -cr <span class="hljs-string">"/path/to/App.app"</span>

<span class="hljs-comment"># 仅清除隔离标记</span>
xattr -d com.apple.quarantine <span class="hljs-string">"/path/to/App.app"</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 架构日记 —— plugin 基础建设]]></title>    <link>https://juejin.cn/post/7602559134575198244</link>    <guid>https://juejin.cn/post/7602559134575198244</guid>    <pubDate>2026-02-04T04:02:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602559134575198244" data-draft-id="7601929765533368371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 架构日记 —— plugin 基础建设"/> <meta itemprop="keywords" content="架构,Flutter,客户端"/> <meta itemprop="datePublished" content="2026-02-04T04:02:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="人形打码机"/> <meta itemprop="url" content="https://juejin.cn/user/2085122730895063"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 架构日记 —— plugin 基础建设
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2085122730895063/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    人形打码机
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:02:45.000Z" title="Wed Feb 04 2026 04:02:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><p>在很多 Flutter 项目刚启动的时候，架构往往不是最先被讨论的问题，通常客户端的架构在初始阶段往往被轻视。</p>
<p>页面能跑、功能能用、交互看起来也没什么问题，似乎一切都在一个“差不多”的状态里。但当项目进入多人协作、功能逐渐增多、开始覆盖不同平台之后，问题往往会以一些并不温和的方式出现。</p>
<p>回头看我自己经历过的几个 Flutter 项目，真正让我意识到“Plugin 基础建设”这件事的重要性，并不是因为某一次写得不顺，而是因为<strong>后期维护的代价实在太高</strong>。</p>
<blockquote>
<p>真实工程中，<strong>为什么对 Plugin 做明确分级</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">为什么做 Plugin 分级</h2>
<p>曾经和别人讨论过一个问题，<code>如果不考虑任何设计模式，不使用任何推荐的项目结构，直接将所有代码放在一个类中是否可以运行项目</code>——答案是当然可以，只要你不担心在一个风和日丽的下午老板突然过来打爆你的头。</p>
<p>Flutter 的优势很明显：跨平台、高效率、学习曲线友好，视图搭建迅速等。<br/>
但这些优势，在项目规模变大之后，也会反过来放大一些风险。其中最典型的一点是：</p>
<blockquote>
<p><strong>平台差异并不会因为 Flutter 而消失</strong>。</p>
</blockquote>
<p>在涉及原生能力的场景中，比如蓝牙、WiFi、文件系统、系统权限管理等，不同平台之间的实现差异是客观存在的。如果在早期没有通过分包或插件做逻辑隔离，这些差异很容易通过 <code>if platform()</code>这样的判定“顺手”写进业务层。</p>
<p>短期看，这样做确实很便捷；<br/>
但随着平台变多、功能复杂，这些差异就会迅速演变成维护噩梦，甚至演化为 P0 问题。</p>
<p>Plugin 的分级并不是为了<code>架构好看</code>，而是为了回答一个更现实的问题：</p>
<blockquote>
<p><strong>复杂度到底应该被放在哪里？</strong></p>
</blockquote>
<p>如果不主动为它准备一个容器，它迟早会流向业务层给各个功能模块带来负担逐渐变为一坨人人躲避的狮山，<code>在未清晰了解业务及历史包袱前不要轻易动狮山，它一定能埋住每个自认为精明的人</code>，如同罗马不是一日建成一般一坨狮山也是充满了各种包袱，解决他的最好方式是在一开始就应该尽可能避免后续的明显不合理堆砌。</p>
<hr/>
<h2 data-id="heading-1">Plugin 分级的常见思路</h2>
<p>在实际项目中，通常根据<code>平台特性 &amp; 业务形态</code>对 Plugin 做分级。</p>
<blockquote>
<p>这种分级并不是绝对的，但优先级是明确的。</p>
</blockquote>
<h3 data-id="heading-2">P0：平台能力分级 —— 最应重视</h3>
<p>Flutter 在 UI 层非常强，但在原生能力调用上天然存在短板。</p>
<p>只要涉及以下场景：</p>
<ul>
<li>蓝牙、WiFi 等硬件能力</li>
<li>文件存储、系统权限</li>
<li>与平台生命周期强相关的能力</li>
</ul>
<p>就不可避免地需要和原生代码打交道。</p>
<p>如果这些逻辑被直接写进业务层，问题往往不是“现在能不能跑”，而是<strong>未来还能不能维护</strong>。<br/>
一次平台改动，就可能牵动大量业务代码，甚至直接引发线上事故。</p>
<p>因此这一层次的抽离往往很关键，通常有以下几个基本要素 ：</p>
<pre><code class="hljs language-bash" lang="bash">-  所有平台差异，只存在于 plugin 内部
-  对业务层暴露的，只是统一接口
-  业务层永远不需要关心当前运行在哪个平台
</code></pre>
<p>目标只有一个：</p>
<blockquote>
<p><strong>通过模块化的划分，把平台复杂度进行封装，只对业务暴露接口能力</strong></p>
</blockquote>
<p>这是整个架构中，优先级最高、也最不能妥协的一层。</p>
<hr/>
<h3 data-id="heading-3">P1：视图公共组件 —— 越早越好</h3>
<p>很多项目 UI 层的问题，在一开始并不容易显现。</p>
<p>项目初期，如果没有明确的开发要求，大家往往各自为战：颜色随手写、样式临时配、弹窗任意调用（毕竟潜意识都觉得 UI 并没有什么设计模式）。短期内看不出太大问题并且开发效率还不差，但当进入多人协作、持续迭代阶段，这些“一时之爽”会迅速堆积成不可忽视的技术债。</p>
<p>在界面开发初期，应尽早纳入视图组件层的建设范围：</p>
<pre><code class="hljs language-bash" lang="bash">-  基础色值与文本样式
-  通用按钮、输入组件
-  弹窗、Toast、对话框
-  路由与页面容器的统一管理
</code></pre>
<p>这一层的风险在于：</p>
<blockquote>
<p><strong>它不是马上爆炸的，但一旦失控，影响范围几乎是全部</strong></p>
</blockquote>
<p>等你真正意识到样式、图标、交互已经出现系统性差异时，往往已经很难在不付出巨大成本的情况下完成重构。</p>
<p>从经验来看，这是一个典型的 <strong>P1 问题，但后果接近 P0</strong>。</p>
<hr/>
<h3 data-id="heading-4">P1：业务域 —— 模块 Owner</h3>
<p>当项目开始拆分模块、多人并行开发时，业务层的结构清晰度会直接影响协作效率。</p>
<p>像登录、用户信息、网络请求、设备管理这类由专人长期维护的功能，如果全部堆在一个业务层里，很容易出现职责不清、改动互相影响的问题。</p>
<p>将这类功能按业务域拆分为独立 Plugin，可以带来几个明显收益：</p>
<ul>
<li>职责边界更清晰</li>
<li>减少无关代码的改动影响</li>
<li>更利于并行开发与长期维护</li>
</ul>
<p>需要强调的是，这一层并不是“拆得越细越好”，而是<strong>拆到责任明确为止</strong>。</p>
<hr/>
<h3 data-id="heading-5">P2：通用工具 —— 提高复用</h3>
<p>还有一类 Plugin，或者说 Package 通常优先级略低，但迟早需要面对：</p>
<pre><code class="hljs language-bash" lang="bash">-  日志系统
-  全局通用的加解密策略
-  一些跨模块复用的工具方法
</code></pre>
<p>这类代码个人更倾向于以 <strong>Dart Package</strong> 的形式维护：</p>
<ul>
<li>独立版本，尽可能不依赖三方插件</li>
<li>明确使用边界（根据项目及团队情况制定）</li>
<li>避免工具方法无限膨胀</li>
</ul>
<p>这一层往往不会成为项目初期的瓶颈，但如果长期忽视，后期同样会成为技术债的集中区。</p>
<hr/>
<h2 data-id="heading-6">简要的分级总结</h2>
<p>如果从宏观角度看，一种接受度较高的分级维度是：</p>
<ul>
<li><strong>Platform Plugin（P0）</strong> ：控制平台差异，避免业务层 P0</li>
<li><strong>Widget / UI Plugin（P1）</strong> ：控制一致性，避免不可回收的样式债</li>
<li><strong>Domain Plugin（P1）</strong> ：控制协作成本，明确业务责任</li>
<li><strong>Tools / Package（P2）</strong> ：控制复用与技术债扩散</li>
</ul>
<blockquote>
<p>分级的目的，从来不是限制开发，而是<strong>让复杂度有序生长</strong>。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">写在最后</h2>
<p>通过一篇短文不可能一次性讲清楚 Flutter Plugin 架构分级。</p>
<p>在后续的《Flutter 架构日记》中，笔者将通过实践结合理论会分别展开不同的分级维度，结合真实项目中的取舍与踩坑经历，围绕以下几点展开学习讨论：</p>
<ul>
<li>平台 Plugin 的设计边界</li>
<li>UI 组件如何避免野蛮生长</li>
<li>业务域 Plugin 的拆分时机</li>
<li>通用工具层如何保持克制</li>
</ul>
<p>架构从来不是一套固定答案，而是一连串在真实约束下不断的做选择，正是它的不唯一性造就了软件工程这门学科；</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[踩坑记录：iOS Safari 软键盘下的"幽灵弹窗"问题]]></title>    <link>https://juejin.cn/post/7602466689713340431</link>    <guid>https://juejin.cn/post/7602466689713340431</guid>    <pubDate>2026-02-04T04:59:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602466689713340431" data-draft-id="7602488187408580660" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="踩坑记录：iOS Safari 软键盘下的&quot;幽灵弹窗&quot;问题"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2026-02-04T04:59:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RemHusband"/> <meta itemprop="url" content="https://juejin.cn/user/1425415102792237"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            踩坑记录：iOS Safari 软键盘下的"幽灵弹窗"问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1425415102792237/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RemHusband
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T04:59:03.000Z" title="Wed Feb 04 2026 04:59:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>最近在做移动端 H5 登录页面时，遇到了一个诡异的 bug：在 iOS Safari 中，弹窗明明显示在屏幕中央，点击按钮却毫无反应。检查元素后发现，DOM 的实际位置和视觉位置完全对不上。折腾了一番后终于搞清楚了原因，记录一下。</p>
</blockquote>
<h2 data-id="heading-0">问题现象</h2>
<p>我们的登录模块有两个页面：账号密码登录和验证码登录，可以互相切换。两个页面都有一个协议确认弹窗，使用 <code>position: fixed</code> 定位。</p>
<p>诡异的事情发生了：</p>
<ol>
<li>在账号密码页面输入手机号（软键盘弹出），触发弹窗，点击取消 —— <strong>正常</strong></li>
<li>切换到验证码页面，触发弹窗，点击取消 —— <strong>正常</strong></li>
<li>再切换回账号密码页面，触发弹窗，点击取消 —— <strong>没反应！</strong></li>
</ol>
<p>打开 Safari 调试器一看，弹窗的 DOM 位置和屏幕上显示的位置差了好几百像素。点击事件实际触发在了空白区域。</p>
<p>这就是传说中的"幽灵弹窗"。</p>
<hr/>
<h2 data-id="heading-1">前置知识：理解移动端视口</h2>
<p>要搞清楚这个问题，得先理解移动端浏览器的视口概念。这部分内容稍微有点绕，但理解了之后很多移动端的坑就都能解释了。</p>
<h3 data-id="heading-2">三种视口</h3>
<p>移动端浏览器有三种视口：</p>
<h4 data-id="heading-3">1. 布局视口（Layout Viewport）</h4>
<p>布局视口是 CSS 布局的基准。当你写 <code>width: 100%</code> 时，这个 100% 就是相对于布局视口的宽度。</p>
<p>在没有 <code>&lt;meta name="viewport"&gt;</code> 标签的情况下，移动端浏览器的布局视口默认是 980px（不同浏览器可能略有差异）。这就是为什么早期的桌面网页在手机上看起来特别小 —— 浏览器把 980px 的内容硬塞进了 320px 的屏幕。</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 这行代码让布局视口等于设备宽度 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
</code></pre>
<h4 data-id="heading-4">2. 视觉视口（Visual Viewport）</h4>
<p>视觉视口是用户当前能看到的区域。当用户双指缩放页面时，布局视口不变，但视觉视口会变小（放大时）或变大（缩小时）。</p>
<p>可以这样理解：布局视口是一张大地图，视觉视口是你手里的放大镜。放大镜移动或缩放，地图本身不会变。</p>
<h4 data-id="heading-5">3. 理想视口（Ideal Viewport）</h4>
<p>理想视口是设备屏幕的实际尺寸。<code>width=device-width</code> 就是让布局视口等于理想视口。</p>
<h3 data-id="heading-6">用代码获取视口信息</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 布局视口</span>
<span class="hljs-keyword">const</span> layoutWidth = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientWidth</span>;
<span class="hljs-keyword">const</span> layoutHeight = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">clientHeight</span>;

<span class="hljs-comment">// 视觉视口（需要 Visual Viewport API）</span>
<span class="hljs-keyword">const</span> visualWidth = <span class="hljs-variable language_">window</span>.<span class="hljs-property">visualViewport</span>?.<span class="hljs-property">width</span>;
<span class="hljs-keyword">const</span> visualHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">visualViewport</span>?.<span class="hljs-property">height</span>;
<span class="hljs-keyword">const</span> offsetTop = <span class="hljs-variable language_">window</span>.<span class="hljs-property">visualViewport</span>?.<span class="hljs-property">offsetTop</span>; <span class="hljs-comment">// 视觉视口相对于布局视口的偏移</span>

<span class="hljs-comment">// 屏幕尺寸</span>
<span class="hljs-keyword">const</span> screenWidth = <span class="hljs-variable language_">window</span>.<span class="hljs-property">screen</span>.<span class="hljs-property">width</span>;
<span class="hljs-keyword">const</span> screenHeight = <span class="hljs-variable language_">window</span>.<span class="hljs-property">screen</span>.<span class="hljs-property">height</span>;
</code></pre>
<h3 data-id="heading-7">视口与 position: fixed 的关系</h3>
<p>这里是关键点：<strong><code>position: fixed</code> 的元素是相对于视觉视口定位的，但它的点击区域是根据布局视口计算的</strong>。</p>
<p>正常情况下，视觉视口和布局视口是重合的，所以没问题。但当软键盘弹出时，iOS Safari 会改变视觉视口而不改变布局视口，这就导致了视觉位置和点击区域的错位。</p>
<hr/>
<h2 data-id="heading-8">浏览器渲染原理：为什么会"错位"</h2>
<p>要理解"幽灵弹窗"，还需要了解浏览器是怎么渲染页面的。</p>
<h3 data-id="heading-9">渲染流水线</h3>
<p>浏览器渲染一个页面大致经过以下步骤：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">HTML</span> → DOM Tree
              ↘
                → Render Tree → Layout → Paint → Composite
              ↗
CSS  → CSSOM
</code></pre>
<ol>
<li><strong>解析 HTML</strong>：构建 DOM 树</li>
<li><strong>解析 CSS</strong>：构建 CSSOM（CSS Object Model）</li>
<li><strong>合并</strong>：DOM + CSSOM = Render Tree（渲染树）</li>
<li><strong>布局（Layout/Reflow）</strong>：计算每个元素的位置和大小</li>
<li><strong>绘制（Paint）</strong>：把元素画到屏幕上</li>
<li><strong>合成（Composite）</strong>：把不同图层合并</li>
</ol>
<h3 data-id="heading-10">重排（Reflow）与重绘（Repaint）</h3>
<h4 data-id="heading-11">重排（Reflow）</h4>
<p>当元素的几何属性（位置、大小）发生变化时，浏览器需要重新计算布局，这就是重排。</p>
<p>触发重排的操作：</p>
<ul>
<li>改变窗口大小</li>
<li>改变字体大小</li>
<li>添加/删除 DOM 元素</li>
<li>改变元素的 <code>width</code>、<code>height</code>、<code>margin</code>、<code>padding</code> 等</li>
<li>读取某些属性：<code>offsetTop</code>、<code>scrollTop</code>、<code>clientTop</code>、<code>getComputedStyle()</code> 等</li>
</ul>
<h4 data-id="heading-12">重绘（Repaint）</h4>
<p>当元素的外观（颜色、背景、阴影等）发生变化，但几何属性不变时，只需要重绘，不需要重排。</p>
<p>触发重绘的操作：</p>
<ul>
<li>改变 <code>color</code>、<code>background</code>、<code>visibility</code> 等</li>
</ul>
<h4 data-id="heading-13">性能影响</h4>
<p>重排的代价比重绘大得多，因为重排会导致整个渲染树的重新计算。这就是为什么我们要尽量避免频繁触发重排。</p>
<h3 data-id="heading-14">图层（Layer）与合成</h3>
<p>现代浏览器会把页面分成多个图层，每个图层独立渲染，最后合成到一起。某些 CSS 属性会触发元素提升为独立图层：</p>
<ul>
<li><code>transform</code></li>
<li><code>opacity</code></li>
<li><code>will-change</code></li>
<li><code>position: fixed</code>（在某些浏览器中）</li>
</ul>
<p>独立图层的好处是：当这个元素变化时，不会影响其他图层，只需要重新合成，不需要重排整个页面。</p>
<p>这就是为什么我们在解决方案中使用 <code>transform: translate3d(0, 0, 0)</code> —— 它强制创建一个独立的合成层，让弹窗的渲染与页面其他部分隔离。</p>
<hr/>
<h2 data-id="heading-15">问题根因深度分析</h2>
<p>现在我们有了足够的背景知识，来深入分析"幽灵弹窗"的成因。</p>
<h3 data-id="heading-16">iOS Safari 的"独特"处理方式</h3>
<p>当软键盘弹出时，不同平台的处理方式不同：</p>
<p><strong>Android Chrome 的做法：</strong></p>
<pre><code class="hljs language-scss" lang="scss">软键盘弹出前：
┌─────────────────────┐
│                     │
│   Layout Viewport   │ = Visual Viewport
│   (<span class="hljs-number">100vh</span>)           │
│                     │
└─────────────────────┘

软键盘弹出后：
┌─────────────────────┐
│   Layout Viewport   │ = Visual Viewport（缩小了）
│   (变小了)           │
├─────────────────────┤
│      软键盘          │
└─────────────────────┘
</code></pre>
<p>Android 的做法是缩小布局视口，<code>position: fixed</code> 的元素会相对于新的视口重新定位，一切正常。</p>
<p><strong>iOS Safari 的做法：</strong></p>
<pre><code class="hljs language-scss" lang="scss">软键盘弹出前：
┌─────────────────────┐
│                     │
│   Layout Viewport   │ = Visual Viewport
│   (<span class="hljs-number">100vh</span>)           │
│                     │
└─────────────────────┘

软键盘弹出后：
┌─────────────────────┐ ← Layout Viewport（不变）
│   ↑                 │
│   │ 页面被推上去     │
│   ↓                 │
├─────────────────────┤ ← Visual Viewport（变小了）
│      软键盘          │
└─────────────────────┘
</code></pre>
<p>iOS 保持布局视口不变，只是把页面内容往上"推"。这时候：</p>
<ul>
<li><code>position: fixed</code> 的元素根据布局视口计算位置</li>
<li>但用户看到的是视觉视口</li>
<li>两者不一致，就出现了"幽灵"现象</li>
</ul>
<h3 data-id="heading-17">为什么多次切换后才出问题？</h3>
<p>每次软键盘弹出，<code>window.scrollY</code> 都会产生变化。当用户在多个页面之间切换时：</p>
<ol>
<li>页面 A：软键盘弹出，<code>scrollY = 200</code></li>
<li>切换到页面 B：<code>scrollY</code> 可能没有完全重置</li>
<li>页面 B：软键盘弹出，<code>scrollY</code> 累加</li>
<li>切换回页面 A：累积的偏移量导致计算错误</li>
</ol>
<p>Vue Router 的 <code>router.replace()</code> 不会触发完整的页面刷新，滚动状态会残留。</p>
<h3 data-id="heading-18">为什么 iOS Chrome 也有问题？</h3>
<p>这里要提一个很多人不知道的事实：<strong>iOS 上所有浏览器都是 Safari 套壳</strong>。</p>
<p>Apple 的 App Store 政策要求：iOS 上的所有浏览器必须使用 WebKit 引擎。所以：</p>






























<table><thead><tr><th>浏览器</th><th>Android 引擎</th><th>iOS 引擎</th></tr></thead><tbody><tr><td>Chrome</td><td>Blink</td><td>WebKit</td></tr><tr><td>Firefox</td><td>Gecko</td><td>WebKit</td></tr><tr><td>Edge</td><td>Blink</td><td>WebKit</td></tr><tr><td>Safari</td><td>-</td><td>WebKit</td></tr></tbody></table>
<p>iOS 上的 Chrome 只是换了个 UI 的 Safari，底层渲染引擎完全一样。这个问题在 iOS 上是无差别攻击。</p>
<hr/>
<h2 data-id="heading-19">解决方案</h2>
<h3 data-id="heading-20">核心思路</h3>
<p>弹窗显示时，把页面"冻住"，让布局视口和视觉视口强制保持一致。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> savedScrollY = <span class="hljs-number">0</span>;
<span class="hljs-keyword">let</span> savedBodyStyle = <span class="hljs-string">''</span>;

<span class="hljs-comment">// 锁定</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">lockBodyScroll</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 兼容性写法，确保能获取到滚动位置</span>
  savedScrollY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">pageYOffset</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span> || <span class="hljs-number">0</span>;
  savedBodyStyle = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span>;

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`
    <span class="hljs-subst">${savedBodyStyle}</span>;
    position: fixed;
    top: -<span class="hljs-subst">${savedScrollY}</span>px;
    left: 0;
    right: 0;
    width: 100%;
    overflow: hidden;
  `</span>;
};

<span class="hljs-comment">// 解锁</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">unlockBodyScroll</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = savedBodyStyle;
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>, savedScrollY);
};
</code></pre>
<p><strong>原理解析：</strong></p>
<ol>
<li><code>position: fixed</code> 让 body 脱离文档流，不再滚动</li>
<li><code>top: -${savedScrollY}px</code> 用负值补偿当前滚动位置，保持视觉一致</li>
<li><code>overflow: hidden</code> 禁止滚动</li>
<li>关闭弹窗时恢复原始样式，并用 <code>scrollTo</code> 恢复滚动位置</li>
</ol>
<h3 data-id="heading-21">Vue 组件中的使用</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { watch, toRefs, nextTick } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-keyword">const</span> props = defineProps&lt;{ <span class="hljs-attr">show</span>: <span class="hljs-built_in">boolean</span> }&gt;();
<span class="hljs-keyword">const</span> { show } = <span class="hljs-title function_">toRefs</span>(props);

<span class="hljs-title function_">watch</span>(show, <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (val) {
    <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">lockBodyScroll</span>();
    });
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">unlockBodyScroll</span>();
  }
}, { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// 组件卸载时确保解锁，防止状态残留</span>
<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (show.<span class="hljs-property">value</span>) {
    <span class="hljs-title function_">unlockBodyScroll</span>();
  }
});
</code></pre>
<h3 data-id="heading-22">CSS 优化</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-class">.dialog-overlay</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;

  <span class="hljs-comment">// 动态视口高度，iOS 15+ 支持</span>
  <span class="hljs-comment">// 会随软键盘弹出自动调整</span>
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100vh</span>;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100</span>dvh;

  <span class="hljs-comment">// 强制创建独立合成层</span>
  <span class="hljs-comment">// 让弹窗的渲染与页面隔离</span>
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
  -webkit-<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate3d</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

  <span class="hljs-comment">// 禁用触摸滚动手势</span>
  touch-action: none;
  -webkit-touch-callout: none;

  <span class="hljs-comment">// 防止滚动穿透到父元素</span>
  overscroll-behavior: contain;
}
</code></pre>
<p><strong>CSS 属性解析：</strong></p>

























<table><thead><tr><th>属性</th><th>作用</th></tr></thead><tbody><tr><td><code>100dvh</code></td><td>动态视口高度，会随软键盘变化</td></tr><tr><td><code>transform: translate3d(0,0,0)</code></td><td>触发 GPU 加速，创建独立图层</td></tr><tr><td><code>touch-action: none</code></td><td>禁用所有触摸手势</td></tr><tr><td><code>overscroll-behavior: contain</code></td><td>滚动到边界时不会触发父元素滚动</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-23">踩过的坑</h2>
<h3 data-id="heading-24">坑 1：忘记在组件卸载时解锁</h3>
<p>如果用户在弹窗打开状态下切换页面（比如点击了弹窗里的链接），<code>body</code> 的 <code>fixed</code> 样式会残留，导致新页面无法滚动。</p>
<p><strong>解决：</strong> 一定要在 <code>onBeforeUnmount</code> 里清理。</p>
<h3 data-id="heading-25">坑 2：滚动位置恢复不准确</h3>
<p><code>window.scrollY</code> 在某些老旧浏览器或特殊情况下可能是 <code>undefined</code>。</p>
<p><strong>解决：</strong> 使用兼容性写法：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> scrollY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">pageYOffset</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">scrollTop</span> || <span class="hljs-number">0</span>;
</code></pre>
<h3 data-id="heading-26">坑 3：100vh 在 iOS 上不靠谱</h3>
<p>iOS Safari 的 <code>100vh</code> 是一个"理想值"，包含了地址栏的高度。当地址栏收起或软键盘弹出时，实际可视区域会变化，但 <code>100vh</code> 不变。</p>
<p><strong>解决：</strong> 使用 <code>100dvh</code>（动态视口高度），但要注意兼容性：</p>
<ul>
<li>iOS 15.4+</li>
<li>Chrome 108+</li>
<li>Firefox 101+</li>
</ul>
<p>对于不支持的浏览器，可以用 JS 动态计算：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">setVh</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> vh = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> * <span class="hljs-number">0.01</span>;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">style</span>.<span class="hljs-title function_">setProperty</span>(<span class="hljs-string">'--vh'</span>, <span class="hljs-string">`<span class="hljs-subst">${vh}</span>px`</span>);
};
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, setVh);
</code></pre>
<h3 data-id="heading-27">坑 4：多个弹窗嵌套</h3>
<p>如果页面上有多个弹窗组件，每个都调用 <code>lockBodyScroll</code>，会互相覆盖 <code>savedScrollY</code>。</p>
<p><strong>解决：</strong> 使用引用计数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">let</span> lockCount = <span class="hljs-number">0</span>;
<span class="hljs-keyword">let</span> savedScrollY = <span class="hljs-number">0</span>;
<span class="hljs-keyword">let</span> savedBodyStyle = <span class="hljs-string">''</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">lockBodyScroll</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (lockCount === <span class="hljs-number">0</span>) {
    savedScrollY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span> || <span class="hljs-number">0</span>;
    savedBodyStyle = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`...`</span>;
  }
  lockCount++;
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">unlockBodyScroll</span> = (<span class="hljs-params"/>) =&gt; {
  lockCount--;
  <span class="hljs-keyword">if</span> (lockCount === <span class="hljs-number">0</span>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = savedBodyStyle;
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>(<span class="hljs-number">0</span>, savedScrollY);
  }
};
</code></pre>
<hr/>
<h2 data-id="heading-28">延伸：其他解决方案</h2>
<h3 data-id="heading-29">方案二：使用 Visual Viewport API</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">adjustDialogPosition</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">visualViewport</span>) {
    <span class="hljs-keyword">const</span> offsetY = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> - <span class="hljs-variable language_">window</span>.<span class="hljs-property">visualViewport</span>.<span class="hljs-property">height</span>;
    dialogRef.<span class="hljs-property">value</span>.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span> = <span class="hljs-string">`translateY(-<span class="hljs-subst">${offsetY / <span class="hljs-number">2</span>}</span>px)`</span>;
  }
};

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">visualViewport</span>?.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, adjustDialogPosition);
});

<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">visualViewport</span>?.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, adjustDialogPosition);
});
</code></pre>
<p><strong>优点：</strong> 不需要锁定 body，更"优雅"
<strong>缺点：</strong> 需要持续监听，有性能开销；弹窗位置会跳动</p>
<h3 data-id="heading-30">方案三：软键盘收起后再显示弹窗</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">showDialog</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 先让输入框失焦，收起软键盘</span>
  (<span class="hljs-variable language_">document</span>.<span class="hljs-property">activeElement</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span>)?.<span class="hljs-title function_">blur</span>();

  <span class="hljs-comment">// 等待软键盘收起动画完成</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    dialogVisible.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>;
  }, <span class="hljs-number">300</span>);
};
</code></pre>
<p><strong>优点：</strong> 简单粗暴，绕过问题
<strong>缺点：</strong> 用户体验不好，有明显延迟</p>
<hr/>
<h2 data-id="heading-31">总结</h2>
<p>这个问题本质上是 <strong>iOS WebKit 的 viewport 处理机制</strong> 和 <strong><code>position: fixed</code> 定位</strong> 的冲突。</p>
<p>关键点：</p>
<ol>
<li>iOS Safari 软键盘弹出时只改变 Visual Viewport，不改变 Layout Viewport</li>
<li><code>position: fixed</code> 根据 Layout Viewport 计算位置，但渲染在 Visual Viewport</li>
<li>页面切换时滚动状态累积，加剧了偏移</li>
</ol>
<p>解决方案的核心就一句话：<strong>弹窗显示时锁定 body 滚动，关闭时恢复</strong>。</p>
<p>这不是 bug，是 Apple 的"设计选择"。作为开发者，我们只能见招拆招。</p>
<p>希望这篇文章能帮到遇到同样问题的朋友，少走点弯路。</p>
<hr/>
<p><em>参考资料：</em></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbugs.webkit.org%2Fshow_bug.cgi%3Fid%3D141832" target="_blank" title="https://bugs.webkit.org/show_bug.cgi?id=141832" ref="nofollow noopener noreferrer">WebKit Bug #141832: position:fixed and virtual keyboard</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FVisual_Viewport_API" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/Visual_Viewport_API" ref="nofollow noopener noreferrer">MDN: Visual Viewport API</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Flength%23dynamic_viewport_units" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/length#dynamic_viewport_units" ref="nofollow noopener noreferrer">MDN: CSS length - Dynamic viewport units</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.quirksmode.org%2Fmobile%2Fviewports2.html" target="_blank" title="https://www.quirksmode.org/mobile/viewports2.html" ref="nofollow noopener noreferrer">A tale of two viewports</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fweb%2Ffundamentals%2Fperformance%2Frendering" target="_blank" title="https://developers.google.com/web/fundamentals/performance/rendering" ref="nofollow noopener noreferrer">Google Developers: Rendering Performance</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose 从入门到精通（六）：架构与工程化]]></title>    <link>https://juejin.cn/post/7602529888483442751</link>    <guid>https://juejin.cn/post/7602529888483442751</guid>    <pubDate>2026-02-04T03:06:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7602529888483442751" data-draft-id="7602503154506383401" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose 从入门到精通（六）：架构与工程化"/> <meta itemprop="keywords" content="Android Studio,Android,Android Jetpack"/> <meta itemprop="datePublished" content="2026-02-04T03:06:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="邹阿涛涛涛涛涛涛涛涛"/> <meta itemprop="url" content="https://juejin.cn/user/3808364009106839"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose 从入门到精通（六）：架构与工程化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808364009106839/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    邹阿涛涛涛涛涛涛涛涛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-04T03:06:41.000Z" title="Wed Feb 04 2026 03:06:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>深入理解 Compose 在大型项目中的架构设计，掌握 Navigation、Hilt、性能优化等企业级开发技能。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">前言</h2>
<p>在前五篇中，我们掌握了 Compose 的核心开发技能。但在实际项目中，我们还需要考虑：</p>
<ul>
<li>如何组织大型项目的代码结构？</li>
<li>如何实现页面导航？</li>
<li>如何管理依赖注入？</li>
<li>如何优化应用性能？</li>
</ul>
<p>本篇文章将深入讲解 Compose 在企业级项目中的架构设计与工程化实践。</p>
<hr/>
<h2 data-id="heading-1">一、项目架构设计</h2>
<h3 data-id="heading-2">1.1 推荐的项目结构</h3>
<pre><code class="hljs language-bash" lang="bash">app/
├── src/main/java/com/example/app/
│   ├── App.kt                    <span class="hljs-comment"># Application 类</span>
│   ├── di/                       <span class="hljs-comment"># 依赖注入模块</span>
│   │   ├── AppModule.kt
│   │   └── NetworkModule.kt
│   ├── data/                     <span class="hljs-comment"># 数据层</span>
│   │   ├── <span class="hljs-built_in">local</span>/                <span class="hljs-comment"># 本地数据源</span>
│   │   │   ├── dao/
│   │   │   ├── entity/
│   │   │   └── AppDatabase.kt
│   │   ├── remote/               <span class="hljs-comment"># 远程数据源</span>
│   │   │   ├── api/
│   │   │   └── dto/
│   │   ├── repository/           <span class="hljs-comment"># 仓库层</span>
│   │   └── model/                <span class="hljs-comment"># 数据模型</span>
│   ├── domain/                   <span class="hljs-comment"># 领域层（可选）</span>
│   │   ├── usecase/
│   │   └── model/
│   ├── ui/                       <span class="hljs-comment"># UI 层</span>
│   │   ├── theme/                <span class="hljs-comment"># 主题配置</span>
│   │   ├── component/            <span class="hljs-comment"># 通用组件</span>
│   │   ├── screen/               <span class="hljs-comment"># 页面</span>
│   │   │   ├── home/
│   │   │   │   ├── HomeScreen.kt
│   │   │   │   ├── HomeViewModel.kt
│   │   │   │   └── HomeUiState.kt
│   │   │   └── profile/
│   │   └── navigation/           <span class="hljs-comment"># 导航配置</span>
│   └── util/                     <span class="hljs-comment"># 工具类</span>
└── src/main/res/                 <span class="hljs-comment"># 资源文件</span>
</code></pre>
<h3 data-id="heading-3">1.2 分层架构原则</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────────┐
│                      分层架构图                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  UI Layer (Presentation)                                │   │
│  │  - Composable 函数                                       │   │
│  │  - ViewModel                                             │   │
│  │  - UI State                                              │   │
│  │  职责：展示数据、处理用户交互                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Domain Layer (Optional)                                │   │
│  │  - UseCase                                               │   │
│  │  - Domain Model                                          │   │
│  │  职责：业务逻辑、数据转换                                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              ↓                                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Data Layer                                             │   │
│  │  - Repository                                            │   │
│  │  - DataSource (Local/Remote)                             │   │
│  │  职责：数据获取、缓存策略                                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  依赖方向：UI → Domain → Data                                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<hr/>
<h2 data-id="heading-4">二、Navigation 组件</h2>
<h3 data-id="heading-5">2.1 为什么需要 Navigation？</h3>
<p>传统 Fragment 导航的问题：</p>
<ul>
<li>事务管理复杂</li>
<li>返回栈难以控制</li>
<li>深度链接实现困难</li>
<li>参数传递类型不安全</li>
</ul>
<p><strong>Compose Navigation 的优势</strong>：</p>
<ul>
<li>声明式导航</li>
<li>类型安全的参数传递</li>
<li>自动处理返回栈</li>
<li>支持深层链接</li>
</ul>
<h3 data-id="heading-6">2.2 Navigation 基础</h3>
<h4 data-id="heading-7">2.2.1 设置导航</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 添加依赖</span>
<span class="hljs-comment">// implementation("androidx.navigation:navigation-compose:2.7.0")</span>

<span class="hljs-comment">// 2. 定义路由</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Screen</span>(<span class="hljs-keyword">val</span> route: String) {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> Home : Screen(<span class="hljs-string">"home"</span>)
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> Profile : Screen(<span class="hljs-string">"profile/{userId}"</span>) {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createRoute</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span> = <span class="hljs-string">"profile/<span class="hljs-variable">$userId</span>"</span>
    }
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> Settings : Screen(<span class="hljs-string">"settings"</span>)
}

<span class="hljs-comment">// 3. 创建 NavHost</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">AppNavigation</span><span class="hljs-params">(
    navController: <span class="hljs-type">NavHostController</span> = rememberNavController()</span></span>
) {
    NavHost(
        navController = navController,
        startDestination = Screen.Home.route
    ) {
        composable(Screen.Home.route) {
            HomeScreen(
                onNavigateToProfile = { userId -&gt;
                    navController.navigate(Screen.Profile.createRoute(userId))
                }
            )
        }
        
        composable(
            route = Screen.Profile.route,
            arguments = listOf(
                navArgument(<span class="hljs-string">"userId"</span>) { type = NavType.StringType }
            )
        ) { backStackEntry -&gt;
            <span class="hljs-keyword">val</span> userId = backStackEntry.arguments?.getString(<span class="hljs-string">"userId"</span>) ?: <span class="hljs-string">""</span>
            ProfileScreen(
                userId = userId,
                onBack = { navController.popBackStack() }
            )
        }
        
        composable(Screen.Settings.route) {
            SettingsScreen()
        }
    }
}
</code></pre>
<h4 data-id="heading-8">2.2.2 导航操作</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 导航到目标页面</span>
navController.navigate(<span class="hljs-string">"profile/123"</span>)

<span class="hljs-comment">// 返回上一页</span>
navController.popBackStack()

<span class="hljs-comment">// 返回指定页面</span>
navController.popBackStack(<span class="hljs-string">"home"</span>, inclusive = <span class="hljs-literal">false</span>)

<span class="hljs-comment">// 清空返回栈并导航</span>
navController.navigate(<span class="hljs-string">"home"</span>) {
    popUpTo(<span class="hljs-string">"home"</span>) { inclusive = <span class="hljs-literal">true</span> }
}

<span class="hljs-comment">// 启动单例页面（防止重复）</span>
navController.navigate(<span class="hljs-string">"detail"</span>) {
    launchSingleTop = <span class="hljs-literal">true</span>
}
</code></pre>
<h3 data-id="heading-9">2.3 类型安全的导航（Navigation 2.8.0+）</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 定义序列化路由类</span>
<span class="hljs-meta">@Serializable</span>
<span class="hljs-keyword">object</span> Home

<span class="hljs-meta">@Serializable</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Profile</span>(<span class="hljs-keyword">val</span> userId: String)

<span class="hljs-meta">@Serializable</span>
<span class="hljs-keyword">object</span> Settings

<span class="hljs-comment">// 2. 创建 NavHost</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">AppNavigation</span><span class="hljs-params">(
    navController: <span class="hljs-type">NavHostController</span> = rememberNavController()</span></span>
) {
    NavHost(
        navController = navController,
        startDestination = Home
    ) {
        composable&lt;Home&gt; {
            HomeScreen(
                onNavigateToProfile = { userId -&gt;
                    navController.navigate(Profile(userId))
                }
            )
        }
        
        composable&lt;Profile&gt; { backStackEntry -&gt;
            <span class="hljs-keyword">val</span> profile: Profile = backStackEntry.toRoute()
            ProfileScreen(userId = profile.userId)
        }
        
        composable&lt;Settings&gt; {
            SettingsScreen()
        }
    }
}
</code></pre>
<h3 data-id="heading-10">2.4 底部导航栏</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">BottomNavApp</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> navController = rememberNavController()
    
    <span class="hljs-keyword">val</span> items = listOf(
        BottomNavItem.Home,
        BottomNavItem.Search,
        BottomNavItem.Profile
    )
    
    Scaffold(
        bottomBar = {
            NavigationBar {
                <span class="hljs-keyword">val</span> navBackStackEntry <span class="hljs-keyword">by</span> navController.currentBackStackEntryAsState()
                <span class="hljs-keyword">val</span> currentDestination = navBackStackEntry?.destination
                
                items.forEach { item -&gt;
                    NavigationBarItem(
                        icon = { Icon(item.icon, contentDescription = item.label) },
                        label = { Text(item.label) },
                        selected = currentDestination?.hierarchy?.any {
                            it.route == item.route
                        } == <span class="hljs-literal">true</span>,
                        onClick = {
                            navController.navigate(item.route) {
                                popUpTo(navController.graph.findStartDestination().id) {
                                    saveState = <span class="hljs-literal">true</span>
                                }
                                launchSingleTop = <span class="hljs-literal">true</span>
                                restoreState = <span class="hljs-literal">true</span>
                            }
                        }
                    )
                }
            }
        }
    ) { innerPadding -&gt;
        NavHost(
            navController = navController,
            startDestination = BottomNavItem.Home.route,
            modifier = Modifier.padding(innerPadding)
        ) {
            composable(BottomNavItem.Home.route) { HomeScreen() }
            composable(BottomNavItem.Search.route) { SearchScreen() }
            composable(BottomNavItem.Profile.route) { ProfileScreen() }
        }
    }
}

<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BottomNavItem</span>(
    <span class="hljs-keyword">val</span> route: String,
    <span class="hljs-keyword">val</span> icon: ImageVector,
    <span class="hljs-keyword">val</span> label: String
) {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> Home : BottomNavItem(<span class="hljs-string">"home"</span>, Icons.Default.Home, <span class="hljs-string">"首页"</span>)
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> Search : BottomNavItem(<span class="hljs-string">"search"</span>, Icons.Default.Search, <span class="hljs-string">"搜索"</span>)
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">object</span> Profile : BottomNavItem(<span class="hljs-string">"profile"</span>, Icons.Default.Person, <span class="hljs-string">"我的"</span>)
}
</code></pre>
<h3 data-id="heading-11">2.5 深层链接</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// AndroidManifest.xml 中配置</span>
&lt;activity
    android:name=<span class="hljs-string">".MainActivity"</span>
    android:exported=<span class="hljs-string">"true"</span>&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=<span class="hljs-string">"android.intent.action.VIEW"</span> /&gt;
        &lt;category android:name=<span class="hljs-string">"android.intent.category.DEFAULT"</span> /&gt;
        &lt;category android:name=<span class="hljs-string">"android.intent.category.BROWSABLE"</span> /&gt;
        &lt;<span class="hljs-keyword">data</span> android:scheme=<span class="hljs-string">"https"</span> android:host=<span class="hljs-string">"example.com"</span> /&gt;
    &lt;/intent-filter&gt;
&lt;/activity&gt;

<span class="hljs-comment">// Navigation 中配置深层链接</span>
composable(
    route = <span class="hljs-string">"article/{articleId}"</span>,
    deepLinks = listOf(
        navDeepLink {
            uriPattern = <span class="hljs-string">"https://example.com/article/{articleId}"</span>
        }
    ),
    arguments = listOf(
        navArgument(<span class="hljs-string">"articleId"</span>) { type = NavType.StringType }
    )
) { backStackEntry -&gt;
    <span class="hljs-keyword">val</span> articleId = backStackEntry.arguments?.getString(<span class="hljs-string">"articleId"</span>)
    ArticleScreen(articleId = articleId)
}
</code></pre>
<hr/>
<h2 data-id="heading-12">三、Hilt 依赖注入</h2>
<h3 data-id="heading-13">3.1 为什么需要依赖注入？</h3>
<p><strong>传统方式的痛点</strong>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 紧耦合，难以测试</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> api = RetrofitClient.api  <span class="hljs-comment">// 硬编码依赖</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> dao = AppDatabase.dao     <span class="hljs-comment">// 硬编码依赖</span>
}
</code></pre>
<p><strong>依赖注入的优势</strong>：</p>
<ul>
<li>解耦组件</li>
<li>便于单元测试</li>
<li>生命周期自动管理</li>
<li>单例控制</li>
</ul>
<h3 data-id="heading-14">3.2 Hilt 基础配置</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 添加依赖</span>
<span class="hljs-comment">/*
plugins {
    id("kotlin-kapt")
    id("dagger.hilt.android.plugin")
}

dependencies {
    implementation("com.google.dagger:hilt-android:2.48")
    kapt("com.google.dagger:hilt-compiler:2.48")
    implementation("androidx.hilt:hilt-navigation-compose:1.1.0")
}
*/</span>

<span class="hljs-comment">// 2. Application 类</span>
<span class="hljs-meta">@HiltAndroidApp</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> : <span class="hljs-type">Application</span>()

<span class="hljs-comment">// 3. Activity</span>
<span class="hljs-meta">@AndroidEntryPoint</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">ComponentActivity</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        setContent {
            MyApp()
        }
    }
}
</code></pre>
<h3 data-id="heading-15">3.3 定义和注入依赖</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 创建 Module</span>
<span class="hljs-meta">@Module</span>
<span class="hljs-meta">@InstallIn(SingletonComponent::class)</span>
<span class="hljs-keyword">object</span> NetworkModule {
    
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-meta">@Singleton</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideRetrofit</span><span class="hljs-params">()</span></span>: Retrofit {
        <span class="hljs-keyword">return</span> Retrofit.Builder()
            .baseUrl(<span class="hljs-string">"https://api.example.com/"</span>)
            .addConverterFactory(GsonConverterFactory.create())
            .build()
    }
    
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-meta">@Singleton</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideApiService</span><span class="hljs-params">(retrofit: <span class="hljs-type">Retrofit</span>)</span></span>: ApiService {
        <span class="hljs-keyword">return</span> retrofit.create(ApiService::<span class="hljs-keyword">class</span>.java)
    }
}

<span class="hljs-meta">@Module</span>
<span class="hljs-meta">@InstallIn(SingletonComponent::class)</span>
<span class="hljs-keyword">object</span> DatabaseModule {
    
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-meta">@Singleton</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideDatabase</span><span class="hljs-params">(<span class="hljs-meta">@ApplicationContext</span> context: <span class="hljs-type">Context</span>)</span></span>: AppDatabase {
        <span class="hljs-keyword">return</span> Room.databaseBuilder(
            context,
            AppDatabase::<span class="hljs-keyword">class</span>.java,
            <span class="hljs-string">"app_database"</span>
        ).build()
    }
    
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideUserDao</span><span class="hljs-params">(database: <span class="hljs-type">AppDatabase</span>)</span></span>: UserDao {
        <span class="hljs-keyword">return</span> database.userDao()
    }
}

<span class="hljs-comment">// 2. Repository 注入依赖</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRepository</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> apiService: ApiService,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userDao: UserDao
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getUsers</span><span class="hljs-params">()</span></span>: List&lt;User&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">val</span> users = apiService.getUsers()
            userDao.insertAll(users)
            users
        } <span class="hljs-keyword">catch</span> (e: Exception) {
            userDao.getAll()
        }
    }
}

<span class="hljs-comment">// 3. ViewModel 注入 Repository</span>
<span class="hljs-meta">@HiltViewModel</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : ViewModel() {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 4. Composable 获取 ViewModel</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserScreen</span><span class="hljs-params">(
    viewModel: <span class="hljs-type">UserViewModel</span> = hiltViewModel()</span></span>
) {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-16">3.4 限定符（Qualifiers）</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 定义限定符</span>
<span class="hljs-meta">@Qualifier</span>
<span class="hljs-meta">@Retention(AnnotationRetention.BINARY)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthInterceptorOkHttpClient</span>

<span class="hljs-meta">@Qualifier</span>
<span class="hljs-meta">@Retention(AnnotationRetention.BINARY)</span>
<span class="hljs-keyword">annotation</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OtherInterceptorOkHttpClient</span>

<span class="hljs-comment">// 提供不同实例</span>
<span class="hljs-meta">@Module</span>
<span class="hljs-meta">@InstallIn(SingletonComponent::class)</span>
<span class="hljs-keyword">object</span> NetworkModule {
    
    <span class="hljs-meta">@AuthInterceptorOkHttpClient</span>
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideAuthOkHttpClient</span><span class="hljs-params">(authInterceptor: <span class="hljs-type">AuthInterceptor</span>)</span></span>: OkHttpClient {
        <span class="hljs-keyword">return</span> OkHttpClient.Builder()
            .addInterceptor(authInterceptor)
            .build()
    }
    
    <span class="hljs-meta">@OtherInterceptorOkHttpClient</span>
    <span class="hljs-meta">@Provides</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">provideOtherOkHttpClient</span><span class="hljs-params">(otherInterceptor: <span class="hljs-type">OtherInterceptor</span>)</span></span>: OkHttpClient {
        <span class="hljs-keyword">return</span> OkHttpClient.Builder()
            .addInterceptor(otherInterceptor)
            .build()
    }
}

<span class="hljs-comment">// 注入指定实例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiService</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-meta">@AuthInterceptorOkHttpClient</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> client: OkHttpClient
)
</code></pre>
<hr/>
<h2 data-id="heading-17">四、性能优化</h2>
<h3 data-id="heading-18">4.1 重组优化</h3>
<h4 data-id="heading-19">4.1.1 避免不必要的重组</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 错误：整个列表都会重组</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserList</span><span class="hljs-params">(users: <span class="hljs-type">List</span>&lt;<span class="hljs-type">User</span>&gt;)</span></span> {
    Column {
        users.forEach { user -&gt;
            UserItem(user = user)  <span class="hljs-comment">// 所有 item 都会重组</span>
        }
    }
}

<span class="hljs-comment">// ✅ 正确：使用 LazyColumn，只重组可见项</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">UserList</span><span class="hljs-params">(users: <span class="hljs-type">List</span>&lt;<span class="hljs-type">User</span>&gt;)</span></span> {
    LazyColumn {
        items(users, key = { it.id }) { user -&gt;
            UserItem(user = user)
        }
    }
}
</code></pre>
<h4 data-id="heading-20">4.1.2 使用 @Stable 和 @Immutable</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ❌ 不稳定类，任何变化都会触发重组</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">""</span>
}

<span class="hljs-comment">// ✅ 稳定类</span>
<span class="hljs-meta">@Stable</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">var</span> name: String = <span class="hljs-string">""</span>
}

<span class="hljs-comment">// ✅ 不可变类，实例替换时才重组</span>
<span class="hljs-meta">@Immutable</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(
    <span class="hljs-keyword">val</span> name: String
)
</code></pre>
<h4 data-id="heading-21">4.1.3 使用 remember 缓存计算</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ExpensiveComponent</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Int</span>&gt;)</span></span> {
    <span class="hljs-comment">// ❌ 每次重组都计算</span>
    <span class="hljs-keyword">val</span> sum = <span class="hljs-keyword">data</span>.sum()
    
    <span class="hljs-comment">// ✅ 只在 data 变化时计算</span>
    <span class="hljs-keyword">val</span> sum = remember(<span class="hljs-keyword">data</span>) { <span class="hljs-keyword">data</span>.sum() }
    
    Text(<span class="hljs-string">"Sum: <span class="hljs-variable">$sum</span>"</span>)
}
</code></pre>
<h3 data-id="heading-22">4.2 布局检查器使用</h3>
<pre><code class="hljs language-vbnet" lang="vbnet">┌─────────────────────────────────────────────────────────────────┐
│                  使用布局检查器优化性能                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  <span class="hljs-number">1</span>. 打开 Layout Inspector                                       │
│     Tools → Layout Inspector                                    │
│                                                                 │
│  <span class="hljs-number">2</span>. 查看重组次数                                                  │
│     - 右侧面板显示每个 Composable 的重组次数                    │
│     - 高重组次数的组件需要优化                                  │
│                                                                 │
│  <span class="hljs-number">3</span>. 常见优化方案                                                  │
│     - 使用 <span class="hljs-keyword">key</span> 优化列表                                          │
│     - 提取不依赖状态的部分                                       │
│     - 使用 derivedStateOf 减少重组                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-23">4.3 图片加载优化</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 使用 Coil 加载图片</span>
AsyncImage(
    model = ImageRequest.Builder(LocalContext.current)
        .<span class="hljs-keyword">data</span>(imageUrl)
        .crossfade(<span class="hljs-literal">true</span>)
        .placeholder(R.drawable.placeholder)
        .error(R.drawable.error)
        .memoryCachePolicy(CachePolicy.ENABLED)
        .diskCachePolicy(CachePolicy.ENABLED)
        .build(),
    contentDescription = <span class="hljs-literal">null</span>,
    contentScale = ContentScale.Crop,
    modifier = Modifier.fillMaxWidth()
)
</code></pre>
<h3 data-id="heading-24">4.4 列表性能优化</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">OptimizedList</span><span class="hljs-params">(items: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Item</span>&gt;)</span></span> {
    LazyColumn {
        items(
            items = items,
            key = { it.id },                    <span class="hljs-comment">// ✅ 使用 key</span>
            contentType = { it.type }           <span class="hljs-comment">// ✅ 使用 contentType</span>
        ) { item -&gt;
            <span class="hljs-keyword">when</span> (item.type) {
                Type.HEADER -&gt; HeaderItem(item)
                Type.CONTENT -&gt; ContentItem(item)
            }
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">ContentItem</span><span class="hljs-params">(item: <span class="hljs-type">Item</span>)</span></span> {
    <span class="hljs-comment">// ✅ 缓存计算结果</span>
    <span class="hljs-keyword">val</span> formattedDate = remember(item.date) {
        formatDate(item.date)
    }
    
    <span class="hljs-comment">// ✅ 避免创建新的 lambda</span>
    <span class="hljs-keyword">val</span> onClick = remember(item.id) {
        { viewModel.onItemClick(item.id) }
    }
    
    Card(onClick = onClick) {
        Text(formattedDate)
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-25">五、测试</h2>
<h3 data-id="heading-26">5.1 Compose UI 测试</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 添加依赖</span>
<span class="hljs-comment">// androidTestImplementation("androidx.compose.ui:ui-test-junit4")</span>

<span class="hljs-comment">// 2. 编写测试</span>
<span class="hljs-meta">@RunWith(AndroidJUnit4::class)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CounterTest</span> {
    <span class="hljs-meta">@get:Rule</span>
    <span class="hljs-keyword">val</span> composeTestRule = createComposeRule()
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">counterIncrements_whenClicked</span><span class="hljs-params">()</span></span> {
        composeTestRule.setContent {
            Counter()
        }
        
        <span class="hljs-comment">// 查找并点击按钮</span>
        composeTestRule.onNodeWithText(<span class="hljs-string">"Count: 0"</span>).assertExists()
        composeTestRule.onNodeWithText(<span class="hljs-string">"Increment"</span>).performClick()
        
        <span class="hljs-comment">// 验证结果</span>
        composeTestRule.onNodeWithText(<span class="hljs-string">"Count: 1"</span>).assertExists()
    }
}
</code></pre>
<h3 data-id="heading-27">5.2 ViewModel 测试</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@ExperimentalCoroutinesApi</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModelTest</span> {
    <span class="hljs-meta">@get:Rule</span>
    <span class="hljs-keyword">val</span> instantExecutorRule = InstantTaskExecutorRule()
    
    <span class="hljs-meta">@get:Rule</span>
    <span class="hljs-keyword">val</span> mainDispatcherRule = MainDispatcherRule()
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> viewModel: UserViewModel
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> repository: FakeUserRepository
    
    <span class="hljs-meta">@Before</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span></span> {
        repository = FakeUserRepository()
        viewModel = UserViewModel(repository)
    }
    
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> `load users updates ui state`<span class="hljs-params">()</span></span> = runTest {
        <span class="hljs-comment">// Given</span>
        <span class="hljs-keyword">val</span> users = listOf(User(<span class="hljs-string">"1"</span>, <span class="hljs-string">"Alice"</span>), User(<span class="hljs-string">"2"</span>, <span class="hljs-string">"Bob"</span>))
        repository.setUsers(users)
        
        <span class="hljs-comment">// When</span>
        viewModel.loadUsers()
        
        <span class="hljs-comment">// Then</span>
        assertEquals(UiState.Success(users), viewModel.uiState.value)
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-28">六、本篇小结</h2>
<p>今天我们深入探讨了 Compose 的架构与工程化：</p>
<h3 data-id="heading-29">项目架构</h3>
<ul>
<li>理解了分层架构的设计原则</li>
<li>掌握了推荐的项目结构</li>
</ul>
<h3 data-id="heading-30">Navigation</h3>
<ul>
<li>掌握了 Navigation 的基础用法</li>
<li>学会了类型安全的导航</li>
<li>理解了深层链接的实现</li>
</ul>
<h3 data-id="heading-31">Hilt</h3>
<ul>
<li>理解了依赖注入的优势</li>
<li>掌握了 Hilt 的配置和使用</li>
<li>学会了限定符的使用</li>
</ul>
<h3 data-id="heading-32">性能优化</h3>
<ul>
<li>掌握了重组优化的方法</li>
<li>学会了使用布局检查器</li>
<li>理解了列表性能优化</li>
</ul>
<h3 data-id="heading-33">测试</h3>
<ul>
<li>掌握了 Compose UI 测试</li>
<li>学会了 ViewModel 测试</li>
</ul>
<hr/>
<h2 data-id="heading-34">下篇预告</h2>
<p><strong>第七篇：高级特性与实战</strong> 将深入讲解：</p>
<ul>
<li>自定义绘制与 Canvas</li>
<li>图形变换与 Shader 效果</li>
<li>窗口 Insets 与边缘到边缘适配</li>
<li>完整实战项目</li>
</ul>
<p>敬请期待！</p>
<hr/>
<blockquote>
<p>📌 <strong>系列文章导航</strong></p>
<ul>
<li>第一篇：初识 Compose ✅</li>
<li>第二篇：核心基石 ✅</li>
<li>第三篇：状态管理 ✅</li>
<li>第四篇：Material 组件与主题 ✅</li>
<li>第五篇：动画与交互 ✅</li>
<li>第六篇：架构与工程化（当前）✅</li>
<li>第七篇：高级特性与实战</li>
</ul>
</blockquote>
<hr/>
<p>如果这篇文章对你有帮助，欢迎 <strong>点赞</strong>、<strong>收藏</strong>、<strong>关注</strong>！有任何问题可以在评论区留言。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>