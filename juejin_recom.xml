<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Go语言动手写Web框架 - Gee第五天 中间件]]></title>    <link>https://juejin.cn/post/7593165280488652841</link>    <guid>https://juejin.cn/post/7593165280488652841</guid>    <pubDate>2026-01-09T12:55:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593165280488652841" data-draft-id="7592990758476693523" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go语言动手写Web框架 - Gee第五天 中间件"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-09T12:55:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Way2top"/> <meta itemprop="url" content="https://juejin.cn/user/1458388314893300"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go语言动手写Web框架 - Gee第五天 中间件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458388314893300/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Way2top
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:55:21.000Z" title="Fri Jan 09 2026 12:55:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">中间件设计</h4>
<p>今天，我们要完成对中间件的支持，计划实现一个 <code>Logger()</code> 中间件，可以在终端输出页面响应的时间。</p>
<p>引入中间件的原因在于，Web 框架需要提供一种灵活的方式来处理请求/响应的不同方面，比如日志记录、性能监控、权限验证等。这些操作如果直接嵌入到每个路由的处理函数中，不仅会造成重复代码，还会让业务逻辑和基础功能混杂在一起，不易维护。</p>
<p>那么具体如何展开呢？</p>
<p>在上一节我们讲到，<strong>路由组</strong> 的作用是为了对不同的路由进行分类管理，避免中间件的冲突。比如：一个大型应用中可能会有很多不同的功能模块（例如：<code>/api</code>，<code>/admin</code>，<code>/v1</code> 等），中间件应该能够按路由组来独立设置，而不是全局应用，避免影响到不同模块的独立性。中间件应该以路由组为单位而不是具体的每一条路由，那样会有大量重复的代码，并且也不符合中间件的定义，因此我们就可以从 <code>RouterGroup</code> 入手了。我们先来看看目前代码中的 RouterGroup 的结构：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> RouterGroup <span class="hljs-keyword">struct</span> {
        prefix      <span class="hljs-type">string</span>
        middlewares []HandlerFunc <span class="hljs-comment">// 支持中间件</span>
        parent      *RouterGroup  <span class="hljs-comment">// 支持嵌套</span>
        engine      *Engine       <span class="hljs-comment">// 所有 group 共享一个 Engine 实例</span>
}
</code></pre>
<p>可以看到，在上一节我们已经给其中添加了一个 <code>middlewares []HandlerFunc</code> 来支持中间件。在 <code>RouterGroup</code> 中，这个属性是用来注册该路由组别下所需要的全部的中间件的。具体来说，不同的路由可能需要使用不同的中间件，此时我们就需要到 <code>Context</code> 结构体中进行修改，用以支持对于具体路由的中间件的使用，来看一下目前 <code>Context</code> 的结构：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">struct</span> {
        Writer     http.ResponseWriter
        Req        *http.Request
        Path       <span class="hljs-type">string</span>            <span class="hljs-comment">// 请求资源路径</span>
        Method     <span class="hljs-type">string</span>            <span class="hljs-comment">// 请求方式</span>
        Params     <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-comment">// 提供对路由参数的访问（router.go 中的 getRoute 返回的 params 就存储在这里）</span>
        StatusCode <span class="hljs-type">int</span>               <span class="hljs-comment">// 状态码</span>
}
</code></pre>
<p>这里并没有和中间件相关的内容，因此考虑增加内容来支持具体路由对于中间件的使用。</p>
<p>首先我们可以想到的就是添加一个类似于 <code>RouterGroup</code> 中的 <code>middlewares</code> 类似的数组，用于存储具体路由需要执行的中间件，不难想到可以添加一个下面的属性：</p>
<pre><code class="hljs language-css" lang="css">handlers <span class="hljs-selector-attr">[]</span>HandlerFunc
</code></pre>
<p>那么，除了这个，还需要其他的内容吗？需要，我们还需要一个 <code>index</code> 用于控制中间件的执行过程。那么最终的设计如下：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">struct</span> {
        Writer     http.ResponseWriter
        Req        *http.Request
        Path       <span class="hljs-type">string</span>            <span class="hljs-comment">// 请求资源路径</span>
        Method     <span class="hljs-type">string</span>            <span class="hljs-comment">// 请求方式</span>
        Params     <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-comment">// 提供对路由参数的访问（router.go 中的 getRoute 返回的 params 就存储在这里）</span>
        StatusCode <span class="hljs-type">int</span>               <span class="hljs-comment">// 状态码</span>
        <span class="hljs-comment">// 用于中间件</span>
        handlers []HandlerFunc
        index    <span class="hljs-type">int</span> <span class="hljs-comment">// 用于控制中间件的执行顺序</span>
}
</code></pre>
<p>我们来解释一下这里的 <code>index</code> 具体是干嘛的，介绍这个之前我们现需要了解一下中间件。</p>
<p>对于某些中间件来说，我们需要在事件开始之前启动，事件结束之后才能结束，比如说我们今天要设计的统计执行时间的中间件，而 <strong><code>index</code></strong> <strong>的设计就是为了能够让它们既能在 Handler 之前执行，也能在 Handler 之后“回头执行”。</strong></p>
<p>如果不设计 index 来控制中间件的运行顺序，看一下下面的场景：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-tag">A</span>()
<span class="hljs-selector-tag">B</span>()
<span class="hljs-built_in">Handler</span>()
</code></pre>
<p><code>A</code> 和 <code>B</code> 都是一个中间件，这样的话，你只能在 <code>Handler</code> 之前做事情，比如鉴权、参数校验等。但实际上有很多中间件都的功能都需要等 Handler 执行完之后才能做，比如：</p>
<ul>
<li>统计请求耗时</li>
<li>捕获 panic</li>
<li>打日志（需要拿到最终的状态码）</li>
</ul>
<p>所以现有的结构没法支撑我们做到一层一层包住 <code>Handler</code>。你可以把中间件想象成这样一个结构：</p>
<pre><code class="hljs language-scss" lang="scss">func <span class="hljs-built_in">Middleware</span>(c *Context) {
    <span class="hljs-comment">// 前半段</span>
    c<span class="hljs-selector-class">.Next</span>()
    <span class="hljs-comment">// 后半段</span>
}
</code></pre>
<p>这个结构的重点在于<code>c.Next()</code> ，这里的 <code>Next()</code> 并不是调用下一个函数这么简单，它真正的含义是：</p>
<p><strong>“把执行权交给下一个中间件/Handler，等它们全部执行完，再回来继续执行我后面的代码。”</strong></p>
<p>这在普通的函数调用中是做不到的，因此为了做到这一点，为了实现 <code>Next()</code>，我们必须：</p>
<ul>
<li>
<p>把 <strong>所有中间件 + Handler</strong> 放进一个列表（<code>c.handlers</code>）</p>
</li>
<li>
<p>用一个 <code>index</code> 记录“现在执行到第几个”</p>
</li>
<li>
<p>通过 <code>Next()</code> 手动推进这个执行链</p>
</li>
</ul>
<p>最后用一个具体的例子来理解一下，假设我们有这样一个中间件的调用：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> -&gt; <span class="hljs-selector-tag">B</span> -&gt; Handler
</code></pre>
<p>那么底层的执行顺序应该是：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> 前
  <span class="hljs-selector-tag">B</span> 前
    Handler
  <span class="hljs-selector-tag">B</span> 后
<span class="hljs-selector-tag">A</span> 后
</code></pre>
<p>这不是普通的“顺序调用”， 而是一个<strong>人为构造的调用栈</strong>。</p>
<p><code>Context.handlers + index + Next()</code> 就是在 <strong>模拟函数调用栈的展开与回收</strong>。</p>
<p>我在理解这部分的时候的困难是：<strong>我忘记了自己在编写一个框架，而不是一个框架的使用者。</strong> 因为框架本身就是为了便于开发，隐去一些不必要的或者重复的逻辑。那作为开发者（或者说框架的使用者），我在开发使用中间件的时候，我知道中间件应该包含Handler，我知道直接使用 <code>A -&gt; B -&gt; Handler</code> 就应该是类似于栈的执行顺序，其他框架直接这么用也是没问题的（底层会包含Handler），这是大家都通用的，因此我（框架使用者）这么用应该是没问题的。因此，框架需要完成从 <code>A -&gt; B -&gt; Handler</code> 到 <code>A 前-&gt;B 前-&gt;Handler-&gt;B 后-&gt;A 后</code>，需要支持大家的使用习惯，同时框架的设计也该如此。因此，我们要引入 <code>index</code>，我们要在框架层面完成从顺序调用到人为构造一个调用栈的转换。</p>
<h4 data-id="heading-1">Next() 的设计</h4>
<p>我们先看<code>Next()</code>的具体实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newContext</span><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span> *Context {
        <span class="hljs-keyword">return</span> &amp;Context{
                Writer: w,
                Req:    req,
                Path:   req.URL.Path,
                Method: req.Method,
                index:  <span class="hljs-number">-1</span>, <span class="hljs-comment">// Context 定义多了一个 index，所以初始化的时候也不要忘了</span>
        }
}


<span class="hljs-comment">// Next 用于控制中间件的执行顺序，调用后会将控制权交给下一个中间件</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> Next() {
        c.index++
        s := <span class="hljs-built_in">len</span>(c.handlers)
        <span class="hljs-keyword">for</span> ; c.index &lt; s; c.index++ {
                c.handlers[c.index](c)
        }
}
</code></pre>
<p>我们先理解如何通过一个数组和一个索引来实现中间件的控制的，通过模拟一次真实的执行来理解。假设某路由需要执行 2 个中间件：A，B。</p>
<p>作为开发者（框架使用者），我们会这样写：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-tag">A</span>(c)
<span class="hljs-selector-tag">B</span>(c)
<span class="hljs-built_in">H</span>(c) <span class="hljs-comment">// Handler</span>
</code></pre>
<p>它们被放进一个数组：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">handlers</span> = [A, B, H]
<span class="hljs-attr">index</span> = -<span class="hljs-number">1</span>
</code></pre>
<p>现在开始执行。</p>
<h5 data-id="heading-2">第一步</h5>
<p>首先框架会调用 <code>c.Next()</code>：</p>
<pre><code class="hljs language-scss" lang="scss">c<span class="hljs-selector-class">.Next</span>()
</code></pre>
<p>为什么需要先调用 <code>c.Next()</code>呢，原因是：</p>
<ul>
<li><strong>启动执行链</strong>：框架需要主动启动中间件链的执行，这样才能确保中间件按照正确顺序执行。</li>
<li><strong>生命周期管理</strong>：框架控制整个请求的生命周期，<strong>从接收请求到执行中间件，再到最终返回响应</strong>，中间件链的启动必须由框架</li>
</ul>
<p>至于具体在框架的哪个位置调用 <code>c.Next()</code>，待会会实现。</p>
<p>调用 <code>Next</code> 之后，进入内部代码：</p>
<pre><code class="hljs language-scss" lang="scss">index++        <span class="hljs-comment">// index = 0</span>
handlers<span class="hljs-selector-attr">[0]</span>(c) <span class="hljs-comment">// 调用 A</span>
</code></pre>
<p>注意：现在还在 <code>Next()</code> 里面，只是 <code>Next</code> 调用了 <code>A</code>。</p>
<h5 data-id="heading-3">第二步</h5>
<p>进入中间件 A 内部：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">A</span><span class="hljs-params">(c)</span></span> {
    part1
    c.Next()
    part2
}
</code></pre>
<p>先执行 <code>part1</code>，然后再次调用 <code>c.Next()</code>。</p>
<h5 data-id="heading-4">第三步</h5>
<p>再次进入 <code>Next</code>，注意这次是从 <code>A</code> 内部进入的 <code>Next</code>：</p>
<pre><code class="hljs language-scss" lang="scss">index++        <span class="hljs-comment">// index = 1</span>
handlers<span class="hljs-selector-attr">[1]</span>(c) <span class="hljs-comment">// 调用 B</span>
</code></pre>
<p>此时：</p>
<ul>
<li>第一次 Next 还没结束</li>
<li>A 也还没结束（part2 还未执行）</li>
<li>又进入了第二层 Next</li>
</ul>
<p>这是<strong>普通函数调用栈嵌套</strong>。</p>
<h5 data-id="heading-5">第四步</h5>
<p>进入 <code>B</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">B</span><span class="hljs-params">(c)</span></span> {
    part3
    c.Next()
    part4
}
</code></pre>
<p>执行 <code>part3</code>，再调用 <code>c.Next()</code>。</p>
<h5 data-id="heading-6">第五步</h5>
<p>第三次进入 <code>Next</code>：</p>
<pre><code class="hljs language-scss" lang="scss">index++        <span class="hljs-comment">// index = 2</span>
handlers<span class="hljs-selector-attr">[2]</span>(c) <span class="hljs-comment">// 调用 H</span>
</code></pre>
<p>进入 Handler。</p>
<h5 data-id="heading-7">第六步</h5>
<p>Handler 没有调用 <code>Next()</code>，所以它直接 return。</p>
<h5 data-id="heading-8">第七步</h5>
<p>程序开始<strong>回退调用栈</strong>：</p>
<ol>
<li>从 Handler 返回到 B</li>
<li>执行 <code>part4</code></li>
<li>B 执行完，返回到 A</li>
<li>执行 <code>part2</code></li>
<li>A 执行完，返回到最初的 Next</li>
<li>整个请求结束</li>
</ol>
<p>这部分很好理解，其实就是递归，一层一层回退。</p>
<h5 data-id="heading-9">最终执行顺序</h5>
<p>所以，最终的执行顺序是：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span><span class="hljs-selector-class">.part1</span>
<span class="hljs-selector-tag">B</span><span class="hljs-selector-class">.part3</span>
H
<span class="hljs-selector-tag">B</span><span class="hljs-selector-class">.part4</span>
<span class="hljs-selector-tag">A</span><span class="hljs-selector-class">.part2</span>
</code></pre>
<hr/>
<p>走完整个流程后我们可以看到，确实实现了：</p>
<blockquote>
<p><strong>中间件不是“按顺序执行”，</strong> <strong>而是“按调用栈展开、再按调用栈回收”。</strong></p>
</blockquote>
<hr/>
<p>最后，还需要解释一下 <code>Next()</code> 内部为什么要用一个循环：</p>
<pre><code class="hljs language-scss" lang="scss">func (c *Context) <span class="hljs-built_in">Next</span>() {
        c<span class="hljs-selector-class">.index</span>++
        s := <span class="hljs-built_in">len</span>(c.handlers)
        for ; c<span class="hljs-selector-class">.index</span> &lt; s; c<span class="hljs-selector-class">.index</span>++ {
                c<span class="hljs-selector-class">.handlers</span><span class="hljs-selector-attr">[c.index]</span>(c)
        }
}
</code></pre>
<p>而不是：</p>
<pre><code class="hljs language-scss" lang="scss">func (c *Context) <span class="hljs-built_in">Next</span>() {
        c<span class="hljs-selector-class">.index</span>++
        c<span class="hljs-selector-class">.handlers</span><span class="hljs-selector-attr">[c.index]</span>(c)
}
</code></pre>
<p>这是因为，有些 <code>handler</code> 并不会调用 <code>Next()</code>，就比如我们上面模拟的过程，最后一步的 <code>handler</code> 没有调用 <code>Next()</code>，如果出现多个 <code>handler</code> 一起调用的情况，此时不用循环就无法推进下去了。</p>
<p>一句话总结就是，<code>for</code> 是为了兜底推进，确保可以执行到底把流程走完。</p>
<p>所以总结一下：</p>
<p><code>Next()</code> 是为了提供一种灵活的控制流，让每个中间件不仅能够在前置逻辑（请求前）执行，还能在后置逻辑（请求后）进行处理。</p>
<p><code>index</code> 不仅仅是控制顺序，实际上它还模拟了一个状态机的行为，可以理解为是“中间件栈”的索引。</p>
<p>在中间件的设计中，<code>Next()</code> 的作用类似于函数调用栈的行为。当调用 <code>Next()</code> 时，程序会依次执行每个中间件，类似于函数调用栈的“展开”。一旦当前中间件执行完成，它会回到上一级中间件继续执行未完成的部分，直到整个栈被“回收”。这种设计让中间件不仅可以在请求处理的前半部分执行逻辑（例如：请求参数校验），也可以在后半部分执行一些收尾操作（例如：统计请求耗时或记录日志）。通过 <code>Next()</code> 和 <code>index</code> 的结合，模拟了一个执行顺序严格控制的栈结构，从而使中间件可以灵活地在请求生命周期的前后两部分完成各自的功能。</p>
<hr/>
<h4 data-id="heading-10">代码实现</h4>
<p>通过上面的讲解，我们已经知道了如何做到对中间件的支持。接下来还需要对框架中的一些函数进行修改。</p>
<p>首先我们要在 <code>gee.go</code> 中定义一个 <code>Use</code> 函数，将中间件注册到某个 Group：</p>
<pre><code class="hljs language-scss" lang="scss">func (group *RouterGroup) <span class="hljs-built_in">Use</span>(middlewares ...HandlerFunc) {
        group<span class="hljs-selector-class">.middlewares</span> = <span class="hljs-built_in">append</span>(group.middlewares, middlewares...)
}
</code></pre>
<p>这个函数实际上就是给某个路由分组添加其可能需要用到的中间件。这里需要注意是对 <code>RouterGroup.middlewares</code> 进行操作，而不是对 <code>Context.handlers</code> 进行操作。前者用于存储该路由分组下所有可能用到的中间件，而后者用于实现中间件的流程控制，即可以存储中间件，也可以存储实际需要调用的函数 handlers。</p>
<hr/>
<p>同时，我们还需要对 <code>gee.go</code> 中的 <code>ServerHTTP</code> 进行修改：</p>
<pre><code class="hljs language-scss" lang="scss">func (engine *Engine) <span class="hljs-built_in">ServeHTTP</span>(w http.ResponseWriter, req *http.Request) {
        <span class="hljs-comment">// 这部分逻辑用于判断传入的路径所属的 group 包含哪些中间件</span>
        <span class="hljs-selector-tag">var</span> middlewares <span class="hljs-selector-attr">[]</span>HandlerFunc
        for _, group := range engine.groups {
                <span class="hljs-comment">// 如果传入路径包含某个 group 的 prefix（前缀），说明传入的路径属于这个 group，那么这个 group 所包含的全部的中间件就都需要应用于该请求路径</span>
                if strings<span class="hljs-selector-class">.HasPrefix</span>(req.URL.Path, group.prefix) {
                        middlewares = <span class="hljs-built_in">append</span>(middlewares, group.middlewares...)
                }
        }
        c := <span class="hljs-built_in">newContext</span>(w, req)
        c.handlers = middlewares // 前面 for 循环找出了该请求路径下需要的全部中间件 middlewares，把这个加入到 Context.handlers，之后就可以根据 Context.handlers 来执行具体的中间件了
        engine.router.<span class="hljs-built_in">handle</span>(c)
}
</code></pre>
<p>当我们接收到一个具体请求时，要判断该请求适用于哪些中间件，在这里我们简单通过 URL 的前缀来判断。得到中间件列表后，赋值给 <code>c.handlers</code>。</p>
<p>最后，我们还需要对 <code>router.go</code> 中的 <code>handle</code> 函数进行修改：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 根据 Context 查找 handler 并调用</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *router)</span></span> handle(c *Context) {
        n, params := r.getRoute(c.Method, c.Path)
        <span class="hljs-keyword">if</span> n != <span class="hljs-literal">nil</span> {
                c.Params = params
                key := c.Method + <span class="hljs-string">"-"</span> + n.pattern
                <span class="hljs-comment">//r.handlers[key](c)</span>
                c.handlers = <span class="hljs-built_in">append</span>(c.handlers, r.handlers[key]) <span class="hljs-comment">// 修改 1</span>
        } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 修改 2</span>
                c.handlers = <span class="hljs-built_in">append</span>(c.handlers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *Context)</span></span> {
                        c.String(http.StatusNotFound, <span class="hljs-string">"404 NOT FOUND: &amp;s\n"</span>, c.Path)
                })
        }
        c.Next() <span class="hljs-comment">// 修改 3</span>
}
</code></pre>
<p>主要修改的部分在代码中标注出来了，其实就是将两个处理都加到 Context.handlers 中。这里更多的是告诉我们：对于这种错误处理之类的代码，完全可以提取出来作为一个中间件进行处理。这里的处理并不是最终的实现，最终的实现应该是将错误处理、日志记录等功能提取成 <strong>独立的中间件函数</strong>，然后通过框架的中间件机制将它们自动应用到请求处理流程中。</p>
<h4 data-id="heading-11">使用 Demo 测试</h4>
<p>首先在 <code>gee</code> 文件夹下添加一个中间件<code>logger.go</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> gee

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"log"</span>
        <span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Logger</span><span class="hljs-params">()</span></span> HandlerFunc {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *Context)</span></span> {
                <span class="hljs-comment">// 开始计时</span>
                t := time.Now()
                <span class="hljs-comment">// 处理请求</span>
                c.Next()
                <span class="hljs-comment">// 计算时间</span>
                log.Printf(<span class="hljs-string">"[%d] %s in %v"</span>, c.StatusCode, c.Req.RequestURI, time.Since(t))
        }
}
</code></pre>
<p>接下来在 <code>main.go</code> 编写测试 demo：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"gee"</span>
        <span class="hljs-string">"log"</span>
        <span class="hljs-string">"net/http"</span>
        <span class="hljs-string">"time"</span>
)

<span class="hljs-comment">// 自定义中间件</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onlyForV2</span><span class="hljs-params">()</span></span> gee.HandlerFunc {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                <span class="hljs-comment">// Start timer</span>
                t := time.Now()
                <span class="hljs-comment">// if a server error occurred</span>
                <span class="hljs-comment">//c.Fail(500, "Internal Server Error")</span>
                <span class="hljs-comment">// Calculate resolution time</span>
                log.Printf(<span class="hljs-string">"[%d] %s in %v for group v2"</span>, c.StatusCode, c.Req.RequestURI, time.Since(t))
        }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
        r := gee.New()
        r.Use(gee.Logger()) <span class="hljs-comment">// global middleware</span>
        r.GET(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                c.HTML(http.StatusOK, <span class="hljs-string">"&lt;h1&gt;Hello Gee&lt;/h1&gt;"</span>)
        })

        v2 := r.Group(<span class="hljs-string">"/v2"</span>)
        v2.Use(onlyForV2()) <span class="hljs-comment">// v2 group middleware</span>
        {
                v2.GET(<span class="hljs-string">"/hello/:name"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                        <span class="hljs-comment">// expect /hello/geektutu</span>
                        c.String(http.StatusOK, <span class="hljs-string">"hello %s, you're at %s\n"</span>, c.Param(<span class="hljs-string">"name"</span>), c.Path)
                })
        }

        r.Run(<span class="hljs-string">":9999"</span>)
}
</code></pre>
<p>运行代码，然后在终端进行测试，可以看到终端确实输出了响应时间相关代码。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f37a77a63974be7b2bddeb526f13a32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2F5MnRvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568174&amp;x-signature=3kYvKjz%2F%2B3ALBo9Nw%2FYXBoZxctk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d78b97577e2487886191ecb90626ba5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2F5MnRvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568174&amp;x-signature=dCMOZz3DHPGP5bpW8Fgi3Pa8Bn0%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[低成本玩转鸿蒙容器的丐版方案]]></title>    <link>https://juejin.cn/post/7593240931286286388</link>    <guid>https://juejin.cn/post/7593240931286286388</guid>    <pubDate>2026-01-09T15:21:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593240931286286388" data-draft-id="7593338828195528744" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="低成本玩转鸿蒙容器的丐版方案"/> <meta itemprop="keywords" content="Docker,HarmonyOS"/> <meta itemprop="datePublished" content="2026-01-09T15:21:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hqzing"/> <meta itemprop="url" content="https://juejin.cn/user/2784422731986295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            低成本玩转鸿蒙容器的丐版方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2784422731986295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hqzing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:21:37.000Z" title="Fri Jan 09 2026 15:21:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>前段时间我发布了《<a href="https://juejin.cn/post/7575112613778145314" target="_blank" title="https://juejin.cn/post/7575112613778145314">介绍一个容器化的鸿蒙环境</a>》这篇文章，介绍了我制作的一个鸿蒙容器。</p>
<p>经过宣传，有一些用户下载体验了这个项目，我也收集到了一些反馈。其中有一项是成本问题：部分用户（例如大学生）可能没有条件去现买一个 arm64 服务器，或者没有条件去长时间供养它。</p>
<p>为了照顾到这类用户，我整理了一个“极低成本最小可用方案”（也可以说是丐版方案）。以牺牲性能为代价，可以在已有的 x64 服务器、WSL 或  Docker Desktop 里面运行这个鸿蒙容器，而无需另外购置 arm64 服务器。</p>
<h2 data-id="heading-1">x64 服务器操作流程</h2>
<p>接下来我将使用一台位于中国大陆内（华为云 西南-贵阳一）的 Ubuntu 24.04 x64 服务器进行演示。</p>
<p>专门挑选这个 Region 是为了能顺便展示如何在网络条件不佳的情况下如何走通全流程，这是中国大陆内的服务器很容易遇到的问题。</p>
<p><strong>1. 安装 Docker</strong></p>
<p>由于我这台服务器是全新的，所以我首先要安装 Docker。</p>
<p>我使用（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSuperManito%2FLinuxMirrors" target="_blank" title="https://github.com/SuperManito/LinuxMirrors" ref="nofollow noopener noreferrer">LinuxMirrors</a>）的脚本来进行安装：</p>
<pre><code class="hljs language-sh" lang="sh">bash &lt;(curl -sSL https://linuxmirrors.cn/docker.sh)

<span class="hljs-comment"># 以下是我做的配置</span>
<span class="hljs-comment"># Docker CE 源：华为云</span>
<span class="hljs-comment"># Docker CE 源的网络地址：公网</span>
<span class="hljs-comment"># Docker Registry 源：毫秒镜像</span>
<span class="hljs-comment"># Docker CE 软件源的网络协议：HTTP</span>
<span class="hljs-comment"># Docker Engine 是否安装最新版本：是</span>
</code></pre>
<p><strong>2. 注册 QEMU 解释器</strong></p>
<p>接下来向 Linux 内核注册 QEMU 解释器，这能让它支持在 x64 服务器上运行 arm64 容器</p>
<pre><code class="hljs language-sh" lang="sh">docker run --<span class="hljs-built_in">rm</span> --privileged tonistiigi/binfmt --install arm64
</code></pre>
<p>有几个注意事项：</p>
<ol>
<li>每次重启服务器都需要重新执行一遍这个命令，重新注册。</li>
<li>这个操作是全局生效的，不仅影响 Docker，还影响整个系统。注册完之后你可以在 x64 机器上直接执行 arm64 的二进制，无论是在 Docker 里面还是在宿主机上都是可以的。</li>
<li>在网络连通性方面，由于我前面装 Docker 的时候已经配了国内的 Docker Registry 源（毫秒镜像）了，所以我能够很顺利地拉取 <code>tonistiigi/binfmt</code> 这个镜像。如果你没配 Docker Registry 源，你得稍微等久一些。如果完全无法下载，那你需要自己配一个国内的 Docker Registry 源。</li>
</ol>
<p><strong>3. 拉取鸿蒙容器并运行</strong></p>
<p>拉取鸿蒙容器并运行</p>
<pre><code class="hljs language-sh" lang="sh">docker run --name=ohos -itd --platform linux/arm64 hqzing/docker-mini-openharmony:latest
</code></pre>
<p>我这里的镜像名字没有填 <code>ghcr.io/hqzing/docker-mini-openharmony:latest</code>，而是填了  <code>hqzing/docker-mini-openharmony:latest</code>。</p>
<p>我的原始镜像是放在 ghcr（GitHub Container Registry）上面的，中国大陆内的服务器拉取这个镜像可能会很慢或不通。为了方便中国大陆内的服务器拉取，我把镜像也往 Docker Hub 传了一份，如此一来用户便可以通过国内的 Docker Registry 源来拉取到它了。</p>
<p><strong>4. 下载软件体验一下</strong></p>
<p>随便下载个我移植好的软件体验一下，比如 neovim 编辑器</p>
<pre><code class="hljs language-sh" lang="sh">docker <span class="hljs-built_in">exec</span> -it ohos sh

<span class="hljs-built_in">cd</span> /root
curl -L -O https://ghfast.top/https://github.com/Harmonybrew/ohos-neovim/releases/download/0.11.4/neovim-0.11.4-ohos-arm64.tar.gz
tar -zxf neovim-0.11.4-ohos-arm64.tar.gz -C /opt
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/opt/neovim-0.11.4-ohos-arm64/bin

<span class="hljs-comment"># 现在可以使用 nvim 命令了</span>
</code></pre>
<p>注意看，我在原始的下载链接前面加了一个 <code>https://ghfast.top</code> 的前缀。这是为了使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fghfast.top%2F" target="_blank" title="https://ghfast.top/" ref="nofollow noopener noreferrer">ghfast.top</a> 的加速下载服务，以解决中国大陆内的服务器拉取 GitHub 资源速度慢/访问不通的问题。</p>
<h2 data-id="heading-2">WSL 和 Docker Desktop</h2>
<p>如果你用的是 WSL，就直接按 x64 服务器的流程进行操作即可，不需要做任何改动。</p>
<p>如果你用的是 Docker Desktop，操作流程跟上面是有一点出入，比如不用自己装 Docker、比如可以在图形界面里面换源，但运行容器的命令不变。</p>
<p>关于 Docker Desktop，我要提一下它的多架构镜像支持。</p>
<p>在正常情况下，最新版本的 Docker Desktop  默认就支持运行不同架构的镜像。它的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2Fbuild%2Fbuilding%2Fmulti-platform%2F%23qemu" target="_blank" title="https://docs.docker.com/build/building/multi-platform/#qemu" ref="nofollow noopener noreferrer">官方文档</a> 是这么说的：</p>
<blockquote>
<p>Docker Desktop supports running and building multi-platform images under emulation by default.</p>
</blockquote>
<p>所以你可以尝试直接执行 <code>docker run --name=ohos -itd --platform linux/arm64 hqzing/docker-mini-openharmony:latest</code> 命令来拉起容器。我在自己的电脑上试了，确实是能正常工作的。</p>
<p>在不正常情况下（可能跟具体的环境或配置有关），如果你发现它在你的电脑上不支持运行 arm64 容器，那你仍需要像在服务器上一样，先执行一遍 <code>docker run --rm --privileged tonistiigi/binfmt --install arm64</code> 命令进行 QEMU 的注册。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用FastAPI 一个 后端 和 两个前端 原生HTML/CSS/JS 、Vue3 写一个博客系统 例]]></title>    <link>https://juejin.cn/post/7593338828195545128</link>    <guid>https://juejin.cn/post/7593338828195545128</guid>    <pubDate>2026-01-09T15:23:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195545128" data-draft-id="7593193235251445812" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用FastAPI 一个 后端 和  两个前端 原生HTML/CSS/JS 、Vue3 写一个博客系统 例"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-09T15:23:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PieroPC"/> <meta itemprop="url" content="https://juejin.cn/user/1998231182522521"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用FastAPI 一个 后端 和  两个前端 原生HTML/CSS/JS 、Vue3 写一个博客系统 例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1998231182522521/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PieroPC
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:23:58.000Z" title="Fri Jan 09 2026 15:23:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">后端：</h2>
<pre><code class="hljs language-js" lang="js">├── backend/
│   ├── main.<span class="hljs-property">py</span>          # <span class="hljs-title class_">FastAPI</span> 后端
│   ├── models.<span class="hljs-property">py</span>        # 数据模型
│   ├── database.<span class="hljs-property">py</span>      # 数据库/状态管理
│   └── requirements.<span class="hljs-property">txt</span>
</code></pre>
<h3 data-id="heading-1">main.py</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException
<span class="hljs-keyword">from</span> fastapi.middleware.cors <span class="hljs-keyword">import</span> CORSMiddleware
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>
<span class="hljs-keyword">import</span> uvicorn

<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> BlogPost
<span class="hljs-keyword">from</span> database <span class="hljs-keyword">import</span> BlogDatabase

<span class="hljs-comment"># 创建 FastAPI 应用</span>
app = FastAPI(
    title=<span class="hljs-string">"博客系统 API"</span>,
    description=<span class="hljs-string">"一个简单的博客系统后端"</span>,
    version=<span class="hljs-string">"1.0.0"</span>
)

<span class="hljs-comment"># 添加 CORS 中间件</span>
app.add_middleware(
    CORSMiddleware,
    allow_origins=[<span class="hljs-string">"*"</span>],  <span class="hljs-comment"># 在生产环境中应该指定具体域名</span>
    allow_credentials=<span class="hljs-literal">True</span>,
    allow_methods=[<span class="hljs-string">"*"</span>],
    allow_headers=[<span class="hljs-string">"*"</span>],
)

<span class="hljs-comment"># 初始化数据库</span>
db = BlogDatabase()

<span class="hljs-comment"># API 路由</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">root</span>():
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"message"</span>: <span class="hljs-string">"欢迎访问博客系统 API"</span>,
        <span class="hljs-string">"docs"</span>: <span class="hljs-string">"/docs"</span>,
        <span class="hljs-string">"endpoints"</span>: {
            <span class="hljs-string">"获取所有文章"</span>: <span class="hljs-string">"GET /api/posts"</span>,
            <span class="hljs-string">"获取单篇文章"</span>: <span class="hljs-string">"GET /api/posts/{id}"</span>,
            <span class="hljs-string">"创建文章"</span>: <span class="hljs-string">"POST /api/posts"</span>,
            <span class="hljs-string">"更新文章"</span>: <span class="hljs-string">"PUT /api/posts/{id}"</span>,
            <span class="hljs-string">"删除文章"</span>: <span class="hljs-string">"DELETE /api/posts/{id}"</span>
        }
    }

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/api/posts"</span>, response_model=<span class="hljs-type">List</span>[BlogPost]</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all_posts</span>():
    <span class="hljs-string">"""获取所有博客文章"""</span>
    <span class="hljs-keyword">return</span> db.get_all_posts()

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/api/posts/{post_id}"</span>, response_model=BlogPost</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_post</span>(<span class="hljs-params">post_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-string">"""根据ID获取博客文章"""</span>
    post = db.get_post(post_id)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> post:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"文章不存在"</span>)
    <span class="hljs-keyword">return</span> post

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/api/posts"</span>, response_model=BlogPost</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_post</span>(<span class="hljs-params">post: BlogPost</span>):
    <span class="hljs-string">"""创建新博客文章"""</span>
    <span class="hljs-keyword">return</span> db.create_post(post.<span class="hljs-built_in">dict</span>())

<span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">"/api/posts/{post_id}"</span>, response_model=BlogPost</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_post</span>(<span class="hljs-params">post_id: <span class="hljs-built_in">int</span>, post: BlogPost</span>):
    <span class="hljs-string">"""更新博客文章"""</span>
    updated = db.update_post(post_id, post.<span class="hljs-built_in">dict</span>())
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> updated:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"文章不存在"</span>)
    <span class="hljs-keyword">return</span> updated

<span class="hljs-meta">@app.delete(<span class="hljs-params"><span class="hljs-string">"/api/posts/{post_id}"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_post</span>(<span class="hljs-params">post_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-string">"""删除博客文章"""</span>
    <span class="hljs-keyword">if</span> db.delete_post(post_id):
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"文章删除成功"</span>}
    <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"文章不存在"</span>)

<span class="hljs-comment"># 健康检查端点</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/health"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">health_check</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"status"</span>: <span class="hljs-string">"healthy"</span>, <span class="hljs-string">"posts_count"</span>: <span class="hljs-built_in">len</span>(db.get_all_posts())}

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    uvicorn.run(
        <span class="hljs-string">"main:app"</span>,
        host=<span class="hljs-string">"0.0.0.0"</span>,
        port=<span class="hljs-number">8000</span>,
        reload=<span class="hljs-literal">True</span>
    )

</code></pre>
<h3 data-id="heading-2">models.py</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogPost</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">int</span>] = <span class="hljs-literal">None</span>
    title: <span class="hljs-built_in">str</span>
    content: <span class="hljs-built_in">str</span>
    author: <span class="hljs-built_in">str</span>
    created_at: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>
    updated_at: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>

</code></pre>
<h3 data-id="heading-3">database.py</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Optional</span>
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> BlogPost

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogDatabase</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.posts = []
        self.post_id_counter = <span class="hljs-number">1</span>
        self.init_sample_data()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_sample_data</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""初始化示例数据"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.posts:
            sample_posts = [
                BlogPost(
                    <span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>,
                    title=<span class="hljs-string">"欢迎来到我的博客"</span>,
                    content=<span class="hljs-string">"这是我的第一篇博客文章，欢迎阅读！"</span>,
                    author=<span class="hljs-string">"管理员"</span>,
                    created_at=<span class="hljs-string">"2024-01-01 10:00:00"</span>,
                    updated_at=<span class="hljs-string">"2024-01-01 10:00:00"</span>
                ),
                BlogPost(
                    <span class="hljs-built_in">id</span>=<span class="hljs-number">2</span>,
                    title=<span class="hljs-string">"NiceGUI 3.X 新特性介绍"</span>,
                    content=<span class="hljs-string">"NiceGUI 3.X 带来了很多令人兴奋的新特性..."</span>,
                    author=<span class="hljs-string">"技术达人"</span>,
                    created_at=<span class="hljs-string">"2024-01-02 14:30:00"</span>,
                    updated_at=<span class="hljs-string">"2024-01-02 14:30:00"</span>
                ),
                BlogPost(
                    <span class="hljs-built_in">id</span>=<span class="hljs-number">3</span>,
                    title=<span class="hljs-string">"Python Web开发趋势"</span>,
                    content=<span class="hljs-string">"近年来，Python在Web开发领域发展迅速..."</span>,
                    author=<span class="hljs-string">"Python爱好者"</span>,
                    created_at=<span class="hljs-string">"2024-01-03 09:15:00"</span>,
                    updated_at=<span class="hljs-string">"2024-01-03 09:15:00"</span>
                )
            ]
            
            <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> sample_posts:
                self.posts.append(post.<span class="hljs-built_in">dict</span>())
            self.post_id_counter = <span class="hljs-number">4</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all_posts</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:
        <span class="hljs-string">"""获取所有文章"""</span>
        <span class="hljs-keyword">return</span> self.posts
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_post</span>(<span class="hljs-params">self, post_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-type">Dict</span>]:
        <span class="hljs-string">"""根据ID获取文章"""</span>
        <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> self.posts:
            <span class="hljs-keyword">if</span> post[<span class="hljs-string">"id"</span>] == post_id:
                <span class="hljs-keyword">return</span> post
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_post</span>(<span class="hljs-params">self, post_data: <span class="hljs-type">Dict</span></span>) -&gt; <span class="hljs-type">Dict</span>:
        <span class="hljs-string">"""创建新文章"""</span>
        post = BlogPost(**post_data)
        post.<span class="hljs-built_in">id</span> = self.post_id_counter
        post.created_at = datetime.now().strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>)
        post.updated_at = post.created_at
        
        post_dict = post.<span class="hljs-built_in">dict</span>()
        self.posts.append(post_dict)
        self.post_id_counter += <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> post_dict
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_post</span>(<span class="hljs-params">self, post_id: <span class="hljs-built_in">int</span>, post_data: <span class="hljs-type">Dict</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-type">Dict</span>]:
        <span class="hljs-string">"""更新文章"""</span>
        <span class="hljs-keyword">for</span> i, existing_post <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.posts):
            <span class="hljs-keyword">if</span> existing_post[<span class="hljs-string">"id"</span>] == post_id:
                post_data[<span class="hljs-string">"id"</span>] = post_id
                post_data[<span class="hljs-string">"created_at"</span>] = existing_post[<span class="hljs-string">"created_at"</span>]
                post_data[<span class="hljs-string">"updated_at"</span>] = datetime.now().strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>)
                
                self.posts[i] = post_data
                <span class="hljs-keyword">return</span> post_data
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_post</span>(<span class="hljs-params">self, post_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""删除文章"""</span>
        <span class="hljs-keyword">for</span> i, post <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.posts):
            <span class="hljs-keyword">if</span> post[<span class="hljs-string">"id"</span>] == post_id:
                self.posts.pop(i)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

</code></pre>
<h3 data-id="heading-4">requirements.txt</h3>
<pre><code class="hljs language-python" lang="python">fastapi==<span class="hljs-number">0.104</span><span class="hljs-number">.1</span>
uvicorn==<span class="hljs-number">0.24</span><span class="hljs-number">.0</span>
pydantic==<span class="hljs-number">2.5</span><span class="hljs-number">.0</span>
python-multipart==<span class="hljs-number">0.0</span><span class="hljs-number">.6</span>

</code></pre>
<blockquote>
<p><strong>启动后端服务器 python main.py</strong></p>
</blockquote>
<h2 data-id="heading-5">Html/css/js 前端</h2>
<pre><code class="hljs language-js" lang="js">blog_system/

├── frontend/
│   ├── index.<span class="hljs-property">html</span>       # 主页面
│   ├── css/
│   │   └── style.<span class="hljs-property">css</span>    # 样式文件
│   └── js/
│       ├── app.<span class="hljs-property">js</span>       # 主应用逻辑
│       ├── api.<span class="hljs-property">js</span>       # <span class="hljs-variable constant_">API</span> 调用封装
│       └── ui.<span class="hljs-property">js</span>        # <span class="hljs-variable constant_">UI</span> 组件

</code></pre>
<h3 data-id="heading-6">frontend/index.html</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>博客系统<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"css/style.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&amp;display=swap"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/marked/marked.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 导航栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-brand"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-blog"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>博客系统<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-links"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"showPage('home')"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-home"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 首页
                <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"showPage('manage')"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-tasks"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 管理
                <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-success"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"showPage('create')"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-plus"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 写文章
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-toggle-theme"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"toggleTheme()"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-moon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 主内容区域 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"main-content"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 首页内容将通过JavaScript动态加载 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 模态框容器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"modal-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 加载指示器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading-overlay"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"loading-overlay"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- JavaScript文件 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/api.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/ui.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 初始化应用</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">initApp</span>();
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<h3 data-id="heading-7">frontend/css/style.css</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 基础样式 */</span>
<span class="hljs-selector-pseudo">:root</span> {
    <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#3b82f6</span>;
    <span class="hljs-attr">--primary-dark</span>: <span class="hljs-number">#2563eb</span>;
    <span class="hljs-attr">--secondary-color</span>: <span class="hljs-number">#6b7280</span>;
    <span class="hljs-attr">--success-color</span>: <span class="hljs-number">#10b981</span>;
    <span class="hljs-attr">--danger-color</span>: <span class="hljs-number">#ef4444</span>;
    <span class="hljs-attr">--warning-color</span>: <span class="hljs-number">#f59e0b</span>;
    <span class="hljs-attr">--light-color</span>: <span class="hljs-number">#f9fafb</span>;
    <span class="hljs-attr">--dark-color</span>: <span class="hljs-number">#1f2937</span>;
    <span class="hljs-attr">--border-color</span>: <span class="hljs-number">#e5e7eb</span>;
    <span class="hljs-attr">--shadow-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
    <span class="hljs-attr">--card-bg</span>: <span class="hljs-number">#ffffff</span>;
    <span class="hljs-attr">--body-bg</span>: <span class="hljs-number">#f3f4f6</span>;
    <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#374151</span>;
}

<span class="hljs-selector-attr">[data-theme=<span class="hljs-string">"dark"</span>]</span> {
    <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#60a5fa</span>;
    <span class="hljs-attr">--primary-dark</span>: <span class="hljs-number">#3b82f6</span>;
    <span class="hljs-attr">--secondary-color</span>: <span class="hljs-number">#9ca3af</span>;
    <span class="hljs-attr">--success-color</span>: <span class="hljs-number">#34d399</span>;
    <span class="hljs-attr">--danger-color</span>: <span class="hljs-number">#f87171</span>;
    <span class="hljs-attr">--warning-color</span>: <span class="hljs-number">#fbbf24</span>;
    <span class="hljs-attr">--light-color</span>: <span class="hljs-number">#374151</span>;
    <span class="hljs-attr">--dark-color</span>: <span class="hljs-number">#111827</span>;
    <span class="hljs-attr">--border-color</span>: <span class="hljs-number">#4b5563</span>;
    <span class="hljs-attr">--shadow-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);
    <span class="hljs-attr">--card-bg</span>: <span class="hljs-number">#1f2937</span>;
    <span class="hljs-attr">--body-bg</span>: <span class="hljs-number">#111827</span>;
    <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#f3f4f6</span>;
}

* {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-tag">body</span> {
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Noto Sans SC'</span>, sans-serif;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--body-bg);
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
    <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span>, color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-comment">/* 导航栏 */</span>
<span class="hljs-selector-class">.navbar</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">color</span>: white;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">var</span>(--shadow-color);
    <span class="hljs-attribute">position</span>: sticky;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000</span>;
}

<span class="hljs-selector-class">.nav-container</span> {
    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: space-between;
    <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-class">.nav-brand</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.nav-brand</span> <span class="hljs-selector-tag">i</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.8rem</span>;
}

<span class="hljs-selector-class">.nav-links</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
}

<span class="hljs-selector-class">.nav-links</span> <span class="hljs-selector-tag">a</span> {
    <span class="hljs-attribute">color</span>: white;
    <span class="hljs-attribute">text-decoration</span>: none;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
    <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.nav-links</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* 按钮样式 */</span>
<span class="hljs-selector-class">.btn</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
    <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">display</span>: inline-flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">text-decoration</span>: none;
}

<span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>);
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">var</span>(--shadow-color);
}

<span class="hljs-selector-class">.btn-primary</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-primary</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-dark);
}

<span class="hljs-selector-class">.btn-success</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--success-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-danger</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--danger-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-secondary</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--secondary-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-outline</span> {
    <span class="hljs-attribute">background-color</span>: transparent;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--primary-color);
}

<span class="hljs-selector-class">.btn-outline</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-toggle-theme</span> {
    <span class="hljs-attribute">background</span>: none;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">color</span>: white;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.btn-toggle-theme</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* 卡片样式 */</span>
<span class="hljs-selector-class">.card</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--card-bg);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">24px</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">var</span>(--shadow-color);
    <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span>, box-shadow <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
}

<span class="hljs-selector-class">.card</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">4px</span>);
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">var</span>(--shadow-color);
}

<span class="hljs-comment">/* 表单样式 */</span>
<span class="hljs-selector-class">.form-group</span> {
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.form-label</span> {
    <span class="hljs-attribute">display</span>: block;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
}

<span class="hljs-selector-class">.form-control</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-built_in">var</span>(--border-color);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">transition</span>: border-color <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--card-bg);
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
}

<span class="hljs-selector-class">.form-control</span><span class="hljs-selector-pseudo">:focus</span> {
    <span class="hljs-attribute">outline</span>: none;
    <span class="hljs-attribute">border-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
}

<span class="hljs-selector-tag">textarea</span><span class="hljs-selector-class">.form-control</span> {
    <span class="hljs-attribute">min-height</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">resize</span>: vertical;
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Noto Sans SC'</span>, sans-serif;
}

<span class="hljs-comment">/* 徽章 */</span>
<span class="hljs-selector-class">.badge</span> {
    <span class="hljs-attribute">display</span>: inline-block;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.85rem</span>;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
}

<span class="hljs-selector-class">.badge-primary</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.badge-success</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--success-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-comment">/* 加载动画 */</span>
<span class="hljs-selector-class">.loading-overlay</span> {
    <span class="hljs-attribute">position</span>: fixed;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
    <span class="hljs-attribute">display</span>: none;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2000</span>;
}

<span class="hljs-selector-class">.spinner</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">5px</span> solid <span class="hljs-built_in">var</span>(--border-color);
    <span class="hljs-attribute">border-top-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">animation</span>: spin <span class="hljs-number">1s</span> linear infinite;
}

<span class="hljs-keyword">@keyframes</span> spin {
    <span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">360deg</span>); }
}

<span class="hljs-comment">/* 模态框 */</span>
<span class="hljs-selector-class">.modal</span> {
    <span class="hljs-attribute">position</span>: fixed;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
    <span class="hljs-attribute">display</span>: none;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1001</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.modal-content</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--card-bg);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">500px</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">max-height</span>: <span class="hljs-number">90vh</span>;
    <span class="hljs-attribute">overflow-y</span>: auto;
}

<span class="hljs-selector-class">.modal-header</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: space-between;
    <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-class">.modal-title</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.modal-close</span> {
    <span class="hljs-attribute">background</span>: none;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--secondary-color);
}

<span class="hljs-selector-class">.modal-body</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.modal-footer</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: flex-end;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-comment">/* 文章列表 */</span>
<span class="hljs-selector-class">.post-list</span> {
    <span class="hljs-attribute">display</span>: grid;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.post-card</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--card-bg);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">24px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
    <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.post-card</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">4px</span>);
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">var</span>(--shadow-color);
}

<span class="hljs-selector-class">.post-title</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
}

<span class="hljs-selector-class">.post-meta</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--secondary-color);
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
}

<span class="hljs-selector-class">.post-content-preview</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">display</span>: -webkit-box;
    -webkit-line-clamp: <span class="hljs-number">3</span>;
    -webkit-box-orient: vertical;
    <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-selector-class">.post-actions</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">15px</span>;
}

<span class="hljs-comment">/* 响应式设计 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
    <span class="hljs-selector-class">.nav-container</span> {
        <span class="hljs-attribute">flex-direction</span>: column;
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
    }
    
    <span class="hljs-selector-class">.nav-links</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">justify-content</span>: center;
        <span class="hljs-attribute">flex-wrap</span>: wrap;
    }
    
    <span class="hljs-selector-class">.container</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
    }
    
    <span class="hljs-selector-class">.post-meta</span> {
        <span class="hljs-attribute">flex-direction</span>: column;
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">5px</span>;
    }
}

</code></pre>
<h3 data-id="heading-8">frontend/js/api.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// API基础配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_BASE_URL</span> = <span class="hljs-string">'http://localhost:8000'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_ENDPOINTS</span> = {
    <span class="hljs-attr">POSTS</span>: <span class="hljs-string">'/api/posts'</span>,
    <span class="hljs-attr">POST</span>: <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> <span class="hljs-string">`/api/posts/<span class="hljs-subst">${id}</span>`</span>
};

<span class="hljs-comment">// 显示/隐藏加载指示器</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showLoading</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loading-overlay'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'flex'</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">hideLoading</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loading-overlay'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
}

<span class="hljs-comment">// 统一的错误处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleApiError</span>(<span class="hljs-params">error</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'API Error:'</span>, error);
    <span class="hljs-keyword">let</span> message = <span class="hljs-string">'网络错误，请稍后重试'</span>;
    
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>) {
        message = error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>?.<span class="hljs-property">detail</span> || <span class="hljs-string">`服务器错误: <span class="hljs-subst">${error.response.status}</span>`</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">request</span>) {
        message = <span class="hljs-string">'无法连接到服务器，请检查网络连接'</span>;
    }
    
    <span class="hljs-title function_">alert</span>(message);
    <span class="hljs-keyword">throw</span> error;
}

<span class="hljs-comment">// 博客API</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">BlogAPI</span> = {
    <span class="hljs-comment">// 获取所有文章</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAllPosts</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">showLoading</span>();
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span><span class="hljs-subst">${API_ENDPOINTS.POSTS}</span>`</span>);
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">handleApiError</span>(error);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">hideLoading</span>();
        }
    },

    <span class="hljs-comment">// 获取单篇文章</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getPost</span>(<span class="hljs-params">id</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">showLoading</span>();
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span><span class="hljs-subst">${API_ENDPOINTS.POST(id)}</span>`</span>);
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">handleApiError</span>(error);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">hideLoading</span>();
        }
    },

    <span class="hljs-comment">// 创建文章</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">createPost</span>(<span class="hljs-params">postData</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">showLoading</span>();
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span><span class="hljs-subst">${API_ENDPOINTS.POSTS}</span>`</span>, {
                <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
                <span class="hljs-attr">headers</span>: {
                    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
                },
                <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(postData)
            });
            
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">handleApiError</span>(error);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">hideLoading</span>();
        }
    },

    <span class="hljs-comment">// 更新文章</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">updatePost</span>(<span class="hljs-params">id, postData</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">showLoading</span>();
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span><span class="hljs-subst">${API_ENDPOINTS.POST(id)}</span>`</span>, {
                <span class="hljs-attr">method</span>: <span class="hljs-string">'PUT'</span>,
                <span class="hljs-attr">headers</span>: {
                    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
                },
                <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(postData)
            });
            
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">handleApiError</span>(error);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">hideLoading</span>();
        }
    },

    <span class="hljs-comment">// 删除文章</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">deletePost</span>(<span class="hljs-params">id</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">showLoading</span>();
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span><span class="hljs-subst">${API_ENDPOINTS.POST(id)}</span>`</span>, {
                <span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span>
            });
            
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">handleApiError</span>(error);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">hideLoading</span>();
        }
    }
};

</code></pre>
<h3 data-id="heading-9">frontend/js/ui.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// UI组件库</span>

<span class="hljs-comment">// 显示通知</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showNotification</span>(<span class="hljs-params">message, type = <span class="hljs-string">'info'</span></span>) {
    <span class="hljs-keyword">const</span> colors = {
        <span class="hljs-attr">success</span>: <span class="hljs-string">'#10b981'</span>,
        <span class="hljs-attr">error</span>: <span class="hljs-string">'#ef4444'</span>,
        <span class="hljs-attr">warning</span>: <span class="hljs-string">'#f59e0b'</span>,
        <span class="hljs-attr">info</span>: <span class="hljs-string">'#3b82f6'</span>
    };
    
    <span class="hljs-keyword">const</span> notification = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    notification.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background-color: <span class="hljs-subst">${colors[type]}</span>;
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        z-index: 1002;
        animation: slideIn 0.3s ease-out;
        max-width: 400px;
    `</span>;
    
    notification.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div style="display: flex; align-items: center; gap: 10px;"&gt;
            &lt;i class="fas <span class="hljs-subst">${type === <span class="hljs-string">'success'</span> ? <span class="hljs-string">'fa-check-circle'</span> : 
                          type === <span class="hljs-string">'error'</span> ? <span class="hljs-string">'fa-exclamation-circle'</span> : 
                          type === <span class="hljs-string">'warning'</span> ? <span class="hljs-string">'fa-exclamation-triangle'</span> : 
                          <span class="hljs-string">'fa-info-circle'</span>}</span>"&gt;&lt;/i&gt;
            &lt;span&gt;<span class="hljs-subst">${message}</span>&lt;/span&gt;
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(notification);
    
    <span class="hljs-comment">// 自动消失</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        notification.<span class="hljs-property">style</span>.<span class="hljs-property">animation</span> = <span class="hljs-string">'slideOut 0.3s ease-out forwards'</span>;
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> notification.<span class="hljs-title function_">remove</span>(), <span class="hljs-number">300</span>);
    }, <span class="hljs-number">3000</span>);
}

<span class="hljs-comment">// 创建模态框</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createModal</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-keyword">const</span> modal = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    modal.<span class="hljs-property">className</span> = <span class="hljs-string">'modal'</span>;
    modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'flex'</span>;
    
    modal.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div class="modal-content"&gt;
            &lt;div class="modal-header"&gt;
                &lt;h3 class="modal-title"&gt;<span class="hljs-subst">${options.title || <span class="hljs-string">''</span>}</span>&lt;/h3&gt;
                &lt;button class="modal-close" onclick="this.closest('.modal').remove()"&gt;
                    &lt;i class="fas fa-times"&gt;&lt;/i&gt;
                &lt;/button&gt;
            &lt;/div&gt;
            &lt;div class="modal-body"&gt;
                <span class="hljs-subst">${options.body || <span class="hljs-string">''</span>}</span>
            &lt;/div&gt;
            <span class="hljs-subst">${options.footer ? <span class="hljs-string">`
            &lt;div class="modal-footer"&gt;
                <span class="hljs-subst">${options.footer}</span>
            &lt;/div&gt;
            `</span> : <span class="hljs-string">''</span>}</span>
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'modal-container'</span>).<span class="hljs-title function_">appendChild</span>(modal);
    
    <span class="hljs-comment">// 点击背景关闭</span>
    modal.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span> === modal) {
            modal.<span class="hljs-title function_">remove</span>();
        }
    });
    
    <span class="hljs-keyword">return</span> modal;
}

<span class="hljs-comment">// 确认对话框</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showConfirmDialog</span>(<span class="hljs-params">message, onConfirm, onCancel = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">const</span> modal = <span class="hljs-title function_">createModal</span>({
        <span class="hljs-attr">title</span>: <span class="hljs-string">'确认操作'</span>,
        <span class="hljs-attr">body</span>: message,
        <span class="hljs-attr">footer</span>: <span class="hljs-string">`
            &lt;button class="btn btn-secondary" onclick="this.closest('.modal').remove(); <span class="hljs-subst">${onCancel ? <span class="hljs-string">'onCancel()'</span> : <span class="hljs-string">''</span>}</span>"&gt;
                取消
            &lt;/button&gt;
            &lt;button class="btn btn-danger" onclick="this.closest('.modal').remove(); onConfirm()"&gt;
                确认
            &lt;/button&gt;
        `</span>
    });
    
    <span class="hljs-keyword">return</span> modal;
}

<span class="hljs-comment">// 渲染文章卡片</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPostCard</span>(<span class="hljs-params">post</span>) {
    <span class="hljs-keyword">const</span> contentPreview = post.<span class="hljs-property">content</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">150</span> 
        ? post.<span class="hljs-property">content</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">150</span>) + <span class="hljs-string">'...'</span> 
        : post.<span class="hljs-property">content</span>;
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
        &lt;div class="post-card"&gt;
            &lt;div class="post-title"&gt;<span class="hljs-subst">${post.title}</span>&lt;/div&gt;
            &lt;div class="post-meta"&gt;
                &lt;span&gt;&lt;i class="fas fa-user"&gt;&lt;/i&gt; <span class="hljs-subst">${post.author}</span>&lt;/span&gt;
                &lt;span&gt;&lt;i class="fas fa-calendar"&gt;&lt;/i&gt; <span class="hljs-subst">${post.created_at}</span>&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class="post-content-preview"&gt;<span class="hljs-subst">${contentPreview}</span>&lt;/div&gt;
            &lt;div class="post-actions"&gt;
                &lt;button class="btn btn-primary" onclick="viewPost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-eye"&gt;&lt;/i&gt; 查看
                &lt;/button&gt;
                &lt;button class="btn btn-secondary" onclick="editPost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-edit"&gt;&lt;/i&gt; 编辑
                &lt;/button&gt;
                &lt;button class="btn btn-danger" onclick="deletePost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-trash"&gt;&lt;/i&gt; 删除
                &lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `</span>;
}

<span class="hljs-comment">// 渲染文章详情</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPostDetail</span>(<span class="hljs-params">post</span>) {
    <span class="hljs-keyword">const</span> cleanContent = <span class="hljs-title class_">DOMPurify</span>.<span class="hljs-title function_">sanitize</span>(marked.<span class="hljs-title function_">parse</span>(post.<span class="hljs-property">content</span>));
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
        &lt;div class="card"&gt;
            &lt;div style="margin-bottom: 20px;"&gt;
                &lt;button class="btn btn-secondary" onclick="showPage('home')"&gt;
                    &lt;i class="fas fa-arrow-left"&gt;&lt;/i&gt; 返回
                &lt;/button&gt;
            &lt;/div&gt;
            
            &lt;h1 class="post-title" style="font-size: 2rem; margin-bottom: 20px;"&gt;
                <span class="hljs-subst">${post.title}</span>
            &lt;/h1&gt;
            
            &lt;div class="post-meta" style="margin-bottom: 30px;"&gt;
                &lt;span class="badge badge-primary"&gt;
                    &lt;i class="fas fa-user"&gt;&lt;/i&gt; <span class="hljs-subst">${post.author}</span>
                &lt;/span&gt;
                &lt;span&gt;&lt;i class="fas fa-calendar"&gt;&lt;/i&gt; 创建: <span class="hljs-subst">${post.created_at}</span>&lt;/span&gt;
                <span class="hljs-subst">${post.updated_at !== post.created_at ? 
                    <span class="hljs-string">`&lt;span&gt;&lt;i class="fas fa-history"&gt;&lt;/i&gt; 更新: <span class="hljs-subst">${post.updated_at}</span>&lt;/span&gt;`</span> : <span class="hljs-string">''</span>}</span>
            &lt;/div&gt;
            
            &lt;div class="post-content" style="font-size: 1.1rem; line-height: 1.8;"&gt;
                <span class="hljs-subst">${cleanContent}</span>
            &lt;/div&gt;
            
            &lt;div class="post-actions" style="margin-top: 30px;"&gt;
                &lt;button class="btn btn-secondary" onclick="editPost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-edit"&gt;&lt;/i&gt; 编辑文章
                &lt;/button&gt;
                &lt;button class="btn btn-danger" onclick="deletePost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-trash"&gt;&lt;/i&gt; 删除文章
                &lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `</span>;
}

<span class="hljs-comment">// 渲染文章表单</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPostForm</span>(<span class="hljs-params">post = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">const</span> isEdit = !!post;
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
        &lt;div class="card"&gt;
            &lt;div style="margin-bottom: 20px;"&gt;
                &lt;button class="btn btn-secondary" onclick="showPage('<span class="hljs-subst">${isEdit ? <span class="hljs-string">`view/<span class="hljs-subst">${post.id}</span>`</span> : <span class="hljs-string">'home'</span>}</span>')"&gt;
                    &lt;i class="fas fa-arrow-left"&gt;&lt;/i&gt; 返回
                &lt;/button&gt;
            &lt;/div&gt;
            
            &lt;h2 style="margin-bottom: 30px; color: var(--text-color);"&gt;
                <span class="hljs-subst">${isEdit ? <span class="hljs-string">'编辑文章'</span> : <span class="hljs-string">'写新文章'</span>}</span>
            &lt;/h2&gt;
            
            &lt;form id="postForm" onsubmit="handleSubmitPost(event, <span class="hljs-subst">${isEdit ? post.id : <span class="hljs-string">'null'</span>}</span>)"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label class="form-label"&gt;标题&lt;/label&gt;
                    &lt;input type="text" class="form-control" id="postTitle" 
                           value="<span class="hljs-subst">${post ? post.title : <span class="hljs-string">''</span>}</span>" required&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label class="form-label"&gt;作者&lt;/label&gt;
                    &lt;input type="text" class="form-control" id="postAuthor" 
                           value="<span class="hljs-subst">${post ? post.author : <span class="hljs-string">'管理员'</span>}</span>" required&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label class="form-label"&gt;内容&lt;/label&gt;
                    &lt;textarea class="form-control" id="postContent" 
                              rows="10" required&gt;<span class="hljs-subst">${post ? post.content : <span class="hljs-string">''</span>}</span>&lt;/textarea&gt;
                &lt;/div&gt;
                
                &lt;div style="display: flex; gap: 10px; margin-top: 30px;"&gt;
                    &lt;button type="button" class="btn btn-secondary" 
                            onclick="showPage('<span class="hljs-subst">${isEdit ? <span class="hljs-string">`view/<span class="hljs-subst">${post.id}</span>`</span> : <span class="hljs-string">'home'</span>}</span>')"&gt;
                        取消
                    &lt;/button&gt;
                    &lt;button type="submit" class="btn btn-success"&gt;
                        &lt;i class="fas fa-paper-plane"&gt;&lt;/i&gt; 
                        <span class="hljs-subst">${isEdit ? <span class="hljs-string">'更新文章'</span> : <span class="hljs-string">'发布文章'</span>}</span>
                    &lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    `</span>;
}

<span class="hljs-comment">// 渲染文章管理表格</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPostTable</span>(<span class="hljs-params">posts</span>) {
    <span class="hljs-keyword">if</span> (posts.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px;"&gt;
                &lt;i class="fas fa-inbox" style="font-size: 3rem; color: var(--secondary-color); margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;h3 style="color: var(--text-color); margin-bottom: 10px;"&gt;暂无文章&lt;/h3&gt;
                &lt;p style="color: var(--secondary-color);"&gt;点击"写文章"按钮开始创作&lt;/p&gt;
            &lt;/div&gt;
        `</span>;
    }
    
    <span class="hljs-keyword">const</span> rows = posts.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">post</span> =&gt;</span> <span class="hljs-string">`
        &lt;tr&gt;
            &lt;td&gt;<span class="hljs-subst">${post.id}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${post.title}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${post.author}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${post.created_at}</span>&lt;/td&gt;
            &lt;td&gt;
                &lt;button class="btn btn-primary btn-sm" onclick="viewPost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-eye"&gt;&lt;/i&gt;
                &lt;/button&gt;
                &lt;button class="btn btn-secondary btn-sm" onclick="editPost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-edit"&gt;&lt;/i&gt;
                &lt;/button&gt;
                &lt;button class="btn btn-danger btn-sm" onclick="deletePost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-trash"&gt;&lt;/i&gt;
                &lt;/button&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    `</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
        &lt;div class="card"&gt;
            &lt;h2 style="margin-bottom: 20px; color: var(--text-color);"&gt;文章管理&lt;/h2&gt;
            &lt;div style="overflow-x: auto;"&gt;
                &lt;table style="width: 100%; border-collapse: collapse;"&gt;
                    &lt;thead&gt;
                        &lt;tr style="background-color: var(--light-color);"&gt;
                            &lt;th style="padding: 12px; text-align: left;"&gt;ID&lt;/th&gt;
                            &lt;th style="padding: 12px; text-align: left;"&gt;标题&lt;/th&gt;
                            &lt;th style="padding: 12px; text-align: left;"&gt;作者&lt;/th&gt;
                            &lt;th style="padding: 12px; text-align: left;"&gt;创建时间&lt;/th&gt;
                            &lt;th style="padding: 12px; text-align: left;"&gt;操作&lt;/th&gt;
                        &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                        <span class="hljs-subst">${rows}</span>
                    &lt;/tbody&gt;
                &lt;/table&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `</span>;
}

</code></pre>
<h3 data-id="heading-10">frontend/js/app.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 应用主逻辑</span>
<span class="hljs-keyword">let</span> currentPage = <span class="hljs-string">'home'</span>;

<span class="hljs-comment">// 初始化应用</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initApp</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 设置主题</span>
    <span class="hljs-keyword">const</span> savedTheme = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'theme'</span>) || <span class="hljs-string">'light'</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-theme'</span>, savedTheme);
    
    <span class="hljs-comment">// 加载首页</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">showPage</span>(<span class="hljs-string">'home'</span>);
}

<span class="hljs-comment">// 切换主题</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleTheme</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> currentTheme = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-theme'</span>);
    <span class="hljs-keyword">const</span> newTheme = currentTheme === <span class="hljs-string">'dark'</span> ? <span class="hljs-string">'light'</span> : <span class="hljs-string">'dark'</span>;
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-theme'</span>, newTheme);
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'theme'</span>, newTheme);
    
    <span class="hljs-comment">// 更新按钮图标</span>
    <span class="hljs-keyword">const</span> themeButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.btn-toggle-theme i'</span>);
    themeButton.<span class="hljs-property">className</span> = newTheme === <span class="hljs-string">'dark'</span> ? <span class="hljs-string">'fas fa-sun'</span> : <span class="hljs-string">'fas fa-moon'</span>;
}

<span class="hljs-comment">// 显示页面</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">showPage</span>(<span class="hljs-params">page</span>) {
    currentPage = page;
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (page === <span class="hljs-string">'home'</span>) {
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadHomePage</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (page === <span class="hljs-string">'manage'</span>) {
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadManagePage</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (page === <span class="hljs-string">'create'</span>) {
            <span class="hljs-title function_">loadCreatePage</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (page.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'view/'</span>)) {
            <span class="hljs-keyword">const</span> postId = <span class="hljs-built_in">parseInt</span>(page.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)[<span class="hljs-number">1</span>]);
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadPostPage</span>(postId);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (page.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'edit/'</span>)) {
            <span class="hljs-keyword">const</span> postId = <span class="hljs-built_in">parseInt</span>(page.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)[<span class="hljs-number">1</span>]);
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadEditPage</span>(postId);
        }
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error loading page:'</span>, error);
        mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px;"&gt;
                &lt;i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger-color); margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;h3 style="color: var(--text-color); margin-bottom: 10px;"&gt;加载失败&lt;/h3&gt;
                &lt;p style="color: var(--secondary-color);"&gt;<span class="hljs-subst">${error.message}</span>&lt;/p&gt;
                &lt;button class="btn btn-primary" onclick="showPage('home')" style="margin-top: 20px;"&gt;
                    返回首页
                &lt;/button&gt;
            &lt;/div&gt;
        `</span>;
    }
}

<span class="hljs-comment">// 加载首页</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadHomePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    
    mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div style="margin-bottom: 30px;"&gt;
            &lt;h1 style="color: var(--text-color); margin-bottom: 10px;"&gt;📚 最新文章&lt;/h1&gt;
            &lt;p style="color: var(--secondary-color);"&gt;欢迎阅读我们的博客文章&lt;/p&gt;
        &lt;/div&gt;
        &lt;div id="posts-container" style="min-height: 200px;"&gt;
            &lt;div style="text-align: center; padding: 40px;"&gt;
                &lt;div class="spinner" style="margin: 0 auto;"&gt;&lt;/div&gt;
                &lt;p style="margin-top: 20px; color: var(--secondary-color);"&gt;加载中...&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">getAllPosts</span>();
        
        <span class="hljs-keyword">if</span> (posts.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'posts-container'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
                &lt;div class="card" style="text-align: center; padding: 40px;"&gt;
                    &lt;i class="fas fa-feather-alt" style="font-size: 3rem; color: var(--secondary-color); margin-bottom: 20px;"&gt;&lt;/i&gt;
                    &lt;h3 style="color: var(--text-color); margin-bottom: 10px;"&gt;暂无文章&lt;/h3&gt;
                    &lt;p style="color: var(--secondary-color); margin-bottom: 20px;"&gt;点击"写文章"按钮开始创作&lt;/p&gt;
                    &lt;button class="btn btn-success" onclick="showPage('create')"&gt;
                        &lt;i class="fas fa-plus"&gt;&lt;/i&gt; 写文章
                    &lt;/button&gt;
                &lt;/div&gt;
            `</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">const</span> postsHTML = posts
                .<span class="hljs-title function_">slice</span>() <span class="hljs-comment">// 创建副本避免修改原数组</span>
                .<span class="hljs-title function_">reverse</span>() <span class="hljs-comment">// 最新的在前</span>
                .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">post</span> =&gt;</span> <span class="hljs-title function_">renderPostCard</span>(post))
                .<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
            
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'posts-container'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
                &lt;div class="post-list"&gt;
                    <span class="hljs-subst">${postsHTML}</span>
                &lt;/div&gt;
            `</span>;
        }
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'posts-container'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px; color: var(--danger-color);"&gt;
                &lt;i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;p&gt;加载文章失败，请刷新页面重试&lt;/p&gt;
            &lt;/div&gt;
        `</span>;
    }
}

<span class="hljs-comment">// 加载文章详情页</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadPostPage</span>(<span class="hljs-params">postId</span>) {
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    
    mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div style="text-align: center; padding: 40px;"&gt;
            &lt;div class="spinner" style="margin: 0 auto;"&gt;&lt;/div&gt;
            &lt;p style="margin-top: 20px; color: var(--secondary-color);"&gt;加载中...&lt;/p&gt;
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">getPost</span>(postId);
        mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-title function_">renderPostDetail</span>(post);
    } <span class="hljs-keyword">catch</span> (error) {
        mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px;"&gt;
                &lt;i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger-color); margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;h3 style="color: var(--text-color); margin-bottom: 10px;"&gt;文章不存在&lt;/h3&gt;
                &lt;p style="color: var(--secondary-color);"&gt;该文章可能已被删除&lt;/p&gt;
                &lt;button class="btn btn-primary" onclick="showPage('home')" style="margin-top: 20px;"&gt;
                    返回首页
                &lt;/button&gt;
            &lt;/div&gt;
        `</span>;
    }
}

<span class="hljs-comment">// 加载创建文章页</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadCreatePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-title function_">renderPostForm</span>();
}

<span class="hljs-comment">// 加载编辑文章页</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadEditPage</span>(<span class="hljs-params">postId</span>) {
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    
    mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div style="text-align: center; padding: 40px;"&gt;
            &lt;div class="spinner" style="margin: 0 auto;"&gt;&lt;/div&gt;
            &lt;p style="margin-top: 20px; color: var(--secondary-color);"&gt;加载中...&lt;/p&gt;
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">getPost</span>(postId);
        mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-title function_">renderPostForm</span>(post);
    } <span class="hljs-keyword">catch</span> (error) {
        mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px;"&gt;
                &lt;i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger-color); margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;h3 style="color: var(--text-color); margin-bottom: 10px;"&gt;文章不存在&lt;/h3&gt;
                &lt;p style="color: var(--secondary-color);"&gt;无法编辑不存在的文章&lt;/p&gt;
                &lt;button class="btn btn-primary" onclick="showPage('home')" style="margin-top: 20px;"&gt;
                    返回首页
                &lt;/button&gt;
            &lt;/div&gt;
        `</span>;
    }
}

<span class="hljs-comment">// 加载管理页面</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadManagePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    
    mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div style="margin-bottom: 30px;"&gt;
            &lt;h1 style="color: var(--text-color); margin-bottom: 10px;"&gt;📋 文章管理&lt;/h1&gt;
            &lt;p style="color: var(--secondary-color);"&gt;管理所有博客文章&lt;/p&gt;
        &lt;/div&gt;
        &lt;div id="manage-container" style="min-height: 200px;"&gt;
            &lt;div style="text-align: center; padding: 40px;"&gt;
                &lt;div class="spinner" style="margin: 0 auto;"&gt;&lt;/div&gt;
                &lt;p style="margin-top: 20px; color: var(--secondary-color);"&gt;加载中...&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">getAllPosts</span>();
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'manage-container'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-title function_">renderPostTable</span>(posts);
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'manage-container'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px; color: var(--danger-color);"&gt;
                &lt;i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;p&gt;加载失败，请刷新页面重试&lt;/p&gt;
            &lt;/div&gt;
        `</span>;
    }
}

<span class="hljs-comment">// 查看文章</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">viewPost</span>(<span class="hljs-params">postId</span>) {
    <span class="hljs-title function_">showPage</span>(<span class="hljs-string">`view/<span class="hljs-subst">${postId}</span>`</span>);
}

<span class="hljs-comment">// 编辑文章</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">editPost</span>(<span class="hljs-params">postId</span>) {
    <span class="hljs-title function_">showPage</span>(<span class="hljs-string">`edit/<span class="hljs-subst">${postId}</span>`</span>);
}

<span class="hljs-comment">// 删除文章</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deletePost</span>(<span class="hljs-params">postId</span>) {
    <span class="hljs-title function_">showConfirmDialog</span>(
        <span class="hljs-string">'确定要删除这篇文章吗？删除后无法恢复。'</span>,
        <span class="hljs-keyword">async</span> () =&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">deletePost</span>(postId);
                <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'文章删除成功'</span>, <span class="hljs-string">'success'</span>);
                
                <span class="hljs-comment">// 根据当前页面刷新内容</span>
                <span class="hljs-keyword">if</span> (currentPage === <span class="hljs-string">'manage'</span>) {
                    <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadManagePage</span>();
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentPage === <span class="hljs-string">'home'</span>) {
                    <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadHomePage</span>();
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-title function_">showPage</span>(<span class="hljs-string">'home'</span>);
                }
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'删除失败: '</span> + error.<span class="hljs-property">message</span>, <span class="hljs-string">'error'</span>);
            }
        }
    );
}

<span class="hljs-comment">// 处理文章提交</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmitPost</span>(<span class="hljs-params">event, postId = <span class="hljs-literal">null</span></span>) {
    event.<span class="hljs-title function_">preventDefault</span>();
    
    <span class="hljs-keyword">const</span> title = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'postTitle'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
    <span class="hljs-keyword">const</span> author = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'postAuthor'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
    <span class="hljs-keyword">const</span> content = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'postContent'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
    
    <span class="hljs-keyword">if</span> (!title || !author || !content) {
        <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'请填写所有必填字段'</span>, <span class="hljs-string">'warning'</span>);
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-keyword">const</span> postData = {
        title,
        author,
        content
    };
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (postId) {
            <span class="hljs-comment">// 更新文章</span>
            <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">updatePost</span>(postId, postData);
            <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'文章更新成功'</span>, <span class="hljs-string">'success'</span>);
            <span class="hljs-title function_">showPage</span>(<span class="hljs-string">`view/<span class="hljs-subst">${postId}</span>`</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 创建新文章</span>
            <span class="hljs-keyword">const</span> newPost = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">createPost</span>(postData);
            <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'文章发布成功'</span>, <span class="hljs-string">'success'</span>);
            <span class="hljs-title function_">showPage</span>(<span class="hljs-string">`view/<span class="hljs-subst">${newPost.id}</span>`</span>);
        }
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'操作失败: '</span> + error.<span class="hljs-property">message</span>, <span class="hljs-string">'error'</span>);
    }
}

<span class="hljs-comment">// 添加CSS动画</span>
<span class="hljs-keyword">const</span> style = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'style'</span>);
style.<span class="hljs-property">textContent</span> = <span class="hljs-string">`
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
    
    .btn-sm {
        padding: 4px 8px;
        font-size: 0.8rem;
    }
`</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(style);

</code></pre>
<blockquote>
<p>入前端目录 cd frontend
使用Python启动HTTP服务器
python -m http.server 3000</p>
</blockquote>
<h2 data-id="heading-11">Vue3 前端</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56a19fb1fd134afd8bdc7956f74a3d57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGllcm9QQw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577038&amp;x-signature=U35wJE4ie8xK%2BejfrthSMugBJhA%3D" alt="image.png" loading="lazy"/></p>
<p>以下是一个完整的Vue 3 + Element Plus前端实现，与FastAPI后端配合使用：</p>
<h3 data-id="heading-12">项目结构</h3>
<pre><code class="hljs language-css" lang="css">frontend/
├── <span class="hljs-attribute">src</span>/
│   ├── components/
│   │   ├── BlogHeader<span class="hljs-selector-class">.vue</span>
│   │   └── BlogSidebar<span class="hljs-selector-class">.vue</span>
│   ├── views/
│   │   ├── HomeView<span class="hljs-selector-class">.vue</span>
│   │   ├── BlogList<span class="hljs-selector-class">.vue</span>
│   │   ├── BlogDetail<span class="hljs-selector-class">.vue</span>
│   │   ├── CreateBlog<span class="hljs-selector-class">.vue</span>
│   │   └── EditBlog<span class="hljs-selector-class">.vue</span>
│   ├── router/
│   │   └── index<span class="hljs-selector-class">.js</span>
│   ├── api/
│   │   └── blog<span class="hljs-selector-class">.js</span>
│   ├── App<span class="hljs-selector-class">.vue</span>
│   └── <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.js</span>
└── package<span class="hljs-selector-class">.json</span>
</code></pre>
<h3 data-id="heading-13">1. 安装依赖</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建Vue项目</span>
npm create vue@latest blog-frontend

<span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> blog-frontend

<span class="hljs-comment"># 安装Element Plus和axios</span>
npm install element-plus axios
npm install @element-plus/icons-vue
</code></pre>
<h3 data-id="heading-14">2. 主要文件代码</h3>
<h4 data-id="heading-15"><code>src/main.js</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementPlus</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'element-plus/dist/index.css'</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">ElementPlusIconsVue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@element-plus/icons-vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-comment">// 注册所有图标</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, component] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-title class_">ElementPlusIconsVue</span>)) {
  app.<span class="hljs-title function_">component</span>(key, component)
}

app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">createPinia</span>())
app.<span class="hljs-title function_">use</span>(router)
app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h4 data-id="heading-16"><code>src/App.vue</code></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;el-container class="app-container"&gt;
      &lt;!-- 头部导航 --&gt;
      &lt;el-header class="app-header"&gt;
        &lt;div class="header-content"&gt;
          &lt;h1 class="logo"&gt;博客管理系统&lt;/h1&gt;
          &lt;div class="nav-links"&gt;
            &lt;router-link to="/" class="nav-link"&gt;
              &lt;el-icon&gt;&lt;HomeFilled /&gt;&lt;/el-icon&gt;
              首页
            &lt;/router-link&gt;
            &lt;router-link to="/blogs" class="nav-link"&gt;
              &lt;el-icon&gt;&lt;Document /&gt;&lt;/el-icon&gt;
              博客列表
            &lt;/router-link&gt;
            &lt;router-link to="/create" class="nav-link"&gt;
              &lt;el-icon&gt;&lt;Edit /&gt;&lt;/el-icon&gt;
              写文章
            &lt;/router-link&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/el-header&gt;

      &lt;!-- 主要内容 --&gt;
      &lt;el-main class="app-main"&gt;
        &lt;router-view /&gt;
      &lt;/el-main&gt;

      &lt;!-- 底部 --&gt;
      &lt;el-footer class="app-footer"&gt;
        &lt;div class="footer-content"&gt;
          &lt;p&gt;© 2024 博客管理系统 | Powered by Vue 3 + Element Plus + FastAPI&lt;/p&gt;
          &lt;p&gt;
            &lt;el-link href="http://localhost:8000/docs" target="_blank" type="info"&gt;
              API文档
            &lt;/el-link&gt;
          &lt;/p&gt;
        &lt;/div&gt;
      &lt;/el-footer&gt;
    &lt;/el-container&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { HomeFilled, Document, Edit } from '@element-plus/icons-vue'
&lt;/script&gt;

&lt;style scoped&gt;
.app-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.app-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.logo {
  margin: 0;
  font-size: 24px;
  font-weight: 600;
}

.nav-links {
  display: flex;
  gap: 30px;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: 5px;
  color: white;
  text-decoration: none;
  font-size: 16px;
  padding: 8px 16px;
  border-radius: 4px;
  transition: all 0.3s;
}

.nav-link:hover {
  background: rgba(255, 255, 255, 0.1);
}

.nav-link.router-link-active {
  background: rgba(255, 255, 255, 0.2);
}

.app-main {
  flex: 1;
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  width: 100%;
}

.app-footer {
  background: #f8f9fa;
  color: #666;
  border-top: 1px solid #e4e7ed;
}

.footer-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  text-align: center;
}

.footer-content p {
  margin: 5px 0;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-17"><code>src/router/index.js</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HomeView</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../views/HomeView.vue'</span>

<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'home'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">HomeView</span>
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/blogs'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'blogs'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/BlogList.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/blogs/:id'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'blog-detail'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/BlogDetail.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/create'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'create-blog'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/CreateBlog.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/edit/:id'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'edit-blog'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/EditBlog.vue'</span>)
  }
]

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
  routes
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router
</code></pre>
<h4 data-id="heading-18"><code>src/api/blog.js</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>

<span class="hljs-comment">// 创建axios实例</span>
<span class="hljs-keyword">const</span> api = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'http://localhost:8000/api'</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
  }
})

<span class="hljs-comment">// 博客API</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> blogApi = {
  <span class="hljs-comment">// 获取所有博客</span>
  <span class="hljs-title function_">getAllBlogs</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/posts'</span>)
  },
  
  <span class="hljs-comment">// 获取单个博客</span>
  <span class="hljs-title function_">getBlogById</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/posts/<span class="hljs-subst">${id}</span>`</span>)
  },
  
  <span class="hljs-comment">// 创建博客</span>
  <span class="hljs-title function_">createBlog</span>(<span class="hljs-params">blogData</span>) {
    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/posts'</span>, blogData)
  },
  
  <span class="hljs-comment">// 更新博客</span>
  <span class="hljs-title function_">updateBlog</span>(<span class="hljs-params">id, blogData</span>) {
    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">put</span>(<span class="hljs-string">`/posts/<span class="hljs-subst">${id}</span>`</span>, blogData)
  },
  
  <span class="hljs-comment">// 删除博客</span>
  <span class="hljs-title function_">deleteBlog</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">delete</span>(<span class="hljs-string">`/posts/<span class="hljs-subst">${id}</span>`</span>)
  }
}
</code></pre>
<h4 data-id="heading-19"><code>src/views/HomeView.vue</code></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="home"&gt;
    &lt;el-row :gutter="20"&gt;
      &lt;el-col :span="24"&gt;
        &lt;el-card class="welcome-card"&gt;
          &lt;template #header&gt;
            &lt;div class="card-header"&gt;
              &lt;h2&gt;欢迎使用博客管理系统&lt;/h2&gt;
            &lt;/div&gt;
          &lt;/template&gt;
          &lt;div class="welcome-content"&gt;
            &lt;el-icon class="welcome-icon"&gt;&lt;Reading /&gt;&lt;/el-icon&gt;
            &lt;p class="welcome-text"&gt;
              这是一个基于 Vue 3 + Element Plus + FastAPI 的完整博客管理系统。
              您可以浏览、创建、编辑和删除博客文章。
            &lt;/p&gt;
            &lt;div class="action-buttons"&gt;
              &lt;el-button 
                type="primary" 
                size="large" 
                @click="$router.push('/blogs')"
                class="action-button"
              &gt;
                &lt;el-icon&gt;&lt;List /&gt;&lt;/el-icon&gt;
                浏览博客
              &lt;/el-button&gt;
              &lt;el-button 
                type="success" 
                size="large" 
                @click="$router.push('/create')"
                class="action-button"
              &gt;
                &lt;el-icon&gt;&lt;Edit /&gt;&lt;/el-icon&gt;
                写新文章
              &lt;/el-button&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/el-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;

    &lt;el-row :gutter="20" class="features"&gt;
      &lt;el-col :xs="24" :sm="12" :md="8" v-for="feature in features" :key="feature.title"&gt;
        &lt;el-card class="feature-card"&gt;
          &lt;div class="feature-icon"&gt;
            &lt;component :is="feature.icon" /&gt;
          &lt;/div&gt;
          &lt;h3&gt;{{ feature.title }}&lt;/h3&gt;
          &lt;p&gt;{{ feature.description }}&lt;/p&gt;
        &lt;/el-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import { Reading, List, Edit, DataBoard, Setting, User } from '@element-plus/icons-vue'

const features = ref([
  {
    title: '简洁易用',
    description: '直观的用户界面，操作简单便捷',
    icon: 'Setting'
  },
  {
    title: '功能完整',
    description: '完整的CRUD操作，满足所有博客管理需求',
    icon: 'DataBoard'
  },
  {
    title: '响应式设计',
    description: '适配各种设备，提供良好的移动端体验',
    icon: 'User'
  }
])
&lt;/script&gt;

&lt;style scoped&gt;
.home {
  padding: 20px;
}

.welcome-card {
  margin-bottom: 30px;
  text-align: center;
  border: none;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.welcome-content {
  padding: 40px 20px;
}

.welcome-icon {
  font-size: 60px;
  color: #409EFF;
  margin-bottom: 20px;
}

.welcome-text {
  font-size: 18px;
  color: #666;
  margin-bottom: 30px;
  line-height: 1.6;
}

.action-buttons {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 30px;
}

.action-button {
  padding: 15px 30px;
}

.features {
  margin-top: 30px;
}

.feature-card {
  height: 100%;
  text-align: center;
  border: none;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s;
}

.feature-card:hover {
  transform: translateY(-5px);
}

.feature-icon {
  font-size: 40px;
  color: #67C23A;
  margin-bottom: 20px;
}

.feature-card h3 {
  margin: 10px 0;
  color: #333;
}

.feature-card p {
  color: #666;
  line-height: 1.5;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-20"><code>src/views/BlogList.vue</code></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="blog-list"&gt;
    &lt;el-row :gutter="20"&gt;
      &lt;el-col :span="24"&gt;
        &lt;div class="page-header"&gt;
          &lt;h2&gt;博客文章&lt;/h2&gt;
          &lt;el-button 
            type="primary" 
            @click="$router.push('/create')"
            class="create-btn"
          &gt;
            &lt;el-icon&gt;&lt;Plus /&gt;&lt;/el-icon&gt;
            创建新文章
          &lt;/el-button&gt;
        &lt;/div&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;

    &lt;el-row :gutter="20" v-loading="loading"&gt;
      &lt;el-col 
        :xs="24" 
        :sm="12" 
        :lg="8" 
        v-for="blog in blogs" 
        :key="blog.id"
      &gt;
        &lt;el-card class="blog-card" shadow="hover"&gt;
          &lt;template #header&gt;
            &lt;div class="blog-header"&gt;
              &lt;h3 class="blog-title"&gt;{{ blog.title }}&lt;/h3&gt;
              &lt;el-tag type="info" size="small"&gt;
                {{ blog.author }}
              &lt;/el-tag&gt;
            &lt;/div&gt;
          &lt;/template&gt;
          
          &lt;div class="blog-content"&gt;
            &lt;p class="blog-excerpt"&gt;
              {{ truncateContent(blog.content) }}
            &lt;/p&gt;
            
            &lt;div class="blog-meta"&gt;
              &lt;div class="meta-item"&gt;
                &lt;el-icon&gt;&lt;Calendar /&gt;&lt;/el-icon&gt;
                &lt;span&gt;{{ formatDate(blog.created_at) }}&lt;/span&gt;
              &lt;/div&gt;
              &lt;div class="meta-item" v-if="blog.updated_at !== blog.created_at"&gt;
                &lt;el-icon&gt;&lt;Refresh /&gt;&lt;/el-icon&gt;
                &lt;span&gt;更新于 {{ formatDate(blog.updated_at) }}&lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          
          &lt;template #footer&gt;
            &lt;div class="blog-actions"&gt;
              &lt;el-button 
                type="primary" 
                size="small" 
                @click="viewBlog(blog.id)"
              &gt;
                &lt;el-icon&gt;&lt;View /&gt;&lt;/el-icon&gt;
                查看详情
              &lt;/el-button&gt;
              &lt;el-button 
                type="warning" 
                size="small" 
                @click="editBlog(blog.id)"
              &gt;
                &lt;el-icon&gt;&lt;Edit /&gt;&lt;/el-icon&gt;
                编辑
              &lt;/el-button&gt;
              &lt;el-button 
                type="danger" 
                size="small" 
                @click="confirmDelete(blog)"
              &gt;
                &lt;el-icon&gt;&lt;Delete /&gt;&lt;/el-icon&gt;
                删除
              &lt;/el-button&gt;
            &lt;/div&gt;
          &lt;/template&gt;
        &lt;/el-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;

    &lt;!-- 空状态 --&gt;
    &lt;el-empty 
      v-if="!loading &amp;&amp; blogs.length === 0" 
      description="暂无博客文章"
      class="empty-state"
    &gt;
      &lt;el-button type="primary" @click="$router.push('/create')"&gt;
        创建第一篇博客
      &lt;/el-button&gt;
    &lt;/el-empty&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage, ElMessageBox } from 'element-plus'
import { blogApi } from '../api/blog'
import { 
  Plus, 
  Calendar, 
  Refresh, 
  View, 
  Edit, 
  Delete 
} from '@element-plus/icons-vue'

const router = useRouter()
const blogs = ref([])
const loading = ref(false)

// 获取博客列表
const fetchBlogs = async () =&gt; {
  try {
    loading.value = true
    const response = await blogApi.getAllBlogs()
    blogs.value = response.data
  } catch (error) {
    ElMessage.error('获取博客列表失败：' + error.message)
  } finally {
    loading.value = false
  }
}

// 查看博客详情
const viewBlog = (id) =&gt; {
  router.push(`/blogs/${id}`)
}

// 编辑博客
const editBlog = (id) =&gt; {
  router.push(`/edit/${id}`)
}

// 确认删除
const confirmDelete = (blog) =&gt; {
  ElMessageBox.confirm(
    `确定要删除文章 "${blog.title}" 吗？`,
    '删除确认',
    {
      confirmButtonText: '确定删除',
      cancelButtonText: '取消',
      type: 'warning',
      center: true
    }
  ).then(async () =&gt; {
    try {
      await blogApi.deleteBlog(blog.id)
      ElMessage.success('文章删除成功')
      fetchBlogs() // 重新加载列表
    } catch (error) {
      ElMessage.error('删除失败：' + error.message)
    }
  }).catch(() =&gt; {
    // 用户取消
  })
}

// 截断内容
const truncateContent = (content, length = 100) =&gt; {
  if (content.length &lt;= length) return content
  return content.substring(0, length) + '...'
}

// 格式化日期
const formatDate = (dateString) =&gt; {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleDateString('zh-CN')
}

onMounted(() =&gt; {
  fetchBlogs()
})
&lt;/script&gt;

&lt;style scoped&gt;
.blog-list {
  padding: 20px;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.page-header h2 {
  margin: 0;
  color: #333;
}

.create-btn {
  padding: 10px 20px;
}

.blog-card {
  margin-bottom: 20px;
  height: 100%;
  transition: transform 0.3s;
}

.blog-card:hover {
  transform: translateY(-5px);
}

.blog-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.blog-title {
  margin: 0;
  font-size: 18px;
  color: #333;
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.blog-content {
  min-height: 120px;
}

.blog-excerpt {
  color: #666;
  line-height: 1.6;
  margin-bottom: 15px;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.blog-meta {
  display: flex;
  flex-direction: column;
  gap: 8px;
  font-size: 12px;
  color: #999;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.blog-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.empty-state {
  margin-top: 50px;
}

@media (max-width: 768px) {
  .page-header {
    flex-direction: column;
    align-items: stretch;
    gap: 15px;
  }
  
  .create-btn {
    width: 100%;
  }
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-21"><code>src/views/BlogDetail.vue</code></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="blog-detail"&gt;
    &lt;div v-if="loading" class="loading-container"&gt;
      &lt;el-skeleton :rows="10" animated /&gt;
    &lt;/div&gt;
    
    &lt;div v-else-if="blog" class="blog-content"&gt;
      &lt;!-- 返回按钮 --&gt;
      &lt;el-button 
        type="info" 
        @click="$router.back()" 
        class="back-btn"
      &gt;
        &lt;el-icon&gt;&lt;ArrowLeft /&gt;&lt;/el-icon&gt;
        返回列表
      &lt;/el-button&gt;
      
      &lt;!-- 博客内容 --&gt;
      &lt;el-card class="blog-card"&gt;
        &lt;template #header&gt;
          &lt;div class="blog-header"&gt;
            &lt;h1 class="blog-title"&gt;{{ blog.title }}&lt;/h1&gt;
            &lt;div class="blog-meta"&gt;
              &lt;el-tag type="primary" size="large"&gt;
                {{ blog.author }}
              &lt;/el-tag&gt;
              &lt;div class="meta-info"&gt;
                &lt;div class="meta-item"&gt;
                  &lt;el-icon&gt;&lt;Calendar /&gt;&lt;/el-icon&gt;
                  &lt;span&gt;发布于 {{ formatDateTime(blog.created_at) }}&lt;/span&gt;
                &lt;/div&gt;
                &lt;div class="meta-item" v-if="blog.updated_at !== blog.created_at"&gt;
                  &lt;el-icon&gt;&lt;Refresh /&gt;&lt;/el-icon&gt;
                  &lt;span&gt;更新于 {{ formatDateTime(blog.updated_at) }}&lt;/span&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/template&gt;
        
        &lt;div class="content-body"&gt;
          &lt;div class="content-text"&gt;
            &lt;p v-for="(paragraph, index) in contentParagraphs" 
               :key="index"
               class="paragraph"&gt;
              {{ paragraph }}
            &lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;template #footer&gt;
          &lt;div class="blog-actions"&gt;
            &lt;el-button-group&gt;
              &lt;el-button 
                type="primary" 
                @click="editBlog"
              &gt;
                &lt;el-icon&gt;&lt;Edit /&gt;&lt;/el-icon&gt;
                编辑文章
              &lt;/el-button&gt;
              &lt;el-button 
                type="danger" 
                @click="confirmDelete"
              &gt;
                &lt;el-icon&gt;&lt;Delete /&gt;&lt;/el-icon&gt;
                删除文章
              &lt;/el-button&gt;
            &lt;/el-button-group&gt;
          &lt;/div&gt;
        &lt;/template&gt;
      &lt;/el-card&gt;
    &lt;/div&gt;
    
    &lt;div v-else class="not-found"&gt;
      &lt;el-result
        icon="error"
        title="文章不存在"
        sub-title="您访问的文章可能已被删除或不存在"
      &gt;
        &lt;template #extra&gt;
          &lt;el-button type="primary" @click="$router.push('/blogs')"&gt;
            返回博客列表
          &lt;/el-button&gt;
        &lt;/template&gt;
      &lt;/el-result&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, onMounted, computed } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { ElMessage, ElMessageBox } from 'element-plus'
import { blogApi } from '../api/blog'
import { 
  ArrowLeft, 
  Calendar, 
  Refresh, 
  Edit, 
  Delete 
} from '@element-plus/icons-vue'

const route = useRoute()
const router = useRouter()
const blog = ref(null)
const loading = ref(true)

// 获取博客详情
const fetchBlog = async () =&gt; {
  try {
    loading.value = true
    const id = parseInt(route.params.id)
    const response = await blogApi.getBlogById(id)
    blog.value = response.data
  } catch (error) {
    ElMessage.error('获取博客详情失败：' + error.message)
    blog.value = null
  } finally {
    loading.value = false
  }
}

// 编辑博客
const editBlog = () =&gt; {
  router.push(`/edit/${blog.value.id}`)
}

// 确认删除
const confirmDelete = () =&gt; {
  ElMessageBox.confirm(
    `确定要删除文章 "${blog.value.title}" 吗？此操作不可恢复。`,
    '删除确认',
    {
      confirmButtonText: '确定删除',
      cancelButtonText: '取消',
      type: 'warning',
      center: true
    }
  ).then(async () =&gt; {
    try {
      await blogApi.deleteBlog(blog.value.id)
      ElMessage.success('文章删除成功')
      router.push('/blogs')
    } catch (error) {
      ElMessage.error('删除失败：' + error.message)
    }
  }).catch(() =&gt; {
    // 用户取消
  })
}

// 格式化日期时间
const formatDateTime = (dateString) =&gt; {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleString('zh-CN')
}

// 将内容分割为段落
const contentParagraphs = computed(() =&gt; {
  if (!blog.value?.content) return []
  return blog.value.content.split('\n').filter(p =&gt; p.trim())
})

onMounted(() =&gt; {
  fetchBlog()
})
&lt;/script&gt;

&lt;style scoped&gt;
.blog-detail {
  padding: 20px;
  max-width: 900px;
  margin: 0 auto;
}

.loading-container {
  padding: 40px;
}

.back-btn {
  margin-bottom: 20px;
}

.blog-card {
  border: none;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.blog-header {
  padding-bottom: 20px;
  border-bottom: 1px solid #e4e7ed;
}

.blog-title {
  margin: 0 0 20px 0;
  font-size: 32px;
  color: #333;
  line-height: 1.3;
}

.blog-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 15px;
}

.meta-info {
  display: flex;
  gap: 20px;
  font-size: 14px;
  color: #666;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.content-body {
  padding: 30px 0;
}

.content-text {
  font-size: 16px;
  line-height: 1.8;
  color: #333;
}

.paragraph {
  margin-bottom: 20px;
  text-indent: 2em;
}

.paragraph:last-child {
  margin-bottom: 0;
}

.blog-actions {
  padding-top: 20px;
  border-top: 1px solid #e4e7ed;
  display: flex;
  justify-content: flex-end;
}

.not-found {
  padding: 100px 20px;
}

@media (max-width: 768px) {
  .blog-title {
    font-size: 24px;
  }
  
  .blog-meta {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .meta-info {
    flex-direction: column;
    gap: 10px;
  }
  
  .content-body {
    padding: 20px 0;
  }
  
  .content-text {
    font-size: 15px;
  }
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-22"><code>src/views/CreateBlog.vue</code> 和 <code>src/views/EditBlog.vue</code></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="blog-editor"&gt;
    &lt;el-page-header 
      @back="$router.back()" 
      :content="isEditMode ? '编辑文章' : '创建新文章'"
      class="page-header"
    /&gt;
    
    &lt;el-card class="editor-card"&gt;
      &lt;template #header&gt;
        &lt;h3&gt;{{ isEditMode ? '编辑文章' : '写新文章' }}&lt;/h3&gt;
      &lt;/template&gt;
      
      &lt;el-form 
        ref="formRef" 
        :model="form" 
        :rules="rules" 
        label-width="80px"
        class="blog-form"
      &gt;
        &lt;el-form-item label="文章标题" prop="title"&gt;
          &lt;el-input 
            v-model="form.title" 
            placeholder="请输入文章标题" 
            size="large"
            clearable
          /&gt;
        &lt;/el-form-item&gt;
        
        &lt;el-form-item label="作者" prop="author"&gt;
          &lt;el-input 
            v-model="form.author" 
            placeholder="请输入作者姓名" 
            size="large"
            clearable
          /&gt;
        &lt;/el-form-item&gt;
        
        &lt;el-form-item label="文章内容" prop="content"&gt;
          &lt;el-input
            v-model="form.content"
            type="textarea"
            :rows="15"
            placeholder="请输入文章内容，支持 Markdown 格式..."
            resize="none"
          /&gt;
          &lt;div class="editor-tips"&gt;
            &lt;el-tag type="info" size="small"&gt;
              &lt;el-icon&gt;&lt;InfoFilled /&gt;&lt;/el-icon&gt;
              提示：您可以使用 Markdown 语法格式化文本
            &lt;/el-tag&gt;
          &lt;/div&gt;
        &lt;/el-form-item&gt;
        
        &lt;el-form-item&gt;
          &lt;el-button 
            type="primary" 
            @click="submitForm" 
            :loading="submitting"
            size="large"
            class="submit-btn"
          &gt;
            {{ isEditMode ? '更新文章' : '发布文章' }}
          &lt;/el-button&gt;
          &lt;el-button 
            @click="$router.back()" 
            size="large"
          &gt;
            取消
          &lt;/el-button&gt;
        &lt;/el-form-item&gt;
      &lt;/el-form&gt;
    &lt;/el-card&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, reactive, onMounted } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { ElMessage } from 'element-plus'
import { blogApi } from '../api/blog'
import { InfoFilled } from '@element-plus/icons-vue'

const route = useRoute()
const router = useRouter()
const formRef = ref(null)
const submitting = ref(false)

// 判断是否为编辑模式
const isEditMode = route.name === 'edit-blog'

// 表单数据
const form = reactive({
  title: '',
  author: '',
  content: ''
})

// 表单验证规则
const rules = {
  title: [
    { required: true, message: '请输入文章标题', trigger: 'blur' },
    { min: 3, message: '标题长度至少 3 个字符', trigger: 'blur' },
    { max: 100, message: '标题长度不能超过 100 个字符', trigger: 'blur' }
  ],
  author: [
    { required: true, message: '请输入作者姓名', trigger: 'blur' },
    { min: 2, message: '作者姓名至少 2 个字符', trigger: 'blur' },
    { max: 50, message: '作者姓名不能超过 50 个字符', trigger: 'blur' }
  ],
  content: [
    { required: true, message: '请输入文章内容', trigger: 'blur' },
    { min: 10, message: '文章内容至少 10 个字符', trigger: 'blur' }
  ]
}

// 编辑模式下加载数据
const loadBlogData = async () =&gt; {
  if (!isEditMode) return
  
  try {
    const id = parseInt(route.params.id)
    const response = await blogApi.getBlogById(id)
    const blog = response.data
    
    form.title = blog.title
    form.author = blog.author
    form.content = blog.content
  } catch (error) {
    ElMessage.error('加载文章失败：' + error.message)
    router.push('/blogs')
  }
}

// 提交表单
const submitForm = async () =&gt; {
  if (!formRef.value) return
  
  try {
    await formRef.value.validate()
    submitting.value = true
    
    if (isEditMode) {
      const id = parseInt(route.params.id)
      await blogApi.updateBlog(id, {
        ...form
      })
      ElMessage.success('文章更新成功')
    } else {
      await blogApi.createBlog({
        ...form
      })
      ElMessage.success('文章创建成功')
    }
    
    router.push('/blogs')
  } catch (error) {
    if (error.name !== 'ValidationError') {
      ElMessage.error(isEditMode ? '更新失败：' + error.message : '创建失败：' + error.message)
    }
  } finally {
    submitting.value = false
  }
}

onMounted(() =&gt; {
  loadBlogData()
})
&lt;/script&gt;

&lt;style scoped&gt;
.blog-editor {
  padding: 20px;
  max-width: 800px;
  margin: 0 auto;
}

.page-header {
  margin-bottom: 20px;
}

.editor-card {
  border: none;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
}

.editor-card :deep(.el-card__header) {
  border-bottom: 1px solid #e4e7ed;
  padding: 20px;
}

.editor-card h3 {
  margin: 0;
  color: #333;
  font-size: 18px;
}

.blog-form {
  padding: 10px;
}

.editor-tips {
  margin-top: 10px;
}

.submit-btn {
  min-width: 120px;
}

@media (max-width: 768px) {
  .blog-editor {
    padding: 10px;
  }
  
  .editor-card {
    margin: 0 -10px;
  }
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-23">3. 运行说明</h3>
<ol>
<li><strong>启动后端服务</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> backend
python main.py
<span class="hljs-comment"># 后端将在 http://localhost:8000 运行</span>
</code></pre>
<ol start="2">
<li><strong>启动前端服务</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> frontend
npm run dev
<span class="hljs-comment"># 前端将在 http://localhost:5173 运行</span>
</code></pre>
<ol start="3">
<li><strong>配置跨域</strong>：后端代码中已经配置了CORS，允许所有源访问。</li>
</ol>
<h3 data-id="heading-24">4. 功能特点</h3>
<ol>
<li><strong>响应式设计</strong>：适配桌面端和移动端</li>
<li><strong>完整CRUD操作</strong>：
<ul>
<li>创建博客文章</li>
<li>查看博客列表</li>
<li>查看博客详情</li>
<li>编辑博客文章</li>
<li>删除博客文章</li>
</ul>
</li>
<li><strong>用户体验优化</strong>：
<ul>
<li>加载状态指示</li>
<li>操作确认对话框</li>
<li>表单验证</li>
<li>错误处理</li>
</ul>
</li>
<li><strong>美观的UI</strong>：使用Element Plus组件，现代化设计</li>
<li><strong>API集成</strong>：与FastAPI后端无缝集成</li>
</ol>
<p>这个前端应用提供了一个完整的博客管理界面，用户可以方便地管理博客文章，所有操作都会通过API与后端交互。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vavr 用户指南]]></title>    <link>https://juejin.cn/post/7593215107405430820</link>    <guid>https://juejin.cn/post/7593215107405430820</guid>    <pubDate>2026-01-09T15:31:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593215107405430820" data-draft-id="7592990758476906515" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vavr 用户指南"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-09T15:31:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SnrtIevg"/> <meta itemprop="url" content="https://juejin.cn/user/3087084381015342"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vavr 用户指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3087084381015342/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SnrtIevg
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:31:31.000Z" title="Fri Jan 09 2026 15:31:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读26分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Daniel Dietrich, Robert Winkler, Grzegorz Piwowarek</strong><br/>
<strong>版本 0.11.0，</strong><br/>
<strong>2025-12-16</strong></p>
<h2 data-id="heading-0">1. 引言</h2>
<p>Vavr（原名 Javaslang）是一个用于 Java 8+ 的函数式库，提供持久化数据类型和函数式控制结构。</p>
<h3 data-id="heading-1">1.1. 在 Java 8 中使用 Vavr 的函数式数据结构</h3>
<p>Java 8 的 lambda（λ）使我们能够创建出色的 API。它们极大地提高了语言的表达能力。</p>
<p>Vavr 利用 lambda 基于函数式模式创建了各种新特性。其中之一是一个旨在替代 Java 标准集合的函数式集合库。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66b1565166ce46409c5fc0e4d83ab8e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU25ydElldmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577746&amp;x-signature=9cTvHyecu94bZfZrCYfkypHjL8o%3D" alt="这只是一个鸟瞰图，你会在下面找到一个人类可读的版本" loading="lazy"/></p>
<h3 data-id="heading-2">1.2. 函数式编程</h3>
<p>在我们深入探讨数据结构的细节之前，我想先谈谈一些基础知识。这将清楚地说明我为什么创建 Vavr，特别是新的 Java 集合。</p>
<h4 data-id="heading-3">1.2.1. 副作用</h4>
<p>Java 应用程序通常充满了副作用。它们会改变某种状态，也许是外部世界。常见的副作用包括就地更改对象或变量、打印到控制台、写入日志文件或数据库。如果副作用以不良方式影响我们程序的语义，则被认为是有害的。</p>
<p>例如，如果一个函数抛出异常并且这个异常被解释，它就被认为是一个影响我们程序的副作用。此外，异常就像非局部的 goto 语句。它们破坏了正常的控制流。然而，现实世界的应用程序确实会执行副作用。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">int</span> <span class="hljs-title function_">divide</span><span class="hljs-params">(<span class="hljs-type">int</span> dividend, <span class="hljs-type">int</span> divisor)</span> {    
	<span class="hljs-comment">// 如果除数为零则抛出异常    </span>
	<span class="hljs-keyword">return</span> dividend / divisor;
}
</code></pre>
<p>在函数式环境中，我们处于有利地位，可以将副作用封装在 <code>Try</code> 中：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = Success(result) 或 Failure(exception)</span>
Try&lt;Integer&gt; <span class="hljs-title function_">divide</span><span class="hljs-params">(Integer dividend, Integer divisor)</span> {    
	<span class="hljs-keyword">return</span> Try.of(() -&gt; dividend / divisor);
}
</code></pre>
<p>这个版本的 <code>divide</code> 不再抛出任何异常。我们通过使用 <code>Try</code> 类型使可能的失败变得明确。</p>
<h4 data-id="heading-4">1.2.2. 引用透明性</h4>
<p>如果一个函数，或者更一般地说，一个表达式，其调用可以被其值替换而不影响程序的行为，则称其为引用透明的。简单来说，给定相同的输入，输出总是相同的。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 不是引用透明的</span>
Math.random();
<span class="hljs-comment">// 引用透明的</span>
Math.max(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
</code></pre>
<p>如果所有涉及的表达式都是引用透明的，则称该函数为纯函数。由纯函数组成的应用程序很可能在编译后就能正常工作。我们能够推理它。单元测试易于编写，调试成为过去式。</p>
<h4 data-id="heading-5">1.2.3. 值编程思想</h4>
<p>Rich Hickey，Clojure 的创造者，做了一个关于《值的价值》的精彩演讲。最有趣的值是不可变值。主要原因是不可变值：</p>
<ul>
<li>本质上是线程安全的，因此不需要同步</li>
<li>在 <code>equals</code> 和 <code>hashCode</code> 方面是稳定的，因此是可靠的哈希键</li>
<li>不需要克隆</li>
<li>在未检查的协变转换中使用时表现类型安全（Java 特有）</li>
</ul>
<p>更好的 Java 的关键在于使用不可变值并结合引用透明的函数。
Vavr 提供了必要的控制和集合，以在日常 Java 编程中实现这一目标。</p>
<h3 data-id="heading-6">1.3. 数据结构概述</h3>
<p>Vavr 的集合库包含一套丰富的基于 lambda 构建的函数式数据结构。它们与 Java 原始集合共享的唯一接口是 <code>Iterable</code>。主要原因是 Java 集合接口的修改器方法不返回底层集合类型的对象。</p>
<p>通过查看不同类型的数据结构，我们将明白为什么这一点如此重要。</p>
<h4 data-id="heading-7">1.3.1. 可变数据结构</h4>
<p>Java 是一种面向对象的编程语言。我们将状态封装在对象中以实现数据隐藏，并提供修改器方法来控制状态。Java 集合框架（JCF）就是建立在这个思想之上的。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Collection</span>&lt;E&gt; {    
	<span class="hljs-comment">// 从此集合中移除所有元素    </span>
	<span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span>;
}
</code></pre>
<p>如今，我将 <code>void</code> 返回类型视为一种代码异味。它表明发生了副作用，状态被改变了。共享的可变状态是失败的重要来源，不仅是在并发环境中。</p>
<h4 data-id="heading-8">1.3.2. 不可变数据结构</h4>
<p>不可变数据结构在创建后不能被修改。在 Java 的上下文中，它们以集合包装器的形式被广泛使用。</p>
<pre><code class="hljs language-Java" lang="Java">List&lt;String&gt; list = Collections.unmodifiableList(otherList);
<span class="hljs-comment">// 报错！list.add("why not?");</span>
</code></pre>
<p>有各种库为我们提供了类似的工具方法。结果始终是特定集合的不可修改视图。通常，当我们调用修改器方法时，它会在运行时抛出异常。</p>
<h4 data-id="heading-9">1.3.3. 持久化数据结构</h4>
<p>持久化数据结构在修改时会保留自身的先前版本，因此实际上是<strong>不可变的</strong>。完全持久化数据结构允许对任何版本进行更新和查询。</p>
<p>许多操作只进行小的更改。仅仅复制前一个版本效率不高。为了节省时间和内存，识别两个版本之间的相似性并尽可能共享数据至关重要。</p>
<p>这个模型没有强加任何实现细节。这时函数式数据结构就登场了。</p>
<h3 data-id="heading-10">1.4. 函数式数据结构</h3>
<p>也称为纯函数式数据结构，它们是不可变且持久的。函数式数据结构的方法是引用透明的。</p>
<p>Vavr 提供了最常用的函数式数据结构。以下示例将深入解释。</p>
<h4 data-id="heading-11">1.4.1. 链表</h4>
<p>最流行也是最简单的函数式数据结构之一是（单向）链表。它有一个头元素和一个尾链表。链表的行为类似于遵循后进先出（LIFO）方法的栈。</p>
<p>在 Vavr 中，我们这样实例化一个 <code>List</code>：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = List(1, 2, 3)</span>
List&lt;Integer&gt; list1 = List.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
</code></pre>
<p>每个 <code>List</code> 元素形成一个单独的链表节点。最后一个元素的尾部是 <code>Nil</code>，即空列表。
这使我们能够在 <code>List</code> 的不同版本之间共享元素。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = List(0, 2, 3)List&lt;Integer&gt; </span>
list2 = list1.tail().prepend(<span class="hljs-number">0</span>);
</code></pre>
<p>新的头元素 <code>0</code> 链接到原始 <code>List</code> 的尾部。原始 <code>List</code> 保持不变。</p>
<p>这些操作在常数时间内完成，换句话说，它们与 <code>List</code> 的大小无关。大多数其他操作需要线性时间。在 Vavr 中，这通过接口 <code>LinearSeq</code> 表示，我们可能已经从 Scala 中了解它。</p>
<p>如果我们需要在常数时间内可查询的数据结构，Vavr 提供了 <code>Array</code> 和 <code>Vector</code>。两者都具有随机访问能力。</p>
<p><code>Array</code> 类型由 Java 对象数组支持。插入和删除操作需要线性时间。<code>Vector</code> 介于 <code>Array</code> 和 <code>List</code> 之间。它在随机访问和修改两个领域都表现良好。</p>
<p>事实上，链表也可以用来实现队列数据结构。</p>
<h4 data-id="heading-12">1.4.2. 队列</h4>
<p>基于两个链表可以实现一个非常高效的函数式队列。前 <code>List</code> 保存要出列的元素，后 <code>List</code> 保存要入列的元素。入列和出列操作都在 O(1) 时间内执行。</p>
<pre><code class="hljs language-Java" lang="Java">Queue&lt;Integer&gt; queue = Queue.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
							.enqueue(<span class="hljs-number">4</span>)
							.enqueue(<span class="hljs-number">5</span>);
</code></pre>
<p>初始队列由三个元素创建。两个元素被入列到后 <code>List</code>。
如果出列时前 <code>List</code> 的元素用完，后 <code>List</code> 会被反转并成为新的前 <code>List</code>。
出列一个元素时，我们得到第一个元素和剩余队列的配对。必须返回队列的新版本，因为函数式数据结构是不可变且持久的。原始队列不受影响。</p>
<pre><code class="hljs language-Java" lang="Java">Queue&lt;Integer&gt; queue = Queue.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
<span class="hljs-comment">// = (1, Queue(2, 3))</span>
Tuple2&lt;Integer, Queue&lt;Integer&gt;&gt; dequeued = queue.dequeue();
</code></pre>
<p>当队列为空时会发生什么？那么 <code>dequeue()</code> 将抛出 <code>NoSuchElementException</code>。要以函数式的方式处理，我们更希望得到一个可选结果。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = Some((1, Queue()))</span>
Queue.of(<span class="hljs-number">1</span>).dequeueOption();
<span class="hljs-comment">// = None</span>
Queue.empty().dequeueOption();
</code></pre>
<p>无论是否为空，可选结果都可以被进一步处理。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = Queue(1)</span>
Queue&lt;Integer&gt; queue = Queue.of(<span class="hljs-number">1</span>);
<span class="hljs-comment">// = Some((1, Queue()))</span>
Option&lt;Tuple2&lt;Integer, Queue&lt;Integer&gt;&gt;&gt; dequeued = queue.dequeueOption();
<span class="hljs-comment">// = Some(1)</span>
Option&lt;Integer&gt; element = dequeued.map(Tuple2::_1);
<span class="hljs-comment">// = Some(Queue())</span>
Option&lt;Queue&lt;Integer&gt;&gt; remaining = dequeued.map(Tuple2::_2);
</code></pre>
<h4 data-id="heading-13">1.4.3. 有序集合</h4>
<p>有序集合是比队列更常用的数据结构。我们使用二叉搜索树以函数式方式对它们进行建模。这些树由最多有两个子节点的节点组成，每个节点都有值。</p>
<p>我们在存在排序的情况下构建二叉搜索树，由元素 <code>Comparator</code> 表示。任何给定节点的左子树的所有值都严格小于给定节点的值。右子树的所有值都严格大于。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = TreeSet(1, 2, 3, 4, 6, 7, 8)</span>
SortedSet&lt;Integer&gt; xs = TreeSet.of(<span class="hljs-number">6</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>);
</code></pre>
<p>在此类树上的搜索在 O(log n) 时间内运行。我们从根开始搜索，决定是否找到了元素。由于值的全序性，我们知道接下来要在哪里搜索，在当前树的左分支还是右分支。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = TreeSet(1, 2, 3);</span>
SortedSet&lt;Integer&gt; set = TreeSet.of(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-comment">// = TreeSet(3, 2, 1);</span>
Comparator&lt;Integer&gt; c = (a, b) -&gt; b - a;
SortedSet&lt;Integer&gt; reversed = TreeSet.of(c, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
</code></pre>
<p>大多数树操作本质上是递归的。插入函数的行为类似于搜索函数。当到达搜索路径的末端时，会创建一个新节点，并重建整个路径直到根节点。尽可能引用现有的子节点。因此，插入操作需要 O(log n) 的时间和空间。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = TreeSet(1, 2, 3, 4, 5, 6, 7, 8)</span>
SortedSet&lt;Integer&gt; ys = xs.add(<span class="hljs-number">5</span>);
</code></pre>
<p>为了保持二叉搜索树的性能特征，需要保持其平衡。从根到叶子的所有路径需要大致相同的长度。</p>
<p>在 Vavr 中，我们基于红黑树实现了一个二叉搜索树。它使用特定的着色策略来在插入和删除时保持树的平衡。要了解更多关于这个主题的信息，请参阅 Chris Okasaki 的《纯函数式数据结构》一书。</p>
<h3 data-id="heading-14">1.5. 集合的现状</h3>
<p>总的来说，我们观察到编程语言正在趋同。好的特性得以保留，其他的则消失。但 Java 不同，它永远需要向后兼容。这是一种优势，但也减缓了进化。</p>
<p>Lambda 使 Java 和 Scala 更加接近，但它们仍然如此不同。Scala 的创造者 Martin Odersky 最近在他 2015 年的 BDSBTB 主题演讲中提到了 Java 8 集合的现状。</p>
<p>他将 Java 的 <code>Stream</code> 描述为 <code>Iterator</code> 的一种高级形式。Java 8 Stream API 是<strong>提升集合</strong>的一个例子。它的作用是定义一个计算，并在另一个明确的步骤中将其链接到特定的集合。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// i + 1</span>
i.prepareForAddition()
	.add(<span class="hljs-number">1</span>)
	.mapBackToInteger(Mappers.toInteger())
</code></pre>
<p>这就是新的 Java 8 Stream API 的工作方式。它是众所周知的 Java 集合之上的一个计算层。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = ["1", "2", "3"] in Java 8</span>
Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
	.stream()
	.map(Object::toString)
	.collect(Collectors.toList())
</code></pre>
<p>Vavr 深受 <code>Scala</code> 的启发。这应该是 Java 8 中上述例子的样子。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = Stream("1", "2", "3") in Vavr</span>
Stream.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).map(Object::toString)
</code></pre>
<p>在过去的一年里，我们投入了大量精力来实现 Vavr 集合库。它包含了最广泛使用的集合类型。</p>
<h4 data-id="heading-15">1.5.1. Seq</h4>
<p>我们通过实现顺序类型开始了我们的旅程。上面我们已经描述了链表。接着是 <code>Stream</code>，一个惰性链表。它允许我们处理可能无限长的元素序列。</p>
<p>所有集合都是 <code>Iterable</code> 的，因此可以在增强的 for 语句中使用。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">for</span> (String s : List.of(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Advent"</span>)) {    
	<span class="hljs-comment">// 副作用和突变</span>
}
</code></pre>
<p>我们也可以通过内化循环并使用 lambda 注入行为来实现同样的效果。</p>
<pre><code class="hljs language-Java" lang="Java">List.of(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Advent"</span>).forEach(s -&gt; {    
	<span class="hljs-comment">// 副作用和突变</span>
});
</code></pre>
<p>无论如何，正如我们之前看到的，我们更喜欢返回值的表达式，而不是什么都不返回的语句。通过看一个简单的例子，我们很快就会发现语句增加了噪音，并分割了本应在一起的东西。</p>
<pre><code class="hljs language-Java" lang="Java">String <span class="hljs-title function_">join</span><span class="hljs-params">(String... words)</span> {
	<span class="hljs-type">StringBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
	<span class="hljs-keyword">for</span>(String s : words) {
		<span class="hljs-keyword">if</span> (builder.length() &gt; <span class="hljs-number">0</span>) {
			builder.append(<span class="hljs-string">", "</span>);
		}
		builder.append(s);
	}
	<span class="hljs-keyword">return</span> builder.toString();
}
</code></pre>
<p>Vavr 集合为我们提供了许多函数来操作底层元素。这使我们能够以非常简洁的方式表达事物。</p>
<pre><code class="hljs language-Java" lang="Java">String <span class="hljs-title function_">join</span><span class="hljs-params">(String... words)</span> {
	<span class="hljs-keyword">return</span> List.of(words)
			.intersperse(<span class="hljs-string">", "</span>)
			.foldLeft(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(), StringBuilder::append)
			.toString();
}
</code></pre>
<p>大多数目标都可以使用 Vavr 以各种方式实现。在这里，我们将整个方法体简化为对 <code>List</code> 实例的流畅函数调用。我们甚至可以删除整个方法，直接使用我们的 <code>List</code> 来获取计算结果。</p>
<pre><code class="hljs language-Java" lang="Java">List.of(words).mkString(<span class="hljs-string">", "</span>);
</code></pre>
<p>在现实世界的应用程序中，我们现在能够大幅减少代码行数，从而降低错误风险。</p>
<h4 data-id="heading-16">1.5.2. Set 和 Map</h4>
<p>序列很棒。但为了完整，一个集合库还需要不同类型的 <code>Set</code> 和 <code>Map</code>。</p>
<p>我们描述了如何使用二叉树结构来建模有序集合。有序 <code>Map</code> 不过是一个包含键值对并对键有排序的有序 <code>Set</code>。</p>
<p><code>HashMap</code> 的实现由哈希数组映射字典树（HAMT）支持。相应地，<code>HashSet</code> 由包含键-键对的 HAMT 支持。</p>
<p>我们的 <code>Map</code> 没有特殊的 <code>Entry</code> 类型来表示键值对。相反，我们使用已经是 Vavr 一部分的 <code>Tuple2</code>。元组的字段是枚举的。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = (1, "A")</span>
Tuple2&lt;Integer, String&gt; entry = Tuple.of(<span class="hljs-number">1</span>, <span class="hljs-string">"A"</span>);
<span class="hljs-type">Integer</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> entry._1;
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> entry._2;
</code></pre>
<p><code>Map</code> 和 <code>Tuple</code> 在 Vavr 中被广泛使用。<code>Tuple</code> 对于以通用方式处理多值返回类型是必不可少的。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = HashMap((0, List(2, 4)), (1, List(1, 3)))</span>
List.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>).groupBy(i -&gt; i % <span class="hljs-number">2</span>);
<span class="hljs-comment">// = List((a, 0), (b, 1), (c, 2))</span>
List.of(<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>).zipWithIndex();
</code></pre>
<p>在 Vavr，我们通过实现 99 个欧拉问题来探索和测试我们的库。这是一个很好的概念验证。请不要犹豫发送拉取请求。</p>
<h2 data-id="heading-17">3. 使用指南</h2>
<p>Vavr 附带了一些最基本类型的精心设计的表示，这些类型在 Java 中显然缺失或简陋：<code>Tuple</code>、<code>Value</code> 和 <code>λ</code>。
在 Vavr 中，一切都建立在这三个基本构建块之上。</p>
<h3 data-id="heading-18">3.1. 元组</h3>
<p>Java 缺少元组的一般概念。元组将固定数量的元素组合在一起，以便它们可以作为一个整体传递。与数组或列表不同，元组可以容纳不同类型的对象，但它们也是不可变的。</p>
<p>元组的类型是 <code>Tuple1</code>、<code>Tuple2</code>、<code>Tuple3</code> 等等。
目前最多有 8 个元素的上限。要访问元组 <code>t</code> 的元素，可以使用方法 <code>t._1</code> 访问第一个元素，<code>t._2</code> 访问第二个，依此类推。</p>
<h4 data-id="heading-19">3.1.1. 创建元组</h4>
<p>以下是如何创建一个包含 <code>String</code> 和 <code>Integer</code> 的元组的示例：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// (Java, 8)</span>
Tuple2&lt;String, Integer&gt; java8 = Tuple.of(<span class="hljs-string">"Java"</span>, <span class="hljs-number">8</span>); 
<span class="hljs-comment">// "Java"</span>
<span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> java8._1; 
<span class="hljs-comment">// 8</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> java8._2; 
</code></pre>
<p>元组是通过静态工厂方法 <code>Tuple.of()</code> 创建的。获取此元组的第 1 个元素。获取此元组的第 2 个元素。</p>
<h4 data-id="heading-20">3.1.2. 按组件映射元组</h4>
<p>按组件映射对元组中的每个元素求值一个函数，返回另一个元组。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// (vavr, 1)</span>
Tuple2&lt;String, Integer&gt; that = java8.map(
	s -&gt; s.substring(<span class="hljs-number">2</span>) + <span class="hljs-string">"vr"</span>,
	i -&gt; i / <span class="hljs-number">8</span>
);
</code></pre>
<h4 data-id="heading-21">3.1.3. 使用单个映射器映射元组</h4>
<p>也可以使用一个映射函数来映射元组。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// (vavr, 1)</span>
Tuple2&lt;String, Integer&gt; that = java8.map(
	(s, i) -&gt; Tuple.of(s.substring(<span class="hljs-number">2</span>) + <span class="hljs-string">"vr"</span>, i / <span class="hljs-number">8</span>)
);
</code></pre>
<h4 data-id="heading-22">3.1.4. 转换元组</h4>
<p>转换基于元组的内容创建一个新类型。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// "vavr 1"</span>
<span class="hljs-type">String</span> <span class="hljs-variable">that</span> <span class="hljs-operator">=</span> java8.apply(
	(s, i) -&gt; s.substring(<span class="hljs-number">2</span>) + <span class="hljs-string">"vr "</span> + i / <span class="hljs-number">8</span>
);
</code></pre>
<h3 data-id="heading-23">3.2. 函数</h3>
<p>函数式编程就是关于值和使用函数对值进行转换。Java 8 只提供了一个接受一个参数的 <code>Function</code> 和一个接受两个参数的 <code>BiFunction</code>。
Vavr 提供了最多 8 个参数的函数。函数式接口称为 <code>Function0</code>、<code>Function1</code>、<code>Function2</code>、<code>Function3</code> 等等。
如果你需要一个抛出受检异常的函数，可以使用 <code>CheckedFunction1</code>、<code>CheckedFunction2</code> 等等。</p>
<p>以下 <code>lambda</code> 表达式创建一个函数来对两个整数求和：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// sum.apply(1, 2) = 3</span>
Function2&lt;Integer, Integer, Integer&gt; sum = (a, b) -&gt; a + b;
</code></pre>
<p>这是以下匿名类定义的简写：</p>
<pre><code class="hljs language-java" lang="java">Function2&lt;Integer, Integer, Integer&gt; sum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function2</span>&lt;Integer, Integer, Integer&gt;() {
	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">apply</span><span class="hljs-params">(Integer a, Integer b)</span> {
		<span class="hljs-keyword">return</span> a + b;    
	}
};
</code></pre>
<p>你也可以使用静态工厂方法 <code>Function3.of(…)</code> 从任何方法引用创建函数。</p>
<pre><code class="hljs language-Java" lang="Java">Function3&lt;String, String, String, String&gt; function3 = Function3.of(<span class="hljs-built_in">this</span>::methodWhichAccepts3Parameters);
</code></pre>
<p>事实上，Vavr 函数式接口是增强版的 Java 8 函数式接口。它们还提供以下特性：</p>
<ul>
<li>组合</li>
<li>提升</li>
<li>柯里化</li>
<li>记忆化</li>
</ul>
<h4 data-id="heading-24">3.2.1. 组合</h4>
<p>你可以组合函数。在数学中，函数组合是将一个函数应用于另一个函数的结果以产生第三个函数。例如，函数<code> f : X → Y</code> 和 <code>g : Y → Z</code> 可以组合产生一个函数<code> h: g(f(x))</code>，它将 X 映射到 Z。</p>
<p>你可以使用 <code>andThen</code>：</p>
<pre><code class="hljs language-java" lang="java">Function1&lt;Integer, Integer&gt; plusOne = a -&gt; a + <span class="hljs-number">1</span>;
Function1&lt;Integer, Integer&gt; multiplyByTwo = a -&gt; a * <span class="hljs-number">2</span>;
Function1&lt;Integer, Integer&gt; add1AndMultiplyBy2 = plusOne.andThen(multiplyByTwo);
then(add1AndMultiplyBy2.apply(<span class="hljs-number">2</span>)).isEqualTo(<span class="hljs-number">6</span>);
</code></pre>
<p>或者 <code>compose</code>：</p>
<pre><code class="hljs language-Java" lang="Java">Function1&lt;Integer, Integer&gt; add1AndMultiplyBy2 = multiplyByTwo.compose(plusOne);
then(add1AndMultiplyBy2.apply(<span class="hljs-number">2</span>)).isEqualTo(<span class="hljs-number">6</span>);
</code></pre>
<h4 data-id="heading-25">3.2.2. 提升</h4>
<p>你可以将一个部分函数提升为一个返回 <code>Option</code> 结果的总函数。术语“部分函数”来自数学。从 X 到 Y 的部分函数是函数 f: X′ → Y，其中 X′ 是 X 的某个子集。它通过不强制 f 将 X 的每个元素映射到 Y 的元素来推广函数 f: X → Y 的概念。这意味着部分函数仅对某些输入值正常工作。如果使用不允许的输入值调用该函数，它通常会抛出异常。</p>
<p>以下方法 <code>divide</code> 是一个只接受非零除数的部分函数。</p>
<pre><code class="hljs language-java" lang="java">Function2&lt;Integer, Integer, Integer&gt; divide = (a, b) -&gt; a / b;
</code></pre>
<p>我们使用 <code>lift</code> 将 <code>divide</code> 转换为一个对所有输入都有定义的总函数。</p>
<pre><code class="hljs language-Java" lang="Java">Function2&lt;Integer, Integer, Option&lt;Integer&gt;&gt; safeDivide = Function2.lift(divide);
<span class="hljs-comment">// = None</span>
Option&lt;Integer&gt; i1 = safeDivide.apply(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>); 
<span class="hljs-comment">// = Some(2)</span>
Option&lt;Integer&gt; i2 = safeDivide.apply(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>); 
</code></pre>
<p>如果使用不允许的输入值调用提升函数，则返回 <code>None</code> 而不是抛出异常。如果使用允许的输入值调用提升函数，则返回 <code>Some</code>。</p>
<p>以下方法 <code>sum</code> 是一个只接受正整数的部分函数。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> first, <span class="hljs-type">int</span> second)</span> {
	<span class="hljs-keyword">if</span> (first &lt; <span class="hljs-number">0</span> || second &lt; <span class="hljs-number">0</span>) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Only positive integers are allowed"</span>);
	}
	<span class="hljs-keyword">return</span> first + second;
}
</code></pre>
<p>函数 <code>sum</code> 对负输入值抛出 <code>IllegalArgumentException</code>。
我们可以通过提供方法引用来提升<code>sum</code>方法。</p>
<pre><code class="hljs language-java" lang="java">Function2&lt;Integer, Integer, Option&lt;Integer&gt;&gt; sum = Function2.lift(<span class="hljs-built_in">this</span>::sum);
<span class="hljs-comment">// = None</span>
Option&lt;Integer&gt; optionalResult = sum.apply(-<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); 
</code></pre>
<p>提升后的函数捕获 <code>IllegalArgumentException</code> 并将其映射到 <code>None</code>。</p>
<h4 data-id="heading-26">3.2.3. 部分应用</h4>
<p>部分应用允许你通过固定一些值从现有函数派生新函数。你可以固定一个或多个参数，固定参数的数量定义了新函数的元数，使得新元数 = (原始元数 - 固定参数)。参数从左到右绑定。</p>
<pre><code class="hljs language-java" lang="java">Function2&lt;Integer, Integer, Integer&gt; sum = (a, b) -&gt; a + b;
Function1&lt;Integer, Integer&gt; add2 = sum.apply(<span class="hljs-number">2</span>); 
then(add2.apply(<span class="hljs-number">4</span>)).isEqualTo(<span class="hljs-number">6</span>);
</code></pre>
<p>第一个参数 <code>a</code> 被固定为值 2。</p>
<p>这可以通过固定 <code>Function5</code> 的前三个参数来演示，结果是一个 <code>Function2</code>。</p>
<pre><code class="hljs language-Java" lang="Java">Function5&lt;Integer, Integer, Integer, Integer, Integer, Integer&gt; sum = (a, b, c, d, e) -&gt; a + b + c + d + e;
Function2&lt;Integer, Integer, Integer&gt; add6 = sum.apply(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>); 
then(add6.apply(<span class="hljs-number">4</span>, <span class="hljs-number">3</span>)).isEqualTo(<span class="hljs-number">13</span>);
</code></pre>
<p><code>a</code>、<code>b</code> 和 <code>c</code> 参数分别被固定为值 2、3 和 1。
部分应用与柯里化不同，将在相关章节中探讨。</p>
<h4 data-id="heading-27">3.2.4. 柯里化</h4>
<p>柯里化是一种通过为其中一个参数固定值来部分应用函数的技术，产生一个返回 <code>Function1</code> 的 <code>Function1</code>。</p>
<p>当 <code>Function2</code> 被柯里化时，结果与 <code>Function2</code> 的部分应用无法区分，因为两者都产生一个 1 元函数。</p>
<pre><code class="hljs language-Java" lang="Java">Function2&lt;Integer, Integer, Integer&gt; sum = (a, b) -&gt; a + b;
Function1&lt;Integer, Integer&gt; add2 = sum.curried().apply(<span class="hljs-number">2</span>); 
then(add2.apply(<span class="hljs-number">4</span>)).isEqualTo(<span class="hljs-number">6</span>);
</code></pre>
<p>第一个参数 <code>a</code> 被固定为值 2。</p>
<p>你可能会注意到，除了使用 <code>.curried()</code> 之外，这段代码与部分应用中给出的 2 元示例完全相同。对于更高元数的函数，区别就变得清晰了。</p>
<pre><code class="hljs language-java" lang="java">Function3&lt;Integer, Integer, Integer, Integer&gt; sum = (a, b, c) -&gt; a + b + c;
<span class="hljs-keyword">final</span> Function1&lt;Integer, Function1&lt;Integer, Integer&gt;&gt; add2 = sum.curried().apply(<span class="hljs-number">2</span>);
then(add2.apply(<span class="hljs-number">4</span>).apply(<span class="hljs-number">3</span>)).isEqualTo(<span class="hljs-number">9</span>);
</code></pre>
<p>注意参数中出现了额外的函数。除了最后一次调用外，对 <code>apply</code> 的进一步调用会返回另一个 <code>Function1</code>。</p>
<h4 data-id="heading-28">3.2.5. 记忆化</h4>
<p>记忆化是一种缓存形式。记忆化的函数只执行一次，然后从缓存返回结果。</p>
<p>以下示例在第一次调用时计算一个随机数，在第二次调用时返回缓存的数字。</p>
<pre><code class="hljs language-Java" lang="Java">Function0&lt;Double&gt; hashCache = Function0.of(Math::random).memoized();
<span class="hljs-type">double</span> <span class="hljs-variable">randomValue1</span> <span class="hljs-operator">=</span> hashCache.apply();
<span class="hljs-type">double</span> <span class="hljs-variable">randomValue2</span> <span class="hljs-operator">=</span> hashCache.apply();
then(randomValue1).isEqualTo(randomValue2);
</code></pre>
<h3 data-id="heading-29">3.3. 值类型</h3>
<p>在函数式环境中，我们将值视为一种范式，一种无法进一步求值的表达式。在 Java 中，我们通过将对象的状态设为 <code>final</code> 并称之为不可变来表达这一点。</p>
<p>Vavr 的函数式 <code>Value</code> 抽象了不可变对象。通过在实例之间共享不可变内存来添加高效的写操作。我们免费获得了线程安全性！</p>
<h4 data-id="heading-30">3.3.1. Option</h4>
<p><code>Option</code> 是一个单子容器类型，表示一个可选值。<code>Option</code> 的实例要么是 <code>Some</code> 的实例，要么是 <code>None</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 可选值，不再有 null</span>
Option&lt;T&gt; option = Option.of(...);
</code></pre>
<p>如果你在使用<code>Java</code>的 <code>Optional</code> 类之后转到 Vavr，有一个关键的区别。在 <code>Optional</code> 中，导致 <code>null</code> 的 <code>.map</code> 调用将导致空的 <code>Optional</code>。在 Vavr 中，它将导致 <code>Some(null)</code>，然后可能导致 <code>NullPointerException</code>。</p>
<p>使用 <code>Optional</code>，这个场景是有效的。</p>
<pre><code class="hljs language-java" lang="java">Optional&lt;String&gt; maybeFoo = Optional.of(<span class="hljs-string">"foo"</span>); 
then(maybeFoo.get()).isEqualTo(<span class="hljs-string">"foo"</span>);

Optional&lt;String&gt; maybeFooBar = maybeFoo.map(s -&gt; (String)<span class="hljs-literal">null</span>)
                                         .map(s -&gt; s.toUpperCase() + <span class="hljs-string">"bar"</span>);
then(maybeFooBar.isPresent()).isFalse();
</code></pre>
<p>该选项是 <code>Some("foo")</code>结果选项在这里变为空</p>
<p>使用 Vavr 的 <code>Option</code>，相同的场景将导致 <code>NullPointerException</code>。</p>
<pre><code class="hljs language-Java" lang="Java">Option&lt;String&gt; maybeFoo = Option.of(<span class="hljs-string">"foo"</span>); then(maybeFoo.get()).isEqualTo(<span class="hljs-string">"foo"</span>);
<span class="hljs-keyword">try</span> {
	maybeFoo.map(s -&gt; (String)<span class="hljs-literal">null</span>)
			.map(s -&gt; s.toUpperCase() + <span class="hljs-string">"bar"</span>);
	Assert.fail();
} <span class="hljs-keyword">catch</span> (NullPointerException e) {   
	 <span class="hljs-comment">// 这显然不是正确的方法</span>
 }
</code></pre>
<p>该选项是 <code>Some("foo")</code>结果选项是 <code>Some(null)</code>对 <code>s.toUpperCase()</code> 的调用是在 null 上调用的</p>
<p>这看起来像是 Vavr 的实现有问题，但事实上并非如此——相反，它遵循了单子在调用 <code>.map</code> 时保持计算上下文的要求。就 <code>Option</code> 而言，这意味着在 <code>Some</code> 上调用 <code>.map</code> 将导致 <code>Some</code>，在 <code>None</code> 上调用 <code>.map</code> 将导致 <code>None</code>。在上面的 Java <code>Optional</code> 示例中，上下文从 <code>Some</code> 更改为 <code>None</code>。</p>
<p>这似乎使 <code>Option</code> 变得无用，但实际上它迫使你关注可能出现的 <code>null</code> 并相应地处理它们，而不是不知不觉地接受它们。处理 <code>null</code> 出现的正确方法是使用 <code>flatMap</code>。</p>
<pre><code class="hljs language-java" lang="java">Option&lt;String&gt; maybeFoo = Option.of(<span class="hljs-string">"foo"</span>); then(maybeFoo.get()).isEqualTo(<span class="hljs-string">"foo"</span>);
Option&lt;String&gt; maybeFooBar = maybeFoo.map(s -&gt; (String)<span class="hljs-literal">null</span>)                                      .flatMap(s -&gt; Option.of(s)                                                          .map(t -&gt; t.toUpperCase() + <span class="hljs-string">"bar"</span>));then(maybeFooBar.isEmpty()).isTrue();
</code></pre>
<p>该选项是 <code>Some("foo")</code>结果选项是 <code>Some(null)``s</code>（即 null）变为 <code>None</code></p>
<p>或者，将 <code>.flatMap</code> 移到与可能为 null 的值相同的位置。</p>
<pre><code class="hljs language-java" lang="java">Option&lt;String&gt; maybeFoo = Option.of(<span class="hljs-string">"foo"</span>); 
then(maybeFoo.get()).isEqualTo(<span class="hljs-string">"foo"</span>);
Option&lt;String&gt; maybeFooBar = maybeFoo.flatMap(s -&gt; Option.of((String)<span class="hljs-literal">null</span>))
                                      .map(s -&gt; s.toUpperCase() + <span class="hljs-string">"bar"</span>);
then(maybeFooBar.isEmpty()).isTrue();
</code></pre>
<p>该选项是 <code>Some("foo")</code>结果选项是 <code>None</code>
这在 Vavr 博客上有更详细的探讨。</p>
<h4 data-id="heading-31">3.3.2. Try</h4>
<p><code>Try</code> 是一个单子容器类型，表示一个可能产生异常或成功返回计算值的计算。它在语义上与 <code>Either</code> 相似但不同。<code>Try</code> 的实例要么是 <code>Success</code> 的实例，要么是 <code>Failure</code> 的实例。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 无需处理异常</span>
Try.of(() -&gt; bunchOfWork()).getOrElse(other);
</code></pre>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.vavr.API.*;        <span class="hljs-comment">// $, Case, Match</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.vavr.Predicates.*; <span class="hljs-comment">// instanceOf</span>
<span class="hljs-type">A</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Try.of(<span class="hljs-built_in">this</span>::bunchOfWork).recover(x -&gt; Match(x).of(
		Case($(instanceOf(Exception_1.class)), t -&gt; somethingWithException(t)),
		Case($(instanceOf(Exception_2.class)), t -&gt; somethingWithException(t)),
		Case($(instanceOf(Exception_n.class)), t -&gt; somethingWithException(t))
)).getOrElse(other);
</code></pre>
<h4 data-id="heading-32">3.3.3. Lazy</h4>
<p><code>Lazy</code> 是一个单子容器类型，表示一个惰性求值的值。与 <code>Supplier</code> 相比，<code>Lazy</code> 是记忆化的，即它只求值一次，因此是引用透明的。</p>
<pre><code class="hljs language-Java" lang="Java">Lazy&lt;Double&gt; lazy = Lazy.of(Math::random);
lazy.isEvaluated(); <span class="hljs-comment">// = false</span>
lazy.get();         <span class="hljs-comment">// = 0.123 (随机生成)</span>
lazy.isEvaluated(); <span class="hljs-comment">// = true</span>
lazy.get();         <span class="hljs-comment">// = 0.123 (已记忆)</span>
</code></pre>
<p>你也可以创建一个真正的惰性值（仅适用于接口）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">CharSequence</span> <span class="hljs-variable">chars</span> <span class="hljs-operator">=</span> Lazy.val(() -&gt; <span class="hljs-string">"Yay!"</span>, CharSequence.class);
</code></pre>
<h4 data-id="heading-33">3.3.4. Either</h4>
<p><code>Either</code> 表示两种可能类型的值。一个 <code>Either</code> 要么是 <code>Left</code>，要么是 <code>Right</code>。如果给定的 <code>Either</code> 是 <code>Right</code> 并投影到 <code>Left</code>，则 <code>Left</code> 操作对 <code>Right</code> 值没有影响。如果给定的 <code>Either</code> 是 <code>Left</code> 并投影到 <code>Right</code>，则 <code>Right</code> 操作对 <code>Left</code> 值没有影响。如果 <code>Left</code> 投影到 <code>Left</code> 或 <code>Right</code> 投影到 <code>Right</code>，则操作会生效。</p>
<p>示例：一个 <code>compute()</code> 函数，其结果要么是一个 <code>Integer</code> 值（成功时），要么是一个 <code>String</code> 类型的错误消息（失败时）。按照惯例，成功情况是 <code>Right</code>，失败是 <code>Left</code>。</p>
<pre><code class="hljs language-java" lang="java">Either&lt;String,Integer&gt; value = compute().right().map(i -&gt; i * <span class="hljs-number">2</span>).toEither();
</code></pre>
<p>如果 <code>compute()</code> 的结果是 <code>Right(1)</code>，则 <code>value</code> 是 <code>Right(2)</code>。
如果 <code>compute()</code> 的结果是 <code>Left("error")</code>，则 <code>value</code> 是 <code>Left("error")</code>。</p>
<h4 data-id="heading-34">3.3.5. Future</h4>
<p><code>Future</code> 是在某个时刻可用的计算结果。提供的所有操作都是非阻塞的。底层的 <code>ExecutorService</code> 用于执行异步处理程序，例如通过 <code>onComplete(…)</code>。</p>
<p><code>Future</code> 有两种状态：挂起和完成。</p>
<ul>
<li>挂起：计算正在进行中。只有挂起的 future 可以被完成或取消。</li>
<li>完成：计算成功完成并产生结果、因异常失败或被取消。</li>
</ul>
<p>可以在 <code>Future</code> 的任何时间点注册回调。这些操作在 <code>Future</code> 完成时立即执行。注册在已完成的 <code>Future</code> 上的操作会立即执行。该操作可能运行在单独的线程上，具体取决于底层的 <code>ExecutorService</code>。注册在已取消的 <code>Future</code> 上的操作会以失败结果执行。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// future 值，异步计算的结果</span>
Future&lt;T&gt; future = Future.of(...);
</code></pre>
<h4 data-id="heading-35">3.3.6. Validation</h4>
<p><code>Validation</code> 控件是一个应用函子，有助于累积错误。当尝试组合单子时，组合过程将在第一个遇到的错误处短路。但是 <code>Validation</code> 将继续处理组合函数，累积所有错误。这在验证多个字段（例如 Web 表单）时特别有用，你希望知道遇到的所有错误，而不是一次一个。</p>
<p>示例：我们从 Web 表单获取字段 <code>name</code> 和 <code>age</code>，并希望创建一个有效的 <code>Person</code> 实例，或者返回验证错误列表。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">PersonValidator</span> <span class="hljs-variable">personValidator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersonValidator</span>();
<span class="hljs-comment">// Valid(Person(John Doe, 30))</span>
Validation&lt;Seq&lt;String&gt;, Person&gt; valid = personValidator.validatePerson(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
<span class="hljs-comment">// Invalid(List(Name contains invalid characters: '!4?', Age must be greater than 0))</span>
Validation&lt;Seq&lt;String&gt;, Person&gt; invalid = personValidator.validatePerson(<span class="hljs-string">"John? Doe!4"</span>, -<span class="hljs-number">1</span>);
</code></pre>
<p>一个有效值包含在 <code>Validation.Valid</code> 实例中，一个验证错误列表包含在 <code>Validation.Invalid</code> 实例中。
以下验证器用于将不同的验证结果组合到一个 <code>Validation</code> 实例中。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonValidator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">VALID_NAME_CHARS</span> <span class="hljs-operator">=</span> <span class="hljs-string">"[a-zA-Z ]"</span>;
		<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MIN_AGE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
		<span class="hljs-keyword">public</span> Validation&lt;Seq&lt;String&gt;, Person&gt; <span class="hljs-title function_">validatePerson</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
			<span class="hljs-keyword">return</span> Validation.combine(validateName(name), validateAge(age)).ap(Person::<span class="hljs-keyword">new</span>);
		}

    <span class="hljs-keyword">private</span> Validation&lt;String, String&gt; <span class="hljs-title function_">validateName</span><span class="hljs-params">(String name)</span> {
			<span class="hljs-keyword">return</span> CharSeq.of(name)
				.replaceAll(VALID_NAME_CHARS, <span class="hljs-string">""</span>)
				.transform(seq -&gt; seq.isEmpty() ? 
					Validation.valid(name) : 
					Validation.invalid(<span class="hljs-string">"Name contains invalid characters: '"</span>+ seq.distinct().sorted() + <span class="hljs-string">"'"</span>)
			);
		}

    <span class="hljs-keyword">private</span> Validation&lt;String, Integer&gt; <span class="hljs-title function_">validateAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
			<span class="hljs-keyword">return</span> age &lt; MIN_AGE
						? Validation.invalid(<span class="hljs-string">"Age must be at least "</span> + MIN_AGE)
						: Validation.valid(age);
		}
}
</code></pre>
<p>如果验证成功，即输入数据有效，则使用给定的字段 <code>name</code> 和 <code>age</code> 创建一个 <code>Person</code> 实例。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String name;
		<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> age;
		
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
			<span class="hljs-built_in">this</span>.name = name;
			<span class="hljs-built_in">this</span>.age = age;
		}

    <span class="hljs-meta">@Override</span>
		<span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-string">"Person("</span> + name + <span class="hljs-string">", "</span> + age + <span class="hljs-string">")"</span>;
		}
}
</code></pre>
<h3 data-id="heading-36">3.4. 集合</h3>
<p>我们投入了大量精力来设计一个全新的 Java 集合库，以满足函数式编程的要求，即不可变性。</p>
<p>Java 的 <code>Stream</code> 将计算提升到不同的层，并在另一个明确的步骤中链接到特定的集合。使用 Vavr，我们不需要所有这些额外的样板代码。</p>
<p>新集合基于 <code>java.lang.Iterable</code>，因此它们利用了语法糖迭代风格。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 1000 个随机数</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">double</span> random : Stream.continually(Math::random).take(<span class="hljs-number">1000</span>)) {
	...
}
</code></pre>
<p><code>TraversableOnce</code> 有大量有用的函数来操作集合。它的 API 类似于 <code>java.util.stream.Stream</code> 但更成熟。</p>
<h4 data-id="heading-37">3.4.1. List</h4>
<p>Vavr 的 <code>List</code> 是一个不可变的链表。修改会创建新实例。大多数操作在线性时间内执行。连续操作一个接一个地执行。</p>
<p>Java 8</p>
<pre><code class="hljs language-Java" lang="Java">Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).stream().reduce((i, j) -&gt; i + j);IntStream.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).sum();
</code></pre>
<p>Vavr</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// io.vavr.collection.List</span>
List.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).sum();
</code></pre>
<h4 data-id="heading-38">3.4.2. Stream</h4>
<p><code>io.vavr.collection.Stream</code> 实现是一个惰性链表。值只在需要时计算。由于其惰性，大多数操作在常数时间内执行。操作通常是中间操作，并在一次遍历中执行。</p>
<p>关于流的一个惊人之处是我们可以使用它们来表示（理论上）无限长的序列。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 2, 4, 6, ...</span>
Stream.from(<span class="hljs-number">1</span>).filter(i -&gt; i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-39">3.4.3. 性能特征</h4>
<p>表 1. 顺序操作的时间复杂度</p>






















































































<table><thead><tr><th/><th>head()</th><th>tail()</th><th>get(int)</th><th>update(int, T)</th><th>prepend(T)</th><th>append(T)</th></tr></thead><tbody><tr><td>Array</td><td>—</td><td>—</td><td>const</td><td>const</td><td>linear</td><td>linear</td></tr><tr><td>CharSeq</td><td>const</td><td>linear</td><td>const</td><td>linear</td><td>linear</td><td>linear</td></tr><tr><td>Iterator</td><td>const</td><td>const</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>List</td><td>const</td><td>const</td><td>linear</td><td>linear</td><td>const</td><td>linear</td></tr><tr><td>Queue</td><td>const</td><td>const¹</td><td>linear</td><td>linear</td><td>const</td><td>const</td></tr><tr><td>PriorityQueue</td><td>log</td><td>log</td><td>—</td><td>—</td><td>log</td><td>log</td></tr><tr><td>Stream</td><td>const</td><td>const</td><td>linear</td><td>linear</td><td>const lazy</td><td>const lazy</td></tr><tr><td>Vector</td><td>const eff</td><td>const eff</td><td>const eff</td><td>const eff</td><td>const eff</td><td>const eff</td></tr></tbody></table>
<p>表 2. Map/Set 操作的时间复杂度</p>





























































<table><thead><tr><th/><th>contains/Key</th><th>add/put</th><th>remove</th><th>min</th></tr></thead><tbody><tr><td>HashMap</td><td>const eff</td><td>const eff</td><td>const eff</td><td>linear</td></tr><tr><td>HashSet</td><td>const eff</td><td>const eff</td><td>const eff</td><td>linear</td></tr><tr><td>LinkedHashMap</td><td>const eff</td><td>linear</td><td>linear</td><td>linear</td></tr><tr><td>LinkedHashSet</td><td>const eff</td><td>linear</td><td>linear</td><td>linear</td></tr><tr><td>Tree</td><td>log</td><td>log</td><td>log</td><td>log</td></tr><tr><td>TreeMap</td><td>log</td><td>log</td><td>log</td><td>log</td></tr><tr><td>TreeSet</td><td>log</td><td>log</td><td>log</td><td>log</td></tr></tbody></table>
<p>图例：</p>
<ul>
<li>const — 常数时间</li>
<li>const¹ — 摊销常数时间，少数操作可能需要更长时间</li>
<li>const eff — 有效常数时间，取决于假设，如哈希键的分布</li>
<li>const lazy — 惰性常数时间，操作被延迟</li>
<li>log — 对数时间</li>
<li>linear — 线性时间</li>
</ul>
<h3 data-id="heading-40">3.5. 属性检查</h3>
<p>属性检查（也称为属性测试）是一种以函数式测试代码属性的真正强大的方式。它基于生成的随机数据，这些数据被传递给用户定义的检查函数。
Vavr 在其 <code>io.vavr:vavr-test</code> 模块中支持属性测试，因此请确保包含它以在测试中使用。</p>
<pre><code class="hljs language-java" lang="java">Arbitrary&lt;Integer&gt; ints = Arbitrary.integer();
<span class="hljs-comment">// square(int) &gt;= 0: OK, passed 1000 </span>
tests.Property.def(<span class="hljs-string">"square(int) &gt;= 0"</span>)
	.forAll(ints)
	.suchThat(i -&gt; i * i &gt;= <span class="hljs-number">0</span>)
	.check()
	.assertIsSatisfied();
</code></pre>
<p>复杂数据结构的生成器由简单生成器组成。</p>
<h3 data-id="heading-41">3.6. 模式匹配</h3>
<p>Scala 有原生模式匹配，这是相对于普通 Java 的优势之一。基本语法接近 Java 的 <code>switch</code>：</p>
<pre><code class="hljs language-Scala" lang="Scala"><span class="hljs-keyword">val</span> s = i <span class="hljs-keyword">match</span> {  
	<span class="hljs-keyword">case</span> <span class="hljs-number">1</span> =&gt; <span class="hljs-string">"one"</span>  
	<span class="hljs-keyword">case</span> <span class="hljs-number">2</span> =&gt; <span class="hljs-string">"two"</span>  
	<span class="hljs-keyword">case</span> _ =&gt; <span class="hljs-string">"?"</span>
}
</code></pre>
<p>值得注意的是 <code>match</code> 是一个表达式，它产生一个结果。此外，它还提供：</p>
<ul>
<li>命名参数 <code>case i: Int ⇒ "Int " + i</code></li>
<li>对象解构 <code>case Some(i) ⇒ i</code></li>
<li>守卫 <code>case Some(i) if i &gt; 0 ⇒ "posi</code>tive " + i`</li>
<li>多条件 <code>case "-h" | "--help" ⇒ displa</code>yHelp`</li>
<li>编译时检查完备性</li>
</ul>
<p>模式匹配是一个很棒的特性，它使我们免于编写一堆 if-then-else 分支。它减少了代码量，同时专注于相关部分。</p>
<h4 data-id="heading-42">3.6.1. Java 匹配基础</h4>
<p>Vavr 提供了一个接近 Scala <code>match</code> 的匹配 API。通过将以下导入添加到我们的应用程序来启用它：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.vavr.API.*;
</code></pre>
<p>将静态方法 <code>Match</code>、<code>Case</code> 和原子模式</p>
<ul>
<li><code>$()</code> - 通配符模式</li>
<li><code>$(value)</code> - 等于模式</li>
<li><code>$(predicate)</code> - 条件模式</li>
</ul>
<p>引入作用域后，最初的 Scala 示例可以这样表达：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> Match(i).of(
	Case($(<span class="hljs-number">1</span>), <span class="hljs-string">"one"</span>),
	Case($(<span class="hljs-number">2</span>), <span class="hljs-string">"two"</span>),
	Case($(), <span class="hljs-string">"?"</span>)
);
</code></pre>
<p>⚡ 我们使用统一的大写方法名，因为 <code>case</code> 是 Java 中的关键字。这使得 API 很特殊。</p>
<p><strong>完备性</strong></p>
<p>最后一个通配符模式 <code>$()</code> 使我们免于 <code>MatchError</code>，如果没有匹配项则会抛出此错误。
因为我们无法像 Scala 编译器那样执行完备性检查，所以我们提供了返回可选结果的可能性：</p>
<pre><code class="hljs language-Java" lang="Java">Option&lt;String&gt; s = Match(i).option(    Case($(<span class="hljs-number">0</span>), <span class="hljs-string">"zero"</span>));
</code></pre>
<p><strong>语法糖</strong></p>
<p>如前所示，<code>Case</code> 允许匹配条件模式。</p>
<pre><code class="hljs language-Java" lang="Java">Case($(predicate), ...)
</code></pre>
<p>Vavr 提供了一组默认谓词。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.vavr.Predicates.*;
</code></pre>
<p>这些可以用来表达最初的 Scala 示例，如下所示：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> Match(i).of(
	Case($(is(<span class="hljs-number">1</span>)), <span class="hljs-string">"one"</span>),
	Case($(is(<span class="hljs-number">2</span>)), <span class="hljs-string">"two"</span>),
	Case($(), <span class="hljs-string">"?"</span>)
);
</code></pre>
<p><strong>多条件</strong></p>
<p>我们使用 <code>isIn</code> 谓词来检查多个条件：</p>
<pre><code class="hljs language-Java" lang="Java">Case($(isIn(<span class="hljs-string">"-h"</span>, <span class="hljs-string">"--help"</span>)), ...)
</code></pre>
<p><strong>执行副作用</strong></p>
<p><code>Match</code> 的行为类似于一个表达式，它产生一个值。为了执行副作用，我们需要使用返回 <code>Void</code> 的辅助函数 <code>run</code>：</p>
<pre><code class="hljs language-Java" lang="Java">Match(arg).of(
	Case($(isIn(<span class="hljs-string">"-h"</span>, <span class="hljs-string">"--help"</span>)), o -&gt; run(<span class="hljs-built_in">this</span>::displayHelp)),
	Case($(isIn(<span class="hljs-string">"-v"</span>, <span class="hljs-string">"--version"</span>)), o -&gt; run(<span class="hljs-built_in">this</span>::displayVersion)),
	Case($(), o -&gt; run(() -&gt; {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(arg);
		})
	)
);
</code></pre>
<p>⚡ <code>run</code> 用于解决歧义，并且因为 <code>void</code> 在 Java 中不是有效的返回值。
注意：<code>run</code> 不能用作直接返回值，即不能在 lambda 体外部使用：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 错误！</span>
Case($(isIn(<span class="hljs-string">"-h"</span>, <span class="hljs-string">"--help"</span>)), run(<span class="hljs-built_in">this</span>::displayHelp))
</code></pre>
<p>否则，<code>Case</code> 将在模式匹配之前被急切求值，这会破坏整个 <code>Match</code> 表达式。相反，我们在 lambda 体内使用它：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 正确</span>
Case($(isIn(<span class="hljs-string">"-h"</span>, <span class="hljs-string">"--help"</span>)), o -&gt; run(<span class="hljs-built_in">this</span>::displayHelp))
</code></pre>
<p>正如我们所看到的，如果使用不当，<code>run</code> 容易出错。请小心。我们考虑在未来的版本中弃用它，也许我们还会为执行副作用提供更好的 API。</p>
<p><strong>命名参数</strong></p>
<p>Vavr 利用 lambda 为匹配的值提供命名参数。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">Number</span> <span class="hljs-variable">plusOne</span> <span class="hljs-operator">=</span> Match(obj).of(
	Case($(instanceOf(Integer.class)), i -&gt; i + <span class="hljs-number">1</span>),
	Case($(instanceOf(Double.class)), d -&gt; d + <span class="hljs-number">1</span>),
	Case($(), o -&gt; { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberFormatException</span>(); }
));
</code></pre>
<p>到目前为止，我们直接使用原子模式匹配值。如果原子模式匹配，则匹配对象的正确类型将从模式的上下文中推断出来。
接下来，我们将看看能够匹配（理论上）任意深度的对象图的递归模式。</p>
<p><strong>对象解构</strong></p>
<p>在 Java 中，我们使用构造函数来实例化类。我们将对象解构理解为将对象分解为其组成部分。
构造函数是应用于参数并返回新实例的函数，而解构函数是接受实例并返回其组成部分的函数。我们说一个对象被解构了。
对象解构不一定是一个唯一的操作。例如，一个 <code>LocalDate</code> 可以被解构为：</p>
<ul>
<li>年、月和日组件</li>
<li>表示相应 <code>Instant</code> 的纪元毫秒的长整型值</li>
<li>等等。</li>
</ul>
<h4 data-id="heading-43">3.6.2. 模式</h4>
<p>在 Vavr 中，我们使用模式来定义如何解构特定类型的实例。这些模式可以与 <code>Match</code> API 结合使用。
<strong>预定义模式</strong>
对于许多 Vavr 类型，已经存在匹配模式。它们通过以下方式导入：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.vavr.Patterns.*;
</code></pre>
<p>例如，我们现在能够匹配 <code>Try</code> 的结果：</p>
<pre><code class="hljs language-Java" lang="Java">Match(_try).of(
	Case($Success($()), value -&gt; ...),
	Case($Failure($()), x -&gt; ...)
);
</code></pre>
<p>⚡ Vavr 的 <code>Match</code> API 的第一个原型允许从匹配模式中提取用户选择的对象。没有适当的编译器支持，这是不切实际的，因为生成的方法数量呈指数级增长。当前的 API 做出了妥协，即匹配所有模式但只解构根模式。</p>
<pre><code class="hljs language-Java" lang="Java">Match(_try).of(
	Case($Success($Tuple2($(<span class="hljs-string">"a"</span>), $())), tuple2 -&gt; ...),
	Case($Failure($(instanceOf(Error.class))), error -&gt; ...)
);
</code></pre>
<p>这里的根模式是 <code>Success</code> 和 <code>Failure</code>。它们被解构为 <code>Tuple2</code> 和 <code>Error</code>，具有正确的泛型类型。</p>
<p>⚡ 深层嵌套的类型是根据 <code>Match</code> 参数推断的，而不是根据匹配的模式。</p>
<p><strong>用户定义模式</strong></p>
<p>能够解构任意对象（包括 <code>final</code> 类的实例）是至关重要的。Vavr 通过提供编译时注解 <code>@Patterns</code> 和 <code>@Unapply</code> 以声明式风格实现这一点。</p>
<p>要启用注解处理器，需要将工件 <code>vavr-match</code> 添加为项目依赖项。</p>
<p>⚡ 注意：当然，模式可以直接实现而不使用代码生成器。更多信息请查看生成的源代码。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> io.vavr.match.annotation.*;
<span class="hljs-meta">@Patternsclass</span> My {
    <span class="hljs-meta">@Unapply</span>    
		<span class="hljs-keyword">static</span> &lt;T&gt; Tuple1&lt;T&gt; <span class="hljs-title function_">Optional</span><span class="hljs-params">(java.util.Optional&lt;T&gt; optional)</span> {
			<span class="hljs-keyword">return</span> Tuple.of(optional.orElse(<span class="hljs-literal">null</span>));    
		}
}
</code></pre>
<p>注解处理器将文件 <code>MyPatterns</code> 放在同一个包中（默认在 <code>target/generated-sources</code> 中）。也支持内部类。特殊情况：如果类名是 <code>$</code>，则生成的类名只是 <code>Patterns</code>，没有前缀。</p>
<p><strong>守卫</strong></p>
<p>现在我们可以使用守卫来匹配 <code>Optional</code>。</p>
<pre><code class="hljs language-Java" lang="Java">Match(optional).of(
	Case($Optional($(v -&gt; v != <span class="hljs-literal">null</span>)), <span class="hljs-string">"defined"</span>),
	Case($Optional($(v -&gt; v == <span class="hljs-literal">null</span>)), <span class="hljs-string">"empty"</span>)
);
</code></pre>
<p>谓词可以通过实现 <code>isNull</code> 和 <code>isNotNull</code> 来简化。
⚡ 是的，提取 <code>null</code> 很奇怪。与其使用 Java 的 <code>Optional</code>，不如试试 Vavr 的 <code>Option</code>！</p>
<pre><code class="hljs language-Java" lang="Java">Match(option).of(
	Case($Some($()), <span class="hljs-string">"defined"</span>),
	Case($None(), <span class="hljs-string">"empty"</span>)
);
</code></pre>
<h2 data-id="heading-44">4. 许可证</h2>
<p>版权所有 2014-2025 Vavr， <a href="https://link.juejin.cn?target=https%3A%2F%2Fvavr.io" target="_blank" title="https://vavr.io" ref="nofollow noopener noreferrer">vavr.io</a><br/>
根据 Apache 许可证 2.0 版（"许可证"）授权；<br/>
除非遵守许可证，否则你不得使用此文件。<br/>
你可以在以下网址获取许可证副本：<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.apache.org%2Flicenses%2FLICENSE-2.0" target="_blank" title="http://www.apache.org/licenses/LICENSE-2.0" ref="nofollow noopener noreferrer">www.apache.org/licenses/LI…</a><br/>
除非适用法律要求或书面同意，否则按"原样"分发的软件，没有任何明示或暗示的担保或条件。<br/>
请参阅许可证以了解许可证下的特定语言管理权限和限制。<br/>
版本 0.11.0<br/>
最后更新于 2025-12-16 18:50:22 UTC</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[实战：在 Docker (Windows) 中构建集成 yt-dlp 的“满血版” n8n 自动化工作流]]></title>    <link>https://juejin.cn/post/7593177437082681395</link>    <guid>https://juejin.cn/post/7593177437082681395</guid>    <pubDate>2026-01-10T02:35:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593177437082681395" data-draft-id="7593212374921330715" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="实战：在 Docker (Windows) 中构建集成 yt-dlp 的“满血版” n8n 自动化工作流"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-10T02:35:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="摸鱼的春哥"/> <meta itemprop="url" content="https://juejin.cn/user/1714893870865303"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            实战：在 Docker (Windows) 中构建集成 yt-dlp 的“满血版” n8n 自动化工作流
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893870865303/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    摸鱼的春哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T02:35:57.000Z" title="Sat Jan 10 2026 02:35:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;font-weight:400;line-height:2;font-size:17px;overflow-x:hidden;color:#000}.markdown-body strong{padding:1px;color:#ee3f4d}.markdown-body em{padding:0 2px;color:#f33b1f}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:30px;margin-bottom:20px;line-height:1.5;font-weight:700}.markdown-body h1{text-align:center;padding-bottom:5px;font-size:32px;color:#ac1f18}.markdown-body h1:after{content:"";display:block;margin:4px auto 0;width:100px;height:2px;border-bottom:2px solid #f33b1f}.markdown-body h2{font-size:28px;border-bottom:1px solid #f33b1f}.markdown-body h2:before{content:"# "!important;color:#f33b1f}.markdown-body h3{font-size:24px;padding-left:9px;border-left:6px solid #f33b1f}.markdown-body h4{font-size:20px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #bbb;margin:16px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f9f1db;color:#ee2746;border-radius:2px;font-size:16px;padding:1px 2px}.markdown-body code,.markdown-body pre{font-family:-apple-system,-apple-system-body,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,PingFang SC,思源黑体 CN,思源黑体,JetBrains Mono,Fira Code,Menlo,Ubuntu Mono,Consolas,sans-serif}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{margin:12px 0!important;border-radius:3px;font-size:15px;padding:16px 12px;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f7f7f7}.markdown-body a{text-decoration:none;color:#1781b5;padding:0 2px;border-bottom:1px solid #1781b5}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #f33b1f;color:#ac1f18}.markdown-body blockquote{color:#3d3d3d;background-color:#fff9f9;padding:6px 16px;margin:16px 0;border-left:3px solid #f07c82}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:6px 0}.markdown-body ol,.markdown-body ul{padding-left:30px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:6px}.markdown-body ol li{padding-left:6px}.markdown-body ::marker{color:#f33b1f}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body .task-list-item input[type=checkbox]{position:relative}.markdown-body .task-list-item input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;border:1px solid #f07c82;border-radius:3px;box-sizing:border-box;z-index:1}.markdown-body .task-list-item input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-5px;left:0;right:0;bottom:0;width:0;height:0;color:#f33b1f;font-size:16px;font-weight:700;z-index:2}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table thead{background:#fff9f9;color:#000;text-align:left;font-size:15px}.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table tr:hover{background-color:#fff9f9}.markdown-body table td,.markdown-body table th{padding:12px 7px;line-height:24px;border:1px solid #f9f1db}.markdown-body table td{min-width:120px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><p>在自动化工作流中，<strong>n8n</strong> 是一个强大的编排工具。但默认的 Docker 镜像为了追求轻量化，往往缺少很多系统级工具。最近我需要在 Windows Docker Desktop 环境下的 n8n 里调用 <strong>yt-dlp</strong> 下载高清视频。</p>
<p>本文记录一下方案的选型与思考。</p>
<h3 data-id="heading-0">1. 为什么我们要抛弃 Alpine，选择 Debian？</h3>
<p>起初，我们尝试在官方默认的 <code>n8n:latest</code> (基于 Alpine Linux) 中安装 <code>python3</code> 和 <code>yt-dlp</code>。虽然安装过程看似顺利，但在运行时却遭遇了滑铁卢。</p>
<h4 data-id="heading-1">遇到的问题</h4>
<ul>
<li><strong>底层库缺失</strong>：运行 yt-dlp 时报错 <code>posix_fallocate64: symbol not found</code>。</li>
<li><strong>原因分析</strong>：这是 Alpine (使用 musl libc) 和 Python 某些预编译二进制库 (依赖 glibc) 之间的经典兼容性问题。虽然可以通过安装 <code>gcompat</code> 尝试修复，但稳定性极差。</li>
<li><strong>官方 Debian 镜像滞后</strong>：官方虽然提供了 <code>n8n:debian</code> 镜像，但更新频率远低于 <code>latest</code>，无法使用 n8n 的最新功能。</li>
</ul>
<h4 data-id="heading-2">解决方案</h4>
<p>为了同时获得 <strong>Debian 的稳定性 (glibc)</strong> 和 <strong>n8n 的最新版本</strong>，我们决定采用 <strong>"Node.js 官方镜像 + 手动安装 n8n"</strong> 的构建策略。</p>
<ul>
<li><strong>底座</strong>：<code>node:20-bookworm</code> (Debian 12，稳定、兼容性好)。</li>
<li><strong>应用</strong>：通过 <code>npm install -g n8n</code> 获取最新版。</li>
<li><strong>扩展</strong>：原生支持 <code>apt</code>，轻松安装 FFmpeg 和 Python。</li>
</ul>
<hr/>
<h3 data-id="heading-3">2. 核心构建：混合加速的 Dockerfile</h3>
<p>在国内网络环境下构建这个镜像是一项挑战：</p>
<ol>
<li><code>apt</code> 和 <code>npm</code> 直连速度慢，需要国内镜像源加速。</li>
<li><code>yt-dlp</code> 发布在 GitHub，国内镜像源无法覆盖，必须走那个，那个你懂的。</li>
</ol>
<p>我们需要一个 <strong>“混合加速”</strong> 的 <code>Dockerfile</code>：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 使用 Node.js 20 (Debian Bookworm) 作为稳固底座
FROM node:20-bookworm

# 1. 接收构建参数 (用于解决 GitHub 连接问题)
ARG HTTP_PROXY
ARG HTTPS_PROXY

USER root

# -----------------------------------------------------------------------------
# 🚀 优化 A：系统级加速 (apt 使用中科大源)
# Bookworm 版本格式变动，使用 sed 替换源
RUN sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list.d/debian.sources &amp;&amp; \
    sed -i 's|security.debian.org/debian-security|mirrors.ustc.edu.cn/debian-security|g' /etc/apt/sources.list.d/debian.sources

# 🚀 优化 B：Node级加速 (npm 使用国内镜像)
RUN npm config set registry [https://registry.npmmirror.com](https://registry.npmmirror.com)
# -----------------------------------------------------------------------------

# 2. 安装系统工具 (apt 走国内源，速度飞快)
# ffmpeg: 合并高清视频音频必备
RUN apt-get update &amp;&amp; \
    apt-get install -y python3 python3-pip ffmpeg wget &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

# 3. 安装 yt-dlp (设置临时环境变量走代理，因为 GitHub 此时必须翻墙)
RUN export http_proxy=${HTTP_PROXY} &amp;&amp; \
    export https_proxy=${HTTPS_PROXY} &amp;&amp; \
    wget [https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp](https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp) -O /usr/local/bin/yt-dlp &amp;&amp; \
    chmod a+rx /usr/local/bin/yt-dlp

# 4. 安装 n8n (npm 走国内源)
RUN npm install -g n8n

# 5. 权限与目录处理
# 创建挂载点 /files 用于存放下载文件
RUN mkdir -p /home/node/.n8n /files &amp;&amp; \
    chown -R node:node /home/node/.n8n /files

# 6. 切换回安全用户
USER node
ENTRYPOINT ["n8n"]
</code></pre>
<h3 data-id="heading-4">3. 编排配置：Docker Compose</h3>
<p>在 Windows Docker Desktop 环境下，让容器连上宿主机的代理软件（Clash/v2ray），关键在于 host.docker.internal。</p>
<p>docker-compose.yml 配置如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">n8n:</span>
    <span class="hljs-attr">build:</span> 
      <span class="hljs-attr">context:</span> <span class="hljs-string">.</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span>
      <span class="hljs-comment"># 传递代理给 Dockerfile 用于 wget 下载 yt-dlp</span>
      <span class="hljs-attr">args:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">HTTP_PROXY=[http://host.docker.internal:7890](http://host.docker.internal:7890)</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">HTTPS_PROXY=[http://host.docker.internal:7890](http://host.docker.internal:7890)</span>
    
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">n8n</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5678:5678"</span>
    
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GENERIC_TIMEZONE=Asia/Shanghai</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">TZ=Asia/Shanghai</span>
      <span class="hljs-comment"># 指定 n8n 配置目录</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_USER_FOLDER=/home/node/.n8n</span>
      
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># n8n 数据持久化</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">n8n_data:/home/node/.n8n</span>
      <span class="hljs-comment"># 挂载宿主机 D 盘用于存放下载的视频</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">D:\n8n_files:/files</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">n8n_data:</span>
</code></pre>
<h3 data-id="heading-5">4. 验证与实战</h3>
<p>构建完成后 (docker-compose up -d --build)，我们不要急着去 n8n 界面，先在命令行里进行一次“外科手术式”的验证。</p>
<p>打开 Windows CMD，执行以下命令：</p>
<h4 data-id="heading-6">验证一：环境检查</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查 yt-dlp 版本 (成功则返回日期版本号)</span>
docker <span class="hljs-built_in">exec</span> -it n8n yt-dlp --version

<span class="hljs-comment"># 检查 FFmpeg (成功则返回配置详情)</span>
docker <span class="hljs-built_in">exec</span> -it n8n ffmpeg -version
</code></pre>
<h4 data-id="heading-7">验证二：网络与代理测试</h4>
<p>这是最关键的一步。我们尝试在容器内通过宿主机代理获取 YouTube 视频标题。</p>
<h2 data-id="heading-8">注意：运行时也需要指定 --proxy，因为容器默认不走代理</h2>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it n8n yt-dlp --proxy <span class="hljs-string">"[http://host.docker.internal:7890](http://host.docker.internal:7890)"</span> --<span class="hljs-built_in">print</span> title [https://www.youtube.com/watch?v=dQw4w9WgXcQ](https://www.youtube.com/watch?v=dQw4w9WgXcQ)
</code></pre>
<p>不需要代理的同学可以删掉 <code>--proxy "[http://host.docker.internal:7890](http://host.docker.internal:7890)"</code></p>
<p>如果输出了 Rick Astley - Never Gonna Give You Up...，恭喜你，网络完全打通！</p>
<h4 data-id="heading-9">验证三：真实下载测试</h4>
<p>直接将视频下载到宿主机的 D:\n8n_files 中：</p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it n8n yt-dlp -o <span class="hljs-string">"/files/test_video.mp4"</span> [https://www.youtube.com/watch?v=dQw4w9WgXcQ](https://www.youtube.com/watch?v=dQw4w9WgXcQ)
</code></pre>
<p>代理配置如果需要就参考验证二加上。</p>
<p>去 D 盘检查文件是否存在，且能正常播放（有声音说明 FFmpeg 工作正常）。</p>
<h3 data-id="heading-10">5. 在 n8n 中使用</h3>
<p>现在，你可以在 n8n 的流程中添加 "Execute Command" 节点，尽情使用 yt-dlp 了：</p>
<pre><code class="hljs language-bash" lang="bash">yt-dlp --proxy <span class="hljs-string">"[http://host.docker.internal:7890](http://host.docker.internal:7890)"</span> -o <span class="hljs-string">'/files/%(title)s.%(ext)s'</span> {{ <span class="hljs-variable">$json</span>.url }}
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>通过这次改造，我们实现了：</p>
<ol>
<li>
<p>稳定性：Debian 底座彻底解决了 Python 运行库报错的问题。</p>
</li>
<li>
<p>时效性：通过 npm 安装，永远可以使用最新版的 n8n。</p>
</li>
<li>
<p>功能性：集成了 FFmpeg 和 yt-dlp，支持最高画质视频下载。</p>
</li>
<li>
<p>速度：构建过程利用国内源，运行过程利用宿主机代理，兼顾了速度与连通性。</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在AI时代，技术人应该每天都要花两小时来构建一个自身的构建系统]]></title>    <link>https://juejin.cn/post/7593193235251839028</link>    <guid>https://juejin.cn/post/7593193235251839028</guid>    <pubDate>2026-01-10T02:38:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593193235251839028" data-draft-id="7593338828196020264" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在AI时代，技术人应该每天都要花两小时来构建一个自身的构建系统"/> <meta itemprop="keywords" content="前端,架构,Vue.js"/> <meta itemprop="datePublished" content="2026-01-10T02:38:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小酒星小杜"/> <meta itemprop="url" content="https://juejin.cn/user/1512542215093479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在AI时代，技术人应该每天都要花两小时来构建一个自身的构建系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1512542215093479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小酒星小杜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T02:38:19.000Z" title="Sat Jan 10 2026 02:38:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">导言</h2>
<p><strong>每天2小时的低内耗构建系统</strong></p>
<blockquote>
<p>我们只需每天只用一小段、几乎不会内耗的时间，去搭建一个长期复利的东西</p>
</blockquote>
<p>我们的重点在低内耗和构建系统。</p>
<h3 data-id="heading-1">为什么不是4小时，8小时？</h3>
<p>4小时、8小时很容易会让我们心里产生<strong>需要全力以赴的假象。</strong></p>
<p>而2小时则不会，你心里就会觉得：</p>
<blockquote>
<p>这2小时，就算浪费了，我也不心疼。</p>
</blockquote>
<p>在技术人看来，我做一个东西需要有一整块的时间，不然我没办法做得好。</p>
<p>但现实的问题是一整块的时间非常少，好的idea和项目都是在等待时间中死亡了。</p>
<p><strong>所以2小时不是时间管理的选择，而是心理设计的选择。</strong></p>
<p>2小时的真正作用：</p>
<p>不是为了赶进度，而是为了降低启动成本，构建系统。</p>
<p>系统存在的意义，是让你在状态最差的那天也能持续构建</p>
<h2 data-id="heading-2">系统总览</h2>
<h3 data-id="heading-3">系统全貌</h3>
<blockquote>
<p>2 Hour Builder = Input -&gt; Build -&gt; Ship 的最小闭环</p>
</blockquote>
<p>这三个步骤是实现一个<strong>反内耗构建系统</strong>的一个<strong>构建单位</strong>。</p>
<p>顺序是不可以乱的，必须按照步骤执行。</p>
<p><strong>Input</strong> <strong>不是学习，是取材</strong>。</p>
<p>不是今天收藏10篇文章，不是系统性的去学习一样东西。</p>
<p>而是只为一件事情服务：</p>
<p>👉<strong>为今天的Build找一个明确的素材。</strong></p>
<p>例如：</p>
<p>一个真实的用户吐槽、一段自己踩过的坑、一个在脑海反复出现的疑问、一条忍不住要反驳的观点。</p>
<p>Input的标准只有一个，<strong>就是今天就能被用掉</strong>。</p>
<p><strong>Build不是创作，是结构化。</strong></p>
<p>不是为了追求好不好、不是细节打磨、不是写完整。</p>
<p>而是一个作用：</p>
<p>👉<strong>把</strong> <strong>Input</strong> <strong>压缩成为一个“可以服用的形态”。</strong></p>
<p>它可以是：</p>
<p>一个你独有的公式、一个页面结构、一段Prompt模板。</p>
<p>目的只有一个：</p>
<p><strong>明天还能复用。</strong></p>
<p><strong>Ship不是发布，是暴露。</strong></p>
<p>不要追求数据好看、不要刻意去转化、不要说“改改再发”。</p>
<p>只做一件事：</p>
<p>👉<strong>让真实用户看见它。</strong></p>
<p>可以是：</p>
<p>一条小红书、一条即刻、发到群里、给一个真实用户用。</p>
<p>最低标准是：</p>
<p><strong>有人能对它产生反应。</strong></p>
<p>这三个步骤不能乱，也不能缺失任何一步。</p>
<p>只Input不Build：</p>
<p>收藏夹吃灰、笔记越来越多、认知越来越高级，<strong>但其实并没有进步，你只是在用“不断学习”来欺骗自己不要面对这个世界。</strong></p>
<p>只Build不Input：</p>
<p>拍脑门就干，凭感觉设计，凭感觉推演，伪需求解决 <strong>。短期很爽，但是长期一定跑偏，这是闭门造车。</strong></p>
<p>不Ship：</p>
<p>一直在优化，一直等更好，一直都是还没准备好。<strong>结果就是看起来很完整，其实从来没有被真实世界验证，这是最内耗的事情。</strong></p>
<blockquote>
<p><strong>没有 Ship 的 Build，都是幻觉</strong></p>
<p><strong>没有</strong> <strong>Input</strong> <strong>的 Build，都是臆测</strong></p>
<p><strong>没有 Build 的 Input，都是拖延</strong></p>
</blockquote>
<p>这就是 <strong>2 Hour Builder 的最小真相闭环。</strong></p>
<p>The 2-Hour Builder System 系列将持续更新，敬请关注</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-208 岭回归与Lasso回归：区别、应用与选择指南]]></title>    <link>https://juejin.cn/post/7593338828195938344</link>    <guid>https://juejin.cn/post/7593338828195938344</guid>    <pubDate>2026-01-10T01:17:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195938344" data-draft-id="7593338828195921960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-208 岭回归与Lasso回归：区别、应用与选择指南"/> <meta itemprop="keywords" content="后端,大数据,机器学习"/> <meta itemprop="datePublished" content="2026-01-10T01:17:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-208 岭回归与Lasso回归：区别、应用与选择指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T01:17:59.000Z" title="Sat Jan 10 2026 01:17:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：解决多重共线性与过拟合问题</li>
<li>结论：岭回归适合高度相关特征，Lasso回归适合特征选择</li>
<li>产出：应用场景与正则化参数λ选择指导</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/530550724ede48d39350b13ca85cb640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=IkAuZPHuLipefWOX4gPE%2F37aybQ%3D" alt="大数据-208 岭回归与Lasso回归：区别、应用与选择指南" loading="lazy"/></p>
<h2 data-id="heading-1">版本矩阵</h2>

























<table><thead><tr><th>版本</th><th>已验证</th><th>说明</th></tr></thead><tbody><tr><td>Ridge Regression (L2)</td><td>已验证</td><td>适用于高相关特征的场景，保持所有特征但压缩系数</td></tr><tr><td>Lasso Regression (L1)</td><td>已验证</td><td>适合高维数据和特征选择，能将部分系数压缩为零</td></tr><tr><td>Elastic Net</td><td>已验证</td><td>结合L1和L2正则化的优势，适合综合场景</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58382cac6aec4306ab50d1e232c99d11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=vtkckM%2Bnyw7yFR9yiiigi7i58%2BA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-2">岭回归和Lasso</h2>
<p>岭回归（Ridge Regression）和Lasso（Least Absolute Shrinkage and Selection Operator）是两种经典的线性回归正则化方法，专门用于解决机器学习中的过拟合问题和多重共线性问题。这两种方法的核心思想都是在普通最小二乘法（OLS）的基础上，通过引入不同的正则化项来约束模型参数。</p>
<ol>
<li>岭回归（L2正则化）：</li>
</ol>
<ul>
<li>添加L2范数惩罚项：在损失函数中加入回归系数平方和的惩罚项（λ∑β²）</li>
<li>特点：所有特征都会被保留，但系数会被压缩</li>
<li>适用场景：当特征之间存在高度相关性时（如基因表达数据）</li>
<li>数学表达式：min(∑(y_i - ŷ_i)² + λ∑β_j²)</li>
</ul>
<ol start="2">
<li>Lasso回归（L1正则化）：</li>
</ol>
<ul>
<li>添加L1范数惩罚项：在损失函数中加入回归系数绝对值的惩罚项（λ∑|β|）</li>
<li>特点：可以实现特征选择，部分系数会被压缩为零</li>
<li>适用场景：当特征维度很高且需要特征选择时（如文本分类）</li>
<li>数学表达式：min(∑(y_i - ŷ_i)² + λ∑|β_j|)</li>
</ul>
<p>实际应用中的典型场景：</p>
<ul>
<li>房价预测：当房屋特征（面积、房间数、地理位置等）存在多重共线性时</li>
<li>基因数据分析：处理成千上万个基因表达数据时</li>
<li>金融风控：从数百个财务指标中筛选关键风险因子</li>
</ul>
<p>这两种方法的区别主要体现在：</p>
<ol>
<li>岭回归会使所有系数都缩小但不为零，适合保留所有特征的情况</li>
<li>Lasso会使得部分系数变为零，实现特征选择</li>
<li>弹性网络（Elastic Net）结合了两者的优点，同时使用L1和L2正则化</li>
</ol>
<p>选择建议：</p>
<ul>
<li>当预测性能比可解释性更重要时，选择岭回归</li>
<li>当需要特征选择和模型可解释性时，选择Lasso</li>
<li>在实际应用中，通常需要通过交叉验证来确定最佳的正则化参数λ</li>
</ul>
<h3 data-id="heading-3">岭回归的原理</h3>
<p>岭回归是在普通线性回归的基础上加入了L2正则化项，使得模型更鲁棒。具体来说，岭回归的损失函数是普通最小二乘法的损失函数与一个L2正则化项之和。该正则化项是回归系数的平方和可以在极小化损失的同时，约束回归系数的大小，避免其过大从而导致模型过拟合。</p>
<h3 data-id="heading-4">Lasso回归的原理</h3>
<p>Lasso回归（Least Absolute Shrinkage and Selection Operator）与岭回归（Ridge Regression）都是线性回归的正则化变体，但它们在正则化方式上存在显著差异：</p>
<ol>
<li>正则化项类型：</li>
</ol>
<ul>
<li>Lasso回归采用L1正则化，即对系数绝对值之和进行惩罚：λΣ|β_j|</li>
<li>岭回归采用L2正则化，即对系数平方和进行惩罚：λΣβ_j²</li>
</ul>
<ol start="2">
<li>特征选择能力：</li>
</ol>
<ul>
<li>Lasso的L1惩罚会导致某些系数完全收缩为零，实现自动特征选择</li>
<li>岭回归的L2惩罚会使所有系数都趋向于变小，但不会完全归零</li>
</ul>
<ol start="3">
<li>数学特性差异：</li>
</ol>
<ul>
<li>Lasso的解在几何上对应菱形约束区域顶点</li>
<li>岭回归的解对应圆形约束区域</li>
</ul>
<ol start="4">
<li>适用场景对比：</li>
</ol>
<ul>
<li>当特征数量远大于样本量时（p&gt;&gt;n），Lasso通常表现更好</li>
<li>当存在高度相关特征时，岭回归往往更稳定</li>
</ul>
<ol start="5">
<li>
<p>实际应用示例：
在基因表达数据分析中（通常有数万个基因特征），Lasso能有效识别出少数关键基因；而在经济学时间序列预测中（特征间高度相关），岭回归能提供更稳健的预测。</p>
</li>
<li>
<p>参数选择：
两种方法都需要通过交叉验证确定最优正则化参数λ，但Lasso的λ通常需要更精细的网格搜索来捕捉特征选择的关键阈值。</p>
</li>
</ol>
<p>注意：在实践中，Elastic Net（结合L1和L2正则化）常被用作折中方案，兼具两种方法的优势。</p>
<h3 data-id="heading-5">解决方式</h3>
<p>解决共线性的问题的方法主要有以下三种：</p>
<ul>
<li>其一是在建模之前对各特征进行相关性检验，若存在多重共线性，则可以考虑进一步对数据集进行 SVD 分解或 PCA 主成分分析，在 SVD 或 PCA 执行的过程中会对数据集进行正交交换，最终所得数据集各列将不存在任务任何相关性。当然此举会对数据集的结构进行改变，且各列特征变得不可解释。</li>
<li>其二则是采用逐步回归的方法，以此选取对因变量解释力度最强的自变量，同时对于存在相关性的自变量加上一个惩罚因子，削弱其对因变量的解释力度，当然该方法不能完全避免多重共线性的存在，但能够绕过最小二乘法对共线性较为敏感的缺陷，构建线性回归模型。</li>
<li>其三则是在原有算法基础上进行修改，放弃对线性方程参数无偏估计的苛刻条件，使其能够容忍特征列存在多重共线性的情况，并且能够顺利建模，且尽可能的保证 SSE 取得最小值。</li>
</ul>
<p>通常来说，能够利用一个算法解决的问题尽量不用多个算的组合来解决，因此此处我们主要考虑后两个方案，其中逐步回归我们将放在线性回归的最后一部分进行讲解，而第三个解决方案，则是我们接下来需要详细讨论的岭回归算法和 Lasso 算法。</p>
<p>岭回归和Lasso回归在加入正则化项的方式上有所不同，从而影响模型的选择和应用。岭回归更适合用于避免系数过大而导致的过拟合，而Lasso在特征选择方面更有优势，因此通常在高维数据中表现更佳。在实际应用中，可以通过交叉验证来选择最适合的正则化参数并在岭回归和Lasso之间做出选择，或者结合两者（Elastic Net）以获得更好的模型效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5cfb546c1f24098a2ca4efb54d5ab79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=RyUswzqnC6oBASgeyUnlKkcHsMQ%3D" alt="对比 岭回归 Lasso" loading="lazy"/></p>
<h3 data-id="heading-6">岭回归</h3>
<h4 data-id="heading-7">基本原理</h4>
<p>岭回归算法实际上是针对线性回归算法局限性的一个改进类算法，优化目的是解决系数矩阵XTX不可逆的问题，客观上同时也起到了克服数据集存在多重共线性的情况，而岭回归的做法也非常简单，就是在原方程系数计算公式中添加了一个扰动项，原先无法求广义逆的情况变成了求出其广义逆，使得问题稳定并得以求解。
岭回归在多元线性回归的损失函数上加上了正则项，表达为系数 w 的 L2 范式（即系数 w 的平方项）乘以正则化系数 λ，岭回归的损失函数的完整表达式写作：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f20ec80dcdb8477abeaccd35e7dad630~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=ab1rU83C9W%2BQVWb1LGyEDYm4Ulk%3D" alt="岭回归公式" loading="lazy"/>
我们仍然可以使用最小二乘法求解，可得：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/244e87a046de4a64bd1bc4448b693549~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=UIjaIdoot9iSwKgWOT%2Bl9qdBXL8%3D" alt="岭回归公式" loading="lazy"/>
此举看似简单，实则非常精妙，用一个满秩的对角矩阵和原系数矩阵计算进行相加的，实际上起到了两个作用，其一是使得最终运算结果（XTX + λI）满秩，即降低了原数据集特征列的共线性影响，其二也相当于对所有的特征列的因变量解释程度进行了惩罚，且λ越大惩罚作用越强。</p>
<p>现在，只要（XTX + λI）存在逆矩阵，我们就可以求解。一个矩阵存在逆矩阵的充分必要条件是这个矩阵的行列式不为0。假设原本的特征矩阵中存在共线性，则我们的方阵 XTX 就会不满秩（存在完全为零的行）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3adca07cfd1f43dc8aa33dba2718e05d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=BTL9MrkFCXvSeeJmpNbCALi5uo4%3D" alt="岭回归公式" loading="lazy"/></p>
<p>此时方阵 XTX 就是没有逆的，最小二乘法就无法使用，加上了λI 之后，我们的矩阵就大不一样了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfba3e4aa1194494bd4b813e92536a30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=uBZqrlTYKRKxMU5r0GtEMCCP0w0%3D" alt="岭回归公式" loading="lazy"/>
最后得到的行列式还是一个梯形行列式，然而它已经不存在全 0 行或者全 0 列了，除非：</p>
<ul>
<li>λ 等于 0</li>
<li>原本的矩阵 XTX中存在对焦线上元素为 -λ，其他元素都为0 的行或者列</li>
</ul>
<p>否则矩阵 XTX+λI 永远都是满秩，在 sklearn 中，λ的值我们可以自由的控制，因此我们可以让它不为 0，比避免第一种情况。而第二种情况，如果我们发现某个λ的取值下模型无法求解，那我们只需要更换一个λ的取值就好了，也可以顺利避免。也就是说，矩阵的逆永远存在，有这个保障，我们的 w 就可以写作：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59c97df5f94a466aabf2c68e238b23fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=1vw7zBqhAYqVwnONZTlAasVc4a4%3D" alt="岭回归公式" loading="lazy"/>
如此，正则化系数λ就避免了精确相关关系带来的影响，至少最小二乘法在λ存在的情况下是一定可以使用。对于存在高度相关关系的矩阵，我们也可以通过调大λ，来让 XTX+λI 矩阵的行列式变大，从而让逆矩阵变小，以此控制参数向量 w 的偏移。当λ越大，模型越不容易受到共线性的影响。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7718dab865e4849bb8bed996bd6ef2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=SjiHQqqTZAtKiIb0TKE5ADS%2B32k%3D" alt="岭回归公式" loading="lazy"/></p>
<h3 data-id="heading-8">Lasso</h3>
<h4 data-id="heading-9">基本原理</h4>
<p>在岭回归中，对自变量系数进行平方和处理也被称做 L2 正则化，由于此原因，岭回归中自变量系数虽然会很快衰减，但很难归为零，且窜在共线性的时候衰减过程也并非严格递减，这就是为何岭回归能够建模、判断共线性，但很难进行变量筛选的原因。为了弥补岭回归在这方面的不足，Tibshirani（1996）提出了 Lasso（The Least Absolute Shrinkage and Selectiontorperator）算法，将岭回归的损失函数中的自变量系数 L2 正则化修改为 L1 正则化，即 Lasso 回归损失函数为：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/464f28c318fe4051bf853471917759dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=lCv9O5LEL6YhT7JrH2%2FyjW2B8Ls%3D" alt="Lasso公式" loading="lazy"/>
我们来看看 Lasso 的计算过程，当我们使用最小二乘法来求解 Lasso 中参数，我们依然对损失函数进行求导：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/415f8fa71fd1494e8071020b13c077b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=2YEP4zRU%2F3XE5Laf%2BvL6D1b89h4%3D" alt="Lasso公式" loading="lazy"/>
现在问题又回到了要求 XTX 的逆必须存在，在岭回归中，我们通过正则化系数λ能够向方阵 XTX 加上一个单位矩阵，以此来防止方阵 XTX 的行列式为 0，而现在 L1 范式所带的正则项λ在求导之后并不带有w 这个项，因此它无法对 XTX 造成任何影响。
也就是说，Lasso 无法解决特征之间精确相关的问题，当我们使用最小二乘法求解线性回归时，如果线性回归无解或者报除零的错误，换 Lasso 不能解决任何问题。
不过，在现实中我们其实会比较少遇到精确相关的多重共线性问题，大部分多重共线性问题应该时高度相关，而如果我们假设方阵 XTX 的逆是一定存在的，那我们可以有：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8af59a4f660f4c8083c7c76e147335a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=sg2b%2BTzR7GEsPMsTYtnl3hvZEg4%3D" alt="Lasso公式" loading="lazy"/>
通过增大λ，我们可以为 w 的计算增加一个负项，从而限制参数估计中 w 的大小，而防止多重共线性引起的参数 w 被估计过大导致模型失准的问题，Lasso 不是从根本上解决多重共线性问题，是限制多重共线性带来的影响。</p>
<h2 data-id="heading-10">错误速查</h2>

























<table><thead><tr><th>症状</th><th>根因</th><th>定位修复方法</th></tr></thead><tbody><tr><td>无法求解模型</td><td>特征矩阵共线性</td><td>特征矩阵XTX不可逆，通过岭回归或增大λ值</td></tr><tr><td>过拟合</td><td>模型复杂度过高</td><td>特征过多且无有效选择，使用Lasso进行特征选择</td></tr><tr><td>特征选择不足</td><td>岭回归无法将特征压缩为零</td><td>需要自动化特征选择，使用Lasso或Elastic Net</td></tr></tbody></table>
<h2 data-id="heading-11">其他系列</h2>
<h3 data-id="heading-12">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-132 Java 生态前沿 2025：Spring、Quarkus、GraalVM、CRaC 与云原生落地</strong></p>
<h3 data-id="heading-13">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-218 RocketMQ Java API 实战：同步/异步 Producer 与 Pull/Push Consumer</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 已完结，OSS已完结，GuavaCache已完结，EVCache已完结，RabbitMQ已完结，RocketMQ正在更新... 深入浅出助你打牢基础！</p>
<h3 data-id="heading-14">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DeepSeek V4，定档春节]]></title>    <link>https://juejin.cn/post/7593481317250220058</link>    <guid>https://juejin.cn/post/7593481317250220058</guid>    <pubDate>2026-01-10T01:23:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593481317250220058" data-draft-id="7593177437082337331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DeepSeek V4，定档春节"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-01-10T01:23:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="童欧巴"/> <meta itemprop="url" content="https://juejin.cn/user/3491704662669469"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DeepSeek V4，定档春节
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3491704662669469/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    童欧巴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T01:23:43.000Z" title="Sat Jan 10 2026 01:23:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>兄弟们，坐稳了，大的真要来了。</p>
<p>外媒《The Information》刚刚捅出一个猛料。</p>
<p>DeepSeek V4 定档春节，计划 2 月中旬发布。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8da23f25342e40468d3fd8a6d458f1f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=ljQw6kLEd11r8ZIO%2BgLTbhN98BA%3D" alt="" loading="lazy"/></p>
<p>而且，这次的目标很明确，显著提升了编程能力。</p>
<p>注意，这绝对不是一次常规的升级。</p>
<p>据多位参与内部测试的人士透露，在多个内部编程基准中。</p>
<p>DeepSeek V4 已经直接超越了当前全球范围内的主流模型。</p>
<p>虽然官方还没回应，但我觉得这事儿大概率是真的。</p>
<p>因为最近，DeepSeek 悄咪咪的把 DeepSeek R1 的论文更新了。</p>
<p>从原来的 22 页直接加厚到 86 页。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef04e2166de64c22aa616bd32bbf719b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=f5%2B9gzb5ZSe6IeUQbIj9Er1gdlA%3D" alt="https://arxiv.org/abs/2501.12948" loading="lazy"/></p>
<p>还有，最新版的 DeepSeek 手机 App，新增了语音输入。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3bf6304215d4bc9948898cc8d5aed0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=Z7kswUv0O1Ihk%2FqXdTKXx5O7h1g%3D" alt="" loading="lazy"/></p>
<p>一切迹象，都像极了在给新模型做预热。</p>
<p>真的要好好期待一下了。</p>
<p>新模型还在路上，但更新的论文还是非常精彩的。</p>
<p>我看完之后，先来跟大家分享三点。</p>
<h2 data-id="heading-0">1</h2>
<p>训练出 R1 这样，一个能跟 OpenAI 的 o1 掰手腕的模型。</p>
<p>总共花了多少钱呢？</p>
<p>看这张表格。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f62076c4555c43f197288ca9528ecb54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=Q7aAgGcaWwu0bx7LojT22G1xTeM%3D" alt="" loading="lazy"/></p>
<p>你没看错，29.4 万美元。</p>
<p>相比之下，海外大模型训练，动不动就是千万美元，上亿美元。</p>
<p>29.4 万美元，在硅谷连一个资深工程师一年的工资都不够。</p>
<p>这事儿最打脸的，就是前 Scale AI 的 CEO，Meta 现任首席 AI 官，Alexandr Wang 了。</p>
<p>他经常说，必须要用昂贵的人工标注数据，天价的算力和顶级的芯片才能做出顶级 AI。</p>
<p>这回 DeepSeek 更新完的论文，相当于一份完全可复现的技术报告。</p>
<p>现在所有的证据都摆在这了。</p>
<p>还花钱看啥爽剧啊，还有比 DeepSeek 更燃的主角吗？</p>
<h2 data-id="heading-1">2</h2>
<p>说真的，再次看到这，我还是起了点鸡皮疙瘩。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0e1ac4299a34edda4cdfe9f56a8da65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=dETHYRk3oXQ85qFIgvmI1uyZMew%3D" alt="" loading="lazy"/></p>
<p>上图的红字是 AI 的思考过程，翻译过来的意思是。</p>
<p><strong>等等，等等，等一下，这正是我要标记的一个顿悟时刻。</strong></p>
<p>这就是强化学习的威力和魅力。</p>
<p>以前训练 AI 爹味十足，像教小孩儿一样，手把手一步一步教他步骤。</p>
<p>这次，DeepSeek 选择了放手，不教你怎么思考，只告诉你答案对不对。</p>
<p>答对了给颗糖，答错了就饿着。</p>
<p>结果在没有任何人教导的情况下，AI 的思考过程中涌现了人类才有的犹豫。</p>
<p>为了获得奖励，AI 居然进化出了自我博弈。</p>
<p>听着很抽象。</p>
<p>这就像你考试答题落笔之前，眉头紧锁，停顿的那几秒。</p>
<p>这声 Wait，是 AI 在一片混沌中，点燃的第一根火柴。</p>
<h2 data-id="heading-2">3</h2>
<p>在论文的蒸馏部分，DeepSeek 回答了一个更具颠覆性的问题。</p>
<p>R1 身上的能力，能不能有效稳定的迁移到小模型上呢？</p>
<p>能，而且效果炸裂。</p>
<p>让 R1 当老师，生成高质量的思维链数据，然后通过监督微调 SFT，直接把这套内功心法传授给小模型。</p>
<p>这就是蒸馏。</p>
<p>好比武林盟主把自己毕生领悟的剑法写成了秘籍，直接扔给了小师弟们。</p>
<p>小师弟们不用再去江湖上挨打试错，不用再跑一遍强化学习的流程，直接照着练就行。</p>
<p>DeepSeek 系统性地实验了 1.5B、7B、8B、14B、32B、70B 等各种规模的小模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55cd887eb818419eb282b8b26c5ec60c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=wDwParAYjZDR6zW8WlW5yGbJPFU%3D" alt="" loading="lazy"/></p>
<p>不管啥尺寸，蒸馏之后性能都得到了大幅提升。</p>
<p>顶级的智能，可以像水一样流动，以更低成本的无缝迁移到小模型身上。</p>
<p>听着有些魔幻，但这才是 DeepSeek 一直所追求的事情。</p>
<p>让智能像自来水一样，便宜且触手可及。</p>
<h2 data-id="heading-3">尾声</h2>
<p>他们建起了高墙，挖深了护城河。</p>
<p>墙内本来 2 块钱的面包，卖到了 200 块。</p>
<p>有一天，DeepSeek 来到墙跟前，狠狠地踹了这堵墙一脚。</p>
<p>墙塌了。</p>
<p>大家往里一看，发面里面没有什么魔法，也没有什么神迹。</p>
<p>有的只是极致的数学，纯粹的逻辑，和一群充满好奇心的工程师。</p>
<p>DeepSeek 官网有句话，我真的特别特别喜欢。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/decd96fe43fb4e5ba9c46d9744bd54a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=a6PQcfkE4FRgTJJmG3efkRjdku0%3D" alt="" loading="lazy"/></p>
<p>探索未至之境。</p>
<p>是啊，我们要永远去探索前人尚未探索之地。</p>
<p>这才是人最应该做的事情，来牵引 AI 走向我们认可的方向。</p>
<p>敢问路在何方？</p>
<p>路，其实就在我们每个人的脚下。</p>
<h2 data-id="heading-4">❤️爱心三连击</h2>
<p>1.如果你觉得欧巴的文章还合胃口，就点个赞支持下吧，你的<strong>赞</strong>是我最大的动力。</p>
<p>2.关注&gt;&gt;&gt;<a href="https://link.juejin.cn?target=https%3A%2F%2Fraw.githubusercontent.com%2FGeekhyt%2Ffront-end-canteen%2Frefs%2Fheads%2Fmaster%2Fimages%2Fqrcode.jpg" target="_blank" title="https://raw.githubusercontent.com/Geekhyt/front-end-canteen/refs/heads/master/images/qrcode.jpg" ref="nofollow noopener noreferrer">公众号欧巴聊AI</a>，AI 时代陪你一起成长。</p>
<p>3.点赞、评论、转发 === 催更！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go语言动手写Web框架 - Gee第四天 分组控制]]></title>    <link>https://juejin.cn/post/7593098101432631350</link>    <guid>https://juejin.cn/post/7593098101432631350</guid>    <pubDate>2026-01-09T12:44:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593098101432631350" data-draft-id="7593165280488636457" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go语言动手写Web框架 - Gee第四天 分组控制"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-09T12:44:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Way2top"/> <meta itemprop="url" content="https://juejin.cn/user/1458388314893300"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go语言动手写Web框架 - Gee第四天 分组控制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458388314893300/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Way2top
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:44:45.000Z" title="Fri Jan 09 2026 12:44:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">Group 设计的原因</h4>
<p>随着 Gee 支持了动态路由匹配，新的结构性问题也随之出现。 在真实的 Web 开发中，路由并非同质的，而是天然存在语义分层。例如：以 <code>/post</code> 开头的路由允许匿名访问；以 <code>/admin</code> 开头的路由需要鉴权；以 <code>/api</code> 开头的路由面向第三方平台，需要额外的鉴权与限制。</p>
<p>如果希望对所有 <code>/admin</code> 类型接口统一做鉴权，在当前仅支持动态路由匹配的框架能力下，就只能在每一个 <code>/admin</code> 路由中重复编写鉴权逻辑。这不仅带来大量重复代码，也违背了开闭原则（OCP），并且使横切逻辑难以维护和扩展。同样地，如果希望对 <code>/post</code> 路由统一增加一组中间件来扩展能力，现有结构也难以优雅支持。</p>
<p>问题因此自然演化为：<strong>如何在不修改已有路由定义的前提下，为一类路由统一施加行为？</strong> 这实际上要求框架中引入“路由作用域”的概念，而不仅仅是“路径匹配”。</p>
<p>一个直观的想法是：是否可以直接在 router 结构体中加入分组相关的数据结构？</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> router <span class="hljs-keyword">struct</span> {
        roots    <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*node
        handlers <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]HandlerFunc
}
</code></pre>
<p>但这在设计上并不合理。<strong>router 的职责被严格限定为：根据 Method + Path 进行匹配并找到对应的 handler。</strong> 它是一个偏算法和数据结构的组件，只关心匹配规则本身，而不关心任何业务语义。</p>
<p>中间件则恰恰相反：它承载的是强业务语义（如鉴权、日志、限流），与作用域密切相关，却与具体的路径匹配算法无关。如果将中间件直接挂载在 router 上，就会迫使 router 同时承担“路径匹配”和“业务控制”两种职责，从而破坏其单一职责原则，也使路由匹配层被业务语义污染。</p>
<p>因此，引入 RouterGroup 本质上是引入一个独立于匹配算法之外的“路由作用域”抽象。它以 URL 前缀作为边界，将一组路由组织到同一语义空间中，使中间件能够按组复用、按层叠加，而 router 仍然只专注于路径匹配本身。这正是中间件必须基于 Group，而不能直接基于 Router 的根本原因。</p>
<h4 data-id="heading-1">Group 具体设计</h4>
<p>接下来我们考虑如何设计 Group 的结构。既然 Group 是用来区分不同路由分组以及承载中间件的，那么肯定要有一个 <code>perfix</code> 来用于区分不同分组（根据路由的前缀进行分组），而用于承载中间件的话可以使用一个 <code>[]HandlerFunc</code> 用于存放多个中间件。另外，我们支持分组嵌套，例如对于 <code>/admin/golang</code> 这个路由来说，<code>/admin</code> 包含的中间件 <code>/admin/golang</code> 也应该拥有，为了实现这一点，还需要有一个 <code>parent</code> 属性用于记录当前路由的上级路由，这样上级路由所拥有的中间件就可以集成到后续的子路由中了。</p>
<p>最后，既然 <code>Group</code> 对象需要进行一些路由操作，那么还需要有访问 <code>Router</code> 的能力。为了方便，我们可以在 <code>Group</code> 中保存一个指针，指向 <code>Engine</code>，因为整个框架的资源都是由 <code>Engine</code> 统一协调的，这样做之后就可以通过 <code>Engine</code> 间接的访问各种借口了。因此，最终 <code>Group</code> 的结构如下：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> RouterGroup <span class="hljs-keyword">struct</span> {
        prefix      <span class="hljs-type">string</span>
        middlewares []HandlerFunc <span class="hljs-comment">// 支持中间件</span>
        parent      *RouterGroup  <span class="hljs-comment">// 支持嵌套</span>
        engine      *Engine       <span class="hljs-comment">// 所有 group 共享一个 Engine 实例</span>
}
</code></pre>
<p>我们还可以进一步地抽象，将<code>Engine</code>作为最顶层的分组，也就是说<code>Engine</code>拥有<code>RouterGroup</code>所有的能力。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">type</span> Engine struct {
        *RouterGroup
        router *router
        <span class="hljs-built_in">groups</span> []*RouterGroup // 存储所有 <span class="hljs-built_in">groups</span>
}
</code></pre>
<p>有关为什么要进一步抽象来将 <code>Engine</code> 作为最顶层，具体原因如下：如果不将 <code>Engine</code> 修改为拥有 <code>RouterGroup</code> 的能力，<code>Engine</code> 仅仅定义 <code>RouterGroup</code> 的话，后续会在创建和管理路由分组时遇到问题。比如，我们需要频繁地通过 <code>Engine</code> 访问 <code>RouterGroup</code>，并且在 <code>RouterGroup</code> 中定义路由的功能会显得不够直观，尤其是在需要分组嵌套或统一管理多个分组的情况下，代码会变得更加复杂且不易扩展。进而我们想到将 <code>Engine</code> 修改为直接包含 <code>RouterGroup</code> 的能力，这样 <code>Engine</code> 就能像 <code>RouterGroup</code> 一样，直接支持路由分组的创建、管理和中间件的使用，使得路由分组的功能更加统一和灵活。修改后，<code>Engine</code> 不仅管理路由，还能管理分组和中间件，简化了代码结构，避免了冗余的接口调用，使得代码更加简洁、易于维护和扩展。</p>
<p>那么定义好 Group 之后，我们就可以对 gee.go 中的内容进行重写了：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Group 用于创建一个新的 RouterGroup</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> Group(prefix <span class="hljs-type">string</span>) *RouterGroup {
        engine := group.engine
        newGroup := &amp;RouterGroup{
                prefix: group.prefix + prefix,
                parent: group,
                engine: engine,
        }
        engine.groups = <span class="hljs-built_in">append</span>(engine.groups, newGroup)
        <span class="hljs-keyword">return</span> newGroup
}

<span class="hljs-comment">// 工具函数，后续 GET 和 POST 会使用这个函数给 engine 的路由表添加路由</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> addRoute(method <span class="hljs-type">string</span>, comp <span class="hljs-type">string</span>, handler HandlerFunc) {
        pattern := group.prefix + comp
        log.Printf(<span class="hljs-string">"Route %4s - %s"</span>, method, pattern)
        group.engine.router.addRoute(method, pattern, handler)
        <span class="hljs-comment">//engine.router.addRoute(method, pattern, handler)</span>
}

<span class="hljs-comment">// GET 提供给用户注册 GET 请求的便捷方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> GET(pattern <span class="hljs-type">string</span>, handler HandlerFunc) {
        group.addRoute(<span class="hljs-string">"GET"</span>, pattern, handler)
}

<span class="hljs-comment">// POST 提供给用户注册 POST 请求的便捷方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> POST(pattern <span class="hljs-type">string</span>, handler HandlerFunc) {
        group.addRoute(<span class="hljs-string">"POST"</span>, pattern, handler)
}
</code></pre>
<p>最后，写完之后可以进行测试：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// main.go</span>
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"gee"</span>
        <span class="hljs-string">"net/http"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
        r := gee.New()
        r.GET(<span class="hljs-string">"/index"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                c.HTML(http.StatusOK, <span class="hljs-string">"&lt;h1&gt;Index Page&lt;/h1&gt;"</span>)
        })
        v1 := r.Group(<span class="hljs-string">"/v1"</span>)
        {
                v1.GET(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                        c.HTML(http.StatusOK, <span class="hljs-string">"&lt;h1&gt;Hello Gee&lt;/h1&gt;"</span>)
                })

                v1.GET(<span class="hljs-string">"/hello"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                        <span class="hljs-comment">// 期望 /hello?name=way2top</span>
                        c.String(http.StatusOK, <span class="hljs-string">"hello %s, you're at %s\n"</span>, c.Query(<span class="hljs-string">"name"</span>), c.Path)
                })
        }
        v2 := r.Group(<span class="hljs-string">"/v2"</span>)
        {
                v2.GET(<span class="hljs-string">"/hello/:name"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                        <span class="hljs-comment">// 期望 /hello/way2top</span>
                        c.String(http.StatusOK, <span class="hljs-string">"hello %s, you're at %s\n"</span>, c.Param(<span class="hljs-string">"name"</span>), c.Path)
                })
                v2.POST(<span class="hljs-string">"/login"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                        c.JSON(http.StatusOK, gee.H{
                                <span class="hljs-string">"username"</span>: c.PostForm(<span class="hljs-string">"username"</span>),
                                <span class="hljs-string">"password"</span>: c.PostForm(<span class="hljs-string">"password"</span>),
                        })
                })
        }

        r.Run(<span class="hljs-string">":9999"</span>)
}
</code></pre>
<p>终端测试：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/index   </span>
&lt;<span class="hljs-selector-tag">h1</span>&gt;<span class="hljs-selector-tag">Index</span> <span class="hljs-selector-tag">Page</span>&lt;/<span class="hljs-selector-tag">h1</span>&gt;%                              
<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/v1</span>
&lt;<span class="hljs-selector-tag">h1</span>&gt;<span class="hljs-selector-tag">Hello</span> <span class="hljs-selector-tag">Gee</span>&lt;/<span class="hljs-selector-tag">h1</span>&gt;%                               
<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/v1/</span>
&lt;<span class="hljs-selector-tag">h1</span>&gt;<span class="hljs-selector-tag">Hello</span> <span class="hljs-selector-tag">Gee</span>&lt;/<span class="hljs-selector-tag">h1</span>&gt;%                               
<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/v1/hello</span>
<span class="hljs-selector-tag">hello</span> , <span class="hljs-selector-tag">you</span>'<span class="hljs-selector-tag">re</span> <span class="hljs-selector-tag">at</span> /<span class="hljs-selector-tag">v1</span>/<span class="hljs-selector-tag">hello</span>

<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/v2      </span>
<span class="hljs-number">404</span> <span class="hljs-selector-tag">NOT</span> <span class="hljs-selector-tag">FOUND</span>: <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-tag">s</span>
%!(EXTRA string=/v2)%                             
<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/v2/hello/way</span>
<span class="hljs-selector-tag">hello</span> <span class="hljs-selector-tag">way</span>, <span class="hljs-selector-tag">you</span>'<span class="hljs-selector-tag">re</span> <span class="hljs-selector-tag">at</span> /<span class="hljs-selector-tag">v2</span>/<span class="hljs-selector-tag">hello</span>/<span class="hljs-selector-tag">way</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年React生态最新趋势：我从Redux迁移到Zustand后性能提升40%的心得]]></title>    <link>https://juejin.cn/post/7593240931286548532</link>    <guid>https://juejin.cn/post/7593240931286548532</guid>    <pubDate>2026-01-10T00:16:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593240931286548532" data-draft-id="7593240931286532148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年React生态最新趋势：我从Redux迁移到Zustand后性能提升40%的心得"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-10T00:16:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年React生态最新趋势：我从Redux迁移到Zustand后性能提升40%的心得
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T00:16:46.000Z" title="Sat Jan 10 2026 00:16:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>2025年React生态最新趋势：我从Redux迁移到Zustand后性能提升40%的心得</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>在React生态系统中，状态管理一直是开发者们热议的话题。从早期的Flux架构到Redux的统治地位，再到近年来轻量级解决方案的崛起，状态管理库的演进从未停止。2025年，随着React Concurrent Features的全面普及和开发者对性能的极致追求，Zustand凭借其简洁性、高性能和可扩展性，逐渐成为许多团队的首选。</p>
<p>作为一名长期使用Redux的前端工程师，我在最近的项目中完成了从Redux到Zustand的迁移，并见证了高达40%的性能提升。本文将分享这一迁移过程中的技术细节、性能优化心得以及对未来React状态管理趋势的思考。</p>
<hr/>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. Redux的历史与挑战</h3>
<p>Redux自2015年诞生以来，一直是React生态中最主流的状态管理方案。其单向数据流、纯函数Reducer和Middleware机制为大型应用提供了可预测的状态管理能力。然而，随着时间的推移，Redux的一些问题也逐渐暴露：</p>
<ul>
<li><strong>模板代码过多</strong>：即使是一个简单的状态更新，也需要定义Action、Reducer和Dispatcher。</li>
<li><strong>性能开销</strong>：基于Context API的实现方式导致不必要的组件重渲染问题。</li>
<li><strong>学习曲线陡峭</strong>：对于新手来说，Redux的概念（如Middleware、Thunk/Saga）较为复杂。</li>
</ul>
<p>尽管Redux Toolkit（RTK）在2019年后大幅简化了开发流程，但在2025年的高并发场景下，其性能瓶颈依然存在。</p>
<h3 data-id="heading-4">2. Zustand的核心优势</h3>
<p>Zustand是一个由Poimandres团队开发的轻量级状态管理库，其设计哲学是“简单且高效”。以下是Zustand的核心优势：</p>
<h4 data-id="heading-5">（1）极简API</h4>
<p>Zustand的API非常简洁，只需几行代码即可定义一个Store：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;

<span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
}));
</code></pre>
<p>相比Redux的模板代码，Zustand的开发效率显著提升。</p>
<h4 data-id="heading-6">（2）精准更新</h4>
<p>Zustand基于Proxy实现细粒度响应式更新，只有依赖特定状态的组件才会重新渲染。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Component</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
};
</code></pre>
<p>即使Store中的其他状态变化了（如<code>user</code>字段），只要<code>count</code>未变，该组件就不会重渲染。</p>
<h4 data-id="heading-7">（3）原生支持异步操作</h4>
<p>Zustand无需Middleware即可直接处理异步逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">fetchData</span>: <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>);
    <span class="hljs-title function_">set</span>({ <span class="hljs-attr">data</span>: <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>() });
  },
}));
</code></pre>
<h4 data-id="heading-8">（4）卓越的性能表现</h4>
<p>在2025年的基准测试中（来源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkrausest%2Fjs-framework-benchmark" target="_blank" title="https://github.com/krausest/js-framework-benchmark" ref="nofollow noopener noreferrer">JS Framework Benchmark</a>），Zustand在万级组件场景下的渲染性能比Redux快40%以上。这主要得益于其避免了Context API的开销和优化的订阅机制。</p>
<h3 data-id="heading-9">3. 迁移实践与性能优化</h3>
<h4 data-id="heading-10">（1）渐进式迁移策略</h4>
<p>我们的项目是一个拥有10万+行代码的大型企业应用。为了降低风险，我们采用了渐进式迁移策略：</p>
<ol>
<li><strong>新功能优先使用Zustand</strong>：避免在老代码上投入更多精力。</li>
<li><strong>逐步替换Redux模块</strong>：从低频更新的模块开始迁移（如用户配置）。</li>
<li><strong>共享状态桥接</strong>：通过自定义Hook实现Redux和Zustand的状态同步：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">useCombinedStore</span> = (<span class="hljs-params">selector</span>) =&gt; {
  <span class="hljs-keyword">const</span> reduxState = <span class="hljs-title function_">useSelector</span>(selector);
  <span class="hljs-keyword">const</span> zustandState = <span class="hljs-title function_">useZustandStore</span>(selector);
  <span class="hljs-keyword">return</span> reduxState || zustandState;
};
</code></pre>
</li>
</ol>
<h4 data-id="heading-11">（2）关键性能优化点</h4>
<ul>
<li><strong>避免嵌套Selectors</strong>：深度嵌套的选择器会触发不必要的计算。</li>
<li><strong>使用Shallow比较</strong>：对于复杂对象，使用<code>shallow</code>比较函数减少重渲染：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallow } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand/shallow'</span>;
<span class="hljs-keyword">const</span> { user, profile } = <span class="hljs-title function_">useStore</span>(
  <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">user</span>: state.<span class="hljs-property">user</span>, <span class="hljs-attr">profile</span>: state.<span class="hljs-property">profile</span> }),
  shallow
);
</code></pre>
</li>
<li><strong>合理拆分Store</strong>：按业务域拆分多个小型Store而非单一全局Store。</li>
</ul>
<h4 data-id="heading-12">（3）实际效果对比</h4>
<p>迁移完成后，我们通过React Profiler进行了量化对比：</p>





























<table><thead><tr><th>Metric</th><th>Redux</th><th>Zustand</th><th>Improvement</th></tr></thead><tbody><tr><td>Render Time (ms)</td><td>120</td><td>72</td><td>-40%</td></tr><tr><td>Bundle Size (KB)</td><td>45</td><td>8</td><td>-82%</td></tr><tr><td>LOC</td><td>~1500</td><td>~400</td><td>-73%</td></tr></tbody></table>
<h3 data-id="heading-13">4. React未来生态的趋势展望</h3>
<p>基于这次迁移经验和2025年的技术发展动态，我认为以下趋势将成为主流：</p>
<h4 data-id="heading-14">（1）轻量化成为刚需</h4>
<p>随着Web应用的复杂度持续增长，“零开销”理念将更受重视。类似Zustand、Jotai这样的轻量级库会进一步挤压Redux的市场份额。</p>
<h4 data-id="heading-15">（2）并发模式友好设计</h4>
<p>React Server Components和Concurrent Features要求状态管理库具备更高的调度灵活性。Zustands的可中断更新机制比传统的单向数据流更具优势。</p>
<h4 data-id="heading-16">（3）类型安全成为标配</h4>
<p>TypeScript的使用率已超过90%，新一代状态管理库都会优先考虑类型推导能力（如Zustands出色的自动类型推断）。</p>
<hr/>
<h2 data-id="heading-17">总结</h2>
<p>从Redux到Zustands的迁移不仅是一次技术栈升级</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建现代化的 Python PostgreSQL 工具库：psql_utils 的重构与优化之旅]]></title>    <link>https://juejin.cn/post/7593338828195889192</link>    <guid>https://juejin.cn/post/7593338828195889192</guid>    <pubDate>2026-01-10T00:33:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195889192" data-draft-id="7593193235251740724" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建现代化的 Python PostgreSQL 工具库：psql_utils 的重构与优化之旅"/> <meta itemprop="keywords" content="Python,PostgreSQL"/> <meta itemprop="datePublished" content="2026-01-10T00:33:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lupino"/> <meta itemprop="url" content="https://juejin.cn/user/3051900006579256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建现代化的 Python PostgreSQL 工具库：psql_utils 的重构与优化之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3051900006579256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lupino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T00:33:12.000Z" title="Sat Jan 10 2026 00:33:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代 Python 后端开发中，轻量级且高效的数据库交互工具至关重要。本文将总结 <code>psql_utils</code> 库的架构设计与重构过程。这是一个基于 <code>psycopg</code> 3 构建的 PostgreSQL 工具库，旨在提供类型安全、同时支持同步（Sync）与异步（Async）的高级数据操作接口。</p>
<h2 data-id="heading-0">1. 项目概览与架构设计</h2>
<p><code>psql_utils</code> 并没有采用全功能的 ORM（对象关系映射）模式，而是选择了一种更轻量级的“SQL 构建器 + 记录操作”模式。这种设计在保持 SQL 灵活性的同时，大大简化了常见的 CRUD 操作。</p>
<p>项目核心由以下几个模块组成：</p>
<ul>
<li><strong>类型定义与 SQL 构建 (<code>types.py</code>, <code>gen_sql.py</code>)</strong> : 负责将 Python 对象转换为 SQL 语句，避免了容易出错的字符串拼接。</li>
<li><strong>连接池管理 (<code>__init__.py</code>, <code>sync.py</code>)</strong> : 分别提供了基于 <code>asyncio</code> 的异步连接池和基于线程的同步连接池，二者共享相似的 API 设计。</li>
<li><strong>记录操作抽象 (<code>record.py</code>, <code>record_sync.py</code>, <code>record_utils.py</code>)</strong> : 在 SQL 构建之上封装了 <code>get</code> (查询), <code>save</code> (插入/更新), <code>remove</code> (删除) 等高层业务逻辑。</li>
<li><strong>打包配置 (<code>pyproject.toml</code>, <code>setup.py</code>)</strong> : 遵循现代 Python 打包标准。</li>
</ul>
<h2 data-id="heading-1">2. 核心重构与优化点</h2>
<p>在对代码库的全面审查中，我们实施了严格的 PEP 8 规范，并修复了潜在的运行时错误。以下是本次重构的关键优化点：</p>
<h3 data-id="heading-2">A. 修复可变默认参数 (Mutable Default Arguments)</h3>
<p>这是 Python 中最常见的陷阱之一。在原代码中，多个函数使用了 <code>list</code> 作为默认参数（例如 <code>keys=[]</code>）。这会导致列表对象在函数调用间共享，从而引发难以调试的状态污染 bug。</p>
<p><strong>优化前：</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini">def __init__(self, <span class="hljs-attr">joins</span>=[]):  <span class="hljs-comment"># 危险！所有实例共享同一个列表</span>
    <span class="hljs-attr">self.joins</span> = joins
</code></pre>
<p><strong>优化后：</strong></p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, joins: <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[LeftJoin]] = <span class="hljs-literal">None</span></span>):
    <span class="hljs-comment"># 安全：每次初始化都创建新列表</span>
    self.joins = joins <span class="hljs-keyword">if</span> joins <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> []
</code></pre>
<h3 data-id="heading-3">B. 类型提示与安全性 (Type Hinting)</h3>
<p>引入了 <code>typing</code> 模块（<code>Optional</code>, <code>List</code>, <code>Union</code>, <code>Callable</code>），配合 <code>mypy_extensions</code>，极大地增强了代码的可读性和 IDE 的自动补全能力。所有函数签名现在都清晰地表明了输入输出类型，减少了类型相关的运行时错误。</p>
<h3 data-id="heading-4">C. 代码风格与规范 (PEP 8 &amp; 79字符限制)</h3>
<p>为了适应各种开发环境（包括终端编辑器和分屏开发），我们强制执行了每行不超过 79 个字符的标准。</p>
<ul>
<li><strong>字符串格式化</strong>：将陈旧的 <code>.format()</code> 方法全面替换为 Python 3.6+ 的 f-string，不仅代码更短，性能也更优。</li>
<li><strong>文档注释</strong>：为核心类和函数添加了清晰的英文 Docstrings，解释了参数用途和返回值。</li>
</ul>
<h3 data-id="heading-5">D. 连接池的健壮性</h3>
<p>在 <code>__init__.py</code> (Async) 和 <code>sync.py</code> (Sync) 中，使用了装饰器模式 (<code>@run_with_pool</code>) 来自动管理数据库游标（Cursor）的生命周期。</p>
<ul>
<li><strong>自动重连</strong>：当检测到连接断开（如 <code>closing</code> 错误）时，装饰器会自动尝试重新建立连接池并重试操作，大大提高了服务在数据库重启或网络波动下的稳定性。</li>
</ul>
<h2 data-id="heading-6">3. 核心功能展示</h2>
<h3 data-id="heading-7">智能的 SQL 生成</h3>
<p><code>gen_sql.py</code> 处理了复杂的 SQL 拼接逻辑，特别是 <code>UPSERT</code>（插入或更新）操作。</p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 自动生成 INSERT INTO ... ON CONFLICT DO UPDATE</span>
<span class="hljs-attr">sql</span> = gen.gen_insert_or_update(
    <span class="hljs-attr">table_name</span>=t(<span class="hljs-string">'users'</span>),
    <span class="hljs-attr">uniq_columns</span>=[c(<span class="hljs-string">'email'</span>)],
    <span class="hljs-attr">value_columns</span>=[c(<span class="hljs-string">'name'</span>), c(<span class="hljs-string">'age'</span>)]
)
</code></pre>
<h3 data-id="heading-8">统一的 Record API</h3>
<p>无论是在异步还是同步环境中，开发者都可以使用几乎一致的 API 来处理数据。</p>
<p><strong>异步保存数据 (<code>record.py</code>)：</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 如果 id 存在则更新，否则根据唯一键判断是插入还是更新</span>
<span class="hljs-attr">user_id</span> = await record.save(
    <span class="hljs-attr">table</span>=t(<span class="hljs-string">'users'</span>),
    <span class="hljs-attr">uniq_keys</span>=[<span class="hljs-string">'email'</span>],
    <span class="hljs-attr">email</span>=<span class="hljs-string">'user@example.com'</span>,
    <span class="hljs-attr">name</span>=<span class="hljs-string">'Pythonista'</span>,
    <span class="hljs-attr">json_keys</span>=[<span class="hljs-string">'meta'</span>] <span class="hljs-comment"># 自动处理 JSON 序列化与合并</span>
)
</code></pre>
<p><strong>同步获取列表 (<code>record_sync.py</code>)：</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 支持分页、排序、JSON 字段查询</span>
<span class="hljs-attr">users</span> = record_sync.get_list(
    <span class="hljs-attr">table</span>=t(<span class="hljs-string">'users'</span>),
    <span class="hljs-attr">part_sql</span>=<span class="hljs-string">"meta#&gt;&gt;'{role}' = %s"</span>,
    <span class="hljs-attr">args</span>=(<span class="hljs-string">'admin'</span>,),
    <span class="hljs-attr">size</span>=<span class="hljs-number">20</span>,
    <span class="hljs-attr">sorts</span>=<span class="hljs-string">'created_at desc'</span>
)
</code></pre>
<h2 data-id="heading-9">4. 现代化打包与依赖</h2>
<p>项目配置已更新以支持现代 Python 生态：</p>
<ul>
<li><strong>pyproject.toml</strong>：作为构建系统的核心，指定了构建依赖。</li>
<li><strong>依赖管理</strong>：明确声明了 <code>psycopg[binary,pool]</code>，确保安装时包含二进制驱动和连接池支持，提升安装速度和运行性能。</li>
<li><strong>版本兼容</strong>：明确标记支持 Python 3.8+，并移除了已废弃的 <code>distutils</code>。</li>
</ul>
<h2 data-id="heading-10">总结</h2>
<p>经过本次重构，<code>psql_utils</code> 从一个简单的工具脚本集合蜕变为一个健壮、类型安全且易于维护的 Python 库。它既保留了直接操作 SQL 的灵活性，又提供了足够的抽象来加速日常开发，是构建中小型 PostgreSQL 应用的理想选择。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[棒棒糖图：当条形图遇上极简美学]]></title>    <link>https://juejin.cn/post/7592990758477037587</link>    <guid>https://juejin.cn/post/7592990758477037587</guid>    <pubDate>2026-01-10T00:40:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592990758477037587" data-draft-id="7593145583348432938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="棒棒糖图：当条形图遇上极简美学"/> <meta itemprop="keywords" content="Python,数据可视化,数据分析"/> <meta itemprop="datePublished" content="2026-01-10T00:40:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            棒棒糖图：当条形图遇上极简美学
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T00:40:59.000Z" title="Sat Jan 10 2026 00:40:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>棒棒糖图</strong>（Lollipop Chart）可以看作是条形图的一种“轻盈版”变体：它用一根从基准线延伸出来的“棒”，并在末端以一个“糖”（圆点）来表示数值，取代了传统的矩形条。</p>
<p>这种图表传达的信息与条形图是一样的，但它更注重突出数据点的位置，整体看起来更加清新、现代。</p>
<p>今天，我们一起探索棒棒糖图的优势，并通过代码实现，亲手打造一个属于自己的棒棒糖图！</p>
<h2 data-id="heading-0">设计原理</h2>
<p>设计棒棒糖图的初衷有两个方面：</p>
<p>首先，通过减少图形中的“墨水”使用量，在面对大量类别或数值普遍较高的情况下，避免了条形图过于密集可能带来的<strong>视觉压迫感</strong>和<strong>杂乱无章</strong>的感觉；</p>
<p>其次，这样的设计能够更好地引导观察者的注意力集中在各个数据点的具体位置及其之间的差异上，非常适合用来进行排名或者对比分析。</p>
<p><strong>棒棒糖图</strong>与<strong>条形图</strong>在功能上是等价的，也并不总是优于条形图。</p>
<p>当处理大量类别、条柱非常高且相互之间距离较近的数据时，棒棒糖图会显得更加易于阅读理解；</p>
<p>然而，在需要强调绝对数量或是希望获得最为直观长度比较的情况下，条形图依然是更好的选择。</p>
<h2 data-id="heading-1">实现原理</h2>
<p><strong>棒棒糖图</strong>在<code>matplotlib</code>库中没有直接对应的类。</p>
<p>不过，它的实现原理非常简单，通过组合使用 <code>matplotlib</code> 中的两个基本绘图功能就可以实现：</p>
<ol>
<li><strong>绘制线条</strong> (<code>plt.vlines</code>)：这是构成棒棒糖“棍子”部分的关键。</li>
</ol>
<p><code>plt.vlines</code> 函数用于在图表上绘制垂直线段。通过指定每个数据点的 x 坐标、线条的起始点（通常是 0）和结束点（即对应数据的 y 值），就可以画出从 x 轴延伸到数据值的线条。</p>
<ol start="2">
<li><strong>绘制圆点</strong> (<code>plt.scatter</code>)：这是构成棒棒糖“糖”部分的关键。</li>
</ol>
<p><code>plt.scatter</code> 函数用于绘制散点图。通过将每个数据点的 x 坐标和 y 坐标（即数据值）作为参数传入，就可以在每条线的顶端绘制一个圆点。</p>
<p>总的来说，<strong>实现原理</strong>就是：用线条表示数值的大小，用圆点强调数值的终点位置，两者结合就形成了视觉上类似棒棒糖的图表。</p>
<p>这种组合方式使得图表比实心的条形图更简洁，同时又能清晰地传达数据信息。</p>
<p>下一节的示例中，将会演示如何使用<code>matplotlib</code>来绘制<strong>棒棒糖图</strong>。</p>
<h2 data-id="heading-2">应用示例</h2>
<p>接下来，让我们通过实际的对比示例，直观地感受棒棒糖图与传统条形图的不同表现。</p>
<h3 data-id="heading-3">适合棒棒糖图的场景</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建更多类别的测试数据</span>
<span class="hljs-comment"># 模拟不同月份中每天的某个指标（例如：每日平均步数，单位：千步）</span>
days = [<span class="hljs-string">f"Day <span class="hljs-subst">{i}</span>"</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">21</span>)]  <span class="hljs-comment"># 生成 20 天的数据</span>
np.random.seed(<span class="hljs-number">42</span>)  <span class="hljs-comment"># 设置随机种子，确保每次运行结果一致</span>
<span class="hljs-comment"># 生成 1 到 5 之间的随机数值作为示例数据</span>
values = np.<span class="hljs-built_in">round</span>(np.random.uniform(<span class="hljs-number">1.0</span>, <span class="hljs-number">5.0</span>, size=<span class="hljs-built_in">len</span>(days)), <span class="hljs-number">1</span>)

<span class="hljs-comment"># --- 创建子图 ---</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>))  <span class="hljs-comment"># 调整为垂直布局，方便比较</span>

<span class="hljs-comment"># --- 绘制条形图 (上图) ---</span>
bars = ax1.bar(days, values, color=<span class="hljs-string">"skyblue"</span>, edgecolor=<span class="hljs-string">"navy"</span>, linewidth=<span class="hljs-number">0.7</span>)
ax1.set_title(<span class="hljs-string">"条形图 (Bar Chart) - 每日步数"</span>, fontsize=<span class="hljs-number">14</span>)
ax1.set_ylabel(<span class="hljs-string">"数值 (千步)"</span>)
<span class="hljs-comment"># ax1.set_xlabel('日期') # x轴标签已在下方图中</span>
ax1.grid(axis=<span class="hljs-string">"y"</span>, linestyle=<span class="hljs-string">"--"</span>, alpha=<span class="hljs-number">0.7</span>)
<span class="hljs-comment"># 在条形图上添加数值标签</span>
<span class="hljs-keyword">for</span> bar, val <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(bars, values):
    height = bar.get_height()
    ax1.text(
        bar.get_x() + bar.get_width() / <span class="hljs-number">2.0</span>,
        height + <span class="hljs-number">0.05</span>,
        <span class="hljs-string">f"<span class="hljs-subst">{val}</span>"</span>,
        ha=<span class="hljs-string">"center"</span>,
        va=<span class="hljs-string">"bottom"</span>,
        fontsize=<span class="hljs-number">8</span>,
    )  <span class="hljs-comment"># 标签旋转90度节省空间</span>

<span class="hljs-comment"># --- 绘制棒棒糖图 (下图) ---</span>
<span class="hljs-comment"># 1. 绘制线条</span>
ax2.vlines(x=<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(days)), ymin=<span class="hljs-number">0</span>, ymax=values, color=<span class="hljs-string">"navy"</span>, linewidth=<span class="hljs-number">2</span>)
<span class="hljs-comment"># 2. 在线条顶部绘制圆点</span>
ax2.scatter(x=<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(days)), y=values, color=<span class="hljs-string">"red"</span>, s=<span class="hljs-number">50</span>, zorder=<span class="hljs-number">3</span>)
<span class="hljs-comment"># 3. 添加数值标签</span>
<span class="hljs-keyword">for</span> i, val <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(values):
    ax2.text(i, val + <span class="hljs-number">0.1</span>, <span class="hljs-string">f"<span class="hljs-subst">{val}</span>"</span>, ha=<span class="hljs-string">"center"</span>, va=<span class="hljs-string">"bottom"</span>, fontsize=<span class="hljs-number">8</span>)

ax2.set_title(<span class="hljs-string">"棒棒糖图 (Lollipop Chart) - 每日步数"</span>, fontsize=<span class="hljs-number">14</span>)
ax2.set_ylabel(<span class="hljs-string">"数值 (千步)"</span>)
ax2.set_xlabel(<span class="hljs-string">"日期"</span>)
ax2.set_xticks(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(days)))
ax2.set_xticklabels(days, rotation=<span class="hljs-number">45</span>, ha=<span class="hljs-string">"right"</span>)  <span class="hljs-comment"># 旋转x轴标签以便阅读</span>
ax2.grid(axis=<span class="hljs-string">"y"</span>, linestyle=<span class="hljs-string">"--"</span>, alpha=<span class="hljs-number">0.7</span>)
ax2.set_ylim(<span class="hljs-number">0</span>, <span class="hljs-built_in">max</span>(values) * <span class="hljs-number">1.1</span>)

<span class="hljs-comment"># --- 显示图形 ---</span>
plt.tight_layout()  <span class="hljs-comment"># 调整子图间距</span>
plt.show()
</code></pre>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf1d9bc25295437d9eca9ef2ad2c08df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768610458&amp;x-signature=RLIfamyr63H81ru8%2B1RRGHY13iI%3D" alt="" loading="lazy"/></p>
<p>这个示例使用了20个数据类别（Day 1 到 Day 20）。</p>
<p>你可以看到，在条形图中，许多蓝色的条形紧密地排列在一起，视觉上显得有些拥挤。</p>
<p>而在棒棒糖图中，线条和圆点使得数据点之间的关系更加清晰，整体视觉效果更轻盈，更容易比较各个数值的大小和识别模式。</p>
<h3 data-id="heading-4">适合传统条形图的场景</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建更适合条形图的测试数据</span>
<span class="hljs-comment"># 模拟某公司连续12个月的销售额（单位：万元）</span>
months = [
    <span class="hljs-string">"1月"</span>,
    <span class="hljs-string">"2月"</span>,
    <span class="hljs-string">"3月"</span>,
    <span class="hljs-string">"4月"</span>,
    <span class="hljs-string">"5月"</span>,
    <span class="hljs-string">"6月"</span>,
    <span class="hljs-string">"7月"</span>,
    <span class="hljs-string">"8月"</span>,
    <span class="hljs-string">"9月"</span>,
    <span class="hljs-string">"10月"</span>,
    <span class="hljs-string">"11月"</span>,
    <span class="hljs-string">"12月"</span>,
]
<span class="hljs-comment"># 生成有一定趋势和波动的销售额数据，例如有季节性高峰</span>
sales = [<span class="hljs-number">120</span>, <span class="hljs-number">110</span>, <span class="hljs-number">135</span>, <span class="hljs-number">140</span>, <span class="hljs-number">155</span>, <span class="hljs-number">170</span>, <span class="hljs-number">185</span>, <span class="hljs-number">180</span>, <span class="hljs-number">160</span>, <span class="hljs-number">150</span>, <span class="hljs-number">145</span>, <span class="hljs-number">165</span>]

<span class="hljs-comment"># --- 创建子图 ---</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">16</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># --- 绘制条形图 (左图) ---</span>
bars = ax1.bar(months, sales, color=<span class="hljs-string">"lightsteelblue"</span>, edgecolor=<span class="hljs-string">"black"</span>, linewidth=<span class="hljs-number">0.7</span>)
ax1.set_title(<span class="hljs-string">"条形图 (Bar Chart - 月份销售额)"</span>, fontsize=<span class="hljs-number">14</span>)
ax1.set_ylabel(<span class="hljs-string">"销售额 (万元)"</span>)
ax1.set_xlabel(<span class="hljs-string">"月份"</span>)
ax1.grid(axis=<span class="hljs-string">"y"</span>, linestyle=<span class="hljs-string">"--"</span>, alpha=<span class="hljs-number">0.7</span>)
<span class="hljs-comment"># 在条形图上添加数值标签</span>
<span class="hljs-keyword">for</span> bar, s <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(bars, sales):
    height = bar.get_height()
    ax1.text(
        bar.get_x() + bar.get_width() / <span class="hljs-number">2.0</span>,
        height + <span class="hljs-number">2</span>,
        <span class="hljs-string">f"<span class="hljs-subst">{s}</span>"</span>,
        ha=<span class="hljs-string">"center"</span>,
        va=<span class="hljs-string">"bottom"</span>,
        fontsize=<span class="hljs-number">9</span>,
    )

<span class="hljs-comment"># --- 绘制棒棒糖图 (右图) ---</span>
ax2.vlines(x=<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(months)), ymin=<span class="hljs-number">0</span>, ymax=sales, color=<span class="hljs-string">"gray"</span>, linewidth=<span class="hljs-number">2</span>)
ax2.scatter(x=<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(months)), y=sales, color=<span class="hljs-string">"coral"</span>, s=<span class="hljs-number">50</span>, zorder=<span class="hljs-number">3</span>)
<span class="hljs-keyword">for</span> i, s <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(sales):
    ax2.text(i, s + <span class="hljs-number">3</span>, <span class="hljs-string">f"<span class="hljs-subst">{s}</span>"</span>, ha=<span class="hljs-string">"center"</span>, va=<span class="hljs-string">"bottom"</span>, fontsize=<span class="hljs-number">9</span>)

ax2.set_title(<span class="hljs-string">"棒棒糖图 (Lollipop Chart - 月份销售额)"</span>, fontsize=<span class="hljs-number">14</span>)
ax2.set_ylabel(<span class="hljs-string">"销售额 (万元)"</span>)
ax2.set_xlabel(<span class="hljs-string">"月份"</span>)
ax2.set_xticks(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(months)))
ax2.set_xticklabels(months, rotation=<span class="hljs-number">45</span>)  <span class="hljs-comment"># 旋转x轴标签以防重叠</span>
ax2.grid(axis=<span class="hljs-string">"y"</span>, linestyle=<span class="hljs-string">"--"</span>, alpha=<span class="hljs-number">0.7</span>)
ax2.set_ylim(<span class="hljs-number">0</span>, <span class="hljs-built_in">max</span>(sales) * <span class="hljs-number">1.1</span>)

<span class="hljs-comment"># --- 显示图形 ---</span>
plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6a6af82104e4da68dfeb68137003d64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768610458&amp;x-signature=CKMCTkTKDEqnjlSONu3jYCO%2Fkfo%3D" alt="" loading="lazy"/></p>
<p>在这个示例中，数据代表的是连续的月份，数值本身代表的是销售额，这是一个“量”的概念。</p>
<p>条形图的实心块能让人立刻感受到哪个月份的销售额更高，整体的分布和对比关系一目了然。</p>
<p>而棒棒糖图虽然也展示了数据，但线条和圆点的组合在视觉上不如实心条形那样能直接传达“量”的感觉，尤其是在数值差异不是特别巨大时，对比效果会稍逊于条形图。</p>
<h2 data-id="heading-5">总结</h2>
<p><strong>棒棒糖图</strong>就像数据可视化世界中的"少即是多"哲学体现。</p>
<p>它不是要取代传统条形图，而是为数据可视化工具箱增加了一个有价值的选项。</p>
<p>就像不同的画笔适合不同的绘画风格，不同的图表类型也适合不同的数据故事。</p>
<p><strong>棒棒糖图</strong>的真正优势在于它改变了数据的**"讲述方式"**。</p>
<p>它不说："这是所有信息，你自己找重点"，而是说："看这里，这些是关键点"。</p>
<p>这种焦点导向的特性，使得棒棒糖图在现代快节奏的数据沟通中越来越受欢迎。</p>
<p>设计可视化时，我们不妨问问自己：我想要观众首先看到什么？如果是精确的数值点和清晰的排名，那么棒棒糖图可能是你的理想选择。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（33） Hibernate的投影（Projections）是什么？]]></title>    <link>https://juejin.cn/post/7593215107405512740</link>    <guid>https://juejin.cn/post/7593215107405512740</guid>    <pubDate>2026-01-09T23:29:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593215107405512740" data-draft-id="7593165280489111593" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（33） Hibernate的投影（Projections）是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T23:29:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（33） Hibernate的投影（Projections）是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T23:29:46.000Z" title="Fri Jan 09 2026 23:29:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的投影（Projections）</h3>
<p>在Hibernate中，投影（Projection）是指查询结果中只包含实体的某些属性，而不是整个实体对象。这对于优化查询性能和减少数据传输量非常有用。</p>
<p>Hibernate的投影可以通过Criteria API中的<code>Projections</code>类来实现。<code>Projections</code>类提供了多种方法，可以对查询结果进行投影，包括单属性、多属性、聚合（如计数、求和、平均值等）和分组等功能。</p>
<h3 data-id="heading-1">使用Projections的示例代码</h3>
<h4 data-id="heading-2">实体类定义</h4>
<p>我们继续使用之前定义的<code>Person</code>和<code>Address</code>实体类：</p>
<h5 data-id="heading-3">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-4">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-5">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-7">使用Projections示例</h3>
<h4 data-id="heading-8">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);

            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Main St"</span>, person1);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Oak St"</span>, person2);

            session.save(address1);
            session.save(address2);

            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-9">使用Projections查询</h4>
<h5 data-id="heading-10">查询Person的姓名和年龄</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.criterion.Projections;
<span class="hljs-keyword">import</span> org.hibernate.criterion.CriteriaQuery;
<span class="hljs-keyword">import</span> org.hibernate.criterion.Restrictions;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;

<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaBuilder;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateProjectionsExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用Projections查询Person的姓名和年龄</span>
        queryPersonNameAndAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonNameAndAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">CriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            CriteriaQuery&lt;Object[]&gt; criteriaQuery = criteriaBuilder.createQuery(Object[].class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);

            criteriaQuery.multiselect(root.get(<span class="hljs-string">"name"</span>), root.get(<span class="hljs-string">"age"</span>));

            List&lt;Object[]&gt; results = session.createQuery(criteriaQuery).getResultList();
            System.out.println(<span class="hljs-string">"Query Person name and age:"</span>);
            <span class="hljs-keyword">for</span> (Object[] row : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
                <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> (Integer) row[<span class="hljs-number">1</span>];
                System.out.println(name + <span class="hljs-string">" - "</span> + age);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-11">使用聚合函数查询</h5>
<p>假设我们想计算所有Person的平均年龄。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.criterion.Projections;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;

<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaBuilder;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateAggregateQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用Projections和聚合函数查询平均年龄</span>
        queryAverageAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAverageAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">CriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            CriteriaQuery&lt;Double&gt; criteriaQuery = criteriaBuilder.createQuery(Double.class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);

            criteriaQuery.select(criteriaBuilder.avg(root.get(<span class="hljs-string">"age"</span>)));

            <span class="hljs-type">Double</span> <span class="hljs-variable">averageAge</span> <span class="hljs-operator">=</span> session.createQuery(criteriaQuery).getSingleResult();
            System.out.println(<span class="hljs-string">"Average age of persons: "</span> + averageAge);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-12">Projections详细解释</h3>
<ol>
<li><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象和两个<code>Address</code>对象供查询使用。
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>,<span class="hljs-number">28</span>);
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（34）Hibernate的别名（Alias）是什么？]]></title>    <link>https://juejin.cn/post/7593139476841381894</link>    <guid>https://juejin.cn/post/7593139476841381894</guid>    <pubDate>2026-01-09T23:31:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593139476841381894" data-draft-id="7593215107405529124" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（34）Hibernate的别名（Alias）是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T23:31:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（34）Hibernate的别名（Alias）是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T23:31:10.000Z" title="Fri Jan 09 2026 23:31:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的别名（Alias）</h3>
<p>在Hibernate中，使用别名（Alias）可以为查询中的实体或属性指定一个简短的替代名称。别名的使用有助于简化查询语句，特别是在多表联接或复杂查询中。此外，别名还可以用于在相同查询中引用同一个实体的多个实例。</p>
<h3 data-id="heading-1">使用别名的示例代码</h3>
<h4 data-id="heading-2">实体类定义</h4>
<p>我们继续使用之前定义的<code>Person</code>和<code>Address</code>实体类。</p>
<h5 data-id="heading-3">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-4">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-5">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-7">使用别名的示例</h3>
<h4 data-id="heading-8">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);

            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Main St"</span>, person1);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Oak St"</span>, person2);

            session.save(address1);
            session.save(address2);

            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-9">使用别名进行查询</h4>
<h5 data-id="heading-10">查询Person及其Address信息</h5>
<p>使用别名来简化多表联接查询。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Join;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateAliasQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用别名查询Person及其Address信息</span>
        queryPersonAndAddress(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonAndAddress</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">HibernateCriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            JpaCriteriaQuery&lt;Object[]&gt; criteriaQuery = criteriaBuilder.createQuery(Object[].class);
            Root&lt;Person&gt; personRoot = criteriaQuery.from(Person.class);
            Join&lt;Person, Address&gt; addressJoin = personRoot.join(<span class="hljs-string">"address"</span>);

            <span class="hljs-comment">// 使用别名</span>
            criteriaQuery.multiselect(personRoot.get(<span class="hljs-string">"name"</span>).alias(<span class="hljs-string">"personName"</span>), addressJoin.get(<span class="hljs-string">"street"</span>).alias(<span class="hljs-string">"addressStreet"</span>));

            List&lt;Object[]&gt; results = session.createQuery(criteriaQuery).getResultList();
            System.out.println(<span class="hljs-string">"Query Person and Address:"</span>);
            <span class="hljs-keyword">for</span> (Object[] row : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">personName</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
                <span class="hljs-type">String</span> <span class="hljs-variable">addressStreet</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">1</span>];
                System.out.println(personName + <span class="hljs-string">" lives at "</span> + addressStreet);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-11">使用别名的详细解释</h3>
<ol>
<li>
<p><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象和两个<code>Address</code>对象供查询使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);

            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Main St"</span>, person1);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Oak St"</span>, person2);

            session.save(address1);
            session.save(address2);

            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>使用别名查询Person及其Address信息</strong>：我们使用别名来简化联接查询并投影特定的属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateAliasQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用别名查询Person及其Address信息</span>
        queryPersonAndAddress(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonAndAddress</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">HibernateCriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            JpaCriteriaQuery&lt;Object[]&gt; criteriaQuery = criteriaBuilder.createQuery(Object[].class);
            Root&lt;Person&gt; personRoot = criteriaQuery.from(Person.class);
            Join&lt;Person, Address&gt; addressJoin = personRoot.join(<span class="hljs-string">"address"</span>);

           
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[机器学习入门概述一览]]></title>    <link>https://juejin.cn/post/7593177437081911347</link>    <guid>https://juejin.cn/post/7593177437081911347</guid>    <pubDate>2026-01-09T15:18:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593177437081911347" data-draft-id="7593171168259620873" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="机器学习入门概述一览"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-09T15:18:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            机器学习入门概述一览
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:18:57.000Z" title="Fri Jan 09 2026 15:18:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>推荐直接网站在线阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Faicoting.cn%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//aicoting.cn/" ref="nofollow noopener noreferrer">aicoting AI算法面试学习在线网站</a></p>
</blockquote>
<h2 data-id="heading-0">定义与核心思想</h2>
<p>学习一个知识最重要的就是要知道这个知识的定义，定义虽然大多晦涩，却是最能完整清晰的表达这个知识的一种表达方式，那么机器学习的定义是什么呢？</p>
<p>机器学习（Machine Learning, ML）是人工智能（AI）的核心分支之一，其目标是通过数据驱动的方法使计算机系统能够自动学习规律，从而在没有显式编程的情况下完成预测、分类、决策和优化等任务。与传统程序设计依赖固定规则不同，机器学习强调经验学习和自我改进，能够从数据中发现潜在模式，并将其应用于新数据。</p>
<p>周志华老师的机器学习一书中给出的定义如下：机器学习是一门学科，致力于研究如何通过计算的手段，利用经验来改善系统自身的性能。在计算机系统中，“经验”通常以“数据”形式存在，因此，机器学习所研究的主要内容，是关于在计算机上从数据中产生“模型”的算法，即“学习算法”，有了学习算法，我们把经验数据提供给他，他就能基于这些数据产生模型；在面对新的情况时，模型会给我们提供相应的判断。如果说计算机科学是研究关于算法的学问，那么类似的，可以说机器学习是研究关于学习算法的学问。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eacb10ee074b478f8fc3d2435deafab9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=OnLf0ewL%2FYHLuQQDhme2%2BiP6%2BS8%3D" alt="" loading="lazy"/></p>
<p>机器学习的核心思想可以概括为以下几个方面：</p>
<ol>
<li>模型（Model）：模型是计算机“理解数据”的数学结构，负责从输入数据中捕捉规律，并进行预测或决策。不同的模型适用于不同类型的问题，例如线性回归用于连续值预测，决策树和神经网络适用于复杂模式识别。</li>
<li>训练（Training）：训练是模型学习的过程，通过输入大量数据，模型不断调整内部参数以最小化预测误差。训练过程的质量直接影响模型的性能和泛化能力。</li>
<li>特征（Feature）：特征是数据中最有信息量的部分，是模型学习规律的基础。高质量的特征能够显著提升模型的预测能力，而无关或噪声特征可能导致性能下降。</li>
<li>泛化能力（Generalization）：机器学习不仅关注模型在训练数据上的表现，更重视其在未知数据上的适应能力。泛化能力强的模型能够在新场景中保持稳定的性能，是衡量机器学习系统有效性的关键指标。</li>
</ol>
<p>简单点说，机器学习的核心思想就是通过数据驱动的方法，让模型自动学习规律，并能够在新的环境中进行准确预测和决策。这一思想贯穿所有机器学习算法和应用，是理解后续各类方法和技术的基础。</p>
<h2 data-id="heading-1">机器学习的类型</h2>
<p>机器学习根据学习方式和数据特征的不同，大致可以分为几类，包括：</p>
<ul>
<li>监督学习（Supervised Learning）：通过带有标签的数据进行学习，核心任务是让模型学会“从输入预测输出”。</li>
<li>无监督学习（Unsupervised Learning）：在没有标签的数据中挖掘潜在规律和结构，常用于模式发现与数据压缩。</li>
<li>半监督学习（Semi-supervised Learning）：结合少量标注数据与大量未标注数据，提高学习效率与模型性能。</li>
<li>强化学习（Reinforcement Learning）：通过与环境交互不断试错，并根据奖励反馈逐步优化策略，用于解决动态决策问题。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/549a671f0f794981a5229fda2ba40b09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=CDvWjtTbsXdwta8ucubYHmcw00k%3D" alt="" loading="lazy"/></p>
<p>这些类型共同构成了机器学习的基本版图：有的强调“从老师那里学习”，有的擅长“无师自通”，有的善于“边学边试”。在实际应用中，它们往往不是孤立存在的，而是可以结合使用，从而应对更加复杂和多样化的任务。</p>
<h3 data-id="heading-2">监督学习</h3>
<p>监督学习是机器学习的基石，其优点在于思路清晰、效果直观，且在分类与回归任务中表现优异。无论是垃圾邮件识别、语音识别，还是金融风控和医疗诊断，都离不开监督学习。理解监督学习，你就打开了机器学习世界的大门。</p>
<p>监督学习（Supervised Learning）是机器学习中最常见、应用最广的一类方法。它的核心思想是利用带有输入与输出标签的数据，训练模型学习两者之间的映射关系，从而在新数据上做出预测。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd02f7f0883d48e3a028b77d9d69b1b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=zznyWc7ARGX2WtUgHb5bqlWYcQQ%3D" alt="" loading="lazy"/></p>
<p>监督学习的本质是“有老师的学习”。在训练过程中，模型接收大量的输入数据（特征）及其对应的正确答案（标签），并尝试学习一个函数，将输入映射到输出。就像学生在老师的指导下，通过参考答案不断纠正自己的错误，模型也通过误差反馈不断调整参数，使预测结果尽可能接近真实标签。</p>
<p>从数学上看，监督学习可以被表述为：给定一个训练集 ，其中表示输入，表示输出，目标是找到一个函数 ，使得在新的输入 下，预测输出 y=f(x) 尽可能接近真实输出 。</p>
<p>监督学习主要分为两大任务：</p>
<ul>
<li>分类（Classification）：输出是离散类别，例如识别图片中的动物种类。</li>
<li>回归（Regression）：输出是连续值，例如预测房价或气温。</li>
</ul>
<p>监督学习通常包括以下几个步骤：</p>
<ol>
<li>数据准备 收集并整理数据，将输入与对应的标签配对。数据质量和数量直接影响模型的效果。</li>
<li>特征工程 提取或选择有价值的特征，去除冗余信息，为模型提供有效的学习基础。</li>
<li>模型选择 根据任务类型选择合适的模型，例如回归任务可用线性回归，分类任务可用逻辑回归、支持向量机或决策树等。</li>
<li>训练模型 将训练数据输入模型，通过优化算法（如梯度下降）不断调整参数，最小化预测值与真实值之间的误差。</li>
<li>模型评估 使用验证集或交叉验证方法，评估模型在未见数据上的表现，常见指标包括准确率、均方误差、F1 分数等。</li>
<li>模型应用 在测试集或真实场景中使用训练好的模型，对新数据进行预测或决策。</li>
</ol>
<h3 data-id="heading-3">无监督学习</h3>
<p>网络中存在着大量的数据，然而这些数据绝大部分是没有标注的，而标注又需要大量的人力，财力，没人愿意当这个冤大头，科学家就想到了一个好办法：这些数据中本来就存在着某些关联，让模型自己学去吧！无监督学习也就应运而生。</p>
<p>无监督学习（Unsupervised Learning）是一种无需人工标注数据的机器学习方法。与监督学习不同，它不依赖输入与标签的对应关系，而是在纯粹的输入数据中自主寻找潜在的模式、规律与结构。</p>
<p>无监督学习的核心思想可以理解为“无老师的学习”。模型并不知道正确答案是什么，它的目标是通过分析数据之间的相似性与差异性，揭示数据背后的隐藏结构。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5898638d0c9c437283b50cda519dc5b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=sqVuxaC0Z0SJZGNkFEO8ABvP%2Bd8%3D" alt="" loading="lazy"/></p>
<p>无监督学习常见的任务包括：</p>
<ul>
<li>聚类（Clustering）：将相似的数据自动归为一类，例如把客户划分成不同群体。</li>
<li>降维（Dimensionality Reduction）：在保留主要信息的前提下，用更少的变量来表示数据，例如将高维图像数据映射到低维空间。</li>
<li>关联规则挖掘（Association Rule Mining）：发现变量之间的潜在关系，例如“购物篮分析”中找出哪些商品经常一起购买。</li>
</ul>
<p>可以说，无监督学习更像是探索未知领域，帮助人们理解数据的内在结构，为后续的预测、决策或特征提取提供支持。</p>
<p>无监督学习的一般流程包括以下几个步骤：</p>
<ol>
<li>数据收集与准备 获取数据并进行基本清洗，确保输入数据质量。由于没有标签，数据的完整性与代表性显得尤为重要。</li>
<li>特征提取与表示 将原始数据转化为模型可理解的特征表示，例如数值向量化或归一化处理。</li>
<li>模型选择 根据任务目标选择合适的方法：若是发现群体结构，可以使用聚类算法；若是降低维度，可以选择主成分分析（PCA）等方法。</li>
<li>模式发现 模型通过分析数据间的相似性、分布规律或统计特性，挖掘出数据中隐藏的模式。</li>
<li>结果解释与应用 对模型输出进行解释和验证，并结合业务需求应用，例如用于市场细分、异常检测或数据可视化。</li>
</ol>
<p>无监督学习的魅力在于发现未知。当缺乏标注数据时，它能够帮助我们理解数据的内在结构，揭示潜在规律，并为其他机器学习方法提供支持。在大数据场景下，无监督学习已经成为探索和利用信息的重要工具，例如用户行为分析、基因数据研究、推荐系统预处理等。</p>
<h3 data-id="heading-4">半监督学习</h3>
<p>在现实世界中，获取大量标注数据往往代价高昂、耗时巨大，而未标注数据却随处可见。半监督学习（Semi-Supervised Learning） 便是在这种背景下诞生的一种折中方案：它试图结合少量带标签的数据与大量无标签的数据，从而提升模型的学习效果。</p>
<p>半监督学习的核心思想是：标签稀缺但数据丰富。相比监督学习完全依赖标注数据，半监督学习希望模型能够借助无标签样本中的潜在结构与分布规律，来辅助模型更好地学习决策边界。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65c4f699474e4a4f9ea055e7de886b64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=aCwBeAxcgVOWNp41IU5wc1Nl8AA%3D" alt="" loading="lazy"/></p>
<p>换句话说，带标签的数据告诉模型“该怎么分”，而无标签的数据则揭示了“数据是怎么分布的”。两者结合，既能降低标注成本，又能提升模型的泛化能力。</p>
<p>半监督学习的典型流程一般包括以下几个步骤：</p>
<ol>
<li>初始训练 使用少量的标注数据训练一个初始模型，建立基本的预测能力。</li>
<li>利用无标签数据 借助无标签数据的分布特性，让模型捕捉数据的潜在结构。常见方式包括聚类假设（相似的样本往往属于同一类别）和流形假设（高维数据往往分布在低维流形上）。</li>
<li>伪标签生成 模型对无标签数据进行预测，并将高置信度的预测结果当作“伪标签”，加入到训练集中，不断扩大标注数据的规模。</li>
<li>迭代优化 将真实标签与伪标签共同用于训练，迭代更新模型，使其在不断学习中获得更强的泛化能力。</li>
</ol>
<p>半监督学习广泛应用于标注成本高昂的领域，例如：</p>
<ul>
<li>医学影像分析：少量专家标注结合大量未标注图像，有助于疾病诊断模型的训练。</li>
<li>自然语言处理：在文本分类或情感分析中，大量语料没有标签，半监督方法能有效利用这些数据。</li>
<li>网络安全：恶意行为样本有限，但大量正常网络流量可以提供辅助信息。</li>
</ul>
<p>半监督学习是一种巧妙的折中方案：它不依赖于昂贵的大规模标注，也不完全放弃监督信号，而是将“少量已知”与“大量未知”相结合，帮助模型在有限的监督下依然能够“学得更好”。在数据爆炸、标注昂贵的当下，半监督学习无疑是推动人工智能走向现实应用的重要方式。</p>
<h3 data-id="heading-5">强化学习</h3>
<p>如果说监督学习像“老师出题、学生作答”，无监督学习像“学生自学、自己总结”，那么强化学习（Reinforcement Learning，RL）更像是“学生在游戏中闯关，通过奖励与惩罚不断升级”。它是一种通过与环境交互来学习决策策略的机器学习方法。</p>
<p>强化学习的核心思想是：行动 → 奖励 → 学习 → 改进。 智能体（agent）通过与环境（environment）交互，在不同状态下采取动作（action），环境会反馈奖励（reward）和新的状态。智能体的目标是通过试错，不断优化策略（policy），以获得长期累积的最大奖励。</p>
<p>可以简单理解为：</p>
<ul>
<li>监督学习学的是“正确答案”；</li>
<li>无监督学习学的是“潜在规律”；</li>
<li>强化学习学的是“如何做选择，才能赢得最多奖励”。</li>
</ul>
<p>一个典型的强化学习流程包括以下几个关键步骤：</p>
<ol>
<li>感知环境状态（State） 智能体观察当前所处的环境，例如机器人看到周围障碍物，游戏玩家知道自己所在位置。</li>
<li>选择动作（Action） 根据当前的策略，智能体决定采取某种动作，例如向前走、向左转或发起攻击。</li>
<li>环境反馈（Reward &amp; Next State） 环境根据动作反馈奖励（正向或负向），同时进入新的状态。例如，机器人避开障碍物获得奖励，撞到障碍物则受到惩罚。</li>
<li>策略更新（Policy Update） 智能体利用反馈信息更新决策策略，让下一次行动更聪明，从而在长期中获得更高的总回报。</li>
</ol>
<p>这一过程循环往复，直到智能体学会在各种情境下如何选择最佳动作。</p>
<p>强化学习的基本要素通常用五元组来描述：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e966718661c4fc889afcb7363bad28f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=3F%2BgULs0DacGLCWuLWO32XZTBdw%3D" alt="" loading="lazy"/></p>
<ul>
<li>Agent（智能体）：学习和决策的主体；</li>
<li>Environment（环境）：智能体所处的外部世界；</li>
<li>State（状态）：环境在某一时刻的信息描述；</li>
<li>Action（动作）：智能体可以采取的行为；</li>
<li>Reward（奖励）：动作执行后环境给予的反馈。</li>
</ul>
<p>强化学习已在多个领域展现出强大潜力：</p>
<ul>
<li>游戏：AlphaGo 打败世界围棋冠军，展示了强化学习在复杂博弈中的威力。</li>
<li>机器人控制：机器人通过试错学会走路、抓取物体，甚至完成精细操作。</li>
<li>推荐系统：根据用户的反馈动态调整推荐内容，优化长期用户体验。</li>
<li>自动驾驶：强化学习帮助汽车在模拟环境中不断优化驾驶策略。</li>
</ul>
<p>强化学习是一种基于“试错—反馈—改进”的学习方法，强调长期回报的最大化。它不像监督学习那样依赖大量标注数据，而是通过与环境的不断交互，逐步形成最优策略。随着计算能力和模拟环境的不断发展，强化学习将在更多复杂、动态的现实场景中发挥重要作用。</p>
<h2 data-id="heading-6">机器学习 vs 深度学习</h2>
<p>在人工智能的发展历程中，机器学习（Machine Learning, ML）和深度学习（Deep Learning, DL）两个常被提及的关键词。它们既紧密相关，又存在显著差异。简单来说，深度学习是机器学习的一种实现方式，但因为表现过于亮眼，经常被单独拿出来与“机器学习”对比。</p>
<h3 data-id="heading-7">定义差异</h3>
<ul>
<li>机器学习：强调让计算机通过数据学习规律，从而进行预测或决策，常见方法有线性回归、支持向量机、决策树等。</li>
<li>深度学习：属于机器学习的一个分支，基于人工神经网络，尤其是多层的深度结构，用于从海量数据中自动提取特征并完成任务。</li>
</ul>
<h3 data-id="heading-8">工作方式差异</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/359518fa907040229989ca047cd4cfd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=dL8cavYEYDvcudO7fNBZocGHuwA%3D" alt="" loading="lazy"/></p>
<ul>
<li>在传统机器学习中，特征工程往往是成败的关键。需要专家根据任务经验提取有价值的特征，例如在图像识别中手工提取边缘、角点等信息。</li>
<li>深度学习则通过多层神经网络自动完成特征提取，减少了人工干预。例如卷积神经网络（CNN）可以自动从图像中学习边缘、纹理、语义等层次特征。</li>
</ul>
<p>这就好比：机器学习需要“人类厨师”精心准备食材，而深度学习可以“自己下厨”，直接从原材料做出美味。</p>
<h3 data-id="heading-9">数据与计算需求差异</h3>
<ul>
<li>机器学习：通常在中小规模数据上就能工作良好，计算资源需求较低。</li>
<li>深度学习：往往需要海量数据和强大的计算能力（GPU/TPU）才能发挥优势，否则容易过拟合或训练效果不佳。</li>
</ul>
<h3 data-id="heading-10">可解释性差异</h3>
<ul>
<li>机器学习模型（如决策树、线性回归）通常较容易解释，可以直观地看出某个特征对结果的影响。</li>
<li>深度学习模型则被称为“黑箱”，尽管研究者提出了可视化和可解释性方法，但整体上仍难以完全解释其内部机制。</li>
</ul>
<h3 data-id="heading-11">应用场景差异</h3>
<ul>
<li>机器学习：适合数据量有限、对可解释性要求高的任务，如金融风控、医疗诊断辅助。</li>
<li>深度学习：在计算机视觉、语音识别、自然语言处理等大规模数据驱动的领域表现卓越。</li>
</ul>
<p>机器学习与深度学习的关系，可以用一句话来形容：深度学习是机器学习的“升级装备”，但并不是所有任务都必须用它。 当数据量有限、计算资源受限时，传统机器学习依旧是高效可靠的选择；而在大数据和高算力的支持下，深度学习则展现出远超传统方法的潜力。</p>
<h2 data-id="heading-12">机器学习的应用场景</h2>
<p>机器学习不仅是实验室里的数学模型，它已经深深嵌入到我们的日常生活和各行各业中。不同的算法和方法让机器能够像人一样思考、预测和决策。你先想一下有哪些应用方向呢？接下来看看是不是和你想的一样吧！</p>
<h3 data-id="heading-13">金融</h3>
<p>金融行业是机器学习最早大规模落地的领域之一。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31fd0fe219334074b181c7ffc2c0c833~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=l73XKMW7yxH6mt3Aqzb7uVmxA3s%3D" alt="" loading="lazy"/></p>
<ul>
<li>信用风险评估：通过客户的消费、还款、交易记录等数据，模型可以预测其违约概率，从而帮助银行和信贷机构做出放贷决策。</li>
<li>欺诈检测：机器学习能够实时监控交易数据，发现异常模式并识别潜在的欺诈行为。</li>
<li>量化交易：利用历史行情和市场特征，模型可以自动寻找交易机会并执行策略。</li>
</ul>
<p>在金融领域，机器学习就像风险雷达，既能规避损失，也能发掘价值。</p>
<h3 data-id="heading-14">医疗</h3>
<p>在医疗健康领域，机器学习正在成为医生的第二双眼睛，我的硕士研究方向就是医学图像处理，但是是使用深度学习，用机器学习估计毕不了业。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9aae59aa1f6243208201ed06fb41add8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=H8anuPnUa19zz9uCv06RFS2wVF0%3D" alt="" loading="lazy"/></p>
<ul>
<li>疾病预测与诊断：通过电子病历、影像和基因数据，模型可以辅助医生更快、更准确地判断病情。</li>
<li>药物研发：通过学习分子结构和临床实验数据，模型能加速药物筛选，缩短研发周期。</li>
<li>个性化医疗：根据患者的遗传信息和生活习惯，提供更有针对性的治疗方案。</li>
</ul>
<p>它的价值不仅在于提高效率，更在于降低误诊率和加速科研进程。</p>
<h3 data-id="heading-15">推荐系统</h3>
<p>推荐系统是机器学习在互联网领域的门面担当，无论是购物，短视频还是看小说，推荐系统都在后台悄悄地工作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f5c394e3525493cbe72f46dd42b8d66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=fNDcLDPZEiQNdLBjyAsc6GQjSpI%3D" alt="" loading="lazy"/></p>
<ul>
<li>电商平台：根据用户的浏览、购买行为，推荐可能感兴趣的商品。</li>
<li>视频网站：结合观看记录和偏好，推荐个性化的影片。</li>
<li>社交媒体：根据互动数据推荐内容或好友，提升用户黏性。</li>
</ul>
<p>换句话说，推荐系统让“信息找人”成为可能，大大提升了用户体验和平台收益。</p>
<h3 data-id="heading-16">自然语言处理（NLP）</h3>
<p>自然语言处理是机器学习最具挑战性和想象力的领域之一。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6013c68d57df44aa932f837828c391a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=qb1zv54rtDsxI6gHlxP9%2BnAYvsY%3D" alt="" loading="lazy"/></p>
<ul>
<li>机器翻译：谷歌翻译、DeepL 等应用背后都是机器学习模型。</li>
<li>情感分析：分析文本中的情绪，用于舆情监控或客户反馈分析。</li>
<li>聊天机器人：利用对话数据进行训练，实现客服、助理等功能。</li>
</ul>
<p>机器学习让语言不再只是人类的专属工具，也成为了人与机器沟通的桥梁。</p>
<h3 data-id="heading-17">计算机视觉（CV）</h3>
<p>计算机视觉可以说是领域最广的一个方向了，因为自然界最不缺的就是文字和图像嘛。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d9e5aa0261f4f408ecb964f080bf326~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=Unwe%2BTVfoa4GKmvIsZ1UN6OvssU%3D" alt="" loading="lazy"/></p>
<ul>
<li>人脸识别：用于安防、支付验证、身份认证。</li>
<li>自动驾驶：识别车道、行人和交通标志，辅助或完全实现无人驾驶。</li>
<li>医学影像分析：识别肿瘤、病灶等细微特征，提升诊断效率。</li>
</ul>
<p>计算机视觉已广泛应用于从手机解锁到工业检测的方方面面。</p>
<p>最新的文章都在公众号aicoting更新，别忘记关注哦！！！</p>
<h2 data-id="heading-18">参考链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fimgtec.eetrend.com%2Fblog%2F2019%2F100042147.html" target="_blank" title="https://imgtec.eetrend.com/blog/2019/100042147.html" ref="nofollow noopener noreferrer">imgtec.eetrend.com/blog/2019/1…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_40641591%2Farticle%2Fdetails%2F143150523" target="_blank" title="https://blog.csdn.net/qq_40641591/article/details/143150523" ref="nofollow noopener noreferrer">blog.csdn.net/qq_40641591…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_43026262%2Farticle%2Fdetails%2F103980616" target="_blank" title="https://blog.csdn.net/weixin_43026262/article/details/103980616" ref="nofollow noopener noreferrer">blog.csdn.net/weixin_4302…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nacos - 服务注册]]></title>    <link>https://juejin.cn/post/7593240931286319156</link>    <guid>https://juejin.cn/post/7593240931286319156</guid>    <pubDate>2026-01-09T15:32:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593240931286319156" data-draft-id="7593338828195561512" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Nacos - 服务注册"/> <meta itemprop="keywords" content="Java,微服务"/> <meta itemprop="datePublished" content="2026-01-09T15:32:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="元Y亨H"/> <meta itemprop="url" content="https://juejin.cn/user/2839351584888617"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Nacos - 服务注册
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2839351584888617/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    元Y亨H
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:32:49.000Z" title="Fri Jan 09 2026 15:32:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nacos 的服务注册是其核心功能之一。随着版本的演进，Nacos 经历了从 1.x（基于 HTTP）到 2.x（基于 gRPC）的架构升级。</p>
<p>下面我将从<strong>客户端发送请求</strong>、<strong>服务端处理请求</strong>、<strong>心跳维持与健康检查</strong>三个维度，详细讲解 Nacos（以 2.x 版本为主，兼顾 1.x 区别）的服务注册流程。</p>
<hr/>
<h3 data-id="heading-0">一、 整体流程概览</h3>
<ol>
<li><strong>服务启动</strong>：客户端（微服务）启动，读取配置。</li>
<li><strong>建立连接</strong>：客户端与 Nacos 服务端建立长连接（gRPC）。</li>
<li><strong>发送注册请求</strong>：客户端封装实例信息（IP、Port、服务名等）发送给服务端。</li>
<li><strong>服务端存储</strong>：服务端将实例信息存入内存注册表。</li>
<li><strong>数据同步</strong>：服务端将新注册的实例信息同步给集群内的其他 Nacos 节点（Distro 协议）。</li>
<li><strong>服务变更通知</strong>：服务端主动推送最新的服务列表给订阅了该服务的客户端。</li>
</ol>
<hr/>
<h3 data-id="heading-1">二、 详细步骤解析</h3>
<h4 data-id="heading-2">1. 客户端：发起注册 (Client Side)</h4>
<ul>
<li><strong>入口</strong>：在 Spring Cloud 环境下，注册入口是 <code>NacosServiceRegistry.register()</code> 方法。</li>
<li><strong>封装实例</strong>：构造 <code>Instance</code> 对象，包含：
<ul>
<li><code>Service Name</code>（服务名）</li>
<li><code>IP</code> 和 <code>Port</code></li>
<li><code>Weight</code>（权重）</li>
<li><code>Metadata</code>（元数据）</li>
<li><code>Ephemeral</code>（是否是临时实例，默认 <strong>true</strong>）</li>
</ul>
</li>
<li><strong>通信协议</strong>：
<ul>
<li><strong>Nacos 1.x</strong>：通过 <strong>HTTP</strong> POST 请求发送到 <code>/nacos/v1/ns/instance</code>。</li>
<li><strong>Nacos 2.x</strong>：通过 <strong>gRPC</strong> 传输。客户端通过 <code>NamingClientProxy</code> 调用 <code>registerService</code>，请求会被封装成 <code>InstanceRequest</code> 发送。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">2. 服务端：接收与存储 (Server Side)</h4>
<p>当 Nacos 服务端收到注册请求后，会执行以下逻辑：</p>
<ul>
<li><strong>解析请求</strong>：<code>InstanceRequestHandler</code> 接收 gRPC 请求（1.x 是 <code>InstanceController</code>）。</li>
<li><strong>内存注册表维护</strong>：
<ul>
<li>Nacos 内部维护了一个多层的 Map 结构：
<code>Map&lt;namespace, Map&lt;group::serviceName, Service&gt;&gt;</code></li>
<li><code>Service</code> 类中包含多个 <code>Cluster</code>（集群）。</li>
<li><code>Cluster</code> 中维护了两个 <code>Set&lt;Instance&gt;</code>：一个是 <strong>临时实例</strong>，一个是 <strong>持久化实例</strong>。</li>
</ul>
</li>
<li><strong>写时复制 (CopyOnWrite)</strong>：为了防止高并发下的读写冲突，Nacos 在更新实例列表时采用了类似 <strong>CopyOnWrite</strong> 的机制。它会先读取旧的列表，创建一个新列表，把新实例放进去，最后替换旧列表。</li>
</ul>
<h4 data-id="heading-4">3. 服务端：一致性协议 (Consistency)</h4>
<p>Nacos 根据实例类型（临时/持久化）走不同的协议：</p>
<ul>
<li><strong>临时实例（默认，AP模式）</strong>：
<ul>
<li>使用 <strong>Distro 协议</strong>（Nacos 自研）。</li>
<li>注册节点会立即同步给集群内其他节点。</li>
<li>遵循 <strong>最终一致性</strong>，保证高可用。</li>
</ul>
</li>
<li><strong>持久化实例（CP模式）</strong>：
<ul>
<li>使用 <strong>Raft 协议</strong>（JRaft 实现）。</li>
<li>必须过半数节点写入成功才算注册成功。</li>
<li>保证 <strong>强一致性</strong>。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">4. 服务端：推送通知 (Push)</h4>
<ul>
<li>一旦注册表发生变化，服务端会触发 <code>ServiceChangeEvent</code>。</li>
<li><strong>推送机制</strong>：服务端通过 <strong>PushService</strong> 找到所有订阅了该服务的客户端，通过 gRPC（2.x）或 UDP（1.x）将最新的实例列表推送过去。</li>
<li><strong>客户端缓存</strong>：客户端收到更新后，会更新本地的 <code>ServiceInfo</code> 缓存，从而实现负载均衡时拿到最新的地址。</li>
</ul>
<hr/>
<h3 data-id="heading-6">三、 核心：健康检查机制</h3>
<p>注册流程完成后，如何保证服务一直“在线”？</p>
<ol>
<li>
<p><strong>Nacos 1.x (HTTP + 心跳)</strong>：</p>
<ul>
<li>客户端每隔 <strong>5秒</strong> 发送一次心跳（Beat）。</li>
<li>服务端若 <strong>15秒</strong> 没收到心跳，标记为不健康。</li>
<li>若 <strong>30秒</strong> 没收到心跳，直接剔除实例。</li>
</ul>
</li>
<li>
<p><strong>Nacos 2.x (gRPC + 连接探测)</strong>：</p>
<ul>
<li><strong>长连接</strong>：基于 gRPC 的 <code>Stream</code>。如果客户端宕机，gRPC 连接会断开。</li>
<li><strong>连接断开即剔除</strong>：服务端监控连接状态，一旦连接异常断开（Connection Disconnect），服务端会立即触发下线流程（针对临时实例）。这种方式比心跳更实时。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-7">四、 总结：1.x 与 2.x 的关键区别</h3>






























<table><thead><tr><th align="left">特性</th><th align="left">Nacos 1.x</th><th align="left">Nacos 2.x</th></tr></thead><tbody><tr><td align="left"><strong>通信协议</strong></td><td align="left">HTTP</td><td align="left">gRPC (双向流)</td></tr><tr><td align="left"><strong>注册效率</strong></td><td align="left">每次注册/心跳都是短连接，开销大</td><td align="left">长连接复用，极大减少连接握手消耗</td></tr><tr><td align="left"><strong>实时性</strong></td><td align="left">依赖心跳间隔，响应稍慢</td><td align="left">连接断开瞬时感应，响应极快</td></tr><tr><td align="left"><strong>一致性协议</strong></td><td align="left">Distro (AP) / Raft (CP)</td><td align="left">优化后的 Distro / JRaft</td></tr></tbody></table>
<p><strong>总结口述版</strong>：</p>
<blockquote>
<p>"Nacos 注册流程首先是客户端通过 gRPC（2.x）向服务端发起注册请求。服务端接收后，会将实例信息存入内存中的双层 Map 结构中，并根据实例是否是临时的，选择走 Distro 异步同步（AP）或 Raft 强一致同步（CP）。存储完成后，服务端会发布变更事件，通过长连接异步推送给所有订阅该服务的客户端。最后，通过 gRPC 的长连接状态来维持实例的健康状态，一旦断开则自动剔除。"</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂机器学习线性代数基础知识！]]></title>    <link>https://juejin.cn/post/7593175890794905646</link>    <guid>https://juejin.cn/post/7593175890794905646</guid>    <pubDate>2026-01-09T15:36:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593175890794905646" data-draft-id="7593077945016811547" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂机器学习线性代数基础知识！"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-09T15:36:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂机器学习线性代数基础知识！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:36:32.000Z" title="Fri Jan 09 2026 15:36:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>推荐直接网站在线阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Faicoting.cn%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//aicoting.cn/" ref="nofollow noopener noreferrer">aicoting AI算法面试学习在线网站</a></p>
</blockquote>
<h2 data-id="heading-0">向量与矩阵</h2>
<h3 data-id="heading-1">向量（Vector）</h3>
<p>向量可以看作是有序数值的集合，用于表示样本特征。</p>
<p>例如，一个房屋数据可以表示为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>面积</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>房间数</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>楼层</mtext></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>120</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>5</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{x} = \begin{bmatrix} \text{面积} \\ \text{房间数} \\ \text{楼层} \end{bmatrix} = \begin{bmatrix} 120 \\ 3 \\ 5 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord cjk_fallback">面积</span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord cjk_fallback">房间数</span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord cjk_fallback">楼层</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">120</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p>在机器学习中，样本就是向量，特征数决定了向量的维度。</p>
<h3 data-id="heading-2">矩阵（Matrix）</h3>
<p>多个样本堆叠成矩阵，例如一个包含 m 个样本、每个样本 n 个特征的数据集可以表示为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mrow><mn>1</mn><mi>n</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"/></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"/></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋱</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"/></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mrow><mi>m</mi><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mrow><mi>m</mi><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mrow><mi>m</mi><mi>n</mi></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">X = \begin{bmatrix} x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1n} \\ x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2n} \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ x_{m1} &amp; x_{m2} &amp; \cdots &amp; x_{mn} \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:5.46em;vertical-align:-2.48em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-4.95em;"><span class="pstrut" style="height:7.4em;"/><span style="width:0.667em;height:5.400em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="5.400em" viewbox="0 0 667 5400"><path d="M403 1759 V84 H666 V0 H319 V1759 v1800 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v1800 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.8275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-4.6275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-2.7675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"/></span></span></span><span style="top:-1.5675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.8275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-4.6275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-2.7675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"/></span></span></span><span style="top:-1.5675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.64em;"><span class="pstrut" style="height:3.5em;"/><span class="mord"><span class="minner">⋯</span></span></span><span style="top:-4.44em;"><span class="pstrut" style="height:3.5em;"/><span class="mord"><span class="minner">⋯</span></span></span><span style="top:-2.58em;"><span class="pstrut" style="height:3.5em;"/><span class="mord"><span class="minner">⋱</span></span></span><span style="top:-1.38em;"><span class="pstrut" style="height:3.5em;"/><span class="mord"><span class="minner">⋯</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.8275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-4.6275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-2.7675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"/></span></span></span><span style="top:-1.5675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">mn</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-4.95em;"><span class="pstrut" style="height:7.4em;"/><span style="width:0.667em;height:5.400em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="5.400em" viewbox="0 0 667 5400"><path d="M347 1759 V0 H0 V84 H263 V1759 v1800 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v1800 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p>其中，每一行是一个样本，每一列是一个特征。</p>
<hr/>
<h2 data-id="heading-3">向量运算与几何意义</h2>
<h3 data-id="heading-4">内积（Dot Product）</h3>
<p>两个向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">a</mi><mo separator="true">,</mo><mi mathvariant="bold">b</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\mathbf{a}, \mathbf{b} \in \mathbb{R}^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathbf">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathbf">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6889em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span> 的内积定义为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">a</mi><mo>⋅</mo><mi mathvariant="bold">b</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>a</mi><mi>i</mi></msub><msub><mi>b</mi><mi>i</mi></msub><mo>=</mo><msup><mi mathvariant="bold">a</mi><mi>T</mi></msup><mi mathvariant="bold">b</mi></mrow><annotation encoding="application/x-tex">\mathbf{a} \cdot \mathbf{b} = \sum_{i=1}^n a_i b_i = \mathbf{a}^T \mathbf{b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"/><span class="mord mathbf">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathbf">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8413em;"/><span class="mord"><span class="mord mathbf">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathbf">b</span></span></span></span></span></p>
<p>几何意义上，内积表示两个向量的相似度：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">a</mi><mo>⋅</mo><mi mathvariant="bold">b</mi><mo>=</mo><mi mathvariant="normal">∥</mi><mi mathvariant="bold">a</mi><mi mathvariant="normal">∥</mi><mi mathvariant="normal">∥</mi><mi mathvariant="bold">b</mi><mi mathvariant="normal">∥</mi><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\mathbf{a} \cdot \mathbf{b} = \|\mathbf{a}\|\|\mathbf{b}\|\cos\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"/><span class="mord mathbf">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathbf">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∥</span><span class="mord mathbf">a</span><span class="mord">∥∥</span><span class="mord mathbf">b</span><span class="mord">∥</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">cos</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span></p>
<p>这在推荐系统（如计算用户与物品的相似度）和分类（如支持向量机的超平面）中至关重要。</p>
<h3 data-id="heading-5">范数（Norm）</h3>
<p>向量的长度由范数衡量。常见的有：</p>
<ul>
<li><strong>L2 范数</strong>： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi><msub><mi mathvariant="normal">∥</mi><mn>2</mn></msub><mo>=</mo><msqrt><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\mathbf{x}\|_2 = \sqrt{\sum_{i=1}^n x_i^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathbf">x</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.3027em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9373em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"/><span class="mord" style="padding-left:1em;"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span/></span></span></span></span></span></span></span><span style="top:-2.8973em;"><span class="pstrut" style="height:3.2em;"/><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119&#10;c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120&#10;c340,-704.7,510.7,-1060.3,512,-1067&#10;l0 -0&#10;c4.7,-7.3,11,-11,19,-11&#10;H40000v40H1012.3&#10;s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232&#10;c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1&#10;s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26&#10;c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z&#10;M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3027em;"><span/></span></span></span></span></span></span></span></span></li>
<li><strong>L1 范数</strong>： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi><msub><mi mathvariant="normal">∥</mi><mn>1</mn></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}\|_1 = \sum_{i=1}^n |x_i|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathbf">x</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">∣</span></span></span></span></span></li>
</ul>
<p>在正则化中，L1 范数鼓励稀疏解（特征选择），L2 范数则抑制过大权重（防止过拟合）。</p>
<hr/>
<h2 data-id="heading-6">矩阵运算与模型计算</h2>
<h3 data-id="heading-7">矩阵乘法</h3>
<p>如果输入样本为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\mathbf{x} \in \mathbb{R}^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"/><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6889em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span>，权重矩阵W为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^{m \times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span> ，则输出为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">y</mi><mo>=</mo><mi>W</mi><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{y} = W \mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.1944em;"/><span class="mord mathbf" style="margin-right:0.01597em;">y</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathbf">x</span></span></span></span></span></p>
<p>这就是神经网络中 <strong>一层全连接层</strong> 的计算方式。</p>
<h3 data-id="heading-8">转置与对称矩阵</h3>
<ul>
<li>矩阵转置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">A^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span> 在内积与相似度计算中常见。</li>
<li>对称矩阵（如协方差矩阵）在 PCA、特征值分解中起核心作用。</li>
</ul>
<p>在机器学习中，数据通常是高维的，直接处理既费计算又不易理解。<strong>特征值分解（Eigen Decomposition）和</strong> <strong>奇异值分解</strong> <strong>（</strong> <strong>SVD</strong> <strong>）</strong> 提供了强大的工具，让我们能够发现数据的“核心方向”，实现降维、特征提取和压缩。</p>
<h2 data-id="heading-9">特征值分解与奇异值分解（SVD）</h2>
<h3 data-id="heading-10">特征值分解</h3>
<p>给定一个方阵 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^{n \times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span>，如果存在标量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">λ</span></span></span></span></span> 和非零向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">v</mi></mrow><annotation encoding="application/x-tex">\mathbf{v}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span></span></span></span>，使得：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">v</mi><mo>=</mo><mi>λ</mi><mi mathvariant="bold">v</mi></mrow><annotation encoding="application/x-tex">\mathbf{v} = \lambda \mathbf{v}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">λ</span><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span></span></span></span>，则称 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">λ</span></span></span></span></span> 为 <strong>特征值</strong>， <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">v</mi></mrow><annotation encoding="application/x-tex">\mathbf{v}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span></span></span></span>为 <strong>特征向量</strong>。</p>
<p>考虑一个简单的 2x2 矩阵：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">A = \begin{bmatrix} 2 &amp; 1 \\ 1 &amp; 2 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p>
<p>求解特征值和特征向量：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>det</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>A</mi><mo>−</mo><mi>λ</mi><mi>I</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn><mspace width="1em"/><mo>⇒</mo><mspace width="1em"/><mrow><mo fence="true">∣</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>2</mn><mo>−</mo><mi>λ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>2</mn><mo>−</mo><mi>λ</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">∣</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\det(A - \lambda I) = 0 \quad \Rightarrow \quad \begin{vmatrix} 2-\lambda &amp; 1 \\ 1 &amp; 2-\lambda \end{vmatrix} = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">det</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">⇒</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:4.4em;"/><span style="width:0.333em;height:2.400em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.333em" height="2.400em" viewbox="0 0 333 2400"><path d="M145 15 v585 v1200 v585 c2.667,10,9.667,15,21,15&#10;c10,0,16.667,-5,20,-15 v-585 v-1200 v-585 c-2.667,-10,-9.667,-15,-21,-15&#10;c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v1200 v585 h43z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">λ</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">λ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:4.4em;"/><span style="width:0.333em;height:2.400em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.333em" height="2.400em" viewbox="0 0 333 2400"><path d="M145 15 v585 v1200 v585 c2.667,10,9.667,15,21,15&#10;c10,0,16.667,-5,20,-15 v-585 v-1200 v-585 c-2.667,-10,-9.667,-15,-21,-15&#10;c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v1200 v585 h43z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></p>
<p>得到特征值 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mn>1</mn></msub><mo>=</mo><mn>3</mn><mo separator="true">,</mo><msub><mi>λ</mi><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\lambda_1 = 3, \lambda_2 = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>，对应特征向量分别为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">v</mi><mn>1</mn></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo separator="true">,</mo><mspace width="1em"/><msub><mi mathvariant="bold">v</mi><mn>2</mn></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{v}_1 = \begin{bmatrix} 1 \\ 1 \end{bmatrix}, \quad \mathbf{v}_2 = \begin{bmatrix} 1 \\ -1 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5944em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.016em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.016em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p>
<p>矩阵 A 作用在 v1 上，方向不变，只拉伸了 3 倍；作用在 v2 上，方向不变，只拉伸了 1 倍。</p>
<p>特征值分解的应用场景包括：</p>
<ul>
<li><strong>PCA</strong> <strong>降维</strong>：在 PCA（主成分分析）中，我们对数据的协方差矩阵 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mi>m</mi></mfrac><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">\frac{1}{m} X^T X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></span> 进行特征值分解，得到最大方差方向上的主成分。</li>
<li><strong>谱聚类</strong>：用 Laplacian 矩阵特征向量划分数据</li>
<li><strong>稳态分析</strong>：马尔可夫链转移矩阵的特征值分析收敛性</li>
</ul>
<h3 data-id="heading-11">奇异值分解（SVD）</h3>
<p>对于任意矩阵 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">X \in \mathbb{R}^{m \times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span>，可以分解为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mi>U</mi><mi mathvariant="normal">Σ</mi><msup><mi>V</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">X = U \Sigma V^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8413em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord">Σ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中：</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>m</mi><mo>×</mo><mi>m</mi></mrow></msup></mrow><annotation encoding="application/x-tex">U \in \mathbb{R}^{m \times m}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span></span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">V \in \mathbb{R}^{n \times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span> 是正交矩阵</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Σ</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\Sigma \in \mathbb{R}^{m \times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"/><span class="mord">Σ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span>是对角矩阵，包含奇异值 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mn>1</mn></msub><mo>≥</mo><msub><mi>σ</mi><mn>2</mn></msub><mo>≥</mo><mo>⋯</mo><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\sigma_1 \ge \sigma_2 \ge \dots \ge 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.786em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.786em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"/><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></li>
</ul>
<p><strong>奇异值</strong>表示矩阵在各个方向上的“能量大小”。<strong>SVD</strong> <strong>可用于非</strong> <strong>方阵</strong>，比特征值分解更通用。</p>
<p>SVD 在降维、信息检索（LSA）、推荐系统（矩阵分解）中应用广泛。</p>
<p>考虑矩阵<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">X = \begin{bmatrix} 3 &amp; 1 \\ 1 &amp; 3 \\ \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p>
<p>SVD 分解结果近似为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo separator="true">,</mo><mspace width="1em"/><mi mathvariant="normal">Σ</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo separator="true">,</mo><mspace width="1em"/><msup><mi>V</mi><mi>T</mi></msup><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">U = \begin{bmatrix} \frac{1}{\sqrt{2}} &amp; -\frac{1}{\sqrt{2}} \\ \frac{1}{\sqrt{2}} &amp; \frac{1}{\sqrt{2}} \end{bmatrix}, \quad \Sigma = \begin{bmatrix} 4 &amp; 0 \\ 0 &amp; 2 \end{bmatrix}, \quad V^T = \begin{bmatrix} \frac{1}{\sqrt{2}} &amp; \frac{1}{\sqrt{2}} \\ -\frac{1}{\sqrt{2}} &amp; \frac{1}{\sqrt{2}} \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6331em;"><span style="top:-3.788em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-2.4049em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1331em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6331em;"><span style="top:-3.788em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-2.4049em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1331em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">]</span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">Σ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">4</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6331em;"><span style="top:-3.788em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-2.4049em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1331em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6331em;"><span style="top:-3.788em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-2.4049em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1331em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">]</span></span></span></span></span></span></span></p>
<p>矩阵 X 可以看作先旋转（ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>V</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">V^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>），再拉伸（ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Σ</mi></mrow><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">Σ</span></span></span></span></span>），再旋转（U），得到原矩阵。保留最大奇异值对应的方向，就能得到数据最重要的信息。</p>
<p>奇异值分解的应用场景包括：</p>
<ul>
<li><strong>推荐系统</strong>：矩阵分解找到用户和物品的潜在因子</li>
<li><strong>图像压缩</strong>：保留主奇异值重建近似图像</li>
<li><strong>潜在语义分析（LSA）</strong> ：从文档-词矩阵提取潜在语义结构</li>
</ul>
<hr/>
<h2 data-id="heading-12">线性代数与机器学习模型</h2>
<h3 data-id="heading-13">线性回归</h3>
<p>预测公式可以写作：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi mathvariant="bold">y</mi><mo>^</mo></mover><mo>=</mo><mi>X</mi><mi mathvariant="bold">w</mi></mrow><annotation encoding="application/x-tex">\hat{\mathbf{y}} = X \mathbf{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9023em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7079em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span><span style="top:-3.0134em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span></span></span></span></p>
<p>其中， <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">w</mi></mrow><annotation encoding="application/x-tex">\mathbf{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span></span></span></span> 是回归系数。利用最小二乘法，参数解为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">w</mi><mo>=</mo><mo stretchy="false">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>X</mi><mi>T</mi></msup><mi mathvariant="bold">y</mi></mrow><annotation encoding="application/x-tex">\mathbf{w} = (X^T X)^{-1} X^T \mathbf{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span></span></span></span></p>
<p>这是线性代数在回归分析中的直接应用。</p>
<h3 data-id="heading-14">支持向量机（SVM）</h3>
<p>SVM 本质上是寻找一个超平面 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="bold">w</mi><mi>T</mi></msup><mi mathvariant="bold">x</mi><mo>+</mo><mi>b</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\mathbf{w}^T \mathbf{x} + b = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9247em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>，最大化数据点与超平面的几何间隔。这是典型的线性代数与凸优化结合的例子。</p>
<h3 data-id="heading-15">神经网络</h3>
<p>神经网络中，每一层的计算都是矩阵运算：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="bold">h</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msup><mi>W</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><msup><mi mathvariant="bold">h</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><msup><mi mathvariant="bold">b</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbf{h}^{(l)} = f(W^{(l)} \mathbf{h}^{(l-1)} + \mathbf{b}^{(l)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"/><span class="mord"><span class="mord mathbf">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathbf">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mo>⋅</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(\cdot)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">⋅</span><span class="mclose">)</span></span></span></span></span>是激活函数。可见整个网络就是一连串的线性变换+非线性映射。</p>
<p>最新的文章都在公众号aicoting更新，别忘记关注哦！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RAG索引流程详解：如何高效解析文档构建知识库]]></title>    <link>https://juejin.cn/post/7593164154632192009</link>    <guid>https://juejin.cn/post/7593164154632192009</guid>    <pubDate>2026-01-09T15:44:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593164154632192009" data-draft-id="7593171168259686409" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RAG索引流程详解：如何高效解析文档构建知识库"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-09T15:44:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北辰alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RAG索引流程详解：如何高效解析文档构建知识库
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北辰alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:44:56.000Z" title="Fri Jan 09 2026 15:44:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d589615192674c6681d1913cb9aff349~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768578296&amp;x-signature=EhyDj2mRevmvYLFaGeHIx7R%2FQE4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">引言：为什么文档解析是RAG的基石？</h2>
<p>在RAG（检索增强生成）系统中，文档解析是整个知识库构建的第一步，也是最关键的一步。就像建房子需要打好地基一样，良好的文档解析质量直接决定了后续检索和生成的效果。今天，我们就深入探讨RAG索引流程中的文档解析技术。</p>
<h2 data-id="heading-1">一、RAG文档解析的整体架构</h2>
<p>首先，让我们通过一个流程图了解完整的解析流程：</p>
<pre><code class="hljs">┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│                 │    │                 │    │                 │
│  原始文档集合   │───▶│  文档解析与拆分 │───▶│  文本向量化     │
│                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └────────┬────────┘
                                                        │
┌─────────────────┐    ┌─────────────────┐             │
│                 │    │                 │             ▼
│  元数据提取    │◀───│  语义分块       │    ┌─────────────────┐
│                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    │  向量存储索引  │
                                                        │                 │
                               └─────────────────┘
</code></pre>
<h2 data-id="heading-2">二、文档解析的核心步骤详解</h2>
<h3 data-id="heading-3">2.1 支持多种文档格式</h3>
<p>实际项目中，文档格式多种多样。我们需要一个能处理各种格式的解析器：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>
<span class="hljs-keyword">from</span> langchain.document_loaders <span class="hljs-keyword">import</span> (
    PyPDFLoader,
    Docx2txtLoader,
    UnstructuredHTMLLoader,
    UnstructuredMarkdownLoader,
    TextLoader
)
<span class="hljs-keyword">from</span> langchain.schema <span class="hljs-keyword">import</span> Document

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiFormatDocumentParser</span>:
    <span class="hljs-string">"""多格式文档解析器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.format_handlers = {
            <span class="hljs-string">'.pdf'</span>: self._parse_pdf,
            <span class="hljs-string">'.docx'</span>: self._parse_docx,
            <span class="hljs-string">'.html'</span>: self._parse_html,
            <span class="hljs-string">'.htm'</span>: self._parse_html,
            <span class="hljs-string">'.md'</span>: self._parse_markdown,
            <span class="hljs-string">'.txt'</span>: self._parse_text,
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_document</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析单个文档"""</span>
        ext = os.path.splitext(file_path)[<span class="hljs-number">1</span>].lower()
        
        <span class="hljs-keyword">if</span> ext <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.format_handlers:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"不支持的文件格式: <span class="hljs-subst">{ext}</span>"</span>)
        
        <span class="hljs-keyword">return</span> self.format_handlers[ext](file_path)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_pdf</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析PDF文档"""</span>
        loader = PyPDFLoader(file_path)
        documents = loader.load()
        
        <span class="hljs-comment"># 提取PDF元数据</span>
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            doc.metadata.update({
                <span class="hljs-string">'source'</span>: file_path,
                <span class="hljs-string">'format'</span>: <span class="hljs-string">'pdf'</span>,
                <span class="hljs-string">'total_pages'</span>: <span class="hljs-built_in">len</span>(documents)
            })
        
        <span class="hljs-keyword">return</span> documents
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_docx</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析Word文档"""</span>
        loader = Docx2txtLoader(file_path)
        documents = loader.load()
        
        <span class="hljs-comment"># 添加文档结构信息</span>
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            doc.metadata.update({
                <span class="hljs-string">'source'</span>: file_path,
                <span class="hljs-string">'format'</span>: <span class="hljs-string">'docx'</span>
            })
        
        <span class="hljs-keyword">return</span> documents
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_html</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析HTML文档"""</span>
        loader = UnstructuredHTMLLoader(file_path)
        <span class="hljs-keyword">return</span> loader.load()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_markdown</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析Markdown文档"""</span>
        loader = UnstructuredMarkdownLoader(file_path)
        <span class="hljs-keyword">return</span> loader.load()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_text</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析纯文本文档"""</span>
        loader = TextLoader(file_path, encoding=<span class="hljs-string">'utf-8'</span>)
        <span class="hljs-keyword">return</span> loader.load()

<span class="hljs-comment"># 使用示例</span>
parser = MultiFormatDocumentParser()
documents = parser.parse_document(<span class="hljs-string">"example.pdf"</span>)
</code></pre>
<h3 data-id="heading-4">2.2 智能文档分块策略</h3>
<p>文档分块是解析的核心环节，直接影响检索质量：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.text_splitter <span class="hljs-keyword">import</span> (
    RecursiveCharacterTextSplitter,
    TokenTextSplitter,
    MarkdownHeaderTextSplitter
)
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartChunker</span>:
    <span class="hljs-string">"""智能文档分块器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, chunk_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">1000</span>, chunk_overlap: <span class="hljs-built_in">int</span> = <span class="hljs-number">200</span></span>):
        self.chunk_size = chunk_size
        self.chunk_overlap = chunk_overlap
        
        <span class="hljs-comment"># 初始化不同的分块器</span>
        self.recursive_splitter = RecursiveCharacterTextSplitter(
            chunk_size=chunk_size,
            chunk_overlap=chunk_overlap,
            separators=[<span class="hljs-string">"\n\n"</span>, <span class="hljs-string">"\n"</span>, <span class="hljs-string">"。"</span>, <span class="hljs-string">"！"</span>, <span class="hljs-string">"？"</span>, <span class="hljs-string">"；"</span>, <span class="hljs-string">"，"</span>, <span class="hljs-string">" "</span>, <span class="hljs-string">""</span>]
        )
        
        self.token_splitter = TokenTextSplitter(
            chunk_size=chunk_size,
            chunk_overlap=chunk_overlap
        )
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">semantic_chunking</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span>, doc_type: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""语义感知的分块"""</span>
        
        <span class="hljs-comment"># 根据文档类型选择分块策略</span>
        <span class="hljs-keyword">if</span> doc_type == <span class="hljs-string">'markdown'</span>:
            <span class="hljs-keyword">return</span> self._markdown_chunking(text)
        <span class="hljs-keyword">elif</span> self._is_code_document(text):
            <span class="hljs-keyword">return</span> self._code_chunking(text)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> self._semantic_paragraph_chunking(text)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_markdown_chunking</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""Markdown文档分块"""</span>
        headers_to_split_on = [
            (<span class="hljs-string">"#"</span>, <span class="hljs-string">"标题1"</span>),
            (<span class="hljs-string">"##"</span>, <span class="hljs-string">"标题2"</span>),
            (<span class="hljs-string">"###"</span>, <span class="hljs-string">"标题3"</span>),
        ]
        
        markdown_splitter = MarkdownHeaderTextSplitter(
            headers_to_split_on=headers_to_split_on
        )
        
        chunks = markdown_splitter.split_text(text)
        <span class="hljs-keyword">return</span> [chunk.page_content <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chunks]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_code_chunking</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""代码文档分块"""</span>
        <span class="hljs-comment"># 按函数、类、方法进行分块</span>
        patterns = [
            <span class="hljs-string">r'(def\s+\w+(.*?):.*?(?=\n\s*def|\Z))'</span>,  <span class="hljs-comment"># 函数</span>
            <span class="hljs-string">r'(class\s+\w+(.*?):.*?(?=\n\s*class|\Z))'</span>,  <span class="hljs-comment"># 类</span>
            <span class="hljs-string">r'(//\s*===.*?===)'</span>,  <span class="hljs-comment"># 注释区块</span>
        ]
        
        chunks = []
        <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> patterns:
            chunks.extend(re.findall(pattern, text, re.DOTALL))
        
        <span class="hljs-keyword">return</span> chunks <span class="hljs-keyword">if</span> chunks <span class="hljs-keyword">else</span> self.recursive_splitter.split_text(text)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_semantic_paragraph_chunking</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""语义段落分块"""</span>
        <span class="hljs-comment"># 先按段落分割</span>
        paragraphs = re.split(<span class="hljs-string">r'\n\s*\n'</span>, text)
        
        chunks = []
        current_chunk = <span class="hljs-string">""</span>
        
        <span class="hljs-keyword">for</span> para <span class="hljs-keyword">in</span> paragraphs:
            para = para.strip()
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> para:
                <span class="hljs-keyword">continue</span>
                
            <span class="hljs-comment"># 如果当前块加上新段落不超过限制，就合并</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_chunk) + <span class="hljs-built_in">len</span>(para) + <span class="hljs-number">1</span> &lt;= self.chunk_size:
                <span class="hljs-keyword">if</span> current_chunk:
                    current_chunk += <span class="hljs-string">"\n\n"</span> + para
                <span class="hljs-keyword">else</span>:
                    current_chunk = para
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># 保存当前块，开始新块</span>
                <span class="hljs-keyword">if</span> current_chunk:
                    chunks.append(current_chunk)
                current_chunk = para
        
        <span class="hljs-comment"># 添加最后一个块</span>
        <span class="hljs-keyword">if</span> current_chunk:
            chunks.append(current_chunk)
        
        <span class="hljs-keyword">return</span> chunks
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_is_code_document</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""判断是否为代码文档"""</span>
        code_keywords = [<span class="hljs-string">'def '</span>, <span class="hljs-string">'class '</span>, <span class="hljs-string">'import '</span>, <span class="hljs-string">'function '</span>, <span class="hljs-string">'var '</span>, <span class="hljs-string">'let '</span>, <span class="hljs-string">'const '</span>]
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">any</span>(keyword <span class="hljs-keyword">in</span> text[:<span class="hljs-number">500</span>] <span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> code_keywords)

<span class="hljs-comment"># 使用示例</span>
chunker = SmartChunker(chunk_size=<span class="hljs-number">1000</span>, chunk_overlap=<span class="hljs-number">200</span>)
chunks = chunker.semantic_chunking(large_text_document, doc_type=<span class="hljs-string">'markdown'</span>)
</code></pre>
<h3 data-id="heading-5">2.3 高级元数据提取</h3>
<p>元数据能显著提升检索精度：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">import</span> pytz
<span class="hljs-keyword">from</span> langchain.schema <span class="hljs-keyword">import</span> Document

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MetadataExtractor</span>:
    <span class="hljs-string">"""元数据提取器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.zh_timezone = pytz.timezone(<span class="hljs-string">'Asia/Shanghai'</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_document_metadata</span>(<span class="hljs-params">self, 
                                 content: <span class="hljs-built_in">str</span>, 
                                 file_path: <span class="hljs-built_in">str</span>, 
                                 doc_type: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""提取文档元数据"""</span>
        
        metadata = {
            <span class="hljs-string">'source'</span>: file_path,
            <span class="hljs-string">'doc_type'</span>: doc_type,
            <span class="hljs-string">'file_name'</span>: os.path.basename(file_path),
            <span class="hljs-string">'file_size'</span>: os.path.getsize(file_path),
            <span class="hljs-string">'last_modified'</span>: self._get_file_mtime(file_path),
            <span class="hljs-string">'content_hash'</span>: self._calculate_content_hash(content),
            <span class="hljs-string">'chunk_count'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'total_length'</span>: <span class="hljs-built_in">len</span>(content),
            <span class="hljs-string">'indexing_time'</span>: datetime.now(self.zh_timezone).isoformat(),
        }
        
        <span class="hljs-comment"># 提取内容相关元数据</span>
        content_metadata = self._extract_content_metadata(content)
        metadata.update(content_metadata)
        
        <span class="hljs-keyword">return</span> metadata
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_extract_content_metadata</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""从内容中提取元数据"""</span>
        
        <span class="hljs-comment"># 提取标题</span>
        title = self._extract_title(content)
        
        <span class="hljs-comment"># 提取关键词（简单实现）</span>
        keywords = self._extract_keywords(content)
        
        <span class="hljs-comment"># 提取文档结构信息</span>
        structure_info = self._analyze_structure(content)
        
        <span class="hljs-comment"># 提取时间信息</span>
        time_info = self._extract_time_info(content)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'title'</span>: title,
            <span class="hljs-string">'keywords'</span>: keywords,
            <span class="hljs-string">'sections'</span>: structure_info.get(<span class="hljs-string">'sections'</span>, []),
            <span class="hljs-string">'paragraph_count'</span>: structure_info.get(<span class="hljs-string">'paragraph_count'</span>, <span class="hljs-number">0</span>),
            <span class="hljs-string">'mentioned_dates'</span>: time_info,
            <span class="hljs-string">'language'</span>: self._detect_language(content),
            <span class="hljs-string">'has_tables'</span>: self._has_tables(content),
            <span class="hljs-string">'has_code_blocks'</span>: self._has_code_blocks(content),
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_extract_title</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""提取文档标题"""</span>
        <span class="hljs-comment"># 尝试从开头或Markdown标题中提取</span>
        lines = content.strip().split(<span class="hljs-string">'\n'</span>)
        
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines[:<span class="hljs-number">10</span>]:  <span class="hljs-comment"># 检查前10行</span>
            line = line.strip()
            <span class="hljs-comment"># Markdown标题</span>
            <span class="hljs-keyword">if</span> line.startswith(<span class="hljs-string">'# '</span>):
                <span class="hljs-keyword">return</span> line[<span class="hljs-number">2</span>:].strip()
            <span class="hljs-comment"># HTML标题标签</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">'&lt;h1&gt;'</span> <span class="hljs-keyword">in</span> line.lower():
                <span class="hljs-keyword">match</span> = re.search(<span class="hljs-string">r'&lt;h1[^&gt;]*&gt;(.*?)&lt;/h1&gt;'</span>, line, re.IGNORECASE)
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>).strip()
        
        <span class="hljs-comment"># 如果没有明确标题，使用第一行非空内容</span>
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
            <span class="hljs-keyword">if</span> line.strip() <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(line.strip()) &gt; <span class="hljs-number">10</span>:
                <span class="hljs-keyword">return</span> line.strip()[:<span class="hljs-number">100</span>]
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">"未命名文档"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_extract_keywords</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span>, top_n: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""提取关键词（简化版）"""</span>
        <span class="hljs-comment"># 移除常见停用词</span>
        stop_words = {<span class="hljs-string">'的'</span>, <span class="hljs-string">'了'</span>, <span class="hljs-string">'在'</span>, <span class="hljs-string">'是'</span>, <span class="hljs-string">'我'</span>, <span class="hljs-string">'有'</span>, <span class="hljs-string">'和'</span>, <span class="hljs-string">'就'</span>, <span class="hljs-string">'不'</span>, <span class="hljs-string">'人'</span>, <span class="hljs-string">'都'</span>, <span class="hljs-string">'一'</span>, <span class="hljs-string">'一个'</span>}
        
        <span class="hljs-comment"># 中文分词（简化处理）</span>
        words = re.findall(<span class="hljs-string">r'[\u4e00-\u9fff]{2,}'</span>, content)
        
        <span class="hljs-comment"># 统计词频</span>
        word_freq = {}
        <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:
            <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> stop_words:
                word_freq[word] = word_freq.get(word, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># 返回频率最高的词</span>
        sorted_words = <span class="hljs-built_in">sorted</span>(word_freq.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        <span class="hljs-keyword">return</span> [word <span class="hljs-keyword">for</span> word, freq <span class="hljs-keyword">in</span> sorted_words[:top_n]]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_analyze_structure</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""分析文档结构"""</span>
        sections = []
        
        <span class="hljs-comment"># 提取标题</span>
        headings = re.findall(<span class="hljs-string">r'^(#{1,6})\s+(.+)$'</span>, content, re.MULTILINE)
        
        <span class="hljs-keyword">for</span> level, title <span class="hljs-keyword">in</span> headings:
            sections.append({
                <span class="hljs-string">'level'</span>: <span class="hljs-built_in">len</span>(level),
                <span class="hljs-string">'title'</span>: title.strip(),
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'heading'</span>
            })
        
        <span class="hljs-comment"># 统计段落</span>
        paragraphs = [p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> re.split(<span class="hljs-string">r'\n\s*\n'</span>, content) <span class="hljs-keyword">if</span> p.strip()]
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'sections'</span>: sections,
            <span class="hljs-string">'paragraph_count'</span>: <span class="hljs-built_in">len</span>(paragraphs),
            <span class="hljs-string">'has_headings'</span>: <span class="hljs-built_in">len</span>(headings) &gt; <span class="hljs-number">0</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_extract_time_info</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""提取时间信息"""</span>
        <span class="hljs-comment"># 匹配常见日期格式</span>
        date_patterns = [
            <span class="hljs-string">r'\d{4}年\d{1,2}月\d{1,2}日'</span>,
            <span class="hljs-string">r'\d{4}-\d{1,2}-\d{1,2}'</span>,
            <span class="hljs-string">r'\d{4}/\d{1,2}/\d{1,2}'</span>,
        ]
        
        dates = []
        <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> date_patterns:
            dates.extend(re.findall(pattern, content))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(dates))  <span class="hljs-comment"># 去重</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_detect_language</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""检测语言"""</span>
        <span class="hljs-comment"># 简单基于字符判断</span>
        zh_chars = <span class="hljs-built_in">len</span>(re.findall(<span class="hljs-string">r'[\u4e00-\u9fff]'</span>, content))
        en_chars = <span class="hljs-built_in">len</span>(re.findall(<span class="hljs-string">r'[a-zA-Z]'</span>, content))
        
        <span class="hljs-keyword">if</span> zh_chars &gt; en_chars:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'zh'</span>
        <span class="hljs-keyword">elif</span> en_chars &gt; zh_chars:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'en'</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'mixed'</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_has_tables</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""判断是否包含表格"""</span>
        <span class="hljs-comment"># Markdown表格</span>
        <span class="hljs-keyword">if</span> re.search(<span class="hljs-string">r'|.*|.*\n|[-:\s|]+|'</span>, content):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-comment"># HTML表格</span>
        <span class="hljs-keyword">if</span> re.search(<span class="hljs-string">r'&lt;table[^&gt;]*&gt;'</span>, content, re.IGNORECASE):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_has_code_blocks</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""判断是否包含代码块"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bool</span>(re.search(<span class="hljs-string">r'```[\s\S]*?```'</span>, content))
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_file_mtime</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""获取文件修改时间"""</span>
        mtime = os.path.getmtime(file_path)
        <span class="hljs-keyword">return</span> datetime.fromtimestamp(mtime, self.zh_timezone).isoformat()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_content_hash</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""计算内容哈希值"""</span>
        <span class="hljs-keyword">return</span> hashlib.md5(content.encode(<span class="hljs-string">'utf-8'</span>)).hexdigest()
</code></pre>
<h3 data-id="heading-6">2.4 完整的文档处理流水线</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DocumentProcessingPipeline</span>:
    <span class="hljs-string">"""文档处理流水线"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 
                 chunk_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">1000</span>,
                 chunk_overlap: <span class="hljs-built_in">int</span> = <span class="hljs-number">200</span></span>):
        
        self.parser = MultiFormatDocumentParser()
        self.chunker = SmartChunker(chunk_size, chunk_overlap)
        self.metadata_extractor = MetadataExtractor()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_document</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""处理单个文档"""</span>
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"开始处理文档: <span class="hljs-subst">{file_path}</span>"</span>)
        
        <span class="hljs-comment"># 1. 解析文档</span>
        raw_documents = self.parser.parse_document(file_path)
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> raw_documents:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"无法解析文档: <span class="hljs-subst">{file_path}</span>"</span>)
        
        <span class="hljs-comment"># 2. 合并所有页面/部分的内容</span>
        full_content = <span class="hljs-string">"\n\n"</span>.join([doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> raw_documents])
        
        <span class="hljs-comment"># 3. 提取文档级元数据</span>
        doc_type = os.path.splitext(file_path)[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>:].lower()
        document_metadata = self.metadata_extractor.extract_document_metadata(
            full_content, file_path, doc_type
        )
        
        <span class="hljs-comment"># 4. 智能分块</span>
        chunks = self.chunker.semantic_chunking(full_content, doc_type)
        
        <span class="hljs-comment"># 5. 为每个块添加元数据</span>
        processed_chunks = []
        <span class="hljs-keyword">for</span> i, chunk_content <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chunks):
            chunk_metadata = document_metadata.copy()
            chunk_metadata.update({
                <span class="hljs-string">'chunk_id'</span>: i + <span class="hljs-number">1</span>,
                <span class="hljs-string">'chunk_index'</span>: i,
                <span class="hljs-string">'chunk_length'</span>: <span class="hljs-built_in">len</span>(chunk_content),
                <span class="hljs-string">'is_first_chunk'</span>: i == <span class="hljs-number">0</span>,
                <span class="hljs-string">'is_last_chunk'</span>: i == <span class="hljs-built_in">len</span>(chunks) - <span class="hljs-number">1</span>,
            })
            
            <span class="hljs-comment"># 创建Document对象</span>
            chunk_doc = Document(
                page_content=chunk_content,
                metadata=chunk_metadata
            )
            processed_chunks.append(chunk_doc)
        
        <span class="hljs-comment"># 更新文档级元数据</span>
        document_metadata[<span class="hljs-string">'chunk_count'</span>] = <span class="hljs-built_in">len</span>(processed_chunks)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文档处理完成: <span class="hljs-subst">{file_path}</span>, 生成 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(processed_chunks)}</span> 个块"</span>)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'document_metadata'</span>: document_metadata,
            <span class="hljs-string">'chunks'</span>: processed_chunks,
            <span class="hljs-string">'original_path'</span>: file_path
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_directory</span>(<span class="hljs-params">self, 
                         directory_path: <span class="hljs-built_in">str</span>, 
                         extensions: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">"""批量处理目录中的文档"""</span>
        
        <span class="hljs-keyword">if</span> extensions <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            extensions = [<span class="hljs-string">'.pdf'</span>, <span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.txt'</span>, <span class="hljs-string">'.md'</span>, <span class="hljs-string">'.html'</span>]
        
        all_results = []
        
        <span class="hljs-keyword">for</span> root, _, files <span class="hljs-keyword">in</span> os.walk(directory_path):
            <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:
                file_path = os.path.join(root, file)
                ext = os.path.splitext(file)[<span class="hljs-number">1</span>].lower()
                
                <span class="hljs-keyword">if</span> extensions <span class="hljs-keyword">and</span> ext <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> extensions:
                    <span class="hljs-keyword">continue</span>
                
                <span class="hljs-keyword">try</span>:
                    result = self.process_document(file_path)
                    all_results.append(result)
                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"处理文件失败 <span class="hljs-subst">{file_path}</span>: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
                    <span class="hljs-keyword">continue</span>
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"目录处理完成，共处理 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(all_results)}</span> 个文档"</span>)
        <span class="hljs-keyword">return</span> all_results

<span class="hljs-comment"># 使用示例</span>
pipeline = DocumentProcessingPipeline(
    chunk_size=<span class="hljs-number">1000</span>,
    chunk_overlap=<span class="hljs-number">200</span>
)

<span class="hljs-comment"># 处理单个文档</span>
result = pipeline.process_document(<span class="hljs-string">"document.pdf"</span>)

<span class="hljs-comment"># 处理整个目录</span>
results = pipeline.process_directory(
    <span class="hljs-string">"./knowledge_base"</span>,
    extensions=[<span class="hljs-string">'.pdf'</span>, <span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.md'</span>, <span class="hljs-string">'.txt'</span>]
)

<span class="hljs-comment"># 提取所有块</span>
all_chunks = []
<span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results:
    all_chunks.extend(result[<span class="hljs-string">'chunks'</span>])

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"总共生成 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(all_chunks)}</span> 个文本块"</span>)
</code></pre>
<h2 data-id="heading-7">三、性能优化和最佳实践</h2>
<h3 data-id="heading-8">3.1 并行处理加速</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> concurrent.futures
<span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ParallelDocumentProcessor</span>:
    <span class="hljs-string">"""并行文档处理器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_workers: <span class="hljs-built_in">int</span> = <span class="hljs-number">4</span></span>):
        self.pipeline = DocumentProcessingPipeline()
        self.max_workers = max_workers
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_batch</span>(<span class="hljs-params">self, file_paths: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">"""批量并行处理文档"""</span>
        
        results = []
        
        <span class="hljs-keyword">with</span> concurrent.futures.ProcessPoolExecutor(
            max_workers=self.max_workers
        ) <span class="hljs-keyword">as</span> executor:
            <span class="hljs-comment"># 提交任务</span>
            future_to_file = {
                executor.submit(self.pipeline.process_document, fp): fp 
                <span class="hljs-keyword">for</span> fp <span class="hljs-keyword">in</span> file_paths
            }
            
            <span class="hljs-comment"># 处理结果</span>
            <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> tqdm(
                concurrent.futures.as_completed(future_to_file),
                total=<span class="hljs-built_in">len</span>(file_paths),
                desc=<span class="hljs-string">"处理文档"</span>
            ):
                file_path = future_to_file[future]
                <span class="hljs-keyword">try</span>:
                    result = future.result()
                    results.append(result)
                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"处理失败 <span class="hljs-subst">{file_path}</span>: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
        
        <span class="hljs-keyword">return</span> results
</code></pre>
<h3 data-id="heading-9">3.2 增量更新处理</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IncrementalIndexUpdater</span>:
    <span class="hljs-string">"""增量索引更新器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, index_storage_path: <span class="hljs-built_in">str</span></span>):
        self.index_storage_path = index_storage_path
        self.processed_files = self._load_processed_files()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_load_processed_files</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""加载已处理文件记录"""</span>
        record_file = os.path.join(self.index_storage_path, <span class="hljs-string">"processed_files.json"</span>)
        
        <span class="hljs-keyword">if</span> os.path.exists(record_file):
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(record_file, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
                <span class="hljs-keyword">return</span> json.load(f)
        <span class="hljs-keyword">return</span> {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_save_processed_files</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""保存已处理文件记录"""</span>
        record_file = os.path.join(self.index_storage_path, <span class="hljs-string">"processed_files.json"</span>)
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(record_file, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
            json.dump(self.processed_files, f, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_changed_files</span>(<span class="hljs-params">self, 
                         directory_path: <span class="hljs-built_in">str</span>, 
                         extensions: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""获取有变化的文件"""</span>
        
        changed_files = []
        
        <span class="hljs-keyword">for</span> root, _, files <span class="hljs-keyword">in</span> os.walk(directory_path):
            <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:
                file_path = os.path.join(root, file)
                ext = os.path.splitext(file)[<span class="hljs-number">1</span>].lower()
                
                <span class="hljs-keyword">if</span> extensions <span class="hljs-keyword">and</span> ext <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> extensions:
                    <span class="hljs-keyword">continue</span>
                
                <span class="hljs-comment"># 检查文件是否已处理或有更新</span>
                file_hash = self._calculate_file_hash(file_path)
                
                <span class="hljs-keyword">if</span> (file_path <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.processed_files <span class="hljs-keyword">or</span> 
                    self.processed_files[file_path] != file_hash):
                    changed_files.append(file_path)
                    self.processed_files[file_path] = file_hash
        
        <span class="hljs-keyword">return</span> changed_files
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_file_hash</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""计算文件哈希"""</span>
        hasher = hashlib.md5()
        
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:
            buf = f.read(<span class="hljs-number">65536</span>)
            <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(buf) &gt; <span class="hljs-number">0</span>:
                hasher.update(buf)
                buf = f.read(<span class="hljs-number">65536</span>)
        
        <span class="hljs-keyword">return</span> hasher.hexdigest()
</code></pre>
<h2 data-id="heading-10">四、常见问题与解决方案</h2>
<h3 data-id="heading-11">问题1：文档格式兼容性</h3>
<p><strong>解决方案</strong>：使用多个解析库，并实现降级策略</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">robust_pdf_parsing</span>(<span class="hljs-params">file_path: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""鲁棒的PDF解析"""</span>
    parsers = [PyPDFLoader, UnstructuredPDFLoader]
    
    <span class="hljs-keyword">for</span> parser_class <span class="hljs-keyword">in</span> parsers:
        <span class="hljs-keyword">try</span>:
            loader = parser_class(file_path)
            <span class="hljs-keyword">return</span> loader.load()
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">continue</span>
    
    <span class="hljs-comment"># 降级到文本提取</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">import</span> textract
        text = textract.process(file_path).decode(<span class="hljs-string">'utf-8'</span>)
        <span class="hljs-keyword">return</span> [Document(page_content=text, metadata={<span class="hljs-string">'source'</span>: file_path})]
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"无法解析PDF文件: <span class="hljs-subst">{file_path}</span>"</span>)
</code></pre>
<h3 data-id="heading-12">问题2：中文文档分块效果不佳</h3>
<p><strong>解决方案</strong>：使用专门的中文分块器</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChineseTextSplitter</span>:
    <span class="hljs-string">"""中文文本分块器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, chunk_size=<span class="hljs-number">500</span>, chunk_overlap=<span class="hljs-number">50</span></span>):
        self.chunk_size = chunk_size
        self.chunk_overlap = chunk_overlap
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">split_text</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-comment"># 使用中文标点进行分割</span>
        separators = [<span class="hljs-string">'\n\n'</span>, <span class="hljs-string">'\n'</span>, <span class="hljs-string">'。'</span>, <span class="hljs-string">'！'</span>, <span class="hljs-string">'？'</span>, <span class="hljs-string">'；'</span>, <span class="hljs-string">'……'</span>, <span class="hljs-string">'…'</span>, <span class="hljs-string">'，'</span>, <span class="hljs-string">'、'</span>]
        
        chunks = []
        current_chunk = <span class="hljs-string">""</span>
        
        <span class="hljs-comment"># 按句子分割</span>
        sentences = self._split_into_sentences(text)
        
        <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences:
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_chunk) + <span class="hljs-built_in">len</span>(sentence) &lt;= self.chunk_size:
                current_chunk += sentence
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">if</span> current_chunk:
                    chunks.append(current_chunk)
                current_chunk = sentence
        
        <span class="hljs-keyword">if</span> current_chunk:
            chunks.append(current_chunk)
        
        <span class="hljs-keyword">return</span> chunks
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_split_into_sentences</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""将中文文本分割成句子"""</span>
        <span class="hljs-keyword">import</span> re
        <span class="hljs-comment"># 中文句子分割规则</span>
        pattern = <span class="hljs-string">r'([。！？；…]+\s*)'</span>
        parts = re.split(pattern, text)
        
        sentences = []
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(parts)-<span class="hljs-number">1</span>, <span class="hljs-number">2</span>):
            sentence = parts[i] + (parts[i+<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> i+<span class="hljs-number">1</span> &lt; <span class="hljs-built_in">len</span>(parts) <span class="hljs-keyword">else</span> <span class="hljs-string">''</span>)
            <span class="hljs-keyword">if</span> sentence.strip():
                sentences.append(sentence)
        
        <span class="hljs-keyword">return</span> sentences
</code></pre>
<h2 data-id="heading-13">五、实战：构建完整的RAG索引系统</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CompleteRAGIndexer</span>:
    <span class="hljs-string">"""完整的RAG索引构建系统"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 
                 embedding_model=<span class="hljs-literal">None</span>,
                 vector_store=<span class="hljs-literal">None</span></span>):
        
        self.pipeline = DocumentProcessingPipeline()
        self.parallel_processor = ParallelDocumentProcessor()
        self.updater = IncrementalIndexUpdater(<span class="hljs-string">"./vector_store"</span>)
        
        self.embedding_model = embedding_model
        self.vector_store = vector_store
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_index</span>(<span class="hljs-params">self, 
                   knowledge_base_path: <span class="hljs-built_in">str</span>,
                   incremental: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""构建知识库索引"""</span>
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始构建RAG索引..."</span>)
        
        <span class="hljs-comment"># 1. 获取需要处理的文件</span>
        <span class="hljs-keyword">if</span> incremental:
            files_to_process = self.updater.get_changed_files(
                knowledge_base_path,
                extensions=[<span class="hljs-string">'.pdf'</span>, <span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.md'</span>, <span class="hljs-string">'.txt'</span>, <span class="hljs-string">'.html'</span>]
            )
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"增量更新: 发现 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(files_to_process)}</span> 个变更文件"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 获取所有文件</span>
            all_files = []
            <span class="hljs-keyword">for</span> root, _, files <span class="hljs-keyword">in</span> os.walk(knowledge_base_path):
                <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:
                    <span class="hljs-keyword">if</span> file.lower().endswith((<span class="hljs-string">'.pdf'</span>, <span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.md'</span>, <span class="hljs-string">'.txt'</span>, <span class="hljs-string">'.html'</span>)):
                        all_files.append(os.path.join(root, file))
            files_to_process = all_files
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> files_to_process:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"没有需要处理的文件"</span>)
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'status'</span>: <span class="hljs-string">'no_changes'</span>, <span class="hljs-string">'chunks'</span>: []}
        
        <span class="hljs-comment"># 2. 并行处理文档</span>
        processing_results = self.parallel_processor.process_batch(files_to_process)
        
        <span class="hljs-comment"># 3. 提取所有文本块</span>
        all_chunks = []
        <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> processing_results:
            all_chunks.extend(result[<span class="hljs-string">'chunks'</span>])
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"总共生成 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(all_chunks)}</span> 个文本块"</span>)
        
        <span class="hljs-comment"># 4. 生成向量嵌入</span>
        <span class="hljs-keyword">if</span> self.embedding_model <span class="hljs-keyword">and</span> self.vector_store:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始生成向量嵌入..."</span>)
            
            texts = [chunk.page_content <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> all_chunks]
            metadatas = [chunk.metadata <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> all_chunks]
            
            embeddings = self.embedding_model.embed_documents(texts)
            
            <span class="hljs-comment"># 存储到向量数据库</span>
            self.vector_store.add_embeddings(
                texts=texts,
                embeddings=embeddings,
                metadatas=metadatas
            )
            
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"向量索引构建完成"</span>)
        
        <span class="hljs-comment"># 5. 保存处理记录</span>
        self.updater._save_processed_files()
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'status'</span>: <span class="hljs-string">'success'</span>,
            <span class="hljs-string">'total_chunks'</span>: <span class="hljs-built_in">len</span>(all_chunks),
            <span class="hljs-string">'processed_files'</span>: <span class="hljs-built_in">len</span>(files_to_process),
            <span class="hljs-string">'chunks'</span>: all_chunks
        }

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># 初始化组件</span>
    <span class="hljs-keyword">from</span> langchain.embeddings <span class="hljs-keyword">import</span> OpenAIEmbeddings
    <span class="hljs-keyword">from</span> langchain.vectorstores <span class="hljs-keyword">import</span> Chroma
    
    embedding_model = OpenAIEmbeddings()
    vector_store = Chroma(
        persist_directory=<span class="hljs-string">"./chroma_db"</span>,
        embedding_function=embedding_model
    )
    
    <span class="hljs-comment"># 构建索引</span>
    indexer = CompleteRAGIndexer(
        embedding_model=embedding_model,
        vector_store=vector_store
    )
    
    <span class="hljs-comment"># 首次全量构建</span>
    result = indexer.build_index(
        knowledge_base_path=<span class="hljs-string">"./knowledge_base"</span>,
        incremental=<span class="hljs-literal">False</span>
    )
    
    <span class="hljs-comment"># 后续增量更新</span>
    result = indexer.build_index(
        knowledge_base_path=<span class="hljs-string">"./knowledge_base"</span>,
        incremental=<span class="hljs-literal">True</span>
    )
</code></pre>
<h2 data-id="heading-14">六、总结与展望</h2>
<p>文档解析是RAG系统的基石，一个优秀的解析系统应该具备：</p>
<ol>
<li>1. <strong>多格式支持</strong>：能处理各种常见文档格式</li>
<li>2. <strong>智能分块</strong>：理解文档结构，保持语义完整性</li>
<li>3. <strong>丰富元数据</strong>：提取有用信息辅助检索</li>
<li>4. <strong>高效处理</strong>：支持并行和增量更新</li>
<li>5. <strong>鲁棒性</strong>：能处理各种异常情况</li>
</ol>
<p>随着大模型技术的发展，未来的文档解析会更加智能化，比如：</p>
<ul>
<li>• 使用视觉模型解析复杂版式</li>
<li>• 利用大模型理解文档语义结构</li>
<li>• 自动识别文档类型和领域</li>
<li>• 智能提取表格、图表等非文本内容</li>
</ul>
<p>希望本文对你构建自己的RAG系统有所帮助！记住，好的开始是成功的一半，精心设计的文档解析流程会让你的RAG系统事半功倍。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS一杯冰美式的时间 -- FullScreenLaunchComponent]]></title>    <link>https://juejin.cn/post/7593338828195577896</link>    <guid>https://juejin.cn/post/7593338828195577896</guid>    <pubDate>2026-01-09T15:58:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195577896" data-draft-id="7593187953272160256" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS一杯冰美式的时间 -- FullScreenLaunchComponent"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2026-01-09T15:58:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="猫猫头啊"/> <meta itemprop="url" content="https://juejin.cn/user/1283876003519357"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS一杯冰美式的时间 -- FullScreenLaunchComponent
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1283876003519357/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    猫猫头啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:58:51.000Z" title="Fri Jan 09 2026 15:58:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>最近在开发中，我们的元服务需要被其他应用通过FullScreenLaunchComponent拉起，我只能说当时上了5.0的当，FullScreenLaunchComponent也是Beta版本的！在实际开发中作为碰了几次灰，踩了不少坑，觉得有必要分享下，故有了此篇文章。</p>
<p>该系列依旧会带着大家，了解，开阔一些不怎么热门的API，也可能是偷偷被更新的API，也可以是好玩的，藏在官方文档的边边角角~当然也会有一些API，之前是我们辛辛苦苦的手撸代码，现在有一个API能帮我们快速实现的，希望大家能找宝藏。</p>
<p>如果您有任何疑问、对文章写的不满意、发现错误或者有更好的方法，欢迎在评论、私信或邮件中提出，非常感谢您的支持。🙏</p>
<h2 data-id="heading-1">二、FullScreenLaunchComponent的诞生背景</h2>
<p>OK，步入正题把，在HarmonyOS开发中，我们可能会需要在一个应用中嵌入另一个应用的能力。比如，你的应用想要使用某个元服务提供的功能，但又不想让用户跳转到另一个应用，而是希望在自己的应用内无缝使用这个能力。</p>
<p>以前我们可能需要通过跳转的方式拉起另一个应用，这样用户体验就不够流畅。FullScreenLaunchComponent就是为了解决这个问题而生的，它允许我们以全屏方式拉起元服务，使得应用能够提供更友好的用户体验。虽然我不是很喜欢这个能力，因为真的坑到我了。</p>
<h3 data-id="heading-2">1. 什么是FullScreenLaunchComponent</h3>
<p>FullScreenLaunchComponent是由ArkUI提供的组件，简单来说，它就是一个"容器"，可以嵌入运行另一个元服务的UI。</p>
<p>当被拉起方授权使用方应用嵌入式运行元服务时，使用方应用可全屏嵌入式运行该服务；若未授权，则使用方应用将以跳出式方式拉起元服务。</p>
<h2 data-id="heading-3">三、基本使用</h2>
<h3 data-id="heading-4">1. 版本说明</h3>
<ul>
<li>该组件从API version 12开始支持</li>
<li>该组件不支持在Wearable设备上使用（真的需要在穿戴设备使用这个功能吗？？？？）</li>
<li>5.0和6.0的表现非常不一样！</li>
</ul>
<h3 data-id="heading-5">2. 使用方接入</h3>
<p>使用方接入非常简单，只需要几行代码就能搞定：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FullScreenLaunchComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">appId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'XXXXX'</span>; <span class="hljs-comment">// 元服务appId</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">FullScreenLaunchComponent</span>({
          <span class="hljs-attr">content</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">ColumnChild</span>,  <span class="hljs-comment">// 占位图标组件</span>
          <span class="hljs-attr">appId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">appId</span>,     <span class="hljs-comment">// 元服务appId</span>
          <span class="hljs-attr">options</span>: {},           <span class="hljs-comment">// 拉起参数</span>
          <span class="hljs-attr">onTerminated</span>: <span class="hljs-function">(<span class="hljs-params">info</span>) =&gt;</span> {
            <span class="hljs-comment">// 元服务退出时的回调</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onTerminated code: <span class="hljs-subst">${info.code.toString()}</span>`</span>);
          },
          <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
            <span class="hljs-comment">// 发生异常时的回调</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`onError code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);
          },
          <span class="hljs-attr">onReceive</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
            <span class="hljs-comment">// 接收元服务传递的数据</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onReceive, data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data)}</span>`</span>);
          }
        }).<span class="hljs-title function_">width</span>(<span class="hljs-string">"80vp"</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">"80vp"</span>)
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
  }
}

<span class="hljs-comment">// 占位图标，点击后拉起元服务</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ColumnChild</span>(<span class="hljs-params"/>) {
  <span class="hljs-title class_">Column</span>() {
    <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.startIcon'</span>))
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'test'</span>)
  }
}
</code></pre>
<p>可以看到，接入确实非常方便！只需要：</p>
<ol>
<li>导入<code>FullScreenLaunchComponent</code></li>
<li>传入<code>appId</code>（元服务的唯一标识）</li>
<li>传入<code>content</code>（占位图标组件）</li>
<li>可选：设置回调函数</li>
</ol>
<h3 data-id="heading-6">3. 提供方实现</h3>
<p>提供方需要继承<code>EmbeddableUIAbility</code>，这是<strong>必须</strong>的！否则系统无法保证元服务功能正常(刚开始，你继承或者不继承，都不影响不正常...)。</p>
<p>提供方入口文件：<code>/src/main/ets/entryability/EntryAbility.ets</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Want</span>, <span class="hljs-title class_">EmbeddableUIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DOMAIN</span> = <span class="hljs-number">0x0000</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EmbeddableUIAbility</span> {
  storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();
  
  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);
  }

  <span class="hljs-title function_">onDestroy</span>(): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onDestroy'</span>);
  }

  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onWindowStageCreate'</span>);
    <span class="hljs-comment">// ⚠️ 重要：正常开发中getMainWindowSync可以正常使用，但如果需要提供给FullScreenLaunchComponent，</span>
    <span class="hljs-comment">// 在FullScreenLaunchComponent场景下getMainWindowSync会崩溃，必须使用try-catch，虽然你也拿不到，笑死了。</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">let</span> mainWindow = windowStage.<span class="hljs-title function_">getMainWindowSync</span>();
    <span class="hljs-comment">//TODO 做点什么</span>
    } <span class="hljs-keyword">catch</span> (err) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'getMainWindowSync failed: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
    }
    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>);
  }

  <span class="hljs-title function_">onWindowStageDestroy</span>(): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onWindowStageDestroy'</span>);
  }

  <span class="hljs-title function_">onForeground</span>(): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onForeground'</span>);
  }

  <span class="hljs-title function_">onBackground</span>(): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onBackground'</span>);
  }
}
</code></pre>
<h2 data-id="heading-7">四、实际开发中的坑点</h2>
<p>以下问题都是我们在作为提供方开发时遇到的，如果你是使用方，可能不会遇到这些问题，但了解这些限制也有助于更好地使用FullScreenLaunchComponent。</p>
<h3 data-id="heading-8">1. 状态栏高度获取问题</h3>
<p>在HarmonyOS 6.0之前，我们在EmbeddableUIAbility中顶部的状态栏高度没有办法正确的获取。这个问题很隐蔽，因为不会报错，只是获取到的值不对，导致UI布局出现问题。</p>
<p><strong>解决方案：</strong></p>
<p>在6.0之前，我直接使用了固定的值。虽然不够优雅，但这是最稳妥的方案。如果你的应用需要适配多个版本，建议封装一个工具方法来处理状态栏高度的获取，避免在不同版本上出现显示问题。</p>
<h3 data-id="heading-9">2. Window相关API的异常处理</h3>
<p>在正常开发中，我们一般会使用<code>windowStage.getMainWindowSync()</code>来获取主窗口，这个方法在普通场景下是可以正常工作的。但是，如果你的元服务需要提供给FullScreenLaunchComponent使用，<code>getMainWindowSync()</code>会崩!!!!！</p>
<p>很多地方习惯性地使用<code>getMainWindow()</code>或者<code>windowStage.getMainWindowSync()</code>，结果在FullScreenLaunchComponent场景下直接崩溃，当时真的是一脸懵逼。(这也促使我们在后面的代码规范中，禁止所有对window方法的直接使用)</p>
<p>这是因为FullScreenLaunchComponent内部默认方式下，提供方无真正的窗口承载，所以无法正常获取Window对象。如果你没有进行try-catch的话，哦吼，崩掉。</p>
<h3 data-id="heading-10">3. 调试困难问题</h3>
<p>调试非常困难，特别是你需要调试的东西在启动流程（如<code>onCreate</code>、<code>onWindowStageCreate</code>）的时候，没法进行调试。因为每次被使用方拉起时，都会创建一个新的Embeddable进程，没办法提前断点，或者断点启动，所以根本没有办法进行启动流程的调试。</p>
<p>我们只能通过日志来一点点排查问题，非常痛苦。</p>
<p><strong>解决方案：</strong></p>
<p>只能一点点的加日志输出。虽然调试体验不好，但这是跨进程架构带来的限制，我们只能通过日志来排查问题。</p>
<h3 data-id="heading-11">4. UIContext获取异常</h3>
<p>因为提供方无真正的窗口承载，所以第2点说的window异常的，实际上获取的UIContext的获取也是异常的。我们在代码中大量使用了<code>getUIContext()</code>来获取UIContext，结果在FullScreenLaunchComponent场景下可能获取不到正确的值，导致很多功能异常。</p>
<p>最后我们修改了大量的使用Context的地方，部分改用<code>applicationContext</code>，才解决了这个问题。</p>
<p>在FullScreenLaunchComponent场景下，尽量避免使用UIContext，优先使用<code>applicationContext</code>或<code>UIAbilityContext</code>。如果必须使用UIContext，一定要做好异常处理。</p>
<h3 data-id="heading-12">5. 不支持富文本组件</h3>
<p>部分功能使用了RichText组件来显示富文本内容，然后发现RichText组件在FullScreenLaunchComponent中不支持。淦！</p>
<p><strong>解决方案：</strong></p>
<p>阿弥陀佛，我们直接重写了一套，富文本组件，搞心态。</p>
<h3 data-id="heading-13">6. EmbeddableUIAbilityContext的特殊性</h3>
<p>作为提供方，我们必须继承<code>EmbeddableUIAbility</code>，但是<code>EmbeddableUIAbility</code>的上下文，是和普通的<code>UIAbility</code>的上下文<code>UIAbilityContext</code>不一样的，使用的是<code>EmbeddableUIAbilityContext</code>，虽然是有继承关系，但在某些API的使用上可能存在差异。</p>
<p>我们在开发时，有些原本在普通UIAbility中能正常工作的代码，在EmbeddableUIAbility中就不行了，就是因为上下文类型的差异导致的。</p>
<p>在使用上下文相关API时，要注意<code>EmbeddableUIAbilityContext</code>和<code>UIAbilityContext</code>的差异，做好兼容处理。</p>
<h2 data-id="heading-14">五、能力范围与限制</h2>
<p>官方文档其实也列出很多限制场景，如下：</p>
<h3 data-id="heading-15">1. 不支持的能力</h3>
<p><strong>组件方面：</strong></p>
<ul>
<li><code>FullScreenLaunchComponent</code>：不支持嵌套拉起（总不能套娃吧...）</li>
<li><code>EmbeddedComponent</code>：不支持嵌套拉起</li>
<li><code>RichText</code>：不支持富文本组件</li>
<li><code>FolderStack</code>：不支持（需要和宿主方窗口形成联动）</li>
<li><code>XComponent</code>：不支持</li>
<li><code>FormLink</code>：不支持</li>
<li><code>HyperLink</code>：不支持</li>
<li><code>ContextMenu</code>：不支持</li>
</ul>
<p><strong>Node-API接口方面：</strong></p>
<ul>
<li>页面间转场：不支持</li>
<li>组件内隐式共享元素转场：不支持</li>
<li><code>componentUtils</code>：不支持（获取的位置信息是EmbeddableUIAbility的WindowProxy的信息）</li>
<li><code>UIContext</code>：不支持（提供方无真正的窗口承载）</li>
<li><code>DragController</code>：不支持（依赖UIContext）</li>
<li>注册自定义字体：不支持</li>
</ul>
<h3 data-id="heading-16">2. 部分支持的能力</h3>
<p><strong>弹窗组件：</strong></p>
<ul>
<li>警告弹窗、列表选择弹窗、自定义弹窗：部分支持</li>
<li>若在FullScreenLaunchComponent中设置<code>showInSubWindow</code>为<code>true</code>，弹窗将基于FullScreenLaunchComponent的宿主窗口对齐</li>
<li>仅限于窗口对齐，其他能力可能受限</li>
</ul>
<p><strong>Navigation组件：</strong></p>
<ul>
<li>部分支持</li>
<li>如果FullScreenLaunchComponent未设置模态或沉浸式，Navigation无法扩展到安全区</li>
<li>无法路由到宿主方的页面中</li>
</ul>
<h3 data-id="heading-17">3. 其他约束</h3>
<p><strong>安全能力约束：</strong></p>
<ul>
<li>FullScreenLaunchComponent能力无法独立提供安全保障机制</li>
<li>提供方应用需要结合使用其他ArkUI的能力进行安全保护</li>
<li>如果存在安全方面的诉求，建议优先使用其他方案</li>
</ul>
<p><strong>嵌套约束：</strong></p>
<ul>
<li>FullScreenLaunchComponent暂不支持嵌套</li>
<li>不支持A应用(UIAbility)-&gt;B应用(EmbeddableUIAbility)-&gt;C应用(EmbeddableUIAbility)这种嵌套能力依赖</li>
</ul>
<p><strong>事件处理机制约束：</strong></p>
<ul>
<li>FullScreenLaunchComponent不支持通用事件，会将事件经过坐标转换后传递给提供方EmbeddableUIAbility处理</li>
<li>宿主进程与提供方进程的交互默认均是异步处理</li>
<li>某些事件（如按键事件、焦点事件）支持同步处理，但支持超时等待机制</li>
</ul>
<p><strong>页面渲染效果体验约束：</strong></p>
<ul>
<li><strong>闪白现象</strong>：创建并拉起另一个进程是耗时的，使用方在等待过程中会感知到FullScreenLaunchComponent的背景色（默认是白色）</li>
<li><strong>渲染显示不同步现象</strong>：当使用方应用页面快速变化时（如横竖屏切换），会出现使用方页面渲染过程和FullScreenLaunchComponent组件中展示的内容不同步的情况</li>
</ul>
<p><strong>消减闪白问题的方法：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">FullScreenLaunchComponent</span>({
  <span class="hljs-attr">content</span>: <span class="hljs-title class_">ColumnChild</span>,
  <span class="hljs-attr">appId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">appId</span>,
  <span class="hljs-attr">options</span>: {},
})
.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5F5F5'</span>)  <span class="hljs-comment">// 根据提供方页面背景色设置，实现无跳变感知</span>
.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
</code></pre>
<h2 data-id="heading-18">六、总结</h2>
<p>总的来说，FullScreenLaunchComponent是一个很强大的组件，使用方接入确实非常方便（苦了我们这些提供方），虽然存在一些限制和坑点，但FullScreenLaunchComponent的效果其实还不错的，有时候都感知不到是到了我们的元服务里面，以为就是自己~</p>
<p>好了，关于FullScreenLaunchComponent的内容我们就介绍到这里。虽然使用方接入很方便，但作为提供方在实际开发中确实有不少坑，希望这篇文章能帮助到正在开发或准备开发可被FullScreenLaunchComponent接入的元服务的开发者。</p>
<h2 data-id="heading-19">七、最后</h2>
<p>因为篇幅原因，我们先到这，哈、下一篇还没想好写什么，如果你有想看的也可以在评论区，或者私信给我，马上写～咕咕咕。</p>
<p>如果您有任何疑问、对文章写的不满意、发现错误或者有更好的方法，欢迎在评论、私信或邮件中提出，非常感谢您的支持。🙏</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里Qwen3-VL双子星开源：图文视频混合检索的“降维打击”]]></title>    <link>https://juejin.cn/post/7593181244709158964</link>    <guid>https://juejin.cn/post/7593181244709158964</guid>    <pubDate>2026-01-09T14:06:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593181244709158964" data-draft-id="7593338828195381288" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里Qwen3-VL双子星开源：图文视频混合检索的“降维打击”"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-09T14:06:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里Qwen3-VL双子星开源：图文视频混合检索的“降维打击”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:06:21.000Z" title="Fri Jan 09 2026 14:06:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你关注大模型领域的最新动态，应该注意到了2026年1月8日的一个重磅消息：阿里通义千问团队把他们的“看家本领”拿出来了。</p>
<p>这次开源的不是又一个单纯聊天的Chatbot，而是一套专门解决“多模态检索”难题的工具链——<strong>Qwen3-VL-Embedding</strong> 和 <strong>Qwen3-VL-Reranker</strong>。</p>
<p>简单说，这套模型是基于强大的Qwen3-VL底座打造的，它们解决了一个让开发者头疼已久的问题：在这个图文、视频爆炸的年代，我们该如何像搜索文字一样，精准地搜索视频片段、复杂图表和截屏？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2F640-1-1024x576.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/640-1-1024x576.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/501a319dc2c4490587c242d5ae9b79cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768572381&amp;x-signature=9pbNLT5ePNNnmXBKeTBP4lrDIdA%3D" alt="640" loading="lazy"/></a></p>
<h3 data-id="heading-0">为什么需要这套“双子星”？</h3>
<p>在过去的一年里，RAG（检索增强生成）几乎成了企业级应用的标配。但痛点在于，传统的RAG大多是“瞎子”，只能处理纯文本。一旦文档里夹杂了流程图、或者知识库里堆满了视频素材，传统模型就歇菜了。</p>
<p>通义团队这次打出的组合拳，正是为了填补这个空白。</p>
<p>这套系统由两个核心角色组成，配合起来就像是一个经验丰富的“图书管理员”：</p>
<p><strong>第一步：Qwen3-VL-Embedding（负责“广撒网”）</strong> 这是检索的第一道关卡。它的任务是把所有的素材——无论是PDF里的文字、PPT里的架构图，还是长视频里的某一帧，统统“翻译”成统一的数学向量。 这打破了模态之间的“生殖隔离”。有了它，你不仅可以用文字搜图，还能用图搜视频。而且，它支持所谓的“Matryoshka”套娃式表示学习，这意味着你可以在推理时灵活截断向量维度，在精度和速度之间自由切换，不用重新训练模型。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Ffadsfsfg-1024x500.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/fadsfsfg-1024x500.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a2d5e703f69423f8c3d203da61a01b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768572381&amp;x-signature=9WjHLkPivbiU9%2F3tsAo8PhyeOH8%3D" alt="fadsfsfg" loading="lazy"/></a></p>
<p><strong>第二步：Qwen3-VL-Reranker（负责“精挑选”）</strong> Embedding虽然快，但有时候不够精准。这时候就需要Reranker登场了。 不同于市面上常见的双塔结构，这个Reranker会把用户的查询和Embedding捞回来的候选内容放在一起进行“深度阅读”。它会通过交叉注意力机制，仔细比对查询意图和素材细节的匹配度，然后重新排座次。官方数据显示，这个精排步骤能显著提升最终结果的准确性。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fffdsdgdfg-1024x305.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/ffdsdgdfg-1024x305.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfe24a8d53184aeead17e71bfae239d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768572381&amp;x-signature=BjbU%2FxDF86qAR%2FFRzaPB4ESvd%2B4%3D" alt="ffdsdgdfg" loading="lazy"/></a></p>
<h3 data-id="heading-1">看起来很强，用起来重吗？</h3>
<p>这可能是开发者最关心的问题。好消息是，这套模型非常“亲民”。</p>
<p><strong>Qwen3-VL-Embedding</strong> 提供了 <strong>2B</strong> 和 <strong>8B</strong> 两个版本。 <strong>Qwen3-VL-Reranker</strong> 目前开源了 <strong>2B</strong> 版本。</p>
<p>对于大多数商业应用或个人开发者来说，2B和8B的参数量意味着你不需要拥有显卡集群，就能在本地或中型服务器上跑起来。同时，它们原生支持32K的上下文长度，处理长文档或长视频片段绰绰有余。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fsdfgfdgdf-1024x553.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/sdfgfdgdf-1024x553.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2076c3f1cc334ac3946a76c3347a078c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768572381&amp;x-signature=7RS0IbloSWnZyv2DRpZ9EReFZEo%3D" alt="sdfgfdgdf" loading="lazy"/></a></p>
<h3 data-id="heading-2">硬实力的证明</h3>
<p>在技术圈，不服跑个分。</p>
<p>根据官方和第三方的测试数据（如MMEB-V2、MMTEB基准），Qwen3-VL-Embedding的8B版本在多模态检索任务上，性能直接超越了目前市面上已知的开源模型，甚至把一些闭源商业服务甩在了身后。</p>
<p>特别是对于那些复杂的视觉文档——比如包含代码截图的教程、充满UI组件的设计稿，这套模型的理解能力展现出了SOTA（当前最佳）的水准。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fsdfsgdf-1024x441.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/sdfsgdf-1024x441.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9cddc8554724dcaa9aa9f26056b60f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768572381&amp;x-signature=QjrUwFj3cFEE3OLJ1WQgxRi%2FHuc%3D" alt="sdfsgdf" loading="lazy"/></a></p>
<h3 data-id="heading-3">总结</h3>
<p>通义千问这次的开源动作，实际上是把多模态RAG的门槛给踏平了。</p>
<p>无论你是想做一个能看懂设计图的企业知识库，还是想搭建一个能搜到“主角穿红衣服那个镜头”的视频搜索引擎，Qwen3-VL的这套Embedding和Reranker组合，都是目前开源界最值得尝试的基石。</p>
<p>目前，模型权重已经全部托管在Hugging Face和ModelScope上，遵循Apache 2.0协议。也就是说，哪怕你是拿去商用，也是完全免费且合规的。</p>
<p>对于正在构建下一代AI应用的开发者来说，这绝对是2026年开年的一份大礼。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GDAL 实现空间分析]]></title>    <link>https://juejin.cn/post/7593175890794758190</link>    <guid>https://juejin.cn/post/7593175890794758190</guid>    <pubDate>2026-01-09T14:26:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593175890794758190" data-draft-id="7593171168259489801" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GDAL 实现空间分析"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-09T14:26:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GDAL 实现空间分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:26:23.000Z" title="Fri Jan 09 2026 14:26:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">^ 关注我，带你一起学GIS ^</h2>
<h2 data-id="heading-1">前言</h2>
<blockquote>
<p>❝</p>
<p>空间分析基于空间关系，常见的如叠加、求差、取反等。在GIS开发中，空间分析作为其灵魂支柱，具有重要意义，是每一个GISer都必须要掌握的技能。</p>
</blockquote>
<p>在之前的文章中讲了如何使用<code>GDAL</code>或者<code>ogr2ogr</code>工具将<code>txt</code>以及<code>csv</code>文本数据转换为<code>Shp</code>格式，本篇教程在之前一系列文章的基础上讲解如何使用<strong>GDAL 实现空间分析</strong>。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487980%26idx%3D1%26sn%3Dbfd72c505f12f36cc459989cb16229db%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487980&amp;idx=1&amp;sn=bfd72c505f12f36cc459989cb16229db&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GDAL 简介</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247488004%26idx%3D1%26sn%3D3cab0afab44ff1c9d2e583933d6b4c3e%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247488004&amp;idx=1&amp;sn=3cab0afab44ff1c9d2e583933d6b4c3e&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GDAL 下载安装</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247488017%26idx%3D1%26sn%3De41670cf4042e17353ad7ee507423269%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247488017&amp;idx=1&amp;sn=e41670cf4042e17353ad7ee507423269&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GDAL 开发起步</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247488343%26idx%3D1%26sn%3D39a39704cd83d5b4a955cef28c1df5ba%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247488343&amp;idx=1&amp;sn=39a39704cd83d5b4a955cef28c1df5ba&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GDAL 实现 GIS 数据读取转换（全）</a></li>
</ul>
<p>如果你还没有看过，建议从以上内容开始。</p>
<h2 data-id="heading-2">1. 开发环境</h2>
<p>本文使用如下开发环境，以供参考。</p>
<p>时间：<code>2025年</code></p>
<p>系统：<code>Windows 11</code></p>
<p>Python：<code>3.11.7</code></p>
<p>GDAL：<code>3.11.1</code></p>
<h2 data-id="heading-3">2. 空间分析</h2>
<p>定义一个方法<code>SpatialAnalysis</code>用于判断要素间空间关系，该方法接收两个参数，其中<code>sourcePath</code>指向源数据路径，<code>resultPath</code>指向结果文件路径。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""说明：GDAL 空间分析操作参数：    -sourcePath：Shp 数据路径    -resultPath：生成结果数据路径"""</span><span class="hljs-keyword">def</span> <span class="hljs-title function_">SpatialAnalysis</span>(<span class="hljs-params">sourcePath,resultPath</span>):
</code></pre>
<p>接着是基础的常规操作，添加数据驱动，获取数据源，获取目标图层。</p>
<pre><code class="hljs language-scss" lang="scss"># 检查文件是否存在<span class="hljs-built_in">checkFilePath</span>(sourcePath)# 添加数据驱动shpDriver = ogr<span class="hljs-selector-class">.GetDriverByName</span>("ESRI Shapefile")# 获取数据源shpDs = shpDriver<span class="hljs-selector-class">.Open</span>(sourcePath)# 获取图层shpLayer = shpDs<span class="hljs-selector-class">.GetLayer</span>(<span class="hljs-number">0</span>)srs = shpLayer<span class="hljs-selector-class">.GetSpatialRef</span>()geomType = shpLayer<span class="hljs-selector-class">.GetGeomType</span>()
</code></pre>
<p>方法<code>checkFilePath</code>用于检查文件路径是否正常，接受一个路径参数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""说明：检查文件路径是否正常参数：    -filePath：文件数据路径"""</span><span class="hljs-keyword">def</span> <span class="hljs-title function_">checkFilePath</span>(<span class="hljs-params">filePath</span>):    <span class="hljs-keyword">if</span> os.path.exists(filePath):        <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件数据路径存在"</span>)    <span class="hljs-keyword">else</span>:        <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件数据路径不存在，请检查！"</span>)
</code></pre>
<p>本文基于以下数据进行空间分析操作。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2189f144c614661a9fef63f88994be5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=hdfUeyRmF5vXPSmyDUG7cTerUio%3D" alt="" loading="lazy"/>对涉及面的操作分别获取面0和面1两个要素。<code>GDAL</code>中的几何处理操作，如叠加、缓冲、求差等均返回一个新的几何对象。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">""</span><span class="hljs-string">"获取第一个图层要素"</span><span class="hljs-string">""</span># feature = shpLayer.GetNextFeature()# 根据FId获取指定要素feature1 = shpLayer.GetFeature(<span class="hljs-number">0</span>)<span class="hljs-built_in">print</span>(f<span class="hljs-string">"n面状要素~~~~~Id：{feature1.GetField('Id')}n"</span>)# 获取要素IdfeatId1 = feature1.GetField(<span class="hljs-string">"Id"</span>)# 获取几何要素geom1 = feature1.GetGeometryRef()# <span class="hljs-built_in">print</span>(f<span class="hljs-string">"面状几何：{geom1}"</span>)<span class="hljs-string">""</span><span class="hljs-string">"    获取第二个要素"</span><span class="hljs-string">""</span>feature2 = shpLayer.GetFeature(<span class="hljs-number">1</span>)geom2 = feature2.GetGeometryRef()featId2 = feature2.GetField(<span class="hljs-string">"Id"</span>)
</code></pre>
<h2 data-id="heading-4">3. 空间叠加</h2>
<p><code>Geometry</code>对象上具有一个方法<code>Intersection</code>用于空间叠加操作，该方法接收另一个几何对象，并返回一个新的<code>Geometry</code>对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    空间操作之【叠加】"""</span>resultGeom = geom1.Intersection(geom2)<span class="hljs-comment"># print(f"面要素【{featId1}】与 面要素【{featId2}】相交结果：{resultGeom}")</span>
</code></pre>
<p>如下面0和面1相交结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d619ddfbcda40b5ab01557eb23d3e03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=B5UbEDIDlw02JRX9e8BFfr2hH20%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">4. 空间缓冲</h2>
<p><code>Geometry</code>对象上具有一个方法<code>Buffer</code>用于空间缓冲区生成，该方法接收另一个几何对象，并返回一个新的<code>Geometry</code>对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    空间操作之【缓冲】"""</span>resultGeom = geom1.Buffer(<span class="hljs-number">1</span>)<span class="hljs-comment"># print(f"面要素【{featId1}】缓冲结果：{resultGeom}")</span>
</code></pre>
<p>如下面0缓冲结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eb05561a414420eb2c175f0c095996b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=GP7XuRjGDG90TirqHtK5LKEW2bg%3D" alt="" loading="lazy"/></p>
<p>如下线段缓冲结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/159214a6f1ab4ada9cb8cfa4ea460a5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=bquL9YUDQH6qRD50v%2BF1BraUmjo%3D" alt="" loading="lazy"/></p>
<p>如下点缓冲结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b39a30c67ebc4c00b98428c9a7d3e6d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=itnwOfIeftwgpOZEiA7QML%2FxueM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">5. 空间联合</h2>
<p><code>Geometry</code>对象上具有一个方法<code>Union</code>用于合并几何对象，该方法接收另一个几何对象，并返回一个新的<code>Geometry</code>对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    空间操作之【联合】"""</span>resultGeom = geom1.<span class="hljs-type">Union</span>(geom2)<span class="hljs-comment"># print(f"面要素【{featId1}】联合结果：{resultGeom}")</span>
</code></pre>
<p>如下面0和面1联合结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6c12332463c4924831aa4cb51d92545~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=QIRtnMa3eycbAuknLlH8%2B5703yc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">6. 空间求差</h2>
<p><code>Geometry</code>对象上具有一个方法<code>Difference</code>用于求取目标几何对象差集，该方法接收另一个几何对象，并返回一个新的<code>Geometry</code>对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    空间操作之【求差】"""</span>resultGeom = geom1.Difference(geom2)<span class="hljs-comment"># print(f"面要素【{featId1}】联合结果：{resultGeom}")</span>
</code></pre>
<p>如下面0和面1求差结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfb4347595ca40d7bda087cb5a248a44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=2vIKI0zhMalaCisV%2Bky%2FEfLkB8Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">7. 对称差集</h2>
<p><code>Geometry</code>对象上具有一个方法<code>SymmetricDifference</code>用于几何对象交集取反操作，该方法接收另一个几何对象，并返回一个新的<code>Geometry</code>对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    空间操作之【求对称差集】"""</span>resultGeom = geom1.SymmetricDifference(geom2)<span class="hljs-built_in">print</span>(<span class="hljs-string">f"面要素【<span class="hljs-subst">{featId1}</span>】联合结果：<span class="hljs-subst">{resultGeom}</span>"</span>)
</code></pre>
<p>如下面0和面1求对称差集结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/338b1c838355433885d47b7d8ec89cb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=Y0AuvimPbfrWicKaqHb3HalSQsw%3D" alt="" loading="lazy"/></p>
<p>还有一些几何操作，如求等、求距离等内容本教程并未涉及，留给感兴趣的读者自行实践。</p>
<h2 data-id="heading-9">8. 创建新图层</h2>
<p>几何运算完成之后，需要将分析结果保存到新的Shp图层。通过数据驱动方法<code>CreateDataSource</code>创建<code>Shp</code>数据源，再使用数据源方法<code>CreateLayer</code>创建图层即可。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    创建新图层"""</span>targetDs = shpDriver.CreateDataSource(resultPath)targetLayer = targetDs.CreateLayer(<span class="hljs-string">"result_layer"</span>,srs,ogr.wkbPolygon)featureDefn = shpLayer.GetLayerDefn()tarFeat = ogr.Feature(featureDefn)fieldCount = featureDefn.GetFieldCount()tarFeat.SetGeometry(resultGeom)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fieldCount):    fieldDefn = featureDefn.GetFieldDefn(i)    name = fieldDefn.GetName()    value = feature1.GetField(i)    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"字段名称：<span class="hljs-subst">{name}</span>，字段值：<span class="hljs-subst">{value}</span>"</span>)    <span class="hljs-comment"># tarFeat.SetField(i,value)    tarFeat.SetField(name,value)targetLayer.CreateFeature(tarFeat)</span>
</code></pre>
<h2 data-id="heading-10">9. 注意事项</h2>
<p>在<code>windows</code>开发环境中同时安装<code>GDAL</code>与<code>PostGIS</code>，其中投影库<code>PROJ</code>的环境变量指向<code>PostGIS</code>的安装路径，在运行GDAL程序时，涉及到要素、几何与投影操作时会导致异常。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/148dec8809004a7f82878a7cb92dce35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=wYkNfSx%2FymT3ZpqRPyJvwt3xznQ%3D" alt="" loading="lazy"/>具体意思为<code>GDAL</code>不支持<code>PostGIS</code>插件中的投影库版本，需要更换投影库或者升级版本。</p>
<p><code>RuntimeError: PROJ: proj_identify: D:Program FilesPostgreSQL13sharecontribpostgis-3.5projproj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.</code><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdac5e5380141dea1389f3bd6cc5943~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=rSr9R6m1P%2Fw0%2FE13l7Z2bZYjY1E%3D" alt="" loading="lazy"/></p>
<p>解决办法为修改<code>PROJ</code>的环境变量到<code>GDAL</code>支持的版本或者在<code>GDAL</code>程序开头添加以下代码：</p>
<pre><code class="hljs language-python" lang="python">os.environ[<span class="hljs-string">'PROJ_LIB'</span>] = <span class="hljs-string">r'D:\Programs\Python\Python311\Libsite-packages\osgeo\data\proj'</span>
</code></pre>
<p><strong>视频效果</strong></p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247488572%26idx%3D1%26sn%3D603105f8b81f906457b8ea337e1b0fc8%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247488572&amp;idx=1&amp;sn=603105f8b81f906457b8ea337e1b0fc8&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GDAL 实现空间分析操作</a></strong></p>
<p><strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc9ccc6dca604c8392c9ec0d62cd0867~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=bG3Rr2gBEnfVPCXxSXLW7ksBC2g%3D" alt="" loading="lazy"/></strong></p>
<blockquote>
<p>❝</p>
<p>OpenLayers示例数据下载，请在公众号后台回复：<strong>ol数据</strong></p>
<p>全国信息化工程师－GIS 应用水平考试资料，请在公众号后台回复：<strong>GIS考试</strong></p>
</blockquote>
<blockquote>
<p>❝</p>
<p><em><strong>GIS之路</strong></em> 公众号已经接入了<strong>智能</strong> <strong>助手</strong>，可以在对话框进行提问，也可以直接搜索历史文章进行查看。</p>
</blockquote>
<p>都看到这了，不要忘记<em><strong>点赞、收藏</strong></em> <strong>+</strong> <em><strong>关注</strong></em> 哦 <strong>！</strong></p>
<p>本号不定时更新有关 <em><strong>GIS开发</strong></em> 相关内容，<em><strong>欢迎关注 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/552828aca9ae4df692fa55f644156d58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=vO62dYay0T9roF5ciVtHNqZqTJw%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf2e562008794b31ab08c6e96ca264bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=OZuuQgLCxbCNqdsaeDlU%2BkwxXrk%3D" alt="" loading="lazy"/></strong></em></p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51655673d28b4719a4149fa8be980a66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=u2sgFAOuodmJgzwMiZIdnNsynlw%3D" alt="" loading="lazy"/></p>
<p>   <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31b07311d2364df8833c4b632ee43b09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=ZJEzCpfE6%2FEs%2BHVS%2Fa2GCQfEzBM%3D" alt="" loading="lazy"/> </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487953%26idx%3D1%26sn%3D0b2d5aeefdb290583cf8cdd82f3c2077%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487953&amp;idx=1&amp;sn=0b2d5aeefdb290583cf8cdd82f3c2077&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GeoTools 开发合集（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487119%26idx%3D1%26sn%3Dc313efa84c27bf933ef2f2a47991ef2d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487119&amp;idx=1&amp;sn=c313efa84c27bf933ef2f2a47991ef2d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">OpenLayers 开发合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Ffkf6VAObpTjPutJplco7wA" target="_blank" title="https://mp.weixin.qq.com/s/fkf6VAObpTjPutJplco7wA" ref="nofollow noopener noreferrer">GDAL 实现空间分析操作</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F_DVIdV5_bBPn3zVzUSoZ0w" target="_blank" title="https://mp.weixin.qq.com/s/_DVIdV5_bBPn3zVzUSoZ0w" ref="nofollow noopener noreferrer">GDAL 空间关系解析</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Ff1GPy_DNqtvEDzojlRmcBg" target="_blank" title="https://mp.weixin.qq.com/s/f1GPy_DNqtvEDzojlRmcBg" ref="nofollow noopener noreferrer">GDAL 实现数据空间查询</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FEyUADPYCf7O_9b0u8LUQCg" target="_blank" title="https://mp.weixin.qq.com/s/EyUADPYCf7O_9b0u8LUQCg" ref="nofollow noopener noreferrer">GDAL 实现数据属性查询</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FRdlldTRZ6c7FzfjBSdSPMg" target="_blank" title="https://mp.weixin.qq.com/s/RdlldTRZ6c7FzfjBSdSPMg" ref="nofollow noopener noreferrer">GDAL 实现创建几何对象</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FTUdUHgYra6oMlOaRIL1m4w" target="_blank" title="https://mp.weixin.qq.com/s/TUdUHgYra6oMlOaRIL1m4w" ref="nofollow noopener noreferrer">GDAL 实现自定义数据坐标系</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPGxwhRbuiRUKIpT2D2cVGQ" target="_blank" title="https://mp.weixin.qq.com/s/PGxwhRbuiRUKIpT2D2cVGQ" ref="nofollow noopener noreferrer">GDAL 实现矢量数据读写</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fi77nCatd4V2nuybZFIs-xA" target="_blank" title="https://mp.weixin.qq.com/s/i77nCatd4V2nuybZFIs-xA" ref="nofollow noopener noreferrer">GDAL 数据类型大全</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0DGoC0oFHizJbweBnEvI-g" target="_blank" title="https://mp.weixin.qq.com/s/0DGoC0oFHizJbweBnEvI-g" ref="nofollow noopener noreferrer">GDAL 实现 GIS 数据读取转换（全）</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码高亮、数学公式、流程图... Astro 博客进阶全指南]]></title>    <link>https://juejin.cn/post/7592990758476857363</link>    <guid>https://juejin.cn/post/7592990758476857363</guid>    <pubDate>2026-01-09T14:25:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592990758476857363" data-draft-id="7592990758476824595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码高亮、数学公式、流程图... Astro 博客进阶全指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-09T14:25:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术更好说"/> <meta itemprop="url" content="https://juejin.cn/user/2735240657517816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码高亮、数学公式、流程图... Astro 博客进阶全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2735240657517816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术更好说
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:25:36.000Z" title="Fri Jan 09 2026 14:25:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c265db806be4a5390aa23e84b3e7d4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5pu05aW96K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573536&amp;x-signature=He9qccJAXS%2FR%2BmjsJOhDq6Up58U%3D" alt="1.jpg" loading="lazy"/>
你刚用 Astro 搭好博客，开始写第一篇技术文章。想要高亮代码的某一行？不行。想加个可折叠的警告框提醒读者注意事项？做不到。想在算法讲解里加个数学公式？完全没思路。</p>
<p>我也遇到过这种尴尬。用纯 Markdown 写了几篇文章后发现，能表达的东西太有限了。看别人的技术博客，代码块可以标注重点、可以展示代码改动前后的对比，文章里还能嵌入交互式的组件,自己却只能干巴巴地贴代码。</p>
<p>好在 Astro 提供了 MDX 这个"增强版 Markdown"。说白了，MDX 让你在写文章的时候可以用组件、可以写 JSX，能做的事情一下子多了好几倍。</p>
<p>这篇文章我会分享 7 个 Astro Markdown/MDX 的进阶用法，从最基础的环境配置到代码高亮、自定义组件、数学公式、流程图，每个技巧都配了完整的代码和配置步骤。读完这篇，你的技术博客能从"能看"升级到"专业"。</p>
<h2 data-id="heading-0">第一部分：基础升级 - 从 Markdown 到 MDX</h2>
<h3 data-id="heading-1">为什么要用 MDX？</h3>
<p>Markdown 和 MDX 的区别，其实就像自行车和电动车——都能骑,但体验完全不同。</p>
<p>纯 Markdown 只能写文本、代码块、图片这些静态内容。你想加个提示框？得用 HTML 硬编码。想在文章里嵌入一个可交互的组件？基本没戏。</p>
<p>MDX 就不一样了，它是"Markdown + JSX"的结合体。你可以：</p>
<ul>
<li><strong>导入和使用组件</strong>：直接在 .mdx 文件里 import 任何 Astro 组件或 React/Vue 组件</li>
<li><strong>写 JSX 表达式</strong>：在文章里用 <code>{variable}</code> 插入变量，甚至写循环和条件判断</li>
<li><strong>自定义元素样式</strong>：把标准的 <code>&lt;h1&gt;</code> 替换成你自己的样式化组件</li>
</ul>
<p>举个具体例子。你想在文章里加个警告框，用纯 Markdown 得这样写：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"warning"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>注意：这个操作会删除所有数据！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>用 MDX 就能这样：</p>
<pre><code class="hljs language-mdx" lang="mdx">import Alert from '@/components/Alert.astro';

&lt;Alert type="warning"&gt;
  注意：这个操作会删除所有数据！
&lt;/Alert&gt;
</code></pre>
<p>看出区别了吗？MDX 让你的文章更像是在"组装积木"，而不是"写代码"。</p>
<h3 data-id="heading-2">5分钟配置 MDX 环境</h3>
<p>配置 MDX 其实超简单，三步搞定。</p>
<p><strong>第一步：安装集成包</strong></p>
<p>打开终端，在你的 Astro 项目里运行：</p>
<pre><code class="hljs language-bash" lang="bash">npx astro add mdx
</code></pre>
<p>Astro CLI 会自动帮你安装 <code>@astrojs/mdx</code> 并更新配置文件。这个命令会问你几个问题（要不要更新配置、要不要安装依赖），全部选 Yes 就行。</p>
<p><strong>第二步：验证配置</strong></p>
<p>装完后，打开 <code>astro.config.mjs</code>，应该能看到这样的代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro/config'</span>;
<span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">'@astrojs/mdx'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">mdx</span>()],
});
</code></pre>
<p>如果没有自动添加，手动加上就行。</p>
<p><strong>第三步：测试 MDX 是否生效</strong></p>
<p>在 <code>src/pages/</code> 或 <code>src/content/</code> 目录下创建一个 <code>test.mdx</code> 文件：</p>
<pre><code class="hljs language-mdx" lang="mdx">
---

title: 测试MDX

---

# 这是 MDX 测试

普通的 Markdown 文本。

export const greeting = "你好";

现在可以用变量了：{greeting}！

&lt;div style="padding: 1rem; background: #f0f0f0;"&gt;
  这是一个 JSX 元素
&lt;/div&gt;
</code></pre>
<p>运行 <code>npm run dev</code>，访问对应页面，如果能看到变量和 JSX 元素正常显示，说明 MDX 已经配置成功了。</p>
<p><strong>关于 .md 和 .mdx 文件的共存</strong></p>
<p>装了 MDX 集成后，你的 <code>.md</code> 文件还是正常工作的，不用担心。Astro 会根据文件扩展名自动选择处理方式：</p>
<ul>
<li><code>.md</code> 文件：按标准 Markdown 处理</li>
<li><code>.mdx</code> 文件：按 MDX 处理，支持组件和 JSX</li>
</ul>
<p>我的建议是：普通文章用 <code>.md</code>，需要用组件的文章用 <code>.mdx</code>。不是所有文章都需要 MDX 的能力。</p>
<h2 data-id="heading-3">第二部分：代码高亮的进阶技巧</h2>
<h3 data-id="heading-4">配置代码高亮主题（Shiki）</h3>
<p>Astro 默认用 Shiki 做代码高亮，这已经很不错了。但默认主题是 <code>github-dark</code>，你可能想换个更符合自己博客风格的。</p>
<p><strong>Shiki vs Prism 该选哪个？</strong></p>
<p>老实讲，我推荐 Shiki。它是 Astro 默认的方案，支持 100 多种编程语言和主题，而且是服务端渲染的，不需要加载额外的 JavaScript。Prism 也不错，但需要引入 CSS 文件，配置相对麻烦一点。</p>
<p><strong>切换内置主题</strong></p>
<p>打开 <code>astro.config.mjs</code>，在 <code>markdown</code> 配置里加上 <code>shikiConfig</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro/config'</span>;
<span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">'@astrojs/mdx'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">mdx</span>()],
  <span class="hljs-attr">markdown</span>: {
    <span class="hljs-attr">shikiConfig</span>: {
      <span class="hljs-attr">theme</span>: <span class="hljs-string">'dracula'</span>, <span class="hljs-comment">// 可选：github-dark, nord, monokai, dracula 等</span>
    },
  },
});
</code></pre>
<p>Shiki 支持超多主题，我常用的有：</p>
<ul>
<li><code>github-dark</code> / <code>github-light</code> - GitHub 风格</li>
<li><code>dracula</code> - 经典的紫黑配色</li>
<li><code>nord</code> - 清冷的北欧风</li>
<li><code>one-dark-pro</code> - VSCode 默认深色主题</li>
</ul>
<p>你可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fshiki.style%2Fthemes" target="_blank" title="https://shiki.style/themes" ref="nofollow noopener noreferrer">Shiki 主题预览</a> 里挑一个自己喜欢的。</p>
<p><strong>实现浅色/深色双主题切换</strong></p>
<p>如果你的博客支持深浅色模式切换，Shiki 可以配置双主题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">markdown</span>: {
  <span class="hljs-attr">shikiConfig</span>: {
    <span class="hljs-attr">themes</span>: {
      <span class="hljs-attr">light</span>: <span class="hljs-string">'github-light'</span>,
      <span class="hljs-attr">dark</span>: <span class="hljs-string">'github-dark'</span>,
    },
  },
},
</code></pre>
<p>这样配置后，Shiki 会根据 CSS 的 <code>prefers-color-scheme</code> 或你自定义的主题切换逻辑自动应用对应的代码高亮主题。</p>
<h3 data-id="heading-5">高亮特定行和代码注释</h3>
<p>写教程的时候，经常需要标注"看这一行很重要"或者展示"代码改了哪些地方"。Shiki Transformers 可以实现这些功能。</p>
<p><strong>高亮重点代码行</strong></p>
<p>先安装 Shiki 的 transformers：</p>
<pre><code class="hljs language-bash" lang="bash">npm install shiki
</code></pre>
<p>然后在配置里启用 <code>transformerNotationHighlight</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro/config'</span>;
<span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">'@astrojs/mdx'</span>;
<span class="hljs-keyword">import</span> { transformerNotationHighlight } <span class="hljs-keyword">from</span> <span class="hljs-string">'@shikijs/transformers'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">mdx</span>()],
  <span class="hljs-attr">markdown</span>: {
    <span class="hljs-attr">shikiConfig</span>: {
      <span class="hljs-attr">theme</span>: <span class="hljs-string">'github-dark'</span>,
      <span class="hljs-attr">transformers</span>: [<span class="hljs-title function_">transformerNotationHighlight</span>()],
    },
  },
});
</code></pre>
<p>现在可以在代码块里用 <code>// [!code highlight]</code> 注释来标记需要高亮的行：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```javascript
function hello() {
  console.log('这行是普通的');
  console.log('这行会高亮显示'); // [!code highlight]
}
```</span>
</code></pre>
<p><strong>展示代码变更（Diff 风格）</strong></p>
<p>在对比"修改前/后"的代码时，可以用 <code>transformerNotationDiff</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { transformerNotationDiff, transformerNotationHighlight } <span class="hljs-keyword">from</span> <span class="hljs-string">'@shikijs/transformers'</span>;

<span class="hljs-attr">markdown</span>: {
  <span class="hljs-attr">shikiConfig</span>: {
    <span class="hljs-attr">theme</span>: <span class="hljs-string">'github-dark'</span>,
    <span class="hljs-attr">transformers</span>: [
      <span class="hljs-title function_">transformerNotationHighlight</span>(),
      <span class="hljs-title function_">transformerNotationDiff</span>(),
    ],
  },
},
</code></pre>
<p>用法：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```javascript
function calculate(a, b) {
  return a + b; // [!code --]
  return a * b; // [!code ++]
}
```</span>
</code></pre>
<p>带 <code>--</code> 的行会显示为红色（删除），带 <code>++</code> 的行显示为绿色（新增）。这个功能写代码教程时超级实用。</p>
<p><strong>聚焦特定代码</strong></p>
<p>还有一个 <code>transformerNotationFocus</code>，可以让其他代码"变灰"，只突出你想强调的部分：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { transformerNotationFocus } <span class="hljs-keyword">from</span> <span class="hljs-string">'@shikijs/transformers'</span>;

<span class="hljs-comment">// 添加到 transformers 数组</span>
<span class="hljs-attr">transformers</span>: [
  <span class="hljs-title function_">transformerNotationFocus</span>(),
],
</code></pre>
<p>使用 <code>// [!code focus]</code> 标记：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```javascript
function process() {
  console.log('这行会变灰');
  console.log('这行正常显示'); // [!code focus]
  console.log('这行也变灰');
}
```</span>
</code></pre>
<h3 data-id="heading-6">升级到 Expressive Code（可选）</h3>
<p>如果你觉得 Shiki 的功能还不够，可以试试 Expressive Code。它是社区开发的增强版代码展示方案，提供了更多开箱即用的功能：</p>
<ul>
<li>代码块标题</li>
<li>一键复制按钮</li>
<li>行号显示</li>
<li>终端窗口样式</li>
<li>代码对比（Side-by-Side）</li>
</ul>
<p><strong>安装超简单</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx astro add astro-expressive-code
</code></pre>
<p>Astro CLI 会自动配置好一切。装完后，你的代码块就自动带上这些功能了，不需要额外配置。</p>
<p><strong>什么时候用 Expressive Code？</strong></p>
<p>说实话，我一开始用的是默认的 Shiki，后来发现读者经常想复制代码，就换成了 Expressive Code。如果你的博客主要是写教程、分享代码，Expressive Code 能让读者体验好很多。</p>
<p>但如果只是偶尔放点代码，用 Shiki + Transformers 就够了，不用增加额外的依赖。</p>
<h2 data-id="heading-7">第三部分：嵌入自定义组件</h2>
<h3 data-id="heading-8">在 MDX 中导入和使用组件</h3>
<p>MDX 最强大的地方就是可以直接在文章里用组件。我经常用这个功能做提示框、代码对比、可折叠区域等。</p>
<p><strong>创建一个警告框组件</strong></p>
<p>先在 <code>src/components/</code> 目录下创建一个 <code>Alert.astro</code>：</p>
<pre><code class="hljs language-astro" lang="astro">
---

interface Props {
  type?: 'info' | 'warning' | 'error';
}

const { type = 'info' } = Astro.props;

const styles = {
  info: 'bg-blue-50 border-blue-200 text-blue-800',
  warning: 'bg-yellow-50 border-yellow-200 text-yellow-800',
  error: 'bg-red-50 border-red-200 text-red-800',
};

---

&lt;div class={`border-l-4 p-4 ${styles[type]}`}&gt;
  &lt;slot /&gt;
&lt;/div&gt;
</code></pre>
<p><strong>在 MDX 文章中使用</strong></p>
<p>在你的 <code>.mdx</code> 文件里导入并使用它：</p>
<pre><code class="hljs language-mdx" lang="mdx">
---

title: 我的技术文章

---

import Alert from '@/components/Alert.astro';

# 文章标题

这是普通的文章内容。

&lt;Alert type="warning"&gt;
  注意：运行这个命令前请备份数据！
&lt;/Alert&gt;

&lt;Alert type="info"&gt;
  提示：你也可以在组件里用 **Markdown 语法**，很方便。
&lt;/Alert&gt;
</code></pre>
<p>看到了吗？在 <code>&lt;Alert&gt;</code> 组件里，你还可以继续用 Markdown 语法（如加粗、链接等），MDX 会自动处理。</p>
<p><strong>使用 React/Vue 组件</strong></p>
<p>MDX 不仅支持 Astro 组件，也可以用 React、Vue 等框架组件。不过要注意加上 <code>client:</code> 指令：</p>
<pre><code class="hljs language-mdx" lang="mdx">import Counter from '@/components/Counter.tsx';

&lt;Counter client:load initialCount={0} /&gt;
</code></pre>
<p><code>client:load</code> 表示这个组件会在页面加载时在客户端运行。如果不加，组件只会服务端渲染，交互功能不生效。</p>
<p><strong>组件文件组织建议</strong></p>
<p>我习惯把文章里常用的组件放在 <code>src/components/mdx/</code> 目录下，这样好管理：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">src</span>/
├── components/
│   ├── mdx/
│   │   ├── Alert<span class="hljs-selector-class">.astro</span>
│   │   ├── CodeCompare<span class="hljs-selector-class">.astro</span>
│   │   ├── Callout<span class="hljs-selector-class">.astro</span>
│   │   └── Tabs<span class="hljs-selector-class">.astro</span>
│   └── ...其他组件
</code></pre>
<h3 data-id="heading-9">映射 Markdown 语法到自定义组件</h3>
<p>这个功能有点"黑魔法"的感觉——你可以把 Markdown 的标准元素（如 h1、a、img）替换成你自己的组件。</p>
<p><strong>为什么要这么做？</strong></p>
<p>比如你想给所有的标题加个锚点图标，或者给外部链接自动加个"↗"标记，手动一个个加太麻烦了。用组件映射，写标准 Markdown 就自动应用你的样式。</p>
<p><strong>实战：自定义标题组件</strong></p>
<p>先创建一个 <code>CustomHeading.astro</code>：</p>
<pre><code class="hljs language-astro" lang="astro">
---

interface Props {
  level: 1 | 2 | 3 | 4 | 5 | 6;
  id?: string;
}

const { level, id } = Astro.props;
const Tag = `h${level}` as any;

---

&lt;Tag id={id} class="group relative"&gt;
  &lt;slot /&gt;
  {id &amp;&amp; (
    &lt;a href={`#${id}`} class="ml-2 opacity-0 group-hover:opacity-100 transition-opacity"&gt;
      #
    &lt;/a&gt;
  )}
&lt;/Tag&gt;
</code></pre>
<p><strong>在 MDX 中使用映射</strong></p>
<p>在你的 <code>.mdx</code> 文件里，导出一个 <code>components</code> 对象：</p>
<pre><code class="hljs language-mdx" lang="mdx">
---

title: 文章标题

---

import CustomHeading from '@/components/CustomHeading.astro';

export const components = {
  h2: (props) =&gt; &lt;CustomHeading level={2} {...props} /&gt;,
  h3: (props) =&gt; &lt;CustomHeading level={3} {...props} /&gt;,
};

## 这是二级标题

鼠标悬停在标题上，会出现 # 锚点链接。

### 这是三级标题

所有 h2 和 h3 都自动应用了自定义样式。
</code></pre>
<p><strong>实战：给外部链接加图标</strong></p>
<p>创建 <code>ExternalLink.astro</code>：</p>
<pre><code class="hljs language-astro" lang="astro">
---

interface Props {
  href?: string;
}

const { href } = Astro.props;
const isExternal = href?.startsWith('http');

---

&lt;a href={href} target={isExternal ? '_blank' : undefined} rel={isExternal ? 'noopener noreferrer' : undefined}&gt;
  &lt;slot /&gt;
  {isExternal &amp;&amp; &lt;span class="ml-1 text-xs"&gt;↗&lt;/span&gt;}
&lt;/a&gt;
</code></pre>
<p>映射使用：</p>
<pre><code class="hljs language-mdx" lang="mdx">import ExternalLink from '@/components/ExternalLink.astro';

export const components = {
  a: ExternalLink,
};

[这是内部链接](/about)
[这是外部链接](https://example.com) ← 会自动加 ↗ 图标
</code></pre>
<p><strong>全局配置映射（高级）</strong></p>
<p>如果你想让所有 MDX 文件都用同一套组件映射，可以在 <code>astro.config.mjs</code> 里配置。不过这个需要自定义 MDX 插件，稍微复杂一点，我一般是在单个文件里配置就够了。</p>
<h2 data-id="heading-10">第四部分：数学公式和图表集成</h2>
<h3 data-id="heading-11">集成 KaTeX 展示数学公式</h3>
<p>如果你写算法、数学或数据科学类的文章，肯定需要展示公式。KaTeX 是目前最好的选择，比 MathJax 快很多，而且支持服务端渲染。</p>
<p><strong>安装 KaTeX</strong></p>
<p>需要安装三个包：</p>
<pre><code class="hljs language-bash" lang="bash">npm install remark-math rehype-katex katex
</code></pre>
<ul>
<li><code>remark-math</code>：解析 LaTeX 语法</li>
<li><code>rehype-katex</code>：渲染公式为 HTML</li>
<li><code>katex</code>：KaTeX 核心库</li>
</ul>
<p><strong>配置 Astro</strong></p>
<p>打开 <code>astro.config.mjs</code>，添加这两个插件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro/config'</span>;
<span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">'@astrojs/mdx'</span>;
<span class="hljs-keyword">import</span> remarkMath <span class="hljs-keyword">from</span> <span class="hljs-string">'remark-math'</span>;
<span class="hljs-keyword">import</span> rehypeKatex <span class="hljs-keyword">from</span> <span class="hljs-string">'rehype-katex'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">mdx</span>()],
  <span class="hljs-attr">markdown</span>: {
    <span class="hljs-attr">remarkPlugins</span>: [remarkMath],
    <span class="hljs-attr">rehypePlugins</span>: [rehypeKatex],
  },
});
</code></pre>
<p><strong>引入 KaTeX 样式</strong></p>
<p>这一步很重要，不然公式渲染不出来。在你的布局文件（如 <code>src/layouts/MarkdownLayout.astro</code>）的 <code>&lt;head&gt;</code> 里加上：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span>
  <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>
  <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"</span>
  <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
/&gt;</span>
</code></pre>
<p><strong>在文章中使用公式</strong></p>
<p>配置好后，就可以在 Markdown/MDX 里写公式了。</p>
<p><strong>行内公式</strong>（用单个 <code>$</code> 包裹）：</p>
<pre><code class="hljs language-markdown" lang="markdown">质能方程：$E = mc^2$

二次方程的解：$x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$
</code></pre>
<p><strong>块级公式</strong>（用双 <code>$$</code> 包裹）：</p>
<pre><code class="hljs language-markdown" lang="markdown">$$
\int<span class="hljs-emphasis">_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$

$$
\sum_</span>{i=1}^{n} i = \frac{n(n+1)}{2}
$$
</code></pre>
<p><strong>常见问题：公式不显示</strong></p>
<p>如果公式不显示或样式不对，检查这几点：</p>
<ol>
<li>KaTeX CSS 是否正确引入（F12 看 Network 面板）</li>
<li>rehype-katex 的版本是否兼容（试试降到 6.x 版本）</li>
<li>公式语法是否正确（去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fkatex.org%2Fdocs%2Fsupported.html" target="_blank" title="https://katex.org/docs/supported.html" ref="nofollow noopener noreferrer">KaTeX 支持列表</a> 确认）</li>
</ol>
<h3 data-id="heading-12">集成 Mermaid 绘制流程图和图表</h3>
<p>Mermaid 可以用代码画流程图、时序图、甘特图等，特别适合技术文档。</p>
<p><strong>三种集成方案对比</strong></p>
<p>社区有几种 Mermaid 集成方案，我简单说说区别：</p>

































<table><thead><tr><th>方案</th><th>渲染方式</th><th>SEO</th><th>配置难度</th><th>推荐指数</th></tr></thead><tbody><tr><td>rehype-mermaid</td><td>服务端</td><td>好</td><td>中</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>astro-diagram</td><td>服务端</td><td>好</td><td>低</td><td>⭐⭐⭐⭐</td></tr><tr><td>astro-mermaid</td><td>客户端</td><td>差</td><td>低</td><td>⭐⭐⭐</td></tr></tbody></table>
<p>我推荐 <strong>rehype-mermaid</strong>，服务端渲染，SEO 友好，生成的是静态 SVG。</p>
<p><strong>安装 rehype-mermaid</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install rehype-mermaid
</code></pre>
<p><strong>配置</strong></p>
<p>在 <code>astro.config.mjs</code> 里添加：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro/config'</span>;
<span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">'@astrojs/mdx'</span>;
<span class="hljs-keyword">import</span> rehypeMermaid <span class="hljs-keyword">from</span> <span class="hljs-string">'rehype-mermaid'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">mdx</span>()],
  <span class="hljs-attr">markdown</span>: {
    <span class="hljs-attr">rehypePlugins</span>: [
      [rehypeMermaid, { <span class="hljs-attr">strategy</span>: <span class="hljs-string">'img-svg'</span> }]
    ],
  },
});
</code></pre>
<p><code>strategy: 'img-svg'</code> 表示生成 SVG 图片，这是最稳定的方案。</p>
<p><strong>在文章中画图</strong></p>
<p>用 <code>mermaid</code> 代码块就行：</p>
<p><strong>流程图示例</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```mermaid
graph TD
    A[开始] --&gt; B{是否安装MDX}
    B --&gt;|是| C[配置代码高亮]
    B --&gt;|否| D[安装MDX]
    D --&gt; C
    C --&gt; E[完成]
```</span>
</code></pre>
<p><strong>时序图示例</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```mermaid
sequenceDiagram
    用户-&gt;&gt;浏览器: 访问页面
    浏览器-&gt;&gt;服务器: 请求HTML
    服务器-&gt;&gt;浏览器: 返回渲染后的页面
    浏览器-&gt;&gt;用户: 显示内容
```</span>
</code></pre>
<p><strong>构建时生成</strong></p>
<p>运行 <code>npm run build</code> 时，Mermaid 图表会在构建阶段生成为 SVG，最终页面里是静态图片，加载速度快，也不需要客户端 JavaScript。</p>
<p><strong>注意事项</strong></p>
<p>如果构建时报错"找不到 Puppeteer"，可能需要额外配置。试试安装 playwright：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -D playwright
</code></pre>
<p>或者换用 astro-diagram 方案，它内置了浏览器环境。</p>
<h2 data-id="heading-13">第五部分：高级技巧和最佳实践</h2>
<h3 data-id="heading-14">Content Collections 的 MDX 优化</h3>
<p>如果你用 Astro 的 Content Collections 管理博客文章（强烈推荐），MDX 文件可以获得更好的类型支持和开发体验。</p>
<p><strong>Content Collections 是什么？</strong></p>
<p>简单说，就是把文章放在 <code>src/content/</code> 目录下，Astro 会自动识别、验证 frontmatter，并提供类型安全的 API 来读取内容。</p>
<p><strong>配置 Content Collections</strong></p>
<p>在 <code>src/content/config.ts</code> 定义你的集合：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineCollection, z } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro:content'</span>;

<span class="hljs-keyword">const</span> blog = <span class="hljs-title function_">defineCollection</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'content'</span>, <span class="hljs-comment">// 表示这是内容文件（Markdown/MDX）</span>
  <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({
    <span class="hljs-attr">title</span>: z.<span class="hljs-title function_">string</span>(),
    <span class="hljs-attr">description</span>: z.<span class="hljs-title function_">string</span>(),
    <span class="hljs-attr">pubDate</span>: z.<span class="hljs-title function_">date</span>(),
    <span class="hljs-attr">tags</span>: z.<span class="hljs-title function_">array</span>(z.<span class="hljs-title function_">string</span>()).<span class="hljs-title function_">optional</span>(),
    <span class="hljs-attr">draft</span>: z.<span class="hljs-title function_">boolean</span>().<span class="hljs-title function_">default</span>(<span class="hljs-literal">false</span>),
  }),
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> collections = { blog };
</code></pre>
<p><strong>在 MDX 中使用</strong></p>
<p>MDX 文件的 frontmatter 会被自动验证：</p>
<pre><code class="hljs language-mdx" lang="mdx">
---

title: Astro MDX 进阶教程
description: 学习 MDX 的高级用法
pubDate: 2025-12-02
tags: [Astro, MDX, 教程]

---

import Alert from '@/components/Alert.astro';

# {frontmatter.title}

&lt;Alert type="info"&gt;
  发布日期：{frontmatter.pubDate.toLocaleDateString()}
&lt;/Alert&gt;
</code></pre>
<p><strong>自动生成目录</strong></p>
<p>Content Collections 提供了 <code>getHeadings()</code> 方法，可以获取文章的所有标题，用来生成目录：</p>
<pre><code class="hljs language-astro" lang="astro">
---

import { getEntry } from 'astro:content';

const entry = await getEntry('blog', 'my-mdx-article');
const { Content, headings } = await entry.render();

---

&lt;aside&gt;
  &lt;h2&gt;目录&lt;/h2&gt;
  &lt;ul&gt;
    {headings.map(h =&gt; (
      &lt;li style={`margin-left: ${(h.depth - 1) * 1}rem`}&gt;
        &lt;a href={`#${h.slug}`}&gt;{h.text}&lt;/a&gt;
      &lt;/li&gt;
    ))}
  &lt;/ul&gt;
&lt;/aside&gt;

&lt;article&gt;
  &lt;Content /&gt;
&lt;/article&gt;
</code></pre>
<p>这个功能在写长文时特别实用，读者可以快速跳转到感兴趣的章节。</p>
<h3 data-id="heading-15">性能优化和常见陷阱</h3>
<p>MDX 很强大，但用不好也会拖慢网站。这里分享几个要注意的点。</p>
<p><strong>避免过度使用客户端组件</strong></p>
<p>MDX 里可以用 React/Vue 组件，但别忘了加 <code>client:*</code> 指令。如果不加，组件只会服务端渲染，交互功能不生效；如果滥用 <code>client:load</code>，会增加大量 JavaScript，拖慢页面加载。</p>
<p>我的建议：</p>
<ul>
<li>静态内容用 Astro 组件（如 Alert、Callout）</li>
<li>需要交互的用 <code>client:visible</code>（可见时才加载）或 <code>client:idle</code>（空闲时加载）</li>
<li>除非必要，不用 <code>client:load</code></li>
</ul>
<p><strong>图片优化</strong></p>
<p>在 MDX 里插入图片，别直接用 <code>&lt;img&gt;</code>，用 Astro 的 Image 组件：</p>
<pre><code class="hljs language-mdx" lang="mdx">
---

title: 我的文章

---

import { Image } from 'astro:assets';
import cover from './cover.jpg';

&lt;Image src={cover} alt="封面图" width={800} height={600} /&gt;
</code></pre>
<p>Astro 会自动优化图片（压缩、生成 WebP、懒加载等），性能好很多。</p>
<p><strong>MDX 的 optimize 选项</strong></p>
<p>如果你的站点有很多 MDX 文件，构建很慢，可以试试开启 <code>optimize</code> 选项：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [
    <span class="hljs-title function_">mdx</span>({
      <span class="hljs-attr">optimize</span>: <span class="hljs-literal">true</span>,
    }),
  ],
});
</code></pre>
<p>这个选项会通过内部的 rehype 插件优化 MDX 输出，加快构建速度。不过可能会改变生成的 HTML 结构，用之前先测试一下。</p>
<p><strong>常见错误和解决方案</strong></p>



































<table><thead><tr><th>错误</th><th>原因</th><th>解决方案</th></tr></thead><tbody><tr><td>MDX 组件不显示</td><td>忘了导入组件</td><td>检查 import 语句</td></tr><tr><td>交互组件不工作</td><td>缺少 client: 指令</td><td>加上 <code>client:load</code> 等</td></tr><tr><td>代码高亮不生效</td><td>Shiki 配置错误</td><td>检查 astro.config.mjs</td></tr><tr><td>数学公式不渲染</td><td>KaTeX CSS 未引入</td><td>在 layout 里加 CSS 链接</td></tr><tr><td>构建很慢</td><td>MDX 文件太多</td><td>开启 optimize 选项</td></tr></tbody></table>
<h2 data-id="heading-16">结论</h2>
<p>说了这么多，总结一下核心要点：</p>
<p><strong>快速回顾 7 个技巧</strong>：</p>
<ol>
<li><strong>配置 MDX 环境</strong> - 一行命令搞定，5分钟上手</li>
<li><strong>切换代码高亮主题</strong> - 用 Shiki 配置你喜欢的风格</li>
<li><strong>高亮和注释代码</strong> - 用 Transformers 标注重点、展示改动</li>
<li><strong>嵌入自定义组件</strong> - 让文章更生动，从 Alert 到交互式 Demo</li>
<li><strong>映射 Markdown 元素</strong> - 批量定制标题、链接等默认样式</li>
<li><strong>展示数学公式</strong> - KaTeX 让你的算法讲解更专业</li>
<li><strong>绘制流程图</strong> - Mermaid 用代码画图，服务端渲染</li>
</ol>
<p>现在就选一个最感兴趣的功能，在你的博客上试试吧。配置过程中遇到问题也别慌，官方文档和社区都很友好，搜一下基本都能找到答案。</p>
<p>话说回来，技术博客最重要的还是内容本身。这些工具只是让你的表达更清晰、更专业，真正吸引读者的，是你的观点和经验。祝你的 Astro 博客越来越好！</p>
<blockquote>
<p>原文首发<a href="https://link.juejin.cn?target=https%3A%2F%2Feastondev.com%2Fblog%2Fzh%2Fposts%2Fdev%2F20251202-astro-mdx-advanced-guide%2F" target="_blank" title="https://eastondev.com/blog/zh/posts/dev/20251202-astro-mdx-advanced-guide/" ref="nofollow noopener noreferrer">自个人博客</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app实现本地MQTT连接]]></title>    <link>https://juejin.cn/post/7593165280488931369</link>    <guid>https://juejin.cn/post/7593165280488931369</guid>    <pubDate>2026-01-09T14:27:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593165280488931369" data-draft-id="7593165280488865833" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app实现本地MQTT连接"/> <meta itemprop="keywords" content="前端,Trae"/> <meta itemprop="datePublished" content="2026-01-09T14:27:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="李剑一"/> <meta itemprop="url" content="https://juejin.cn/user/4147782344247918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app实现本地MQTT连接
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4147782344247918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    李剑一
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:27:23.000Z" title="Fri Jan 09 2026 14:27:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近接到安卓端的需求，要求使用MQTT连接实现设备信息的收发。</p>
<p>可能有兄弟不太清楚 <strong>MQTT协议</strong> 是什么，简单地说它是一种轻量级的、基于<strong>发布/订阅</strong>模式的消息传输协议，广泛用于物联网（IoT）领域。</p>
<p>常见的操作就是连接后有N个设备订阅了主题A，这时候任意一台设备对主题A发布了一条信息，则当前N个设备都能收到这条消息。</p>
<p>至于其他的也不用知道的太清楚，反正知道一般是这么玩的就行。</p>
<p>假如你想知道的更为详细，可以询问 <code>Trae</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8193f4914934c5b9c4d8096aac846ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2O5YmR5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573643&amp;x-signature=3lDmOEgK8hGFoRJoioo1g73ZWdQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">需求</h2>
<ol>
<li>实现MQTT连接</li>
<li>实现主题(Topic)订阅</li>
<li>能够发送消息</li>
<li>能够接收消息</li>
</ol>
<h2 data-id="heading-1">实现方案</h2>
<p>首先是安装 <code>mqtt.js</code> 插件和 <code>uuid.js</code> 插件。</p>
<pre><code class="hljs language-bash" lang="bash">npm i mqtt@3.0.0 uuid
</code></pre>
<p><strong>注意</strong>: 这里一定要安装 <code>mqtt v3.0</code> 版本，我之前装了一个 v5.x 版本，有比较大的 API 改动。项目上时间紧张，遂没有再尝试。（有兴趣的朋友可以考虑用最新版实现）</p>
<p><code>uuid</code> 只是起到生成 连接ID 和 消息ID 的作用，这里也可以直接使用时间戳的方式，但是为了保证不重复，这里便不再更换了。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// mqttClient.js 对 MQTT 的简单封装</span>
<span class="hljs-keyword">let</span> client = <span class="hljs-literal">null</span>;
<span class="hljs-comment">/**
 * 初始化 MQTT 连接
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">options</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} options.host - 服务器地址（不带协议）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} options.port - 端口（通常 WebSocket 是 8083、8084 或 443）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} options.clientId - 客户端 ID（建议唯一）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [options.username] - 用户名
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [options.password] - 密码
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">boolean</span>} [options.useWss=false] - 是否使用 wss（HTTPS）
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initMqtt</span>(<span class="hljs-params">options</span>) {
	<span class="hljs-keyword">const</span> {
		host,
		port,
		clientId,
		username = <span class="hljs-string">''</span>,
		password = <span class="hljs-string">''</span>,
		useWss = <span class="hljs-literal">false</span>
	} = options;

	<span class="hljs-comment">// 根据平台选择协议（App 和 H5 用 ws/wss，小程序用 wxs/wss）</span>
	<span class="hljs-keyword">let</span> protocol = <span class="hljs-string">'ws'</span>;
	<span class="hljs-keyword">if</span> (useWss) protocol = <span class="hljs-string">'wss'</span>;

	<span class="hljs-comment">// #ifdef MP-WEIXIN</span>
	protocol = useWss ? <span class="hljs-string">'wxs'</span> : <span class="hljs-string">'wxs'</span>;
	<span class="hljs-comment">// #endif</span>

	<span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${protocol}</span>://<span class="hljs-subst">${host}</span>:<span class="hljs-subst">${port}</span>/mqtt`</span>; <span class="hljs-comment">// 注意：路径可能是 / 或 /mqtt，根据你的 broker 配置</span>

	<span class="hljs-keyword">const</span> connectOptions = {
		<span class="hljs-attr">clientId</span>: clientId,
		<span class="hljs-attr">username</span>: username,
		<span class="hljs-attr">password</span>: password,
		<span class="hljs-attr">keepalive</span>: <span class="hljs-number">60</span>, <span class="hljs-comment">// 心跳间隔（秒）</span>
		<span class="hljs-attr">reconnectPeriod</span>: <span class="hljs-number">5000</span>, <span class="hljs-comment">// 自动重连间隔（毫秒）</span>
		<span class="hljs-attr">connectTimeout</span>: <span class="hljs-number">10000</span>, <span class="hljs-comment">// 连接超时</span>
		<span class="hljs-attr">clean</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 是否清除会话</span>
	};

	<span class="hljs-comment">// 引入 mqtt（必须用 min 版本，否则小程序报错）</span>
	<span class="hljs-keyword">const</span> mqtt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mqtt/dist/mqtt.min.js'</span>);

	client = mqtt.<span class="hljs-title function_">connect</span>(url, connectOptions);

	<span class="hljs-comment">// 监听连接事件</span>
	client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-function">() =&gt;</span> {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MQTT 连接成功'</span>);
	});

	client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'reconnect'</span>, <span class="hljs-function">() =&gt;</span> {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MQTT 正在重连...'</span>);
	});

	client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'MQTT 连接错误:'</span>, err);
	});

	client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">() =&gt;</span> {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MQTT 连接已关闭'</span>);
	});

	<span class="hljs-keyword">return</span> client;
}

<span class="hljs-comment">/**
 * 订阅主题
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">topic</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">callback</span> - (topic, message) =&gt; {}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">topic, callback</span>) {
	<span class="hljs-keyword">if</span> (!client) {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'MQTT 客户端未初始化'</span>);
		<span class="hljs-keyword">return</span>;
	}

	client.<span class="hljs-title function_">subscribe</span>(topic, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
		<span class="hljs-keyword">if</span> (!err) {
			<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`订阅主题成功: <span class="hljs-subst">${topic}</span>`</span>);
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'订阅失败:'</span>, err);
		}
	});

	<span class="hljs-comment">// 监听消息（全局监听，需配合 topic 过滤）</span>
	client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">receivedTopic, message</span>) =&gt;</span> {
		<span class="hljs-comment">// if (receivedTopic === topic) {</span>
			<span class="hljs-keyword">try</span> {
				<span class="hljs-comment">// 尝试解析 JSON</span>
				<span class="hljs-keyword">const</span> payload = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(message.<span class="hljs-title function_">toString</span>());
				<span class="hljs-title function_">callback</span>(receivedTopic, payload);
			} <span class="hljs-keyword">catch</span> (e) {
				<span class="hljs-comment">// 非 JSON 消息</span>
				<span class="hljs-title function_">callback</span>(receivedTopic, message.<span class="hljs-title function_">toString</span>());
			}
		<span class="hljs-comment">// }</span>
	});
}

<span class="hljs-comment">/**
 * 发布消息
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">topic</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string|object</span>} <span class="hljs-variable">message</span>
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">publish</span>(<span class="hljs-params">topic, message</span>) {
	<span class="hljs-keyword">if</span> (!client) {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'MQTT 客户端未初始化'</span>);
		<span class="hljs-keyword">return</span>;
	}

	<span class="hljs-keyword">const</span> payload = <span class="hljs-keyword">typeof</span> message === <span class="hljs-string">'object'</span> ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(message) : message;
	client.<span class="hljs-title function_">publish</span>(topic, payload, {
		<span class="hljs-attr">qos</span>: <span class="hljs-number">1</span>
	}, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
		<span class="hljs-keyword">if</span> (err) {
			<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'发布失败:'</span>, err);
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`发布成功: <span class="hljs-subst">${topic}</span>`</span>, payload);
		}
	});
}

<span class="hljs-comment">/**
 * 断开连接
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"/>) {
	<span class="hljs-keyword">if</span> (client) {
		client.<span class="hljs-title function_">end</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// true 表示强制断开</span>
		client = <span class="hljs-literal">null</span>;
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MQTT 已断开'</span>);
	}
}
</code></pre>
<p>我让 <strong>Trae</strong> 基于网上的封装简单进行了修改，生成了上述封装Js文件。</p>
<p><strong>注意</strong>：在<code>监听消息</code>的部分，如果你的 Topic 是固定的，则请将 <code>if (receivedTopic === topic)</code> 的<strong>注释打开</strong>，如果不是，则<strong>注释掉</strong>，后续有详解。</p>
<p>现在进入到 <code>page/index/index.vue</code> 文件中</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> {initMqtt, subscribe, publish, disconnect} <span class="hljs-keyword">from</span> <span class="hljs-string">'./mqttClient.js'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">host</span>: <span class="hljs-string">'broker.emqx.io'</span>,
            <span class="hljs-attr">messages</span>: []
        }
    },
    <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">connect</span>()
    },
    <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">disconnect</span>()
    },
    <span class="hljs-attr">methods</span>: {
        <span class="hljs-comment">// 连接</span>
        <span class="hljs-title function_">connect</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> uuid = <span class="hljs-title function_">uuidv4</span>();
            <span class="hljs-keyword">const</span> client = <span class="hljs-title function_">initMqtt</span>({
                <span class="hljs-attr">host</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">host</span>,
                <span class="hljs-attr">port</span>: <span class="hljs-number">8083</span>,
                <span class="hljs-attr">clientId</span>: uuid,
                <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">useWss</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 如果是 HTTPS/WSS，设为 true</span>
            });
            <span class="hljs-keyword">if</span> (client) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">subscribeTopic</span>();
            }
        },
        <span class="hljs-comment">// 订阅 test/topic 主题</span>
        <span class="hljs-title function_">subscribeTopic</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">subscribe</span>(<span class="hljs-string">'test/topic'</span>, <span class="hljs-function">(<span class="hljs-params">topic, message</span>) =&gt;</span> {
                <span class="hljs-comment">// 接收到的消息</span>
                <span class="hljs-keyword">const</span> msg = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(message);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">unshift</span>(msg);
            });
        },
        <span class="hljs-comment">// 订阅 带通配符 的主题</span>
        <span class="hljs-title function_">subscribeTopics</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">subscribe</span>(<span class="hljs-string">'+/topic'</span>, <span class="hljs-function">(<span class="hljs-params">topic, message</span>) =&gt;</span> {
                <span class="hljs-comment">// 接收到的消息</span>
                <span class="hljs-keyword">const</span> msg = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(message);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">unshift</span>(msg);
            });
        },
        <span class="hljs-comment">// 发送消息到 test/topic 主题</span>
        <span class="hljs-title function_">publishMessage</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">publish</span>(<span class="hljs-string">'test/topic'</span>, {
                <span class="hljs-attr">name</span>: <span class="hljs-string">'uni-app'</span>,
                <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
                <span class="hljs-attr">msg</span>: <span class="hljs-string">'测试信息'</span>
            });
        },
        <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">disconnect</span>();
        }
    }
}
</code></pre>
<p><strong>注意</strong>：在卸载页面的时候建议将 MQTT连接 断开，或者在 uni-app 中使用也可以使用 unload 方法断开连接。</p>
<p>另外订阅主题可以采用常规的，确定性的 <code>Topic</code> 主题名称，也可以采用 <code>通配符(+)</code> 的主题名称。</p>
<p><strong>Trae</strong>还提醒我一定要注意，假如你的 Topic 为：</p>
<p><code>123/456/report</code> 则你的通配符主题名称为 <code>+/+/report</code></p>
<p>假如你的 Topic 为：</p>
<p><code>/123/456/report</code> 则你的通配符主题名称为 <code>+/+/+/report</code>，因为他的第一位是 <strong>空字符串</strong>。</p>
<h2 data-id="heading-2">结论</h2>
<p>在开发 IoT 设备时这个协议用的比较广泛，如果不接触这个方面一般不会用上这个。</p>
<p>另外 MQTT 本身自带<code>心跳</code>和<code>自动重连</code>机制，大致上相当于 <code>WebSocket</code>，这个部分一般不需要做特殊开发。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【重磅福利】学生认证可免费领取 Gemini 3 Pro 一年]]></title>    <link>https://juejin.cn/post/7593338828195446824</link>    <guid>https://juejin.cn/post/7593338828195446824</guid>    <pubDate>2026-01-09T14:35:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195446824" data-draft-id="7593193235251396660" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【重磅福利】学生认证可免费领取 Gemini 3 Pro 一年 "/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-09T14:35:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大卫"/> <meta itemprop="url" content="https://juejin.cn/user/1961184474695213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【重磅福利】学生认证可免费领取 Gemini 3 Pro 一年 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1961184474695213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大卫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:35:54.000Z" title="Fri Jan 09 2026 14:35:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>谷歌正式发布最新一代推理模型 Gemini 3.0 Pro，并同步开放 API 接口及在 谷歌 AI Studio 推出预览版。这款模型一经发布，立刻横扫各大评测榜单，以“一夜封神”的姿态震撼了全球 AI 社群。</p>
<p>值得玩味的是，OpenAI 首席执行官奥特曼也隔空向谷歌发来“贺电”，在社交媒体上评价“Gemini 3 看起来很不错”，谷歌首席执行官皮查伊（Sundar Pichai）则以一个轻松的表情包回应，尽显王者风范。</p>
<p>Gemini 3.0 Pro 的强大并非空穴来风，其在关键的基准测试中实现了全面“碾压式”的领先：</p>
<p><strong>数学能力登顶全球：</strong> 在被誉为“地狱难度”的数学竞赛基准 MathArena 中，当 GPT-5.1 等其他顶级大模型仍在 1% 左右徘徊时，Gemini 3.0 Pro 的得分一举达到 <strong>23.4%</strong> ，毫无争议地成为当前全球数学能力最强的 AI。</p>
<h2 data-id="heading-1">重磅福利</h2>
<p>现在一年会员只要 <strong>29.9</strong> 元，帮您解决以下 4 大问题。</p>
<blockquote>
<p>⚠️注：优惠截止日期 2026年1月31日</p>
<p>如有问题可以联系V：zm_david。</p>
</blockquote>
<h2 data-id="heading-2">1. 出了点问题（Something went wrong）</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/228d3b26acee4cb0a60a7d1b40514c86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=FwqoEmTGrfzbyt7J09CcHSndlfs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b44ecadaba1b48cca89662ae802a29de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=pwcwTIc%2FPwlJUvIiHD0rgaSDr2A%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">2. 此账号无法订阅 Google AI 方案</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e3e2b44eed343e3b9b73e9b19001e46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=3iNaktoFMgp17ihOUw1uZu9hNe0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. 无法享受此优惠</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64f8c40de8054a4684fbed1304e96c21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=hX5x6DXtJ4ygmXzSruRwL7lJopM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0af1afa414f74c259acab6a7b0121e16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=vguhpjj9Aa0x0AN%2FHR%2F9xc4aHI0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">4. 没有 Visa 卡绑定</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0983335f6f548109905edf089f93f30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=i7%2BbFbh%2B9LL59ZGJHssYSysd%2Bqk%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose内部的不同节点类型]]></title>    <link>https://juejin.cn/post/7593164154632126473</link>    <guid>https://juejin.cn/post/7593164154632126473</guid>    <pubDate>2026-01-09T14:55:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593164154632126473" data-draft-id="7593175890794840110" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose内部的不同节点类型"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2026-01-09T14:55:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose内部的不同节点类型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:55:00.000Z" title="Fri Jan 09 2026 14:55:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「The Different Node Types in Jetpack Compose」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.grokkingandroid.com%2Fthe-different-node-types-in-jetpack-compose%2F" target="_blank" title="https://www.grokkingandroid.com/the-different-node-types-in-jetpack-compose/" ref="nofollow noopener noreferrer">www.grokkingandroid.com/the-differe…</a>，由Wolfram Rittmeyer发布于2025年12月30日。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a732fb91ad6842e5ac8ac107d3ad45a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768575299&amp;x-signature=MY8MC4m7UqcnVuXbWeLfU%2BG8XFg%3D" alt="预览图展示了 ComposeUiNode 的部分列表" loading="lazy"/></p>
<p>如果你仔细观察 Compose，你会发现它很奇怪。你会发现很多函数都没有返回值。然而，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fui%2Fcompose%2Fmental-model" target="_blank" title="https://developer.android.com/develop/ui/compose/mental-model" ref="nofollow noopener noreferrer">Android 文档</a>却说：</p>
<blockquote>
<p>可组合函数会生成 UI 层级结构。</p>
</blockquote>
<p>这到底是什么意思呢？从函数式编程的角度来看，你那些看似无害的无状态可组合函数实际上会产生大量的<em>副作用[1]</em>。其中就包括<em>创建节点[2]</em>。</p>
<p>有时你可能会创建一些可组合函数来自己创建节点。但更多时候，你会直接委托给其他可组合函数来创建节点。</p>
<p>那么，让我们来看看有哪些节点，它们的创建位置以及它们的用途：</p>
<ul>
<li>ComposeUiNode</li>
<li>LayoutNode</li>
<li>Modifier.Node</li>
<li>SemanticsNode</li>
</ul>
<h2 data-id="heading-0">ComposeUiNode</h2>
<p>当你深入研究<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2Flayout%2Fpackage-summary%23Layout(androidx.compose.ui.Modifier%2Candroidx.compose.ui.layout.MeasurePolicy)" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/layout/package-summary#Layout(androidx.compose.ui.Modifier,androidx.compose.ui.layout.MeasurePolicy)" ref="nofollow noopener noreferrer"><code>Layout</code></a>可组合对象时，你会发现它调用了<code>ReusableComposeNode[3]</code>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-meta">@UiComposable</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Layout</span><span class="hljs-params">(modifier: <span class="hljs-type">Modifier</span> = Modifier, measurePolicy: <span class="hljs-type">MeasurePolicy</span>)</span></span> {
    <span class="hljs-keyword">val</span> compositeKeyHash = currentCompositeKeyHash
    <span class="hljs-keyword">val</span> materialized = currentComposer.materialize(modifier)
    <span class="hljs-keyword">val</span> localMap = currentComposer.currentCompositionLocalMap
    ReusableComposeNode&lt;ComposeUiNode, Applier&gt;(
        factory = ComposeUiNode.Constructor,
        update = {
            <span class="hljs-keyword">set</span>(measurePolicy, SetMeasurePolicy)
            <span class="hljs-keyword">set</span>(localMap, SetResolvedCompositionLocals)
            <span class="hljs-keyword">set</span>(materialized, SetModifier)
            <span class="hljs-keyword">set</span>(compositeKeyHash, SetCompositeKeyHash)
        },
    )
}
</code></pre>
<p><strong><code>ReusableComposeNode</code>本身并不是一个节点。</strong> 上面的代码中并没有构造函数调用，而是对另一个可组合对象的调用。第八行的工厂参数看似无关紧要，但实际上非常重要。因为最终会创建节点的就是这个函数。它会创建一个 <code>ComposeUiNode</code>。</p>
<p><code>ReusableComposeNode</code> Composable 与 Compose 运行时紧密相关。这段代码告诉 Composer 应该启动一个 <code>GroupKind.ReusableNode</code> 类型的新组，然后代码会创建一个新节点，或者在重新组合时重用现有节点。最后，当使用 update 函数参数时，它会设置节点的内容：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any, <span class="hljs-keyword">reified</span> E : Applier&gt;</span> <span class="hljs-title">ReusableComposeNode</span><span class="hljs-params">(
    <span class="hljs-keyword">noinline</span> factory: () -&gt; <span class="hljs-type">T</span>,
    update: @<span class="hljs-type">DisallowComposableCalls</span> <span class="hljs-type">Updater</span>.() -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    <span class="hljs-keyword">if</span> (currentComposer.applier !<span class="hljs-keyword">is</span> E) invalidApplier()
    currentComposer.startReusableNode()
    <span class="hljs-keyword">if</span> (currentComposer.inserting) {
        currentComposer.createNode(factory)
    } <span class="hljs-keyword">else</span> {
        currentComposer.useNode()
    }
    Updater(currentComposer).update()
    currentComposer.endNode()
}
</code></pre>
<p>我们看到工厂被传递给了 <code>createNode()</code> 调用。此调用会安排在所有插入操作处理完毕后创建节点。Compose 运行时内部会延迟执行许多操作以实现优化。这里我们并不关心具体何时发生，只需知道它_将会_发生即可。当它发生时，工厂将被调用。</p>
<p>现在让我们更仔细地看一下工厂本身：<code>ComposeUiNode.Constructor</code> 看起来像是 <code>ComposeUiNode</code> 的构造函数。但事实并非如此。实际上，<code>ComposeUiNode</code> 是一个接口，它本身并不执行任何操作。它实际上是 <code>LayoutNode</code> 使用的基接口。至于这个接口和构造函数的用途，在接口声明上方的注释中已经给出：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/** Interface extracted from LayoutNode to not mark the whole LayoutNode class as <span class="hljs-doctag">@PublishedApi</span>. */</span>
<span class="hljs-meta">@PublishedApi</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComposeUiNode</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">/** Object of pre-allocated lambdas used to make use with ComposeNode allocation-less. */</span>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">val</span> Constructor: () -&gt; ComposeUiNode = LayoutNode.Constructor
        <span class="hljs-keyword">val</span> VirtualConstructor: () -&gt; ComposeUiNode = { LayoutNode(isVirtual = <span class="hljs-literal">true</span>) }
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p><strong>所以 <code>ComposeUiNode</code> 只是 <code>LayoutNode</code> 的一个抽象。</strong></p>
<h2 data-id="heading-1">布局节点（LayoutNode）</h2>
<p>在上一节中，我们已经了解了 <code>LayoutNode</code> 的实际创建时间。基本上，每当调用 <code>Layout</code> 可组合组件时，都会创建 <code>LayoutNode</code>。<code>LayoutNode</code> 是树状结构中的元素，代表屏幕上的内容。它需要被测量，可以在其边界内放置子元素，也可以绘制内容。</p>
<p>每个 <code>LayoutNode</code> 都知道它的子元素和父元素。因此，<code>LayoutNode</code> 构成了一个节点树，代表了已发出的内容。需要明确的是：Compose 创建的树状结构与其他 UI 框架一样——但 Google 更倾向于使用一些更高级的命名方式。<strong>因此，每当你听到/读到有关可组合组件发出内容时，请将其理解为一个 LayoutNode 被创建并插入到树中。</strong></p>
<p><code>LayoutNode</code> 类实际上非常有趣，因此值得单独撰写一篇博文，我将在其中更详细地介绍它的一些方面。</p>
<p>这里有两点值得一提：</p>
<ul>
<li><code>Applier</code> 是调用 <code>LayoutNode</code> 相应树状结构处理方法的实例。 - <code>LayoutNode</code> 持有对 <code>Owner</code> 的引用。</li>
</ul>
<p>由于 <code>Applier</code> 和 <code>Owner</code> 在 Compose 中都是非常重要的概念，我将在单独的博文中分别介绍它们。</p>
<h3 data-id="heading-2">LayoutNode 的用途</h3>
<p><code>LayoutNode</code> 构成 UI 树，并跟踪其父节点和子节点。UI 树本身的管理由 <code>Applier</code> 完成，我将在另一篇文章中介绍它。</p>
<p>另外，需要记住的一点是，<code>LayoutNode</code> 存储在 <code>SlotTable[4]</code> 中。因此，在重新组合时，如果运行时认为树的这一部分不需要更改，则可以重用现有的 <code>LayoutNode</code>。</p>
<p><code>LayoutNode</code> 还会保存其修饰符（参见下一节），并委托这些修饰符来决定该 <code>LayoutNode</code> 需要多少空间（测量）、在屏幕上放置元素的位置（布局）以及最终在屏幕上显示什么内容（绘制）。</p>
<p>还有更多内容——但正如我提到的，那是另一篇文章的一部分。</p>
<h2 data-id="heading-3">Modifier.Node</h2>
<p>修饰符在内部由 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2FModifier.Node" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/Modifier.Node" ref="nofollow noopener noreferrer"><code>Modifier.Node</code></a> 对象表示。<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2FModifier.Node" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/Modifier.Node" ref="nofollow noopener noreferrer">根据文档</a>，它是“为应用于 androidx.compose.ui.layout.Layout 的每个 Modifier.Element 创建的生命周期更长的对象”。</p>
<p>这个“生命周期更长”很有意思。基本上，只要 <code>Modifier.Node</code> 属于 <code>LayoutNode</code> 的修饰符链，它就会一直存在。 <code>LayoutNode</code> 持有一个 <code>NodeChain</code> 类型的对象，该对象内部维护着一个修饰符列表，并检查该列表是否发生更改，以及 <code>Modifier.Node</code> 的生命周期方法（例如 <code>onAttach()</code>）是否被调用。</p>
<p><code>Modifier.Node</code> 有许多现有的子类型，例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2Fnode%2FLayoutModifierNode" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/node/LayoutModifierNode" ref="nofollow noopener noreferrer"><code>LayoutModifierNode</code></a>（见下文）或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2Fnode%2FDrawModifierNode%3Fhl%3Den" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/node/DrawModifierNode?hl=en" ref="nofollow noopener noreferrer"><code>DrawModifierNode</code></a>。后者负责实际在屏幕上绘制内容，我计划在另一篇文章中详细介绍。</p>
<p>由于 <code>LayoutNode</code> 是 <code>SlotTable</code> 的一部分，因此附加到 <code>LayoutNode</code> 的 <code>NodeChain</code> 对象的 <code>Modifier.Node</code> 显然也是 <code>SlotTable</code> 的一部分。</p>
<h3 data-id="heading-4">特殊子类型：<code>LayoutModifierNode</code></h3>
<p><code>LayoutModifierNode</code>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2Fnode%2FLayoutModifierNode%25EF%25BC%2589%25E6%2598%25AF%25E5%25AE%259E%25E9%2599%2585%25E8%25BF%259B%25E8%25A1%258C%25E6%25B5%258B%25E9%2587%258F%25E7%259A%2584%25E8%258A%2582%25E7%2582%25B9%25EF%25BC%258C%25E5%259B%25A0%25E4%25B8%25BA%25E5%25AE%2583%25E4%25BB%25AC%25E4%25BC%259A%25E5%25BD%25B1%25E5%2593%258D%25E5%25B1%258F%25E5%25B9%2595%25E4%25B8%258A%25E5%2585%2583%25E7%25B4%25A0%25E7%259A%2584%25E5%25A4%25A7%25E5%25B0%258F%25E5%2592%258C%25E4%25BD%258D%25E7%25BD%25AE%25E3%2580%2582%25E6%25AD%25A3%25E5%25A6%2582%25E6%2596%2587%25E6%25A1%25A3%25E6%2589%2580%25E8%25BF%25B0%25EF%25BC%259A%25E2%2580%259C%2560LayoutModifierNode%2560" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/node/LayoutModifierNode%EF%BC%89%E6%98%AF%E5%AE%9E%E9%99%85%E8%BF%9B%E8%A1%8C%E6%B5%8B%E9%87%8F%E7%9A%84%E8%8A%82%E7%82%B9%EF%BC%8C%E5%9B%A0%E4%B8%BA%E5%AE%83%E4%BB%AC%E4%BC%9A%E5%BD%B1%E5%93%8D%E5%B1%8F%E5%B9%95%E4%B8%8A%E5%85%83%E7%B4%A0%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%92%8C%E4%BD%8D%E7%BD%AE%E3%80%82%E6%AD%A3%E5%A6%82%E6%96%87%E6%A1%A3%E6%89%80%E8%BF%B0%EF%BC%9A%E2%80%9C%60LayoutModifierNode%60" ref="nofollow noopener noreferrer">developer.android.com/reference/k…</a> 会改变其包裹内容的测量和布局方式。”。因此，在测量和布局过程中，每当遍历 <code>ModifierNode</code> 链时，这些节点实际上都会开始进行测量。</p>
<p>因此，所有想要改变其子元素位置或对整个 Composable 元素大小产生任何影响的修饰符都需要实现 <code>LayoutModifierNode</code> 接口。例如，<code>SizeNode</code> 就是一个实现 <code>LayoutModifierNode</code> 接口的例子，它是 <code>height()</code>、<code>width()</code> 或 <code>size()</code> 等修饰符实际使用的节点。</p>
<h2 data-id="heading-5">SemanticsNode</h2>
<p>当你想要向设备的*辅助功能服务[5]*传递一些信息时，你可以使用 Compose 中的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2FModifier%23(androidx.compose.ui.Modifier).semantics(kotlin.Boolean%2Ckotlin.Function1)" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/Modifier#(androidx.compose.ui.Modifier).semantics(kotlin.Boolean,kotlin.Function1)" ref="nofollow noopener noreferrer"><code>semantics</code></a> 修饰符来告知系统要向用户传达哪些语义属性。</p>
<p>但是辅助功能服务并不了解 Compose。在其他平台上，这一点显而易见，但考虑到 Compose 向后兼容（而且它并非 Android 框架的组成部分），在 Android 上也是如此。</p>
<p>对于辅助功能，前面提到的 <code>Owner</code> 再次发挥作用。它持有一个 <code>SemanticsOwner</code>，该 <code>SemanticsOwner</code> 充当了与相应平台语义框架之间的桥梁。</p>
<p>为此，<code>SemanticsOwner</code> 维护着一个 <code>SemanticNode</code> 对象树，用于向辅助功能服务的用户描述屏幕内容。这也是我未来会更详细介绍的内容之一。</p>
<p>敬请期待更多关于 Compose 内部运作机制的见解。祝你编码愉快！</p>
<h2 data-id="heading-6">脚注</h2>
<ul>
<li>[1] 我在本段中使用“副作用”一词，是因为它在<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSide_effect_(computer_science)" target="_blank" title="https://en.wikipedia.org/wiki/Side_effect_(computer_science)" ref="nofollow noopener noreferrer">计算机科学和函数式编程</a>中由来已久。我这里指的并非官方 Compose 文档中提到的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fui%2Fcompose%2Fside-effects" target="_blank" title="https://developer.android.com/develop/ui/compose/side-effects" ref="nofollow noopener noreferrer">副作用</a>。Compose 文档至少在过去有时会提及副作用的这种用法——尽管实际上 Compose 函数并非纯函数。</li>
<li>[2] 如果在 Compose Compiler 插件完成工作后查看 Composable，你会发现它不仅创建了节点，而且你的函数还会进行大量调用，从而改变应用程序的全局状态。但这些调用并不会实际绘制任何内容。它们最多只会创建一些绘制操作，这些操作会被记录下来，并在系统认为需要绘制时，于未来的某个时间点被调用。我将在以后的两篇文章中分别介绍绘制过程以及编译器对代码所做的更改。</li>
<li>[3] 实际上，布局可组合对象共有三个。但它们最终都会调用 <code>ReusableComposeNode</code>。其他变体的示例也与之非常相似。</li>
<li>[4] 本系列文章中我可能不会介绍 SlotTable。我推荐 Richard Leland 的这篇关于 compose 的文章（<a href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2Fandroiddevelopers%2Funder-the-hood-of-jetpack-compose-part-2-of-2-37b2c20c6cdd%25EF%25BC%2589%25EF%25BC%258C%25E4%25BB%25A5%25E5%258F%258A" target="_blank" title="https://medium.com/androiddevelopers/under-the-hood-of-jetpack-compose-part-2-of-2-37b2c20c6cdd%EF%BC%89%EF%BC%8C%E4%BB%A5%E5%8F%8A" ref="nofollow noopener noreferrer">medium.com/androiddeve…</a> Mohit Sarveiya 的关于 slotTable 的视频（<a href="https://link.juejin.cn?target=https%3A%2F%2Fcodingwithmohit.com%2F%25EF%25BC%2589%25EF%25BC%258C%25E8%25BF%2599%25E4%25BA%259B%25E8%25A7%2586%25E9%25A2%2591%25E8%25AE%25B2%25E8%25A7%25A3%25E4%25BA%2586%25E5%25A6%2582%25E4%25BD%2595%25E6%25AD%25A3%25E7%25A1%25AE%25E4%25BD%25BF%25E7%2594%25A8" target="_blank" title="https://codingwithmohit.com/%EF%BC%89%EF%BC%8C%E8%BF%99%E4%BA%9B%E8%A7%86%E9%A2%91%E8%AE%B2%E8%A7%A3%E4%BA%86%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8" ref="nofollow noopener noreferrer">codingwithmohit.com/），这些视频讲解了如何…</a> slotTable。</li>
<li>[5] 设备上的辅助功能服务在 Android 系统中是 AccessibilityService 的实现，但在 iOS、桌面或 Web 端则有所不同，因此我在本文中使用“辅助功能服务”这个通用术语。</li>
</ul>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GIS中的“高度”到底指什么？一文厘清正高、正常高与大地高的区别]]></title>    <link>https://juejin.cn/post/7593098101432729654</link>    <guid>https://juejin.cn/post/7593098101432729654</guid>    <pubDate>2026-01-09T13:23:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593098101432729654" data-draft-id="7593145583348088874" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GIS中的“高度”到底指什么？一文厘清正高、正常高与大地高的区别"/> <meta itemprop="keywords" content="GIS"/> <meta itemprop="datePublished" content="2026-01-09T13:23:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="charlee44"/> <meta itemprop="url" content="https://juejin.cn/user/1117549770846872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GIS中的“高度”到底指什么？一文厘清正高、正常高与大地高的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117549770846872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    charlee44
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:23:01.000Z" title="Fri Jan 09 2026 13:23:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>节选自<a href="https://link.juejin.cn?target=https%3A%2F%2Fitem.jd.com%2F14603137.html" target="_blank" title="https://item.jd.com/14603137.html" ref="nofollow noopener noreferrer">《GIS基础原理与技术实践》</a>第2章 地理空间参考系统</strong>
作者原创内容，转载请注明出处。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f40e608f94c493889e21857893f4279~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569781&amp;x-signature=2RdCPNt9Q2tYu%2B%2F3LRnrwqZ0woU%3D" alt="GIS基础原理与技术实践" loading="lazy"/></p>
<h2 data-id="heading-0">2.3 高程参考系统</h2>
<p>使用经度和纬度表示的地理坐标系是一种水平坐标系统（这里的水平坐标系统并不表示其就是平面坐标系的意思，更准确的含义是其表达了三维空间坐标系的两个维度），缺少对于第三维度也就是高程的参考，也就是本节我们要介绍的：高程参考系统。高程参考系统是一种垂直坐标系。</p>
<h3 data-id="heading-1">2.3.1 大地水准面</h3>
<p>我们知道，参考椭球体是对地球表面的一种逼近。那么问题来了，参考椭球体是用喜马拉雅山所在的高度进行逼近，还是以马里亚纳海沟的高度进行逼近？答案肯定都不是。其实，这其中还隐藏了另一个逼地球自然表面的参考面，那就是本节我们要讲的——大地水准面（Geoid）。</p>
<p>地理坐标系的第三维度通常使用海拔高度（Elevation），而不是到球心的距离。然而问题在于，高度的值是一个相对量，需要一个起算点。并且，这个高度必须沿着重力方向（铅锤方向）才有物理意义（想一想为什么建筑物总是要修的与地面垂直）。我们说到“海拔”这个名词，就会联想到高度的值应该是一个目标地物距离海平面的高差。事实也确实如此，我们可以定一个平均海平面作为高程的起算点，并且假设这个海平面完全静止，并且延伸到所有大陆下部，生成了一个密闭的曲面——这个曲面就是大地水准面。</p>
<p>与参考椭球面不同的是，参考椭球面是数学模型得到的，处处平滑且平整；而大地水准面虽然平滑但不平整，是一个不规则但连续的闭合曲面。这其中的原因在于，地球质量分布不均匀，造成地球的引力场也是分布不均的。假设地球球体完全被水覆盖，水的高度也不会是完全一样：在地球局部密度更大的地方，地球施加的引力就会越大，造成水位越高。换句话说，大地水准面是一个重力等势面，重力方向（铅垂方向）在其任何地方都与其表面垂直；由于质量（引力）不均，每个位置的铅垂方向不一样，结果就是大地水准面并不平整。如下图2.8所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d53017b72e44df6ad9ded58c1b883c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569781&amp;x-signature=PypzjF4eh0ArCPUww%2B2Blb2KwRI%3D" alt="图2.8 大地水准面与旋转椭球体" loading="lazy"/></p>
<h3 data-id="heading-2">2.3.2 三级逼近</h3>
<p>现在我们已经有了大地水准面、参考椭球面和大地基准面。那么它们的关系是如何呢？简单来说，它们共同组成了对地球自然表面的三级逼近。</p>
<ul>
<li>大地水准面是对地球自然表面的第一级逼近。大地水准面通过重力等势，确定了一个高程起算面，它远比地球自然表面平整得多，但是不是完全平整。地球自然表面具有从珠穆朗玛峰（+8800米）到马里亚纳海沟（-11,000米）的高差，但大地水准面与参考椭球面的偏差范围不超过200m（从+85米的冰岛到-106米的印度南部）。</li>
<li>参考椭球面是对地球自然表面的第二级逼近。地球自然表面和大地水准面都是不规则的曲面，无法通过数学模型对其进行表达，这也意味着难以对其进行测算和分析。通过将大地水准面拟合成一个旋转椭球体，使我们可以对地球自然表面进行空间几何计算。参考椭球面是测量计算的基准面。</li>
<li>大地基准面是对地球自然表面的第三极逼近。参考椭球体是对地球球体的抽象，但大地基准面解决的是这个参考椭球体如何摆放的问题：大地基准面要么与地球自然表面的局部区域具有较好的重合度，以便解决局部区域精度的问题；要么让椭球体中心位于地球质心，以便具有全球范围可使用的便捷性。</li>
</ul>
<h3 data-id="heading-3">2.3.3 高程系统</h3>
<h4 data-id="heading-4">1 似大地水准面</h4>
<p>如前所述，大地水准面确定了高程的起算面。那么，地球表面上一点到大地水准面必然有一个高度，这个高度就是正高（Orthometric Height）。正高就是我们通常意义上所说的海拔或者海拔高度，也叫做高程（Elevation）。这个高程系统就是正高系统。</p>
<p>然而，大地水准面的问题是其仅仅只是一个理想化的模型，是不能准确测量的。客观地说，大地水准面所假想的大陆下部的海平面无法被量测，没有现实意义。为了解决这个问题，就引入了一个数学辅助面：似大地水准面（Quasi-geoid）。似大地水准面采用平均正常重力值来拟合水准面曲线（大地某一点的重力值无法精确求取），导致两者在海洋上完全重合，在大陆上有2 ~ 4米的微小差异。如果不能理解不要紧，我们可以定性的理解：似大地水准面是对大地水准面的数学近似，似大地水准面可以精确求得，大地水准面不可以精确求得。</p>
<p>同样的，地球表面上一点到似大地水准面也有一个高度，我们把这个高度叫做正常高（Normal height），其高程就是正常高系统。正因为似大地水准面是大地水准面得近似且可求取，所以一般使用正常高来替代正高，正常高系统结果也可以称为海拔高度。我国目前采用的法定高程系统就是正常高系统。</p>
<p>正高和正常高，大地水准面和似大地水准面的示意图如下图2.9所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0724c4f0f8084ebab6f8e5d74660fb1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569781&amp;x-signature=WFVH8luc5ce1hikIEldLD4ErKDI%3D" alt="图2.9 正高、正常高与大地高" loading="lazy"/></p>
<h4 data-id="heading-5">2 高程系统</h4>
<p>如图2.9中所示，除了正高系统和正常高系统，还有一类常用的高程系统就是大地高系统。所谓大地高，指的是以参考椭球面为基准面的高程系统，其值是地面上一点沿该点的椭球面法线到参考椭球面的距离。大地高也称为椭球高。</p>
<p>虽然我们一般采用的高程系统是正常高系统，但在实际的使用过程中，有的时候知道正常高需要计算大地高，有的时候又需要通过大地高来计算正常高。一个很典型的例子就是，GPS（Global Positioning System，全球定位系统）获取的高程一般是大地高，那么如何得到我们想要的正常高呢？</p>
<p>如下表2.4所述，对于高程系统中变量，我们有如下定义：</p>




































<table><thead><tr><th align="center">符号</th><th align="center">名称</th><th align="center">含义</th></tr></thead><tbody><tr><td align="center"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">H_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></td><td align="center">正常高（Normal Height）</td><td align="center">地面上一点沿重力方向到似大地水准面的距离</td></tr><tr><td align="center"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>o</mi></msub></mrow><annotation encoding="application/x-tex">H_o</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></td><td align="center">正高 （Orthometric Height）</td><td align="center">地面上一点沿重力方向到大地水准面的距离</td></tr><tr><td align="center"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">H_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span></td><td align="center">大地高（Geodetic Height）</td><td align="center">地面上一点沿椭球面法线方向到参考椭球面的距离</td></tr><tr><td align="center"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ζ</mi></mrow><annotation encoding="application/x-tex">\zeta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span></span></span></span></span></td><td align="center">高程异常（Height Anomaly）</td><td align="center">似大地水准面到参考椭球面的距离</td></tr><tr><td align="center"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span></td><td align="center">大地水准面差距（Geoid Undulation）</td><td align="center">大地水准面到参考椭球面的距离</td></tr></tbody></table>
<p>将它们在示意图中标识，如下图2.10所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86f67969c61e4eafaf010751f95ea2d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569781&amp;x-signature=3J2R4NYxMc2jIP%2F%2FX4u8oDPWyOA%3D" alt="图2.10 正高、正常高与大地高" loading="lazy"/></p>
<p>根据图示很显然可以得到如下公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"/><mtd><mrow><msub><mi>H</mi><mi>g</mi></msub><mo>=</mo><msub><mi>H</mi><mi>n</mi></msub><mo>+</mo><mi>ζ</mi></mrow></mtd><mtd width="50%"/><mtd><mtext>(2.6)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">H_g = H_n + \zeta \tag{2.6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span></span><span class="tag"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2.6</span></span><span class="mord">)</span></span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"/><mtd><mrow><msub><mi>H</mi><mi>g</mi></msub><mo>=</mo><msub><mi>H</mi><mi>o</mi></msub><mo>+</mo><mi>N</mi></mrow></mtd><mtd width="50%"/><mtd><mtext>(2.7)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">H_g = H_o + N \tag{2.7}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span><span class="tag"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2.7</span></span><span class="mord">)</span></span></span></span></span></span></div>
<p>回到之前提到的问题，GPS获取的高程为大地高<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">H_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>，那么再通过大地测量的方法，可以精确确定高程异常<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ζ</mi></mrow><annotation encoding="application/x-tex">\zeta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span></span></span></span></span>，根据公式2.6，大地高减去高程异常就可以得到正常高<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">H_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>，正常高可以用来代替正高，正高即最常用的海拔高度。在实际的应用中，有时需要大地高，有时需要正常高，可根据上述公式灵活转换。</p>
<h4 data-id="heading-6">3 高程基准</h4>
<p>如2.3.1节所述，大地水准面使用一个假想的平均海平面作为高程起点（基准），这个平均海面可以通过在各地的验潮站观测、计算、综合得到。我国根据实际的观测结果之上，建立多个高程基准面，其中最常用的两个国家高程基准是：</p>
<ul>
<li>1956黄海高程基准，水准原点高程72.289米。</li>
<li>1985国家高程基准，水准原点高程72.260米。</li>
</ul>
<p>目前，1985国家高程基准已经全部替代1956黄海高程基准，之前所有使用1956黄海高程基准的高程结果都需要通过下式2.8进行转换：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>H</mi><mn>85</mn></msub><mo>=</mo><msub><mi>H</mi><mn>56</mn></msub><mo>−</mo><mn>0.029</mn></mrow><annotation encoding="application/x-tex">H_{85} = H_{56} - 0.029</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">85</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">56</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.029</span></span></span></span></span></div>
<p>此外，国际上通用的还有美国国家地理空间情报局（National Geospatial-Intelligence Agency，NGA）发布的EGM（Earth Gravitational Models，地球重力模型）大地水准面。这个大地水准面模型是综合利用现有全球大量重力数据计算出来的，适用于全球范围。目前已经发布了EGM84、EGM96、EGM2008和EGM2020四个版本。</p>
<hr/>
<p>本文节选自作者新书《GIS基础原理与技术实践》第2章。书中系统讲解 GIS 核心理论与多语言实战，适合开发者与高校师生。</p>
<p>📚 <strong>配套资源开源</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffafa1899%2FGISBasic" target="_blank" title="https://github.com/fafa1899/GISBasic" ref="nofollow noopener noreferrer">GitHub</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Fcharlee44%2FGISBasic" target="_blank" title="https://gitcode.com/charlee44/GISBasic" ref="nofollow noopener noreferrer">GitCode</a></p>
<p>🛒 <strong>支持正版</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fitem.jd.com%2F14603137.html" target="_blank" title="https://item.jd.com/14603137.html" ref="nofollow noopener noreferrer">京东</a>｜<a href="https://link.juejin.cn?target=https%3A%2F%2Fproduct.dangdang.com%2F29988568.html" target="_blank" title="https://product.dangdang.com/29988568.html" ref="nofollow noopener noreferrer">当当</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（31）Hibernate的原生SQL查询是什么？]]></title>    <link>https://juejin.cn/post/7593145583348105258</link>    <guid>https://juejin.cn/post/7593145583348105258</guid>    <pubDate>2026-01-09T13:47:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593145583348105258" data-draft-id="7593098101432778806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（31）Hibernate的原生SQL查询是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T13:47:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（31）Hibernate的原生SQL查询是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:47:01.000Z" title="Fri Jan 09 2026 13:47:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的原生SQL查询</h3>
<p>在某些情况下，HQL（Hibernate Query Language）或Criteria API可能无法满足复杂查询的需要，这时可以使用原生SQL查询（Native SQL Query）。原生SQL查询允许开发者直接编写SQL语句，并通过Hibernate执行这些语句，将结果映射为实体类或自定义结果集。</p>
<h3 data-id="heading-1">使用原生SQL查询</h3>
<p>原生SQL查询主要分为两种：</p>
<ol>
<li><strong>实体查询</strong>：返回实体对象。</li>
<li><strong>非实体查询</strong>：返回自定义对象或投影结果。</li>
</ol>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">实体类定义</h4>
<p>我们将定义两个实体类：<code>Person</code> 和 <code>Address</code>。</p>
<h5 data-id="heading-4">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-5">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-6">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-8">使用原生SQL查询示例</h3>
<h4 data-id="heading-9">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-10">使用原生SQL查询</h4>
<h5 data-id="heading-11">查询所有Person记录</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAllPersons</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM person"</span>;
            NativeQuery&lt;Person&gt; query = session.createNativeQuery(sql, Person.class);
            List&lt;Person&gt; persons = query.getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-12">使用投影查询返回自定义结果</h5>
<p>假设我们只想查询Person的姓名和年龄，而不是整个实体，这时可以使用投影查询（Projection Query）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateProjectionQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL投影查询</span>
        queryPersonNameAndAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonNameAndAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT name, age FROM person"</span>;
            NativeQuery&lt;Object[]&gt; query = session.createNativeQuery(sql);
            List&lt;Object[]&gt; results = query.getResultList();
            System.out.println(<span class="hljs-string">"Query person name and age:"</span>);
            <span class="hljs-keyword">for</span> (Object[] row : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
                <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> (Integer) row[<span class="hljs-number">1</span>];
                System.out.println(name + <span class="hljs-string">" - "</span> + age);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-13">原生SQL查询详细解释</h3>
<ol>
<li>
<p><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象供查询使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>查询所有Person记录</strong>：使用原生SQL查询所有Person记录并映射为<code>Person</code>实体。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（31）Hibernate的原生SQL查询是什么？]]></title>    <link>https://juejin.cn/post/7593165280488833065</link>    <guid>https://juejin.cn/post/7593165280488833065</guid>    <pubDate>2026-01-09T13:47:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593165280488833065" data-draft-id="7593098101432795190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（31）Hibernate的原生SQL查询是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T13:47:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（31）Hibernate的原生SQL查询是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:47:44.000Z" title="Fri Jan 09 2026 13:47:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的原生SQL查询</h3>
<p>在某些情况下，HQL（Hibernate Query Language）或Criteria API可能无法满足复杂查询的需要，这时可以使用原生SQL查询（Native SQL Query）。原生SQL查询允许开发者直接编写SQL语句，并通过Hibernate执行这些语句，将结果映射为实体类或自定义结果集。</p>
<h3 data-id="heading-1">使用原生SQL查询</h3>
<p>原生SQL查询主要分为两种：</p>
<ol>
<li><strong>实体查询</strong>：返回实体对象。</li>
<li><strong>非实体查询</strong>：返回自定义对象或投影结果。</li>
</ol>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">实体类定义</h4>
<p>我们将定义两个实体类：<code>Person</code> 和 <code>Address</code>。</p>
<h5 data-id="heading-4">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-5">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-6">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-8">使用原生SQL查询示例</h3>
<h4 data-id="heading-9">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-10">使用原生SQL查询</h4>
<h5 data-id="heading-11">查询所有Person记录</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAllPersons</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM person"</span>;
            NativeQuery&lt;Person&gt; query = session.createNativeQuery(sql, Person.class);
            List&lt;Person&gt; persons = query.getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-12">使用投影查询返回自定义结果</h5>
<p>假设我们只想查询Person的姓名和年龄，而不是整个实体，这时可以使用投影查询（Projection Query）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateProjectionQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL投影查询</span>
        queryPersonNameAndAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonNameAndAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT name, age FROM person"</span>;
            NativeQuery&lt;Object[]&gt; query = session.createNativeQuery(sql);
            List&lt;Object[]&gt; results = query.getResultList();
            System.out.println(<span class="hljs-string">"Query person name and age:"</span>);
            <span class="hljs-keyword">for</span> (Object[] row : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
                <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> (Integer) row[<span class="hljs-number">1</span>];
                System.out.println(name + <span class="hljs-string">" - "</span> + age);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-13">原生SQL查询详细解释</h3>
<ol>
<li>
<p><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象供查询使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>查询所有Person记录</strong>：使用原生SQL查询所有Person记录并映射为<code>Person</code>实体。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝被找回！MJJ必修课：Outlook邮箱交易后的“防回手”安全设置全攻略]]></title>    <link>https://juejin.cn/post/7593338828195233832</link>    <guid>https://juejin.cn/post/7593338828195233832</guid>    <pubDate>2026-01-09T13:43:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195233832" data-draft-id="7593193235251216436" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝被找回！MJJ必修课：Outlook邮箱交易后的“防回手”安全设置全攻略"/> <meta itemprop="keywords" content="服务器"/> <meta itemprop="datePublished" content="2026-01-09T13:43:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝被找回！MJJ必修课：Outlook邮箱交易后的“防回手”安全设置全攻略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:43:03.000Z" title="Fri Jan 09 2026 13:43:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">拒绝被找回！MJJ必修课：Outlook邮箱交易后的“防回手”安全设置全攻略</h2>
<p>在MJJ的日常交易中，遵循“一机一号”的祖训，Outlook凭借其高风控阈值和广泛的接受度，始终稳坐交易市场的头把交椅。</p>
<p>但是，买来的号总是心惊胆战？担心卖家留了后门随时“回手掏”？</p>
<p>别慌，只要按照这篇教程的<strong>三个核心步骤</strong>操作，就能把账号彻底清洗干净，变成你自己的私有财产。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/351c3ffc076f47719b46f4c491fe67e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=XdkTbu9V3mIQCcYNuSrapYxzqg0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">准备工作</h2>
<p>登录你的Outlook账号，进入 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Faccount.microsoft.com%2Fsecurity" target="_blank" title="https://account.microsoft.com/security" ref="nofollow noopener noreferrer">Microsoft 账户安全页面</a></strong>。</p>
<blockquote>
<p><strong>高危预警</strong>：在进行以下操作前，请确保你当前的网络环境相对稳定，最好使用浏览器的隐私模式登录，避免缓存冲突。</p>
</blockquote>
<h2 data-id="heading-2">第一步：清洗辅助验证方式</h2>
<p>这是最基础也是最容易被忽视的一步。很多时候你改了密码，卖家却能通过预留的辅助邮箱轻松重置。</p>
<p><strong>操作逻辑：</strong> 先加后删。确保手里有粮，心中不慌。</p>
<ul>
<li>点击 <strong>“高级安全选项” (Advanced security options)</strong>。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72a1c40439954dbda99f400f498be873~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=H4xgaheWMWWQkdVRHwL1KdWH82w%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>仔细检查</strong>当前的辅助验证方式（手机号、备用邮箱）。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/767aef44bb984a778d680e710218c54d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=jYKGKYGTVmoZkSxpFHaliAn%2FIcA%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>添加自己的验证方式</strong>：</p>
</li>
<li>
<p>强烈建议添加<strong>邮箱</strong>作为辅助验证，操作方便且接收验证码稳定。</p>
</li>
<li>
<p><em>注意：如果账号当前只有一个辅助邮箱（卖家的），千万别急着删！一定要先添加并验证你自己的邮箱，成功上位后，再把卖家的踢掉。</em></p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5ec71484b9e45f3a587a5900c7b6dca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=Gc6g9Dy7MfwqXsBrWQ4XL2E8bCU%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>添加完成后</strong>，果断删除所有不属于你的邮箱和手机号。</li>
</ul>
<h2 data-id="heading-3">第二步：重置安全恢复码</h2>
<p>很多人改了密码、换了手机号，最后还是被找回了，为什么？因为你漏掉了Outlook的“尚方宝剑”——<strong>恢复代码（Recovery Code）</strong>。</p>
<h3 data-id="heading-4">为什么必须重置它？</h3>
<p>Outlook的恢复代码是一串25位的随机字符。它是账户的<strong>最后一道防线</strong>。哪怕没有密码、没有手机验证码，拥有这串代码的人可以直接绕过所有验证，强行重置账户。</p>
<p><strong>风险点</strong>：如果前号主保留了之前的恢复代码，他随时可以“复活”并接管账号。</p>
<h3 data-id="heading-5">如何操作？</h3>
<ul>
<li>在“高级安全选项”页面，向下拉，找到 <strong>“恢复代码” (Recovery code)</strong> 区域。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/058cea4ff65a478aa46a329e261f45cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=VS5Rws8Sc3d7uiOzrc%2BGkFcS0fc%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>点击 <strong>“生成新代码” (Generate new code)</strong> 或 <strong>“替换”</strong>。</p>
</li>
<li>
<p><strong>系统逻辑</strong>：当你生成新代码的瞬间，<strong>旧的代码会立即失效</strong>。这意味着前号主手里的那个备份彻底变成了废纸。</p>
</li>
<li>
<p><strong>保存新代码</strong>：系统会显示一个新的25位代码（如 <code>XXXXX-XXXXX-...</code>）。</p>
</li>
<li>
<p><em>建议：截图保存或抄写下来，存放在本地安全的地方，不要只保存在网盘或邮箱里。</em></p>
</li>
</ul>
<h2 data-id="heading-6">第三步：踢掉所有登入设备</h2>
<p>改完所有设置后，如果卖家的电脑或手机还保持着登录状态（Cookie/Session未失效），他依然有机会在你眼皮底下查看验证码或进行破坏。</p>
<ul>
<li>在“高级安全选项”页面下方，找到 <strong>“注销我” (Sign me out)</strong> 或 <strong>“注销所有位置”</strong>。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3773885afb0c4fedb09add7a1ce0a658~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=op1vPNzcG37lu6VN6EplBvJ%2Bqc0%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>点击确认。</p>
</li>
<li>
<p><em>备注：微软官方提示该操作可能需要24小时生效，但实测通常几分钟内就会把所有设备（包括你自己当前的设备）全部强制下线。</em></p>
</li>
</ul>
<h2 data-id="heading-7">第四步：修改登录密码</h2>
<p>做完以上三个“大手术”后，账号已经基本安全。最后一步，为了仪式感和绝对的安全：</p>
<ul>
<li>去修改一个高强度的<strong>登录密码</strong>。</li>
<li>重新登录你的账号，享受完全掌控的快感。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/343d74b03e2c4feabb8c7a223e7a23f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=PfG2SSs%2F1iJ5N3l7cXVHsdV9b4w%3D" alt="" loading="lazy"/></p>
<p>总结与防坑小贴士</p>
<ol>
<li><strong>顺序不能乱</strong>：建议按 <strong>添加自己邮箱 → 删别人邮箱 → 重置恢复码 → 踢设备 → 改密码</strong> 的顺序操作。</li>
<li><strong>风控注意</strong>：如果账号IP变动极其剧烈，连续修改安全设置可能会触发微软的30天安全挂起期（Security wait period）。如果遇到提示需等待30天，说明账号被风控，此时账号仍可登录但无法修改安全信息，建议挂机养号几天再试。</li>
<li><strong>双重验证(2FA)</strong>：如果条件允许，建议绑定微软自家的 Authenticator App，安全性远高于短信验证。</li>
</ol>
<p>做完这套流程，你的Outlook账号就像穿了防弹衣，除了你没人能进得去！</p>
<p><em>如果有遗漏的细节或遇到特殊的风控情况，欢迎在评论区补充交流！</em></p>
<h3 data-id="heading-8">如果觉得文章好，可以关注<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.legacyvps.com%2F" target="_blank" title="https://www.legacyvps.com/" ref="nofollow noopener noreferrer">传家宝VPS</a></h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（32）什么是Hibernate的Criteria查询？]]></title>    <link>https://juejin.cn/post/7592990758476759059</link>    <guid>https://juejin.cn/post/7592990758476759059</guid>    <pubDate>2026-01-09T13:49:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592990758476759059" data-draft-id="7593145583348121642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（32）什么是Hibernate的Criteria查询？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T13:49:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（32）什么是Hibernate的Criteria查询？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:49:00.000Z" title="Fri Jan 09 2026 13:49:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的Criteria查询</h3>
<p>Hibernate的Criteria查询是一种面向对象的查询方式，它允许开发者以编程方式构建查询，而不是直接编写HQL或SQL语句。它的主要特点包括：</p>
<ul>
<li><strong>类型安全</strong>：编译时检查可以捕捉到错误。</li>
<li><strong>面向对象</strong>：使用Java对象和方法来构建查询。</li>
<li><strong>动态生成</strong>：可以在运行时动态生成查询，而不是在编译时固定查询。</li>
</ul>
<h3 data-id="heading-1">使用Criteria查询</h3>
<p>在Hibernate 5之前，Criteria API是通过<code>org.hibernate.Criteria</code>接口实现的。在Hibernate 5及之后，Criteria API被重新设计为JPA的Criteria API（<code>javax.persistence.criteria</code>）。</p>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">实体类定义</h4>
<p>继续使用之前定义的<code>Person</code>和<code>Address</code>实体类。</p>
<h5 data-id="heading-4">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-5">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-7">使用Criteria查询示例</h3>
<h4 data-id="heading-8">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-9">使用Criteria查询</h4>
<h5 data-id="heading-10">查询所有Person记录</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;

<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCriteriaQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用Criteria查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAllPersons</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">HibernateCriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            JpaCriteriaQuery&lt;Person&gt; criteriaQuery = criteriaBuilder.createQuery(Person.class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);
            criteriaQuery.select(root);

            List&lt;Person&gt; persons = session.createQuery(criteriaQuery).getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-11">使用条件查询</h5>
<p>假设我们想查询年龄大于25岁的Person。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;

<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Predicate;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCriteriaConditionalQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用Criteria条件查询</span>
        queryPersonsByAge(sessionFactory, <span class="hljs-number">25</span>);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonsByAge</span><span class="hljs-params">(SessionFactory sessionFactory, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">HibernateCriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            JpaCriteriaQuery&lt;Person&gt; criteriaQuery = criteriaBuilder.createQuery(Person.class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);

            <span class="hljs-type">Predicate</span> <span class="hljs-variable">agePredicate</span> <span class="hljs-operator">=</span> criteriaBuilder.greaterThan(root.get(<span class="hljs-string">"age"</span>), age);
            criteriaQuery.select(root).where(agePredicate);

            List&lt;Person&gt; persons = session.createQuery(criteriaQuery).getResultList();
            System.out.println(<span class="hljs-string">"Query persons with age greater than "</span> + age + <span class="hljs-string">":"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-12">Criteria查询详细解释</h3>
<ol>
<li>
<p><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象供查询使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>查询所有Person记录</strong>：使用Criteria查询所有Person记录。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCriteriaQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用Criteria查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAllPersons</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">HibernateCriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            JpaCriteriaQuery&lt;Person&gt; criteriaQuery = criteriaBuilder.createQuery(Person.class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);
            criteriaQuery.select(root);

            List&lt;Person&gt; persons = session.createQuery(criteriaQuery).getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() );
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TIOBE 公布 C# 是 2025 年度编程语言]]></title>    <link>https://juejin.cn/post/7593145583348154410</link>    <guid>https://juejin.cn/post/7593145583348154410</guid>    <pubDate>2026-01-09T13:50:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593145583348154410" data-draft-id="7593145583348138026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TIOBE 公布 C# 是 2025 年度编程语言"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2026-01-09T13:50:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TIOBE 公布 C# 是 2025 年度编程语言
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:50:40.000Z" title="Fri Jan 09 2026 13:50:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>TIOBE 公布的数据显示，C# 以 2.94% 的年度最大涨幅再度获评<code>2025 年度编程语言</code>，在近三年内，C# 第二次被 TIOBE 指数评为<code>年度编程语言</code>。这一荣誉授予了在年度排名中涨幅最大的编程语言，而 C# 正是凭借这一最大增幅获此殊荣。</p>
<p>多年来，C# 经历了根本性的变革：从语言设计的角度来看，它常常是主流编程语言中率先采纳新趋势的先行者。与此同时，C# 成功实现了两次重大转型：一是从仅限 Windows 平台转向跨平台支持，二是从微软专属走向开源。C# 总能在关键时刻及时演进，持续保持活力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9efab1720cfb4a098214fc1bc9a19002~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=56IL1QkVj62Pi5L73pwiu9Cr0Ng%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">TIOBE 介绍</h2>
<p>TIOBE 是一个编程社区指数，用于衡量不同编程语言的受欢迎程度。TIOBE 指数基于全球范围内熟练工程师数量、课程和第三方供应商等多个因素进行评估。指数每月更新一次，并使用一系列流行搜索引擎（如Google、必应、雅虎、维基百科、亚马逊、YouTube 和百度等）来计算编程语言的相关搜索结果和讨论量等数据。需要注意的是，TIOBE指数并不代表“最佳”编程语言，也不是指“代码行数最多”的语言。</p>
<h2 data-id="heading-2">TIOBE 编程语言评分排行榜</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92c779c82b854290816f4396cc320533~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=hCQs6c6Gzbu0Y0Ps%2FXEYhXm1XDM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">TIOBE 编程社区指数</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31112bd0097c4660b1272fdf21a1b1a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=KdGoNORKkJlLIuwx1kEnyD%2BCnNc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">编程语言名人堂</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daacdb4c6e8242a78563e6fbeb56ab1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=bf6rUUACsxZKLI3ynVuQW4v5S5Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">C# 14 新增的一些功能</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Fdotnet%2Fcsharp%2Fwhats-new%2Fcsharp-14" target="_blank" title="https://learn.microsoft.com/zh-cn/dotnet/csharp/whats-new/csharp-14" ref="nofollow noopener noreferrer">learn.microsoft.com/zh-cn/dotne…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d072ec259f374da79a919240c05a54f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=wUSBMB9X3hRndwbmAWNMPAZ5wg4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">.NET 10 正式发布</h2>
<p>.NET 团队于 2025 年 11 月 11 日宣布 .NET 10 正式发布，这是迄今为止最高效、最现代、最安全、最智能且性能最高的 .NET 版本。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c979d7cb5a04cf0bcef7a6b36a09951~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=cKvrDewsmjUqjqQ6ef%2FXF8gykh8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/795eebe014c24ae2b0033a8512e9104c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=IlShUQwb6ShlcOHMfdJZ%2BbrORfM%3D" alt="" loading="lazy"/></p>
<p>.NET 10 是一个长期支持版本（LTS） ，将支持三年 ，直至 2028 年 11 月 10 日。我们强烈建议生产环境中的应用程序升级到 .NET 10，以便享受更长的支持周期、显著的性能提升以及众多新功能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ec524c0f9b64bc99db0dc14ac9ebef4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=cpkwTi1BWbSltzksruzMkp2ICNw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">.NET 让构建 AI 驱动的应用变得简单直接</h2>
<p>.NET 让构建 AI 驱动的应用变得简单直接，无论是轻量级集成还是复杂的多智能体系统都能轻松应对。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6da089f82e8045ecbbb398c50e0950e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=cDembuQ%2FJC%2FFyM6IQyh%2BSxVWD0w%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">Microsoft 代理框架：构建智能多代理系统</h3>
<p>Microsoft 代理框架通过将语义内核和 AutoGen 的优点结合到统一体验中，简化了智能代理 AI 系统的构建。无论您是构建单个 AI 代理还是协调多个代理协同工作，该框架都能提供您所需的模式和基础设施。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fagent-framework" target="_blank" title="https://github.com/microsoft/agent-framework" ref="nofollow noopener noreferrer">github.com/microsoft/a…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a1f1f9bd5404a859ccbf778af773579~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=4rknz7UhUdiZl%2B8tCYTA3SPpHwQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">人工智能应用的统一构建模块</h3>
<p><code>Microsoft.Extensions.AI</code> 和 <code>Microsoft.Extensions.VectorData</code> 提供统一的抽象，用于将 AI 服务集成到您的应用程序中。IChatClient 接口通过一致的 API 与任何提供程序（OpenAI、Azure OpenAI、GitHub Models、Ollama）配合使用，从而可以轻松切换提供程序或支持多个后端，而无需重写代码。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5750b0dd079b4a6e83eefdc566c8244f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=qGdSGXp6cQup8yooeR1D4Ss0DKQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">.NET 提供一流的 MCP 支持</h3>
<p>.NET 提供对 Model Context Protocol（MCP，模型上下文协议） 的一流支持，让 AI 智能体能够通过标准化方式连接外部工具和服务。MCP 使 AI 智能体可以访问数据源、API 和各种工具，从而显著提升其能力和适用场景的多样性。</p>
<ul>
<li>C# MCP SDK：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Fcsharp-sdk" target="_blank" title="https://github.com/modelcontextprotocol/csharp-sdk" ref="nofollow noopener noreferrer">github.com/modelcontex…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/812d793e7d804298a82435ced941c698~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=uPUD5dHJGpCPNyHrXfCqoREwRzM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">C#/.NET/.NET Core学习、工作、面试指南</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49f7c96db26c44b99ddb009725ca2f6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=wPR4hGqvcs%2FSk7vHiSC0q4HJsvk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">参考文章</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftiobe.org.cn%2Ftiobe-index" target="_blank" title="https://tiobe.org.cn/tiobe-index" ref="nofollow noopener noreferrer">tiobe.org.cn/tiobe-index</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tiobe.com%2Ftiobe-index" target="_blank" title="https://www.tiobe.com/tiobe-index" ref="nofollow noopener noreferrer">www.tiobe.com/tiobe-index</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink源码阅读：Netty通信]]></title>    <link>https://juejin.cn/post/7593164154631815177</link>    <guid>https://juejin.cn/post/7593164154631815177</guid>    <pubDate>2026-01-09T12:13:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593164154631815177" data-draft-id="7593164154631798793" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink源码阅读：Netty通信"/> <meta itemprop="keywords" content="Flink,大数据"/> <meta itemprop="datePublished" content="2026-01-09T12:13:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink源码阅读：Netty通信
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:13:27.000Z" title="Fri Jan 09 2026 12:13:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前文中我们了解了 Flink 的数据交互过程，上游的 Task 将数据写入到 ResultSubpartition 的 buffers 队列中。下游的 Task 通过 LocalInputChannel 和 RemoteInputChannel 消费上游的数据。</p>
<p>LocalInputChannel 是上下游的 Task 部署在同一个 TaskManager 时使用的，在本地即可完成数据交换，无需网络通信。当上下游的 Task 部署在不同的 TaskManager 时，就需要用到 RemoteInputChannel，Flink 利用 Netty 来进行数据交互。本文我们来一起梳理一下 Netty 相关的源码。</p>
<h3 data-id="heading-0">初始化</h3>
<p>我们先来看 NettyServer 和 NettyClient 的初始化过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ba4706fbb604cc5884638aaad02c95b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=ro8kY7ZVGC%2BQRjha4Mu06IgMWMI%3D" alt="NettyInit" loading="lazy"/></p>
<p>Netty 的初始化阶段是在 TaskManager 启动的过程中执行的。在 <code>TaskManagerServices.fromConfiguration</code> 方法中，会创建并启动 ShuffleEnvironment。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> TaskManagerServices <span class="hljs-title function_ invoke__">fromConfiguration</span>(
        TaskManagerServicesConfiguration taskManagerServicesConfiguration,
        PermanentBlobService permanentBlobService,
        MetricGroup taskManagerMetricGroup,
        ExecutorService ioExecutor,
        ScheduledExecutor scheduledExecutor,
        FatalErrorHandler fatalErrorHandler,
        WorkingDirectory workingDirectory)
        throws <span class="hljs-built_in">Exception</span> {
    ...

    <span class="hljs-keyword">final</span> ShuffleEnvironment<span class="hljs-meta">&lt;?</span>, <span class="hljs-meta">?&gt;</span> shuffleEnvironment =
            <span class="hljs-title function_ invoke__">createShuffleEnvironment</span>(
                    taskManagerServicesConfiguration,
                    taskEventDispatcher,
                    taskManagerMetricGroup,
                    ioExecutor,
                    scheduledExecutor);
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> listeningDataPort = shuffleEnvironment.<span class="hljs-title function_ invoke__">start</span>();
    ...
}
</code></pre>
<p>我们顺着调用链路可以一直找到 <code>NettyShuffleServiceFactory.createNettyShuffleEnvironment</code> 方法，这个方法中创建了 NettyConnectionManager，在 NettyConnectionManager 中有几个很重要的对象。</p>
<pre><code class="hljs language-ini" lang="ini">public NettyConnectionManager(
        NettyBufferPool bufferPool,
        ResultPartitionProvider partitionProvider,
        TaskEventPublisher taskEventPublisher,
        NettyConfig nettyConfig,
        boolean connectionReuseEnabled) {

    <span class="hljs-attr">this.server</span> = new NettyServer(nettyConfig)<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.client</span> = new NettyClient(nettyConfig)<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.bufferPool</span> = checkNotNull(bufferPool)<span class="hljs-comment">;</span>

    <span class="hljs-attr">this.partitionRequestClientFactory</span> =
            new PartitionRequestClientFactory(
                    client, nettyConfig.getNetworkRetries(), connectionReuseEnabled)<span class="hljs-comment">;</span>

    <span class="hljs-attr">this.nettyProtocol</span> =
            new NettyProtocol(
                    checkNotNull(partitionProvider), checkNotNull(taskEventPublisher))<span class="hljs-comment">;</span>
}
</code></pre>
<p>server 和 client 不需要多介绍，就是 Netty 的服务端和客户端。bufferPool 是缓冲池，用于存储要传输的数据。nettyProtocol 提供了 NettyClient 和 NettyServer 引导启动注册的 Channel Handler。</p>
<p>后面就是创建 NettyShuffleEnvironment 及其需要的对象了。在创建完成后，会调用它的 start 方法启动。这个启动方法就是调用了 <code>connectionManager.start</code>，在 NettyConnectionManager 中，就是初始化客户端和服务端。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">start</span>() throws IOException</span> {
    client.<span class="hljs-keyword">init</span>(nettyProtocol, bufferPool);

    <span class="hljs-keyword">return</span> server.<span class="hljs-keyword">init</span>(nettyProtocol, bufferPool);
}
</code></pre>
<h4 data-id="heading-1">client 初始化</h4>
<p>client 的初始化过程是先创建并初始化 Bootstrap。</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">initEpollBootstrap</span>() {
    <span class="hljs-comment">// Add the server port number to the name in order to distinguish</span>
    <span class="hljs-comment">// multiple clients running on the same host.</span>
    String name =
            NettyConfig<span class="hljs-selector-class">.CLIENT_THREAD_GROUP_NAME</span> + " (" + config.getServerPortRange() + ")";

    EpollEventLoopGroup epollGroup =
            new <span class="hljs-built_in">EpollEventLoopGroup</span>(
                    config.getClientNumThreads(), NettyServer<span class="hljs-selector-class">.getNamedThreadFactory</span>(name));
    bootstrap<span class="hljs-selector-class">.group</span>(epollGroup)<span class="hljs-selector-class">.channel</span>(EpollSocketChannel.class);

    config<span class="hljs-selector-class">.getTcpKeepIdleInSeconds</span>()
            <span class="hljs-selector-class">.ifPresent</span>(idle -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPIDLE, idle));
    config<span class="hljs-selector-class">.getTcpKeepInternalInSeconds</span>()
            <span class="hljs-selector-class">.ifPresent</span>(
                    interval -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPINTVL, interval));
    config<span class="hljs-selector-class">.getTcpKeepCount</span>()
            <span class="hljs-selector-class">.ifPresent</span>(count -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPCNT, count));
}
</code></pre>
<p>初始化过程重要设置 EventLoopGroup 和 channel，可以用 epoll 的话就用 epoll，否则就用 nio。设置好这些后就是设置了一些通道参数（连接超时时间、Bufffer 池等）。</p>
<p>到这里 client 的初始化其实并没有结束，还需要设置 Handler 流水线，这些工作是在 Task 启动时执行了。</p>
<h4 data-id="heading-2">server 初始化</h4>
<p>server 的初始化过程是先创建并初始化了 ServerBootstrap。之后同样也是设置 EventLoopGroup 和 channel，以及通道相关的各种参数。</p>
<p>设置好之后，会添加 ChannelHandler 流水线，这里的 ChannelHandler 流水线就是我们前面创建的 NettyProtocol 提供的。</p>
<pre><code class="hljs language-ini" lang="ini">public ChannelHandler<span class="hljs-section">[]</span> getServerChannelHandlers() {
    PartitionRequestQueue <span class="hljs-attr">queueOfPartitionQueues</span> = new PartitionRequestQueue()<span class="hljs-comment">;</span>
    PartitionRequestServerHandler <span class="hljs-attr">serverHandler</span> =
            new PartitionRequestServerHandler(
                    partitionProvider, taskEventPublisher, queueOfPartitionQueues)<span class="hljs-comment">;</span>

    return new ChannelHandler<span class="hljs-section">[]</span> {
        messageEncoder,
        new NettyMessage.NettyMessageDecoder(),
        serverHandler,
        queueOfPartitionQueues
    }<span class="hljs-comment">;</span>
}
</code></pre>
<p>流水线上包含了消息编码器、解码器、PartitionRequestServerHandler 请求服务端处理器和 PartitionRequestQueue 分区请求队列。</p>
<p>这些都设置好之后，就开始启动 NettyServer 服务了。</p>
<pre><code class="hljs language-scss" lang="scss">Iterator&lt;Integer&gt; portsIterator = config<span class="hljs-selector-class">.getServerPortRange</span>()<span class="hljs-selector-class">.getPortsIterator</span>();
while (portsIterator.hasNext() &amp;&amp; bindFuture == null) {
    Integer port = portsIterator<span class="hljs-selector-class">.next</span>();
    LOG<span class="hljs-selector-class">.debug</span>("Trying to bind Netty server to port: {}", port);

    bootstrap<span class="hljs-selector-class">.localAddress</span>(config.getServerAddress(), port);
    try {
        bindFuture = bootstrap<span class="hljs-selector-class">.bind</span>()<span class="hljs-selector-class">.syncUninterruptibly</span>();
    } catch (Exception e) {
        <span class="hljs-comment">// syncUninterruptibly() throws checked exceptions via Unsafe</span>
        <span class="hljs-comment">// continue if the exception is due to the port being in use, fail early</span>
        <span class="hljs-comment">// otherwise</span>
        if (isBindFailure(e)) {
            LOG<span class="hljs-selector-class">.debug</span>("Failed to bind Netty server", e);
        } else {
            throw e;
        }
    }
}

if (bindFuture == null) {
    throw new <span class="hljs-built_in">BindException</span>(
            "Could not start rest endpoint on any port in port range "
                    + config.getServerPortRange());
}

localAddress = (InetSocketAddress) bindFuture<span class="hljs-selector-class">.channel</span>()<span class="hljs-selector-class">.localAddress</span>();
</code></pre>
<h3 data-id="heading-3">客户端请求远端子分区</h3>
<p>服务端和客户端初始化之后，在 Task 运行时，会先完成 Client 的 ChannelHandler 的配置，然后请求 Netty 远端服务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b99d38c65200487f8f5f1d7e05cc2b36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=7ig7BNFyUGozffh2yuryKQkj%2FHo%3D" alt="NettyRequestPartition" loading="lazy"/></p>
<p>我们来看具体过程，在 Task 初始化时，会调用 <code>StreamTask.invoke</code> 方法，其内部会调用 <code>StreamTask.restoreStateAndGate</code> 方法，这里会便利 Task 的所有 InputGate，然后调用 requestPartitions。在 InputGate 的 requestPartitions 逻辑中，又便利所有的 InputChannel，调用 requestSubpartitions。</p>
<pre><code class="hljs language-scss" lang="scss">for (InputGate inputGate : inputGates) {
    recoveredFutures<span class="hljs-selector-class">.add</span>(inputGate.getStateConsumedFuture());

    inputGate
            <span class="hljs-selector-class">.getStateConsumedFuture</span>()
            <span class="hljs-selector-class">.thenRun</span>(
                    () -&gt;
                            mainMailboxExecutor<span class="hljs-selector-class">.execute</span>(
                                    inputGate::requestPartitions,
                                    "Input gate request partitions"));
}


private void <span class="hljs-built_in">internalRequestPartitions</span>() {
    for (InputChannel inputChannel : inputChannels()) {
        try {
            inputChannel<span class="hljs-selector-class">.requestSubpartitions</span>();
        } catch (Throwable t) {
            inputChannel<span class="hljs-selector-class">.setError</span>(t);
            return;
        }
    }
}
</code></pre>
<p>我们来看 <code>RemoteInputChannel.requestSubpartitions</code> 的逻辑。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">requestSubpartitions</span>() throws IOException, InterruptedException</span> {
    <span class="hljs-keyword">if</span> (partitionRequestClient == <span class="hljs-literal">null</span>) {
        LOG.debug(
                <span class="hljs-string">"{}: Requesting REMOTE subpartitions {} of partition {}. {}"</span>,
                <span class="hljs-keyword">this</span>,
                consumedSubpartitionIndexSet,
                partitionId,
                channelStatePersister);
        <span class="hljs-comment">// Create a client and request the partition</span>
        <span class="hljs-keyword">try</span> {
            partitionRequestClient =
                    connectionManager.createPartitionRequestClient(connectionId);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-comment">// IOExceptions indicate that we could not open a connection to the remote</span>
            <span class="hljs-comment">// TaskExecutor</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> PartitionConnectionException(partitionId, e);
        }

        partitionRequestClient.requestSubpartition(
                partitionId, consumedSubpartitionIndexSet, <span class="hljs-keyword">this</span>, <span class="hljs-number">0</span>);
    }
}
</code></pre>
<p>这里主要有两个步骤，先是创建 partitionRequestClient，然后调用 requestSubpartition。</p>
<h4 data-id="heading-4">创建请求客户端</h4>
<p>PartitionRequestClient 是在 <code>PartitionRequestClientFactory.connect</code> 中创建的。先调用了 <code>NettyClient.connect</code>，同步等待客户端连接到服务端，这个过程中会进行 ChannelHandler 配置，也就是我们在初始化的过程中介绍的，NettyClient 没有完成的步骤。</p>
<pre><code class="hljs language-scss" lang="scss">public ChannelHandler<span class="hljs-selector-attr">[]</span> <span class="hljs-built_in">getClientChannelHandlers</span>() {
    NetworkClientHandler networkClientHandler = new <span class="hljs-built_in">CreditBasedPartitionRequestClientHandler</span>();

    return new ChannelHandler<span class="hljs-selector-attr">[]</span> {
        messageEncoder,
        new <span class="hljs-built_in">NettyMessageClientDecoderDelegate</span>(networkClientHandler),
        networkClientHandler
    };
}
</code></pre>
<p>Handler 包括了消息编码器、解码器和 CreditBasedPartitionRequestClientHandler 这个基于 Credit 的分区请求客户端处理器。Handler 配置好之后会利用 bootstrap 连接到服务端。</p>
<p>在获取到 Channel 和 NetworkClientHandler 之后，就直接创建了 NettyPartitionRequestClient。</p>
<h4 data-id="heading-5">请求子分区数据</h4>
<p>让我们再回到 RemoteInputChannel 的 requestSubpartitions 方法中，现在我们创建好了 NettyPartitionRequestClient，接下来就是调用它的 requestSubpartition 方法来发起请求。</p>
<p>这里逻辑也比较简单：</p>
<ol>
<li>向 NetworkClientHandler 注册当前 RemoteInputChannel。</li>
<li>构造请求对象 PartitionRequest，这里包含了分区 ID、子分区索引、inputChannel ID 以及初识的 Credit。</li>
<li>调用 <code>tcpChannel.writeAndFlush</code> 发起请求，并添加请求失败的监听。</li>
<li>如果请求失败，移除当前 inputChannel。</li>
</ol>
<h3 data-id="heading-6">服务端响应</h3>
<p>现在数据到了服务端，我们来看服务端处理的具体过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/339a67c8d7c64865bc109c665e60c60c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=xpUm9gskdJn323LGxtvTmcAThSc%3D" alt="NettyServerHandler" loading="lazy"/></p>
<p>在 NettyServer 初始化的过程中，我们添加了两个重要的 Handler，分别是 PartitionRequestServerHandler 和 PartitionRequestQueue。服务端响应数据的过程就是这两个 Handler 在发挥作用。</p>
<p>PartitionRequestServerHandler 负责处理 Client 端通过 PartitionRequestClient 发送的请求，处理过程是先创建 CreditBasedSequenceNumberingViewReader 类型的 reader，然后将它放入 PartitionRequestQueue 维护的 reader 队列中。PartitionRequestQueue 会监听 Netty Channel 的可写入状态，当 Netty Channel 可写入时，会消费数据并写入网络。</p>
<p>下面我们来看具体的源码。</p>
<p>服务端的响应入口在 <code>PartitionRequestServerHandler.channelRead0</code> 方法，这里在处理 PartitionRequest 请求时，先是创建 CreditBasedSequenceNumberingViewReader，然后调用 requestSubpartitionViewOrRegisterListener。</p>
<p>requestSubpartitionViewOrRegisterListener 的逻辑是创建 ResultSubpartitionView，并提醒 PartitionRequestQueue 有数据可用。</p>
<pre><code class="hljs language-ini" lang="ini">Optional&lt;ResultSubpartitionView&gt; <span class="hljs-attr">subpartitionViewOptional</span> =
        partitionProvider.createSubpartitionViewOrRegisterListener(
                resultPartitionId,
                subpartitionIndexSet,
                this,
                partitionRequestListener)<span class="hljs-comment">;</span>
...

notifyDataAvailable(subpartitionView)<span class="hljs-comment">;</span>
</code></pre>
<p>ResultSubpartitionView 就是用来消费 ResultSubpartition 的数据。</p>
<p>notifyDataAvailable 内部调用了 notifyReaderNonEmpty，notifyReaderNonEmpty 又触发了 userEventTriggered，这里调用 enqueueAvailableReader 将 reader 放入到可用队列 availableReaders 中。</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">enqueueAvailableReader</span>(final NetworkSequenceViewReader reader) throws Exception {
    if (reader.isRegisteredAsAvailable()) {
        return;
    }

    ResultSubpartitionView<span class="hljs-selector-class">.AvailabilityWithBacklog</span> availabilityWithBacklog =
            reader<span class="hljs-selector-class">.getAvailabilityAndBacklog</span>();
    if (!availabilityWithBacklog.isAvailable()) {
        int backlog = availabilityWithBacklog<span class="hljs-selector-class">.getBacklog</span>();
        if (backlog &gt; <span class="hljs-number">0</span> &amp;&amp; reader.needAnnounceBacklog()) {
            <span class="hljs-built_in">announceBacklog</span>(reader, backlog);
        }
        return;
    }

    <span class="hljs-comment">// Queue an available reader for consumption. If the queue is empty,</span>
    <span class="hljs-comment">// we try trigger the actual write. Otherwise this will be handled by</span>
    <span class="hljs-comment">// the writeAndFlushNextMessageIfPossible calls.</span>
    boolean triggerWrite = availableReaders<span class="hljs-selector-class">.isEmpty</span>();
    <span class="hljs-built_in">registerAvailableReader</span>(reader);

    if (triggerWrite) {
        <span class="hljs-built_in">writeAndFlushNextMessageIfPossible</span>(ctx.channel());
    }
}
</code></pre>
<p>如果 reader 是队列中的第一个元素，会触发数据写入网络。</p>
<p>writeAndFlushNextMessageIfPossible 的处理步骤如下：</p>
<ol>
<li>取出可用 reader。</li>
<li>调用 <code>reader.getNextBuffer</code> 获取数据。</li>
<li>如果 reader 仍然可用，将其加回队列。</li>
<li>向下游写入数据并添加下次写入的监听。</li>
</ol>

<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> BufferAndAvailability <span class="hljs-title function_">getNextBuffer</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-type">BufferAndBacklog</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> subpartitionView.getNextBuffer();
    <span class="hljs-keyword">if</span> (next != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (next.buffer().isBuffer() &amp;&amp; --numCreditsAvailable &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"no credit available"</span>);
        }

        <span class="hljs-keyword">final</span> Buffer.<span class="hljs-type">DataType</span> <span class="hljs-variable">nextDataType</span> <span class="hljs-operator">=</span> getNextDataType(next);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferAndAvailability</span>(
                next.buffer(), nextDataType, next.buffersInBacklog(), next.getSequenceNumber());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p>在 getNextBuffer 方法中，会将 credit 值减 1，并判断是否小于 0。如果小于 0 会抛出异常，reader 是否可用也是根据 numCreditsAvailable 是否大于 0 来判断的。</p>
<h3 data-id="heading-7">客户端接收数据</h3>
<p>NettyClient 在消费数据时，同样也是以 ChannelHandler 作为入口。这里的入口方法是 <code>CreditBasedPartitionRequestClientHandler.channelRead</code> 。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e3e211ea7d445e8a040cfd2e5bac1dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=QzLjqwFQqFXMQxN4wlfezdFTli4%3D" alt="NettyClientHandler" loading="lazy"/></p>
<p>在 decodeMsg 方法中，先解码 msg，判断 InputChannel 是否可用，如果不可用，则取消当前 InputChannel 的订阅。如果可用，继续调用 decodeBufferOrEvent 进行处理。decodeBufferOrEvent 的核心逻辑是调用 <code>RemoteInputChannel.onBuffer</code> 方法，将数据加入到 receivedBuffers 队列。</p>
<p>如果 receivedBuffers 队列在此之前处于空闲状态，会调用 notifyChannelNonEmpty，将当前 RemoteInputChannel 加入到 inputChannelsWithData 队列中，同时还会唤醒 inputChannelsWithData 上的阻塞线程，让 inputGate 可以消费 RemoteInputChannel 的数据。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> boolean <span class="hljs-title">queueChannelUnsafe</span>(<span class="hljs-params">InputChannel channel, boolean priority</span>)</span> {
    assert Thread.holdsLock(inputChannelsWithData);
    <span class="hljs-keyword">if</span> (channelsWithEndOfPartitionEvents.<span class="hljs-keyword">get</span>(channel.getChannelIndex())) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    final boolean alreadyEnqueued =
            enqueuedInputChannelsWithData.<span class="hljs-keyword">get</span>(channel.getChannelIndex());
    <span class="hljs-keyword">if</span> (alreadyEnqueued
            &amp;&amp; (!priority || inputChannelsWithData.containsPriorityElement(channel))) {
        <span class="hljs-comment">// already notified / prioritized (double notification), ignore</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 当前 inputChannel 加入到 inputChannelsWithData</span>
    inputChannelsWithData.<span class="hljs-keyword">add</span>(channel, priority, alreadyEnqueued);
    <span class="hljs-keyword">if</span> (!alreadyEnqueued) {
        enqueuedInputChannelsWithData.<span class="hljs-keyword">set</span>(channel.getChannelIndex());
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">// 唤醒线程</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyDataAvailable</span>()</span> {
    availabilityMonitor.notifyAll();
    toNotify = inputGate.availabilityHelper.getUnavailableToResetAvailable();
}
</code></pre>
<p>如果客户端有积压，还需要根据积压申请 Buffer 并更新 Credit 值。这里申请的 buffer 数量为积压数量+初识 Credit 值。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSenderBacklog</span><span class="hljs-params">(<span class="hljs-type">int</span> backlog)</span> <span class="hljs-keyword">throws</span> IOException {
    notifyBufferAvailable(bufferManager.requestFloatingBuffers(backlog + initialCredit));
}
</code></pre>
<p>如果 RemoteInputChannel 没有足够的 buffer，则会向 LocalBufferPool 申请新的 buffer，如果申请不到，会加一个监听，等 LocalBufferPool 有空闲时再触发申请 buffer。</p>
<pre><code class="hljs language-ini" lang="ini">private int tryRequestBuffers() {
    assert Thread.holdsLock(bufferQueue)<span class="hljs-comment">;</span>

    int <span class="hljs-attr">numRequestedBuffers</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    while (bufferQueue.getAvailableBufferSize() &lt; numRequiredBuffers
            &amp;&amp; !isWaitingForFloatingBuffers) {
        BufferPool <span class="hljs-attr">bufferPool</span> = inputChannel.inputGate.getBufferPool()<span class="hljs-comment">;</span>
        Buffer <span class="hljs-attr">buffer</span> = bufferPool.requestBuffer()<span class="hljs-comment">;</span>
        if (buffer != null) {
            bufferQueue.addFloatingBuffer(buffer)<span class="hljs-comment">;</span>
            numRequestedBuffers++<span class="hljs-comment">;</span>
        } else if (bufferPool.addBufferListener(this)) {
            <span class="hljs-attr">isWaitingForFloatingBuffers</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
            break<span class="hljs-comment">;</span>
        }
    }
    return numRequestedBuffers<span class="hljs-comment">;</span>
}
</code></pre>
<p>当 RemoteInputChannel 申请到了需要的 buffer 之后，就会向 NettyServer 发送 AddCredit 消息，请求更新 Credit 值。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyCreditAvailable</span>() throws IOException</span> {
    checkPartitionRequestQueueInitialized();

    partitionRequestClient.notifyCreditAvailable(<span class="hljs-keyword">this</span>);
}


<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyCreditAvailable</span>(<span class="hljs-params">RemoteInputChannel inputChannel</span>)</span> {
    sendToChannel(<span class="hljs-keyword">new</span> AddCreditMessage(inputChannel));
}
</code></pre>
<p>NettyServer 收到请求后，会将对应的 Credit 值进行更新。</p>
<pre><code class="hljs language-ini" lang="ini">else if (<span class="hljs-attr">msgClazz</span> == AddCredit.class) {
    AddCredit <span class="hljs-attr">request</span> = (AddCredit) msg<span class="hljs-comment">;</span>

    outboundQueue.addCreditOrResumeConsumption(
            request.receiverId, reader -&gt; reader.addCredit(request.credit))<span class="hljs-comment">;</span>
}

void addCreditOrResumeConsumption(
        InputChannelID receiverId, Consumer&lt;NetworkSequenceViewReader&gt; operation)
        throws Exception {
    if (fatalError) {
        return<span class="hljs-comment">;</span>
    }

    NetworkSequenceViewReader <span class="hljs-attr">reader</span> = obtainReader(receiverId)<span class="hljs-comment">;</span>

    operation.accept(reader)<span class="hljs-comment">;</span>
    enqueueAvailableReader(reader)<span class="hljs-comment">;</span>
}


public void addCredit(int creditDeltas) {
    numCreditsAvailable += creditDeltas<span class="hljs-comment">;</span>
}
</code></pre>
<p>此外，Flink 还有两种场景会更新 Credit 值。</p>
<p>一种是 LocalBufferPool 回收空闲 buffer 时，会将 buffer 分配给申请者，分配之后会调用对应 InputChannel 的 notifyBufferAvailable 方法通知更新 Credit。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91654d63dada40089adc39ddeaa32f16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=%2B6Q5%2FPKgLnUQeBSJ7%2BBwQflI7Ik%3D" alt="LocalBufferPool" loading="lazy"/></p>
<p>另一种是 RemoteInputChannel 独占的 buffer 队列释放 buffer 时，会触发 Credit 更新。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c5cb9fddc0d4e18802107951125230b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=T4scDtDnWrMIvABCUiom8RV0bTQ%3D" alt="BufferManager" loading="lazy"/></p>
<h3 data-id="heading-8">反压</h3>
<p>通过前面的学习，我们其实已经理解了反压的机制了。当前 Flink 的反压就是通过 Credit 来实现反压的，如果下游数据处理速度慢，Credit 会被耗尽，上游也就不会继续处理和下发数据了。直到下游处理完成，有了空闲的 buffer，此时向上游反馈更新 Credit 值，上游就会继续处理数据。</p>
<h3 data-id="heading-9">总结</h3>
<p>最后我们总结一下，本文我们一起梳理了 Flink Netty 相关的源码。包括 NettyClient 和 NettyServer 的初始化，初始化过程中会创建一系列 ChannelHandler，之后利用这些Handler 处理数据，数据处理包括 Client 端的发送和接收消息，Server 端处理消息的过程。中间还穿插着 Credit 的处理。Flink 的反压逻辑就是依赖于 Credit 来实现的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基准测试：Akamai云上的NVIDIA RTX Pro 6000 Blackwell]]></title>    <link>https://juejin.cn/post/7593173569871806516</link>    <guid>https://juejin.cn/post/7593173569871806516</guid>    <pubDate>2026-01-09T12:18:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593173569871806516" data-draft-id="7593224937075474484" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基准测试：Akamai云上的NVIDIA RTX Pro 6000 Blackwell"/> <meta itemprop="keywords" content="人工智能,云计算,测试"/> <meta itemprop="datePublished" content="2026-01-09T12:18:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AKAMAI"/> <meta itemprop="url" content="https://juejin.cn/user/829502942352628"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基准测试：Akamai云上的NVIDIA RTX Pro 6000 Blackwell
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/829502942352628/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AKAMAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:18:22.000Z" title="Fri Jan 09 2026 12:18:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0"><strong><strong>执行摘要</strong></strong></h4>
<p>基准测试显示，在Akamai云上运行的NVIDIA RTX PRO™ 6000 Blackwell推理吞吐量比H100最高提升1.63倍，在100个并发请求下每台服务器达到24,240 TPS。</p>
<hr/>
<p>如您所在的企业也在考虑采购云服务或进行云迁移，</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_260109_blogarticles241" target="_blank" title="https://www.akamai.com/zh/lp/akamai-cloud-computing-freetrial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_260109_blogarticles241" ref="nofollow noopener noreferrer">点击链接</a>了解Akamai Linode解决方案，现在申请试用可得高达5000美元专属额度</p>
<hr/>
<h4 data-id="heading-1"><strong><strong>为Akamai推理云进行基准测试</strong></strong></h4>
<p>本周，Akamai宣布推出<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Fblog%2Fcloud%2Fai-edge-all-you-need%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejing_260109_external1_blogarticles241" target="_blank" title="https://www.akamai.com/zh/blog/cloud/ai-edge-all-you-need?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejing_260109_external1_blogarticles241" ref="nofollow noopener noreferrer">Akamai推理云</a>。我们将自身在全球分布式架构方面的专业知识与NVIDIA Blackwell AI基础设施相结合，从根本上重新思考并扩展了释放AI真正潜力所需的加速计算能力。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Fblog%2Fcloud%2Fenabling-ai-everywhere-with-akamai-inference-cloud%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejing_260109_external2_blogarticles241" target="_blank" title="https://www.akamai.com/zh/blog/cloud/enabling-ai-everywhere-with-akamai-inference-cloud?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejing_260109_external2_blogarticles241" ref="nofollow noopener noreferrer">Akamai推理云</a>平台将NVIDIA RTX PRO™服务器（配备NVIDIA RTX PRO 6000 Blackwell服务器版GPU、NVIDIA BlueField-3® DPU和NVIDIA AI Enterprise软件）与Akamai的分布式云计算基础设施和全球边缘网络（在全球拥有超过4,400个站点）相结合。</p>
<h4 data-id="heading-2"><strong><strong>高效、通用且优化的GPU</strong></strong></h4>
<p>分布式推理和下一代智能体体验需要高效、通用并能针对并发实时工作负载进行优化的GPU。RTX PRO 6000 Blackwell完全满足这三项要求。其FP4精度模式以数据中心级GPU的一小部分功耗和成本提供了卓越的吞吐量，使得将其部署到数百个站点变得切实可行。</p>
<p>该架构支持在单个GPU上并发处理包括文本、视觉和语音在内的多模态工作负载，减少了对专用加速器的需求，并限制了不必要的网络数据传输。</p>
<p>NVIDIA RTX Pro服务器针对代理式AI、工业和物理AI、科学计算、数据分析与模拟、视觉计算和企业应用等工作负载进行了优化。</p>
<p>NVIDIA强调，这些服务器能够实现高达6倍的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Fglossary%2Fwhat-is-a-large-language-model%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejing_260109_external3_blogarticles241" target="_blank" title="https://www.akamai.com/zh/glossary/what-is-a-large-language-model?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejing_260109_external3_blogarticles241" ref="nofollow noopener noreferrer">大语言模型</a>推理吞吐量、4倍更快的合成数据生成速度、7倍更快的基因组序列比对速度、3倍更高的工程模拟吞吐量、4倍更佳的实时渲染性能，以及4倍更多的并发多实例GPU工作负载。</p>
<h4 data-id="heading-3"><strong><strong>性能验证</strong></strong></h4>
<p>为了验证性能，我们测试了在Akamai云上运行的NVIDIA RTX Pro 6000 Blackwell服务器版GPU，并使用NVIDIA LaunchPad环境将其与NVIDIA H100 NVL 96GB进行了基准比较。</p>
<p>我们的目标是了解，与目前行业的黄金标准相比，下一代RTX Pro 6000 GPU在实际推理工作负载中的表现如何。</p>
<h4 data-id="heading-4"><strong><strong>基准测试结果展示</strong></strong></h4>
<p>基准测试结果证实了NVIDIA RTX Pro 6000 Blackwell在Akamai云上的设计优势。</p>
<ul>
<li>相较于H100（FP8），吞吐量提升<strong><strong>1.63倍</strong></strong>，这表明RTX Pro 6000 Blackwell以更小巧、更易于部署的规格提供了数据中心级的性能，非常适合于分布式环境。</li>
<li>从FP8切换到FP4带来的<strong><strong>1.32倍</strong></strong>性能提升，展示了NVIDIA的精度效率如何直接转化为在边缘更快、更具成本效益的推理。</li>
<li>在<strong><strong>100+并发请求</strong></strong>下保持稳定的性能，验证了该GPU处理全球分布式推理中多租户、对延迟敏感的工作负载的能力。</li>
</ul>
<p>综合来看，这些结果表明，Blackwell的效率和并发性优势使其成为Akamai分布式推理架构的理想基础，能够在我们的全球网络中提供高吞吐、低延迟和可扩展的性能。</p>
<h4 data-id="heading-5"><strong><strong>基准测试概述</strong></strong></h4>
<p>我们遵循NVIDIA的基准测试方法来评估一致负载条件下的推理性能。在本文中，我们将介绍设置、方法和关键发现，并讨论这些结果对在Akamai云上运行AI工作负载的意义。</p>
<p><strong><strong>设置</strong></strong></p>
<p>为了评估Akamai云上的NVIDIA RTX Pro 6000 GPU，我们使用了<strong><strong>Llama-3.3-Nemotron-Super-49B-v1.5</strong></strong>模型，这是一个源于Meta Llama-3.3-70B-Instruct（即参考模型）的大语言模型。它是一个针对推理、人类聊天偏好以及智能体任务（如RAG和工具调用）进行后训练的推理模型。</p>
<p>我们为同一模型使用了两个NVIDIA推理微服务配置文件，以比较精度模式并了解其对性能和效率的影响。这两个配置文件——tensorrt_llm-rtx6000_blackwell_sv-fp8-tp1-pp1-throughput-2bb5 和 tensorrt_llm-rtx6000_blackwell_sv-nvfp4-tp1-pp1-throughput-2bb5——除了精度设置外完全相同。</p>
<p>第一个使用<strong><strong>FP8</strong></strong>精度，第二个使用NVIDIA的<strong><strong>FP4</strong></strong>精度。NVIDIA的FP4版本直接在NVIDIA Blackwell GPU中得到支持。</p>
<p>通过运行两者，我们旨在观察降低数值精度如何影响吞吐量和延迟。NVFP4以低于1%的精度损失带来了显著的性能和效率提升，实现了更快、更低功耗的大规模推理，而FP8则提供了更高的数值精度。比较两者有助于为实际工作负载确定速度、效率和推理保真度之间的最佳权衡。</p>
<p>我们在位于Akamai云LAX数据中心的NVIDIA RTX Pro 6000 Blackwell服务器版GPU上运行了测试。为了进行比较，我们使用了NVIDIA LaunchPad环境中的NVIDIA H100 GPU。</p>
<p><strong><strong>方法论</strong></strong></p>
<p>对于此基准测试，我们运行了一个旨在测量现实负载条件下基线推理性能的压力测试。每个请求处理200个输入令牌并生成200个输出令牌，代表了大语言模型典型的短提示-响应交互。</p>
<p>为了测试可扩展性和一致性，我们执行了<strong><strong>100个并发运行</strong></strong>，使我们能够观察系统处理持续同时推理量时的吞吐量和延迟行为。这种方法提供了模型和硬件在生产类工作负载下性能的一个受控但具有代表性的快照。</p>
<p>我们测量了两个关键指标：<strong><strong>首令牌时间（TTFT）<strong><strong>和</strong></strong>每秒令牌数（TPS）</strong></strong>。TTFT以毫秒为单位，衡量模型在收到提示后开始生成响应的速度——这是延迟和用户感知响应性的重要指标。TPS衡量整体吞吐量，显示系统在生成开始后每秒可以生成多少令牌。</p>
<p>两者结合提供了现实世界性能的平衡视图，反映了初始推理的速度以及负载下的持续输出效率。</p>
<p>作为基准测试方法的一部分，我们运行了两组测试来评估NVIDIA RTX 6000 Blackwell服务器版GPU的性能特征。</p>
<ol>
<li><strong><strong>FP4与FP8精度比较</strong></strong><br/>
我们在同一模型上测试了两个NIM配置文件——一个使用<strong><strong>FP8</strong></strong>精度，另一个使用FP4精度——以衡量NVIDIA新型<strong><strong>FP4</strong></strong>量化对推理性能的影响。NVIDIA强调FP4是效率和吞吐量方面的一项重大进步。</li>
<li><strong><strong>RTX 6000与H100 GPU比较</strong></strong><br/>
然后，我们将<strong><strong>RTX 6000 Blackwell</strong></strong>的结果与在<strong><strong>NVIDIA LaunchPad</strong></strong>环境中运行的<strong><strong>H100 GPU</strong></strong>进行了比较，通过查看两个NIM配置文件<strong><strong>FP8</strong></strong>及<strong><strong>FP4</strong></strong>来评估实际推理优势。这使我们能够评估RTX 6000不仅在不同精度模式下的表现，还与NVIDIA当前的数据中心GPU标准进行对比。</li>
</ol>
<p><strong><strong>详细结果</strong></strong></p>
<p>我们确定<strong><strong>最佳并发级别为100</strong></strong>——即在100个同时推理请求下，我们观察到了最稳定和最具代表性的性能结果。在C=100时，RTX 6000从FP8切换到FP4精度带来了<strong><strong>1.32倍</strong></strong>的性能提升，显示了NVIDIA FP4量化的效率增益。</p>
<p>与使用FP8精度的H100相比，RTX Pro 6000 Blackwell服务器在使用NVFP4精度时实现了<strong><strong>1.63倍</strong></strong>的性能提升。即使使用FP8，Blackwell服务器也展示了<strong><strong>1.21倍</strong></strong>的优势，显示了超越旧FP8格式的下一代推理优化。</p>
<p>总体而言，在此并发级别下，RTX Pro 6000 Blackwell服务器实现了<strong><strong>3,030.01 TPS</strong></strong>，这相当于我们基础设施即服务（IaaS）虚拟机产品可提供高达<strong><strong>24,240.08 TPS</strong></strong>，突显了Blackwell架构在Akamai云上强大的推理性能和可扩展性。</p>
<h4 data-id="heading-6"><strong><strong>测试1：FP8与FP4精度比较</strong></strong></h4>
<p>RTX Pro 6000 Blackwell FP8与FP4的性能结果。</p>
<p><strong><strong>LAX：NVIDIA RTX Pro 6000 Blackwell服务器 FP8</strong></strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97dcc1f923be419eb98312be84387ba1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565902&amp;x-signature=8xXj7bfALNZ4H2aLJlBK5fqf8RM%3D" alt="" loading="lazy"/></p>
<p><strong><strong>LAX：NVIDIA RTX PRO 6000 Blackwell服务器 FP4</strong></strong></p>
<p><strong><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef4eafab5ac64fc29eeec53b3e1dcc89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565902&amp;x-signature=hizz9DHt833P2ruK6rXaQl8GssI%3D" alt="" loading="lazy"/></strong></strong></p>
<p><strong><strong>测试2：RTX Pro 6000 Blackwell服务器与H100 GPU比较</strong></strong></p>
<p>H100 NVL FP8与RTX Pro 6000 Blackwell服务器 FP8和FP4的性能结果比较。</p>
<p><strong><strong>LaunchPad：H100 NVL FP8</strong></strong></p>
<p><strong><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f10c3ab58ea416e8109eb8ba79ee30a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565902&amp;x-signature=PRTVdLCl2%2F4DOGy96V7Xvzki8W0%3D" alt="" loading="lazy"/></strong></strong></p>
<p><strong><strong>LaunchPad：NVIDIA RTX PRO 6000 Blackwell服务器 FP8</strong></strong></p>
<p><strong><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/716ba7039620466da287b23c3b85973b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565902&amp;x-signature=5%2B83fMvTL8vPnHdFE%2BggyCAhjfM%3D" alt="" loading="lazy"/></strong></strong></p>
<p><strong><strong>LaunchPad：NVIDIA RTX PRO 6000 Blackwell服务器 FP4</strong></strong></p>
<p><strong><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66603aaa9e4e4d819e985e549430ad60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUtBTUFJ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565902&amp;x-signature=125IgRqFZWKwU6SV6uS2wPiq47U%3D" alt="" loading="lazy"/></strong></strong></p>
<h4 data-id="heading-7"><strong><strong>结论</strong></strong></h4>
<p>本次基准测试旨在评估NVIDIA RTX Pro 6000 Blackwell服务器版GPU在Akamai云上执行LLM推理的表现，以及在相似假设下与NVIDIA H100 GPU的比较。使用NVIDIA推荐的基准测试方法，我们测试了FP8和FP4两种精度模式，以了解性能、效率和延迟之间的权衡。</p>
<p>结果清楚地表明，FP4带来了可衡量的增益，在RTX 6000上相比FP8吞吐量提升<strong><strong>1.32倍</strong></strong>。与FP8下的H100相比，RTX 6000（FP4）实现了<strong><strong>1.63倍</strong></strong>的性能提升，突显了Blackwell架构在推理工作负载方面的潜力。</p>
<p>这些发现表明，在Akamai分布式云上运行的RTX 6000 GPU能够以更低的成本和延迟为实际AI推理提供高吞吐量和高效的扩展。对于正在评估GPU方案的团队而言，这种组合能在全球范围内达成速度、效率与可及性的卓越平衡。</p>
<h4 data-id="heading-8"><strong><strong>获取访问权限</strong></strong></h4>
<p>注册以获取在Akamai推理云上使用RTX Pro 6000 Blackwell服务器版的访问权限。</p>
<hr/>
<p>如您所在的企业也在考虑采购云服务或进行云迁移，</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_260109_blogarticles241_end" target="_blank" title="https://www.akamai.com/zh/lp/akamai-cloud-computing-freetrial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_260109_blogarticles241_end" ref="nofollow noopener noreferrer">点击链接</a>了解Akamai Linode解决方案，现在申请试用可得高达5000美元专属额度</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我们来说说 Cookie、Session、Token、JWT]]></title>    <link>https://juejin.cn/post/7593187953271881728</link>    <guid>https://juejin.cn/post/7593187953271881728</guid>    <pubDate>2026-01-09T12:57:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593187953271881728" data-draft-id="7593193235251150900" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我们来说说 Cookie、Session、Token、JWT"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-09T12:57:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小假"/> <meta itemprop="url" content="https://juejin.cn/user/2285197690931932"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我们来说说 Cookie、Session、Token、JWT
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2285197690931932/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小假
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:57:19.000Z" title="Fri Jan 09 2026 12:57:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是认证（Authentication）</h2>
<ul>
<li>通俗地讲就是验证当前用户的身份，证明“你是你自己”（比如：你每天上下班打卡，都需要通过指纹打卡，当你的指纹和系统里录入的指纹相匹配时，就打卡成功）</li>
<li>互联网中的认证：</li>
</ul>

<ul>
<li>
<ul>
<li>用户名密码登录</li>
<li>邮箱发送登录链接</li>
<li>手机号接收验证码</li>
<li>只要你能收到邮箱/验证码，就默认你是账号的主人</li>
</ul>
</li>
</ul>
<h2 data-id="heading-1">什么是授权（Authorization）</h2>
<ul>
<li>用户授予第三方应用访问该用户某些资源的权限</li>
</ul>

<ul>
<li>
<ul>
<li>在安装手机应用的时候，APP 会询问是否允许授予权限（访问相册、地理位置等权限）</li>
<li>在访问微信小程序时，当登录时，小程序会询问是否允许授予权限（获取昵称、头像、地区、性别等个人信息）</li>
</ul>
</li>
</ul>

<ul>
<li>实现授权的方式有：cookie、session、token、OAuth</li>
</ul>
<h2 data-id="heading-2">什么是凭证（Credentials）</h2>
<ul>
<li>实现认证和授权的前提是需要一种媒介（证书）来标记访问者的身份</li>
</ul>

<ul>
<li>
<ul>
<li>在战国时期，商鞅变法，发明了照身帖。照身帖由官府发放，是一块打磨光滑细密的竹板，上面刻有持有人的头像和籍贯信息。国人必须持有，如若没有就被认为是黑户，或者间谍之类的。</li>
<li>在现实生活中，每个人都会有一张专属的居民身份证，是用于证明持有人身份的一种法定证件。通过身份证，可以办理手机卡/银行卡/个人贷款/交通出行等等，这就是认证的凭证。</li>
<li>在互联网应用中，一般网站（如掘金）会有两种模式，游客模式和登录模式。游客模式下，可以正常浏览网站上面的文章，一旦想要点赞/收藏/分享文章，就需要登录或者注册账号。当用户登录成功后，服务器会给该用户使用的浏览器颁发一个令牌（token），这个令牌用来表明身份，每次浏览器发送请求时会带上这个令牌，就可以使用游客模式下无法使用的功能。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-3">什么是 Cookie</h2>
<ul>
<li>HTTP 是无状态的协议（对于事务处理没有记忆能力，每次客户端和服务端会话完成时，服务端不会保存任何会话信息）：每个请求都是完全独立的，服务端无法确认当前访问者的身份信息，无法分辨上一次的请求发送者和这一次的发送者是不是同一个人。所以服务器与浏览器为了进行会话跟踪（知道是谁在访问），就必须主动的去维护一个状态，这个状态用于告知服务端前后两个请求是否来自同一浏览器。而这个状态需要通过 cookie 或者 session 去实现。</li>
<li>cookie 存储在客户端：cookie 是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。</li>
<li>cookie 是不可跨域的：每个 cookie 都会绑定单一的域名，无法在别的域名下获取使用，一级域名和二级域名之间是允许共享使用的（靠的是 domain）。</li>
</ul>
<p>cookie 重要的属性</p>





































<table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>name=value</td><td>键值对，设置 Cookie 的名称及相对应的值，都必须是字符串类型 - 如果值为 Unicode 字符，需要为字符编码。- 如果值为二进制数据，则需要使用 BASE64 编码。</td></tr><tr><td>domain</td><td>指定 cookie 所属域名，默认是当前域名</td></tr><tr><td>path</td><td>指定 cookie 在哪个路径（路由）下生效，默认是 ‘/‘。如果设置为/abc，则只有/abc下的路由可以访问到该 cookie，如：/abc/read。</td></tr><tr><td>maxAge</td><td>cookie 失效的时间，单位秒。如果为整数，则该 cookie 在 maxAge 秒后失效。如果为负数，该 cookie 为临时 cookie ，关闭浏览器即失效，浏览器也不会以任何形式保存该 cookie 。如果为 0，表示删除该 cookie 。默认为 -1。-比 expires 好用。</td></tr><tr><td>expires</td><td>过期时间，在设置的某个时间点后该 cookie 就会失效。一般浏览器的 cookie 都是默认储存的，当关闭浏览器结束这个会话的时候，这个 cookie 也就会被删除</td></tr><tr><td>secure</td><td>该 cookie 是否仅被使用安全协议传输。安全协议有 HTTPS，SSL等，在网络上传输数据之前先将数据加密。默认为false。当 secure 值为 true 时，cookie 在 HTTP 中是无效，在 HTTPS 中才有效。</td></tr><tr><td>httpOnly</td><td>如果给某个 cookie 设置了 httpOnly 属性，则无法通过 JS 脚本 读取到该 cookie 的信息，但还是能通过 Application 中手动修改 cookie，所以只是在一定程度上可以防止 XSS 攻击，不是绝对的安全</td></tr></tbody></table>
<h2 data-id="heading-4">什么是 Session</h2>
<ul>
<li>session 是另一种记录服务器和客户端会话状态的机制</li>
<li>session 是基于 cookie 实现的，session 存储在服务器端，sessionId 会被存储到客户端的cookie 中</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a859eaee2a24037b837ee0c9a1edfec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5YGH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568239&amp;x-signature=gOS9fkxOKw%2Fep58t63nVbKuRI9w%3D" alt="" loading="lazy"/></p>
<ul>
<li>session 认证流程：</li>
</ul>

<ul>
<li>
<ul>
<li>用户第一次请求服务器的时候，服务器根据用户提交的相关信息，创建对应的 Session</li>
<li>请求返回时将此 Session 的唯一标识信息 SessionID 返回给浏览器</li>
<li>浏览器接收到服务器返回的 SessionID 信息后，会将此信息存入到 Cookie 中，同时 Cookie 记录此 SessionID 属于哪个域名</li>
<li>当用户第二次访问服务器的时候，请求会自动判断此域名下是否存在 Cookie 信息，如果存在自动将 Cookie 信息也发送给服务端，服务端会从 Cookie 中获取 SessionID，再根据 SessionID 查找对应的 Session 信息，如果没有找到说明用户没有登录或者登录失效，如果找到 Session 证明用户已经登录可执行后面操作。</li>
</ul>
</li>
</ul>
<p>根据以上流程可知，SessionID 是连接 Cookie 和 Session 的一道桥梁，大部分系统也是根据此原理来验证用户登录状态。</p>
<h2 data-id="heading-5">Cookie 和 Session 的区别</h2>
<ul>
<li>安全性：Session 比 Cookie 安全，Session 是存储在服务器端的，Cookie 是存储在客户端的。</li>
<li>存取值的类型不同：Cookie 只支持存字符串数据，想要设置其他类型的数据，需要将其转换成字符串，Session 可以存任意数据类型。</li>
<li>有效期不同：Cookie 可设置为长时间保持，比如经常使用的默认登录功能，Session 一般失效时间较短，客户端关闭（默认情况下）或者 Session 超时都会失效。</li>
<li>存储大小不同：单个 Cookie 保存的数据不能超过 4K，Session 可存储数据远高于 Cookie，但是当访问量过多，会占用过多的服务器资源。</li>
</ul>
<h2 data-id="heading-6">什么是 Token（令牌）</h2>
<h3 data-id="heading-7">Acesss Token</h3>
<ul>
<li>访问资源接口（API）时所需要的资源凭证</li>
<li>简单 token 的组成：uid(用户唯一的身份标识)、time(当前时间的时间戳)、sign（签名，token 的前几位以哈希算法压缩成的一定长度的十六进制字符串）</li>
<li>特点：</li>
</ul>

<ul>
<li>
<ul>
<li>服务端无状态化、可扩展性好</li>
<li>支持移动端设备</li>
<li>安全</li>
<li>支持跨程序调用</li>
</ul>
</li>
</ul>

<ul>
<li>token 的身份验证流程：</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d90360d6b254a108b2a34941353a887~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5YGH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568239&amp;x-signature=W2RCfhd9EefIaILH12lDb3FXj80%3D" alt="" loading="lazy"/></p>
<ol>
<li>客户端使用用户名跟密码请求登录</li>
<li>服务端收到请求，去验证用户名与密码</li>
<li>验证成功后，服务端会签发一个 token 并把这个 token 发送给客户端</li>
<li>客户端收到 token 以后，会把它存储起来，比如放在 cookie 里或者 localStorage 里</li>
<li>客户端每次向服务端请求资源的时候需要带着服务端签发的 token</li>
<li>服务端收到请求，然后去验证客户端请求里面带着的 token ，如果验证成功，就向客户端返回请求的数据</li>
</ol>
<ul>
<li>每一次请求都需要携带 token，需要把 token 放到 HTTP 的 Header 里</li>
<li>基于 token 的用户认证是一种服务端无状态的认证方式，服务端不用存放 token 数据。用解析 token 的计算时间换取 session 的存储空间，从而减轻服务器的压力，减少频繁的查询数据库</li>
<li>token 完全由应用管理，所以它可以避开同源策略</li>
</ul>
<h3 data-id="heading-8">Refresh Token</h3>
<ul>
<li>另外一种 token——refresh token</li>
<li>refresh token 是专用于刷新 access token 的 token。如果没有 refresh token，也可以刷新 access token，但每次刷新都要用户输入登录用户名与密码，会很麻烦。有了 refresh token，可以减少这个麻烦，客户端直接用 refresh token 去更新 access token，无需用户进行额外的操作。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc194893c4a14663b71e869f9ca59027~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5YGH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568239&amp;x-signature=8aaZXEP5X0lKf70px%2FdsXzuAIcM%3D" alt="" loading="lazy"/></p>
<ul>
<li>Access Token 的有效期比较短，当 Acesss Token 由于过期而失效时，使用 Refresh Token 就可以获取到新的 Token，如果 Refresh Token 也失效了，用户就只能重新登录了。</li>
<li>Refresh Token 及过期时间是存储在服务器的数据库中，只有在申请新的 Acesss Token 时才会验证，不会对业务接口响应时间造成影响，也不需要向 Session 一样一直保持在内存中以应对大量的请求。</li>
</ul>
<h2 data-id="heading-9">Token 和 Session 的区别</h2>
<ul>
<li>Session 是一种记录服务器和客户端会话状态的机制，使服务端有状态化，可以记录会话信息。而 Token 是令牌，访问资源接口（API）时所需要的资源凭证。Token使服务端无状态化，不会存储会话信息。</li>
<li>Session 和 Token 并不矛盾，作为身份认证 Token 安全性比 Session 好，因为每一个请求都有签名还能防止监听以及重放攻击，而 Session 就必须依赖链路层来保障通讯安全了。如果需要实现有状态的会话，仍然可以增加 Session 来在服务器端保存一些状态。</li>
<li>所谓 Session 认证只是简单的把 User 信息存储到 Session 里，因为 SessionID 的不可预测性，暂且认为是安全的。而 Token ，如果指的是 OAuth Token 或类似的机制的话，提供的是 认证 和 授权 ，认证是针对用户，授权是针对 App 。其目的是让某 App 有权利访问某用户的信息。这里的 Token 是唯一的。不可以转移到其它 App上，也不可以转到其它用户上。Session 只提供一种简单的认证，即只要有此 SessionID ，即认为有此 User 的全部权利。是需要严格保密的，这个数据应该只保存在站方，不应该共享给其它网站或者第三方 App。所以简单来说：如果用户数据可能需要和第三方共享，或者允许第三方调用 API 接口，用 Token 。如果永远只是自己的网站，自己的 App，用什么就无所谓了。</li>
</ul>
<h2 data-id="heading-10">什么是 JWT</h2>
<ul>
<li>JSON Web Token（简称 JWT）是目前最流行的跨域认证解决方案。</li>
<li>是一种认证授权机制。</li>
<li>JWT 是为了在网络应用环境间传递声明而执行的一种基于 JSON 的开放标准（RFC 7519）。JWT 的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源。比如用在用户登录上。</li>
<li>可以使用 HMAC 算法或者是 RSA 的公/私秘钥对 JWT 进行签名。因为数字签名的存在，这些传递的信息是可信的。</li>
</ul>
<h3 data-id="heading-11">生成 JWT</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fjwt.io%2Fwww.jsonwebtoken.io%2F" target="_blank" title="https://jwt.io/www.jsonwebtoken.io/" ref="nofollow noopener noreferrer">jwt.io/www.jsonweb…</a></p>
<h3 data-id="heading-12">JWT 的原理</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdbf2b1cd5284bc0ad158b91e2543dc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5YGH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568239&amp;x-signature=VKvM%2BNv6E%2FtZVs0WGwWFISJbiKk%3D" alt="" loading="lazy"/></p>
<ul>
<li>JWT 认证流程：</li>
</ul>

<ul>
<li>
<ul>
<li>用户输入用户名/密码登录，服务端认证成功后，会返回给客户端一个 JWT</li>
<li>客户端将 token 保存到本地（通常使用 localstorage，也可以使用 cookie）</li>
<li>当用户希望访问一个受保护的路由或者资源的时候，需要请求头的 Authorization 字段中使用Bearer 模式添加 JWT，其内容看起来是下面这样</li>
</ul>
</li>
</ul>

<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Authorization: Bearer &lt;token&gt;</span>
</code></pre>
<ul>
<li>服务端的保护路由将会检查请求头 Authorization 中的 JWT 信息，如果合法，则允许用户的行为</li>
<li>因为 JWT 是自包含的（内部包含了一些会话信息），因此减少了需要查询数据库的需要</li>
<li>因为 JWT 并不使用 Cookie 的，所以可以使用任何域名提供 API 服务而不需要担心跨域资源共享问题（CORS）</li>
<li>因为用户的状态不再存储在服务端的内存中，所以这是一种无状态的认证机制</li>
</ul>
<h3 data-id="heading-13">JWT 的使用方式</h3>
<ul>
<li>客户端收到服务器返回的 JWT，可以储存在 Cookie 里面，也可以储存在 localStorage。</li>
</ul>
<h4 data-id="heading-14">方式一</h4>
<ul>
<li>当用户希望访问一个受保护的路由或者资源的时候，可以把它放在 Cookie 里面自动发送，但是这样不能跨域，所以更好的做法是放在 HTTP 请求头信息的 Authorization 字段里，使用 Bearer 模式添加 JWT。</li>
</ul>

<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">GET</span> /calendar/v1/events
<span class="hljs-symbol">Host:</span> api.example.com
<span class="hljs-symbol">Authorization:</span> Bearer &lt;token&gt;
</code></pre>
<ul>
<li>
<ul>
<li>用户的状态不会存储在服务端的内存中，这是一种无状态的认证机制</li>
<li>服务端的保护路由将会检查请求头 Authorization 中的 JWT 信息，如果合法，则允许用户的行为。</li>
<li>由于 JWT 是自包含的，因此减少了需要查询数据库的需要</li>
<li>JWT 的这些特性使得可以完全依赖其无状态的特性提供数据 API 服务，甚至是创建一个下载流服务。</li>
<li>因为 JWT 并不使用 Cookie ，所以可以使用任何域名提供 API 服务而不需要担心跨域资源共享问题（CORS）</li>
</ul>
</li>
</ul>
<h4 data-id="heading-15">方式二</h4>
<ul>
<li>跨域的时候，可以把 JWT 放在 POST 请求的数据体里。</li>
</ul>
<h4 data-id="heading-16">方式三</h4>
<ul>
<li>通过 URL 传输</li>
</ul>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.example.com%2Fuser%3Ftoken%3Dxxx" target="_blank" title="http://www.example.com/user?token=xxx" ref="nofollow noopener noreferrer">www.example.com/user?token=…</a></p>
<h2 data-id="heading-17">Token 和 JWT 的区别</h2>
<p>相同：</p>
<ul>
<li>都是访问资源的令牌</li>
<li>都可以记录用户的信息</li>
<li>都是使服务端无状态化</li>
<li>都是只有验证成功后，客户端才能访问服务端上受保护的资源</li>
</ul>
<p>区别：</p>
<ul>
<li>Token：服务端验证客户端发送过来的 Token 时，还需要查询数据库获取用户信息，然后验证 Token 是否有效。</li>
<li>JWT：将 Token 和 Payload 加密后存储于客户端，服务端只需要使用密钥解密进行校验（校验也是 JWT 自己实现的）即可，不需要查询或者减少查询数据库，因为 JWT 自包含了用户信息和加密的数据。</li>
</ul>
<h2 data-id="heading-18">常见的前后端鉴权方式</h2>
<ol>
<li>Session-Cookie</li>
<li>Token 验证（包括 JWT，SSO）</li>
<li>OAuth2.0（开放授权）</li>
</ol>
<h2 data-id="heading-19">常见的加密算法</h2>
<ul>
<li>哈希算法(Hash Algorithm)又称散列算法、散列函数、哈希函数，是一种从任何一种数据中创建小的数字“指纹”的方法。哈希算法将数据重新打乱混合，重新创建一个哈希值。</li>
<li>哈希算法主要用来保障数据真实性(即完整性)，即发信人将原始消息和哈希值一起发送，收信人通过相同的哈希函数来校验原始数据是否真实。</li>
<li>哈希算法通常有以下几个特点：</li>
</ul>

<ul>
<li>
<ul>
<li>2 的 128 次方为 340282366920938463463374607431768211456，也就是 10 的 39 次方级别</li>
<li>2 的 160 次方为 1.4615016373309029182036848327163e+48，也就是 10 的 48 次方级别</li>
<li>2 的 256 次方为 1.1579208923731619542357098500869 × 10 的 77 次方，也就是 10 的 77 次方</li>
<li>正像快速：原始数据可以快速计算出哈希值</li>
<li>逆向困难：通过哈希值基本不可能推导出原始数据</li>
<li>输入敏感：原始数据只要有一点变动，得到的哈希值差别很大</li>
<li>冲突避免：很难找到不同的原始数据得到相同的哈希值，宇宙中原子数大约在 10 的 60 次方到 80 次方之间，所以 2 的 256 次方有足够的空间容纳所有的可能，算法好的情况下冲突碰撞的概率很低：</li>
</ul>
</li>
</ul>
<p>注意：</p>
<ol>
<li>以上不能保证数据被恶意篡改，原始数据和哈希值都可能被恶意篡改，要保证不被篡改，可以使用RSA 公钥私钥方案，再配合哈希值。</li>
<li>哈希算法主要用来防止计算机传输过程中的错误，早期计算机通过前 7 位数据第 8 位奇偶校验码来保障（12.5% 的浪费效率低），对于一段数据或文件，通过哈希算法生成 128bit 或者 256bit 的哈希值，如果校验有问题就要求重传。</li>
</ol>
<h2 data-id="heading-20">常见问题</h2>
<h3 data-id="heading-21">使用 cookie 时需要考虑的问题</h3>
<ul>
<li>因为存储在客户端，容易被客户端篡改，使用前需要验证合法性</li>
<li>不要存储敏感数据，比如用户密码，账户余额</li>
<li>使用 httpOnly 在一定程度上提高安全性</li>
<li>尽量减少 cookie 的体积，能存储的数据量不能超过 4kb</li>
<li>设置正确的 domain 和 path，减少数据传输</li>
<li>cookie 无法跨域</li>
<li>一个浏览器针对一个网站最多存 20 个Cookie，浏览器一般只允许存放 300 个Cookie</li>
<li>移动端对 cookie 的支持不是很好，而 session 需要基于 cookie 实现，所以移动端常用的是 token</li>
</ul>
<h3 data-id="heading-22">使用 session 时需要考虑的问题</h3>
<ul>
<li>将 session 存储在服务器里面，当用户同时在线量比较多时，这些 session 会占据较多的内存，需要在服务端定期的去清理过期的 session</li>
<li>当网站采用集群部署的时候，会遇到多台 web 服务器之间如何做 session 共享的问题。因为 session 是由单个服务器创建的，但是处理用户请求的服务器不一定是那个创建 session 的服务器，那么该服务器就无法拿到之前已经放入到 session 中的登录凭证之类的信息了。</li>
<li>当多个应用要共享 session 时，除了以上问题，还会遇到跨域问题，因为不同的应用可能部署的主机不一样，需要在各个应用做好 cookie 跨域的处理。</li>
<li>sessionId 是存储在 cookie 中的，假如浏览器禁止 cookie 或不支持 cookie 怎么办？一般会把 sessionId 跟在 url 参数后面即重写 url，所以 session 不一定非得需要靠 cookie 实现</li>
<li>移动端对 cookie 的支持不是很好，而 session 需要基于 cookie 实现，所以移动端常用的是 token</li>
</ul>
<h3 data-id="heading-23">使用 token 时需要考虑的问题</h3>
<ul>
<li>如果认为用数据库来存储 token 会导致查询时间太长，可以选择放在内存当中。比如 redis 很适合对 token 查询的需求。</li>
<li>token 完全由应用管理，所以它可以避开同源策略</li>
<li>token 可以避免 CSRF 攻击(因为不需要 cookie 了)</li>
<li>移动端对 cookie 的支持不是很好，而 session 需要基于 cookie 实现，所以移动端常用的是 token</li>
</ul>
<h3 data-id="heading-24">使用 JWT 时需要考虑的问题</h3>
<ul>
<li>因为 JWT 并不依赖 Cookie 的，所以可以使用任何域名提供 API 服务而不需要担心跨域资源共享问题（CORS）</li>
<li>JWT 默认是不加密，但也是可以加密的。生成原始 Token 以后，可以用密钥再加密一次。</li>
<li>JWT 不加密的情况下，不能将秘密数据写入 JWT。</li>
<li>JWT 不仅可以用于认证，也可以用于交换信息。有效使用 JWT，可以降低服务器查询数据库的次数。</li>
<li>JWT 最大的优势是服务器不再需要存储 Session，使得服务器认证鉴权业务可以方便扩展。但这也是 JWT 最大的缺点：由于服务器不需要存储 Session 状态，因此使用过程中无法废弃某个 Token 或者更改 Token 的权限。也就是说一旦 JWT 签发了，到期之前就会始终有效，除非服务器部署额外的逻辑。</li>
<li>JWT 本身包含了认证信息，一旦泄露，任何人都可以获得该令牌的所有权限。为了减少盗用，JWT的有效期应该设置得比较短。对于一些比较重要的权限，使用时应该再次对用户进行认证。</li>
<li>JWT 适合一次性的命令认证，颁发一个有效期极短的 JWT，即使暴露了危险也很小，由于每次操作都会生成新的 JWT，因此也没必要保存 JWT，真正实现无状态。</li>
<li>为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用 HTTPS 协议传输。</li>
</ul>
<h3 data-id="heading-25">使用加密算法时需要考虑的问题</h3>
<ul>
<li>绝不要以明文存储密码</li>
<li>永远使用 哈希算法 来处理密码，绝不要使用 Base64 或其他编码方式来存储密码，这和以明文存储密码是一样的，使用哈希，而不要使用编码。编码以及加密，都是双向的过程，而密码是保密的，应该只被它的所有者知道， 这个过程必须是单向的。哈希正是用于做这个的，从来没有解哈希这种说法， 但是编码就存在解码，加密就存在解密。</li>
<li>绝不要使用弱哈希或已被破解的哈希算法，像 MD5 或 SHA1 ，只使用强密码哈希算法。</li>
<li>绝不要以明文形式显示或发送密码，即使是对密码的所有者也应该这样。如果需要 “忘记密码” 的功能，可以随机生成一个新的一次性的（这点很重要）密码，然后把这个密码发送给用户。</li>
</ul>
<h3 data-id="heading-26">分布式架构下 session 共享方案</h3>
<h4 data-id="heading-27">1. session 复制</h4>
<p>任何一个服务器上的 session 发生改变（增删改），该节点会把这个 session 的所有内容序列化，然后广播给所有其它节点，不管其他服务器需不需要 session ，以此来保证 session 同步<br/>
优点：可容错，各个服务器间 session 能够实时响应。缺点：会对网络负荷造成一定压力，如果 session 量大的话可能会造成网络堵塞，拖慢服务器性能。</p>
<h4 data-id="heading-28">2. 粘性 session /IP 绑定策略</h4>
<ul>
<li>采用 Ngnix 中的 ip_hash 机制，将某个 ip的所有请求都定向到同一台服务器上，即将用户与服务器绑定。用户第一次请求时，负载均衡器将用户的请求转发到了 A 服务器上，如果负载均衡器设置了粘性 session 的话，那么用户以后的每次请求都会转发到 A 服务器上，相当于把用户和 A 服务器粘到了一块，这就是粘性 session 机制。</li>
</ul>
<p>优点：简单，不需要对 session 做任何处理。缺点：缺乏容错性，如果当前访问的服务器发生故障，用户被转移到第二个服务器上时，他的 session 信息都将失效。适用场景：发生故障对客户产生的影响较小；服务器发生故障是低概率事件 。实现方式：以 Nginx 为例，在 upstream 模块配置 ip_hash 属性即可实现粘性 session。</p>
<h4 data-id="heading-29">3. session 共享（常用）</h4>
<ul>
<li>使用分布式缓存方案比如 Memcached 、Redis 来缓存 session，但是要求 Memcached 或 Redis 必须是集群</li>
<li>把 session 放到 Redis 中存储，虽然架构上变得复杂，并且需要多访问一次 Redis ，但是这种方案带来的好处也是很大的：</li>
</ul>

<ul>
<li>
<ul>
<li>实现了 session 共享；</li>
<li>可以水平扩展（增加 Redis 服务器）；</li>
<li>服务器重启 session 不丢失（不过也要注意 session 在 Redis 中的刷新/失效机制）；</li>
<li>不仅可以跨服务器 session 共享，甚至可以跨平台（例如网页端和 APP 端）</li>
</ul>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/029470ed1c75477cb0b51431c0ac6af1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5YGH:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568239&amp;x-signature=gSCNJvpZGBSWtDYFcYelugrccxY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-30">4. session 持久化</h4>
<p>将 session 存储到数据库中，保证 session 的持久化<br/>
优点：服务器出现问题，session 不会丢失缺点：如果网站的访问量很大，把 session 存储到数据库中，会对数据库造成很大压力，还需要增加额外的开销维护数据库。</p>
<h3 data-id="heading-31">只要关闭浏览器 ，session 真的就消失了？</h3>
<p>不对。对 session 来说，除非程序通知服务器删除一个 session，否则服务器会一直保留，程序一般都是在用户做 log off 的时候发个指令去删除 session。然而浏览器从来不会主动在关闭之前通知服务器它将要关闭，因此服务器根本不会有机会知道浏览器已经关闭，之所以会有这种错觉，是大部分 session 机制都使用会话 cookie 来保存 session id，而关闭浏览器后这个 session id 就消失了，再次连接服务器时也就无法找到原来的 session。如果服务器设置的 cookie 被保存在硬盘上，或者使用某种手段改写浏览器发出的 HTTP 请求头，把原来的 session id 发送给服务器，则再次打开浏览器仍然能够打开原来的 session。恰恰是由于关闭浏览器不会导致 session 被删除，迫使服务器为 session 设置了一个失效时间，当距离客户端上一次使用 session 的时间超过这个失效时间时，服务器就认为客户端已经停止了活动，才会把 session 删除以节省存储空间。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[知识蒸馏学习总结]]></title>    <link>https://juejin.cn/post/7593145583347941418</link>    <guid>https://juejin.cn/post/7593145583347941418</guid>    <pubDate>2026-01-09T11:13:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593145583347941418" data-draft-id="7593145583347925034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="知识蒸馏学习总结"/> <meta itemprop="keywords" content="算法,人工智能"/> <meta itemprop="datePublished" content="2026-01-09T11:13:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="矮人三等"/> <meta itemprop="url" content="https://juejin.cn/user/4350105576808472"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            知识蒸馏学习总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4350105576808472/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    矮人三等
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T11:13:11.000Z" title="Fri Jan 09 2026 11:13:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读23分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<ol>
<li>模型蒸馏是一种将大模型的知识传递给小模型的过程，“大模型”通常是一个性能较好的复杂模型，而“小模型”则是一个更简单、计算量较小的模型。
<ol>
<li>通过模型蒸馏，可以让小模型学到大模型的一些关键知识，从而在保持较高性能的同时，降低计算成本和存储需求。</li>
<li>蒸馏算法的关键问题是如何从老师模型转换的知识传授给学生模型。</li>
<li>一个知识蒸馏系统由三个主要部分组成：知识，蒸馏算法，和师生架构。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25c953a52ad4409bb3f960c7038a6b3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=ZOgEpZDmnD5%2F0jNX2FlJUwTiBVQ%3D" alt="在这里插入图片描述" loading="lazy"/></li>
</ol>
</li>
</ol>
<h2 data-id="heading-1">标签</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87bc82048efe42169a81ee57b0c0511d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=co5PBuFQFygAj9bJ4rbDB2IL%2BeQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>软标签和硬标签：在机器学习和深度学习中，硬标签（Hard Labels）和软标签（Soft Labels） 是两种不同的标签表示方式。
<ol>
<li>硬标签（Hard Labels）在模型蒸馏中，硬标签是指 真实数据的标注，通常是 独热编码（One-Hot Encoding） 的形式。硬标签表示每个样本的真实类别，用于 监督学习。
<ol>
<li>特点 是离散性和明确性：
<ol>
<li>离散性：硬标签是离散的，每个样本只有一个类别被标记为1，其余类别为0。</li>
<li>明确性：硬标签直接反映了数据的真实类别，没有概率信息。</li>
</ol>
</li>
</ol>
</li>
<li>软标签（Soft Labels） 在模型蒸馏中，软标签是指教师模型的输出概率分布。教师模型对每个样本进行预测，输出每个类别的概率值，这些概率值构成了软标签。</li>
<li>暗知识：指的是<strong>教师模型学到的、无法通过人工标注的 “硬标签” 直接体现的隐性规律与关联信息</strong>，是教师模型在海量数据上训练后内化的 “经验”。
<ol>
<li>举例如下：判断句子 “苹果发布会即将召开” 的类别是<code>[科技, 美食, 体育]</code>。
<ol>
<li>硬标签：<code>[1,0,0]</code>（科技）</li>
<li>暗知识：教师输出<code>[0.85, 0.1, 0.05]</code>。其中<code>0.1</code>的美食概率，就是暗知识 (因为 “苹果” 也可以指水果，模型捕捉到了这个一词多义的隐性关联。)</li>
</ol>
</li>
</ol>
</li>
<li>暗知识的核心特点
<ol>
<li>隐含性：无法通过人工标注得到，是模型从数据中自主学习到的模式。</li>
<li>泛化性：包含类别间的相似性、关联性，能帮助学生模型更好地处理模糊样本。</li>
<li>温度依赖：暗知识的提取需要通过**温度系数 T **软化教师模型的输出概率。T 越大，概率分布越平滑，暗知识的体现越充分
<ol>
<li>logits：<strong>logits（对数几率）指的是模型最后一层全连接层的原始输出</strong>—— 它是还没经过 Softmax 激活函数、没有被归一化成概率的数值，通俗理解就是比如比赛评委打分：此时刚进行打分，还没有根据分数进行分组的阶段输出</li>
</ol>
</li>
</ol>
</li>
<li>暗知识与知识蒸馏的关系: 知识蒸馏的核心就是<strong>把暗知识从教师模型迁移到学生模型</strong>。
<ul>
<li>如果只让学生学习硬标签，学生只能学会 “分类结果”，但学不会 “分类的逻辑”；</li>
<li>结合软标签学习暗知识，学生不仅能判断 “是什么”，还能理解 “为什么像”，从而在样本分布复杂、数据量少的场景下，达到接近教师模型的泛化性能。</li>
</ul>
</li>
</ol>
</li>
</ol>
<h2 data-id="heading-2">蒸馏过程</h2>
<ol>
<li>变量以及公式详解：
<ol>
<li>Zi(T) ：表示教师模型对第 i 类的 logits；  Zi(S)同理表示学生模型的 logits</li>
<li>yi 表示真实标签，也就是硬标签</li>
<li>Softmax(Zi) = Pi = e^(zi  ) / ∑j e ^ (zj)</li>
<li>软化概率公式(带有温度 T 的 softmax 公式，生成软标签的工具)：Pi_T = e^(zi / T ) / ∑j e ^ (zj / T)</li>
<li>交叉熵损失函数(多分类为例)：L_CE= - ∑i  yi * log(y^)</li>
<li>图像任务：T=2 ～ 4；NLP 任务：T=5～10</li>
</ol>
</li>
<li>蒸馏损失的计算：L_total = α * L_hard + (1-α)  * L_soft             α ∈  [0,1]) 是损失权重，通常取 (0.3)（侧重软损失传递暗知识）。
<ol>
<li>软损失 L_soft 是传递教师的"暗知识"，分别结算教师模型和学生模型的软化概率：
<ol>
<li>1.4 中的软化概率公式分别计算得到 Pi_T 和 Qi_S</li>
<li>注：其实就是模型最后一层全连接成的原始输出 logits，不使用 softmax 而是带有 T 的 softmax 得到每个类别的概率值</li>
</ol>
</li>
<li>计算交叉熵损失：L_soft = - ∑i Pi_T   * log(Qi_S)
<ol>
<li>使用 1.5 中的公式，其实这就是一个计算教师模型输出概率和学生概率分布的差值后，反向传播来训练学生模型的过程</li>
</ol>
</li>
<li>硬损失 L_hard 是保证任务正确性：
<ol>
<li>此时 T=1，也就是说硬化概率公式就是原本的 softmax 函数得到的</li>
<li>Pi_S：硬标签也就是 softmax 得到的结果， L_hard = - ∑i yi   * log(Pi_S)，此时不需要教师模型计算，因为用的是真实标签</li>
</ol>
</li>
<li>softmax 函数此时也可以用 MSE 函数来代替，原因如下：
<ol>
<li>当前计算损失直接使用预测值和真实值的均方和，同样可以进行反向传播训练，而且不经过 softmax 还可以避免 Softmax 的数值压缩，更直接传递教师的原始判断信息。</li>
<li>此时的 MSE 不是为了分类，而是单纯为了让学生分布和教师分布接近的更快</li>
<li>MSE 使用场景：(快速验证、小模型蒸馏)   CE 使用场景: (核心蒸馏场景，优先选择)</li>
</ol>
</li>
<li>总结： logits --&gt; Pi --&gt; L ，教师模型参数冻结，只更新学生模型参数</li>
</ol>
</li>
</ol>
<h2 data-id="heading-3">1 知识</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebc942849fbb4788b8be7af0e2bcf889~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=0ve%2BR1YlvreMdEZN6L6EnV4vGGs%3D" alt="在这里插入图片描述" loading="lazy"/></p>





























<table><thead><tr><th>知识类型</th><th>迁移对象</th><th>适用场景</th><th>典型损失函数</th></tr></thead><tbody><tr><td>基于响应的知识</td><td>教师模型全连接层输出 logits</td><td>入门级蒸馏、小模型轻量化</td><td>交叉熵（软标签）、MSE（Logits 匹配）</td></tr><tr><td>基于特征的知识</td><td>教师模型中间层的特征向量</td><td>复杂任务（检测 / 分割）、大模型蒸馏</td><td>MSE、余弦相似度、Gram 矩阵损失</td></tr><tr><td>基于关系的知识</td><td>教师模型样本间的关联关系</td><td>细粒度分类、小样本学习</td><td>关系一致性损失、对比损失</td></tr></tbody></table>
<ol>
<li>
<p>基于响应的知识：最基础、最经典的蒸馏范式
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90d0b06b9d244811b0211c0c879641b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=j5Gn8y%2FQ6ULRrWWz6n4Pet%2Ba8bQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>核心定义：知识是教师模型在<strong>输出层的响应</strong>，即最后一层的 <strong>Logits</strong> 或经过 Softmax（带温度 T）的 <strong>概率分布</strong>。</li>
<li>通俗理解：相当于教师直接把 “最终答案 + 最终结果的思考” 告诉学生：</li>
<li>迁移方式：学生模型的输出层响应 对齐 教师模型的输出层响应</li>
<li>优势：实现简单，无需修改模型结构，适合入门和快速验证</li>
<li>基于软目标的响应型知识蒸馏通常用于监督学习的场景中。</li>
</ol>
</li>
<li>
<p>基于特征的知识：函数通过最小化教师模型和学生模型之间的特征激活差异来进行优化
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0205f2fc67d1407a99a9a69c5df0f1af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=C%2FIo09BAggAnPASfJ03PAozST6k%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>核心定义：知识是教师模型<strong>中间层的特征表示</strong>，这些特征是模型对输入数据的 “抽象理解”</li>
<li>通俗理解：教师不仅告诉学生 “答案”，还把 “解题的草稿纸” 给学生看，让学生可以学习分析问题的关键步骤</li>
<li>迁移方式：选择教师与学生的<strong>对应中间层</strong>（需保证维度匹配，不匹配时用投影层转换），让学生的中间特征 对齐 教师的中间特征；</li>
<li>实现步骤拆解：
<ol>
<li>选定中间层：(目的：保证两者特征的语义层级一致)
<ol>
<li>选择方法：分层级(根据模型结构顺序分层级)和找对应(同结构对应比例，不同结构优先选输出维度相近 + 语义层级相近的层)</li>
<li>不用纠结 “选最准的层”，优先选<strong>中层</strong>（底层太简单、高层太接近输出层，中层的知识迁移性价比最高）；</li>
<li>若不确定，直接选模型的<strong>倒数第 3~ 第 5 层</strong>（大部分模型的核心语义都在这个区间）。</li>
</ol>
</li>
<li>提取中间特征：通俗理解就是使用一个钩子函数或者修改模型，让模型在前向传播的时候在你选定的中间层进行"拦截"，把中间层输出保存下来，不影响正常训练，只是从中间复制了一份数据。</li>
<li>特征维度匹配：加投影层
<ol>
<li>投影层的作用只有一个：解决师生特征 “维度不匹配” 的问题，本质是一个 “转换器”。</li>
<li>其实在 NLP 中就是加一个线性变换来改变维度，不破坏特征的语义信息。</li>
<li>此时结果就是教师模型中间层输出和学生模型中间层输出的维度是一致的</li>
</ol>
</li>
<li>计算损失并优化：使用表格中的损失函数，并使用方向传播进行训练即可</li>
<li>Gram 矩阵损失（Gram Matrix Loss）：
<ol>
<li>Gram 矩阵不关心特征的 “具体数值”，只关心 <strong>“特征内部不同部分的关联程度”</strong>。</li>
<li>提取教师和学生的<strong>中层隐藏特征</strong>：形状为<code>[批次大小, 序列长度, 隐藏层维度]</code>；</li>
<li>计算 Gram 矩阵：衡量 “词 A 的隐藏向量” 和 “词 B 的隐藏向量” 的相关性；</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>
<p>基于关系的知识：突破了 “单样本知识” 的局限，关注教师模型对<strong>多个样本之间关系</strong>的理解
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/babc038ea54147f694c40c882e0b4de7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=Ik7EpZDJxU%2BrLI2V27DP3He0VbE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>
<p>核心定义：知识不是单个样本的输出或特征，而是<strong>样本之间的相对关系</strong>，比如 “样本 A 和样本 B 的相似性高于样本 A 和样本 C”“样本 X 是样本 Y 的特例”。</p>
</li>
<li>
<p>通俗理解：教师教学生 “举一反三” 的能力，不是教学生 “这是猫”“那是狗”，而是教 “猫和老虎长得像，猫和狗长得不像”“波斯猫是猫的一种”。</p>
</li>
<li>
<p>迁移方式：构建样本组（对），让学生模型学到的样本间关系 与 教师模型一致；</p>
</li>
<li>
<p>优势：能传递 “泛化性知识”，解决小样本、细粒度分类等数据不足的问题。</p>
</li>
<li>
<p>实现步骤拆解：</p>
<ol>
<li>
<p>构建样本组：</p>
<ol>
<li>从批次中选子集构建 “样本对 / 样本组”，比如批次 B=8(批次是样本集)，选其中 4 个样本组成组(抽样)，计算两两之间的关系；</li>
<li>目的：让模型学习 “样本 A 和 B 像，A 和 C 不像” 这类相对关系。</li>
</ol>
</li>
<li>
<p>提取样本特征：方法同上，只是后续处理不太一致，一个是单个样本，一个是样本组，此时会得到教师模型的特征矩阵和学生模型的特征矩阵，计算矩阵距离，并训练让其距离拉近</p>
</li>
<li>
<p>计算关系矩阵：对教师 / 学生的样本特征，计算 “两两相似度矩阵”（比如余弦相似度），得到教师关系矩阵 (R_t)、学生关系矩阵 (R_s)；</p>
<ol>
<li>优先用<strong>余弦相似度</strong>（通用、鲁棒，大部分场景效果最好）；</li>
<li>如果特征已经做了归一化（比如用<code>F.normalize</code>），用<strong>点积相似度</strong>（计算更快，结果和余弦相似度一致）。</li>
</ol>





























<table><thead><tr><th>相似度方法</th><th>计算逻辑（通俗版）</th><th>适用场景</th><th>优点</th></tr></thead><tbody><tr><td>余弦相似度</td><td>衡量两个特征<strong>方向是否一致</strong>，不关心长度（比如特征 A=[1,2], 特征 B=[2,4]，方向相同，余弦相似度 = 1）</td><td>特征长度差异大的场景（如 NLP 的不同长度句子特征）</td><td>对特征缩放不敏感，通用型强</td></tr><tr><td>欧式距离（倒数）</td><td>衡量两个特征<strong>在空间中的直线距离</strong>，距离越小越相似（比如 A 和 B 坐标离得越近，越相似）</td><td>特征维度低、数值分布均匀的场景</td><td>计算简单，易于理解</td></tr><tr><td>点积相似度</td><td>衡量两个特征<strong>数值的乘积和</strong>，数值越大、对应维度越一致，相似度越高</td><td>特征已经归一化（长度为 1）的场景</td><td>计算速度最快，适合大规模样本</td></tr></tbody></table>
</li>
<li>
<p>计算损失并优化：用关系一致性损失 / 对比损失，让 (R_s) 逼近 (R_t)，仅更新学生参数。</p>
<ol>
<li>关系一致性损失（Relation Consistency Loss）：直接衡量教师和学生的<strong>样本关系矩阵</strong>的差异，让学生学到的 “样本间相似性” 和教师完全一致。
<ol>
<li>余弦相似度：<strong>只做 “关系描述”</strong>（比如 “学生 A 和 B 像，相似度 0.9”），是一个 “静态数值”，把 “特征矩阵” 转化为 “关系矩阵”，只做 “数值转换”，无优化能力</li>
<li>关系一致性损失：<strong>做 “关系优化”</strong>（衡量学生的描述和教师的描述差多少，再通过反向传播让学生修正），是一个 “动态优化过程”，通俗讲就是这一步开始对 1 中得到的关系矩阵进行处理，其实就是进行归一化后的 MSE</li>
<li>优化目标：让学生的<strong>关系矩阵数值</strong> 逐元素逼近教师，依赖教师的 “标准答案”（关系矩阵）</li>
<li>使用场景：有高性能教师模型的场景，追求 “学生完全复刻教师的关系判断”</li>
</ol>
</li>
<li>对比损失（Contrastive Loss ； 经典 InfoNCE 损失）：不直接匹配相似度数值，而是通过 “拉近同类样本、推远异类样本” 的方式(物理意义：让正样本对的相似度尽可能大，负样本对的相似度尽可能小。)，让学生学到教师的 “样本关系逻辑”，是更鲁棒的关系蒸馏方式。
<ol>
<li>优化目标：让学生学会 <strong>“同类样本更像，异类样本更不像”</strong> 的相对关系，不追求数值完全一致；不依赖教师，只依赖样本的类别标签（正样本 / 负样本）</li>
<li>使用场景：教师模型效果一般，或样本标签充足的场景，追求 “学生自主学习合理的样本关系”</li>
</ol>
</li>
<li>两种损失可以搭配使用
<ol>
<li>关系一致性损失保证学生 “复刻教师的经验”；</li>
<li>对比损失保证学生 “学习通用的关系逻辑”，避免过拟合到教师的误差</li>
<li>教师模型能力极强或者资源有限情况下不建议搭配使用</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 data-id="heading-4">2 训练</h2>
<ol>
<li>离线蒸馏：离线蒸馏是最常见的方法，其中使用一个预训练的教师模型来指导学生模型。在这种方式中，教师模型首先在训练数据集上进行预训练，然后将教师模型中的知识蒸馏到学生模型中进行训练。
<ol>
<li>优缺点：
<ol>
<li>优点：教师性能稳定，学生的上限由教师决定；实现简单，工业界落地成熟。</li>
<li>缺点：需要分两步训练，耗时较长；教师一旦固定，无法在学生训练过程中优化。</li>
</ol>
</li>
<li>典型应用：
<ol>
<li>大模型轻量化：如用 GPT-3 蒸馏小尺寸 GPT、用 ResNet-152 蒸馏 ResNet-18；</li>
<li>特定任务优化：如用中文预训练大模型蒸馏小模型，适配移动端文本分类。</li>
</ol>
</li>
</ol>
</li>
<li>在线蒸馏：在离线蒸馏中，预训练的教师模型通常是一个高容量的深度神经网络。然而，在某些情况下，可能无法获得适用于离线蒸馏的预训练模型。为了解决这一局限性，可以使用在线蒸馏，在这种方法中，教师模型和学生模型在一个端到端的训练过程中同时更新。在线蒸馏可以通过并行计算实现，因此是一种高效的方法。
<ol>
<li>实现步骤：
<ol>
<li>初始化多个模型：通常初始化一组结构相同或相似的模型（如 3 个 ResNet-18），互为 “教师” 和 “学生”；</li>
<li>协同训练：每个模型在训练时，既作为 “学生” 学习其他模型的输出，也作为 “教师” 输出软标签指导其他模型；</li>
<li>动态更新：所有模型的参数都在训练中更新，没有固定的教师。</li>
</ol>
</li>
<li>优缺点：
<ol>
<li>优点：无需预训练教师，训练流程一步到位；教师动态更新，避免过拟合；多个模型协同，性能通常优于单模型。</li>
<li>缺点：训练时需要同时运行多个模型，显存占用高；超参数调优复杂。</li>
</ol>
</li>
<li>典型应用：
<ol>
<li>多模型集成系统：如推荐系统的多塔模型；</li>
<li>资源受限场景：如边缘设备的模型训练，无法承担预训练大模型的成本。</li>
</ol>
</li>
</ol>
</li>
<li>自蒸馏：在自蒸馏中，教师模型和学生模型使用相同的模型。例如，可以利用深层神经网络的深层激活值来训练浅层网络。这可以视为在线蒸馏的一种特殊情况，并可以通过多种方式实现。例如，教师模型在早期训练轮次的知识可以转移到其后期训练轮次中，用于训练学生模型。
<ol>
<li>最轻量化的蒸馏范式</li>
<li>两种实现方式：
<ol>
<li>基于时间的自蒸馏：用模型不同训练阶段的输出作为软标签</li>
<li>基于结构的自蒸馏	用模型不同部分的输出作为软标签</li>
</ol>
</li>
<li>优缺点：
<ol>
<li>优点：无额外教师开销，显存占用最低；训练流程简单，适合小模型和隐私保护场景（无需共享教师模型）；</li>
<li>缺点：性能上限受限于模型自身，无法超越单模型的最优性能；对训练超参数敏感。</li>
</ol>
</li>
<li>典型应用：
<ol>
<li>小模型性能提升：如移动端的轻量级 CNN 模型，通过自蒸馏提升分类精度；</li>
<li>隐私计算场景：如医疗数据训练，数据不能离开本地，无法训练独立教师模型。</li>
</ol>
</li>
</ol>
</li>
<li><strong>训练效率</strong>：自蒸馏 &gt; 在线蒸馏 &gt; 离线蒸馏（自蒸馏无需额外训练教师）；</li>
<li><strong>性能上限</strong>：离线蒸馏 &gt; 在线蒸馏 &gt; 自蒸馏（离线蒸馏可使用超大模型作为教师）。</li>
</ol>
<h2 data-id="heading-5">3 知识蒸馏的算法</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24b32417a6b14194b574ab2118ac7ad3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=OsttwO5%2FGYyXtbTUWGg7%2FUwIkm4%3D" alt="在这里插入图片描述" loading="lazy"/></p>

































































<table><thead><tr><th>蒸馏方法</th><th>核心定位</th><th>关键创新点</th><th>典型应用</th></tr></thead><tbody><tr><td>对抗蒸馏</td><td>鲁棒性优化</td><td>引入 GAN 思想，让学生对抗性学习教师知识</td><td>噪声数据分类、防御对抗攻击(自动驾驶)</td></tr><tr><td>多教师蒸馏</td><td>知识融合</td><td>多个教师模型协同指导，集成互补知识</td><td>医疗影像诊断(高精度要求，小样本场景)</td></tr><tr><td>跨模态蒸馏</td><td>跨领域迁移</td><td>不同模态模型间传递知识（如视觉→文本）</td><td>图文检测，字幕生成，某一模态数据不足</td></tr><tr><td>图蒸馏</td><td>图结构适配</td><td>针对图神经网络（GNN）的拓扑 + 节点知识迁移</td><td>社交网络分析、分子属性预测</td></tr><tr><td>注意力蒸馏</td><td>结构对齐</td><td>迁移教师模型的注意力权重，复刻决策逻辑</td><td>大语言模型轻量化、机器翻译。细颗粒任务</td></tr><tr><td>无数据蒸馏</td><td>隐私保护</td><td>无需原始数据，通过生成数据传递知识</td><td>隐私敏感场景（医疗 / 金融）</td></tr><tr><td>量化蒸馏</td><td>硬件适配</td><td>结合模型量化，在压缩精度的同时保留性能</td><td>边缘设备部署（手机 / IoT）低资源情况</td></tr><tr><td>终身蒸馏</td><td>持续学习</td><td>模型在新任务上学习时，保留旧任务知识</td><td>机器人自主学习、推荐系统迭代</td></tr><tr><td>NAS 蒸馏</td><td>架构搜索</td><td>蒸馏指导神经架构搜索，高效生成最优小模型</td><td>自动化模型设计、低算力场景</td></tr></tbody></table>
<ol>
<li>
<p>对抗蒸馏：将<strong>对抗生成网络（GAN）</strong> 的思想融入蒸馏，通过 “生成器 - 判别器” 的博弈，让学生模型不仅学习教师的软标签，还能<strong>抵抗噪声和对抗样本</strong>，提升鲁棒性。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0191e21c7904bc0a57d5bd93625c055~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=FGNubxzxY5F%2Blxf6ogSFjiBQzaw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>实现流程：
<ol>
<li>使用干净数据和对抗数据训练判别器</li>
<li>使用教师模型生成干净数据</li>
<li>让学生模型去使用干净数据进行推理，得到结果后让判别器判断属于哪种数据(干净或者对抗)</li>
<li>学习干净数据的时候，可以使用教师模型的结果来优化，提高学生模型的精度</li>
<li>学习对抗数据的时候，精度提升了那对抗数据的结果也会提升，鲁棒性增强，判别器无法识别学生模型的输出到底是干净数据还是对抗数据</li>
<li>注：判别器只对输出数据进行判别，其实判别的是每个词向量位置，比如一个正常文本的词向量数值大小是不一样的，对抗数据就是不符合正常文本的向量值大小的，学生模型如何可以把这个位置对应的概率大小调整好，判别器就会认为这个文本是正常的。</li>
</ol>
</li>
</ol>
</li>
<li>
<p>多教师蒸馏：用<strong>多个不同的教师模型</strong>协同指导一个学生模型，融合多个教师的互补知识，避免单教师的局限性。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4a792752b5a4363bcc2fc9eb63a3ad6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=cxxDGNQSJnj6unQxPLeaDuVgGuI%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>教师选择策略：
<ol>
<li>同架构多教师：多个相同结构的模型，训练在不同数据子集上（如数据增强的不同版本）；</li>
<li>异架构多教师：不同结构的模型，覆盖不同的特征提取角度。</li>
</ol>
</li>
<li>知识加权策略：
<ol>
<li>加权平均：根据教师的性能权重，融合多个教师的软标签。</li>
<li>投票机制：对每个样本，取多个教师软标签的众数作为学生的学习目标；</li>
<li>分层融合：不同教师负责指导学生的不同中间层（如教师 A 指导低层特征，教师 B 指导高层特征）。</li>
</ol>
</li>
<li>离线蒸馏的模式，随机森林的思想。</li>
</ol>
</li>
<li>
<p>跨模态蒸馏：让不同模态的模型之间传递知识（如视觉模型→文本模型、语音模型→图像模型），实现跨领域的知识迁移。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d62f75d261214e78a76513eb63712490~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=rnK7NkY2%2Bxpvrx137WPjiChSB3s%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>共享特征空间：通过一个映射层，将源模态（如图像）的特征和目标模态（如文本）的特征投影到同一空间；</li>
<li>对齐损失：让学生模型（目标模态）的特征与教师模型（源模态）的特征在共享空间中对齐。</li>
<li>离线蒸馏的模式，统一不同模态的信息，完成在统一态上的迁移</li>
</ol>
</li>
<li>
<p>图蒸馏：专门针对<strong>图神经网络（GNN）</strong> 设计的蒸馏方法，不仅迁移节点的特征知识，还迁移图的<strong>拓扑结构知识</strong>（如节点间的连接关系、子图的结构模式）。</p>
<ol>
<li>本人内容不涉及，不做详解</li>
</ol>
</li>
<li>
<p>注意力蒸馏：聚焦于迁移教师模型的<strong>注意力权重</strong>，让学生模型复刻教师的 “决策逻辑”—— 比如教师关注图像的哪个区域、文本的哪个词，而非仅学习输出层的软标签。</p>
<ol>
<li>获取注意力权重：类比上面"基于关系的知识"，区别在于这个蒸馏方法是针对样本，上面是针对样本组</li>
<li>蒸馏的损失设计：
<ol>
<li>直接匹配：学生的注意力矩阵与教师的注意力矩阵的 MSE 损失；</li>
<li>特征加权：用教师的注意力权重加权学生的中间特征，再计算与教师特征的</li>
</ol>
</li>
<li>通俗讲就是把教师模型的注意力权重附加到学生模型的特征向量，要一一对应，这样学生就知道了向量的重要程度</li>
</ol>
</li>
<li>
<p>无数据蒸馏：在<strong>没有原始训练数据</strong>的前提下，实现教师模型到学生模型的知识迁移，核心解决<strong>数据隐私和数据缺失</strong>的问题。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0df7c135ca23473aabfb18beb80cc9dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=h0rfVJ3fFil13NUlNSxVfQt%2FqNs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>生成伪数据
<ol>
<li>用教师模型指导一个生成器（如 GAN），生成能够激活教师模型关键特征的伪数据（如让教师输出高置信度的图像）；</li>
<li>伪数据的质量直接决定蒸馏效果。</li>
</ol>
</li>
<li>蒸馏流程：
<ol>
<li>生成器生成伪数据→输入教师模型，得到软标签；</li>
<li>学生模型学习伪数据和对应的软标签，无需接触原始数据。</li>
</ol>
</li>
<li>离线蒸馏模式</li>
</ol>
</li>
<li>
<p>量化蒸馏：将<strong>模型量化</strong>与知识蒸馏结合，在把模型权重从高精度（如 FP32）压缩到低精度（如 INT8、INT4）的同时，通过蒸馏弥补量化带来的性能损失。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b4186eb4a324b9daa09b55036577a65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-u5Lq65LiJ562J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561991&amp;x-signature=6bWPFaKl282xPP1x43i619rx%2B%2FY%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>量化的核心问题：低精度量化会导致权重信息丢失，模型精度下降；</li>
<li>通过蒸馏进行补偿的策略：
<ol>
<li>教师：高精度的原始模型（FP32）；</li>
<li>学生：量化后的低精度模型（INT8）；</li>
<li>蒸馏目标：让量化学生的输出与高精度教师的输出对齐，同时优化量化误差。</li>
</ol>
</li>
<li>QAT：在<strong>训练过程中就模拟量化的误差</strong>，让模型提前适应低精度，最终量化后的精度损失大幅降低。
<ol>
<li>通俗讲并不是学生就一直用低精度来训练，而是在量化 / 反量化节点降低精确度进行训练，这样就可以让模型感受到丢失精确度带来的影响，从而降低这部分影响</li>
</ol>
</li>
</ol>
</li>
<li>
<p>终身蒸馏：也叫<strong>持续学习蒸馏</strong>，解决模型在<strong>连续学习新任务</strong>时的 “灾难性遗忘” 问题 —— 让模型在学习新任务知识的同时，通过蒸馏保留旧任务的知识。</p>
<ol>
<li>特有机制：
<ol>
<li><strong>知识回放</strong>（Replay）：训练新任务时，每隔 epoch 回放缓存的旧任务样本，让学生同时学新旧任务；</li>
<li><strong>弹性权重固化（EWC）</strong>：对旧任务重要的参数 “加权重惩罚”，避免新任务训练时修改这些参数（比如识别猫的参数，学狗时不被篡改）。</li>
</ol>
</li>
<li>知识缓存机制
<ol>
<li>学习新任务时，缓存旧任务的关键样本和教师模型（旧任务的最优模型）；</li>
<li>新任务的学生模型同时学习：① 新任务的硬标签；② 旧任务教师模型的软标签。</li>
</ol>
</li>
<li>增量蒸馏策略
<ol>
<li>每次学习新任务后，更新教师模型为 “新旧任务融合的模型”；</li>
<li>后续任务的学生模型，始终学习最新的教师模型知识。</li>
</ol>
</li>
</ol>
</li>
<li>
<p>NAS蒸馏：将<strong>知识蒸馏与神经架构搜索（NAS）</strong> 结合，用教师模型的知识来指导 NAS 算法，高效搜索出性能接近教师、且计算量极小的学生模型架构</p>
<ol>
<li>一种可以自动选择最优学生模型的算法。</li>
</ol>
</li>
<li>
<p>方法选择：</p>
<ol>
<li><strong>看数据条件</strong>：数据隐私→无数据蒸馏；数据多模态→跨模态蒸馏；</li>
<li><strong>看模型架构</strong>：图结构→图蒸馏；Transformer→注意力蒸馏；</li>
<li><strong>看部署需求</strong>：边缘设备→量化蒸馏；自动化设计→NAS 蒸馏；</li>
<li><strong>看任务特性</strong>：持续学习→终身蒸馏；鲁棒性要求→对抗蒸馏；高精度要求→多教师蒸馏。</li>
<li>常用程度：注意力蒸馏 / 量化蒸馏 / 多教师蒸馏 &gt; 跨模态蒸馏 &gt; 对抗 / 无数据 / 图 / 终身 / NAS 蒸馏；</li>
</ol>
</li>
</ol>
<h3 data-id="heading-6">参考</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fu012347027%2Farticle%2Fdetails%2F111415197" target="_blank" title="https://blog.csdn.net/u012347027/article/details/111415197" ref="nofollow noopener noreferrer">1</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fa131529%2Farticle%2Fdetails%2F144582677" target="_blank" title="https://blog.csdn.net/a131529/article/details/144582677" ref="nofollow noopener noreferrer">2</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 如何准确判断数据类型？5 种方法深度对比]]></title>    <link>https://juejin.cn/post/7593139476840841222</link>    <guid>https://juejin.cn/post/7593139476840841222</guid>    <pubDate>2026-01-09T11:31:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593139476840841222" data-draft-id="7582785032852504639" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 如何准确判断数据类型？5 种方法深度对比"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-09T11:31:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 如何准确判断数据类型？5 种方法深度对比
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T11:31:57.000Z" title="Fri Jan 09 2026 11:31:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在写js的时候，很容易因为数据类型没判断好而出错，比如这样的代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">return</span> a + b;
}
<span class="hljs-comment">// 我以为是 10 + 20 = 30</span>
<span class="hljs-title function_">calculate</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>); <span class="hljs-comment">// 结果 30 对的 </span>

<span class="hljs-comment">// 实际上用户输入的是字符串和数字</span>
<span class="hljs-title function_">calculate</span>(<span class="hljs-string">"10"</span>, <span class="hljs-number">20</span>); <span class="hljs-comment">// 结果为 "1020" </span>
</code></pre>
<p>所以为了避免这种情况的出现，我们还是要去判断好数据类型。</p>
<p>在<code>JavaScript</code>中，有几种方式来判断数据类型，以下是常用的方法：</p>
<h2 data-id="heading-0">1. typeof 操作符</h2>
<p>最常用的类型判断方法，但有一些局限性：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">typeof</span> <span class="hljs-number">42</span>;           <span class="hljs-comment">// "number"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-string">"hello"</span>;      <span class="hljs-comment">// "string"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-literal">true</span>;         <span class="hljs-comment">// "boolean"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-literal">undefined</span>;    <span class="hljs-comment">// "undefined"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-literal">null</span>;         <span class="hljs-comment">// "object" (历史遗留问题)</span>
<span class="hljs-keyword">typeof</span> {};           <span class="hljs-comment">// "object"</span>
<span class="hljs-keyword">typeof</span> [];           <span class="hljs-comment">// "object"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){}; <span class="hljs-comment">// "function"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Symbol</span>();     <span class="hljs-comment">// "symbol"</span>
<span class="hljs-keyword">typeof</span> <span class="hljs-number">42n</span>;          <span class="hljs-comment">// "bigint"</span>
</code></pre>
<p><strong>局限性</strong>：</p>
<ul>
<li>无法区分数组、对象和 <code>null</code></li>
<li>函数返回 <code>function</code></li>
<li><code>typeof</code> 适合判断基本类型，但遇到对象类型就力不从心了</li>
</ul>
<hr/>
<h2 data-id="heading-1">2. instanceof 操作符</h2>
<p>用于检测构造函数的 <code>prototype</code> 属性是否出现在对象的原型链中：</p>
<pre><code class="hljs language-javascript" lang="javascript">[] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>;           <span class="hljs-comment">// true</span>
{} <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>;          <span class="hljs-comment">// true</span>
<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>;    <span class="hljs-comment">// true</span>
<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){} <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Function</span>; <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 继承关系，数组也是对象</span>
[] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>;          <span class="hljs-comment">// true</span>
</code></pre>
<p><code>instanceof</code> 的局限性：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 基本类型用不了</span>
<span class="hljs-number">42</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Number</span>;          <span class="hljs-comment">// false</span>
<span class="hljs-string">"hello"</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">String</span>;     <span class="hljs-comment">// false</span>
</code></pre>
<p>在跨 <code>iframe</code> 或不同 <code>window</code> 环境下可能失效（因为构造函数不同）</p>
<hr/>
<h2 data-id="heading-2">3. Object.prototype .toString.call()</h2>
<p>这是最准确、最可靠的方法,能识别所有内置类型！</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-number">42</span>);           <span class="hljs-comment">// "[object Number]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-string">"hello"</span>);      <span class="hljs-comment">// "[object String]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">true</span>);         <span class="hljs-comment">// "[object Boolean]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>);         <span class="hljs-comment">// "[object Null]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">undefined</span>);    <span class="hljs-comment">// "[object Undefined]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>([]);           <span class="hljs-comment">// "[object Array]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>({});           <span class="hljs-comment">// "[object Object]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){}); <span class="hljs-comment">// "[object Function]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-title class_">Symbol</span>());     <span class="hljs-comment">// "[object Symbol]"</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-number">42n</span>);          <span class="hljs-comment">// "[object BigInt]"</span>
</code></pre>
<p>我们封装一个实用的工具函数：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getRealType</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(value)
        .<span class="hljs-title function_">slice</span>(<span class="hljs-number">8</span>, -<span class="hljs-number">1</span>)          <span class="hljs-comment">// 截取"[object "和"]"之间的内容</span>
        .<span class="hljs-title function_">toLowerCase</span>();         <span class="hljs-comment">// 转为小写，更友好</span>
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getRealType</span>([]));        <span class="hljs-comment">// "array"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getRealType</span>(<span class="hljs-literal">null</span>));      <span class="hljs-comment">// "null"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getRealType</span>({}));        <span class="hljs-comment">// "object"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">getRealType</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>())); <span class="hljs-comment">// "date"</span>
</code></pre>
<hr/>
<h2 data-id="heading-3">4. 专用方法</h2>
<p>对于一些特殊类型，JavaScript提供了专门的判断方法：</p>
<h3 data-id="heading-4">判断数组：Array.isArray()</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>([]);     <span class="hljs-comment">// true</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>({});     <span class="hljs-comment">// false</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(<span class="hljs-string">"123"</span>);  <span class="hljs-comment">// false</span>
</code></pre>
<h3 data-id="heading-5">判断NaN：Number.isNaN()</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 注意区别！</span>
<span class="hljs-built_in">isNaN</span>(<span class="hljs-string">"hello"</span>);        <span class="hljs-comment">// true  ← 字符串不是数字，但这样判断容易误解</span>
<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// false ← 更准确：只有真正的NaN才返回true</span>
<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(<span class="hljs-title class_">NaN</span>);     <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-6">判断有限数字：Number.isFinite()</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isFinite</span>(<span class="hljs-number">42</span>);     <span class="hljs-comment">// true</span>
<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isFinite</span>(<span class="hljs-title class_">Infinity</span>); <span class="hljs-comment">// false  ← 无穷大不是有限数字</span>
<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isFinite</span>(<span class="hljs-string">"42"</span>);   <span class="hljs-comment">// false  ← 字符串不是数字</span>
</code></pre>
<h2 data-id="heading-7">编写健壮的函数</h2>
<p>在实际开发中的应用：</p>
<h3 data-id="heading-8">场景1：安全的数字相加</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">safeAdd</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-comment">// 确保两个参数都是数字类型</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a !== <span class="hljs-string">'number'</span> || <span class="hljs-keyword">typeof</span> b !== <span class="hljs-string">'number'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'参数必须是数字'</span>);
    }
    <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-title function_">safeAdd</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);     <span class="hljs-comment">// 3</span>
<span class="hljs-title function_">safeAdd</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"2"</span>);   <span class="hljs-comment">// 报错：参数必须是数字</span>
</code></pre>
<h3 data-id="heading-9">场景2：处理多种数据类型</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-comment">// getRealType方法在第3点Object.prototype.toString.call()中有写</span>
    <span class="hljs-keyword">const</span> type = <span class="hljs-title function_">getRealType</span>(data); 
    
    <span class="hljs-keyword">switch</span>(type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'array'</span>:
            <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item * <span class="hljs-number">2</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'object'</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(data).<span class="hljs-property">length</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'string'</span>:
            <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">toUpperCase</span>();
        <span class="hljs-keyword">case</span> <span class="hljs-string">'number'</span>:
            <span class="hljs-keyword">return</span> data * <span class="hljs-number">2</span>;
        <span class="hljs-attr">default</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'不支持的数据类型'</span>;
    }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">processData</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]));    <span class="hljs-comment">// [2, 4, 6]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">processData</span>(<span class="hljs-string">"hello"</span>));      <span class="hljs-comment">// "HELLO"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">processData</span>({<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span>})); <span class="hljs-comment">// 2</span>
</code></pre>
<h2 data-id="heading-10">总结：选择合适的方法</h2>



































<table><thead><tr><th>场景</th><th>推荐方法</th><th>示例</th></tr></thead><tbody><tr><td>判断基本类型</td><td><code>typeof</code></td><td><code>typeof "hello" === "string"</code></td></tr><tr><td>判断数组</td><td><code>Array.isArray()</code></td><td><code>Array.isArray([])</code></td></tr><tr><td>判断自定义对象</td><td><code>instanceof</code></td><td><code>obj instanceof MyClass</code></td></tr><tr><td>精确类型判断</td><td><code>Object.prototype.toString.call()</code></td><td>见上文工具函数</td></tr><tr><td>特殊值判断</td><td>专用方法</td><td><code>Number.isNaN()</code>, <code>Number.isFinite()</code></td></tr></tbody></table>
<blockquote>
<p>本文首发于公众号：程序员大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-11">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FUqzEppE_f8gdil6S-toBTg" target="_blank" title="https://mp.weixin.qq.com/s/UqzEppE_f8gdil6S-toBTg" ref="nofollow noopener noreferrer">写前端久了，我用 Node.js 给自己造了几个省力小工具</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FF4JkmYxUs9RAtsti6V1uhg" target="_blank" title="https://mp.weixin.qq.com/s/F4JkmYxUs9RAtsti6V1uhg" ref="nofollow noopener noreferrer">我也是写了很久 TypeScript，才意识到这些写法不对</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F2wHCiqgtRfK_008fLBamPQ" target="_blank" title="https://mp.weixin.qq.com/s/2wHCiqgtRfK_008fLBamPQ" ref="nofollow noopener noreferrer">ThreadLocal 在实际项目中的 6 大用法，原来可以这么简单</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FsMAKhSLNvmU1ddxg0yv9Fg" target="_blank" title="https://mp.weixin.qq.com/s/sMAKhSLNvmU1ddxg0yv9Fg" ref="nofollow noopener noreferrer">重构了20个SpringBoot项目后，总结出这套稳定高效的架构设计</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS 特殊符号 / 英文导致换行问题速查表]]></title>    <link>https://juejin.cn/post/7593077945016221723</link>    <guid>https://juejin.cn/post/7593077945016221723</guid>    <pubDate>2026-01-09T10:02:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593077945016221723" data-draft-id="7593169840199794714" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS 特殊符号 / 英文导致换行问题速查表"/> <meta itemprop="keywords" content="CSS"/> <meta itemprop="datePublished" content="2026-01-09T10:02:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卡尔特斯"/> <meta itemprop="url" content="https://juejin.cn/user/4450440831840909"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS 特殊符号 / 英文导致换行问题速查表
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4450440831840909/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卡尔特斯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T10:02:55.000Z" title="Fri Jan 09 2026 10:02:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、最推荐通用写法（90% 场景）</h2>
<pre><code class="hljs language-arduino" lang="arduino">.text {
  <span class="hljs-type">word</span>-<span class="hljs-keyword">break</span>: normal;
  overflow-wrap: <span class="hljs-keyword">break</span>-<span class="hljs-type">word</span>;
  white-space: normal;
}
</code></pre>
<p><strong>适用：</strong></p>
<ul>
<li>中文 + 英文混排</li>
<li>URL / 特殊符号</li>
<li>不希望英文被拆成字母</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、常见需求对应写法</h2>
<blockquote>
<p>以下场景覆盖：<strong>不拆单词 / 允许拆单词 / 特殊符号提前换行</strong> 等真实业务需求</p>
</blockquote>
<h3 data-id="heading-2">1️⃣ 不希望单词被拆开</h3>
<pre><code class="hljs language-arduino" lang="arduino">.text {
  <span class="hljs-type">word</span>-<span class="hljs-keyword">break</span>: normal;
  overflow-wrap: normal;
}
</code></pre>
<hr/>
<h3 data-id="heading-3">2️⃣ 单词太长允许必要时换行（推荐）</h3>
<pre><code class="hljs language-arduino" lang="arduino">.text {
  overflow-wrap: <span class="hljs-keyword">break</span>-<span class="hljs-type">word</span>;
  <span class="hljs-type">word</span>-<span class="hljs-keyword">break</span>: normal;
}
</code></pre>
<hr/>
<h3 data-id="heading-4">3️⃣ 特殊符号（<code>- _ / .</code>）导致断行</h3>
<pre><code class="hljs language-arduino" lang="arduino">.text {
  <span class="hljs-type">word</span>-<span class="hljs-keyword">break</span>: keep-all;
  overflow-wrap: <span class="hljs-keyword">break</span>-<span class="hljs-type">word</span>;
}
</code></pre>
<hr/>
<h3 data-id="heading-5">4️⃣ 完全不换行（一行显示）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">white-space</span>: nowrap;
}
</code></pre>
<hr/>
<h3 data-id="heading-6">5️⃣ 一行显示，超出省略号</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.text</span> {
  <span class="hljs-attribute">white-space</span>: nowrap;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">text-overflow</span>: ellipsis;
}
</code></pre>
<hr/>
<h3 data-id="heading-7">6️⃣ URL / 长链接优雅断行</h3>
<pre><code class="hljs language-arduino" lang="arduino">.text {
  <span class="hljs-type">word</span>-<span class="hljs-keyword">break</span>: normal;
  overflow-wrap: anywhere;
}
</code></pre>
<hr/>
<h3 data-id="heading-8">7️⃣ 代码 / hash / token 强制断行</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.code</span> {
  <span class="hljs-attribute">word-break</span>: break-all;
  <span class="hljs-attribute">font-family</span>: monospace;
}
</code></pre>
<hr/>
<h3 data-id="heading-9">8️⃣ <strong>明确接受单词被拆开（强制任何位置换行）</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino">.text {
  <span class="hljs-type">word</span>-<span class="hljs-keyword">break</span>: <span class="hljs-keyword">break</span>-all;
}
</code></pre>
<p><strong>适用：</strong></p>
<ul>
<li>日志内容</li>
<li>长 hash / token / ID</li>
<li>空间极窄但必须完整展示</li>
</ul>
<p>⚠️ 英文会被拆成字母，属于<strong>主动选择的行为</strong></p>
<hr/>
<h3 data-id="heading-10">9️⃣ <strong>特殊符号导致“提前换行”（如 <code>- / _ .</code>）</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino">.text {
  <span class="hljs-type">word</span>-<span class="hljs-keyword">break</span>: normal;
  overflow-wrap: normal;
}
</code></pre>
<p><strong>说明：</strong></p>
<ul>
<li>禁止在符号处断行</li>
<li>让浏览器只在真正需要时换行</li>
</ul>
<hr/>
<h3 data-id="heading-11">🔟 <strong>允许在特殊符号处优先换行（比拆字母更友好）</strong></h3>
<pre><code class="hljs language-arduino" lang="arduino">.text {
  overflow-wrap: anywhere;
  <span class="hljs-type">word</span>-<span class="hljs-keyword">break</span>: normal;
}
</code></pre>
<p><strong>适用：</strong></p>
<ul>
<li>URL / 路径</li>
<li><code>aaa-bbb-ccc-ddd</code></li>
<li>希望优先在符号处分行，而不是字母中间</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-meta">---
</span>
<span class="hljs-comment">## 三、Flex / Table 常见坑</span>

<span class="hljs-comment">### flex 子项内容被异常换行</span>

<span class="hljs-string">```css</span>
<span class="hljs-string">.item</span> {
  <span class="hljs-attr">min-width:</span> <span class="hljs-number">0</span><span class="hljs-string">;</span>
  <span class="hljs-attr">overflow-wrap:</span> <span class="hljs-string">break-word;</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-12">四、不推荐写法（慎用）</h2>
<blockquote>
<p>⚠️ 以下写法不是不能用，而是<strong>必须明确知道后果</strong></p>
</blockquote>
<pre><code class="hljs language-kotlin" lang="kotlin">word-<span class="hljs-keyword">break</span>: <span class="hljs-keyword">break</span>-all;
</code></pre>
<p>❌ 会把英文拆成字母，仅适合日志 / code 场景</p>
<hr/>
<h2 data-id="heading-13">五、属性速记表</h2>





















<table><thead><tr><th>属性</th><th>作用</th></tr></thead><tbody><tr><td><code>word-break</code></td><td>是否允许在单词内部断行</td></tr><tr><td><code>overflow-wrap</code></td><td>单词太长时是否允许换行（⭐推荐）</td></tr><tr><td><code>white-space</code></td><td>是否允许换行</td></tr></tbody></table>
<hr/>
<p>📌 <strong>记住一句话：</strong></p>
<blockquote>
<p><strong>优先用 <code>overflow-wrap: break-word</code>，避免 <code>word-break: break-all</code></strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用changeset来管理你的npm包版本]]></title>    <link>https://juejin.cn/post/7593139476840611846</link>    <guid>https://juejin.cn/post/7593139476840611846</guid>    <pubDate>2026-01-09T10:05:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593139476840611846" data-draft-id="7593098101432238134" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用changeset来管理你的npm包版本"/> <meta itemprop="keywords" content="前端,NPM"/> <meta itemprop="datePublished" content="2026-01-09T10:05:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀饭52"/> <meta itemprop="url" content="https://juejin.cn/user/2313028196632446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用changeset来管理你的npm包版本
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028196632446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀饭52
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T10:05:48.000Z" title="Fri Jan 09 2026 10:05:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"/>
<p>简单介绍下，changeset是一个版本管理和生成更新日志的工具，超级适用于多包仓库，比如monorepo，可以在提交发布时，自动更新所有包的版本号，创建Tag，并且生成更新日志。</p>
<h3 data-id="heading-1">一、安装</h3>
<p>进入项目之后执行命令，安装changeset，并且初始化</p>
<pre><code class="hljs language-bash" lang="bash"> pnpm add -D @changesets/cli
 pnpm changeset init
</code></pre>
<p>执行完之后，在项目中会新增一个<code>.changeset</code>目录，用于存放配置文件和<strong>临时的版本变更描述文件</strong>。</p>
<pre><code class="hljs language-txt" lang="txt">.changeset/
 ├─ config.json
 └─ README.md
</code></pre>
<h3 data-id="heading-2">二、使用流程</h3>
<p>在通用的版本管理流程中，通常会区分为：</p>
<ul>
<li><strong>预发布版本</strong>（如alpha和beta）</li>
<li><strong>正式版本</strong></li>
</ul>
<h4 data-id="heading-3">预发布版本</h4>
<p>预发布阶段的两级为alpha和beta，下面是大致区别：</p>



































<table><thead><tr><th align="left">维度</th><th>alpha（内测）</th><th>beta（公测）</th></tr></thead><tbody><tr><td align="left"><strong>代码稳定性</strong></td><td>随时可能大改</td><td>功能基本锁定，不会有大的调整</td></tr><tr><td align="left"><strong>测试人群</strong></td><td>团队内部</td><td>灰度用户</td></tr><tr><td align="left"><strong>发布频率</strong></td><td>每天/每周都能出包</td><td>节奏稍慢，某个阶段的版本</td></tr><tr><td align="left"><strong>版本号示例</strong></td><td>1.0.0-alpha.0 ➜ 1.0.0-alpha.1 …</td><td>1.0.0-beta.0 ➜ 1.0.0-beta.1 …</td></tr><tr><td align="left"><strong>退出条件</strong></td><td>达到功能完备 → 进入beta</td><td>连续几天无阻塞Bug → 发布正式版</td></tr></tbody></table>
<p>相关命令：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm changeset pre enter alpha   <span class="hljs-comment"># 进入alpha模式,</span>
pnpm changeset version          <span class="hljs-comment"># 版本变成0.0.1-alpha.0</span>

pnpm changeset pre enter beta   <span class="hljs-comment"># 进入beta模式</span>
pnpm changeset version          <span class="hljs-comment"># 版本变成0.0.1-beta.0</span>

<span class="hljs-comment"># 结束预发布</span>
pnpm changeset pre <span class="hljs-built_in">exit</span>
pnpm changeset version          <span class="hljs-comment"># 版本变成0.0.1</span>
</code></pre>
<h4 data-id="heading-4">正式版本</h4>
<p>当你完成某个包的开发，准备发版时，执行：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm changeset
</code></pre>
<p>如果是多包仓库，终端会出现一个选择框，让你选择改过的包，</p>
<ol>
<li>
<p>按空格选中你改过的包（有星号就算选中）→ 回车，</p>
</li>
<li>
<p>选包的更新级别，会依次出现major和minor，回车到下一步，如果都没选中，就默认为patch，输入本次更新的描述回车</p>
<ul>
<li>patch：修复小bug（1.0.0→1.0.1）</li>
<li>minor：添加新功能（1.0.0→1.1.0）</li>
<li>major：破坏性的大版本调整，api级别的调整（1.0.0→2.0.0）</li>
</ul>
</li>
</ol>
<p>单包仓库就直接到了选择更新级别这一步，同样是输入描述，然后回车；</p>
<p>生成版本号，执行：</p>
<pre><code class="hljs language-bash" lang="bash">pnpm changeset version
</code></pre>
<p>你会发现<code>.changeset</code>文件夹中刚才生成的md文件都已经不见了，版本号也升好了。</p>
<h4 data-id="heading-5">发布</h4>
<ul>
<li>登录npm</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">npm login
</code></pre>
<ul>
<li>发版</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">pnpm changeset publish
</code></pre>
<p>成功后，会在git创建对应的git tag，终端会给出每个包的版本号和 npm链接。</p>
<h3 data-id="heading-6">三、changeset总结</h3>
<p>最后总结下，对changeset的整体感觉</p>
<h4 data-id="heading-7">优点</h4>
<ol>
<li>版本语义化，显式标注变更级别</li>
<li>每一次变更都会新建个文件，方便review
<ul>
<li>列出受影响的包</li>
<li>变更的级别，patch/minor/major</li>
<li>变更的内容</li>
</ul>
</li>
<li>自动生成tag、版本号changelog</li>
<li>Monorepo依赖的自动推导，比如修改了a包，b包依赖了a包，那么b包也会更新版本</li>
</ol>
<h4 data-id="heading-8">缺点</h4>
<ol>
<li>会有额外心智负担，
<ul>
<li>每次变更都要执行changeset，会增加操作流程（其实我觉得这个不能算）</li>
<li>思考版本类型</li>
<li>流程容易漏</li>
</ul>
</li>
<li>单包项目有点多余，没完全发挥作用</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Switch2Antigravity: 让 IntelliJ IDEA 与 Antigravity 无缝协作]]></title>    <link>https://juejin.cn/post/7593181244708519988</link>    <guid>https://juejin.cn/post/7593181244708519988</guid>    <pubDate>2026-01-09T09:53:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593181244708519988" data-draft-id="7593173569871380532" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Switch2Antigravity: 让 IntelliJ IDEA 与 Antigravity 无缝协作"/> <meta itemprop="keywords" content="VibeCoding,IntelliJ IDEA,程序员"/> <meta itemprop="datePublished" content="2026-01-09T09:53:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PPPHUANG"/> <meta itemprop="url" content="https://juejin.cn/user/3083464300298525"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Switch2Antigravity: 让 IntelliJ IDEA 与 Antigravity 无缝协作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3083464300298525/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PPPHUANG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T09:53:31.000Z" title="Fri Jan 09 2026 09:53:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Antigravity</strong> 是一款“以智能体为主”的平台。它预设 AI 不仅是编写代码的工具，而且是能够规划、执行、验证和迭代复杂工程任务的自主行动者，几乎无需人工干预。随着 <strong>Gemini 3</strong> 的发布 Antigravity 在 vibe coding 领域火的一塌糊涂。</p>
<p>在日常开发中，经常在 <strong>IntelliJ IDEA</strong> (强大的 Java/Kotlin 静态分析与重构能力) 和 <strong>Antigravity</strong> (流畅的 AI 辅助编码体验) 之间切换。</p>
<p>为了解决两个编辑器之间频繁“手动定位文件”的痛点，我开发了一个 IntelliJ IDEA 插件 —— <strong>Switch2Antigravity</strong>，搭配 vs code 的 <strong>Switch2IDEA</strong> 插件让 IntelliJ IDEA 与 Antigravity 无缝协作。</p>
<h2 data-id="heading-0"><strong>✨ 核心功能</strong></h2>
<p>这个插件的核心目标只有一个：<strong>Context Switching Costs Null (让上下文切换零成本)</strong>。</p>
<ul>
<li>
<p><strong>⚡ 一键跳转</strong>: 在 IDEA 中按下 <code>Shift + Alt + A</code>，当前编辑的文件会立即在 Antigravity 中打开。也可以在文件或者文件夹上点击右键 <code>Open in Antigravity</code>。</p>
</li>
<li>
<p><strong>📍 精准定位</strong>: 不仅仅是打开文件，它会自动带你到<strong>光标所在的具体行和列</strong>。无缝衔接你的思维流。</p>
</li>
<li>
<p><strong>🛠️ 智能配置</strong>:</p>
<ul>
<li>自动检测系统中的 Antigravity 安装路径 (支持 Windows <code>where</code> 和 Mac/Linux <code>which</code> 探测)。</li>
<li>支持在设置页面自定义可执行文件路径。</li>
</ul>
</li>
</ul>
<h2 data-id="heading-1"><strong>🔧 技术实现亮点</strong></h2>
<p>基于 IntelliJ Platform SDK 和 Kotlin 开发，虽然功能简单，但细节满满。</p>
<h3 data-id="heading-2"><strong>1. 跨平台启动命令</strong></h3>
<p>不同系统的启动参数略有不同，为了保证稳定性，我们使用了原生的 CLI 调用方式而不是 URL Scheme。</p>
<h3 data-id="heading-3"><strong>2. 智能路径探测</strong></h3>
<p>很多同学的安装路径各不相同，我们在 <code>OpenInAntigravityAction</code> 中实现了多级探测策略：</p>
<ol>
<li><strong>用户配置优先</strong>: 检查插件设置中是否指定了路径。</li>
<li><strong>PATH 环境变量</strong>: 遍历 PATH 查找 <code>antigravity</code>。</li>
<li><strong>System Command</strong>: 尝试执行 <code>where antigravity</code> (Win) 或 <code>which antigravity</code> (Mac) 获取真实路径。</li>
<li><strong>默认路径兜底</strong>: 检查常见的默认安装位置 (如 <code>AppData</code>, <code>/Applications</code> 等)。</li>
</ol>
<h2 data-id="heading-4"><strong>🤯 Inception：用 Antigravity 开发 Antigravity 插件</strong></h2>
<p>更有趣的是，<strong>这个插件本身就是完全使用 Antigravity 辅助开发的</strong>。</p>
<p>从最初的 Gradle 脚本配置、Kotlin 逻辑实现，到复杂的 SVG 图标生成脚本，甚至是 solving 各种环境兼容性 bug，全过程都是在 Antigravity 的 AGENTIC 模式下完成的。</p>
<ul>
<li><strong>需求理解</strong>: 我只需要输入 "帮我搞个 IDEA 插件，能跳转到 Antigravity"，它就自动规划了 <code>plugin.xml</code> 和 Action 的结构。</li>
<li><strong>代码生成</strong>: 自动补全了复杂的 PSI 和 ActionSystem 相关代码。</li>
<li><strong>Debug</strong>: 遇到 Mac 下 <code>open</code> 命令参数问题，它迅速给出了 <code>ProcessBuilder</code> 的 CLI 替代方案。</li>
<li><strong>文案创作</strong>: 你正在看的这篇博客，也是它写的！</li>
</ul>
<p>这不仅是一个工具的集成，更是一次 <strong>AI Native 开发流程</strong> 的最佳实践。</p>
<h2 data-id="heading-5"><strong>📦 如何安装</strong></h2>
<p>插件上架 JetBrains Marketplace， 编辑器 JetBrains Marketplace 中搜索安装。</p>
<p>手动安装</p>
<ol>
<li>Clone 本项目源码。</li>
<li>运行 <code>./gradlew buildPlugin</code>。</li>
<li>在 IDEA 中选择 "Install Plugin from Disk"，选中 <code>build/distributions/</code> 下生成的 Zip 包即可。</li>
</ol>
<h2 data-id="heading-6"><strong>🔗 开源地址</strong></h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FPPPHUANG%2Fidea-antigravity-plugin" target="_blank" title="https://github.com/PPPHUANG/idea-antigravity-plugin" ref="nofollow noopener noreferrer">github.com/PPPHUANG/id…</a></p>
<hr/>
<p><em>Happy Coding with IDEA &amp; Antigravity!</em></p>
<p>公众号：<strong>DailyHappy</strong> 一位后端写码师，一位黑暗料理制造者。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 Angular UI 的 C# 桌面应用]]></title>    <link>https://juejin.cn/post/7592960378690945059</link>    <guid>https://juejin.cn/post/7592960378690945059</guid>    <pubDate>2026-01-09T09:15:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592960378690945059" data-draft-id="7593158683411103744" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 Angular UI 的 C# 桌面应用"/> <meta itemprop="keywords" content="后端,前端,Angular.js"/> <meta itemprop="datePublished" content="2026-01-09T09:15:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="TeamDev"/> <meta itemprop="url" content="https://juejin.cn/user/4158825167847872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 Angular UI 的 C# 桌面应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4158825167847872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    TeamDev
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T09:15:58.000Z" title="Fri Jan 09 2026 09:15:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/195aa778358b47d78318720fb2753233~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVGVhbURldg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554959&amp;x-signature=FjadOfvXrMRCMXS%2BjhA6wYG%2BPLM%3D" alt="" loading="lazy"/></p>
<p>现代用户体验已成为桌面应用的基础要求，采用 Web 技术能帮助团队更快交付软件。</p>
<p>本文将展示基于 C# 的桌面应用架构，其用户界面采用 Angular 实现。该应用支持离线运行且无需本地服务器。</p>
<h2 data-id="heading-0">为什么在桌面应用中使用 Web UI？</h2>
<p>Web UI 技术栈拥有庞大且经过充分验证的组件生态系统。采用 Angular 构建桌面UI，可借助熟悉的工具处理布局、主题和交互逻辑，避免在原生 UI 框架中重复实现相同控件。</p>
<p>这种方式同时简化了代码复用流程。同一个 Angular 应用既能在浏览器中运行，也能嵌入桌面应用宿主程序，大幅减少代码冗余，实现 UI 变更的集中管理。原生窗口与系统集成的工作由独立模块负责，Web 层保持可移植性，桌面应用则能与各个操作系统实现无缝集成。</p>
<h2 data-id="heading-1">C# 桌面应用中的 Web UI</h2>
<p>本文将构建一个 跨平台的 Avalonia 桌面应用，其 UI 是一个基于 Angular 的简单偏好设置界面。Angular Web 应用被打包进桌面程序中，而 .NET 端负责将设置保存到持久化存储中。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83d0dc08f9a5488c9c1461569da6ce99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVGVhbURldg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554959&amp;x-signature=QX6ZBmPIWne9kcNjTAx5FMzwZvU%3D" alt="运行在 Avalonia 窗口中的 Angular UI。" loading="lazy"/></p>
<p align="center"><span>运行在 Avalonia 窗口中的 Angular UI</span></p>
<p>UI 使用了 PrimeNG 作为现成的 Angular 组件库，但在该架构下，任何类似的组件库都可以使用。</p>
<p>将网页界面嵌入桌面壳层时,需克服以下障碍：</p>
<ol>
<li>需采用符合现代网页标准的可靠网页视图组件。</li>
<li>需实现无服务器环境下的网页内容加载，确保应用自包含性。</li>
<li>需建立 JavaScript 与 .NET 之间的双向通信机制。</li>
</ol>
<p>后续章节将依次说明：窗口与网页视图的配置方案、无服务器加载 Angular UI 的实现方法，以及通过 OpenAPI 规范定义的接口连接 JavaScript 与 .NET 的具体方案。</p>
<h2 data-id="heading-2">应用窗口与网页视图</h2>
<p>对于桌面壳层，我们使用 Avalonia 创建原生窗口和布局，并通过 DotNetBrowser（基于 Chromium 的跨平台网页视图组件）将其嵌入其中：</p>
<p><strong>MainWindow.axaml</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Window</span> <span class="hljs-attr">Width</span>=<span class="hljs-string">"1200"</span> <span class="hljs-attr">Height</span>=<span class="hljs-string">"800"</span> <span class="hljs-attr">Title</span>=<span class="hljs-string">"Angular Demo"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">app:BrowserView</span> <span class="hljs-attr">x:Name</span>=<span class="hljs-string">"BrowserView"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Window</span>&gt;</span>
</code></pre>
<p>在后端代码中，窗口会监听生命周期事件，并在打开时初始化浏览器组件：</p>
<p><strong>MainWindow.axaml.cs</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MainWindow</span> : <span class="hljs-title">Window</span>
{
<span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">string</span> Url = ResourceRequestHandler.Domain;

    <span class="hljs-keyword">public</span> IBrowser? Browser { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> IServiceProvider? ServiceProvider { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainWindow</span>()</span>
    {
        InitializeComponent();
        Opened += OnOpened;
        Closed += OnClosed;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnOpened</span>(<span class="hljs-params"><span class="hljs-built_in">object</span>? sender, EventArgs e</span>)</span>
    {
        Browser = ServiceProvider
            .GetRequiredService&lt;IEngineService&gt;()
            .CreateBrowser();
        BrowserView.InitializeFrom(Browser);

        <span class="hljs-keyword">await</span> Browser.Navigation.LoadUrl(Url);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnClosed</span>(<span class="hljs-params"><span class="hljs-built_in">object</span>? sender, EventArgs e</span>)</span>
    {
        Browser?.Dispose();
    }
}
</code></pre>
<p>Engine 本身由 <code>IEngineService</code> 管理，因此窗口只需在打开时请求新的浏览器实例，并在关闭时释放它。这样可以将 Engine 的生命周期和配置集中管理。</p>
<h2 data-id="heading-3">在桌面应用中加载 Web UI</h2>
<p>将 Angular 应用移入嵌入式浏览器会改变其加载方式。
在生产环境中，编译后的压缩文件会被打包到桌面应用中，而非通过常规浏览器标签页的 <code>http://localhost</code> 地址提供服务。</p>
<p>不过，在在开发阶段，您仍希望获得开发服务器的快速反馈和热重载功能。</p>
<p>在开发模式下，可保持常规 Angular 工作流：启动 <code>ng serve</code> 并加载开发 URL，这样热重载功才能得以保留。</p>
<h3 data-id="heading-4">生产环境中的 Web UI 加载</h3>
<p>在生产环境中，我们不希望依赖开发服务器，甚至不希望使用任何 HTTP 服务器。相反，嵌入式浏览器会加载类似 <code>dnb://internal.host/</code> 这样的自定义协议 URL。</p>
<p>DotNetBrowser 可拦截该协议请求，并通过嵌入资源响应数据而非网络请求。配置此协议处理器后，Angular 应用完全由包内部提供：</p>
<p><strong>EngineService.cs</strong></p>
<pre><code class="hljs language-ini" lang="ini">var <span class="hljs-attr">builder</span> = new EngineOptions.Builder
{
    <span class="hljs-attr">RenderingMode</span> = RenderingMode.HardwareAccelerated
}<span class="hljs-comment">;</span>
builder.Schemes.Add(Scheme.Create("dnb"), handler)<span class="hljs-comment">;</span>
</code></pre>
<p><strong>ResourceRequestHandler.cs</strong></p>
<pre><code class="hljs language-lua" lang="lua">private <span class="hljs-built_in">string</span> ConvertToResourcePath(<span class="hljs-built_in">string</span> url)
{
    <span class="hljs-built_in">string</span> <span class="hljs-built_in">path</span> = url.Replace(Domain, <span class="hljs-built_in">string</span>.Empty, StringComparison.Ordinal);
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span>.IsNullOrWhiteSpace(<span class="hljs-built_in">path</span>) || <span class="hljs-built_in">path</span> == <span class="hljs-string">"/"</span>)
    {
        <span class="hljs-built_in">path</span> = <span class="hljs-string">"browser/index.html"</span>;
    }
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">path</span>.StartsWith(<span class="hljs-string">"browser/"</span>, StringComparison.OrdinalIgnoreCase))
    {
        <span class="hljs-built_in">path</span> = $<span class="hljs-string">"browser/{path}"</span>;
    }
    <span class="hljs-keyword">return</span> prefix + <span class="hljs-built_in">path</span>.TrimStart(<span class="hljs-string">'/'</span>).Replace(<span class="hljs-string">"/"</span>, <span class="hljs-string">"."</span>);
}
</code></pre>
<p>完成资源加载配置后，剩下的关键步骤是让 Angular 与 .NET 之间进行信息交换。</p>
<h2 data-id="heading-5">Web 应用与 .NET 之间的通信</h2>
<p>与任何 Web UI 一样，Angular 应用也需要与后端进行通信。这便是应用程序的 .NET 部分，负责处理业务逻辑，而 Web UI 则负责用户交互。关键问题在于如何将这两部分连接起来，同时确保在应用程序演进过程中保持可维护性。</p>
<h3 data-id="heading-6">JavaScript 与 .NET 的直接桥接</h3>
<p>最直接的方式是将 .NET 方法直接暴露给 JavaScript。DotNetBrowser 支持这种方式。首先，定义一个 C# 类：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">PrefsService</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> PreferencesStore store;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PrefsService</span>(<span class="hljs-params">PreferencesStore store</span>)</span>
    {
        <span class="hljs-keyword">this</span>.store = store;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetAccountEmail</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> email</span>)</span>
    {
        <span class="hljs-keyword">var</span> account = store.GetAccount();
        account.Email = email;
        store.SetAccount(account);
    }
}
</code></pre>
<p>其次，在 TypeScript 中映射其结构：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrefsService</span> {
  <span class="hljs-title function_">setAccountEmail</span>(<span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">declare</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">prefsService</span>: <span class="hljs-title class_">PrefsService</span>;
<span class="hljs-comment">// ...</span>
prefsService.<span class="hljs-title function_">setAccountEmail</span>(<span class="hljs-string">'john.doe@example.com'</span>);
</code></pre>
<p>最后，将 C# 对象注入 JavaScript 环境：</p>
<pre><code class="hljs language-csharp" lang="csharp">browser.InjectJsHandler = <span class="hljs-keyword">new</span> Handler&lt;InjectJsParameters&gt;(p =&gt;
{
    <span class="hljs-built_in">dynamic</span> window = p.Frame.ExecuteJavaScript(<span class="hljs-string">"window"</span>).Result;
    <span class="hljs-keyword">if</span> (window != <span class="hljs-literal">null</span>)
    {
        window.prefsService = <span class="hljs-keyword">new</span> PrefsService(store);
    }
});
</code></pre>
<p>对于小型项目来说，这种方式简单直观，也容易理解。但当 API 增长到不止几个方法时，就会在 C# 和 TypeScript 中重复定义同样的契约，并依赖人工保持同步。</p>
<p>为避免这种问题，该应用将桥接层视为一个 小型 HTTP API，并使用工具自动生成客户端，具体做法将在 OpenAPI 章节中介绍。</p>
<h3 data-id="heading-7">OpenAPI</h3>
<p>在这种架构中，Web 与 .NET 之间的契约通过 OpenAPI 进行一次性描述。基于同一份规范，可以生成 强类型的 C# 和 TypeScript 模型与客户端，从而确保两端在 API 演进过程中始终保持同步。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79f0a8f4a4904b82942f54a94d7f44fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVGVhbURldg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554959&amp;x-signature=YQsKuZsOD6wWbSArMAhe%2B2QuUtU%3D" alt="Angular UI 与 .NET 处理程序的通信" loading="lazy"/></p>
<p align="center"><span>Angular UI 与 .NET 处理程序的通信</span></p>
<p>处理 API 请求时，我们采用与加载网页相同的 <code>dnb:/</code> 方案拦截器。此设计使应用保持自包含特性，避免暴露用户可在普通浏览器中访问的 <code>localhost</code> 端口或远程端点。</p>
<p>客户端方面，生成的 TypeScript 服务通过常规 <code>fetch()</code> API 进行通信。这确保 TypeScript 代码具备可移植性，并与常规浏览器环境兼容。</p>
<h4 data-id="heading-8">OpenAPI 契约概览</h4>
<p>以下是我们用于演示项目的 OpenAPI 定义精简版：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">paths:</span>
  <span class="hljs-string">/account:</span>
    <span class="hljs-attr">get:</span>
      <span class="hljs-attr">responses:</span>
        <span class="hljs-attr">'200':</span>
          <span class="hljs-attr">content:</span>
            <span class="hljs-attr">application/json:</span>
              <span class="hljs-attr">schema:</span>
                <span class="hljs-string">$ref:</span> <span class="hljs-string">'#/components/schemas/Account'</span>
    <span class="hljs-attr">put:</span>
      <span class="hljs-attr">requestBody:</span>
        <span class="hljs-attr">required:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">content:</span>
          <span class="hljs-attr">application/json:</span>
            <span class="hljs-attr">schema:</span>
              <span class="hljs-string">$ref:</span> <span class="hljs-string">'#/components/schemas/Account'</span>
<span class="hljs-attr">components:</span>
  <span class="hljs-attr">schemas:</span>
    <span class="hljs-attr">Account:</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">object</span>
      <span class="hljs-attr">properties:</span>
        <span class="hljs-attr">email:</span>
          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
        <span class="hljs-attr">fullName:</span>
          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
        <span class="hljs-attr">twoFactorAuthentication:</span>
          <span class="hljs-attr">type:</span> <span class="hljs-string">string</span>
        <span class="hljs-attr">biometricAuthentication:</span>
          <span class="hljs-attr">type:</span> <span class="hljs-string">boolean</span>
</code></pre>
<p>以下是 TypeScript 代码如何使用自动生成的 API 客户端：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> account = <span class="hljs-keyword">await</span> <span class="hljs-title class_">DefaultService</span>.<span class="hljs-title function_">getAccount</span>();

<span class="hljs-keyword">const</span> <span class="hljs-attr">next</span>: <span class="hljs-title class_">Account</span> = {
  ...account,
  <span class="hljs-attr">email</span>: <span class="hljs-string">'john.doe@example.com'</span>,
};

<span class="hljs-keyword">await</span> <span class="hljs-title class_">DefaultService</span>.<span class="hljs-title function_">putAccount</span>(next);
</code></pre>
<p>在服务器端，相同的 OpenAPI 定义支持拦截器处理 <code>dnb://internal.host/api/*</code> 请求，并将它们路由到业务逻辑类：</p>
<p><strong>ResourceRequestHandler.cs</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title class_">InterceptRequestResponse</span> <span class="hljs-title class_">HandleApiRequest</span>(
    <span class="hljs-title class_">InterceptRequestParameters</span> parameters,
    <span class="hljs-built_in">string</span> path)
{
    <span class="hljs-keyword">return</span> (method, trimmedPath) <span class="hljs-keyword">switch</span>
    {
        <span class="hljs-function">(<span class="hljs-params"><span class="hljs-string">"GET"</span>, <span class="hljs-string">"account"</span></span>) =&gt;</span> <span class="hljs-title class_">JsonResponse</span>(parameters, store.<span class="hljs-title class_">GetAccount</span>()),
        <span class="hljs-function">(<span class="hljs-params"><span class="hljs-string">"PUT"</span>, <span class="hljs-string">"account"</span></span>) =&gt;</span>
            <span class="hljs-title class_">HandlePut</span>&lt;<span class="hljs-title class_">Account</span>&gt;(parameters, <span class="hljs-function"><span class="hljs-params">a</span> =&gt;</span> store.<span class="hljs-title class_">SetAccount</span>(a)),
        <span class="hljs-function">(<span class="hljs-params"><span class="hljs-string">"GET"</span>, <span class="hljs-string">"profile-picture"</span></span>) =&gt;</span>
            <span class="hljs-title class_">JsonResponse</span>(parameters, store.<span class="hljs-title class_">GetProfilePicture</span>()),
        <span class="hljs-function">(<span class="hljs-params"><span class="hljs-string">"PUT"</span>, <span class="hljs-string">"profile-picture"</span></span>) =&gt;</span>
            <span class="hljs-title class_">HandlePut</span>&lt;<span class="hljs-title class_">ProfilePicture</span>&gt;(
                parameters,
                <span class="hljs-function"><span class="hljs-params">pic</span> =&gt;</span> store.<span class="hljs-title class_">SetProfilePicture</span>(pic)),
        <span class="hljs-function"><span class="hljs-params">_</span> =&gt;</span> <span class="hljs-title class_">CreateResponse</span>(parameters, <span class="hljs-title class_">HttpStatusCode</span>.<span class="hljs-property">NotFound</span>)
    };
}
</code></pre>
<p>该架构确保协议类型安全、支持离线操作，并保持与常规浏览器环境的兼容性，因为它依赖标准 HTTP 语义。</p>
<h2 data-id="heading-9">总结</h2>
<p>DotNetBrowser 与 Avalonia 提供了原生、跨平台的桌面外壳，而 Angular 与 PrimeNG 则带来了现代化的 Web UI。通过自定义协议加载 UI，可以保持应用完全自包含；而基于 OpenAPI 的契约，则允许 JavaScript 通过 fetch 调用 .NET，而无需额外启动服务器。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PostgreSQL 显式锁定：从原理到实践（趣味版）]]></title>    <link>https://juejin.cn/post/7593158683411431424</link>    <guid>https://juejin.cn/post/7593158683411431424</guid>    <pubDate>2026-01-09T10:11:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593158683411431424" data-draft-id="7593193235250724916" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PostgreSQL 显式锁定：从原理到实践（趣味版）"/> <meta itemprop="keywords" content="PostgreSQL"/> <meta itemprop="datePublished" content="2026-01-09T10:11:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="光蛋"/> <meta itemprop="url" content="https://juejin.cn/user/3537560778573467"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PostgreSQL 显式锁定：从原理到实践（趣味版）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3537560778573467/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    光蛋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T10:11:14.000Z" title="Fri Jan 09 2026 10:11:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：数据库里的“抢板凳”游戏</h2>
<p>想象一下，你和朋友围着一张摆满零食的桌子抢吃的：有人只想看一眼零食（读数据），有人想直接拿走（改数据），有人想把整张桌子搬走（删表）。如果没人管，桌子肯定会被掀翻——PostgreSQL的显式锁，就是这场“抢零食游戏”的规则和裁判，确保每个人都能按规矩来，不打架、不抢乱。</p>
<p>PostgreSQL的锁体系就像一套精密的“交通规则”，覆盖了表、行、页三个维度，还有专门解决“互不相让”的死锁机制，以及灵活的“自定义规则”（咨询锁）。接下来，我们用故事+示例的方式，把这些枯燥的锁概念讲明白。</p>
<h2 data-id="heading-1">1 表级锁：给整张零食桌定规矩</h2>
<p>表级锁是给整张表上的“大锁”，就像给零食桌贴标签：“只许看”，“可拿零食但不能搬桌子”，“谁都不许碰”……PostgreSQL定义了8种表级锁模式，核心是“谁和谁不能同时来”。</p>
<h3 data-id="heading-2">趣味场景：零食店的营业规则</h3>
<p>假设你开了一家零食店（数据库），货架（表）上摆着各种零食（数据），不同顾客（事务）有不同需求，你需要用表级锁来管理：</p>
<ul>
<li><strong>ACCESS SHARE（只许看）</strong> ：顾客只想看货架上有什么零食（SELECT），不拿也不碰。只要没人把货架搬走（ACCESS EXCLUSIVE），多少人看都可以。</li>
<li><strong>ROW EXCLUSIVE（可拿零食）</strong> ：顾客要拿走一包薯片（UPDATE/INSERT/DELETE），此时不能有人把货架锁起来盘点（SHARE），但其他人还能看、还能拿其他零食。</li>
<li><strong>ACCESS EXCLUSIVE（谁都不许碰）</strong> ：你要把整个货架搬走重装（ALTER TABLE/TRUNCATE），此时任何人都不能看、不能拿，必须等你搬完。</li>
</ul>
<h3 data-id="heading-3">实操示例：手动加表级锁</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 会话1：给products表加“只许读”的锁（ACCESS SHARE）</span>
<span class="hljs-keyword">BEGIN</span>;
LOCK <span class="hljs-keyword">TABLE</span> products <span class="hljs-keyword">IN</span> ACCESS SHARE MODE;
<span class="hljs-comment">-- 此时可以正常SELECT，但无法执行ALTER TABLE/TRUNCATE</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> category <span class="hljs-operator">=</span> <span class="hljs-string">'零食'</span>;
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 会话2：尝试给products表加“独占锁”（ACCESS EXCLUSIVE），会被阻塞</span>
<span class="hljs-keyword">BEGIN</span>;
LOCK <span class="hljs-keyword">TABLE</span> products <span class="hljs-keyword">IN</span> ACCESS EXCLUSIVE MODE; <span class="hljs-comment">-- 等待会话1提交后才会执行</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> products <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> stock <span class="hljs-type">int</span>;
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 冲突示例：ACCESS SHARE和ACCESS EXCLUSIVE互斥</span>
<span class="hljs-comment">-- 会话1先持有ACCESS SHARE，会话2的ACCESS EXCLUSIVE会等待；反之亦然</span>
</code></pre>
<h3 data-id="heading-4">核心冲突规则（简化版）</h3>

























<table><thead><tr><th>锁模式</th><th>能和谁共存？</th><th>不能和谁共存？</th></tr></thead><tbody><tr><td>ACCESS SHARE（只读）</td><td>几乎所有锁</td><td>只有ACCESS EXCLUSIVE</td></tr><tr><td>ROW EXCLUSIVE（改数据）</td><td>读锁、行共享锁</td><td>共享锁、独占锁、ACCESS EXCLUSIVE</td></tr><tr><td>ACCESS EXCLUSIVE（独占）</td><td>无</td><td>所有锁</td></tr></tbody></table>
<h3 data-id="heading-5">实际使用案例：电商商品表的表级锁控制</h3>
<p>【场景】电商平台的商品表（products）日常有大量用户查询商品信息（SELECT），运营人员需定期更新商品分类（ALTER TABLE），数据分析师需夜间生成销售统计报表（CREATE INDEX CONCURRENTLY）。</p>
<p>【锁策略设计】：</p>
<ul>
<li>用户查询商品时，PostgreSQL自动加ACCESS SHARE锁，不影响其他查询，仅阻塞ALTER TABLE等加ACCESS EXCLUSIVE锁的操作；</li>
<li>运营更新商品分类字段（ALTER TABLE products ADD COLUMN category_level int）时，需加ACCESS EXCLUSIVE锁，需避开查询高峰（如凌晨执行），避免阻塞大量用户查询；</li>
<li>数据分析师创建统计索引（CREATE INDEX CONCURRENTLY idx_products_sales ON products(sales_num)）时，加SHARE UPDATE EXCLUSIVE锁，不会阻塞用户查询，但会阻塞运营的ALTER TABLE操作，需与运营操作错峰。</li>
</ul>
<p>【实操验证】：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 高峰时段用户查询（自动加ACCESS SHARE锁）</span>
<span class="hljs-keyword">SELECT</span> name, price, stock <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> category <span class="hljs-operator">=</span> <span class="hljs-string">'electronics'</span>;

<span class="hljs-comment">-- 夜间运营更新字段（加ACCESS EXCLUSIVE锁）</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> products <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> category_level <span class="hljs-type">int</span>;
<span class="hljs-keyword">UPDATE</span> products <span class="hljs-keyword">SET</span> category_level <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> category <span class="hljs-operator">=</span> <span class="hljs-string">'electronics'</span>;
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 凌晨分析师创建并发索引（加SHARE UPDATE EXCLUSIVE锁）</span>
<span class="hljs-keyword">CREATE</span> INDEX CONCURRENTLY idx_products_sales <span class="hljs-keyword">ON</span> products(sales_num);
</code></pre>
<h2 data-id="heading-6">2 行级锁：只锁你想要的那包零食</h2>
<p>如果说表级锁是“锁整张桌子”，行级锁就是“只锁你手里的那包薯片”——不影响别人拿其他零食，精准又高效。PostgreSQL的行级锁只阻塞“改这行数据的人”，不影响“看这行数据的人”。</p>
<h3 data-id="heading-7">趣味场景：抢最后一包限量薯片</h3>
<p>零食店只剩1包限量薯片（行数据），两个顾客同时想买：</p>
<ul>
<li>顾客A先伸手拿（SELECT ... FOR UPDATE），给这包薯片贴了“我要了”的标签（行级排他锁）；</li>
<li>顾客B再伸手，发现标签后只能等顾客A松手（事务结束），要么买到，要么发现薯片已经被买走（行被删除）。</li>
</ul>
<h3 data-id="heading-8">实操示例：行级锁的4种模式</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 会话1：锁定id=100的薯片行（FOR UPDATE，排他锁）</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- 此时这行被锁定，其他会话改这行都会等</span>
<span class="hljs-keyword">UPDATE</span> products <span class="hljs-keyword">SET</span> stock <span class="hljs-operator">=</span> stock <span class="hljs-operator">-</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
<span class="hljs-comment">-- 暂不提交，保持锁</span>

<span class="hljs-comment">-- 会话2：尝试改同一行，会被阻塞</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> products <span class="hljs-keyword">SET</span> price <span class="hljs-operator">=</span> <span class="hljs-number">9.9</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">100</span>; <span class="hljs-comment">-- 等待会话1提交/回滚</span>
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 更温和的锁：FOR NO KEY UPDATE（不阻塞FOR KEY SHARE）</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">NO</span> KEY <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- 只锁“非主键/外键列”，适合普通更新</span>
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- 共享锁：FOR SHARE（多人可看，都不能改）</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">FOR</span> SHARE;
<span class="hljs-comment">-- 其他会话可以加FOR SHARE，但不能加FOR UPDATE</span>
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h3 data-id="heading-9">行级锁冲突规则</h3>
<h3 data-id="heading-10">实际使用案例：秒杀活动中的行级锁防超卖</h3>
<p>【场景】电商秒杀活动，某款限量100件的商品，大量用户同时抢购，需防止超卖（即最终下单数超过库存数）。</p>
<p>【问题分析】：若不使用行级锁，多个事务同时读取库存（如stock=1），都判断有库存并执行扣减，会导致最终stock变为-1（超卖）。</p>
<p>【解决方案】：使用SELECT ... FOR UPDATE行级锁，确保同一时刻只有一个事务能修改该商品的库存记录。</p>
<p>【实操代码】：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 秒杀下单核心逻辑（需在事务中执行）</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-comment">-- 锁定目标商品行，防止其他事务同时修改</span>
<span class="hljs-keyword">SELECT</span> stock <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1001</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- 检查库存是否充足</span>
IF (<span class="hljs-keyword">SELECT</span> stock <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1001</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>
  <span class="hljs-comment">-- 扣减库存</span>
  <span class="hljs-keyword">UPDATE</span> products <span class="hljs-keyword">SET</span> stock <span class="hljs-operator">=</span> stock <span class="hljs-operator">-</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1001</span>;
  <span class="hljs-comment">-- 创建订单记录</span>
  <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> orders (product_id, user_id, create_time) 
  <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1001</span>, #{userId}, NOW());
  <span class="hljs-keyword">COMMIT</span>;
  <span class="hljs-keyword">RETURN</span> <span class="hljs-string">'下单成功'</span>;
<span class="hljs-keyword">ELSE</span>
  <span class="hljs-keyword">ROLLBACK</span>;
  <span class="hljs-keyword">RETURN</span> <span class="hljs-string">'库存不足'</span>;
<span class="hljs-keyword">END</span> IF;
</code></pre>
<p>【说明】：通过FOR UPDATE锁定商品行后，其他抢购该商品的事务会阻塞在SELECT ... FOR UPDATE步骤，等待当前事务提交或回滚后再执行，从而避免超卖。</p>








































<table><thead><tr><th>请求的锁</th><th>FOR KEY SHARE</th><th>FOR SHARE</th><th>FOR NO KEY UPDATE</th><th>FOR UPDATE</th></tr></thead><tbody><tr><td>FOR KEY SHARE</td><td>✅</td><td>✅</td><td>✅</td><td>❌</td></tr><tr><td>FOR SHARE</td><td>✅</td><td>✅</td><td>❌</td><td>❌</td></tr><tr><td>FOR NO KEY UPDATE</td><td>❌</td><td>❌</td><td>❌</td><td>❌</td></tr><tr><td>FOR UPDATE</td><td>❌</td><td>❌</td><td>❌</td><td>❌</td></tr></tbody></table>
<h2 data-id="heading-11">3 页级锁：零食盒的“临时锁”</h2>
<p>页级锁是PostgreSQL内部用的“小锁”——把表拆成一个个“零食盒”（数据页），操作盒里的零食时，先锁盒子，用完马上放。对应用开发者来说，<strong>完全不用关心</strong>，PostgreSQL会自动处理，这里只做科普：</p>
<ul>
<li>作用：控制对内存中数据页的读写；</li>
<li>特点：用完就放，不持久，开发者无需手动操作。</li>
</ul>
<h2 data-id="heading-12">4 死锁：谁都不让谁的“僵局”</h2>
<p>死锁就像两个顾客吵架：</p>
<p>顾客A：你先把我的薯片还给我，我再给你可乐！</p>
<p>顾客B：你先把我的可乐还给我，我再给你薯片！</p>
<p>谁都不让步，最后只能店长（PostgreSQL）出面，把其中一个人劝走（中断事务），打破僵局。</p>
<h3 data-id="heading-13">趣味场景：转账引发的死锁</h3>
<p>小明要给小红转100元，小红要给小明转50元，两人同时操作：</p>
<ol>
<li>小明的事务：先锁自己的账户（更新余额-100），再想锁小红的账户（+100）；</li>
<li>小红的事务：先锁自己的账户（更新余额-50），再想锁小明的账户（+50）；</li>
<li>结果：小明等小红松手，小红等小明松手，死锁！</li>
</ol>
<h3 data-id="heading-14">实操示例：复现并解决死锁</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 先建表：账户表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> accounts (
  acctnum <span class="hljs-type">int</span> <span class="hljs-keyword">PRIMARY</span> KEY,
  balance <span class="hljs-type">numeric</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>)
);
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> accounts <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">11111</span>, <span class="hljs-number">1000</span>), (<span class="hljs-number">22222</span>, <span class="hljs-number">1000</span>);

<span class="hljs-comment">-- 会话1（小明）：先更自己，再更小红</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> acctnum <span class="hljs-operator">=</span> <span class="hljs-number">11111</span>;
<span class="hljs-comment">-- 暂不提交，保持锁</span>

<span class="hljs-comment">-- 会话2（小红）：先更自己，再更小明</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">50</span> <span class="hljs-keyword">WHERE</span> acctnum <span class="hljs-operator">=</span> <span class="hljs-number">22222</span>;
<span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> <span class="hljs-number">50</span> <span class="hljs-keyword">WHERE</span> acctnum <span class="hljs-operator">=</span> <span class="hljs-number">11111</span>; <span class="hljs-comment">-- 等待会话1</span>

<span class="hljs-comment">-- 回到会话1：尝试更小红，触发死锁</span>
<span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> acctnum <span class="hljs-operator">=</span> <span class="hljs-number">22222</span>;
<span class="hljs-comment">-- PostgreSQL会提示：ERROR:  deadlock detected</span>
<span class="hljs-comment">-- 并中断其中一个事务，另一个继续执行</span>
</code></pre>
<h3 data-id="heading-15">死锁预防技巧</h3>
<h3 data-id="heading-16">实际使用案例：多账户转账的死锁避免</h3>
<p>【场景】银行转账系统，支持用户之间互转，如用户A转用户B、用户B转用户A，若不控制锁顺序，易引发死锁。</p>
<p>【死锁复现】：如前文“转账引发的死锁”示例，因两个事务锁账户的顺序相反（A先锁A再锁B，B先锁B再锁A），导致死锁。</p>
<p>【解决方案】：统一锁顺序，即所有转账事务都按“账户号从小到大”的顺序锁定账户。</p>
<p>【优化后实操代码】：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 通用转账函数（统一按账户号升序锁）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> transfer(from_acct <span class="hljs-type">int</span>, to_acct <span class="hljs-type">int</span>, amount <span class="hljs-type">numeric</span>)
<span class="hljs-keyword">RETURNS</span> <span class="hljs-type">VARCHAR</span> <span class="hljs-keyword">AS</span> $$
<span class="hljs-keyword">DECLARE</span>
  min_acct <span class="hljs-type">int</span>;
  max_acct <span class="hljs-type">int</span>;
<span class="hljs-keyword">BEGIN</span>
  <span class="hljs-comment">-- 确定账户号大小，统一先锁小号账户</span>
  IF from_acct <span class="hljs-operator">&lt;</span> to_acct <span class="hljs-keyword">THEN</span>
    min_acct :<span class="hljs-operator">=</span> from_acct;
    max_acct :<span class="hljs-operator">=</span> to_acct;
  <span class="hljs-keyword">ELSE</span>
    min_acct :<span class="hljs-operator">=</span> to_acct;
    max_acct :<span class="hljs-operator">=</span> from_acct;
  <span class="hljs-keyword">END</span> IF;
  
  <span class="hljs-keyword">BEGIN</span>;
  <span class="hljs-comment">-- 按统一顺序锁定账户</span>
  <span class="hljs-keyword">SELECT</span> balance <span class="hljs-keyword">FROM</span> accounts <span class="hljs-keyword">WHERE</span> acctnum <span class="hljs-operator">=</span> min_acct <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
  <span class="hljs-keyword">SELECT</span> balance <span class="hljs-keyword">FROM</span> accounts <span class="hljs-keyword">WHERE</span> acctnum <span class="hljs-operator">=</span> max_acct <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
  
  <span class="hljs-comment">-- 检查转出账户余额</span>
  IF (<span class="hljs-keyword">SELECT</span> balance <span class="hljs-keyword">FROM</span> accounts <span class="hljs-keyword">WHERE</span> acctnum <span class="hljs-operator">=</span> from_acct) <span class="hljs-operator">&lt;</span> amount <span class="hljs-keyword">THEN</span>
    <span class="hljs-keyword">ROLLBACK</span>;
    <span class="hljs-keyword">RETURN</span> <span class="hljs-string">'余额不足'</span>;
  <span class="hljs-keyword">END</span> IF;
  
  <span class="hljs-comment">-- 执行转账</span>
  <span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> amount <span class="hljs-keyword">WHERE</span> acctnum <span class="hljs-operator">=</span> from_acct;
  <span class="hljs-keyword">UPDATE</span> accounts <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> amount <span class="hljs-keyword">WHERE</span> acctnum <span class="hljs-operator">=</span> to_acct;
  
  <span class="hljs-keyword">COMMIT</span>;
  <span class="hljs-keyword">RETURN</span> <span class="hljs-string">'转账成功'</span>;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;

<span class="hljs-comment">-- 调用示例（无论谁转谁，都按账户号升序锁）</span>
<span class="hljs-keyword">SELECT</span> transfer(<span class="hljs-number">11111</span>, <span class="hljs-number">22222</span>, <span class="hljs-number">100</span>); <span class="hljs-comment">-- 先锁11111，再锁22222</span>
<span class="hljs-keyword">SELECT</span> transfer(<span class="hljs-number">22222</span>, <span class="hljs-number">11111</span>, <span class="hljs-number">50</span>);  <span class="hljs-comment">-- 同样先锁11111，再锁22222</span>
</code></pre>
<p>【说明】：通过统一锁顺序，确保所有事务对多个账户的锁定顺序一致，从根本上避免了死锁的发生。</p>
<ol>
<li><strong>统一锁顺序</strong>：所有事务都按“账户号从小到大”更新，比如先更11111，再更22222；</li>
<li><strong>缩短锁持有时间</strong>：事务尽量快，别拿着锁等用户输入；</li>
<li><strong>重试机制</strong>：捕获死锁错误后，自动重试事务。</li>
</ol>
<h2 data-id="heading-17">5 咨询锁：自定义的“零食店规矩”</h2>
<p>咨询锁是PostgreSQL给开发者的“自定义锁”——系统不管你怎么用，全靠你自己守规矩。就像零食店老板和熟客约定：“看到桌上摆着红色杯子，就说明我在盘点，别进来”，杯子（咨询锁）的含义由你们自己定。</p>
<h3 data-id="heading-18">趣味场景：防止多人同时盘点库存</h3>
<p>零食店每天闭店要盘点，你怕多个员工同时盘点出错，就用咨询锁：</p>
<ul>
<li>员工A盘点前，先“占坑”：拿一个编号为100的咨询锁；</li>
<li>员工B再想盘点，发现100号锁被占，就等员工A盘完再开始；</li>
<li>盘点结束，员工A释放锁。</li>
</ul>
<h3 data-id="heading-19">实操示例：会话级vs事务级咨询锁</h3>
<h3 data-id="heading-20">实际使用案例：分布式任务调度的咨询锁控制</h3>
<p>【场景】分布式系统中，多个服务节点需共同执行一批定时任务（如订单超时关闭），需确保同一个任务同一时刻只被一个节点执行，避免重复处理。</p>
<p>【解决方案】：使用事务级咨询锁，每个任务对应一个唯一标识（如任务ID），服务节点执行任务前先获取该标识的咨询锁，获取成功则执行任务，失败则跳过（等待下一轮）。</p>
<p>【实操代码】：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 定时任务执行逻辑（每个节点定时调用）</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> execute_timeout_task()
<span class="hljs-keyword">RETURNS</span> VOID <span class="hljs-keyword">AS</span> $$
<span class="hljs-keyword">DECLARE</span>
  task RECORD;
  lock_acquired <span class="hljs-type">BOOLEAN</span>;
<span class="hljs-keyword">BEGIN</span>
  <span class="hljs-comment">-- 遍历未执行的超时订单任务</span>
  <span class="hljs-keyword">FOR</span> task <span class="hljs-keyword">IN</span> <span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> order_timeout_tasks <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'pending'</span> LOOP
    <span class="hljs-comment">-- 尝试获取事务级咨询锁（任务ID作为锁标识）</span>
    <span class="hljs-keyword">SELECT</span> pg_try_advisory_xact_lock(task.id) <span class="hljs-keyword">INTO</span> lock_acquired;
    
    IF lock_acquired <span class="hljs-keyword">THEN</span>
      <span class="hljs-comment">-- 获取锁成功，执行任务（关闭超时订单）</span>
      <span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'closed'</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> task.order_id;
      <span class="hljs-comment">-- 更新任务状态为已完成</span>
      <span class="hljs-keyword">UPDATE</span> order_timeout_tasks <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'completed'</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> task.id;
      RAISE NOTICE <span class="hljs-string">'任务 % 执行成功'</span>, task.id;
    <span class="hljs-keyword">ELSE</span>
      <span class="hljs-comment">-- 未获取到锁，说明其他节点正在执行</span>
      RAISE NOTICE <span class="hljs-string">'任务 % 已被其他节点执行，跳过'</span>, task.id;
    <span class="hljs-keyword">END</span> IF;
  <span class="hljs-keyword">END</span> LOOP;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;

<span class="hljs-comment">-- 服务节点定时调用（如每分钟一次）</span>
<span class="hljs-keyword">SELECT</span> execute_timeout_task();
</code></pre>
<p>【说明】：使用pg_try_advisory_xact_lock（非阻塞获取事务级咨询锁），避免节点间相互等待。事务结束后锁自动释放，无需手动解锁，确保任务执行的原子性和唯一性。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 会话级咨询锁（会话结束才释放，无视事务回滚）</span>
<span class="hljs-keyword">SELECT</span> pg_advisory_lock(<span class="hljs-number">100</span>); <span class="hljs-comment">-- 占100号锁</span>
<span class="hljs-comment">-- 此时其他会话调用pg_advisory_lock(100)会阻塞</span>
<span class="hljs-keyword">SELECT</span> pg_advisory_unlock(<span class="hljs-number">100</span>); <span class="hljs-comment">-- 释放锁</span>

<span class="hljs-comment">-- 2. 事务级咨询锁（事务结束自动释放）</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> pg_advisory_xact_lock(<span class="hljs-number">100</span>); <span class="hljs-comment">-- 事务级锁</span>
<span class="hljs-comment">-- 盘点操作：SELECT SUM(stock) FROM products;</span>
<span class="hljs-keyword">COMMIT</span>; <span class="hljs-comment">-- 提交后自动释放锁</span>

<span class="hljs-comment">-- 避坑：LIMIT和咨询锁一起用要小心</span>
<span class="hljs-comment">-- 错误写法：可能锁到非预期的行</span>
<span class="hljs-keyword">SELECT</span> pg_advisory_lock(id) <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> LIMIT <span class="hljs-number">10</span>;

<span class="hljs-comment">-- 正确写法：先筛选行，再锁</span>
<span class="hljs-keyword">SELECT</span> pg_advisory_lock(q.id) <span class="hljs-keyword">FROM</span> (
  <span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> LIMIT <span class="hljs-number">10</span>
) q;
</code></pre>
<h2 data-id="heading-21">6 总结</h2>
<ol>
<li><strong>表级锁</strong>：按“严格程度”分8种，核心是ACCESS SHARE（只读）和ACCESS EXCLUSIVE（独占）互斥，适合控制整张表的访问；</li>
<li><strong>行级锁</strong>：精准锁定单行，只阻塞修改，不阻塞读取，常用FOR UPDATE实现“悲观锁”；</li>
<li><strong>死锁</strong>：多事务互等锁导致，预防关键是“统一锁顺序+缩短锁持有时间”；</li>
<li><strong>咨询锁</strong>：自定义锁，分会话级（手动释放）和事务级（自动释放），适合MVCC不适用的场景。</li>
</ol>
<p>“读尽量不堵读，改尽量少堵读，独占锁堵一切，死锁靠顺序防，咨询锁自己定”。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Ajax 数据请求：从零开始掌握异步通信]]></title>    <link>https://juejin.cn/post/7571695634942165019</link>    <guid>https://juejin.cn/post/7571695634942165019</guid>    <pubDate>2025-11-12T14:19:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571695634942165019" data-draft-id="7571704212850851891" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Ajax 数据请求：从零开始掌握异步通信"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-12T14:19:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神秘的猪头"/> <meta itemprop="url" content="https://juejin.cn/user/793223472877051"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Ajax 数据请求：从零开始掌握异步通信
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/793223472877051/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神秘的猪头
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-12T14:19:18.000Z" title="Wed Nov 12 2025 14:19:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-12
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代 Web 开发中，<strong>Ajax（Asynchronous JavaScript and XML）</strong> 是实现页面局部刷新、提升用户体验的核心技术之一。虽然名字里包含 “XML”，但如今我们更多使用的是 <strong>JSON 格式</strong>的数据。本文将结合原理讲解与示例代码，带你深入理解并动手实践原生 Ajax 请求。</p>
<hr/>
<h2 data-id="heading-0">一、什么是 Ajax？</h2>
<p>Ajax 全称是 <strong>Asynchronous JavaScript and XML</strong>，即“异步的 JavaScript 和 XML”。它的核心思想是：</p>
<blockquote>
<p><strong>在不重新加载整个页面的情况下，通过 JavaScript 向服务器发送请求并处理响应，从而动态更新网页内容。</strong></p>
</blockquote>
<p>这种机制让 Web 应用更像桌面应用——流畅、快速、无刷新。</p>
<hr/>
<h2 data-id="heading-1">二、Ajax 的基本工作流程</h2>
<p>使用原生 JavaScript 发起 Ajax 请求，通常遵循以下五个步骤：</p>
<ol>
<li><strong>创建 XMLHttpRequest 对象</strong></li>
<li><strong>调用 <code>open()</code> 方法配置请求</strong></li>
<li><strong>设置回调函数监听状态变化（<code>onreadystatechange</code>）</strong></li>
<li><strong>调用 <code>send()</code> 发送请求</strong></li>
<li><strong>在回调中处理响应数据</strong></li>
</ol>
<h3 data-id="heading-2">关键概念解析</h3>
<h4 data-id="heading-3">1. <code>XMLHttpRequest</code> 对象</h4>
<p>这是浏览器内置的对象，用于发起 HTTP 请求。</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">xhr</span> = new XMLHttpRequest()<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-4">2. <code>open(method, url, async)</code></h4>
<ul>
<li><code>method</code>：HTTP 方法，如 <code>'GET'</code>、<code>'POST'</code></li>
<li><code>url</code>：请求的目标地址（API 接口）</li>
<li><code>async</code>：是否异步（<strong>强烈建议设为 <code>true</code></strong>）</li>
</ul>
<blockquote>
<p>⚠️ 注意：示例中使用了 <code>false</code>（同步），这会阻塞浏览器，<strong>实际开发中应避免</strong>！</p>
</blockquote>
<h4 data-id="heading-5">3. <code>send()</code></h4>
<p>真正发出请求。对于 GET 请求，通常传入 <code>null</code> 或空值。</p>
<h4 data-id="heading-6">4. <code>onreadystatechange</code> 事件</h4>
<p>每当请求状态发生变化时触发。我们需要在这个回调中判断请求是否成功完成。</p>
<h4 data-id="heading-7">5. 状态码与就绪状态</h4>

















<table><thead><tr><th>属性</th><th>含义</th></tr></thead><tbody><tr><td><code>xhr.status</code></td><td>HTTP 状态码，如 <code>200</code> 表示成功</td></tr><tr><td><code>xhr.readyState</code></td><td>请求的当前阶段（0~4）</td></tr></tbody></table>
<h5 data-id="heading-8"><code>readyState</code> 的五个阶段：</h5>



































<table><thead><tr><th>值</th><th>状态</th><th>说明</th></tr></thead><tbody><tr><td>0</td><td>UNSENT</td><td>已创建，未调用 <code>open()</code></td></tr><tr><td>1</td><td>OPENED</td><td>已调用 <code>open()</code></td></tr><tr><td>2</td><td>HEADERS_RECEIVED</td><td>已调用 <code>send()</code>，收到响应头</td></tr><tr><td>3</td><td>LOADING</td><td>正在接收响应体</td></tr><tr><td>4</td><td>DONE</td><td>请求完成，响应数据全部接收</td></tr></tbody></table>
<p>✅ <strong>只有当 <code>readyState === 4</code> 且 <code>status === 200</code> 时，才表示请求成功！</strong></p>
<hr/>
<h2 data-id="heading-9">三、实战示例：获取 GitHub 组织成员列表</h2>
<p>我们将通过一个真实 API（GitHub 的公开接口）来演示如何用 Ajax 获取数据并渲染到页面。</p>
<h3 data-id="heading-10">✅ 改进后的推荐写法（<strong>异步模式</strong>）</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Ajax 数据请求 - 异步版<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Lemoncode 组织成员<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"members"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();

        <span class="hljs-comment">// 配置请求：异步 GET</span>
        xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://api.github.com/orgs/lemoncode/members'</span>, <span class="hljs-literal">true</span>);

        <span class="hljs-comment">// 监听状态变化</span>
        xhr.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
            <span class="hljs-comment">// 只有 readyState 为 4 且状态码为 200 才处理</span>
            <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">readyState</span> === <span class="hljs-number">4</span>) {
                <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {
                    <span class="hljs-comment">// 成功：解析 JSON 并渲染</span>
                    <span class="hljs-keyword">const</span> members = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(xhr.<span class="hljs-property">responseText</span>);
                    <span class="hljs-keyword">const</span> listItems = members.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> <span class="hljs-string">`&lt;li&gt;<span class="hljs-subst">${user.login}</span>&lt;/li&gt;`</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
                    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'members'</span>).<span class="hljs-property">innerHTML</span> = listItems;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// 失败：显示错误信息</span>
                    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'members'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'&lt;li&gt;加载失败，请稍后重试。&lt;/li&gt;'</span>;
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败:'</span>, xhr.<span class="hljs-property">status</span>);
                }
            }
        };

        <span class="hljs-comment">// 发送请求</span>
        xhr.<span class="hljs-title function_">send</span>();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-11">🌟 关键改进点：</h3>
<ol>
<li><strong>使用 <code>async: true</code></strong> —— 不阻塞主线程，用户体验更好。</li>
<li><strong>错误处理</strong> —— 检查非 200 状态码，避免程序崩溃。</li>
<li><strong>结构清晰</strong> —— 先监听，再发送，逻辑更安全。</li>
</ol>
<hr/>
<h2 data-id="heading-12">四、为什么不要用同步请求（<code>async: false</code>）？</h2>
<p>在你提供的原始代码中：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">xhr.<span class="hljs-keyword">open</span>(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'...'</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// 同步！</span>
</code></pre>
<p>这会导致：</p>
<ul>
<li>浏览器界面<strong>完全冻结</strong>，直到请求完成；</li>
<li>用户无法滚动、点击或交互；</li>
<li>现代浏览器已<strong>不推荐甚至警告</strong>使用同步 XHR。</li>
</ul>
<p>✅ <strong>永远使用异步请求！</strong></p>
<hr/>
<h2 data-id="heading-13">五、现代替代方案：<code>fetch</code> API</h2>
<p>虽然原生 Ajax 是基础，但现代开发更常用 <code>fetch</code>，它基于 Promise，语法更简洁：</p>
<pre><code class="hljs language-ini" lang="ini">fetch('https://api.github.com/orgs/lemoncode/members')
  .then(<span class="hljs-attr">response</span> =&gt; response.json())
  .then(<span class="hljs-attr">members</span> =&gt; {
    document.getElementById('members').<span class="hljs-attr">innerHTML</span> = 
      members.map(<span class="hljs-attr">user</span> =&gt; `&lt;li&gt;<span class="hljs-variable">${user.login}</span>&lt;/li&gt;`).join(<span class="hljs-string">''</span>)<span class="hljs-comment">;</span>
  })
  .catch(<span class="hljs-attr">error</span> =&gt; {
    console.error('请求出错:', error)<span class="hljs-comment">;</span>
  })<span class="hljs-comment">;</span>
</code></pre>
<p>不过，理解 <code>XMLHttpRequest</code> 仍是掌握网络请求本质的关键！</p>
<hr/>
<h2 data-id="heading-14">六、总结</h2>

































<table><thead><tr><th>要点</th><th>说明</th></tr></thead><tbody><tr><td>✅ 核心对象</td><td><code>XMLHttpRequest</code></td></tr><tr><td>✅ 必须监听</td><td><code>onreadystatechange</code></td></tr><tr><td>✅ 判断条件</td><td><code>readyState === 4 &amp;&amp; status === 200</code></td></tr><tr><td>✅ 数据格式</td><td>通常为 JSON，需 <code>JSON.parse()</code></td></tr><tr><td>❌ 避免使用</td><td>同步请求（<code>async: false</code>）</td></tr><tr><td>🔮 进阶方向</td><td>学习 <code>fetch</code>、<code>axios</code> 等现代工具</td></tr></tbody></table>
<hr/>
<p>通过本文的学习，你应该已经掌握了 Ajax 的基本原理和实现方式。下一步可以尝试：</p>
<ul>
<li>发送 POST 请求提交表单；</li>
<li>添加加载动画（<code>readyState === 3</code> 时显示“加载中”）；</li>
<li>封装一个通用的 Ajax 函数。</li>
</ul>
<p>记住：<strong>异步是 Web 的灵魂，而 Ajax 是通往动态交互的第一步！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[华为 DevKit 25.2.rc1 源码迁移分析使用教程（openEuler + ARM64）]]></title>    <link>https://juejin.cn/post/7593098101431910454</link>    <guid>https://juejin.cn/post/7593098101431910454</guid>    <pubDate>2026-01-09T09:11:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593098101431910454" data-draft-id="7592990758476152851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="华为 DevKit 25.2.rc1 源码迁移分析使用教程（openEuler + ARM64）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T09:11:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="秋说"/> <meta itemprop="url" content="https://juejin.cn/user/442448008454568"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            华为 DevKit 25.2.rc1 源码迁移分析使用教程（openEuler + ARM64）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/442448008454568/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    秋说
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T09:11:52.000Z" title="Fri Jan 09 2026 09:11:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>华为 DevKit 是一款用于 x86 → 鲲鹏（ARM64）平台代码迁移分析  的工具。从 v25.0 起，DevKit 采用   模块化 RPM 包设计 ，需安装多个组件才能使用源码迁移功能。本次实验我带大家实操一下码迁移分析使用，实验有以下几点需要注意。</p>
<p>⚠️   注意 ：</p>
<ul>
<li>25.2.rc1 为 Release Candidate 版本 ，存在权限和参数接口变更问题。</li>
<li>正式版（如 25.1.0）体验更佳，建议实验完成后升级。</li>
<li>本次实验是在华为云开发者空间上进行的，点击进入<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huaweicloud.com%2Fspace%2Fdevportal%2Fplatform%2FdevEnvironment%3Ftab%3Dcloud_desktop%26ticket%3DST-8160487-KjIyCRlHrKoolUkIbqrfPb59-sso%26locale%3Dzh-cn" target="_blank" title="https://developer.huaweicloud.com/space/devportal/platform/devEnvironment?tab=cloud_desktop&amp;ticket=ST-8160487-KjIyCRlHrKoolUkIbqrfPb59-sso&amp;locale=zh-cn" ref="nofollow noopener noreferrer">developer.huaweicloud.com/space/devpo…</a></li>
</ul>
<hr/>
<h2 data-id="heading-1">二、准备工作</h2>
<h3 data-id="heading-2">1. 下载所需 RPM 包</h3>
<p>确保已下载以下三个包（架构：<code>aarch64</code>）：</p>
<pre><code class="hljs language-bash" lang="bash">devkit-25.2.rcll-1.aarch64.rpm
devkit-porting-25.2.rc1-1.aarch64.rpm     <span class="hljs-comment"># 必须！提供迁移分析能力</span>
devkit-sys-mig-25.2.rc1-1.aarch64.rpm     <span class="hljs-comment"># 可选（本次实验不需要）</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e54f10977114e1fa1ffff23f4c8309c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL6K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554712&amp;x-signature=muxyIhN5zvFzfiloi%2B%2FBRHqnajc%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>💡 若未下载，请从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.hikunpeng.com%2Fzh%2Fdeveloper%2Fdevkit%2Fdownload%3Ftab%3DcommandLine" target="_blank" title="https://www.hikunpeng.com/zh/developer/devkit/download?tab=commandLine" ref="nofollow noopener noreferrer">华为鲲鹏社区</a> 获取。</p>
</blockquote>
<h3 data-id="heading-3">2. 准备待分析项目</h3>
<p>以开源项目 <code>simdjson</code> 为例：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ~
git <span class="hljs-built_in">clone</span> https://github.com/simdjson/simdjson.git
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/029dba0f48de4266a0c1719706557931~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL6K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554712&amp;x-signature=F8tmF4b5lT068WFkZXnn6JSYH2c%3D" alt="image.png" loading="lazy"/></p>
<p>项目路径：<code>/home/developer/simdjson</code></p>
<hr/>
<h2 data-id="heading-4">三、安装 DevKit</h2>
<h3 data-id="heading-5">1. 卸载旧版本（如有）</h3>
<pre><code class="hljs language-javascript" lang="javascript">sudo rpm -e devkit devkit-porting devkit-sys-mig <span class="hljs-number">2</span>&gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span> || <span class="hljs-literal">true</span>
</code></pre>
<h3 data-id="heading-6">2. 按依赖顺序安装 RPM 包</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入 RPM 所在目录（假设在 ~/Downloads）</span>
<span class="hljs-built_in">cd</span> ~/Downloads

<span class="hljs-comment"># 安装主框架</span>
sudo rpm -ivh devkit-25.2.rc1-1.aarch64.rpm

<span class="hljs-comment"># 安装源码迁移模块（关键！）</span>
sudo rpm -ivh devkit-porting-25.2.rc1-1.aarch64.rpm

<span class="hljs-comment"># （可选）安装系统迁移模块</span>
<span class="hljs-comment"># sudo rpm -ivh devkit-sys-mig-25.2.rc1-1.aarch64.rpm</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/676c849d890e49ebb7a4177c1f450755~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL6K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554712&amp;x-signature=Yeym1n6fi7Xoq6A4FSfBwjBfzVE%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>✅ 验证安装：
<code>/usr/local/devkit/devkit --version</code></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d961c76991b64b51978231ed9b79365d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL6K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554712&amp;x-signature=q4Seuw2A79Rsg6HYnyVUsjf%2Fk84%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-7">四、运行源码迁移分析</h2>
<h3 data-id="heading-8">1. 创建输出目录</h3>
<pre><code class="hljs language-arduino" lang="arduino">mkdir -p /home/developer/migration_report
</code></pre>
<h3 data-id="heading-9">2. 执行分析命令（关键：使用新参数格式）</h3>
<blockquote>
<p>⚠️   DevKit 25.2.rc1 参数变更 ：
<code>--project-path</code> → <code>--input</code> 或 <code>-i</code>
<code>--output-path</code> → <code>--output</code> 或 <code>-o</code>
<code>--language</code> → <code>--source-type</code></p>
</blockquote>
<pre><code class="hljs language-css" lang="css">sudo devkit porting <span class="hljs-attribute">src</span>-mig \
  <span class="hljs-attr">--input</span> /home/developer/simdjson \
  <span class="hljs-attr">--output</span> /home/developer/migration_report \
  <span class="hljs-attr">--source-type</span> c,c++
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a1e7208d3b94f96a60bba6cac095ca8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL6K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554712&amp;x-signature=I52Pm%2BXjZqYTGC%2BdUMYMuoBY97Y%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>🔍   为什么用  <code> sudo</code>  ？
RC 版本硬编码日志路径为 <code>/usr/local/devkit/...</code>，普通用户无写权限。
正式版默认使用 <code>$HOME/.kunpeng-devkit</code>，无需 <code>sudo</code>。</p>
</blockquote>
<h3 data-id="heading-10">3. 等待分析完成</h3>
<p>典型输出：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Using the local system as target os:</span> <span class="hljs-string">openeuler22.03</span>
<span class="hljs-attr">Current progress:</span> [<span class="hljs-number">100</span><span class="hljs-string">%</span>] [<span class="hljs-string">Phase</span> <span class="hljs-number">3</span><span class="hljs-string">/3</span>] <span class="hljs-string">Scan</span> <span class="hljs-string">completed.</span> <span class="hljs-string">Generating</span> <span class="hljs-string">reports.</span>
<span class="hljs-string">...</span>
<span class="hljs-attr">Files to be modified:</span> <span class="hljs-number">30</span>
<span class="hljs-attr">Lines to be modified:</span> <span class="hljs-number">204</span>
<span class="hljs-attr">Estimated transplant workload:</span> <span class="hljs-number">0.5</span> <span class="hljs-string">person/months.</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17f1344bb887493299a552cbd177619a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL6K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554712&amp;x-signature=%2FCC%2FfAVmJQ8BMQ5UwZoYWO9ZR7I%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-11">五、查看分析报告</h2>
<h3 data-id="heading-12">1. 报告文件列表</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> ~/migration_report/
</code></pre>
<p>生成三个文件：</p>
<ul>
<li><code>Code_Porting_ .html</code> ←   主报告（推荐）</li>
<li><code>Code_Porting_ .csv</code>  ← 表格数据</li>
<li><code>Code_Porting_ .json</code> ← 原始数据</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/028d22157ab84539a0d5778240ed8ea5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56eL6K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554712&amp;x-signature=WyiXT7cfcgz0x1yKzD9pl9qeAkQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-13">3. 报告内容解读</h3>

























<table><thead><tr><th>类别</th><th>说明</th></tr></thead><tbody><tr><td>架构相关指令</td><td>x86 汇编（如 <code>_mm_load_si128</code>）、SSE/AVX 内建函数</td></tr><tr><td>编译器差异</td><td>GCC/Clang 特有扩展在 ARM64 上的兼容性</td></tr><tr><td>字节序与对齐</td><td>大端/小端、内存对齐问题</td></tr><tr><td>依赖库兼容性</td><td>第三方库是否支持 ARM64</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-14">六、常见问题与解决方案</h2>



































<table><thead><tr><th>问题</th><th>原因</th><th>解决方案</th></tr></thead><tbody><tr><td><code>error: init execute pwd failed</code></td><td>未安装 <code>devkit-porting</code></td><td>安装 <code>devkit-porting- .rpm</code></td></tr><tr><td><code>Permission denied: common.log.lock</code></td><td>RC 版硬编码系统路径</td><td>使用  <code> sudo</code>   运行</td></tr><tr><td><code>The task name is incorrect</code></td><td>未指定子任务</td><td>使用 <code>devkit porting src-mig ...</code></td></tr><tr><td><code>required: -i/--input</code></td><td>参数格式变更</td><td>将 <code>--project-path</code> 改为 <code>--input</code></td></tr><tr><td>SELinux 阻止写入</td><td>安全策略限制</td><td>临时执行 <code>sudo setenforce 0</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-15">七、后续建议</h2>
<h3 data-id="heading-16">1. 升级到正式版</h3>
<p>卸载 RC 版：</p>
<pre><code class="hljs">sudo rpm -e devkit devkit-porting devkit-sys-mig
</code></pre>
<p>下载并安装   DevKit 25.1.0 正式版 ，享受：</p>
<ul>
<li>无需 <code>sudo</code></li>
<li>自动使用 <code>$HOME/.kunpeng-devkit</code></li>
<li>更稳定的 CLI 接口</li>
</ul>
<h3 data-id="heading-17">2. 修改代码并验证</h3>
<p>根据报告提示：</p>
<ul>
<li>替换 x86 内建函数为 ARM NEON 等价实现</li>
<li>添加跨平台宏（如 <code>#ifdef __aarch64__</code>）</li>
<li>在鲲鹏服务器上编译测试</li>
</ul>
<hr/>
<h2 data-id="heading-18">八、附录：完整命令速查</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装</span>
sudo rpm -ivh devkit- .rpm devkit-porting- .rpm

<span class="hljs-comment"># 分析（RC 版必须用 sudo + 新参数）</span>
sudo devkit porting src-mig \
  --input /path/to/source \
  --output /path/to/report \
  --source-type c,c++

<span class="hljs-comment"># 归还权限</span>
sudo <span class="hljs-built_in">chown</span> -R <span class="hljs-variable">$USER</span>:<span class="hljs-variable">$USER</span> /path/to/report

<span class="hljs-comment"># 查看帮助</span>
devkit porting src-mig --<span class="hljs-built_in">help</span>
</code></pre>
<hr/>
<h2 data-id="heading-19">总结</h2>
<p>作为一个开发者，在 openEuler ARM64 环境下使用 DevKit 25.2.rc1 进行源码迁移分析时，需特别注意其 RC 版本的限制：必须安装 <code>devkit-porting</code> 模块，且因日志路径硬编码于系统目录，普通用户无写权限，  需用  <code> sudo</code>   执行 。同时，CLI 参数已变更——<code>--project-path</code> 改为 <code>--input</code>，<code>--language</code> 改为 <code>--source-type</code>。虽然流程略显繁琐，但工具能精准识别 x86 专属指令（如 SSE/AVX）、内存对齐等问题，并生成 HTML 报告，极大提升 ARM64 移植效率。建议实验后升级至正式版以获得更友好的开发体验。</p>
<p>鲲鹏社区直达<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.hikunpeng.com%2Fdeveloper%3Futm_campaign%3Dcom%26utm_source%3Dcsdnkol" target="_blank" title="https://www.hikunpeng.com/developer?utm_campaign=com&amp;utm_source=csdnkol" ref="nofollow noopener noreferrer">www.hikunpeng.com/developer?u…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 成为 2025 年的编程语言，7个C#技巧助力开发效率]]></title>    <link>https://juejin.cn/post/7593165280488030249</link>    <guid>https://juejin.cn/post/7593165280488030249</guid>    <pubDate>2026-01-09T09:02:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593165280488030249" data-draft-id="7592990758476120083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 成为 2025 年的编程语言，7个C#技巧助力开发效率"/> <meta itemprop="keywords" content="后端,.NET,C#"/> <meta itemprop="datePublished" content="2026-01-09T09:02:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ServBay"/> <meta itemprop="url" content="https://juejin.cn/user/3828929445244761"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 成为 2025 年的编程语言，7个C#技巧助力开发效率
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3828929445244761/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ServBay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T09:02:45.000Z" title="Fri Jan 09 2026 09:02:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>TIOBE 公布的数据显示，C# 以 2.94% 的年度最大涨幅再度获评2025 年度编程语言，这是 C# 在三年内第二次获此殊荣，凭借的是其在榜单上最大的年度增长幅度。</p>
<p>其实，C# 早就不是当年那个贴着“Windows 独占”和“闭源”标签的语言了。从早期的模仿者到如今现代语言特性的引领者，C# 成功完成了向跨平台和开源的巨大转型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ef1361c669747aeb3a12d40b53095bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554966&amp;x-signature=NirDk39sroy1mRZ%2BV7aU6xqCYCE%3D" alt="" loading="lazy"/></p>
<p>在企业级开发领域，C# 与 Java 的竞争持续了二十多年。相比于 Java 略显冗长和样板化的代码风格，C# 在语法设计的灵活性和演进速度上一直保持着敏锐的嗅觉。对于开发者而言，C# 版本的快速迭代意味着手里有了更多高效的工具。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bc78edb15a1407392fe3093eeeda6f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554966&amp;x-signature=O7rh2mx5NGeg1dPGitT67tnGdPc%3D" alt="" loading="lazy"/></p>
<p>以下盘点7个在实际开发中非常实用的C#代码技巧，涵盖并发处理、内存优化及新语法特性。</p>
<h3 data-id="heading-0">多线程场景下的字典安全策略</h3>
<p>在多线程环境操作字典时，手动加锁（lock）往往容易出错且效率不高。不要重复造轮子，<code>ConcurrentDictionary&lt;TKey, TValue&gt;</code> 是专为并发读写设计的结构，内部实现了细粒度的锁机制和原子操作。</p>
<p><strong>低效：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">var</span> cache = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">int</span>&gt;();
<span class="hljs-comment">// 多线程并发写入时，普通字典非线程安全，可能导致异常或数据覆盖</span>
<span class="hljs-keyword">await</span> Task.WhenAll(dataItems.Select(<span class="hljs-keyword">async</span> item =&gt;
{
    <span class="hljs-comment">// 即使加锁，性能也会受影响</span>
    cache[item.Key] = <span class="hljs-keyword">await</span> ProcessItemAsync(item);
}));
</code></pre>
<p><strong>推荐：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">var</span> cache = <span class="hljs-keyword">new</span> ConcurrentDictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">int</span>&gt;();
<span class="hljs-comment">// 内部已处理并发控制，读写更高效</span>
<span class="hljs-keyword">await</span> Task.WhenAll(dataItems.Select(<span class="hljs-keyword">async</span> item =&gt;
{
    cache[item.Key] = <span class="hljs-keyword">await</span> ProcessItemAsync(item);
}));
</code></pre>
<h3 data-id="heading-1">避免频繁分配空集合</h3>
<p>在返回空数组或列表时，习惯性地 <code>new</code> 一个对象会造成不必要的内存分配。特别是在高频调用的循环或 LINQ 查询中，这会显著增加垃圾回收（GC）的压力。<code>.NET</code> 为此提供了缓存的单例空对象。</p>
<p><strong>低效：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">string</span>[<span class="hljs-number">0</span>]; <span class="hljs-comment">// 每次都在堆上分配新对象</span>
</code></pre>
<p><strong>推荐：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">return</span> Array.Empty&lt;<span class="hljs-built_in">string</span>&gt;(); <span class="hljs-comment">// 使用全局缓存的空实例</span>
</code></pre>
<p>同理，在 LINQ 场景下应使用 <code>Enumerable.Empty&lt;T&gt;()</code>。</p>
<h3 data-id="heading-2">善用空合并赋值运算符 (??=)</h3>
<p><code>??=</code> 运算符能让空检查和初始化逻辑变得极其简洁。它不仅减少了样板代码，还消除了不必要的嵌套，非常适合用于属性的延迟加载（Lazy Initialization）。</p>
<p><strong>低效：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">if</span> (userSettings == <span class="hljs-literal">null</span>)
{
    userSettings = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();
}
</code></pre>
<p><strong>推荐：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-comment">// 仅当 userSettings 为 null 时才进行赋值</span>
userSettings ??= <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;();
</code></pre>
<h3 data-id="heading-3">优化日志记录中的字符串开销</h3>
<p>C# 10 引入了针对插值字符串的底层优化。在记录日志时，如果直接使用 <code>$</code> 进行拼接，即便日志级别未开启，字符串拼接的开销依然存在。使用结构化日志参数写法，可以在日志级别关闭时完全跳过插值计算。</p>
<p><strong>有隐形开销：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-comment">// 即使 LogLevel 关闭，字符串插值依然会执行，消耗 CPU</span>
_logger.LogInformation(<span class="hljs-string">$"Order <span class="hljs-subst">{orderId}</span> processed at <span class="hljs-subst">{DateTime.Now}</span>"</span>);
</code></pre>
<p><strong>推荐：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-comment">// 模板化参数，只有日志确实需要记录时，才会处理参数</span>
_logger.LogInformation(<span class="hljs-string">"Order {OrderId} processed at {ProcessTime}"</span>, orderId, DateTime.Now);
</code></pre>
<h3 data-id="heading-4">并行任务优先使用 Task.WhenAll</h3>
<p>在异步方法中，如果多个任务之间没有依赖关系，顺次 <code>await</code> 会导致它们串行执行，浪费了并发优势。应当同时启动所有任务，并等待它们全部完成。</p>
<p><strong>低效：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">await</span> UploadLogsAsync();
<span class="hljs-keyword">await</span> UpdateDatabaseAsync();
<span class="hljs-keyword">await</span> NotifyUserAsync();
</code></pre>
<p><strong>高效：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">await</span> Task.WhenAll(
    UploadLogsAsync(),
    UpdateDatabaseAsync(),
    NotifyUserAsync()
);
</code></pre>
<p><em>注：使用</em> <em><code>Task.WhenAll</code></em> 时，若发生异常，抛出的是 <code>AggregateException</code> <em>，需注意捕获处理。</em></p>
<h3 data-id="heading-5">预设字典容量以避免重哈希</h3>
<p><code>Dictionary</code> 在元素数量超出当前容量时，会触发扩容（Resize）和重哈希（Rehash），这是非常昂贵的操作。如果能预估数据量级，在构造时指定容量可以大幅减少内存分配开销。</p>
<p><strong>低效：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">var</span> map = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">string</span>&gt;(); <span class="hljs-comment">// 默认容量小，数据多时会多次扩容</span>
</code></pre>
<p><strong>高效：</strong></p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">var</span> map = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">int</span>, <span class="hljs-built_in">string</span>&gt;(expectedCount); <span class="hljs-comment">// 一次分配到位</span>
</code></pre>
<h3 data-id="heading-6">原始字符串字面量与插值</h3>
<p>C# 11 引入了三重引号 <code>"""</code>，完美解决了 JSON、SQL 或 HTML 字符串中引号转义的痛点。结合 <code>$$</code> 语法，还可以自定义插值符号，避免与内容中的 <code>{}</code> 冲突。</p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">var</span> userName = <span class="hljs-string">"Alice"</span>;
<span class="hljs-keyword">var</span> userAge = <span class="hljs-number">28</span>;

<span class="hljs-comment">// 使用 $$ 前缀，表示 {{}} 才是插值，单个 {} 被视为普通字符</span>
<span class="hljs-keyword">var</span> jsonContent = $<span class="hljs-string">$""</span><span class="hljs-string">"
{
    "</span>user<span class="hljs-string">": "</span>{{userName}}<span class="hljs-string">",
    "</span>age<span class="hljs-string">": {{userAge}},
    "</span>role<span class="hljs-string">": "</span>admin<span class="hljs-string">"
}
"</span><span class="hljs-string">""</span>;
</code></pre>
<p>这种写法让代码清晰度大幅提升，再也不用数反斜杠了。</p>
<h3 data-id="heading-7">快速搞定.NET环境</h3>
<p>上述技巧跨越了多个 C# 版本，从基础的 .NET Framework 到最新的 .NET Core 及 .NET 5+。在实际工作中，维护旧项目（如 .NET 2.0）和探索新特性（如 .NET 10.0）往往需要同时进行。</p>
<p>在本地配置.NET环境时，多个运行版本还是挺麻烦的，涉及大量的环境变量切换。使用 ServBay 就能<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fnet" target="_blank" title="https://www.servbay.com/features/net" ref="nofollow noopener noreferrer">一键安装 .NET 环境</a>，支持范围极广，从 .NET 2.0 一直到 .NET 10.0，甚至包含了 Mono 6。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54cb1c5922604fe18b4202bf6f7182c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768554966&amp;x-signature=fXQIzGvaxdC6l39Q%2BuzjuIAmMHY%3D" alt="" loading="lazy"/></p>
<p>ServBay 支持多个.NET版本同时并存，完全不需要开发者手动处理环境变量冲突。无论你是需要维护十年前的老系统，还是测试最新的 C# 语法特性，都能在同一台机器上无缝切换，将精力真正集中在代码编写上。</p>
<h3 data-id="heading-8">结语</h3>
<p>代码的整洁与高效往往体现在细节之中。掌握这些 C# 技巧，不仅能减少运行时的资源消耗，更能让代码逻辑清晰易读。随着 .NET 生态的不断发展，保持对新特性的关注，并结合得力的工具来管理开发环境，是每一位开发者持续进阶的关键。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ABP9.3.0+React 19.2.0基础创建]]></title>    <link>https://juejin.cn/post/7593158683411152896</link>    <guid>https://juejin.cn/post/7593158683411152896</guid>    <pubDate>2026-01-09T09:15:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593158683411152896" data-draft-id="7592960378690879523" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ABP9.3.0+React 19.2.0基础创建"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2026-01-09T09:15:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="七八星天"/> <meta itemprop="url" content="https://juejin.cn/user/3848733848768205"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ABP9.3.0+React 19.2.0基础创建
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3848733848768205/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    七八星天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T09:15:03.000Z" title="Fri Jan 09 2026 09:15:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前/后端技术栈</h2>
<p>服务端:</p>
<pre><code class="hljs language-makefile" lang="makefile">ABP Framework v9.3.0
	
<span class="hljs-section">ORM:</span>
	EFCore   v9.3.0
        -SqlServer V2022
      

<span class="hljs-section">环境:</span>
	.NET SDK 9.0
	
<span class="hljs-section">工具:</span>
	.ABP CLI 9.3.0
</code></pre>
<p>客户端:</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Web:</span>
	React + Vite + TypeScript
	-UI:
		Antd
	

<span class="hljs-section">环境:</span>
	Node v20.19.6
	pnpm v10.23.0
	Android SDK
        Vite 和 React 对环境要求较宽松：支持 Node.js 较新版本（&gt;=14/16/18），通常无需严格固定版本即可运行。
<span class="hljs-section">工具:	</span>
	vite 	v7.2.4
	nvm 	v1.2.2
	vite-cli:通过npm命令,不需要全局安装
</code></pre>
<h2 data-id="heading-1">1.创建</h2>
<p>创建相应的框架项目文件</p>
<h3 data-id="heading-2">后端ABP</h3>
<pre><code class="hljs language-ruby" lang="ruby">/<span class="hljs-regexp">/ABP官网
https:/</span><span class="hljs-regexp">/abp.io/docs</span><span class="hljs-regexp">/latest/get</span>-started/layered-web-application  
</code></pre>
<h4 data-id="heading-3">🌈使用ABP_CLI创建</h4>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-comment">//手脚架说明</span>
https:<span class="hljs-comment">//abp.io/docs/latest/cli </span>
<span class="hljs-comment">//手脚架快速命令构建页面</span>
https:<span class="hljs-comment">//abp.io/get-started</span>
确认当前 CLI 安装的版本:abp --version

<span class="hljs-comment">//模板选择指南</span>
https:<span class="hljs-comment">//abp.io/docs/9.3/solution-templates/guide</span>


<span class="hljs-comment">//指定文件夹，CMD</span>
输入命令：   
abp <span class="hljs-keyword">new</span> AppCoreServer -t app  -u none -d ef -v <span class="hljs-number">9.3</span><span class="hljs-number">.0</span>
<span class="hljs-comment">//生成完后即可看到/AppCoreServer/aspnet-core文件夹</span>
</code></pre>
<h4 data-id="heading-4">项目结构</h4>
<pre><code class="hljs language-bash" lang="bash">aspnet-core/                	 		<span class="hljs-comment"># 解决方案。</span>
   ├── src/                   		 	<span class="hljs-comment"># 后端主服务代码目录。</span>
   │   ├── Application/        		 	<span class="hljs-comment"># 应用服务层，处理业务逻辑。</span>
   │   ├── Application.Contracts/       <span class="hljs-comment"># 应用服务层接口定义层。</span>
   │   ├── DbMigrator/             		<span class="hljs-comment"># 迁移层，用于配置，定义迁移数据库。</span>
   │   ├── Domain/             			<span class="hljs-comment"># 领域层，包含领域模型和业务规则。</span>
   │   ├── Domain.Shared/             	<span class="hljs-comment"># 存放通用类和定义。</span>
   │   ├── EntityFrameworkCore/ 		<span class="hljs-comment"># 数据访问层，使用 EF Core 实现数据库操作。</span>
   │   ├── HttpApi/            			<span class="hljs-comment"># HTTP API 层，定义 API 接口,暴露 REST API。</span>
   │   ├── HttpApi.Client/     			<span class="hljs-comment"># 生成 C# SDK，用于其它程序直接消费API-(可以让另一个c#项目引用该层</span>
   │   │									,然后调用Application一样调用,而不是写httlclient调用,适用于微服务,分布式)
   │   └── HttpApi.Host/       			<span class="hljs-comment"># 项目根模块，配置和运行后端服务,Program就在这里。</span>
   │
   └── <span class="hljs-built_in">test</span>/                   			<span class="hljs-comment"># 测试单元。</span>
   │   ├── Application.Tests/  			<span class="hljs-comment"># 应用服务层的测试。</span>
   │   ├── Domain.Tests/       			<span class="hljs-comment"># 领域层的测试。</span>
   │   └── IntegrationTests/   			<span class="hljs-comment"># 集成测试。</span>
   │
   └──AppCoreServer.sln					<span class="hljs-comment">#解决方案文件,包含项目路径、依赖顺序,.net10开始变成slnx</span>
   |
   └──.gitignore						<span class="hljs-comment">#定义 Git 不需要追踪的文件和目录。</span>
</code></pre>
<h4 data-id="heading-5">附录</h4>
<h5 data-id="heading-6">🧱 ABP 项目类型总览对比表</h5>























































<table><thead><tr><th>类型</th><th>名称</th><th>特点</th><th>适用场景</th><th>是否分层</th><th>是否前后端分离</th><th>是否支持模块化</th><th>是否为微服务</th></tr></thead><tbody><tr><td>1️⃣</td><td><strong>单层 Web 应用</strong> (Single Layer Web App)</td><td>所有代码在一个项目中</td><td>快速开发、小项目、原型</td><td>❌</td><td>❌（默认集成 UI）</td><td>❌</td><td>❌</td></tr><tr><td>2️⃣</td><td><strong>分层 Web 应用</strong> (Layered Web App)</td><td>领域、应用、接口、EFCore 层分离</td><td>中大型项目，清晰架构</td><td>✅</td><td>❌（默认集成 UI）</td><td>✅</td><td>❌</td></tr><tr><td>3️⃣</td><td><strong>模块项目</strong> (Module Project)</td><td>可复用、可移植、可发布为 NuGet 模块</td><td>公共服务模块、组件库</td><td>✅</td><td>❌</td><td>✅（专为模块开发）</td><td>❌</td></tr><tr><td>4️⃣</td><td><strong>微服务解决方案</strong> (Microservice Solution)</td><td>多服务、多数据库、前后端分离</td><td>大型系统、分布式部署</td><td>✅</td><td>✅（UI 独立）</td><td>✅</td><td>✅</td></tr></tbody></table>
<h3 data-id="heading-7">前端React</h3>
<pre><code class="hljs language-ruby" lang="ruby">前端<span class="hljs-title class_">React</span>+<span class="hljs-title class_">Vite</span>手脚架

/<span class="hljs-regexp">/React官网
https:/</span><span class="hljs-regexp">/zh-hans.react.dev/learn</span><span class="hljs-regexp">/creating-a-react-app

/</span><span class="hljs-regexp">/Vite官网
https:/</span><span class="hljs-regexp">/vitejs.cn/vite</span>5-cn/
</code></pre>
<h4 data-id="heading-8">🌈使用Vite创建</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//使用Vite手脚架创建React+TypeScript项目</span>


<span class="hljs-attr">cmd</span>:

<span class="hljs-attr">D</span>:\<span class="hljs-title class_">AppWmcsServer</span>&gt;npm create vite@latest
&gt; npx
&gt; create-vite

|
o  <span class="hljs-title class_">Project</span> <span class="hljs-attr">name</span>:						<span class="hljs-comment">//项目名</span>
|  react-web
|
o  <span class="hljs-title class_">Select</span> a <span class="hljs-attr">framework</span>:   				<span class="hljs-comment">//框架</span>
|  <span class="hljs-title class_">React</span>
|
o  <span class="hljs-title class_">Select</span> a <span class="hljs-attr">variant</span>:   					<span class="hljs-comment">//选择一种版本</span>
|  <span class="hljs-title class_">TypeScript</span> + <span class="hljs-variable constant_">SWC</span>
|
o  <span class="hljs-title class_">Use</span> rolldown-vite (<span class="hljs-title class_">Experimental</span>)?:  	<span class="hljs-comment">//是否使用实验性功能,否</span>
|  <span class="hljs-title class_">No</span>
|
o  <span class="hljs-title class_">Install</span> <span class="hljs-keyword">with</span> npm and start now?   	<span class="hljs-comment">//是否安装依赖,否</span>
|  <span class="hljs-title class_">No</span>
|
o  <span class="hljs-title class_">Scaffolding</span> project <span class="hljs-keyword">in</span> <span class="hljs-attr">D</span>:\<span class="hljs-title class_">AppWmcsServer</span>\react-web...
|
—  <span class="hljs-title class_">Done</span>. <span class="hljs-title class_">Now</span> <span class="hljs-attr">run</span>:

  cd react-web
  npm install
  npm run dev
<span class="hljs-attr">D</span>:\0App\<span class="hljs-title class_">ResourceCenter</span>\2App\<span class="hljs-title class_">AppWmcsServer</span>&gt;


<span class="hljs-comment">//TypeScript + SWC:</span>
<span class="hljs-comment">//使用 TypeScript 语言编写项目代码</span>
<span class="hljs-comment">//使用 SWC 作为构建时的编译器（替代 Babel 或 TSC）将.ts、.tsx 文件会被 SWC 编译为 JavaScript，速度比用 Babel 快很多</span>
</code></pre>
<h4 data-id="heading-9">项目结构</h4>
<pre><code class="hljs language-csharp" lang="csharp">react-web/
├── node_modules/       <span class="hljs-meta"># 存放项目的依赖包，由 npm 或 yarn 自动生成，不需要手动修改。</span>
├── <span class="hljs-keyword">public</span>/             <span class="hljs-meta"># 存放公共资源文件，直接复制到最终构建的输出中。</span>
│   └── favicon.ico     <span class="hljs-meta"># 项目的图标文件，通常显示在浏览器标签页中。</span>
├── index.html      	<span class="hljs-meta"># 项目的入口 HTML 文件。Vite 以此文件为基础生成最终的页面。</span>
├── src/                <span class="hljs-meta"># 源代码目录，存放主要的开发文件。</span>
│   ├── assets/         <span class="hljs-meta"># 存放静态资源文件，如图片、字体等。</span>
│   ├── components/     <span class="hljs-meta"># 存放可复用的 React 组件，每个组件可以独立开发和测试。</span>
│   ├── pages/          <span class="hljs-meta"># 存放页面级组件，每个页面代表一个路由或完整功能模块。</span>
│   ├── App.tsx         <span class="hljs-meta"># 主应用组件，通常包含路由和全局状态管理的内容。</span>
│   ├── main.tsx        <span class="hljs-meta"># 项目的入口文件，用于渲染根组件并挂载到 DOM 上。</span>
│   └── vite-env.d.ts   <span class="hljs-meta"># 为 Vite 特定的 TypeScript 类型声明文件，方便开发时的类型检查。</span>
├── tsconfig.json       <span class="hljs-meta"># 这是 TypeScript 项目的根配置文件，定义了全局的 TypeScript 编译选项</span>
├── tsconfig.app.json   <span class="hljs-meta">#这个文件是特定于应用的 TypeScript 配置文件    </span>
├── tsconfig.node.json  <span class="hljs-meta">#这个文件专门为 Node.js 环境配置 TypeScript。     </span>
├── vite.config.ts      <span class="hljs-meta"># Vite 的配置文件，用于自定义开发服务器、插件和构建流程。</span>
├── package.json        <span class="hljs-meta"># 项目的元数据文件，包含项目依赖、脚本和基本信息。</span>
├── .eslintrc.cjs       <span class="hljs-meta"># ESLint 的配置文件，用于规范代码风格和查找潜在问题。</span>
├── .gitignore          <span class="hljs-meta"># 定义 Git 不需要追踪的文件和目录。</span>
└── README.md           <span class="hljs-meta"># 自述文件项目的说明文档，包含项目简介、使用说明和贡献指南。</span>
</code></pre>
<h2 data-id="heading-10">2.项目初始化</h2>
<pre><code class="hljs">将项目模板结构不需要的文件修改删除调整
</code></pre>
<h3 data-id="heading-11">2.1 ABP</h3>
<h4 data-id="heading-12">初始化Serilog日志</h4>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">async</span> Task&lt;<span class="hljs-built_in">int</span>&gt; <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        Log.Logger = <span class="hljs-keyword">new</span> LoggerConfiguration()
<span class="hljs-meta">#<span class="hljs-keyword">if</span> DEBUG</span>
            .MinimumLevel.Debug()
<span class="hljs-meta">#<span class="hljs-keyword">else</span></span>
            .MinimumLevel.Information()
<span class="hljs-meta">#<span class="hljs-keyword">endif</span></span>
            .MinimumLevel.Override(<span class="hljs-string">"Microsoft"</span>, LogEventLevel.Information)
            .MinimumLevel.Override(<span class="hljs-string">"Microsoft.EntityFrameworkCore"</span>, LogEventLevel.Warning)
            .Enrich.FromLogContext()
            .WriteTo.Async(c =&gt; c.File(
                <span class="hljs-string">"Logs/log-.log"</span>,
                rollingInterval: RollingInterval.Day,
                rollOnFileSizeLimit: <span class="hljs-literal">true</span>,
                fileSizeLimitBytes: <span class="hljs-number">1L</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> / <span class="hljs-number">2</span>, <span class="hljs-comment">// 500MB</span>
                retainedFileCountLimit: <span class="hljs-number">10</span>,
                shared: <span class="hljs-literal">true</span>
            ))
<span class="hljs-meta">#<span class="hljs-keyword">if</span> DEBUG  //debug时日志输出到控制台</span>
            .WriteTo.Async(c =&gt; c.Console())
<span class="hljs-meta">#<span class="hljs-keyword">endif</span>    //日志输出文件中</span>
            .CreateLogger();       

        <span class="hljs-keyword">try</span>
        {
           <span class="hljs-comment">//#省略...</span>
        }
    }
</code></pre>
<blockquote>
<p><strong>解析</strong></p>
</blockquote>
<pre><code class="hljs language-vbnet" lang="vbnet">Serilog 是一个高性能、简单的日志库，用于记录应用程序的日志。它支持丰富的输出方式（控制台、文件、数据库等），并且允许动态配置日志级别。

.MinimumLevel.Debug() 和 .MinimumLevel.Information()：这两行代码设置日志的最小级别。在 Debug 模式下，日志级别设置为 Debug，这意味着所有级别的日志都会被记录（包括 Debug、Information、Warning 等）。在 Release 模式下，日志级别设置为 Information，表示只记录 Information 级别及更高严重级别的日志。

.MinimumLevel.Override(<span class="hljs-string">"Microsoft"</span>, LogEventLevel.Information)：这行代码覆盖了 Microsoft 命名空间的日志级别，设置为 Information。这样就不会记录 Microsoft 相关的调试信息，减少日志冗余。

.WriteTo.<span class="hljs-keyword">Async</span>(...)：这里的 WriteTo 配置定义了日志的输出方式。<span class="hljs-keyword">Async</span> 是指日志会异步写入，避免影响主线程的性能。它配置了：

File：日志会写入文件。日志文件会以 Logs/log-.log 命名，并且日志会按天分割。

<span class="hljs-symbol">rollingInterval:</span> RollingInterval.Day：每一天都会生成一个新的日志文件。

<span class="hljs-symbol">rollOnFileSizeLimit:</span> <span class="hljs-literal">true</span>：当文件大小超过限制时，日志会自动滚动（即生成新的文件）。

<span class="hljs-symbol">fileSizeLimitBytes:</span> <span class="hljs-number">1L</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> / <span class="hljs-number">2</span>：日志文件的最大大小为 <span class="hljs-number">500</span>MB。

<span class="hljs-symbol">retainedFileCountLimit:</span> <span class="hljs-number">10</span>：保留最近的 <span class="hljs-number">10</span> 个日志文件，删除更早的文件。

<span class="hljs-symbol">shared:</span> <span class="hljs-literal">true</span>：文件可被多个进程共享。

Console 输出（仅在 Debug 模式下）：如果是 Debug 模式，还会输出日志到控制台。这样在调试时可以快速看到日志。
</code></pre>
<h4 data-id="heading-13">初始化配置文件</h4>
<blockquote>
<p>src/AppCoreServer.HttpApi.Host/appsettings.json 项目根配置文件</p>
</blockquote>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"App"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
       <span class="hljs-comment">//当前服务自身的根 URL，常用于服务注册或跳转（OpenIddict、身份认证等场景）</span>
    <span class="hljs-attr">"SelfUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://localhost:44239"</span><span class="hljs-punctuation">,</span>
      
       <span class="hljs-comment">//允许哪些前端域名进行跨域访问（用逗号或分号分隔）支持通配符如 https://*.xxx.com</span>
    <span class="hljs-attr">"CorsOrigins"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://*.AppCoreServer.com"</span><span class="hljs-punctuation">,</span>
      
      <span class="hljs-comment">//【Openiddict提供,授权码模式备案名单】登录完成后允许跳转的 URL 白名单（防止重定向攻击）可设置为 https://yourfrontend.com</span>
    <span class="hljs-attr">"RedirectAllowedUrls"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    
    <span class="hljs-comment">//初始配置链接字符串,EFcore默认使用Default字符串</span>
  <span class="hljs-attr">"ConnectionStrings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Server=.;Database=AppCoreServer;uid=sa;pwd=sa;TrustServerCertificate=True"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-comment">//认证配置，见下文OpenIdDict认证授权</span>
  <span class="hljs-attr">"AuthServer"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Authority"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://localhost:44239"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"RequireHttpsMetadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"SwaggerClientId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AppCoreServer_Swagger"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    
  <span class="hljs-attr">"StringEncryption"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"DefaultPassPhrase"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"WVtuUXdarYDdaFZp"</span><span class="hljs-comment">//编码密钥，用于一些编码服务</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>src/AppCoreServer.DbMigrator/appsettings.json 项目迁移配置</p>
</blockquote>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-comment">//迁移地址</span>
  <span class="hljs-attr">"ConnectionStrings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
     <span class="hljs-attr">"Default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Server=.;Database=AppCoreServer;uid=sa;pwd=sa;TrustServerCertificate=True"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    
  <span class="hljs-attr">"Redis"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Configuration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"127.0.0.1"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-comment">//OpenIddict认证模式配置</span>
  <span class="hljs-attr">"OpenIddict"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Applications"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"AppCoreServer_Web"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"ClientId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AppCoreServer_Web"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ClientSecret"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1q2w3e*"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"RootUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://localhost:44320"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"AppCoreServer_App"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"ClientId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AppCoreServer_App"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"RootUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:4200"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"AppCoreServer_BlazorServerTiered"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"ClientId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AppCoreServer_BlazorServerTiered"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ClientSecret"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1q2w3e*"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"RootUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://localhost:44345"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"AppCoreServer_BlazorWebAppTiered"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"ClientId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AppCoreServer_BlazorWebAppTiered"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ClientSecret"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1q2w3e*"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"RootUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://localhost:44345"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"AppCoreServer_Swagger"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"ClientId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AppCoreServer_Swagger"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"RootUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://localhost:44355"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>launchSettings.json</p>
</blockquote>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">//aspnet-core\src\AppCoreServer.HttpApi.Host\Properties\launchSettings.json</span>
运行配置文件<span class="hljs-punctuation">,</span>用于开发时的端口监听配置<span class="hljs-punctuation">,</span>常用于编辑器配置启动编译<span class="hljs-punctuation">,</span>部署时忽略.

 <span class="hljs-attr">"applicationUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://localhost:44239"</span><span class="hljs-comment">//地址跟App:SelfUrl保持一致</span>
</code></pre>























<table><thead><tr><th>启动方式</th><th>使用配置</th><th>底层宿主</th><th>启动行为</th></tr></thead><tbody><tr><td><code>IIS Express</code></td><td><code>iisExpress.applicationUrl</code></td><td><strong>IIS Express 进程 (<code>iisexpress.exe</code>)</strong></td><td>通过 VS 或命令调用 <code>iisexpress.exe</code> 启动项目，不是用 <code>dotnet run</code></td></tr><tr><td><code>Kestrel</code>（dotnet run）</td><td><code>applicationUrl</code></td><td><strong>Kestrel 服务器 (<code>dotnet</code>)</strong></td><td>使用 <code>dotnet run</code> 启动程序，即调用 <code>.dll</code> 文件运行</td></tr></tbody></table>
<h3 data-id="heading-14">2.2 React</h3>
<h4 data-id="heading-15">🌈调整：</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">//新建src/view/App目录</span>
	
view/App
├──App.tsx
└──App.css



<span class="hljs-comment">//修改App.tsx:</span>
const App<span class="hljs-punctuation">:</span> React.FC = () =&gt; <span class="hljs-punctuation">{</span>
    return(
        &lt;StrictMode&gt;
      
        &lt;/StrictMode&gt;
    )
<span class="hljs-punctuation">}</span>


<span class="hljs-comment">//修改main.tsx:</span>
createRoot(document.getElementById('root')!).render(
    &lt;App/&gt;
)


<span class="hljs-comment">//如上，main.tsx作为根目录入口文件，App.tsx作为全局配置来整理项目</span>
</code></pre>
<blockquote>
<p>StrictMode:</p>
</blockquote>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-operator">&lt;</span><span class="hljs-type">StrictMode</span><span class="hljs-operator">&gt;</span> 是 <span class="hljs-type">React</span> 提供的一种工具，用来检测应用中的潜在问题<span class="hljs-operator">。</span>它不会渲染任何可见的 <span class="hljs-type">UI，只是对其子组件执行额外的检查和警告，帮助开发者编写更健壮的代码</span><span class="hljs-operator">。</span>

主要功能
检测废弃的生命周期方法：例如 componentWillMount<span class="hljs-operator">、</span>componentWillReceiveProps<span class="hljs-operator">。</span>
识别不安全的操作：比如 findDOMNode 的使用<span class="hljs-operator">。</span>
检查意外的副作用：<span class="hljs-type">React</span> 会在开发环境下对组件的 render 和 useEffect 等进行两次调用，以帮助识别潜在的副作用<span class="hljs-operator">。</span>
强制更严格的模式：提醒开发者采用 <span class="hljs-type">React</span> 推荐的最佳实践<span class="hljs-operator">。</span>
</code></pre>
<h2 data-id="heading-16">3.基础构建</h2>
<h3 data-id="heading-17">3.1 后端跨域</h3>
<h4 data-id="heading-18">🌈操作</h4>
<pre><code class="hljs language-c#" lang="c#">   <span class="hljs-string">"App"</span>: {
    <span class="hljs-string">"SelfUrl"</span>: <span class="hljs-string">"https://localhost:55555"</span>,
    <span class="hljs-string">"CorsOrigins"</span>: <span class="hljs-string">"https://*.ServerApp.com"</span>
        
 	<span class="hljs-comment">//添加了允许全部</span>
	<span class="hljs-string">"AllowAnyOrigin"</span>: <span class="hljs-string">"true"</span>
  },
 
 context.Services.AddCors(options =&gt;
        {
            options.AddDefaultPolicy(builder =&gt;
            {
                builder
                    .WithAbpExposedHeaders()
                    .SetIsOriginAllowedToAllowWildcardSubdomains()
                    .AllowAnyHeader()
                    .AllowAnyMethod().AllowCredentials().WithExposedHeaders(<span class="hljs-string">"x-elsa-workflow-instance-id"</span>);

                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">bool</span>.Parse(configuration[<span class="hljs-string">"App:AllowAnyOrigin"</span>] ?? <span class="hljs-string">"false"</span>))
                {
                    <span class="hljs-comment">//允许全部</span>
                    builder.SetIsOriginAllowed(_ =&gt; <span class="hljs-literal">true</span>);
                }
                <span class="hljs-keyword">else</span>
                {
                    <span class="hljs-comment">//否则按照CorsOrigins允许的来</span>
                    builder
                        .WithOrigins(
                            (configuration[<span class="hljs-string">"App:CorsOrigins"</span>] ?? <span class="hljs-string">""</span>)
                            .Split(<span class="hljs-string">","</span>, StringSplitOptions.RemoveEmptyEntries)
                            .Select(o =&gt; o.RemovePostFix(<span class="hljs-string">"/"</span>))
                            .ToArray()
                        );
                }
            });
        });
</code></pre>
<h3 data-id="heading-19">3.2 OpenIddict授权认证</h3>
<h4 data-id="heading-20">配置客户端</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">//aspnet-core\src\AppCoreServer.DbMigrator\appsettings.json 迁移文件配置</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"ConnectionStrings"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Default"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Server=.;Database=AppCoreServer;uid=sa;pwd=sa;TrustServerCertificate=True"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"OpenIddict"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"Applications"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"AppCoreServer_Swagger"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"ClientId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AppCoreServer_Swagger"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"RootUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://localhost:55319"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-comment">//新增APP内部客户端,使用密码模式</span>
        <span class="hljs-attr">"AppCoreServer_App"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"ClientId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AppCoreServer_App"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ClientSecret"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1q2w3E*"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-comment">//新增第三方访问客户端,使用授权码模式</span>
      <span class="hljs-attr">"AppCoreServer_ExternalSystems"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"ClientId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AppCoreServer_ExternalSystems"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"ClientSecret"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ExternalSystems_API"</span>
      <span class="hljs-punctuation">}</span>
      
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-21">创建客户端</h4>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">namespace</span> <span class="hljs-title">AppCoreServer.OpenIddict</span>;

<span class="hljs-comment">/* Creates initial data that is needed to property run the application
 * and make client-to-server communication possible.
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">OpenIddictDataSeedContributor</span> : <span class="hljs-title">IDataSeedContributor</span>, <span class="hljs-title">ITransientDependency</span>
{
   <span class="hljs-comment">//...省略</span>

    [<span class="hljs-meta">UnitOfWork</span>]
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">SeedAsync</span>(<span class="hljs-params">DataSeedContext context</span>)</span>
    {
        <span class="hljs-keyword">await</span> CreateScopesAsync();
        <span class="hljs-keyword">await</span> CreateApplicationsAsync();
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">CreateScopesAsync</span>()</span>
    {
        <span class="hljs-comment">//框架默认创建</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> _openIddictScopeRepository.FindByNameAsync(<span class="hljs-string">"AppCoreServer"</span>) == <span class="hljs-literal">null</span>)
        {
            <span class="hljs-keyword">await</span> _scopeManager.CreateAsync(<span class="hljs-keyword">new</span> OpenIddictScopeDescriptor {
                Name = <span class="hljs-string">"AppCoreServer"</span>, DisplayName = <span class="hljs-string">"AppCoreServer API"</span>, Resources = { <span class="hljs-string">"AppCoreServer"</span> }
            });
        }
        
        <span class="hljs-comment">//创建第三方访问客户端</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> _openIddictScopeRepository.FindByNameAsync(<span class="hljs-string">"ExternalSystems"</span>) == <span class="hljs-literal">null</span>)
        {
            <span class="hljs-keyword">await</span> _scopeManager.CreateAsync(<span class="hljs-keyword">new</span> OpenIddictScopeDescriptor {
                Name = <span class="hljs-string">"ExternalSystems"</span>, DisplayName = <span class="hljs-string">"ExternalSystems API"</span>, Resources = { <span class="hljs-string">"ExternalSystems"</span> }
            });
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">CreateApplicationsAsync</span>()</span>
    {
        
     <span class="hljs-comment">// ✅ 通用 Scope（所有客户端都能用的）</span>
    <span class="hljs-keyword">var</span> commonScopes = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;
    {
        OpenIddictConstants.Permissions.Scopes.Address,
        OpenIddictConstants.Permissions. Scopes.Email,
        OpenIddictConstants.Permissions. Scopes.Phone,
        OpenIddictConstants.Permissions.Scopes.Profile,
        OpenIddictConstants. Permissions.Scopes.Roles,
        <span class="hljs-string">"AppCoreServer"</span>,  <span class="hljs-comment">// 主 API 的 Scope</span>
        <span class="hljs-string">"ExternalSystems"</span>
    };

    <span class="hljs-keyword">var</span> configurationSection = _configuration.GetSection(<span class="hljs-string">"OpenIddict:Applications"</span>);

    <span class="hljs-comment">// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span>
    <span class="hljs-comment">// 1️⃣ Swagger 客户端（公共客户端 + 授权码模式）</span>
    <span class="hljs-comment">// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span>
    <span class="hljs-keyword">var</span> swaggerClientId = configurationSection[<span class="hljs-string">"AppCoreServer_Swagger: ClientId"</span>];
    <span class="hljs-keyword">if</span> (!swaggerClientId.IsNullOrWhiteSpace())
    {
        <span class="hljs-keyword">var</span> swaggerRootUrl = configurationSection[<span class="hljs-string">"AppCoreServer_Swagger:RootUrl"</span>]?.TrimEnd(<span class="hljs-string">'/'</span>);

        <span class="hljs-keyword">await</span> CreateApplicationAsync(
            name: swaggerClientId!,
            type: OpenIddictConstants.ClientTypes.Public,  <span class="hljs-comment">// ✅ 公共客户端</span>
            consentType: OpenIddictConstants.ConsentTypes.Implicit,  <span class="hljs-comment">// ✅ 自动同意</span>
            displayName: <span class="hljs-string">"Swagger Application"</span>,
            secret: <span class="hljs-literal">null</span>,  <span class="hljs-comment">// ✅ 公共客户端不需要 Secret</span>
            grantTypes: <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;
            {
                OpenIddictConstants.GrantTypes.AuthorizationCode  <span class="hljs-comment">// ✅ 授权码模式</span>
            },
            scopes: commonScopes,
            redirectUri: <span class="hljs-string">$"<span class="hljs-subst">{swaggerRootUrl}</span>/swagger/oauth2-redirect.html"</span>,
            clientUri: swaggerRootUrl
        );
    }

    <span class="hljs-comment">// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span>
    <span class="hljs-comment">// 2️⃣ App 客户端（内部网页/移动端 + 密码模式）</span>
    <span class="hljs-comment">// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span>
    <span class="hljs-keyword">var</span> appClientId = configurationSection[<span class="hljs-string">"AppCoreServer_App:ClientId"</span>];
    <span class="hljs-keyword">if</span> (!appClientId. IsNullOrWhiteSpace())
    {
        <span class="hljs-keyword">var</span> appClientSecret = configurationSection[<span class="hljs-string">"AppCoreServer_App:ClientSecret"</span>];  <span class="hljs-comment">// ✅ 从配置读取 Secret</span>

        <span class="hljs-keyword">await</span> CreateApplicationAsync(
            name: appClientId!,
            type: OpenIddictConstants.ClientTypes. Public,
            consentType:  OpenIddictConstants.ConsentTypes.Implicit,  <span class="hljs-comment">// ✅ 自动同意（内部系统）</span>
            displayName: <span class="hljs-string">"App Application"</span>,
            secret: <span class="hljs-literal">null</span>,
            grantTypes: <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;
            {
                OpenIddictConstants.GrantTypes.Password,  <span class="hljs-comment">// ✅ 密码模式</span>
                OpenIddictConstants.GrantTypes.RefreshToken  <span class="hljs-comment">// ✅ 支持刷新令牌</span>
            },
            scopes: commonScopes,
            redirectUri: <span class="hljs-literal">null</span>, 
            clientUri: <span class="hljs-literal">null</span>
        );
    }

    <span class="hljs-comment">// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span>
    <span class="hljs-comment">// 3️⃣ 第三方系统客户端（机密客户端 + 客户端凭证模式）</span>
    <span class="hljs-comment">// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</span>
    <span class="hljs-keyword">var</span> externalSystemsClientId = configurationSection[<span class="hljs-string">"AppCoreServer_ExternalSystems:ClientId"</span>];
    <span class="hljs-keyword">if</span> (!externalSystemsClientId.IsNullOrWhiteSpace())
    {
        <span class="hljs-keyword">var</span> externalSystemsSecret = configurationSection[<span class="hljs-string">"AppCoreServer_ExternalSystems:ClientSecret"</span>];  <span class="hljs-comment">// ✅ 读取 Secret</span>

        <span class="hljs-comment">// ✅ 第三方系统专用 Scope</span>
        <span class="hljs-keyword">var</span> externalScopes = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;
        {
            <span class="hljs-string">"ExternalSystems"</span>  <span class="hljs-comment">// ✅ 只能访问外部系统 API</span>
        };
        <span class="hljs-keyword">await</span> CreateApplicationAsync(
            name: externalSystemsClientId!,
            type: OpenIddictConstants.ClientTypes.Confidential,  <span class="hljs-comment">// ✅ 机密客户端</span>
            consentType: OpenIddictConstants. ConsentTypes.Implicit,  <span class="hljs-comment">// ✅ 不需要用户确认</span>
            displayName: <span class="hljs-string">"External Systems Application"</span>, 
            secret:  externalSystemsSecret,  <span class="hljs-comment">// ✅ 必须配置 Secret</span>
            grantTypes: <span class="hljs-keyword">new</span> List&lt;<span class="hljs-built_in">string</span>&gt;
            {
                OpenIddictConstants.GrantTypes.ClientCredentials  <span class="hljs-comment">// ✅ 客户端凭证模式（推荐）</span>
            },
            scopes: externalScopes, 
            redirectUri: <span class="hljs-literal">null</span>, 
            clientUri: <span class="hljs-literal">null</span>
        );
    }
        
    }
}

</code></pre>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">SeedAsync</span>(<span class="hljs-params">DataSeedContext context</span>)</span>
{
    <span class="hljs-keyword">await</span> CreateScopesAsync();
    <span class="hljs-keyword">await</span> CreateApplicationsAsync();

    <span class="hljs-comment">//主动给admin角色添加全部权限</span>
    <span class="hljs-keyword">var</span> allPermissions =(<span class="hljs-keyword">await</span> _permissionDefinitionManager.GetPermissionsAsync()).Select(p =&gt; p.Name);
    <span class="hljs-keyword">await</span> _permissionDataSeeder.SeedAsync(<span class="hljs-string">"R"</span>,<span class="hljs-string">"admin"</span>,allPermissions);
}
</code></pre>
<h4 data-id="heading-22">执行迁移</h4>
<p>OpenIddict 使用 4 张核心表：</p>






























<table><thead><tr><th>表名</th><th>作用</th><th>主要字段</th></tr></thead><tbody><tr><td><strong>OpenIddictApplications</strong></td><td>存储客户端应用配置</td><td>ClientId, ClientSecret, Type, Permissions</td></tr><tr><td><strong>OpenIddictScopes</strong></td><td>定义权限范围</td><td>Name, DisplayName, Resources</td></tr><tr><td><strong>OpenIddictAuthorizations</strong></td><td>记录用户授权</td><td>Subject（用户ID）, ApplicationId, Scopes</td></tr><tr><td><strong>OpenIddictTokens</strong></td><td>存储 Token</td><td>Type, Payload, ExpirationDate</td></tr></tbody></table>
<p><strong>表关系</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown">OpenIddictApplications（客户端）
<span class="hljs-code">    ↓ 1: N
OpenIddictAuthorizations（授权记录）
    ↓ 1:N
OpenIddictTokens（Token）
</span>
OpenIddictScopes（独立，定义可用的 Scope）
</code></pre>
<h4 data-id="heading-23">修改Token生效时间</h4>
<pre><code class="hljs language-c#" lang="c#">  <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureAuthentication</span>(<span class="hljs-params">ServiceConfigurationContext context</span>)</span>
    {
        context.Services.ForwardIdentityAuthenticationForBearer(OpenIddictValidationAspNetCoreDefaults.AuthenticationScheme);
        context.Services.Configure&lt;AbpClaimsPrincipalFactoryOptions&gt;(options =&gt;
        {
            options.IsDynamicClaimsEnabled = <span class="hljs-literal">true</span>;
        });

      	<span class="hljs-comment">//AddOpenIddict的配置</span>
        context.Services.AddOpenIddict().AddServer(options =&gt;
        {
            <span class="hljs-comment">// ⏱️ Token 生命周期配置,12个小时</span>
            options.SetAccessTokenLifetime(TimeSpan.FromHours(<span class="hljs-number">12</span>));
        });
    }
</code></pre>
<h4 data-id="heading-24">创建权限</h4>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-comment">//aspnet-core\src\AppCoreServer.Application.Contracts\Permissions</span>
<span class="hljs-comment">// 权限定义提供者，用于定义模块的权限结构</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AppCoreServerPermissionDefinitionProvider</span> : <span class="hljs-title">PermissionDefinitionProvider</span>
{
    <span class="hljs-comment">// 重写 Define 方法，在其中定义你的权限结构</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Define</span>(<span class="hljs-params">IPermissionDefinitionContext context</span>)</span>
    {
        <span class="hljs-comment">// 添加权限组（用于归类权限），组名为 "frame"</span>
        <span class="hljs-keyword">var</span> myGroup = context.AddGroup(AppCoreServerPermissions.GroupName);

        <span class="hljs-comment">// 在权限组中添加一个权限，权限名为 "AppCoreServer.MyPermission1"，显示名称为“测试权限”</span>
        myGroup.AddPermission(AppCoreServerPermissions.MyPermission1, L(<span class="hljs-string">"测试权限"</span>));
    }

    <span class="hljs-comment">// 本地化方法，将字符串包装成 LocalizableString，用于多语言支持</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> LocalizableString <span class="hljs-title">L</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span>
    {
        <span class="hljs-keyword">return</span> LocalizableString.Create&lt;frameResource&gt;(name);
        <span class="hljs-comment">// frameResource 是你模块的资源类，用于多语言本地化</span>
    }
}
</code></pre>
<h4 data-id="heading-25">添加权限</h4>
<pre><code class="hljs language-c#" lang="c#">[<span class="hljs-meta">Authorize(framePermissions.MyPermission1)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">GetInventory</span>()</span>
{
    <span class="hljs-keyword">await</span> _InventoryRepository.getby();
}


此时可以测试一下swagger Ui，运行后报错<span class="hljs-number">401</span>，没有登录，然后此时可以在右上角Authoriz是解锁状态，以frame_Swagger客户端登录，
client_secret:不用输入，如果输入匹配不了，即使输入了登录账户admin密码<span class="hljs-number">1</span>q2w3E*也是错误。登录成功后,Authoriz是锁状态,即可访问权限接口。
</code></pre>
<h4 data-id="heading-26">用户密码登录</h4>
<p>postman中参数要使用x-www-form-urlencoded填写</p>
<pre><code class="hljs language-shell" lang="shell">curl --location --request POST 'https://localhost:55319/connect/token' \
--header 'User-Agent: Apifox/1.0.0 (https://apifox.com)' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--header 'Accept: */*' \
--header 'Host: localhost:55319' \
--header 'Connection: keep-alive' \
--data-urlencode 'grant_type=password' \
--data-urlencode 'client_id=AppCoreServer_App' \
--data-urlencode 'scope=AppCoreServer' \
--data-urlencode 'username=admin' \
--data-urlencode 'password=1q2w3E*'
</code></pre>
<p>响应</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"access_token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eyJhbGciOiJSUzI1N...."</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"token_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bearer"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"expires_in"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">43199</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-27">服务端凭证登录</h4>
<pre><code class="hljs language-ini" lang="ini">POST /connect/token
Content-Type:  application/x-www-form-urlencoded

<span class="hljs-attr">grant_type</span>=client_credentials
&amp;<span class="hljs-attr">client_id</span>=AppCoreServer_ExternalSystems
&amp;<span class="hljs-attr">client_secret</span>=ExternalSystems_API
&amp;<span class="hljs-attr">scope</span>=ExternalSystems
</code></pre>
<h4 data-id="heading-28">防伪令牌</h4>
<pre><code class="hljs language-css" lang="css">问题 <span class="hljs-number">1</span>：ABP <span class="hljs-number">9.0</span> 开始强验证了吗？
答：是的！ ABP <span class="hljs-number">9.0</span> 默认强制验证防伪令牌，这是安全性增强的重大变更。

问题 <span class="hljs-number">2</span>：是否只接受 RequestVerificationToken 字段？
答：是的！ ABP 默认只接受 RequestVerificationToken 作为 <span class="hljs-selector-tag">Header</span> 名称，x-xsrf-token 是不被识别的。

解决方案
把前端的 x-xsrf-token 改成 RequestVerificationToken 即可！
</code></pre>
<p>后端禁用防伪令牌验证</p>
<pre><code class="hljs language-c#" lang="c#">注册到服务运行时中
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureAntiForgery</span>(<span class="hljs-params">ServiceConfigurationContext context</span>)</span>
{
    context.Services.Configure&lt;AbpAntiForgeryOptions&gt;(options =&gt; { options.AutoValidate = <span class="hljs-literal">false</span>; });
}
</code></pre>
<h3 data-id="heading-29">3.3 前端Vite代理+Axios封装</h3>
<h4 data-id="heading-30">🌈配置Vite</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">react</span>()],
  <span class="hljs-attr">server</span>: {
  	<span class="hljs-attr">port</span>: <span class="hljs-number">5173</span>, <span class="hljs-comment">// 设置开发服务器的端口为 5173</span>
    <span class="hljs-attr">cors</span>:<span class="hljs-literal">true</span>,
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-comment">//url关键字</span>
      <span class="hljs-string">'/api'</span>: {
  		<span class="hljs-attr">target</span>: <span class="hljs-string">"https://localhost:55555/"</span>,  
        <span class="hljs-comment">//是否跨域</span>
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">//【注意：当指定的目标地址是https的时候一定要添加上该配置，如果是http则不需要，</span>
        <span class="hljs-comment">//不然请求会一直报错500且调试前端会提示 http proxy error: Error: self signed certificate in certificate chain vite 代理报错】</span>
        <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 如果是https接口，需要配置这个参数,禁用 SSL 校验，适用于 HTTPS 的本地开发环境</span>
        <span class="hljs-attr">ws</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 允许websocket代理</span>
        <span class="hljs-comment">// 重写配置：可以将请求url重写  ，以下意思是将'/api/app/station'进行重写，留着api加上网址=》</span>
        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^\/api/</span>, <span class="hljs-string">'/api'</span>),
      }
    },
  },
})


<span class="hljs-attr">target</span>: <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_BASE_URL</span> 
这样的写法目前在config中读取环境变量是失败的
详情可见<span class="hljs-attr">https</span>:<span class="hljs-comment">//cn.vite.dev</span>
</code></pre>
<h4 data-id="heading-31">🌈Axios封装</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> axios, {<span class="hljs-title class_">AxiosRequestConfig</span>, <span class="hljs-title class_">AxiosResponse</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"axios"</span>;
<span class="hljs-keyword">import</span> {stringify} <span class="hljs-keyword">from</span> <span class="hljs-string">"qs"</span>;  
<span class="hljs-comment">//npm install qs</span>
<span class="hljs-comment">//npm install --save-dev @types/qs</span>

<span class="hljs-comment">// 定义 API 响应数据结构的接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ResponseData</span> {
    errorMessage?: <span class="hljs-built_in">string</span>;
    [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">unknown</span>;  <span class="hljs-comment">// 可以根据实际需要进行扩展</span>
}

<span class="hljs-comment">// 定义请求配置接口</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RequestConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AxiosRequestConfig</span> {
    requestType?: <span class="hljs-string">"form"</span> | <span class="hljs-string">"json"</span>;  <span class="hljs-comment">// 定义请求类型</span>
}

<span class="hljs-keyword">const</span> instance = axios.<span class="hljs-title function_">create</span>({
    <span class="hljs-attr">baseURL</span>: <span class="hljs-title function_">getBaseURL</span>(),
    <span class="hljs-comment">// timeout: 3000,</span>
    <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
    }
});


<span class="hljs-comment">// 请求拦截</span>
instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
    <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
        <span class="hljs-comment">// 根据 requestType 设置请求头或对数据进行转换</span>
        <span class="hljs-keyword">if</span> ((config <span class="hljs-keyword">as</span> <span class="hljs-title class_">RequestConfig</span>).<span class="hljs-property">requestType</span> === <span class="hljs-string">"form"</span>) {
            config.<span class="hljs-property">headers</span>[<span class="hljs-string">"Content-Type"</span>] = <span class="hljs-string">"application/x-www-form-urlencoded;charset=UTF-8"</span>;
            config.<span class="hljs-property">data</span> = <span class="hljs-title function_">stringify</span>(config.<span class="hljs-property">data</span>); <span class="hljs-comment">// 序列化为表单数据</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((config <span class="hljs-keyword">as</span> <span class="hljs-title class_">RequestConfig</span>).<span class="hljs-property">requestType</span> === <span class="hljs-string">"json"</span>) {
            config.<span class="hljs-property">headers</span>[<span class="hljs-string">"Content-Type"</span>] = <span class="hljs-string">"application/json"</span>;
        }
        <span class="hljs-keyword">return</span> config;
    },
    <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">alert</span>(err.<span class="hljs-property">message</span> || <span class="hljs-string">"请求错误"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(err);
    }
);

<span class="hljs-comment">// 响应拦截</span>
instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
    <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response,
    <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> errorMessage = <span class="hljs-title function_">getErrorMessage</span>(err.<span class="hljs-property">response</span>);
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">alert</span>(errorMessage || err.<span class="hljs-property">message</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(err); <span class="hljs-comment">// 保证错误被业务捕获</span>
    }
);



<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> request&lt;T = <span class="hljs-title class_">ResponseData</span>&gt;(
    <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">param</span>: <span class="hljs-title class_">RequestConfig</span> = {}
): <span class="hljs-title class_">Promise</span>&lt;T&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> instance&lt;T&gt;(url, {...param});
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
}



<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">getErrorMessage</span> = (<span class="hljs-params">response: AxiosResponse | <span class="hljs-literal">undefined</span></span>) =&gt; {
    <span class="hljs-comment">//注意,当使用Vite代理时,response不是null,因为vite代理会抛错500出来</span>
    <span class="hljs-comment">//代理机制：Vite 使用 Node.js 的 http-proxy 或类似库转发请求。如果目标服务器（https://localhost:55319/）不可达，代理会捕获错误并返回 HTTP 响应（e.g., 500），而不是抛出原始的 ECONNREFUSED 或超时错误。</span>
    <span class="hljs-keyword">if</span> (!response) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"服务器未响应,请检查网络"</span>;
    }
    <span class="hljs-keyword">const</span> data = response.<span class="hljs-property">data</span>;
    <span class="hljs-keyword">if</span> (!data) {
        <span class="hljs-keyword">switch</span> (response.<span class="hljs-property">status</span>) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">401</span>:
                <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">alert</span>(<span class="hljs-string">"登录已过期，请重新登录"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">reload</span>();
            <span class="hljs-keyword">case</span> <span class="hljs-number">403</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"无此操作权限"</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">404</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"服务端无此资源"</span>;
            <span class="hljs-attr">default</span>:
                <span class="hljs-keyword">return</span> <span class="hljs-string">"未知异常,请联系开发人员"</span>;
        }
    }
    <span class="hljs-comment">// 如果后端返回了详细错误信息，可在这里优先返回</span>
    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">error</span>.<span class="hljs-property">message</span>) {
        <span class="hljs-keyword">return</span> data.<span class="hljs-property">error</span>.<span class="hljs-property">message</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">"未知错误"</span>;
};

<span class="hljs-comment">// ✅ 核心修改：开发环境返回空字符串，让请求走相对路径</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getBaseURL</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> env = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>;
    
    <span class="hljs-comment">// 开发环境：返回空字符串，走 Vite proxy</span>
    <span class="hljs-keyword">if</span> (env.<span class="hljs-property">DEV</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;  <span class="hljs-comment">// ✅ 关键改动</span>
    }
    

    <span class="hljs-keyword">if</span> (env.<span class="hljs-property">PROD</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${env.VITE_API_BASE_URL}</span>:<span class="hljs-subst">${env.VITE_API_PORT}</span>`</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
}

</code></pre>
<h4 data-id="heading-32">Vite.env 环境变量配置</h4>
<p>操作</p>
<pre><code class="hljs language-ini" lang="ini">手动创建以下文件
.env   		开发环境
.env.production   生产环境

文件手动新增变量
{
    <span class="hljs-attr">VITE_API_BASE_URL</span>=https://localhost
    <span class="hljs-attr">VITE_API_PORT</span> =<span class="hljs-number">44319</span>
}
</code></pre>
<p>解释</p>
<pre><code class="hljs language-typescript" lang="typescript">环境加载优先级
一份用于指定模式的文件（例如 .<span class="hljs-property">env</span>.<span class="hljs-property">production</span>）会比通用形式的优先级更高（例如 .<span class="hljs-property">env</span>）。
为了防止意外地将一些环境变量泄漏到客户端，只有以 <span class="hljs-variable constant_">VITE_</span> 为前缀的变量才会暴露给经过 vite 处理的代码



<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>) <span class="hljs-comment">//此时根据不同的环境，使用不同的环境变量</span>
==》{
    <span class="hljs-string">"BASE_URL"</span>: <span class="hljs-string">"/"</span>,
    <span class="hljs-string">"DEV"</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">//开发环境</span>
    <span class="hljs-string">"MODE"</span>: <span class="hljs-string">"development"</span>,
    <span class="hljs-string">"PROD"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">"SSR"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-string">"VITE_API_BASE_URL"</span>: <span class="hljs-string">"https://localhost"</span>,
    <span class="hljs-string">"VITE_API_PORT"</span>: <span class="hljs-string">"44319"</span>,
}

<span class="hljs-title class_">Vite</span> 在一个特殊的 <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span> 对象上暴露环境变量，这些变量在构建时会被静态地替换掉。这里有一些在所有情况下都可以使用的内建变量：
<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MODE</span>: {<span class="hljs-built_in">string</span>} 应用运行的模式。

<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">BASE_URL</span>: {<span class="hljs-built_in">string</span>} 部署应用时的基本 <span class="hljs-variable constant_">URL</span>。他由base 配置项决定。

<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">PROD</span>: {<span class="hljs-built_in">boolean</span>} 应用是否运行在生产环境（使用 <span class="hljs-variable constant_">NODE_ENV</span>=<span class="hljs-string">'production'</span> 运行开发服务器或构建应用时使用 <span class="hljs-variable constant_">NODE_ENV</span>=<span class="hljs-string">'production'</span> ）。

<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">DEV</span>: {<span class="hljs-built_in">boolean</span>} 应用是否运行在开发环境 (永远与 <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">PROD</span>相反)。

<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">SSR</span>: {<span class="hljs-built_in">boolean</span>} 应用是否运行在 server 上。
</code></pre>
<h3 data-id="heading-33">3.4 Openapi与Swagger</h3>
<h4 data-id="heading-34">配置Swagger/json</h4>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConfigureSwaggerServices</span>(<span class="hljs-params">ServiceConfigurationContext context, IConfiguration configuration</span>)</span>
    {
        context.Services.AddAbpSwaggerGenWithOAuth(
            configuration[<span class="hljs-string">"AuthServer:Authority"</span>]!,
            <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt;
            {
                    {<span class="hljs-string">"AppCoreServer"</span>, <span class="hljs-string">"AppCoreServer API"</span>}
            },
            options =&gt;
            {
                options.SwaggerDoc(<span class="hljs-string">"v1"</span>, <span class="hljs-keyword">new</span> OpenApiInfo { Title = <span class="hljs-string">"AppCoreServer API"</span>, Version = <span class="hljs-string">"v1"</span> });
                options.DocInclusionPredicate((docName, description) =&gt; <span class="hljs-literal">true</span>);
                options.CustomSchemaIds(type =&gt; type.FullName);
                
                <span class="hljs-comment">//给Swagger的json中添加  operationId字段</span>
                <span class="hljs-comment">//可见Swashbuckle  Abp.Swashbuckle.Extensions</span>
                options.CustomOperationIds(apiDesc =&gt;
                    apiDesc.TryGetMethodInfo(<span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> methodInfo) ? methodInfo.Name : <span class="hljs-literal">null</span>);
            });
    }


<span class="hljs-comment">//得到的API_json==&gt;</span>

<span class="hljs-string">"/api/abp/application-configuration"</span>: {
      <span class="hljs-string">"get"</span>: {
        <span class="hljs-string">"tags"</span>: [
          <span class="hljs-string">"AbpApplicationConfiguration"</span>
        ],
        <span class="hljs-string">"operationId"</span>: <span class="hljs-string">"GetAsync"</span>, <span class="hljs-comment">//方便前端生成方法名称</span>
        <span class="hljs-string">"parameters"</span>: [
          {
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"IncludeLocalizationResources"</span>,
            <span class="hljs-string">"in"</span>: <span class="hljs-string">"query"</span>,
            <span class="hljs-string">"schema"</span>: {
              <span class="hljs-string">"type"</span>: <span class="hljs-string">"boolean"</span>
            }
          }
        ]
</code></pre>
<h4 data-id="heading-35">配置Umijs/Openapi</h4>
<blockquote>
<p>1.14.1版</p>
</blockquote>
<p>创建\reactWeb\openapi2ts.config.ts文件</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { generateService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@umijs/openapi'</span>;
<span class="hljs-title function_">generateService</span>({
    <span class="hljs-comment">/**
     * 指定请求库导入语句，生成的接口文件会用到这个导入。
     * 例如你项目中封装了请求函数 request，可以写成：
     * "import { request } from '@/utils/request'"
     */</span>
    <span class="hljs-attr">requestLibPath</span>: <span class="hljs-string">"../../utils/request"</span>,

    <span class="hljs-comment">/**
     * OpenAPI / Swagger 的接口文档地址或本地文件路径。
     * 这里是本地接口文档的 HTTP 地址，生成代码会基于这个定义。
     */</span>
    <span class="hljs-attr">schemaPath</span>: <span class="hljs-string">'https://localhost:2001/swagger/v1/swagger.json'</span>,

    <span class="hljs-comment">/**
     * 项目名称，生成的文件夹名或命名空间参考名，
     * 主要用于区分不同项目的生成代码。
     */</span>
    <span class="hljs-attr">serversPath</span>: <span class="hljs-string">"./src/services"</span>,
    <span class="hljs-attr">projectName</span>: <span class="hljs-string">'api'</span>,

    <span class="hljs-comment">/**
     * TypeScript 代码中使用的命名空间名称，
     * 生成的类型、接口等都会放在这个命名空间下。
     */</span>
    <span class="hljs-attr">namespace</span>: <span class="hljs-string">'API'</span>,

    <span class="hljs-comment">/**
     * 自定义模板文件夹路径，指向你的 Nunjucks 模板目录。
     * 生成器会使用此目录下的模板文件生成代码，
     * 方便你自定义生成格式。
     */</span>  
	<span class="hljs-attr">templatesFolder</span>: <span class="hljs-string">'./openapi-template'</span>, 

    <span class="hljs-comment">/**
     * 是否使用驼峰命名法生成接口方法名称，默认 true。
     * 设为 false，接口方法名保持 PascalCase，
     * 比如 GetAsync 而不是 getAsync。
     */</span>
    <span class="hljs-attr">isCamelCase</span>: <span class="hljs-literal">false</span>,

    <span class="hljs-comment">/**
     * 钩子函数集，可以自定义生成过程的各种逻辑，
     * 这里自定义了接口函数名称生成逻辑，
     * 使用 OpenAPI 中定义的 operationId 作为函数名，
     * 如果没有则默认 'AutoGenerated'。
     */</span>
    <span class="hljs-attr">hook</span>: {
        <span class="hljs-title function_">customFunctionName</span>(<span class="hljs-params">api</span>) {
            <span class="hljs-keyword">return</span> api.<span class="hljs-property">operationId</span> || <span class="hljs-string">'AutoGenerated'</span>;
        },
    },
});

</code></pre>
<p>templatesFolder: './openapi-template',</p>
<pre><code class="hljs">需要使用自定义模板,解决默认模板生成的入参参数类型集合,重复不兼容的问题
</code></pre>
<p>配置运行命令</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsc -b &amp;&amp; vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eslint ."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"openapi2ts"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"tsx openapi2ts.config.ts"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>

<span class="hljs-comment">//有需要安装以下两个依赖包</span>
<span class="hljs-comment">//pnpm i tsx@3.14.0</span>
<span class="hljs-comment">//pnpm add tslib</span>
</code></pre>
<p>执行</p>
<pre><code class="hljs language-json" lang="json">此时可以看到 serversPath<span class="hljs-punctuation">:</span> <span class="hljs-string">"./src/services"</span>
生成了后端对应的请求文件<span class="hljs-punctuation">,</span>API的格式是按照requestLibPath<span class="hljs-punctuation">:</span> <span class="hljs-string">"../../utils/request"</span>设计
    
 <span class="hljs-comment">/** 此处后端没有提供注释 GET /api/abp/application-configuration */</span>
export async function GetAsync(
  <span class="hljs-comment">// 叠加生成的Param类型 (非body参数swagger默认没有生成对象)</span>
  params<span class="hljs-punctuation">:</span> API.GetAsyncParams<span class="hljs-punctuation">,</span>
  options?<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-punctuation">[</span>key<span class="hljs-punctuation">:</span> string<span class="hljs-punctuation">]</span><span class="hljs-punctuation">:</span> any <span class="hljs-punctuation">}</span>
) <span class="hljs-punctuation">{</span>
  return request&lt;API.ApplicationConfigurationDto&gt;(
    <span class="hljs-string">"/api/abp/application-configuration"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      method<span class="hljs-punctuation">:</span> <span class="hljs-string">"GET"</span><span class="hljs-punctuation">,</span>
      params<span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        ...params<span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      ...(options || <span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span>)<span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">}</span>
  );
<span class="hljs-punctuation">}</span>   
</code></pre>
<h3 data-id="heading-36">3.5全局配置与路由与布局</h3>
<h4 data-id="heading-37">修改html主结构</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-title class_">AppServer</span>\react-web\index.<span class="hljs-property">html</span>

修改项目主入口html，标题等为自己项目log等

<span class="hljs-attr">svg</span>:<span class="hljs-attr">https</span>:<span class="hljs-comment">//www.iconfont.cn/</span>
</code></pre>
<h4 data-id="heading-38">UI库</h4>
<pre><code class="hljs language-bash" lang="bash">以下使用了
<span class="hljs-string">"antd
"</span>antd-style<span class="hljs-string">"
"</span>@ant-design/icons<span class="hljs-string">"
"</span>@ant-design/pro-components<span class="hljs-string">"
</span></code></pre>
<h4 data-id="heading-39">构建路由</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Freactrouter.remix.org.cn%2Fhome" target="_blank" title="https://reactrouter.remix.org.cn/home" ref="nofollow noopener noreferrer">React Router 主页 | React Router - React Router 路由库</a></p>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> react-router-dom   ^<span class="hljs-number">7.11</span>.<span class="hljs-number">0</span>
使用数据模式
</code></pre>

































<table><thead><tr><th>包名</th><th>适用场景</th><th>优点</th><th>缺点</th><th>推荐度（Vite 项目）</th></tr></thead><tbody><tr><td><code>react-router</code></td><td>底层逻辑，非 Web 项目</td><td>灵活、可扩展</td><td>缺少 DOM 功能</td><td>低（通常不单独用）</td></tr><tr><td><code>react-router-dom</code></td><td>标准 Web SPA 路由</td><td>简单、稳定、功能齐全</td><td>缺少 SSR/SSG 等高级功能</td><td>高（基础搭建）</td></tr><tr><td><code>@react-router/dev</code></td><td>现代框架模式（v7）</td><td>SSR、SSG、数据加载、Vite 集成</td><td>配置复杂，生态较新</td><td>中高（需要高级功能）</td></tr></tbody></table>
<h5 data-id="heading-40">构建主路由链</h5>
<p>创建react-web\src\router</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//react-web\src\router\index.ts</span>

<span class="hljs-keyword">const</span> <span class="hljs-attr">index</span>:<span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> createBrowserRouter&gt; = <span class="hljs-title function_">createBrowserRouter</span>([
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">"/"</span>,
        <span class="hljs-attr">element</span>: <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"../view/ServerApp/Dashboard"</span>))),
    },
]);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> index;
                                  
                                                                    
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Dashboard</span>:<span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>= <span class="hljs-function">()=&gt;</span>{
    <span class="hljs-keyword">return</span>(
        <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>我是仪表盘<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/&gt;</span></span>
    )
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Dashboard</span>;
</code></pre>
<h5 data-id="heading-41">注册路由</h5>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span>(
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">StrictMode</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">RouterProvider</span> <span class="hljs-attr">router</span>=<span class="hljs-string">{router}/</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">StrictMode</span>&gt;</span></span>
    )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>


<span class="hljs-comment">//此时按照上述路由链，则优先展示仪表盘页面</span>
</code></pre>
<h5 data-id="heading-42">路由加载页面</h5>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">StrictMode</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">PageLoading</span>/&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">RouterProvider</span> <span class="hljs-attr">router</span>=<span class="hljs-string">{MainRouter}/</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">StrictMode</span>&gt;</span></span>
    )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>
</code></pre>
<h5 data-id="heading-43">基础页面</h5>
<h6 data-id="heading-44">创建404页面</h6>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">//npm antd-style  创建样式</span>

<span class="hljs-comment">//react-web\src\view\System\NotFound\index.tsx</span>
<span class="hljs-keyword">import</span> {useNavigate} <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router-dom"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Button</span>, <span class="hljs-title class_">Result</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"antd"</span>;
<span class="hljs-keyword">import</span> useStyles <span class="hljs-keyword">from</span> <span class="hljs-string">"./style.ts"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">NotFound</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> {styles} = <span class="hljs-title function_">useStyles</span>();
    <span class="hljs-keyword">const</span>  navigate=<span class="hljs-title function_">useNavigate</span>();
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Result</span>
            <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.result}</span>
            <span class="hljs-attr">icon</span>=<span class="hljs-string">{null}</span>
            <span class="hljs-attr">title</span>=<span class="hljs-string">"当前页面不存在..."</span>
            <span class="hljs-attr">subTitle</span>=<span class="hljs-string">"请检查您输入的网址是否正确，或点击下面的按钮返回上一级"</span>
            <span class="hljs-attr">extra</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span>=&gt;</span>navigate(-1)}&gt;返回上一级<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>}
        /&gt;</span>

    );
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">NotFound</span>;
</code></pre>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//react-web\src\view\System\NotFound\style.ts</span>

<span class="hljs-keyword">import</span> {createStyles} <span class="hljs-keyword">from</span> <span class="hljs-string">"antd-style"</span>;
<span class="hljs-keyword">import</span> notFoundImg <span class="hljs-keyword">from</span> <span class="hljs-string">"../../../assets/404.png"</span>

<span class="hljs-keyword">const</span> useStyles = <span class="hljs-title function_">createStyles</span>({
    <span class="hljs-attr">result</span>:{
        <span class="hljs-attr">position</span>: <span class="hljs-string">'relative'</span>,
        <span class="hljs-attr">backgroundImage</span>: <span class="hljs-string">`url(<span class="hljs-subst">${notFoundImg}</span>)`</span>,  <span class="hljs-comment">// 动态引入图片路径</span>
        <span class="hljs-attr">backgroundSize</span>: <span class="hljs-string">'cover'</span>,         <span class="hljs-comment">// 确保图片覆盖整个区域</span>
        <span class="hljs-attr">backgroundPosition</span>: <span class="hljs-string">'center'</span>,    <span class="hljs-comment">// 居中显示背景图片</span>
        <span class="hljs-attr">backgroundRepeat</span>: <span class="hljs-string">'no-repeat'</span>,   <span class="hljs-comment">// 防止图片重复</span>
        <span class="hljs-attr">textAlign</span>: <span class="hljs-string">"center"</span>,             <span class="hljs-comment">// 文本居中</span>
        <span class="hljs-attr">display</span>: <span class="hljs-string">'flex'</span>,
        <span class="hljs-attr">flexDirection</span>: <span class="hljs-string">'column'</span>,
        <span class="hljs-attr">justifyContent</span>: <span class="hljs-string">'center'</span>,        <span class="hljs-comment">// 垂直居中</span>
        <span class="hljs-attr">alignItems</span>: <span class="hljs-string">'center'</span>,            <span class="hljs-comment">// 水平居中</span>
        <span class="hljs-attr">height</span>: <span class="hljs-string">'100vh'</span>,
    },
})
<span class="hljs-keyword">export</span>  <span class="hljs-keyword">default</span>  useStyles;
</code></pre>
<h6 data-id="heading-45">加载页面</h6>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Spin</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"antd"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">PageLoading</span>:<span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>=<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-keyword">const</span> <span class="hljs-attr">contentStyle</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">CSSProperties</span> = {
        <span class="hljs-attr">padding</span>: <span class="hljs-number">50</span>,
        <span class="hljs-attr">background</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.05)'</span>,
        <span class="hljs-attr">borderRadius</span>: <span class="hljs-number">4</span>,
    };

    <span class="hljs-keyword">return</span> (

        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
                <span class="hljs-attr">height:</span> "<span class="hljs-attr">100vh</span>", // <span class="hljs-attr">占满视口高度</span>
                <span class="hljs-attr">display:</span> "<span class="hljs-attr">flex</span>", // <span class="hljs-attr">启用</span> <span class="hljs-attr">flex</span> <span class="hljs-attr">布局</span>
                <span class="hljs-attr">justifyContent:</span> "<span class="hljs-attr">center</span>", // <span class="hljs-attr">水平居中</span>
                <span class="hljs-attr">alignItems:</span> "<span class="hljs-attr">center</span>", // <span class="hljs-attr">垂直居中</span>
                <span class="hljs-attr">flexDirection:</span> "<span class="hljs-attr">column</span>", // <span class="hljs-attr">子元素纵向排列</span>
                <span class="hljs-attr">backgroundColor:</span> "#<span class="hljs-attr">f0f2f5</span>", // <span class="hljs-attr">设置背景色</span>，<span class="hljs-attr">与</span> <span class="hljs-attr">antd</span> <span class="hljs-attr">默认一致</span>（<span class="hljs-attr">可选</span>）
            }}
        &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Spin</span> <span class="hljs-attr">tip</span>=<span class="hljs-string">"Loading"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{contentStyle}/</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Spin</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">PageLoading</span>;
</code></pre>
<h4 data-id="heading-46">全局样式</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//删除index.css,App.css文件</span>
<span class="hljs-comment">//AppServer\react-web\src\styles</span>
<span class="hljs-comment">//AppServer\react-web\src\styles\GlobalStyle.ts</span>


<span class="hljs-keyword">import</span> { createGlobalStyle } <span class="hljs-keyword">from</span> <span class="hljs-string">"antd-style"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">GlobalStyle</span> = <span class="hljs-title function_">createGlobalStyle</span>(
    <span class="hljs-function">(<span class="hljs-params">{ theme }</span>) =&gt;</span> <span class="hljs-string">`
html,body{
    height:100%;
    width:100%;
    background-color:<span class="hljs-subst">${theme.colorBgLayout}</span>;
}
body{
margin:0;
}
`</span>,
);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">GlobalStyle</span>;
</code></pre>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> <span class="hljs-title class_">App</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">StrictMode</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">PageLoading</span>/&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">RouterProvider</span> <span class="hljs-attr">router</span>=<span class="hljs-string">{MainRouter}/</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">GlobalStyle</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">StrictMode</span>&gt;</span></span>
    )
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>
</code></pre>
<h4 data-id="heading-47">页面布局</h4>
<h5 data-id="heading-48">添加业务路由</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {lazy} <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">WindowsFilled</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@ant-design/icons"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">MenuDataItem</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"@ant-design/pro-components"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Navigate</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router-dom"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ServiceRouters</span>: <span class="hljs-title class_">MenuDataItem</span>[] = [
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">"dashboard"</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">"主页"</span>,
        <span class="hljs-attr">element</span>: <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"../view/ServerAppPages/Dashboard"</span>))),
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">"systemManager"</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">"系统管理"</span>,
        <span class="hljs-attr">icon</span>: <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">WindowsFilled</span>),
        <span class="hljs-attr">children</span>: [
            {
                <span class="hljs-attr">path</span>: <span class="hljs-string">"ChangeLogs"</span>,
                <span class="hljs-attr">name</span>: <span class="hljs-string">"更新日志"</span>,
                <span class="hljs-attr">element</span>: (
                    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"../view/ServerAppPages/ChangeLogs"</span>)))
                ),
            }
        ]
    },
    { <span class="hljs-comment">//页面重定向</span>
        <span class="hljs-attr">index</span>:<span class="hljs-literal">true</span>,
        <span class="hljs-title class_">Component</span>: <span class="hljs-function">() =&gt;</span>
            <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">Navigate</span>, {
                <span class="hljs-attr">to</span>: <span class="hljs-string">"/dashboard"</span>,
            }),
    },
];

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">ServiceRouters</span>;

</code></pre>
<h5 data-id="heading-49">ProLayout</h5>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">//https://procomponents.ant.design/components/layout</span>

<span class="hljs-keyword">import</span> {
    <span class="hljs-title class_">LogoutOutlined</span>
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/icons'</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">PageContainer</span>, <span class="hljs-title class_">ProSettings</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-components'</span>;
<span class="hljs-keyword">import</span> {
    <span class="hljs-title class_">ProLayout</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@ant-design/pro-components'</span>;
<span class="hljs-keyword">import</span> {
    <span class="hljs-title class_">Button</span>,
    <span class="hljs-title class_">Dropdown</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HeartSvg</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../../../../public/log.svg"</span>;
<span class="hljs-keyword">import</span> {<span class="hljs-title class_">Link</span>, <span class="hljs-title class_">Outlet</span>, useLocation, useNavigate} <span class="hljs-keyword">from</span> <span class="hljs-string">"react-router-dom"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {<span class="hljs-title class_">Suspense</span>, useState} <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">PageLoading</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../../System/PageLoading"</span>;
<span class="hljs-keyword">import</span> serviceRouters <span class="hljs-keyword">from</span> <span class="hljs-string">"@/router/ServiceRouters.ts"</span>;


<span class="hljs-keyword">const</span> <span class="hljs-title class_">Layout</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> [settings] = useState&lt;<span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">ProSettings</span>&gt;&gt;({
        <span class="hljs-attr">fixSiderbar</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">layout</span>: <span class="hljs-string">"mix"</span>,
        <span class="hljs-attr">splitMenus</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">navTheme</span>: <span class="hljs-string">"light"</span>,
        <span class="hljs-attr">contentWidth</span>: <span class="hljs-string">"Fluid"</span>,
        <span class="hljs-attr">colorPrimary</span>: <span class="hljs-string">"#FAAD14"</span>,
        <span class="hljs-attr">siderMenuType</span>: <span class="hljs-string">"sub"</span>,
        <span class="hljs-attr">fixedHeader</span>: <span class="hljs-literal">true</span>,
    });
    <span class="hljs-keyword">const</span> username =<span class="hljs-string">"admin"</span>;
    <span class="hljs-keyword">const</span> navigate = <span class="hljs-title function_">useNavigate</span>();
    <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ProLayout</span>
            {<span class="hljs-attr">...settings</span>} //<span class="hljs-attr">设置属性样式配置</span>
            <span class="hljs-attr">logo</span>=<span class="hljs-string">{</span>
                &lt;<span class="hljs-attr">img</span>
                    <span class="hljs-attr">src</span>=<span class="hljs-string">{HeartSvg}</span>
                    <span class="hljs-attr">alt</span>=<span class="hljs-string">"logo"</span>
                    <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
                        <span class="hljs-attr">height:</span> <span class="hljs-attr">24</span>,
                        <span class="hljs-attr">width:</span> "<span class="hljs-attr">auto</span>",
                        <span class="hljs-attr">objectFit:</span> "<span class="hljs-attr">contain</span>",
                        <span class="hljs-attr">verticalAlign:</span> "<span class="hljs-attr">middle</span>",
                    }}
                /&gt;</span>
            }
            title={"博客"}
            menuDataRender={() =&gt; serviceRouters} //传入路由生成侧边菜单栏
            //头部标题，默认antd图标
            //面包屑，根据传递的路由名
            breadcrumbRender={(routes = []) =&gt; {
                return routes.map((route) =&gt; {
                    return {
                        path: route.path,
                        breadcrumbName: route.breadcrumbName,
                    };
                });
            }}
            //左侧边栏样式设置
            siderMenuType={"sub"}
            //左侧边栏底部样式
            menuFooterRender={(props) =&gt; {
                if (props?.collapsed) return undefined;
                return (
                    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">textAlign:</span> '<span class="hljs-attr">center</span>', <span class="hljs-attr">paddingBlockStart:</span> <span class="hljs-attr">12</span> }}&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>© 驰名商标<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                );
            }}
            //目前不明确
            location={location}
            //路由点击事件
            menuItemRender={(item, dom) =&gt; {
                if (item.path) {
                    return <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{</span>`${<span class="hljs-attr">item.path</span>}`}&gt;</span>{dom}<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>;
                }
                return dom;
            }}
        &gt;
            {/* 渲染选中的页面内容 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">PageLoading</span> /&gt;</span>}&gt;
                <span class="hljs-tag">&lt;<span class="hljs-name">PageContainer</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">PageContainer</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">ProLayout</span>&gt;</span></span>
    );
};
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Layout</span>;
</code></pre>
<h5 data-id="heading-50">配置主路由</h5>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MainRouter</span>: <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-keyword">typeof</span> createBrowserRouter&gt; = <span class="hljs-title function_">createBrowserRouter</span>([
    {
        <span class="hljs-attr">path</span>:<span class="hljs-string">"/"</span>,
        <span class="hljs-attr">element</span>: <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"../view/System/Layout"</span>))),
        <span class="hljs-attr">children</span>: serviceRouters
    },
    {
        <span class="hljs-attr">path</span>: <span class="hljs-string">"*"</span>,    <span class="hljs-comment">// 使用path: "*",匹配配置全局404</span>
        <span class="hljs-attr">element</span>: (
            <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"../view/System/NotFound"</span>)))
        ),
    }

]);
                             
                            
</code></pre>
<h5 data-id="heading-51">理解</h5>
<pre><code class="hljs language-tex" lang="tex">应用启动时，通过路由配置以 `path: "/"` 优先加载 `Layout` 组件，作为整体框架的容器。

`Layout` 组件内部预先配置了业务路由（`serviceRouters`），将其转换为侧边栏菜单，侧边栏中的链接如 `&lt;a href="/dashboard"&gt;主页&lt;/a&gt;` 。

用户首次访问 `/` 时，通过路由重定向跳转到 `/dashboard`，确保进入系统后默认显示主页内容。

整体流程是：`Layout` 负责框架结构（侧边栏、头部、页脚），业务路由负责具体页面内容渲染，实现了框架与业务的分离与解耦。

应用挂载点只挂载全局路由配置，维护简洁，易于扩展和维护，以此分开主路由和业务路由
</code></pre>
<h4 data-id="heading-52">拓展</h4>
<h5 data-id="heading-53">路径优化</h5>
<blockquote>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fvite-tsconfig-paths" target="_blank" title="https://www.npmjs.com/package/vite-tsconfig-paths" ref="nofollow noopener noreferrer"><code>vite-tsconfig-paths</code></a></strong></p>
</blockquote>
<p>它的作用就是：
<strong>自动读取你的 <code>tsconfig.json</code> 或 <code>jsconfig.json</code> 里的路径别名配置</strong>，并在 Vite 中生效，无需手动在 <code>vite.config.ts</code> 中写 <code>alias</code>！</p>
<pre><code class="hljs language-javascript" lang="javascript">效果：
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MainRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../../router/MainRouter.ts"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">MainRouter</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@/router/MainRouter.ts"</span>;
</code></pre>
<ol>
<li>安装依赖</li>
</ol>
<pre><code class="hljs language-css" lang="css">npm install vite-tsconfig-paths <span class="hljs-attr">--save-dev</span>
</code></pre>
<ol start="2">
<li>配置 vite.config.ts</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>;
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react'</span>;
<span class="hljs-keyword">import</span> tsconfigPaths <span class="hljs-keyword">from</span> <span class="hljs-string">'vite-tsconfig-paths'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">react</span>(),
    <span class="hljs-title function_">tsconfigPaths</span>(), <span class="hljs-comment">// 👈 自动读取 tsconfig.json 中的 paths</span>
  ],
});
</code></pre>
<ol start="3">
<li>设置 tsconfig.json 中的路径别名</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// tsconfig.app.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
   
    <span class="hljs-comment">//引用路径替代</span>
    <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"."</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 设置基准路径为项目根目录</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"@/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/*"</span><span class="hljs-punctuation">]</span>  <span class="hljs-comment">// 现在可以工作</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>优点</p>
<ul>
<li>不需要手动写 <code>resolve.alias</code>。</li>
<li>支持多个别名，如 <code>"@components/*": ["src/components/*"]</code>。</li>
<li>和 <code>tsc</code> / IDE / ESLint / Jest 保持一致性。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub Fork 协作完整流程]]></title>    <link>https://juejin.cn/post/7592887786967466020</link>    <guid>https://juejin.cn/post/7592887786967466020</guid>    <pubDate>2026-01-09T08:17:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592887786967466020" data-draft-id="7592887786967416868" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub Fork 协作完整流程"/> <meta itemprop="keywords" content="前端,Git,前端工程化"/> <meta itemprop="datePublished" content="2026-01-09T08:17:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="眯眼因为很困啦"/> <meta itemprop="url" content="https://juejin.cn/user/2718423318278718"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub Fork 协作完整流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2718423318278718/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    眯眼因为很困啦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T08:17:17.000Z" title="Fri Jan 09 2026 08:17:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">GitHub Fork 协作完整流程</h2>
<blockquote>
<p>适用于：开源项目二次开发、插件扩展、给上游项目提交 PR（Pull Request）</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">一、Fork 是什么？</h3>
<p>Fork 是把别人的 GitHub 仓库复制一份到你自己的账号下：</p>
<pre><code class="hljs">原仓库（upstream） → 你的仓库（origin）
</code></pre>
<p>你在自己的仓库里可以随意修改代码，而不会影响原项目。</p>
<hr/>
<h3 data-id="heading-2">二、整体协作流程</h3>
<pre><code class="hljs language-css" lang="css">flowchart <span class="hljs-selector-tag">TD</span>
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[原项目 GitHub 仓库]</span> --&gt;|Fork| <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[你自己的 GitHub 仓库]</span>
    <span class="hljs-selector-tag">B</span> --&gt;|git clone| C<span class="hljs-selector-attr">[你的本地仓库]</span>
    <span class="hljs-selector-tag">A</span> --&gt;|git fetch upstream| C
    C --&gt;|git merge upstream/<span class="hljs-selector-tag">main</span>| C
    C --&gt;|git push origin| <span class="hljs-selector-tag">B</span>
    <span class="hljs-selector-tag">B</span> --&gt;|Pull Request| <span class="hljs-selector-tag">A</span>
</code></pre>
<hr/>
<h3 data-id="heading-3">三、Fork 项目（网页操作）</h3>
<ol>
<li>
<p>打开你要 Fork 的仓库，例如：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">https:</span>//github.com/vercel/<span class="hljs-keyword">next</span>.js
</code></pre>
</li>
<li>
<p>点击右上角 <strong>Fork</strong></p>
</li>
<li>
<p>选择你的 GitHub 账号</p>
</li>
<li>
<p>得到你的仓库：</p>
<pre><code class="hljs language-bash" lang="bash">https://github.com/你的用户名/next.js
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-4">四、Clone 到本地</h3>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/你的用户名/next.js.git
<span class="hljs-built_in">cd</span> next.js
</code></pre>
<hr/>
<h3 data-id="heading-5">五、配置 upstream（非常重要）</h3>
<p>查看当前远程仓库：</p>
<pre><code class="hljs">git remote -v
</code></pre>
<p>你会看到：</p>
<pre><code class="hljs language-bash" lang="bash">origin https://github.com/你的用户名/next.js.git
</code></pre>
<p>添加原仓库：</p>
<pre><code class="hljs language-csharp" lang="csharp">git remote <span class="hljs-keyword">add</span> upstream https:<span class="hljs-comment">//github.com/vercel/next.js.git</span>
</code></pre>
<p>再确认：</p>
<pre><code class="hljs">git remote -v
</code></pre>
<p>应该是：</p>
<pre><code class="hljs">origin   你自己的仓库
upstream 原项目仓库
</code></pre>
<hr/>
<h3 data-id="heading-6">六、同步原项目最新代码（标准流程）</h3>
<pre><code class="hljs language-css" lang="css">git checkout <span class="hljs-selector-tag">main</span>
git fetch upstream
git merge upstream/<span class="hljs-selector-tag">main</span>
git push origin <span class="hljs-selector-tag">main</span>
</code></pre>
<p>含义：</p>
<blockquote>
<p>用原作者的 main 更新你的 main，并推送到你自己的 GitHub</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">七、开发你的功能</h3>
<pre><code class="hljs language-perl" lang="perl">git checkout -b <span class="hljs-keyword">my</span>-feature
<span class="hljs-comment"># 修改代码</span>
git add .
git commit -m <span class="hljs-string">"Add my feature"</span>
git <span class="hljs-keyword">push</span> origin <span class="hljs-keyword">my</span>-feature
</code></pre>
<hr/>
<h3 data-id="heading-8">八、提交 Pull Request</h3>
<ol>
<li>
<p>打开你的 GitHub 仓库</p>
</li>
<li>
<p>GitHub 会提示：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">Compare</span> &amp; Pull Request
</code></pre>
</li>
<li>
<p>点击并填写说明</p>
</li>
<li>
<p>提交 → 原项目维护者审核</p>
</li>
</ol>
<hr/>
<h3 data-id="heading-9">九、为什么必须使用 upstream？</h3>

















<table><thead><tr><th>远程名</th><th>作用</th></tr></thead><tbody><tr><td>origin</td><td>你自己的 GitHub 仓库</td></tr><tr><td>upstream</td><td>原作者的 GitHub 仓库</td></tr></tbody></table>
<p>你只向 origin push，但要从 upstream 获取最新版本。</p>
<hr/>
<h3 data-id="heading-10">十、fetch vs merge 的正确用法</h3>
<pre><code class="hljs language-rust" lang="rust">sequenceDiagram
    participant U <span class="hljs-keyword">as</span> GitHub upstream
    participant L <span class="hljs-keyword">as</span> Local Repo
    participant O <span class="hljs-keyword">as</span> GitHub origin

    U<span class="hljs-punctuation">-&gt;</span>&gt;L: git fetch upstream
    L<span class="hljs-punctuation">-&gt;</span>&gt;L: upstream/main 更新
    L<span class="hljs-punctuation">-&gt;</span>&gt;L: git merge upstream/main
    L<span class="hljs-punctuation">-&gt;</span>&gt;O: git push origin main
</code></pre>
<ul>
<li><code>fetch</code> = 下载真实世界</li>
<li><code>merge</code> = 使用真实世界</li>
</ul>
<p>永远不要跳过 fetch。</p>
<hr/>
<h3 data-id="heading-11">十一、错误示例（不要这样）</h3>
<pre><code class="hljs language-bash" lang="bash">git merge upstream/main   <span class="hljs-comment"># ❌ 如果你没先 fetch</span>
</code></pre>
<p>你合并的可能是 <strong>几个月前缓存的 upstream</strong>，非常危险。</p>
<hr/>
<h3 data-id="heading-12">十二、最佳实践总结</h3>
<blockquote>
<p>Fork 项目的生存法则</p>
</blockquote>
<pre><code class="hljs language-sql" lang="sql">只向 origin 写代码  
只从 upstream 读更新  
<span class="hljs-keyword">fetch</span> 在前，<span class="hljs-keyword">merge</span> 在后
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀 React Router 7 + Vercel 部署全指南]]></title>    <link>https://juejin.cn/post/7593077945015779355</link>    <guid>https://juejin.cn/post/7593077945015779355</guid>    <pubDate>2026-01-09T08:20:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593077945015779355" data-draft-id="7592992745574465574" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀 React Router 7 + Vercel 部署全指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-09T08:20:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="whisper"/> <meta itemprop="url" content="https://juejin.cn/user/2814366169706040"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀 React Router 7 + Vercel 部署全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2814366169706040/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    whisper
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T08:20:16.000Z" title="Fri Jan 09 2026 08:20:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、 开发环境准备 (本地)</h3>
<ol>
<li><strong>推荐包管理器</strong>：使用 <code>pnpm</code> 替代 <code>npm</code> 以获得更快的构建速度和更清晰的依赖管理。</li>
</ol>
<p>如果已经使用npm构建，那么先删掉node_modules文件夹，安装pnpm</p>
<pre><code class="hljs">pnpm install
</code></pre>
<ol start="2">
<li><strong>Node.js 版本限制</strong>：</li>
</ol>
<p>在 <code>package.json</code> 中显式指定：</p>
<ul>
<li>
<ul>
<li>JSON</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"engines"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"20.x"</span> <span class="hljs-punctuation">}</span>
</code></pre>
<ol start="3">
<li><strong>静态模式配置 (SPA)</strong> ：</li>
</ol>
<p>若不需要 SSR（服务端渲染），在 <code>react-router.config.ts</code> 中设置：</p>
<ul>
<li>
<ul>
<li>TypeScript</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> { ssr: <span class="hljs-literal">false</span> } satisfies Config;
</code></pre>
<ol start="4">
<li><strong>关联github及vercel</strong></li>
</ol>
<p>本地代码提交到github，同时登录vercel平台，将vercel与github关联上，后续你在本地改动了代码并提交到github后，访问vercel平台的项目域名就能看到改动的内容了</p>
<hr/>
<h3 data-id="heading-1">二、 静态资源与图标 (Icon)</h3>
<ol>
<li><strong>文件存放</strong>：所有的图片、SVG 图标必须放在根目录的 <code>public/</code> 文件夹下。</li>
<li><strong>页面引入</strong>：</li>
</ol>
<p>在 <code>app/root.tsx</code> 的 <code>links</code> 函数中配置：</p>
<ul>
<li>
<ul>
<li>TypeScript</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">export const links: <span class="hljs-attr">LinksFunction</span> = () =&gt; [
  { rel: <span class="hljs-string">"icon"</span>, type: <span class="hljs-string">"image/svg+xml"</span>, href: <span class="hljs-string">"/logo.svg"</span> },
]<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">三、 Vercel 部署关键点 (最重要)</h3>
<p>如果你遇到 <code>now-php</code> 或 <code>Function Runtimes</code> 报错，请检查以下配置：</p>
<p><code>vercel.json</code> <strong>配置</strong>（强制静态重写，防止 404）：</p>
<ol>
<li>JSON</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"rewrites"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/(.*)"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/"</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="2">
<li><strong>Vercel 后台设置</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li><strong>Framework Preset</strong>: 优先选择 <code>Vite</code>；如果被锁定为 <code>React Router</code>，请确保手动开启 <strong>Build and Output Settings</strong>。</li>
<li><strong>Build Command</strong>: <code>pnpm build</code></li>
<li><strong>Output Directory</strong>: <code>dist</code>（如果在脚本中手动移动了产物）或 <code>build/client</code>。</li>
<li><strong>Install Command</strong>: <code>pnpm install</code></li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-3">四、 自定义域名</h3>
<ol>
<li><strong>修改 Vercel 默认域名</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li><code>Settings</code> -&gt; <code>Domains</code> -&gt; <code>Edit</code>，可以直接修改 <code>xxx.vercel.app</code> 的前缀。</li>
</ul>
</li>
</ul>
<ol start="2">
<li><strong>绑定独立域名</strong>：</li>
</ol>
<ul>
<li>
<ul>
<li>在 <code>Domains</code> 页面输入你购买的域名。</li>
<li><strong>DNS 配置</strong>：</li>
</ul>
</li>
</ul>

<ul>
<li>
<ul>
<li>
<ul>
<li><strong>A 记录</strong>：指向 <code>76.76.21.21</code>。</li>
<li><strong>CNAME 记录</strong>：指向 <code>cname.vercel-dns.com</code>。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">💡 核心避坑心得</h3>
<ul>
<li><strong>清理缓存</strong>：部署报错时，尝试删除 Vercel 项目重新导入，并确保 <code>pnpm-lock.yaml</code> 是最新的。</li>
<li><strong>路径大小写</strong>：Vercel 的 Linux 环境对文件名大小写敏感，确保 <code>import</code> 路径与文件名完全一致。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从vue3 watch开始理解Vue的响应式原理]]></title>    <link>https://juejin.cn/post/7592922036093222927</link>    <guid>https://juejin.cn/post/7592922036093222927</guid>    <pubDate>2026-01-09T08:23:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592922036093222927" data-draft-id="7592939457043529780" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从vue3 watch开始理解Vue的响应式原理"/> <meta itemprop="keywords" content="Vue.js,前端"/> <meta itemprop="datePublished" content="2026-01-09T08:23:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="徐徐子"/> <meta itemprop="url" content="https://juejin.cn/user/1724455245584872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从vue3 watch开始理解Vue的响应式原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1724455245584872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    徐徐子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T08:23:32.000Z" title="Fri Jan 09 2026 08:23:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">从vue3 watch开始理解Vue的响应式原理</h2>
<h3 data-id="heading-1">前言</h3>
<p>vue源代码的内容非常之多，包括模板解析（把vue文件的写法解析成一个函数用来插入dom或者调整dom），依赖收集，响应式，事件处理，插槽，组件，指令，等等等。刚开始看时不知道从何看起，这里分享一个个人的学习思路，我们可以从一些关键的api开始逐步学习，这里推荐 reactive，watch。明白了这两个api时如何工作的，那vue的响应式系统就基本理解了。</p>
<h3 data-id="heading-2">let`s start</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// demo.js</span>
<span class="hljs-keyword">import</span> { reactive, watch } <span class="hljs-keyword">from</span> <span class="hljs-string">'./vue-core.js'</span>
<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>
})
<span class="hljs-title function_">watch</span>(user, <span class="hljs-function">(<span class="hljs-params">newValue, oldValue</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(
    <span class="hljs-string">`User changed from <span class="hljs-subst">${oldValue.name}</span>,<span class="hljs-subst">${oldValue.age}</span> to <span class="hljs-subst">${newValue.name}</span>,<span class="hljs-subst">${newValue.age}</span>`</span>
  )
})
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  user.<span class="hljs-property">name</span> = <span class="hljs-string">'Bob'</span>
  user.<span class="hljs-property">age</span> = <span class="hljs-number">30</span>
}, <span class="hljs-number">1000</span>)

</code></pre>
<p>朴素的示例，如果user发生了变化。那么就会触发watch的回调。脱离vue框架，我们需要如何设计呢，首先想到的简单逻辑就是拦截user的set和get。无论是通过Proxy还是Object的set，原理是一样的。</p>
<pre><code class="hljs language-vue-core.js" lang="vue-core.js">let activeSub = null // 当前活跃的订阅者
const targetMap = new WeakMap()

export function reactive(obj) {
  return new Proxy(obj, {
    get(target, key, receiver) {
      track(target, key)
      return Reflect.get(target, key, receiver)
    },
    set(target, key, value, receiver) {
      const res = Reflect.set(target, key, value, receiver)
      trigger(target, key)
      return res
    }
  })
}
// 简化版watch实现,只考虑监听一个reactive对象（类似上面的user例子）的变化
export function watch(source, cb) {
  const getter = () =&gt; {
    for (const key in source) {
      source[key]
    }
    return source
  }
  let oldValue
  const effect = new ReactiveEffect(getter)
  const job = () =&gt; {
    const newValue = effect.run()
    //todo 对比newValue和oldValue是否有变化
    cb(newValue, oldValue)
    oldValue = newValue
  }
  effect.schedule = job
  oldValue = effect.run()
  console.log('old', oldValue)
}

// 示例解释：搜集user中每个key的下游依赖，当user的name或age变化时，触发对应的依赖更新，从而调用watch的回调函数。
function track(target, key) {
  let depsMap = targetMap.get(target)
  if (!depsMap) {
    targetMap.set(target, (depsMap = new Map()))
  }
  let dep = depsMap.get(key)
  if (!dep) {
    depsMap.set(key, (dep = new Dep()))
  }
  dep.track()
}
function trigger(target, key) {
  const depsMap = targetMap.get(target)
  if (!depsMap) return
  const dep = depsMap.get(key)
  if (dep) {
    dep.trigger()
  }
}

function Dep() {
  this.subs = new Set()
  this.track = () =&gt; {
    // 借助全局变量activeSub记录当前活跃的订阅者
    if (activeSub) {
      this.subs.add(activeSub)
    }
  }
  this.trigger = () =&gt; {
    this.subs.forEach((sub) =&gt; {
      sub.notify()
    })
  }
}

function ReactiveEffect(fn) {
  this.fn = fn
  this.notify = null // 回调函数, 可类比于watch的cb用来辅助理解
  this.schedule = null
  this.run = () =&gt; {
    // 标记当前活跃的订阅者为this 通过fn触发每个ref或者reactive对象的getter
    // 从而触发track函数，将当前活跃的订阅者this添加到dep的subs中
    const preActiveSub = activeSub
    activeSub = this
    const value = this.fn()
    activeSub = preActiveSub
    return value
  }
  // 上游的ref或者reactive对象触发setter时，会通过收集者调用trigger函数，从而触发schedule函数，在watch中就是cb函数
  this.trigger = () =&gt; {
    this.schedule?.()
  }
  this.notify = () =&gt; {
    this.trigger()
  }
}


</code></pre>
<p>从上面的demo中我们初步实现了user变动时调用一个回调，deps表示“依赖”，通俗的理解就是有多少个下游正在依赖user，例如computed，watch，render函数等等这些的最终结果都是根据上游来变动的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ea5b4ca808c4f92ad4f667b53d72641~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6Q5b6Q5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768551812&amp;x-signature=zZe3IG9xoTjpn77lYac00AbsKMQ%3D" alt="3a7131ea44dd9bfb4726e7f3af8f988ce8045f8de77b904d636c9d9b0ff74207.png" loading="lazy"/></p>
<p>这里面其实就两个概念需要理解，一个是依赖收集者 Dep，一个是响应副作用管理器 ReactiveEffect。借助例子，Dep 理解为用来管理user中每个key都有哪些watch正在监听。而 ReactiveEffect 理解为当user的某个key发生变化时，需要调用哪些watch的回调函数。</p>
<p>调用watch的过程其实关注的就是  oldValue = effect.run() 这一段代码。在创建watch时，会立即调用effect.run()，从而触发user的getter，从而触发track函数，将当前活跃的订阅者effect添加到user.name和user.age的dep中。这样，当user.name或user.age发生变化时，就会触发trigger函数，从而调用effect的notify函数，从而调用watch的回调函数。</p>
<p>组件渲染其实就是一个特殊的watch，watch的回调函数就是渲染函数。当user的name或age发生变化时，就会触发渲染函数，从而更新dom。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Electron 写了一个 macOS 版本的 wallpaper（附源码、下载地址）]]></title>    <link>https://juejin.cn/post/7592939457043726388</link>    <guid>https://juejin.cn/post/7592939457043726388</guid>    <pubDate>2026-01-09T08:46:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592939457043726388" data-draft-id="7592939457043349556" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Electron 写了一个 macOS 版本的 wallpaper（附源码、下载地址）"/> <meta itemprop="keywords" content="前端,Electron,Vue.js"/> <meta itemprop="datePublished" content="2026-01-09T08:46:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="musashi"/> <meta itemprop="url" content="https://juejin.cn/user/4072246799240072"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Electron 写了一个 macOS 版本的 wallpaper（附源码、下载地址）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4072246799240072/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    musashi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T08:46:46.000Z" title="Fri Jan 09 2026 08:46:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Mac 上一直未能找到免费且好用的类似 Wallpaper Engine 的动态壁纸软件。所以直接想着自己搞一个。</p>
<p>本文主要记录核心技术点的实现，包括“将窗口置于桌面图标下层”、“多显示器支持”、“系统托盘常驻”。</p>
<p>效果展示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/287c98bf651a4a06934c604bc032785b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbXVzYXNoaQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768553772&amp;x-signature=MvFAzM5UTh1rTEbjQIDdOnbjp84%3D" alt="output.gif" loading="lazy"/></p>
<h2 data-id="heading-0">功能支持</h2>
<ul>
<li><strong>控制中心 (Dashboard)</strong>：提供独立的控制面板，可为每个显示器单独管理壁纸。</li>
<li><strong>丰富的媒体支持</strong>：
<ul>
<li><strong>图片</strong>：支持 JPG, PNG, GIF, WebP 等常见格式。</li>
<li><strong>视频</strong>：支持 MP4, WebM, MKV, MOV (自动静音循环播放)。</li>
<li><strong>HTML</strong>：支持将任意本地 HTML 文件设置为交互式壁纸。</li>
</ul>
</li>
<li><strong>自动保存状态</strong>：应用重启后，自动恢复上次设置的壁纸配置。</li>
<li><strong>历史记录</strong>：自动记录最近使用的壁纸，方便快速切换回之前的喜爱内容。</li>
<li><strong>多显示器支持</strong>：自动检测接入的显示器，并支持多屏独立设置。</li>
<li><strong>在线画廊</strong>：内置在线资源库，可一键下载包括《绝区零》、《原神》、《鸣潮》等热门游戏的高清静态与动态壁纸。</li>
</ul>
<h2 data-id="heading-1">核心技术实现</h2>
<h3 data-id="heading-2">1. 将窗口置于桌面图标下层</h3>
<p>这是最核心的功能。Electron 的 <code>BrowserWindow</code> 提供了一个 <code>type: 'desktop'</code> 属性，在 macOS 上会将窗口置于最底层。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> win = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'desktop'</span>, <span class="hljs-comment">// 关键配置：设置为桌面类型</span>
  <span class="hljs-attr">enableLargerThanScreen</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">frame</span>: <span class="hljs-literal">false</span>,    <span class="hljs-comment">// 无边框</span>
  <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>,     <span class="hljs-comment">// 先隐藏，加载完再显示</span>
  <span class="hljs-attr">webPreferences</span>: {
    <span class="hljs-attr">nodeIntegration</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">contextIsolation</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">webSecurity</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 允许加载本地资源</span>
  }
});
</code></pre>
<p>仅仅这样还不够，为了保证交互体验，我们需要让这个窗口无法被聚焦和移动，像真正的壁纸一样。</p>
<h3 data-id="heading-3">2. 多显示器支持</h3>
<p>现在的开发环境通常都有多个屏幕。通过 Electron 的 <code>screen</code> 模块获取所有显示器，并为每个显示器创建一个独立的 BrowserWindow 实例。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { screen } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'electron'</span>);

<span class="hljs-keyword">const</span> displays = screen.<span class="hljs-title function_">getAllDisplays</span>();

displays.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">display</span>) =&gt;</span> {
  <span class="hljs-title function_">createWallpaperWindow</span>(display);
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">createWallpaperWindow</span>(<span class="hljs-params">display</span>) {
  <span class="hljs-keyword">const</span> { x, y, width, height } = display.<span class="hljs-property">bounds</span>;
  <span class="hljs-keyword">const</span> win = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BrowserWindow</span>({
    x, y, width, height, <span class="hljs-comment">// 填满当前屏幕</span>
    <span class="hljs-comment">// ... 其他配置</span>
  });
  
  <span class="hljs-comment">// 加载资源</span>
  win.<span class="hljs-title function_">loadFile</span>(<span class="hljs-string">'path/to/wallpaper.html'</span>);
}
</code></pre>
<h3 data-id="heading-4">3. 资源获取 (爬虫)</h3>
<p>为了解决壁纸来源问题，内置了一个简单的爬虫（基于 Node.js <code>fetch</code>），抓取米游社等平台的同人图和官方壁纸。</p>
<p>主要难点在于处理接口的 Referer 校验和数据分页。</p>
<h3 data-id="heading-5">4. 甚至支持关闭主窗口后常驻后台</h3>
<p>为了不让应用在关闭设置面板（主窗口）时直接退出，需要利用 <code>Tray</code> 模块和拦截 <code>window-all-closed</code> 事件。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 拦截主窗口关闭事件，改为隐藏</span>
mainWindow.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!app.<span class="hljs-property">isQuitting</span>) {
    event.<span class="hljs-title function_">preventDefault</span>();
    mainWindow.<span class="hljs-title function_">hide</span>();
  }
});

<span class="hljs-comment">// 实现托盘菜单</span>
<span class="hljs-keyword">const</span> tray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tray</span>(iconPath);
<span class="hljs-keyword">const</span> contextMenu = <span class="hljs-title class_">Menu</span>.<span class="hljs-title function_">buildFromTemplate</span>([
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'打开面板'</span>, <span class="hljs-attr">click</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">showMainWindow</span>() },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'退出'</span>, <span class="hljs-attr">click</span>: <span class="hljs-function">() =&gt;</span> {
      app.<span class="hljs-property">isQuitting</span> = <span class="hljs-literal">true</span>;
      app.<span class="hljs-title function_">quit</span>();
    } 
  }
]);
tray.<span class="hljs-title function_">setContextMenu</span>(contextMenu);
</code></pre>
<h2 data-id="heading-6">构建与分发</h2>
<h3 data-id="heading-7">1. 双架构打包</h3>
<p>为了同时支持 M1/M2/M3 (Apple Silicon) 和旧款 Intel Mac，配置了 <code>electron-builder</code> 的 universal 构建或分别构建。</p>
<p><code>package.json</code> 配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-attr">"mac"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"default"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"arch"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"x64"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"arm64"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-8">2. "应用已损坏，无法打开" 的解决</h3>
<p>因为没有购买 Apple 昂贵的开发者证书进行签名，编译出的 <code>.app</code> 在别人的电脑上运行时会被 macOS Gatekeeper 拦截，提示“应用已损坏”。</p>
<p>这是一个常见问题，解决方法是移除苹果的隔离属性。用户需要执行一次终端命令：</p>
<pre><code class="hljs language-bash" lang="bash">sudo xattr -rd com.apple.quarantine /Applications/Wallpaper-Mac.app
</code></pre>
<h2 data-id="heading-9">源码与下载</h2>
<p>项目已开源，虽然功能简单，但足以满足日常动态壁纸需求（支持视频、图片）。</p>
<ul>
<li><strong>GitHub 地址</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzhulinghao%2Fwallpaper-mac" target="_blank" title="https://github.com/zhulinghao/wallpaper-mac" ref="nofollow noopener noreferrer">github.com/zhulinghao/…</a></li>
<li><strong>Release 下载</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzhulinghao%2Fwallpaper-mac%2Freleases%2Ftag%2Fv1.0.0" target="_blank" title="https://github.com/zhulinghao/wallpaper-mac/releases/tag/v1.0.0" ref="nofollow noopener noreferrer">github.com/zhulinghao/…</a></li>
</ul>
<p>欢迎 Star 和 PR。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>