<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[深入理解Python控制流：for/while循环的底层逻辑与最佳实践]]></title>    <link>https://juejin.cn/post/7593240931286335540</link>    <guid>https://juejin.cn/post/7593240931286335540</guid>    <pubDate>2026-01-09T15:33:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593240931286335540" data-draft-id="7593187953272127488" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解Python控制流：for/while循环的底层逻辑与最佳实践"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-09T15:33:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="love_summer"/> <meta itemprop="url" content="https://juejin.cn/user/1462819851084228"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解Python控制流：for/while循环的底层逻辑与最佳实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1462819851084228/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    love_summer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:33:54.000Z" title="Fri Jan 09 2026 15:33:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>【引言】</strong><br/>
在Python代码中，循环可能是最常用但也最容易出错的逻辑。虽然我们每天都在写<code>for i in range(n)</code>，但你真的理解Python中<code>while</code>循环的4个关键步骤吗？为什么<code>for...else</code>这种看似“反直觉”的语法会在Python中存在？本文将结合实战案例，深入探讨Python的循环结构，带你写出更Pythonic、更健壮的代码。</p>
</blockquote>
<h4 data-id="heading-0">一、For 循环：Pythonic 的首选</h4>
<p>在Python中，<code>for</code>循环被称为“遍历循环”。与C/Java中经典的<code>for(int i=0; i&lt;n; i++)</code>不同，Python的<code>for</code>更加抽象，它不依赖索引，而是依赖迭代器协议。</p>
<p><strong>1. 从<code>range()</code>看内存优化</strong></p>
<p><code>range()</code>在Python 3中返回的是一个可迭代对象，而不是列表。这意味着<code>range(1000000)</code>不会在内存中生成一个包含100万个数字的列表，它只在循环时按需生成数字，极大地节省了内存。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 掘金风格代码示例</span>
<span class="hljs-comment"># 计算水仙花数 - 使用生成器思维</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">find_narcissistic_numbers</span>():
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>, <span class="hljs-number">1000</span>):
        <span class="hljs-comment"># 位运算比取模更快，但取模可读性更好</span>
        digits = [<span class="hljs-built_in">int</span>(d) <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>(i)]
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">sum</span>(d ** <span class="hljs-number">3</span> <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> digits) == i:
            <span class="hljs-keyword">yield</span> i  <span class="hljs-comment"># 使用生成器，按需产生结果</span>
<span class="hljs-comment"># 打印结果</span>
<span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> find_narcissistic_numbers():
    <span class="hljs-built_in">print</span>(num)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62184b8bb3ca48e5a3796de816fd1ca0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG92ZV9zdW1tZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577633&amp;x-signature=12%2BEcCRPQu0XTOtc4y%2ForrjjNqg%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-1">二、While 循环：状态机的模拟</h4>
<p><code>while</code>循环在Python中通常用于模拟“状态机”或处理未知循环次数的逻辑。它的核心在于四个步骤，很多初学者的死循环往往是因为漏掉了“改变变量”这一步。</p>
<p><strong>1. 避免“魔术数字”和“死循环”</strong></p>
<p>在编写<code>while</code>循环时，最忌讳的是没有明确的退出条件。参考书中**【示例4-13】**的登录逻辑，我们可以看到使用计数器<code>i</code>来限制尝试次数的重要性。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 重构【示例4-13】，提高可读性</span>
MAX_ATTEMPTS = <span class="hljs-number">3</span>
attempts = <span class="hljs-number">0</span>
<span class="hljs-keyword">while</span> attempts &lt; MAX_ATTEMPTS:
    username = <span class="hljs-built_in">input</span>(<span class="hljs-string">"Username: "</span>)
    password = <span class="hljs-built_in">input</span>(<span class="hljs-string">"Password: "</span>)
    
    <span class="hljs-keyword">if</span> username == <span class="hljs-string">'ysj'</span> <span class="hljs-keyword">and</span> password == <span class="hljs-string">'888888'</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"Login Success"</span>)
        <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 成功即退出</span>
        
    attempts += <span class="hljs-number">1</span>
    remaining = MAX_ATTEMPTS - attempts
    <span class="hljs-keyword">if</span> remaining &gt; <span class="hljs-number">0</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Error. <span class="hljs-subst">{remaining}</span> attempts left."</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># else分支只在循环正常结束（即break未触发）时执行</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Account locked."</span>)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c813d0d3ead42a4a1f3a98d9af0389d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG92ZV9zdW1tZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577633&amp;x-signature=Rq%2BS7jXUoYtxywP4y9Rn9ILu16w%3D" alt="image.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79a11c2c60724b888d8358e084a647f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG92ZV9zdW1tZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577633&amp;x-signature=%2FKJkF6VnLTCpFgqEJ6WMe2mzXis%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p><strong>Tip</strong>: 使用<code>while...else</code>结构可以优雅地处理“循环耗尽仍未成功”的逻辑，避免在循环外再写一次<code>if attempts == MAX_ATTEMPTS</code>的判断。</p>
</blockquote>
<h4 data-id="heading-2">三、嵌套循环：时间复杂度的陷阱</h4>
<p>嵌套循环是算法复杂度的重灾区。书中**【示例4-15/16】**的图形打印是理解嵌套逻辑的绝佳案例，但要注意其时间复杂度。</p>
<ul>
<li>双重循环打印矩形：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo>×</mo><mi>M</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N \times M)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mclose">)</span></span></span></span></span></li>
<li>打印菱形（双层循环）：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>N</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>
在实际开发中，尽量避免超过3层的嵌套循环，否则代码的可读性和性能都会急剧下降。如果遇到复杂图形（如空心菱形），可以考虑使用字符串的<code>center()</code>方法来简化逻辑，或者将图形拆分为上下两个三角形分别处理。</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 简化版：利用字符串操作打印等腰三角形（比双重循环更Pythonic）</span>
row = <span class="hljs-number">5</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, row*<span class="hljs-number">2</span>, <span class="hljs-number">2</span>):
    <span class="hljs-built_in">print</span>((<span class="hljs-string">'*'</span> * i).center(row*<span class="hljs-number">2</span>-<span class="hljs-number">1</span>))
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df788cba1631438daee1260b483545b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbG92ZV9zdW1tZXI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577633&amp;x-signature=t2rUeWLlekYxJn7WsIc9SuZ7t5M%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">四、最佳实践总结</h4>
<ol>
<li><strong>优先使用<code>for</code></strong>：除非必须使用条件判断，否则优先使用<code>for</code>循环，因为它更不易出错。</li>
<li><strong>善用<code>else</code></strong>：不要忽略<code>for...else</code>和<code>while...else</code>，它们可以帮你省去不必要的<code>flag</code>变量。</li>
<li><strong>警惕嵌套</strong>：嵌套循环越深，代码越难维护。思考是否可以通过列表推导式、<code>itertools</code>库或者重构函数来减少嵌套。
希望这些分析能让你对Python的循环结构有更深的理解！</li>
</ol>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端面试加分技巧：文本省略 + Tooltip 优雅实现，附可直接复用代码（求职党必看）]]></title>    <link>https://juejin.cn/post/7593139476840726534</link>    <guid>https://juejin.cn/post/7593139476840726534</guid>    <pubDate>2026-01-09T10:45:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593139476840726534" data-draft-id="7593165280488357929" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端面试加分技巧：文本省略 + Tooltip 优雅实现，附可直接复用代码（求职党必看）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-09T10:45:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="海云前端1"/> <meta itemprop="url" content="https://juejin.cn/user/963618991244365"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端面试加分技巧：文本省略 + Tooltip 优雅实现，附可直接复用代码（求职党必看）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/963618991244365/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    海云前端1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T10:45:21.000Z" title="Fri Jan 09 2026 10:45:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端开发中，<strong>文本溢出处理是高频业务场景</strong> —— 接口返回的内容可能长短不一，固定宽度下过长文本会破坏页面布局，这时候<code>text-overflow: ellipsis</code>省略号样式就成了必备方案。但产品往往会补充需求：用户悬停时能看到完整文本，且未省略时不显示冗余提示。</p>
<p>这个看似简单的交互，实则是面试中常被考察的 “细节实现能力”，也是简历上能体现工程化思维的加分项。</p>
<p>今天就分享一套可直接复用的解决方案，不仅能完美解决  <strong>省略时显示 Tooltip 的核心需求</strong>，还能适配单行 / 多行场景，代码简洁易懂，<strong>面试时聊起这类实操场景，绝对能让面试官眼前一亮</strong></p>
<h2 data-id="heading-0">核心痛点与面试考点</h2>
<p>为什么这个小功能能成为面试加分项？因为它背后考察的是前端工程师的  <strong>场景化解决能力</strong>：</p>
<ul>
<li>如何精准判断文本是否被省略（ scrollWidth/scrollHeight 与 clientWidth/clientHeight 的对比逻辑）；</li>
<li>如何避免无用渲染（未省略时不渲染 Tooltip 组件）；</li>
<li>如何适配响应式场景（窗口缩放时重新检测）；</li>
<li>如何封装可复用逻辑（自定义 Hook + 组件封装思维）。</li>
</ul>
<p>这些考点在中级前端面试中频繁出现，而能拿出完整可运行的代码，再讲清实现思路，比单纯说 我会处理文本溢出 更有说服力。</p>
<h2 data-id="heading-1">完整实现方案</h2>
<h3 data-id="heading-2">第一步：封装核心检测 Hook（useEllipsis.ts）</h3>
<p>首先实现一个自定义 Hook，专门负责检测文本是否被省略，适配单行 / 多行配置：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { useEffect, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 配置项类型定义，支持自定义行数</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">EllipsisOptions</span> = {
  lines?: <span class="hljs-built_in">number</span>;
};

<span class="hljs-comment">// 泛型约束确保ref只绑定HTMLElement元素</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> useEllipsis&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HTMLElement</span>&gt;({
  lines = <span class="hljs-number">1</span>,
}: <span class="hljs-title class_">EllipsisOptions</span> = {}) {
  <span class="hljs-keyword">const</span> targetRef = useRef&lt;T&gt;(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [hasEllipsis, setHasEllipsis] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);

  <span class="hljs-comment">// 核心检测逻辑</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">checkEllipsis</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">const</span> element = targetRef.<span class="hljs-property">current</span>;
    <span class="hljs-keyword">if</span> (!element) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// 单行检测：滚动宽度 &gt; 可视宽度</span>
    <span class="hljs-comment">// 多行检测：滚动高度 &gt; 可视高度</span>
    <span class="hljs-keyword">if</span> (lines === <span class="hljs-number">1</span>) {
      <span class="hljs-title function_">setHasEllipsis</span>(element.<span class="hljs-property">scrollWidth</span> &gt; element.<span class="hljs-property">clientWidth</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">setHasEllipsis</span>(element.<span class="hljs-property">scrollHeight</span> &gt; element.<span class="hljs-property">clientHeight</span>);
    }
  };

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">checkEllipsis</span>();
    <span class="hljs-comment">// 监听窗口缩放，重新检测</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, checkEllipsis);
    <span class="hljs-comment">// 组件卸载时清除监听，避免内存泄漏</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'resize'</span>, checkEllipsis);
  }, [lines]);

  <span class="hljs-keyword">return</span> { targetRef, hasEllipsis };
}
</code></pre>
<h3 data-id="heading-3">第二步：封装业务组件（EllipsisTooltip.tsx）</h3>
<p>结合 UI 库的 Tooltip 组件（这里以 Arco Design 为例，AntD 等其他库可直接替换），封装成通用业务组件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Tooltip</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@arco-design/web-react'</span>;
<span class="hljs-keyword">import</span> { useEllipsis } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useEllipsis'</span>;
<span class="hljs-keyword">import</span> { cn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/lib/utils'</span>; <span class="hljs-comment">// 假设已有样式合并工具函数</span>

<span class="hljs-comment">// 组件Props类型定义，明确入参规范</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">EllipsisTooltipProps</span> = {
  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 要展示的文本</span>
  className?: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 自定义样式</span>
  onClick?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>; <span class="hljs-comment">// 点击事件</span>
  lines?: <span class="hljs-built_in">number</span>; <span class="hljs-comment">// 最大显示行数，默认1行</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">EllipsisTooltip</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">FC</span>&lt;<span class="hljs-title class_">EllipsisTooltipProps</span>&gt; = <span class="hljs-function">(<span class="hljs-params">{
  text,
  className,
  onClick,
  lines = <span class="hljs-number">1</span>,
}</span>) =&gt;</span> {
  <span class="hljs-comment">// 复用Hook获取检测结果</span>
  <span class="hljs-keyword">const</span> { targetRef, hasEllipsis } = useEllipsis&lt;<span class="hljs-title class_">HTMLDivElement</span>&gt;({ lines });

  <span class="hljs-comment">// 动态生成行数样式（适配Tailwind）</span>
  <span class="hljs-keyword">const</span> lineStyle = lines === <span class="hljs-number">1</span> 
    ? <span class="hljs-string">'truncate whitespace-nowrap'</span> 
    : <span class="hljs-string">`line-clamp-<span class="hljs-subst">${lines}</span>`</span>;

  <span class="hljs-comment">// 核心内容节点</span>
  <span class="hljs-keyword">const</span> contentNode = (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
      <span class="hljs-attr">ref</span>=<span class="hljs-string">{targetRef}</span>
      <span class="hljs-attr">className</span>=<span class="hljs-string">{cn(lineStyle,</span> <span class="hljs-attr">className</span>)}
      <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span>
    &gt;</span>
      {text}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );

  <span class="hljs-comment">// 关键优化：只有文本被省略时才渲染Tooltip</span>
  <span class="hljs-keyword">return</span> hasEllipsis ? <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Tooltip</span> <span class="hljs-attr">content</span>=<span class="hljs-string">{text}</span>&gt;</span>{contentNode}<span class="hljs-tag">&lt;/<span class="hljs-name">Tooltip</span>&gt;</span></span> : contentNode;
};
</code></pre>
<h3 data-id="heading-4">第三步：实际使用示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">DemoPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 模拟长文本和短文本场景</span>
  <span class="hljs-keyword">const</span> longText = <span class="hljs-string">'这是一段非常长的文本内容，实际开发中可能来自接口返回，长度不确定需要自适应处理'</span>;
  <span class="hljs-keyword">const</span> shortText = <span class="hljs-string">'简短文本（不显示Tooltip）'</span>;

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"p-4"</span>&gt;</span>
      {/* 单行省略：宽度28rem，超出显示Tooltip */}
      <span class="hljs-tag">&lt;<span class="hljs-name">EllipsisTooltip</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-28 mb-4 inline-block"</span> <span class="hljs-attr">text</span>=<span class="hljs-string">{longText}</span> /&gt;</span>
      {/* 多行省略：最多2行，超出显示Tooltip */}
      <span class="hljs-tag">&lt;<span class="hljs-name">EllipsisTooltip</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"w-40 mb-4 inline-block"</span> <span class="hljs-attr">text</span>=<span class="hljs-string">{longText}</span> <span class="hljs-attr">lines</span>=<span class="hljs-string">{2}</span> /&gt;</span>
      {/* 未省略：不渲染Tooltip */}
      <span class="hljs-tag">&lt;<span class="hljs-name">EllipsisTooltip</span> <span class="hljs-attr">text</span>=<span class="hljs-string">{shortText}</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-5">面试高频追问与应答思路</h2>
<p>掌握这个实现后，遇到相关面试题再也不用慌，这些追问可以这样答：</p>
<ol>
<li>问：如何判断文本是否被省略？<strong>答：单行通过对比元素的<code>scrollWidth</code>（内容实际宽度）和<code>clientWidth</code>（元素可视宽度），多行则对比<code>scrollHeight</code>和<code>clientHeight</code>，当实际尺寸大于可视尺寸时，说明文本被省略。</strong></li>
<li>问：为什么要监听 window.resize 事件？<strong>答：响应式场景下，窗口缩放会导致元素可视尺寸变化，原本未省略的文本可能被截断，原本省略的文本可能完全显示，因此需要重新检测更新状态。</strong></li>
<li>：组件优化点有哪些？<strong>答：① 懒渲染：未省略时不渲染 Tooltip 组件，减少 DOM 节点；② 清除监听：组件卸载时移除 resize 事件，避免内存泄漏；③ 类型约束：用 TypeScript 明确 Props 和 Hook 返回值类型，提升代码健壮性。</strong></li>
</ol>
<p>这些应答思路，正是面试官想看到的 工程化思维,  不仅能实现功能，还能考虑边界情况和性能优化。</p>
<h2 data-id="heading-6">求职党注意：这个技能如何转化为 offer？</h2>
<p>前端求职中，“能落地的实操技能” 比空泛的 “熟悉 React/Vue” 更有竞争力。这个文本省略 + Tooltip 的实现，你可以这样用在求职中：</p>
<ul>
<li><strong>简历亮点</strong>：在 “项目经验” 中补充 “封装通用文本处理组件，适配单行 / 多行场景，减少冗余代码 30%”；</li>
<li><strong>面试实操</strong>：当面试官问 “如何处理文本溢出并显示完整内容” 时，直接打开代码片段讲解实现逻辑，展示你的编码规范和问题解决能力；</li>
<li><strong>项目复盘</strong>：结合这个组件，聊你在实际项目中如何 “识别重复场景→封装通用组件→提升团队开发效率”，体现你的协作和工程化能力。</li>
</ul>
<p>但很多同学在求职中会遇到：明明掌握了这些技能，却不知道如何在简历中呈现、面试时如何表达才能打动面试官？甚至拿到面试机会后，面对算法题、项目深挖、HR 面等环节手足无措？</p>
<p>如果你正处于前端求职瓶颈期 —— 投简历石沉大海、面试屡面屡挂、不知道自己的短板在哪里，不妨试试我的「前端简历面试辅导 + 求职陪跑」服务：</p>
<ul>
<li>简历精修：结合你的项目经验，提炼核心亮点，让 HR 一眼看到你的价值；</li>
<li>面试辅导：针对性讲解高频面试题、算法题拆解、项目深挖技巧，模拟真实面试场景；</li>
<li>求职陪跑：从投递策略、笔试辅导到 offer 谈判，全程 1v1 指导，帮你避开求职坑，高效拿到心仪 offer。</li>
</ul>
<p>已经帮助 50 + 前端同学突破求职瓶颈，拿到字节、阿里、腾讯、美团等大厂及独角兽公司 offer，平均薪资提升 20%+。如果你想少走弯路，快速上岸</p>
<p>购买前端面试题、报名前端简历面试辅导、前端求职陪跑：<a href="https://link.juejin.cn?target=https%3A%2F%2Fb23.tv%2Fmevanxn" target="_blank" title="https://b23.tv/mevanxn" ref="nofollow noopener noreferrer">b23.tv/mevanxn</a></p>
<p>视频主页：<a href="https://link.juejin.cn?target=https%3A%2F%2Fb23.tv%2F3PhcsDI" target="_blank" title="https://b23.tv/3PhcsDI" ref="nofollow noopener noreferrer">b23.tv/3PhcsDI</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Zustand 从入门到精通：我的工程实践笔记]]></title>    <link>https://juejin.cn/post/7593193235250970676</link>    <guid>https://juejin.cn/post/7593193235250970676</guid>    <pubDate>2026-01-09T10:52:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593193235250970676" data-draft-id="7593173569871593524" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Zustand 从入门到精通：我的工程实践笔记"/> <meta itemprop="keywords" content="前端,性能优化"/> <meta itemprop="datePublished" content="2026-01-09T10:52:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="triumph_passion"/> <meta itemprop="url" content="https://juejin.cn/user/4484269938844096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Zustand 从入门到精通：我的工程实践笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4484269938844096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    triumph_passion
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T10:52:59.000Z" title="Fri Jan 09 2026 10:52:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Zustand 从入门到精通：我的工程实践笔记</h2>
<p><strong>目标读者</strong>：已经会用 Zustand，但想把它用得"稳"和"可演进"的 React 开发者</p>
<hr/>
<h3 data-id="heading-1">引言</h3>
<p>我写这份笔记的目的很简单：把 Zustand 从"会用"推进到"用得稳、用得可演进"。
我不会在这里重复 API 文档式的讲解，而是用一个完整的 Todo Demo，把我认为最重要的工程实践串起来：<strong>订阅边界、actions/state 分离、persist 的坑、派生状态（computed）怎么做，以及为什么我尽量不用 useShallow。</strong></p>
<p>Zustand 的 API 文档很简单，几行代码就能跑起来。但在真实项目中，如何组织 store？如何避免不必要的重渲染？持久化有哪些坑？派生状态怎么做？</p>
<p>我用一个完整的 Todo Demo，把这些问题串起来，分享一套在项目中验证过的最佳实践。</p>
<hr/>
<h3 data-id="heading-2">1. 我最终的 Demo（你可以直接跑）</h3>
<blockquote>
<p>这份代码是"我认为比较稳"的 Zustand 用法：</p>
<ul>
<li>组件只订阅自己需要的数据</li>
<li>actions/state 分离</li>
<li>persist 只持久化纯数据（避免函数丢失）</li>
<li>派生值用 selector 直接订阅（类似 Vue computed 的效果）</li>
<li>表单用 react-hook-form + zod</li>
</ul>
</blockquote>
<h4 data-id="heading-3">0.1 <code>useTodoStore.ts</code>（Zustand store）</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;
<span class="hljs-keyword">import</span> { persist } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand/middleware'</span>;
<span class="hljs-keyword">import</span> { immer } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand/middleware/immer'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TodoState</span> {
  <span class="hljs-attr">todos</span>: <span class="hljs-title class_">Todo</span>[];
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">TodoActions</span> {
  <span class="hljs-attr">addTodo</span>: <span class="hljs-function">(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">toggleTodo</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">removeTodo</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">clearCompleted</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoStore</span> = <span class="hljs-title class_">TodoState</span> &amp; { <span class="hljs-attr">actions</span>: <span class="hljs-title class_">TodoActions</span> };

<span class="hljs-keyword">const</span> useTodoStore = create&lt;<span class="hljs-title class_">TodoStore</span>&gt;()(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-title function_">immer</span>(<span class="hljs-function"><span class="hljs-params">set</span> =&gt;</span> ({
      <span class="hljs-attr">todos</span>: [],
      <span class="hljs-attr">actions</span>: {
        <span class="hljs-attr">addTodo</span>: <span class="hljs-function">(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt;</span>
          <span class="hljs-title function_">set</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> {
            state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">push</span>({
              <span class="hljs-attr">id</span>: crypto.<span class="hljs-title function_">randomUUID</span>(),
              text,
              <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>,
            });
          }),
        <span class="hljs-attr">toggleTodo</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;</span>
          <span class="hljs-title function_">set</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> {
            <span class="hljs-keyword">const</span> todo = state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">todo: Todo</span>) =&gt;</span> todo.<span class="hljs-property">id</span> === id);
            <span class="hljs-keyword">if</span> (todo) todo.<span class="hljs-property">completed</span> = !todo.<span class="hljs-property">completed</span>;
          }),
        <span class="hljs-attr">removeTodo</span>: <span class="hljs-function">(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) =&gt;</span>
          <span class="hljs-title function_">set</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> {
            state.<span class="hljs-property">todos</span> = state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">todo: Todo</span>) =&gt;</span> todo.<span class="hljs-property">id</span> !== id);
          }),
        <span class="hljs-attr">clearCompleted</span>: <span class="hljs-function">() =&gt;</span>
          <span class="hljs-title function_">set</span>(<span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> {
            state.<span class="hljs-property">todos</span> = state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">todo: Todo</span>) =&gt;</span> !todo.<span class="hljs-property">completed</span>);
          }),
      },
    })),
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'todos-storage'</span>,

      <span class="hljs-comment">/**
       * 关键：persist 只持久化可序列化的数据。
       * 我只存 todos，不存 actions（函数不能 JSON 序列化，否则会出现 addTodo is not a function）
       */</span>
      <span class="hljs-attr">partialize</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> ({ <span class="hljs-attr">todos</span>: state.<span class="hljs-property">todos</span> }),
    }
  )
);

<span class="hljs-comment">/**
 * 我不直接导出 useTodoStore（避免误订阅整个 store），
 * 而是导出语义化 hooks，集中 selector 逻辑。
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useTodos</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">useTodoStore</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">todos</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useTodoActions</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">useTodoStore</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">actions</span>);

<span class="hljs-comment">/**
 * 派生值：类似 Vue computed。
 * 组件如果只关心 count，就只订阅这个 selector，而不是订阅 todos。
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useIncompleteCount</span> = (<span class="hljs-params"/>) =&gt;
  <span class="hljs-title function_">useTodoStore</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">todos</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, t</span>) =&gt;</span> acc + (t.<span class="hljs-property">completed</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>), <span class="hljs-number">0</span>));
</code></pre>
<h4 data-id="heading-4">0.2 <code>schema.ts</code>（zod schema）</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { z } <span class="hljs-keyword">from</span> <span class="hljs-string">'zod'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> todoSchema = z.<span class="hljs-title function_">object</span>({
  <span class="hljs-attr">todoText</span>: z.<span class="hljs-title function_">string</span>().<span class="hljs-title function_">trim</span>().<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>, <span class="hljs-string">'请输入待办项'</span>),
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoValues</span> = z.<span class="hljs-property">infer</span>&lt;<span class="hljs-keyword">typeof</span> todoSchema&gt;;
</code></pre>
<h4 data-id="heading-5">0.3 <code>Demo.tsx</code>（React 组件：AddTodo / TodoList / Footer）</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../components/ui/button'</span>;
<span class="hljs-keyword">import</span> clsx <span class="hljs-keyword">from</span> <span class="hljs-string">'clsx'</span>;

<span class="hljs-keyword">import</span> {
  useIncompleteCount,
  useTodoActions,
  useTodos,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/useTodoStore'</span>;

<span class="hljs-keyword">import</span> { useForm } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-hook-form'</span>;
<span class="hljs-keyword">import</span> { todoSchema, <span class="hljs-keyword">type</span> <span class="hljs-title class_">TodoValues</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;
<span class="hljs-keyword">import</span> { zodResolver } <span class="hljs-keyword">from</span> <span class="hljs-string">'@hookform/resolvers/zod'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">AddTodo</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> {
    register,
    handleSubmit,
    reset,
    <span class="hljs-attr">formState</span>: { errors },
  } = useForm&lt;<span class="hljs-title class_">TodoValues</span>&gt;({
    <span class="hljs-attr">resolver</span>: <span class="hljs-title function_">zodResolver</span>(todoSchema),
    <span class="hljs-attr">defaultValues</span>: {
      <span class="hljs-attr">todoText</span>: <span class="hljs-string">''</span>,
    },
  });

  <span class="hljs-keyword">const</span> { addTodo } = <span class="hljs-title function_">useTodoActions</span>();

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onSubmit</span> = (<span class="hljs-params">values: TodoValues</span>) =&gt; {
    <span class="hljs-title function_">addTodo</span>(values.<span class="hljs-property">todoText</span>);
    <span class="hljs-title function_">reset</span>();
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span>
      <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit(onSubmit)}</span>
      <span class="hljs-attr">className</span>=<span class="hljs-string">"my-2 flex justify-between"</span>
    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex min-h-15 flex-col"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"rounded-xl border border-gray-600 px-2 py-1 text-sm"</span>
          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"请输入任务"</span>
          {<span class="hljs-attr">...register</span>('<span class="hljs-attr">todoText</span>')}
        /&gt;</span>
        {errors.todoText &amp;&amp; (
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mt-1 ml-1 text-xs text-red-500"</span>&gt;</span>
            *{errors.todoText.message}
          <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        )}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">variant</span>=<span class="hljs-string">"outline"</span>&gt;</span>
        添加
      <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">TodoList</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> todos = <span class="hljs-title function_">useTodos</span>();
  <span class="hljs-keyword">const</span> { toggleTodo, removeTodo } = <span class="hljs-title function_">useTodoActions</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {todos.map(todo =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{todo.id}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mt-2 flex justify-between"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
              <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span>
              <span class="hljs-attr">checked</span>=<span class="hljs-string">{todo.completed}</span>
              <span class="hljs-attr">onChange</span>=<span class="hljs-string">{()</span> =&gt;</span> toggleTodo(todo.id)}
            /&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>
              <span class="hljs-attr">className</span>=<span class="hljs-string">{clsx(</span>
                '<span class="hljs-attr">ml-2</span>',
                <span class="hljs-attr">todo.completed</span> &amp;&amp; '<span class="hljs-attr">text-gray-400</span> <span class="hljs-attr">line-through</span>'
              )}
            &gt;</span>
              {todo.text}
            <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> removeTodo(todo.id)}&gt;
            删除
          <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Footer</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> { clearCompleted } = <span class="hljs-title function_">useTodoActions</span>();
  <span class="hljs-keyword">const</span> incompleteCount = <span class="hljs-title function_">useIncompleteCount</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"my-2 flex justify-end"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>未完成数量：{incompleteCount}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{clearCompleted}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"rounded-full"</span>&gt;</span>
        删除已完成
      <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">Demo</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"mt-2 ml-2 flex w-100 flex-col rounded-xl bg-gray-100 px-3 py-2"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"self-center font-bold"</span>&gt;</span>TODO LIST<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">AddTodo</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">TodoList</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Demo</span>;
</code></pre>
<hr/>
<h3 data-id="heading-6">2. 我如何理解 Zustand 的"进阶点"</h3>
<h4 data-id="heading-7">2.1 订阅边界是第一性原理</h4>
<p>Zustand 组件更新的触发条件，我用一句话描述：</p>
<blockquote>
<p>我订阅的 selector 返回值发生变化（<code>Object.is(prev, next) === false</code>），组件就重渲染。</p>
</blockquote>
<p>所以我做的所有"最佳实践"，都在回答：
<strong>我到底让组件订阅了什么？它的返回值稳定吗？</strong></p>
<hr/>
<h3 data-id="heading-8">3. 为什么我不直接导出 store hook</h3>
<p>我刻意不导出 <code>useTodoStore</code> 给业务组件使用，而是只导出：</p>
<ul>
<li><code>useTodos()</code></li>
<li><code>useTodoActions()</code></li>
<li><code>useIncompleteCount()</code></li>
</ul>
<p>原因：</p>
<ol>
<li>
<p><strong>避免误订阅整个 store</strong></p>
<ul>
<li><code>useTodoStore()</code> 相当于订阅 <code>state =&gt; state</code>，任何字段变化都会触发 re-render</li>
</ul>
</li>
<li>
<p><strong>selector 逻辑集中</strong></p>
<ul>
<li>以后我想改变数据结构（比如从数组换成 map），只用改 hook，不用全局搜索替换</li>
</ul>
</li>
<li>
<p><strong>语义更强</strong></p>
<ul>
<li>业务组件里读起来像"声明依赖"，而不是"实现细节拼装"</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-9">4. 为什么我把 actions 和 state 分离</h3>
<p>我把 store 组织成：</p>
<pre><code class="hljs language-ts" lang="ts">{ todos, <span class="hljs-attr">actions</span>: { ... } }
</code></pre>
<p>这让我在组件里形成一种稳定模式：</p>
<ul>
<li>订阅数据：<code>const todos = useTodos()</code></li>
<li>触发事件：<code>const { addTodo } = useTodoActions()</code></li>
</ul>
<p>这里有个我认为很"关键但容易忽略"的点：</p>
<blockquote>
<p>actions 是稳定引用，它们不会随 todos 更新而改变。</p>
</blockquote>
<p>因此：
只订阅 <code>actions</code> 的组件（例如 AddTodo）不会因为 <code>todos</code> 更新而重渲染。
这让渲染边界非常清晰。</p>
<hr/>
<h3 data-id="heading-10">5. persist 的坑：为什么我必须使用 partialize</h3>
<p>我亲自踩过这个坑：<code>addTodo is not a function</code>。
本质原因：</p>
<ul>
<li>persist 会把 state JSON 序列化</li>
<li>函数无法被序列化</li>
<li>rehydrate 后 actions 被覆盖成非函数对象</li>
</ul>
<p>所以我必须写：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-attr">partialize</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> ({ <span class="hljs-attr">todos</span>: state.<span class="hljs-property">todos</span> });
</code></pre>
<p>我的经验是：</p>
<blockquote>
<p>persist 只存"数据"，绝对不要存"行为"。</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">6. "computed" 在 Zustand 里怎么做？</h3>
<p>Vue 有 computed，我在 Zustand 里用 selector 来模拟同等效果：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useIncompleteCount</span> = (<span class="hljs-params"/>) =&gt;
  <span class="hljs-title function_">useTodoStore</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">todos</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, t</span>) =&gt;</span> acc + (t.<span class="hljs-property">completed</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>), <span class="hljs-number">0</span>));
</code></pre>
<p>然后在 Footer 里只订阅这个派生值：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> incompleteCount = <span class="hljs-title function_">useIncompleteCount</span>();
</code></pre>
<p>我特别强调这一点，因为这体现了"订阅最小依赖"的思想：
Footer 不关心 todos 具体内容，只关心 count，所以我不订阅 todos。</p>
<hr/>
<h3 data-id="heading-12">7. 为什么我尽量不用 useShallow</h3>
<p>useShallow 的作用我理解为：</p>
<blockquote>
<p>当 selector 被迫返回一个新对象/数组（<code>{}</code> / <code>[]</code>）时，用 shallow compare 抵消引用变化。</p>
</blockquote>
<p>但在这个 Demo 里，我通过：</p>
<ul>
<li>原子 selector（<code>useTodos</code>, <code>useTodoActions</code>, <code>useIncompleteCount</code>）</li>
<li>actions/state 分离</li>
</ul>
<p>已经避免了"返回新对象"的场景。
因此我几乎不需要 useShallow。</p>
<p>如果我确实需要一次性返回多个 state 值，我才会用：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title function_">useTodoStore</span>(<span class="hljs-title function_">useShallow</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> ({ <span class="hljs-attr">a</span>: s.<span class="hljs-property">a</span>, <span class="hljs-attr">b</span>: s.<span class="hljs-property">b</span> })));
</code></pre>
<hr/>
<h3 data-id="heading-13">8. 最终沉淀的"写 Zustand 的规则集"</h3>
<p>自己定的规则基本是这些：</p>
<ol>
<li><strong>组件不直接用 store hook</strong></li>
<li><strong>导出语义化 hooks，集中 selector</strong></li>
<li><strong>actions/state 分离</strong></li>
<li><strong>persist 只持久化纯数据（partialize 必写）</strong></li>
<li><strong>派生状态优先用 selector（而不是强迫订阅原始 state）</strong></li>
<li><strong>默认不用 useShallow，只有在必须返回 object/array 时使用</strong></li>
<li><strong>能让组件依赖更小，就让依赖更小</strong></li>
</ol>
<hr/>
<h3 data-id="heading-14">9. 结语：我认为 Zustand 的"进阶"是什么</h3>
<p>对我而言，Zustand 的进阶不是掌握多少 middleware，
而是我能否持续回答这两个问题：</p>
<ol>
<li><strong>这个组件到底订阅了什么？</strong></li>
<li><strong>我的 selector 返回值是稳定的吗？</strong></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[模块化 CSS：解决样式污染的前端工程化方案]]></title>    <link>https://juejin.cn/post/7593098101432401974</link>    <guid>https://juejin.cn/post/7593098101432401974</guid>    <pubDate>2026-01-09T11:00:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593098101432401974" data-draft-id="7593139476833189931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="模块化 CSS：解决样式污染的前端工程化方案"/> <meta itemprop="keywords" content="CSS,React.js,Vue.js"/> <meta itemprop="datePublished" content="2026-01-09T11:00:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冻梨政哥"/> <meta itemprop="url" content="https://juejin.cn/user/2373184444182659"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            模块化 CSS：解决样式污染的前端工程化方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2373184444182659/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冻梨政哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T11:00:46.000Z" title="Fri Jan 09 2026 11:00:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">模块化 CSS：解决样式污染的前端工程化方案</h2>
<p>在前端开发从静态页面走向组件化、工程化的过程中，CSS 作为样式定义的核心语言，其原生特性带来的问题逐渐凸显。模块化 CSS 应运而生，成为解决样式全局污染、适配组件化开发的关键方案。本文将从模块化 CSS 的由来、用法及核心意义三个维度，结合 React 实战案例，深入解读这一前端工程化的重要实践。</p>
<h3 data-id="heading-1">一、模块化 CSS 的由来：解决原生 CSS 的「全局污染」痛点</h3>
<p>CSS 的设计初衷是为静态网页提供样式定义，其核心特性之一是「全局作用域」—— 所有样式规则都会作用于整个文档，不存在天然的组件级作用域隔离。这一特性在简单页面中并无明显问题，但随着前端开发的发展，逐渐暴露出致命缺陷：</p>
<h4 data-id="heading-2">1. 原生 CSS 的核心问题</h4>
<ul>
<li><strong>样式冲突与覆盖</strong>：当多个开发者协作开发，或项目规模扩大时，不同组件、页面若使用相同的类名（如 <code>.button</code>、<code>.txt</code>），后加载的样式会覆盖先加载的样式，导致组件样式「污染」或被「污染」。例如一个按钮组件定义的 <code>.button</code> 样式，可能会被另一个按钮组件的同名类名覆盖，破坏组件的视觉一致性。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d41991bc19424db0a1f97d1b8d5efc8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya75qKo5pS_5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561246&amp;x-signature=3FWRsiwJjpXcPeu7O4m3s1mR0fw%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bf8a3c61ddd40638ae043a2f930ef62~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya75qKo5pS_5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561246&amp;x-signature=oEijzk8a%2FyoBHEhVbgiWRRzW9yg%3D" alt="image.png" loading="lazy"/>
<strong>样式冲突</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27d7a1324ea949f7bcce61a57be2d552~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya75qKo5pS_5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561246&amp;x-signature=%2BvvGDzD3P6vwo1UjulOuB2WLRdc%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>组件化开发的适配缺失</strong>：React、Vue 等框架推动的组件化开发，要求组件具备「高内聚、低耦合」的特性 —— 组件的 HTML 结构、JS 逻辑、样式应封装为独立单元，原生 CSS 的全局作用域完全违背这一原则，样式无法和组件绑定，成为组件化开发的「短板」。</li>
<li>
<h4 data-id="heading-3">2. 模块化 CSS 的诞生</h4>
</li>
</ul>
<p>为了适配组件化开发模式，解决样式全局污染问题，模块化 CSS 方案被提出。其核心目标是为 CSS 赋予「作用域隔离」能力，让样式仅作用于指定组件，实现「组件样式私有化」。目前主流的模块化 CSS 方案分为两类：一类是 React 主推的 CSS Modules，另一类是 Vue 内置的 <code>scoped</code> 特性。</p>
<h3 data-id="heading-4">二、模块化 CSS 的核心用法：以 React CSS Modules 为例</h3>
<p>模块化 CSS 的实现方式因框架而异，其中 React 的 CSS Modules 是最具代表性的实现方案，以下结合实战代码，详解其核心用法：</p>
<h4 data-id="heading-5">1. CSS Modules 的基础规则</h4>
<p>CSS Modules 的核心是将 CSS 文件编译为 JS 对象，通过「类名映射 + 唯一 Hash 生成」实现作用域隔离，其使用流程可总结为三步：</p>
<h5 data-id="heading-6">步骤 1：样式文件命名规范</h5>
<p>将普通 CSS 文件命名为 <code>[文件名].module.css</code>（如 <code>Button.module.css</code>、<code>anotherButton.module.css</code>），这是 React 识别 CSS Modules 的标识，编译工具（如 Webpack）会对这类文件做特殊处理。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3aaa12fa3e7410bac8579da9effc947~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya75qKo5pS_5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561246&amp;x-signature=MT%2FExBV%2BzN52DY9S1rqiOh3NoDY%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-7">步骤 2：在组件中导入样式文件</h5>
<p>CSS Modules 会将 CSS 文件编译为 JS 对象，类名作为对象的「键」，编译后的唯一 Hash 字符串作为「值」。在组件中通过 ES6 导入语法引入该对象：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Button.jsx </span>
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./Button.module.css'</span>; 
<span class="hljs-comment">// AnotherButton.jsx </span>
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">'./anotherButton.module.css'</span>;
</code></pre>
<p>控制台打印 <code>styles</code> 可看到类似结果：<code>{ button: "Button_button_12345", txt: "Button_txt_67890" }</code>，其中「12345」「67890」是编译生成的唯一 Hash，确保类名全局唯一。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb5e70a717f44d9f843b9fda3899482b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya75qKo5pS_5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561246&amp;x-signature=v3xySMkB%2Bwp3oVJN2XLsH%2FMxMQk%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-8">步骤 3：在 JSX 中使用模块化样式</h5>
<p>通过 <code>className={styles.类名}</code> 的方式，将编译后的唯一类名绑定到元素上，替代原生的字符串类名：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Button.jsx 示例 </span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Button</span>(<span class="hljs-params"/>) { 
<span class="hljs-keyword">return</span> ( 
<span class="xml"><span class="hljs-tag">&lt;&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.txt}</span>&gt;</span>你好，世界!!!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.button}</span>&gt;</span>My Button<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span> 
<span class="hljs-tag">&lt;/&gt;</span></span> 
) } 
<span class="hljs-comment">// AnotherButton.jsx 示例 </span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">AnotherButton</span>(<span class="hljs-params"/>) { 
<span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.button}</span>&gt;</span>My Another Button<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span> 
}
</code></pre>
<p>尽管 <code>Button.module.css</code> 和 <code>anotherButton.module.css</code> 都定义了 <code>.button</code> 类，但由于 Hash 不同，最终渲染的类名分别为 <code>Button_button_12345</code> 和 <code>anotherButton_button_abcde</code>，样式完全隔离，不会互相覆盖。</p>
<h4 data-id="heading-9">2. 其他模块化 CSS 方案：Vue scoped</h4>
<p>Vue 则采用更简洁的 <code>scoped</code> 特性实现样式隔离：在 <code>&lt;style&gt;</code> 标签中添加 <code>scoped</code> 属性，Vue 会为组件内所有元素添加唯一的 Hash 属性（如 <code>data-v-123456</code>），并将 CSS 规则编译为属性选择器（如 <code>.button[data-v-123456]</code>）。这种方式无需修改类名，可读性更高，且 Hash 仅生成一次，性能更优。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa93eaa3d6ab4c83b3fccfe0c71b9ddc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya75qKo5pS_5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561246&amp;x-signature=pOlwS1XOfafSvV71OKuKEsci9iU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cfbd55122b7436aa261e15d42878102~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Ya75qKo5pS_5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768561246&amp;x-signature=Z904YzhjO3X7z3efQcrAAhcFgG8%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">3. 补充：CSS-in-JS 方案</h4>
<p>除了 CSS Modules，React 还支持 styled-components 等 CSS-in-JS 方案，直接在 JS 中编写样式，通过组件 props 动态控制样式，本质也是模块化 CSS 的延伸：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">Button</span> = styled.button` 
background:${<span class="hljs-attr">props</span> =&gt; props.primary?<span class="hljs-string">'blue'</span>: <span class="hljs-string">'white'</span>}<span class="hljs-comment">; </span>
color:${<span class="hljs-attr">props</span> =&gt; props.primary?<span class="hljs-string">'white'</span>: <span class="hljs-string">'blue'</span>}<span class="hljs-comment">; </span>
`<span class="hljs-comment">; </span>
// 使用时：&lt;Button primary&gt;主要按钮&lt;/Button&gt;
</code></pre>
<h3 data-id="heading-11">三、模块化 CSS 的核心意义：适配工程化，赋能组件化开发</h3>
<p>模块化 CSS 并非单纯的「语法糖」，而是前端工程化发展的必然结果，其核心价值体现在以下维度：</p>
<h4 data-id="heading-12">1. 彻底解决样式污染问题</h4>
<p>通过「唯一 Hash 类名」或「属性选择器」，让组件样式仅作用于自身，既不会污染全局样式，也不会被全局样式或其他组件样式影响。例如 <code>Button</code> 组件的 <code>.txt</code> 样式（橙色背景、红色文字），仅作用于该组件内的 <code>&lt;h1&gt;</code> 元素，不会影响其他组件的文字样式。</p>
<h4 data-id="heading-13">2. 提升大型项目的可维护性</h4>
<p>模块化 CSS 让样式和组件「一一绑定」，开发者修改组件样式时，无需担心影响其他页面 / 组件，定位问题、迭代样式的效率大幅提升。尤其在多人协作的开源项目或企业级应用中，无需再通过「命名空间前缀（如 <code>btn-button</code>）」规避类名冲突，简化了开发规范。</p>
<h4 data-id="heading-14">3. 强化组件的复用性</h4>
<p>组件化开发的核心目标是「复用」，而样式隔离是组件复用的前提。模块化 CSS 让组件成为「HTML + JS + CSS」的完整独立单元，可直接复用在不同项目、不同页面中，无需担心样式冲突，大幅提升组件的复用价值。</p>
<h4 data-id="heading-15">4. 适配前端工程化流程</h4>
<p>模块化 CSS 可与 Webpack、Vite 等构建工具深度集成，支持样式压缩、按需加载、预处理器（Less/Sass）等特性，成为前端工程化体系的重要组成部分，推动项目从「手写静态 CSS」走向「工程化样式管理」。</p>
<h3 data-id="heading-16">四、总结</h3>
<p>从原生 CSS 的全局污染痛点，到组件化开发的迫切需求，模块化 CSS 是前端开发从「页面级」走向「组件级」的必然产物。无论是 React 的 CSS Modules、Vue 的 scoped，还是 CSS-in-JS 方案，核心目标都是为 CSS 赋予作用域隔离能力。</p>
<p>模块化 CSS 不仅解决了样式冲突的历史问题，更让样式管理适配工程化、组件化的开发模式，提升了大型项目的可维护性和协作效率。在前端开发日益复杂的今天，掌握模块化 CSS 已成为前端工程师的必备能力，也是构建健壮、可扩展前端应用的基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[echarts柱状图实现斜切以及label展示]]></title>    <link>https://juejin.cn/post/7593177437081550899</link>    <guid>https://juejin.cn/post/7593177437081550899</guid>    <pubDate>2026-01-09T11:27:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593177437081550899" data-draft-id="7593177437081518131" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="echarts柱状图实现斜切以及label展示"/> <meta itemprop="keywords" content="ECharts"/> <meta itemprop="datePublished" content="2026-01-09T11:27:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="该用户加载中"/> <meta itemprop="url" content="https://juejin.cn/user/2621703968797415"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            echarts柱状图实现斜切以及label展示
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2621703968797415/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    该用户加载中
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T11:27:19.000Z" title="Fri Jan 09 2026 11:27:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">思路</h2>
<p>话不多说，ui图如下</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c8a0bc3eb5b4732be5711670db972e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35Yqg6L295Lit:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768562895&amp;x-signature=TZA3Ws7kil96Qd%2FelIk0OlVXbHU%3D" alt="image.png" loading="lazy"/></p>
<p>拿到这个ui图的时候就知道不简单了，柱状图简单，斜切功能又怎么实现了，于是查找资料</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc02bdced82b4a40bbfa3af3946501ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35Yqg6L295Lit:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768562895&amp;x-signature=N347o%2F4Qewphc4gFPgiKvhUciQw%3D" alt="image.png" loading="lazy"/></p>
<p>发现这个功能很像(来源:<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.isqqw.com%2Fviewer%3Fid%3D41249" target="_blank" title="https://www.isqqw.com/viewer?id=41249" ref="nofollow noopener noreferrer">横向柱图斜切 - ECharts图表集,echarts gallery社区,Make A Pie,分享你的可视化作品isqqw.com</a>)</p>
<p>尝试发现当值为负数的时候样式爆炸，效果如图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ffb1950d7b147c0a814c97755ad4a35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35Yqg6L295Lit:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768562895&amp;x-signature=HsHXJOvzNXpm%2B0xjM5YtbKaSrH8%3D" alt="image.png" loading="lazy"/></p>
<p>这个方案只能放弃，于是决定用自定义 custom实现了
思路很简单，就是画出柱状图和label，负数的柱状图我放在右边是因为数据太大会和y轴的值重合了，着急下班，就贴出最终代码了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5830a3a3878040feb93b089c580dc8ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35Yqg6L295Lit:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768562895&amp;x-signature=2ij4dSFPFSn%2FtBkhQBeGzBKHclw%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">最终代码</h2>
<pre><code class="hljs language-js" lang="js">  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">tooltip</span>: {
      <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#012C68'</span>,
      <span class="hljs-attr">borderColor</span>: <span class="hljs-string">'#012C68'</span>,
      <span class="hljs-attr">extraCssText</span>: <span class="hljs-string">'box-shadow: 0 0 10px 0 rgba(0, 119, 255, 0.50) inset'</span>, <span class="hljs-comment">// 添加阴影以突出显示</span>
      <span class="hljs-attr">axisPointer</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'shadow'</span>,
      },
      <span class="hljs-attr">textStyle</span>: {
        <span class="hljs-attr">color</span>: <span class="hljs-string">'#fff'</span>, <span class="hljs-comment">// 设置文字颜色为深色，以便在白色背景下清晰可见</span>
      },
      <span class="hljs-attr">className</span>: <span class="hljs-string">'my-custom-tooltip'</span>,
      <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">params</span>) {
        <span class="hljs-comment">// params 是提示框触发时的数据信息</span>
        <span class="hljs-keyword">if</span> (params.<span class="hljs-property">data</span>) {
          <span class="hljs-keyword">const</span> type = params.<span class="hljs-property">data</span>.<span class="hljs-property">type</span>; <span class="hljs-comment">// 节点名称</span>
          <span class="hljs-keyword">const</span> unit = params.<span class="hljs-property">data</span>.<span class="hljs-property">unit</span> || <span class="hljs-string">''</span>;
          <span class="hljs-keyword">const</span> name = params.<span class="hljs-property">name</span>; <span class="hljs-comment">// 节点名称</span>
          <span class="hljs-keyword">const</span> value = params.<span class="hljs-property">data</span>.<span class="hljs-property">value</span> || <span class="hljs-string">''</span>; <span class="hljs-comment">// 值（你传的是 column4）</span>
          <span class="hljs-keyword">return</span> <span class="hljs-string">`
                  &lt;div  style="border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-bottom: 5px;"&gt;
                  &lt;strong style="
                  max-width: 150px;
                  display: inline-block;
                  white-space: normal;        /* 允许换行（关键！） */
                  word-wrap: break-word;      /* 长单词/连续字符可断行 */
                  overflow-wrap: break-word;  /* 现代标准写法 */
                "&gt;<span class="hljs-subst">${name}</span>&lt;/strong&gt;
                  &lt;/div&gt;
                  <span class="hljs-subst">${type}</span>：<span class="hljs-subst">${value}</span><span class="hljs-subst">${unit}</span>
                `</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">''</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
      },
    },
    <span class="hljs-attr">xAxis</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'value'</span>,
      <span class="hljs-attr">axisLabel</span>: {
        <span class="hljs-attr">color</span>: <span class="hljs-string">'#fff'</span>,
        <span class="hljs-attr">fontSize</span>: <span class="hljs-number">12</span>,
        <span class="hljs-attr">formatter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) {
          <span class="hljs-keyword">return</span> value;
        },
      },
      <span class="hljs-attr">splitLine</span>: {
        <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">lineStyle</span>: {
          <span class="hljs-attr">color</span>: <span class="hljs-string">'#fff'</span>,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'dashed'</span>, <span class="hljs-comment">// 虚线</span>
          <span class="hljs-attr">opacity</span>: <span class="hljs-number">0.2</span>,
        },
      },
      <span class="hljs-attr">axisLine</span>: {
        <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>,
      },
      <span class="hljs-attr">axisTick</span>: {
        <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>,
      },
    },
    <span class="hljs-attr">yAxis</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'category'</span>,
      <span class="hljs-attr">data</span>: data.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${v.index}</span> <span class="hljs-subst">${v.orgName}</span>`</span>),
      <span class="hljs-attr">axisLabel</span>: {
        <span class="hljs-attr">color</span>: <span class="hljs-string">'#fff'</span>,
        <span class="hljs-attr">fontSize</span>: <span class="hljs-number">14</span>,
        <span class="hljs-attr">width</span>: <span class="hljs-number">120</span>,
        <span class="hljs-comment">// 当内容超出宽度时使用省略号</span>
        <span class="hljs-attr">overflow</span>: <span class="hljs-string">'truncate'</span>,
        <span class="hljs-attr">ellipsis</span>: <span class="hljs-string">'...'</span>,
        <span class="hljs-attr">align</span>: <span class="hljs-string">'left'</span>,
        <span class="hljs-attr">margin</span>: <span class="hljs-number">120</span>,
        <span class="hljs-attr">formatter</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> <span class="hljs-string">`{arrow|} <span class="hljs-subst">${value}</span>`</span>,
        <span class="hljs-attr">rich</span>: {
          <span class="hljs-attr">arrow</span>: {
            <span class="hljs-attr">backgroundColor</span>: {
              <span class="hljs-attr">image</span>: arrow,
            },
            <span class="hljs-attr">backgroundRepeat</span>: <span class="hljs-string">'no-repeat'</span>,
            <span class="hljs-comment">// 关键：通过 padding 控制垂直位置</span>
          },
        },
      },
      <span class="hljs-attr">axisLine</span>: {
        <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>,
      },
      <span class="hljs-attr">axisTick</span>: {
        <span class="hljs-attr">show</span>: <span class="hljs-literal">false</span>,
      },
    },
    <span class="hljs-attr">grid</span>: {
      <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">// 上边距</span>
      <span class="hljs-attr">left</span>: -<span class="hljs-number">110</span>, <span class="hljs-comment">// 左边距</span>
      <span class="hljs-attr">right</span>: <span class="hljs-number">30</span>, <span class="hljs-comment">// 右边距</span>
      <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span>, <span class="hljs-comment">// 下边距</span>
      <span class="hljs-attr">containLabel</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 如果为true，则确保网格包含坐标轴标签</span>
    },
    <span class="hljs-attr">series</span>: [
      {
        <span class="hljs-attr">data</span>: data.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">v</span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> { ...v };
        }),
        <span class="hljs-attr">type</span>: <span class="hljs-string">'custom'</span>,
        <span class="hljs-attr">renderItem</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">params, api</span>) {
          <span class="hljs-keyword">const</span> value = api.<span class="hljs-title function_">value</span>(<span class="hljs-number">0</span>);
          <span class="hljs-keyword">const</span> categoryIndex = api.<span class="hljs-title function_">value</span>(<span class="hljs-number">1</span>);

          <span class="hljs-comment">// 获取坐标（绝对像素）</span>
          <span class="hljs-keyword">const</span> zeroPoint = api.<span class="hljs-title function_">coord</span>([<span class="hljs-number">0</span>, categoryIndex]);
          <span class="hljs-keyword">const</span> valuePoint = api.<span class="hljs-title function_">coord</span>([value, categoryIndex]);

          <span class="hljs-keyword">const</span> barHeight = api.<span class="hljs-title function_">size</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>])[<span class="hljs-number">1</span>] * <span class="hljs-number">0.3</span>; <span class="hljs-comment">// 更细</span>
          <span class="hljs-keyword">const</span> y = zeroPoint[<span class="hljs-number">1</span>] - barHeight / <span class="hljs-number">2</span>;
          <span class="hljs-keyword">const</span> cut = <span class="hljs-number">8</span>;
          <span class="hljs-keyword">const</span> x0 = zeroPoint[<span class="hljs-number">0</span>];
          <span class="hljs-keyword">const</span> x1 = valuePoint[<span class="hljs-number">0</span>];
          <span class="hljs-keyword">const</span> width = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(x1 - x0); <span class="hljs-comment">// 使用绝对值计算宽度</span>

          <span class="hljs-keyword">let</span> points, labelX, labelY, gradient, bar, labelText, group;

          <span class="hljs-keyword">if</span> (value &gt; <span class="hljs-number">0</span> &amp;&amp; width &gt; cut) {
            <span class="hljs-comment">// 正值且足够宽做斜切</span>
            points = [
              [x0, y],
              [x1, y],
              [x1 - cut, y + barHeight],
              [x0, y + barHeight],
            ];

            gradient = <span class="hljs-keyword">new</span> echarts.<span class="hljs-property">graphic</span>.<span class="hljs-title class_">LinearGradient</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, [
              { <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#016AFF'</span> },
              { <span class="hljs-attr">offset</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#4AE5FF'</span> },
            ]);

            labelX = x1 - cut + <span class="hljs-number">20</span>;
            labelY = y + barHeight / <span class="hljs-number">2</span>;
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span> &amp;&amp; width &gt; cut) {
            points = [
              [x0, y],
              [x1 + cut, y],
              [x1, y + barHeight],
              [x0, y + barHeight],
            ];

            gradient = <span class="hljs-keyword">new</span> echarts.<span class="hljs-property">graphic</span>.<span class="hljs-title class_">LinearGradient</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, [
              { <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#016AFF'</span> },
              { <span class="hljs-attr">offset</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#4AE5FF'</span> },
            ]);
            <span class="hljs-comment">// 因为y轴设置为</span>
            <span class="hljs-comment">// labelX = x1 - cut - 10;</span>
            labelX = x0 + <span class="hljs-number">20</span>;
            labelY = y + barHeight / <span class="hljs-number">2</span>;
          } <span class="hljs-keyword">else</span> {
            points = [
              [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(x0, x1), y],
              [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(x0, x1), y],
              [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(x0, x1), y + barHeight],
              [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(x0, x1), y + barHeight],
            ];
            gradient = <span class="hljs-keyword">new</span> echarts.<span class="hljs-property">graphic</span>.<span class="hljs-title class_">LinearGradient</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, [
              { <span class="hljs-attr">offset</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#016AFF'</span> },
              { <span class="hljs-attr">offset</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#4AE5FF'</span> },
            ]);
            labelX = value &gt;= <span class="hljs-number">0</span> ? x1 + <span class="hljs-number">20</span> : x1 - <span class="hljs-number">20</span>;
            labelY = y + barHeight / <span class="hljs-number">2</span>;
          }

          bar = {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'polygon'</span>,
            <span class="hljs-attr">shape</span>: { <span class="hljs-attr">points</span>: points },
            <span class="hljs-attr">style</span>: { <span class="hljs-attr">fill</span>: gradient },
            <span class="hljs-attr">key</span>: params.<span class="hljs-property">dataIndex</span>,
            <span class="hljs-attr">info</span>: { <span class="hljs-attr">value</span>: value },
          };

          labelText = {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>,
            <span class="hljs-attr">style</span>: {
              <span class="hljs-attr">text</span>: value.<span class="hljs-title function_">toString</span>(),
              <span class="hljs-attr">textAlign</span>: <span class="hljs-string">'center'</span>,
              <span class="hljs-attr">textVerticalAlign</span>: <span class="hljs-string">'middle'</span>,
              <span class="hljs-attr">fill</span>: <span class="hljs-string">'#FFFFFF'</span>, <span class="hljs-comment">// 白色文本</span>
              <span class="hljs-attr">fontSize</span>: <span class="hljs-number">14</span>,
            },
            <span class="hljs-attr">position</span>: [labelX, labelY],
          };

          group = {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'group'</span>,
            <span class="hljs-attr">children</span>: [bar, labelText],
          };

          <span class="hljs-keyword">return</span> group; <span class="hljs-comment">// 返回组对象</span>
        },
      },
    ],
  };
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker 浅谈]]></title>    <link>https://juejin.cn/post/7593169840200040474</link>    <guid>https://juejin.cn/post/7593169840200040474</guid>    <pubDate>2026-01-09T12:56:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593169840200040474" data-draft-id="7592444642277965834" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker 浅谈"/> <meta itemprop="keywords" content="Docker"/> <meta itemprop="datePublished" content="2026-01-09T12:56:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="岳出于山"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476454536"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker 浅谈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476454536/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    岳出于山
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:56:16.000Z" title="Fri Jan 09 2026 12:56:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">Docker 是什么</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7f8ad2eeeb646c5bf043a00fdb73ee9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKz5Ye65LqO5bGx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568871&amp;x-signature=QBJ4QFQa9MQeV79Bq0wpqMMN9EE%3D" alt="" loading="lazy"/></p>
<p>你可以把 Docker 理解为软件世界的集装箱。就如 Docker logo 所展示的，是一头鲸鱼驮着若干集装箱。Docker 可以允许开发者将应用以及所有依赖项（库、环境等）打包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 或 Windows 机器上。</p>
<h3 data-id="heading-1">诞生的背景</h3>
<p>应用在开发、测试、生产环境中，由于环境依赖、配置差异等等问题，常导致 <em>“在我这能跑”</em> 的难题。传统虚拟机虽能隔离环境，但资源占用高、启动慢、笨重，无法满足轻量、快速部署的需求。 Docker 便在这种背景下诞生。</p>
<h3 data-id="heading-2">Docker 与虚拟机的区别</h3>
<p>虚拟机能实现环境隔离，解决部署环境一致性的问题。那么 Docker 又是怎么解决的，有什么优势呢？</p>
<p>一言以蔽之：虚拟机虚拟化硬件，依赖完整的操作系统；而容器虚拟化操作系统，共享主机内核，因此更轻量、更快速。</p>
<p>通俗化的理解就是：</p>
<ul>
<li>
<p>虚拟机就像一栋独栋别墅。拥有自己的地基、墙体、水电系统（虚拟硬件）和完整的家庭空间（操作系统）。私密性好（隔离强），但建造和启动慢，占用土地多（资源消耗大）。</p>
</li>
<li>
<p>Docker 容器就像一栋公寓楼里的一个单间。所有房间共享大楼的地基和主体结构（主机内核），但每个房间有自己独立的墙壁（隔离）、家具（应用与依赖）。启动快（拎包入住），非常节省资源。</p>
</li>
</ul>
<h2 data-id="heading-3">核心概念</h2>
<h3 data-id="heading-4">  Dockerfile</h3>
<p>  文本文件，描述如何构建镜像（例如指定基础镜像、安装软件、复制文件等）。</p>
<h3 data-id="heading-5">  镜像 Image</h3>
<p>  Dockerfile 构建后的产物即镜像（Image）。镜像是只读的，类似于安装系统用的 <code>.iso</code> 文件，它包含了运行应用所需的所有东西（代码、库、环境变量、配置文件）。</p>
<h4 data-id="heading-6">    层 Layer</h4>
<p>  镜像由层构成，每个层表示文件系统的变更——增加、修改、删除。</p>
<h3 data-id="heading-7">  容器 Container</h3>
<p>  容器就是实际运行中的实例，基于镜像创建而来，与其他容器隔离。类似于一个轻量级的、隔离的虚拟机（但本质是进程）。</p>
<h3 data-id="heading-8">  仓库 Registry</h3>
<p>  存储和分发镜像的平台，如 Docker Hub（Docker 官方平台)。</p>
<h3 data-id="heading-9">  Docker Compose</h3>
<p>  容器的一个最佳实践是每个容器应该只做一件事。但实际项目可能需要同时运行过个容器，并且同时管理容器间的网络连接等。使用 Docker Compose，可以实现在一个 YAML 文件中定义所有容器及其配置。然后使用一条命令便可启动运行。</p>
<p>  例如一个项目包含前端、后端、数据库，分别对应三个镜像，这一个项目可以用一个 docker-compose.yml 文件描述，包含三个镜像，用一条命令就能启动。</p>
<h2 data-id="heading-10">Docker 架构</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18235008490841729aa25cfbdd3de34e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bKz5Ye65LqO5bGx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568871&amp;x-signature=I%2F04X3WLEcVJVqrvjLwt%2BMypf4c%3D" alt="" loading="lazy"/></p>
<p>  Docker 采用客户端-服务器架构。Docker 客户端和守护进程可以运行在同一系统上，也可以将 Docker 客户端连接到远程 Docker 守护进程。Docker 客户端和守护进程通过 REST API 进行通信，通信方式可以是 UNIX 套接字或网络接口。</p>
<ul>
<li>
<p>Docker 守护进程（<code>dockerd</code>）监听 Docker API 请求，并管理 Docker 对象，如镜像、容器、网络和卷。守护进程还可以与其他守护进程通信，以管理 Docker 服务。</p>
</li>
<li>
<p>Docker 客户端（<code>docker</code>）是许多 Docker 用户与 Docker 交互的主要方式。当你使用 <code>docker run</code> 等命令时，客户端会将这些命令发送给 <code>dockerd</code>，由其执行。<code>docker</code> 命令使用 Docker API。Docker 客户端可以与多个守护进程通信。另一个 Docker 客户端是 Docker Compose，它允许你操作由一组容器组成的应用程序。</p>
</li>
</ul>
<h2 data-id="heading-11">Docker 的基础使用场景</h2>
<h3 data-id="heading-12">用 Dockerfile 构建镜像</h3>
<p>以下是一个简单示例，描述了一个前端项目的 Dockfile</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 指定基础镜像，使用官方 nginx 镜像
FROM nginx:alpine

# 删除默认 nginx 静态资源
RUN rm -rf /usr/share/nginx/html/*

# 拷贝 web 项目的 build  文件到 nginx 静态目录下
COPY dist/ /usr/share/nginx/html/

# 拷贝自定义 nginx 配置
COPY default.conf /etc/nginx/conf.d/default.conf

# 暴露端口 80
EXPOSE 80

# 让 NGINX 在前台运行，防止 Docker 容器启动后立即退出
CMD [ "nginx" , "-g" , "daemon off;" ]
</code></pre>
<p>如上 <code>FROM</code>/<code>RUN</code>/<code>CMD</code> 等是 Dockerfile 的指令</p>

































<table><thead><tr><th>指令</th><th>说明</th></tr></thead><tbody><tr><td>FROM</td><td>定制的镜像都是基于某个基础镜像，FROM 就是用来指定基础镜像</td></tr><tr><td>RUN</td><td>在构建过程中的执行命令</td></tr><tr><td>CMD</td><td>创建容器时要执行的默认命令</td></tr><tr><td>COPY</td><td>复制指令，从上下文目录中复制文件或者目录到容器内指定路径</td></tr><tr><td>EXPOSE</td><td>声明容器运行时监听的网络端口</td></tr><tr><td>ENV</td><td>在容器内部设置环境变量</td></tr></tbody></table>
<p>构建指令</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 以当前目录为上下文构建名称为 frontend 的镜像，即当前目录需要有 Dockerfile</span>
docker build -t frontend .
</code></pre>
<blockquote>
<p>frontend 为镜像名称，也可以指定标签如 frontend:v1，frontend:latest，</p>
</blockquote>
<h3 data-id="heading-13">镜像推送和拉取</h3>
<p>如果是为了在其他机器上使用镜像，那我们需要用到镜像仓库。</p>
<blockquote>
<p>需要登陆才可使用进行推送操作</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># docker 登陆命令</span>
docker login [hub URL]
</code></pre>
</blockquote>
<p>将本地镜像推送到远程的镜像仓库</p>
<pre><code class="hljs language-sh" lang="sh">docker push my-image:latest
</code></pre>
<p>从镜像仓库拉取指定镜像</p>
<pre><code class="hljs language-sh" lang="sh">docker pull my-image:latest
</code></pre>
<blockquote>
<p>关于拉取镜像：拉取的镜像会存在本地，然后当基于镜像创建容器时，如果指定的镜像本地没有，则会默认从仓库拉取镜像，有则使用本地镜像。</p>
</blockquote>
<blockquote>
<p>本地可以安装使用 Docker Desktop，查看镜像、容器等，非常方便。</p>
</blockquote>
<h3 data-id="heading-14">基于镜像创建容器</h3>
<p>创建容器使用 <code>docker run</code> 命令，如启动一个基于 ubuntu 的镜像，启动后在前台运行（即命令行不会退出）</p>
<pre><code class="hljs language-sh" lang="sh">docker run ubuntu
</code></pre>
<p>一般有几种场景：</p>
<p><strong>后台运行容器</strong></p>
<p>在后台运行 ubuntu 容器并返回容器 ID</p>
<pre><code class="hljs language-sh" lang="sh">docker run -d ubuntu 
</code></pre>
<p><strong>交互式运行并分配终端</strong></p>
<p>以交互模式运行 ubuntu 容器，并启动一个 Bash shell</p>
<pre><code class="hljs language-sh" lang="sh">docker run -it ubuntu /bin/bash
</code></pre>
<p><strong>临时容器</strong></p>
<p>启动一个 ubuntu 容器，执行 xxxx 命令，完成后自动删除容器</p>
<pre><code class="hljs language-sh" lang="sh">docker run --<span class="hljs-built_in">rm</span> ubuntu sh -c <span class="hljs-string">"xxxxx"</span>
</code></pre>
<p>另外一下是一些常用的参数：</p>



































<table><thead><tr><th>参数</th><th>示例</th><th>含义</th></tr></thead><tbody><tr><td>--name</td><td>--name my_container</td><td>指定容器名称，不指定的话 docker 会随机生成一个名称</td></tr><tr><td>-p</td><td>-p 8080:80</td><td>端口映射，主机的 8080 端口映射为容器内的 80 端口</td></tr><tr><td>-v</td><td>-v /host/data:/container/data</td><td>挂载卷，将主机的 /host/data 目录挂载到容器内的 /container/data 目录</td></tr><tr><td>-e, --env</td><td>-e MY_ENV=my_value</td><td>设置环境变量 MY_ENV=my_value</td></tr><tr><td>--network</td><td>--network host</td><td>指定网络模式</td></tr></tbody></table>
<h3 data-id="heading-15">容器管理</h3>
<p><strong>容器启动、停止、重启</strong></p>
<pre><code class="hljs language-sh" lang="sh">docker start my_container
docker stop my_container
docker restart my_container
</code></pre>
<p><strong>删除一个或多个已经停止容器</strong></p>
<pre><code class="hljs language-sh" lang="sh">docker <span class="hljs-built_in">rm</span> my_container
</code></pre>
<p><strong>在运行中的容器中执行命令</strong></p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 在 my_container 容器中执行 ls /app 命令</span>
docker <span class="hljs-built_in">exec</span> my_container <span class="hljs-built_in">ls</span> /app 
</code></pre>
<p><strong>查看当前运行的容器</strong></p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 查看所有运行的容器</span>
docker ps

<span class="hljs-comment"># 查看所有容器，包含停止的</span>
docker ps -a

<span class="hljs-comment"># 显示所有容器 ID</span>
docker ps -aq

<span class="hljs-comment"># 输出示例</span>
CONTAINER ID   IMAGE               COMMAND                  CREATED       STATUS       PORTS                                     NAMES
09b4274e4356   project__frontend   <span class="hljs-string">"/docker-entrypoint.…"</span>   3 hours ago   Up 3 hours   0.0.0.0:8081-&gt;80/tcp, [::]:8081-&gt;80/tcp   frontend
30486b3d96d0   project__backend    <span class="hljs-string">"./wait-for-mysql.sh"</span>    3 hours ago   Up 3 hours   1024/tcp                                  backend
929f7bfcf316   project__mysql      <span class="hljs-string">"docker-entrypoint.s…"</span>   3 hours ago   Up 3 hours   3306/tcp, 33060/tcp                       mysql
6d78b99b0e3b   redis:alpine        <span class="hljs-string">"docker-entrypoint.s…"</span>   3 hours ago   Up 3 hours   6379/tcp                                  redis
</code></pre>
<p><code>docker ps</code> 常用来查看所有容器的运行状态。容器状态有 7 种：</p>
<ul>
<li>
<p><code>created</code>，已创建，从未启动过的容器</p>
</li>
<li>
<p><code>running</code>，运行中，通过<code>docker start</code>或<code>docker run</code>启动。</p>
</li>
<li>
<p><code>paused</code>，已暂停，通过<code>docker pause</code>暂停。</p>
</li>
<li>
<p><code>restarting</code>，重启中，由于容器指定的重启策略而正在启动。</p>
</li>
<li>
<p><code>exited</code>，已停止，一个不再运行的容器。例如，容器内的进程已完成，或者容器已通过<code>docker stop</code>命令停止。</p>
</li>
<li>
<p><code>removing</code>，删除中，执行<code>docker rm</code>，容器正在被移除</p>
</li>
<li>
<p><code>dead</code>，已失效，例如，由于外部进程占用资源而仅被部分移除的容器。<code>dead</code>的容器无法（重新）启动，只能被移除</p>
</li>
</ul>
<p><strong>查看容器运行的日志</strong></p>
<pre><code class="hljs language-sh" lang="sh">docker logs my_container

<span class="hljs-comment"># 跟随日志，类似于 tail -f</span>
docker logs -f my_container 
</code></pre>
<p><strong>查看容器端口映射信息</strong></p>
<pre><code class="hljs language-sh" lang="sh">docker port my_container

<span class="hljs-comment"># 输出示例</span>
80/tcp -&gt; 0.0.0.0:8081  <span class="hljs-comment"># ipv4</span>
80/tcp -&gt; [::]:8081     <span class="hljs-comment"># ipv6</span>
</code></pre>
<h2 data-id="heading-16">Docker Compose 的使用场景</h2>
<p>实际一个项目，可能会有多个服务组成，即完整运行一个服务可能会基于多个镜像运行多个容器，包含若干配置，以及多个容器协作需要创建网络等。docker compose 就是针对这种情况的解决方案，通过 <code>docker-compose.yml</code> 文件可以配置多个容器组成的服务，以及它们依赖的网络配置等。然后可以用一个命令就能启动这个多容器的项目。</p>
<h3 data-id="heading-17">docker-compose.yml</h3>
<p>如下所示，docker-compose.yml 定义了 5 个服务，包含数据库服务、后端服务、前端服务</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">services:</span>  <span class="hljs-comment"># 服务配置</span>
  <span class="hljs-attr">mysql:</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql</span> <span class="hljs-comment"># 容器名称</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">./mysql</span>             <span class="hljs-comment"># 构建目录</span>
    <span class="hljs-attr">platform:</span> <span class="hljs-string">linux/amd64</span>      <span class="hljs-comment"># 架构类型</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">project__mysql</span>  <span class="hljs-comment"># 镜像名称（本地构建可不需要）</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>   <span class="hljs-comment"># 重启策略</span>
    <span class="hljs-attr">volumes:</span>          <span class="hljs-comment"># 依赖卷</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql-data:/var/lib/mysql</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:alpine</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-data:/data</span>

  <span class="hljs-attr">backend:</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">backend</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">./backend</span>
    <span class="hljs-attr">platform:</span> <span class="hljs-string">linux/amd64</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">project__backend</span>
    <span class="hljs-attr">depends_on:</span>     <span class="hljs-comment"># 启动顺序依赖</span>
      <span class="hljs-attr">mysql:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span>
      <span class="hljs-attr">redis:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_started</span>

  <span class="hljs-attr">frontend:</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">frontend</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">./frontend</span>
    <span class="hljs-attr">platform:</span> <span class="hljs-string">linux/amd64</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">project__frontend</span>
    <span class="hljs-attr">ports:</span>     <span class="hljs-comment"># 端口映射</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8081:80"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

  <span class="hljs-attr">frontend-admin:</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">frontend_admin</span>
    <span class="hljs-attr">build:</span> <span class="hljs-string">./frontend-admin</span>
    <span class="hljs-attr">platform:</span> <span class="hljs-string">linux/amd64</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">project__frontend-admin</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8082:80"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

<span class="hljs-attr">volumes:</span>   <span class="hljs-comment"># 卷配置</span>
  <span class="hljs-attr">mysql-data:</span>
  <span class="hljs-attr">redis-data:</span>
</code></pre>
<p>docker-compose.yml 所处目录的上下文示意：</p>
<pre><code class="hljs language-scss" lang="scss">.
|-mysql
|  |-Dockerfile
|  `<span class="hljs-built_in">-</span>(other files)
|-backend
|  |-Dockerfile
|  `<span class="hljs-built_in">-</span>(other files)
|-frontend
|  |-Dockerfile
|  `<span class="hljs-built_in">-</span>(other files)
|-frontend-admin
|  |-Dockerfile
|  `<span class="hljs-built_in">-</span>(other files)
`-docker-compose<span class="hljs-selector-class">.yml</span>
</code></pre>
<h3 data-id="heading-18">构建与推送镜像</h3>
<p><strong>构建</strong></p>
<p>含有 <code>build</code> 配置的服务，会自动依赖其所指定的目录进行构建，指定目录下需包含 <code>Dockerfile</code></p>
<pre><code class="hljs language-sh" lang="sh">docker compose build
</code></pre>
<p><strong>推送</strong></p>
<p>构建完成后，可以将构建完成的镜像自动推送到镜像仓库，即含有 <code>build</code> 配置的项会自动推送到 <code>image</code> 定义的镜像位置（当然镜像仓库是有权限控制的）</p>
<pre><code class="hljs language-sh" lang="sh">docker compose push
</code></pre>
<h3 data-id="heading-19">启动命令与过程</h3>
<p><strong>启动命令</strong></p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 启动服务在前台运行，一旦退出则服务停止</span>
docker compose up 

<span class="hljs-comment"># 启动服务在后台运行</span>
docker compose up -d
</code></pre>
<p><strong>启动的具体过程</strong></p>
<ol>
<li>
<p>前期准备与验证</p>
<ol>
<li>读取 Compose 文件</li>
<li>验证配置，检查 YAML 语法、服务定义、网络、卷等配置是否正确。</li>
<li>项目环境，确定项目名称（默认是当前目录名，可通过 <code>-p</code> 指定）。</li>
</ol>
</li>
<li>
<p>构建与拉取镜像</p>
<ol>
<li>如果配置了 <code>build</code>，会构建镜像，如果本地构建过，则直接使用缓存，否则会进行构建，如果配置了 <code>--build</code> 则会使用进行构建。</li>
<li>如果配置了 <code>image</code>，会拉取镜像，如果本地不存在就会从镜像仓库拉取，如果配置了 <code>--pull=always</code> 会始终从镜像仓库拉取。</li>
</ol>
</li>
<li>
<p>创建网络和卷</p>
<ol>
<li>创建网络：根据 <code>networks</code> 部分创建自定义网络。默认会为整个项目创建一个名为 <code>{project-name}_default</code> 的网络，所有服务都会连接到这个网络，以便通过服务名进行通信。</li>
<li>创建卷：根据 <code>volumes</code> 部分创建命名的持久化卷。如果卷已存在，则直接使用。</li>
</ol>
</li>
<li>
<p>启动服务（容器）</p>
<ol>
<li>
<p>按依赖顺序启动，会根据 <code>depends_on</code> 配置来确定启动顺序。</p>
<ol>
<li>例如，一个 <code>web</code> 服务依赖 <code>db</code> 服务，那么 Compose 会先启动 <code>db</code>，然后再启动 <code>web</code>。但注意 <code>depends_on</code> 只能决定启动顺序，并不能保证 <code>web</code> 启动时 <code>db</code> 已经正常运行</li>
</ol>
</li>
<li>
<p>容器创建：为每个服务创建并启动容器，这相当于对每个服务执行 <code>docker run</code></p>
</li>
<li>
<p>重启策略：会根据 <code>restart</code> 策略来管理容器的生命周期</p>
</li>
</ol>
</li>
<li>
<p>服务健康检查（如果配置了 <code>healthcheck</code>）</p>
<ol>
<li>
<p>等待健康状态：如果服务配置了健康检查（<code>healthcheck</code>），Compose 会等待容器变为 healthy 状态，然后再启动依赖于它的下一个服务。</p>
</li>
<li>
<p>与 <code>depends_on</code> 的区别：</p>
<ul>
<li><code>depends_on</code> 只控制启动顺序（容器进程运行）。</li>
<li><code>healthcheck</code> + <code>condition: service_healthy</code> 控制就绪顺序（容器内应用真正准备好接收请求）。这是更可靠的方式</li>
</ul>
</li>
</ol>
</li>
<li>
<p>后续</p>
<ol>
<li>
<p>前台模式：会用一个彩色的输出流输出所有服务的日志，按下 <code>Ctrl+C</code> 会停止所有正在运行的服务</p>
</li>
<li>
<p>后台模式（<code>-d</code> 参数）：启动命令会立即返回，只打印出创建了哪些容器。之后可以用<code>docker compose logs</code> 来查看日志，使用 <code>docker compose ps</code> 查看状态。</p>
</li>
</ol>
</li>
</ol>
<p><strong>使用启动命令时常用的一些参数</strong></p>






























<table><thead><tr><th>参数</th><th>示例</th><th>含义</th></tr></thead><tbody><tr><td>-f</td><td>docker compose -f xxx.yml up</td><td>用于指定某个 docker compose yml 配置启动，默认是当前目录下的 docker-compose.yml 文件</td></tr><tr><td>-p</td><td>docker compose -p app up</td><td>指定启动项目名称，默认是以当前的目录名</td></tr><tr><td>--build</td><td>docker compose up --build</td><td>启动时强制重新构建镜像，即使镜像已存在</td></tr><tr><td>--pull</td><td>docker compose up --pull=</td><td>指定启动前拉镜像的策略， <br/>- <code>always</code>，总是从远程拉镜像，即使本地已经有了，保证运行时是最新镜像 <br/>-   <code>missing</code>，（默认值）如果本地不存在指定的镜像，则从仓库拉取。如果本地已存在，则直接使用本地镜像 <br/>-   <code>never</code>，从不拉取镜像。如果本地不存在该镜像，则命令失败</td></tr></tbody></table>
<h3 data-id="heading-20">运维：查看、停止</h3>
<p><strong>查看日志</strong></p>
<pre><code class="hljs language-sh" lang="sh">docker compose logs 
</code></pre>
<p><strong>停止并删除 docker compose 所创建的容器</strong></p>
<pre><code class="hljs language-sh" lang="sh">docker compose down
</code></pre>
<p><strong>重启 docker compose 所创建的容器</strong></p>
<pre><code class="hljs language-sh" lang="sh">docker compose restart
</code></pre>
<h2 data-id="heading-21">网络 Network</h2>
<h3 data-id="heading-22">网络模式</h3>
<p>安装 Docker 时，它会自动创建三个网络，bridge（创建容器默认连接到此网络）、 none 、host。</p>
<p>运行容器时，可以指定容器运行的网络模式。</p>
<ul>
<li>
<p>Host</p>
<ul>
<li>通过 <code>--network=host</code> 指定</li>
<li>容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口</li>
</ul>
</li>
<li>
<p>Bridge</p>
<ul>
<li>通过 <code>--network=bridge</code> 指定，如果不指定，会默认以 brdge 模式</li>
<li>为每一个容器分配、设置IP等，并将容器连接到一个 docker0 虚拟网桥，通过 docker0 网桥以及 Iptables nat 表配置与宿主机通信</li>
</ul>
</li>
<li>
<p>None</p>
<ul>
<li>通过 <code>--network=none</code> 指定</li>
<li>关闭容器的网络功能</li>
</ul>
</li>
<li>
<p>Container</p>
<ul>
<li>通过 <code>--network=container:NAME_or_ID</code> 指定</li>
<li>创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口范围。</li>
</ul>
</li>
<li>
<p>指定自定义网络</p>
</li>
</ul>
<h3 data-id="heading-23">相关命令</h3>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 列出所有网络</span>
docker network <span class="hljs-built_in">ls</span>
<span class="hljs-comment"># 创建一个新的网络</span>
docker network create &lt;network&gt;
<span class="hljs-comment"># 删除指定的网络</span>
docker network <span class="hljs-built_in">rm</span> &lt;network&gt;
<span class="hljs-comment"># 连接容器到网络</span>
docker network connect &lt;network&gt; &lt;container&gt;
<span class="hljs-comment"># 断开容器与网络的连接</span>
docker network disconnect &lt;network&gt; &lt;container&gt;
</code></pre>
<h2 data-id="heading-24">卷 Volume</h2>
<p>卷是容器的持久性数据存储，由 Docker 创建和管理。可以使用<code>docker volume create</code>命令显式创建卷，Docker 也可以在创建容器或服务时创建卷。</p>
<p>创建卷时，它会存储在 Docker 主机上的一个目录中。将卷挂载到容器时，挂载到容器中的就是这个目录。这与绑定挂载的工作方式类似，不同之处在于卷由 Docker 管理，并且与主机的核心功能隔离开来。</p>
<p>卷相关的命令</p>
<pre><code class="hljs language-sh" lang="sh"><span class="hljs-comment"># 列出所有卷</span>
docker volume <span class="hljs-built_in">ls</span>
<span class="hljs-comment">#　创建一个新的卷</span>
docker volume create &lt;volume&gt;
<span class="hljs-comment"># 删除指定的卷</span>
docker volume <span class="hljs-built_in">rm</span> &lt;volume&gt;
<span class="hljs-comment"># 显示卷的详细信息</span>
docker volume inspect &lt;volume&gt;
</code></pre>
<h2 data-id="heading-25">Docker in Docker （DinD）</h2>
<p>Docker in Docker（简称 DinD）指的是在一个 Docker 容器内部运行一个完整的 Docker 守护进程（Docker Daemon）和客户端（Docker CLI）。</p>
<p>简单来说，就是“容器里的容器”。你可以在一个容器中执行 <code>docker build</code>、<code>docker run</code> 等命令，就像在宿主机上一样。</p>
<p>可以使用官方的 <code>docker:dind</code> 镜像进行构建。这个镜像经过特殊配置，可以在容器内启动并运行 Docker 守护进程。运行此类容器通常需要 <code>--privileged</code>（特权）模式。</p>
<p><strong>优点</strong></p>
<ul>
<li>
<p>环境隔离：构建环境与宿主机完全隔离，非常干净，不会相互污染。</p>
</li>
<li>
<p>安全性相对较高：与 DoD 相比，它对宿主机的影响更小，进程和文件系统都是隔离的。</p>
</li>
</ul>
<p><strong>缺点</strong></p>
<ul>
<li>
<p>性能开销大：在容器内运行完整的 Docker 守护进程和存储驱动（通常使用效率较低的 <code>vfs</code>），资源占用高。</p>
</li>
<li>
<p>无法共享缓存：每次启动一个 DinD 容器，都是一个全新的环境，之前构建的镜像缓存会丢失，导致构建速度慢。</p>
</li>
</ul>
<p><strong>业务场景</strong></p>
<p>业务中需要通过 docker compose 启动多个容器，而部署环境的容器中使用了 host 的网络模式，内部再使用 docker compose 启动会默认创建网络，由于要部署的环境众多，这会导致 host 网络无法分配的问题。此时需要使用 Docker in Docker 的方式进行部署，隔绝项目网络与部署环境的网络。</p>
<h2 data-id="heading-26">结语</h2>
<p>以上是业务中使用到的 Docker 知识的简单总结，本文对 Docker 相关知识的多个方面均有涉及，但受限于篇幅和定位，各部分内容的探讨尚属浅显。若希望深入理解 Docker 的底层原理、高级应用及最佳实践，可进一步阅读专业技术文档如 Docker 官方网站等，以获取更系统、全面的知识体系。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Blog-SSR 系统操作手册(v1.0.0)]]></title>    <link>https://juejin.cn/post/7593139476840955910</link>    <guid>https://juejin.cn/post/7593139476840955910</guid>    <pubDate>2026-01-09T13:02:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593139476840955910" data-draft-id="7593098101432516662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Blog-SSR 系统操作手册(v1.0.0)"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-09T13:02:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="彭涛361"/> <meta itemprop="url" content="https://juejin.cn/user/550189444378333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Blog-SSR 系统操作手册(v1.0.0)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/550189444378333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    彭涛361
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:02:11.000Z" title="Fri Jan 09 2026 13:02:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读44分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Blog-SSR 系统操作手册(v1.0.0)</h2>
<h3 data-id="heading-1">📖 文档概述</h3>
<p>本文档是 Blog-SSR 系统的完整操作手册，旨在帮助开发者从零开始搭建和运行整个博客系统。系统采用现代化的全栈技术栈，包含前后端分离架构、SSR优化、Docker容器化部署等特性。</p>
<blockquote>
<p>注: 操作手册 是一步一步的项目框架搭建说明, 暂时忋完成了核心功能, 其余开发中的功能还在补充中.</p>
</blockquote>
<blockquote>
<p>注: 操作手册 是一步一步的项目框架搭建说明, 这里出现的代码 是参考项目源码(下载地址: <code>git clone https://github.com/pengtaohenry1213-prog/Blog</code>), 所以有些部分的代码略有差异, 这点要注意.</p>
</blockquote>
<h4 data-id="heading-2">🎯 适用读者</h4>
<ul>
<li>新加入项目的开发者</li>
<li>需要从零搭建项目的工程师</li>
<li>运维人员进行系统部署</li>
</ul>
<h4 data-id="heading-3">🎯 项目当前状态</h4>
<p><strong>已完成的核心功能：</strong></p>
<ul>
<li>✅ 完整的Docker容器化环境</li>
<li>✅ JWT用户认证系统（包含前端登录界面）</li>
<li>✅ MySQL + Redis数据存储</li>
<li>✅ Express后端API框架</li>
<li>✅ Nginx反向代理配置</li>
<li>✅ 前后端基础架构
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 前端登录页面可正常使用</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 后端 API 接口响应正常</li>
</ul>
</li>
</ul>
<p><strong>开发中的功能：</strong></p>
<ul>
<li>🚧 文章管理系统（后端模型和API）</li>
<li>🚧 前端管理后台完整功能</li>
<li>🚧 Nuxt SSR前台页面</li>
</ul>
<p><strong>⚠️ 需要补充的功能：</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 文章模型定义和数据库迁移</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 文章管理 API 接口</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 前端文章管理界面</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 用户权限管理</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 统计数据展示</li>
</ul>
<h4 data-id="heading-4">📋 前置要求</h4>
<ul>
<li>熟悉 Node.js 开发环境</li>
<li>了解 Docker 和容器化概念</li>
<li>具备基本的 Linux/macOS 命令行操作能力</li>
</ul>
<h4 data-id="heading-5">🎯 开发工作流选择指南</h4>
<p><strong>重要提醒：开发阶段优先使用本地开发模式</strong></p>
<h5 data-id="heading-6">开发环境推荐方案</h5>
<p><strong>🎨 本地开发模式（推荐用于日常开发）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动基础设施服务（MySQL + Redis）</span>
pnpm run docker-dev:up:redis
pnpm run docker-dev:up:mysql

<span class="hljs-comment"># 本地启动后端服务（支持热重载）</span>
pnpm run dev:backend

<span class="hljs-comment"># 本地启动前端服务</span>
pnpm run dev:frontend
</code></pre>
<p><strong>🐳 Docker 开发模式（适用于集成测试）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># docker 容器创建&amp;部署</span>
pnpm run docker:build

<span class="hljs-comment"># 完整容器化环境启动</span>
pnpm run docker:up
</code></pre>
<h5 data-id="heading-7">两种模式的对比</h5>








































<table><thead><tr><th>方面</th><th>本地开发模式</th><th>Docker 开发模式</th></tr></thead><tbody><tr><td><strong>启动速度</strong></td><td>~3秒 ⚡</td><td>~30秒 🐌</td></tr><tr><td><strong>热重载</strong></td><td>即时响应 ⚡</td><td>需要 volume 映射</td></tr><tr><td><strong>调试体验</strong></td><td>优秀（断点调试）</td><td>一般</td></tr><tr><td><strong>资源占用</strong></td><td>低</td><td>高</td></tr><tr><td><strong>文件访问</strong></td><td>直接访问</td><td>通过 volume</td></tr><tr><td><strong>适用场景</strong></td><td>日常开发、代码编写</td><td>集成测试、演示环境</td></tr></tbody></table>
<h5 data-id="heading-8">开发阶段最佳实践</h5>
<ol>
<li>
<p><strong>基础设施服务使用 Docker</strong></p>
<ul>
<li>MySQL 和 Redis 建议一直使用 Docker 容器</li>
<li>保证环境一致性和数据持久化</li>
</ul>
</li>
<li>
<p><strong>应用服务使用本地模式</strong></p>
<ul>
<li>后端服务：<code>pnpm run dev:backend</code>（支持热重载）</li>
<li>前端服务：<code>pnpm run dev:frontend</code>（Vite 热重载）</li>
<li>Nuxt 服务：<code>pnpm run dev:nuxt</code>（如需要）</li>
</ul>
</li>
<li>
<p><strong>何时使用 Docker 模式</strong></p>
<ul>
<li>全栈集成测试时</li>
<li>向团队演示功能时</li>
<li>模拟生产环境配置时</li>
<li>CI/CD 自动化测试时</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-9"><strong>执行顺序总览表</strong>
当前顺序： 环境准备 → 项目初始化 → Docker基础服务 → 后端基础框架搭建（Express + 中间件 + 工具函数） → 数据库设计与初始化（模型定义 + 初始化脚本 + 数据库同步） → JWT认证系统 → Redis缓存集成 → 前端后台管理</h3>
<h3 data-id="heading-10">阶段一：基础运行环境准备</h3>
<h4 data-id="heading-11">🎯 本阶段目标</h4>
<p>确保本地开发环境具备运行 Blog-SSR 项目的最低要求。</p>
<h4 data-id="heading-12">✅ 预期结果</h4>
<ul>
<li>所有必需工具正确安装并可正常运行</li>
<li>Node.js ≥ 18.0.0, pnpm ≥ 9.0.0, Docker ≥ 24.0.0</li>
<li>Docker 引擎正常运行，可创建和启动容器</li>
<li>网络连接正常，可访问 Docker Hub</li>
</ul>
<h4 data-id="heading-13">📏 验证标准</h4>



































<table><thead><tr><th>检查项</th><th>验证命令</th><th>期望结果</th></tr></thead><tbody><tr><td>Node.js 版本</td><td><code>node --version</code></td><td>≥ 18.0.0</td></tr><tr><td>pnpm 版本</td><td><code>pnpm --version</code></td><td>≥ 9.0.0</td></tr><tr><td>Docker 版本</td><td><code>docker --version</code></td><td>≥ 24.0.0</td></tr><tr><td>Docker 引擎状态</td><td><code>docker info</code></td><td>无错误输出</td></tr><tr><td>Docker Hub 连接</td><td><code>curl -fsSL https://registry-1.docker.io/v2/</code></td><td>HTTP 200</td></tr></tbody></table>
<h4 data-id="heading-14">📦 技术栈详情</h4>
<ul>
<li><strong>容器化</strong>: Docker + Docker Compose</li>
<li><strong>代码规范</strong>: ESLint + Prettier + Husky + lint-staged</li>
<li><strong>concurrently</strong>: Node.js 命令行工具, 功能是在同一个终端窗口中，并行（同时）运行多个命令行命令，而无需打开多个终端分别执行。</li>
</ul>
<h4 data-id="heading-15">📋 环境依赖清单</h4>















































<table><thead><tr><th>工具</th><th>版本要求</th><th>安装方式</th><th>验证命令</th></tr></thead><tbody><tr><td>Node.js</td><td>≥ 18.0.0</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2F" target="_blank" title="https://nodejs.org/" ref="nofollow noopener noreferrer">官网下载</a></td><td><code>node --version</code></td></tr><tr><td>pnpm</td><td>≥ 9.0.0</td><td><code>npm install -g pnpm</code></td><td><code>pnpm --version</code></td></tr><tr><td>Docker</td><td>≥ 24.0.0</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.docker.com%2Fproducts%2Fdocker-desktop" target="_blank" title="https://www.docker.com/products/docker-desktop" ref="nofollow noopener noreferrer">Docker Desktop</a></td><td><code>docker --version</code></td></tr><tr><td>Docker Compose</td><td>≥ 2.0.0</td><td>随 Docker Desktop</td><td><code>docker compose version</code></td></tr><tr><td>Git</td><td>≥ 2.30.0</td><td>系统包管理器</td><td><code>git --version</code></td></tr><tr><td>concurrently</td><td>≥ 9.0.0</td><td><code>pnpm add -D concurrently</code></td><td>已随项目安装</td></tr></tbody></table>
<p><strong>技术栈版本详情：</strong></p>































































































<table><thead><tr><th>组件</th><th>版本</th><th>说明</th></tr></thead><tbody><tr><td><strong>后端</strong></td><td/><td/></tr><tr><td>Express</td><td>4.18.2</td><td>Web 框架</td></tr><tr><td>Sequelize</td><td>6.37.7</td><td>ORM</td></tr><tr><td>MySQL2</td><td>3.6.5</td><td>数据库驱动</td></tr><tr><td>Redis</td><td>4.6.12</td><td>缓存客户端</td></tr><tr><td>JWT</td><td>9.0.2</td><td>身份认证</td></tr><tr><td><strong>前端后台管理</strong></td><td/><td/></tr><tr><td>Vue</td><td>3.5.24</td><td>前端框架</td></tr><tr><td>Vite</td><td>rolldown-vite@7.2.5</td><td>构建工具</td></tr><tr><td>Element Plus</td><td>2.13.0</td><td>UI 组件库</td></tr><tr><td>Pinia</td><td>3.0.4</td><td>状态管理</td></tr><tr><td><strong>SSR前台</strong></td><td/><td/></tr><tr><td>Nuxt</td><td>3.12.0</td><td>SSR 框架</td></tr><tr><td><strong>容器化</strong></td><td/><td/></tr><tr><td>MySQL</td><td>8.0</td><td>数据库</td></tr><tr><td>Redis</td><td>8.4.0</td><td>缓存</td></tr><tr><td>Nginx</td><td>Alpine</td><td>反向代理</td></tr></tbody></table>
<h4 data-id="heading-16">当前项目状态分析</h4>
<p><strong>已有的资源：</strong></p>
<ul>
<li>✅ Node.js、pnpm、Docker、Docker Compose 安装验证</li>
<li>✅ 技术栈版本清单已定义</li>
</ul>
<p><strong>缺失的部分：</strong></p>
<ul>
<li>❌ 项目代码和配置</li>
</ul>
<h4 data-id="heading-17">🧭 操作步骤</h4>
<h5 data-id="heading-18">1. 安装 Node.js</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 nvm 管理 Node.js 版本（推荐）</span>
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
<span class="hljs-built_in">source</span> ~/.bashrc
nvm install 18
nvm use 18
</code></pre>
<h5 data-id="heading-19">2. 安装 pnpm</h5>
<pre><code class="hljs language-bash" lang="bash">npm install -g pnpm
</code></pre>
<h5 data-id="heading-20">3. 安装 Docker Desktop</h5>
<ul>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.docker.com%2Fproducts%2Fdocker-desktop" target="_blank" title="https://www.docker.com/products/docker-desktop" ref="nofollow noopener noreferrer">Docker 官网</a></li>
<li>下载对应操作系统版本</li>
<li>完成安装并启动 Docker Desktop</li>
</ul>
<hr/>
<h3 data-id="heading-21">阶段二：项目结构初始化</h3>
<h4 data-id="heading-22">🎯 本阶段目标</h4>
<p>创建完整的 Monorepo 项目结构，配置工作区依赖管理。</p>
<h4 data-id="heading-23">✅ 预期结果</h4>
<ul>
<li>完整的项目目录结构按照规范创建</li>
<li>pnpm 工作区正确配置，可识别所有子包</li>
<li>共享模块 @blog/common 成功创建并可导入</li>
<li>根项目依赖正确安装，工作区识别正常</li>
</ul>
<h4 data-id="heading-24">📏 验证标准</h4>



































<table><thead><tr><th>检查项</th><th>验证命令</th><th>期望结果</th></tr></thead><tbody><tr><td>工作区配置</td><td><code>cat pnpm-workspace.yaml</code></td><td>包含 <code>packages: - 'packages/*'</code></td></tr><tr><td>工作区识别</td><td><code>pnpm ls --depth=-1</code></td><td>列出所有工作区包</td></tr><tr><td>共享模块</td><td><code>ls -la packages/common/</code></td><td>包含 index.js, package.json, types/, utils/</td></tr><tr><td>依赖安装</td><td><code>pnpm install</code></td><td>无错误，成功安装所有依赖</td></tr><tr><td>模块导入</td><td><code>node -e "import('./packages/common/index.js')"</code></td><td>无错误，可正常导入</td></tr></tbody></table>
<h4 data-id="heading-25">📦 技术栈详情</h4>
<ul>
<li><strong>包管理</strong>: pnpm workspaces (monorepo)</li>
</ul>
<h4 data-id="heading-26">当前项目状态分析</h4>
<p><strong>已有的资源：</strong></p>
<ul>
<li>✅ pnpm 工作区配置已创建</li>
<li>✅ 共享模块 @blog/common 已定义</li>
</ul>
<p><strong>缺失的部分：</strong></p>
<ul>
<li>❌ 各服务模块的具体实现</li>
</ul>
<h4 data-id="heading-27">🧭 操作步骤</h4>
<blockquote>
<p>注: 也可直接下载源码, 如果克隆现有仓库</p>
</blockquote>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/pengtaohenry1213-prog/Blog
<span class="hljs-built_in">cd</span> blog-ssr
</code></pre>
<h5 data-id="heading-28">步骤 1：克隆或初始化项目</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如果是从头开始</span>
<span class="hljs-built_in">mkdir</span> blog-ssr &amp;&amp; <span class="hljs-built_in">cd</span> blog-ssr
git init
</code></pre>
<h5 data-id="heading-29">步骤 2：初始化根项目配置</h5>
<p>项目根目录执行: <code>pnpm init</code> 以创建package.json.
修改 <code>package.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"blog-ssr"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"全栈博客系统，支持 SSR 和后台管理"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"packageManager"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm@9.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"docker:up"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"docker compose -f docker/docker-compose.yml --env-file .env up -d"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker:down"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"docker compose -f docker/docker-compose.yml down"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"docker-dev:up"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"docker compose -f docker/docker-compose.dev.yml --env-file .env.development up -d"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker-dev:down"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"docker compose -f docker/docker-compose.dev.yml down"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker-dev:delete"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"docker compose -f docker/docker-compose.dev.yml --env-file .env.development down -v"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev:backend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm --filter @blog/backend run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev:frontend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm --filter @blog/frontend run dev"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-30">步骤 3：配置 pnpm 工作区</h5>
<p>创建 <code>touch pnpm-workspace.yaml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">packages:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">'packages/*'</span>
</code></pre>
<h5 data-id="heading-31">步骤 4：创建共享模块 <code>mkdir packages &amp;&amp; mkdir packages/common</code></h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p packages/common/{types,utils}
</code></pre>
<p>创建 <code>touch packages/common/package.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@blog/common"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Blog-SSR 共享模块"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exports"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"."</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./types/index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"./utils"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./utils/index.js"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>创建 <code>touch packages/common/types/index.js</code></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> {};
</code></pre>
<p>创建 <code>touch packages/common/utils/index.js</code></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 共享工具函数
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">formatDate</span>(<span class="hljs-params">date, format = <span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span></span>) {
  <span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(date);
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(d.<span class="hljs-title function_">getTime</span>())) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  }

  <span class="hljs-keyword">const</span> year = d.<span class="hljs-title function_">getFullYear</span>();
  <span class="hljs-keyword">const</span> month = <span class="hljs-title class_">String</span>(d.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
  <span class="hljs-keyword">const</span> day = <span class="hljs-title class_">String</span>(d.<span class="hljs-title function_">getDate</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
  <span class="hljs-keyword">const</span> hours = <span class="hljs-title class_">String</span>(d.<span class="hljs-title function_">getHours</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
  <span class="hljs-keyword">const</span> minutes = <span class="hljs-title class_">String</span>(d.<span class="hljs-title function_">getMinutes</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);
  <span class="hljs-keyword">const</span> seconds = <span class="hljs-title class_">String</span>(d.<span class="hljs-title function_">getSeconds</span>()).<span class="hljs-title function_">padStart</span>(<span class="hljs-number">2</span>, <span class="hljs-string">'0'</span>);

  <span class="hljs-keyword">return</span> format
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'YYYY'</span>, year)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'MM'</span>, month)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'DD'</span>, day)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'HH'</span>, hours)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'mm'</span>, minutes)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-string">'ss'</span>, seconds);
}
</code></pre>
<p>创建 <code>touch packages/common/index.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./types/index.js'</span>;
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/index.js'</span>;
</code></pre>
<h5 data-id="heading-32">步骤 5：安装根级开发依赖</h5>
<pre><code class="hljs language-bash" lang="bash">pnpm add -D -w eslint prettier lint-staged husky sass
</code></pre>
<h4 data-id="heading-33">📄 环境变量配置详解</h4>
<h4 data-id="heading-34">🎯 配置原则</h4>
<p>项目采用多环境配置策略：</p>
<ul>
<li><strong><code>.env.development</code></strong> - 开发环境配置（本地开发）</li>
<li><strong><code>.env</code></strong> - 生产环境配置（Docker 容器）</li>
</ul>
<h4 data-id="heading-35">🧭 配置步骤</h4>
<h5 data-id="heading-36">步骤 1：创建开发环境配置</h5>
<p>在项目根目录, 创建 <code>touch .env.development</code> 文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 后端服务配置</span>
NODE_ENV=development
HOST=0.0.0.0
PORT=3001

<span class="hljs-comment"># 数据库配置（Docker 容器）</span>
DB_HOST=localhost
DB_PORT=3306
DB_NAME=blog_db
DB_USER=blog_root
DB_PASSWORD=blog123

<span class="hljs-comment"># Redis 配置（Docker 容器）</span>
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=redis123

<span class="hljs-comment"># JWT 配置</span>
JWT_SECRET=dev_jwt_secret_key_for_development_only
JWT_EXPIRES_IN=7d

<span class="hljs-comment"># CORS 配置（允许前端访问）</span>
CORS_ORIGIN=http://localhost

<span class="hljs-comment"># Nuxt SSR 配置</span>
NUXT_PUBLIC_API_BASE_URL=http://localhost:3001/api
NUXT_PUBLIC_SITE_BASE=http://localhost:3000
NUXT_PUBLIC_SITE_NAME=个人博客

<span class="hljs-comment"># Docker 服务端口配置</span>
BACKEND_PORT=3001
FRONTEND_PORT=80
NUXT_PORT=3000
</code></pre>
<h5 data-id="heading-37">步骤 2：创建生产环境配置</h5>
<p>在项目根目录, 创建 <code>touch .env</code> 文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 生产环境配置（用于 Docker 容器间通信）</span>
NODE_ENV=production
...
</code></pre>
<h5 data-id="heading-38">步骤 3: 根目录附加配置文件</h5>
<p>创建: <code>touch .gitignore</code></p>
<h4 data-id="heading-39">🔐 安全注意事项</h4>
<ol>
<li><strong>JWT 密钥</strong>: 生产环境必须使用强随机密钥</li>
<li><strong>数据库密码</strong>: 使用复杂密码，避免默认值</li>
<li><strong>环境隔离</strong>: 不同环境使用不同的配置</li>
<li><strong>敏感信息</strong>: 不要将 <code>.env</code> 文件提交到版本控制</li>
</ol>
<hr/>
<h3 data-id="heading-40">阶段三: Docker 基础服务配置</h3>
<h4 data-id="heading-41">🎯 本阶段目标</h4>
<p>启动 MySQL 和 Redis 容器，为后端服务提供数据存储和缓存支持。</p>
<h4 data-id="heading-42">✅ 预期结果</h4>
<ul>
<li>MySQL 和 Redis 容器成功启动并运行</li>
<li>数据库初始化脚本自动执行，创建基础表结构</li>
<li>容器间网络互通，可通过服务名访问</li>
<li>数据持久化配置生效，重启后数据保留</li>
</ul>
<h4 data-id="heading-43">📏 验证标准</h4>









































<table><thead><tr><th>检查项</th><th>验证命令</th><th>期望结果</th></tr></thead><tbody><tr><td>容器状态</td><td><code>docker compose ps</code></td><td>mysql 和 redis 状态为 Up/Healthy</td></tr><tr><td>MySQL 连接</td><td><code>docker compose exec mysql mysql -uroot -pblog123 -e "SELECT 1;"</code></td><td>返回结果 <code>1</code></td></tr><tr><td>Redis 连接</td><td><code>docker compose exec redis redis-cli -a redis123 ping</code></td><td>返回 <code>PONG</code></td></tr><tr><td>数据库初始化</td><td><code>docker compose exec mysql mysql -ublog_root -pblog123 blog_db -e "SHOW TABLES;"</code></td><td>包含基础表结构</td></tr><tr><td>网络连接</td><td><code>docker compose exec mysql mysql -ublog_root -pblog123 -h mysql -e "SELECT 1;"</code></td><td>容器内网络正常</td></tr><tr><td>数据持久化</td><td>重启容器后数据保留</td><td><code>docker compose restart &amp;&amp; docker compose exec mysql mysql -ublog_root -pblog123 blog_db -e "SELECT COUNT(*) FROM users;"</code></td><td>数据未丢失</td></tr></tbody></table>
<h4 data-id="heading-44">📦 技术栈详情</h4>
<ul>
<li><strong>容器化</strong>: Docker + Docker Compose</li>
</ul>
<h4 data-id="heading-45">📋 环境依赖清单</h4>























<table><thead><tr><th>工具</th><th>版本要求</th><th>安装方式</th><th>验证命令</th></tr></thead><tbody><tr><td>Docker</td><td>≥ 24.0.0</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.docker.com%2Fproducts%2Fdocker-desktop" target="_blank" title="https://www.docker.com/products/docker-desktop" ref="nofollow noopener noreferrer">Docker Desktop</a></td><td><code>docker --version</code></td></tr><tr><td>Docker Compose</td><td>≥ 2.0.0</td><td>随 Docker Desktop</td><td><code>docker compose version</code></td></tr></tbody></table>
<h4 data-id="heading-46">📁 项目结构概览</h4>
<pre><code class="hljs language-bash" lang="bash">docker/
├── docker-compose.yml       <span class="hljs-comment"># 生产环境完整服务编排</span>
├── docker-compose.dev.yml   <span class="hljs-comment"># 开发环境服务配置</span>
└── scripts/
    └── init.sql            <span class="hljs-comment"># 数据库初始化脚本</span>
</code></pre>
<h4 data-id="heading-47">📋 服务配置说明</h4>


























<table><thead><tr><th>服务</th><th>镜像版本</th><th>容器端口</th><th>数据持久化</th><th>健康检查</th></tr></thead><tbody><tr><td>MySQL</td><td>8.0</td><td>3306</td><td>✅</td><td>✅</td></tr><tr><td>Redis</td><td>8.4.0</td><td>6379</td><td>✅</td><td>✅</td></tr></tbody></table>
<h4 data-id="heading-48">当前项目状态分析</h4>
<p>**已有的资源: **</p>
<ul>
<li>✅ Docker Compose 配置已创建</li>
<li>✅ MySQL 和 Redis 容器配置已定义</li>
<li>✅ 数据库初始化脚本已准备</li>
</ul>
<p>**缺失的部分: **</p>
<ul>
<li>❌ 应用服务容器配置（后端、前端、Nuxt）</li>
</ul>
<h5 data-id="heading-49">步骤 1: 配置 Docker Compose</h5>
<p><strong>项目已包含完整的 Docker 配置，直接使用即可。</strong></p>
<p>创建目录: <code>mkdir -p docker/{backend,frontend,nginx,nuxt,scripts}</code></p>
<p>创建 <code>touch docker/docker-compose.dev.yml</code>
参考 <code>docker/docker-compose.dev.yml</code> 文件，确保包含:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">mysql:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">blog-test-mysql2</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">${DB_PASSWORD}</span>
      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">${DB_NAME}</span>
      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">${DB_USER}</span>
      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">${DB_PASSWORD}</span>
    <span class="hljs-comment"># 👇 dev模式, 临时暴露端口用于本地开发</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${DB_PORT}:3306"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql_data:/var/lib/mysql</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./docker/scripts/init.sql:/docker-entrypoint-initdb.d/init.sql:ro</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">--default-authentication-plugin=caching_sha2_password</span> <span class="hljs-comment"># 设置默认 认证插件为 caching_sha2_password</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">blog-network</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"mysqladmin"</span>, <span class="hljs-string">"ping"</span>, <span class="hljs-string">"-h"</span>, <span class="hljs-string">"localhost"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">5s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">5</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:8.4.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">blog-test-redis2</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${REDIS_PORT:-6379}:6379"</span>  <span class="hljs-comment"># ✅ 正确暴露端口, 左侧: 使用环境变量 REDIS_PORT，如果未设置则默认为 6379; 右侧: 6379 - 容器内部的 Redis 端口</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">REDIS_PASSWORD=${REDIS_PASSWORD}</span> <span class="hljs-comment"># 指定 Redis 密码</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis_data:/data</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">blog-network</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">--appendonly</span> <span class="hljs-literal">yes</span> <span class="hljs-string">--requirepass</span> <span class="hljs-string">${REDIS_PASSWORD}</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"redis-cli"</span>, <span class="hljs-string">"ping"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">5s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">5</span>

<span class="hljs-comment"># 顶级 volumes 定义, 优点: 数据不会随容器删除; 更安全、可复用;</span>
<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">mysql_data:</span>
  <span class="hljs-attr">redis_data:</span>
  <span class="hljs-comment"># backend_logs:</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">blog-network:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
  <span class="hljs-attr">db-network:</span> <span class="hljs-comment"># 仅数据库/backend 可访问</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</code></pre>
<p>创建 <code>touch docker/scripts/init.sql</code>
参考 <code>docker/scripts/init.sql</code> 文件，确保包含:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 数据库初始化脚本</span>
<span class="hljs-comment">-- 此脚本会在 MySQL 容器首次启动时自动执行</span>

<span class="hljs-comment">-- 创建数据库（如果不存在）</span>
<span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> blog_db <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci;

USE blog_db;

<span class="hljs-comment">-- 注意: 表结构会由 Sequelize 自动创建</span>
<span class="hljs-comment">-- 这里创建索引以优化查询性能</span>
<span class="hljs-comment">-- 注意: MySQL 的 CREATE INDEX 不支持 IF NOT EXISTS，需要先检查索引是否存在</span>

<span class="hljs-comment">-- 为 users 表的 username 字段创建唯一索引（如果不存在）</span>
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@dbname</span> <span class="hljs-operator">=</span> DATABASE();
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@tablename</span> <span class="hljs-operator">=</span> <span class="hljs-string">'users'</span>;
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@indexname</span> <span class="hljs-operator">=</span> <span class="hljs-string">'idx_users_username'</span>;
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@preparedStatement</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> IF(
  (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.STATISTICS
    <span class="hljs-keyword">WHERE</span> table_schema <span class="hljs-operator">=</span> <span class="hljs-variable">@dbname</span>
    <span class="hljs-keyword">AND</span> table_name <span class="hljs-operator">=</span> <span class="hljs-variable">@tablename</span>
    <span class="hljs-keyword">AND</span> index_name <span class="hljs-operator">=</span> <span class="hljs-variable">@indexname</span>
  ) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>,
  <span class="hljs-string">'SELECT 1'</span>,
  CONCAT(<span class="hljs-string">'CREATE UNIQUE INDEX '</span>, <span class="hljs-variable">@indexname</span>, <span class="hljs-string">' ON '</span>, <span class="hljs-variable">@tablename</span>, <span class="hljs-string">'(username)'</span>)
));
<span class="hljs-keyword">PREPARE</span> stmt <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@preparedStatement</span>;
<span class="hljs-keyword">EXECUTE</span> stmt;
<span class="hljs-keyword">DEALLOCATE</span> <span class="hljs-keyword">PREPARE</span> stmt;

<span class="hljs-comment">-- 为 articles 表的 author_id、category_id、publish_time 字段创建联合索引（如果不存在）</span>
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@tablename</span> <span class="hljs-operator">=</span> <span class="hljs-string">'articles'</span>;
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@indexname</span> <span class="hljs-operator">=</span> <span class="hljs-string">'idx_articles_author_category_time'</span>;
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@preparedStatement</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> IF(
  (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.STATISTICS
    <span class="hljs-keyword">WHERE</span> table_schema <span class="hljs-operator">=</span> <span class="hljs-variable">@dbname</span>
    <span class="hljs-keyword">AND</span> table_name <span class="hljs-operator">=</span> <span class="hljs-variable">@tablename</span>
    <span class="hljs-keyword">AND</span> index_name <span class="hljs-operator">=</span> <span class="hljs-variable">@indexname</span>
  ) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>,
  <span class="hljs-string">'SELECT 1'</span>,
  CONCAT(<span class="hljs-string">'CREATE INDEX '</span>, <span class="hljs-variable">@indexname</span>, <span class="hljs-string">' ON '</span>, <span class="hljs-variable">@tablename</span>, <span class="hljs-string">'(author_id, category_id, publish_time)'</span>)
));
<span class="hljs-keyword">PREPARE</span> stmt <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@preparedStatement</span>;
<span class="hljs-keyword">EXECUTE</span> stmt;
<span class="hljs-keyword">DEALLOCATE</span> <span class="hljs-keyword">PREPARE</span> stmt;

<span class="hljs-comment">-- 为 articles 表的 publish_time 创建单独索引（用于排序，如果不存在）</span>
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@indexname</span> <span class="hljs-operator">=</span> <span class="hljs-string">'idx_articles_publish_time'</span>;
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@preparedStatement</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> IF(
  (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.STATISTICS
    <span class="hljs-keyword">WHERE</span> table_schema <span class="hljs-operator">=</span> <span class="hljs-variable">@dbname</span>
    <span class="hljs-keyword">AND</span> table_name <span class="hljs-operator">=</span> <span class="hljs-variable">@tablename</span>
    <span class="hljs-keyword">AND</span> index_name <span class="hljs-operator">=</span> <span class="hljs-variable">@indexname</span>
  ) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>,
  <span class="hljs-string">'SELECT 1'</span>,
  CONCAT(<span class="hljs-string">'CREATE INDEX '</span>, <span class="hljs-variable">@indexname</span>, <span class="hljs-string">' ON '</span>, <span class="hljs-variable">@tablename</span>, <span class="hljs-string">'(publish_time)'</span>)
));
<span class="hljs-keyword">PREPARE</span> stmt <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@preparedStatement</span>;
<span class="hljs-keyword">EXECUTE</span> stmt;
<span class="hljs-keyword">DEALLOCATE</span> <span class="hljs-keyword">PREPARE</span> stmt;

<span class="hljs-comment">-- 为 articles 表的 category_id 创建索引（用于分类查询，如果不存在）</span>
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@indexname</span> <span class="hljs-operator">=</span> <span class="hljs-string">'idx_articles_category_id'</span>;
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@preparedStatement</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> IF(
  (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.STATISTICS
    <span class="hljs-keyword">WHERE</span> table_schema <span class="hljs-operator">=</span> <span class="hljs-variable">@dbname</span>
    <span class="hljs-keyword">AND</span> table_name <span class="hljs-operator">=</span> <span class="hljs-variable">@tablename</span>
    <span class="hljs-keyword">AND</span> index_name <span class="hljs-operator">=</span> <span class="hljs-variable">@indexname</span>
  ) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>,
  <span class="hljs-string">'SELECT 1'</span>,
  CONCAT(<span class="hljs-string">'CREATE INDEX '</span>, <span class="hljs-variable">@indexname</span>, <span class="hljs-string">' ON '</span>, <span class="hljs-variable">@tablename</span>, <span class="hljs-string">'(category_id)'</span>)
));
<span class="hljs-keyword">PREPARE</span> stmt <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@preparedStatement</span>;
<span class="hljs-keyword">EXECUTE</span> stmt;
<span class="hljs-keyword">DEALLOCATE</span> <span class="hljs-keyword">PREPARE</span> stmt;

<span class="hljs-comment">-- 为 articles 表的 author_id 创建索引（用于作者查询，如果不存在）</span>
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@indexname</span> <span class="hljs-operator">=</span> <span class="hljs-string">'idx_articles_author_id'</span>;
<span class="hljs-keyword">SET</span> <span class="hljs-variable">@preparedStatement</span> <span class="hljs-operator">=</span> (<span class="hljs-keyword">SELECT</span> IF(
  (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> INFORMATION_SCHEMA.STATISTICS
    <span class="hljs-keyword">WHERE</span> table_schema <span class="hljs-operator">=</span> <span class="hljs-variable">@dbname</span>
    <span class="hljs-keyword">AND</span> table_name <span class="hljs-operator">=</span> <span class="hljs-variable">@tablename</span>
    <span class="hljs-keyword">AND</span> index_name <span class="hljs-operator">=</span> <span class="hljs-variable">@indexname</span>
  ) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>,
  <span class="hljs-string">'SELECT 1'</span>,
  CONCAT(<span class="hljs-string">'CREATE INDEX '</span>, <span class="hljs-variable">@indexname</span>, <span class="hljs-string">' ON '</span>, <span class="hljs-variable">@tablename</span>, <span class="hljs-string">'(author_id)'</span>)
));
<span class="hljs-keyword">PREPARE</span> stmt <span class="hljs-keyword">FROM</span> <span class="hljs-variable">@preparedStatement</span>;
<span class="hljs-keyword">EXECUTE</span> stmt;
<span class="hljs-keyword">DEALLOCATE</span> <span class="hljs-keyword">PREPARE</span> stmt;
</code></pre>
<h5 data-id="heading-50">步骤 2: 启动基础服务</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动 MySQL 和 Redis</span>
<span class="hljs-comment"># 使用 --env-file 参数直接指定环境文件，确保容器内能获取到正确的环境变量值</span>
docker compose -f docker/docker-compose.dev.yml --env-file .env.development up -d mysql redis
</code></pre>
<hr/>
<h3 data-id="heading-51">阶段四: 后端基础框架搭建</h3>
<h4 data-id="heading-52">🎯 本阶段目标</h4>
<p>搭建 Express + 中间件 + 工具函数的基础框架，为后续业务逻辑开发提供基础设施。</p>
<h4 data-id="heading-53">✅ 预期结果</h4>
<ul>
<li>Express 服务器成功启动，可监听指定端口</li>
<li>所有中间件正确配置并生效（CORS、Helmet、安全等）</li>
<li>健康检查接口返回详细的状态信息</li>
<li>日志系统正常工作，记录请求和错误信息</li>
<li>错误处理中间件正确捕获并格式化错误响应</li>
</ul>
<h4 data-id="heading-54">📏 验证标准</h4>


















































<table><thead><tr><th>检查项</th><th>验证命令</th><th>期望结果</th></tr></thead><tbody><tr><td>服务启动</td><td><code>cd packages/backend &amp;&amp; pnpm run dev</code></td><td>服务器成功启动，显示监听端口</td></tr><tr><td>健康检查</td><td><code>curl http://localhost:3001/api/health</code></td><td>返回包含状态信息的 JSON</td></tr><tr><td>CORS 配置</td><td>检查跨域请求</td><td>允许配置的域名访问</td></tr><tr><td>日志记录</td><td>查看 logs/ 目录</td><td>包含 combined.log 和 error.log</td></tr><tr><td>错误处理</td><td><code>curl http://localhost:3001/api/nonexistent</code></td><td>返回 404 错误，格式化响应</td></tr><tr><td>中间件顺序</td><td>检查请求日志</td><td>请求按正确顺序通过中间件</td></tr><tr><td>内存监控</td><td>健康检查响应</td><td>包含 RSS、堆内存等指标</td></tr><tr><td>环境变量</td><td>检查配置加载</td><td>不同环境加载对应配置</td></tr></tbody></table>
<h4 data-id="heading-55">📦 技术栈详情</h4>
<ul>
<li><strong>后端框架</strong>: Node.js 18+ + Express 5.2.1</li>
<li><strong>数据库</strong>: MySQL 8.0 + Sequelize 6.37.7 ORM</li>
<li><strong>缓存</strong>: Redis 8.4.0</li>
<li><strong>认证授权</strong>: JWT + bcryptjs</li>
<li><strong>安全防护</strong>: Helmet + CORS + 限流
<ul>
<li>Winston: 日志系统</li>
<li>CORS: 跨域处理</li>
<li>Helmet: 安全中间件</li>
<li>bcryptjs: 密码哈希（加密）库</li>
</ul>
</li>
<li><strong>日志系统</strong>: Winston</li>
<li><strong>API文档</strong>: Swagger</li>
<li><strong>容器化</strong>: Docker + Docker Compose</li>
<li><strong>代码规范</strong>: ESLint + Prettier + Husky + lint-staged</li>
<li><strong>包管理</strong>: pnpm workspaces (monorepo)</li>
<li><strong>时间处理</strong>: Day.js</li>
<li><strong>工具库</strong>: Lodash-es + 共享工具模块</li>
</ul>
<h4 data-id="heading-56">📋 环境依赖清单</h4>









































<table><thead><tr><th>工具</th><th>版本要求</th><th>安装方式</th><th>验证命令</th></tr></thead><tbody><tr><td>Node.js</td><td>≥ 18.0.0</td><td>已安装</td><td><code>node --version</code></td></tr><tr><td>npm/pnpm</td><td>≥ 9.0.0</td><td>已安装</td><td><code>pnpm --version</code></td></tr><tr><td>MySQL</td><td>8.0</td><td>Docker 容器</td><td><code>docker ps</code></td></tr><tr><td>Redis</td><td>8.4.0</td><td>Docker 容器</td><td><code>docker ps</code></td></tr><tr><td>bcryptjs</td><td>3.0.3</td><td><code>pnpm add bcryptjs</code></td><td>已安装</td></tr></tbody></table>
<h4 data-id="heading-57">🧭 操作步骤</h4>
<h5 data-id="heading-58">步骤 1: 项目结构初始化</h5>
<p>**主要依赖包（已配置）: **</p>
<ul>
<li><strong>Web框架</strong>: Express 4.18.2</li>
<li><strong>安全</strong>: Helmet 7.1.0 + CORS 2.8.5</li>
<li><strong>日志</strong>: Winston 3.11.0</li>
<li><strong>工具</strong>: dayjs 1.11.10, debug 4.3.4</li>
</ul>
<h5 data-id="heading-59">步骤 1.5: 从零开始创建（可选）</h5>
<p>如果需要重新创建后端项目，以下是具体的创建步骤:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 初始化后端项目</span>
<span class="hljs-built_in">mkdir</span> packages/backend
<span class="hljs-built_in">cd</span> packages/backend
pnpm init

<span class="hljs-comment"># 2. 安装核心依赖</span>
pnpm add express mysql2 redis sequelize bcryptjs jsonwebtoken cors helmet
pnpm add express-rate-limit express-validator winston dotenv swagger-jsdoc swagger-ui-express
pnpm add debug dayjs

<span class="hljs-comment"># 3. 安装开发依赖</span>
pnpm add -D eslint nodemon

<span class="hljs-comment"># 4. 创建 package.json 脚本</span>
<span class="hljs-comment"># 修改 package.json 添加 scripts 字段</span>
<span class="hljs-string">"main"</span>: <span class="hljs-string">"app.js"</span>,
<span class="hljs-string">"type"</span>: <span class="hljs-string">"module"</span>,
<span class="hljs-string">"scripts"</span>: {
  <span class="hljs-string">"dev"</span>: <span class="hljs-string">"node --watch app.js"</span>,
  <span class="hljs-string">"start"</span>: <span class="hljs-string">"node app.js"</span>,
  <span class="hljs-string">"init-db"</span>: <span class="hljs-string">"node scripts/init-db.js"</span>,
  <span class="hljs-string">"check-indexes"</span>: <span class="hljs-string">"node scripts/check-indexes.js"</span>
},

<span class="hljs-comment"># 5. 核心目录结构</span>
<span class="hljs-built_in">mkdir</span> -p config models modules middleware utils scripts logs
<span class="hljs-comment"># 然后创建相应的文件和配置</span>
</code></pre>
<h5 data-id="heading-60">步骤 2: 配置文件搭建</h5>
<p>创建 <code>touch config/index.js</code>:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;

<span class="hljs-comment">// 加载环境变量</span>
<span class="hljs-keyword">const</span> env = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> || <span class="hljs-string">'development'</span>;
<span class="hljs-keyword">const</span> envFiles = [
  <span class="hljs-string">'../../.env.local'</span>,        <span class="hljs-comment">// 本地覆盖（最高优先级）</span>
  <span class="hljs-string">`../../.env.<span class="hljs-subst">${env}</span>`</span>,       <span class="hljs-comment">// 环境特定配置</span>
  <span class="hljs-string">'../../.env'</span>               <span class="hljs-comment">// 默认配置</span>
];

envFiles.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">file</span> =&gt;</span> {
  <span class="hljs-keyword">try</span> {
    dotenv.<span class="hljs-title function_">config</span>({ <span class="hljs-attr">path</span>: file });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// 静默跳过不存在的文件</span>
  }
});

<span class="hljs-comment">// 配置对象</span>
<span class="hljs-keyword">const</span> config = {
  <span class="hljs-comment">// env config</span>
  <span class="hljs-attr">env</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span>,

  <span class="hljs-comment">// server config</span>
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">host</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">HOST</span>,
    <span class="hljs-attr">port</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span>
  },

  <span class="hljs-comment">// db config</span>
  <span class="hljs-attr">database</span>: {
    <span class="hljs-attr">host</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_HOST</span>,
    <span class="hljs-attr">port</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_PORT</span>,
    <span class="hljs-attr">name</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_NAME</span>,
    <span class="hljs-attr">user</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_USER</span>,
    <span class="hljs-attr">password</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">DB_PASSWORD</span>,
    <span class="hljs-attr">pool</span>: {
      <span class="hljs-attr">max</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span> ? <span class="hljs-number">10</span> : <span class="hljs-number">5</span>,
      <span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">acquire</span>: <span class="hljs-number">30000</span>,
      <span class="hljs-attr">idle</span>: <span class="hljs-number">10000</span>
    }
  },

  <span class="hljs-comment">// redis cache config</span>
  <span class="hljs-attr">redis</span>: {
    <span class="hljs-attr">host</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">REDIS_HOST</span>,
    <span class="hljs-attr">port</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">REDIS_PORT</span>,
    <span class="hljs-attr">password</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">REDIS_PASSWORD</span>,
  },

  <span class="hljs-comment">// cors config - cors 是用来解决 跨域资源共享</span>
  <span class="hljs-comment">// 用于配置 cors: 跨域资源共享 (CORS) 的配置</span>
  <span class="hljs-attr">cors</span>: {
    <span class="hljs-comment">// origin: process.env.CORS_ORIGIN,</span>
    <span class="hljs-attr">origin</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">origin, callback</span>) {
      <span class="hljs-comment">// 允许没有 origin 的请求（比如移动端应用或 Postman 测试）</span>
      <span class="hljs-keyword">if</span> (!origin) <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);
      
      <span class="hljs-keyword">const</span> isProduct = process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>;
      <span class="hljs-keyword">if</span> (isProduct) {
        <span class="hljs-keyword">const</span> corsOrigin = process.<span class="hljs-property">env</span>.<span class="hljs-property">CORS_ORIGIN</span> || <span class="hljs-string">''</span>;
        <span class="hljs-comment">// 生产环境: 只允许 corsOrigin 里指定的 访问源</span>
        <span class="hljs-keyword">const</span> allowedOrigins = corsOrigin ? corsOrigin.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>) : [];
        <span class="hljs-keyword">if</span> (allowedOrigins.<span class="hljs-title function_">includes</span>(origin)) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);
        }
        <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 拒绝不在允许列表中的 origin</span>
          <span class="hljs-keyword">const</span> msg = <span class="hljs-string">`该网站的CORS策略不允许从指定的源访问: <span class="hljs-subst">${origin}</span>`</span>;
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(msg), <span class="hljs-literal">false</span>);
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 开发环境, 全部放行</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">callback</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>);
      }
    },
    <span class="hljs-attr">credentials</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 允许发送 cookies 和认证信息</span>
  },

  <span class="hljs-comment">// logger config</span>
  <span class="hljs-attr">logging</span>: {
    <span class="hljs-attr">level</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span> ? <span class="hljs-string">'info'</span> : <span class="hljs-string">'debug'</span>,
    <span class="hljs-attr">file</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">'production'</span>
  }
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> config;
</code></pre>
<p>创建 <code>touch config/database.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Sequelize</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'sequelize'</span>;
<span class="hljs-keyword">import</span> config <span class="hljs-keyword">from</span> <span class="hljs-string">'./index.js'</span>;

<span class="hljs-keyword">const</span> options = {
  <span class="hljs-attr">host</span>: config.<span class="hljs-property">database</span>.<span class="hljs-property">host</span>,
  <span class="hljs-attr">port</span>: config.<span class="hljs-property">database</span>.<span class="hljs-property">port</span>,
  <span class="hljs-attr">database</span>: config.<span class="hljs-property">database</span>.<span class="hljs-property">name</span>,
  <span class="hljs-attr">username</span>: config.<span class="hljs-property">database</span>.<span class="hljs-property">user</span>,
  <span class="hljs-attr">password</span>: config.<span class="hljs-property">database</span>.<span class="hljs-property">password</span>,
  <span class="hljs-attr">dialect</span>: <span class="hljs-string">'mysql'</span>,
  <span class="hljs-attr">logging</span>: config.<span class="hljs-property">env</span> === <span class="hljs-string">'development'</span> ? <span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span> : <span class="hljs-literal">false</span>,
  <span class="hljs-attr">pool</span>: config.<span class="hljs-property">database</span>.<span class="hljs-property">pool</span>,
  <span class="hljs-attr">timezone</span>: <span class="hljs-string">'+08:00'</span>
};

<span class="hljs-keyword">const</span> sequelize = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sequelize</span>(options);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> sequelize;
</code></pre>
<h5 data-id="heading-61">步骤 3：工具函数创建</h5>
<p>创建 <code>touch utils/logger.js</code>：</p>
<h5 data-id="heading-62">步骤 4：中间件创建</h5>
<p>创建 <code>touch middleware/requestLogger.js</code>：</p>
<p>创建 <code>touch middleware/errorHandler.js</code>：</p>
<h5 data-id="heading-63">步骤 5：应用入口创建</h5>
<p>创建 <code>touch app.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>;
<span class="hljs-keyword">import</span> cors <span class="hljs-keyword">from</span> <span class="hljs-string">'cors'</span>;
<span class="hljs-keyword">import</span> helmet <span class="hljs-keyword">from</span> <span class="hljs-string">'helmet'</span>;

<span class="hljs-comment">// process.env 在 ./config/index.js 里处理</span>
<span class="hljs-keyword">import</span> config <span class="hljs-keyword">from</span> <span class="hljs-string">'./config/index.js'</span>;
<span class="hljs-keyword">import</span> sequelize <span class="hljs-keyword">from</span> <span class="hljs-string">'./config/database.js'</span>; <span class="hljs-comment">// 导入数据库连接</span>
<span class="hljs-keyword">import</span> logger <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/logger.js'</span>;

<span class="hljs-comment">/* 
  导入所有模型，确保所有 Sequelize 模型在应用启动时被正确注册和初始化。
  具体作用：
    1. 模型注册 - 让 Sequelize 识别所有定义的数据库模型（User、Article、Category 等）
    2. 关联关系建立 - 执行模型之间的关联关系（如外键、一对多、多对多关系）
    3. 数据库同步支持 - 为后续的 sequelize.sync() 操作提供完整的模型信息，确保数据库表结构能正确创建或更新
    4. 副作用执行 - 即使没有直接使用导入的内容，也会执行 models/index.js 文件中的所有初始化代码
  这是 Sequelize 应用的标准做法，必须在数据库连接和同步之前完成模型的注册。
*/</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'./models/index.js'</span>;

<span class="hljs-keyword">import</span> { requestLogger } <span class="hljs-keyword">from</span> <span class="hljs-string">'./middleware/requestLogger.js'</span>; <span class="hljs-comment">// 导入请求日志记录器</span>
<span class="hljs-keyword">import</span> { errorHandler, notFoundHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">'./middleware/errorHandler.js'</span>; <span class="hljs-comment">// 错误处理中间件</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = config.<span class="hljs-property">server</span>.<span class="hljs-property">port</span>;

<span class="hljs-comment">// 中间件配置</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">helmet</span>({
  <span class="hljs-attr">contentSecurityPolicy</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 禁用CSP, 由前端 vite-plugin-csp 和 nginx 处理</span>
})); <span class="hljs-comment">// 安全中间件 - helmet: 设置各种 HTTP 头以增强安全性</span>

app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>(config.<span class="hljs-property">cors</span>)); <span class="hljs-comment">// cors: 跨域资源共享 (CORS)</span>

<span class="hljs-comment">// 安全中间件 - cors: 跨域资源共享 (CORS)</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>()); <span class="hljs-comment">// 解析请求体(JSON)</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">urlencoded</span>({ <span class="hljs-attr">extended</span>: <span class="hljs-literal">true</span> })); <span class="hljs-comment">// 解析请求体(URL 编码)</span>
app.<span class="hljs-title function_">use</span>(requestLogger); <span class="hljs-comment">// 请求日志（requestLogger）</span>

<span class="hljs-comment">// 健康检查接口 - 动态检测各项服务状态</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/health'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'健康检查开始'</span>);

  <span class="hljs-comment">// 初始化状态变量</span>
  <span class="hljs-keyword">let</span> dbStatus = <span class="hljs-string">'disconnected'</span>;
  <span class="hljs-keyword">let</span> redisStatus = <span class="hljs-string">'disconnected'</span>;
  <span class="hljs-keyword">let</span> overallStatus = <span class="hljs-string">'healthy'</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 1. 检查 MySQL 数据库连接</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 动态导入数据库连接（避免循环依赖）</span>
      <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: sequelize } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./config/database.js'</span>);
      <span class="hljs-keyword">await</span> sequelize.<span class="hljs-title function_">authenticate</span>();
      dbStatus = <span class="hljs-string">'connected'</span>;
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'✅ 数据库连接正常'</span>);
    } <span class="hljs-keyword">catch</span> (dbError) {
      logger.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'❌ 数据库连接失败:'</span>, dbError.<span class="hljs-property">message</span>);
      dbStatus = <span class="hljs-string">'disconnected'</span>;
      overallStatus = <span class="hljs-string">'degraded'</span>; <span class="hljs-comment">// 降级但不致命</span>
    }

    <span class="hljs-comment">// 2. 检查 Redis 连接（如果已配置）</span>
    

    <span class="hljs-comment">// 3. 获取内存使用情况</span>
    <span class="hljs-keyword">const</span> memUsage = process.<span class="hljs-title function_">memoryUsage</span>();
    <span class="hljs-keyword">const</span> memoryInfo = {
      <span class="hljs-attr">rss</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.round(memUsage.rss / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>)}</span>MB`</span>,           <span class="hljs-comment">// 常驻内存</span>
      <span class="hljs-attr">heapTotal</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.round(memUsage.heapTotal / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>)}</span>MB`</span>, <span class="hljs-comment">// 堆内存总量</span>
      <span class="hljs-attr">heapUsed</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.round(memUsage.heapUsed / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>)}</span>MB`</span>,   <span class="hljs-comment">// 已用堆内存</span>
      <span class="hljs-attr">external</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.round(memUsage.external / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>)}</span>MB`</span>    <span class="hljs-comment">// 外部内存</span>
    };

    <span class="hljs-comment">// 4. 构建响应数据</span>
    <span class="hljs-keyword">const</span> healthData = {
      <span class="hljs-attr">status</span>: overallStatus,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
      <span class="hljs-attr">uptime</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.round(process.uptime())}</span>s`</span>,
      <span class="hljs-attr">version</span>: process.<span class="hljs-property">version</span>,
      <span class="hljs-attr">environment</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> || <span class="hljs-string">'development'</span>,
      <span class="hljs-attr">database</span>: dbStatus,
      <span class="hljs-attr">memory</span>: memoryInfo,
      <span class="hljs-attr">pid</span>: process.<span class="hljs-property">pid</span>
    };

    <span class="hljs-comment">// 5. 根据整体状态返回相应的 HTTP 状态码</span>
    <span class="hljs-keyword">const</span> httpStatus = overallStatus === <span class="hljs-string">'healthy'</span> ? <span class="hljs-number">200</span> : <span class="hljs-number">503</span>;

    res.<span class="hljs-title function_">status</span>(httpStatus).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: httpStatus,
      <span class="hljs-attr">message</span>: overallStatus === <span class="hljs-string">'healthy'</span> ? <span class="hljs-string">'服务正常'</span> : <span class="hljs-string">'服务部分异常'</span>,
      <span class="hljs-attr">data</span>: healthData
    });

    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`🏥 健康检查完成 - 状态: <span class="hljs-subst">${overallStatus}</span>`</span>);

  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-comment">// 捕获所有未预期的错误</span>
    logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">`💥 健康检查发生严重错误: <span class="hljs-subst">${error.message}</span>`</span>, {
      <span class="hljs-attr">stack</span>: error.<span class="hljs-property">stack</span>,
      <span class="hljs-attr">uptime</span>: process.<span class="hljs-title function_">uptime</span>(),
      <span class="hljs-attr">memory</span>: process.<span class="hljs-title function_">memoryUsage</span>()
    });

    <span class="hljs-comment">// 返回服务不可用状态</span>
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">503</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-number">503</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'服务异常'</span>,
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">status</span>: <span class="hljs-string">'unhealthy'</span>,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
        <span class="hljs-attr">uptime</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.round(process.uptime())}</span>s`</span>,
        <span class="hljs-attr">version</span>: process.<span class="hljs-property">version</span>,
        <span class="hljs-attr">environment</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> || <span class="hljs-string">'development'</span>,
        <span class="hljs-attr">database</span>: dbStatus,
        <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>,
        <span class="hljs-attr">pid</span>: process.<span class="hljs-property">pid</span>
      }
    });
  }
});

<span class="hljs-comment">// 错误处理</span>
app.<span class="hljs-title function_">use</span>(notFoundHandler);   <span class="hljs-comment">// 处理 404 错误</span>
app.<span class="hljs-title function_">use</span>(errorHandler);      <span class="hljs-comment">// 全局错误处理</span>

<span class="hljs-comment">// 启动服务</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">startServer</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// ✅ 验证 MySQL 连接可用</span>
    <span class="hljs-comment">// 动态导入数据库连接（避免循环依赖）</span>
      <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: sequelize } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./config/database.js'</span>);
    <span class="hljs-keyword">await</span> sequelize.<span class="hljs-title function_">authenticate</span>();
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'数据库连接成功'</span>);

    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`服务器运行在 http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);

    <span class="hljs-comment">// ✅ 同步 Sequelize 模型（开发环境）</span>
    <span class="hljs-keyword">if</span> (config.<span class="hljs-property">env</span> === <span class="hljs-string">'development'</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> sequelize.<span class="hljs-title function_">sync</span>({ <span class="hljs-attr">alter</span>: <span class="hljs-literal">true</span> });
        <span class="hljs-comment">// await sequelize.sync({ force: true });</span>
        logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'数据库模型已同步'</span>);
      } <span class="hljs-keyword">catch</span> (syncError) {
        logger.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'数据库模型同步失败（可能是表结构已存在）：'</span>, syncError.<span class="hljs-property">message</span>);
        logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'继续启动服务器...'</span>);
      }
    }

    <span class="hljs-comment">// ✅ 监听指定端口（默认 3001）</span>
    <span class="hljs-comment">// ✅ 输出启动成功日志</span>
    app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'🚀 服务器启动成功！'</span>, config.<span class="hljs-property">env</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>));
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📍 服务地址: http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`📚 API 文档: http://localhost:<span class="hljs-subst">${PORT}</span>/api-docs`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`🏥 健康检查: http://localhost:<span class="hljs-subst">${PORT}</span>/api/health`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'='</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">60</span>) + <span class="hljs-string">'\n'</span>);
      
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`服务器运行在 http://localhost:<span class="hljs-subst">${PORT}</span>`</span>);
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`API 文档: http://localhost:<span class="hljs-subst">${PORT}</span>/api-docs`</span>);
    });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n⚠️  服务器启动失败，请解决上述问题后重试\n'</span>);
    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
  }
};

<span class="hljs-comment">// 执行启动服务器</span>
<span class="hljs-title function_">startServer</span>();
</code></pre>
<hr/>
<h3 data-id="heading-64">阶段五：数据库设计与初始化</h3>
<h4 data-id="heading-65">🎯 本阶段目标</h4>
<p>创建数据库表结构，初始化基础数据。</p>
<h4 data-id="heading-66">✅ 预期结果</h4>
<ul>
<li>Sequelize 模型正确定义，包含所有必要字段</li>
<li>数据库表结构自动创建或同步成功</li>
<li>基础数据（管理员用户、分类等）正确插入</li>
<li>数据库索引优化配置生效</li>
<li>密码加密工具正常工作</li>
</ul>
<h4 data-id="heading-67">📏 验证标准</h4>













































<table><thead><tr><th>检查项</th><th>验证命令</th><th>期望结果</th></tr></thead><tbody><tr><td>表结构同步</td><td><code>cd packages/backend &amp;&amp; pnpm run init-db</code></td><td>无错误，显示同步成功</td></tr><tr><td>模型定义</td><td>检查 models/ 目录</td><td>包含 User.js, Category.js 等模型文件</td></tr><tr><td>基础数据</td><td>查询数据库</td><td>包含管理员用户和默认分类</td></tr><tr><td>密码加密</td><td>测试 hashPassword 函数</td><td>密码正确加密和验证</td></tr><tr><td>数据库索引</td><td><code>SHOW INDEX FROM users;</code></td><td>包含必要的索引</td></tr><tr><td>外键关系</td><td>检查表结构</td><td>模型间的关联关系正确</td></tr><tr><td>数据完整性</td><td>插入测试数据</td><td>无约束冲突，数据正确存储</td></tr></tbody></table>
<h4 data-id="heading-68">📦 技术栈详情</h4>
<ul>
<li><strong>数据库</strong>: MySQL 8.0 + Sequelize 6.37.7 ORM</li>
</ul>
<h4 data-id="heading-69">🧭 操作步骤</h4>
<h5 data-id="heading-70">步骤 1：创建utils工具脚本</h5>
<p>创建 <code>touch utils/bcrypt.js</code>：</p>
<h5 data-id="heading-71">步骤 2：创建数据模型</h5>
<p>创建 <code>touch models/User.js</code>:</p>
<p>创建 <code>touch models/Category.js</code>:</p>
<p>创建 <code>touch models/index.js</code>:</p>
<h5 data-id="heading-72">步骤 3：创建初始化脚本</h5>
<p>创建 <code>touch scripts/init-db.js</code>：</p>
<h5 data-id="heading-73">步骤 4：运行初始化脚本</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> packages/backend
pnpm run init-db
</code></pre>
<hr/>
<h3 data-id="heading-74">阶段六：JWT认证系统</h3>
<h4 data-id="heading-75">🎯 本阶段目标</h4>
<p>JWT认证系统实现方案: 构建 backend + frontend 的JWT登录管理</p>
<h4 data-id="heading-76">✅ 预期结果</h4>
<ul>
<li>用户注册、登录、登出功能完整实现</li>
<li>JWT token 正确生成、验证和过期处理</li>
<li>权限控制中间件按角色正确过滤访问</li>
<li>密码安全加密存储，支持验证</li>
<li>认证失败时返回适当的错误信息</li>
</ul>
<h4 data-id="heading-77">📏 验证标准</h4>













































<table><thead><tr><th>检查项</th><th>验证命令</th><th>期望结果</th></tr></thead><tbody><tr><td>用户注册</td><td><code>curl -X POST http://localhost:3001/api/auth/register -d '{"username":"test","password":"123456"}'</code></td><td>返回 201 状态和 token</td></tr><tr><td>用户登录</td><td><code>curl -X POST http://localhost:3001/api/auth/login -d '{"username":"admin","password":"admin123"}'</code></td><td>返回 200 状态和 token</td></tr><tr><td>JWT 验证</td><td>带 token 访问受保护接口</td><td>返回用户数据，无 401 错误</td></tr><tr><td>权限控制</td><td>普通用户访问管理员接口</td><td>返回 403 权限不足错误</td></tr><tr><td>Token 过期</td><td>使用过期 token 访问</td><td>返回 401 无效令牌错误</td></tr><tr><td>密码验证</td><td>错误的密码登录</td><td>返回 401 用户名或密码错误</td></tr><tr><td>用户信息获取</td><td>GET /api/users/current</td><td>返回当前用户信息</td></tr></tbody></table>
<h4 data-id="heading-78">📦 技术栈详情</h4>
<ul>
<li><strong>认证授权</strong>: JWT + bcryptjs</li>
<li><strong>jsonwebtoken</strong>: JWT token生成和验证</li>
<li><strong>bcryptjs</strong>: 密码哈希加密</li>
<li><strong>express-validator</strong>: 他是 Node.js/Express 生态中处理请求参数校验和数据验证的核心中间件库，专门解决后端接口的参数合法性问题</li>
</ul>
<h4 data-id="heading-79">📋 环境依赖清单</h4>





























<table><thead><tr><th>工具</th><th>版本要求</th><th>安装方式</th><th>验证命令</th></tr></thead><tbody><tr><td>jsonwebtoken</td><td>9.0.3</td><td><code>pnpm add jsonwebtoken</code></td><td>已安装</td></tr><tr><td>bcryptjs</td><td>3.0.3</td><td><code>pnpm add bcryptjs</code></td><td>已安装</td></tr><tr><td>express-validator</td><td>7.3.1</td><td><code>pnpm add express-validator</code></td><td>已安装</td></tr></tbody></table>
<h4 data-id="heading-80">🧭 操作步骤</h4>
<h5 data-id="heading-81">步骤 1：更新环境变量配置</h5>
<p>检查在 <code>.env</code> 和 <code>.evn.development</code> 文件中是否添加JWT配置：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># JWT配置</span>
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=7d
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-comment">// jwt config</span>
  <span class="hljs-attr">jwt</span>: {
    <span class="hljs-attr">secret</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">JWT_SECRET</span>,
    <span class="hljs-attr">expiresIn</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">JWT_EXPIRES_IN</span>
  },
  <span class="hljs-attr">cors</span>: { ... }
</code></pre>
<h5 data-id="heading-82">步骤 2：创建JWT工具函数 和 Redis 缓存工具类(cache.js)</h5>
<p>首先创建JWT相关的工具函数：
进入服务端代码目录: <code>cd packages/backend</code>
创建 <code>touch utils/jwt.js</code></p>
<h5 data-id="heading-83">步骤 3：创建认证中间件 和 express-validator 中间件</h5>
<p>创建: <code>touch middleware/auth.js</code></p>
<p>创建: <code>touch middleware/validator.js</code></p>
<h5 data-id="heading-84">步骤 4：创建Auth控制器、路由 和 服务</h5>
<p>创建modules所需目录: <code>mkdir -p modules/{auth,user,article,stats}</code></p>
<p><strong>4.1 创建控制器</strong>
创建: <code>touch modules/auth/controller.js</code></p>
<p><strong>4.2 创建路由</strong>
创建: <code>touch modules/auth/router.js</code></p>
<p><strong>4.2 创建Auth服务(通过Sequelize与MySQL通信)</strong>
创建: <code>touch modules/auth/service.js</code></p>
<h5 data-id="heading-85">步骤 5：创建User控制器、路由 和 服务</h5>
<p>创建: <code>touch modules/user/controller.js</code></p>
<p>创建: <code>touch modules/user/router.js</code></p>
<p>创建: <code>touch modules/user/service.js</code></p>
<h5 data-id="heading-86">步骤 6：app.js 路由补全</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 导入路由</span>
<span class="hljs-keyword">import</span> userRouter <span class="hljs-keyword">from</span> <span class="hljs-string">'./modules/user/router.js'</span>; <span class="hljs-comment">// 用户路由</span>
<span class="hljs-keyword">import</span> authRouter <span class="hljs-keyword">from</span> <span class="hljs-string">'./modules/auth/router.js'</span>; <span class="hljs-comment">// 认证路由</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
...

<span class="hljs-comment">// 使用路由 - API 路由, 业务路由挂载</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/api/users'</span>, userRouter); <span class="hljs-comment">// 用户模块, 用户注册、登录、信息管理</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/api/auth'</span>, authRouter); <span class="hljs-comment">// 认证模块, 身份认证、权限控制、Token 管理</span>
</code></pre>
<h5 data-id="heading-87">步骤 7：测试认证系统</h5>
<p>创建测试用户后，可以测试以下接口：</p>
<ul>
<li>在packages/backend项根目录 重新启动服务: <code>npm run dev</code></li>
<li>在packages/backend项根目录 创建 <code>touch test-users.sh</code> 文件</li>
<li>编辑此文件</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">  <span class="hljs-comment">#!/bin/bash</span>

  <span class="hljs-comment"># 服务器地址</span>
  BASE_URL=<span class="hljs-string">"http://localhost:3001"</span>

  <span class="hljs-comment"># 登录获取 token</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"=== 登录获取 Token ==="</span>
  LOGIN_RESPONSE=$(curl -s -X POST <span class="hljs-variable">$BASE_URL</span>/api/auth/login \
    -H <span class="hljs-string">"Content-Type: application/json"</span> \
    -d <span class="hljs-string">'{"username":"admin","password":"admin123"}'</span>)

  TOKEN=$(<span class="hljs-built_in">echo</span> <span class="hljs-variable">$LOGIN_RESPONSE</span> | jq -r <span class="hljs-string">'.data.token'</span>)
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"Token: <span class="hljs-variable">$TOKEN</span>"</span>

  <span class="hljs-comment"># 测试各个接口</span>
  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n=== 获取当前用户信息 ==="</span>
  curl -X GET <span class="hljs-variable">$BASE_URL</span>/api/users/current \
    -H <span class="hljs-string">"Authorization: Bearer <span class="hljs-variable">$TOKEN</span>"</span> | jq

  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n=== 获取用户列表 ==="</span>
  curl -X GET <span class="hljs-string">"<span class="hljs-variable">$BASE_URL</span>/api/users?page=1&amp;pageSize=5"</span> \
    -H <span class="hljs-string">"Authorization: Bearer <span class="hljs-variable">$TOKEN</span>"</span> | jq

  <span class="hljs-built_in">echo</span> -e <span class="hljs-string">"\n=== 获取用户详情 (ID=1) ==="</span>
  curl -X GET <span class="hljs-variable">$BASE_URL</span>/api/users/1 \
    -H <span class="hljs-string">"Authorization: Bearer <span class="hljs-variable">$TOKEN</span>"</span> | jq
</code></pre>
<ul>
<li>给脚本添加执行权限: <code>chmod +x test-users.sh</code></li>
<li>执行脚本, 使用 bash 命令运行: <code>bash test-users.sh</code></li>
<li>预期输出示例</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">=== 登录获取 Token ===
Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

=== 获取当前用户信息 ===
{
  <span class="hljs-string">"code"</span>: 200,
  <span class="hljs-string">"message"</span>: <span class="hljs-string">"获取成功"</span>,
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"id"</span>: 1,
    <span class="hljs-string">"username"</span>: <span class="hljs-string">"admin"</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"admin@example.com"</span>,
    <span class="hljs-string">"role"</span>: <span class="hljs-string">"admin"</span>,
    <span class="hljs-string">"status"</span>: <span class="hljs-string">"active"</span>
  }
}

=== 获取用户列表 ===
{
  <span class="hljs-string">"code"</span>: 200,
  <span class="hljs-string">"message"</span>: <span class="hljs-string">"获取成功"</span>,
  <span class="hljs-string">"data"</span>: {
    <span class="hljs-string">"list"</span>: [...],
    <span class="hljs-string">"total"</span>: 1,
    <span class="hljs-string">"page"</span>: 1,
    <span class="hljs-string">"pageSize"</span>: 5,
    <span class="hljs-string">"totalPages"</span>: 1
  }
}
</code></pre>
<h4 data-id="heading-88">✅ 实际测试验证</h4>
<p>完成 JWT 认证系统搭建后，让我们进行完整的 API 测试验证，确保所有功能正常工作。</p>
<h5 data-id="heading-89">测试环境准备</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 确保基础服务运行</span>
pnpm run docker-dev:up

<span class="hljs-comment"># 2. 启动后端服务</span>
<span class="hljs-built_in">cd</span> packages/backend
pnpm run dev

<span class="hljs-comment"># 3. 验证健康检查</span>
curl http://localhost:3001/api/health | jq
<span class="hljs-comment"># 应返回数据库连接状态正常</span>
</code></pre>
<hr/>
<h3 data-id="heading-90">阶段七：Redis初始化</h3>
<h4 data-id="heading-91">🎯 本阶段目标</h4>
<p>集成 Redis 缓存服务，实现数据缓存、会话管理等功能。</p>
<h4 data-id="heading-92">✅ 预期结果</h4>
<ul>
<li>Redis 连接配置正确，客户端成功连接</li>
<li>缓存服务类实现完整的 CRUD 操作</li>
<li>健康检查包含 Redis 连接状态</li>
<li>Token 存储到 Redis，支持会话管理</li>
<li>缓存数据在重启后可恢复</li>
</ul>
<h4 data-id="heading-93">📏 验证标准</h4>













































<table><thead><tr><th>检查项</th><th>验证命令</th><th>期望结果</th></tr></thead><tbody><tr><td>Redis 连接</td><td>健康检查接口</td><td>redis 状态为 "connected"</td></tr><tr><td>缓存操作</td><td>测试缓存 set/get</td><td>数据正确存储和读取</td></tr><tr><td>Token 存储</td><td>登录后检查 Redis</td><td>token 存储在 Redis 中</td></tr><tr><td>缓存过期</td><td>设置过期时间的数据</td><td>到期后自动清除</td></tr><tr><td>连接恢复</td><td>重启 Redis 后</td><td>应用自动重连</td></tr><tr><td>内存监控</td><td>Redis INFO 命令</td><td>内存使用正常</td></tr><tr><td>数据持久化</td><td>重启容器后</td><td>AOF 数据保留</td></tr></tbody></table>
<h4 data-id="heading-94">📝 Redis 缓存策略</h4>
<p><strong>缓存键命名规范：</strong></p>
<ul>
<li><code>user:{id}</code> - 用户信息缓存</li>
<li><code>article:{id}</code> - 文章内容缓存</li>
<li><code>articles:list:{page}</code> - 文章列表缓存</li>
<li><code>token:{userId}</code> - 用户认证令牌</li>
</ul>
<p><strong>缓存过期时间：</strong></p>
<ul>
<li>用户信息：1小时</li>
<li>文章内容：30分钟</li>
<li>文章列表：10分钟</li>
<li>认证令牌：7天</li>
</ul>
<p><strong>缓存更新策略：</strong></p>
<ul>
<li>数据更新时主动删除相关缓存</li>
<li>使用缓存穿透保护</li>
<li>实现缓存预热机制</li>
</ul>
<h4 data-id="heading-95">📦 技术栈详情</h4>
<ul>
<li><strong>缓存</strong>: Redis 8.4.0, 内存数据库和缓存服务</li>
</ul>
<h4 data-id="heading-96">📋 环境依赖清单</h4>























<table><thead><tr><th>工具</th><th>版本要求</th><th>安装方式</th><th>验证命令</th></tr></thead><tbody><tr><td>Redis</td><td>5.10.0</td><td><code>pnpm add redis</code></td><td>已安装</td></tr><tr><td>Docker Redis</td><td>8.4.0</td><td>Docker 容器</td><td><code>docker ps</code></td></tr></tbody></table>
<h4 data-id="heading-97">📁 项目结构概览</h4>
<pre><code class="hljs language-bash" lang="bash">packages/backend/
├── config/
│   └── redis.js           <span class="hljs-comment"># Redis 连接配置</span>
├── utils/
│   └── cache.js           <span class="hljs-comment"># Redis 缓存服务类（已创建）</span>
└── app.js                 <span class="hljs-comment"># 应用入口（需要集成 Redis）</span>
</code></pre>
<h4 data-id="heading-98">当前项目状态分析</h4>
<p><strong>已有的资源：</strong></p>
<ul>
<li>✅ Redis 依赖已安装（redis 5.10.0）</li>
<li>✅ Docker Redis 服务配置已完成</li>
</ul>
<p><strong>缺失的部分：</strong></p>
<ul>
<li>❌ Redis 连接配置已实现（config/redis.js）</li>
<li>❌ 后端集成 Redis 连接</li>
<li>❌ Redis 缓存服务在应用中的使用</li>
</ul>
<h4 data-id="heading-99">🧭 操作步骤</h4>
<h5 data-id="heading-100">停止服务 + 清理数据库:</h5>
<pre><code class="hljs language-dash" lang="dash"># 停止 Docker 服务
pnpm docker-dev:down

# 删除数据库卷（这会删除所有数据）
# pnpm docker-dev:delete (暂时取消此步骤)

# 重新启动服务
pnpm docker-dev:up
</code></pre>
<h5 data-id="heading-101">步骤 1：确认 Redis 连接配置</h5>
<p>项目已包含完整的 Redis 连接配置：</p>
<pre><code class="hljs language-bash" lang="bash">packages/backend/
├── config/
    └── redis.js        <span class="hljs-comment"># Redis 连接配置</span>
</code></pre>
<h5 data-id="heading-102">步骤 2：Redis 连接配置详解</h5>
<p><code>cd packages/backend</code> 目录下, 创建 <code>touch config/redis.js</code>：</p>
<p><code>cd packages/backend</code> 目录下, 创建 <code>touch utils/cache.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/** 
 * 核心逻辑是使用 redisClient 实例 执行 Redis 操作，
 * 通过 try-catch 块处理错误，
 * 使用 logger 记录错误信息，
 * 最后 导出 单例实例 供其他模块 使用。
*/</span>

<span class="hljs-keyword">import</span> redisClient <span class="hljs-keyword">from</span> <span class="hljs-string">'../config/redis.js'</span>;
<span class="hljs-keyword">import</span> logger <span class="hljs-keyword">from</span> <span class="hljs-string">'./logger.js'</span>;

<span class="hljs-comment">/**
 * Redis 缓存工具类
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheService</span> {
  <span class="hljs-comment">/**
   * 获取缓存
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} key 缓存键
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;any&gt;</span>} 缓存值
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> value = <span class="hljs-keyword">await</span> redisClient.<span class="hljs-title function_">get</span>(key);
      <span class="hljs-keyword">return</span> value ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(value) : <span class="hljs-literal">null</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Cache get error: <span class="hljs-subst">${error.message}</span>`</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-comment">/**
   * 设置缓存
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} key 缓存键
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">any</span>} value 缓存值
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} expire 过期时间（秒）
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">set</span>(<span class="hljs-params">key, value, expire = <span class="hljs-number">3600</span></span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> redisClient.<span class="hljs-title function_">setEx</span>(key, expire, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value));
    } <span class="hljs-keyword">catch</span> (error) {
      logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Cache set error: <span class="hljs-subst">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment">/**
   * 删除缓存
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} key 缓存键
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">del</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> redisClient.<span class="hljs-title function_">del</span>(key);
    } <span class="hljs-keyword">catch</span> (error) {
      logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Cache del error: <span class="hljs-subst">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment">/**
   * 批量删除缓存（支持通配符）
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} pattern 匹配模式
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">delPattern</span>(<span class="hljs-params">pattern</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> keys = <span class="hljs-keyword">await</span> redisClient.<span class="hljs-title function_">keys</span>(pattern);
      <span class="hljs-keyword">if</span> (keys.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">await</span> redisClient.<span class="hljs-title function_">del</span>(keys);
      }
    } <span class="hljs-keyword">catch</span> (error) {
      logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Cache delPattern error: <span class="hljs-subst">${error.message}</span>`</span>);
    }
  }

  <span class="hljs-comment">/**
   * 检查缓存是否存在
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} key 缓存键
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Promise&lt;boolean&gt;</span>}
   */</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">exists</span>(<span class="hljs-params">key</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> redisClient.<span class="hljs-title function_">exists</span>(key) === <span class="hljs-number">1</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      logger.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Cache exists error: <span class="hljs-subst">${error.message}</span>`</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheService</span>();
</code></pre>
<h5 data-id="heading-103">步骤 4：在应用中集成 Redis + 更新健康检查接口</h5>
<p>更新 <code>app.js</code>，集成 Redis 连接：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/** 
 * 核心逻辑是更新健康检查接口，集成 Redis 连接，并返回 Redis 连接状态。
*/</span>

<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>;
<span class="hljs-comment">// ... 其他导入</span>
<span class="hljs-keyword">import</span> redisClient <span class="hljs-keyword">from</span> <span class="hljs-string">'./config/redis.js'</span>; <span class="hljs-comment">// 导入 Redis 客户端</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();
<span class="hljs-comment">// ... 中间件配置</span>

<span class="hljs-comment">// 路由配置（后续添加）</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/api/auth'</span>, authRouter); <span class="hljs-comment">// 认证模块, 身份认证、权限控制、Token 管理</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/api/users'</span>, userRouter); <span class="hljs-comment">// 用户模块, 用户注册、登录、信息管理</span>
<span class="hljs-comment">// app.use('/api/articles', articleRouter);</span>

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/health'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'健康检查开始'</span>);

  <span class="hljs-comment">/*
    健康检查内容：
      ✅ MySQL 数据库连接状态
      ✅ Redis 缓存连接状态
      ✅ 内存使用情况（RSS、Heap Total、Heap Used）
      ✅ 服务运行时间（Uptime）
      ✅ Node.js 版本信息
      ✅ 环境标识
  */</span>

  <span class="hljs-comment">// 初始化状态变量</span>
  <span class="hljs-keyword">let</span> dbStatus = <span class="hljs-string">'disconnected'</span>;
  <span class="hljs-keyword">let</span> redisStatus = <span class="hljs-string">'disconnected'</span>;
  <span class="hljs-keyword">let</span> overallStatus = <span class="hljs-string">'healthy'</span>;

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 1. 检查 MySQL 数据库连接</span>
    ...

    <span class="hljs-comment">// 2. 检查 Redis 连接</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 尝试动态导入 Redis 客户端（可能还未创建）</span>
      <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: redisClient } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./config/redis.js'</span>);
      <span class="hljs-keyword">await</span> redisClient.<span class="hljs-title function_">ping</span>();
      redisStatus = <span class="hljs-string">'connected'</span>;
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'✅ Redis 连接正常'</span>);
    } <span class="hljs-keyword">catch</span> (redisError) {
      <span class="hljs-comment">// Redis 连接失败不影响整体健康状态</span>
      logger.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'⚠️ Redis 连接失败，将以无缓存模式运行:'</span>, redisError.<span class="hljs-property">message</span>);
      redisStatus = <span class="hljs-string">'disconnected'</span>;
    }

    <span class="hljs-comment">// 3. 获取内存使用情况</span>
    ...

    <span class="hljs-comment">// 4. 构建响应数据</span>
    <span class="hljs-keyword">const</span> healthData = {
      ...
      <span class="hljs-attr">redis</span>: redisStatus,
      <span class="hljs-attr">memory</span>: memoryInfo,
      <span class="hljs-attr">pid</span>: process.<span class="hljs-property">pid</span>
    };

    <span class="hljs-comment">// 5. 根据整体状态返回相应的 HTTP 状态码</span>
    ...

  } <span class="hljs-keyword">catch</span> (error) {
    ...
    <span class="hljs-comment">// 返回服务不可用状态</span>
    res.<span class="hljs-title function_">status</span>(<span class="hljs-number">503</span>).<span class="hljs-title function_">json</span>({
      <span class="hljs-attr">code</span>: <span class="hljs-number">503</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-string">'服务异常'</span>,
      <span class="hljs-attr">data</span>: {
        ...
        <span class="hljs-attr">redis</span>: redisStatus,
        <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>,
        <span class="hljs-attr">pid</span>: process.<span class="hljs-property">pid</span>
      }
    });
  }
});

<span class="hljs-comment">// 启动服务</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">startServer</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 验证数据库连接</span>
    <span class="hljs-comment">// 动态导入数据库连接（避免循环依赖）</span>
      <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: sequelize } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./config/database.js'</span>);
    <span class="hljs-keyword">await</span> sequelize.<span class="hljs-title function_">authenticate</span>();
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'数据库连接成功'</span>);

    <span class="hljs-comment">// 检查 Redis 连接</span>
    <span class="hljs-keyword">let</span> redisStatus = <span class="hljs-string">'disconnected'</span>;
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 尝试动态导入 Redis 客户端（可能还未创建）</span>
      <span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: redisClient } = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./config/redis.js'</span>);
      <span class="hljs-keyword">await</span> redisClient.<span class="hljs-title function_">ping</span>();
      redisStatus = <span class="hljs-string">'connected'</span>;
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Redis 连接成功'</span>);
    } <span class="hljs-keyword">catch</span> (redisError) {
      logger.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Redis 连接失败，将以无缓存模式运行:'</span>, redisError.<span class="hljs-property">message</span>);
    }

    <span class="hljs-comment">// 启动服务器</span>
    ...

  } <span class="hljs-keyword">catch</span> (error) {
    ...
  }
};
</code></pre>
<h5 data-id="heading-104">步骤 5：Redis 缓存使用示例</h5>
<p>在业务代码中使用缓存服务, 比如: <code>modules/auth/service.js</code>:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在 auth service 中使用缓存存储 token</span>
<span class="hljs-keyword">import</span> cacheService <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/cache.js'</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthService</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">username, password</span>) {
    <span class="hljs-comment">// ... 登录逻辑</span>

    <span class="hljs-comment">// 为了避免每次用户登录都会生成新的token并覆盖存储在Redis中的旧token，这会导致同一个用户可以同时拥有多个有效的登录会话。</span>
    <span class="hljs-comment">// 检查用户是否已经登录，如果已登录 则先登出之前的登录</span>
    <span class="hljs-keyword">const</span> existingToken = <span class="hljs-keyword">await</span> cacheService.<span class="hljs-title function_">get</span>(<span class="hljs-string">`token:<span class="hljs-subst">${user.id}</span>`</span>);
    <span class="hljs-keyword">if</span> (existingToken) {
      <span class="hljs-comment">// 在日志中记录重复登录行为，便于监控</span>
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`用户 <span class="hljs-subst">${username}</span> 已在其他地方登录，执行登出操作`</span>);
      <span class="hljs-comment">// 当用户重复登录时，系统会先删除之前的token</span>
      <span class="hljs-keyword">await</span> cacheService.<span class="hljs-title function_">del</span>(<span class="hljs-string">`token:<span class="hljs-subst">${user.id}</span>`</span>);
    }

    <span class="hljs-comment">// 生成 token</span>
    <span class="hljs-keyword">const</span> token = <span class="hljs-title function_">generateToken</span>({
      <span class="hljs-attr">userId</span>: user.<span class="hljs-property">id</span>,
      <span class="hljs-attr">username</span>: user.<span class="hljs-property">username</span>,
      <span class="hljs-attr">role</span>: user.<span class="hljs-property">role</span>
    });

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'生成 Token: '</span>, token);

    <span class="hljs-comment">// 将 token 存储到 Redis（7天过期）</span>
    <span class="hljs-keyword">await</span> cacheService.<span class="hljs-title function_">set</span>(<span class="hljs-string">`token:<span class="hljs-subst">${user.id}</span>`</span>, token, <span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span>);

    <span class="hljs-comment">// 返回用户信息（不包含密码）和 Token</span>
    <span class="hljs-keyword">const</span> userData = user.<span class="hljs-title function_">toJSON</span>();
    <span class="hljs-keyword">delete</span> userData.<span class="hljs-property">password</span>;

    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">user</span>: userData,
      token
    };
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params">userId</span>) {
    <span class="hljs-comment">// 从 Redis 中删除 token</span>
    <span class="hljs-keyword">await</span> cacheService.<span class="hljs-title function_">del</span>(<span class="hljs-string">`token:<span class="hljs-subst">${userId}</span>`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">register</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-comment">// ... 注册逻辑</span>
    <span class="hljs-keyword">await</span> cacheService.<span class="hljs-title function_">set</span>(<span class="hljs-string">`token:<span class="hljs-subst">${user.id}</span>`</span>, token, <span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span>);

    <span class="hljs-keyword">return</span> {
      user,
      token
    };
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthService</span>();
</code></pre>
<h4 data-id="heading-105">✅ 验证方式</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查 Redis 容器状态 </span>
docker compose -f docker/docker-compose.dev.yml --env-file ./.env.development ps redis
<span class="hljs-comment"># 应显示 redis 容器状态为 Up/Healthy</span>

<span class="hljs-comment"># 2. 测试 Redis 连接</span>
docker compose -f docker/docker-compose.dev.yml --env-file ./.env.development <span class="hljs-built_in">exec</span> redis redis-cli -a redis123 ping
<span class="hljs-comment"># 应返回 PONG</span>

<span class="hljs-comment"># 3. 测试 Redis 密码认证</span>
docker compose -f docker/docker-compose.dev.yml --env-file ./.env.development <span class="hljs-built_in">exec</span> redis redis-cli -a redis123
<span class="hljs-comment"># 进入 Redis CLI 后执行:</span>
AUTH redis123
<span class="hljs-comment"># 应返回 OK</span>

<span class="hljs-comment"># 4. 检查后端启动日志</span>
<span class="hljs-built_in">cd</span> packages/backend &amp;&amp; pnpm run dev
<span class="hljs-comment"># 日志中应显示 "Redis 连接成功"</span>

<span class="hljs-comment"># 5. 测试健康检查接口</span>
curl http://localhost:3001/api/health | jq
<span class="hljs-comment"># 应返回详细的健康状态信息，包含：</span>
<span class="hljs-comment"># - status: "healthy"（数据库和Redis都正常）</span>
<span class="hljs-comment"># - database: "connected"</span>
<span class="hljs-comment"># - redis: "connected"</span>
<span class="hljs-comment"># - memory: 内存使用情况</span>
<span class="hljs-comment"># - uptime: 服务运行时间</span>
<span class="hljs-comment"># - version: Node.js版本</span>

<span class="hljs-comment"># 6. 测试缓存功能</span>
<span class="hljs-comment"># 在 Redis CLI 中查看缓存数据:</span>
<span class="hljs-comment"># KEYS *</span>
<span class="hljs-comment"># GET token:1 (如果有用户登录)</span>
</code></pre>
<p>这个阶段为后续的JWT认证、会话管理和数据缓存功能奠定了基础。接下来可以进入"阶段八：JWT + auth + Login"来实现完整的认证系统。</p>
<hr/>
<h3 data-id="heading-106">阶段八：前端后台管理（可选）</h3>
<h4 data-id="heading-107">🎯 本阶段目标</h4>
<p>构建 Vue3 + Vite 后台管理界面。</p>
<h4 data-id="heading-108">✅ 预期结果</h4>
<ul>
<li>Vue3 + Vite 开发服务器成功启动</li>
<li>Element Plus 组件库正确集成</li>
<li>登录页面可正常访问和使用</li>
<li>API 请求正确配置，支持跨域</li>
<li>路由系统正常工作，支持导航</li>
</ul>
<h4 data-id="heading-109">📏 验证标准</h4>


















































<table><thead><tr><th>检查项</th><th>验证命令</th><th>期望结果</th></tr></thead><tbody><tr><td>开发服务器</td><td><code>cd packages/frontend &amp;&amp; pnpm run dev</code></td><td>服务器启动在 5173 端口</td></tr><tr><td>页面访问</td><td>浏览器访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A5173" target="_blank" title="http://localhost:5173" ref="nofollow noopener noreferrer">http://localhost:5173</a></td><td>显示登录页面</td></tr><tr><td>API 集成</td><td>检查网络请求</td><td>请求发送到后端 API</td></tr><tr><td>组件渲染</td><td>Element Plus 组件</td><td>正确显示和交互</td></tr><tr><td>路由跳转</td><td>点击登录按钮</td><td>成功跳转到对应页面</td></tr><tr><td>构建测试</td><td><code>pnpm run build</code></td><td>生成 dist 目录</td></tr><tr><td>热重载</td><td>修改代码</td><td>页面自动刷新</td></tr><tr><td>环境变量</td><td>VITE_API_BASE_URL</td><td>正确配置 API 地址</td></tr></tbody></table>
<h4 data-id="heading-110">📋 技术栈详情</h4>
<ul>
<li><strong>前端框架</strong>: Vue 3.5.24 + Nuxt 4.2.2 (SSR)</li>
<li><strong>构建工具</strong>: Vite (rolldown-vite@7.2.5) + pnpm 9.0.0</li>
<li><strong>UI组件库</strong>: Element Plus 2.13.0 + 图标库</li>
<li><strong>状态管理</strong>: Pinia 3.0.4</li>
<li><strong>路由管理</strong>: Vue Router 4.x</li>
<li><strong>HTTP客户端</strong>: Axios 1.13.2</li>
<li><strong>数据可视化</strong>: ECharts 6.0.0</li>
<li><strong>Markdown编辑器</strong>: Vditor 3.11.2 + md-editor-v3 6.3.1</li>
</ul>
<h4 data-id="heading-111">📋 环境依赖清单</h4>



























































<table><thead><tr><th>工具</th><th>版本要求</th><th>安装方式</th><th>验证命令</th></tr></thead><tbody><tr><td>Vue</td><td>3.5.24</td><td><code>pnpm add vue</code></td><td>已安装</td></tr><tr><td>Vite</td><td>rolldown-vite@7.2.5</td><td><code>pnpm add vite</code></td><td>已安装</td></tr><tr><td>Element Plus</td><td>2.13.0</td><td><code>pnpm add element-plus</code></td><td>已安装</td></tr><tr><td>Pinia</td><td>3.0.4</td><td><code>pnpm add pinia</code></td><td>已安装</td></tr><tr><td>Vue Router</td><td>4.2.5</td><td>路由管理</td><td>已安装</td></tr><tr><td>Axios</td><td>1.13.2</td><td>HTTP 客户端</td><td>已安装</td></tr><tr><td>ECharts</td><td>6.0.0</td><td>图表库</td><td>已安装</td></tr><tr><td>Vditor</td><td>3.11.2</td><td>Markdown 编辑器</td><td>已安装</td></tr></tbody></table>
<h4 data-id="heading-112">📁 项目结构概览</h4>
<p>前端项目结构：</p>
<pre><code class="hljs language-bash" lang="bash">packages/frontend/
├── src/
│   ├── api/              <span class="hljs-comment"># API 接口封装</span>
│   │   ├── index.js     <span class="hljs-comment"># API 基础配置</span>
│   │   ├── auth.js      <span class="hljs-comment"># 认证相关接口</span>
│   │   ├── article.js   <span class="hljs-comment"># 文章相关接口</span>
│   │   ├── stats.js     <span class="hljs-comment"># 统计相关接口</span>
│   │   └── user.js      <span class="hljs-comment"># 用户相关接口</span>
│   ├── components/       <span class="hljs-comment"># 全局组件</span>
│   │   ├── BaseEChart.vue    <span class="hljs-comment"># 图表组件</span>
│   │   ├── CanvasText.vue    <span class="hljs-comment"># 画布文本组件</span>
│   │   └── MarkdownEditor.vue <span class="hljs-comment"># Markdown 编辑器</span>
│   ├── views/            <span class="hljs-comment"># 页面组件</span>
│   │   ├── admin/        <span class="hljs-comment"># 后台管理页面</span>
│   │   │   ├── Layout.vue     <span class="hljs-comment"># 后台布局</span>
│   │   │   ├── Login.vue      <span class="hljs-comment"># 登录页</span>
│   │   │   ├── Dashboard.vue  <span class="hljs-comment"># 仪表板</span>
│   │   │   ├── ArticleList.vue <span class="hljs-comment"># 文章列表</span>
│   │   │   ├── ArticleForm.vue <span class="hljs-comment"># 文章表单</span>
│   │   │   └── UserList.vue   <span class="hljs-comment"># 用户列表</span>
│   │   └── frontend/      <span class="hljs-comment"># 前台页面（可选）</span>
│   ├── stores/           <span class="hljs-comment"># Pinia 状态管理</span>
│   │   └── auth.js       <span class="hljs-comment"># 认证状态</span>
│   ├── router/           <span class="hljs-comment"># 路由配置</span>
│   │   └── index.js      <span class="hljs-comment"># 路由定义</span>
│   ├── composables/      <span class="hljs-comment"># 组合式函数</span>
│   │   ├── useDebounce.js    <span class="hljs-comment"># 防抖</span>
│   │   ├── useErrorHandler.js <span class="hljs-comment"># 错误处理</span>
│   │   ├── useRequest.js     <span class="hljs-comment"># 请求封装</span>
│   │   └── useTabVisibility.js <span class="hljs-comment"># 标签页可见性</span>
│   ├── utils/            <span class="hljs-comment"># 工具函数</span>
│   │   ├── request.js    <span class="hljs-comment"># Axios 封装</span>
│   │   └── security.js   <span class="hljs-comment"># 安全工具</span>
│   ├── workers/          <span class="hljs-comment"># Web Workers</span>
│   │   └── markdown-processor.worker.js
│   └── main.js           <span class="hljs-comment"># 应用入口</span>
├── public/               <span class="hljs-comment"># 静态资源</span>
├── vite.config.js        <span class="hljs-comment"># Vite 配置</span>
└── package.json          <span class="hljs-comment"># 项目配置</span>
</code></pre>
<h4 data-id="heading-113">当前项目状态分析</h4>
<p><strong>已有的资源：</strong></p>
<ul>
<li>✅ Vue3 + Vite 项目结构已配置</li>
<li>✅ Element Plus UI 组件库已集成</li>
<li>✅ API 接口封装已定义</li>
</ul>
<p><strong>缺失的部分：</strong></p>
<ul>
<li>❌ 认证状态管理实现</li>
<li>❌ 登录组件和路由配置</li>
</ul>
<h4 data-id="heading-114">🧭 操作步骤</h4>
<h5 data-id="heading-115">步骤 1：项目结构说明</h5>
<p>项目已包含完整的前端后台管理配置，直接使用即可。</p>
<h5 data-id="heading-116">步骤 2：主要功能模块</h5>
<ul>
<li><strong>后台管理</strong>: 文章管理、用户管理、分类管理、数据统计</li>
<li><strong>Markdown 编辑</strong>: 支持富文本编辑和预览</li>
<li><strong>图表展示</strong>: 使用 ECharts 展示统计数据</li>
<li><strong>响应式设计</strong>: 支持移动端和桌面端</li>
<li><strong>权限控制</strong>: 基于角色的访问控制</li>
</ul>
<h5 data-id="heading-117">步骤 3：开发服务器配置</h5>
<p>Vite 配置已包含：</p>
<ul>
<li><strong>路径别名</strong>: <code>@</code> 指向 <code>src/</code>, <code>@blog/common</code> 指向共享模块</li>
<li><strong>代理配置</strong>: 开发环境 API 代理到后端服务</li>
<li><strong>构建优化</strong>: 代码分割、压缩、Tree Shaking</li>
</ul>
<h5 data-id="heading-118">步骤 4：从零开始创建（可选）</h5>
<p>如果需要重新创建前端项目，以下是具体的创建步骤：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 初始化 Vue3 + Vite 项目</span>
<span class="hljs-built_in">mkdir</span> packages/frontend
<span class="hljs-built_in">cd</span> packages/frontend
pnpm create vite . --template vue
<span class="hljs-comment"># 选择: Use rolldown-vite (Experimental)?: Yes</span>
<span class="hljs-comment"># 选择: Install with pnpm and start now? Yes</span>

<span class="hljs-comment"># 2. 安装核心依赖</span>
pnpm add vue-router@4 pinia @element-plus/icons-vue element-plus axios
pnpm add echarts @sunny-117/text-image lodash-es md-editor-v3 vditor

<span class="hljs-comment"># 3. 安装开发依赖</span>
pnpm add -D @vitejs/plugin-vue eslint eslint-plugin-vue prettier
pnpm add -D husky lint-staged sass rollup-plugin-visualizer terser
pnpm add -D unplugin-auto-import unplugin-vue-components

<span class="hljs-comment"># 4. 创建项目结构</span>
<span class="hljs-built_in">mkdir</span> -p src/{api,views,router,stores,utils,composables,workers}
<span class="hljs-built_in">mkdir</span> -p src/views/{admin,frontend}

<span class="hljs-comment"># 然后创建相应的文件和组件</span>

<span class="hljs-comment"># 5. 配置 Vite 别名</span>
<span class="hljs-comment"># 修改 vite.config.js 添加路径别名配置</span>
```javascript
import { defineConfig } from <span class="hljs-string">'vite'</span>
import vue from <span class="hljs-string">'@vitejs/plugin-vue'</span>
import { fileURLToPath, URL } from <span class="hljs-string">'node:url'</span>

<span class="hljs-built_in">export</span> default defineConfig({
  plugins: [vue()],
  resolve: {
    <span class="hljs-built_in">alias</span>: {
      <span class="hljs-string">'@'</span>: fileURLToPath(new URL(<span class="hljs-string">'./src'</span>, import.meta.url)),
      <span class="hljs-string">'@blog/common'</span>: fileURLToPath(new URL(<span class="hljs-string">'../common'</span>, import.meta.url))
    }
  },
  // 明确指定环境文件搜索路径
  envDir: <span class="hljs-string">'../../'</span>
})

<span class="hljs-comment"># 6. 配置 Pinia + 导入vue-router入口文件</span>
<span class="hljs-comment"># 修改 main.js 添加路径别名配置</span>
```javascript
import { createApp } from <span class="hljs-string">'vue'</span>
import { createPinia } from <span class="hljs-string">'pinia'</span>

import ElementPlus from <span class="hljs-string">'element-plus'</span>;
import <span class="hljs-string">'element-plus/dist/index.css'</span>;
import zhCn from <span class="hljs-string">'element-plus/dist/locale/zh-cn.mjs'</span>;

import <span class="hljs-string">'./style.css'</span>
import App from <span class="hljs-string">'./App.vue'</span>
import router from <span class="hljs-string">'./router'</span>

const app = createApp(App)
const pinia = createPinia()

app.use(pinia)
app.use(router)
app.use(ElementPlus, { locale: zhCn });

// 等待路由就绪后再挂载应用, 发现问题: 应用还没等路由准备好就 mount，初次导航被打断，界面表现成刷新/闪一下。
router.isReady().<span class="hljs-keyword">then</span>(() =&gt; {
  app.mount('#app');
});

// app.mount('#app');

</code></pre>
<h5 data-id="heading-119">步骤 5：核心组件创建</h5>
<p>创建登录组件 <code>touch src/views/admin/Login.vue</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"login-container"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"form"</span> @<span class="hljs-attr">submit.prevent</span>=<span class="hljs-string">"handleLogin"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"用户名"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"form.username"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"密码"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"form.password"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">native-type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">:loading</span>=<span class="hljs-string">"loading"</span>&gt;</span>
        登录
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useRouter } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> { useAuthStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../stores/auth'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-keyword">const</span> form = <span class="hljs-title function_">ref</span>({ <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">password</span>: <span class="hljs-string">''</span> })
<span class="hljs-keyword">const</span> loading = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">false</span>)
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">useRouter</span>()
<span class="hljs-keyword">const</span> authStore = <span class="hljs-title function_">useAuthStore</span>()

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (!form.<span class="hljs-property">value</span>.<span class="hljs-property">username</span> || !form.<span class="hljs-property">value</span>.<span class="hljs-property">password</span>) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请输入用户名和密码'</span>)
    <span class="hljs-keyword">return</span>
  }
  
  loading.<span class="hljs-property">value</span> = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> authStore.<span class="hljs-title function_">login</span>(form.<span class="hljs-property">value</span>)
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'登录成功'</span>)
    router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/'</span>)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">response</span>?.<span class="hljs-property">data</span>?.<span class="hljs-property">message</span> || <span class="hljs-string">'登录失败'</span>)
  } <span class="hljs-keyword">finally</span> {
    loading.<span class="hljs-property">value</span> = <span class="hljs-literal">false</span>
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.login-container</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">400px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">100px</span> auto;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h5 data-id="heading-120">步骤 6：路由配置</h5>
<p>创建 <code>touch src/router/index.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/login'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/admin/Login.vue'</span>)
  }
]

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
  routes
})
</code></pre>
<h5 data-id="heading-121">步骤 7：API接口封装</h5>
<p>创建 <code>touch src/api/auth.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> request <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/request'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">login</span> = (<span class="hljs-params">data</span>) =&gt; request.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/auth/login'</span>, data)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">logout</span> = (<span class="hljs-params"/>) =&gt; request.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/auth/logout'</span>)
</code></pre>
<h5 data-id="heading-122">步骤 8：状态管理</h5>
<p>创建 <code>touch src/stores/auth.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { login } <span class="hljs-keyword">from</span> <span class="hljs-string">'../api/auth'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useAuthStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'auth'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">token</span>: <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>)
  }),
  
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">credentials</span>) {
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">login</span>(credentials)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">user</span>
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'token'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span>)
    },
    
    <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-literal">null</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = <span class="hljs-literal">null</span>
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'token'</span>)
    }
  }
})
</code></pre>
<h5 data-id="heading-123">步骤9: Axios请求封装</h5>
<p>创建 <code>touch src/utils/request.js</code></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>

<span class="hljs-comment">// 创建 axios 实例</span>
<span class="hljs-keyword">const</span> request = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_BASE_URL</span> || <span class="hljs-string">'http://localhost:3001/api'</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
  }
})

<span class="hljs-comment">// 请求拦截器</span>
request.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
    <span class="hljs-comment">// 从 localStorage 获取 token</span>
    <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>)
    <span class="hljs-keyword">if</span> (token) {
      config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>
    }
    <span class="hljs-keyword">return</span> config
  },
  <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)

<span class="hljs-comment">// 响应拦截器</span>
request.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
    <span class="hljs-keyword">return</span> response
  },
  <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>?.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) {
      <span class="hljs-comment">// token 过期，清除本地存储并跳转到登录页</span>
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'token'</span>)
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'/login'</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> request
</code></pre>
<h5 data-id="heading-124">步骤10: 修改 App.js</h5>
<p><strong>先删除不用的components文件, 如:HelloWorld.vue</strong>
<code>rm src/components/HelloWorld.vue</code></p>
<p><strong>修改App.vue</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;router-view /&gt;
&lt;/template&gt;

&lt;script setup&gt;
// App 根组件

// 处理全局 locale 配置（可选）: 引入Element Plus 中文语言包
// import zhCn from 'element-plus/dist/locale/zh-cn.mjs';
&lt;/script&gt;

&lt;style&gt;
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#app {
  min-height: 100vh;
}
&lt;/style&gt;
</code></pre>
<h5 data-id="heading-125">✅ 验证方式</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> packages/frontend

<span class="hljs-comment"># 1. 检查 request.js 文件是否创建成功</span>
<span class="hljs-built_in">ls</span> -la src/utils/request.js

<span class="hljs-comment"># 2. 测试前端开发服务器启动</span>
pnpm run dev
<span class="hljs-comment"># 应显示: Local: http://localhost:5173/</span>

<span class="hljs-comment"># 3. 验证环境变量配置</span>
<span class="hljs-comment"># 创建 .env.development 文件（如果不存在）</span>
<span class="hljs-comment"># echo "VITE_API_BASE_URL=http://localhost:3001/api" &gt; .env.development</span>

<span class="hljs-comment"># 4. 测试 API 请求（需要先启动后端服务）</span>
<span class="hljs-comment"># 在浏览器开发者工具中测试：</span>
<span class="hljs-comment"># fetch('http://localhost:5173/api/health')</span>
<span class="hljs-comment"># 应该能看到请求发送到后端</span>

<span class="hljs-comment"># 5. 检查登录功能</span>
<span class="hljs-comment"># 访问 http://localhost:5173/login</span>
<span class="hljs-comment"># 输入用户名: admin, 密码: admin123</span>
<span class="hljs-comment"># 点击登录按钮，观察网络请求和响应</span>

<span class="hljs-comment"># 6. 验证 token 存储</span>
<span class="hljs-comment"># 登录成功后，检查 localStorage 中是否有 token</span>
<span class="hljs-comment"># 在浏览器控制台输入: localStorage.getItem('token')</span>

<span class="hljs-comment"># 7. 测试请求拦截器</span>
<span class="hljs-comment"># 打开浏览器开发者工具 Network 标签</span>
<span class="hljs-comment"># 观察所有 API 请求是否自动添加了 Authorization 头</span>
</code></pre>
<hr/>
<h3 data-id="heading-126">阶段九：Nuxt SSR 前台（可选）</h3>
<h4 data-id="heading-127">🎯 本阶段目标</h4>
<p>实现首页 SSR，提升首屏加载性能和 SEO。</p>
<h4 data-id="heading-128">✅ 预期结果</h4>
<ul>
<li>Nuxt3 开发服务器成功启动</li>
<li>首页实现服务端渲染（SSR）</li>
<li>SEO 优化配置正确（meta 标签等）</li>
<li>路由系统按配置正确渲染</li>
<li>API 集成正常工作</li>
</ul>
<h4 data-id="heading-129">📏 验证标准</h4>


















































<table><thead><tr><th>检查项</th><th>验证命令</th><th>期望结果</th></tr></thead><tbody><tr><td>SSR 渲染</td><td>查看页面源码</td><td>包含完整 HTML 结构</td></tr><tr><td>开发服务器</td><td><code>cd packages/nuxt-ssr &amp;&amp; pnpm run dev</code></td><td>服务器启动在 3000 端口</td></tr><tr><td>页面访问</td><td>浏览器访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000" target="_blank" title="http://localhost:3000" ref="nofollow noopener noreferrer">http://localhost:3000</a></td><td>显示 SSR 渲染的页面</td></tr><tr><td>SEO 优化</td><td>查看页面 meta 标签</td><td>包含标题、描述等 SEO 信息</td></tr><tr><td>路由渲染</td><td>访问不同页面</td><td>按 routeRules 配置渲染模式</td></tr><tr><td>API 集成</td><td>服务端数据获取</td><td>数据正确获取和渲染</td></tr><tr><td>构建测试</td><td><code>pnpm run build</code></td><td>生成 .output 目录</td></tr><tr><td>生产预览</td><td><code>pnpm run preview</code></td><td>生产构建正确运行</td></tr></tbody></table>
<h4 data-id="heading-130">技术栈详情</h4>
<ul>
<li><strong>后端框架</strong>: ???</li>
</ul>
<h4 data-id="heading-131">📦 环境依赖清单</h4>



































<table><thead><tr><th>工具</th><th>版本要求</th><th>安装方式</th><th>验证命令</th></tr></thead><tbody><tr><td>Nuxt</td><td>3.12.0</td><td><code>pnpm add nuxt</code></td><td>已安装</td></tr><tr><td>Vue</td><td>3.4.0</td><td>随 Nuxt 安装</td><td>已安装</td></tr><tr><td>Pinia</td><td>2.1.7</td><td><code>pnpm add @pinia/nuxt</code></td><td>已安装</td></tr><tr><td>Element Plus</td><td>2.11.9</td><td><code>pnpm add @element-plus/nuxt</code></td><td>已安装</td></tr></tbody></table>
<p>| Day.js | 1.11.19 | 日期处理 |</p>
<h4 data-id="heading-132">📁 项目结构概览</h4>
<pre><code class="hljs language-bash" lang="bash">packages/nuxt-ssr/
├── pages/                 <span class="hljs-comment"># 页面路由（文件系统路由）</span>
│   └── index.vue          <span class="hljs-comment"># 首页</span>
├── components/            <span class="hljs-comment"># 组件</span>
├── layouts/               <span class="hljs-comment"># 布局</span>
│   └── default.vue        <span class="hljs-comment"># 默认布局</span>
├── composables/           <span class="hljs-comment"># 组合式函数</span>
├── stores/                <span class="hljs-comment"># Pinia 状态管理</span>
├── server/
│   ├── api/              <span class="hljs-comment"># 服务端 API 路由</span>
│   └── middleware/       <span class="hljs-comment"># 服务端中间件</span>
├── public/               <span class="hljs-comment"># 静态资源</span>
└── nuxt.config.ts        <span class="hljs-comment"># Nuxt 配置</span>
</code></pre>
<h4 data-id="heading-133">当前项目状态分析</h4>
<p><strong>已有的资源：</strong></p>
<ul>
<li>✅ Nuxt3 项目结构已配置</li>
<li>✅ SSR 路由规则已定义</li>
<li>✅ 运行时配置已设置</li>
</ul>
<p><strong>缺失的部分：</strong></p>
<ul>
<li>❌ 服务端 API 路由实现</li>
<li>❌ 页面组件和布局</li>
</ul>
<h4 data-id="heading-134">🧭 操作步骤</h4>
<h5 data-id="heading-135">步骤 1：项目结构说明</h5>
<p><strong>项目已包含完整的 Nuxt SSR 配置，直接使用即可。</strong></p>
<p>Nuxt 项目结构：</p>
<pre><code class="hljs language-bash" lang="bash">packages/nuxt-ssr/
├── pages/               <span class="hljs-comment"># 页面路由（文件系统路由）</span>
│   └── index.vue       <span class="hljs-comment"># 首页（SSR）</span>
├── components/          <span class="hljs-comment"># 组件</span>
├── layouts/             <span class="hljs-comment"># 布局</span>
│   └── default.vue     <span class="hljs-comment"># 默认布局</span>
├── composables/         <span class="hljs-comment"># 组合式函数</span>
│   ├── useArticleApi.js <span class="hljs-comment"># 文章 API</span>
│   └── useRequest.js    <span class="hljs-comment"># 请求封装</span>
├── stores/              <span class="hljs-comment"># Pinia 状态管理</span>
│   └── auth.js         <span class="hljs-comment"># 认证状态</span>
├── server/              <span class="hljs-comment"># 服务端代码</span>
│   ├── api/            <span class="hljs-comment"># 服务端 API 路由</span>
│   └── middleware/     <span class="hljs-comment"># 服务端中间件</span>
├── plugins/             <span class="hljs-comment"># 插件</span>
│   └── element-plus.ts <span class="hljs-comment"># Element Plus 插件</span>
├── public/              <span class="hljs-comment"># 静态资源</span>
├── nuxt.config.ts       <span class="hljs-comment"># Nuxt 配置（已完整配置）</span>
├── tsconfig.json        <span class="hljs-comment"># TypeScript 配置</span>
└── package.json         <span class="hljs-comment"># 项目配置</span>
</code></pre>
<h5 data-id="heading-136">步骤 2：核心配置特性</h5>
<p><strong>已配置的 Nuxt 特性：</strong></p>
<ul>
<li><strong>SSR 配置</strong>: 默认开启 SSR，仅首页 SSR，其他页面 CSR</li>
<li><strong>路由规则</strong>: 基于页面重要性配置渲染模式</li>
<li><strong>开发代理</strong>: 开发环境自动代理 API 请求到后端</li>
<li><strong>Element Plus</strong>: 完整集成，包括图标和主题</li>
<li><strong>TypeScript</strong>: 支持 .ts 配置文件</li>
<li><strong>环境变量</strong>: 支持运行时配置</li>
</ul>
<p><strong>路由规则配置：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">routeRules</span>: {
  <span class="hljs-string">'/'</span>: { <span class="hljs-attr">ssr</span>: <span class="hljs-literal">true</span> },           <span class="hljs-comment">// 首页 SSR，提升 SEO</span>
  <span class="hljs-string">'/article/**'</span>: { <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span> }, <span class="hljs-comment">// 文章详情 CSR，提升交互性</span>
  <span class="hljs-string">'/category/**'</span>: { <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span> }, <span class="hljs-comment">// 分类页 CSR</span>
  <span class="hljs-string">'/search'</span>: { <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span> },     <span class="hljs-comment">// 搜索页 CSR</span>
  <span class="hljs-string">'/admin/**'</span>: { <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span> }    <span class="hljs-comment">// 管理后台 CSR</span>
}
</code></pre>
<p><strong>运行时配置：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">runtimeConfig</span>: {
  <span class="hljs-attr">public</span>: {
    <span class="hljs-attr">apiBase</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NUXT_PUBLIC_API_BASE_URL</span>,
    <span class="hljs-attr">siteBase</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NUXT_PUBLIC_SITE_BASE</span>,
    <span class="hljs-attr">siteName</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">NUXT_PUBLIC_SITE_NAME</span>
  }
}
</code></pre>
<h5 data-id="heading-137">步骤 3：SEO 和性能优化</h5>
<ul>
<li><strong>服务端渲染</strong>: 首页 SSR，提升首屏加载和 SEO</li>
<li><strong>预渲染</strong>: 支持静态生成（可选）</li>
<li><strong>代码分割</strong>: 自动代码分割和懒加载</li>
<li><strong>优化字体</strong>: 字体优化和预加载</li>
<li><strong>图片优化</strong>: 自动图片优化</li>
</ul>
<h5 data-id="heading-138">步骤 4：从零开始创建（可选）</h5>
<p>如果需要重新创建 Nuxt SSR 项目，以下是具体的创建步骤：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 初始化 Nuxt3 项目</span>
<span class="hljs-built_in">mkdir</span> packages/nuxt-ssr
<span class="hljs-built_in">cd</span> packages/nuxt-ssr
npx nuxi@latest init .
<span class="hljs-comment"># 这会创建一个基础的 Nuxt3 项目</span>
<span class="hljs-comment"># 选择1: minimal – Minimal setup for Nuxt 4</span>
<span class="hljs-comment"># 选择2: Override its contents</span>
<span class="hljs-comment"># 选择3: package manager: pnpm</span>
<span class="hljs-comment"># 选择4: Initialize git repository: Yes</span>
<span class="hljs-comment"># 选择5: Dependencies isntalled: Yes、 Git repository initialized: Yes、 </span>
<span class="hljs-comment"># 选择6: official modules: No</span>

<span class="hljs-comment"># 2. 安装核心依赖</span>
pnpm add @element-plus/nuxt @element-plus/icons-vue element-plus @pinia/nuxt pinia
pnpm add dayjs echarts vditor vue-router

<span class="hljs-comment"># 3. 安装开发依赖</span>
<span class="hljs-comment"># pnpm add -D eslint eslint-plugin-vue prettier sass</span>
pnpm add -D unplugin-auto-import unplugin-vue-components

<span class="hljs-comment"># 4. 配置 Nuxt 特性</span>
<span class="hljs-comment"># 修改 nuxt.config.ts 添加 SSR 配置、路由规则、运行时配置等</span>

<span class="hljs-comment"># 5. 创建项目结构</span>
<span class="hljs-built_in">mkdir</span> -p pages components layouts composables stores server/api server/middleware plugins public
<span class="hljs-comment"># 然后创建相应的文件和组件</span>

<span class="hljs-comment"># 6 修改 `nuxt.config.ts`：</span>
<span class="hljs-built_in">export</span> default defineNuxtConfig({
  devtools: { enabled: <span class="hljs-literal">true</span> },
  modules: [<span class="hljs-string">'@element-plus/nuxt'</span>, <span class="hljs-string">'@pinia/nuxt'</span>],
  runtimeConfig: {
    public: {
      apiBaseUrl: process.env.NUXT_PUBLIC_API_BASE_URL || <span class="hljs-string">'http://localhost:3001/api'</span>
    }
  }
})
</code></pre>
<h5 data-id="heading-139">步骤 5：完善 docker-compose.yml 和 docker-compose.dev.yml</h5>
<p><code>docker-compose.yml 和 docker-compose.dev.yml</code></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">services:</span>
  <span class="hljs-comment"># Nuxt3 SSR 服务（首页）</span>
  <span class="hljs-attr">nuxt:</span>
    <span class="hljs-attr">dns:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">1.1</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span>
    <span class="hljs-attr">build:</span>
      <span class="hljs-attr">context:</span> <span class="hljs-string">..</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">docker/nuxt/Dockerfile</span>
      <span class="hljs-attr">args:</span>
        <span class="hljs-attr">NUXT_PUBLIC_API_BASE_URL:</span> <span class="hljs-string">${NUXT_PUBLIC_API_BASE_URL:-http://backend:3001/api}</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">blog-nuxt</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">NODE_ENV:</span> <span class="hljs-string">production</span>
      <span class="hljs-attr">NUXT_PUBLIC_API_BASE_URL:</span> <span class="hljs-string">${NUXT_PUBLIC_API_BASE_URL:-http://backend:3001/api}</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${NUXT_PORT:-3000}:3000"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-attr">backend:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">blog-network</span> <span class="hljs-comment"># 仅关联公共网络，不访问数据库</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-comment"># test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000', (r) =&gt; {process.exit(r.statusCode === 200 ? 0 : 1)})"]</span>
      <span class="hljs-comment"># 优化健康检查逻辑，增加错误捕获</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"node"</span>, <span class="hljs-string">"-e"</span>, <span class="hljs-string">"const http = require('http'); const req = http.get('http://localhost:3000', (res) =&gt; { process.exit(res.statusCode === 200 ? 0 : 1); }); req.on('error', () =&gt; { process.exit(1); });"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span>
      <span class="hljs-attr">start_period:</span> <span class="hljs-string">40s</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
</code></pre>
<h4 data-id="heading-140">✅ 验证方式</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> packages/nuxt-ssr

<span class="hljs-comment"># 安装依赖（如果未安装）</span>
pnpm install

<span class="hljs-comment"># 启动开发服务器</span>
pnpm run dev

<span class="hljs-comment"># 验证启动成功</span>
<span class="hljs-comment"># 应显示: Local: http://localhost:3000</span>

<span class="hljs-comment"># 浏览器访问 http://localhost:3000</span>
<span class="hljs-comment"># 应能看到 SSR 渲染的首页（查看源码应包含完整 HTML）</span>

<span class="hljs-comment"># 测试构建</span>
pnpm run build
<span class="hljs-comment"># 应成功构建生产版本</span>

<span class="hljs-comment"># 测试预览</span>
pnpm run preview
<span class="hljs-comment"># 应能预览生产构建</span>
</code></pre>
<hr/>
<h3 data-id="heading-141">阶段十：Docker 化部署（可选）</h3>
<h4 data-id="heading-142">🎯 本阶段目标</h4>
<p>将整个应用容器化，实现生产环境部署。
Dockerfile 是多阶段构建的，有 builder 阶段 和 生产阶段, 这里主要是做 生产阶段 的工作.</p>
<blockquote>
<p>注1: 为了生产阶段的工作顺利, 最好把项目根目录下的 <code>.env.development</code> 复制一份并命名为 <code>.env</code>, 同时 docker目录下的 <code>docker-compose.dev.yml</code>也是 复制一份并命名为 <code>docker-compose.yml</code>.</p>
</blockquote>
<h4 data-id="heading-143">✅ 预期结果</h4>
<ul>
<li>所有服务成功容器化并可独立运行</li>
<li>Nginx 反向代理正确配置路由</li>
<li>容器间网络通信正常</li>
<li>数据持久化配置生效</li>
<li>生产环境配置正确加载</li>
</ul>
<h4 data-id="heading-144">📏 验证标准</h4>


















































<table><thead><tr><th>检查项</th><th>验证命令</th><th>期望结果</th></tr></thead><tbody><tr><td>容器构建</td><td><code>pnpm run docker:build</code></td><td>所有镜像构建成功</td></tr><tr><td>服务启动</td><td><code>pnpm run docker:up</code></td><td>所有容器状态为 Up/Healthy</td></tr><tr><td>Nginx 代理</td><td>访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost" target="_blank" title="http://localhost" ref="nofollow noopener noreferrer">http://localhost</a></td><td>正确路由到对应服务</td></tr><tr><td>API 访问</td><td>访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%2Fapi%2Fhealth" target="_blank" title="http://localhost/api/health" ref="nofollow noopener noreferrer">http://localhost/api/health</a></td><td>返回完整的健康状态</td></tr><tr><td>前端访问</td><td>访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%2Fadmin" target="_blank" title="http://localhost/admin" ref="nofollow noopener noreferrer">http://localhost/admin</a></td><td>显示后台管理界面</td></tr><tr><td>SSR 前台</td><td>访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost" target="_blank" title="http://localhost" ref="nofollow noopener noreferrer">http://localhost</a></td><td>显示 SSR 渲染页面</td></tr><tr><td>容器日志</td><td><code>pnpm run docker:logs</code></td><td>无错误日志</td></tr><tr><td>数据持久化</td><td>重启容器</td><td>数据正确保留</td></tr></tbody></table>
<h4 data-id="heading-145">环境依赖清单</h4>



































<table><thead><tr><th>工具</th><th>版本要求</th><th>安装方式</th><th>验证命令</th></tr></thead><tbody><tr><td>Docker</td><td>≥ 24.0.0</td><td>已安装</td><td><code>docker --version</code></td></tr><tr><td>Docker Compose</td><td>≥ 2.0.0</td><td>已安装</td><td><code>docker compose version</code></td></tr><tr><td>Node.js</td><td>≥ 18.0.0</td><td>已安装</td><td><code>node --version</code></td></tr><tr><td>pnpm</td><td>≥ 9.0.0</td><td>已安装</td><td><code>pnpm --version</code></td></tr></tbody></table>
<h4 data-id="heading-146">📋 技术栈详情</h4>
<ul>
<li><strong>容器化</strong>: Docker + Docker Compose</li>
</ul>
<h4 data-id="heading-147">📁 项目结构概览</h4>
<pre><code class="hljs language-bash" lang="bash">docker/
├── docker-compose.yml     <span class="hljs-comment"># 生产环境完整编排</span>
├── docker-compose.dev.yml <span class="hljs-comment"># 开发环境编排</span>
├── backend/
│   └── Dockerfile         <span class="hljs-comment"># 后端容器配置</span>
├── frontend/
│   └── Dockerfile         <span class="hljs-comment"># 前端容器配置</span>
├── nuxt/
│   └── Dockerfile         <span class="hljs-comment"># Nuxt 容器配置</span>
└── nginx/
    └── nginx.conf         <span class="hljs-comment"># Nginx 反向代理配置</span>
</code></pre>
<h4 data-id="heading-148">当前项目状态分析</h4>
<p><strong>已有的资源：</strong></p>
<ul>
<li>✅ 数据持久化配置已完整</li>
<li>✅ 服务架构说明已完整</li>
<li>✅ 部署流程说明已完整</li>
<li>✅ 验证方式已完整</li>
</ul>
<h4 data-id="heading-149">缺失的部分：</h4>
<ul>
<li>❌ Dockerfile 配置
<ul>
<li>后端服务容器配置: backend/Dockerfile</li>
<li>前端后台管理容器配置:frontend/Dockerfile</li>
<li>Nuxt SSR 前台容器配置:nuxt/Dockerfile</li>
<li>Nginx 反向代理配置文件:nginx/nginx.conf</li>
</ul>
</li>
<li>❌ docker-compose.dev.yml 配置</li>
<li>❌ 数据持久化配置</li>
<li>❌ 服务架构说明</li>
<li>❌ 部署流程说明</li>
<li>❌ 验证方式说明</li>
</ul>
<h4 data-id="heading-150">容器化服务架构</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">┌─────────────────────────────────────────────────┐</span>
<span class="hljs-string">│</span>                 <span class="hljs-string">Nginx</span> <span class="hljs-string">(Port</span> <span class="hljs-number">80</span><span class="hljs-string">)</span>                 <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">┌─────────────────────────────────────────────┐</span> <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">│</span>  <span class="hljs-string">/api/*</span> <span class="hljs-string">→</span> <span class="hljs-string">Backend</span> <span class="hljs-string">Service</span> <span class="hljs-string">(Port</span> <span class="hljs-number">3001</span><span class="hljs-string">)</span>      <span class="hljs-string">│</span> <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">│</span>                                             <span class="hljs-string">│</span> <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">│</span>  <span class="hljs-string">/*</span> <span class="hljs-string">→</span> <span class="hljs-string">Nuxt</span> <span class="hljs-string">SSR</span> <span class="hljs-string">Service</span> <span class="hljs-string">(Port</span> <span class="hljs-number">3000</span><span class="hljs-string">)</span>          <span class="hljs-string">│</span> <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">│</span>                                             <span class="hljs-string">│</span> <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">│</span>  <span class="hljs-string">/admin/*</span> <span class="hljs-string">→</span> <span class="hljs-string">Frontend</span> <span class="hljs-string">SPA</span> <span class="hljs-string">(Port</span> <span class="hljs-number">80</span><span class="hljs-string">)</span>          <span class="hljs-string">│</span> <span class="hljs-string">│</span>
<span class="hljs-string">│</span>  <span class="hljs-string">└─────────────────────────────────────────────┘</span> <span class="hljs-string">│</span>
<span class="hljs-string">└─────────────────────────────────────────────────┘</span>
                    <span class="hljs-string">│</span>          <span class="hljs-string">│</span>          <span class="hljs-string">│</span>
                    <span class="hljs-string">▼</span>          <span class="hljs-string">▼</span>          <span class="hljs-string">▼</span>
        <span class="hljs-string">┌───────────┴───────────┴───────────┴───────────┐</span>
        <span class="hljs-string">│</span>                                               <span class="hljs-string">│</span>
        <span class="hljs-string">│</span>           <span class="hljs-string">Docker</span> <span class="hljs-string">Network</span> <span class="hljs-string">(blog-network)</span>       <span class="hljs-string">│</span>
        <span class="hljs-string">│</span>                                               <span class="hljs-string">│</span>
        <span class="hljs-string">│</span>  <span class="hljs-string">┌─────────────┐</span>  <span class="hljs-string">┌─────────────┐</span>             <span class="hljs-string">│</span>
        <span class="hljs-string">│</span>  <span class="hljs-string">│</span>   <span class="hljs-string">MySQL</span>     <span class="hljs-string">│</span>  <span class="hljs-string">│</span>    <span class="hljs-string">Redis</span>    <span class="hljs-string">│</span>             <span class="hljs-string">│</span>
        <span class="hljs-string">│</span>  <span class="hljs-string">│</span> <span class="hljs-string">(Port</span> <span class="hljs-number">3306</span><span class="hljs-string">)</span> <span class="hljs-string">│</span>  <span class="hljs-string">│</span> <span class="hljs-string">(Port</span> <span class="hljs-number">6379</span><span class="hljs-string">)│</span>             <span class="hljs-string">│</span>
        <span class="hljs-string">│</span>  <span class="hljs-string">└─────────────┘</span>  <span class="hljs-string">└─────────────┘</span>             <span class="hljs-string">│</span>
        <span class="hljs-string">└───────────────────────────────────────────────┘</span>
</code></pre>
<h4 data-id="heading-151">🧭 操作步骤</h4>
<h5 data-id="heading-152">步骤 1：主要功能模块</h5>
<ul>
<li><strong>多服务架构</strong>: 后端 API、前端管理后台、Nuxt SSR 前台、Nginx 反向代理</li>
<li><strong>数据持久化</strong>: MySQL 数据库和 Redis 缓存的卷挂载配置</li>
<li><strong>网络通信</strong>: Docker 内部网络配置，确保服务间安全通信</li>
<li><strong>反向代理</strong>: Nginx 配置实现路径路由和负载均衡</li>
<li><strong>环境隔离</strong>: 生产环境和开发环境的配置分离</li>
<li><strong>日志管理</strong>: 容器日志收集和监控</li>
<li><strong>健康检查</strong>: 服务状态监控和自动重启机制</li>
<li><strong>安全配置</strong>: 非 root 用户运行、端口映射、安全加固</li>
</ul>
<h5 data-id="heading-153">步骤 2：从零开始创建</h5>
<p><strong>Docker 服务器配置：</strong></p>
<h6 data-id="heading-154">2.1 后端 Dockerfile (docker/backend/Dockerfile)</h6>
<p><strong>创建: <code>touch docker/backend/Dockerfile</code></strong>:</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 基础镜像选择
#   使用 Node.js LTS 版本的 Alpine Linux 镜像
#     Alpine 是一个轻量级 Linux 发行版，镜像体积小，安全性高
#     lts 表示长期支持版本，稳定性更好
FROM node:lts-alpine

# 设置工作目录: 在容器内创建并切换到 /app 目录, 后续所有命令（如 COPY、RUN）都会在这个目录下执行
WORKDIR /app

# 安装系统依赖: 安装 curl 工具，用于健康检查, --no-cache 参数：不缓存包索引，减小镜像体积
# 在 Alpine 镜像中(node:lts-alpine) 安装 curl 工具.
RUN apk add --no-cache curl

# 安装包管理器: 全局安装 pnpm（Performant Node Package Manager）, pnpm 比 npm/yarn 更快，磁盘占用更少，支持 workspace 功能
RUN npm install -g pnpm@10.24.0

# 复制 workspace 配置文件（依赖安装优化层）
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./

# 创建 monorepo 所需的目录结构: packages/common: 共享代码模块, packages/backend: 后端服务代码
RUN mkdir -p packages/common packages/backend

# 复制共享模块的依赖文件: 先复制 common 模块的 package.json，用于依赖解析, 这样可以正确安装 workspace 内部的依赖关系
COPY packages/common/package.json ./packages/common/

# 复制后端模块的依赖文件: package*.json 通配符匹配 package.json 和 package-lock.json
COPY packages/backend/package*.json ./packages/backend/

# 安装生产环境依赖
RUN pnpm install --frozen-lockfile --only=production


# 复制源代码: 在依赖安装完成后再复制源代码, 这样代码变更不会影响依赖层的缓存，提高构建效率
# 复制: 后端服务源代码 + 共享模块源代码
COPY packages/backend/ ./packages/backend/
COPY packages/common/ ./packages/common/

# 切换到后端服务目录: 将工作目录切换到后端服务目录, 后续命令（如 CMD）将在此目录下执行
WORKDIR /app/packages/backend

# 创建日志目录: 创建日志文件存储目录, 确保应用运行时可以正常写入日志文件
RUN mkdir -p logs

# 暴露端口: 声明容器运行时监听的端口3001(后端 API 服务端口)
EXPOSE 3001

# ----------------------------------------------------------------------------
# 健康检查配置
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
  CMD curl -f http://localhost:3001/api/health || exit 1

# 启动命令 在 /app/packages/backend
CMD ["node", "app.js"]
</code></pre>
<h6 data-id="heading-155">2.2 前端 Dockerfile (docker/frontend/Dockerfile)</h6>
<p><strong>创建: <code>touch docker/frontend/Dockerfile</code></strong>:</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 第一阶段：构建阶段（Builder Stage）: 此阶段负责安装依赖、编译源代码，生成静态资源文件

# 构建阶段基础镜像
FROM node:lts-alpine AS builder

# 设置构建工作目录: 在容器内创建并切换到 /app 目录
WORKDIR /app

# 安装包管理器
# 全局安装 pnpm（Performant Node Package Manager）, pnpm 比 npm/yarn 更快，磁盘占用更少，支持 workspace 功能
# -p 参数：如果目录已存在则不报错，支持递归创建
RUN npm install -g pnpm@10.24.0

# 复制 workspace 配置文件（依赖安装优化层）
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./

# 创建 packages 目录结构
# 创建 monorepo 所需的目录结构 (单体仓库, 无论是前端应用、后端服务、公共组件库、工具函数，还是文档，都可以放在同一个仓库里管理)
RUN mkdir -p packages/common packages/frontend

# 复制共享模块的依赖文件
COPY packages/common/package.json ./packages/common/

# 复制前端模块的依赖文件
COPY packages/frontend/package.json ./packages/frontend/

# 安装所有依赖（包括开发依赖）
RUN pnpm install --frozen-lockfile

# 复制源代码
COPY packages/frontend/ ./packages/frontend/
# 复制共享模块源代码
COPY packages/common/ ./packages/common/

# 构建前端应用
# 切换到前端应用目录
WORKDIR /app/packages/frontend

# 执行构建命令，生成静态资源文件到 dist 目录
# 构建产物包括：HTML、CSS、JavaScript、图片等静态资源
RUN pnpm run build

# 第二阶段：生产阶段（Production Stage）

# 生产阶段基础镜像
FROM nginx:alpine

# 复制构建产物
COPY --from=builder /app/packages/frontend/dist /usr/share/nginx/html

# 复制 Nginx 配置文件
COPY docker/nginx/nginx.conf /etc/nginx/nginx.conf

# 暴露端口
EXPOSE 80

# 启动 Nginx
CMD ["nginx", "-g", "daemon off;"]
</code></pre>
<h6 data-id="heading-156">2.3 Nuxt SSR Dockerfile (docker/nuxt/Dockerfile)</h6>
<p><strong>创建: <code>touch docker/nuxt/Dockerfile</code></strong>:</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 第一阶段：构建阶段（Builder Stage）: 此阶段负责安装依赖、编译源代码，生成 Nuxt3 构建产物
FROM node:lts-alpine AS builder

# 设置构建工作目录: 在容器内创建并切换到 /app 目录
WORKDIR /app

# 安装包管理器: 全局安装 pnpm（Performant Node Package Manager）, pnpm 比 npm/yarn 更快，磁盘占用更少，支持 workspace 功能
RUN npm install -g pnpm@10.24.0

# 复制 workspace 配置文件（依赖安装优化层）: 先复制依赖管理文件(package.json、pnpm-lock.yaml、pnpm-workspace.yaml)，利用 Docker 层缓存机制
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./

# 创建 monorepo 所需的目录结构: packages/common: 共享代码模块, packages/nuxt-ssr: Nuxt3 项目目录
# -p 参数：如果目录已存在则不报错，支持递归创建
RUN mkdir -p packages/common packages/nuxt-ssr

# 复制共享模块的依赖文件: 先复制 common 模块的 package.json，用于依赖解析, 这样可以正确安装 workspace 内部的依赖关系
COPY packages/common/package.json ./packages/common/

# 复制 Nuxt 项目依赖文件: 复制 packages/nuxt-ssr 的 package.json
COPY packages/nuxt-ssr/package.json ./packages/nuxt-ssr/

# 安装所有依赖（包括开发依赖）: --frozen-lockfile 严格使用 pnpm-lock.yaml，不更新锁文件, 确保构建的一致性和可重现性
RUN pnpm install --frozen-lockfile

# 复制源代码: 在依赖安装完成后再复制源代码, 这样代码变更不会影响依赖层的缓存，提高构建效率
# 复制: Nuxt3 项目源代码 + 共享模块源代码
COPY packages/nuxt-ssr/ ./packages/nuxt-ssr/
COPY packages/common/ ./packages/common/

# 切换到 Nuxt 项目目录: 将工作目录切换到 Nuxt 项目目录, 后续构建命令将在此目录下执行
WORKDIR /app/packages/nuxt-ssr

# 设置构建时环境变量: ARG 用于构建时传入参数, ENV 设置运行时环境变量
ARG NUXT_PUBLIC_API_BASE_URL
ENV NUXT_PUBLIC_API_BASE_URL=${NUXT_PUBLIC_API_BASE_URL:-http://backend:3001/api}

# 构建 Nuxt3 应用: 执行构建命令，生成 SSR 应用构建产物到 .output 目录
#   构建产物包括: 服务端代码(.output/server)、客户端代码(.output/public)、路由配置等
RUN pnpm run build


# 第二阶段：生产阶段（Production Stage）: 此阶段只包含运行所需的文件，使用轻量级的 Node.js 镜像

# 生产阶段基础镜像: 使用 Node.js LTS 版本的 Alpine Linux 镜像作为运行环境
# ✅ 重新开始的好处：干净的基础镜像, 这是 Docker 多阶段构建的常见做法
FROM node:lts-alpine AS production
# FROM builder  # ❌ 不推荐

# 设置构建时环境变量（在生产阶段也需要定义这个 ARG）
ARG NUXT_PUBLIC_API_BASE_URL

# 设置工作目录: 在容器内创建并切换到 /app 目录. 注: 与上面的不是同一个目录, 各自在不同的 镜像中创建的 `/app` 目录
WORKDIR /app

# 安装包管理器: 全局安装 pnpm, 用于安装生产依赖
RUN npm install -g pnpm@10.24.0

# 复制 workspace 配置文件（依赖安装优化层）: 先复制依赖管理文件，利用 Docker 层缓存机制
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./

# 创建 monorepo 所需的目录结构: packages/common: 共享代码模块, packages/nuxt-ssr: Nuxt3 项目目录
RUN mkdir -p packages/common packages/nuxt-ssr

# 复制共享模块的依赖文件: 先复制 common 模块的 package.json，用于依赖解析
COPY packages/common/package.json ./packages/common/

# 复制 Nuxt 项目依赖文件: 复制 packages/nuxt-ssr 的 package.json
COPY packages/nuxt-ssr/package.json ./packages/nuxt-ssr/

# 安装生产环境依赖: --frozen-lockfile 严格使用 pnpm-lock.yaml，不更新锁文件, 确保构建的一致性和可重现性
RUN pnpm install --frozen-lockfile --only=production

# 从构建阶段复制构建产物: 从 builder 阶段复制 Nuxt3 构建好的 .output 目录
COPY --from=builder /app/packages/nuxt-ssr/.output ./packages/nuxt-ssr/.output

# 复制必要的配置文件: 复制 Nuxt 配置文件和 package.json（运行时可能需要）
COPY packages/nuxt-ssr/nuxt.config.ts ./packages/nuxt-ssr/
COPY packages/nuxt-ssr/package.json ./packages/nuxt-ssr/

# 复制共享模块源代码: 复制共享模块源代码（如果 Nuxt 应用运行时需要）
COPY packages/common/ ./packages/common/

# 切换到 Nuxt 项目目录: 将工作目录切换到 Nuxt 项目目录, 后续命令（如 CMD）将在此目录下执行
WORKDIR /app/packages/nuxt-ssr

# 设置运行时环境变量
ENV NODE_ENV=production
ENV NUXT_PUBLIC_API_BASE_URL=${NUXT_PUBLIC_API_BASE_URL:-http://backend:3001/api}

# 暴露端口: 声明容器运行时监听的端口3000(Nuxt3 SSR 服务端口)
EXPOSE 3000

# 健康检查配置: 配置容器健康检查机制
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
  CMD node -e "require('http').get('http://localhost:3000', (r) =&gt; {process.exit(r.statusCode === 200 ? 0 : 1)})"

# 启动命令 在 /app/packages/nuxt-ssr
CMD ["node", ".output/server/index.mjs"]
</code></pre>
<h6 data-id="heading-157">2.4 Nginx 反向代理配置文件 (docker/nginx/nginx.conf)</h6>
<p><strong>创建: <code>touch docker/nginx/nginx.conf</code></strong>:</p>
<pre><code class="hljs language-conf" lang="conf"># 运行 Nginx 的用户和组, 使用 nginx 用户运行，提高安全性（非 root）
user nginx;

# Worker 进程数, auto: 自动设置为 CPU 核心数，充分利用多核性能
worker_processes auto;

# 错误日志配置
#   /var/log/nginx/error.log: 错误日志文件路径
#   warn: 只记录警告及以上级别的日志
error_log /var/log/nginx/error.log warn;

# PID 文件路径, 存储主进程 ID，用于进程管理
pid /var/run/nginx.pid;

# 事件模块配置
events {
  worker_connections 1024;
}

# HTTP 模块配置
http {
  # MIME 类型配置, 包含所有标准的 MIME 类型映射（如 text/html, application/json 等）
  include /etc/nginx/mime.types;
  
  # 默认 MIME 类型, 当无法识别文件类型时，使用 application/octet-stream（二进制流）
  default_type application/octet-stream;

  # 日志格式定义
  log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                  '$status $body_bytes_sent "$http_referer" '
                  '"$http_user_agent" "$http_x_forwarded_for"';

  # 访问日志配置, 使用上面定义的 main 格式记录所有访问日志
  access_log /var/log/nginx/access.log main;

  # 性能优化配置
  
  # 启用 sendfile
  sendfile on;
  
  # TCP_NOPUSH 选项, 与 sendfile 配合使用，等待数据包填满后再发送，减少网络包数量
  tcp_nopush on;
  
  # TCP_NODELAY 选项, 禁用 Nagle 算法，立即发送小数据包，降低延迟, 适用于需要低延迟的场景（如 API 请求）
  tcp_nodelay on;
  
  # Keep-Alive 超时时间, 65 秒：保持连接打开的时间，减少连接建立开销
  keepalive_timeout 65;
  
  # 类型哈希表最大大小, 2048: 提高 MIME 类型查找效率
  types_hash_max_size 2048;
  
  # 客户端请求体最大大小
  #   20M: 允许上传最大 20MB 的文件（如文章中的图片）
  client_max_body_size 20M;

  # 启用 Gzip 压缩
  gzip on;
  
  # 添加 Vary: Accept-Encoding 响应头, 告诉缓存服务器根据 Accept-Encoding 头缓存不同版本
  gzip_vary on;
  
  # 代理请求的压缩策略, any: 对所有代理请求启用压缩（包括已压缩的响应）
  gzip_proxied any;
  
  # 压缩级别: 6: 平衡压缩率和 CPU 消耗（1-9，9 压缩率最高但 CPU 消耗最大）
  gzip_comp_level 6;
  
  # 压缩的文件类型, 只压缩文本类文件，图片和视频等二进制文件通常已经压缩过
  gzip_types text/plain text/css text/xml text/javascript 
  application/json application/javascript application/xml+rss 
  application/rss+xml font/truetype font/opentype 
  application/vnd.ms-fontobject image/svg+xml;
  
  # 禁用 Gzip 的浏览器, msie6: 禁用 IE6 的 Gzip（IE6 对 Gzip 支持有问题）
  gzip_disable "msie6";
  
  # 最小压缩长度, 1000: 只压缩大于 1000 字节的文件，小文件压缩可能反而增加体积
  gzip_min_length 1000;

  # 代理缓存配置
  # 配置 API 响应的缓存存储
  proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=api_cache:10m max_size=100m inactive=60m use_temp_path=off;

  # 上游服务器配置（Upstream）
  
  # 后端 API 服务配置
  upstream backend {
    # 后端服务地址
    #   backend:3001: Docker Compose 中的服务名，端口 3001
    #   使用服务名而非 IP，由 Docker 网络 DNS 解析
    server backend:3001;
    
    # Keep-Alive 连接数
    #   32: 保持 32 个空闲连接，减少连接建立开销
    keepalive 32;
  }

  # Nuxt3 SSR 服务配置
  upstream nuxt {
      # Nuxt3 SSR 服务地址
    #   nuxt:3000: Docker Compose 中的服务名，端口 3000
    server nuxt:3000;
    
    # Keep-Alive 连接数
    keepalive 32;
  }

  # HTTP 服务器配置
  server {
    # 监听端口, 80: HTTP 标准端口
    listen 80;
    
    # 服务器名称, localhost: 本地访问，生产环境应改为实际域名
    server_name localhost;
    
    # 网站根目录
    root /usr/share/nginx/html;
    
    # 默认首页文件, 确保 index.html 可以被正确访问
    index index.html;

    # 内容安全策略（CSP）头
    # 防止 XSS 攻击，限制资源加载来源, 适配 ECharts noeval 版本，无 unsafe-eval，提升安全性
    add_header Content-Security-Policy "
      default-src 'self';                                    # 默认只允许同源资源
      script-src 'self';                                     # 脚本来源（不允许内联和 eval，使用 ECharts noeval 版本）
      style-src 'self' 'unsafe-inline';                      # 样式来源（允许内联样式，ECharts 样式需要）
      img-src 'self' data: blob:;                            # 图片来源（允许 data URI 和 blob，ECharts 图表导出需要）
      font-src 'self' data:;                                  # 字体来源（允许 data URI）
      connect-src 'self';                                     # 连接来源（API 请求）
      object-src 'none';                                      # 禁止插件
      base-uri 'self';                                        # 限制 base 标签的 URL
      frame-src 'none';                                       # 禁止 iframe
    " always;

    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;

    location /api {
      proxy_pass http://backend;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection 'upgrade';
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_cache_bypass $http_upgrade;
      proxy_cache api_cache;
      proxy_cache_valid 200 60m;
      proxy_cache_valid 404 1m;
      proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
      proxy_cache_background_update on;
      proxy_cache_lock on;
      proxy_cache_methods GET HEAD;
      proxy_no_cache $request_method;
    }

    # Nuxt3 静态资源代理
    # 代理 Nuxt3 的静态资源（CSS、JS 等）,^~ : 前缀匹配，优先级高于正则匹配，阻止后续正则匹配
    location ^~ /_nuxt/ {
      # 代理到 Nuxt3 服务
      proxy_pass http://nuxt;
      
      # HTTP 版本和请求头
      proxy_http_version 1.1;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      
      # 静态资源长期缓存: 1y: 缓存 1 年, immutable: 标记为不可变资源，浏览器可永久缓存
      expires 1y;
      add_header Cache-Control "public, immutable";
    }

    # Vue3 SPA 静态资源缓存
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ {
      # 长期缓存
      expires 1y;
      add_header Cache-Control "public, immutable";
      
      # 关闭访问日志
      #   静态资源访问量大，不记录日志减少 I/O
      access_log off;
    }

    # Nuxt3 SSR 首页
    location = / {
      # 代理到 Nuxt3 SSR 服务
      proxy_pass http://nuxt;
      
      # HTTP 版本和 WebSocket 支持
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection 'upgrade';
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_cache_bypass $http_upgrade;
      
      add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    location / { 
      add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
    
    # 添加了 location = /index.html：确保回退到 /index.html 时能正确访问
    #   当 try_files 回退到 /index.html 时，这个 location 确保文件能被正确返回
    location = /index.html {
      root /usr/share/nginx/html;
      add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    location /health {
      # 不记录访问日志
      access_log off;
      
      # 直接返回 200 状态码和 "healthy" 文本
      return 200 "healthy\n";
      
      # 设置响应类型
      add_header Content-Type text/plain;
    }

    # 5xx 错误：返回 50x.html 错误页面
    error_page 500 502 503 504 /50x.html;
    
    # 50x.html 文件位置
    location = /50x.html {
      root /usr/share/nginx/html;
    }
  }
}
</code></pre>
<h6 data-id="heading-158">2.5 添加 docker-compose.yml</h6>
<p><strong>创建: <code>touch docker/docker-compose.yml</code></strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml">  <span class="hljs-attr">services:</span>
  <span class="hljs-attr">mysql:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">blog-test-mysql2</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">${DB_PASSWORD:-blog123}</span>
      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">${DB_NAME:-blog_db}</span>
      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">${DB_USER:-blog_root}</span>
      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">${DB_PASSWORD:-blog123}</span>
    <span class="hljs-comment"># 👇 dev模式, 临时暴露端口用于本地开发</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${DB_PORT:-3306}:3306"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql_data:/var/lib/mysql</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./scripts/init.sql:/docker-entrypoint-initdb.d/init.sql:ro</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">--default-authentication-plugin=caching_sha2_password</span> <span class="hljs-comment"># 设置默认 认证插件为 caching_sha2_password</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">blog-network</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">db-network</span>  <span class="hljs-comment"># 关联db-network，实现网络隔离</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-comment"># test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"mysqladmin"</span>, <span class="hljs-string">"ping"</span>, <span class="hljs-string">"-h"</span>, <span class="hljs-string">"localhost"</span>, <span class="hljs-string">"-u"</span>, <span class="hljs-string">"root"</span>, <span class="hljs-string">"-p${DB_PASSWORD:-blog123}"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">5s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">5</span>

  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:8.4.0</span>
    <span class="hljs-comment"># image: redis:7.2-alpine # 修正Redis镜像版本为有效稳定版</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">blog-test-redis2</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">REDIS_PASSWORD=${REDIS_PASSWORD:-redis123}</span> <span class="hljs-comment"># 显式定义环境变量，避免 command 中解析失败</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${REDIS_PORT:-6379}:6379"</span>  <span class="hljs-comment"># 暴露端口供外部访问</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis_data:/data</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">blog-network</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">db-network</span>  <span class="hljs-comment"># 关联db-network，实现网络隔离</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">--appendonly</span> <span class="hljs-literal">yes</span> <span class="hljs-string">--requirepass</span> <span class="hljs-string">${REDIS_PASSWORD:-redis123}</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-comment"># 改用 --password 参数，兼容 Alpine 版本</span>
      <span class="hljs-comment"># test: ["CMD", "redis-cli", "--password", "$REDIS_PASSWORD", "ping"]</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"redis-cli"</span>, <span class="hljs-string">"-a"</span>, <span class="hljs-string">"${REDIS_PASSWORD:-redis123}"</span>, <span class="hljs-string">"ping"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">5s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">5</span>

  <span class="hljs-comment"># 后端服务</span>
  <span class="hljs-attr">backend:</span>
    <span class="hljs-attr">build:</span>
      <span class="hljs-attr">context:</span> <span class="hljs-string">..</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">docker/backend/Dockerfile</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">blog-backend</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">NODE_ENV:</span> <span class="hljs-string">production</span>
      <span class="hljs-attr">PORT:</span> <span class="hljs-number">3001</span>
      <span class="hljs-attr">DB_HOST:</span> <span class="hljs-string">mysql</span>
      <span class="hljs-attr">DB_PORT:</span> <span class="hljs-number">3306</span>
      <span class="hljs-attr">DB_NAME:</span> <span class="hljs-string">${DB_NAME:-blog_db}</span>
      <span class="hljs-attr">DB_USER:</span> <span class="hljs-string">${DB_USER:-blog_user}</span>
      <span class="hljs-attr">DB_PASSWORD:</span> <span class="hljs-string">${DB_PASSWORD:-blog123}</span>
      <span class="hljs-attr">REDIS_HOST:</span> <span class="hljs-string">redis</span>
      <span class="hljs-attr">REDIS_PORT:</span> <span class="hljs-number">6379</span>
      <span class="hljs-attr">REDIS_PASSWORD:</span> <span class="hljs-string">${REDIS_PASSWORD:-redis123}</span>
      <span class="hljs-attr">JWT_SECRET:</span> <span class="hljs-string">${JWT_SECRET:-your_jwt_secret_key_change_in_production}</span>
      <span class="hljs-attr">JWT_EXPIRES_IN:</span> <span class="hljs-string">7d</span>
      <span class="hljs-attr">CORS_ORIGIN:</span> <span class="hljs-string">http://localhost</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${BACKEND_PORT:-3001}:3001"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend_logs:/app/logs</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-attr">mysql:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span>
      <span class="hljs-attr">redis:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">blog-network</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"curl"</span>, <span class="hljs-string">"-f"</span>, <span class="hljs-string">"http://localhost:3001/api/health"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span>
      <span class="hljs-attr">start_period:</span> <span class="hljs-string">40s</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>

  <span class="hljs-comment"># Nuxt3 SSR 服务（首页）</span>
  <span class="hljs-attr">nuxt:</span>
    <span class="hljs-attr">dns:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">1.1</span><span class="hljs-number">.1</span><span class="hljs-number">.1</span>
    <span class="hljs-attr">build:</span>
      <span class="hljs-attr">context:</span> <span class="hljs-string">..</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">docker/nuxt/Dockerfile</span>
      <span class="hljs-attr">args:</span>
        <span class="hljs-attr">NUXT_PUBLIC_API_BASE_URL:</span> <span class="hljs-string">${NUXT_PUBLIC_API_BASE_URL:-http://backend:3001/api}</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">blog-nuxt</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">NODE_ENV:</span> <span class="hljs-string">production</span>
      <span class="hljs-attr">NUXT_PUBLIC_API_BASE_URL:</span> <span class="hljs-string">${NUXT_PUBLIC_API_BASE_URL:-http://backend:3001/api}</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${NUXT_PORT:-3000}:3000"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-attr">backend:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">blog-network</span> <span class="hljs-comment"># 仅关联公共网络，不访问数据库</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-comment"># test: ["CMD", "node", "-e", "require('http').get('http://localhost:3000', (r) =&gt; {process.exit(r.statusCode === 200 ? 0 : 1)})"]</span>
      <span class="hljs-comment"># 优化健康检查逻辑，增加错误捕获</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"node"</span>, <span class="hljs-string">"-e"</span>, <span class="hljs-string">"const http = require('http'); const req = http.get('http://localhost:3000', (res) =&gt; { process.exit(res.statusCode === 200 ? 0 : 1); }); req.on('error', () =&gt; { process.exit(1); });"</span>]
      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span>
      <span class="hljs-attr">start_period:</span> <span class="hljs-string">40s</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>

  <span class="hljs-comment"># 前端服务（Vue3 SPA，其他页面）</span>
  <span class="hljs-attr">frontend:</span>
    <span class="hljs-attr">build:</span>
      <span class="hljs-attr">context:</span> <span class="hljs-string">..</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">docker/frontend/Dockerfile</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">blog-frontend</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"${FRONTEND_PORT:-80}:80"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">blog-network</span> <span class="hljs-comment"># 仅关联公共网络，不访问数据库</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>

<span class="hljs-comment"># 顶级 volumes 定义, 优点：数据不会随容器删除; 更安全、可复用;</span>
<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">mysql_data:</span>
  <span class="hljs-attr">redis_data:</span>
  <span class="hljs-attr">backend_logs:</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">blog-network:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
  <span class="hljs-attr">db-network:</span> <span class="hljs-comment"># 仅数据库/backend 可访问</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</code></pre>
<blockquote>
<p>注: 创建完成后, 使用 <code>docker compose config</code> 来检查配置语法.</p>
</blockquote>
<h6 data-id="heading-159">2.6 修改根目录中的packages.json, 添加 build 相关的 脚本命令:</h6>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"blog-ssr"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"全栈博客系统，支持 SSR 和后台管理"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"packageManager"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm@9.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"workspaces"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"packages/*"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"docker-dev:up:redis"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose -f docker-compose.dev.yml --env-file ../.env.development up -d redis"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker-dev:up:mysql"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose -f compose docker-compose.dev.yml --env-file ../.env.development up -d mysql"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker-dev:up:nuxt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose -f compose docker-compose.dev.yml --env-file ../.env.development up -d nuxt"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker-dev:up:frontend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose -f compose docker-compose.dev.yml --env-file ../.env.development up -d frontend"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker-dev:up:backend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose -f compose docker-compose.dev.yml --env-file ../.env.development up -d backend"</span><span class="hljs-punctuation">,</span>
    
    <span class="hljs-attr">"docker-dev:stop"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose -f compose docker-compose.dev.yml --env-file ../.env.development stop"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker-dev:stop:frontend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose -f compose docker-compose.dev.yml --env-file ../.env.development stop frontend"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker-dev:stop:backend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose -f compose docker-compose.dev.yml --env-file ../.env.development stop backend"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker-dev:stop:nuxt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose -f compose docker-compose.dev.yml --env-file ../.env.development stop nuxt"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"dev:frontend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm run docker-dev:stop:frontend || true &amp;&amp; cd packages/frontend &amp;&amp; pnpm run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev:backend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm run docker-dev:stop:backend || true &amp;&amp; cd packages/backend &amp;&amp; pnpm run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev:nuxt"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm run docker-dev:stop:nuxt || true &amp;&amp; cd packages/nuxt-ssr &amp;&amp; pnpm run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"kill:frontend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"kill-port 5173 --force"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"kill:backend"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"kill-port 3001 --force"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"docker:logs"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose logs -f"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"docker:build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm run docker:down &amp;&amp; cd docker &amp;&amp; docker compose up -d --build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"backend:init-db"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd packages/backend &amp;&amp; npm run init-db"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm run docker-dev:up:redis &amp;&amp; pnpm run docker-dev:up:mysql &amp;&amp; pnpm docker-dev:stop &amp;&amp; concurrently \"pnpm run dev:frontend\" \"pnpm run dev:backend\" \"pnpm run dev:nuxt\""</span><span class="hljs-punctuation">,</span>
    
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm run docker:build &amp;&amp; pnpm run backend:init-db"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-attr">"docker:up"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm run docker:down &amp;&amp; cd docker &amp;&amp; docker compose up -d"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"docker:down"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cd docker &amp;&amp; docker compose down"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"engines"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&gt;=18.0.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"pnpm"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&gt;=6.11.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"author"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"henrypt"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MIT"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"markdown-it"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^14.1.0"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^9.39.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"husky"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^9.1.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint-staged"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^16.2.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.7.4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"sass"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^1.97.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"concurrently"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^9.2.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"kill-port"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.0.1"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h6 data-id="heading-160">2.7 全局依赖安装</h6>
<pre><code class="hljs language-bash" lang="bash">pnpm install
</code></pre>

































<table><thead><tr><th>命令</th><th>构建镜像</th><th>启动服务</th><th>开发模式</th><th>适用环境</th></tr></thead><tbody><tr><td><code>pnpm run dev</code></td><td>❌</td><td>✅ (本地)</td><td>热重载开发</td><td>本地开发</td></tr><tr><td><code>pnpm run docker:up</code></td><td>❌</td><td>✅ (容器)</td><td>生产模式</td><td>已部署环境</td></tr><tr><td><code>pnpm run docker:build</code></td><td>✅</td><td>✅ (容器)</td><td>生产模式</td><td>首次部署/代码更新</td></tr></tbody></table>
<blockquote>
<p><code>pnpm run dev</code> 用于 开发 &amp; 测试 阶段
<code>pnpm run docker:up</code> 和 <code>pnpm run docker:build</code> 前, 建议先执行 docker compose down</p>
</blockquote>
<p><strong>使用建议</strong>：</p>
<ul>
<li>开发时：<code>pnpm run dev</code></li>
<li>部署新版本：<code>pnpm run docker:build</code></li>
<li>启动现有部署：<code>pnpm run docker:up</code> /  <code>pnpm run docker:down</code></li>
</ul>
<h6 data-id="heading-161">2.8 添加 .env</h6>
<p><strong>项目根目录 创建: <code>touch .env</code></strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 后端服务配置</span>
NODE_ENV=production
HOST=0.0.0.0
PORT=3001

<span class="hljs-comment"># 数据库配置（Docker 容器）</span>
DB_HOST=localhost
DB_PORT=3306
DB_NAME=blog_db
DB_USER=blog_root
DB_PASSWORD=blog123

<span class="hljs-comment"># Redis 配置（Docker 容器）</span>
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=redis123

<span class="hljs-comment"># JWT 配置</span>
JWT_SECRET=dev_jwt_secret_key_for_development_only
JWT_EXPIRES_IN=7d

<span class="hljs-comment"># CORS 配置（允许前端访问）</span>
CORS_ORIGIN=http://localhost

<span class="hljs-comment"># Nuxt SSR 配置</span>
NUXT_PUBLIC_API_BASE_URL=http://localhost:3001/api
NUXT_PUBLIC_SITE_BASE=http://localhost:3000
NUXT_PUBLIC_SITE_NAME=个人博客

<span class="hljs-comment"># Docker 服务端口配置</span>
BACKEND_PORT=3001
FRONTEND_PORT=80
NUXT_PORT=3000
</code></pre>
<h6 data-id="heading-162">注意事项：</h6>
<ul>
<li>环境变量优先级：<code>environment</code> 中的环境变量会覆盖 <code>Dockerfile</code> 中设置的环境变量</li>
<li>构建参数：<code>build.args</code> 中的参数只在构建时有效，不会作为环境变量传递到运行的容器中</li>
<li>多阶段构建：当前的 Nuxt Dockerfile 已经是多阶段构建，包含了构建阶段和生产阶段，这是最佳实践</li>
</ul>
<h5 data-id="heading-163">步骤 4：部署流程</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 进入docker目录, 检查docker配置语法的正确性:</span>
`docker-compose config`

<span class="hljs-comment"># 2. 构建并启动所有服务</span>
<span class="hljs-comment"># 返回项目根目录</span>
pnpm run build

<span class="hljs-comment"># 注: build 脚本会先停止现有容器，构建新镜像，启动服务，然后初始化数据库</span>
<span class="hljs-comment"># 注: build 里集成了docker的build + init-db(数据库初始化工作)</span>

<span class="hljs-comment"># 查看服务状态</span>
docker compose ps

<span class="hljs-comment"># 查看服务日志</span>
pnpm run docker:logs
</code></pre>
<h4 data-id="heading-164">✅ 验证方式</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 进入docker目录, 检查docker配置语法的正确性:</span>
`docker-compose config`

<span class="hljs-comment"># 2. 检查服务状态</span>
docker compose ps
<span class="hljs-comment"># 应显示所有服务状态为 Up/Healthy</span>

<span class="hljs-comment"># 3. 测试健康检查</span>
curl http://localhost/api/health | jq
<span class="hljs-comment"># 应返回完整的健康状态信息，包含数据库、Redis、内存等状态</span>

<span class="hljs-comment"># 4. 测试前台首页</span>
curl http://localhost/
<span class="hljs-comment"># 应返回完整的 HTML 页面（SSR）</span>

<span class="hljs-comment"># 5. 测试后台管理</span>
curl http://localhost/admin/
<span class="hljs-comment"># 应返回前端应用</span>

<span class="hljs-comment"># 6. 查看服务日志</span>
pnpm run docker:logs:backend
pnpm run docker:logs:nuxt

<span class="hljs-comment"># 7. 检查容器资源使用</span>
docker stats

<span class="hljs-comment"># 8. 服务健康检查</span>
```bash
curl http://localhost:3001/api/health

<span class="hljs-comment"># 9. 登录检查</span>
curl -v -X POST http://localhost:3001/api/auth/login \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"username":"admin","password":"admin123"}'</span>
</code></pre>
<h4 data-id="heading-165">✅ 补充排查点</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 网络 / 权限问题：db-network 网络是否创建成功？Redis 容器是否有权限写入 redis_data 卷？</span>
  <span class="hljs-comment"># 检查网络</span>
  docker network <span class="hljs-built_in">ls</span> | grep db-network
  <span class="hljs-comment"># 检查卷权限</span>
  docker volume inspect redis_data

<span class="hljs-comment"># 2. 端口冲突：宿主机 6379 端口是否被其他进程占用？</span>
  <span class="hljs-comment"># 运行</span>
  lsof -i :6379  <span class="hljs-comment"># Mac/Linux</span>
  netstat -ano | findstr :6379  <span class="hljs-comment"># Windows</span>
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浅谈 storeToRefs]]></title>    <link>https://juejin.cn/post/7593171168259506185</link>    <guid>https://juejin.cn/post/7593171168259506185</guid>    <pubDate>2026-01-09T14:02:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593171168259506185" data-draft-id="7592818272153911323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浅谈 storeToRefs"/> <meta itemprop="keywords" content="前端,TypeScript,Vuex"/> <meta itemprop="datePublished" content="2026-01-09T14:02:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="在西安牧羊的牛油果"/> <meta itemprop="url" content="https://juejin.cn/user/2946346894233133"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浅谈 storeToRefs
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2946346894233133/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    在西安牧羊的牛油果
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:02:27.000Z" title="Fri Jan 09 2026 14:02:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>storeToRefs 是专门用来把 Pinia store 解构成「仍然有响应性 + 完整 TS 提示」的 refs 工具。</p>
<hr/>
<h2 data-id="heading-1">一、<code>storeToRefs</code> 是干嘛的？</h2>
<h3 data-id="heading-2">问题背景</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useUserStore</span>()
<span class="hljs-keyword">const</span> { name } = store   <span class="hljs-comment">// ❌ 响应性断了 + TS 变弱</span>
</code></pre>
<h3 data-id="heading-3">解决方案</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { storeToRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useUserStore</span>()
<span class="hljs-keyword">const</span> { name } = <span class="hljs-title function_">storeToRefs</span>(store) <span class="hljs-comment">// ✅</span>
</code></pre>
<p><strong>结果：</strong></p>
<ul>
<li><code>name</code> 是 <code>Ref&lt;string&gt;</code></li>
<li>响应性不丢</li>
<li>TS 自动补全、类型检查完整</li>
</ul>
<hr/>
<h2 data-id="heading-4">二、它到底“帮你做了什么”？</h2>
<p><code>storeToRefs(store)</code> 会：</p>
<ol>
<li>
<p><strong>只处理</strong></p>
<ol>
<li><code>state</code></li>
<li><code>getters</code></li>
</ol>
</li>
<li>
<p><strong>跳过</strong></p>
<ol>
<li><code>actions</code></li>
</ol>
</li>
<li>
<p>把它们统一包成 <code>ref / computed</code></p>
</li>
</ol>
<p>可以把它理解成：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 伪代码</span>
{
  <span class="hljs-attr">stateKey</span>: <span class="hljs-title function_">toRef</span>(store, <span class="hljs-string">'stateKey'</span>),
  <span class="hljs-attr">getterKey</span>: <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> store.<span class="hljs-property">getterKey</span>),
}
</code></pre>
<hr/>
<h2 data-id="heading-5">三、TS 类型长什么样？</h2>
<h3 data-id="heading-6">Store 定义</h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Tom'</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">18</span>,
  }),
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-attr">isAdult</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>,
  },
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">setName</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name
    },
  },
})
</code></pre>
<h3 data-id="heading-7">使用 <code>storeToRefs</code></h3>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useUserStore</span>()
<span class="hljs-keyword">const</span> { name, age, isAdult } = <span class="hljs-title function_">storeToRefs</span>(store)
</code></pre>
<h3 data-id="heading-8">TS 推导结果</h3>
<pre><code class="hljs language-ts" lang="ts">name      <span class="hljs-comment">// Ref&lt;string&gt;</span>
age       <span class="hljs-comment">// Ref&lt;number&gt;</span>
isAdult   <span class="hljs-comment">// ComputedRef&lt;boolean&gt;</span>
</code></pre>
<p>✔ 不会是 <code>any</code> ✔ 不会丢 getter 类型 ✔ 自动区分 Ref / ComputedRef</p>
<hr/>
<h2 data-id="heading-9">四、为什么 <code>actions</code> 不能放进去？</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> { setName } = <span class="hljs-title function_">storeToRefs</span>(store) <span class="hljs-comment">// ❌ 不存在</span>
</code></pre>
<p>因为：</p>
<ul>
<li>action 是普通函数</li>
<li>不需要响应性</li>
<li>包成 ref 反而会破坏 <code>this</code> / 调用方式</li>
</ul>
<p>👉 正确做法：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> { setName } = store
</code></pre>
<hr/>
<h2 data-id="heading-10">五、最标准、最推荐的组合写法</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useUserStore</span>()

<span class="hljs-keyword">const</span> { name, age, isAdult } = <span class="hljs-title function_">storeToRefs</span>(store)
<span class="hljs-keyword">const</span> { setName } = store
</code></pre>
<p>这是 <strong>Pinia 官方文档 + 实战</strong> 都默认的模式。</p>
<hr/>
<h2 data-id="heading-11">六、模板里为什么不用 <code>.value</code>？</h2>
<pre><code class="hljs language-ts" lang="ts">&lt;script setup lang=<span class="hljs-string">"ts"</span>&gt;
  <span class="hljs-keyword">const</span> store = <span class="hljs-title function_">useUserStore</span>()
  <span class="hljs-keyword">const</span> { name } = <span class="hljs-title function_">storeToRefs</span>(store)
&lt;/script&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  {{ name }} <span class="hljs-comment">&lt;!-- 自动 unref --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<ul>
<li>Vue template 会自动 <code>unref</code></li>
<li>TS 仍然认为它是 <code>Ref&lt;string&gt;</code></li>
<li>两边都正确 ✅</li>
</ul>
<hr/>
<h2 data-id="heading-12">七、什么时候一定要用 <code>storeToRefs</code>？</h2>
<h3 data-id="heading-13">✅ 必须用</h3>
<ul>
<li>在 <code>setup()</code> / <code>script setup</code> 里解构 store</li>
<li>想保留响应性 + TS 提示</li>
<li>把 store 拆开传给 composable</li>
</ul>
<h3 data-id="heading-14">❌ 不用</h3>
<p><code>store.name</code> <code>store.isAdult</code> <code>store.setName()</code></p>
<blockquote>
<p>不解构 = 不需要 <code>storeToRefs</code></p>
</blockquote>
<hr/>
<h2 data-id="heading-15">八、总结</h2>
<blockquote>
<p><strong>Pinia 解构三原则</strong></p>
<ul>
<li>解构 <code>state / getters</code> 👉 <code>storeToRefs</code></li>
<li>解构 <code>actions</code> 👉 直接解</li>
<li>能不解构就不解构（TS 最稳）</li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 宏编译的限制与解决方案：深入理解与实践突破]]></title>    <link>https://juejin.cn/post/7593169840200351770</link>    <guid>https://juejin.cn/post/7593169840200351770</guid>    <pubDate>2026-01-09T15:38:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593169840200351770" data-draft-id="7592615536384491554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 宏编译的限制与解决方案：深入理解与实践突破"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2026-01-09T15:38:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="boooooooom"/> <meta itemprop="url" content="https://juejin.cn/user/3078273283917399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 宏编译的限制与解决方案：深入理解与实践突破
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3078273283917399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    boooooooom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:38:16.000Z" title="Fri Jan 09 2026 15:38:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 宏编译的限制与解决方案：深入理解与实践突破</h2>
<p>在 Vue3 <code>&lt;script setup&gt; </code> 语法体系中，宏（Macro）是核心特性之一。诸如 defineProps、defineEmits、defineModel 等内置宏，通过编译时注入逻辑，大幅简化了组件开发流程。但宏编译本质是 Vue 编译器对特定语法的“静态解析优化”，这也决定了它存在诸多使用限制。本文将系统梳理 Vue3 宏编译的核心限制，剖析限制背后的原因，并提供针对性的解决方案，帮助开发者在实际项目中规避陷阱、高效使用宏特性。</p>
<h3 data-id="heading-1">一、先明确：什么是 Vue3 宏编译？</h3>
<p>Vue3 中的宏，是一组“编译时工具函数”，它们不参与运行时执行，仅在 Vue 编译器处理组件代码时发挥作用。其核心价值是：通过静态分析代码，自动生成冗余的运行时代码（如 props 声明、emit 事件触发逻辑等），减少开发者手动编码量。</p>
<p>典型示例：使用 defineProps 宏时，编译器会自动将其解析为组件的 props 选项，并生成对应的类型校验逻辑，无需开发者手动编写 export default { props: {} }。</p>
<p>但正因为宏依赖“编译时静态解析”，而非运行时动态处理，当代码逻辑超出静态解析能力范围时，就会触发限制。</p>
<h3 data-id="heading-2">二、Vue3 宏编译的核心限制</h3>
<p>Vue3 宏编译的限制主要集中在<code>动态语法不支持</code> <code>作用域隔离</code> <code>类型推导边界</code>三大维度，以下是最常见的限制及实际场景案例。</p>
<h4 data-id="heading-3">1. 限制一：不支持动态参数，仅能静态字面量</h4>
<p>这是宏编译最核心的限制。由于宏需要在编译时确定参数的具体值，无法解析运行时动态生成的变量或表达式。</p>
<h5 data-id="heading-4">场景案例：动态定义 props 类型</h5>
<p>试图通过变量动态拼接 props 类型，会直接报错：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// 错误示例：动态变量无法被宏静态解析
const dynamicPropType = String;
const props = defineProps({
  name: {
    type: dynamicPropType, // 编译报错：宏参数必须是静态字面量
    required: true
  }
});
&lt;/script&gt;
</code></pre>
<h5 data-id="heading-5">限制原因</h5>
<p>defineProps 等宏的参数必须是<code>编译时可确定的静态结构</code>（如字面量对象、数组）。编译器在处理时，需要直接读取参数内容生成代码，而动态变量的取值只能在运行时确定，超出了静态解析能力。</p>
<h4 data-id="heading-6">2. 限制二：宏必须在顶层作用域调用，不能嵌套在函数/条件中</h4>
<p>所有 Vue 内置宏（defineProps、defineEmits、defineModel 等）都必须在 <code>&lt;script setup&gt;</code> 的顶层作用域调用，不能嵌套在函数、if 条件、循环等代码块中。</p>
<h5 data-id="heading-7">场景案例：条件性定义 props</h5>
<p>试图根据条件动态声明 props，会触发编译错误：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// 错误示例：宏嵌套在条件语句中
const isAdmin = true;
if (isAdmin) {
  const props = defineProps({ adminId: Number }); // 编译报错：宏必须在顶层作用域
} else {
  const props = defineProps({ userId: Number });
}
&lt;/script&gt;
</code></pre>
<h5 data-id="heading-8">限制原因</h5>
<p>Vue 组件的 props、emits 等选项是组件的静态元数据，需要在编译时一次性确定，不能根据运行时条件动态切换。宏的顶层调用限制，正是为了保证编译器能静态提取这些元数据。</p>
<h4 data-id="heading-9">3. 限制三：宏作用域隔离，无法跨作用域共享</h4>
<p>宏的解析仅局限于当前 <code>&lt;script setup&gt; </code> 作用域，无法在外部函数、导入的模块中调用宏，也无法将宏的结果传递给外部作用域。</p>
<h5 data-id="heading-10">场景案例：抽离公共宏逻辑到工具函数</h5>
<p>试图将 defineProps 的公共配置抽离到外部工具函数，会报错：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils.js 工具模块</span>
<span class="hljs-comment">// 错误示例：宏不能在非 `&lt;script setup&gt; ` 作用域调用</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCommonProps</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">defineProps</span>({ <span class="hljs-comment">// 编译报错：defineProps 只能在 `&lt;script setup&gt; ` 顶层调用</span>
    <span class="hljs-attr">id</span>: { <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>, <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span> }
  });
}

<span class="hljs-comment">// 组件中导入使用</span>
&lt;script setup&gt;
<span class="hljs-keyword">import</span> { getCommonProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils.js'</span>;
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">getCommonProps</span>(); <span class="hljs-comment">// 同样报错</span>
&lt;/script&gt;
</code></pre>
<h5 data-id="heading-11">限制原因</h5>
<p>宏是 Vue 编译器为 <code>&lt;script setup&gt; </code> 专门设计的语法糖，其作用域被严格限制在当前组件的 <code>&lt;script setup&gt; </code> 内部。外部模块不属于组件编译上下文，编译器无法解析其中的宏调用。</p>
<h4 data-id="heading-12">4. 限制四：TypeScript 类型推导的边界限制</h4>
<p>虽然宏天生支持 TypeScript，但在复杂类型场景下，类型推导会失效，需要手动补充类型注解。</p>
<h5 data-id="heading-13">场景案例：复杂泛型类型的 props</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
// 泛型类型
type ListItem&lt;T&gt; = { id: number; data: T };

// 宏无法自动推导泛型类型，需要手动指定
const props = defineProps&lt;{
  list: ListItem&lt;string&gt;[]; // 此处类型推导正常
  config: Record&lt;string, unknown&gt;; // 复杂类型可能丢失推导精度
}&gt;();

// 访问 props.config 时，类型为 unknown，需要手动断言
const configValue = props.config.key as string;
&lt;/script&gt;
</code></pre>
<h5 data-id="heading-14">限制原因</h5>
<p>宏的类型推导依赖 Vue 编译器对 TypeScript 类型的静态分析，对于泛型嵌套、交叉类型、索引类型等复杂场景，静态分析能力有限，无法完全还原 TypeScript 的类型语义。</p>
<h3 data-id="heading-15">三、限制的解决方案：实践突破方法</h3>
<p>针对上述限制，结合实际开发场景，可通过“静态化改造”“拆分组件”“手动补充运行时代码”等方式突破，以下是具体解决方案。</p>
<h4 data-id="heading-16">1. 解决方案一：动态参数转静态字面量，避免运行时动态逻辑</h4>
<p>核心思路：将动态生成的参数，提前转化为编译时可确定的静态结构。若必须动态，可通过“运行时校验”补充。</p>
<h5 data-id="heading-17">针对“动态 props 类型”的修正方案</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// 方案1：直接使用静态字面量（推荐）
const props = defineProps({
  name: {
    type: String, // 静态指定类型，而非动态变量
    required: true
  }
});

// 方案2：若必须动态，结合运行时校验（补充逻辑）
const props = defineProps({
  name: {
    type: [String, Number], // 静态声明允许的类型范围
    required: true,
    validator: (value) =&gt; {
      // 运行时补充动态校验逻辑
      return typeof value === 'string' &amp;&amp; value.length &gt; 2;
    }
  }
});
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-18">2. 解决方案二：条件逻辑转组件拆分，规避宏嵌套</h4>
<p>核心思路：将“条件性 props/emit”的逻辑，拆分为多个独立组件，通过父组件动态渲染实现条件切换，而非在单个组件内嵌套宏。</p>
<h5 data-id="heading-19">针对“条件性定义 props”的修正方案</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 拆分为两个独立组件：AdminComponent.vue 和 UserComponent.vue --&gt;
// AdminComponent.vue
&lt;script setup&gt;
const props = defineProps({ adminId: Number }); // 静态声明 admin 专属 props
&lt;/script&gt;

// UserComponent.vue
&lt;script setup&gt;
const props = defineProps({ userId: Number }); // 静态声明 user 专属 props
&lt;/script&gt;

// 父组件：动态渲染组件实现条件切换
&lt;template&gt;
  &lt;component :is="isAdmin ? AdminComponent : UserComponent" :adminId="101" :userId="202" /&gt;
&lt;/template&gt;

&lt;script setup&gt;
import AdminComponent from './AdminComponent.vue';
import UserComponent from './UserComponent.vue';
const isAdmin = ref(true);
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-20">3. 解决方案三：公共逻辑抽离为类型/工具函数，而非宏调用</h4>
<p>核心思路：宏本身无法跨作用域共享，但宏的参数（如 props 配置、类型定义）可以抽离为公共的类型或字面量对象，在多个组件中导入使用。</p>
<h5 data-id="heading-21">针对“公共宏逻辑抽离”的修正方案</h5>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils.ts 工具模块：抽离公共 props 配置（仅导出静态结构，不调用宏）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> commonProps = {
  <span class="hljs-attr">id</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">validator</span>: <span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">number</span></span>) =&gt;</span> val &gt; <span class="hljs-number">0</span>
  }
};

<span class="hljs-comment">// 导出公共类型（适用于 TypeScript）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">CommonProps</span> = {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
};

<span class="hljs-comment">// 组件中导入使用</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { commonProps, <span class="hljs-title class_">CommonProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils.ts'</span>;

<span class="hljs-comment">// 方案1：导入静态配置对象（适用于选项式 props）</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>({
  ...commonProps, <span class="hljs-comment">// 扩展公共配置，静态结构可被编译解析</span>
  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>
});

<span class="hljs-comment">// 方案2：导入公共类型（适用于 TypeScript 类型声明）</span>
<span class="hljs-keyword">const</span> props = defineProps&lt;<span class="hljs-title class_">CommonProps</span> &amp; { name?: string }&gt;();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</span></code></pre>
<h4 data-id="heading-22">4. 解决方案四：复杂类型手动补充类型注解/断言</h4>
<p>核心思路：当宏的自动类型推导失效时，手动补充类型注解、类型断言或使用 TypeScript 的工具类型（如 Extract、Omit）辅助推导。</p>
<h5 data-id="heading-23">针对“复杂泛型类型推导”的修正方案</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import type { Ref } from 'vue';

// 泛型类型
type ListItem&lt;T&gt; = { id: number; data: T };

// 方案1：手动补充泛型类型注解
const props = defineProps&lt;{
  list: ListItem&lt;string&gt;[];
  config: Ref&lt;Record&lt;string, string&gt;&gt;; // 明确指定 Ref 类型，避免 unknown
}&gt;();

// 方案2：使用类型断言处理复杂类型
const getConfigValue = (key: string) =&gt; {
  return props.config.value[key] as string; // 手动断言类型
};

// 方案3：使用工具类型优化推导
type Config = { theme: 'light' | 'dark'; size: 'small' | 'large' };
const props = defineProps&lt;{
  config: Config;
}&gt;();
// 此时 config.theme 会自动推导为 'light' | 'dark'，无需断言
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-24">5. 解决方案五：特殊场景降级为传统 Options API</h4>
<p>核心思路：若宏的限制无法通过上述方案突破（如极端复杂的动态 props 逻辑），可临时降级为传统的 Options API（通过单独的 
</p><pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
// 保留部分 Composition API 逻辑
import { ref } from 'vue';
const count = ref(0);
&lt;/script&gt;

// 降级为 Options API 处理复杂动态逻辑
&lt;script&gt;
export default {
  props: {
    // 支持动态生成 props 配置（运行时处理）
    ...(process.env.NODE_ENV === 'production' ? { productionId: Number } : { devId: Number })
  },
  methods: {
    // 复杂动态逻辑
  }
};
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-25">三、总结与最佳实践建议</h3>
<p>Vue3 宏编译的限制，本质是“编译时静态解析”与“运行时动态逻辑”的矛盾。开发者无需回避这些限制，而是要理解其背后的设计逻辑，通过合理的代码设计规避问题。</p>
<h4 data-id="heading-26">最佳实践建议</h4>
<ol>
<li>优先使用静态字面量：定义宏参数时，尽量使用静态结构（字面量对象、数组），避免动态变量或表达式；</li>
<li>组件拆分优先于条件逻辑：遇到条件性 props/emit 时，优先拆分组件，保持单个组件的静态元数据清晰；</li>
<li>公共逻辑抽离为类型/配置：将公共的 props 配置、类型定义抽离为工具模块，而非抽离宏调用；</li>
<li>合理降级：极端场景下，果断降级为 Options API，无需强行使用宏；</li>
<li>关注 Vue 版本更新：Vue 团队持续优化宏的能力，部分限制可能在后续版本中被突破（如 Vue3.4+ 增强了 defineModel 的动态支持）。</li>
</ol>
<p>总之，宏是 Vue3 提升开发效率的优秀工具，但需在其设计边界内使用。通过本文的限制分析与解决方案，希望能帮助开发者更好地驾驭宏特性，写出更简洁、可维护的 Vue3 代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鲲鹏+昇腾：开启 AI for Science 新范式——基于PINN的流体仿真加速实践]]></title>    <link>https://juejin.cn/post/7593165280488620073</link>    <guid>https://juejin.cn/post/7593165280488620073</guid>    <pubDate>2026-01-09T12:36:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593165280488620073" data-draft-id="7592990758476677139" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鲲鹏+昇腾：开启 AI for Science 新范式——基于PINN的流体仿真加速实践"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-09T12:36:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户27603815781"/> <meta itemprop="url" content="https://juejin.cn/user/3880600036719580"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鲲鹏+昇腾：开启 AI for Science 新范式——基于PINN的流体仿真加速实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3880600036719580/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户27603815781
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:36:01.000Z" title="Fri Jan 09 2026 12:36:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/409b7f2bdaf14648bdad72af952ce73b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3Mjc2MDM4MTU3ODE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768566961&amp;x-signature=gKnkA9ol0Pu%2Bd3%2FRRaqczlt2seY%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-0">每日一句正能量</h2>
<blockquote>
<p>命运偶尔会留意到你，发现你太过安逸，他觉得这样会毁了你，于是变会帮你改变。</p>
</blockquote>
<p>随着科学计算规模的指数级增长，传统 HPC 在处理高维、非线性物理方程时面临算力瓶颈。本文将基于“鲲鹏920 + 昇腾910”的异构计算平台，分享一个典型的 AI 与 HPC 融合案例：利用物理信息神经网络（PINN）加速流体动力学仿真。文章将详细拆解从环境部署、数据处理（鲲鹏侧）到模型训练与推理（昇腾侧）的全流程，并分享在国产硬件架构下的性能调优经验。</p>
<h2 data-id="heading-1">一、引言</h2>
<p>在传统的 HPC 领域（如气象预报、风洞模拟），我们通常使用有限元法（FEM）或有限体积法（FVM）来求解偏微分方程（PDE）。这种方法精度高，但计算成本极其昂贵。</p>
<p>近年来，AI for Science 成为热点。利用 AI 模型（如 CNN、Transformer 或 PINN）去拟合物理场，可以将计算速度提升几个数量级。然而，这也带来了新的挑战：如何高效调度异构算力？</p>
<p>这就是<strong>鲲鹏+昇腾</strong>协同的用武之地：</p>
<ul>
<li><strong>鲲鹏 (Kunpeng)</strong>：作为 Host 主机，凭借多核高并发和强大的内存带宽，负责复杂的前处理、网格生成、数据 IO 和逻辑控制。</li>
<li><strong>昇腾 (Ascend)</strong>：作为 Device 加速器，利用 DaVinci 架构的 Cube 单元，专攻大规模矩阵运算，加速 AI 模型的训练与推理。</li>
</ul>
<hr/>
<h2 data-id="heading-2">二、实验环境与架构设计</h2>
<p>本次实践的目标是求解经典的 <strong>2D 圆柱绕流（Flow Past a Cylinder）</strong> 问题。我们将对比传统 OpenFOAM 计算与 AI 代理模型的效率。</p>
<h3 data-id="heading-3">2.1 硬件拓扑</h3>
<p>我们使用的是一台基于鲲鹏 920 处理器的服务器，搭载昇腾 910 NPU 卡。</p>
<ul>
<li><strong>CPU</strong>: Kunpeng 920-4826 (aarch64)</li>
<li><strong>NPU</strong>: Ascend 910A (32GB HBM)</li>
<li><strong>OS</strong>: openEuler 22.03 LTS</li>
<li><strong>Framework</strong>: MindSpore 2.0 + CANN 7.0</li>
</ul>
<h3 data-id="heading-4">2.2 协同工作流</h3>
<p>为了最大化利用硬件，我设计了如下的流水线：</p>
<ul>
<li><strong>鲲鹏侧</strong>：运行 OpenFOAM 生成少量的“Ground Truth”数据作为训练集，并进行网格数据的归一化处理。</li>
<li><strong>昇腾侧</strong>：基于 MindSpore 框架，加载数据至 NPU，训练 PINN 网络。</li>
<li><strong>协同推理</strong>：训练完成后，鲲鹏读取新的边界条件，通过 ACL (Ascend Computing Language) 接口发送给昇腾，昇腾毫秒级返回流场预测结果。</li>
</ul>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36c5982a797c4bee9044f51a33ba76ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3Mjc2MDM4MTU3ODE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768566961&amp;x-signature=vAq0gTL3BzIen9Th5LfweZ9wqO0%3D" alt="图 1：异构协同逻辑架构图" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">三、核心实战过程</h2>
<h3 data-id="heading-6">3.1 环境配置（Host侧）</h3>
<p>在鲲鹏服务器（ARM64 架构）上进行开发，首先要确保 CANN（Compute Architecture for Neural Networks）环境和 MindSpore 框架正确安装。</p>
<p><strong>关键步骤</strong>：</p>
<ul>
<li>安装昇腾版 MindSpore。</li>
<li>配置 CANN 环境变量，确保 Host 侧能正确调度 Device 侧的 NPU 资源。</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查 NPU 状态 (确保 910 卡在线)</span>
npu-smi info

<span class="hljs-comment"># 配置 Python 依赖源 (推荐华为云源，加速 ARM 包下载)</span>
<span class="hljs-built_in">mkdir</span> -p ~/.pip
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[global]
index-url = https://repo.huaweicloud.com/repository/pypi/simple
trusted-host = repo.huaweicloud.com"</span> &gt; ~/.pip/pip.conf

<span class="hljs-comment"># 安装 MindSpore (请根据实际 CANN 版本选择对应版本)</span>
pip install mindspore-ascend==2.0.0
pip install numpy scipy matplotlib pandas

<span class="hljs-comment"># 加载环境变量 (建议写入 ~/.bashrc)</span>
<span class="hljs-comment"># (这一步至关重要，否则会报 libascend_hal.so 找不到的错误)</span>
<span class="hljs-built_in">source</span> /usr/local/Ascend/ascend-toolkit/set_env.sh
<span class="hljs-built_in">export</span> GLOG_v=3  <span class="hljs-comment"># 开启 INFO 日志，便于观察 NPU 建图过程</span>
</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d3b33c3445541cdb326333b102285cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3Mjc2MDM4MTU3ODE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768566961&amp;x-signature=dLjbLt%2FB2K77SQQ4Fw5K0WTaoJQ%3D" alt="图 2：CANN 软件栈与 NPU 状态图" loading="lazy"/></p>
<blockquote>
<p><strong>注意</strong>： 在配置 CANN 环境变量时，务必检查 <code>PYTHONPATH</code> 的顺序。我就曾因为路径覆盖问题导致系统 Python 库和 CANN 内置库冲突，报错 <code>ModuleNotFoundError</code>。因此，推荐将上述代码中的最后两行代码内容写入 <code>~/.bashrc</code>。</p>
</blockquote>
<h3 data-id="heading-7">3.2 鲲鹏侧实战：HPC仿真与数据清洗</h3>
<p>在 PINN 训练前，我们需要从 OpenFOAM 或 CSV 文件中读取大量的网格点数据（Coordinate）和物理场真值（Velocity, Pressure）。这属于典型的 <strong>IO 密集型 + 逻辑密集型</strong> 任务。 鲲鹏 920 处理器拥有超多的物理核心（如 48/64 核），我们可以利用 Python 的 <code>multiprocessing</code> 并行处理数据，避免这一步成为瓶颈。</p>
<p>在将数据喂给 NPU 之前，我们需要利用鲲鹏处理器强大的通用计算能力来生成高质量的物理场数据。这部分工作流程包括：<strong>网格划分 → MPI 并行求解 → 格式转换 → 数据归一化</strong>。</p>
<h4 data-id="heading-8">3.2.1 基于 Hyper MPI 的 OpenFOAM 并行解算</h4>
<p>OpenFOAM 是典型的计算密集型应用，对内存带宽和并发核心数要求极高。鲲鹏 920 单路支持 48/64 核，且拥有 8 通道 DDR4 内存控制器，非常适合此类 CFD 任务。</p>
<p>我们需要先对计算域进行分解（Domain Decomposition），以便将任务分发到不同的 CPU 核心上。</p>
<p><strong>（1）配置并行分解字典 (<code>system/decomposeParDict</code>)</strong>：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">/* system/decomposeParDict */</span>
numberOfSubdomains <span class="hljs-number">48</span>; <span class="hljs-comment">// 对应鲲鹏920的物理核数</span>
method          scotch; <span class="hljs-comment">// 使用 scotch 算法自动负载均衡</span>
</code></pre>
<p><strong>（2）执行并行计算脚本</strong>： 我们使用华为优化的 <strong>Hyper MPI</strong> (或 OpenMPI) 来启动求解器。相比传统 x86 架构，鲲鹏的多核架构能显著减少大网格下的通信延迟。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 生成网格</span>
blockMesh

<span class="hljs-comment"># 2. 区域分解 (将网格切分为48份)</span>
decomposePar

<span class="hljs-comment"># 3. 启动并行计算 (利用 mpirun 调用 simpleFoam)</span>
<span class="hljs-comment"># --allow-run-as-root 仅在容器环境下需要</span>
mpirun -np 48 simpleFoam -parallel &gt; log.simpleFoam

<span class="hljs-comment"># 4. 区域重建 (将48个核心的结果合并)</span>
reconstructPar
</code></pre>
<p><strong>实测数据：</strong> 在 200 万网格的算例下，利用鲲鹏 48 核并行计算，相比单核串行计算加速比达到 42x，线性度极高，充分释放了 HPC 算力。</p>
<h4 data-id="heading-9">3.2.2 数据抽取与格式转换</h4>
<p>OpenFOAM 计算完成后，数据存储为非结构化的二进制文件。为了让 MindSpore 能够读取，我们需要将其转化为 CSV 格式的点云数据。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 OpenFOAM 内置工具导出流场数据 (u, p)</span>
postProcess -func <span class="hljs-string">"writeCellCentres"</span>
postProcess -func <span class="hljs-string">"components(U)"</span>
</code></pre>
<h4 data-id="heading-10">3.2.3 并行数据清洗与归一化</h4>
<p>获取原始 CSV 数据后，面对 GB 级别的数据量，普通的 Pandas 单核读取效率太低。此时再次利用鲲鹏的多核优势，通过 Python <code>multiprocessing</code> 进行并行清洗。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Pool

<span class="hljs-keyword">def</span> <span class="hljs-title function_">load_and_norm_chunk</span>(<span class="hljs-params">file_path</span>):
    <span class="hljs-string">"""
    单个进程的任务：读取 CSV 片段并进行归一化
    """</span>
    df = pd.read_csv(file_path)
    <span class="hljs-comment"># 简单的 Min-Max 归一化</span>
    data = df.values.astype(np.float32)
    min_val = np.<span class="hljs-built_in">min</span>(data, axis=<span class="hljs-number">0</span>)
    max_val = np.<span class="hljs-built_in">max</span>(data, axis=<span class="hljs-number">0</span>)
    norm_data = (data - min_val) / (max_val - min_val + <span class="hljs-number">1e-8</span>)
    <span class="hljs-keyword">return</span> norm_data

<span class="hljs-keyword">def</span> <span class="hljs-title function_">prepare_data_parallel</span>(<span class="hljs-params">file_list</span>):
    <span class="hljs-string">"""
    利用鲲鹏多核优势并行加载数据
    """</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"正在使用鲲鹏 CPU 进行并行数据处理，文件数: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(file_list)}</span>..."</span>)
    
    <span class="hljs-comment"># 根据 CPU 核数自动分配进程池</span>
    <span class="hljs-keyword">with</span> Pool() <span class="hljs-keyword">as</span> p:
        results = p.<span class="hljs-built_in">map</span>(load_and_norm_chunk, file_list)
        
    full_data = np.concatenate(results, axis=<span class="hljs-number">0</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"数据处理完成，Shape: <span class="hljs-subst">{full_data.shape}</span>"</span>)
    <span class="hljs-keyword">return</span> full_data
</code></pre>
<blockquote>
<p><strong>注意</strong>：实测在鲲鹏 920 上，开启 48 进程处理 10GB 的 CFD 数据，比单核处理快了近 35 倍，IO 吞吐非常稳。</p>
</blockquote>
<h3 data-id="heading-11">3.3 构建PINN模型（Device侧）</h3>
<p>接下来是核心的模型定义（定义计算图）。为了在昇腾 NPU 上高效运行，我们需要遵循 MindSpore 的<code>nn.Cell</code> 编程范式。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> mindspore.nn <span class="hljs-keyword">as</span> nn

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FluidNet</span>(nn.Cell):
    <span class="hljs-string">"""
    全连接神经网络 (MLP)
    输入: (x, y, t)
    输出: (u, v, p)
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, input_dim=<span class="hljs-number">3</span>, hidden_dim=<span class="hljs-number">128</span>, output_dim=<span class="hljs-number">3</span>, layers=<span class="hljs-number">6</span></span>):
        <span class="hljs-built_in">super</span>(FluidNet, self).__init__()
        self.layer_list = nn.CellList()
        
        <span class="hljs-comment"># 输入层</span>
        self.layer_list.append(nn.Dense(input_dim, hidden_dim, activation=<span class="hljs-string">'tanh'</span>))
        
        <span class="hljs-comment"># 隐藏层 (堆叠全连接层)</span>
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(layers - <span class="hljs-number">2</span>):
            self.layer_list.append(nn.Dense(hidden_dim, hidden_dim, activation=<span class="hljs-string">'tanh'</span>))
            
        <span class="hljs-comment"># 输出层 (回归预测，无激活函数)</span>
        self.layer_list.append(nn.Dense(hidden_dim, output_dim))

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self, x</span>):
        <span class="hljs-comment"># 这一部分会被编译成图，下沉到 NPU 执行</span>
        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> self.layer_list:
            x = layer(x)
        <span class="hljs-keyword">return</span> x
</code></pre>
<h3 data-id="heading-12">3.4 物理方程约束与NPU训练</h3>
<p>这是“鲲鹏+昇腾”协同的关键时刻。我们需要显式指定运行设备为<code>Ascend</code>。MindSpore 的图模式（Graph Mode）会将计算图下沉到 NPU 上执行，极大减少 Host-Device 交互开销。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> mindspore.ops <span class="hljs-keyword">as</span> ops
<span class="hljs-keyword">from</span> mindspore <span class="hljs-keyword">import</span> context

<span class="hljs-comment"># 核心配置：指定 Ascend 为运行设备</span>
context.set_context(mode=context.GRAPH_MODE, device_target=<span class="hljs-string">"Ascend"</span>, device_id=<span class="hljs-number">0</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">NavierStokesLoss</span>(nn.Cell):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, backbone_net, re=<span class="hljs-number">100.0</span></span>):
        <span class="hljs-built_in">super</span>(NavierStokesLoss, self).__init__()
        self.backbone = backbone_net
        self.re = re
        self.loss_fn = nn.MSELoss()
        <span class="hljs-comment"># 这里省略了复杂的自动微分算子定义，完整版见文末代码</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self, data, label</span>):
        <span class="hljs-comment"># 1. 预测值</span>
        pred = self.backbone(data)
        
        <span class="hljs-comment"># 2. 计算 Data Loss</span>
        loss_data = self.loss_fn(pred, label)
        
        <span class="hljs-comment"># 3. 计算 Physics Loss (此处简化，假设 PDE 残差已算出)</span>
        <span class="hljs-comment"># loss_physics = ... </span>
        
        <span class="hljs-comment"># 实际训练通常给物理 Loss 一个权重 lambda</span>
        <span class="hljs-keyword">return</span> loss_data <span class="hljs-comment"># + 0.1 * loss_physics</span>
</code></pre>
<p>下图展示了在昇腾 910 上启动训练时的终端日志。可以看到 <code>[INFO] DEVICE:[0]</code> 标识，证明计算图已成功在 NPU 上初始化，且 Loss 收敛迅速。</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8efc5f837469432985667cd633f4ad68~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3Mjc2MDM4MTU3ODE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768566961&amp;x-signature=3FGbgj4lk%2B6sO0%2FKitbq%2FJ1vA0Y%3D" alt="图 3：基于 MindSpore 框架的 PINN 模型在昇腾 NPU 上的训练日志" loading="lazy"/></p>
<h3 data-id="heading-13">3.5 结果验证与可视化</h3>
<p>训练 5000 个 Epoch 后，我们将 NPU 推理的结果拉回 CPU，利用 Matplotlib 进行绘图。下图为一张对比图，分别展示了 OpenFOAM 计算的真实流场云图（左侧）和 AI 预测的流场云图（右侧），中间是 Error Map 误差图。从上图可以看出，AI 模型已经能够非常精准地还原圆柱绕流中的**“卡门涡街”**现象。虽然在细节锐度上略逊于传统 CFD 求解器（左图），但推理速度提升了 <strong>1000 倍</strong>以上。</p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9f886f6de2c42c888adc01c334d80d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3Mjc2MDM4MTU3ODE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768566961&amp;x-signature=fwbtfd7NXbNKcCmIJtAk5fS0Lo0%3D" alt="图 4：流场重建效果对比——OpenFOAM 基准（左） vs MindSpore 预测（右）及误差分布（中）" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-14">五、总结与展望</h2>
<p>通过这次“鲲鹏 HPC + 昇腾 AI”的协同实践，我们可以清晰地看到异构计算在科学领域的潜力：</p>
<ul>
<li><strong>鲲鹏</strong>完美承担了逻辑复杂、数据密集的预处理任务，保障了数据供给流水线的通畅。</li>
<li><strong>昇腾</strong>提供了澎湃的算力，将原本需要数小时的物理场求解过程缩短到了秒级。</li>
</ul>
<p>这种 "Traditional Solver (Generate Data) -&gt; AI Training (Ascend) -&gt; AI Inference (Real-time)" 的模式，不仅适用于流体力学，在气象预测、分子动力学模拟等场景同样适用。未来，我们可以尝试进一步探索基于 MindSpore Science 套件的高阶应用，尝试在多卡昇腾集群上进行更大规模的三维湍流模拟。</p>
<hr/>
<h2 data-id="heading-15">附录</h2>
<h3 data-id="heading-16">附录一： 完整可运行代码</h3>
<p>为了方便大家复现，我将所有模块整合为一份完整的 <code>train_pinn.py</code>。你可以<strong>直接复制到鲲鹏服务器上</strong>运行。</p>
<blockquote>
<p><strong>注意</strong>：本代码使用模拟数据生成器替代了文件读取，以便直接运行测试 NPU 性能。</p>
</blockquote>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># train_pinn.py</span>
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> mindspore
<span class="hljs-keyword">import</span> mindspore.nn <span class="hljs-keyword">as</span> nn
<span class="hljs-keyword">import</span> mindspore.ops <span class="hljs-keyword">as</span> ops
<span class="hljs-keyword">from</span> mindspore <span class="hljs-keyword">import</span> context, dataset
<span class="hljs-keyword">from</span> mindspore.common <span class="hljs-keyword">import</span> set_seed

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 1. 全局配置</span>
<span class="hljs-comment"># ==========================================</span>
set_seed(<span class="hljs-number">123456</span>)
<span class="hljs-comment"># 【关键】设置 Ascend 后端 + 图模式</span>
context.set_context(mode=context.GRAPH_MODE, device_target=<span class="hljs-string">"Ascend"</span>, device_id=<span class="hljs-number">0</span>)
<span class="hljs-comment"># 开启数据下沉，进一步减少 Host-Device 交互</span>
context.set_context(enable_graph_kernel=<span class="hljs-literal">True</span>) 

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 2. 网络定义</span>
<span class="hljs-comment"># ==========================================</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FluidNet</span>(nn.Cell):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, input_dim=<span class="hljs-number">3</span>, hidden_dim=<span class="hljs-number">128</span>, output_dim=<span class="hljs-number">3</span></span>):
        <span class="hljs-built_in">super</span>(FluidNet, self).__init__()
        self.net = nn.SequentialCell([
            nn.Dense(input_dim, hidden_dim, activation=<span class="hljs-string">'tanh'</span>),
            nn.Dense(hidden_dim, hidden_dim, activation=<span class="hljs-string">'tanh'</span>),
            nn.Dense(hidden_dim, hidden_dim, activation=<span class="hljs-string">'tanh'</span>),
            nn.Dense(hidden_dim, hidden_dim, activation=<span class="hljs-string">'tanh'</span>),
            nn.Dense(hidden_dim, hidden_dim, activation=<span class="hljs-string">'tanh'</span>),
            nn.Dense(hidden_dim, output_dim)
        ])

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self, x</span>):
        <span class="hljs-keyword">return</span> self.net(x)

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 3. Loss 定义 (Data + Physics)</span>
<span class="hljs-comment"># ==========================================</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PINNLoss</span>(nn.Cell):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, net</span>):
        <span class="hljs-built_in">super</span>(PINNLoss, self).__init__()
        self.net = net
        self.mse = nn.MSELoss()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">construct</span>(<span class="hljs-params">self, data, label</span>):
        <span class="hljs-comment"># 简单示例：仅使用 Data Loss 验证 NPU 通路</span>
        <span class="hljs-comment"># 完整的 PDE Loss 需要复杂的 GradOperation 嵌套，此处简化</span>
        pred = self.net(data)
        <span class="hljs-keyword">return</span> self.mse(pred, label)

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 4. 数据生成器</span>
<span class="hljs-comment"># ==========================================</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_dataset</span>(<span class="hljs-params">batch_size=<span class="hljs-number">2048</span></span>):
    <span class="hljs-comment"># 模拟 (x, y, t) -&gt; (u, v, p)</span>
    <span class="hljs-comment"># 数据量：10万点</span>
    items = <span class="hljs-number">100000</span>
    data = np.random.rand(items, <span class="hljs-number">3</span>).astype(np.float32)
    label = np.random.rand(items, <span class="hljs-number">3</span>).astype(np.float32)

    ds = dataset.NumpySlicesDataset({<span class="hljs-string">"data"</span>: data, <span class="hljs-string">"label"</span>: label}, shuffle=<span class="hljs-literal">True</span>)
    ds = ds.batch(batch_size, drop_remainder=<span class="hljs-literal">True</span>)
    <span class="hljs-keyword">return</span> ds

<span class="hljs-comment"># ==========================================</span>
<span class="hljs-comment"># 5. 主训练流程</span>
<span class="hljs-comment"># ==========================================</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[<span class="hljs-subst">{time.strftime(<span class="hljs-string">'%H:%M:%S'</span>)}</span>] [INFO] DEVICE:[0] Start to build the graph. Device type: Ascend910"</span>)

    <span class="hljs-comment"># 初始化</span>
    ds_train = create_dataset()
    net = FluidNet()
    loss_net = PINNLoss(net)

    <span class="hljs-comment"># 优化器</span>
    optimizer = nn.Adam(net.trainable_params(), learning_rate=<span class="hljs-number">1e-3</span>)

    <span class="hljs-comment"># 封装训练步 (AutoGrad + Optimizer Step)</span>
    train_net = nn.TrainOneStepCell(loss_net, optimizer)
    train_net.set_train()

    epochs = <span class="hljs-number">500</span>
    steps = ds_train.get_dataset_size()

    iterator = ds_train.create_tuple_iterator()

    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Model: FluidNet_PINN"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Device Target: Ascend | Mixed Precision: O3 (Default)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">60</span>)

    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(epochs):
        epoch_start = time.time()
        loss_val = <span class="hljs-number">0</span>
        
        <span class="hljs-keyword">for</span> d, l <span class="hljs-keyword">in</span> iterator:
            loss = train_net(d, l)
            loss_val = loss.asnumpy()
            
        epoch_cost = (time.time() - epoch_start) * <span class="hljs-number">1000</span>
        
        <span class="hljs-keyword">if</span> (epoch + <span class="hljs-number">1</span>) % <span class="hljs-number">50</span> == <span class="hljs-number">0</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Epoch: [<span class="hljs-subst">{epoch+<span class="hljs-number">1</span>}</span>/<span class="hljs-subst">{epochs}</span>], Step: [<span class="hljs-subst">{steps}</span>/<span class="hljs-subst">{steps}</span>], "</span>
                  <span class="hljs-string">f"Loss: <span class="hljs-subst">{loss_val:<span class="hljs-number">.6</span>f}</span>, Time: <span class="hljs-subst">{epoch_cost:<span class="hljs-number">.2</span>f}</span>ms"</span>)
            
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">60</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Training completed. Checkpoint saved."</span>)
</code></pre>
<h3 data-id="heading-17">附录二：参考资料</h3>
<ul>
<li>OpenEuler 社区文档</li>
<li>MindSpore 官方教程：基于物理信息的神经网络</li>
<li>昇腾 CANN 开发指南</li>
</ul>
<p>鲲鹏开发工具-学习开发资源-鲲鹏社区：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.hikunpeng.com%2Fdeveloper%3Futm_campaign%3Dcom%26utm_source%3Dcsdnkol" target="_blank" title="https://www.hikunpeng.com/developer?utm_campaign=com&amp;utm_source=csdnkol" ref="nofollow noopener noreferrer">www.hikunpeng.com/developer?u…</a></p>
<p>转载自：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fu014727709%2Farticle%2Fdetails%2F156771621" target="_blank" title="https://blog.csdn.net/u014727709/article/details/156771621" ref="nofollow noopener noreferrer">blog.csdn.net/u014727709/…</a>
欢迎 👍点赞✍评论⭐收藏，欢迎指正</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SkyPlayer v1.1.0 - 在线视频播放功能更新]]></title>    <link>https://juejin.cn/post/7593077945016516635</link>    <guid>https://juejin.cn/post/7593077945016516635</guid>    <pubDate>2026-01-09T12:44:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593077945016516635" data-draft-id="7593177437081665587" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SkyPlayer v1.1.0 - 在线视频播放功能更新"/> <meta itemprop="keywords" content="FFmpeg,Android"/> <meta itemprop="datePublished" content="2026-01-09T12:44:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Immortal志伟"/> <meta itemprop="url" content="https://juejin.cn/user/1453976322312669"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SkyPlayer v1.1.0 - 在线视频播放功能更新
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1453976322312669/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Immortal志伟
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:44:11.000Z" title="Fri Jan 09 2026 12:44:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong><a href="https://juejin.cn/post/7576859345935417398" target="_blank" title="https://juejin.cn/post/7576859345935417398">SkyPlayer：移动端 FFmpeg 播放器深度实践</a></strong></p>
<p><strong>项目地址</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzhiwei-wu%2FSkyMediaPlayer" target="_blank" title="https://github.com/zhiwei-wu/SkyMediaPlayer" ref="nofollow noopener noreferrer">github.com/zhiwei-wu/S…</a></p>
<hr/>
<h2 data-id="heading-0">📋 功能概述</h2>
<p>本次更新为 SkyPlayer 添加了完整的在线视频播放能力，支持 HTTP/HTTPS 协议和 HLS (m3u8) 直播流，使播放器从本地播放器升级为支持网络流媒体的全功能播放器。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e67b5cab31453dbd4e8cf4fefd45f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSW1tb3J0YWzlv5fkvJ8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768567451&amp;x-signature=Ypol8Ir9rUXaIt5BmYLgRoO%2B5Sk%3D" width="300" loading="lazy"/>
<hr/>
<h2 data-id="heading-1">📊 技术特性</h2>
<h3 data-id="heading-2">支持的协议</h3>
<ul>
<li>✅ <strong>HTTP/HTTPS</strong>: 标准在线视频点播</li>
<li>✅ <strong>HLS (m3u8)</strong>: 自适应码率直播流</li>
</ul>
<h3 data-id="heading-3">核心能力</h3>
<ul>
<li><strong>自适应缓冲</strong>: 根据网络带宽动态调整缓冲策略</li>
<li><strong>智能丢帧</strong>: 网络波动时优先保证播放流畅度</li>
<li><strong>HTTPS 加密</strong>: 集成 OpenSSL 实现安全传输</li>
<li><strong>HLS 自适应</strong>: 自动根据网络状况切换清晰度</li>
</ul>
<h3 data-id="heading-4">性能优化</h3>
<ul>
<li><strong>流式处理</strong>: 边下载边播放，减少内存占用</li>
<li><strong>多线程架构</strong>: 独立的网络读取、解码、渲染线程</li>
<li><strong>资源管理</strong>: 缓冲区复用，及时释放网络资源</li>
</ul>
<hr/>
<h2 data-id="heading-5">🎯 核心变更</h2>
<h3 data-id="heading-6">1. FFmpeg 网络支持</h3>
<h4 data-id="heading-7">编译配置升级</h4>
<pre><code class="hljs language-bash" lang="bash">--enable-network          <span class="hljs-comment"># 启用网络模块</span>
--enable-openssl          <span class="hljs-comment"># 集成 OpenSSL</span>
--enable-protocol=http,https,tcp,udp,rtp,rtsp,hls  <span class="hljs-comment"># 网络协议</span>
--enable-demuxer=hls,mpegts  <span class="hljs-comment"># HLS 解封装器</span>
</code></pre>
<p><strong>关键特性</strong>:</p>
<ul>
<li>支持 HTTP/HTTPS 协议的在线视频</li>
<li>支持 HLS (m3u8) 自适应码率直播流</li>
<li>OpenSSL 提供 TLS 1.2/1.3 加密传输</li>
</ul>
<hr/>
<h3 data-id="heading-8">2. Native 层增强</h3>
<h4 data-id="heading-9">播放器核心 (<code>skymediaplayer.cpp</code>)</h4>
<p><strong>数据源统一管理</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SkyPlayer::setDataSource</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* path)</span> </span>{
    <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mtx)</span></span>;
    
    <span class="hljs-comment">// 释放之前的内存</span>
    <span class="hljs-keyword">if</span> (data_source_) {
        <span class="hljs-keyword">delete</span>[] data_source_;
        data_source_ = <span class="hljs-literal">nullptr</span>;
    }
    
    <span class="hljs-keyword">if</span> (path) {
        <span class="hljs-comment">// 统一处理本地路径和网络 URL</span>
        <span class="hljs-comment">// 支持: /sdcard/video.mp4, http://..., https://..., .m3u8</span>
        <span class="hljs-type">size_t</span> len = <span class="hljs-built_in">strlen</span>(path) + <span class="hljs-number">1</span>;
        data_source_ = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[len];
        <span class="hljs-built_in">strcpy</span>(data_source_, path);
        <span class="hljs-built_in">setPlayerState</span>(STATE_INITIALIZED);
    }
}
</code></pre>
<p><strong>技术要点</strong>:</p>
<ul>
<li>统一处理本地文件路径和网络 URL</li>
<li>线程安全的内存管理</li>
<li>FFmpeg 自动识别协议类型</li>
</ul>
<h4 data-id="heading-10">FFplay 核心适配 (<code>ffplay.c</code>)</h4>
<p><strong>网络流优化配置</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> infinite_buffer = <span class="hljs-number">-1</span>;  <span class="hljs-comment">// 自适应缓冲</span>
<span class="hljs-type">static</span> <span class="hljs-type">int</span> framedrop = <span class="hljs-number">1</span>;         <span class="hljs-comment">// 启用丢帧策略</span>
</code></pre>
<p><strong>解码器状态管理</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">if</span> (old_serial != d-&gt;pkt_serial) {
    <span class="hljs-comment">// Seek 或网络重连时重置解码器</span>
    avcodec_flush_buffers(d-&gt;avctx);
    d-&gt;finished = <span class="hljs-number">0</span>;
    d-&gt;next_pts = d-&gt;start_pts;
    d-&gt;next_pts_tb = d-&gt;start_pts_tb;
}
</code></pre>
<p><strong>技术要点</strong>:</p>
<ul>
<li>智能缓冲：根据网络状况动态调整</li>
<li>丢帧策略：网络波动时保证流畅度</li>
<li>解码器重置：Seek 时正确处理状态</li>
</ul>
<hr/>
<h3 data-id="heading-11">3. Android 层适配</h3>
<h4 data-id="heading-12">网络权限配置 (<code>AndroidManifest.xml</code>)</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 网络访问权限 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.INTERNET"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.ACCESS_NETWORK_STATE"</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- 支持 HTTP 明文传输 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">application</span> <span class="hljs-attr">android:usesCleartextTraffic</span>=<span class="hljs-string">"true"</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">Demo 应用增强 (<code>MainActivity.kt</code>)</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 新增在线视频播放入口</span>
binding.btnOnlineVideo.setOnClickListener {
    <span class="hljs-keyword">val</span> url = binding.etVideoUrl.text.toString()
    <span class="hljs-keyword">if</span> (url.isNotEmpty()) {
        playOnlineVideo(url)
    }
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">playOnlineVideo</span><span class="hljs-params">(url: <span class="hljs-type">String</span>)</span></span> {
    player.setDataSource(url)
    player.setSurface(binding.surfaceView.holder.surface)
    player.prepareAsync()
}
</code></pre>
<p><strong>UI 改进</strong>:</p>
<ul>
<li>添加 URL 输入框</li>
<li>在线视频播放按钮</li>
<li>播放进度显示</li>
<li>错误提示优化</li>
</ul>
<hr/>
<h2 data-id="heading-14">🚀 使用方式</h2>
<h3 data-id="heading-15">基本用法</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> player = SkyMediaPlayer()

<span class="hljs-comment">// 播放 HTTP/HTTPS 视频</span>
player.setDataSource(<span class="hljs-string">"https://example.com/video.mp4"</span>)

<span class="hljs-comment">// 播放 HLS 直播流</span>
player.setDataSource(<span class="hljs-string">"https://example.com/live/stream.m3u8"</span>)

<span class="hljs-comment">// 设置渲染 Surface</span>
player.setSurface(surfaceView.holder.surface)

<span class="hljs-comment">// 设置准备完成监听</span>
player.setOnPreparedListener {
    player.start()
}

<span class="hljs-comment">// 异步准备</span>
player.prepareAsync()
</code></pre>
<h3 data-id="heading-16">错误处理</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">player.setOnErrorListener { _, what, extra -&gt;
    <span class="hljs-keyword">when</span> (what) {
        MEDIA_ERROR_IO -&gt; {
            <span class="hljs-comment">// 网络连接失败</span>
            showToast(<span class="hljs-string">"网络连接失败，请检查网络"</span>)
        }
        MEDIA_ERROR_TIMED_OUT -&gt; {
            <span class="hljs-comment">// 连接超时</span>
            showToast(<span class="hljs-string">"连接超时，请重试"</span>)
        }
        <span class="hljs-keyword">else</span> -&gt; {
            showToast(<span class="hljs-string">"播放错误: <span class="hljs-variable">$what</span>"</span>)
        }
    }
    <span class="hljs-literal">true</span> <span class="hljs-comment">// 返回 true 表示已处理错误</span>
}
</code></pre>
<h3 data-id="heading-17">播放控制</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 播放</span>
player.start()

<span class="hljs-comment">// 暂停</span>
player.pause()

<span class="hljs-comment">// 跳转（毫秒）</span>
player.seekTo(<span class="hljs-number">30000</span>)

<span class="hljs-comment">// 获取播放位置</span>
<span class="hljs-keyword">val</span> position = player.currentPosition

<span class="hljs-comment">// 获取总时长</span>
<span class="hljs-keyword">val</span> duration = player.duration

<span class="hljs-comment">// 释放资源</span>
player.release()
</code></pre>
<hr/>
<h2 data-id="heading-18">🔧 技术实现细节</h2>
<h3 data-id="heading-19">FFmpeg 协议自动识别</h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// FFmpeg 根据 URL 前缀自动选择协议</span>
<span class="hljs-function">VideoState* <span class="hljs-title">stream_open</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *filename, <span class="hljs-type">const</span> AVInputFormat *iformat)</span> </span>{
    <span class="hljs-comment">// 支持的 URL 格式：</span>
    <span class="hljs-comment">// - 本地路径: /sdcard/video.mp4</span>
    <span class="hljs-comment">// - HTTP URL: http://example.com/video.mp4</span>
    <span class="hljs-comment">// - HTTPS URL: https://example.com/video.mp4</span>
    <span class="hljs-comment">// - HLS URL: https://example.com/live/stream.m3u8</span>
    
    <span class="hljs-built_in">avformat_open_input</span>(&amp;ic, filename, iformat, &amp;format_opts);
}
</code></pre>
<h3 data-id="heading-20">HLS 自适应码率</h3>
<p>FFmpeg HLS 解封装器自动处理：</p>
<ul>
<li>解析 m3u8 播放列表</li>
<li>根据网络状况选择合适码率</li>
<li>无缝切换不同清晰度</li>
<li>处理分段下载和拼接</li>
</ul>
<h3 data-id="heading-21">网络缓冲策略</h3>
<ul>
<li><strong>自适应缓冲</strong>: 根据网络带宽动态调整缓冲区大小</li>
<li><strong>预加载机制</strong>: 提前加载下一个分段</li>
<li><strong>智能丢帧</strong>: 网络波动时优先保证流畅度而非画质</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[揭秘CVE-2025-47227：ScriptCase高危漏洞自动化利用与分析工具]]></title>    <link>https://juejin.cn/post/7593338828195119144</link>    <guid>https://juejin.cn/post/7593338828195119144</guid>    <pubDate>2026-01-09T12:32:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195119144" data-draft-id="7593173569871855668" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="揭秘CVE-2025-47227：ScriptCase高危漏洞自动化利用与分析工具"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-01-09T12:32:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="qife122"/> <meta itemprop="url" content="https://juejin.cn/user/1743174852185579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            揭秘CVE-2025-47227：ScriptCase高危漏洞自动化利用与分析工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1743174852185579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    qife122
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:32:47.000Z" title="Fri Jan 09 2026 12:32:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🔓 CVE-2025-47227 漏洞利用与分析工具</h2>
<h3 data-id="heading-1">项目概述</h3>
<p>本工具旨在自动化利用和演示<strong>Netmake ScriptCase Production Environment</strong>模块中存在的一个关键安全漏洞（CVE-2025-47227）。该漏洞允许未经身份验证的攻击者通过精心构造的请求重置管理员密码，从而完全接管系统。项目还展示了如何将此漏洞与后续的命令注入漏洞（CVE-2025-47228）串联，实现从无权限到远程命令执行（RCE）的完整攻击链。</p>
<h3 data-id="heading-2">功能特性</h3>
<ul>
<li><strong>完整的漏洞利用链</strong>：自动化执行从管理员密码重置到远程命令执行的完整过程。</li>
<li><strong>模块化操作</strong>：支持单独执行密码重置、单独执行已认证的命令注入，或进行完整的预认证RCE。</li>
<li><strong>路径探测</strong>：提供目标环境部署路径的自动探测功能。</li>
<li><strong>图像处理与OCR</strong>：集成图像预处理和光学字符识别（OCR）模块，用于处理潜在的验证码等图像挑战。</li>
<li><strong>灵活的参数配置</strong>：通过命令行选项轻松指定目标URL、执行命令和管理员密码。</li>
</ul>
<h3 data-id="heading-3">安装指南</h3>
<h4 data-id="heading-4">系统要求</h4>
<ul>
<li>Python 3.x</li>
<li>网络连接（用于访问目标系统）</li>
</ul>
<h4 data-id="heading-5">依赖安装</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装核心Python库</span>
pip install requests beautifulsoup4 Pillow pytesseract

<span class="hljs-comment"># 在Debian/Ubuntu系统上可能还需要安装Tesseract OCR引擎</span>
sudo apt-get install tesseract-ocr
<span class="hljs-comment"># 或在macOS上</span>
brew install tesseract
</code></pre>
<h4 data-id="heading-6">平台注意事项</h4>
<ul>
<li><code>pytesseract</code> 是Tesseract OCR引擎的Python封装，需要系统已安装Tesseract。</li>
<li>Pillow库用于图像处理，请确保系统有必要的图像库支持（如libjpeg, zlib）。</li>
</ul>
<h3 data-id="heading-7">使用说明</h3>
<h4 data-id="heading-8">基本用法示例</h4>
<p>该工具提供多种操作模式，可通过命令行参数灵活控制。</p>
<p><strong>1. 完整的预认证RCE（密码重置 + 命令执行）</strong>
此模式利用漏洞链，在无任何凭证的情况下直接执行系统命令。</p>
<pre><code class="hljs language-bash" lang="bash">python exploit.py -u http://example.org/scriptcase -c <span class="hljs-string">"whoami"</span>
</code></pre>
<p><strong>2. 仅执行密码重置</strong>
此模式仅触发CVE-2025-47227漏洞，重置管理员密码，不执行后续命令。</p>
<pre><code class="hljs language-bash" lang="bash">python exploit.py -u http://example.org/scriptcase
</code></pre>
<p><strong>3. 仅执行已认证的命令注入（RCE）</strong>
此模式在已知管理员密码的情况下，利用CVE-2025-47228漏洞执行命令。</p>
<pre><code class="hljs language-bash" lang="bash">python exploit.py -u http://example.org/scriptcase -c <span class="hljs-string">"id"</span> -p <span class="hljs-string">'NewAdminPassword123*'</span>
</code></pre>
<p><strong>4. 探测部署路径</strong>
此模式用于识别目标服务器上ScriptCase的安装路径。</p>
<pre><code class="hljs language-bash" lang="bash">python exploit.py -u http://example.org/ -d
</code></pre>
<h4 data-id="heading-9">命令行选项详解</h4>
<pre><code class="hljs language-css" lang="css">  -h, <span class="hljs-attr">--help</span>            显示帮助信息并退出
  -u BASE_URL, <span class="hljs-attr">--base-url</span>=BASE_URL
                        目标系统的基础URL（必需）
  -c COMMAND, <span class="hljs-attr">--command</span>=COMMAND
                        要在目标系统上执行的命令
  -<span class="hljs-selector-tag">p</span> PASSWORD, <span class="hljs-attr">--password</span>=PASSWORD
                        已知的管理员密码（用于仅RCE模式）
  -d, <span class="hljs-attr">--detect</span>          启用部署路径探测模式
</code></pre>
<h3 data-id="heading-10">核心代码</h3>
<h4 data-id="heading-11">1. 图像处理与OCR模块 (<code>process_image</code> 函数)</h4>
<p>此函数负责对输入的图像字节数据进行预处理，并利用Tesseract OCR引擎提取文本，用于处理可能的图像验证码。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_image</span>(<span class="hljs-params">input_image, output_image_path=<span class="hljs-literal">None</span></span>):
    <span class="hljs-string">"""
    对图像进行预处理并执行OCR识别。

    参数:
        input_image (bytes): 原始图像字节数据。
        output_image_path (str, optional): 处理后的图像保存路径。

    返回:
        str: 识别出的文本，转换为大写并去除首尾空格。
    """</span>
    <span class="hljs-comment"># 打开图像</span>
    img = Image.<span class="hljs-built_in">open</span>(io.BytesIO(input_image))

    <span class="hljs-comment"># 将图像转换为RGB模式（确保一致性）</span>
    img = img.convert(<span class="hljs-string">'RGB'</span>)

    <span class="hljs-comment"># 加载像素数据</span>
    pixels = img.load()

    <span class="hljs-comment"># 获取图像尺寸</span>
    width, height = img.size

    <span class="hljs-comment"># 处理每个像素：将非纯黑/纯白的背景替换为浅灰色，将白色文字转为黑色</span>
    <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(height):
        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(width):
            r, g, b = pixels[x, y]
            <span class="hljs-comment"># 改变随机颜色的背景为固定浅灰色（字母仅为黑或白）</span>
            <span class="hljs-keyword">if</span> (r, g, b) != (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) <span class="hljs-keyword">and</span> (r, g, b) != (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>):
                pixels[x, y] = (<span class="hljs-number">211</span>, <span class="hljs-number">211</span>, <span class="hljs-number">211</span>) <span class="hljs-comment"># 改为浅灰色</span>
            <span class="hljs-keyword">elif</span> (r, g, b) == (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>): <span class="hljs-comment"># 将白色文字改为黑色文字</span>
                pixels[x, y] = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) <span class="hljs-comment"># 改为黑色</span>

    <span class="hljs-comment"># 将图像尺寸从 (200, 50) 放大5倍至 (1000, 250)，使用HAMMING算法保持清晰度</span>
    img = img.resize((<span class="hljs-number">1000</span>,<span class="hljs-number">250</span>), Image.Resampling.HAMMING)

    <span class="hljs-comment"># 配置Tesseract OCR参数</span>
    <span class="hljs-comment"># psm 6或8模式效果最佳</span>
    <span class="hljs-comment"># 限制字符集为英文字母</span>
    <span class="hljs-comment"># 禁用词典优化以提高原始文本识别准确率</span>
    custom_oem_psm_config = <span class="hljs-string">rf'--psm 8 --oem 3 -c tessedit_char_whitelist=<span class="hljs-subst">{string.ascii_letters}</span> -c load_system_dawg=false -c load_freq_dawg=false --dpi 300'</span>
    <span class="hljs-comment"># 执行OCR识别</span>
    text = pytesseract.image_to_string(img, config=custom_oem_psm_config)
    <span class="hljs-comment"># 返回大写并去除首尾空格的结果</span>
    <span class="hljs-keyword">return</span>(text.upper().strip())
</code></pre>
<h4 data-id="heading-12">2. 漏洞利用逻辑概述</h4>
<p>工具的核心利用逻辑围绕向<code>login.php</code>脚本发送精心构造的HTTP请求。</p>
<p><strong>关键步骤：</strong></p>
<ol>
<li><strong>密码重置请求</strong>：通过向<code>login.php</code>发送特定参数（如<code>act=valid_hash&amp;login=admin</code>），利用漏洞逻辑重置管理员账户的密码哈希。</li>
<li><strong>会话建立与认证</strong>：使用重置后的密码（或用户提供的密码）向系统进行登录，获取有效的会话Cookie。</li>
<li><strong>命令注入执行</strong>：在已认证的会话中，访问存在命令注入漏洞的端点（例如<code>sys_get.php?in=app</code>），通过注入参数（如<code>fdt</code>）执行任意系统命令。</li>
</ol>
<p><strong>代码结构提示：</strong></p>
<ul>
<li>工具使用<code>requests</code>库处理HTTP通信。</li>
<li>使用<code>BeautifulSoup</code>解析HTML响应以提取关键信息（如令牌、路径）。</li>
<li>通过命令行参数解析（<code>optparse</code>）提供灵活的用户交互。</li>
<li>攻击流程被模块化，便于单独测试漏洞的每个部分。</li>
</ul>
<hr/>
<h4 data-id="heading-13">⚠️ 免责声明</h4>
<p>本工具及相关漏洞信息仅供<strong>教育、安全研究和授权测试</strong>之用。未经明确授权，对任何系统进行漏洞利用测试均属非法及不道德行为。使用者应确保仅在拥有合法权限的系统上进行测试，并承担一切因滥用此工具而导致的法律责任及后果。开发者不对任何误用或由此造成的损害负责。请负责任地使用安全知识，以帮助提升系统安全。
6HFtX5dABrKlqXeO5PUv/ydjQZDJ7Ct83xG1NG8fcAPrDDo2PMaKtdjzmAXMXDz+</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI API从0到1基础调用实践]]></title>    <link>https://juejin.cn/post/7593338828195151912</link>    <guid>https://juejin.cn/post/7593338828195151912</guid>    <pubDate>2026-01-09T13:16:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195151912" data-draft-id="7593173569871872052" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI API从0到1基础调用实践 "/> <meta itemprop="keywords" content="OpenAI"/> <meta itemprop="datePublished" content="2026-01-09T13:16:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="草帽lufei"/> <meta itemprop="url" content="https://juejin.cn/user/501033035632093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI API从0到1基础调用实践 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/501033035632093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    草帽lufei
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:16:15.000Z" title="Fri Jan 09 2026 13:16:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言</h2>
<p>了解了Agent和LLM的一些基础知识后，直接上python开始调API</p>
<h2 data-id="heading-1">代码实现</h2>
<h3 data-id="heading-2">环境准备</h3>
<p>先装好python，创建项目目录，安装必要库</p>
<pre><code class="hljs language-bash" lang="bash">pip install openai python-dotenv
</code></pre>
<h4 data-id="heading-3">配置API密钥</h4>
<p>创建 <code>.env</code> 文件并添加API密钥：</p>
<pre><code class="hljs language-env" lang="env">OPENAI_API_KEY=your_openai_api_key
</code></pre>
<h3 data-id="heading-4">获取 OpenAI API 密钥</h3>
<p>打开OpenAI获取API密钥地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fapi-keys" target="_blank" title="https://platform.openai.com/api-keys" ref="nofollow noopener noreferrer">platform.openai.com/api-keys</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea7d839c6ad149cab785122b4a5d587d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569393&amp;x-signature=nVItBIa8YpjPFplS1DMndaW0KcI%3D" alt="" loading="lazy"/></p>
<p>直接Google账号或者Microsoft账号登录OpenAI，然后完善一下基本资料，就能创建API密钥了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/999ace1351e944aa8269d3beb64eb2f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569393&amp;x-signature=VF8ochaushkBHdKwOO88SEKf88g%3D" alt="" loading="lazy"/></p>
<p>创建好以后，把key保存好，然后下一步，非常专业的操作，上来就付费，选择稍后再买</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c18ce8804e374d6caf864f9f9b989ed0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569393&amp;x-signature=LukTDJjhZzOfYd1FtflsQpkIMHo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">激活虚拟环境</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Linux/Mac</span>
. venv/bin/activate

<span class="hljs-comment"># Windows</span>
venv\Scripts\activate
</code></pre>
<blockquote>
<p>这一步是因为我用的 virtualenv 虚拟环境管理工具，系统全局 Python，直接使用即可</p>
</blockquote>
<h2 data-id="heading-6">代码示例</h2>
<h3 data-id="heading-7">官方Demo</h3>
<p>创建 test_openai.py 文件，代码如下</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI

client = OpenAI(
  api_key=<span class="hljs-string">"api-key"</span> <span class="hljs-comment"># 替换为你自己的API密钥</span>
)

<span class="hljs-comment"># 调用 OpenAI 的 responses.create 接口生成文本</span>
<span class="hljs-comment"># 参数说明：</span>
<span class="hljs-comment">#   model="gpt-5-nano"   - 指定使用的模型为 gpt-5-nano（轻量版）</span>
<span class="hljs-comment">#   input="write a haiku about ai" - 输入提示词，要求写一首关于 AI 的俳句</span>
<span class="hljs-comment">#   store=True           - 将本次请求及结果存储到后台，用于后续分析或优化</span>
response = client.responses.create(
  model=<span class="hljs-string">"gpt-5-nano"</span>,
  <span class="hljs-built_in">input</span>=<span class="hljs-string">"请创作一首关于AI的短诗"</span>,
  store=<span class="hljs-literal">True</span>,
)

<span class="hljs-built_in">print</span>(response.output_text);
</code></pre>
<p>在终端中使用 <code>python test_openai.py</code> 命令运行文件，即可看到输出结果，如下效果则说明调用成功了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cac83cf01a4429daf7088ac860c0dee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569393&amp;x-signature=tCX2u62WVCtVLy%2BJJdMM1lxAQg8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">简单文本生成</h3>
<p>将 test_openai.py 代码中的 <code>api_key="api-key"</code> 替换为 <code>api_key=os.getenv("OPENAI_API_KEY")</code>，并把 key 放到对应的 <code>.env</code> 文件中</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI

<span class="hljs-comment"># 加载环境变量</span>
load_dotenv()

<span class="hljs-comment"># 初始化客户端</span>
client = OpenAI(api_key=os.getenv(<span class="hljs-string">"OPENAI_API_KEY"</span>))

<span class="hljs-comment"># 简单文本生成</span>
response = client.chat.completions.create(
    model=<span class="hljs-string">"gpt-5-nano"</span>,
    messages=[
        {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个友好的助手。"</span>},
        {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"请解释什么是AI Agent。"</span>}
    ]
)

<span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">0</span>].message.content)
</code></pre>
<p>同级目录下创建 .env 文件，内容如下</p>
<pre><code class="hljs language-env" lang="env">OPENAI_API_KEY=your_openai_api_key
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e5d624eee9446d28eaf65d6cf8a0612~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569393&amp;x-signature=Jt0SaaAxjxoE7v%2BX6vQLMkLpGMs%3D" alt="" loading="lazy"/></p>
<p>再次执行 test_openai.py 文件，即可看到输出结果，如下效果则说明调用成功了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/233b397a3b2d4cf6a35e7e64bfe7b07d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569393&amp;x-signature=8CjPLePU3XhwjSW0PGezwwd%2Fecg%3D" alt="" loading="lazy"/></p>
<p>上面通过调用 OpenAI 的 responses.create 接口生成文本已经知道了，下面看多轮对话的例子</p>
<h3 data-id="heading-9">多轮对话</h3>
<p>多轮对话就是在一次对话中，用户和AI系统进行多次交互，就像我们日常用豆包之类的一样</p>
<p>还能定义角色，例如让 AI 专业导师，然后回答问题，代码示例如下</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os 
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv 
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI 

<span class="hljs-comment"># 加载环境变量 </span>
load_dotenv() 

<span class="hljs-comment"># 初始化客户端 </span>
client = OpenAI(api_key=os.getenv(<span class="hljs-string">"OPENAI_API_KEY"</span>)) 

messages = [
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个专业的AI导师。"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"什么是大语言模型？"</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"大语言模型是一种基于深度学习的人工智能模型，能够理解和生成人类语言..."</span>},
    {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"它和传统NLP模型有什么区别？"</span>}
]
response = client.chat.completions.create(
    model=<span class="hljs-string">"gpt-5-nano"</span>,
    messages=messages
)

<span class="hljs-built_in">print</span>(response.choices[<span class="hljs-number">0</span>].message.content)

</code></pre>
<p><strong>注意</strong>，message前三行是对话历史的一部分，用于构建多轮对话的上下文</p>
<p>再次运行后，会看到AI提供了继续的回答</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1d503bd57a64ad8bde7c199048cf472~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569393&amp;x-signature=iYLEusk8S1CU6cVL8cNI67ODuUo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">分析图片</h3>
<p>下面是一个分析图片的例子，图片地址为接了一个图上传到图床，图中是一只柴犬狗</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os 
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv 
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI 

<span class="hljs-comment"># 加载环境变量 </span>
load_dotenv() 

<span class="hljs-comment"># 初始化客户端 </span>
client = OpenAI(api_key=os.getenv(<span class="hljs-string">"OPENAI_API_KEY"</span>)) 


<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI
client = OpenAI()

response = client.responses.create(
    model=<span class="hljs-string">"gpt-5-nano"</span>,
    <span class="hljs-built_in">input</span>=[
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"content"</span>: [
                {
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"input_text"</span>,
                    <span class="hljs-string">"text"</span>: <span class="hljs-string">"这个图片中有什么?"</span>,
                },
                {
                    <span class="hljs-string">"type"</span>: <span class="hljs-string">"input_image"</span>,
                    <span class="hljs-string">"image_url"</span>: <span class="hljs-string">"https://raw.githubusercontent.com/gywgithub/image-bed/main/20260109204706397.png"</span>
                }
            ]
        }
    ]
)

<span class="hljs-built_in">print</span>(response.output_text)
</code></pre>
<p>图片效果</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ceebd00b35d94a4ab72b346a2d959e21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569393&amp;x-signature=5Xpog7TsTMIix6bbz53Y98oPwGE%3D" alt="" loading="lazy"/></p>
<p>看看执行代码后的输出，分析的挺好，我就知道这图里面有只柴犬</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2034d164ec9848328e1315da3d04d29a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569393&amp;x-signature=6Obpk%2FiDP0GQyJ1PRlGnf%2BNRlSo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">小结</h2>
<p>运行了三个简单的例子后，了解了API的基本调用方法和流程，后面将会继续学习如何用工具扩展模型能力，以及流式响应等等</p>
<blockquote>
<p>欢迎留言交流，如果觉得有帮助，可以<code>点个赞</code>支持一下</p>
<p>公众号：草帽lufei</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RAG嵌入模型选择全攻略：从理论到代码实战]]></title>    <link>https://juejin.cn/post/7593212374921576475</link>    <guid>https://juejin.cn/post/7593212374921576475</guid>    <pubDate>2026-01-10T03:49:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593212374921576475" data-draft-id="7593242327932682250" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RAG嵌入模型选择全攻略：从理论到代码实战"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-10T03:49:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北辰alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RAG嵌入模型选择全攻略：从理论到代码实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北辰alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T03:49:41.000Z" title="Sat Jan 10 2026 03:49:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：为什么嵌入模型是RAG的"灵魂"？</h2>
<p>在Retrieval-Augmented Generation（检索增强生成）系统中，嵌入模型扮演着至关重要的角色。它就像是系统的"翻译官"，将人类语言转化为机器能理解的向量，决定了检索的质量和精度。今天，我们将深入探讨如何为你的RAG系统选择最合适的嵌入模型。</p>
<h2 data-id="heading-1">一、嵌入模型的核心作用与原理</h2>
<h3 data-id="heading-2">1.1 RAG中的嵌入工作流程</h3>
<pre><code class="hljs language-css" lang="css">输入查询嵌入模型编码文档库文档分块批量嵌入处理查询向量向量数据库向量相似度计算<span class="hljs-attribute">Top</span>-K相关文档LLM生成答案
</code></pre>
<h3 data-id="heading-3">1.2 嵌入质量的核心指标</h3>
<ul>
<li>• <strong>语义保真度</strong>：相似含义的文本应有相近的向量</li>
<li>• <strong>领域适应性</strong>：在特定领域（医疗、法律、技术）的表现</li>
<li>• <strong>多语言支持</strong>：跨语言检索的能力</li>
<li>• <strong>计算效率</strong>：推理速度和内存占用</li>
</ul>
<h2 data-id="heading-4">二、选择嵌入模型的7个关键因素</h2>
<h3 data-id="heading-5">2.1 评估维度框架</h3>
<h4 data-id="heading-6">维度一：任务特性匹配</h4>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 不同任务的嵌入需求分析</span>
task_requirements = {
    <span class="hljs-string">"语义搜索"</span>: {
        <span class="hljs-string">"需要"</span>: [<span class="hljs-string">"语义相似度"</span>, <span class="hljs-string">"上下文理解"</span>, <span class="hljs-string">"细粒度匹配"</span>],
        <span class="hljs-string">"推荐模型"</span>: [<span class="hljs-string">"text-embedding-ada-002"</span>, <span class="hljs-string">"bge-large-zh"</span>],
        <span class="hljs-string">"关键指标"</span>: <span class="hljs-string">"Recall@K, MRR"</span>
    },
    <span class="hljs-string">"文档聚类"</span>: {
        <span class="hljs-string">"需要"</span>: [<span class="hljs-string">"主题区分"</span>, <span class="hljs-string">"全局结构"</span>, <span class="hljs-string">"降维能力"</span>],
        <span class="hljs-string">"推荐模型"</span>: [<span class="hljs-string">"all-MiniLM-L6-v2"</span>, <span class="hljs-string">"paraphrase-multilingual"</span>],
        <span class="hljs-string">"关键指标"</span>: <span class="hljs-string">"聚类纯度, NMI"</span>
    },
    <span class="hljs-string">"问答系统"</span>: {
        <span class="hljs-string">"需要"</span>: [<span class="hljs-string">"问题-答案匹配"</span>, <span class="hljs-string">"事实准确性"</span>, <span class="hljs-string">"抗噪声"</span>],
        <span class="hljs-string">"推荐模型"</span>: [<span class="hljs-string">"bge-reranker-large"</span>, <span class="hljs-string">"e5-large"</span>],
        <span class="hljs-string">"关键指标"</span>: <span class="hljs-string">"准确率, F1分数"</span>
    }
}
</code></pre>
<h4 data-id="heading-7">维度二：性能与效率平衡</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">EmbeddingModelEvaluator</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, model_name</span>):
        self.model = SentenceTransformer(model_name)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_performance</span>(<span class="hljs-params">self, texts, batch_size=<span class="hljs-number">32</span></span>):
        <span class="hljs-string">"""全面评估模型性能"""</span>
        results = {}
        
        <span class="hljs-comment"># 速度测试</span>
        start = time.time()
        embeddings = self.model.encode(texts, batch_size=batch_size)
        results[<span class="hljs-string">'inference_time'</span>] = time.time() - start
        results[<span class="hljs-string">'throughput'</span>] = <span class="hljs-built_in">len</span>(texts) / results[<span class="hljs-string">'inference_time'</span>]
        
        <span class="hljs-comment"># 内存使用（近似）</span>
        results[<span class="hljs-string">'model_size_mb'</span>] = self.model.get_sentence_embedding_dimension() * <span class="hljs-number">4</span> / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>
        
        <span class="hljs-comment"># 质量测试（示例）</span>
        similarity = np.dot(embeddings[<span class="hljs-number">0</span>], embeddings[<span class="hljs-number">1</span>]) / (
            np.linalg.norm(embeddings[<span class="hljs-number">0</span>]) * np.linalg.norm(embeddings[<span class="hljs-number">1</span>])
        )
        results[<span class="hljs-string">'semantic_similarity'</span>] = similarity
        
        <span class="hljs-keyword">return</span> results

<span class="hljs-comment"># 测试不同模型</span>
models_to_test = [
    <span class="hljs-string">"all-MiniLM-L6-v2"</span>,      <span class="hljs-comment"># 轻量级</span>
    <span class="hljs-string">"all-mpnet-base-v2"</span>,     <span class="hljs-comment"># 平衡型</span>
    <span class="hljs-string">"bge-large-zh-v1.5"</span>,     <span class="hljs-comment"># 中文优化</span>
]

sample_texts = [<span class="hljs-string">"机器学习是人工智能的核心"</span>, <span class="hljs-string">"深度学习是机器学习的分支"</span>]
<span class="hljs-keyword">for</span> model_name <span class="hljs-keyword">in</span> models_to_test:
    evaluator = EmbeddingModelEvaluator(model_name)
    perf = evaluator.evaluate_performance(sample_texts)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{model_name}</span>: <span class="hljs-subst">{perf}</span>"</span>)
</code></pre>
<h4 data-id="heading-8">维度三：多语言与跨语言能力</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 多语言嵌入模型对比</span>
multilingual_models = {
    <span class="hljs-string">"paraphrase-multilingual-MiniLM-L12-v2"</span>: {
        <span class="hljs-string">"支持语言"</span>: <span class="hljs-number">50</span>+,
        <span class="hljs-string">"典型应用"</span>: <span class="hljs-string">"跨语言检索"</span>,
        <span class="hljs-string">"向量维度"</span>: <span class="hljs-number">384</span>
    },
    <span class="hljs-string">"distiluse-base-multilingual-cased-v2"</span>: {
        <span class="hljs-string">"支持语言"</span>: <span class="hljs-number">15</span>,
        <span class="hljs-string">"典型应用"</span>: <span class="hljs-string">"语义相似度"</span>,
        <span class="hljs-string">"向量维度"</span>: <span class="hljs-number">512</span>
    },
    <span class="hljs-string">"bge-m3"</span>: {
        <span class="hljs-string">"支持语言"</span>: <span class="hljs-number">100</span>+,
        <span class="hljs-string">"典型应用"</span>: <span class="hljs-string">"多语言RAG"</span>,
        <span class="hljs-string">"向量维度"</span>: <span class="hljs-number">1024</span>
    }
}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_multilingual_capability</span>(<span class="hljs-params">model, texts_by_language</span>):
    <span class="hljs-string">"""测试模型的多语言理解能力"""</span>
    results = {}
    <span class="hljs-keyword">for</span> lang, texts <span class="hljs-keyword">in</span> texts_by_language.items():
        embeddings = model.encode(texts)
        
        <span class="hljs-comment"># 计算同语言内的语义一致性</span>
        intra_similarity = calculate_cosine_similarity(embeddings[<span class="hljs-number">0</span>], embeddings[<span class="hljs-number">1</span>])
        
        <span class="hljs-comment"># 计算跨语言语义对齐（如果有翻译对）</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">f"<span class="hljs-subst">{lang}</span>_translation"</span> <span class="hljs-keyword">in</span> texts_by_language:
            trans_emb = model.encode(texts_by_language[<span class="hljs-string">f"<span class="hljs-subst">{lang}</span>_translation"</span>])
            cross_similarity = calculate_cosine_similarity(embeddings[<span class="hljs-number">0</span>], trans_emb[<span class="hljs-number">0</span>])
            results[<span class="hljs-string">f"<span class="hljs-subst">{lang}</span>_alignment"</span>] = cross_similarity
        
        results[<span class="hljs-string">f"<span class="hljs-subst">{lang}</span>_coherence"</span>] = intra_similarity
    
    <span class="hljs-keyword">return</span> results
</code></pre>
<h4 data-id="heading-9">维度四：领域适配性</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 领域特定嵌入模型</span>
domain_specific_models = {
    <span class="hljs-string">"医疗健康"</span>: {
        <span class="hljs-string">"BioBERT"</span>: <span class="hljs-string">"生物医学文献预训练"</span>,
        <span class="hljs-string">"ClinicalBERT"</span>: <span class="hljs-string">"临床文本优化"</span>,
        <span class="hljs-string">"优点"</span>: <span class="hljs-string">"医学术语理解强"</span>,
        <span class="hljs-string">"缺点"</span>: <span class="hljs-string">"通用性较差"</span>
    },
    <span class="hljs-string">"法律文书"</span>: {
        <span class="hljs-string">"LegalBERT"</span>: <span class="hljs-string">"法律文本预训练"</span>,
        <span class="hljs-string">"Law2Vec"</span>: <span class="hljs-string">"法律概念嵌入"</span>,
        <span class="hljs-string">"优点"</span>: <span class="hljs-string">"法律术语准确"</span>,
        <span class="hljs-string">"缺点"</span>: <span class="hljs-string">"需要法律语料"</span>
    },
    <span class="hljs-string">"金融科技"</span>: {
        <span class="hljs-string">"FinBERT"</span>: <span class="hljs-string">"金融情感分析"</span>,
        <span class="hljs-string">"FinRE"</span>: <span class="hljs-string">"金融关系提取"</span>,
        <span class="hljs-string">"优点"</span>: <span class="hljs-string">"金融实体识别"</span>,
        <span class="hljs-string">"缺点"</span>: <span class="hljs-string">"更新频率要求高"</span>
    }
}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">fine_tune_for_domain</span>(<span class="hljs-params">base_model, domain_data, epochs=<span class="hljs-number">3</span></span>):
    <span class="hljs-string">"""领域适应微调示例"""</span>
    <span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> InputExample, losses
    <span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader
    
    <span class="hljs-comment"># 准备训练数据（相似对）</span>
    train_examples = []
    <span class="hljs-keyword">for</span> query, positive <span class="hljs-keyword">in</span> domain_data:
        train_examples.append(InputExample(
            texts=[query, positive],
            label=<span class="hljs-number">1.0</span>
        ))
    
    <span class="hljs-comment"># 创建数据加载器</span>
    train_dataloader = DataLoader(
        train_examples, 
        shuffle=<span class="hljs-literal">True</span>, 
        batch_size=<span class="hljs-number">16</span>
    )
    
    <span class="hljs-comment"># 定义损失函数</span>
    train_loss = losses.CosineSimilarityLoss(base_model)
    
    <span class="hljs-comment"># 微调模型</span>
    base_model.fit(
        train_objectives=[(train_dataloader, train_loss)],
        epochs=epochs,
        warmup_steps=<span class="hljs-number">100</span>,
        output_path=<span class="hljs-string">f"./<span class="hljs-subst">{base_model.model_name}</span>-domain-tuned"</span>
    )
</code></pre>
<h4 data-id="heading-10">维度五：上下文长度限制</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 处理长文本的策略比较</span>
context_handling_strategies = {
    <span class="hljs-string">"滑动窗口"</span>: {
        <span class="hljs-string">"实现方式"</span>: <span class="hljs-string">"重叠分块+聚合"</span>,
        <span class="hljs-string">"最大长度"</span>: <span class="hljs-string">"理论上无限"</span>,
        <span class="hljs-string">"优点"</span>: <span class="hljs-string">"保留局部语义"</span>,
        <span class="hljs-string">"缺点"</span>: <span class="hljs-string">"计算开销大"</span>
    },
    <span class="hljs-string">"层次聚合"</span>: {
        <span class="hljs-string">"实现方式"</span>: <span class="hljs-string">"句子级-&gt;段落级-&gt;文档级"</span>,
        <span class="hljs-string">"最大长度"</span>: <span class="hljs-string">"取决于层级数"</span>,
        <span class="hljs-string">"优点"</span>: <span class="hljs-string">"保持文档结构"</span>,
        <span class="hljs-string">"缺点"</span>: <span class="hljs-string">"实现复杂"</span>
    },
    <span class="hljs-string">"最近邻池化"</span>: {
        <span class="hljs-string">"实现方式"</span>: <span class="hljs-string">"提取关键句子嵌入"</span>,
        <span class="hljs-string">"最大长度"</span>: <span class="hljs-string">"固定token数"</span>,
        <span class="hljs-string">"优点"</span>: <span class="hljs-string">"聚焦重点"</span>,
        <span class="hljs-string">"缺点"</span>: <span class="hljs-string">"可能丢失信息"</span>
    }
}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_long_document</span>(<span class="hljs-params">model, document, max_length=<span class="hljs-number">512</span>, strategy=<span class="hljs-string">"sliding_window"</span></span>):
    <span class="hljs-string">"""处理超长文档的嵌入生成"""</span>
    
    <span class="hljs-keyword">if</span> strategy == <span class="hljs-string">"sliding_window"</span>:
        <span class="hljs-comment"># 滑动窗口方法</span>
        chunks = []
        overlap = <span class="hljs-number">50</span>  <span class="hljs-comment"># 重叠token数</span>
        
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(document), max_length - overlap):
            chunk = document[i:i + max_length]
            chunks.append(chunk)
        
        <span class="hljs-comment"># 生成每个chunk的嵌入</span>
        chunk_embeddings = model.encode(chunks)
        
        <span class="hljs-comment"># 平均池化（简单策略）</span>
        <span class="hljs-keyword">return</span> np.mean(chunk_embeddings, axis=<span class="hljs-number">0</span>)
    
    <span class="hljs-keyword">elif</span> strategy == <span class="hljs-string">"hierarchical"</span>:
        <span class="hljs-comment"># 层次化方法</span>
        sentences = split_into_sentences(document)
        sentence_embeddings = model.encode(sentences)
        
        <span class="hljs-comment"># 段落级聚合</span>
        paragraphs = group_sentences_into_paragraphs(sentences)
        paragraph_embeddings = []
        
        <span class="hljs-keyword">for</span> para <span class="hljs-keyword">in</span> paragraphs:
            sent_indices = get_sentence_indices(para, sentences)
            para_embed = np.mean(
                sentence_embeddings[sent_indices], 
                axis=<span class="hljs-number">0</span>
            )
            paragraph_embeddings.append(para_embed)
        
        <span class="hljs-comment"># 文档级聚合</span>
        <span class="hljs-keyword">return</span> np.mean(paragraph_embeddings, axis=<span class="hljs-number">0</span>)
</code></pre>
<h4 data-id="heading-11">维度六：成本考量</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 嵌入模型成本效益分析</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CostBenefitAnalyzer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, api_models, local_models</span>):
        self.api_models = api_models  <span class="hljs-comment"># OpenAI, Cohere等</span>
        self.local_models = local_models  <span class="hljs-comment"># 本地部署模型</span>
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_total_cost</span>(<span class="hljs-params">self, documents_per_month, avg_tokens_per_doc</span>):
        <span class="hljs-string">"""计算月度总成本"""</span>
        cost_analysis = {}
        
        <span class="hljs-comment"># API模型成本</span>
        <span class="hljs-keyword">for</span> model_name, info <span class="hljs-keyword">in</span> self.api_models.items():
            monthly_cost = (
                documents_per_month * 
                avg_tokens_per_doc / <span class="hljs-number">1000</span> * 
                info[<span class="hljs-string">'price_per_1k_tokens'</span>]
            )
            cost_analysis[model_name] = {
                <span class="hljs-string">'monthly_cost'</span>: monthly_cost,
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'api'</span>,
                <span class="hljs-string">'infrastructure_cost'</span>: <span class="hljs-number">0</span>
            }
        
        <span class="hljs-comment"># 本地模型成本</span>
        <span class="hljs-keyword">for</span> model_name, info <span class="hljs-keyword">in</span> self.local_models.items():
            <span class="hljs-comment"># 硬件成本摊销（假设3年折旧）</span>
            hardware_cost_per_month = info[<span class="hljs-string">'hardware_cost'</span>] / <span class="hljs-number">36</span>
            
            <span class="hljs-comment"># 电力和维护成本</span>
            operational_cost = info[<span class="hljs-string">'power_consumption'</span>] * <span class="hljs-number">24</span> * <span class="hljs-number">30</span> * <span class="hljs-number">0.15</span>
            
            monthly_cost = hardware_cost_per_month + operational_cost
            
            cost_analysis[model_name] = {
                <span class="hljs-string">'monthly_cost'</span>: monthly_cost,
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'local'</span>,
                <span class="hljs-string">'infrastructure_cost'</span>: hardware_cost_per_month
            }
        
        <span class="hljs-keyword">return</span> cost_analysis
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">roi_analysis</span>(<span class="hljs-params">self, cost_analysis, accuracy_gains</span>):
        <span class="hljs-string">"""投资回报率分析"""</span>
        roi_results = {}
        
        <span class="hljs-keyword">for</span> model_name, cost_info <span class="hljs-keyword">in</span> cost_analysis.items():
            <span class="hljs-keyword">if</span> model_name <span class="hljs-keyword">in</span> accuracy_gains:
                accuracy_improvement = accuracy_gains[model_name]
                
                <span class="hljs-comment"># 简化ROI计算（业务价值转换）</span>
                business_value = accuracy_improvement * <span class="hljs-number">10000</span>  <span class="hljs-comment"># 假设每个百分点价值</span>
                roi = (business_value - cost_info[<span class="hljs-string">'monthly_cost'</span>]) / cost_info[<span class="hljs-string">'monthly_cost'</span>]
                
                roi_results[model_name] = {
                    <span class="hljs-string">'roi'</span>: roi,
                    <span class="hljs-string">'payback_months'</span>: <span class="hljs-number">1</span> / roi <span class="hljs-keyword">if</span> roi &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,
                    <span class="hljs-string">'total_value'</span>: business_value
                }
        
        <span class="hljs-keyword">return</span> roi_results
</code></pre>
<h4 data-id="heading-12">维度七：评估与验证框架</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 全面的嵌入模型评估</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EmbeddingModelBenchmark</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, test_datasets</span>):
        self.datasets = test_datasets
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_benchmark</span>(<span class="hljs-params">self, model, model_name</span>):
        <span class="hljs-string">"""运行完整评估基准测试"""</span>
        results = {}
        
        <span class="hljs-comment"># 1. MTEB基准测试（如果可用）</span>
        <span class="hljs-keyword">if</span> has_mteb_support(model_name):
            results[<span class="hljs-string">'mteb'</span>] = evaluate_mteb(model)
        
        <span class="hljs-comment"># 2. 领域特定测试</span>
        <span class="hljs-keyword">for</span> domain, data <span class="hljs-keyword">in</span> self.datasets.items():
            domain_results = self.evaluate_domain(model, data, domain)
            results[domain] = domain_results
        
        <span class="hljs-comment"># 3. 鲁棒性测试</span>
        results[<span class="hljs-string">'robustness'</span>] = {
            <span class="hljs-string">'typo_resistance'</span>: test_typo_robustness(model),
            <span class="hljs-string">'paraphrase_detection'</span>: test_paraphrase_detection(model),
            <span class="hljs-string">'negation_handling'</span>: test_negation_handling(model)
        }
        
        <span class="hljs-comment"># 4. 公平性测试</span>
        results[<span class="hljs-string">'fairness'</span>] = evaluate_bias_and_fairness(model)
        
        <span class="hljs-keyword">return</span> results
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_domain</span>(<span class="hljs-params">self, model, data, domain</span>):
        <span class="hljs-string">"""特定领域评估"""</span>
        scores = {}
        
        <span class="hljs-comment"># 检索精度</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'queries'</span> <span class="hljs-keyword">in</span> data <span class="hljs-keyword">and</span> <span class="hljs-string">'corpus'</span> <span class="hljs-keyword">in</span> data:
            retrieval_score = evaluate_retrieval(
                model, 
                data[<span class="hljs-string">'queries'</span>], 
                data[<span class="hljs-string">'corpus'</span>], 
                data.get(<span class="hljs-string">'qrels'</span>)
            )
            scores[<span class="hljs-string">'retrieval'</span>] = retrieval_score
        
        <span class="hljs-comment"># 聚类质量</span>
        <span class="hljs-keyword">if</span> <span class="hljs-string">'clustering_data'</span> <span class="hljs-keyword">in</span> data:
            clustering_score = evaluate_clustering(
                model,
                data[<span class="hljs-string">'clustering_data'</span>]
            )
            scores[<span class="hljs-string">'clustering'</span>] = clustering_score
        
        <span class="hljs-keyword">return</span> scores
    
<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_typo_robustness</span>(<span class="hljs-params">model</span>):
    <span class="hljs-string">"""测试拼写错误鲁棒性"""</span>
    original = <span class="hljs-string">"机器学习算法"</span>
    typo_variants = [
        <span class="hljs-string">"机气学习算法"</span>,  <span class="hljs-comment"># 同音错字</span>
        <span class="hljs-string">"机器学系算法"</span>,  <span class="hljs-comment"># 形近错字</span>
        <span class="hljs-string">"j器学习算法"</span>,   <span class="hljs-comment"># 键盘误敲</span>
        <span class="hljs-string">"机器学习"</span>,      <span class="hljs-comment"># 缺失词</span>
    ]
    
    original_embed = model.encode(original)
    similarities = []
    
    <span class="hljs-keyword">for</span> variant <span class="hljs-keyword">in</span> typo_variants:
        variant_embed = model.encode(variant)
        sim = cosine_similarity(original_embed, variant_embed)
        similarities.append(sim)
    
    <span class="hljs-keyword">return</span> np.mean(similarities)
</code></pre>
<h2 data-id="heading-13">三、实战：构建RAG嵌入选择系统</h2>
<h3 data-id="heading-14">3.1 决策流程图实现</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EmbeddingModelSelector</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.model_registry = self._load_model_registry()
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_load_model_registry</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""加载模型注册表"""</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'general'</span>: [<span class="hljs-string">'text-embedding-ada-002'</span>, <span class="hljs-string">'bge-large-en'</span>, <span class="hljs-string">'e5-large'</span>],
            <span class="hljs-string">'multilingual'</span>: [<span class="hljs-string">'bge-m3'</span>, <span class="hljs-string">'paraphrase-multilingual'</span>, <span class="hljs-string">'text-embedding-3-multilingual'</span>],
            <span class="hljs-string">'lightweight'</span>: [<span class="hljs-string">'all-MiniLM-L6-v2'</span>, <span class="hljs-string">'gte-tiny'</span>, <span class="hljs-string">'bge-small-en'</span>],
            <span class="hljs-string">'domain_specific'</span>: {
                <span class="hljs-string">'medical'</span>: [<span class="hljs-string">'BioBERT'</span>, <span class="hljs-string">'ClinicalBERT'</span>],
                <span class="hljs-string">'legal'</span>: [<span class="hljs-string">'LegalBERT'</span>],
                <span class="hljs-string">'financial'</span>: [<span class="hljs-string">'FinBERT'</span>]
            }
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_model</span>(<span class="hljs-params">self, requirements</span>):
        <span class="hljs-string">"""基于需求选择模型"""</span>
        candidates = []
        
        <span class="hljs-comment"># 1. 基础筛选</span>
        <span class="hljs-keyword">if</span> requirements[<span class="hljs-string">'language'</span>] != <span class="hljs-string">'en'</span>:
            candidates.extend(self.model_registry[<span class="hljs-string">'multilingual'</span>])
        <span class="hljs-keyword">elif</span> requirements[<span class="hljs-string">'computational_budget'</span>] == <span class="hljs-string">'low'</span>:
            candidates.extend(self.model_registry[<span class="hljs-string">'lightweight'</span>])
        <span class="hljs-keyword">else</span>:
            candidates.extend(self.model_registry[<span class="hljs-string">'general'</span>])
        
        <span class="hljs-comment"># 2. 领域适配</span>
        <span class="hljs-keyword">if</span> requirements.get(<span class="hljs-string">'domain'</span>):
            domain_models = self.model_registry[<span class="hljs-string">'domain_specific'</span>].get(
                requirements[<span class="hljs-string">'domain'</span>], []
            )
            candidates.extend(domain_models)
        
        <span class="hljs-comment"># 3. 性能要求筛选</span>
        filtered_candidates = []
        <span class="hljs-keyword">for</span> model <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span>(candidates):  <span class="hljs-comment"># 去重</span>
            specs = self.get_model_specifications(model)
            <span class="hljs-keyword">if</span> self._meets_requirements(specs, requirements):
                filtered_candidates.append((model, specs))
        
        <span class="hljs-comment"># 4. 排序（按综合得分）</span>
        ranked = <span class="hljs-built_in">sorted</span>(
            filtered_candidates,
            key=<span class="hljs-keyword">lambda</span> x: self._calculate_score(x[<span class="hljs-number">1</span>], requirements),
            reverse=<span class="hljs-literal">True</span>
        )
        
        <span class="hljs-keyword">return</span> ranked[:<span class="hljs-number">3</span>]  <span class="hljs-comment"># 返回前三推荐</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_score</span>(<span class="hljs-params">self, specs, requirements</span>):
        <span class="hljs-string">"""计算模型匹配得分"""</span>
        score = <span class="hljs-number">0</span>
        
        <span class="hljs-comment"># 性能匹配（40%）</span>
        perf_score = self._evaluate_performance_match(specs, requirements)
        score += perf_score * <span class="hljs-number">0.4</span>
        
        <span class="hljs-comment"># 成本效益（30%）</span>
        cost_score = self._evaluate_cost_effectiveness(specs, requirements)
        score += cost_score * <span class="hljs-number">0.3</span>
        
        <span class="hljs-comment"># 易用性（20%）</span>
        usability_score = self._evaluate_usability(specs, requirements)
        score += usability_score * <span class="hljs-number">0.2</span>
        
        <span class="hljs-comment"># 社区支持（10%）</span>
        community_score = self._evaluate_community_support(specs)
        score += community_score * <span class="hljs-number">0.1</span>
        
        <span class="hljs-keyword">return</span> score
</code></pre>
<h3 data-id="heading-15">3.2 完整部署示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># RAG系统嵌入层完整实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RAGEmbeddingLayer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config</span>):
        self.config = config
        self.model = self._initialize_model()
        self.vector_db = self._initialize_vector_db()
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_initialize_model</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""初始化嵌入模型"""</span>
        model_config = self.config[<span class="hljs-string">'embedding_model'</span>]
        
        <span class="hljs-keyword">if</span> model_config[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'local'</span>:
            <span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> SentenceTransformer
            model = SentenceTransformer(model_config[<span class="hljs-string">'name'</span>])
            
            <span class="hljs-comment"># 应用优化</span>
            <span class="hljs-keyword">if</span> model_config.get(<span class="hljs-string">'quantization'</span>):
                model = self._apply_quantization(model)
                
        <span class="hljs-keyword">elif</span> model_config[<span class="hljs-string">'type'</span>] == <span class="hljs-string">'api'</span>:
            model = APIEmbeddingModel(
                endpoint=model_config[<span class="hljs-string">'endpoint'</span>],
                api_key=model_config[<span class="hljs-string">'api_key'</span>]
            )
        
        <span class="hljs-comment"># 预热模型</span>
        model.encode([<span class="hljs-string">"warmup"</span>])
        
        <span class="hljs-keyword">return</span> model
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_apply_quantization</span>(<span class="hljs-params">self, model</span>):
        <span class="hljs-string">"""应用模型量化"""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">import</span> onnxruntime <span class="hljs-keyword">as</span> ort
            <span class="hljs-keyword">from</span> sentence_transformers <span class="hljs-keyword">import</span> quantize_embeddings
            
            <span class="hljs-comment"># 转换为ONNX格式并量化</span>
            model.save_as_onnx(<span class="hljs-string">"model.onnx"</span>)
            quantized_model = quantize_embeddings(model, qtype=<span class="hljs-string">'int8'</span>)
            <span class="hljs-keyword">return</span> quantized_model
        <span class="hljs-keyword">except</span> ImportError:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"量化工具未安装，使用原模型"</span>)
            <span class="hljs-keyword">return</span> model
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_documents</span>(<span class="hljs-params">self, documents</span>):
        <span class="hljs-string">"""处理文档库"""</span>
        all_chunks = []
        all_embeddings = []
        
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            <span class="hljs-comment"># 1. 文档分块</span>
            chunks = self.chunk_document(doc)
            all_chunks.extend(chunks)
            
            <span class="hljs-comment"># 2. 批量生成嵌入（带缓存）</span>
            chunk_embeddings = self._encode_with_cache(chunks)
            all_embeddings.extend(chunk_embeddings)
        
        <span class="hljs-comment"># 3. 存储到向量数据库</span>
        self.vector_db.upsert(
            embeddings=all_embeddings,
            documents=all_chunks,
            metadatas=[doc.metadata <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents]
        )
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(all_chunks)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">retrieve</span>(<span class="hljs-params">self, query, top_k=<span class="hljs-number">5</span></span>):
        <span class="hljs-string">"""检索相关文档"""</span>
        <span class="hljs-comment"># 生成查询嵌入</span>
        query_embedding = self.model.encode(query)
        
        <span class="hljs-comment"># 相似度搜索（带重排序可选）</span>
        <span class="hljs-keyword">if</span> self.config.get(<span class="hljs-string">'reranker'</span>):
            candidates = self.vector_db.search(
                query_embedding, 
                k=top_k*<span class="hljs-number">3</span>  <span class="hljs-comment"># 获取更多候选用于重排序</span>
            )
            <span class="hljs-comment"># 应用重排序</span>
            results = self.rerank(query, candidates)
        <span class="hljs-keyword">else</span>:
            results = self.vector_db.search(query_embedding, k=top_k)
        
        <span class="hljs-keyword">return</span> results[:top_k]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">rerank</span>(<span class="hljs-params">self, query, candidates</span>):
        <span class="hljs-string">"""重排序提升精度"""</span>
        reranker_model = CrossEncoder(<span class="hljs-string">'bge-reranker-large'</span>)
        
        pairs = [[query, cand[<span class="hljs-string">'text'</span>]] <span class="hljs-keyword">for</span> cand <span class="hljs-keyword">in</span> candidates]
        scores = reranker_model.predict(pairs)
        
        <span class="hljs-comment"># 按重排序分数排序</span>
        reranked = <span class="hljs-built_in">sorted</span>(
            <span class="hljs-built_in">zip</span>(candidates, scores),
            key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>],
            reverse=<span class="hljs-literal">True</span>
        )
        
        <span class="hljs-keyword">return</span> [item[<span class="hljs-number">0</span>] <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> reranked]
</code></pre>
<h2 data-id="heading-16">四、最佳实践与建议</h2>
<h3 data-id="heading-17">4.1 模型选择决策树</h3>
<ol>
<li>1. <strong>明确需求优先级</strong></li>
<li>
<ul>
<li>• 精度优先 vs 速度优先</li>
<li>• 单语言 vs 多语言</li>
<li>• 通用领域 vs 专业领域</li>
</ul>
</li>
<li>2. <strong>考虑部署环境</strong></li>
<li>
<ul>
<li>• 云端API：简单快速，适合初创</li>
<li>• 本地部署：数据安全，长期成本低</li>
<li>• 混合部署：关键数据本地，一般数据云端</li>
</ul>
</li>
<li>3. <strong>实施渐进策略</strong></li>
<li>
<ul>
<li>• 阶段1：使用通用模型快速验证</li>
<li>• 阶段2：根据数据特性选择优化模型</li>
<li>• 阶段3：领域适应微调</li>
<li>• 阶段4：模型集成与ensemble</li>
</ul>
</li>
</ol>
<h3 data-id="heading-18">4.2 监控与迭代</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 嵌入质量监控系统</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EmbeddingQualityMonitor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, rag_system</span>):
        self.rag = rag_system
        self.metrics_history = []
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">track_retrieval_quality</span>(<span class="hljs-params">self, queries, ground_truth</span>):
        <span class="hljs-string">"""跟踪检索质量"""</span>
        daily_metrics = {}
        
        <span class="hljs-keyword">for</span> query, true_docs <span class="hljs-keyword">in</span> ground_truth.items():
            retrieved = self.rag.retrieve(query, top_k=<span class="hljs-number">10</span>)
            
            <span class="hljs-comment"># 计算精度指标</span>
            precision_at_k = self.calculate_precision(retrieved, true_docs)
            mrr = self.calculate_mrr(retrieved, true_docs)
            
            daily_metrics[query] = {
                <span class="hljs-string">'precision@5'</span>: precision_at_k[<span class="hljs-number">5</span>],
                <span class="hljs-string">'precision@10'</span>: precision_at_k[<span class="hljs-number">10</span>],
                <span class="hljs-string">'mrr'</span>: mrr,
                <span class="hljs-string">'retrieved_ids'</span>: [doc.<span class="hljs-built_in">id</span> <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> retrieved]
            }
        
        self.metrics_history.append(daily_metrics)
        
        <span class="hljs-comment"># 检测性能下降</span>
        <span class="hljs-keyword">if</span> self._detect_degradation():
            self.alert_and_recommend()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_detect_degradation</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""检测性能下降"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(self.metrics_history) &lt; <span class="hljs-number">7</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
        
        recent_avg = np.mean([
            m[<span class="hljs-string">'precision@5'</span>] 
            <span class="hljs-keyword">for</span> daily <span class="hljs-keyword">in</span> self.metrics_history[-<span class="hljs-number">7</span>:] 
            <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> daily.values()
        ])
        
        previous_avg = np.mean([
            m[<span class="hljs-string">'precision@5'</span>] 
            <span class="hljs-keyword">for</span> daily <span class="hljs-keyword">in</span> self.metrics_history[-<span class="hljs-number">14</span>:-<span class="hljs-number">7</span>] 
            <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> daily.values()
        ])
        
        <span class="hljs-keyword">return</span> (previous_avg - recent_avg) / previous_avg &gt; <span class="hljs-number">0.1</span>  <span class="hljs-comment"># 下降超过10%</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">recommend_model_update</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""推荐模型更新"""</span>
        current_model = self.rag.embedding_model_name
        
        <span class="hljs-comment"># 分析问题模式</span>
        error_patterns = self.analyze_error_patterns()
        
        <span class="hljs-comment"># 推荐新模型</span>
        <span class="hljs-keyword">if</span> error_patterns[<span class="hljs-string">'multilingual_failure'</span>] &gt; <span class="hljs-number">0.3</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"bge-m3"</span>  <span class="hljs-comment"># 更好的多语言支持</span>
        <span class="hljs-keyword">elif</span> error_patterns[<span class="hljs-string">'long_context_failure'</span>] &gt; <span class="hljs-number">0.4</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"text-embedding-3-large"</span>  <span class="hljs-comment"># 更长上下文</span>
        <span class="hljs-keyword">elif</span> self.rag.config[<span class="hljs-string">'budget'</span>] &lt; <span class="hljs-number">100</span>:  <span class="hljs-comment"># 预算有限</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">"gte-tiny"</span>  <span class="hljs-comment"># 轻量级替代</span>
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<h2 data-id="heading-19">五、未来趋势与展望</h2>
<h3 data-id="heading-20">5.1 新兴技术方向</h3>
<ul>
<li>• <strong>稀疏嵌入</strong>：更高的效率和可解释性</li>
<li>• <strong>动态嵌入</strong>：根据查询动态调整表示</li>
<li>• <strong>多模态嵌入</strong>：文本、图像、音频统一表示</li>
<li>• <strong>可学习检索</strong>：端到端优化检索过程</li>
</ul>
<h3 data-id="heading-21">5.2 实用建议</h3>
<ol>
<li>1. <strong>从简单开始</strong>：先用通用模型验证业务逻辑</li>
<li>2. <strong>数据质量至上</strong>：清理数据比更换模型更重要</li>
<li>3. <strong>持续评估</strong>：建立自动化评估流程</li>
<li>4. <strong>保持更新</strong>：关注新模型发布和benchmark结果</li>
<li>5. <strong>考虑集成</strong>：多个模型ensemble可能胜过单个模型</li>
</ol>
<h2 data-id="heading-22">结语</h2>
<p>选择合适的嵌入模型是RAG系统成功的关键。没有"最好"的模型，只有"最合适"的模型。通过系统性的评估框架、明确的需求分析和持续的监控优化，你可以为你的RAG系统找到最佳的嵌入解决方案。</p>
<p>记住，技术选择应该服务于业务目标。从实际需求出发，平衡性能、成本和维护复杂度，才能构建出既高效又可持续的RAG系统。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangGraph智能体开发设计模式（四）——LangGraph多智能体设计模式：网络架构]]></title>    <link>https://juejin.cn/post/7593240931287007284</link>    <guid>https://juejin.cn/post/7593240931287007284</guid>    <pubDate>2026-01-10T03:52:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593240931287007284" data-draft-id="7592431064976998415" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangGraph智能体开发设计模式（四）——LangGraph多智能体设计模式：网络架构"/> <meta itemprop="keywords" content="人工智能,LangChain,Agent"/> <meta itemprop="datePublished" content="2026-01-10T03:52:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型真好玩"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangGraph智能体开发设计模式（四）——LangGraph多智能体设计模式：网络架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型真好玩
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T03:52:21.000Z" title="Sat Jan 10 2026 03:52:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>上篇文章 <a href="https://juejin.cn/post/7591703562133684258" target="_blank" title="https://juejin.cn/post/7591703562133684258">LangGraph智能体开发设计模式（三）——LangGraph多智能体设计模式：主管架构与分层架构</a>分享了多智能体系统的两种核心架构：<strong>主管架构</strong>与<strong>分层架构</strong>。它们通过引入顶层智能体进行统一决策与调度，显著提升了系统处理复杂任务的能力。然而，除了这种集中式的协调模式，还存在另一种更为平等与分布式的架构——在这种设计中，每个智能体都能直接交互、协同工作，而不必依赖于单一的主管节点来调解所有通信。这便是笔者将要深入介绍的最后一种多智能体设计模式：<strong>网络架构</strong>。</p>
<p>本系列将涵盖常见的工作流模式与多智能体架构模式，预计通过四篇文章展开。相关内容均列于笔者的专栏<a href="https://juejin.cn/column/7526240014499495972" target="_blank" title="https://juejin.cn/column/7526240014499495972">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>，该专栏适合所有对 LangChain 感兴趣的学习者，无论之前是否接触过 LangChain。该专栏基于笔者在实际项目中的深度使用经验，系统讲解了使用LangChain/LangGraph如何开发智能体，目前已更新 36 讲，并持续补充实战与拓展内容。欢迎感兴趣的同学关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号<strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p>
<p>2026年笔者的另一大重心还会放在<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzk3NTA2OTMxNQ%3D%3D%26action%3Dgetalbum%26album_id%3D4331818996941979657%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzk3NTA2OTMxNQ==&amp;action=getalbum&amp;album_id=4331818996941979657#wechat_redirect" ref="nofollow noopener noreferrer"><strong>大模型训练</strong>专栏</a>分享上，当然，谈论训练无法绕过算力这道现实的门槛。昂贵的GPU是许多人探索技术的拦路石。正因如此笔者今年特意与一些可靠的算力平台展开了合作，希望能为大家解决算力瓶颈。大家可以通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U" ref="nofollow noopener noreferrer">www.lab4ai.cn/register?ag…</a> 注册<strong>Lab4ai算力平台</strong>，提供了包括英伟达H系列在内的多种选择，更有 <strong>5小时的免费体验额度</strong>。</p>
<h2 data-id="heading-1">一、网络架构</h2>
<h3 data-id="heading-2">1.1 网络架构概念</h3>
<p>网络架构为多智能体系统提供了一种去中心化、高灵活性的协作范式。在该模型中，所有智能体处于对等地位，彼此之间可直接建立通信连接（多对多），无需依赖中央主管来协调每一次交互。每个智能体基于自身状态、系统整体目标以及已交换的消息，自主决策接下来应调用哪一个合作智能体。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08ff47291ef848b28fbc85897616b2d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768621940&amp;x-signature=0OIUiPuqu6FzFMemyDndfIP7%2Fvs%3D" alt="0.png" width="70%" loading="lazy"/></p>
<p>网络架构在以下场景中具有显著优势：</p>
<ol>
<li><strong>任务本质是协作且动态的</strong>：当智能体交互的最佳顺序无法预先确定时，网络支持动态、自适应的协作，智能体可根据实时情况临时决定行为。</li>
<li><strong>需要去中心化决策</strong>：控制权分散于各智能体之间，能提升系统的容错能力。单个智能体的故障不易导致整个系统瘫痪。</li>
<li><strong>专业智能体需灵活交互</strong>：若不同智能体具备独特的专业知识，且这些知识可能在任务的不同节点被需要，网络架构能支持更顺畅的信息交换与协作。</li>
</ol>
<p>然而，网络架构的平等性与自由度也带来了设计上的挑战：必须仔细管理系统的复杂性，明确各智能体的共同目标与行为边界，以确保在分散决策下整体行为依然连贯、一致。</p>
<h3 data-id="heading-3">1.2 典型的网络架构——Swarm架构</h3>
<p>Swarm 架构是网络架构的一个典型代表，其核心在于智能体能够基于专业领域动态地移交控制权。在该系统中，每个智能体被设计为特定领域的专家，对话或任务会被动态路由至最适合处理当前上下文的智能体。一个关键特征是，Swarm 能够“记忆”上一次被激活的智能体。这确保了在同一对话线程的后续交互中，系统能智能地优先由该智能体响应，从而保持上下文的连续性与对话的连贯性。</p>
<p>Swarm 架构的核心特性如下：</p>
<ol>
<li><strong>具备移交能力的智能体</strong>：各智能体配备“移交工具”，可显式地将控制权及当前上下文转移给其他更擅长处理后续任务的智能体，实现专家间的有效协作。</li>
<li><strong>动态的智能体路由</strong>：对话的路由决策是动态且高度依赖于上下文的。智能体依据自身专业知识和当前对话状态决定是否移交、移交给谁，从而形成灵活自适应的系统流程。</li>
<li><strong>基于记忆的对话连续性</strong>：Swarm 维护对话历史，并记录每个线程中上次激活的智能体。这种记忆机制对于在多次交互中提供连贯、自然的用户体验至关重要。</li>
</ol>
<h2 data-id="heading-4">二、LangGraph网络架构代码实战</h2>
<p>尽管网络架构的设计与实现具有一定复杂性，但LangGraph为开发者提供了相应的支持库以降低开发门槛。目前，实现多智能体网络架构的成熟范式是 <strong>Swarm 架构</strong>。为此，LangGraph 专门提供了 <code>langgraph-swarm</code> 库，它封装了用于创建具备移交能力的智能体工具，使得多个智能体能够以对等的方式进行交互与协作。</p>
<p>下面笔者通过一个使用 <code>langgraph-swarm</code> 库的示例来具体说明 Swarm 架构的实现。该示例包含两个专业智能体：<strong>Agent1（数学专家）</strong>  和 <strong>Agent2（小猫咪语气智能体）</strong> 。</p>
<ol>
<li><strong>环境配置：</strong>  首先需要安装 <code>langgraph-swarm</code> 类库。在激活的<code>anaconda langchain</code>虚拟环境中执行以下命令：<code>pip install -U langgraph-swarm</code>:</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52d72622c242454db33fa3640d81630c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768621940&amp;x-signature=KnWGY%2FF%2B9qslqbhjl9QyOtG%2FUsY%3D" alt="1.png" loading="lazy"/></p>
<ol start="2">
<li><strong>引入相关依赖：</strong>    在项目文件夹下新建 <code>.env</code> 文件，填入你的 <code>DEEPSEEK_API_KEY</code>。随后引入必要的依赖。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage, SystemMessage
<span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">from</span> langchain_deepseek <span class="hljs-keyword">import</span> ChatDeepSeek
<span class="hljs-keyword">from</span> langchain.agents <span class="hljs-keyword">import</span> create_agent
<span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> InMemorySaver
<span class="hljs-keyword">from</span> langgraph_swarm <span class="hljs-keyword">import</span> create_handoff_tool, create_swarm
<span class="hljs-keyword">from</span> dotenv <span class="hljs-keyword">import</span> load_dotenv

load_dotenv()

llm = ChatDeepSeek(
    model=<span class="hljs-string">"deepseek-chat"</span>,
)
</code></pre>
<ol start="3">
<li><strong>定义专业智能体:</strong> 注意从 <code>langgraph-swarm</code> 引入的 <code>create_handoff_tool</code> 函数，它使智能体具备向其他智能体移交控制权的能力。通过定制移交过程，每个智能体得以处于平等地位，并能将专业任务移交给更合适的智能体。</li>
</ol>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a:<span class="hljs-built_in">int</span>, b:<span class="hljs-built_in">int</span></span>)-&gt;<span class="hljs-built_in">int</span>:
    <span class="hljs-string">'''
    计算两个整数和字符串相加时务必调用该函数
    '''</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'Agent1 加法工具调用'</span>)
    <span class="hljs-keyword">return</span> a+b

<span class="hljs-comment"># agent1是一位可以调用add函数和移交给agent2移交工具函数的智能体</span>
agent1 = create_agent(
    model=llm,
    tools=[add, create_handoff_tool(agent_name=<span class="hljs-string">'agent2'</span>, description=<span class="hljs-string">'当用户想和agent2对话时，转给agent2回答'</span>)],
    system_prompt=<span class="hljs-string">'你是agent1，一位加法专家，可以利用提供的add函数完成所有加法运算'</span>,
    name=<span class="hljs-string">'agent1'</span>
)

<span class="hljs-comment"># agent2说话的语气像小猫咪，并且拥有一个移交给agent1以寻求数学帮助的移交工具</span>
agent2 = create_agent(
    model=llm,
    tools=[create_handoff_tool(agent_name=<span class="hljs-string">'agent1'</span>, description=<span class="hljs-string">'请务必将所有的加法运算移交给agent1, 它可以帮助你解决数学问题'</span>)],
    system_prompt=<span class="hljs-string">'你是agent2， 你说话语气像小猫咪'</span>,
    name=<span class="hljs-string">'agent2'</span>
)
</code></pre>
<ol start="4">
<li><strong>创建Swarm网络架构</strong>: Swarm架构需要通过记忆保持对话连续性，这里使用内存检查点<code>InMemorySaver</code>来实现短期记忆（对此不熟悉的读者可参考笔者文章《<a href="https://juejin.cn/post/7585553799298056238" target="_blank" title="https://juejin.cn/post/7585553799298056238">LangGraph1.0速通指南（二）—— LangGraph1.0 条件边、记忆、人在回路</a>》）。接着，使用 <code>create_swarm</code> 方法创建 Swarm 网络架构，并默认激活 <code>agent1</code>。</li>
</ol>
<pre><code class="hljs language-python" lang="python">checkpointer = InMemorySaver()
workflow = create_swarm(
    [agent1, agent2],
    default_active_agent=<span class="hljs-string">"agent1"</span> <span class="hljs-comment"># 默认激活的智能体是agent1</span>
)

app = workflow.<span class="hljs-built_in">compile</span>(checkpointer=checkpointer)
</code></pre>
<ol start="5">
<li><strong>运行测试</strong>: 通过多轮对话来观察多智能体的协作结果。虽然默认激活的是 <code>agent1</code>，但当用户明确要求与 <code>agent2</code> 对话时，架构会自动将控制权移交给 <code>agent2</code>。随后，当用户提出数学计算问题（<code>100+100</code>）时，架构又会从 <code>agent2</code> 切换回 <code>agent1</code> 来执行计算。</li>
</ol>
<pre><code class="hljs language-python" lang="python">config = {
    <span class="hljs-string">'configurable'</span>: {
        <span class="hljs-string">'thread_id'</span>: <span class="hljs-string">'1'</span>
    }
}

<span class="hljs-comment"># 第一轮对话</span>
first = app.invoke(
    {<span class="hljs-string">'messages'</span>: [{<span class="hljs-string">'role'</span>: <span class="hljs-string">'user'</span>, <span class="hljs-string">'content'</span>: <span class="hljs-string">'我想和agent2说话，请转接agent2'</span>}]},
    config
)

<span class="hljs-built_in">print</span>(first[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content) <span class="hljs-comment"># 第一轮输出</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">'\n\n'</span>)

second = app.invoke(
    {<span class="hljs-string">'messages'</span>: [{<span class="hljs-string">'role'</span>: <span class="hljs-string">'user'</span>, <span class="hljs-string">'content'</span>: <span class="hljs-string">'100+100等于多少'</span>}]},
    config
)
<span class="hljs-built_in">print</span>(second[<span class="hljs-string">'messages'</span>][-<span class="hljs-number">1</span>].content) <span class="hljs-comment"># 第二轮输出</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cf6dbe33fc746b69406ffb8d7889346~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768621940&amp;x-signature=nTdIPe8vnbkYK5yUmoD4iud%2FpUY%3D" alt="2.png" loading="lazy"/></p>
<p>以上所有代码大家可以关注笔者的同名微信公众号 <strong>大模型真好玩</strong>，并私信: <strong>LangChain智能体开发</strong>免费获取。</p>
<p>当然，以上仅是 <code>langgraph-swarm</code> 的简单应用。该库提供了丰富的自定义选项，允许开发者根据特定需求定制智能体间的网络交互行为，主要包括以下功能：</p>
<ul>
<li><strong>自定义移交工具</strong>：开发者可以创建自定义移交工具，并能修改其名称、描述、调用参数以及在移交过程中传递的上下文信息。这允许对智能体间的通信和状态传递进行细粒度的控制。</li>
<li><strong>自定义智能体实现</strong>：虽然库默认假设所有智能体共享单一的消息数据结构，但开发者可以实现自定义的智能体，采用不同的状态模式或创建私有的消息历史记录。不过，这需要仔细管理智能体与 Swarm 框架之间的状态转换和通信路径。</li>
<li><strong>内存管理</strong>：有效的内存管理对于 Swarm 架构至关重要，尤其是在长时间运行的对话中。需要选择合适的记忆存储后端，并尽可能利用长期记忆机制来维护长上下文的一致性。</li>
</ul>
<h2 data-id="heading-5">三、 LangGraph多智能体架构总结对比</h2>
<p>至此笔者就完整介绍了 LangGraph 中三种核心的多智能体设计模式：<strong>主管架构</strong>、<strong>分层架构</strong>与<strong>网络架构</strong>。</p>
<p>主管架构通过设置中央控制点来协调专业智能体的工作；分层架构在此基础上引入了更高层的主管（团队经理），通过树状结构管理更广泛的复杂性；而网络架构则提供了一种去中心化、高灵活性的替代方案，更适合需要动态协作与涌现行为的场景。</p>
<p>LangGraph 及其相关的 Supervisor 与 Swarm 库为这些架构的实现提供了强大支持，显著简化了构建健壮、可扩展且易于管理的多智能体系统的过程。善用这些模式与工具，开发者能够构建出通过智能体高效协作来处理复杂任务的AI应用。</p>
<p>三种架构的核心区别与适用场景对比如下表所示：</p>





































<table><thead><tr><th>多智能体架构</th><th>结构</th><th>复杂性管理</th><th>可扩展性</th><th>灵活性</th><th>用例</th></tr></thead><tbody><tr><td>主管架构</td><td>中央主管智能体、专业智能体</td><td>集中控制，可管理中等复杂性</td><td>中</td><td>低</td><td>需要明确协调、明确定义的专业化任务</td></tr><tr><td>分层架构</td><td>顶层主管智能体、团队主动智能体</td><td>分层控制，降低每个主动智能体的负载，高度模块化</td><td>高</td><td>中</td><td>复杂任务，有大量智能体，需要组织结构</td></tr><tr><td>网络架构</td><td>分散式智能体、多对多通信</td><td>分布式控制，涌现行为，更难管理</td><td>高</td><td>高</td><td>协作任务，动态环境、不可预测的工作流</td></tr></tbody></table>
<h2 data-id="heading-6">四、 总结</h2>
<p>本篇重点分享了网络架构及其典型实现 Swarm架构 的特点，并结合代码示例展示了如何利用 <code>langgraph-swarm</code> 库构建具备动态移交能力的智能体协作网络。文章最后对比了LangGraph多智能体系统的三种核心设计模式：集中控制的主管架构、分层管理的分层架构，以及去中心化、高灵活性的网络架构，大家根据实际需求自行选取。</p>
<p><a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">《深入浅出LangChain&amp;LangGraph AI Agent 智能体开发》</a>专栏内容源自笔者在实际学习和工作中对 LangChain 与 LangGraph 的深度使用经验，旨在帮助大家系统性地、高效地掌握 AI Agent 的开发方法，在各大技术平台获得了不少关注与支持。目前已更新36讲，正在更新LangGraph1.0速通指南，并随时补充笔者在实际工作中总结的拓展知识点。如果大家感兴趣，欢迎关注笔者的掘金账号与专栏，也可关注笔者的同名微信公众号 <strong>大模型真好玩</strong>，每期分享涉及的代码均可在公众号私信: <strong>LangChain智能体开发</strong>免费获取。</p>
<p>2026年笔者的另一大重心还会放在<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzk3NTA2OTMxNQ%3D%3D%26action%3Dgetalbum%26album_id%3D4331818996941979657%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzk3NTA2OTMxNQ==&amp;action=getalbum&amp;album_id=4331818996941979657#wechat_redirect" ref="nofollow noopener noreferrer"><strong>大模型训练</strong>专栏</a>分享上，当然，谈论训练无法绕过算力这道现实的门槛。昂贵的GPU是许多人探索技术的拦路石。正因如此笔者今年特意与一些可靠的算力平台展开了合作，希望能为大家解决算力瓶颈。大家可以通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lab4ai.cn%2Fregister%3FagentID%3Duser-XorgKKc56U" target="_blank" title="https://www.lab4ai.cn/register?agentID=user-XorgKKc56U" ref="nofollow noopener noreferrer">www.lab4ai.cn/register?ag…</a> 注册<strong>Lab4ai算力平台</strong>，提供了包括英伟达H系列在内的多种选择，更有 <strong>5小时的免费体验额度</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI大模型小白手册｜如何像工程师一样写Prompt？]]></title>    <link>https://juejin.cn/post/7593251491935682606</link>    <guid>https://juejin.cn/post/7593251491935682606</guid>    <pubDate>2026-01-10T03:55:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593251491935682606" data-draft-id="7593234983755431946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI大模型小白手册｜如何像工程师一样写Prompt？"/> <meta itemprop="keywords" content="LLM,AIGC,AI编程"/> <meta itemprop="datePublished" content="2026-01-10T03:55:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="树獭非懒"/> <meta itemprop="url" content="https://juejin.cn/user/2295436009296199"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI大模型小白手册｜如何像工程师一样写Prompt？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436009296199/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    树獭非懒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T03:55:21.000Z" title="Sat Jan 10 2026 03:55:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p><strong>从“人工智障”到“全能助手”，你可能只差这一步</strong></p>
<p>你是不是也有过这样的经历：</p>
<p>满怀期待地向ChatGPT或DeepSeek提问：“帮我写个Python函数吧！”</p>
<p>结果它给你写了一个只能加正数的函数，输入负数就报错。</p>
<p>或者你说：“生成一张美女图。”</p>
<p>结果它给你画了一个金发碧眼的欧美范儿，而你想要的是“古风长裙”。</p>
<p>这时候你可能会想：“这AI是不是不太聪明？”</p>
<p>其实，<strong>AI 很聪明，但它很“单纯”。</strong> 它就像一个刚入职、满腹经纶但不懂你潜规则的实习生。你给它的指令（Prompt）如果含糊不清，它只能靠猜。</p>
<p>今天，我们就来聊聊 <strong>“提示词工程”</strong>，教你如何像工程师一样，用精准的语言掌控AI，让它从“人工智障”秒变“全能助手”。</p>
<h3 data-id="heading-1">系列目录（持续更新）：</h3>
<p><a href="https://juejin.cn/post/7585027616736165940" target="_blank" title="https://juejin.cn/post/7585027616736165940">AI大模型小白手册｜基础原理篇</a></p>
<p><a href="https://juejin.cn/post/7587675306658594816" target="_blank" title="https://juejin.cn/post/7587675306658594816">AI大模型小白手册 | API调用的魔法指南</a></p>
<h2 data-id="heading-2">第一章：先选对“人”，再派活</h2>
<p>在写Prompt之前，你要先明白：不同的模型有不同的“性格”。如果你选错了模型，写再好的Prompt也是事倍功半。</p>
<p>我们把市面上的大模型大致分为两类：</p>
<h3 data-id="heading-3">1. 通用模型（如 DeepSeek V3, GPT-4o）</h3>
<p>性格：像一个<strong>才华横溢但逻辑跳跃的文科生。</strong></p>
<ul>
<li><strong>擅长：</strong> 创意写作、文案润色、翻译、画图、日常闲聊。</li>
<li><strong>怎么跟它聊：</strong> 它需要你<strong>手把手教</strong>。如果你让它做逻辑题，你得告诉它第一步干什么，第二步干什么（比如用CoT思维链），否则它容易想歪。</li>
<li><strong>口诀：缺什么，补什么。</strong></li>
</ul>
<h3 data-id="heading-4">2. 推理模型（如 DeepSeek R1, o1）</h3>
<p><strong>性格：</strong> 像一个<strong>严谨死板但逻辑无敌的理科生</strong>。</p>
<ul>
<li><strong>擅长：</strong> 数学证明、代码Debug、复杂逻辑推理、物理题。</li>
<li><strong>怎么跟它聊：</strong> <strong>“要什么，直接说”</strong>。千万别把它当文科生教，它会自动在脑子里把步骤拆解得比你还清楚。如果你强行让它每一步都汇报，反而会降低它的效率。</li>
<li><strong>口诀：信任它，指令简。</strong></li>
</ul>
<blockquote>
<p><strong>举个栗子：</strong></p>
<ul>
<li>想写一封感人的情书？找 <strong>DeepSeek V3</strong>。</li>
<li>想算一下火箭弹道轨迹？找 <strong>DeepSeek R1</strong>。</li>
</ul>
</blockquote>
<h2 data-id="heading-5">第二章：工程师的“万能公式”</h2>
<p>选定模型后，我们怎么写出高质量的Prompt？</p>
<p>这里有一个经过验证的<strong>六大要素公式</strong>。按照重要性从高到低排列：</p>
<h3 data-id="heading-6">1. 任务 —— 核心中的核心</h3>
<p>永远用<strong>动词</strong>开头。</p>
<ul>
<li>❌ 错误：关于那个...</li>
<li>✅ 正确：<strong>生成</strong>一段关于环保的...</li>
<li>✅ 正确：<strong>计算</strong>这两个数值的...</li>
</ul>
<h3 data-id="heading-7">2. 上下文 —— 给个背景</h3>
<p>你是谁？这是什么场景？给AI一个坐标系。</p>
<ul>
<li><em>例子：</em>“我是一名电商运营经理，正在准备双十一的促销文案...”</li>
</ul>
<h3 data-id="heading-8">3. 示例 —— 榜样的力量</h3>
<p>如果你觉得指令很难说清楚，直接给它看**“标准答案”**。这叫 Few-shot（少样本学习）。</p>
<ul>
<li><em>场景：</em> 让AI写请假邮件。</li>
<li><em>Prompt：</em> “请帮我写一封请假邮件。<strong>下面是一个模板参考：</strong> ‘尊敬的领导，我因...请假...工作已交接给...’”</li>
</ul>
<h3 data-id="heading-9">4. 角色 —— 设定人设</h3>
<p>告诉AI它现在是专家、还是五岁小朋友。</p>
<ul>
<li><em>例子：</em>“请你扮演一名<strong>资深律师</strong>，帮我审核这段合同。”</li>
</ul>
<h3 data-id="heading-10">5. 格式 —— 规范输出</h3>
<p>你是要表格？JSON？还是段落？</p>
<ul>
<li><em>例子：</em>“请以<strong>JSON格式</strong>输出，包含时间、地点、人物三个字段。”</li>
</ul>
<h3 data-id="heading-11">6. 语气 —— 调节风格</h3>
<p>正式？幽默？还是严厉？</p>
<ul>
<li><em>例子：</em>“请用<strong>幽默风趣</strong>的口吻...”</li>
</ul>
<h2 data-id="heading-12">第三章：从“差不多”到“精准完美”的进阶技巧</h2>
<p>掌握了公式，只能算入门。要成为高手，你需要用下面这几个技巧把AI的潜能逼出来。</p>
<h3 data-id="heading-13">技巧 1：把“模糊”变成“具体”</h3>
<p>AI 最怕模糊的词。</p>
<ul>
<li>❌ <strong>模糊：</strong> “画一个 beautiful girl。”（AI可能画成任意风格）</li>
<li>✅ <strong>具体：</strong> “画一个<strong>动漫少女，长黑发，数码画风，纯白底色，工笔画细节</strong>。”</li>
</ul>
<blockquote>
<p><strong>工程师思维：</strong> 把AI当成<strong>刚入行的孩子</strong>，少留解读空间，细节越多，意外越少。</p>
</blockquote>
<h3 data-id="heading-14">技巧 2：CoT 思维链 —— 让AI学会“分步走”</h3>
<p>对于复杂的逻辑任务，不要指望AI一步到位。你要强迫它“慢下来”。</p>
<ul>
<li><strong>普通Prompt：</strong> “判断这段客服对话是否合规。”（AI可能看一眼就瞎说：合规）</li>
<li><strong>CoT Prompt：</strong>
<blockquote>
<p>“请一步一步判断这段客服对话：</p>
<ol>
<li>首先检查客服是否使用了礼貌用语；</li>
<li>其次检查是否提及了准确的产品名称和价格；</li>
<li>最后检查是否使用了网络用语（如‘亲’）。
请按照上述步骤分析，并给出最终结论。”
<strong>效果：</strong> 通过把复杂问题拆解为简单的 <code>Step 1, Step 2</code>，AI的推理错误率会大幅下降。</li>
</ol>
</blockquote>
</li>
</ul>
<h3 data-id="heading-15">技巧 3：使用分隔符 —— 区分指令和数据</h3>
<p>当你给的内容很长时，用符号把“指令”和“数据”隔开，防止AI混淆。
<strong>推荐使用三个引号 <code>"""</code> 或 <code>###</code>：</strong></p>
<pre><code class="hljs language-text" lang="text">请总结以下三个引号中的文本：
"""
这里是一段很长的用户评论...
这里有几千字的文本...
"""
请总结为三句话。
</code></pre>
<hr/>
<h2 data-id="heading-16">第四章：代码实战（程序员专属）</h2>
<p>如果你是开发者，你需要通过代码调用API。怎么把上面的技巧用到代码里？</p>
<h3 data-id="heading-17">1. 准备工作</h3>
<p>我们需要封装一个调用函数（以 DeepSeek 为例）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> dashscope
<span class="hljs-keyword">import</span> os
<span class="hljs-comment"># 设置你的API Key</span>
dashscope.api_key = os.getenv(<span class="hljs-string">'DASHSCOPE_API_KEY'</span>)
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_completion</span>(<span class="hljs-params">prompt, model=<span class="hljs-string">"deepseek-v3"</span></span>):
    messages = [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}]
    response = dashscope.Generation.call(
        model=model,
        messages=messages,
        result_format=<span class="hljs-string">'message'</span>, <span class="hljs-comment"># 设置为message格式</span>
        temperature=<span class="hljs-number">0</span>,            <span class="hljs-comment"># 温度设为0，输出最稳定，不随机</span>
    )
    <span class="hljs-keyword">return</span> response.output.choices[<span class="hljs-number">0</span>].message.content
</code></pre>
<h3 data-id="heading-18">2. 实战案例 A：结构化数据提取（JSON格式）</h3>
<p><strong>场景：</strong> 用户说“办个100G的套餐”，我们要提取出他的具体需求。</p>
<pre><code class="hljs language-python" lang="python">input_text = <span class="hljs-string">"办个100G的套餐。"</span>
<span class="hljs-comment"># 使用我们的公式构建Prompt</span>
instruction = <span class="hljs-string">"""
你的任务是识别用户对手机流量套餐产品的选择条件。
每种产品包含三个属性：名称、月费价格、月流量。
根据用户输入，识别上述属性的需求。
"""</span>
<span class="hljs-comment"># 明确指定输出格式</span>
output_format = <span class="hljs-string">"以JSON格式输出，包含键值对。"</span>
prompt = <span class="hljs-string">f"""
# 目标
<span class="hljs-subst">{instruction}</span>
# 用户输入
<span class="hljs-subst">{input_text}</span>
# 输出格式
<span class="hljs-subst">{output_format}</span>
"""</span>
<span class="hljs-built_in">print</span>(get_completion(prompt))
</code></pre>
<p><strong>输出结果示例：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"月流量"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"100G"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"名称"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"未提及"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"月费价格"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"未提及"</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<h3 data-id="heading-19">3. 实战案例 B：魔法优化魔法</h3>
<p>如果你不会写Prompt，可以让AI帮你写！</p>
<pre><code class="hljs language-python" lang="python">user_prompt = <span class="hljs-string">"""
做一个手机流量套餐的客服代表，叫小瓜。
可以帮助用户选择最合适的流量套餐产品。
"""</span>
instruction = <span class="hljs-string">"""
你是一名专业的提示词创作者。
你的目标是根据我的需求打造更好的提示词。
请帮我优化上面的提示词，使其更加高效。
"""</span>
prompt = <span class="hljs-string">f"""
# 用户提示词
<span class="hljs-subst">{user_prompt}</span>
# 目标
<span class="hljs-subst">{instruction}</span>
"""</span>
<span class="hljs-built_in">print</span>(get_completion(prompt))

</code></pre>
<p>AI 会把你的简单指令，优化成一个包含角色设定、语气要求、常见问题预案的完美Prompt。</p>
<h2 data-id="heading-20">总结</h2>
<p>写 Prompt 就像跟人沟通，但它比跟人沟通更简单——因为<strong>它没有情绪，只有逻辑</strong>。</p>
<ol>
<li><strong>选对工具</strong>：V3 写诗，R1 算数。</li>
<li><strong>套用公式</strong>：任务 &gt; 上下文 &gt; 示例 &gt; 角色 &gt; 格式 &gt; 语气。</li>
<li><strong>具体具体再具体</strong>：模糊指令是万恶之源。</li>
<li><strong>分步思考</strong>：遇到难题，就让AI“一步一步来”。
未来每个人都是提示词工程师。哪怕你是小白，只要按照上面的方法多练习几次，你也能让 AI 成为你最得力的助手！
<strong>现在，去试试把你的第一个 Prompt 改得更好吧！</strong></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[👉 求你了，别再裸写 fetch 做 AI 流式响应了！90% 的人都在踩这个坑]]></title>    <link>https://juejin.cn/post/7593177437081747507</link>    <guid>https://juejin.cn/post/7593177437081747507</guid>    <pubDate>2026-01-09T13:25:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593177437081747507" data-draft-id="7593177437081731123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="👉 求你了，别再裸写 fetch 做 AI 流式响应了！90% 的人都在踩这个坑"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2026-01-09T13:25:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Smoothzjc"/> <meta itemprop="url" content="https://juejin.cn/user/1302297507801358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            👉 求你了，别再裸写 fetch 做 AI 流式响应了！90% 的人都在踩这个坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1302297507801358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Smoothzjc
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:25:25.000Z" title="Fri Jan 09 2026 13:25:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p><strong>🏆 本篇文章带你了解作者在工作中开发 AI Agent CUI 的过程中关于「流式输出」品尝到的酸甜苦辣~🙌 如文章有误，恳请评论区指正，谢谢！<strong>💖</strong> 写作不易，「点赞」+「在看」+「转发」 谢谢支持！</strong></p>
</blockquote>
<h2 data-id="heading-0">前言：流式输出的“隐形陷阱”</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/206016f3468f40eaa6092d649bdda172~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU21vb3Roempj:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569925&amp;x-signature=vqcr0Dkv25B0TNRrJW0ROX9vFMw%3D" alt="" loading="lazy"/>我们期望的丝滑 AI 回复体验</p>
<p>在前端接入 ChatGPT、OCR 或任何大模型能力时，“流式返回”（Streaming）几乎是标配。服务端一边算，前端一边把字打出来，用户体验非常丝滑。</p>
<p>这看起来是一个非常标准的技术，但在实际工程中，很多开发者会遇到一个<strong>隐蔽却致命</strong>的怪象： 同样是流式请求，<strong>有的实现稳如泰山，有的却总是少字、断句、乱码，甚至完全无法复现 Bug。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b119664059c54c8896cba8c3f43c5721~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU21vb3Roempj:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569925&amp;x-signature=HlYp7toUoE2Wf1UERhQWMkPTrO4%3D" alt="" loading="lazy"/>实际工程中经常遇到的“丢字断句”现象</p>
<p>很多时候，我们会把锅甩给“网络抖动”或“浏览器 Bug”，但真相往往更扎心：<strong>问题不出在网络，而出在你对“流”的理解层级上。</strong></p>
<p>本文将抛开晦涩的术语，用最通俗的语言告诉你：为什么手写的 <code>fetch</code> 读取流极其容易“弄丢”你的数据，以及为什么 <code>fetchEventSource</code> 才是正解。</p>
<hr/>
<h2 data-id="heading-1">一、现场对比：手写版 vs 专业版</h2>
<p>为了搞清楚问题，我们先看两段代码。它们都在做同一件事：<strong>接收服务端推过来的 AI 回复。</strong></p>
<h3 data-id="heading-2">❌ 方式一：裸用 fetch + reader（相当于“手接水管”）</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 伪代码演示</span>
<span class="hljs-keyword">const</span> reader = response.body.getReader();
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
  <span class="hljs-keyword">const</span> { <span class="hljs-keyword">value</span> } = <span class="hljs-keyword">await</span> reader.read(); 
  <span class="hljs-comment">// 💀 灾难现场：</span>
  <span class="hljs-comment">// 1. 手动解码二进制数据</span>
  <span class="hljs-comment">// 2. 手动用正则去匹配 data:、RECORD_ID 等字段</span>
  <span class="hljs-comment">// 3. 手动拼接破碎的字符串</span>
  <span class="hljs-comment">// 4. 手动处理换行符...</span>
}
</code></pre>
<p><strong>特点：</strong>  代码里充满了复杂的正则替换（<code>replace</code>）、拼接逻辑。开发者实际上是在<strong>手动重新发明一个“协议解析器”</strong> 。</p>
<h3 data-id="heading-3">✅ 方式二：使用 fetchEventSource（相当于“收快递”）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchEventSource</span>(url, {
  <span class="hljs-title function_">onmessage</span>(<span class="hljs-params">msg</span>) {
    <span class="hljs-comment">// 🎁 优雅现场：</span>
    <span class="hljs-comment">// 直接拿到完整数据，不用管它是怎么传过来的</span>
    <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">event</span> === <span class="hljs-string">'message'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(msg.<span class="hljs-property">data</span>); 
    }
  }
});
</code></pre>
<p><strong>特点：</strong>  代码极简，没有复杂的拼接逻辑。你不需要关心数据是怎么传输的，只关心拿到的结果。</p>
<hr/>
<h2 data-id="heading-4">二、核心原理：是“接水管”还是“收快递”？</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c49ddb2895e34f5a95f7fa1a9df96af9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU21vb3Roempj:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569925&amp;x-signature=FKVV3jouz61DeDTzFC13WfqHGVo%3D" alt="" loading="lazy"/>手动处理原始数据流 vs 接收封装好的完整事件</p>
<p>为什么代码差别这么大？因为这两种方式工作的<strong>层级</strong>完全不同。</p>
<p>我们可以用 <strong>“接收信件”</strong> 来打个比方。</p>
<h3 data-id="heading-5">1. SSE 协议：互联网的写信规范</h3>
<p>服务端给前端推数据，遵循一种叫 <strong>SSE (Server-Sent Events)</strong>  的规范。它就像写信：</p>
<ul>
<li><strong><code>data:</code></strong>  是信的内容。</li>
<li><strong><code>\n\n</code>（两个换行）</strong>  是信封封口的标记，代表“这一封信写完了”。</li>
</ul>
<p>服务端发出来的数据是这样的：</p>
<blockquote>
<p>data: 你好，我是AI。\n\n data: 今天天气不错。\n\n</p>
</blockquote>
<h3 data-id="heading-6">2. fetch + reader = “碎纸机”</h3>
<p>当你直接使用 <code>reader.read()</code> 时，你是在<strong>最底层的网络层（TCP层）工作。 网络传输不关心原本的“信”长什么样，它只负责把数据运过去。为了运输效率，它经常会把数据切碎</strong>或者<strong>粘在一起</strong>。</p>
<p><strong>这就是导致“丢数据”的根本原因：</strong></p>
<ul>
<li><strong>场景 A（被切碎）：</strong></li>
<li>服务端发了：<code>data: RecordID: 100</code></li>
<li>你的 reader 第一次读到：<code>data: Record</code> （断了！）</li>
<li>你的 reader 第二次读到：<code>ID: 100</code></li>
<li><strong>后果：</strong>  你的代码如果此时用正则去匹配 <code>RecordID</code>，第一次匹配不到，第二次也匹配不到。<strong>这条数据就这样“消失”了。</strong></li>
<li><strong>场景 B（粘在一起）：</strong></li>
<li>服务端发了两条：<code>hello</code> 和 <code>world</code></li>
<li>你的 reader 一口气读到：<code>data: hello\n\ndata: world</code></li>
<li><strong>后果：</strong>  你的代码如果只写了简单的替换逻辑，很可能直接把中间的换行符当垃圾清理掉了，结果变成了 <code>helloworld</code>，丢失了分句信息。</li>
</ul>
<h3 data-id="heading-7">3. fetchEventSource 的优势：它是“私人秘书”</h3>
<p><code>fetchEventSource</code> 这个库，就像一个懂行的<strong>私人秘书</strong>。 它虽然底层也用 fetch，但它在中间多做了一层关键工作：<strong>缓存与拼接</strong>。</p>
<ul>
<li>它会帮你在门口守着，拿到碎片（<code>data: Record</code>）时不急着给你。</li>
<li>它会等到下一片（<code>ID: 100</code>）到了，帮你拼好。</li>
<li>直到它看到了信封封口标记（<code>\n\n</code>），确认这是一封<strong>完整的信</strong>，才会敲门把信交给你（触发 <code>onmessage</code>）。</li>
</ul>
<p><strong>总结对比：</strong></p>






























<table><thead><tr><th>维度</th><th>fetchEventSource (秘书)</th><th>fetch + reader (你自己)</th></tr></thead><tbody><tr><td><strong>拿到的东西</strong></td><td><strong>完整的事件</strong> (语义级)</td><td><strong>随机的字节碎片</strong> (传输级)</td></tr><tr><td><strong>处理碎片/粘包</strong></td><td>✅ 自动处理，帮你拼好</td><td>❌ 你得自己写复杂的算法去拼</td></tr><tr><td><strong>乱码风险</strong></td><td>✅ 内部处理了 UTF-8 解码</td><td>❌ 遇到中文被切成两半时直接乱码</td></tr><tr><td><strong>丢数据概率</strong></td><td><strong>极低</strong></td><td><strong>极高</strong> (尤其是网络波动时)</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">三、避坑指南：到底该怎么选</h2>
<p>读到这里，答案已经很明显了。</p>
<h3 data-id="heading-9">✅ 什么时候必须用 fetchEventSource？</h3>
<p>只要你的场景是 <strong>AI 对话、流式文字、OCR 识别</strong>，或者任何服务端声明了 <code>Content-Type: text/event-stream</code> 的接口。<strong>请务必使用 <code>fetchEventSource</code>。</strong> 不要试图挑战手写解析器，因为你无法预判网络会把你的数据切成什么奇怪的形状。</p>
<h3 data-id="heading-10">⚠️ 什么时候才用 fetch + reader？</h3>
<p>只有当你明确知道自己在下载<strong>文件</strong>、处理<strong>二进制流</strong>（比如视频流、音频流），或者你需要处理一种服务端自定义的非标准协议时，才需要下沉到这个层级去手动处理。</p>
<hr/>
<h2 data-id="heading-11">💡 总结</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aebb4c86986e45c7939d5f5809a933cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU21vb3Roempj:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569925&amp;x-signature=zLvZ4G%2FMzXxFbMlPhU1o21LQ7y4%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>fetch + reader</strong> 是在网络管道里捞碎片，极其容易划伤手（丢数据）。</li>
<li><strong>fetchEventSource</strong> 是坐在办公桌前收完整的信件，安全又优雅。</li>
</ul>
<p><strong>下次再做 AI 流式输出，别再自己造轮子了，让专业的库来做专业的事。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0204febfd3547c4a995c8536d66ffd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU21vb3Roempj:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569925&amp;x-signature=9VBsb45LuuAdgzOQRS6MYL2ewlc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">最后</h2>
<p>我是 Smoothzjc，致力于产出更多且不仅限于前端方面的优质文章</p>
<p>写作不易，<strong>「点赞」+「收藏」+「转发」</strong> 谢谢支持💖</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go语言动手写Web框架 - Gee第五天 中间件]]></title>    <link>https://juejin.cn/post/7593165280488652841</link>    <guid>https://juejin.cn/post/7593165280488652841</guid>    <pubDate>2026-01-09T12:55:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593165280488652841" data-draft-id="7592990758476693523" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go语言动手写Web框架 - Gee第五天 中间件"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-09T12:55:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Way2top"/> <meta itemprop="url" content="https://juejin.cn/user/1458388314893300"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go语言动手写Web框架 - Gee第五天 中间件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458388314893300/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Way2top
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:55:21.000Z" title="Fri Jan 09 2026 12:55:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">中间件设计</h4>
<p>今天，我们要完成对中间件的支持，计划实现一个 <code>Logger()</code> 中间件，可以在终端输出页面响应的时间。</p>
<p>引入中间件的原因在于，Web 框架需要提供一种灵活的方式来处理请求/响应的不同方面，比如日志记录、性能监控、权限验证等。这些操作如果直接嵌入到每个路由的处理函数中，不仅会造成重复代码，还会让业务逻辑和基础功能混杂在一起，不易维护。</p>
<p>那么具体如何展开呢？</p>
<p>在上一节我们讲到，<strong>路由组</strong> 的作用是为了对不同的路由进行分类管理，避免中间件的冲突。比如：一个大型应用中可能会有很多不同的功能模块（例如：<code>/api</code>，<code>/admin</code>，<code>/v1</code> 等），中间件应该能够按路由组来独立设置，而不是全局应用，避免影响到不同模块的独立性。中间件应该以路由组为单位而不是具体的每一条路由，那样会有大量重复的代码，并且也不符合中间件的定义，因此我们就可以从 <code>RouterGroup</code> 入手了。我们先来看看目前代码中的 RouterGroup 的结构：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> RouterGroup <span class="hljs-keyword">struct</span> {
        prefix      <span class="hljs-type">string</span>
        middlewares []HandlerFunc <span class="hljs-comment">// 支持中间件</span>
        parent      *RouterGroup  <span class="hljs-comment">// 支持嵌套</span>
        engine      *Engine       <span class="hljs-comment">// 所有 group 共享一个 Engine 实例</span>
}
</code></pre>
<p>可以看到，在上一节我们已经给其中添加了一个 <code>middlewares []HandlerFunc</code> 来支持中间件。在 <code>RouterGroup</code> 中，这个属性是用来注册该路由组别下所需要的全部的中间件的。具体来说，不同的路由可能需要使用不同的中间件，此时我们就需要到 <code>Context</code> 结构体中进行修改，用以支持对于具体路由的中间件的使用，来看一下目前 <code>Context</code> 的结构：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">struct</span> {
        Writer     http.ResponseWriter
        Req        *http.Request
        Path       <span class="hljs-type">string</span>            <span class="hljs-comment">// 请求资源路径</span>
        Method     <span class="hljs-type">string</span>            <span class="hljs-comment">// 请求方式</span>
        Params     <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-comment">// 提供对路由参数的访问（router.go 中的 getRoute 返回的 params 就存储在这里）</span>
        StatusCode <span class="hljs-type">int</span>               <span class="hljs-comment">// 状态码</span>
}
</code></pre>
<p>这里并没有和中间件相关的内容，因此考虑增加内容来支持具体路由对于中间件的使用。</p>
<p>首先我们可以想到的就是添加一个类似于 <code>RouterGroup</code> 中的 <code>middlewares</code> 类似的数组，用于存储具体路由需要执行的中间件，不难想到可以添加一个下面的属性：</p>
<pre><code class="hljs language-css" lang="css">handlers <span class="hljs-selector-attr">[]</span>HandlerFunc
</code></pre>
<p>那么，除了这个，还需要其他的内容吗？需要，我们还需要一个 <code>index</code> 用于控制中间件的执行过程。那么最终的设计如下：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Context <span class="hljs-keyword">struct</span> {
        Writer     http.ResponseWriter
        Req        *http.Request
        Path       <span class="hljs-type">string</span>            <span class="hljs-comment">// 请求资源路径</span>
        Method     <span class="hljs-type">string</span>            <span class="hljs-comment">// 请求方式</span>
        Params     <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span> <span class="hljs-comment">// 提供对路由参数的访问（router.go 中的 getRoute 返回的 params 就存储在这里）</span>
        StatusCode <span class="hljs-type">int</span>               <span class="hljs-comment">// 状态码</span>
        <span class="hljs-comment">// 用于中间件</span>
        handlers []HandlerFunc
        index    <span class="hljs-type">int</span> <span class="hljs-comment">// 用于控制中间件的执行顺序</span>
}
</code></pre>
<p>我们来解释一下这里的 <code>index</code> 具体是干嘛的，介绍这个之前我们现需要了解一下中间件。</p>
<p>对于某些中间件来说，我们需要在事件开始之前启动，事件结束之后才能结束，比如说我们今天要设计的统计执行时间的中间件，而 <strong><code>index</code></strong> <strong>的设计就是为了能够让它们既能在 Handler 之前执行，也能在 Handler 之后“回头执行”。</strong></p>
<p>如果不设计 index 来控制中间件的运行顺序，看一下下面的场景：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-tag">A</span>()
<span class="hljs-selector-tag">B</span>()
<span class="hljs-built_in">Handler</span>()
</code></pre>
<p><code>A</code> 和 <code>B</code> 都是一个中间件，这样的话，你只能在 <code>Handler</code> 之前做事情，比如鉴权、参数校验等。但实际上有很多中间件都的功能都需要等 Handler 执行完之后才能做，比如：</p>
<ul>
<li>统计请求耗时</li>
<li>捕获 panic</li>
<li>打日志（需要拿到最终的状态码）</li>
</ul>
<p>所以现有的结构没法支撑我们做到一层一层包住 <code>Handler</code>。你可以把中间件想象成这样一个结构：</p>
<pre><code class="hljs language-scss" lang="scss">func <span class="hljs-built_in">Middleware</span>(c *Context) {
    <span class="hljs-comment">// 前半段</span>
    c<span class="hljs-selector-class">.Next</span>()
    <span class="hljs-comment">// 后半段</span>
}
</code></pre>
<p>这个结构的重点在于<code>c.Next()</code> ，这里的 <code>Next()</code> 并不是调用下一个函数这么简单，它真正的含义是：</p>
<p><strong>“把执行权交给下一个中间件/Handler，等它们全部执行完，再回来继续执行我后面的代码。”</strong></p>
<p>这在普通的函数调用中是做不到的，因此为了做到这一点，为了实现 <code>Next()</code>，我们必须：</p>
<ul>
<li>
<p>把 <strong>所有中间件 + Handler</strong> 放进一个列表（<code>c.handlers</code>）</p>
</li>
<li>
<p>用一个 <code>index</code> 记录“现在执行到第几个”</p>
</li>
<li>
<p>通过 <code>Next()</code> 手动推进这个执行链</p>
</li>
</ul>
<p>最后用一个具体的例子来理解一下，假设我们有这样一个中间件的调用：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> -&gt; <span class="hljs-selector-tag">B</span> -&gt; Handler
</code></pre>
<p>那么底层的执行顺序应该是：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> 前
  <span class="hljs-selector-tag">B</span> 前
    Handler
  <span class="hljs-selector-tag">B</span> 后
<span class="hljs-selector-tag">A</span> 后
</code></pre>
<p>这不是普通的“顺序调用”， 而是一个<strong>人为构造的调用栈</strong>。</p>
<p><code>Context.handlers + index + Next()</code> 就是在 <strong>模拟函数调用栈的展开与回收</strong>。</p>
<p>我在理解这部分的时候的困难是：<strong>我忘记了自己在编写一个框架，而不是一个框架的使用者。</strong> 因为框架本身就是为了便于开发，隐去一些不必要的或者重复的逻辑。那作为开发者（或者说框架的使用者），我在开发使用中间件的时候，我知道中间件应该包含Handler，我知道直接使用 <code>A -&gt; B -&gt; Handler</code> 就应该是类似于栈的执行顺序，其他框架直接这么用也是没问题的（底层会包含Handler），这是大家都通用的，因此我（框架使用者）这么用应该是没问题的。因此，框架需要完成从 <code>A -&gt; B -&gt; Handler</code> 到 <code>A 前-&gt;B 前-&gt;Handler-&gt;B 后-&gt;A 后</code>，需要支持大家的使用习惯，同时框架的设计也该如此。因此，我们要引入 <code>index</code>，我们要在框架层面完成从顺序调用到人为构造一个调用栈的转换。</p>
<h4 data-id="heading-1">Next() 的设计</h4>
<p>我们先看<code>Next()</code>的具体实现：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">newContext</span><span class="hljs-params">(w http.ResponseWriter, req *http.Request)</span></span> *Context {
        <span class="hljs-keyword">return</span> &amp;Context{
                Writer: w,
                Req:    req,
                Path:   req.URL.Path,
                Method: req.Method,
                index:  <span class="hljs-number">-1</span>, <span class="hljs-comment">// Context 定义多了一个 index，所以初始化的时候也不要忘了</span>
        }
}


<span class="hljs-comment">// Next 用于控制中间件的执行顺序，调用后会将控制权交给下一个中间件</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Context)</span></span> Next() {
        c.index++
        s := <span class="hljs-built_in">len</span>(c.handlers)
        <span class="hljs-keyword">for</span> ; c.index &lt; s; c.index++ {
                c.handlers[c.index](c)
        }
}
</code></pre>
<p>我们先理解如何通过一个数组和一个索引来实现中间件的控制的，通过模拟一次真实的执行来理解。假设某路由需要执行 2 个中间件：A，B。</p>
<p>作为开发者（框架使用者），我们会这样写：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-tag">A</span>(c)
<span class="hljs-selector-tag">B</span>(c)
<span class="hljs-built_in">H</span>(c) <span class="hljs-comment">// Handler</span>
</code></pre>
<p>它们被放进一个数组：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">handlers</span> = [A, B, H]
<span class="hljs-attr">index</span> = -<span class="hljs-number">1</span>
</code></pre>
<p>现在开始执行。</p>
<h5 data-id="heading-2">第一步</h5>
<p>首先框架会调用 <code>c.Next()</code>：</p>
<pre><code class="hljs language-scss" lang="scss">c<span class="hljs-selector-class">.Next</span>()
</code></pre>
<p>为什么需要先调用 <code>c.Next()</code>呢，原因是：</p>
<ul>
<li><strong>启动执行链</strong>：框架需要主动启动中间件链的执行，这样才能确保中间件按照正确顺序执行。</li>
<li><strong>生命周期管理</strong>：框架控制整个请求的生命周期，<strong>从接收请求到执行中间件，再到最终返回响应</strong>，中间件链的启动必须由框架</li>
</ul>
<p>至于具体在框架的哪个位置调用 <code>c.Next()</code>，待会会实现。</p>
<p>调用 <code>Next</code> 之后，进入内部代码：</p>
<pre><code class="hljs language-scss" lang="scss">index++        <span class="hljs-comment">// index = 0</span>
handlers<span class="hljs-selector-attr">[0]</span>(c) <span class="hljs-comment">// 调用 A</span>
</code></pre>
<p>注意：现在还在 <code>Next()</code> 里面，只是 <code>Next</code> 调用了 <code>A</code>。</p>
<h5 data-id="heading-3">第二步</h5>
<p>进入中间件 A 内部：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">A</span><span class="hljs-params">(c)</span></span> {
    part1
    c.Next()
    part2
}
</code></pre>
<p>先执行 <code>part1</code>，然后再次调用 <code>c.Next()</code>。</p>
<h5 data-id="heading-4">第三步</h5>
<p>再次进入 <code>Next</code>，注意这次是从 <code>A</code> 内部进入的 <code>Next</code>：</p>
<pre><code class="hljs language-scss" lang="scss">index++        <span class="hljs-comment">// index = 1</span>
handlers<span class="hljs-selector-attr">[1]</span>(c) <span class="hljs-comment">// 调用 B</span>
</code></pre>
<p>此时：</p>
<ul>
<li>第一次 Next 还没结束</li>
<li>A 也还没结束（part2 还未执行）</li>
<li>又进入了第二层 Next</li>
</ul>
<p>这是<strong>普通函数调用栈嵌套</strong>。</p>
<h5 data-id="heading-5">第四步</h5>
<p>进入 <code>B</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">B</span><span class="hljs-params">(c)</span></span> {
    part3
    c.Next()
    part4
}
</code></pre>
<p>执行 <code>part3</code>，再调用 <code>c.Next()</code>。</p>
<h5 data-id="heading-6">第五步</h5>
<p>第三次进入 <code>Next</code>：</p>
<pre><code class="hljs language-scss" lang="scss">index++        <span class="hljs-comment">// index = 2</span>
handlers<span class="hljs-selector-attr">[2]</span>(c) <span class="hljs-comment">// 调用 H</span>
</code></pre>
<p>进入 Handler。</p>
<h5 data-id="heading-7">第六步</h5>
<p>Handler 没有调用 <code>Next()</code>，所以它直接 return。</p>
<h5 data-id="heading-8">第七步</h5>
<p>程序开始<strong>回退调用栈</strong>：</p>
<ol>
<li>从 Handler 返回到 B</li>
<li>执行 <code>part4</code></li>
<li>B 执行完，返回到 A</li>
<li>执行 <code>part2</code></li>
<li>A 执行完，返回到最初的 Next</li>
<li>整个请求结束</li>
</ol>
<p>这部分很好理解，其实就是递归，一层一层回退。</p>
<h5 data-id="heading-9">最终执行顺序</h5>
<p>所以，最终的执行顺序是：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span><span class="hljs-selector-class">.part1</span>
<span class="hljs-selector-tag">B</span><span class="hljs-selector-class">.part3</span>
H
<span class="hljs-selector-tag">B</span><span class="hljs-selector-class">.part4</span>
<span class="hljs-selector-tag">A</span><span class="hljs-selector-class">.part2</span>
</code></pre>
<hr/>
<p>走完整个流程后我们可以看到，确实实现了：</p>
<blockquote>
<p><strong>中间件不是“按顺序执行”，</strong> <strong>而是“按调用栈展开、再按调用栈回收”。</strong></p>
</blockquote>
<hr/>
<p>最后，还需要解释一下 <code>Next()</code> 内部为什么要用一个循环：</p>
<pre><code class="hljs language-scss" lang="scss">func (c *Context) <span class="hljs-built_in">Next</span>() {
        c<span class="hljs-selector-class">.index</span>++
        s := <span class="hljs-built_in">len</span>(c.handlers)
        for ; c<span class="hljs-selector-class">.index</span> &lt; s; c<span class="hljs-selector-class">.index</span>++ {
                c<span class="hljs-selector-class">.handlers</span><span class="hljs-selector-attr">[c.index]</span>(c)
        }
}
</code></pre>
<p>而不是：</p>
<pre><code class="hljs language-scss" lang="scss">func (c *Context) <span class="hljs-built_in">Next</span>() {
        c<span class="hljs-selector-class">.index</span>++
        c<span class="hljs-selector-class">.handlers</span><span class="hljs-selector-attr">[c.index]</span>(c)
}
</code></pre>
<p>这是因为，有些 <code>handler</code> 并不会调用 <code>Next()</code>，就比如我们上面模拟的过程，最后一步的 <code>handler</code> 没有调用 <code>Next()</code>，如果出现多个 <code>handler</code> 一起调用的情况，此时不用循环就无法推进下去了。</p>
<p>一句话总结就是，<code>for</code> 是为了兜底推进，确保可以执行到底把流程走完。</p>
<p>所以总结一下：</p>
<p><code>Next()</code> 是为了提供一种灵活的控制流，让每个中间件不仅能够在前置逻辑（请求前）执行，还能在后置逻辑（请求后）进行处理。</p>
<p><code>index</code> 不仅仅是控制顺序，实际上它还模拟了一个状态机的行为，可以理解为是“中间件栈”的索引。</p>
<p>在中间件的设计中，<code>Next()</code> 的作用类似于函数调用栈的行为。当调用 <code>Next()</code> 时，程序会依次执行每个中间件，类似于函数调用栈的“展开”。一旦当前中间件执行完成，它会回到上一级中间件继续执行未完成的部分，直到整个栈被“回收”。这种设计让中间件不仅可以在请求处理的前半部分执行逻辑（例如：请求参数校验），也可以在后半部分执行一些收尾操作（例如：统计请求耗时或记录日志）。通过 <code>Next()</code> 和 <code>index</code> 的结合，模拟了一个执行顺序严格控制的栈结构，从而使中间件可以灵活地在请求生命周期的前后两部分完成各自的功能。</p>
<hr/>
<h4 data-id="heading-10">代码实现</h4>
<p>通过上面的讲解，我们已经知道了如何做到对中间件的支持。接下来还需要对框架中的一些函数进行修改。</p>
<p>首先我们要在 <code>gee.go</code> 中定义一个 <code>Use</code> 函数，将中间件注册到某个 Group：</p>
<pre><code class="hljs language-scss" lang="scss">func (group *RouterGroup) <span class="hljs-built_in">Use</span>(middlewares ...HandlerFunc) {
        group<span class="hljs-selector-class">.middlewares</span> = <span class="hljs-built_in">append</span>(group.middlewares, middlewares...)
}
</code></pre>
<p>这个函数实际上就是给某个路由分组添加其可能需要用到的中间件。这里需要注意是对 <code>RouterGroup.middlewares</code> 进行操作，而不是对 <code>Context.handlers</code> 进行操作。前者用于存储该路由分组下所有可能用到的中间件，而后者用于实现中间件的流程控制，即可以存储中间件，也可以存储实际需要调用的函数 handlers。</p>
<hr/>
<p>同时，我们还需要对 <code>gee.go</code> 中的 <code>ServerHTTP</code> 进行修改：</p>
<pre><code class="hljs language-scss" lang="scss">func (engine *Engine) <span class="hljs-built_in">ServeHTTP</span>(w http.ResponseWriter, req *http.Request) {
        <span class="hljs-comment">// 这部分逻辑用于判断传入的路径所属的 group 包含哪些中间件</span>
        <span class="hljs-selector-tag">var</span> middlewares <span class="hljs-selector-attr">[]</span>HandlerFunc
        for _, group := range engine.groups {
                <span class="hljs-comment">// 如果传入路径包含某个 group 的 prefix（前缀），说明传入的路径属于这个 group，那么这个 group 所包含的全部的中间件就都需要应用于该请求路径</span>
                if strings<span class="hljs-selector-class">.HasPrefix</span>(req.URL.Path, group.prefix) {
                        middlewares = <span class="hljs-built_in">append</span>(middlewares, group.middlewares...)
                }
        }
        c := <span class="hljs-built_in">newContext</span>(w, req)
        c.handlers = middlewares // 前面 for 循环找出了该请求路径下需要的全部中间件 middlewares，把这个加入到 Context.handlers，之后就可以根据 Context.handlers 来执行具体的中间件了
        engine.router.<span class="hljs-built_in">handle</span>(c)
}
</code></pre>
<p>当我们接收到一个具体请求时，要判断该请求适用于哪些中间件，在这里我们简单通过 URL 的前缀来判断。得到中间件列表后，赋值给 <code>c.handlers</code>。</p>
<p>最后，我们还需要对 <code>router.go</code> 中的 <code>handle</code> 函数进行修改：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 根据 Context 查找 handler 并调用</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *router)</span></span> handle(c *Context) {
        n, params := r.getRoute(c.Method, c.Path)
        <span class="hljs-keyword">if</span> n != <span class="hljs-literal">nil</span> {
                c.Params = params
                key := c.Method + <span class="hljs-string">"-"</span> + n.pattern
                <span class="hljs-comment">//r.handlers[key](c)</span>
                c.handlers = <span class="hljs-built_in">append</span>(c.handlers, r.handlers[key]) <span class="hljs-comment">// 修改 1</span>
        } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 修改 2</span>
                c.handlers = <span class="hljs-built_in">append</span>(c.handlers, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *Context)</span></span> {
                        c.String(http.StatusNotFound, <span class="hljs-string">"404 NOT FOUND: &amp;s\n"</span>, c.Path)
                })
        }
        c.Next() <span class="hljs-comment">// 修改 3</span>
}
</code></pre>
<p>主要修改的部分在代码中标注出来了，其实就是将两个处理都加到 Context.handlers 中。这里更多的是告诉我们：对于这种错误处理之类的代码，完全可以提取出来作为一个中间件进行处理。这里的处理并不是最终的实现，最终的实现应该是将错误处理、日志记录等功能提取成 <strong>独立的中间件函数</strong>，然后通过框架的中间件机制将它们自动应用到请求处理流程中。</p>
<h4 data-id="heading-11">使用 Demo 测试</h4>
<p>首先在 <code>gee</code> 文件夹下添加一个中间件<code>logger.go</code>：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> gee

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"log"</span>
        <span class="hljs-string">"time"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Logger</span><span class="hljs-params">()</span></span> HandlerFunc {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *Context)</span></span> {
                <span class="hljs-comment">// 开始计时</span>
                t := time.Now()
                <span class="hljs-comment">// 处理请求</span>
                c.Next()
                <span class="hljs-comment">// 计算时间</span>
                log.Printf(<span class="hljs-string">"[%d] %s in %v"</span>, c.StatusCode, c.Req.RequestURI, time.Since(t))
        }
}
</code></pre>
<p>接下来在 <code>main.go</code> 编写测试 demo：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"gee"</span>
        <span class="hljs-string">"log"</span>
        <span class="hljs-string">"net/http"</span>
        <span class="hljs-string">"time"</span>
)

<span class="hljs-comment">// 自定义中间件</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">onlyForV2</span><span class="hljs-params">()</span></span> gee.HandlerFunc {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                <span class="hljs-comment">// Start timer</span>
                t := time.Now()
                <span class="hljs-comment">// if a server error occurred</span>
                <span class="hljs-comment">//c.Fail(500, "Internal Server Error")</span>
                <span class="hljs-comment">// Calculate resolution time</span>
                log.Printf(<span class="hljs-string">"[%d] %s in %v for group v2"</span>, c.StatusCode, c.Req.RequestURI, time.Since(t))
        }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
        r := gee.New()
        r.Use(gee.Logger()) <span class="hljs-comment">// global middleware</span>
        r.GET(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                c.HTML(http.StatusOK, <span class="hljs-string">"&lt;h1&gt;Hello Gee&lt;/h1&gt;"</span>)
        })

        v2 := r.Group(<span class="hljs-string">"/v2"</span>)
        v2.Use(onlyForV2()) <span class="hljs-comment">// v2 group middleware</span>
        {
                v2.GET(<span class="hljs-string">"/hello/:name"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                        <span class="hljs-comment">// expect /hello/geektutu</span>
                        c.String(http.StatusOK, <span class="hljs-string">"hello %s, you're at %s\n"</span>, c.Param(<span class="hljs-string">"name"</span>), c.Path)
                })
        }

        r.Run(<span class="hljs-string">":9999"</span>)
}
</code></pre>
<p>运行代码，然后在终端进行测试，可以看到终端确实输出了响应时间相关代码。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f37a77a63974be7b2bddeb526f13a32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2F5MnRvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568174&amp;x-signature=3kYvKjz%2F%2B3ALBo9Nw%2FYXBoZxctk%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d78b97577e2487886191ecb90626ba5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2F5MnRvcA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768568174&amp;x-signature=dCMOZz3DHPGP5bpW8Fgi3Pa8Bn0%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[低成本玩转鸿蒙容器的丐版方案]]></title>    <link>https://juejin.cn/post/7593240931286286388</link>    <guid>https://juejin.cn/post/7593240931286286388</guid>    <pubDate>2026-01-09T15:21:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593240931286286388" data-draft-id="7593338828195528744" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="低成本玩转鸿蒙容器的丐版方案"/> <meta itemprop="keywords" content="Docker,HarmonyOS"/> <meta itemprop="datePublished" content="2026-01-09T15:21:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="hqzing"/> <meta itemprop="url" content="https://juejin.cn/user/2784422731986295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            低成本玩转鸿蒙容器的丐版方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2784422731986295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    hqzing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:21:37.000Z" title="Fri Jan 09 2026 15:21:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>前段时间我发布了《<a href="https://juejin.cn/post/7575112613778145314" target="_blank" title="https://juejin.cn/post/7575112613778145314">介绍一个容器化的鸿蒙环境</a>》这篇文章，介绍了我制作的一个鸿蒙容器。</p>
<p>经过宣传，有一些用户下载体验了这个项目，我也收集到了一些反馈。其中有一项是成本问题：部分用户（例如大学生）可能没有条件去现买一个 arm64 服务器，或者没有条件去长时间供养它。</p>
<p>为了照顾到这类用户，我整理了一个“极低成本最小可用方案”（也可以说是丐版方案）。以牺牲性能为代价，可以在已有的 x64 服务器、WSL 或  Docker Desktop 里面运行这个鸿蒙容器，而无需另外购置 arm64 服务器。</p>
<h2 data-id="heading-1">x64 服务器操作流程</h2>
<p>接下来我将使用一台位于中国大陆内（华为云 西南-贵阳一）的 Ubuntu 24.04 x64 服务器进行演示。</p>
<p>专门挑选这个 Region 是为了能顺便展示如何在网络条件不佳的情况下如何走通全流程，这是中国大陆内的服务器很容易遇到的问题。</p>
<p><strong>1. 安装 Docker</strong></p>
<p>由于我这台服务器是全新的，所以我首先要安装 Docker。</p>
<p>我使用（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSuperManito%2FLinuxMirrors" target="_blank" title="https://github.com/SuperManito/LinuxMirrors" ref="nofollow noopener noreferrer">LinuxMirrors</a>）的脚本来进行安装：</p>
<pre><code class="hljs language-sh" lang="sh">bash &lt;(curl -sSL https://linuxmirrors.cn/docker.sh)

<span class="hljs-comment"># 以下是我做的配置</span>
<span class="hljs-comment"># Docker CE 源：华为云</span>
<span class="hljs-comment"># Docker CE 源的网络地址：公网</span>
<span class="hljs-comment"># Docker Registry 源：毫秒镜像</span>
<span class="hljs-comment"># Docker CE 软件源的网络协议：HTTP</span>
<span class="hljs-comment"># Docker Engine 是否安装最新版本：是</span>
</code></pre>
<p><strong>2. 注册 QEMU 解释器</strong></p>
<p>接下来向 Linux 内核注册 QEMU 解释器，这能让它支持在 x64 服务器上运行 arm64 容器</p>
<pre><code class="hljs language-sh" lang="sh">docker run --<span class="hljs-built_in">rm</span> --privileged tonistiigi/binfmt --install arm64
</code></pre>
<p>有几个注意事项：</p>
<ol>
<li>每次重启服务器都需要重新执行一遍这个命令，重新注册。</li>
<li>这个操作是全局生效的，不仅影响 Docker，还影响整个系统。注册完之后你可以在 x64 机器上直接执行 arm64 的二进制，无论是在 Docker 里面还是在宿主机上都是可以的。</li>
<li>在网络连通性方面，由于我前面装 Docker 的时候已经配了国内的 Docker Registry 源（毫秒镜像）了，所以我能够很顺利地拉取 <code>tonistiigi/binfmt</code> 这个镜像。如果你没配 Docker Registry 源，你得稍微等久一些。如果完全无法下载，那你需要自己配一个国内的 Docker Registry 源。</li>
</ol>
<p><strong>3. 拉取鸿蒙容器并运行</strong></p>
<p>拉取鸿蒙容器并运行</p>
<pre><code class="hljs language-sh" lang="sh">docker run --name=ohos -itd --platform linux/arm64 hqzing/docker-mini-openharmony:latest
</code></pre>
<p>我这里的镜像名字没有填 <code>ghcr.io/hqzing/docker-mini-openharmony:latest</code>，而是填了  <code>hqzing/docker-mini-openharmony:latest</code>。</p>
<p>我的原始镜像是放在 ghcr（GitHub Container Registry）上面的，中国大陆内的服务器拉取这个镜像可能会很慢或不通。为了方便中国大陆内的服务器拉取，我把镜像也往 Docker Hub 传了一份，如此一来用户便可以通过国内的 Docker Registry 源来拉取到它了。</p>
<p><strong>4. 下载软件体验一下</strong></p>
<p>随便下载个我移植好的软件体验一下，比如 neovim 编辑器</p>
<pre><code class="hljs language-sh" lang="sh">docker <span class="hljs-built_in">exec</span> -it ohos sh

<span class="hljs-built_in">cd</span> /root
curl -L -O https://ghfast.top/https://github.com/Harmonybrew/ohos-neovim/releases/download/0.11.4/neovim-0.11.4-ohos-arm64.tar.gz
tar -zxf neovim-0.11.4-ohos-arm64.tar.gz -C /opt
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/opt/neovim-0.11.4-ohos-arm64/bin

<span class="hljs-comment"># 现在可以使用 nvim 命令了</span>
</code></pre>
<p>注意看，我在原始的下载链接前面加了一个 <code>https://ghfast.top</code> 的前缀。这是为了使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fghfast.top%2F" target="_blank" title="https://ghfast.top/" ref="nofollow noopener noreferrer">ghfast.top</a> 的加速下载服务，以解决中国大陆内的服务器拉取 GitHub 资源速度慢/访问不通的问题。</p>
<h2 data-id="heading-2">WSL 和 Docker Desktop</h2>
<p>如果你用的是 WSL，就直接按 x64 服务器的流程进行操作即可，不需要做任何改动。</p>
<p>如果你用的是 Docker Desktop，操作流程跟上面是有一点出入，比如不用自己装 Docker、比如可以在图形界面里面换源，但运行容器的命令不变。</p>
<p>关于 Docker Desktop，我要提一下它的多架构镜像支持。</p>
<p>在正常情况下，最新版本的 Docker Desktop  默认就支持运行不同架构的镜像。它的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.docker.com%2Fbuild%2Fbuilding%2Fmulti-platform%2F%23qemu" target="_blank" title="https://docs.docker.com/build/building/multi-platform/#qemu" ref="nofollow noopener noreferrer">官方文档</a> 是这么说的：</p>
<blockquote>
<p>Docker Desktop supports running and building multi-platform images under emulation by default.</p>
</blockquote>
<p>所以你可以尝试直接执行 <code>docker run --name=ohos -itd --platform linux/arm64 hqzing/docker-mini-openharmony:latest</code> 命令来拉起容器。我在自己的电脑上试了，确实是能正常工作的。</p>
<p>在不正常情况下（可能跟具体的环境或配置有关），如果你发现它在你的电脑上不支持运行 arm64 容器，那你仍需要像在服务器上一样，先执行一遍 <code>docker run --rm --privileged tonistiigi/binfmt --install arm64</code> 命令进行 QEMU 的注册。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用FastAPI 一个 后端 和 两个前端 原生HTML/CSS/JS 、Vue3 写一个博客系统 例]]></title>    <link>https://juejin.cn/post/7593338828195545128</link>    <guid>https://juejin.cn/post/7593338828195545128</guid>    <pubDate>2026-01-09T15:23:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195545128" data-draft-id="7593193235251445812" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用FastAPI 一个 后端 和  两个前端 原生HTML/CSS/JS 、Vue3 写一个博客系统 例"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-09T15:23:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PieroPC"/> <meta itemprop="url" content="https://juejin.cn/user/1998231182522521"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用FastAPI 一个 后端 和  两个前端 原生HTML/CSS/JS 、Vue3 写一个博客系统 例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1998231182522521/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PieroPC
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:23:58.000Z" title="Fri Jan 09 2026 15:23:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">后端：</h2>
<pre><code class="hljs language-js" lang="js">├── backend/
│   ├── main.<span class="hljs-property">py</span>          # <span class="hljs-title class_">FastAPI</span> 后端
│   ├── models.<span class="hljs-property">py</span>        # 数据模型
│   ├── database.<span class="hljs-property">py</span>      # 数据库/状态管理
│   └── requirements.<span class="hljs-property">txt</span>
</code></pre>
<h3 data-id="heading-1">main.py</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException
<span class="hljs-keyword">from</span> fastapi.middleware.cors <span class="hljs-keyword">import</span> CORSMiddleware
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>
<span class="hljs-keyword">import</span> uvicorn

<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> BlogPost
<span class="hljs-keyword">from</span> database <span class="hljs-keyword">import</span> BlogDatabase

<span class="hljs-comment"># 创建 FastAPI 应用</span>
app = FastAPI(
    title=<span class="hljs-string">"博客系统 API"</span>,
    description=<span class="hljs-string">"一个简单的博客系统后端"</span>,
    version=<span class="hljs-string">"1.0.0"</span>
)

<span class="hljs-comment"># 添加 CORS 中间件</span>
app.add_middleware(
    CORSMiddleware,
    allow_origins=[<span class="hljs-string">"*"</span>],  <span class="hljs-comment"># 在生产环境中应该指定具体域名</span>
    allow_credentials=<span class="hljs-literal">True</span>,
    allow_methods=[<span class="hljs-string">"*"</span>],
    allow_headers=[<span class="hljs-string">"*"</span>],
)

<span class="hljs-comment"># 初始化数据库</span>
db = BlogDatabase()

<span class="hljs-comment"># API 路由</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">root</span>():
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"message"</span>: <span class="hljs-string">"欢迎访问博客系统 API"</span>,
        <span class="hljs-string">"docs"</span>: <span class="hljs-string">"/docs"</span>,
        <span class="hljs-string">"endpoints"</span>: {
            <span class="hljs-string">"获取所有文章"</span>: <span class="hljs-string">"GET /api/posts"</span>,
            <span class="hljs-string">"获取单篇文章"</span>: <span class="hljs-string">"GET /api/posts/{id}"</span>,
            <span class="hljs-string">"创建文章"</span>: <span class="hljs-string">"POST /api/posts"</span>,
            <span class="hljs-string">"更新文章"</span>: <span class="hljs-string">"PUT /api/posts/{id}"</span>,
            <span class="hljs-string">"删除文章"</span>: <span class="hljs-string">"DELETE /api/posts/{id}"</span>
        }
    }

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/api/posts"</span>, response_model=<span class="hljs-type">List</span>[BlogPost]</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all_posts</span>():
    <span class="hljs-string">"""获取所有博客文章"""</span>
    <span class="hljs-keyword">return</span> db.get_all_posts()

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/api/posts/{post_id}"</span>, response_model=BlogPost</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_post</span>(<span class="hljs-params">post_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-string">"""根据ID获取博客文章"""</span>
    post = db.get_post(post_id)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> post:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"文章不存在"</span>)
    <span class="hljs-keyword">return</span> post

<span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">"/api/posts"</span>, response_model=BlogPost</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_post</span>(<span class="hljs-params">post: BlogPost</span>):
    <span class="hljs-string">"""创建新博客文章"""</span>
    <span class="hljs-keyword">return</span> db.create_post(post.<span class="hljs-built_in">dict</span>())

<span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">"/api/posts/{post_id}"</span>, response_model=BlogPost</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_post</span>(<span class="hljs-params">post_id: <span class="hljs-built_in">int</span>, post: BlogPost</span>):
    <span class="hljs-string">"""更新博客文章"""</span>
    updated = db.update_post(post_id, post.<span class="hljs-built_in">dict</span>())
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> updated:
        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"文章不存在"</span>)
    <span class="hljs-keyword">return</span> updated

<span class="hljs-meta">@app.delete(<span class="hljs-params"><span class="hljs-string">"/api/posts/{post_id}"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_post</span>(<span class="hljs-params">post_id: <span class="hljs-built_in">int</span></span>):
    <span class="hljs-string">"""删除博客文章"""</span>
    <span class="hljs-keyword">if</span> db.delete_post(post_id):
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"message"</span>: <span class="hljs-string">"文章删除成功"</span>}
    <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">404</span>, detail=<span class="hljs-string">"文章不存在"</span>)

<span class="hljs-comment"># 健康检查端点</span>
<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/health"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">health_check</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"status"</span>: <span class="hljs-string">"healthy"</span>, <span class="hljs-string">"posts_count"</span>: <span class="hljs-built_in">len</span>(db.get_all_posts())}

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    uvicorn.run(
        <span class="hljs-string">"main:app"</span>,
        host=<span class="hljs-string">"0.0.0.0"</span>,
        port=<span class="hljs-number">8000</span>,
        reload=<span class="hljs-literal">True</span>
    )

</code></pre>
<h3 data-id="heading-2">models.py</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogPost</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">int</span>] = <span class="hljs-literal">None</span>
    title: <span class="hljs-built_in">str</span>
    content: <span class="hljs-built_in">str</span>
    author: <span class="hljs-built_in">str</span>
    created_at: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>
    updated_at: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>

</code></pre>
<h3 data-id="heading-3">database.py</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Optional</span>
<span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> BlogPost

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogDatabase</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.posts = []
        self.post_id_counter = <span class="hljs-number">1</span>
        self.init_sample_data()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_sample_data</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""初始化示例数据"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.posts:
            sample_posts = [
                BlogPost(
                    <span class="hljs-built_in">id</span>=<span class="hljs-number">1</span>,
                    title=<span class="hljs-string">"欢迎来到我的博客"</span>,
                    content=<span class="hljs-string">"这是我的第一篇博客文章，欢迎阅读！"</span>,
                    author=<span class="hljs-string">"管理员"</span>,
                    created_at=<span class="hljs-string">"2024-01-01 10:00:00"</span>,
                    updated_at=<span class="hljs-string">"2024-01-01 10:00:00"</span>
                ),
                BlogPost(
                    <span class="hljs-built_in">id</span>=<span class="hljs-number">2</span>,
                    title=<span class="hljs-string">"NiceGUI 3.X 新特性介绍"</span>,
                    content=<span class="hljs-string">"NiceGUI 3.X 带来了很多令人兴奋的新特性..."</span>,
                    author=<span class="hljs-string">"技术达人"</span>,
                    created_at=<span class="hljs-string">"2024-01-02 14:30:00"</span>,
                    updated_at=<span class="hljs-string">"2024-01-02 14:30:00"</span>
                ),
                BlogPost(
                    <span class="hljs-built_in">id</span>=<span class="hljs-number">3</span>,
                    title=<span class="hljs-string">"Python Web开发趋势"</span>,
                    content=<span class="hljs-string">"近年来，Python在Web开发领域发展迅速..."</span>,
                    author=<span class="hljs-string">"Python爱好者"</span>,
                    created_at=<span class="hljs-string">"2024-01-03 09:15:00"</span>,
                    updated_at=<span class="hljs-string">"2024-01-03 09:15:00"</span>
                )
            ]
            
            <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> sample_posts:
                self.posts.append(post.<span class="hljs-built_in">dict</span>())
            self.post_id_counter = <span class="hljs-number">4</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all_posts</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:
        <span class="hljs-string">"""获取所有文章"""</span>
        <span class="hljs-keyword">return</span> self.posts
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_post</span>(<span class="hljs-params">self, post_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-type">Dict</span>]:
        <span class="hljs-string">"""根据ID获取文章"""</span>
        <span class="hljs-keyword">for</span> post <span class="hljs-keyword">in</span> self.posts:
            <span class="hljs-keyword">if</span> post[<span class="hljs-string">"id"</span>] == post_id:
                <span class="hljs-keyword">return</span> post
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_post</span>(<span class="hljs-params">self, post_data: <span class="hljs-type">Dict</span></span>) -&gt; <span class="hljs-type">Dict</span>:
        <span class="hljs-string">"""创建新文章"""</span>
        post = BlogPost(**post_data)
        post.<span class="hljs-built_in">id</span> = self.post_id_counter
        post.created_at = datetime.now().strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>)
        post.updated_at = post.created_at
        
        post_dict = post.<span class="hljs-built_in">dict</span>()
        self.posts.append(post_dict)
        self.post_id_counter += <span class="hljs-number">1</span>
        <span class="hljs-keyword">return</span> post_dict
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_post</span>(<span class="hljs-params">self, post_id: <span class="hljs-built_in">int</span>, post_data: <span class="hljs-type">Dict</span></span>) -&gt; <span class="hljs-type">Optional</span>[<span class="hljs-type">Dict</span>]:
        <span class="hljs-string">"""更新文章"""</span>
        <span class="hljs-keyword">for</span> i, existing_post <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.posts):
            <span class="hljs-keyword">if</span> existing_post[<span class="hljs-string">"id"</span>] == post_id:
                post_data[<span class="hljs-string">"id"</span>] = post_id
                post_data[<span class="hljs-string">"created_at"</span>] = existing_post[<span class="hljs-string">"created_at"</span>]
                post_data[<span class="hljs-string">"updated_at"</span>] = datetime.now().strftime(<span class="hljs-string">"%Y-%m-%d %H:%M:%S"</span>)
                
                self.posts[i] = post_data
                <span class="hljs-keyword">return</span> post_data
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_post</span>(<span class="hljs-params">self, post_id: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""删除文章"""</span>
        <span class="hljs-keyword">for</span> i, post <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.posts):
            <span class="hljs-keyword">if</span> post[<span class="hljs-string">"id"</span>] == post_id:
                self.posts.pop(i)
                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>

</code></pre>
<h3 data-id="heading-4">requirements.txt</h3>
<pre><code class="hljs language-python" lang="python">fastapi==<span class="hljs-number">0.104</span><span class="hljs-number">.1</span>
uvicorn==<span class="hljs-number">0.24</span><span class="hljs-number">.0</span>
pydantic==<span class="hljs-number">2.5</span><span class="hljs-number">.0</span>
python-multipart==<span class="hljs-number">0.0</span><span class="hljs-number">.6</span>

</code></pre>
<blockquote>
<p><strong>启动后端服务器 python main.py</strong></p>
</blockquote>
<h2 data-id="heading-5">Html/css/js 前端</h2>
<pre><code class="hljs language-js" lang="js">blog_system/

├── frontend/
│   ├── index.<span class="hljs-property">html</span>       # 主页面
│   ├── css/
│   │   └── style.<span class="hljs-property">css</span>    # 样式文件
│   └── js/
│       ├── app.<span class="hljs-property">js</span>       # 主应用逻辑
│       ├── api.<span class="hljs-property">js</span>       # <span class="hljs-variable constant_">API</span> 调用封装
│       └── ui.<span class="hljs-property">js</span>        # <span class="hljs-variable constant_">UI</span> 组件

</code></pre>
<h3 data-id="heading-6">frontend/index.html</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>博客系统<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"css/style.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&amp;display=swap"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/marked/marked.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 导航栏 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navbar"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-brand"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-blog"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>博客系统<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav-links"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"showPage('home')"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-home"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 首页
                <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"showPage('manage')"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-tasks"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 管理
                <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn btn-success"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"showPage('create')"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-plus"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span> 写文章
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-toggle-theme"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"toggleTheme()"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"fas fa-moon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 主内容区域 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"main-content"</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 首页内容将通过JavaScript动态加载 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 模态框容器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"modal-container"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 加载指示器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading-overlay"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"loading-overlay"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"spinner"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- JavaScript文件 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/api.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/ui.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"js/app.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// 初始化应用</span>
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'DOMContentLoaded'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">initApp</span>();
        });
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

</code></pre>
<h3 data-id="heading-7">frontend/css/style.css</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 基础样式 */</span>
<span class="hljs-selector-pseudo">:root</span> {
    <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#3b82f6</span>;
    <span class="hljs-attr">--primary-dark</span>: <span class="hljs-number">#2563eb</span>;
    <span class="hljs-attr">--secondary-color</span>: <span class="hljs-number">#6b7280</span>;
    <span class="hljs-attr">--success-color</span>: <span class="hljs-number">#10b981</span>;
    <span class="hljs-attr">--danger-color</span>: <span class="hljs-number">#ef4444</span>;
    <span class="hljs-attr">--warning-color</span>: <span class="hljs-number">#f59e0b</span>;
    <span class="hljs-attr">--light-color</span>: <span class="hljs-number">#f9fafb</span>;
    <span class="hljs-attr">--dark-color</span>: <span class="hljs-number">#1f2937</span>;
    <span class="hljs-attr">--border-color</span>: <span class="hljs-number">#e5e7eb</span>;
    <span class="hljs-attr">--shadow-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>);
    <span class="hljs-attr">--card-bg</span>: <span class="hljs-number">#ffffff</span>;
    <span class="hljs-attr">--body-bg</span>: <span class="hljs-number">#f3f4f6</span>;
    <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#374151</span>;
}

<span class="hljs-selector-attr">[data-theme=<span class="hljs-string">"dark"</span>]</span> {
    <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#60a5fa</span>;
    <span class="hljs-attr">--primary-dark</span>: <span class="hljs-number">#3b82f6</span>;
    <span class="hljs-attr">--secondary-color</span>: <span class="hljs-number">#9ca3af</span>;
    <span class="hljs-attr">--success-color</span>: <span class="hljs-number">#34d399</span>;
    <span class="hljs-attr">--danger-color</span>: <span class="hljs-number">#f87171</span>;
    <span class="hljs-attr">--warning-color</span>: <span class="hljs-number">#fbbf24</span>;
    <span class="hljs-attr">--light-color</span>: <span class="hljs-number">#374151</span>;
    <span class="hljs-attr">--dark-color</span>: <span class="hljs-number">#111827</span>;
    <span class="hljs-attr">--border-color</span>: <span class="hljs-number">#4b5563</span>;
    <span class="hljs-attr">--shadow-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);
    <span class="hljs-attr">--card-bg</span>: <span class="hljs-number">#1f2937</span>;
    <span class="hljs-attr">--body-bg</span>: <span class="hljs-number">#111827</span>;
    <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#f3f4f6</span>;
}

* {
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-tag">body</span> {
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Noto Sans SC'</span>, sans-serif;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--body-bg);
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
    <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span>, color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.container</span> {
    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-comment">/* 导航栏 */</span>
<span class="hljs-selector-class">.navbar</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">color</span>: white;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">var</span>(--shadow-color);
    <span class="hljs-attribute">position</span>: sticky;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1000</span>;
}

<span class="hljs-selector-class">.nav-container</span> {
    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1200px</span>;
    <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: space-between;
    <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-class">.nav-brand</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.nav-brand</span> <span class="hljs-selector-tag">i</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.8rem</span>;
}

<span class="hljs-selector-class">.nav-links</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
}

<span class="hljs-selector-class">.nav-links</span> <span class="hljs-selector-tag">a</span> {
    <span class="hljs-attribute">color</span>: white;
    <span class="hljs-attribute">text-decoration</span>: none;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
    <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.nav-links</span> <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* 按钮样式 */</span>
<span class="hljs-selector-class">.btn</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
    <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">display</span>: inline-flex;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">text-decoration</span>: none;
}

<span class="hljs-selector-class">.btn</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">2px</span>);
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">var</span>(--shadow-color);
}

<span class="hljs-selector-class">.btn-primary</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-primary</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-dark);
}

<span class="hljs-selector-class">.btn-success</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--success-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-danger</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--danger-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-secondary</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--secondary-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-outline</span> {
    <span class="hljs-attribute">background-color</span>: transparent;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--primary-color);
}

<span class="hljs-selector-class">.btn-outline</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-toggle-theme</span> {
    <span class="hljs-attribute">background</span>: none;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">color</span>: white;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.2rem</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">transition</span>: background-color <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.btn-toggle-theme</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-comment">/* 卡片样式 */</span>
<span class="hljs-selector-class">.card</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--card-bg);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">24px</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">20px</span> <span class="hljs-built_in">var</span>(--shadow-color);
    <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span>, box-shadow <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
}

<span class="hljs-selector-class">.card</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">4px</span>);
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">var</span>(--shadow-color);
}

<span class="hljs-comment">/* 表单样式 */</span>
<span class="hljs-selector-class">.form-group</span> {
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.form-label</span> {
    <span class="hljs-attribute">display</span>: block;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
}

<span class="hljs-selector-class">.form-control</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> solid <span class="hljs-built_in">var</span>(--border-color);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1rem</span>;
    <span class="hljs-attribute">transition</span>: border-color <span class="hljs-number">0.3s</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--card-bg);
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
}

<span class="hljs-selector-class">.form-control</span><span class="hljs-selector-pseudo">:focus</span> {
    <span class="hljs-attribute">outline</span>: none;
    <span class="hljs-attribute">border-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
}

<span class="hljs-selector-tag">textarea</span><span class="hljs-selector-class">.form-control</span> {
    <span class="hljs-attribute">min-height</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">resize</span>: vertical;
    <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'Noto Sans SC'</span>, sans-serif;
}

<span class="hljs-comment">/* 徽章 */</span>
<span class="hljs-selector-class">.badge</span> {
    <span class="hljs-attribute">display</span>: inline-block;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.85rem</span>;
    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
}

<span class="hljs-selector-class">.badge-primary</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.badge-success</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--success-color);
    <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-comment">/* 加载动画 */</span>
<span class="hljs-selector-class">.loading-overlay</span> {
    <span class="hljs-attribute">position</span>: fixed;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
    <span class="hljs-attribute">display</span>: none;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2000</span>;
}

<span class="hljs-selector-class">.spinner</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">5px</span> solid <span class="hljs-built_in">var</span>(--border-color);
    <span class="hljs-attribute">border-top-color</span>: <span class="hljs-built_in">var</span>(--primary-color);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">animation</span>: spin <span class="hljs-number">1s</span> linear infinite;
}

<span class="hljs-keyword">@keyframes</span> spin {
    <span class="hljs-selector-tag">to</span> { <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">360deg</span>); }
}

<span class="hljs-comment">/* 模态框 */</span>
<span class="hljs-selector-class">.modal</span> {
    <span class="hljs-attribute">position</span>: fixed;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
    <span class="hljs-attribute">display</span>: none;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">align-items</span>: center;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1001</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.modal-content</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--card-bg);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">max-width</span>: <span class="hljs-number">500px</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">max-height</span>: <span class="hljs-number">90vh</span>;
    <span class="hljs-attribute">overflow-y</span>: auto;
}

<span class="hljs-selector-class">.modal-header</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: space-between;
    <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-class">.modal-title</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.modal-close</span> {
    <span class="hljs-attribute">background</span>: none;
    <span class="hljs-attribute">border</span>: none;
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    <span class="hljs-attribute">cursor</span>: pointer;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--secondary-color);
}

<span class="hljs-selector-class">.modal-body</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.modal-footer</span> {
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">border-top</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: flex-end;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-comment">/* 文章列表 */</span>
<span class="hljs-selector-class">.post-list</span> {
    <span class="hljs-attribute">display</span>: grid;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">20px</span>;
}

<span class="hljs-selector-class">.post-card</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--card-bg);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">24px</span>;
    <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-built_in">var</span>(--border-color);
    <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span>;
}

<span class="hljs-selector-class">.post-card</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">4px</span>);
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">8px</span> <span class="hljs-number">30px</span> <span class="hljs-built_in">var</span>(--shadow-color);
}

<span class="hljs-selector-class">.post-title</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">1.5rem</span>;
    <span class="hljs-attribute">font-weight</span>: bold;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
}

<span class="hljs-selector-class">.post-meta</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--secondary-color);
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0.9rem</span>;
}

<span class="hljs-selector-class">.post-content-preview</span> {
    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.6</span>;
    <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">15px</span>;
    <span class="hljs-attribute">display</span>: -webkit-box;
    -webkit-line-clamp: <span class="hljs-number">3</span>;
    -webkit-box-orient: vertical;
    <span class="hljs-attribute">overflow</span>: hidden;
}

<span class="hljs-selector-class">.post-actions</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">10px</span>;
    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">15px</span>;
}

<span class="hljs-comment">/* 响应式设计 */</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-width</span>: <span class="hljs-number">768px</span>) {
    <span class="hljs-selector-class">.nav-container</span> {
        <span class="hljs-attribute">flex-direction</span>: column;
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">15px</span>;
    }
    
    <span class="hljs-selector-class">.nav-links</span> {
        <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
        <span class="hljs-attribute">justify-content</span>: center;
        <span class="hljs-attribute">flex-wrap</span>: wrap;
    }
    
    <span class="hljs-selector-class">.container</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
    }
    
    <span class="hljs-selector-class">.post-meta</span> {
        <span class="hljs-attribute">flex-direction</span>: column;
        <span class="hljs-attribute">gap</span>: <span class="hljs-number">5px</span>;
    }
}

</code></pre>
<h3 data-id="heading-8">frontend/js/api.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// API基础配置</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_BASE_URL</span> = <span class="hljs-string">'http://localhost:8000'</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">API_ENDPOINTS</span> = {
    <span class="hljs-attr">POSTS</span>: <span class="hljs-string">'/api/posts'</span>,
    <span class="hljs-attr">POST</span>: <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> <span class="hljs-string">`/api/posts/<span class="hljs-subst">${id}</span>`</span>
};

<span class="hljs-comment">// 显示/隐藏加载指示器</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showLoading</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loading-overlay'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'flex'</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">hideLoading</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'loading-overlay'</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
}

<span class="hljs-comment">// 统一的错误处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleApiError</span>(<span class="hljs-params">error</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'API Error:'</span>, error);
    <span class="hljs-keyword">let</span> message = <span class="hljs-string">'网络错误，请稍后重试'</span>;
    
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>) {
        message = error.<span class="hljs-property">response</span>.<span class="hljs-property">data</span>?.<span class="hljs-property">detail</span> || <span class="hljs-string">`服务器错误: <span class="hljs-subst">${error.response.status}</span>`</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">request</span>) {
        message = <span class="hljs-string">'无法连接到服务器，请检查网络连接'</span>;
    }
    
    <span class="hljs-title function_">alert</span>(message);
    <span class="hljs-keyword">throw</span> error;
}

<span class="hljs-comment">// 博客API</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">BlogAPI</span> = {
    <span class="hljs-comment">// 获取所有文章</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAllPosts</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">showLoading</span>();
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span><span class="hljs-subst">${API_ENDPOINTS.POSTS}</span>`</span>);
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">handleApiError</span>(error);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">hideLoading</span>();
        }
    },

    <span class="hljs-comment">// 获取单篇文章</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getPost</span>(<span class="hljs-params">id</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">showLoading</span>();
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span><span class="hljs-subst">${API_ENDPOINTS.POST(id)}</span>`</span>);
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">handleApiError</span>(error);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">hideLoading</span>();
        }
    },

    <span class="hljs-comment">// 创建文章</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">createPost</span>(<span class="hljs-params">postData</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">showLoading</span>();
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span><span class="hljs-subst">${API_ENDPOINTS.POSTS}</span>`</span>, {
                <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
                <span class="hljs-attr">headers</span>: {
                    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
                },
                <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(postData)
            });
            
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">handleApiError</span>(error);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">hideLoading</span>();
        }
    },

    <span class="hljs-comment">// 更新文章</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">updatePost</span>(<span class="hljs-params">id, postData</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">showLoading</span>();
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span><span class="hljs-subst">${API_ENDPOINTS.POST(id)}</span>`</span>, {
                <span class="hljs-attr">method</span>: <span class="hljs-string">'PUT'</span>,
                <span class="hljs-attr">headers</span>: {
                    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
                },
                <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(postData)
            });
            
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">handleApiError</span>(error);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">hideLoading</span>();
        }
    },

    <span class="hljs-comment">// 删除文章</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">deletePost</span>(<span class="hljs-params">id</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-title function_">showLoading</span>();
            <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`<span class="hljs-subst">${API_BASE_URL}</span><span class="hljs-subst">${API_ENDPOINTS.POST(id)}</span>`</span>, {
                <span class="hljs-attr">method</span>: <span class="hljs-string">'DELETE'</span>
            });
            
            <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`HTTP error! status: <span class="hljs-subst">${response.status}</span>`</span>);
            <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
            <span class="hljs-keyword">return</span> data;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-title function_">handleApiError</span>(error);
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-title function_">hideLoading</span>();
        }
    }
};

</code></pre>
<h3 data-id="heading-9">frontend/js/ui.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// UI组件库</span>

<span class="hljs-comment">// 显示通知</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showNotification</span>(<span class="hljs-params">message, type = <span class="hljs-string">'info'</span></span>) {
    <span class="hljs-keyword">const</span> colors = {
        <span class="hljs-attr">success</span>: <span class="hljs-string">'#10b981'</span>,
        <span class="hljs-attr">error</span>: <span class="hljs-string">'#ef4444'</span>,
        <span class="hljs-attr">warning</span>: <span class="hljs-string">'#f59e0b'</span>,
        <span class="hljs-attr">info</span>: <span class="hljs-string">'#3b82f6'</span>
    };
    
    <span class="hljs-keyword">const</span> notification = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    notification.<span class="hljs-property">style</span>.<span class="hljs-property">cssText</span> = <span class="hljs-string">`
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        background-color: <span class="hljs-subst">${colors[type]}</span>;
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        z-index: 1002;
        animation: slideIn 0.3s ease-out;
        max-width: 400px;
    `</span>;
    
    notification.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div style="display: flex; align-items: center; gap: 10px;"&gt;
            &lt;i class="fas <span class="hljs-subst">${type === <span class="hljs-string">'success'</span> ? <span class="hljs-string">'fa-check-circle'</span> : 
                          type === <span class="hljs-string">'error'</span> ? <span class="hljs-string">'fa-exclamation-circle'</span> : 
                          type === <span class="hljs-string">'warning'</span> ? <span class="hljs-string">'fa-exclamation-triangle'</span> : 
                          <span class="hljs-string">'fa-info-circle'</span>}</span>"&gt;&lt;/i&gt;
            &lt;span&gt;<span class="hljs-subst">${message}</span>&lt;/span&gt;
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(notification);
    
    <span class="hljs-comment">// 自动消失</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        notification.<span class="hljs-property">style</span>.<span class="hljs-property">animation</span> = <span class="hljs-string">'slideOut 0.3s ease-out forwards'</span>;
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> notification.<span class="hljs-title function_">remove</span>(), <span class="hljs-number">300</span>);
    }, <span class="hljs-number">3000</span>);
}

<span class="hljs-comment">// 创建模态框</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createModal</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-keyword">const</span> modal = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    modal.<span class="hljs-property">className</span> = <span class="hljs-string">'modal'</span>;
    modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'flex'</span>;
    
    modal.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div class="modal-content"&gt;
            &lt;div class="modal-header"&gt;
                &lt;h3 class="modal-title"&gt;<span class="hljs-subst">${options.title || <span class="hljs-string">''</span>}</span>&lt;/h3&gt;
                &lt;button class="modal-close" onclick="this.closest('.modal').remove()"&gt;
                    &lt;i class="fas fa-times"&gt;&lt;/i&gt;
                &lt;/button&gt;
            &lt;/div&gt;
            &lt;div class="modal-body"&gt;
                <span class="hljs-subst">${options.body || <span class="hljs-string">''</span>}</span>
            &lt;/div&gt;
            <span class="hljs-subst">${options.footer ? <span class="hljs-string">`
            &lt;div class="modal-footer"&gt;
                <span class="hljs-subst">${options.footer}</span>
            &lt;/div&gt;
            `</span> : <span class="hljs-string">''</span>}</span>
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'modal-container'</span>).<span class="hljs-title function_">appendChild</span>(modal);
    
    <span class="hljs-comment">// 点击背景关闭</span>
    modal.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span> === modal) {
            modal.<span class="hljs-title function_">remove</span>();
        }
    });
    
    <span class="hljs-keyword">return</span> modal;
}

<span class="hljs-comment">// 确认对话框</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showConfirmDialog</span>(<span class="hljs-params">message, onConfirm, onCancel = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">const</span> modal = <span class="hljs-title function_">createModal</span>({
        <span class="hljs-attr">title</span>: <span class="hljs-string">'确认操作'</span>,
        <span class="hljs-attr">body</span>: message,
        <span class="hljs-attr">footer</span>: <span class="hljs-string">`
            &lt;button class="btn btn-secondary" onclick="this.closest('.modal').remove(); <span class="hljs-subst">${onCancel ? <span class="hljs-string">'onCancel()'</span> : <span class="hljs-string">''</span>}</span>"&gt;
                取消
            &lt;/button&gt;
            &lt;button class="btn btn-danger" onclick="this.closest('.modal').remove(); onConfirm()"&gt;
                确认
            &lt;/button&gt;
        `</span>
    });
    
    <span class="hljs-keyword">return</span> modal;
}

<span class="hljs-comment">// 渲染文章卡片</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPostCard</span>(<span class="hljs-params">post</span>) {
    <span class="hljs-keyword">const</span> contentPreview = post.<span class="hljs-property">content</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">150</span> 
        ? post.<span class="hljs-property">content</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, <span class="hljs-number">150</span>) + <span class="hljs-string">'...'</span> 
        : post.<span class="hljs-property">content</span>;
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
        &lt;div class="post-card"&gt;
            &lt;div class="post-title"&gt;<span class="hljs-subst">${post.title}</span>&lt;/div&gt;
            &lt;div class="post-meta"&gt;
                &lt;span&gt;&lt;i class="fas fa-user"&gt;&lt;/i&gt; <span class="hljs-subst">${post.author}</span>&lt;/span&gt;
                &lt;span&gt;&lt;i class="fas fa-calendar"&gt;&lt;/i&gt; <span class="hljs-subst">${post.created_at}</span>&lt;/span&gt;
            &lt;/div&gt;
            &lt;div class="post-content-preview"&gt;<span class="hljs-subst">${contentPreview}</span>&lt;/div&gt;
            &lt;div class="post-actions"&gt;
                &lt;button class="btn btn-primary" onclick="viewPost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-eye"&gt;&lt;/i&gt; 查看
                &lt;/button&gt;
                &lt;button class="btn btn-secondary" onclick="editPost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-edit"&gt;&lt;/i&gt; 编辑
                &lt;/button&gt;
                &lt;button class="btn btn-danger" onclick="deletePost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-trash"&gt;&lt;/i&gt; 删除
                &lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `</span>;
}

<span class="hljs-comment">// 渲染文章详情</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPostDetail</span>(<span class="hljs-params">post</span>) {
    <span class="hljs-keyword">const</span> cleanContent = <span class="hljs-title class_">DOMPurify</span>.<span class="hljs-title function_">sanitize</span>(marked.<span class="hljs-title function_">parse</span>(post.<span class="hljs-property">content</span>));
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
        &lt;div class="card"&gt;
            &lt;div style="margin-bottom: 20px;"&gt;
                &lt;button class="btn btn-secondary" onclick="showPage('home')"&gt;
                    &lt;i class="fas fa-arrow-left"&gt;&lt;/i&gt; 返回
                &lt;/button&gt;
            &lt;/div&gt;
            
            &lt;h1 class="post-title" style="font-size: 2rem; margin-bottom: 20px;"&gt;
                <span class="hljs-subst">${post.title}</span>
            &lt;/h1&gt;
            
            &lt;div class="post-meta" style="margin-bottom: 30px;"&gt;
                &lt;span class="badge badge-primary"&gt;
                    &lt;i class="fas fa-user"&gt;&lt;/i&gt; <span class="hljs-subst">${post.author}</span>
                &lt;/span&gt;
                &lt;span&gt;&lt;i class="fas fa-calendar"&gt;&lt;/i&gt; 创建: <span class="hljs-subst">${post.created_at}</span>&lt;/span&gt;
                <span class="hljs-subst">${post.updated_at !== post.created_at ? 
                    <span class="hljs-string">`&lt;span&gt;&lt;i class="fas fa-history"&gt;&lt;/i&gt; 更新: <span class="hljs-subst">${post.updated_at}</span>&lt;/span&gt;`</span> : <span class="hljs-string">''</span>}</span>
            &lt;/div&gt;
            
            &lt;div class="post-content" style="font-size: 1.1rem; line-height: 1.8;"&gt;
                <span class="hljs-subst">${cleanContent}</span>
            &lt;/div&gt;
            
            &lt;div class="post-actions" style="margin-top: 30px;"&gt;
                &lt;button class="btn btn-secondary" onclick="editPost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-edit"&gt;&lt;/i&gt; 编辑文章
                &lt;/button&gt;
                &lt;button class="btn btn-danger" onclick="deletePost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-trash"&gt;&lt;/i&gt; 删除文章
                &lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `</span>;
}

<span class="hljs-comment">// 渲染文章表单</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPostForm</span>(<span class="hljs-params">post = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">const</span> isEdit = !!post;
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
        &lt;div class="card"&gt;
            &lt;div style="margin-bottom: 20px;"&gt;
                &lt;button class="btn btn-secondary" onclick="showPage('<span class="hljs-subst">${isEdit ? <span class="hljs-string">`view/<span class="hljs-subst">${post.id}</span>`</span> : <span class="hljs-string">'home'</span>}</span>')"&gt;
                    &lt;i class="fas fa-arrow-left"&gt;&lt;/i&gt; 返回
                &lt;/button&gt;
            &lt;/div&gt;
            
            &lt;h2 style="margin-bottom: 30px; color: var(--text-color);"&gt;
                <span class="hljs-subst">${isEdit ? <span class="hljs-string">'编辑文章'</span> : <span class="hljs-string">'写新文章'</span>}</span>
            &lt;/h2&gt;
            
            &lt;form id="postForm" onsubmit="handleSubmitPost(event, <span class="hljs-subst">${isEdit ? post.id : <span class="hljs-string">'null'</span>}</span>)"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label class="form-label"&gt;标题&lt;/label&gt;
                    &lt;input type="text" class="form-control" id="postTitle" 
                           value="<span class="hljs-subst">${post ? post.title : <span class="hljs-string">''</span>}</span>" required&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label class="form-label"&gt;作者&lt;/label&gt;
                    &lt;input type="text" class="form-control" id="postAuthor" 
                           value="<span class="hljs-subst">${post ? post.author : <span class="hljs-string">'管理员'</span>}</span>" required&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label class="form-label"&gt;内容&lt;/label&gt;
                    &lt;textarea class="form-control" id="postContent" 
                              rows="10" required&gt;<span class="hljs-subst">${post ? post.content : <span class="hljs-string">''</span>}</span>&lt;/textarea&gt;
                &lt;/div&gt;
                
                &lt;div style="display: flex; gap: 10px; margin-top: 30px;"&gt;
                    &lt;button type="button" class="btn btn-secondary" 
                            onclick="showPage('<span class="hljs-subst">${isEdit ? <span class="hljs-string">`view/<span class="hljs-subst">${post.id}</span>`</span> : <span class="hljs-string">'home'</span>}</span>')"&gt;
                        取消
                    &lt;/button&gt;
                    &lt;button type="submit" class="btn btn-success"&gt;
                        &lt;i class="fas fa-paper-plane"&gt;&lt;/i&gt; 
                        <span class="hljs-subst">${isEdit ? <span class="hljs-string">'更新文章'</span> : <span class="hljs-string">'发布文章'</span>}</span>
                    &lt;/button&gt;
                &lt;/div&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    `</span>;
}

<span class="hljs-comment">// 渲染文章管理表格</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderPostTable</span>(<span class="hljs-params">posts</span>) {
    <span class="hljs-keyword">if</span> (posts.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px;"&gt;
                &lt;i class="fas fa-inbox" style="font-size: 3rem; color: var(--secondary-color); margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;h3 style="color: var(--text-color); margin-bottom: 10px;"&gt;暂无文章&lt;/h3&gt;
                &lt;p style="color: var(--secondary-color);"&gt;点击"写文章"按钮开始创作&lt;/p&gt;
            &lt;/div&gt;
        `</span>;
    }
    
    <span class="hljs-keyword">const</span> rows = posts.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">post</span> =&gt;</span> <span class="hljs-string">`
        &lt;tr&gt;
            &lt;td&gt;<span class="hljs-subst">${post.id}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${post.title}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${post.author}</span>&lt;/td&gt;
            &lt;td&gt;<span class="hljs-subst">${post.created_at}</span>&lt;/td&gt;
            &lt;td&gt;
                &lt;button class="btn btn-primary btn-sm" onclick="viewPost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-eye"&gt;&lt;/i&gt;
                &lt;/button&gt;
                &lt;button class="btn btn-secondary btn-sm" onclick="editPost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-edit"&gt;&lt;/i&gt;
                &lt;/button&gt;
                &lt;button class="btn btn-danger btn-sm" onclick="deletePost(<span class="hljs-subst">${post.id}</span>)"&gt;
                    &lt;i class="fas fa-trash"&gt;&lt;/i&gt;
                &lt;/button&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    `</span>).<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`
        &lt;div class="card"&gt;
            &lt;h2 style="margin-bottom: 20px; color: var(--text-color);"&gt;文章管理&lt;/h2&gt;
            &lt;div style="overflow-x: auto;"&gt;
                &lt;table style="width: 100%; border-collapse: collapse;"&gt;
                    &lt;thead&gt;
                        &lt;tr style="background-color: var(--light-color);"&gt;
                            &lt;th style="padding: 12px; text-align: left;"&gt;ID&lt;/th&gt;
                            &lt;th style="padding: 12px; text-align: left;"&gt;标题&lt;/th&gt;
                            &lt;th style="padding: 12px; text-align: left;"&gt;作者&lt;/th&gt;
                            &lt;th style="padding: 12px; text-align: left;"&gt;创建时间&lt;/th&gt;
                            &lt;th style="padding: 12px; text-align: left;"&gt;操作&lt;/th&gt;
                        &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                        <span class="hljs-subst">${rows}</span>
                    &lt;/tbody&gt;
                &lt;/table&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `</span>;
}

</code></pre>
<h3 data-id="heading-10">frontend/js/app.js</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 应用主逻辑</span>
<span class="hljs-keyword">let</span> currentPage = <span class="hljs-string">'home'</span>;

<span class="hljs-comment">// 初始化应用</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initApp</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 设置主题</span>
    <span class="hljs-keyword">const</span> savedTheme = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'theme'</span>) || <span class="hljs-string">'light'</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-theme'</span>, savedTheme);
    
    <span class="hljs-comment">// 加载首页</span>
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">showPage</span>(<span class="hljs-string">'home'</span>);
}

<span class="hljs-comment">// 切换主题</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleTheme</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> currentTheme = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-theme'</span>);
    <span class="hljs-keyword">const</span> newTheme = currentTheme === <span class="hljs-string">'dark'</span> ? <span class="hljs-string">'light'</span> : <span class="hljs-string">'dark'</span>;
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-theme'</span>, newTheme);
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'theme'</span>, newTheme);
    
    <span class="hljs-comment">// 更新按钮图标</span>
    <span class="hljs-keyword">const</span> themeButton = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.btn-toggle-theme i'</span>);
    themeButton.<span class="hljs-property">className</span> = newTheme === <span class="hljs-string">'dark'</span> ? <span class="hljs-string">'fas fa-sun'</span> : <span class="hljs-string">'fas fa-moon'</span>;
}

<span class="hljs-comment">// 显示页面</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">showPage</span>(<span class="hljs-params">page</span>) {
    currentPage = page;
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (page === <span class="hljs-string">'home'</span>) {
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadHomePage</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (page === <span class="hljs-string">'manage'</span>) {
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadManagePage</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (page === <span class="hljs-string">'create'</span>) {
            <span class="hljs-title function_">loadCreatePage</span>();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (page.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'view/'</span>)) {
            <span class="hljs-keyword">const</span> postId = <span class="hljs-built_in">parseInt</span>(page.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)[<span class="hljs-number">1</span>]);
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadPostPage</span>(postId);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (page.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'edit/'</span>)) {
            <span class="hljs-keyword">const</span> postId = <span class="hljs-built_in">parseInt</span>(page.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)[<span class="hljs-number">1</span>]);
            <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadEditPage</span>(postId);
        }
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error loading page:'</span>, error);
        mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px;"&gt;
                &lt;i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger-color); margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;h3 style="color: var(--text-color); margin-bottom: 10px;"&gt;加载失败&lt;/h3&gt;
                &lt;p style="color: var(--secondary-color);"&gt;<span class="hljs-subst">${error.message}</span>&lt;/p&gt;
                &lt;button class="btn btn-primary" onclick="showPage('home')" style="margin-top: 20px;"&gt;
                    返回首页
                &lt;/button&gt;
            &lt;/div&gt;
        `</span>;
    }
}

<span class="hljs-comment">// 加载首页</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadHomePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    
    mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div style="margin-bottom: 30px;"&gt;
            &lt;h1 style="color: var(--text-color); margin-bottom: 10px;"&gt;📚 最新文章&lt;/h1&gt;
            &lt;p style="color: var(--secondary-color);"&gt;欢迎阅读我们的博客文章&lt;/p&gt;
        &lt;/div&gt;
        &lt;div id="posts-container" style="min-height: 200px;"&gt;
            &lt;div style="text-align: center; padding: 40px;"&gt;
                &lt;div class="spinner" style="margin: 0 auto;"&gt;&lt;/div&gt;
                &lt;p style="margin-top: 20px; color: var(--secondary-color);"&gt;加载中...&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">getAllPosts</span>();
        
        <span class="hljs-keyword">if</span> (posts.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'posts-container'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
                &lt;div class="card" style="text-align: center; padding: 40px;"&gt;
                    &lt;i class="fas fa-feather-alt" style="font-size: 3rem; color: var(--secondary-color); margin-bottom: 20px;"&gt;&lt;/i&gt;
                    &lt;h3 style="color: var(--text-color); margin-bottom: 10px;"&gt;暂无文章&lt;/h3&gt;
                    &lt;p style="color: var(--secondary-color); margin-bottom: 20px;"&gt;点击"写文章"按钮开始创作&lt;/p&gt;
                    &lt;button class="btn btn-success" onclick="showPage('create')"&gt;
                        &lt;i class="fas fa-plus"&gt;&lt;/i&gt; 写文章
                    &lt;/button&gt;
                &lt;/div&gt;
            `</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">const</span> postsHTML = posts
                .<span class="hljs-title function_">slice</span>() <span class="hljs-comment">// 创建副本避免修改原数组</span>
                .<span class="hljs-title function_">reverse</span>() <span class="hljs-comment">// 最新的在前</span>
                .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">post</span> =&gt;</span> <span class="hljs-title function_">renderPostCard</span>(post))
                .<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);
            
            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'posts-container'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
                &lt;div class="post-list"&gt;
                    <span class="hljs-subst">${postsHTML}</span>
                &lt;/div&gt;
            `</span>;
        }
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'posts-container'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px; color: var(--danger-color);"&gt;
                &lt;i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;p&gt;加载文章失败，请刷新页面重试&lt;/p&gt;
            &lt;/div&gt;
        `</span>;
    }
}

<span class="hljs-comment">// 加载文章详情页</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadPostPage</span>(<span class="hljs-params">postId</span>) {
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    
    mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div style="text-align: center; padding: 40px;"&gt;
            &lt;div class="spinner" style="margin: 0 auto;"&gt;&lt;/div&gt;
            &lt;p style="margin-top: 20px; color: var(--secondary-color);"&gt;加载中...&lt;/p&gt;
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">getPost</span>(postId);
        mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-title function_">renderPostDetail</span>(post);
    } <span class="hljs-keyword">catch</span> (error) {
        mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px;"&gt;
                &lt;i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger-color); margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;h3 style="color: var(--text-color); margin-bottom: 10px;"&gt;文章不存在&lt;/h3&gt;
                &lt;p style="color: var(--secondary-color);"&gt;该文章可能已被删除&lt;/p&gt;
                &lt;button class="btn btn-primary" onclick="showPage('home')" style="margin-top: 20px;"&gt;
                    返回首页
                &lt;/button&gt;
            &lt;/div&gt;
        `</span>;
    }
}

<span class="hljs-comment">// 加载创建文章页</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadCreatePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-title function_">renderPostForm</span>();
}

<span class="hljs-comment">// 加载编辑文章页</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadEditPage</span>(<span class="hljs-params">postId</span>) {
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    
    mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div style="text-align: center; padding: 40px;"&gt;
            &lt;div class="spinner" style="margin: 0 auto;"&gt;&lt;/div&gt;
            &lt;p style="margin-top: 20px; color: var(--secondary-color);"&gt;加载中...&lt;/p&gt;
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">getPost</span>(postId);
        mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-title function_">renderPostForm</span>(post);
    } <span class="hljs-keyword">catch</span> (error) {
        mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px;"&gt;
                &lt;i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger-color); margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;h3 style="color: var(--text-color); margin-bottom: 10px;"&gt;文章不存在&lt;/h3&gt;
                &lt;p style="color: var(--secondary-color);"&gt;无法编辑不存在的文章&lt;/p&gt;
                &lt;button class="btn btn-primary" onclick="showPage('home')" style="margin-top: 20px;"&gt;
                    返回首页
                &lt;/button&gt;
            &lt;/div&gt;
        `</span>;
    }
}

<span class="hljs-comment">// 加载管理页面</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadManagePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> mainContent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'main-content'</span>);
    
    mainContent.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
        &lt;div style="margin-bottom: 30px;"&gt;
            &lt;h1 style="color: var(--text-color); margin-bottom: 10px;"&gt;📋 文章管理&lt;/h1&gt;
            &lt;p style="color: var(--secondary-color);"&gt;管理所有博客文章&lt;/p&gt;
        &lt;/div&gt;
        &lt;div id="manage-container" style="min-height: 200px;"&gt;
            &lt;div style="text-align: center; padding: 40px;"&gt;
                &lt;div class="spinner" style="margin: 0 auto;"&gt;&lt;/div&gt;
                &lt;p style="margin-top: 20px; color: var(--secondary-color);"&gt;加载中...&lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    `</span>;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">getAllPosts</span>();
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'manage-container'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-title function_">renderPostTable</span>(posts);
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'manage-container'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
            &lt;div class="card" style="text-align: center; padding: 40px; color: var(--danger-color);"&gt;
                &lt;i class="fas fa-exclamation-circle" style="font-size: 3rem; margin-bottom: 20px;"&gt;&lt;/i&gt;
                &lt;p&gt;加载失败，请刷新页面重试&lt;/p&gt;
            &lt;/div&gt;
        `</span>;
    }
}

<span class="hljs-comment">// 查看文章</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">viewPost</span>(<span class="hljs-params">postId</span>) {
    <span class="hljs-title function_">showPage</span>(<span class="hljs-string">`view/<span class="hljs-subst">${postId}</span>`</span>);
}

<span class="hljs-comment">// 编辑文章</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">editPost</span>(<span class="hljs-params">postId</span>) {
    <span class="hljs-title function_">showPage</span>(<span class="hljs-string">`edit/<span class="hljs-subst">${postId}</span>`</span>);
}

<span class="hljs-comment">// 删除文章</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">deletePost</span>(<span class="hljs-params">postId</span>) {
    <span class="hljs-title function_">showConfirmDialog</span>(
        <span class="hljs-string">'确定要删除这篇文章吗？删除后无法恢复。'</span>,
        <span class="hljs-keyword">async</span> () =&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">deletePost</span>(postId);
                <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'文章删除成功'</span>, <span class="hljs-string">'success'</span>);
                
                <span class="hljs-comment">// 根据当前页面刷新内容</span>
                <span class="hljs-keyword">if</span> (currentPage === <span class="hljs-string">'manage'</span>) {
                    <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadManagePage</span>();
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentPage === <span class="hljs-string">'home'</span>) {
                    <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadHomePage</span>();
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-title function_">showPage</span>(<span class="hljs-string">'home'</span>);
                }
            } <span class="hljs-keyword">catch</span> (error) {
                <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'删除失败: '</span> + error.<span class="hljs-property">message</span>, <span class="hljs-string">'error'</span>);
            }
        }
    );
}

<span class="hljs-comment">// 处理文章提交</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSubmitPost</span>(<span class="hljs-params">event, postId = <span class="hljs-literal">null</span></span>) {
    event.<span class="hljs-title function_">preventDefault</span>();
    
    <span class="hljs-keyword">const</span> title = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'postTitle'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
    <span class="hljs-keyword">const</span> author = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'postAuthor'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
    <span class="hljs-keyword">const</span> content = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'postContent'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
    
    <span class="hljs-keyword">if</span> (!title || !author || !content) {
        <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'请填写所有必填字段'</span>, <span class="hljs-string">'warning'</span>);
        <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-keyword">const</span> postData = {
        title,
        author,
        content
    };
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (postId) {
            <span class="hljs-comment">// 更新文章</span>
            <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">updatePost</span>(postId, postData);
            <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'文章更新成功'</span>, <span class="hljs-string">'success'</span>);
            <span class="hljs-title function_">showPage</span>(<span class="hljs-string">`view/<span class="hljs-subst">${postId}</span>`</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 创建新文章</span>
            <span class="hljs-keyword">const</span> newPost = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BlogAPI</span>.<span class="hljs-title function_">createPost</span>(postData);
            <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'文章发布成功'</span>, <span class="hljs-string">'success'</span>);
            <span class="hljs-title function_">showPage</span>(<span class="hljs-string">`view/<span class="hljs-subst">${newPost.id}</span>`</span>);
        }
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-title function_">showNotification</span>(<span class="hljs-string">'操作失败: '</span> + error.<span class="hljs-property">message</span>, <span class="hljs-string">'error'</span>);
    }
}

<span class="hljs-comment">// 添加CSS动画</span>
<span class="hljs-keyword">const</span> style = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'style'</span>);
style.<span class="hljs-property">textContent</span> = <span class="hljs-string">`
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
    
    .btn-sm {
        padding: 4px 8px;
        font-size: 0.8rem;
    }
`</span>;
<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span>.<span class="hljs-title function_">appendChild</span>(style);

</code></pre>
<blockquote>
<p>入前端目录 cd frontend
使用Python启动HTTP服务器
python -m http.server 3000</p>
</blockquote>
<h2 data-id="heading-11">Vue3 前端</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56a19fb1fd134afd8bdc7956f74a3d57~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGllcm9QQw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577038&amp;x-signature=U35wJE4ie8xK%2BejfrthSMugBJhA%3D" alt="image.png" loading="lazy"/></p>
<p>以下是一个完整的Vue 3 + Element Plus前端实现，与FastAPI后端配合使用：</p>
<h3 data-id="heading-12">项目结构</h3>
<pre><code class="hljs language-css" lang="css">frontend/
├── <span class="hljs-attribute">src</span>/
│   ├── components/
│   │   ├── BlogHeader<span class="hljs-selector-class">.vue</span>
│   │   └── BlogSidebar<span class="hljs-selector-class">.vue</span>
│   ├── views/
│   │   ├── HomeView<span class="hljs-selector-class">.vue</span>
│   │   ├── BlogList<span class="hljs-selector-class">.vue</span>
│   │   ├── BlogDetail<span class="hljs-selector-class">.vue</span>
│   │   ├── CreateBlog<span class="hljs-selector-class">.vue</span>
│   │   └── EditBlog<span class="hljs-selector-class">.vue</span>
│   ├── router/
│   │   └── index<span class="hljs-selector-class">.js</span>
│   ├── api/
│   │   └── blog<span class="hljs-selector-class">.js</span>
│   ├── App<span class="hljs-selector-class">.vue</span>
│   └── <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.js</span>
└── package<span class="hljs-selector-class">.json</span>
</code></pre>
<h3 data-id="heading-13">1. 安装依赖</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建Vue项目</span>
npm create vue@latest blog-frontend

<span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> blog-frontend

<span class="hljs-comment"># 安装Element Plus和axios</span>
npm install element-plus axios
npm install @element-plus/icons-vue
</code></pre>
<h3 data-id="heading-14">2. 主要文件代码</h3>
<h4 data-id="heading-15"><code>src/main.js</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementPlus</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'element-plus/dist/index.css'</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">ElementPlusIconsVue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@element-plus/icons-vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

<span class="hljs-comment">// 注册所有图标</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, component] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-title class_">ElementPlusIconsVue</span>)) {
  app.<span class="hljs-title function_">component</span>(key, component)
}

app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">createPinia</span>())
app.<span class="hljs-title function_">use</span>(router)
app.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">ElementPlus</span>)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h4 data-id="heading-16"><code>src/App.vue</code></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;el-container class="app-container"&gt;
      &lt;!-- 头部导航 --&gt;
      &lt;el-header class="app-header"&gt;
        &lt;div class="header-content"&gt;
          &lt;h1 class="logo"&gt;博客管理系统&lt;/h1&gt;
          &lt;div class="nav-links"&gt;
            &lt;router-link to="/" class="nav-link"&gt;
              &lt;el-icon&gt;&lt;HomeFilled /&gt;&lt;/el-icon&gt;
              首页
            &lt;/router-link&gt;
            &lt;router-link to="/blogs" class="nav-link"&gt;
              &lt;el-icon&gt;&lt;Document /&gt;&lt;/el-icon&gt;
              博客列表
            &lt;/router-link&gt;
            &lt;router-link to="/create" class="nav-link"&gt;
              &lt;el-icon&gt;&lt;Edit /&gt;&lt;/el-icon&gt;
              写文章
            &lt;/router-link&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/el-header&gt;

      &lt;!-- 主要内容 --&gt;
      &lt;el-main class="app-main"&gt;
        &lt;router-view /&gt;
      &lt;/el-main&gt;

      &lt;!-- 底部 --&gt;
      &lt;el-footer class="app-footer"&gt;
        &lt;div class="footer-content"&gt;
          &lt;p&gt;© 2024 博客管理系统 | Powered by Vue 3 + Element Plus + FastAPI&lt;/p&gt;
          &lt;p&gt;
            &lt;el-link href="http://localhost:8000/docs" target="_blank" type="info"&gt;
              API文档
            &lt;/el-link&gt;
          &lt;/p&gt;
        &lt;/div&gt;
      &lt;/el-footer&gt;
    &lt;/el-container&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { HomeFilled, Document, Edit } from '@element-plus/icons-vue'
&lt;/script&gt;

&lt;style scoped&gt;
.app-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.app-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

.logo {
  margin: 0;
  font-size: 24px;
  font-weight: 600;
}

.nav-links {
  display: flex;
  gap: 30px;
}

.nav-link {
  display: flex;
  align-items: center;
  gap: 5px;
  color: white;
  text-decoration: none;
  font-size: 16px;
  padding: 8px 16px;
  border-radius: 4px;
  transition: all 0.3s;
}

.nav-link:hover {
  background: rgba(255, 255, 255, 0.1);
}

.nav-link.router-link-active {
  background: rgba(255, 255, 255, 0.2);
}

.app-main {
  flex: 1;
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  width: 100%;
}

.app-footer {
  background: #f8f9fa;
  color: #666;
  border-top: 1px solid #e4e7ed;
}

.footer-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  text-align: center;
}

.footer-content p {
  margin: 5px 0;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-17"><code>src/router/index.js</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HomeView</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../views/HomeView.vue'</span>

<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'home'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-title class_">HomeView</span>
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/blogs'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'blogs'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/BlogList.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/blogs/:id'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'blog-detail'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/BlogDetail.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/create'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'create-blog'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/CreateBlog.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/edit/:id'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'edit-blog'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/EditBlog.vue'</span>)
  }
]

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(),
  routes
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router
</code></pre>
<h4 data-id="heading-18"><code>src/api/blog.js</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>

<span class="hljs-comment">// 创建axios实例</span>
<span class="hljs-keyword">const</span> api = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'http://localhost:8000/api'</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>
  }
})

<span class="hljs-comment">// 博客API</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> blogApi = {
  <span class="hljs-comment">// 获取所有博客</span>
  <span class="hljs-title function_">getAllBlogs</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/posts'</span>)
  },
  
  <span class="hljs-comment">// 获取单个博客</span>
  <span class="hljs-title function_">getBlogById</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">get</span>(<span class="hljs-string">`/posts/<span class="hljs-subst">${id}</span>`</span>)
  },
  
  <span class="hljs-comment">// 创建博客</span>
  <span class="hljs-title function_">createBlog</span>(<span class="hljs-params">blogData</span>) {
    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/posts'</span>, blogData)
  },
  
  <span class="hljs-comment">// 更新博客</span>
  <span class="hljs-title function_">updateBlog</span>(<span class="hljs-params">id, blogData</span>) {
    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">put</span>(<span class="hljs-string">`/posts/<span class="hljs-subst">${id}</span>`</span>, blogData)
  },
  
  <span class="hljs-comment">// 删除博客</span>
  <span class="hljs-title function_">deleteBlog</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">delete</span>(<span class="hljs-string">`/posts/<span class="hljs-subst">${id}</span>`</span>)
  }
}
</code></pre>
<h4 data-id="heading-19"><code>src/views/HomeView.vue</code></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="home"&gt;
    &lt;el-row :gutter="20"&gt;
      &lt;el-col :span="24"&gt;
        &lt;el-card class="welcome-card"&gt;
          &lt;template #header&gt;
            &lt;div class="card-header"&gt;
              &lt;h2&gt;欢迎使用博客管理系统&lt;/h2&gt;
            &lt;/div&gt;
          &lt;/template&gt;
          &lt;div class="welcome-content"&gt;
            &lt;el-icon class="welcome-icon"&gt;&lt;Reading /&gt;&lt;/el-icon&gt;
            &lt;p class="welcome-text"&gt;
              这是一个基于 Vue 3 + Element Plus + FastAPI 的完整博客管理系统。
              您可以浏览、创建、编辑和删除博客文章。
            &lt;/p&gt;
            &lt;div class="action-buttons"&gt;
              &lt;el-button 
                type="primary" 
                size="large" 
                @click="$router.push('/blogs')"
                class="action-button"
              &gt;
                &lt;el-icon&gt;&lt;List /&gt;&lt;/el-icon&gt;
                浏览博客
              &lt;/el-button&gt;
              &lt;el-button 
                type="success" 
                size="large" 
                @click="$router.push('/create')"
                class="action-button"
              &gt;
                &lt;el-icon&gt;&lt;Edit /&gt;&lt;/el-icon&gt;
                写新文章
              &lt;/el-button&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/el-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;

    &lt;el-row :gutter="20" class="features"&gt;
      &lt;el-col :xs="24" :sm="12" :md="8" v-for="feature in features" :key="feature.title"&gt;
        &lt;el-card class="feature-card"&gt;
          &lt;div class="feature-icon"&gt;
            &lt;component :is="feature.icon" /&gt;
          &lt;/div&gt;
          &lt;h3&gt;{{ feature.title }}&lt;/h3&gt;
          &lt;p&gt;{{ feature.description }}&lt;/p&gt;
        &lt;/el-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import { Reading, List, Edit, DataBoard, Setting, User } from '@element-plus/icons-vue'

const features = ref([
  {
    title: '简洁易用',
    description: '直观的用户界面，操作简单便捷',
    icon: 'Setting'
  },
  {
    title: '功能完整',
    description: '完整的CRUD操作，满足所有博客管理需求',
    icon: 'DataBoard'
  },
  {
    title: '响应式设计',
    description: '适配各种设备，提供良好的移动端体验',
    icon: 'User'
  }
])
&lt;/script&gt;

&lt;style scoped&gt;
.home {
  padding: 20px;
}

.welcome-card {
  margin-bottom: 30px;
  text-align: center;
  border: none;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.welcome-content {
  padding: 40px 20px;
}

.welcome-icon {
  font-size: 60px;
  color: #409EFF;
  margin-bottom: 20px;
}

.welcome-text {
  font-size: 18px;
  color: #666;
  margin-bottom: 30px;
  line-height: 1.6;
}

.action-buttons {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 30px;
}

.action-button {
  padding: 15px 30px;
}

.features {
  margin-top: 30px;
}

.feature-card {
  height: 100%;
  text-align: center;
  border: none;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s;
}

.feature-card:hover {
  transform: translateY(-5px);
}

.feature-icon {
  font-size: 40px;
  color: #67C23A;
  margin-bottom: 20px;
}

.feature-card h3 {
  margin: 10px 0;
  color: #333;
}

.feature-card p {
  color: #666;
  line-height: 1.5;
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-20"><code>src/views/BlogList.vue</code></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="blog-list"&gt;
    &lt;el-row :gutter="20"&gt;
      &lt;el-col :span="24"&gt;
        &lt;div class="page-header"&gt;
          &lt;h2&gt;博客文章&lt;/h2&gt;
          &lt;el-button 
            type="primary" 
            @click="$router.push('/create')"
            class="create-btn"
          &gt;
            &lt;el-icon&gt;&lt;Plus /&gt;&lt;/el-icon&gt;
            创建新文章
          &lt;/el-button&gt;
        &lt;/div&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;

    &lt;el-row :gutter="20" v-loading="loading"&gt;
      &lt;el-col 
        :xs="24" 
        :sm="12" 
        :lg="8" 
        v-for="blog in blogs" 
        :key="blog.id"
      &gt;
        &lt;el-card class="blog-card" shadow="hover"&gt;
          &lt;template #header&gt;
            &lt;div class="blog-header"&gt;
              &lt;h3 class="blog-title"&gt;{{ blog.title }}&lt;/h3&gt;
              &lt;el-tag type="info" size="small"&gt;
                {{ blog.author }}
              &lt;/el-tag&gt;
            &lt;/div&gt;
          &lt;/template&gt;
          
          &lt;div class="blog-content"&gt;
            &lt;p class="blog-excerpt"&gt;
              {{ truncateContent(blog.content) }}
            &lt;/p&gt;
            
            &lt;div class="blog-meta"&gt;
              &lt;div class="meta-item"&gt;
                &lt;el-icon&gt;&lt;Calendar /&gt;&lt;/el-icon&gt;
                &lt;span&gt;{{ formatDate(blog.created_at) }}&lt;/span&gt;
              &lt;/div&gt;
              &lt;div class="meta-item" v-if="blog.updated_at !== blog.created_at"&gt;
                &lt;el-icon&gt;&lt;Refresh /&gt;&lt;/el-icon&gt;
                &lt;span&gt;更新于 {{ formatDate(blog.updated_at) }}&lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          
          &lt;template #footer&gt;
            &lt;div class="blog-actions"&gt;
              &lt;el-button 
                type="primary" 
                size="small" 
                @click="viewBlog(blog.id)"
              &gt;
                &lt;el-icon&gt;&lt;View /&gt;&lt;/el-icon&gt;
                查看详情
              &lt;/el-button&gt;
              &lt;el-button 
                type="warning" 
                size="small" 
                @click="editBlog(blog.id)"
              &gt;
                &lt;el-icon&gt;&lt;Edit /&gt;&lt;/el-icon&gt;
                编辑
              &lt;/el-button&gt;
              &lt;el-button 
                type="danger" 
                size="small" 
                @click="confirmDelete(blog)"
              &gt;
                &lt;el-icon&gt;&lt;Delete /&gt;&lt;/el-icon&gt;
                删除
              &lt;/el-button&gt;
            &lt;/div&gt;
          &lt;/template&gt;
        &lt;/el-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;

    &lt;!-- 空状态 --&gt;
    &lt;el-empty 
      v-if="!loading &amp;&amp; blogs.length === 0" 
      description="暂无博客文章"
      class="empty-state"
    &gt;
      &lt;el-button type="primary" @click="$router.push('/create')"&gt;
        创建第一篇博客
      &lt;/el-button&gt;
    &lt;/el-empty&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage, ElMessageBox } from 'element-plus'
import { blogApi } from '../api/blog'
import { 
  Plus, 
  Calendar, 
  Refresh, 
  View, 
  Edit, 
  Delete 
} from '@element-plus/icons-vue'

const router = useRouter()
const blogs = ref([])
const loading = ref(false)

// 获取博客列表
const fetchBlogs = async () =&gt; {
  try {
    loading.value = true
    const response = await blogApi.getAllBlogs()
    blogs.value = response.data
  } catch (error) {
    ElMessage.error('获取博客列表失败：' + error.message)
  } finally {
    loading.value = false
  }
}

// 查看博客详情
const viewBlog = (id) =&gt; {
  router.push(`/blogs/${id}`)
}

// 编辑博客
const editBlog = (id) =&gt; {
  router.push(`/edit/${id}`)
}

// 确认删除
const confirmDelete = (blog) =&gt; {
  ElMessageBox.confirm(
    `确定要删除文章 "${blog.title}" 吗？`,
    '删除确认',
    {
      confirmButtonText: '确定删除',
      cancelButtonText: '取消',
      type: 'warning',
      center: true
    }
  ).then(async () =&gt; {
    try {
      await blogApi.deleteBlog(blog.id)
      ElMessage.success('文章删除成功')
      fetchBlogs() // 重新加载列表
    } catch (error) {
      ElMessage.error('删除失败：' + error.message)
    }
  }).catch(() =&gt; {
    // 用户取消
  })
}

// 截断内容
const truncateContent = (content, length = 100) =&gt; {
  if (content.length &lt;= length) return content
  return content.substring(0, length) + '...'
}

// 格式化日期
const formatDate = (dateString) =&gt; {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleDateString('zh-CN')
}

onMounted(() =&gt; {
  fetchBlogs()
})
&lt;/script&gt;

&lt;style scoped&gt;
.blog-list {
  padding: 20px;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.page-header h2 {
  margin: 0;
  color: #333;
}

.create-btn {
  padding: 10px 20px;
}

.blog-card {
  margin-bottom: 20px;
  height: 100%;
  transition: transform 0.3s;
}

.blog-card:hover {
  transform: translateY(-5px);
}

.blog-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.blog-title {
  margin: 0;
  font-size: 18px;
  color: #333;
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.blog-content {
  min-height: 120px;
}

.blog-excerpt {
  color: #666;
  line-height: 1.6;
  margin-bottom: 15px;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.blog-meta {
  display: flex;
  flex-direction: column;
  gap: 8px;
  font-size: 12px;
  color: #999;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.blog-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.empty-state {
  margin-top: 50px;
}

@media (max-width: 768px) {
  .page-header {
    flex-direction: column;
    align-items: stretch;
    gap: 15px;
  }
  
  .create-btn {
    width: 100%;
  }
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-21"><code>src/views/BlogDetail.vue</code></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="blog-detail"&gt;
    &lt;div v-if="loading" class="loading-container"&gt;
      &lt;el-skeleton :rows="10" animated /&gt;
    &lt;/div&gt;
    
    &lt;div v-else-if="blog" class="blog-content"&gt;
      &lt;!-- 返回按钮 --&gt;
      &lt;el-button 
        type="info" 
        @click="$router.back()" 
        class="back-btn"
      &gt;
        &lt;el-icon&gt;&lt;ArrowLeft /&gt;&lt;/el-icon&gt;
        返回列表
      &lt;/el-button&gt;
      
      &lt;!-- 博客内容 --&gt;
      &lt;el-card class="blog-card"&gt;
        &lt;template #header&gt;
          &lt;div class="blog-header"&gt;
            &lt;h1 class="blog-title"&gt;{{ blog.title }}&lt;/h1&gt;
            &lt;div class="blog-meta"&gt;
              &lt;el-tag type="primary" size="large"&gt;
                {{ blog.author }}
              &lt;/el-tag&gt;
              &lt;div class="meta-info"&gt;
                &lt;div class="meta-item"&gt;
                  &lt;el-icon&gt;&lt;Calendar /&gt;&lt;/el-icon&gt;
                  &lt;span&gt;发布于 {{ formatDateTime(blog.created_at) }}&lt;/span&gt;
                &lt;/div&gt;
                &lt;div class="meta-item" v-if="blog.updated_at !== blog.created_at"&gt;
                  &lt;el-icon&gt;&lt;Refresh /&gt;&lt;/el-icon&gt;
                  &lt;span&gt;更新于 {{ formatDateTime(blog.updated_at) }}&lt;/span&gt;
                &lt;/div&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/template&gt;
        
        &lt;div class="content-body"&gt;
          &lt;div class="content-text"&gt;
            &lt;p v-for="(paragraph, index) in contentParagraphs" 
               :key="index"
               class="paragraph"&gt;
              {{ paragraph }}
            &lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        
        &lt;template #footer&gt;
          &lt;div class="blog-actions"&gt;
            &lt;el-button-group&gt;
              &lt;el-button 
                type="primary" 
                @click="editBlog"
              &gt;
                &lt;el-icon&gt;&lt;Edit /&gt;&lt;/el-icon&gt;
                编辑文章
              &lt;/el-button&gt;
              &lt;el-button 
                type="danger" 
                @click="confirmDelete"
              &gt;
                &lt;el-icon&gt;&lt;Delete /&gt;&lt;/el-icon&gt;
                删除文章
              &lt;/el-button&gt;
            &lt;/el-button-group&gt;
          &lt;/div&gt;
        &lt;/template&gt;
      &lt;/el-card&gt;
    &lt;/div&gt;
    
    &lt;div v-else class="not-found"&gt;
      &lt;el-result
        icon="error"
        title="文章不存在"
        sub-title="您访问的文章可能已被删除或不存在"
      &gt;
        &lt;template #extra&gt;
          &lt;el-button type="primary" @click="$router.push('/blogs')"&gt;
            返回博客列表
          &lt;/el-button&gt;
        &lt;/template&gt;
      &lt;/el-result&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, onMounted, computed } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { ElMessage, ElMessageBox } from 'element-plus'
import { blogApi } from '../api/blog'
import { 
  ArrowLeft, 
  Calendar, 
  Refresh, 
  Edit, 
  Delete 
} from '@element-plus/icons-vue'

const route = useRoute()
const router = useRouter()
const blog = ref(null)
const loading = ref(true)

// 获取博客详情
const fetchBlog = async () =&gt; {
  try {
    loading.value = true
    const id = parseInt(route.params.id)
    const response = await blogApi.getBlogById(id)
    blog.value = response.data
  } catch (error) {
    ElMessage.error('获取博客详情失败：' + error.message)
    blog.value = null
  } finally {
    loading.value = false
  }
}

// 编辑博客
const editBlog = () =&gt; {
  router.push(`/edit/${blog.value.id}`)
}

// 确认删除
const confirmDelete = () =&gt; {
  ElMessageBox.confirm(
    `确定要删除文章 "${blog.value.title}" 吗？此操作不可恢复。`,
    '删除确认',
    {
      confirmButtonText: '确定删除',
      cancelButtonText: '取消',
      type: 'warning',
      center: true
    }
  ).then(async () =&gt; {
    try {
      await blogApi.deleteBlog(blog.value.id)
      ElMessage.success('文章删除成功')
      router.push('/blogs')
    } catch (error) {
      ElMessage.error('删除失败：' + error.message)
    }
  }).catch(() =&gt; {
    // 用户取消
  })
}

// 格式化日期时间
const formatDateTime = (dateString) =&gt; {
  if (!dateString) return ''
  const date = new Date(dateString)
  return date.toLocaleString('zh-CN')
}

// 将内容分割为段落
const contentParagraphs = computed(() =&gt; {
  if (!blog.value?.content) return []
  return blog.value.content.split('\n').filter(p =&gt; p.trim())
})

onMounted(() =&gt; {
  fetchBlog()
})
&lt;/script&gt;

&lt;style scoped&gt;
.blog-detail {
  padding: 20px;
  max-width: 900px;
  margin: 0 auto;
}

.loading-container {
  padding: 40px;
}

.back-btn {
  margin-bottom: 20px;
}

.blog-card {
  border: none;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.blog-header {
  padding-bottom: 20px;
  border-bottom: 1px solid #e4e7ed;
}

.blog-title {
  margin: 0 0 20px 0;
  font-size: 32px;
  color: #333;
  line-height: 1.3;
}

.blog-meta {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 15px;
}

.meta-info {
  display: flex;
  gap: 20px;
  font-size: 14px;
  color: #666;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 5px;
}

.content-body {
  padding: 30px 0;
}

.content-text {
  font-size: 16px;
  line-height: 1.8;
  color: #333;
}

.paragraph {
  margin-bottom: 20px;
  text-indent: 2em;
}

.paragraph:last-child {
  margin-bottom: 0;
}

.blog-actions {
  padding-top: 20px;
  border-top: 1px solid #e4e7ed;
  display: flex;
  justify-content: flex-end;
}

.not-found {
  padding: 100px 20px;
}

@media (max-width: 768px) {
  .blog-title {
    font-size: 24px;
  }
  
  .blog-meta {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .meta-info {
    flex-direction: column;
    gap: 10px;
  }
  
  .content-body {
    padding: 20px 0;
  }
  
  .content-text {
    font-size: 15px;
  }
}
&lt;/style&gt;
</code></pre>
<h4 data-id="heading-22"><code>src/views/CreateBlog.vue</code> 和 <code>src/views/EditBlog.vue</code></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="blog-editor"&gt;
    &lt;el-page-header 
      @back="$router.back()" 
      :content="isEditMode ? '编辑文章' : '创建新文章'"
      class="page-header"
    /&gt;
    
    &lt;el-card class="editor-card"&gt;
      &lt;template #header&gt;
        &lt;h3&gt;{{ isEditMode ? '编辑文章' : '写新文章' }}&lt;/h3&gt;
      &lt;/template&gt;
      
      &lt;el-form 
        ref="formRef" 
        :model="form" 
        :rules="rules" 
        label-width="80px"
        class="blog-form"
      &gt;
        &lt;el-form-item label="文章标题" prop="title"&gt;
          &lt;el-input 
            v-model="form.title" 
            placeholder="请输入文章标题" 
            size="large"
            clearable
          /&gt;
        &lt;/el-form-item&gt;
        
        &lt;el-form-item label="作者" prop="author"&gt;
          &lt;el-input 
            v-model="form.author" 
            placeholder="请输入作者姓名" 
            size="large"
            clearable
          /&gt;
        &lt;/el-form-item&gt;
        
        &lt;el-form-item label="文章内容" prop="content"&gt;
          &lt;el-input
            v-model="form.content"
            type="textarea"
            :rows="15"
            placeholder="请输入文章内容，支持 Markdown 格式..."
            resize="none"
          /&gt;
          &lt;div class="editor-tips"&gt;
            &lt;el-tag type="info" size="small"&gt;
              &lt;el-icon&gt;&lt;InfoFilled /&gt;&lt;/el-icon&gt;
              提示：您可以使用 Markdown 语法格式化文本
            &lt;/el-tag&gt;
          &lt;/div&gt;
        &lt;/el-form-item&gt;
        
        &lt;el-form-item&gt;
          &lt;el-button 
            type="primary" 
            @click="submitForm" 
            :loading="submitting"
            size="large"
            class="submit-btn"
          &gt;
            {{ isEditMode ? '更新文章' : '发布文章' }}
          &lt;/el-button&gt;
          &lt;el-button 
            @click="$router.back()" 
            size="large"
          &gt;
            取消
          &lt;/el-button&gt;
        &lt;/el-form-item&gt;
      &lt;/el-form&gt;
    &lt;/el-card&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, reactive, onMounted } from 'vue'
import { useRoute, useRouter } from 'vue-router'
import { ElMessage } from 'element-plus'
import { blogApi } from '../api/blog'
import { InfoFilled } from '@element-plus/icons-vue'

const route = useRoute()
const router = useRouter()
const formRef = ref(null)
const submitting = ref(false)

// 判断是否为编辑模式
const isEditMode = route.name === 'edit-blog'

// 表单数据
const form = reactive({
  title: '',
  author: '',
  content: ''
})

// 表单验证规则
const rules = {
  title: [
    { required: true, message: '请输入文章标题', trigger: 'blur' },
    { min: 3, message: '标题长度至少 3 个字符', trigger: 'blur' },
    { max: 100, message: '标题长度不能超过 100 个字符', trigger: 'blur' }
  ],
  author: [
    { required: true, message: '请输入作者姓名', trigger: 'blur' },
    { min: 2, message: '作者姓名至少 2 个字符', trigger: 'blur' },
    { max: 50, message: '作者姓名不能超过 50 个字符', trigger: 'blur' }
  ],
  content: [
    { required: true, message: '请输入文章内容', trigger: 'blur' },
    { min: 10, message: '文章内容至少 10 个字符', trigger: 'blur' }
  ]
}

// 编辑模式下加载数据
const loadBlogData = async () =&gt; {
  if (!isEditMode) return
  
  try {
    const id = parseInt(route.params.id)
    const response = await blogApi.getBlogById(id)
    const blog = response.data
    
    form.title = blog.title
    form.author = blog.author
    form.content = blog.content
  } catch (error) {
    ElMessage.error('加载文章失败：' + error.message)
    router.push('/blogs')
  }
}

// 提交表单
const submitForm = async () =&gt; {
  if (!formRef.value) return
  
  try {
    await formRef.value.validate()
    submitting.value = true
    
    if (isEditMode) {
      const id = parseInt(route.params.id)
      await blogApi.updateBlog(id, {
        ...form
      })
      ElMessage.success('文章更新成功')
    } else {
      await blogApi.createBlog({
        ...form
      })
      ElMessage.success('文章创建成功')
    }
    
    router.push('/blogs')
  } catch (error) {
    if (error.name !== 'ValidationError') {
      ElMessage.error(isEditMode ? '更新失败：' + error.message : '创建失败：' + error.message)
    }
  } finally {
    submitting.value = false
  }
}

onMounted(() =&gt; {
  loadBlogData()
})
&lt;/script&gt;

&lt;style scoped&gt;
.blog-editor {
  padding: 20px;
  max-width: 800px;
  margin: 0 auto;
}

.page-header {
  margin-bottom: 20px;
}

.editor-card {
  border: none;
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
}

.editor-card :deep(.el-card__header) {
  border-bottom: 1px solid #e4e7ed;
  padding: 20px;
}

.editor-card h3 {
  margin: 0;
  color: #333;
  font-size: 18px;
}

.blog-form {
  padding: 10px;
}

.editor-tips {
  margin-top: 10px;
}

.submit-btn {
  min-width: 120px;
}

@media (max-width: 768px) {
  .blog-editor {
    padding: 10px;
  }
  
  .editor-card {
    margin: 0 -10px;
  }
}
&lt;/style&gt;
</code></pre>
<h3 data-id="heading-23">3. 运行说明</h3>
<ol>
<li><strong>启动后端服务</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> backend
python main.py
<span class="hljs-comment"># 后端将在 http://localhost:8000 运行</span>
</code></pre>
<ol start="2">
<li><strong>启动前端服务</strong>：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> frontend
npm run dev
<span class="hljs-comment"># 前端将在 http://localhost:5173 运行</span>
</code></pre>
<ol start="3">
<li><strong>配置跨域</strong>：后端代码中已经配置了CORS，允许所有源访问。</li>
</ol>
<h3 data-id="heading-24">4. 功能特点</h3>
<ol>
<li><strong>响应式设计</strong>：适配桌面端和移动端</li>
<li><strong>完整CRUD操作</strong>：
<ul>
<li>创建博客文章</li>
<li>查看博客列表</li>
<li>查看博客详情</li>
<li>编辑博客文章</li>
<li>删除博客文章</li>
</ul>
</li>
<li><strong>用户体验优化</strong>：
<ul>
<li>加载状态指示</li>
<li>操作确认对话框</li>
<li>表单验证</li>
<li>错误处理</li>
</ul>
</li>
<li><strong>美观的UI</strong>：使用Element Plus组件，现代化设计</li>
<li><strong>API集成</strong>：与FastAPI后端无缝集成</li>
</ol>
<p>这个前端应用提供了一个完整的博客管理界面，用户可以方便地管理博客文章，所有操作都会通过API与后端交互。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vavr 用户指南]]></title>    <link>https://juejin.cn/post/7593215107405430820</link>    <guid>https://juejin.cn/post/7593215107405430820</guid>    <pubDate>2026-01-09T15:31:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593215107405430820" data-draft-id="7592990758476906515" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vavr 用户指南"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2026-01-09T15:31:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SnrtIevg"/> <meta itemprop="url" content="https://juejin.cn/user/3087084381015342"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vavr 用户指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3087084381015342/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SnrtIevg
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:31:31.000Z" title="Fri Jan 09 2026 15:31:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读26分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>Daniel Dietrich, Robert Winkler, Grzegorz Piwowarek</strong><br/>
<strong>版本 0.11.0，</strong><br/>
<strong>2025-12-16</strong></p>
<h2 data-id="heading-0">1. 引言</h2>
<p>Vavr（原名 Javaslang）是一个用于 Java 8+ 的函数式库，提供持久化数据类型和函数式控制结构。</p>
<h3 data-id="heading-1">1.1. 在 Java 8 中使用 Vavr 的函数式数据结构</h3>
<p>Java 8 的 lambda（λ）使我们能够创建出色的 API。它们极大地提高了语言的表达能力。</p>
<p>Vavr 利用 lambda 基于函数式模式创建了各种新特性。其中之一是一个旨在替代 Java 标准集合的函数式集合库。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66b1565166ce46409c5fc0e4d83ab8e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU25ydElldmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577746&amp;x-signature=9cTvHyecu94bZfZrCYfkypHjL8o%3D" alt="这只是一个鸟瞰图，你会在下面找到一个人类可读的版本" loading="lazy"/></p>
<h3 data-id="heading-2">1.2. 函数式编程</h3>
<p>在我们深入探讨数据结构的细节之前，我想先谈谈一些基础知识。这将清楚地说明我为什么创建 Vavr，特别是新的 Java 集合。</p>
<h4 data-id="heading-3">1.2.1. 副作用</h4>
<p>Java 应用程序通常充满了副作用。它们会改变某种状态，也许是外部世界。常见的副作用包括就地更改对象或变量、打印到控制台、写入日志文件或数据库。如果副作用以不良方式影响我们程序的语义，则被认为是有害的。</p>
<p>例如，如果一个函数抛出异常并且这个异常被解释，它就被认为是一个影响我们程序的副作用。此外，异常就像非局部的 goto 语句。它们破坏了正常的控制流。然而，现实世界的应用程序确实会执行副作用。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">int</span> <span class="hljs-title function_">divide</span><span class="hljs-params">(<span class="hljs-type">int</span> dividend, <span class="hljs-type">int</span> divisor)</span> {    
	<span class="hljs-comment">// 如果除数为零则抛出异常    </span>
	<span class="hljs-keyword">return</span> dividend / divisor;
}
</code></pre>
<p>在函数式环境中，我们处于有利地位，可以将副作用封装在 <code>Try</code> 中：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = Success(result) 或 Failure(exception)</span>
Try&lt;Integer&gt; <span class="hljs-title function_">divide</span><span class="hljs-params">(Integer dividend, Integer divisor)</span> {    
	<span class="hljs-keyword">return</span> Try.of(() -&gt; dividend / divisor);
}
</code></pre>
<p>这个版本的 <code>divide</code> 不再抛出任何异常。我们通过使用 <code>Try</code> 类型使可能的失败变得明确。</p>
<h4 data-id="heading-4">1.2.2. 引用透明性</h4>
<p>如果一个函数，或者更一般地说，一个表达式，其调用可以被其值替换而不影响程序的行为，则称其为引用透明的。简单来说，给定相同的输入，输出总是相同的。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 不是引用透明的</span>
Math.random();
<span class="hljs-comment">// 引用透明的</span>
Math.max(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
</code></pre>
<p>如果所有涉及的表达式都是引用透明的，则称该函数为纯函数。由纯函数组成的应用程序很可能在编译后就能正常工作。我们能够推理它。单元测试易于编写，调试成为过去式。</p>
<h4 data-id="heading-5">1.2.3. 值编程思想</h4>
<p>Rich Hickey，Clojure 的创造者，做了一个关于《值的价值》的精彩演讲。最有趣的值是不可变值。主要原因是不可变值：</p>
<ul>
<li>本质上是线程安全的，因此不需要同步</li>
<li>在 <code>equals</code> 和 <code>hashCode</code> 方面是稳定的，因此是可靠的哈希键</li>
<li>不需要克隆</li>
<li>在未检查的协变转换中使用时表现类型安全（Java 特有）</li>
</ul>
<p>更好的 Java 的关键在于使用不可变值并结合引用透明的函数。
Vavr 提供了必要的控制和集合，以在日常 Java 编程中实现这一目标。</p>
<h3 data-id="heading-6">1.3. 数据结构概述</h3>
<p>Vavr 的集合库包含一套丰富的基于 lambda 构建的函数式数据结构。它们与 Java 原始集合共享的唯一接口是 <code>Iterable</code>。主要原因是 Java 集合接口的修改器方法不返回底层集合类型的对象。</p>
<p>通过查看不同类型的数据结构，我们将明白为什么这一点如此重要。</p>
<h4 data-id="heading-7">1.3.1. 可变数据结构</h4>
<p>Java 是一种面向对象的编程语言。我们将状态封装在对象中以实现数据隐藏，并提供修改器方法来控制状态。Java 集合框架（JCF）就是建立在这个思想之上的。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Collection</span>&lt;E&gt; {    
	<span class="hljs-comment">// 从此集合中移除所有元素    </span>
	<span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span>;
}
</code></pre>
<p>如今，我将 <code>void</code> 返回类型视为一种代码异味。它表明发生了副作用，状态被改变了。共享的可变状态是失败的重要来源，不仅是在并发环境中。</p>
<h4 data-id="heading-8">1.3.2. 不可变数据结构</h4>
<p>不可变数据结构在创建后不能被修改。在 Java 的上下文中，它们以集合包装器的形式被广泛使用。</p>
<pre><code class="hljs language-Java" lang="Java">List&lt;String&gt; list = Collections.unmodifiableList(otherList);
<span class="hljs-comment">// 报错！list.add("why not?");</span>
</code></pre>
<p>有各种库为我们提供了类似的工具方法。结果始终是特定集合的不可修改视图。通常，当我们调用修改器方法时，它会在运行时抛出异常。</p>
<h4 data-id="heading-9">1.3.3. 持久化数据结构</h4>
<p>持久化数据结构在修改时会保留自身的先前版本，因此实际上是<strong>不可变的</strong>。完全持久化数据结构允许对任何版本进行更新和查询。</p>
<p>许多操作只进行小的更改。仅仅复制前一个版本效率不高。为了节省时间和内存，识别两个版本之间的相似性并尽可能共享数据至关重要。</p>
<p>这个模型没有强加任何实现细节。这时函数式数据结构就登场了。</p>
<h3 data-id="heading-10">1.4. 函数式数据结构</h3>
<p>也称为纯函数式数据结构，它们是不可变且持久的。函数式数据结构的方法是引用透明的。</p>
<p>Vavr 提供了最常用的函数式数据结构。以下示例将深入解释。</p>
<h4 data-id="heading-11">1.4.1. 链表</h4>
<p>最流行也是最简单的函数式数据结构之一是（单向）链表。它有一个头元素和一个尾链表。链表的行为类似于遵循后进先出（LIFO）方法的栈。</p>
<p>在 Vavr 中，我们这样实例化一个 <code>List</code>：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = List(1, 2, 3)</span>
List&lt;Integer&gt; list1 = List.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
</code></pre>
<p>每个 <code>List</code> 元素形成一个单独的链表节点。最后一个元素的尾部是 <code>Nil</code>，即空列表。
这使我们能够在 <code>List</code> 的不同版本之间共享元素。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = List(0, 2, 3)List&lt;Integer&gt; </span>
list2 = list1.tail().prepend(<span class="hljs-number">0</span>);
</code></pre>
<p>新的头元素 <code>0</code> 链接到原始 <code>List</code> 的尾部。原始 <code>List</code> 保持不变。</p>
<p>这些操作在常数时间内完成，换句话说，它们与 <code>List</code> 的大小无关。大多数其他操作需要线性时间。在 Vavr 中，这通过接口 <code>LinearSeq</code> 表示，我们可能已经从 Scala 中了解它。</p>
<p>如果我们需要在常数时间内可查询的数据结构，Vavr 提供了 <code>Array</code> 和 <code>Vector</code>。两者都具有随机访问能力。</p>
<p><code>Array</code> 类型由 Java 对象数组支持。插入和删除操作需要线性时间。<code>Vector</code> 介于 <code>Array</code> 和 <code>List</code> 之间。它在随机访问和修改两个领域都表现良好。</p>
<p>事实上，链表也可以用来实现队列数据结构。</p>
<h4 data-id="heading-12">1.4.2. 队列</h4>
<p>基于两个链表可以实现一个非常高效的函数式队列。前 <code>List</code> 保存要出列的元素，后 <code>List</code> 保存要入列的元素。入列和出列操作都在 O(1) 时间内执行。</p>
<pre><code class="hljs language-Java" lang="Java">Queue&lt;Integer&gt; queue = Queue.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
							.enqueue(<span class="hljs-number">4</span>)
							.enqueue(<span class="hljs-number">5</span>);
</code></pre>
<p>初始队列由三个元素创建。两个元素被入列到后 <code>List</code>。
如果出列时前 <code>List</code> 的元素用完，后 <code>List</code> 会被反转并成为新的前 <code>List</code>。
出列一个元素时，我们得到第一个元素和剩余队列的配对。必须返回队列的新版本，因为函数式数据结构是不可变且持久的。原始队列不受影响。</p>
<pre><code class="hljs language-Java" lang="Java">Queue&lt;Integer&gt; queue = Queue.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
<span class="hljs-comment">// = (1, Queue(2, 3))</span>
Tuple2&lt;Integer, Queue&lt;Integer&gt;&gt; dequeued = queue.dequeue();
</code></pre>
<p>当队列为空时会发生什么？那么 <code>dequeue()</code> 将抛出 <code>NoSuchElementException</code>。要以函数式的方式处理，我们更希望得到一个可选结果。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = Some((1, Queue()))</span>
Queue.of(<span class="hljs-number">1</span>).dequeueOption();
<span class="hljs-comment">// = None</span>
Queue.empty().dequeueOption();
</code></pre>
<p>无论是否为空，可选结果都可以被进一步处理。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = Queue(1)</span>
Queue&lt;Integer&gt; queue = Queue.of(<span class="hljs-number">1</span>);
<span class="hljs-comment">// = Some((1, Queue()))</span>
Option&lt;Tuple2&lt;Integer, Queue&lt;Integer&gt;&gt;&gt; dequeued = queue.dequeueOption();
<span class="hljs-comment">// = Some(1)</span>
Option&lt;Integer&gt; element = dequeued.map(Tuple2::_1);
<span class="hljs-comment">// = Some(Queue())</span>
Option&lt;Queue&lt;Integer&gt;&gt; remaining = dequeued.map(Tuple2::_2);
</code></pre>
<h4 data-id="heading-13">1.4.3. 有序集合</h4>
<p>有序集合是比队列更常用的数据结构。我们使用二叉搜索树以函数式方式对它们进行建模。这些树由最多有两个子节点的节点组成，每个节点都有值。</p>
<p>我们在存在排序的情况下构建二叉搜索树，由元素 <code>Comparator</code> 表示。任何给定节点的左子树的所有值都严格小于给定节点的值。右子树的所有值都严格大于。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = TreeSet(1, 2, 3, 4, 6, 7, 8)</span>
SortedSet&lt;Integer&gt; xs = TreeSet.of(<span class="hljs-number">6</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>);
</code></pre>
<p>在此类树上的搜索在 O(log n) 时间内运行。我们从根开始搜索，决定是否找到了元素。由于值的全序性，我们知道接下来要在哪里搜索，在当前树的左分支还是右分支。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = TreeSet(1, 2, 3);</span>
SortedSet&lt;Integer&gt; set = TreeSet.of(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
<span class="hljs-comment">// = TreeSet(3, 2, 1);</span>
Comparator&lt;Integer&gt; c = (a, b) -&gt; b - a;
SortedSet&lt;Integer&gt; reversed = TreeSet.of(c, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
</code></pre>
<p>大多数树操作本质上是递归的。插入函数的行为类似于搜索函数。当到达搜索路径的末端时，会创建一个新节点，并重建整个路径直到根节点。尽可能引用现有的子节点。因此，插入操作需要 O(log n) 的时间和空间。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = TreeSet(1, 2, 3, 4, 5, 6, 7, 8)</span>
SortedSet&lt;Integer&gt; ys = xs.add(<span class="hljs-number">5</span>);
</code></pre>
<p>为了保持二叉搜索树的性能特征，需要保持其平衡。从根到叶子的所有路径需要大致相同的长度。</p>
<p>在 Vavr 中，我们基于红黑树实现了一个二叉搜索树。它使用特定的着色策略来在插入和删除时保持树的平衡。要了解更多关于这个主题的信息，请参阅 Chris Okasaki 的《纯函数式数据结构》一书。</p>
<h3 data-id="heading-14">1.5. 集合的现状</h3>
<p>总的来说，我们观察到编程语言正在趋同。好的特性得以保留，其他的则消失。但 Java 不同，它永远需要向后兼容。这是一种优势，但也减缓了进化。</p>
<p>Lambda 使 Java 和 Scala 更加接近，但它们仍然如此不同。Scala 的创造者 Martin Odersky 最近在他 2015 年的 BDSBTB 主题演讲中提到了 Java 8 集合的现状。</p>
<p>他将 Java 的 <code>Stream</code> 描述为 <code>Iterator</code> 的一种高级形式。Java 8 Stream API 是<strong>提升集合</strong>的一个例子。它的作用是定义一个计算，并在另一个明确的步骤中将其链接到特定的集合。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// i + 1</span>
i.prepareForAddition()
	.add(<span class="hljs-number">1</span>)
	.mapBackToInteger(Mappers.toInteger())
</code></pre>
<p>这就是新的 Java 8 Stream API 的工作方式。它是众所周知的 Java 集合之上的一个计算层。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = ["1", "2", "3"] in Java 8</span>
Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
	.stream()
	.map(Object::toString)
	.collect(Collectors.toList())
</code></pre>
<p>Vavr 深受 <code>Scala</code> 的启发。这应该是 Java 8 中上述例子的样子。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = Stream("1", "2", "3") in Vavr</span>
Stream.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).map(Object::toString)
</code></pre>
<p>在过去的一年里，我们投入了大量精力来实现 Vavr 集合库。它包含了最广泛使用的集合类型。</p>
<h4 data-id="heading-15">1.5.1. Seq</h4>
<p>我们通过实现顺序类型开始了我们的旅程。上面我们已经描述了链表。接着是 <code>Stream</code>，一个惰性链表。它允许我们处理可能无限长的元素序列。</p>
<p>所有集合都是 <code>Iterable</code> 的，因此可以在增强的 for 语句中使用。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">for</span> (String s : List.of(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Advent"</span>)) {    
	<span class="hljs-comment">// 副作用和突变</span>
}
</code></pre>
<p>我们也可以通过内化循环并使用 lambda 注入行为来实现同样的效果。</p>
<pre><code class="hljs language-Java" lang="Java">List.of(<span class="hljs-string">"Java"</span>, <span class="hljs-string">"Advent"</span>).forEach(s -&gt; {    
	<span class="hljs-comment">// 副作用和突变</span>
});
</code></pre>
<p>无论如何，正如我们之前看到的，我们更喜欢返回值的表达式，而不是什么都不返回的语句。通过看一个简单的例子，我们很快就会发现语句增加了噪音，并分割了本应在一起的东西。</p>
<pre><code class="hljs language-Java" lang="Java">String <span class="hljs-title function_">join</span><span class="hljs-params">(String... words)</span> {
	<span class="hljs-type">StringBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
	<span class="hljs-keyword">for</span>(String s : words) {
		<span class="hljs-keyword">if</span> (builder.length() &gt; <span class="hljs-number">0</span>) {
			builder.append(<span class="hljs-string">", "</span>);
		}
		builder.append(s);
	}
	<span class="hljs-keyword">return</span> builder.toString();
}
</code></pre>
<p>Vavr 集合为我们提供了许多函数来操作底层元素。这使我们能够以非常简洁的方式表达事物。</p>
<pre><code class="hljs language-Java" lang="Java">String <span class="hljs-title function_">join</span><span class="hljs-params">(String... words)</span> {
	<span class="hljs-keyword">return</span> List.of(words)
			.intersperse(<span class="hljs-string">", "</span>)
			.foldLeft(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(), StringBuilder::append)
			.toString();
}
</code></pre>
<p>大多数目标都可以使用 Vavr 以各种方式实现。在这里，我们将整个方法体简化为对 <code>List</code> 实例的流畅函数调用。我们甚至可以删除整个方法，直接使用我们的 <code>List</code> 来获取计算结果。</p>
<pre><code class="hljs language-Java" lang="Java">List.of(words).mkString(<span class="hljs-string">", "</span>);
</code></pre>
<p>在现实世界的应用程序中，我们现在能够大幅减少代码行数，从而降低错误风险。</p>
<h4 data-id="heading-16">1.5.2. Set 和 Map</h4>
<p>序列很棒。但为了完整，一个集合库还需要不同类型的 <code>Set</code> 和 <code>Map</code>。</p>
<p>我们描述了如何使用二叉树结构来建模有序集合。有序 <code>Map</code> 不过是一个包含键值对并对键有排序的有序 <code>Set</code>。</p>
<p><code>HashMap</code> 的实现由哈希数组映射字典树（HAMT）支持。相应地，<code>HashSet</code> 由包含键-键对的 HAMT 支持。</p>
<p>我们的 <code>Map</code> 没有特殊的 <code>Entry</code> 类型来表示键值对。相反，我们使用已经是 Vavr 一部分的 <code>Tuple2</code>。元组的字段是枚举的。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = (1, "A")</span>
Tuple2&lt;Integer, String&gt; entry = Tuple.of(<span class="hljs-number">1</span>, <span class="hljs-string">"A"</span>);
<span class="hljs-type">Integer</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> entry._1;
<span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> entry._2;
</code></pre>
<p><code>Map</code> 和 <code>Tuple</code> 在 Vavr 中被广泛使用。<code>Tuple</code> 对于以通用方式处理多值返回类型是必不可少的。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// = HashMap((0, List(2, 4)), (1, List(1, 3)))</span>
List.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>).groupBy(i -&gt; i % <span class="hljs-number">2</span>);
<span class="hljs-comment">// = List((a, 0), (b, 1), (c, 2))</span>
List.of(<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>).zipWithIndex();
</code></pre>
<p>在 Vavr，我们通过实现 99 个欧拉问题来探索和测试我们的库。这是一个很好的概念验证。请不要犹豫发送拉取请求。</p>
<h2 data-id="heading-17">3. 使用指南</h2>
<p>Vavr 附带了一些最基本类型的精心设计的表示，这些类型在 Java 中显然缺失或简陋：<code>Tuple</code>、<code>Value</code> 和 <code>λ</code>。
在 Vavr 中，一切都建立在这三个基本构建块之上。</p>
<h3 data-id="heading-18">3.1. 元组</h3>
<p>Java 缺少元组的一般概念。元组将固定数量的元素组合在一起，以便它们可以作为一个整体传递。与数组或列表不同，元组可以容纳不同类型的对象，但它们也是不可变的。</p>
<p>元组的类型是 <code>Tuple1</code>、<code>Tuple2</code>、<code>Tuple3</code> 等等。
目前最多有 8 个元素的上限。要访问元组 <code>t</code> 的元素，可以使用方法 <code>t._1</code> 访问第一个元素，<code>t._2</code> 访问第二个，依此类推。</p>
<h4 data-id="heading-19">3.1.1. 创建元组</h4>
<p>以下是如何创建一个包含 <code>String</code> 和 <code>Integer</code> 的元组的示例：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// (Java, 8)</span>
Tuple2&lt;String, Integer&gt; java8 = Tuple.of(<span class="hljs-string">"Java"</span>, <span class="hljs-number">8</span>); 
<span class="hljs-comment">// "Java"</span>
<span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> java8._1; 
<span class="hljs-comment">// 8</span>
<span class="hljs-type">Integer</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> java8._2; 
</code></pre>
<p>元组是通过静态工厂方法 <code>Tuple.of()</code> 创建的。获取此元组的第 1 个元素。获取此元组的第 2 个元素。</p>
<h4 data-id="heading-20">3.1.2. 按组件映射元组</h4>
<p>按组件映射对元组中的每个元素求值一个函数，返回另一个元组。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// (vavr, 1)</span>
Tuple2&lt;String, Integer&gt; that = java8.map(
	s -&gt; s.substring(<span class="hljs-number">2</span>) + <span class="hljs-string">"vr"</span>,
	i -&gt; i / <span class="hljs-number">8</span>
);
</code></pre>
<h4 data-id="heading-21">3.1.3. 使用单个映射器映射元组</h4>
<p>也可以使用一个映射函数来映射元组。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// (vavr, 1)</span>
Tuple2&lt;String, Integer&gt; that = java8.map(
	(s, i) -&gt; Tuple.of(s.substring(<span class="hljs-number">2</span>) + <span class="hljs-string">"vr"</span>, i / <span class="hljs-number">8</span>)
);
</code></pre>
<h4 data-id="heading-22">3.1.4. 转换元组</h4>
<p>转换基于元组的内容创建一个新类型。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// "vavr 1"</span>
<span class="hljs-type">String</span> <span class="hljs-variable">that</span> <span class="hljs-operator">=</span> java8.apply(
	(s, i) -&gt; s.substring(<span class="hljs-number">2</span>) + <span class="hljs-string">"vr "</span> + i / <span class="hljs-number">8</span>
);
</code></pre>
<h3 data-id="heading-23">3.2. 函数</h3>
<p>函数式编程就是关于值和使用函数对值进行转换。Java 8 只提供了一个接受一个参数的 <code>Function</code> 和一个接受两个参数的 <code>BiFunction</code>。
Vavr 提供了最多 8 个参数的函数。函数式接口称为 <code>Function0</code>、<code>Function1</code>、<code>Function2</code>、<code>Function3</code> 等等。
如果你需要一个抛出受检异常的函数，可以使用 <code>CheckedFunction1</code>、<code>CheckedFunction2</code> 等等。</p>
<p>以下 <code>lambda</code> 表达式创建一个函数来对两个整数求和：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// sum.apply(1, 2) = 3</span>
Function2&lt;Integer, Integer, Integer&gt; sum = (a, b) -&gt; a + b;
</code></pre>
<p>这是以下匿名类定义的简写：</p>
<pre><code class="hljs language-java" lang="java">Function2&lt;Integer, Integer, Integer&gt; sum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Function2</span>&lt;Integer, Integer, Integer&gt;() {
	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">apply</span><span class="hljs-params">(Integer a, Integer b)</span> {
		<span class="hljs-keyword">return</span> a + b;    
	}
};
</code></pre>
<p>你也可以使用静态工厂方法 <code>Function3.of(…)</code> 从任何方法引用创建函数。</p>
<pre><code class="hljs language-Java" lang="Java">Function3&lt;String, String, String, String&gt; function3 = Function3.of(<span class="hljs-built_in">this</span>::methodWhichAccepts3Parameters);
</code></pre>
<p>事实上，Vavr 函数式接口是增强版的 Java 8 函数式接口。它们还提供以下特性：</p>
<ul>
<li>组合</li>
<li>提升</li>
<li>柯里化</li>
<li>记忆化</li>
</ul>
<h4 data-id="heading-24">3.2.1. 组合</h4>
<p>你可以组合函数。在数学中，函数组合是将一个函数应用于另一个函数的结果以产生第三个函数。例如，函数<code> f : X → Y</code> 和 <code>g : Y → Z</code> 可以组合产生一个函数<code> h: g(f(x))</code>，它将 X 映射到 Z。</p>
<p>你可以使用 <code>andThen</code>：</p>
<pre><code class="hljs language-java" lang="java">Function1&lt;Integer, Integer&gt; plusOne = a -&gt; a + <span class="hljs-number">1</span>;
Function1&lt;Integer, Integer&gt; multiplyByTwo = a -&gt; a * <span class="hljs-number">2</span>;
Function1&lt;Integer, Integer&gt; add1AndMultiplyBy2 = plusOne.andThen(multiplyByTwo);
then(add1AndMultiplyBy2.apply(<span class="hljs-number">2</span>)).isEqualTo(<span class="hljs-number">6</span>);
</code></pre>
<p>或者 <code>compose</code>：</p>
<pre><code class="hljs language-Java" lang="Java">Function1&lt;Integer, Integer&gt; add1AndMultiplyBy2 = multiplyByTwo.compose(plusOne);
then(add1AndMultiplyBy2.apply(<span class="hljs-number">2</span>)).isEqualTo(<span class="hljs-number">6</span>);
</code></pre>
<h4 data-id="heading-25">3.2.2. 提升</h4>
<p>你可以将一个部分函数提升为一个返回 <code>Option</code> 结果的总函数。术语“部分函数”来自数学。从 X 到 Y 的部分函数是函数 f: X′ → Y，其中 X′ 是 X 的某个子集。它通过不强制 f 将 X 的每个元素映射到 Y 的元素来推广函数 f: X → Y 的概念。这意味着部分函数仅对某些输入值正常工作。如果使用不允许的输入值调用该函数，它通常会抛出异常。</p>
<p>以下方法 <code>divide</code> 是一个只接受非零除数的部分函数。</p>
<pre><code class="hljs language-java" lang="java">Function2&lt;Integer, Integer, Integer&gt; divide = (a, b) -&gt; a / b;
</code></pre>
<p>我们使用 <code>lift</code> 将 <code>divide</code> 转换为一个对所有输入都有定义的总函数。</p>
<pre><code class="hljs language-Java" lang="Java">Function2&lt;Integer, Integer, Option&lt;Integer&gt;&gt; safeDivide = Function2.lift(divide);
<span class="hljs-comment">// = None</span>
Option&lt;Integer&gt; i1 = safeDivide.apply(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>); 
<span class="hljs-comment">// = Some(2)</span>
Option&lt;Integer&gt; i2 = safeDivide.apply(<span class="hljs-number">4</span>, <span class="hljs-number">2</span>); 
</code></pre>
<p>如果使用不允许的输入值调用提升函数，则返回 <code>None</code> 而不是抛出异常。如果使用允许的输入值调用提升函数，则返回 <code>Some</code>。</p>
<p>以下方法 <code>sum</code> 是一个只接受正整数的部分函数。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> first, <span class="hljs-type">int</span> second)</span> {
	<span class="hljs-keyword">if</span> (first &lt; <span class="hljs-number">0</span> || second &lt; <span class="hljs-number">0</span>) {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Only positive integers are allowed"</span>);
	}
	<span class="hljs-keyword">return</span> first + second;
}
</code></pre>
<p>函数 <code>sum</code> 对负输入值抛出 <code>IllegalArgumentException</code>。
我们可以通过提供方法引用来提升<code>sum</code>方法。</p>
<pre><code class="hljs language-java" lang="java">Function2&lt;Integer, Integer, Option&lt;Integer&gt;&gt; sum = Function2.lift(<span class="hljs-built_in">this</span>::sum);
<span class="hljs-comment">// = None</span>
Option&lt;Integer&gt; optionalResult = sum.apply(-<span class="hljs-number">1</span>, <span class="hljs-number">2</span>); 
</code></pre>
<p>提升后的函数捕获 <code>IllegalArgumentException</code> 并将其映射到 <code>None</code>。</p>
<h4 data-id="heading-26">3.2.3. 部分应用</h4>
<p>部分应用允许你通过固定一些值从现有函数派生新函数。你可以固定一个或多个参数，固定参数的数量定义了新函数的元数，使得新元数 = (原始元数 - 固定参数)。参数从左到右绑定。</p>
<pre><code class="hljs language-java" lang="java">Function2&lt;Integer, Integer, Integer&gt; sum = (a, b) -&gt; a + b;
Function1&lt;Integer, Integer&gt; add2 = sum.apply(<span class="hljs-number">2</span>); 
then(add2.apply(<span class="hljs-number">4</span>)).isEqualTo(<span class="hljs-number">6</span>);
</code></pre>
<p>第一个参数 <code>a</code> 被固定为值 2。</p>
<p>这可以通过固定 <code>Function5</code> 的前三个参数来演示，结果是一个 <code>Function2</code>。</p>
<pre><code class="hljs language-Java" lang="Java">Function5&lt;Integer, Integer, Integer, Integer, Integer, Integer&gt; sum = (a, b, c, d, e) -&gt; a + b + c + d + e;
Function2&lt;Integer, Integer, Integer&gt; add6 = sum.apply(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>); 
then(add6.apply(<span class="hljs-number">4</span>, <span class="hljs-number">3</span>)).isEqualTo(<span class="hljs-number">13</span>);
</code></pre>
<p><code>a</code>、<code>b</code> 和 <code>c</code> 参数分别被固定为值 2、3 和 1。
部分应用与柯里化不同，将在相关章节中探讨。</p>
<h4 data-id="heading-27">3.2.4. 柯里化</h4>
<p>柯里化是一种通过为其中一个参数固定值来部分应用函数的技术，产生一个返回 <code>Function1</code> 的 <code>Function1</code>。</p>
<p>当 <code>Function2</code> 被柯里化时，结果与 <code>Function2</code> 的部分应用无法区分，因为两者都产生一个 1 元函数。</p>
<pre><code class="hljs language-Java" lang="Java">Function2&lt;Integer, Integer, Integer&gt; sum = (a, b) -&gt; a + b;
Function1&lt;Integer, Integer&gt; add2 = sum.curried().apply(<span class="hljs-number">2</span>); 
then(add2.apply(<span class="hljs-number">4</span>)).isEqualTo(<span class="hljs-number">6</span>);
</code></pre>
<p>第一个参数 <code>a</code> 被固定为值 2。</p>
<p>你可能会注意到，除了使用 <code>.curried()</code> 之外，这段代码与部分应用中给出的 2 元示例完全相同。对于更高元数的函数，区别就变得清晰了。</p>
<pre><code class="hljs language-java" lang="java">Function3&lt;Integer, Integer, Integer, Integer&gt; sum = (a, b, c) -&gt; a + b + c;
<span class="hljs-keyword">final</span> Function1&lt;Integer, Function1&lt;Integer, Integer&gt;&gt; add2 = sum.curried().apply(<span class="hljs-number">2</span>);
then(add2.apply(<span class="hljs-number">4</span>).apply(<span class="hljs-number">3</span>)).isEqualTo(<span class="hljs-number">9</span>);
</code></pre>
<p>注意参数中出现了额外的函数。除了最后一次调用外，对 <code>apply</code> 的进一步调用会返回另一个 <code>Function1</code>。</p>
<h4 data-id="heading-28">3.2.5. 记忆化</h4>
<p>记忆化是一种缓存形式。记忆化的函数只执行一次，然后从缓存返回结果。</p>
<p>以下示例在第一次调用时计算一个随机数，在第二次调用时返回缓存的数字。</p>
<pre><code class="hljs language-Java" lang="Java">Function0&lt;Double&gt; hashCache = Function0.of(Math::random).memoized();
<span class="hljs-type">double</span> <span class="hljs-variable">randomValue1</span> <span class="hljs-operator">=</span> hashCache.apply();
<span class="hljs-type">double</span> <span class="hljs-variable">randomValue2</span> <span class="hljs-operator">=</span> hashCache.apply();
then(randomValue1).isEqualTo(randomValue2);
</code></pre>
<h3 data-id="heading-29">3.3. 值类型</h3>
<p>在函数式环境中，我们将值视为一种范式，一种无法进一步求值的表达式。在 Java 中，我们通过将对象的状态设为 <code>final</code> 并称之为不可变来表达这一点。</p>
<p>Vavr 的函数式 <code>Value</code> 抽象了不可变对象。通过在实例之间共享不可变内存来添加高效的写操作。我们免费获得了线程安全性！</p>
<h4 data-id="heading-30">3.3.1. Option</h4>
<p><code>Option</code> 是一个单子容器类型，表示一个可选值。<code>Option</code> 的实例要么是 <code>Some</code> 的实例，要么是 <code>None</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 可选值，不再有 null</span>
Option&lt;T&gt; option = Option.of(...);
</code></pre>
<p>如果你在使用<code>Java</code>的 <code>Optional</code> 类之后转到 Vavr，有一个关键的区别。在 <code>Optional</code> 中，导致 <code>null</code> 的 <code>.map</code> 调用将导致空的 <code>Optional</code>。在 Vavr 中，它将导致 <code>Some(null)</code>，然后可能导致 <code>NullPointerException</code>。</p>
<p>使用 <code>Optional</code>，这个场景是有效的。</p>
<pre><code class="hljs language-java" lang="java">Optional&lt;String&gt; maybeFoo = Optional.of(<span class="hljs-string">"foo"</span>); 
then(maybeFoo.get()).isEqualTo(<span class="hljs-string">"foo"</span>);

Optional&lt;String&gt; maybeFooBar = maybeFoo.map(s -&gt; (String)<span class="hljs-literal">null</span>)
                                         .map(s -&gt; s.toUpperCase() + <span class="hljs-string">"bar"</span>);
then(maybeFooBar.isPresent()).isFalse();
</code></pre>
<p>该选项是 <code>Some("foo")</code>结果选项在这里变为空</p>
<p>使用 Vavr 的 <code>Option</code>，相同的场景将导致 <code>NullPointerException</code>。</p>
<pre><code class="hljs language-Java" lang="Java">Option&lt;String&gt; maybeFoo = Option.of(<span class="hljs-string">"foo"</span>); then(maybeFoo.get()).isEqualTo(<span class="hljs-string">"foo"</span>);
<span class="hljs-keyword">try</span> {
	maybeFoo.map(s -&gt; (String)<span class="hljs-literal">null</span>)
			.map(s -&gt; s.toUpperCase() + <span class="hljs-string">"bar"</span>);
	Assert.fail();
} <span class="hljs-keyword">catch</span> (NullPointerException e) {   
	 <span class="hljs-comment">// 这显然不是正确的方法</span>
 }
</code></pre>
<p>该选项是 <code>Some("foo")</code>结果选项是 <code>Some(null)</code>对 <code>s.toUpperCase()</code> 的调用是在 null 上调用的</p>
<p>这看起来像是 Vavr 的实现有问题，但事实上并非如此——相反，它遵循了单子在调用 <code>.map</code> 时保持计算上下文的要求。就 <code>Option</code> 而言，这意味着在 <code>Some</code> 上调用 <code>.map</code> 将导致 <code>Some</code>，在 <code>None</code> 上调用 <code>.map</code> 将导致 <code>None</code>。在上面的 Java <code>Optional</code> 示例中，上下文从 <code>Some</code> 更改为 <code>None</code>。</p>
<p>这似乎使 <code>Option</code> 变得无用，但实际上它迫使你关注可能出现的 <code>null</code> 并相应地处理它们，而不是不知不觉地接受它们。处理 <code>null</code> 出现的正确方法是使用 <code>flatMap</code>。</p>
<pre><code class="hljs language-java" lang="java">Option&lt;String&gt; maybeFoo = Option.of(<span class="hljs-string">"foo"</span>); then(maybeFoo.get()).isEqualTo(<span class="hljs-string">"foo"</span>);
Option&lt;String&gt; maybeFooBar = maybeFoo.map(s -&gt; (String)<span class="hljs-literal">null</span>)                                      .flatMap(s -&gt; Option.of(s)                                                          .map(t -&gt; t.toUpperCase() + <span class="hljs-string">"bar"</span>));then(maybeFooBar.isEmpty()).isTrue();
</code></pre>
<p>该选项是 <code>Some("foo")</code>结果选项是 <code>Some(null)``s</code>（即 null）变为 <code>None</code></p>
<p>或者，将 <code>.flatMap</code> 移到与可能为 null 的值相同的位置。</p>
<pre><code class="hljs language-java" lang="java">Option&lt;String&gt; maybeFoo = Option.of(<span class="hljs-string">"foo"</span>); 
then(maybeFoo.get()).isEqualTo(<span class="hljs-string">"foo"</span>);
Option&lt;String&gt; maybeFooBar = maybeFoo.flatMap(s -&gt; Option.of((String)<span class="hljs-literal">null</span>))
                                      .map(s -&gt; s.toUpperCase() + <span class="hljs-string">"bar"</span>);
then(maybeFooBar.isEmpty()).isTrue();
</code></pre>
<p>该选项是 <code>Some("foo")</code>结果选项是 <code>None</code>
这在 Vavr 博客上有更详细的探讨。</p>
<h4 data-id="heading-31">3.3.2. Try</h4>
<p><code>Try</code> 是一个单子容器类型，表示一个可能产生异常或成功返回计算值的计算。它在语义上与 <code>Either</code> 相似但不同。<code>Try</code> 的实例要么是 <code>Success</code> 的实例，要么是 <code>Failure</code> 的实例。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 无需处理异常</span>
Try.of(() -&gt; bunchOfWork()).getOrElse(other);
</code></pre>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.vavr.API.*;        <span class="hljs-comment">// $, Case, Match</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.vavr.Predicates.*; <span class="hljs-comment">// instanceOf</span>
<span class="hljs-type">A</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Try.of(<span class="hljs-built_in">this</span>::bunchOfWork).recover(x -&gt; Match(x).of(
		Case($(instanceOf(Exception_1.class)), t -&gt; somethingWithException(t)),
		Case($(instanceOf(Exception_2.class)), t -&gt; somethingWithException(t)),
		Case($(instanceOf(Exception_n.class)), t -&gt; somethingWithException(t))
)).getOrElse(other);
</code></pre>
<h4 data-id="heading-32">3.3.3. Lazy</h4>
<p><code>Lazy</code> 是一个单子容器类型，表示一个惰性求值的值。与 <code>Supplier</code> 相比，<code>Lazy</code> 是记忆化的，即它只求值一次，因此是引用透明的。</p>
<pre><code class="hljs language-Java" lang="Java">Lazy&lt;Double&gt; lazy = Lazy.of(Math::random);
lazy.isEvaluated(); <span class="hljs-comment">// = false</span>
lazy.get();         <span class="hljs-comment">// = 0.123 (随机生成)</span>
lazy.isEvaluated(); <span class="hljs-comment">// = true</span>
lazy.get();         <span class="hljs-comment">// = 0.123 (已记忆)</span>
</code></pre>
<p>你也可以创建一个真正的惰性值（仅适用于接口）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">CharSequence</span> <span class="hljs-variable">chars</span> <span class="hljs-operator">=</span> Lazy.val(() -&gt; <span class="hljs-string">"Yay!"</span>, CharSequence.class);
</code></pre>
<h4 data-id="heading-33">3.3.4. Either</h4>
<p><code>Either</code> 表示两种可能类型的值。一个 <code>Either</code> 要么是 <code>Left</code>，要么是 <code>Right</code>。如果给定的 <code>Either</code> 是 <code>Right</code> 并投影到 <code>Left</code>，则 <code>Left</code> 操作对 <code>Right</code> 值没有影响。如果给定的 <code>Either</code> 是 <code>Left</code> 并投影到 <code>Right</code>，则 <code>Right</code> 操作对 <code>Left</code> 值没有影响。如果 <code>Left</code> 投影到 <code>Left</code> 或 <code>Right</code> 投影到 <code>Right</code>，则操作会生效。</p>
<p>示例：一个 <code>compute()</code> 函数，其结果要么是一个 <code>Integer</code> 值（成功时），要么是一个 <code>String</code> 类型的错误消息（失败时）。按照惯例，成功情况是 <code>Right</code>，失败是 <code>Left</code>。</p>
<pre><code class="hljs language-java" lang="java">Either&lt;String,Integer&gt; value = compute().right().map(i -&gt; i * <span class="hljs-number">2</span>).toEither();
</code></pre>
<p>如果 <code>compute()</code> 的结果是 <code>Right(1)</code>，则 <code>value</code> 是 <code>Right(2)</code>。
如果 <code>compute()</code> 的结果是 <code>Left("error")</code>，则 <code>value</code> 是 <code>Left("error")</code>。</p>
<h4 data-id="heading-34">3.3.5. Future</h4>
<p><code>Future</code> 是在某个时刻可用的计算结果。提供的所有操作都是非阻塞的。底层的 <code>ExecutorService</code> 用于执行异步处理程序，例如通过 <code>onComplete(…)</code>。</p>
<p><code>Future</code> 有两种状态：挂起和完成。</p>
<ul>
<li>挂起：计算正在进行中。只有挂起的 future 可以被完成或取消。</li>
<li>完成：计算成功完成并产生结果、因异常失败或被取消。</li>
</ul>
<p>可以在 <code>Future</code> 的任何时间点注册回调。这些操作在 <code>Future</code> 完成时立即执行。注册在已完成的 <code>Future</code> 上的操作会立即执行。该操作可能运行在单独的线程上，具体取决于底层的 <code>ExecutorService</code>。注册在已取消的 <code>Future</code> 上的操作会以失败结果执行。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// future 值，异步计算的结果</span>
Future&lt;T&gt; future = Future.of(...);
</code></pre>
<h4 data-id="heading-35">3.3.6. Validation</h4>
<p><code>Validation</code> 控件是一个应用函子，有助于累积错误。当尝试组合单子时，组合过程将在第一个遇到的错误处短路。但是 <code>Validation</code> 将继续处理组合函数，累积所有错误。这在验证多个字段（例如 Web 表单）时特别有用，你希望知道遇到的所有错误，而不是一次一个。</p>
<p>示例：我们从 Web 表单获取字段 <code>name</code> 和 <code>age</code>，并希望创建一个有效的 <code>Person</code> 实例，或者返回验证错误列表。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">PersonValidator</span> <span class="hljs-variable">personValidator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersonValidator</span>();
<span class="hljs-comment">// Valid(Person(John Doe, 30))</span>
Validation&lt;Seq&lt;String&gt;, Person&gt; valid = personValidator.validatePerson(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
<span class="hljs-comment">// Invalid(List(Name contains invalid characters: '!4?', Age must be greater than 0))</span>
Validation&lt;Seq&lt;String&gt;, Person&gt; invalid = personValidator.validatePerson(<span class="hljs-string">"John? Doe!4"</span>, -<span class="hljs-number">1</span>);
</code></pre>
<p>一个有效值包含在 <code>Validation.Valid</code> 实例中，一个验证错误列表包含在 <code>Validation.Invalid</code> 实例中。
以下验证器用于将不同的验证结果组合到一个 <code>Validation</code> 实例中。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PersonValidator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">VALID_NAME_CHARS</span> <span class="hljs-operator">=</span> <span class="hljs-string">"[a-zA-Z ]"</span>;
		<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MIN_AGE</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
		<span class="hljs-keyword">public</span> Validation&lt;Seq&lt;String&gt;, Person&gt; <span class="hljs-title function_">validatePerson</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
			<span class="hljs-keyword">return</span> Validation.combine(validateName(name), validateAge(age)).ap(Person::<span class="hljs-keyword">new</span>);
		}

    <span class="hljs-keyword">private</span> Validation&lt;String, String&gt; <span class="hljs-title function_">validateName</span><span class="hljs-params">(String name)</span> {
			<span class="hljs-keyword">return</span> CharSeq.of(name)
				.replaceAll(VALID_NAME_CHARS, <span class="hljs-string">""</span>)
				.transform(seq -&gt; seq.isEmpty() ? 
					Validation.valid(name) : 
					Validation.invalid(<span class="hljs-string">"Name contains invalid characters: '"</span>+ seq.distinct().sorted() + <span class="hljs-string">"'"</span>)
			);
		}

    <span class="hljs-keyword">private</span> Validation&lt;String, Integer&gt; <span class="hljs-title function_">validateAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
			<span class="hljs-keyword">return</span> age &lt; MIN_AGE
						? Validation.invalid(<span class="hljs-string">"Age must be at least "</span> + MIN_AGE)
						: Validation.valid(age);
		}
}
</code></pre>
<p>如果验证成功，即输入数据有效，则使用给定的字段 <code>name</code> 和 <code>age</code> 创建一个 <code>Person</code> 实例。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> String name;
		<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> age;
		
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
			<span class="hljs-built_in">this</span>.name = name;
			<span class="hljs-built_in">this</span>.age = age;
		}

    <span class="hljs-meta">@Override</span>
		<span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-string">"Person("</span> + name + <span class="hljs-string">", "</span> + age + <span class="hljs-string">")"</span>;
		}
}
</code></pre>
<h3 data-id="heading-36">3.4. 集合</h3>
<p>我们投入了大量精力来设计一个全新的 Java 集合库，以满足函数式编程的要求，即不可变性。</p>
<p>Java 的 <code>Stream</code> 将计算提升到不同的层，并在另一个明确的步骤中链接到特定的集合。使用 Vavr，我们不需要所有这些额外的样板代码。</p>
<p>新集合基于 <code>java.lang.Iterable</code>，因此它们利用了语法糖迭代风格。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 1000 个随机数</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">double</span> random : Stream.continually(Math::random).take(<span class="hljs-number">1000</span>)) {
	...
}
</code></pre>
<p><code>TraversableOnce</code> 有大量有用的函数来操作集合。它的 API 类似于 <code>java.util.stream.Stream</code> 但更成熟。</p>
<h4 data-id="heading-37">3.4.1. List</h4>
<p>Vavr 的 <code>List</code> 是一个不可变的链表。修改会创建新实例。大多数操作在线性时间内执行。连续操作一个接一个地执行。</p>
<p>Java 8</p>
<pre><code class="hljs language-Java" lang="Java">Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).stream().reduce((i, j) -&gt; i + j);IntStream.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).sum();
</code></pre>
<p>Vavr</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// io.vavr.collection.List</span>
List.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>).sum();
</code></pre>
<h4 data-id="heading-38">3.4.2. Stream</h4>
<p><code>io.vavr.collection.Stream</code> 实现是一个惰性链表。值只在需要时计算。由于其惰性，大多数操作在常数时间内执行。操作通常是中间操作，并在一次遍历中执行。</p>
<p>关于流的一个惊人之处是我们可以使用它们来表示（理论上）无限长的序列。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 2, 4, 6, ...</span>
Stream.from(<span class="hljs-number">1</span>).filter(i -&gt; i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>);
</code></pre>
<h4 data-id="heading-39">3.4.3. 性能特征</h4>
<p>表 1. 顺序操作的时间复杂度</p>






















































































<table><thead><tr><th/><th>head()</th><th>tail()</th><th>get(int)</th><th>update(int, T)</th><th>prepend(T)</th><th>append(T)</th></tr></thead><tbody><tr><td>Array</td><td>—</td><td>—</td><td>const</td><td>const</td><td>linear</td><td>linear</td></tr><tr><td>CharSeq</td><td>const</td><td>linear</td><td>const</td><td>linear</td><td>linear</td><td>linear</td></tr><tr><td>Iterator</td><td>const</td><td>const</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>List</td><td>const</td><td>const</td><td>linear</td><td>linear</td><td>const</td><td>linear</td></tr><tr><td>Queue</td><td>const</td><td>const¹</td><td>linear</td><td>linear</td><td>const</td><td>const</td></tr><tr><td>PriorityQueue</td><td>log</td><td>log</td><td>—</td><td>—</td><td>log</td><td>log</td></tr><tr><td>Stream</td><td>const</td><td>const</td><td>linear</td><td>linear</td><td>const lazy</td><td>const lazy</td></tr><tr><td>Vector</td><td>const eff</td><td>const eff</td><td>const eff</td><td>const eff</td><td>const eff</td><td>const eff</td></tr></tbody></table>
<p>表 2. Map/Set 操作的时间复杂度</p>





























































<table><thead><tr><th/><th>contains/Key</th><th>add/put</th><th>remove</th><th>min</th></tr></thead><tbody><tr><td>HashMap</td><td>const eff</td><td>const eff</td><td>const eff</td><td>linear</td></tr><tr><td>HashSet</td><td>const eff</td><td>const eff</td><td>const eff</td><td>linear</td></tr><tr><td>LinkedHashMap</td><td>const eff</td><td>linear</td><td>linear</td><td>linear</td></tr><tr><td>LinkedHashSet</td><td>const eff</td><td>linear</td><td>linear</td><td>linear</td></tr><tr><td>Tree</td><td>log</td><td>log</td><td>log</td><td>log</td></tr><tr><td>TreeMap</td><td>log</td><td>log</td><td>log</td><td>log</td></tr><tr><td>TreeSet</td><td>log</td><td>log</td><td>log</td><td>log</td></tr></tbody></table>
<p>图例：</p>
<ul>
<li>const — 常数时间</li>
<li>const¹ — 摊销常数时间，少数操作可能需要更长时间</li>
<li>const eff — 有效常数时间，取决于假设，如哈希键的分布</li>
<li>const lazy — 惰性常数时间，操作被延迟</li>
<li>log — 对数时间</li>
<li>linear — 线性时间</li>
</ul>
<h3 data-id="heading-40">3.5. 属性检查</h3>
<p>属性检查（也称为属性测试）是一种以函数式测试代码属性的真正强大的方式。它基于生成的随机数据，这些数据被传递给用户定义的检查函数。
Vavr 在其 <code>io.vavr:vavr-test</code> 模块中支持属性测试，因此请确保包含它以在测试中使用。</p>
<pre><code class="hljs language-java" lang="java">Arbitrary&lt;Integer&gt; ints = Arbitrary.integer();
<span class="hljs-comment">// square(int) &gt;= 0: OK, passed 1000 </span>
tests.Property.def(<span class="hljs-string">"square(int) &gt;= 0"</span>)
	.forAll(ints)
	.suchThat(i -&gt; i * i &gt;= <span class="hljs-number">0</span>)
	.check()
	.assertIsSatisfied();
</code></pre>
<p>复杂数据结构的生成器由简单生成器组成。</p>
<h3 data-id="heading-41">3.6. 模式匹配</h3>
<p>Scala 有原生模式匹配，这是相对于普通 Java 的优势之一。基本语法接近 Java 的 <code>switch</code>：</p>
<pre><code class="hljs language-Scala" lang="Scala"><span class="hljs-keyword">val</span> s = i <span class="hljs-keyword">match</span> {  
	<span class="hljs-keyword">case</span> <span class="hljs-number">1</span> =&gt; <span class="hljs-string">"one"</span>  
	<span class="hljs-keyword">case</span> <span class="hljs-number">2</span> =&gt; <span class="hljs-string">"two"</span>  
	<span class="hljs-keyword">case</span> _ =&gt; <span class="hljs-string">"?"</span>
}
</code></pre>
<p>值得注意的是 <code>match</code> 是一个表达式，它产生一个结果。此外，它还提供：</p>
<ul>
<li>命名参数 <code>case i: Int ⇒ "Int " + i</code></li>
<li>对象解构 <code>case Some(i) ⇒ i</code></li>
<li>守卫 <code>case Some(i) if i &gt; 0 ⇒ "posi</code>tive " + i`</li>
<li>多条件 <code>case "-h" | "--help" ⇒ displa</code>yHelp`</li>
<li>编译时检查完备性</li>
</ul>
<p>模式匹配是一个很棒的特性，它使我们免于编写一堆 if-then-else 分支。它减少了代码量，同时专注于相关部分。</p>
<h4 data-id="heading-42">3.6.1. Java 匹配基础</h4>
<p>Vavr 提供了一个接近 Scala <code>match</code> 的匹配 API。通过将以下导入添加到我们的应用程序来启用它：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.vavr.API.*;
</code></pre>
<p>将静态方法 <code>Match</code>、<code>Case</code> 和原子模式</p>
<ul>
<li><code>$()</code> - 通配符模式</li>
<li><code>$(value)</code> - 等于模式</li>
<li><code>$(predicate)</code> - 条件模式</li>
</ul>
<p>引入作用域后，最初的 Scala 示例可以这样表达：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> Match(i).of(
	Case($(<span class="hljs-number">1</span>), <span class="hljs-string">"one"</span>),
	Case($(<span class="hljs-number">2</span>), <span class="hljs-string">"two"</span>),
	Case($(), <span class="hljs-string">"?"</span>)
);
</code></pre>
<p>⚡ 我们使用统一的大写方法名，因为 <code>case</code> 是 Java 中的关键字。这使得 API 很特殊。</p>
<p><strong>完备性</strong></p>
<p>最后一个通配符模式 <code>$()</code> 使我们免于 <code>MatchError</code>，如果没有匹配项则会抛出此错误。
因为我们无法像 Scala 编译器那样执行完备性检查，所以我们提供了返回可选结果的可能性：</p>
<pre><code class="hljs language-Java" lang="Java">Option&lt;String&gt; s = Match(i).option(    Case($(<span class="hljs-number">0</span>), <span class="hljs-string">"zero"</span>));
</code></pre>
<p><strong>语法糖</strong></p>
<p>如前所示，<code>Case</code> 允许匹配条件模式。</p>
<pre><code class="hljs language-Java" lang="Java">Case($(predicate), ...)
</code></pre>
<p>Vavr 提供了一组默认谓词。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.vavr.Predicates.*;
</code></pre>
<p>这些可以用来表达最初的 Scala 示例，如下所示：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> Match(i).of(
	Case($(is(<span class="hljs-number">1</span>)), <span class="hljs-string">"one"</span>),
	Case($(is(<span class="hljs-number">2</span>)), <span class="hljs-string">"two"</span>),
	Case($(), <span class="hljs-string">"?"</span>)
);
</code></pre>
<p><strong>多条件</strong></p>
<p>我们使用 <code>isIn</code> 谓词来检查多个条件：</p>
<pre><code class="hljs language-Java" lang="Java">Case($(isIn(<span class="hljs-string">"-h"</span>, <span class="hljs-string">"--help"</span>)), ...)
</code></pre>
<p><strong>执行副作用</strong></p>
<p><code>Match</code> 的行为类似于一个表达式，它产生一个值。为了执行副作用，我们需要使用返回 <code>Void</code> 的辅助函数 <code>run</code>：</p>
<pre><code class="hljs language-Java" lang="Java">Match(arg).of(
	Case($(isIn(<span class="hljs-string">"-h"</span>, <span class="hljs-string">"--help"</span>)), o -&gt; run(<span class="hljs-built_in">this</span>::displayHelp)),
	Case($(isIn(<span class="hljs-string">"-v"</span>, <span class="hljs-string">"--version"</span>)), o -&gt; run(<span class="hljs-built_in">this</span>::displayVersion)),
	Case($(), o -&gt; run(() -&gt; {
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(arg);
		})
	)
);
</code></pre>
<p>⚡ <code>run</code> 用于解决歧义，并且因为 <code>void</code> 在 Java 中不是有效的返回值。
注意：<code>run</code> 不能用作直接返回值，即不能在 lambda 体外部使用：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 错误！</span>
Case($(isIn(<span class="hljs-string">"-h"</span>, <span class="hljs-string">"--help"</span>)), run(<span class="hljs-built_in">this</span>::displayHelp))
</code></pre>
<p>否则，<code>Case</code> 将在模式匹配之前被急切求值，这会破坏整个 <code>Match</code> 表达式。相反，我们在 lambda 体内使用它：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// 正确</span>
Case($(isIn(<span class="hljs-string">"-h"</span>, <span class="hljs-string">"--help"</span>)), o -&gt; run(<span class="hljs-built_in">this</span>::displayHelp))
</code></pre>
<p>正如我们所看到的，如果使用不当，<code>run</code> 容易出错。请小心。我们考虑在未来的版本中弃用它，也许我们还会为执行副作用提供更好的 API。</p>
<p><strong>命名参数</strong></p>
<p>Vavr 利用 lambda 为匹配的值提供命名参数。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">Number</span> <span class="hljs-variable">plusOne</span> <span class="hljs-operator">=</span> Match(obj).of(
	Case($(instanceOf(Integer.class)), i -&gt; i + <span class="hljs-number">1</span>),
	Case($(instanceOf(Double.class)), d -&gt; d + <span class="hljs-number">1</span>),
	Case($(), o -&gt; { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberFormatException</span>(); }
));
</code></pre>
<p>到目前为止，我们直接使用原子模式匹配值。如果原子模式匹配，则匹配对象的正确类型将从模式的上下文中推断出来。
接下来，我们将看看能够匹配（理论上）任意深度的对象图的递归模式。</p>
<p><strong>对象解构</strong></p>
<p>在 Java 中，我们使用构造函数来实例化类。我们将对象解构理解为将对象分解为其组成部分。
构造函数是应用于参数并返回新实例的函数，而解构函数是接受实例并返回其组成部分的函数。我们说一个对象被解构了。
对象解构不一定是一个唯一的操作。例如，一个 <code>LocalDate</code> 可以被解构为：</p>
<ul>
<li>年、月和日组件</li>
<li>表示相应 <code>Instant</code> 的纪元毫秒的长整型值</li>
<li>等等。</li>
</ul>
<h4 data-id="heading-43">3.6.2. 模式</h4>
<p>在 Vavr 中，我们使用模式来定义如何解构特定类型的实例。这些模式可以与 <code>Match</code> API 结合使用。
<strong>预定义模式</strong>
对于许多 Vavr 类型，已经存在匹配模式。它们通过以下方式导入：</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> io.vavr.Patterns.*;
</code></pre>
<p>例如，我们现在能够匹配 <code>Try</code> 的结果：</p>
<pre><code class="hljs language-Java" lang="Java">Match(_try).of(
	Case($Success($()), value -&gt; ...),
	Case($Failure($()), x -&gt; ...)
);
</code></pre>
<p>⚡ Vavr 的 <code>Match</code> API 的第一个原型允许从匹配模式中提取用户选择的对象。没有适当的编译器支持，这是不切实际的，因为生成的方法数量呈指数级增长。当前的 API 做出了妥协，即匹配所有模式但只解构根模式。</p>
<pre><code class="hljs language-Java" lang="Java">Match(_try).of(
	Case($Success($Tuple2($(<span class="hljs-string">"a"</span>), $())), tuple2 -&gt; ...),
	Case($Failure($(instanceOf(Error.class))), error -&gt; ...)
);
</code></pre>
<p>这里的根模式是 <code>Success</code> 和 <code>Failure</code>。它们被解构为 <code>Tuple2</code> 和 <code>Error</code>，具有正确的泛型类型。</p>
<p>⚡ 深层嵌套的类型是根据 <code>Match</code> 参数推断的，而不是根据匹配的模式。</p>
<p><strong>用户定义模式</strong></p>
<p>能够解构任意对象（包括 <code>final</code> 类的实例）是至关重要的。Vavr 通过提供编译时注解 <code>@Patterns</code> 和 <code>@Unapply</code> 以声明式风格实现这一点。</p>
<p>要启用注解处理器，需要将工件 <code>vavr-match</code> 添加为项目依赖项。</p>
<p>⚡ 注意：当然，模式可以直接实现而不使用代码生成器。更多信息请查看生成的源代码。</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> io.vavr.match.annotation.*;
<span class="hljs-meta">@Patternsclass</span> My {
    <span class="hljs-meta">@Unapply</span>    
		<span class="hljs-keyword">static</span> &lt;T&gt; Tuple1&lt;T&gt; <span class="hljs-title function_">Optional</span><span class="hljs-params">(java.util.Optional&lt;T&gt; optional)</span> {
			<span class="hljs-keyword">return</span> Tuple.of(optional.orElse(<span class="hljs-literal">null</span>));    
		}
}
</code></pre>
<p>注解处理器将文件 <code>MyPatterns</code> 放在同一个包中（默认在 <code>target/generated-sources</code> 中）。也支持内部类。特殊情况：如果类名是 <code>$</code>，则生成的类名只是 <code>Patterns</code>，没有前缀。</p>
<p><strong>守卫</strong></p>
<p>现在我们可以使用守卫来匹配 <code>Optional</code>。</p>
<pre><code class="hljs language-Java" lang="Java">Match(optional).of(
	Case($Optional($(v -&gt; v != <span class="hljs-literal">null</span>)), <span class="hljs-string">"defined"</span>),
	Case($Optional($(v -&gt; v == <span class="hljs-literal">null</span>)), <span class="hljs-string">"empty"</span>)
);
</code></pre>
<p>谓词可以通过实现 <code>isNull</code> 和 <code>isNotNull</code> 来简化。
⚡ 是的，提取 <code>null</code> 很奇怪。与其使用 Java 的 <code>Optional</code>，不如试试 Vavr 的 <code>Option</code>！</p>
<pre><code class="hljs language-Java" lang="Java">Match(option).of(
	Case($Some($()), <span class="hljs-string">"defined"</span>),
	Case($None(), <span class="hljs-string">"empty"</span>)
);
</code></pre>
<h2 data-id="heading-44">4. 许可证</h2>
<p>版权所有 2014-2025 Vavr， <a href="https://link.juejin.cn?target=https%3A%2F%2Fvavr.io" target="_blank" title="https://vavr.io" ref="nofollow noopener noreferrer">vavr.io</a><br/>
根据 Apache 许可证 2.0 版（"许可证"）授权；<br/>
除非遵守许可证，否则你不得使用此文件。<br/>
你可以在以下网址获取许可证副本：<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.apache.org%2Flicenses%2FLICENSE-2.0" target="_blank" title="http://www.apache.org/licenses/LICENSE-2.0" ref="nofollow noopener noreferrer">www.apache.org/licenses/LI…</a><br/>
除非适用法律要求或书面同意，否则按"原样"分发的软件，没有任何明示或暗示的担保或条件。<br/>
请参阅许可证以了解许可证下的特定语言管理权限和限制。<br/>
版本 0.11.0<br/>
最后更新于 2025-12-16 18:50:22 UTC</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[实战：在 Docker (Windows) 中构建集成 yt-dlp 的“满血版” n8n 自动化工作流]]></title>    <link>https://juejin.cn/post/7593177437082681395</link>    <guid>https://juejin.cn/post/7593177437082681395</guid>    <pubDate>2026-01-10T02:35:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593177437082681395" data-draft-id="7593212374921330715" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="实战：在 Docker (Windows) 中构建集成 yt-dlp 的“满血版” n8n 自动化工作流"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-10T02:35:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="摸鱼的春哥"/> <meta itemprop="url" content="https://juejin.cn/user/1714893870865303"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            实战：在 Docker (Windows) 中构建集成 yt-dlp 的“满血版” n8n 自动化工作流
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1714893870865303/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    摸鱼的春哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T02:35:57.000Z" title="Sat Jan 10 2026 02:35:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;font-weight:400;line-height:2;font-size:17px;overflow-x:hidden;color:#000}.markdown-body strong{padding:1px;color:#ee3f4d}.markdown-body em{padding:0 2px;color:#f33b1f}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:30px;margin-bottom:20px;line-height:1.5;font-weight:700}.markdown-body h1{text-align:center;padding-bottom:5px;font-size:32px;color:#ac1f18}.markdown-body h1:after{content:"";display:block;margin:4px auto 0;width:100px;height:2px;border-bottom:2px solid #f33b1f}.markdown-body h2{font-size:28px;border-bottom:1px solid #f33b1f}.markdown-body h2:before{content:"# "!important;color:#f33b1f}.markdown-body h3{font-size:24px;padding-left:9px;border-left:6px solid #f33b1f}.markdown-body h4{font-size:20px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #bbb;margin:16px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f9f1db;color:#ee2746;border-radius:2px;font-size:16px;padding:1px 2px}.markdown-body code,.markdown-body pre{font-family:-apple-system,-apple-system-body,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,PingFang SC,思源黑体 CN,思源黑体,JetBrains Mono,Fira Code,Menlo,Ubuntu Mono,Consolas,sans-serif}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{margin:12px 0!important;border-radius:3px;font-size:15px;padding:16px 12px;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f7f7f7}.markdown-body a{text-decoration:none;color:#1781b5;padding:0 2px;border-bottom:1px solid #1781b5}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #f33b1f;color:#ac1f18}.markdown-body blockquote{color:#3d3d3d;background-color:#fff9f9;padding:6px 16px;margin:16px 0;border-left:3px solid #f07c82}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:6px 0}.markdown-body ol,.markdown-body ul{padding-left:30px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:6px}.markdown-body ol li{padding-left:6px}.markdown-body ::marker{color:#f33b1f}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body .task-list-item input[type=checkbox]{position:relative}.markdown-body .task-list-item input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;border:1px solid #f07c82;border-radius:3px;box-sizing:border-box;z-index:1}.markdown-body .task-list-item input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-5px;left:0;right:0;bottom:0;width:0;height:0;color:#f33b1f;font-size:16px;font-weight:700;z-index:2}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table thead{background:#fff9f9;color:#000;text-align:left;font-size:15px}.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table tr:hover{background-color:#fff9f9}.markdown-body table td,.markdown-body table th{padding:12px 7px;line-height:24px;border:1px solid #f9f1db}.markdown-body table td{min-width:120px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><p>在自动化工作流中，<strong>n8n</strong> 是一个强大的编排工具。但默认的 Docker 镜像为了追求轻量化，往往缺少很多系统级工具。最近我需要在 Windows Docker Desktop 环境下的 n8n 里调用 <strong>yt-dlp</strong> 下载高清视频。</p>
<p>本文记录一下方案的选型与思考。</p>
<h3 data-id="heading-0">1. 为什么我们要抛弃 Alpine，选择 Debian？</h3>
<p>起初，我们尝试在官方默认的 <code>n8n:latest</code> (基于 Alpine Linux) 中安装 <code>python3</code> 和 <code>yt-dlp</code>。虽然安装过程看似顺利，但在运行时却遭遇了滑铁卢。</p>
<h4 data-id="heading-1">遇到的问题</h4>
<ul>
<li><strong>底层库缺失</strong>：运行 yt-dlp 时报错 <code>posix_fallocate64: symbol not found</code>。</li>
<li><strong>原因分析</strong>：这是 Alpine (使用 musl libc) 和 Python 某些预编译二进制库 (依赖 glibc) 之间的经典兼容性问题。虽然可以通过安装 <code>gcompat</code> 尝试修复，但稳定性极差。</li>
<li><strong>官方 Debian 镜像滞后</strong>：官方虽然提供了 <code>n8n:debian</code> 镜像，但更新频率远低于 <code>latest</code>，无法使用 n8n 的最新功能。</li>
</ul>
<h4 data-id="heading-2">解决方案</h4>
<p>为了同时获得 <strong>Debian 的稳定性 (glibc)</strong> 和 <strong>n8n 的最新版本</strong>，我们决定采用 <strong>"Node.js 官方镜像 + 手动安装 n8n"</strong> 的构建策略。</p>
<ul>
<li><strong>底座</strong>：<code>node:20-bookworm</code> (Debian 12，稳定、兼容性好)。</li>
<li><strong>应用</strong>：通过 <code>npm install -g n8n</code> 获取最新版。</li>
<li><strong>扩展</strong>：原生支持 <code>apt</code>，轻松安装 FFmpeg 和 Python。</li>
</ul>
<hr/>
<h3 data-id="heading-3">2. 核心构建：混合加速的 Dockerfile</h3>
<p>在国内网络环境下构建这个镜像是一项挑战：</p>
<ol>
<li><code>apt</code> 和 <code>npm</code> 直连速度慢，需要国内镜像源加速。</li>
<li><code>yt-dlp</code> 发布在 GitHub，国内镜像源无法覆盖，必须走那个，那个你懂的。</li>
</ol>
<p>我们需要一个 <strong>“混合加速”</strong> 的 <code>Dockerfile</code>：</p>
<pre><code class="hljs language-dockerfile" lang="dockerfile"># 使用 Node.js 20 (Debian Bookworm) 作为稳固底座
FROM node:20-bookworm

# 1. 接收构建参数 (用于解决 GitHub 连接问题)
ARG HTTP_PROXY
ARG HTTPS_PROXY

USER root

# -----------------------------------------------------------------------------
# 🚀 优化 A：系统级加速 (apt 使用中科大源)
# Bookworm 版本格式变动，使用 sed 替换源
RUN sed -i 's/deb.debian.org/mirrors.ustc.edu.cn/g' /etc/apt/sources.list.d/debian.sources &amp;&amp; \
    sed -i 's|security.debian.org/debian-security|mirrors.ustc.edu.cn/debian-security|g' /etc/apt/sources.list.d/debian.sources

# 🚀 优化 B：Node级加速 (npm 使用国内镜像)
RUN npm config set registry [https://registry.npmmirror.com](https://registry.npmmirror.com)
# -----------------------------------------------------------------------------

# 2. 安装系统工具 (apt 走国内源，速度飞快)
# ffmpeg: 合并高清视频音频必备
RUN apt-get update &amp;&amp; \
    apt-get install -y python3 python3-pip ffmpeg wget &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

# 3. 安装 yt-dlp (设置临时环境变量走代理，因为 GitHub 此时必须翻墙)
RUN export http_proxy=${HTTP_PROXY} &amp;&amp; \
    export https_proxy=${HTTPS_PROXY} &amp;&amp; \
    wget [https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp](https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp) -O /usr/local/bin/yt-dlp &amp;&amp; \
    chmod a+rx /usr/local/bin/yt-dlp

# 4. 安装 n8n (npm 走国内源)
RUN npm install -g n8n

# 5. 权限与目录处理
# 创建挂载点 /files 用于存放下载文件
RUN mkdir -p /home/node/.n8n /files &amp;&amp; \
    chown -R node:node /home/node/.n8n /files

# 6. 切换回安全用户
USER node
ENTRYPOINT ["n8n"]
</code></pre>
<h3 data-id="heading-4">3. 编排配置：Docker Compose</h3>
<p>在 Windows Docker Desktop 环境下，让容器连上宿主机的代理软件（Clash/v2ray），关键在于 host.docker.internal。</p>
<p>docker-compose.yml 配置如下：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">n8n:</span>
    <span class="hljs-attr">build:</span> 
      <span class="hljs-attr">context:</span> <span class="hljs-string">.</span>
      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span>
      <span class="hljs-comment"># 传递代理给 Dockerfile 用于 wget 下载 yt-dlp</span>
      <span class="hljs-attr">args:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">HTTP_PROXY=[http://host.docker.internal:7890](http://host.docker.internal:7890)</span>
        <span class="hljs-bullet">-</span> <span class="hljs-string">HTTPS_PROXY=[http://host.docker.internal:7890](http://host.docker.internal:7890)</span>
    
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">n8n</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5678:5678"</span>
    
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">GENERIC_TIMEZONE=Asia/Shanghai</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">TZ=Asia/Shanghai</span>
      <span class="hljs-comment"># 指定 n8n 配置目录</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">N8N_USER_FOLDER=/home/node/.n8n</span>
      
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-comment"># n8n 数据持久化</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">n8n_data:/home/node/.n8n</span>
      <span class="hljs-comment"># 挂载宿主机 D 盘用于存放下载的视频</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">D:\n8n_files:/files</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">n8n_data:</span>
</code></pre>
<h3 data-id="heading-5">4. 验证与实战</h3>
<p>构建完成后 (docker-compose up -d --build)，我们不要急着去 n8n 界面，先在命令行里进行一次“外科手术式”的验证。</p>
<p>打开 Windows CMD，执行以下命令：</p>
<h4 data-id="heading-6">验证一：环境检查</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查 yt-dlp 版本 (成功则返回日期版本号)</span>
docker <span class="hljs-built_in">exec</span> -it n8n yt-dlp --version

<span class="hljs-comment"># 检查 FFmpeg (成功则返回配置详情)</span>
docker <span class="hljs-built_in">exec</span> -it n8n ffmpeg -version
</code></pre>
<h4 data-id="heading-7">验证二：网络与代理测试</h4>
<p>这是最关键的一步。我们尝试在容器内通过宿主机代理获取 YouTube 视频标题。</p>
<h2 data-id="heading-8">注意：运行时也需要指定 --proxy，因为容器默认不走代理</h2>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it n8n yt-dlp --proxy <span class="hljs-string">"[http://host.docker.internal:7890](http://host.docker.internal:7890)"</span> --<span class="hljs-built_in">print</span> title [https://www.youtube.com/watch?v=dQw4w9WgXcQ](https://www.youtube.com/watch?v=dQw4w9WgXcQ)
</code></pre>
<p>不需要代理的同学可以删掉 <code>--proxy "[http://host.docker.internal:7890](http://host.docker.internal:7890)"</code></p>
<p>如果输出了 Rick Astley - Never Gonna Give You Up...，恭喜你，网络完全打通！</p>
<h4 data-id="heading-9">验证三：真实下载测试</h4>
<p>直接将视频下载到宿主机的 D:\n8n_files 中：</p>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it n8n yt-dlp -o <span class="hljs-string">"/files/test_video.mp4"</span> [https://www.youtube.com/watch?v=dQw4w9WgXcQ](https://www.youtube.com/watch?v=dQw4w9WgXcQ)
</code></pre>
<p>代理配置如果需要就参考验证二加上。</p>
<p>去 D 盘检查文件是否存在，且能正常播放（有声音说明 FFmpeg 工作正常）。</p>
<h3 data-id="heading-10">5. 在 n8n 中使用</h3>
<p>现在，你可以在 n8n 的流程中添加 "Execute Command" 节点，尽情使用 yt-dlp 了：</p>
<pre><code class="hljs language-bash" lang="bash">yt-dlp --proxy <span class="hljs-string">"[http://host.docker.internal:7890](http://host.docker.internal:7890)"</span> -o <span class="hljs-string">'/files/%(title)s.%(ext)s'</span> {{ <span class="hljs-variable">$json</span>.url }}
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>通过这次改造，我们实现了：</p>
<ol>
<li>
<p>稳定性：Debian 底座彻底解决了 Python 运行库报错的问题。</p>
</li>
<li>
<p>时效性：通过 npm 安装，永远可以使用最新版的 n8n。</p>
</li>
<li>
<p>功能性：集成了 FFmpeg 和 yt-dlp，支持最高画质视频下载。</p>
</li>
<li>
<p>速度：构建过程利用国内源，运行过程利用宿主机代理，兼顾了速度与连通性。</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在AI时代，技术人应该每天都要花两小时来构建一个自身的构建系统]]></title>    <link>https://juejin.cn/post/7593193235251839028</link>    <guid>https://juejin.cn/post/7593193235251839028</guid>    <pubDate>2026-01-10T02:38:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593193235251839028" data-draft-id="7593338828196020264" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在AI时代，技术人应该每天都要花两小时来构建一个自身的构建系统"/> <meta itemprop="keywords" content="前端,架构,Vue.js"/> <meta itemprop="datePublished" content="2026-01-10T02:38:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小酒星小杜"/> <meta itemprop="url" content="https://juejin.cn/user/1512542215093479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在AI时代，技术人应该每天都要花两小时来构建一个自身的构建系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1512542215093479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小酒星小杜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T02:38:19.000Z" title="Sat Jan 10 2026 02:38:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">导言</h2>
<p><strong>每天2小时的低内耗构建系统</strong></p>
<blockquote>
<p>我们只需每天只用一小段、几乎不会内耗的时间，去搭建一个长期复利的东西</p>
</blockquote>
<p>我们的重点在低内耗和构建系统。</p>
<h3 data-id="heading-1">为什么不是4小时，8小时？</h3>
<p>4小时、8小时很容易会让我们心里产生<strong>需要全力以赴的假象。</strong></p>
<p>而2小时则不会，你心里就会觉得：</p>
<blockquote>
<p>这2小时，就算浪费了，我也不心疼。</p>
</blockquote>
<p>在技术人看来，我做一个东西需要有一整块的时间，不然我没办法做得好。</p>
<p>但现实的问题是一整块的时间非常少，好的idea和项目都是在等待时间中死亡了。</p>
<p><strong>所以2小时不是时间管理的选择，而是心理设计的选择。</strong></p>
<p>2小时的真正作用：</p>
<p>不是为了赶进度，而是为了降低启动成本，构建系统。</p>
<p>系统存在的意义，是让你在状态最差的那天也能持续构建</p>
<h2 data-id="heading-2">系统总览</h2>
<h3 data-id="heading-3">系统全貌</h3>
<blockquote>
<p>2 Hour Builder = Input -&gt; Build -&gt; Ship 的最小闭环</p>
</blockquote>
<p>这三个步骤是实现一个<strong>反内耗构建系统</strong>的一个<strong>构建单位</strong>。</p>
<p>顺序是不可以乱的，必须按照步骤执行。</p>
<p><strong>Input</strong> <strong>不是学习，是取材</strong>。</p>
<p>不是今天收藏10篇文章，不是系统性的去学习一样东西。</p>
<p>而是只为一件事情服务：</p>
<p>👉<strong>为今天的Build找一个明确的素材。</strong></p>
<p>例如：</p>
<p>一个真实的用户吐槽、一段自己踩过的坑、一个在脑海反复出现的疑问、一条忍不住要反驳的观点。</p>
<p>Input的标准只有一个，<strong>就是今天就能被用掉</strong>。</p>
<p><strong>Build不是创作，是结构化。</strong></p>
<p>不是为了追求好不好、不是细节打磨、不是写完整。</p>
<p>而是一个作用：</p>
<p>👉<strong>把</strong> <strong>Input</strong> <strong>压缩成为一个“可以服用的形态”。</strong></p>
<p>它可以是：</p>
<p>一个你独有的公式、一个页面结构、一段Prompt模板。</p>
<p>目的只有一个：</p>
<p><strong>明天还能复用。</strong></p>
<p><strong>Ship不是发布，是暴露。</strong></p>
<p>不要追求数据好看、不要刻意去转化、不要说“改改再发”。</p>
<p>只做一件事：</p>
<p>👉<strong>让真实用户看见它。</strong></p>
<p>可以是：</p>
<p>一条小红书、一条即刻、发到群里、给一个真实用户用。</p>
<p>最低标准是：</p>
<p><strong>有人能对它产生反应。</strong></p>
<p>这三个步骤不能乱，也不能缺失任何一步。</p>
<p>只Input不Build：</p>
<p>收藏夹吃灰、笔记越来越多、认知越来越高级，<strong>但其实并没有进步，你只是在用“不断学习”来欺骗自己不要面对这个世界。</strong></p>
<p>只Build不Input：</p>
<p>拍脑门就干，凭感觉设计，凭感觉推演，伪需求解决 <strong>。短期很爽，但是长期一定跑偏，这是闭门造车。</strong></p>
<p>不Ship：</p>
<p>一直在优化，一直等更好，一直都是还没准备好。<strong>结果就是看起来很完整，其实从来没有被真实世界验证，这是最内耗的事情。</strong></p>
<blockquote>
<p><strong>没有 Ship 的 Build，都是幻觉</strong></p>
<p><strong>没有</strong> <strong>Input</strong> <strong>的 Build，都是臆测</strong></p>
<p><strong>没有 Build 的 Input，都是拖延</strong></p>
</blockquote>
<p>这就是 <strong>2 Hour Builder 的最小真相闭环。</strong></p>
<p>The 2-Hour Builder System 系列将持续更新，敬请关注</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大数据-208 岭回归与Lasso回归：区别、应用与选择指南]]></title>    <link>https://juejin.cn/post/7593338828195938344</link>    <guid>https://juejin.cn/post/7593338828195938344</guid>    <pubDate>2026-01-10T01:17:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195938344" data-draft-id="7593338828195921960" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大数据-208 岭回归与Lasso回归：区别、应用与选择指南"/> <meta itemprop="keywords" content="后端,大数据,机器学习"/> <meta itemprop="datePublished" content="2026-01-10T01:17:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="武子康"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大数据-208 岭回归与Lasso回归：区别、应用与选择指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    武子康
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T01:17:59.000Z" title="Sat Jan 10 2026 01:17:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>场景：解决多重共线性与过拟合问题</li>
<li>结论：岭回归适合高度相关特征，Lasso回归适合特征选择</li>
<li>产出：应用场景与正则化参数λ选择指导</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/530550724ede48d39350b13ca85cb640~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=IkAuZPHuLipefWOX4gPE%2F37aybQ%3D" alt="大数据-208 岭回归与Lasso回归：区别、应用与选择指南" loading="lazy"/></p>
<h2 data-id="heading-1">版本矩阵</h2>

























<table><thead><tr><th>版本</th><th>已验证</th><th>说明</th></tr></thead><tbody><tr><td>Ridge Regression (L2)</td><td>已验证</td><td>适用于高相关特征的场景，保持所有特征但压缩系数</td></tr><tr><td>Lasso Regression (L1)</td><td>已验证</td><td>适合高维数据和特征选择，能将部分系数压缩为零</td></tr><tr><td>Elastic Net</td><td>已验证</td><td>结合L1和L2正则化的优势，适合综合场景</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58382cac6aec4306ab50d1e232c99d11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=vtkckM%2Bnyw7yFR9yiiigi7i58%2BA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-2">岭回归和Lasso</h2>
<p>岭回归（Ridge Regression）和Lasso（Least Absolute Shrinkage and Selection Operator）是两种经典的线性回归正则化方法，专门用于解决机器学习中的过拟合问题和多重共线性问题。这两种方法的核心思想都是在普通最小二乘法（OLS）的基础上，通过引入不同的正则化项来约束模型参数。</p>
<ol>
<li>岭回归（L2正则化）：</li>
</ol>
<ul>
<li>添加L2范数惩罚项：在损失函数中加入回归系数平方和的惩罚项（λ∑β²）</li>
<li>特点：所有特征都会被保留，但系数会被压缩</li>
<li>适用场景：当特征之间存在高度相关性时（如基因表达数据）</li>
<li>数学表达式：min(∑(y_i - ŷ_i)² + λ∑β_j²)</li>
</ul>
<ol start="2">
<li>Lasso回归（L1正则化）：</li>
</ol>
<ul>
<li>添加L1范数惩罚项：在损失函数中加入回归系数绝对值的惩罚项（λ∑|β|）</li>
<li>特点：可以实现特征选择，部分系数会被压缩为零</li>
<li>适用场景：当特征维度很高且需要特征选择时（如文本分类）</li>
<li>数学表达式：min(∑(y_i - ŷ_i)² + λ∑|β_j|)</li>
</ul>
<p>实际应用中的典型场景：</p>
<ul>
<li>房价预测：当房屋特征（面积、房间数、地理位置等）存在多重共线性时</li>
<li>基因数据分析：处理成千上万个基因表达数据时</li>
<li>金融风控：从数百个财务指标中筛选关键风险因子</li>
</ul>
<p>这两种方法的区别主要体现在：</p>
<ol>
<li>岭回归会使所有系数都缩小但不为零，适合保留所有特征的情况</li>
<li>Lasso会使得部分系数变为零，实现特征选择</li>
<li>弹性网络（Elastic Net）结合了两者的优点，同时使用L1和L2正则化</li>
</ol>
<p>选择建议：</p>
<ul>
<li>当预测性能比可解释性更重要时，选择岭回归</li>
<li>当需要特征选择和模型可解释性时，选择Lasso</li>
<li>在实际应用中，通常需要通过交叉验证来确定最佳的正则化参数λ</li>
</ul>
<h3 data-id="heading-3">岭回归的原理</h3>
<p>岭回归是在普通线性回归的基础上加入了L2正则化项，使得模型更鲁棒。具体来说，岭回归的损失函数是普通最小二乘法的损失函数与一个L2正则化项之和。该正则化项是回归系数的平方和可以在极小化损失的同时，约束回归系数的大小，避免其过大从而导致模型过拟合。</p>
<h3 data-id="heading-4">Lasso回归的原理</h3>
<p>Lasso回归（Least Absolute Shrinkage and Selection Operator）与岭回归（Ridge Regression）都是线性回归的正则化变体，但它们在正则化方式上存在显著差异：</p>
<ol>
<li>正则化项类型：</li>
</ol>
<ul>
<li>Lasso回归采用L1正则化，即对系数绝对值之和进行惩罚：λΣ|β_j|</li>
<li>岭回归采用L2正则化，即对系数平方和进行惩罚：λΣβ_j²</li>
</ul>
<ol start="2">
<li>特征选择能力：</li>
</ol>
<ul>
<li>Lasso的L1惩罚会导致某些系数完全收缩为零，实现自动特征选择</li>
<li>岭回归的L2惩罚会使所有系数都趋向于变小，但不会完全归零</li>
</ul>
<ol start="3">
<li>数学特性差异：</li>
</ol>
<ul>
<li>Lasso的解在几何上对应菱形约束区域顶点</li>
<li>岭回归的解对应圆形约束区域</li>
</ul>
<ol start="4">
<li>适用场景对比：</li>
</ol>
<ul>
<li>当特征数量远大于样本量时（p&gt;&gt;n），Lasso通常表现更好</li>
<li>当存在高度相关特征时，岭回归往往更稳定</li>
</ul>
<ol start="5">
<li>
<p>实际应用示例：
在基因表达数据分析中（通常有数万个基因特征），Lasso能有效识别出少数关键基因；而在经济学时间序列预测中（特征间高度相关），岭回归能提供更稳健的预测。</p>
</li>
<li>
<p>参数选择：
两种方法都需要通过交叉验证确定最优正则化参数λ，但Lasso的λ通常需要更精细的网格搜索来捕捉特征选择的关键阈值。</p>
</li>
</ol>
<p>注意：在实践中，Elastic Net（结合L1和L2正则化）常被用作折中方案，兼具两种方法的优势。</p>
<h3 data-id="heading-5">解决方式</h3>
<p>解决共线性的问题的方法主要有以下三种：</p>
<ul>
<li>其一是在建模之前对各特征进行相关性检验，若存在多重共线性，则可以考虑进一步对数据集进行 SVD 分解或 PCA 主成分分析，在 SVD 或 PCA 执行的过程中会对数据集进行正交交换，最终所得数据集各列将不存在任务任何相关性。当然此举会对数据集的结构进行改变，且各列特征变得不可解释。</li>
<li>其二则是采用逐步回归的方法，以此选取对因变量解释力度最强的自变量，同时对于存在相关性的自变量加上一个惩罚因子，削弱其对因变量的解释力度，当然该方法不能完全避免多重共线性的存在，但能够绕过最小二乘法对共线性较为敏感的缺陷，构建线性回归模型。</li>
<li>其三则是在原有算法基础上进行修改，放弃对线性方程参数无偏估计的苛刻条件，使其能够容忍特征列存在多重共线性的情况，并且能够顺利建模，且尽可能的保证 SSE 取得最小值。</li>
</ul>
<p>通常来说，能够利用一个算法解决的问题尽量不用多个算的组合来解决，因此此处我们主要考虑后两个方案，其中逐步回归我们将放在线性回归的最后一部分进行讲解，而第三个解决方案，则是我们接下来需要详细讨论的岭回归算法和 Lasso 算法。</p>
<p>岭回归和Lasso回归在加入正则化项的方式上有所不同，从而影响模型的选择和应用。岭回归更适合用于避免系数过大而导致的过拟合，而Lasso在特征选择方面更有优势，因此通常在高维数据中表现更佳。在实际应用中，可以通过交叉验证来选择最适合的正则化参数并在岭回归和Lasso之间做出选择，或者结合两者（Elastic Net）以获得更好的模型效果。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5cfb546c1f24098a2ca4efb54d5ab79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=RyUswzqnC6oBASgeyUnlKkcHsMQ%3D" alt="对比 岭回归 Lasso" loading="lazy"/></p>
<h3 data-id="heading-6">岭回归</h3>
<h4 data-id="heading-7">基本原理</h4>
<p>岭回归算法实际上是针对线性回归算法局限性的一个改进类算法，优化目的是解决系数矩阵XTX不可逆的问题，客观上同时也起到了克服数据集存在多重共线性的情况，而岭回归的做法也非常简单，就是在原方程系数计算公式中添加了一个扰动项，原先无法求广义逆的情况变成了求出其广义逆，使得问题稳定并得以求解。
岭回归在多元线性回归的损失函数上加上了正则项，表达为系数 w 的 L2 范式（即系数 w 的平方项）乘以正则化系数 λ，岭回归的损失函数的完整表达式写作：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f20ec80dcdb8477abeaccd35e7dad630~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=ab1rU83C9W%2BQVWb1LGyEDYm4Ulk%3D" alt="岭回归公式" loading="lazy"/>
我们仍然可以使用最小二乘法求解，可得：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/244e87a046de4a64bd1bc4448b693549~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=UIjaIdoot9iSwKgWOT%2Bl9qdBXL8%3D" alt="岭回归公式" loading="lazy"/>
此举看似简单，实则非常精妙，用一个满秩的对角矩阵和原系数矩阵计算进行相加的，实际上起到了两个作用，其一是使得最终运算结果（XTX + λI）满秩，即降低了原数据集特征列的共线性影响，其二也相当于对所有的特征列的因变量解释程度进行了惩罚，且λ越大惩罚作用越强。</p>
<p>现在，只要（XTX + λI）存在逆矩阵，我们就可以求解。一个矩阵存在逆矩阵的充分必要条件是这个矩阵的行列式不为0。假设原本的特征矩阵中存在共线性，则我们的方阵 XTX 就会不满秩（存在完全为零的行）。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3adca07cfd1f43dc8aa33dba2718e05d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=BTL9MrkFCXvSeeJmpNbCALi5uo4%3D" alt="岭回归公式" loading="lazy"/></p>
<p>此时方阵 XTX 就是没有逆的，最小二乘法就无法使用，加上了λI 之后，我们的矩阵就大不一样了：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfba3e4aa1194494bd4b813e92536a30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=uBZqrlTYKRKxMU5r0GtEMCCP0w0%3D" alt="岭回归公式" loading="lazy"/>
最后得到的行列式还是一个梯形行列式，然而它已经不存在全 0 行或者全 0 列了，除非：</p>
<ul>
<li>λ 等于 0</li>
<li>原本的矩阵 XTX中存在对焦线上元素为 -λ，其他元素都为0 的行或者列</li>
</ul>
<p>否则矩阵 XTX+λI 永远都是满秩，在 sklearn 中，λ的值我们可以自由的控制，因此我们可以让它不为 0，比避免第一种情况。而第二种情况，如果我们发现某个λ的取值下模型无法求解，那我们只需要更换一个λ的取值就好了，也可以顺利避免。也就是说，矩阵的逆永远存在，有这个保障，我们的 w 就可以写作：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59c97df5f94a466aabf2c68e238b23fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=1vw7zBqhAYqVwnONZTlAasVc4a4%3D" alt="岭回归公式" loading="lazy"/>
如此，正则化系数λ就避免了精确相关关系带来的影响，至少最小二乘法在λ存在的情况下是一定可以使用。对于存在高度相关关系的矩阵，我们也可以通过调大λ，来让 XTX+λI 矩阵的行列式变大，从而让逆矩阵变小，以此控制参数向量 w 的偏移。当λ越大，模型越不容易受到共线性的影响。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7718dab865e4849bb8bed996bd6ef2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=SjiHQqqTZAtKiIb0TKE5ADS%2B32k%3D" alt="岭回归公式" loading="lazy"/></p>
<h3 data-id="heading-8">Lasso</h3>
<h4 data-id="heading-9">基本原理</h4>
<p>在岭回归中，对自变量系数进行平方和处理也被称做 L2 正则化，由于此原因，岭回归中自变量系数虽然会很快衰减，但很难归为零，且窜在共线性的时候衰减过程也并非严格递减，这就是为何岭回归能够建模、判断共线性，但很难进行变量筛选的原因。为了弥补岭回归在这方面的不足，Tibshirani（1996）提出了 Lasso（The Least Absolute Shrinkage and Selectiontorperator）算法，将岭回归的损失函数中的自变量系数 L2 正则化修改为 L1 正则化，即 Lasso 回归损失函数为：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/464f28c318fe4051bf853471917759dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=lCv9O5LEL6YhT7JrH2%2FyjW2B8Ls%3D" alt="Lasso公式" loading="lazy"/>
我们来看看 Lasso 的计算过程，当我们使用最小二乘法来求解 Lasso 中参数，我们依然对损失函数进行求导：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/415f8fa71fd1494e8071020b13c077b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=2YEP4zRU%2F3XE5Laf%2BvL6D1b89h4%3D" alt="Lasso公式" loading="lazy"/>
现在问题又回到了要求 XTX 的逆必须存在，在岭回归中，我们通过正则化系数λ能够向方阵 XTX 加上一个单位矩阵，以此来防止方阵 XTX 的行列式为 0，而现在 L1 范式所带的正则项λ在求导之后并不带有w 这个项，因此它无法对 XTX 造成任何影响。
也就是说，Lasso 无法解决特征之间精确相关的问题，当我们使用最小二乘法求解线性回归时，如果线性回归无解或者报除零的错误，换 Lasso 不能解决任何问题。
不过，在现实中我们其实会比较少遇到精确相关的多重共线性问题，大部分多重共线性问题应该时高度相关，而如果我们假设方阵 XTX 的逆是一定存在的，那我们可以有：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8af59a4f660f4c8083c7c76e147335a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768612678&amp;x-signature=sg2b%2BTzR7GEsPMsTYtnl3hvZEg4%3D" alt="Lasso公式" loading="lazy"/>
通过增大λ，我们可以为 w 的计算增加一个负项，从而限制参数估计中 w 的大小，而防止多重共线性引起的参数 w 被估计过大导致模型失准的问题，Lasso 不是从根本上解决多重共线性问题，是限制多重共线性带来的影响。</p>
<h2 data-id="heading-10">错误速查</h2>

























<table><thead><tr><th>症状</th><th>根因</th><th>定位修复方法</th></tr></thead><tbody><tr><td>无法求解模型</td><td>特征矩阵共线性</td><td>特征矩阵XTX不可逆，通过岭回归或增大λ值</td></tr><tr><td>过拟合</td><td>模型复杂度过高</td><td>特征过多且无有效选择，使用Lasso进行特征选择</td></tr><tr><td>特征选择不足</td><td>岭回归无法将特征压缩为零</td><td>需要自动化特征选择，使用Lasso或Elastic Net</td></tr></tbody></table>
<h2 data-id="heading-11">其他系列</h2>
<h3 data-id="heading-12">🚀 AI篇持续更新中（长期更新）</h3>
<p><strong>AI炼丹日志-29 - 字节跳动 DeerFlow 深度研究框<em>斜体样式</em>架 私有部署 测试上手 架构研究</strong>，持续打造实用AI工具指南！
<strong>AI研究-132 Java 生态前沿 2025：Spring、Quarkus、GraalVM、CRaC 与云原生落地</strong></p>
<h3 data-id="heading-13">💻 Java篇持续更新中（长期更新）</h3>
<p><strong>Java-218 RocketMQ Java API 实战：同步/异步 Producer 与 Pull/Push Consumer</strong>
MyBatis 已完结，Spring 已完结，Nginx已完结，Tomcat已完结，分布式服务已完结，Dubbo已完结，MySQL已完结，MongoDB已完结，Neo4j已完结，FastDFS 已完结，OSS已完结，GuavaCache已完结，EVCache已完结，RabbitMQ已完结，RocketMQ正在更新... 深入浅出助你打牢基础！</p>
<h3 data-id="heading-14">📊 大数据板块已完成多项干货更新（300篇）：</h3>
<p>包括 Hadoop、Hive、Kafka、Flink、ClickHouse、Elasticsearch 等二十余项核心组件，覆盖离线+实时数仓全栈！
<strong>大数据-278 Spark MLib - 基础介绍 机器学习算法 梯度提升树 GBDT案例 详解</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DeepSeek V4，定档春节]]></title>    <link>https://juejin.cn/post/7593481317250220058</link>    <guid>https://juejin.cn/post/7593481317250220058</guid>    <pubDate>2026-01-10T01:23:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593481317250220058" data-draft-id="7593177437082337331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DeepSeek V4，定档春节"/> <meta itemprop="keywords" content="人工智能,AIGC"/> <meta itemprop="datePublished" content="2026-01-10T01:23:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="童欧巴"/> <meta itemprop="url" content="https://juejin.cn/user/3491704662669469"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DeepSeek V4，定档春节
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3491704662669469/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    童欧巴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T01:23:43.000Z" title="Sat Jan 10 2026 01:23:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p>兄弟们，坐稳了，大的真要来了。</p>
<p>外媒《The Information》刚刚捅出一个猛料。</p>
<p>DeepSeek V4 定档春节，计划 2 月中旬发布。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8da23f25342e40468d3fd8a6d458f1f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=ljQw6kLEd11r8ZIO%2BgLTbhN98BA%3D" alt="" loading="lazy"/></p>
<p>而且，这次的目标很明确，显著提升了编程能力。</p>
<p>注意，这绝对不是一次常规的升级。</p>
<p>据多位参与内部测试的人士透露，在多个内部编程基准中。</p>
<p>DeepSeek V4 已经直接超越了当前全球范围内的主流模型。</p>
<p>虽然官方还没回应，但我觉得这事儿大概率是真的。</p>
<p>因为最近，DeepSeek 悄咪咪的把 DeepSeek R1 的论文更新了。</p>
<p>从原来的 22 页直接加厚到 86 页。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef04e2166de64c22aa616bd32bbf719b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=f5%2B9gzb5ZSe6IeUQbIj9Er1gdlA%3D" alt="https://arxiv.org/abs/2501.12948" loading="lazy"/></p>
<p>还有，最新版的 DeepSeek 手机 App，新增了语音输入。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3bf6304215d4bc9948898cc8d5aed0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=Z7kswUv0O1Ihk%2FqXdTKXx5O7h1g%3D" alt="" loading="lazy"/></p>
<p>一切迹象，都像极了在给新模型做预热。</p>
<p>真的要好好期待一下了。</p>
<p>新模型还在路上，但更新的论文还是非常精彩的。</p>
<p>我看完之后，先来跟大家分享三点。</p>
<h2 data-id="heading-0">1</h2>
<p>训练出 R1 这样，一个能跟 OpenAI 的 o1 掰手腕的模型。</p>
<p>总共花了多少钱呢？</p>
<p>看这张表格。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f62076c4555c43f197288ca9528ecb54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=Q7aAgGcaWwu0bx7LojT22G1xTeM%3D" alt="" loading="lazy"/></p>
<p>你没看错，29.4 万美元。</p>
<p>相比之下，海外大模型训练，动不动就是千万美元，上亿美元。</p>
<p>29.4 万美元，在硅谷连一个资深工程师一年的工资都不够。</p>
<p>这事儿最打脸的，就是前 Scale AI 的 CEO，Meta 现任首席 AI 官，Alexandr Wang 了。</p>
<p>他经常说，必须要用昂贵的人工标注数据，天价的算力和顶级的芯片才能做出顶级 AI。</p>
<p>这回 DeepSeek 更新完的论文，相当于一份完全可复现的技术报告。</p>
<p>现在所有的证据都摆在这了。</p>
<p>还花钱看啥爽剧啊，还有比 DeepSeek 更燃的主角吗？</p>
<h2 data-id="heading-1">2</h2>
<p>说真的，再次看到这，我还是起了点鸡皮疙瘩。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0e1ac4299a34edda4cdfe9f56a8da65~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=dETHYRk3oXQ85qFIgvmI1uyZMew%3D" alt="" loading="lazy"/></p>
<p>上图的红字是 AI 的思考过程，翻译过来的意思是。</p>
<p><strong>等等，等等，等一下，这正是我要标记的一个顿悟时刻。</strong></p>
<p>这就是强化学习的威力和魅力。</p>
<p>以前训练 AI 爹味十足，像教小孩儿一样，手把手一步一步教他步骤。</p>
<p>这次，DeepSeek 选择了放手，不教你怎么思考，只告诉你答案对不对。</p>
<p>答对了给颗糖，答错了就饿着。</p>
<p>结果在没有任何人教导的情况下，AI 的思考过程中涌现了人类才有的犹豫。</p>
<p>为了获得奖励，AI 居然进化出了自我博弈。</p>
<p>听着很抽象。</p>
<p>这就像你考试答题落笔之前，眉头紧锁，停顿的那几秒。</p>
<p>这声 Wait，是 AI 在一片混沌中，点燃的第一根火柴。</p>
<h2 data-id="heading-2">3</h2>
<p>在论文的蒸馏部分，DeepSeek 回答了一个更具颠覆性的问题。</p>
<p>R1 身上的能力，能不能有效稳定的迁移到小模型上呢？</p>
<p>能，而且效果炸裂。</p>
<p>让 R1 当老师，生成高质量的思维链数据，然后通过监督微调 SFT，直接把这套内功心法传授给小模型。</p>
<p>这就是蒸馏。</p>
<p>好比武林盟主把自己毕生领悟的剑法写成了秘籍，直接扔给了小师弟们。</p>
<p>小师弟们不用再去江湖上挨打试错，不用再跑一遍强化学习的流程，直接照着练就行。</p>
<p>DeepSeek 系统性地实验了 1.5B、7B、8B、14B、32B、70B 等各种规模的小模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55cd887eb818419eb282b8b26c5ec60c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=wDwParAYjZDR6zW8WlW5yGbJPFU%3D" alt="" loading="lazy"/></p>
<p>不管啥尺寸，蒸馏之后性能都得到了大幅提升。</p>
<p>顶级的智能，可以像水一样流动，以更低成本的无缝迁移到小模型身上。</p>
<p>听着有些魔幻，但这才是 DeepSeek 一直所追求的事情。</p>
<p>让智能像自来水一样，便宜且触手可及。</p>
<h2 data-id="heading-3">尾声</h2>
<p>他们建起了高墙，挖深了护城河。</p>
<p>墙内本来 2 块钱的面包，卖到了 200 块。</p>
<p>有一天，DeepSeek 来到墙跟前，狠狠地踹了这堵墙一脚。</p>
<p>墙塌了。</p>
<p>大家往里一看，发面里面没有什么魔法，也没有什么神迹。</p>
<p>有的只是极致的数学，纯粹的逻辑，和一群充满好奇心的工程师。</p>
<p>DeepSeek 官网有句话，我真的特别特别喜欢。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/decd96fe43fb4e5ba9c46d9744bd54a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56ul5qyn5be0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768613022&amp;x-signature=a6PQcfkE4FRgTJJmG3efkRjdku0%3D" alt="" loading="lazy"/></p>
<p>探索未至之境。</p>
<p>是啊，我们要永远去探索前人尚未探索之地。</p>
<p>这才是人最应该做的事情，来牵引 AI 走向我们认可的方向。</p>
<p>敢问路在何方？</p>
<p>路，其实就在我们每个人的脚下。</p>
<h2 data-id="heading-4">❤️爱心三连击</h2>
<p>1.如果你觉得欧巴的文章还合胃口，就点个赞支持下吧，你的<strong>赞</strong>是我最大的动力。</p>
<p>2.关注&gt;&gt;&gt;<a href="https://link.juejin.cn?target=https%3A%2F%2Fraw.githubusercontent.com%2FGeekhyt%2Ffront-end-canteen%2Frefs%2Fheads%2Fmaster%2Fimages%2Fqrcode.jpg" target="_blank" title="https://raw.githubusercontent.com/Geekhyt/front-end-canteen/refs/heads/master/images/qrcode.jpg" ref="nofollow noopener noreferrer">公众号欧巴聊AI</a>，AI 时代陪你一起成长。</p>
<p>3.点赞、评论、转发 === 催更！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go语言动手写Web框架 - Gee第四天 分组控制]]></title>    <link>https://juejin.cn/post/7593098101432631350</link>    <guid>https://juejin.cn/post/7593098101432631350</guid>    <pubDate>2026-01-09T12:44:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593098101432631350" data-draft-id="7593165280488636457" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go语言动手写Web框架 - Gee第四天 分组控制"/> <meta itemprop="keywords" content="后端,Go"/> <meta itemprop="datePublished" content="2026-01-09T12:44:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Way2top"/> <meta itemprop="url" content="https://juejin.cn/user/1458388314893300"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go语言动手写Web框架 - Gee第四天 分组控制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1458388314893300/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Way2top
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:44:45.000Z" title="Fri Jan 09 2026 12:44:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">Group 设计的原因</h4>
<p>随着 Gee 支持了动态路由匹配，新的结构性问题也随之出现。 在真实的 Web 开发中，路由并非同质的，而是天然存在语义分层。例如：以 <code>/post</code> 开头的路由允许匿名访问；以 <code>/admin</code> 开头的路由需要鉴权；以 <code>/api</code> 开头的路由面向第三方平台，需要额外的鉴权与限制。</p>
<p>如果希望对所有 <code>/admin</code> 类型接口统一做鉴权，在当前仅支持动态路由匹配的框架能力下，就只能在每一个 <code>/admin</code> 路由中重复编写鉴权逻辑。这不仅带来大量重复代码，也违背了开闭原则（OCP），并且使横切逻辑难以维护和扩展。同样地，如果希望对 <code>/post</code> 路由统一增加一组中间件来扩展能力，现有结构也难以优雅支持。</p>
<p>问题因此自然演化为：<strong>如何在不修改已有路由定义的前提下，为一类路由统一施加行为？</strong> 这实际上要求框架中引入“路由作用域”的概念，而不仅仅是“路径匹配”。</p>
<p>一个直观的想法是：是否可以直接在 router 结构体中加入分组相关的数据结构？</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> router <span class="hljs-keyword">struct</span> {
        roots    <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*node
        handlers <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]HandlerFunc
}
</code></pre>
<p>但这在设计上并不合理。<strong>router 的职责被严格限定为：根据 Method + Path 进行匹配并找到对应的 handler。</strong> 它是一个偏算法和数据结构的组件，只关心匹配规则本身，而不关心任何业务语义。</p>
<p>中间件则恰恰相反：它承载的是强业务语义（如鉴权、日志、限流），与作用域密切相关，却与具体的路径匹配算法无关。如果将中间件直接挂载在 router 上，就会迫使 router 同时承担“路径匹配”和“业务控制”两种职责，从而破坏其单一职责原则，也使路由匹配层被业务语义污染。</p>
<p>因此，引入 RouterGroup 本质上是引入一个独立于匹配算法之外的“路由作用域”抽象。它以 URL 前缀作为边界，将一组路由组织到同一语义空间中，使中间件能够按组复用、按层叠加，而 router 仍然只专注于路径匹配本身。这正是中间件必须基于 Group，而不能直接基于 Router 的根本原因。</p>
<h4 data-id="heading-1">Group 具体设计</h4>
<p>接下来我们考虑如何设计 Group 的结构。既然 Group 是用来区分不同路由分组以及承载中间件的，那么肯定要有一个 <code>perfix</code> 来用于区分不同分组（根据路由的前缀进行分组），而用于承载中间件的话可以使用一个 <code>[]HandlerFunc</code> 用于存放多个中间件。另外，我们支持分组嵌套，例如对于 <code>/admin/golang</code> 这个路由来说，<code>/admin</code> 包含的中间件 <code>/admin/golang</code> 也应该拥有，为了实现这一点，还需要有一个 <code>parent</code> 属性用于记录当前路由的上级路由，这样上级路由所拥有的中间件就可以集成到后续的子路由中了。</p>
<p>最后，既然 <code>Group</code> 对象需要进行一些路由操作，那么还需要有访问 <code>Router</code> 的能力。为了方便，我们可以在 <code>Group</code> 中保存一个指针，指向 <code>Engine</code>，因为整个框架的资源都是由 <code>Engine</code> 统一协调的，这样做之后就可以通过 <code>Engine</code> 间接的访问各种借口了。因此，最终 <code>Group</code> 的结构如下：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> RouterGroup <span class="hljs-keyword">struct</span> {
        prefix      <span class="hljs-type">string</span>
        middlewares []HandlerFunc <span class="hljs-comment">// 支持中间件</span>
        parent      *RouterGroup  <span class="hljs-comment">// 支持嵌套</span>
        engine      *Engine       <span class="hljs-comment">// 所有 group 共享一个 Engine 实例</span>
}
</code></pre>
<p>我们还可以进一步地抽象，将<code>Engine</code>作为最顶层的分组，也就是说<code>Engine</code>拥有<code>RouterGroup</code>所有的能力。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">type</span> Engine struct {
        *RouterGroup
        router *router
        <span class="hljs-built_in">groups</span> []*RouterGroup // 存储所有 <span class="hljs-built_in">groups</span>
}
</code></pre>
<p>有关为什么要进一步抽象来将 <code>Engine</code> 作为最顶层，具体原因如下：如果不将 <code>Engine</code> 修改为拥有 <code>RouterGroup</code> 的能力，<code>Engine</code> 仅仅定义 <code>RouterGroup</code> 的话，后续会在创建和管理路由分组时遇到问题。比如，我们需要频繁地通过 <code>Engine</code> 访问 <code>RouterGroup</code>，并且在 <code>RouterGroup</code> 中定义路由的功能会显得不够直观，尤其是在需要分组嵌套或统一管理多个分组的情况下，代码会变得更加复杂且不易扩展。进而我们想到将 <code>Engine</code> 修改为直接包含 <code>RouterGroup</code> 的能力，这样 <code>Engine</code> 就能像 <code>RouterGroup</code> 一样，直接支持路由分组的创建、管理和中间件的使用，使得路由分组的功能更加统一和灵活。修改后，<code>Engine</code> 不仅管理路由，还能管理分组和中间件，简化了代码结构，避免了冗余的接口调用，使得代码更加简洁、易于维护和扩展。</p>
<p>那么定义好 Group 之后，我们就可以对 gee.go 中的内容进行重写了：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Group 用于创建一个新的 RouterGroup</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> Group(prefix <span class="hljs-type">string</span>) *RouterGroup {
        engine := group.engine
        newGroup := &amp;RouterGroup{
                prefix: group.prefix + prefix,
                parent: group,
                engine: engine,
        }
        engine.groups = <span class="hljs-built_in">append</span>(engine.groups, newGroup)
        <span class="hljs-keyword">return</span> newGroup
}

<span class="hljs-comment">// 工具函数，后续 GET 和 POST 会使用这个函数给 engine 的路由表添加路由</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> addRoute(method <span class="hljs-type">string</span>, comp <span class="hljs-type">string</span>, handler HandlerFunc) {
        pattern := group.prefix + comp
        log.Printf(<span class="hljs-string">"Route %4s - %s"</span>, method, pattern)
        group.engine.router.addRoute(method, pattern, handler)
        <span class="hljs-comment">//engine.router.addRoute(method, pattern, handler)</span>
}

<span class="hljs-comment">// GET 提供给用户注册 GET 请求的便捷方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> GET(pattern <span class="hljs-type">string</span>, handler HandlerFunc) {
        group.addRoute(<span class="hljs-string">"GET"</span>, pattern, handler)
}

<span class="hljs-comment">// POST 提供给用户注册 POST 请求的便捷方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(group *RouterGroup)</span></span> POST(pattern <span class="hljs-type">string</span>, handler HandlerFunc) {
        group.addRoute(<span class="hljs-string">"POST"</span>, pattern, handler)
}
</code></pre>
<p>最后，写完之后可以进行测试：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// main.go</span>
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
        <span class="hljs-string">"gee"</span>
        <span class="hljs-string">"net/http"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
        r := gee.New()
        r.GET(<span class="hljs-string">"/index"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                c.HTML(http.StatusOK, <span class="hljs-string">"&lt;h1&gt;Index Page&lt;/h1&gt;"</span>)
        })
        v1 := r.Group(<span class="hljs-string">"/v1"</span>)
        {
                v1.GET(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                        c.HTML(http.StatusOK, <span class="hljs-string">"&lt;h1&gt;Hello Gee&lt;/h1&gt;"</span>)
                })

                v1.GET(<span class="hljs-string">"/hello"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                        <span class="hljs-comment">// 期望 /hello?name=way2top</span>
                        c.String(http.StatusOK, <span class="hljs-string">"hello %s, you're at %s\n"</span>, c.Query(<span class="hljs-string">"name"</span>), c.Path)
                })
        }
        v2 := r.Group(<span class="hljs-string">"/v2"</span>)
        {
                v2.GET(<span class="hljs-string">"/hello/:name"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                        <span class="hljs-comment">// 期望 /hello/way2top</span>
                        c.String(http.StatusOK, <span class="hljs-string">"hello %s, you're at %s\n"</span>, c.Param(<span class="hljs-string">"name"</span>), c.Path)
                })
                v2.POST(<span class="hljs-string">"/login"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gee.Context)</span></span> {
                        c.JSON(http.StatusOK, gee.H{
                                <span class="hljs-string">"username"</span>: c.PostForm(<span class="hljs-string">"username"</span>),
                                <span class="hljs-string">"password"</span>: c.PostForm(<span class="hljs-string">"password"</span>),
                        })
                })
        }

        r.Run(<span class="hljs-string">":9999"</span>)
}
</code></pre>
<p>终端测试：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/index   </span>
&lt;<span class="hljs-selector-tag">h1</span>&gt;<span class="hljs-selector-tag">Index</span> <span class="hljs-selector-tag">Page</span>&lt;/<span class="hljs-selector-tag">h1</span>&gt;%                              
<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/v1</span>
&lt;<span class="hljs-selector-tag">h1</span>&gt;<span class="hljs-selector-tag">Hello</span> <span class="hljs-selector-tag">Gee</span>&lt;/<span class="hljs-selector-tag">h1</span>&gt;%                               
<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/v1/</span>
&lt;<span class="hljs-selector-tag">h1</span>&gt;<span class="hljs-selector-tag">Hello</span> <span class="hljs-selector-tag">Gee</span>&lt;/<span class="hljs-selector-tag">h1</span>&gt;%                               
<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/v1/hello</span>
<span class="hljs-selector-tag">hello</span> , <span class="hljs-selector-tag">you</span>'<span class="hljs-selector-tag">re</span> <span class="hljs-selector-tag">at</span> /<span class="hljs-selector-tag">v1</span>/<span class="hljs-selector-tag">hello</span>

<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/v2      </span>
<span class="hljs-number">404</span> <span class="hljs-selector-tag">NOT</span> <span class="hljs-selector-tag">FOUND</span>: <span class="hljs-selector-tag">&amp;</span><span class="hljs-selector-tag">s</span>
%!(EXTRA string=/v2)%                             
<span class="hljs-selector-tag">Gee</span> <span class="hljs-selector-tag">on</span>  <span class="hljs-selector-tag">main</span> <span class="hljs-selector-attr">[!]</span> <span class="hljs-selector-tag">via</span>  <span class="hljs-selector-tag">v1</span><span class="hljs-selector-class">.24</span><span class="hljs-selector-class">.3</span> 
❯ <span class="hljs-selector-tag">curl</span> <span class="hljs-selector-tag">http</span>:<span class="hljs-comment">//localhost:9999/v2/hello/way</span>
<span class="hljs-selector-tag">hello</span> <span class="hljs-selector-tag">way</span>, <span class="hljs-selector-tag">you</span>'<span class="hljs-selector-tag">re</span> <span class="hljs-selector-tag">at</span> /<span class="hljs-selector-tag">v2</span>/<span class="hljs-selector-tag">hello</span>/<span class="hljs-selector-tag">way</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年React生态最新趋势：我从Redux迁移到Zustand后性能提升40%的心得]]></title>    <link>https://juejin.cn/post/7593240931286548532</link>    <guid>https://juejin.cn/post/7593240931286548532</guid>    <pubDate>2026-01-10T00:16:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593240931286548532" data-draft-id="7593240931286532148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年React生态最新趋势：我从Redux迁移到Zustand后性能提升40%的心得"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-10T00:16:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年React生态最新趋势：我从Redux迁移到Zustand后性能提升40%的心得
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T00:16:46.000Z" title="Sat Jan 10 2026 00:16:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>2025年React生态最新趋势：我从Redux迁移到Zustand后性能提升40%的心得</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>在React生态系统中，状态管理一直是开发者们热议的话题。从早期的Flux架构到Redux的统治地位，再到近年来轻量级解决方案的崛起，状态管理库的演进从未停止。2025年，随着React Concurrent Features的全面普及和开发者对性能的极致追求，Zustand凭借其简洁性、高性能和可扩展性，逐渐成为许多团队的首选。</p>
<p>作为一名长期使用Redux的前端工程师，我在最近的项目中完成了从Redux到Zustand的迁移，并见证了高达40%的性能提升。本文将分享这一迁移过程中的技术细节、性能优化心得以及对未来React状态管理趋势的思考。</p>
<hr/>
<h2 data-id="heading-2">主体</h2>
<h3 data-id="heading-3">1. Redux的历史与挑战</h3>
<p>Redux自2015年诞生以来，一直是React生态中最主流的状态管理方案。其单向数据流、纯函数Reducer和Middleware机制为大型应用提供了可预测的状态管理能力。然而，随着时间的推移，Redux的一些问题也逐渐暴露：</p>
<ul>
<li><strong>模板代码过多</strong>：即使是一个简单的状态更新，也需要定义Action、Reducer和Dispatcher。</li>
<li><strong>性能开销</strong>：基于Context API的实现方式导致不必要的组件重渲染问题。</li>
<li><strong>学习曲线陡峭</strong>：对于新手来说，Redux的概念（如Middleware、Thunk/Saga）较为复杂。</li>
</ul>
<p>尽管Redux Toolkit（RTK）在2019年后大幅简化了开发流程，但在2025年的高并发场景下，其性能瓶颈依然存在。</p>
<h3 data-id="heading-4">2. Zustand的核心优势</h3>
<p>Zustand是一个由Poimandres团队开发的轻量级状态管理库，其设计哲学是“简单且高效”。以下是Zustand的核心优势：</p>
<h4 data-id="heading-5">（1）极简API</h4>
<p>Zustand的API非常简洁，只需几行代码即可定义一个Store：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;

<span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">increment</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">count</span>: state.<span class="hljs-property">count</span> + <span class="hljs-number">1</span> })),
}));
</code></pre>
<p>相比Redux的模板代码，Zustand的开发效率显著提升。</p>
<h4 data-id="heading-6">（2）精准更新</h4>
<p>Zustand基于Proxy实现细粒度响应式更新，只有依赖特定状态的组件才会重新渲染。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Component</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">useStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span>);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
};
</code></pre>
<p>即使Store中的其他状态变化了（如<code>user</code>字段），只要<code>count</code>未变，该组件就不会重渲染。</p>
<h4 data-id="heading-7">（3）原生支持异步操作</h4>
<p>Zustand无需Middleware即可直接处理异步逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> useStore = <span class="hljs-title function_">create</span>(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">data</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">fetchData</span>: <span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>);
    <span class="hljs-title function_">set</span>({ <span class="hljs-attr">data</span>: <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>() });
  },
}));
</code></pre>
<h4 data-id="heading-8">（4）卓越的性能表现</h4>
<p>在2025年的基准测试中（来源：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkrausest%2Fjs-framework-benchmark" target="_blank" title="https://github.com/krausest/js-framework-benchmark" ref="nofollow noopener noreferrer">JS Framework Benchmark</a>），Zustand在万级组件场景下的渲染性能比Redux快40%以上。这主要得益于其避免了Context API的开销和优化的订阅机制。</p>
<h3 data-id="heading-9">3. 迁移实践与性能优化</h3>
<h4 data-id="heading-10">（1）渐进式迁移策略</h4>
<p>我们的项目是一个拥有10万+行代码的大型企业应用。为了降低风险，我们采用了渐进式迁移策略：</p>
<ol>
<li><strong>新功能优先使用Zustand</strong>：避免在老代码上投入更多精力。</li>
<li><strong>逐步替换Redux模块</strong>：从低频更新的模块开始迁移（如用户配置）。</li>
<li><strong>共享状态桥接</strong>：通过自定义Hook实现Redux和Zustand的状态同步：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">useCombinedStore</span> = (<span class="hljs-params">selector</span>) =&gt; {
  <span class="hljs-keyword">const</span> reduxState = <span class="hljs-title function_">useSelector</span>(selector);
  <span class="hljs-keyword">const</span> zustandState = <span class="hljs-title function_">useZustandStore</span>(selector);
  <span class="hljs-keyword">return</span> reduxState || zustandState;
};
</code></pre>
</li>
</ol>
<h4 data-id="heading-11">（2）关键性能优化点</h4>
<ul>
<li><strong>避免嵌套Selectors</strong>：深度嵌套的选择器会触发不必要的计算。</li>
<li><strong>使用Shallow比较</strong>：对于复杂对象，使用<code>shallow</code>比较函数减少重渲染：
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { shallow } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand/shallow'</span>;
<span class="hljs-keyword">const</span> { user, profile } = <span class="hljs-title function_">useStore</span>(
  <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">user</span>: state.<span class="hljs-property">user</span>, <span class="hljs-attr">profile</span>: state.<span class="hljs-property">profile</span> }),
  shallow
);
</code></pre>
</li>
<li><strong>合理拆分Store</strong>：按业务域拆分多个小型Store而非单一全局Store。</li>
</ul>
<h4 data-id="heading-12">（3）实际效果对比</h4>
<p>迁移完成后，我们通过React Profiler进行了量化对比：</p>





























<table><thead><tr><th>Metric</th><th>Redux</th><th>Zustand</th><th>Improvement</th></tr></thead><tbody><tr><td>Render Time (ms)</td><td>120</td><td>72</td><td>-40%</td></tr><tr><td>Bundle Size (KB)</td><td>45</td><td>8</td><td>-82%</td></tr><tr><td>LOC</td><td>~1500</td><td>~400</td><td>-73%</td></tr></tbody></table>
<h3 data-id="heading-13">4. React未来生态的趋势展望</h3>
<p>基于这次迁移经验和2025年的技术发展动态，我认为以下趋势将成为主流：</p>
<h4 data-id="heading-14">（1）轻量化成为刚需</h4>
<p>随着Web应用的复杂度持续增长，“零开销”理念将更受重视。类似Zustand、Jotai这样的轻量级库会进一步挤压Redux的市场份额。</p>
<h4 data-id="heading-15">（2）并发模式友好设计</h4>
<p>React Server Components和Concurrent Features要求状态管理库具备更高的调度灵活性。Zustands的可中断更新机制比传统的单向数据流更具优势。</p>
<h4 data-id="heading-16">（3）类型安全成为标配</h4>
<p>TypeScript的使用率已超过90%，新一代状态管理库都会优先考虑类型推导能力（如Zustands出色的自动类型推断）。</p>
<hr/>
<h2 data-id="heading-17">总结</h2>
<p>从Redux到Zustands的迁移不仅是一次技术栈升级</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建现代化的 Python PostgreSQL 工具库：psql_utils 的重构与优化之旅]]></title>    <link>https://juejin.cn/post/7593338828195889192</link>    <guid>https://juejin.cn/post/7593338828195889192</guid>    <pubDate>2026-01-10T00:33:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195889192" data-draft-id="7593193235251740724" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建现代化的 Python PostgreSQL 工具库：psql_utils 的重构与优化之旅"/> <meta itemprop="keywords" content="Python,PostgreSQL"/> <meta itemprop="datePublished" content="2026-01-10T00:33:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lupino"/> <meta itemprop="url" content="https://juejin.cn/user/3051900006579256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建现代化的 Python PostgreSQL 工具库：psql_utils 的重构与优化之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3051900006579256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lupino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T00:33:12.000Z" title="Sat Jan 10 2026 00:33:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在现代 Python 后端开发中，轻量级且高效的数据库交互工具至关重要。本文将总结 <code>psql_utils</code> 库的架构设计与重构过程。这是一个基于 <code>psycopg</code> 3 构建的 PostgreSQL 工具库，旨在提供类型安全、同时支持同步（Sync）与异步（Async）的高级数据操作接口。</p>
<h2 data-id="heading-0">1. 项目概览与架构设计</h2>
<p><code>psql_utils</code> 并没有采用全功能的 ORM（对象关系映射）模式，而是选择了一种更轻量级的“SQL 构建器 + 记录操作”模式。这种设计在保持 SQL 灵活性的同时，大大简化了常见的 CRUD 操作。</p>
<p>项目核心由以下几个模块组成：</p>
<ul>
<li><strong>类型定义与 SQL 构建 (<code>types.py</code>, <code>gen_sql.py</code>)</strong> : 负责将 Python 对象转换为 SQL 语句，避免了容易出错的字符串拼接。</li>
<li><strong>连接池管理 (<code>__init__.py</code>, <code>sync.py</code>)</strong> : 分别提供了基于 <code>asyncio</code> 的异步连接池和基于线程的同步连接池，二者共享相似的 API 设计。</li>
<li><strong>记录操作抽象 (<code>record.py</code>, <code>record_sync.py</code>, <code>record_utils.py</code>)</strong> : 在 SQL 构建之上封装了 <code>get</code> (查询), <code>save</code> (插入/更新), <code>remove</code> (删除) 等高层业务逻辑。</li>
<li><strong>打包配置 (<code>pyproject.toml</code>, <code>setup.py</code>)</strong> : 遵循现代 Python 打包标准。</li>
</ul>
<h2 data-id="heading-1">2. 核心重构与优化点</h2>
<p>在对代码库的全面审查中，我们实施了严格的 PEP 8 规范，并修复了潜在的运行时错误。以下是本次重构的关键优化点：</p>
<h3 data-id="heading-2">A. 修复可变默认参数 (Mutable Default Arguments)</h3>
<p>这是 Python 中最常见的陷阱之一。在原代码中，多个函数使用了 <code>list</code> 作为默认参数（例如 <code>keys=[]</code>）。这会导致列表对象在函数调用间共享，从而引发难以调试的状态污染 bug。</p>
<p><strong>优化前：</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini">def __init__(self, <span class="hljs-attr">joins</span>=[]):  <span class="hljs-comment"># 危险！所有实例共享同一个列表</span>
    <span class="hljs-attr">self.joins</span> = joins
</code></pre>
<p><strong>优化后：</strong></p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, joins: <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[LeftJoin]] = <span class="hljs-literal">None</span></span>):
    <span class="hljs-comment"># 安全：每次初始化都创建新列表</span>
    self.joins = joins <span class="hljs-keyword">if</span> joins <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> []
</code></pre>
<h3 data-id="heading-3">B. 类型提示与安全性 (Type Hinting)</h3>
<p>引入了 <code>typing</code> 模块（<code>Optional</code>, <code>List</code>, <code>Union</code>, <code>Callable</code>），配合 <code>mypy_extensions</code>，极大地增强了代码的可读性和 IDE 的自动补全能力。所有函数签名现在都清晰地表明了输入输出类型，减少了类型相关的运行时错误。</p>
<h3 data-id="heading-4">C. 代码风格与规范 (PEP 8 &amp; 79字符限制)</h3>
<p>为了适应各种开发环境（包括终端编辑器和分屏开发），我们强制执行了每行不超过 79 个字符的标准。</p>
<ul>
<li><strong>字符串格式化</strong>：将陈旧的 <code>.format()</code> 方法全面替换为 Python 3.6+ 的 f-string，不仅代码更短，性能也更优。</li>
<li><strong>文档注释</strong>：为核心类和函数添加了清晰的英文 Docstrings，解释了参数用途和返回值。</li>
</ul>
<h3 data-id="heading-5">D. 连接池的健壮性</h3>
<p>在 <code>__init__.py</code> (Async) 和 <code>sync.py</code> (Sync) 中，使用了装饰器模式 (<code>@run_with_pool</code>) 来自动管理数据库游标（Cursor）的生命周期。</p>
<ul>
<li><strong>自动重连</strong>：当检测到连接断开（如 <code>closing</code> 错误）时，装饰器会自动尝试重新建立连接池并重试操作，大大提高了服务在数据库重启或网络波动下的稳定性。</li>
</ul>
<h2 data-id="heading-6">3. 核心功能展示</h2>
<h3 data-id="heading-7">智能的 SQL 生成</h3>
<p><code>gen_sql.py</code> 处理了复杂的 SQL 拼接逻辑，特别是 <code>UPSERT</code>（插入或更新）操作。</p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 自动生成 INSERT INTO ... ON CONFLICT DO UPDATE</span>
<span class="hljs-attr">sql</span> = gen.gen_insert_or_update(
    <span class="hljs-attr">table_name</span>=t(<span class="hljs-string">'users'</span>),
    <span class="hljs-attr">uniq_columns</span>=[c(<span class="hljs-string">'email'</span>)],
    <span class="hljs-attr">value_columns</span>=[c(<span class="hljs-string">'name'</span>), c(<span class="hljs-string">'age'</span>)]
)
</code></pre>
<h3 data-id="heading-8">统一的 Record API</h3>
<p>无论是在异步还是同步环境中，开发者都可以使用几乎一致的 API 来处理数据。</p>
<p><strong>异步保存数据 (<code>record.py</code>)：</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 如果 id 存在则更新，否则根据唯一键判断是插入还是更新</span>
<span class="hljs-attr">user_id</span> = await record.save(
    <span class="hljs-attr">table</span>=t(<span class="hljs-string">'users'</span>),
    <span class="hljs-attr">uniq_keys</span>=[<span class="hljs-string">'email'</span>],
    <span class="hljs-attr">email</span>=<span class="hljs-string">'user@example.com'</span>,
    <span class="hljs-attr">name</span>=<span class="hljs-string">'Pythonista'</span>,
    <span class="hljs-attr">json_keys</span>=[<span class="hljs-string">'meta'</span>] <span class="hljs-comment"># 自动处理 JSON 序列化与合并</span>
)
</code></pre>
<p><strong>同步获取列表 (<code>record_sync.py</code>)：</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 支持分页、排序、JSON 字段查询</span>
<span class="hljs-attr">users</span> = record_sync.get_list(
    <span class="hljs-attr">table</span>=t(<span class="hljs-string">'users'</span>),
    <span class="hljs-attr">part_sql</span>=<span class="hljs-string">"meta#&gt;&gt;'{role}' = %s"</span>,
    <span class="hljs-attr">args</span>=(<span class="hljs-string">'admin'</span>,),
    <span class="hljs-attr">size</span>=<span class="hljs-number">20</span>,
    <span class="hljs-attr">sorts</span>=<span class="hljs-string">'created_at desc'</span>
)
</code></pre>
<h2 data-id="heading-9">4. 现代化打包与依赖</h2>
<p>项目配置已更新以支持现代 Python 生态：</p>
<ul>
<li><strong>pyproject.toml</strong>：作为构建系统的核心，指定了构建依赖。</li>
<li><strong>依赖管理</strong>：明确声明了 <code>psycopg[binary,pool]</code>，确保安装时包含二进制驱动和连接池支持，提升安装速度和运行性能。</li>
<li><strong>版本兼容</strong>：明确标记支持 Python 3.8+，并移除了已废弃的 <code>distutils</code>。</li>
</ul>
<h2 data-id="heading-10">总结</h2>
<p>经过本次重构，<code>psql_utils</code> 从一个简单的工具脚本集合蜕变为一个健壮、类型安全且易于维护的 Python 库。它既保留了直接操作 SQL 的灵活性，又提供了足够的抽象来加速日常开发，是构建中小型 PostgreSQL 应用的理想选择。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[棒棒糖图：当条形图遇上极简美学]]></title>    <link>https://juejin.cn/post/7592990758477037587</link>    <guid>https://juejin.cn/post/7592990758477037587</guid>    <pubDate>2026-01-10T00:40:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592990758477037587" data-draft-id="7593145583348432938" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="棒棒糖图：当条形图遇上极简美学"/> <meta itemprop="keywords" content="Python,数据可视化,数据分析"/> <meta itemprop="datePublished" content="2026-01-10T00:40:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            棒棒糖图：当条形图遇上极简美学
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-10T00:40:59.000Z" title="Sat Jan 10 2026 00:40:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>棒棒糖图</strong>（Lollipop Chart）可以看作是条形图的一种“轻盈版”变体：它用一根从基准线延伸出来的“棒”，并在末端以一个“糖”（圆点）来表示数值，取代了传统的矩形条。</p>
<p>这种图表传达的信息与条形图是一样的，但它更注重突出数据点的位置，整体看起来更加清新、现代。</p>
<p>今天，我们一起探索棒棒糖图的优势，并通过代码实现，亲手打造一个属于自己的棒棒糖图！</p>
<h2 data-id="heading-0">设计原理</h2>
<p>设计棒棒糖图的初衷有两个方面：</p>
<p>首先，通过减少图形中的“墨水”使用量，在面对大量类别或数值普遍较高的情况下，避免了条形图过于密集可能带来的<strong>视觉压迫感</strong>和<strong>杂乱无章</strong>的感觉；</p>
<p>其次，这样的设计能够更好地引导观察者的注意力集中在各个数据点的具体位置及其之间的差异上，非常适合用来进行排名或者对比分析。</p>
<p><strong>棒棒糖图</strong>与<strong>条形图</strong>在功能上是等价的，也并不总是优于条形图。</p>
<p>当处理大量类别、条柱非常高且相互之间距离较近的数据时，棒棒糖图会显得更加易于阅读理解；</p>
<p>然而，在需要强调绝对数量或是希望获得最为直观长度比较的情况下，条形图依然是更好的选择。</p>
<h2 data-id="heading-1">实现原理</h2>
<p><strong>棒棒糖图</strong>在<code>matplotlib</code>库中没有直接对应的类。</p>
<p>不过，它的实现原理非常简单，通过组合使用 <code>matplotlib</code> 中的两个基本绘图功能就可以实现：</p>
<ol>
<li><strong>绘制线条</strong> (<code>plt.vlines</code>)：这是构成棒棒糖“棍子”部分的关键。</li>
</ol>
<p><code>plt.vlines</code> 函数用于在图表上绘制垂直线段。通过指定每个数据点的 x 坐标、线条的起始点（通常是 0）和结束点（即对应数据的 y 值），就可以画出从 x 轴延伸到数据值的线条。</p>
<ol start="2">
<li><strong>绘制圆点</strong> (<code>plt.scatter</code>)：这是构成棒棒糖“糖”部分的关键。</li>
</ol>
<p><code>plt.scatter</code> 函数用于绘制散点图。通过将每个数据点的 x 坐标和 y 坐标（即数据值）作为参数传入，就可以在每条线的顶端绘制一个圆点。</p>
<p>总的来说，<strong>实现原理</strong>就是：用线条表示数值的大小，用圆点强调数值的终点位置，两者结合就形成了视觉上类似棒棒糖的图表。</p>
<p>这种组合方式使得图表比实心的条形图更简洁，同时又能清晰地传达数据信息。</p>
<p>下一节的示例中，将会演示如何使用<code>matplotlib</code>来绘制<strong>棒棒糖图</strong>。</p>
<h2 data-id="heading-2">应用示例</h2>
<p>接下来，让我们通过实际的对比示例，直观地感受棒棒糖图与传统条形图的不同表现。</p>
<h3 data-id="heading-3">适合棒棒糖图的场景</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建更多类别的测试数据</span>
<span class="hljs-comment"># 模拟不同月份中每天的某个指标（例如：每日平均步数，单位：千步）</span>
days = [<span class="hljs-string">f"Day <span class="hljs-subst">{i}</span>"</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">21</span>)]  <span class="hljs-comment"># 生成 20 天的数据</span>
np.random.seed(<span class="hljs-number">42</span>)  <span class="hljs-comment"># 设置随机种子，确保每次运行结果一致</span>
<span class="hljs-comment"># 生成 1 到 5 之间的随机数值作为示例数据</span>
values = np.<span class="hljs-built_in">round</span>(np.random.uniform(<span class="hljs-number">1.0</span>, <span class="hljs-number">5.0</span>, size=<span class="hljs-built_in">len</span>(days)), <span class="hljs-number">1</span>)

<span class="hljs-comment"># --- 创建子图 ---</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, figsize=(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>))  <span class="hljs-comment"># 调整为垂直布局，方便比较</span>

<span class="hljs-comment"># --- 绘制条形图 (上图) ---</span>
bars = ax1.bar(days, values, color=<span class="hljs-string">"skyblue"</span>, edgecolor=<span class="hljs-string">"navy"</span>, linewidth=<span class="hljs-number">0.7</span>)
ax1.set_title(<span class="hljs-string">"条形图 (Bar Chart) - 每日步数"</span>, fontsize=<span class="hljs-number">14</span>)
ax1.set_ylabel(<span class="hljs-string">"数值 (千步)"</span>)
<span class="hljs-comment"># ax1.set_xlabel('日期') # x轴标签已在下方图中</span>
ax1.grid(axis=<span class="hljs-string">"y"</span>, linestyle=<span class="hljs-string">"--"</span>, alpha=<span class="hljs-number">0.7</span>)
<span class="hljs-comment"># 在条形图上添加数值标签</span>
<span class="hljs-keyword">for</span> bar, val <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(bars, values):
    height = bar.get_height()
    ax1.text(
        bar.get_x() + bar.get_width() / <span class="hljs-number">2.0</span>,
        height + <span class="hljs-number">0.05</span>,
        <span class="hljs-string">f"<span class="hljs-subst">{val}</span>"</span>,
        ha=<span class="hljs-string">"center"</span>,
        va=<span class="hljs-string">"bottom"</span>,
        fontsize=<span class="hljs-number">8</span>,
    )  <span class="hljs-comment"># 标签旋转90度节省空间</span>

<span class="hljs-comment"># --- 绘制棒棒糖图 (下图) ---</span>
<span class="hljs-comment"># 1. 绘制线条</span>
ax2.vlines(x=<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(days)), ymin=<span class="hljs-number">0</span>, ymax=values, color=<span class="hljs-string">"navy"</span>, linewidth=<span class="hljs-number">2</span>)
<span class="hljs-comment"># 2. 在线条顶部绘制圆点</span>
ax2.scatter(x=<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(days)), y=values, color=<span class="hljs-string">"red"</span>, s=<span class="hljs-number">50</span>, zorder=<span class="hljs-number">3</span>)
<span class="hljs-comment"># 3. 添加数值标签</span>
<span class="hljs-keyword">for</span> i, val <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(values):
    ax2.text(i, val + <span class="hljs-number">0.1</span>, <span class="hljs-string">f"<span class="hljs-subst">{val}</span>"</span>, ha=<span class="hljs-string">"center"</span>, va=<span class="hljs-string">"bottom"</span>, fontsize=<span class="hljs-number">8</span>)

ax2.set_title(<span class="hljs-string">"棒棒糖图 (Lollipop Chart) - 每日步数"</span>, fontsize=<span class="hljs-number">14</span>)
ax2.set_ylabel(<span class="hljs-string">"数值 (千步)"</span>)
ax2.set_xlabel(<span class="hljs-string">"日期"</span>)
ax2.set_xticks(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(days)))
ax2.set_xticklabels(days, rotation=<span class="hljs-number">45</span>, ha=<span class="hljs-string">"right"</span>)  <span class="hljs-comment"># 旋转x轴标签以便阅读</span>
ax2.grid(axis=<span class="hljs-string">"y"</span>, linestyle=<span class="hljs-string">"--"</span>, alpha=<span class="hljs-number">0.7</span>)
ax2.set_ylim(<span class="hljs-number">0</span>, <span class="hljs-built_in">max</span>(values) * <span class="hljs-number">1.1</span>)

<span class="hljs-comment"># --- 显示图形 ---</span>
plt.tight_layout()  <span class="hljs-comment"># 调整子图间距</span>
plt.show()
</code></pre>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf1d9bc25295437d9eca9ef2ad2c08df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768610458&amp;x-signature=RLIfamyr63H81ru8%2B1RRGHY13iI%3D" alt="" loading="lazy"/></p>
<p>这个示例使用了20个数据类别（Day 1 到 Day 20）。</p>
<p>你可以看到，在条形图中，许多蓝色的条形紧密地排列在一起，视觉上显得有些拥挤。</p>
<p>而在棒棒糖图中，线条和圆点使得数据点之间的关系更加清晰，整体视觉效果更轻盈，更容易比较各个数值的大小和识别模式。</p>
<h3 data-id="heading-4">适合传统条形图的场景</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 创建更适合条形图的测试数据</span>
<span class="hljs-comment"># 模拟某公司连续12个月的销售额（单位：万元）</span>
months = [
    <span class="hljs-string">"1月"</span>,
    <span class="hljs-string">"2月"</span>,
    <span class="hljs-string">"3月"</span>,
    <span class="hljs-string">"4月"</span>,
    <span class="hljs-string">"5月"</span>,
    <span class="hljs-string">"6月"</span>,
    <span class="hljs-string">"7月"</span>,
    <span class="hljs-string">"8月"</span>,
    <span class="hljs-string">"9月"</span>,
    <span class="hljs-string">"10月"</span>,
    <span class="hljs-string">"11月"</span>,
    <span class="hljs-string">"12月"</span>,
]
<span class="hljs-comment"># 生成有一定趋势和波动的销售额数据，例如有季节性高峰</span>
sales = [<span class="hljs-number">120</span>, <span class="hljs-number">110</span>, <span class="hljs-number">135</span>, <span class="hljs-number">140</span>, <span class="hljs-number">155</span>, <span class="hljs-number">170</span>, <span class="hljs-number">185</span>, <span class="hljs-number">180</span>, <span class="hljs-number">160</span>, <span class="hljs-number">150</span>, <span class="hljs-number">145</span>, <span class="hljs-number">165</span>]

<span class="hljs-comment"># --- 创建子图 ---</span>
fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, figsize=(<span class="hljs-number">16</span>, <span class="hljs-number">6</span>))

<span class="hljs-comment"># --- 绘制条形图 (左图) ---</span>
bars = ax1.bar(months, sales, color=<span class="hljs-string">"lightsteelblue"</span>, edgecolor=<span class="hljs-string">"black"</span>, linewidth=<span class="hljs-number">0.7</span>)
ax1.set_title(<span class="hljs-string">"条形图 (Bar Chart - 月份销售额)"</span>, fontsize=<span class="hljs-number">14</span>)
ax1.set_ylabel(<span class="hljs-string">"销售额 (万元)"</span>)
ax1.set_xlabel(<span class="hljs-string">"月份"</span>)
ax1.grid(axis=<span class="hljs-string">"y"</span>, linestyle=<span class="hljs-string">"--"</span>, alpha=<span class="hljs-number">0.7</span>)
<span class="hljs-comment"># 在条形图上添加数值标签</span>
<span class="hljs-keyword">for</span> bar, s <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(bars, sales):
    height = bar.get_height()
    ax1.text(
        bar.get_x() + bar.get_width() / <span class="hljs-number">2.0</span>,
        height + <span class="hljs-number">2</span>,
        <span class="hljs-string">f"<span class="hljs-subst">{s}</span>"</span>,
        ha=<span class="hljs-string">"center"</span>,
        va=<span class="hljs-string">"bottom"</span>,
        fontsize=<span class="hljs-number">9</span>,
    )

<span class="hljs-comment"># --- 绘制棒棒糖图 (右图) ---</span>
ax2.vlines(x=<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(months)), ymin=<span class="hljs-number">0</span>, ymax=sales, color=<span class="hljs-string">"gray"</span>, linewidth=<span class="hljs-number">2</span>)
ax2.scatter(x=<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(months)), y=sales, color=<span class="hljs-string">"coral"</span>, s=<span class="hljs-number">50</span>, zorder=<span class="hljs-number">3</span>)
<span class="hljs-keyword">for</span> i, s <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(sales):
    ax2.text(i, s + <span class="hljs-number">3</span>, <span class="hljs-string">f"<span class="hljs-subst">{s}</span>"</span>, ha=<span class="hljs-string">"center"</span>, va=<span class="hljs-string">"bottom"</span>, fontsize=<span class="hljs-number">9</span>)

ax2.set_title(<span class="hljs-string">"棒棒糖图 (Lollipop Chart - 月份销售额)"</span>, fontsize=<span class="hljs-number">14</span>)
ax2.set_ylabel(<span class="hljs-string">"销售额 (万元)"</span>)
ax2.set_xlabel(<span class="hljs-string">"月份"</span>)
ax2.set_xticks(<span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(months)))
ax2.set_xticklabels(months, rotation=<span class="hljs-number">45</span>)  <span class="hljs-comment"># 旋转x轴标签以防重叠</span>
ax2.grid(axis=<span class="hljs-string">"y"</span>, linestyle=<span class="hljs-string">"--"</span>, alpha=<span class="hljs-number">0.7</span>)
ax2.set_ylim(<span class="hljs-number">0</span>, <span class="hljs-built_in">max</span>(sales) * <span class="hljs-number">1.1</span>)

<span class="hljs-comment"># --- 显示图形 ---</span>
plt.tight_layout()
plt.show()
</code></pre>

<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6a6af82104e4da68dfeb68137003d64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768610458&amp;x-signature=CKMCTkTKDEqnjlSONu3jYCO%2Fkfo%3D" alt="" loading="lazy"/></p>
<p>在这个示例中，数据代表的是连续的月份，数值本身代表的是销售额，这是一个“量”的概念。</p>
<p>条形图的实心块能让人立刻感受到哪个月份的销售额更高，整体的分布和对比关系一目了然。</p>
<p>而棒棒糖图虽然也展示了数据，但线条和圆点的组合在视觉上不如实心条形那样能直接传达“量”的感觉，尤其是在数值差异不是特别巨大时，对比效果会稍逊于条形图。</p>
<h2 data-id="heading-5">总结</h2>
<p><strong>棒棒糖图</strong>就像数据可视化世界中的"少即是多"哲学体现。</p>
<p>它不是要取代传统条形图，而是为数据可视化工具箱增加了一个有价值的选项。</p>
<p>就像不同的画笔适合不同的绘画风格，不同的图表类型也适合不同的数据故事。</p>
<p><strong>棒棒糖图</strong>的真正优势在于它改变了数据的**"讲述方式"**。</p>
<p>它不说："这是所有信息，你自己找重点"，而是说："看这里，这些是关键点"。</p>
<p>这种焦点导向的特性，使得棒棒糖图在现代快节奏的数据沟通中越来越受欢迎。</p>
<p>设计可视化时，我们不妨问问自己：我想要观众首先看到什么？如果是精确的数值点和清晰的排名，那么棒棒糖图可能是你的理想选择。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（33） Hibernate的投影（Projections）是什么？]]></title>    <link>https://juejin.cn/post/7593215107405512740</link>    <guid>https://juejin.cn/post/7593215107405512740</guid>    <pubDate>2026-01-09T23:29:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593215107405512740" data-draft-id="7593165280489111593" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（33） Hibernate的投影（Projections）是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T23:29:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（33） Hibernate的投影（Projections）是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T23:29:46.000Z" title="Fri Jan 09 2026 23:29:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的投影（Projections）</h3>
<p>在Hibernate中，投影（Projection）是指查询结果中只包含实体的某些属性，而不是整个实体对象。这对于优化查询性能和减少数据传输量非常有用。</p>
<p>Hibernate的投影可以通过Criteria API中的<code>Projections</code>类来实现。<code>Projections</code>类提供了多种方法，可以对查询结果进行投影，包括单属性、多属性、聚合（如计数、求和、平均值等）和分组等功能。</p>
<h3 data-id="heading-1">使用Projections的示例代码</h3>
<h4 data-id="heading-2">实体类定义</h4>
<p>我们继续使用之前定义的<code>Person</code>和<code>Address</code>实体类：</p>
<h5 data-id="heading-3">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-4">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-5">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-7">使用Projections示例</h3>
<h4 data-id="heading-8">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);

            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Main St"</span>, person1);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Oak St"</span>, person2);

            session.save(address1);
            session.save(address2);

            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-9">使用Projections查询</h4>
<h5 data-id="heading-10">查询Person的姓名和年龄</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.criterion.Projections;
<span class="hljs-keyword">import</span> org.hibernate.criterion.CriteriaQuery;
<span class="hljs-keyword">import</span> org.hibernate.criterion.Restrictions;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;

<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaBuilder;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateProjectionsExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用Projections查询Person的姓名和年龄</span>
        queryPersonNameAndAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonNameAndAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">CriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            CriteriaQuery&lt;Object[]&gt; criteriaQuery = criteriaBuilder.createQuery(Object[].class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);

            criteriaQuery.multiselect(root.get(<span class="hljs-string">"name"</span>), root.get(<span class="hljs-string">"age"</span>));

            List&lt;Object[]&gt; results = session.createQuery(criteriaQuery).getResultList();
            System.out.println(<span class="hljs-string">"Query Person name and age:"</span>);
            <span class="hljs-keyword">for</span> (Object[] row : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
                <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> (Integer) row[<span class="hljs-number">1</span>];
                System.out.println(name + <span class="hljs-string">" - "</span> + age);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-11">使用聚合函数查询</h5>
<p>假设我们想计算所有Person的平均年龄。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;
<span class="hljs-keyword">import</span> org.hibernate.criterion.Projections;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;

<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaBuilder;
<span class="hljs-keyword">import</span> javax.persistence.criteria.CriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateAggregateQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用Projections和聚合函数查询平均年龄</span>
        queryAverageAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAverageAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">CriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            CriteriaQuery&lt;Double&gt; criteriaQuery = criteriaBuilder.createQuery(Double.class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);

            criteriaQuery.select(criteriaBuilder.avg(root.get(<span class="hljs-string">"age"</span>)));

            <span class="hljs-type">Double</span> <span class="hljs-variable">averageAge</span> <span class="hljs-operator">=</span> session.createQuery(criteriaQuery).getSingleResult();
            System.out.println(<span class="hljs-string">"Average age of persons: "</span> + averageAge);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-12">Projections详细解释</h3>
<ol>
<li><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象和两个<code>Address</code>对象供查询使用。
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>,<span class="hljs-number">28</span>);
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（34）Hibernate的别名（Alias）是什么？]]></title>    <link>https://juejin.cn/post/7593139476841381894</link>    <guid>https://juejin.cn/post/7593139476841381894</guid>    <pubDate>2026-01-09T23:31:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593139476841381894" data-draft-id="7593215107405529124" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（34）Hibernate的别名（Alias）是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T23:31:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（34）Hibernate的别名（Alias）是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T23:31:10.000Z" title="Fri Jan 09 2026 23:31:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的别名（Alias）</h3>
<p>在Hibernate中，使用别名（Alias）可以为查询中的实体或属性指定一个简短的替代名称。别名的使用有助于简化查询语句，特别是在多表联接或复杂查询中。此外，别名还可以用于在相同查询中引用同一个实体的多个实例。</p>
<h3 data-id="heading-1">使用别名的示例代码</h3>
<h4 data-id="heading-2">实体类定义</h4>
<p>我们继续使用之前定义的<code>Person</code>和<code>Address</code>实体类。</p>
<h5 data-id="heading-3">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-4">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-5">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-7">使用别名的示例</h3>
<h4 data-id="heading-8">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);

            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Main St"</span>, person1);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Oak St"</span>, person2);

            session.save(address1);
            session.save(address2);

            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-9">使用别名进行查询</h4>
<h5 data-id="heading-10">查询Person及其Address信息</h5>
<p>使用别名来简化多表联接查询。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Join;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateAliasQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用别名查询Person及其Address信息</span>
        queryPersonAndAddress(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonAndAddress</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">HibernateCriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            JpaCriteriaQuery&lt;Object[]&gt; criteriaQuery = criteriaBuilder.createQuery(Object[].class);
            Root&lt;Person&gt; personRoot = criteriaQuery.from(Person.class);
            Join&lt;Person, Address&gt; addressJoin = personRoot.join(<span class="hljs-string">"address"</span>);

            <span class="hljs-comment">// 使用别名</span>
            criteriaQuery.multiselect(personRoot.get(<span class="hljs-string">"name"</span>).alias(<span class="hljs-string">"personName"</span>), addressJoin.get(<span class="hljs-string">"street"</span>).alias(<span class="hljs-string">"addressStreet"</span>));

            List&lt;Object[]&gt; results = session.createQuery(criteriaQuery).getResultList();
            System.out.println(<span class="hljs-string">"Query Person and Address:"</span>);
            <span class="hljs-keyword">for</span> (Object[] row : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">personName</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
                <span class="hljs-type">String</span> <span class="hljs-variable">addressStreet</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">1</span>];
                System.out.println(personName + <span class="hljs-string">" lives at "</span> + addressStreet);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-11">使用别名的详细解释</h3>
<ol>
<li>
<p><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象和两个<code>Address</code>对象供查询使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);

            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Main St"</span>, person1);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Oak St"</span>, person2);

            session.save(address1);
            session.save(address2);

            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>使用别名查询Person及其Address信息</strong>：我们使用别名来简化联接查询并投影特定的属性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateAliasQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用别名查询Person及其Address信息</span>
        queryPersonAndAddress(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonAndAddress</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">HibernateCriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            JpaCriteriaQuery&lt;Object[]&gt; criteriaQuery = criteriaBuilder.createQuery(Object[].class);
            Root&lt;Person&gt; personRoot = criteriaQuery.from(Person.class);
            Join&lt;Person, Address&gt; addressJoin = personRoot.join(<span class="hljs-string">"address"</span>);

           
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[机器学习入门概述一览]]></title>    <link>https://juejin.cn/post/7593177437081911347</link>    <guid>https://juejin.cn/post/7593177437081911347</guid>    <pubDate>2026-01-09T15:18:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593177437081911347" data-draft-id="7593171168259620873" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="机器学习入门概述一览"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-09T15:18:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            机器学习入门概述一览
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:18:57.000Z" title="Fri Jan 09 2026 15:18:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>推荐直接网站在线阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Faicoting.cn%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//aicoting.cn/" ref="nofollow noopener noreferrer">aicoting AI算法面试学习在线网站</a></p>
</blockquote>
<h2 data-id="heading-0">定义与核心思想</h2>
<p>学习一个知识最重要的就是要知道这个知识的定义，定义虽然大多晦涩，却是最能完整清晰的表达这个知识的一种表达方式，那么机器学习的定义是什么呢？</p>
<p>机器学习（Machine Learning, ML）是人工智能（AI）的核心分支之一，其目标是通过数据驱动的方法使计算机系统能够自动学习规律，从而在没有显式编程的情况下完成预测、分类、决策和优化等任务。与传统程序设计依赖固定规则不同，机器学习强调经验学习和自我改进，能够从数据中发现潜在模式，并将其应用于新数据。</p>
<p>周志华老师的机器学习一书中给出的定义如下：机器学习是一门学科，致力于研究如何通过计算的手段，利用经验来改善系统自身的性能。在计算机系统中，“经验”通常以“数据”形式存在，因此，机器学习所研究的主要内容，是关于在计算机上从数据中产生“模型”的算法，即“学习算法”，有了学习算法，我们把经验数据提供给他，他就能基于这些数据产生模型；在面对新的情况时，模型会给我们提供相应的判断。如果说计算机科学是研究关于算法的学问，那么类似的，可以说机器学习是研究关于学习算法的学问。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eacb10ee074b478f8fc3d2435deafab9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=OnLf0ewL%2FYHLuQQDhme2%2BiP6%2BS8%3D" alt="" loading="lazy"/></p>
<p>机器学习的核心思想可以概括为以下几个方面：</p>
<ol>
<li>模型（Model）：模型是计算机“理解数据”的数学结构，负责从输入数据中捕捉规律，并进行预测或决策。不同的模型适用于不同类型的问题，例如线性回归用于连续值预测，决策树和神经网络适用于复杂模式识别。</li>
<li>训练（Training）：训练是模型学习的过程，通过输入大量数据，模型不断调整内部参数以最小化预测误差。训练过程的质量直接影响模型的性能和泛化能力。</li>
<li>特征（Feature）：特征是数据中最有信息量的部分，是模型学习规律的基础。高质量的特征能够显著提升模型的预测能力，而无关或噪声特征可能导致性能下降。</li>
<li>泛化能力（Generalization）：机器学习不仅关注模型在训练数据上的表现，更重视其在未知数据上的适应能力。泛化能力强的模型能够在新场景中保持稳定的性能，是衡量机器学习系统有效性的关键指标。</li>
</ol>
<p>简单点说，机器学习的核心思想就是通过数据驱动的方法，让模型自动学习规律，并能够在新的环境中进行准确预测和决策。这一思想贯穿所有机器学习算法和应用，是理解后续各类方法和技术的基础。</p>
<h2 data-id="heading-1">机器学习的类型</h2>
<p>机器学习根据学习方式和数据特征的不同，大致可以分为几类，包括：</p>
<ul>
<li>监督学习（Supervised Learning）：通过带有标签的数据进行学习，核心任务是让模型学会“从输入预测输出”。</li>
<li>无监督学习（Unsupervised Learning）：在没有标签的数据中挖掘潜在规律和结构，常用于模式发现与数据压缩。</li>
<li>半监督学习（Semi-supervised Learning）：结合少量标注数据与大量未标注数据，提高学习效率与模型性能。</li>
<li>强化学习（Reinforcement Learning）：通过与环境交互不断试错，并根据奖励反馈逐步优化策略，用于解决动态决策问题。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/549a671f0f794981a5229fda2ba40b09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=CDvWjtTbsXdwta8ucubYHmcw00k%3D" alt="" loading="lazy"/></p>
<p>这些类型共同构成了机器学习的基本版图：有的强调“从老师那里学习”，有的擅长“无师自通”，有的善于“边学边试”。在实际应用中，它们往往不是孤立存在的，而是可以结合使用，从而应对更加复杂和多样化的任务。</p>
<h3 data-id="heading-2">监督学习</h3>
<p>监督学习是机器学习的基石，其优点在于思路清晰、效果直观，且在分类与回归任务中表现优异。无论是垃圾邮件识别、语音识别，还是金融风控和医疗诊断，都离不开监督学习。理解监督学习，你就打开了机器学习世界的大门。</p>
<p>监督学习（Supervised Learning）是机器学习中最常见、应用最广的一类方法。它的核心思想是利用带有输入与输出标签的数据，训练模型学习两者之间的映射关系，从而在新数据上做出预测。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd02f7f0883d48e3a028b77d9d69b1b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=zznyWc7ARGX2WtUgHb5bqlWYcQQ%3D" alt="" loading="lazy"/></p>
<p>监督学习的本质是“有老师的学习”。在训练过程中，模型接收大量的输入数据（特征）及其对应的正确答案（标签），并尝试学习一个函数，将输入映射到输出。就像学生在老师的指导下，通过参考答案不断纠正自己的错误，模型也通过误差反馈不断调整参数，使预测结果尽可能接近真实标签。</p>
<p>从数学上看，监督学习可以被表述为：给定一个训练集 ，其中表示输入，表示输出，目标是找到一个函数 ，使得在新的输入 下，预测输出 y=f(x) 尽可能接近真实输出 。</p>
<p>监督学习主要分为两大任务：</p>
<ul>
<li>分类（Classification）：输出是离散类别，例如识别图片中的动物种类。</li>
<li>回归（Regression）：输出是连续值，例如预测房价或气温。</li>
</ul>
<p>监督学习通常包括以下几个步骤：</p>
<ol>
<li>数据准备 收集并整理数据，将输入与对应的标签配对。数据质量和数量直接影响模型的效果。</li>
<li>特征工程 提取或选择有价值的特征，去除冗余信息，为模型提供有效的学习基础。</li>
<li>模型选择 根据任务类型选择合适的模型，例如回归任务可用线性回归，分类任务可用逻辑回归、支持向量机或决策树等。</li>
<li>训练模型 将训练数据输入模型，通过优化算法（如梯度下降）不断调整参数，最小化预测值与真实值之间的误差。</li>
<li>模型评估 使用验证集或交叉验证方法，评估模型在未见数据上的表现，常见指标包括准确率、均方误差、F1 分数等。</li>
<li>模型应用 在测试集或真实场景中使用训练好的模型，对新数据进行预测或决策。</li>
</ol>
<h3 data-id="heading-3">无监督学习</h3>
<p>网络中存在着大量的数据，然而这些数据绝大部分是没有标注的，而标注又需要大量的人力，财力，没人愿意当这个冤大头，科学家就想到了一个好办法：这些数据中本来就存在着某些关联，让模型自己学去吧！无监督学习也就应运而生。</p>
<p>无监督学习（Unsupervised Learning）是一种无需人工标注数据的机器学习方法。与监督学习不同，它不依赖输入与标签的对应关系，而是在纯粹的输入数据中自主寻找潜在的模式、规律与结构。</p>
<p>无监督学习的核心思想可以理解为“无老师的学习”。模型并不知道正确答案是什么，它的目标是通过分析数据之间的相似性与差异性，揭示数据背后的隐藏结构。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5898638d0c9c437283b50cda519dc5b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=sqVuxaC0Z0SJZGNkFEO8ABvP%2Bd8%3D" alt="" loading="lazy"/></p>
<p>无监督学习常见的任务包括：</p>
<ul>
<li>聚类（Clustering）：将相似的数据自动归为一类，例如把客户划分成不同群体。</li>
<li>降维（Dimensionality Reduction）：在保留主要信息的前提下，用更少的变量来表示数据，例如将高维图像数据映射到低维空间。</li>
<li>关联规则挖掘（Association Rule Mining）：发现变量之间的潜在关系，例如“购物篮分析”中找出哪些商品经常一起购买。</li>
</ul>
<p>可以说，无监督学习更像是探索未知领域，帮助人们理解数据的内在结构，为后续的预测、决策或特征提取提供支持。</p>
<p>无监督学习的一般流程包括以下几个步骤：</p>
<ol>
<li>数据收集与准备 获取数据并进行基本清洗，确保输入数据质量。由于没有标签，数据的完整性与代表性显得尤为重要。</li>
<li>特征提取与表示 将原始数据转化为模型可理解的特征表示，例如数值向量化或归一化处理。</li>
<li>模型选择 根据任务目标选择合适的方法：若是发现群体结构，可以使用聚类算法；若是降低维度，可以选择主成分分析（PCA）等方法。</li>
<li>模式发现 模型通过分析数据间的相似性、分布规律或统计特性，挖掘出数据中隐藏的模式。</li>
<li>结果解释与应用 对模型输出进行解释和验证，并结合业务需求应用，例如用于市场细分、异常检测或数据可视化。</li>
</ol>
<p>无监督学习的魅力在于发现未知。当缺乏标注数据时，它能够帮助我们理解数据的内在结构，揭示潜在规律，并为其他机器学习方法提供支持。在大数据场景下，无监督学习已经成为探索和利用信息的重要工具，例如用户行为分析、基因数据研究、推荐系统预处理等。</p>
<h3 data-id="heading-4">半监督学习</h3>
<p>在现实世界中，获取大量标注数据往往代价高昂、耗时巨大，而未标注数据却随处可见。半监督学习（Semi-Supervised Learning） 便是在这种背景下诞生的一种折中方案：它试图结合少量带标签的数据与大量无标签的数据，从而提升模型的学习效果。</p>
<p>半监督学习的核心思想是：标签稀缺但数据丰富。相比监督学习完全依赖标注数据，半监督学习希望模型能够借助无标签样本中的潜在结构与分布规律，来辅助模型更好地学习决策边界。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65c4f699474e4a4f9ea055e7de886b64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=aCwBeAxcgVOWNp41IU5wc1Nl8AA%3D" alt="" loading="lazy"/></p>
<p>换句话说，带标签的数据告诉模型“该怎么分”，而无标签的数据则揭示了“数据是怎么分布的”。两者结合，既能降低标注成本，又能提升模型的泛化能力。</p>
<p>半监督学习的典型流程一般包括以下几个步骤：</p>
<ol>
<li>初始训练 使用少量的标注数据训练一个初始模型，建立基本的预测能力。</li>
<li>利用无标签数据 借助无标签数据的分布特性，让模型捕捉数据的潜在结构。常见方式包括聚类假设（相似的样本往往属于同一类别）和流形假设（高维数据往往分布在低维流形上）。</li>
<li>伪标签生成 模型对无标签数据进行预测，并将高置信度的预测结果当作“伪标签”，加入到训练集中，不断扩大标注数据的规模。</li>
<li>迭代优化 将真实标签与伪标签共同用于训练，迭代更新模型，使其在不断学习中获得更强的泛化能力。</li>
</ol>
<p>半监督学习广泛应用于标注成本高昂的领域，例如：</p>
<ul>
<li>医学影像分析：少量专家标注结合大量未标注图像，有助于疾病诊断模型的训练。</li>
<li>自然语言处理：在文本分类或情感分析中，大量语料没有标签，半监督方法能有效利用这些数据。</li>
<li>网络安全：恶意行为样本有限，但大量正常网络流量可以提供辅助信息。</li>
</ul>
<p>半监督学习是一种巧妙的折中方案：它不依赖于昂贵的大规模标注，也不完全放弃监督信号，而是将“少量已知”与“大量未知”相结合，帮助模型在有限的监督下依然能够“学得更好”。在数据爆炸、标注昂贵的当下，半监督学习无疑是推动人工智能走向现实应用的重要方式。</p>
<h3 data-id="heading-5">强化学习</h3>
<p>如果说监督学习像“老师出题、学生作答”，无监督学习像“学生自学、自己总结”，那么强化学习（Reinforcement Learning，RL）更像是“学生在游戏中闯关，通过奖励与惩罚不断升级”。它是一种通过与环境交互来学习决策策略的机器学习方法。</p>
<p>强化学习的核心思想是：行动 → 奖励 → 学习 → 改进。 智能体（agent）通过与环境（environment）交互，在不同状态下采取动作（action），环境会反馈奖励（reward）和新的状态。智能体的目标是通过试错，不断优化策略（policy），以获得长期累积的最大奖励。</p>
<p>可以简单理解为：</p>
<ul>
<li>监督学习学的是“正确答案”；</li>
<li>无监督学习学的是“潜在规律”；</li>
<li>强化学习学的是“如何做选择，才能赢得最多奖励”。</li>
</ul>
<p>一个典型的强化学习流程包括以下几个关键步骤：</p>
<ol>
<li>感知环境状态（State） 智能体观察当前所处的环境，例如机器人看到周围障碍物，游戏玩家知道自己所在位置。</li>
<li>选择动作（Action） 根据当前的策略，智能体决定采取某种动作，例如向前走、向左转或发起攻击。</li>
<li>环境反馈（Reward &amp; Next State） 环境根据动作反馈奖励（正向或负向），同时进入新的状态。例如，机器人避开障碍物获得奖励，撞到障碍物则受到惩罚。</li>
<li>策略更新（Policy Update） 智能体利用反馈信息更新决策策略，让下一次行动更聪明，从而在长期中获得更高的总回报。</li>
</ol>
<p>这一过程循环往复，直到智能体学会在各种情境下如何选择最佳动作。</p>
<p>强化学习的基本要素通常用五元组来描述：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e966718661c4fc889afcb7363bad28f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=3F%2BgULs0DacGLCWuLWO32XZTBdw%3D" alt="" loading="lazy"/></p>
<ul>
<li>Agent（智能体）：学习和决策的主体；</li>
<li>Environment（环境）：智能体所处的外部世界；</li>
<li>State（状态）：环境在某一时刻的信息描述；</li>
<li>Action（动作）：智能体可以采取的行为；</li>
<li>Reward（奖励）：动作执行后环境给予的反馈。</li>
</ul>
<p>强化学习已在多个领域展现出强大潜力：</p>
<ul>
<li>游戏：AlphaGo 打败世界围棋冠军，展示了强化学习在复杂博弈中的威力。</li>
<li>机器人控制：机器人通过试错学会走路、抓取物体，甚至完成精细操作。</li>
<li>推荐系统：根据用户的反馈动态调整推荐内容，优化长期用户体验。</li>
<li>自动驾驶：强化学习帮助汽车在模拟环境中不断优化驾驶策略。</li>
</ul>
<p>强化学习是一种基于“试错—反馈—改进”的学习方法，强调长期回报的最大化。它不像监督学习那样依赖大量标注数据，而是通过与环境的不断交互，逐步形成最优策略。随着计算能力和模拟环境的不断发展，强化学习将在更多复杂、动态的现实场景中发挥重要作用。</p>
<h2 data-id="heading-6">机器学习 vs 深度学习</h2>
<p>在人工智能的发展历程中，机器学习（Machine Learning, ML）和深度学习（Deep Learning, DL）两个常被提及的关键词。它们既紧密相关，又存在显著差异。简单来说，深度学习是机器学习的一种实现方式，但因为表现过于亮眼，经常被单独拿出来与“机器学习”对比。</p>
<h3 data-id="heading-7">定义差异</h3>
<ul>
<li>机器学习：强调让计算机通过数据学习规律，从而进行预测或决策，常见方法有线性回归、支持向量机、决策树等。</li>
<li>深度学习：属于机器学习的一个分支，基于人工神经网络，尤其是多层的深度结构，用于从海量数据中自动提取特征并完成任务。</li>
</ul>
<h3 data-id="heading-8">工作方式差异</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/359518fa907040229989ca047cd4cfd7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=dL8cavYEYDvcudO7fNBZocGHuwA%3D" alt="" loading="lazy"/></p>
<ul>
<li>在传统机器学习中，特征工程往往是成败的关键。需要专家根据任务经验提取有价值的特征，例如在图像识别中手工提取边缘、角点等信息。</li>
<li>深度学习则通过多层神经网络自动完成特征提取，减少了人工干预。例如卷积神经网络（CNN）可以自动从图像中学习边缘、纹理、语义等层次特征。</li>
</ul>
<p>这就好比：机器学习需要“人类厨师”精心准备食材，而深度学习可以“自己下厨”，直接从原材料做出美味。</p>
<h3 data-id="heading-9">数据与计算需求差异</h3>
<ul>
<li>机器学习：通常在中小规模数据上就能工作良好，计算资源需求较低。</li>
<li>深度学习：往往需要海量数据和强大的计算能力（GPU/TPU）才能发挥优势，否则容易过拟合或训练效果不佳。</li>
</ul>
<h3 data-id="heading-10">可解释性差异</h3>
<ul>
<li>机器学习模型（如决策树、线性回归）通常较容易解释，可以直观地看出某个特征对结果的影响。</li>
<li>深度学习模型则被称为“黑箱”，尽管研究者提出了可视化和可解释性方法，但整体上仍难以完全解释其内部机制。</li>
</ul>
<h3 data-id="heading-11">应用场景差异</h3>
<ul>
<li>机器学习：适合数据量有限、对可解释性要求高的任务，如金融风控、医疗诊断辅助。</li>
<li>深度学习：在计算机视觉、语音识别、自然语言处理等大规模数据驱动的领域表现卓越。</li>
</ul>
<p>机器学习与深度学习的关系，可以用一句话来形容：深度学习是机器学习的“升级装备”，但并不是所有任务都必须用它。 当数据量有限、计算资源受限时，传统机器学习依旧是高效可靠的选择；而在大数据和高算力的支持下，深度学习则展现出远超传统方法的潜力。</p>
<h2 data-id="heading-12">机器学习的应用场景</h2>
<p>机器学习不仅是实验室里的数学模型，它已经深深嵌入到我们的日常生活和各行各业中。不同的算法和方法让机器能够像人一样思考、预测和决策。你先想一下有哪些应用方向呢？接下来看看是不是和你想的一样吧！</p>
<h3 data-id="heading-13">金融</h3>
<p>金融行业是机器学习最早大规模落地的领域之一。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31fd0fe219334074b181c7ffc2c0c833~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=l73XKMW7yxH6mt3Aqzb7uVmxA3s%3D" alt="" loading="lazy"/></p>
<ul>
<li>信用风险评估：通过客户的消费、还款、交易记录等数据，模型可以预测其违约概率，从而帮助银行和信贷机构做出放贷决策。</li>
<li>欺诈检测：机器学习能够实时监控交易数据，发现异常模式并识别潜在的欺诈行为。</li>
<li>量化交易：利用历史行情和市场特征，模型可以自动寻找交易机会并执行策略。</li>
</ul>
<p>在金融领域，机器学习就像风险雷达，既能规避损失，也能发掘价值。</p>
<h3 data-id="heading-14">医疗</h3>
<p>在医疗健康领域，机器学习正在成为医生的第二双眼睛，我的硕士研究方向就是医学图像处理，但是是使用深度学习，用机器学习估计毕不了业。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9aae59aa1f6243208201ed06fb41add8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=H8anuPnUa19zz9uCv06RFS2wVF0%3D" alt="" loading="lazy"/></p>
<ul>
<li>疾病预测与诊断：通过电子病历、影像和基因数据，模型可以辅助医生更快、更准确地判断病情。</li>
<li>药物研发：通过学习分子结构和临床实验数据，模型能加速药物筛选，缩短研发周期。</li>
<li>个性化医疗：根据患者的遗传信息和生活习惯，提供更有针对性的治疗方案。</li>
</ul>
<p>它的价值不仅在于提高效率，更在于降低误诊率和加速科研进程。</p>
<h3 data-id="heading-15">推荐系统</h3>
<p>推荐系统是机器学习在互联网领域的门面担当，无论是购物，短视频还是看小说，推荐系统都在后台悄悄地工作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f5c394e3525493cbe72f46dd42b8d66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=fNDcLDPZEiQNdLBjyAsc6GQjSpI%3D" alt="" loading="lazy"/></p>
<ul>
<li>电商平台：根据用户的浏览、购买行为，推荐可能感兴趣的商品。</li>
<li>视频网站：结合观看记录和偏好，推荐个性化的影片。</li>
<li>社交媒体：根据互动数据推荐内容或好友，提升用户黏性。</li>
</ul>
<p>换句话说，推荐系统让“信息找人”成为可能，大大提升了用户体验和平台收益。</p>
<h3 data-id="heading-16">自然语言处理（NLP）</h3>
<p>自然语言处理是机器学习最具挑战性和想象力的领域之一。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6013c68d57df44aa932f837828c391a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=qb1zv54rtDsxI6gHlxP9%2BnAYvsY%3D" alt="" loading="lazy"/></p>
<ul>
<li>机器翻译：谷歌翻译、DeepL 等应用背后都是机器学习模型。</li>
<li>情感分析：分析文本中的情绪，用于舆情监控或客户反馈分析。</li>
<li>聊天机器人：利用对话数据进行训练，实现客服、助理等功能。</li>
</ul>
<p>机器学习让语言不再只是人类的专属工具，也成为了人与机器沟通的桥梁。</p>
<h3 data-id="heading-17">计算机视觉（CV）</h3>
<p>计算机视觉可以说是领域最广的一个方向了，因为自然界最不缺的就是文字和图像嘛。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d9e5aa0261f4f408ecb964f080bf326~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768577858&amp;x-signature=Unwe%2BTVfoa4GKmvIsZ1UN6OvssU%3D" alt="" loading="lazy"/></p>
<ul>
<li>人脸识别：用于安防、支付验证、身份认证。</li>
<li>自动驾驶：识别车道、行人和交通标志，辅助或完全实现无人驾驶。</li>
<li>医学影像分析：识别肿瘤、病灶等细微特征，提升诊断效率。</li>
</ul>
<p>计算机视觉已广泛应用于从手机解锁到工业检测的方方面面。</p>
<p>最新的文章都在公众号aicoting更新，别忘记关注哦！！！</p>
<h2 data-id="heading-18">参考链接</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fimgtec.eetrend.com%2Fblog%2F2019%2F100042147.html" target="_blank" title="https://imgtec.eetrend.com/blog/2019/100042147.html" ref="nofollow noopener noreferrer">imgtec.eetrend.com/blog/2019/1…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_40641591%2Farticle%2Fdetails%2F143150523" target="_blank" title="https://blog.csdn.net/qq_40641591/article/details/143150523" ref="nofollow noopener noreferrer">blog.csdn.net/qq_40641591…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_43026262%2Farticle%2Fdetails%2F103980616" target="_blank" title="https://blog.csdn.net/weixin_43026262/article/details/103980616" ref="nofollow noopener noreferrer">blog.csdn.net/weixin_4302…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nacos - 服务注册]]></title>    <link>https://juejin.cn/post/7593240931286319156</link>    <guid>https://juejin.cn/post/7593240931286319156</guid>    <pubDate>2026-01-09T15:32:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593240931286319156" data-draft-id="7593338828195561512" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Nacos - 服务注册"/> <meta itemprop="keywords" content="Java,微服务"/> <meta itemprop="datePublished" content="2026-01-09T15:32:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="元Y亨H"/> <meta itemprop="url" content="https://juejin.cn/user/2839351584888617"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Nacos - 服务注册
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2839351584888617/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    元Y亨H
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:32:49.000Z" title="Fri Jan 09 2026 15:32:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nacos 的服务注册是其核心功能之一。随着版本的演进，Nacos 经历了从 1.x（基于 HTTP）到 2.x（基于 gRPC）的架构升级。</p>
<p>下面我将从<strong>客户端发送请求</strong>、<strong>服务端处理请求</strong>、<strong>心跳维持与健康检查</strong>三个维度，详细讲解 Nacos（以 2.x 版本为主，兼顾 1.x 区别）的服务注册流程。</p>
<hr/>
<h3 data-id="heading-0">一、 整体流程概览</h3>
<ol>
<li><strong>服务启动</strong>：客户端（微服务）启动，读取配置。</li>
<li><strong>建立连接</strong>：客户端与 Nacos 服务端建立长连接（gRPC）。</li>
<li><strong>发送注册请求</strong>：客户端封装实例信息（IP、Port、服务名等）发送给服务端。</li>
<li><strong>服务端存储</strong>：服务端将实例信息存入内存注册表。</li>
<li><strong>数据同步</strong>：服务端将新注册的实例信息同步给集群内的其他 Nacos 节点（Distro 协议）。</li>
<li><strong>服务变更通知</strong>：服务端主动推送最新的服务列表给订阅了该服务的客户端。</li>
</ol>
<hr/>
<h3 data-id="heading-1">二、 详细步骤解析</h3>
<h4 data-id="heading-2">1. 客户端：发起注册 (Client Side)</h4>
<ul>
<li><strong>入口</strong>：在 Spring Cloud 环境下，注册入口是 <code>NacosServiceRegistry.register()</code> 方法。</li>
<li><strong>封装实例</strong>：构造 <code>Instance</code> 对象，包含：
<ul>
<li><code>Service Name</code>（服务名）</li>
<li><code>IP</code> 和 <code>Port</code></li>
<li><code>Weight</code>（权重）</li>
<li><code>Metadata</code>（元数据）</li>
<li><code>Ephemeral</code>（是否是临时实例，默认 <strong>true</strong>）</li>
</ul>
</li>
<li><strong>通信协议</strong>：
<ul>
<li><strong>Nacos 1.x</strong>：通过 <strong>HTTP</strong> POST 请求发送到 <code>/nacos/v1/ns/instance</code>。</li>
<li><strong>Nacos 2.x</strong>：通过 <strong>gRPC</strong> 传输。客户端通过 <code>NamingClientProxy</code> 调用 <code>registerService</code>，请求会被封装成 <code>InstanceRequest</code> 发送。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-3">2. 服务端：接收与存储 (Server Side)</h4>
<p>当 Nacos 服务端收到注册请求后，会执行以下逻辑：</p>
<ul>
<li><strong>解析请求</strong>：<code>InstanceRequestHandler</code> 接收 gRPC 请求（1.x 是 <code>InstanceController</code>）。</li>
<li><strong>内存注册表维护</strong>：
<ul>
<li>Nacos 内部维护了一个多层的 Map 结构：
<code>Map&lt;namespace, Map&lt;group::serviceName, Service&gt;&gt;</code></li>
<li><code>Service</code> 类中包含多个 <code>Cluster</code>（集群）。</li>
<li><code>Cluster</code> 中维护了两个 <code>Set&lt;Instance&gt;</code>：一个是 <strong>临时实例</strong>，一个是 <strong>持久化实例</strong>。</li>
</ul>
</li>
<li><strong>写时复制 (CopyOnWrite)</strong>：为了防止高并发下的读写冲突，Nacos 在更新实例列表时采用了类似 <strong>CopyOnWrite</strong> 的机制。它会先读取旧的列表，创建一个新列表，把新实例放进去，最后替换旧列表。</li>
</ul>
<h4 data-id="heading-4">3. 服务端：一致性协议 (Consistency)</h4>
<p>Nacos 根据实例类型（临时/持久化）走不同的协议：</p>
<ul>
<li><strong>临时实例（默认，AP模式）</strong>：
<ul>
<li>使用 <strong>Distro 协议</strong>（Nacos 自研）。</li>
<li>注册节点会立即同步给集群内其他节点。</li>
<li>遵循 <strong>最终一致性</strong>，保证高可用。</li>
</ul>
</li>
<li><strong>持久化实例（CP模式）</strong>：
<ul>
<li>使用 <strong>Raft 协议</strong>（JRaft 实现）。</li>
<li>必须过半数节点写入成功才算注册成功。</li>
<li>保证 <strong>强一致性</strong>。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">4. 服务端：推送通知 (Push)</h4>
<ul>
<li>一旦注册表发生变化，服务端会触发 <code>ServiceChangeEvent</code>。</li>
<li><strong>推送机制</strong>：服务端通过 <strong>PushService</strong> 找到所有订阅了该服务的客户端，通过 gRPC（2.x）或 UDP（1.x）将最新的实例列表推送过去。</li>
<li><strong>客户端缓存</strong>：客户端收到更新后，会更新本地的 <code>ServiceInfo</code> 缓存，从而实现负载均衡时拿到最新的地址。</li>
</ul>
<hr/>
<h3 data-id="heading-6">三、 核心：健康检查机制</h3>
<p>注册流程完成后，如何保证服务一直“在线”？</p>
<ol>
<li>
<p><strong>Nacos 1.x (HTTP + 心跳)</strong>：</p>
<ul>
<li>客户端每隔 <strong>5秒</strong> 发送一次心跳（Beat）。</li>
<li>服务端若 <strong>15秒</strong> 没收到心跳，标记为不健康。</li>
<li>若 <strong>30秒</strong> 没收到心跳，直接剔除实例。</li>
</ul>
</li>
<li>
<p><strong>Nacos 2.x (gRPC + 连接探测)</strong>：</p>
<ul>
<li><strong>长连接</strong>：基于 gRPC 的 <code>Stream</code>。如果客户端宕机，gRPC 连接会断开。</li>
<li><strong>连接断开即剔除</strong>：服务端监控连接状态，一旦连接异常断开（Connection Disconnect），服务端会立即触发下线流程（针对临时实例）。这种方式比心跳更实时。</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-7">四、 总结：1.x 与 2.x 的关键区别</h3>






























<table><thead><tr><th align="left">特性</th><th align="left">Nacos 1.x</th><th align="left">Nacos 2.x</th></tr></thead><tbody><tr><td align="left"><strong>通信协议</strong></td><td align="left">HTTP</td><td align="left">gRPC (双向流)</td></tr><tr><td align="left"><strong>注册效率</strong></td><td align="left">每次注册/心跳都是短连接，开销大</td><td align="left">长连接复用，极大减少连接握手消耗</td></tr><tr><td align="left"><strong>实时性</strong></td><td align="left">依赖心跳间隔，响应稍慢</td><td align="left">连接断开瞬时感应，响应极快</td></tr><tr><td align="left"><strong>一致性协议</strong></td><td align="left">Distro (AP) / Raft (CP)</td><td align="left">优化后的 Distro / JRaft</td></tr></tbody></table>
<p><strong>总结口述版</strong>：</p>
<blockquote>
<p>"Nacos 注册流程首先是客户端通过 gRPC（2.x）向服务端发起注册请求。服务端接收后，会将实例信息存入内存中的双层 Map 结构中，并根据实例是否是临时的，选择走 Distro 异步同步（AP）或 Raft 强一致同步（CP）。存储完成后，服务端会发布变更事件，通过长连接异步推送给所有订阅该服务的客户端。最后，通过 gRPC 的长连接状态来维持实例的健康状态，一旦断开则自动剔除。"</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂机器学习线性代数基础知识！]]></title>    <link>https://juejin.cn/post/7593175890794905646</link>    <guid>https://juejin.cn/post/7593175890794905646</guid>    <pubDate>2026-01-09T15:36:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593175890794905646" data-draft-id="7593077945016811547" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂机器学习线性代数基础知识！"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-01-09T15:36:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂机器学习线性代数基础知识！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:36:32.000Z" title="Fri Jan 09 2026 15:36:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>推荐直接网站在线阅读：<a href="https://link.juejin.cn?target=https%3A%2F%2Flink.zhihu.com%2F%3Ftarget%3Dhttps%253A%2F%2Faicoting.cn%2F" target="_blank" title="https://link.zhihu.com/?target=https%3A//aicoting.cn/" ref="nofollow noopener noreferrer">aicoting AI算法面试学习在线网站</a></p>
</blockquote>
<h2 data-id="heading-0">向量与矩阵</h2>
<h3 data-id="heading-1">向量（Vector）</h3>
<p>向量可以看作是有序数值的集合，用于表示样本特征。</p>
<p>例如，一个房屋数据可以表示为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>面积</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>房间数</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mtext>楼层</mtext></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>120</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>5</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{x} = \begin{bmatrix} \text{面积} \\ \text{房间数} \\ \text{楼层} \end{bmatrix} = \begin{bmatrix} 120 \\ 3 \\ 5 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord cjk_fallback">面积</span></span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord cjk_fallback">房间数</span></span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord text"><span class="mord cjk_fallback">楼层</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3.6em;vertical-align:-1.55em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M403 1759 V84 H666 V0 H319 V1759 v0 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.21em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">120</span></span></span><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span></span></span><span style="top:-1.81em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.05em;"><span style="top:-4.05em;"><span class="pstrut" style="height:5.6em;"/><span style="width:0.667em;height:3.600em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="3.600em" viewbox="0 0 667 3600"><path d="M347 1759 V0 H0 V84 H263 V1759 v0 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v0 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.55em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p>在机器学习中，样本就是向量，特征数决定了向量的维度。</p>
<h3 data-id="heading-2">矩阵（Matrix）</h3>
<p>多个样本堆叠成矩阵，例如一个包含 m 个样本、每个样本 n 个特征的数据集可以表示为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mrow><mn>1</mn><mi>n</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"/></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"/></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋱</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">⋮</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"/></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mrow><mi>m</mi><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mrow><mi>m</mi><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">⋯</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mrow><mi>m</mi><mi>n</mi></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">X = \begin{bmatrix} x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1n} \\ x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2n} \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ x_{m1} &amp; x_{m2} &amp; \cdots &amp; x_{mn} \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:5.46em;vertical-align:-2.48em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-4.95em;"><span class="pstrut" style="height:7.4em;"/><span style="width:0.667em;height:5.400em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="5.400em" viewbox="0 0 667 5400"><path d="M403 1759 V84 H666 V0 H319 V1759 v1800 v1759 h347 v-84&#10;H403z M403 1759 V0 H319 V1759 v1800 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.8275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-4.6275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-2.7675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"/></span></span></span><span style="top:-1.5675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.8275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-4.6275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-2.7675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"/></span></span></span><span style="top:-1.5675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.64em;"><span class="pstrut" style="height:3.5em;"/><span class="mord"><span class="minner">⋯</span></span></span><span style="top:-4.44em;"><span class="pstrut" style="height:3.5em;"/><span class="mord"><span class="minner">⋯</span></span></span><span style="top:-2.58em;"><span class="pstrut" style="height:3.5em;"/><span class="mord"><span class="minner">⋱</span></span></span><span style="top:-1.38em;"><span class="pstrut" style="height:3.5em;"/><span class="mord"><span class="minner">⋯</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.8275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-4.6275em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span><span style="top:-2.7675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord">⋮</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"/></span></span></span><span style="top:-1.5675em;"><span class="pstrut" style="height:3.6875em;"/><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">mn</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-4.95em;"><span class="pstrut" style="height:7.4em;"/><span style="width:0.667em;height:5.400em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.667em" height="5.400em" viewbox="0 0 667 5400"><path d="M347 1759 V0 H0 V84 H263 V1759 v1800 v1759 H0 v84 H347z&#10;M347 1759 V0 H263 V1759 v1800 v1759 h84z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span/></span></span></span></span></span></span></span></span></span></span></p>
<p>其中，每一行是一个样本，每一列是一个特征。</p>
<hr/>
<h2 data-id="heading-3">向量运算与几何意义</h2>
<h3 data-id="heading-4">内积（Dot Product）</h3>
<p>两个向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">a</mi><mo separator="true">,</mo><mi mathvariant="bold">b</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\mathbf{a}, \mathbf{b} \in \mathbb{R}^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathbf">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathbf">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6889em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span> 的内积定义为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">a</mi><mo>⋅</mo><mi mathvariant="bold">b</mi><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>a</mi><mi>i</mi></msub><msub><mi>b</mi><mi>i</mi></msub><mo>=</mo><msup><mi mathvariant="bold">a</mi><mi>T</mi></msup><mi mathvariant="bold">b</mi></mrow><annotation encoding="application/x-tex">\mathbf{a} \cdot \mathbf{b} = \sum_{i=1}^n a_i b_i = \mathbf{a}^T \mathbf{b}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"/><span class="mord mathbf">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathbf">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8413em;"/><span class="mord"><span class="mord mathbf">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathbf">b</span></span></span></span></span></p>
<p>几何意义上，内积表示两个向量的相似度：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">a</mi><mo>⋅</mo><mi mathvariant="bold">b</mi><mo>=</mo><mi mathvariant="normal">∥</mi><mi mathvariant="bold">a</mi><mi mathvariant="normal">∥</mi><mi mathvariant="normal">∥</mi><mi mathvariant="bold">b</mi><mi mathvariant="normal">∥</mi><mi>cos</mi><mo>⁡</mo><mi>θ</mi></mrow><annotation encoding="application/x-tex">\mathbf{a} \cdot \mathbf{b} = \|\mathbf{a}\|\|\mathbf{b}\|\cos\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4445em;"/><span class="mord mathbf">a</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathbf">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord">∥</span><span class="mord mathbf">a</span><span class="mord">∥∥</span><span class="mord mathbf">b</span><span class="mord">∥</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mop">cos</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span></span></p>
<p>这在推荐系统（如计算用户与物品的相似度）和分类（如支持向量机的超平面）中至关重要。</p>
<h3 data-id="heading-5">范数（Norm）</h3>
<p>向量的长度由范数衡量。常见的有：</p>
<ul>
<li><strong>L2 范数</strong>： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi><msub><mi mathvariant="normal">∥</mi><mn>2</mn></msub><mo>=</mo><msqrt><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup></mrow></msqrt></mrow><annotation encoding="application/x-tex">\mathbf{x}\|_2 = \sqrt{\sum_{i=1}^n x_i^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathbf">x</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.3027em;"/><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9373em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"/><span class="mord" style="padding-left:1em;"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2769em;"><span/></span></span></span></span></span></span></span><span style="top:-2.8973em;"><span class="pstrut" style="height:3.2em;"/><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119&#10;c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120&#10;c340,-704.7,510.7,-1060.3,512,-1067&#10;l0 -0&#10;c4.7,-7.3,11,-11,19,-11&#10;H40000v40H1012.3&#10;s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232&#10;c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1&#10;s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26&#10;c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z&#10;M1001 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3027em;"><span/></span></span></span></span></span></span></span></span></li>
<li><strong>L1 范数</strong>： <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi><msub><mi mathvariant="normal">∥</mi><mn>1</mn></msub><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">\mathbf{x}\|_1 = \sum_{i=1}^n |x_i|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathbf">x</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.104em;vertical-align:-0.2997em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord">∣</span></span></span></span></span></li>
</ul>
<p>在正则化中，L1 范数鼓励稀疏解（特征选择），L2 范数则抑制过大权重（防止过拟合）。</p>
<hr/>
<h2 data-id="heading-6">矩阵运算与模型计算</h2>
<h3 data-id="heading-7">矩阵乘法</h3>
<p>如果输入样本为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">x</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\mathbf{x} \in \mathbb{R}^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"/><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6889em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span>，权重矩阵W为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^{m \times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span> ，则输出为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">y</mi><mo>=</mo><mi>W</mi><mi mathvariant="bold">x</mi></mrow><annotation encoding="application/x-tex">\mathbf{y} = W \mathbf{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.1944em;"/><span class="mord mathbf" style="margin-right:0.01597em;">y</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathbf">x</span></span></span></span></span></p>
<p>这就是神经网络中 <strong>一层全连接层</strong> 的计算方式。</p>
<h3 data-id="heading-8">转置与对称矩阵</h3>
<ul>
<li>矩阵转置 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">A^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"/><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span> 在内积与相似度计算中常见。</li>
<li>对称矩阵（如协方差矩阵）在 PCA、特征值分解中起核心作用。</li>
</ul>
<p>在机器学习中，数据通常是高维的，直接处理既费计算又不易理解。<strong>特征值分解（Eigen Decomposition）和</strong> <strong>奇异值分解</strong> <strong>（</strong> <strong>SVD</strong> <strong>）</strong> 提供了强大的工具，让我们能够发现数据的“核心方向”，实现降维、特征提取和压缩。</p>
<h2 data-id="heading-9">特征值分解与奇异值分解（SVD）</h2>
<h3 data-id="heading-10">特征值分解</h3>
<p>给定一个方阵 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="double-struck">R</mi><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^{n \times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span>，如果存在标量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">λ</span></span></span></span></span> 和非零向量 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">v</mi></mrow><annotation encoding="application/x-tex">\mathbf{v}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span></span></span></span>，使得：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">v</mi><mo>=</mo><mi>λ</mi><mi mathvariant="bold">v</mi></mrow><annotation encoding="application/x-tex">\mathbf{v} = \lambda \mathbf{v}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">λ</span><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span></span></span></span>，则称 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">λ</span></span></span></span></span> 为 <strong>特征值</strong>， <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">v</mi></mrow><annotation encoding="application/x-tex">\mathbf{v}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">v</span></span></span></span></span>为 <strong>特征向量</strong>。</p>
<p>考虑一个简单的 2x2 矩阵：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">A = \begin{bmatrix} 2 &amp; 1 \\ 1 &amp; 2 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p>
<p>求解特征值和特征向量：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>det</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>A</mi><mo>−</mo><mi>λ</mi><mi>I</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn><mspace width="1em"/><mo>⇒</mo><mspace width="1em"/><mrow><mo fence="true">∣</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>2</mn><mo>−</mo><mi>λ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>2</mn><mo>−</mo><mi>λ</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">∣</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\det(A - \lambda I) = 0 \quad \Rightarrow \quad \begin{vmatrix} 2-\lambda &amp; 1 \\ 1 &amp; 2-\lambda \end{vmatrix} = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">det</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">λ</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">⇒</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:4.4em;"/><span style="width:0.333em;height:2.400em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.333em" height="2.400em" viewbox="0 0 333 2400"><path d="M145 15 v585 v1200 v585 c2.667,10,9.667,15,21,15&#10;c10,0,16.667,-5,20,-15 v-585 v-1200 v-585 c-2.667,-10,-9.667,-15,-21,-15&#10;c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v1200 v585 h43z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">λ</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mord mathnormal">λ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:4.4em;"/><span style="width:0.333em;height:2.400em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.333em" height="2.400em" viewbox="0 0 333 2400"><path d="M145 15 v585 v1200 v585 c2.667,10,9.667,15,21,15&#10;c10,0,16.667,-5,20,-15 v-585 v-1200 v-585 c-2.667,-10,-9.667,-15,-21,-15&#10;c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v1200 v585 h43z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></p>
<p>得到特征值 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mn>1</mn></msub><mo>=</mo><mn>3</mn><mo separator="true">,</mo><msub><mi>λ</mi><mn>2</mn></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\lambda_1 = 3, \lambda_2 = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal">λ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">1</span></span></span></span></span>，对应特征向量分别为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">v</mi><mn>1</mn></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo separator="true">,</mo><mspace width="1em"/><msub><mi mathvariant="bold">v</mi><mn>2</mn></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{v}_1 = \begin{bmatrix} 1 \\ 1 \end{bmatrix}, \quad \mathbf{v}_2 = \begin{bmatrix} 1 \\ -1 \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5944em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.016em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.016em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p>
<p>矩阵 A 作用在 v1 上，方向不变，只拉伸了 3 倍；作用在 v2 上，方向不变，只拉伸了 1 倍。</p>
<p>特征值分解的应用场景包括：</p>
<ul>
<li><strong>PCA</strong> <strong>降维</strong>：在 PCA（主成分分析）中，我们对数据的协方差矩阵 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mi>m</mi></mfrac><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi></mrow><annotation encoding="application/x-tex">\frac{1}{m} X^T X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span></span> 进行特征值分解，得到最大方差方向上的主成分。</li>
<li><strong>谱聚类</strong>：用 Laplacian 矩阵特征向量划分数据</li>
<li><strong>稳态分析</strong>：马尔可夫链转移矩阵的特征值分析收敛性</li>
</ul>
<h3 data-id="heading-11">奇异值分解（SVD）</h3>
<p>对于任意矩阵 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">X \in \mathbb{R}^{m \times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span>，可以分解为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mi>U</mi><mi mathvariant="normal">Σ</mi><msup><mi>V</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">X = U \Sigma V^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8413em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord">Σ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中：</p>
<ul>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>m</mi><mo>×</mo><mi>m</mi></mrow></msup></mrow><annotation encoding="application/x-tex">U \in \mathbb{R}^{m \times m}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span></span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">V \in \mathbb{R}^{n \times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"/><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span> 是正交矩阵</li>
<li><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Σ</mi><mo>∈</mo><msup><mi mathvariant="double-struck">R</mi><mrow><mi>m</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\Sigma \in \mathbb{R}^{m \times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"/><span class="mord">Σ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7713em;"/><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></span>是对角矩阵，包含奇异值 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mn>1</mn></msub><mo>≥</mo><msub><mi>σ</mi><mn>2</mn></msub><mo>≥</mo><mo>⋯</mo><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\sigma_1 \ge \sigma_2 \ge \dots \ge 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.786em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.786em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"/><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span></li>
</ul>
<p><strong>奇异值</strong>表示矩阵在各个方向上的“能量大小”。<strong>SVD</strong> <strong>可用于非</strong> <strong>方阵</strong>，比特征值分解更通用。</p>
<p>SVD 在降维、信息检索（LSA）、推荐系统（矩阵分解）中应用广泛。</p>
<p>考虑矩阵<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">X = \begin{bmatrix} 3 &amp; 1 \\ 1 &amp; 3 \\ \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p>
<p>SVD 分解结果近似为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>U</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo separator="true">,</mo><mspace width="1em"/><mi mathvariant="normal">Σ</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo separator="true">,</mo><mspace width="1em"/><msup><mi>V</mi><mi>T</mi></msup><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mfrac><mn>1</mn><msqrt><mn>2</mn></msqrt></mfrac></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">U = \begin{bmatrix} \frac{1}{\sqrt{2}} &amp; -\frac{1}{\sqrt{2}} \\ \frac{1}{\sqrt{2}} &amp; \frac{1}{\sqrt{2}} \end{bmatrix}, \quad \Sigma = \begin{bmatrix} 4 &amp; 0 \\ 0 &amp; 2 \end{bmatrix}, \quad V^T = \begin{bmatrix} \frac{1}{\sqrt{2}} &amp; \frac{1}{\sqrt{2}} \\ -\frac{1}{\sqrt{2}} &amp; \frac{1}{\sqrt{2}} \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6331em;"><span style="top:-3.788em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-2.4049em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1331em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6331em;"><span style="top:-3.788em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-2.4049em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1331em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">]</span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">Σ</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">4</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"/><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"/><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6331em;"><span style="top:-3.788em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-2.4049em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord">−</span><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1331em;"><span/></span></span></span></span><span class="arraycolsep" style="width:0.5em;"/><span class="arraycolsep" style="width:0.5em;"/><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6331em;"><span style="top:-3.788em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span><span style="top:-2.4049em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.551em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">2</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1331em;"><span/></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">]</span></span></span></span></span></span></span></p>
<p>矩阵 X 可以看作先旋转（ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>V</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">V^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8413em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>），再拉伸（ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Σ</mi></mrow><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord">Σ</span></span></span></span></span>），再旋转（U），得到原矩阵。保留最大奇异值对应的方向，就能得到数据最重要的信息。</p>
<p>奇异值分解的应用场景包括：</p>
<ul>
<li><strong>推荐系统</strong>：矩阵分解找到用户和物品的潜在因子</li>
<li><strong>图像压缩</strong>：保留主奇异值重建近似图像</li>
<li><strong>潜在语义分析（LSA）</strong> ：从文档-词矩阵提取潜在语义结构</li>
</ul>
<hr/>
<h2 data-id="heading-12">线性代数与机器学习模型</h2>
<h3 data-id="heading-13">线性回归</h3>
<p>预测公式可以写作：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover accent="true"><mi mathvariant="bold">y</mi><mo>^</mo></mover><mo>=</mo><mi>X</mi><mi mathvariant="bold">w</mi></mrow><annotation encoding="application/x-tex">\hat{\mathbf{y}} = X \mathbf{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9023em;vertical-align:-0.1944em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7079em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span><span style="top:-3.0134em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.1944em;"><span class="mord">^</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span/></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span></span></span></span></p>
<p>其中， <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">w</mi></mrow><annotation encoding="application/x-tex">\mathbf{w}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">w</span></span></span></span></span> 是回归系数。利用最小二乘法，参数解为：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="bold">w</mi><mo>=</mo><mo stretchy="false">(</mo><msup><mi>X</mi><mi>T</mi></msup><mi>X</mi><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>X</mi><mi>T</mi></msup><mi mathvariant="bold">y</mi></mrow><annotation encoding="application/x-tex">\mathbf{w} = (X^T X)^{-1} X^T \mathbf{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4444em;"/><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0913em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathbf" style="margin-right:0.01597em;">y</span></span></span></span></span></p>
<p>这是线性代数在回归分析中的直接应用。</p>
<h3 data-id="heading-14">支持向量机（SVM）</h3>
<p>SVM 本质上是寻找一个超平面 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="bold">w</mi><mi>T</mi></msup><mi mathvariant="bold">x</mi><mo>+</mo><mi>b</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\mathbf{w}^T \mathbf{x} + b = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9247em;vertical-align:-0.0833em;"/><span class="mord"><span class="mord mathbf" style="margin-right:0.01597em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathbf">x</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>，最大化数据点与超平面的几何间隔。这是典型的线性代数与凸优化结合的例子。</p>
<h3 data-id="heading-15">神经网络</h3>
<p>神经网络中，每一层的计算都是矩阵运算：<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant="bold">h</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msup><mi>W</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><msup><mi mathvariant="bold">h</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>+</mo><msup><mi mathvariant="bold">b</mi><mrow><mo stretchy="false">(</mo><mi>l</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathbf{h}^{(l)} = f(W^{(l)} \mathbf{h}^{(l-1)} + \mathbf{b}^{(l)})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"/><span class="mord"><span class="mord mathbf">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathbf">h</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mbin mtight">−</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.138em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathbf">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p>其中 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mo>⋅</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(\cdot)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">⋅</span><span class="mclose">)</span></span></span></span></span>是激活函数。可见整个网络就是一连串的线性变换+非线性映射。</p>
<p>最新的文章都在公众号aicoting更新，别忘记关注哦！！！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RAG索引流程详解：如何高效解析文档构建知识库]]></title>    <link>https://juejin.cn/post/7593164154632192009</link>    <guid>https://juejin.cn/post/7593164154632192009</guid>    <pubDate>2026-01-09T15:44:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593164154632192009" data-draft-id="7593171168259686409" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RAG索引流程详解：如何高效解析文档构建知识库"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-09T15:44:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北辰alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RAG索引流程详解：如何高效解析文档构建知识库
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北辰alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:44:56.000Z" title="Fri Jan 09 2026 15:44:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d589615192674c6681d1913cb9aff349~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768578296&amp;x-signature=EhyDj2mRevmvYLFaGeHIx7R%2FQE4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">引言：为什么文档解析是RAG的基石？</h2>
<p>在RAG（检索增强生成）系统中，文档解析是整个知识库构建的第一步，也是最关键的一步。就像建房子需要打好地基一样，良好的文档解析质量直接决定了后续检索和生成的效果。今天，我们就深入探讨RAG索引流程中的文档解析技术。</p>
<h2 data-id="heading-1">一、RAG文档解析的整体架构</h2>
<p>首先，让我们通过一个流程图了解完整的解析流程：</p>
<pre><code class="hljs">┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│                 │    │                 │    │                 │
│  原始文档集合   │───▶│  文档解析与拆分 │───▶│  文本向量化     │
│                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └────────┬────────┘
                                                        │
┌─────────────────┐    ┌─────────────────┐             │
│                 │    │                 │             ▼
│  元数据提取    │◀───│  语义分块       │    ┌─────────────────┐
│                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    │  向量存储索引  │
                                                        │                 │
                               └─────────────────┘
</code></pre>
<h2 data-id="heading-2">二、文档解析的核心步骤详解</h2>
<h3 data-id="heading-3">2.1 支持多种文档格式</h3>
<p>实际项目中，文档格式多种多样。我们需要一个能处理各种格式的解析器：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>, <span class="hljs-type">Any</span>
<span class="hljs-keyword">from</span> langchain.document_loaders <span class="hljs-keyword">import</span> (
    PyPDFLoader,
    Docx2txtLoader,
    UnstructuredHTMLLoader,
    UnstructuredMarkdownLoader,
    TextLoader
)
<span class="hljs-keyword">from</span> langchain.schema <span class="hljs-keyword">import</span> Document

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiFormatDocumentParser</span>:
    <span class="hljs-string">"""多格式文档解析器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.format_handlers = {
            <span class="hljs-string">'.pdf'</span>: self._parse_pdf,
            <span class="hljs-string">'.docx'</span>: self._parse_docx,
            <span class="hljs-string">'.html'</span>: self._parse_html,
            <span class="hljs-string">'.htm'</span>: self._parse_html,
            <span class="hljs-string">'.md'</span>: self._parse_markdown,
            <span class="hljs-string">'.txt'</span>: self._parse_text,
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_document</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析单个文档"""</span>
        ext = os.path.splitext(file_path)[<span class="hljs-number">1</span>].lower()
        
        <span class="hljs-keyword">if</span> ext <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.format_handlers:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"不支持的文件格式: <span class="hljs-subst">{ext}</span>"</span>)
        
        <span class="hljs-keyword">return</span> self.format_handlers[ext](file_path)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_pdf</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析PDF文档"""</span>
        loader = PyPDFLoader(file_path)
        documents = loader.load()
        
        <span class="hljs-comment"># 提取PDF元数据</span>
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            doc.metadata.update({
                <span class="hljs-string">'source'</span>: file_path,
                <span class="hljs-string">'format'</span>: <span class="hljs-string">'pdf'</span>,
                <span class="hljs-string">'total_pages'</span>: <span class="hljs-built_in">len</span>(documents)
            })
        
        <span class="hljs-keyword">return</span> documents
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_docx</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析Word文档"""</span>
        loader = Docx2txtLoader(file_path)
        documents = loader.load()
        
        <span class="hljs-comment"># 添加文档结构信息</span>
        <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> documents:
            doc.metadata.update({
                <span class="hljs-string">'source'</span>: file_path,
                <span class="hljs-string">'format'</span>: <span class="hljs-string">'docx'</span>
            })
        
        <span class="hljs-keyword">return</span> documents
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_html</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析HTML文档"""</span>
        loader = UnstructuredHTMLLoader(file_path)
        <span class="hljs-keyword">return</span> loader.load()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_markdown</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析Markdown文档"""</span>
        loader = UnstructuredMarkdownLoader(file_path)
        <span class="hljs-keyword">return</span> loader.load()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_text</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[Document]:
        <span class="hljs-string">"""解析纯文本文档"""</span>
        loader = TextLoader(file_path, encoding=<span class="hljs-string">'utf-8'</span>)
        <span class="hljs-keyword">return</span> loader.load()

<span class="hljs-comment"># 使用示例</span>
parser = MultiFormatDocumentParser()
documents = parser.parse_document(<span class="hljs-string">"example.pdf"</span>)
</code></pre>
<h3 data-id="heading-4">2.2 智能文档分块策略</h3>
<p>文档分块是解析的核心环节，直接影响检索质量：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain.text_splitter <span class="hljs-keyword">import</span> (
    RecursiveCharacterTextSplitter,
    TokenTextSplitter,
    MarkdownHeaderTextSplitter
)
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartChunker</span>:
    <span class="hljs-string">"""智能文档分块器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, chunk_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">1000</span>, chunk_overlap: <span class="hljs-built_in">int</span> = <span class="hljs-number">200</span></span>):
        self.chunk_size = chunk_size
        self.chunk_overlap = chunk_overlap
        
        <span class="hljs-comment"># 初始化不同的分块器</span>
        self.recursive_splitter = RecursiveCharacterTextSplitter(
            chunk_size=chunk_size,
            chunk_overlap=chunk_overlap,
            separators=[<span class="hljs-string">"\n\n"</span>, <span class="hljs-string">"\n"</span>, <span class="hljs-string">"。"</span>, <span class="hljs-string">"！"</span>, <span class="hljs-string">"？"</span>, <span class="hljs-string">"；"</span>, <span class="hljs-string">"，"</span>, <span class="hljs-string">" "</span>, <span class="hljs-string">""</span>]
        )
        
        self.token_splitter = TokenTextSplitter(
            chunk_size=chunk_size,
            chunk_overlap=chunk_overlap
        )
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">semantic_chunking</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span>, doc_type: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""语义感知的分块"""</span>
        
        <span class="hljs-comment"># 根据文档类型选择分块策略</span>
        <span class="hljs-keyword">if</span> doc_type == <span class="hljs-string">'markdown'</span>:
            <span class="hljs-keyword">return</span> self._markdown_chunking(text)
        <span class="hljs-keyword">elif</span> self._is_code_document(text):
            <span class="hljs-keyword">return</span> self._code_chunking(text)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> self._semantic_paragraph_chunking(text)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_markdown_chunking</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""Markdown文档分块"""</span>
        headers_to_split_on = [
            (<span class="hljs-string">"#"</span>, <span class="hljs-string">"标题1"</span>),
            (<span class="hljs-string">"##"</span>, <span class="hljs-string">"标题2"</span>),
            (<span class="hljs-string">"###"</span>, <span class="hljs-string">"标题3"</span>),
        ]
        
        markdown_splitter = MarkdownHeaderTextSplitter(
            headers_to_split_on=headers_to_split_on
        )
        
        chunks = markdown_splitter.split_text(text)
        <span class="hljs-keyword">return</span> [chunk.page_content <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chunks]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_code_chunking</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""代码文档分块"""</span>
        <span class="hljs-comment"># 按函数、类、方法进行分块</span>
        patterns = [
            <span class="hljs-string">r'(def\s+\w+(.*?):.*?(?=\n\s*def|\Z))'</span>,  <span class="hljs-comment"># 函数</span>
            <span class="hljs-string">r'(class\s+\w+(.*?):.*?(?=\n\s*class|\Z))'</span>,  <span class="hljs-comment"># 类</span>
            <span class="hljs-string">r'(//\s*===.*?===)'</span>,  <span class="hljs-comment"># 注释区块</span>
        ]
        
        chunks = []
        <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> patterns:
            chunks.extend(re.findall(pattern, text, re.DOTALL))
        
        <span class="hljs-keyword">return</span> chunks <span class="hljs-keyword">if</span> chunks <span class="hljs-keyword">else</span> self.recursive_splitter.split_text(text)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_semantic_paragraph_chunking</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""语义段落分块"""</span>
        <span class="hljs-comment"># 先按段落分割</span>
        paragraphs = re.split(<span class="hljs-string">r'\n\s*\n'</span>, text)
        
        chunks = []
        current_chunk = <span class="hljs-string">""</span>
        
        <span class="hljs-keyword">for</span> para <span class="hljs-keyword">in</span> paragraphs:
            para = para.strip()
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> para:
                <span class="hljs-keyword">continue</span>
                
            <span class="hljs-comment"># 如果当前块加上新段落不超过限制，就合并</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_chunk) + <span class="hljs-built_in">len</span>(para) + <span class="hljs-number">1</span> &lt;= self.chunk_size:
                <span class="hljs-keyword">if</span> current_chunk:
                    current_chunk += <span class="hljs-string">"\n\n"</span> + para
                <span class="hljs-keyword">else</span>:
                    current_chunk = para
            <span class="hljs-keyword">else</span>:
                <span class="hljs-comment"># 保存当前块，开始新块</span>
                <span class="hljs-keyword">if</span> current_chunk:
                    chunks.append(current_chunk)
                current_chunk = para
        
        <span class="hljs-comment"># 添加最后一个块</span>
        <span class="hljs-keyword">if</span> current_chunk:
            chunks.append(current_chunk)
        
        <span class="hljs-keyword">return</span> chunks
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_is_code_document</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""判断是否为代码文档"""</span>
        code_keywords = [<span class="hljs-string">'def '</span>, <span class="hljs-string">'class '</span>, <span class="hljs-string">'import '</span>, <span class="hljs-string">'function '</span>, <span class="hljs-string">'var '</span>, <span class="hljs-string">'let '</span>, <span class="hljs-string">'const '</span>]
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">any</span>(keyword <span class="hljs-keyword">in</span> text[:<span class="hljs-number">500</span>] <span class="hljs-keyword">for</span> keyword <span class="hljs-keyword">in</span> code_keywords)

<span class="hljs-comment"># 使用示例</span>
chunker = SmartChunker(chunk_size=<span class="hljs-number">1000</span>, chunk_overlap=<span class="hljs-number">200</span>)
chunks = chunker.semantic_chunking(large_text_document, doc_type=<span class="hljs-string">'markdown'</span>)
</code></pre>
<h3 data-id="heading-5">2.3 高级元数据提取</h3>
<p>元数据能显著提升检索精度：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">import</span> pytz
<span class="hljs-keyword">from</span> langchain.schema <span class="hljs-keyword">import</span> Document

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MetadataExtractor</span>:
    <span class="hljs-string">"""元数据提取器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.zh_timezone = pytz.timezone(<span class="hljs-string">'Asia/Shanghai'</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_document_metadata</span>(<span class="hljs-params">self, 
                                 content: <span class="hljs-built_in">str</span>, 
                                 file_path: <span class="hljs-built_in">str</span>, 
                                 doc_type: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""提取文档元数据"""</span>
        
        metadata = {
            <span class="hljs-string">'source'</span>: file_path,
            <span class="hljs-string">'doc_type'</span>: doc_type,
            <span class="hljs-string">'file_name'</span>: os.path.basename(file_path),
            <span class="hljs-string">'file_size'</span>: os.path.getsize(file_path),
            <span class="hljs-string">'last_modified'</span>: self._get_file_mtime(file_path),
            <span class="hljs-string">'content_hash'</span>: self._calculate_content_hash(content),
            <span class="hljs-string">'chunk_count'</span>: <span class="hljs-number">0</span>,
            <span class="hljs-string">'total_length'</span>: <span class="hljs-built_in">len</span>(content),
            <span class="hljs-string">'indexing_time'</span>: datetime.now(self.zh_timezone).isoformat(),
        }
        
        <span class="hljs-comment"># 提取内容相关元数据</span>
        content_metadata = self._extract_content_metadata(content)
        metadata.update(content_metadata)
        
        <span class="hljs-keyword">return</span> metadata
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_extract_content_metadata</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""从内容中提取元数据"""</span>
        
        <span class="hljs-comment"># 提取标题</span>
        title = self._extract_title(content)
        
        <span class="hljs-comment"># 提取关键词（简单实现）</span>
        keywords = self._extract_keywords(content)
        
        <span class="hljs-comment"># 提取文档结构信息</span>
        structure_info = self._analyze_structure(content)
        
        <span class="hljs-comment"># 提取时间信息</span>
        time_info = self._extract_time_info(content)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'title'</span>: title,
            <span class="hljs-string">'keywords'</span>: keywords,
            <span class="hljs-string">'sections'</span>: structure_info.get(<span class="hljs-string">'sections'</span>, []),
            <span class="hljs-string">'paragraph_count'</span>: structure_info.get(<span class="hljs-string">'paragraph_count'</span>, <span class="hljs-number">0</span>),
            <span class="hljs-string">'mentioned_dates'</span>: time_info,
            <span class="hljs-string">'language'</span>: self._detect_language(content),
            <span class="hljs-string">'has_tables'</span>: self._has_tables(content),
            <span class="hljs-string">'has_code_blocks'</span>: self._has_code_blocks(content),
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_extract_title</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""提取文档标题"""</span>
        <span class="hljs-comment"># 尝试从开头或Markdown标题中提取</span>
        lines = content.strip().split(<span class="hljs-string">'\n'</span>)
        
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines[:<span class="hljs-number">10</span>]:  <span class="hljs-comment"># 检查前10行</span>
            line = line.strip()
            <span class="hljs-comment"># Markdown标题</span>
            <span class="hljs-keyword">if</span> line.startswith(<span class="hljs-string">'# '</span>):
                <span class="hljs-keyword">return</span> line[<span class="hljs-number">2</span>:].strip()
            <span class="hljs-comment"># HTML标题标签</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">'&lt;h1&gt;'</span> <span class="hljs-keyword">in</span> line.lower():
                <span class="hljs-keyword">match</span> = re.search(<span class="hljs-string">r'&lt;h1[^&gt;]*&gt;(.*?)&lt;/h1&gt;'</span>, line, re.IGNORECASE)
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>:
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>).strip()
        
        <span class="hljs-comment"># 如果没有明确标题，使用第一行非空内容</span>
        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:
            <span class="hljs-keyword">if</span> line.strip() <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(line.strip()) &gt; <span class="hljs-number">10</span>:
                <span class="hljs-keyword">return</span> line.strip()[:<span class="hljs-number">100</span>]
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">"未命名文档"</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_extract_keywords</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span>, top_n: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""提取关键词（简化版）"""</span>
        <span class="hljs-comment"># 移除常见停用词</span>
        stop_words = {<span class="hljs-string">'的'</span>, <span class="hljs-string">'了'</span>, <span class="hljs-string">'在'</span>, <span class="hljs-string">'是'</span>, <span class="hljs-string">'我'</span>, <span class="hljs-string">'有'</span>, <span class="hljs-string">'和'</span>, <span class="hljs-string">'就'</span>, <span class="hljs-string">'不'</span>, <span class="hljs-string">'人'</span>, <span class="hljs-string">'都'</span>, <span class="hljs-string">'一'</span>, <span class="hljs-string">'一个'</span>}
        
        <span class="hljs-comment"># 中文分词（简化处理）</span>
        words = re.findall(<span class="hljs-string">r'[\u4e00-\u9fff]{2,}'</span>, content)
        
        <span class="hljs-comment"># 统计词频</span>
        word_freq = {}
        <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:
            <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> stop_words:
                word_freq[word] = word_freq.get(word, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>
        
        <span class="hljs-comment"># 返回频率最高的词</span>
        sorted_words = <span class="hljs-built_in">sorted</span>(word_freq.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        <span class="hljs-keyword">return</span> [word <span class="hljs-keyword">for</span> word, freq <span class="hljs-keyword">in</span> sorted_words[:top_n]]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_analyze_structure</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""分析文档结构"""</span>
        sections = []
        
        <span class="hljs-comment"># 提取标题</span>
        headings = re.findall(<span class="hljs-string">r'^(#{1,6})\s+(.+)$'</span>, content, re.MULTILINE)
        
        <span class="hljs-keyword">for</span> level, title <span class="hljs-keyword">in</span> headings:
            sections.append({
                <span class="hljs-string">'level'</span>: <span class="hljs-built_in">len</span>(level),
                <span class="hljs-string">'title'</span>: title.strip(),
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'heading'</span>
            })
        
        <span class="hljs-comment"># 统计段落</span>
        paragraphs = [p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> re.split(<span class="hljs-string">r'\n\s*\n'</span>, content) <span class="hljs-keyword">if</span> p.strip()]
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'sections'</span>: sections,
            <span class="hljs-string">'paragraph_count'</span>: <span class="hljs-built_in">len</span>(paragraphs),
            <span class="hljs-string">'has_headings'</span>: <span class="hljs-built_in">len</span>(headings) &gt; <span class="hljs-number">0</span>
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_extract_time_info</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""提取时间信息"""</span>
        <span class="hljs-comment"># 匹配常见日期格式</span>
        date_patterns = [
            <span class="hljs-string">r'\d{4}年\d{1,2}月\d{1,2}日'</span>,
            <span class="hljs-string">r'\d{4}-\d{1,2}-\d{1,2}'</span>,
            <span class="hljs-string">r'\d{4}/\d{1,2}/\d{1,2}'</span>,
        ]
        
        dates = []
        <span class="hljs-keyword">for</span> pattern <span class="hljs-keyword">in</span> date_patterns:
            dates.extend(re.findall(pattern, content))
        
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(dates))  <span class="hljs-comment"># 去重</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_detect_language</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""检测语言"""</span>
        <span class="hljs-comment"># 简单基于字符判断</span>
        zh_chars = <span class="hljs-built_in">len</span>(re.findall(<span class="hljs-string">r'[\u4e00-\u9fff]'</span>, content))
        en_chars = <span class="hljs-built_in">len</span>(re.findall(<span class="hljs-string">r'[a-zA-Z]'</span>, content))
        
        <span class="hljs-keyword">if</span> zh_chars &gt; en_chars:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'zh'</span>
        <span class="hljs-keyword">elif</span> en_chars &gt; zh_chars:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'en'</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">'mixed'</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_has_tables</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""判断是否包含表格"""</span>
        <span class="hljs-comment"># Markdown表格</span>
        <span class="hljs-keyword">if</span> re.search(<span class="hljs-string">r'|.*|.*\n|[-:\s|]+|'</span>, content):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-comment"># HTML表格</span>
        <span class="hljs-keyword">if</span> re.search(<span class="hljs-string">r'&lt;table[^&gt;]*&gt;'</span>, content, re.IGNORECASE):
            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_has_code_blocks</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""判断是否包含代码块"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bool</span>(re.search(<span class="hljs-string">r'```[\s\S]*?```'</span>, content))
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_file_mtime</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""获取文件修改时间"""</span>
        mtime = os.path.getmtime(file_path)
        <span class="hljs-keyword">return</span> datetime.fromtimestamp(mtime, self.zh_timezone).isoformat()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_content_hash</span>(<span class="hljs-params">self, content: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""计算内容哈希值"""</span>
        <span class="hljs-keyword">return</span> hashlib.md5(content.encode(<span class="hljs-string">'utf-8'</span>)).hexdigest()
</code></pre>
<h3 data-id="heading-6">2.4 完整的文档处理流水线</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DocumentProcessingPipeline</span>:
    <span class="hljs-string">"""文档处理流水线"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 
                 chunk_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">1000</span>,
                 chunk_overlap: <span class="hljs-built_in">int</span> = <span class="hljs-number">200</span></span>):
        
        self.parser = MultiFormatDocumentParser()
        self.chunker = SmartChunker(chunk_size, chunk_overlap)
        self.metadata_extractor = MetadataExtractor()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_document</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""处理单个文档"""</span>
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"开始处理文档: <span class="hljs-subst">{file_path}</span>"</span>)
        
        <span class="hljs-comment"># 1. 解析文档</span>
        raw_documents = self.parser.parse_document(file_path)
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> raw_documents:
            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"无法解析文档: <span class="hljs-subst">{file_path}</span>"</span>)
        
        <span class="hljs-comment"># 2. 合并所有页面/部分的内容</span>
        full_content = <span class="hljs-string">"\n\n"</span>.join([doc.page_content <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> raw_documents])
        
        <span class="hljs-comment"># 3. 提取文档级元数据</span>
        doc_type = os.path.splitext(file_path)[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>:].lower()
        document_metadata = self.metadata_extractor.extract_document_metadata(
            full_content, file_path, doc_type
        )
        
        <span class="hljs-comment"># 4. 智能分块</span>
        chunks = self.chunker.semantic_chunking(full_content, doc_type)
        
        <span class="hljs-comment"># 5. 为每个块添加元数据</span>
        processed_chunks = []
        <span class="hljs-keyword">for</span> i, chunk_content <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(chunks):
            chunk_metadata = document_metadata.copy()
            chunk_metadata.update({
                <span class="hljs-string">'chunk_id'</span>: i + <span class="hljs-number">1</span>,
                <span class="hljs-string">'chunk_index'</span>: i,
                <span class="hljs-string">'chunk_length'</span>: <span class="hljs-built_in">len</span>(chunk_content),
                <span class="hljs-string">'is_first_chunk'</span>: i == <span class="hljs-number">0</span>,
                <span class="hljs-string">'is_last_chunk'</span>: i == <span class="hljs-built_in">len</span>(chunks) - <span class="hljs-number">1</span>,
            })
            
            <span class="hljs-comment"># 创建Document对象</span>
            chunk_doc = Document(
                page_content=chunk_content,
                metadata=chunk_metadata
            )
            processed_chunks.append(chunk_doc)
        
        <span class="hljs-comment"># 更新文档级元数据</span>
        document_metadata[<span class="hljs-string">'chunk_count'</span>] = <span class="hljs-built_in">len</span>(processed_chunks)
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文档处理完成: <span class="hljs-subst">{file_path}</span>, 生成 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(processed_chunks)}</span> 个块"</span>)
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'document_metadata'</span>: document_metadata,
            <span class="hljs-string">'chunks'</span>: processed_chunks,
            <span class="hljs-string">'original_path'</span>: file_path
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_directory</span>(<span class="hljs-params">self, 
                         directory_path: <span class="hljs-built_in">str</span>, 
                         extensions: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">"""批量处理目录中的文档"""</span>
        
        <span class="hljs-keyword">if</span> extensions <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            extensions = [<span class="hljs-string">'.pdf'</span>, <span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.txt'</span>, <span class="hljs-string">'.md'</span>, <span class="hljs-string">'.html'</span>]
        
        all_results = []
        
        <span class="hljs-keyword">for</span> root, _, files <span class="hljs-keyword">in</span> os.walk(directory_path):
            <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:
                file_path = os.path.join(root, file)
                ext = os.path.splitext(file)[<span class="hljs-number">1</span>].lower()
                
                <span class="hljs-keyword">if</span> extensions <span class="hljs-keyword">and</span> ext <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> extensions:
                    <span class="hljs-keyword">continue</span>
                
                <span class="hljs-keyword">try</span>:
                    result = self.process_document(file_path)
                    all_results.append(result)
                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"处理文件失败 <span class="hljs-subst">{file_path}</span>: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
                    <span class="hljs-keyword">continue</span>
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"目录处理完成，共处理 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(all_results)}</span> 个文档"</span>)
        <span class="hljs-keyword">return</span> all_results

<span class="hljs-comment"># 使用示例</span>
pipeline = DocumentProcessingPipeline(
    chunk_size=<span class="hljs-number">1000</span>,
    chunk_overlap=<span class="hljs-number">200</span>
)

<span class="hljs-comment"># 处理单个文档</span>
result = pipeline.process_document(<span class="hljs-string">"document.pdf"</span>)

<span class="hljs-comment"># 处理整个目录</span>
results = pipeline.process_directory(
    <span class="hljs-string">"./knowledge_base"</span>,
    extensions=[<span class="hljs-string">'.pdf'</span>, <span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.md'</span>, <span class="hljs-string">'.txt'</span>]
)

<span class="hljs-comment"># 提取所有块</span>
all_chunks = []
<span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results:
    all_chunks.extend(result[<span class="hljs-string">'chunks'</span>])

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"总共生成 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(all_chunks)}</span> 个文本块"</span>)
</code></pre>
<h2 data-id="heading-7">三、性能优化和最佳实践</h2>
<h3 data-id="heading-8">3.1 并行处理加速</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> concurrent.futures
<span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ParallelDocumentProcessor</span>:
    <span class="hljs-string">"""并行文档处理器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, max_workers: <span class="hljs-built_in">int</span> = <span class="hljs-number">4</span></span>):
        self.pipeline = DocumentProcessingPipeline()
        self.max_workers = max_workers
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_batch</span>(<span class="hljs-params">self, file_paths: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]]:
        <span class="hljs-string">"""批量并行处理文档"""</span>
        
        results = []
        
        <span class="hljs-keyword">with</span> concurrent.futures.ProcessPoolExecutor(
            max_workers=self.max_workers
        ) <span class="hljs-keyword">as</span> executor:
            <span class="hljs-comment"># 提交任务</span>
            future_to_file = {
                executor.submit(self.pipeline.process_document, fp): fp 
                <span class="hljs-keyword">for</span> fp <span class="hljs-keyword">in</span> file_paths
            }
            
            <span class="hljs-comment"># 处理结果</span>
            <span class="hljs-keyword">for</span> future <span class="hljs-keyword">in</span> tqdm(
                concurrent.futures.as_completed(future_to_file),
                total=<span class="hljs-built_in">len</span>(file_paths),
                desc=<span class="hljs-string">"处理文档"</span>
            ):
                file_path = future_to_file[future]
                <span class="hljs-keyword">try</span>:
                    result = future.result()
                    results.append(result)
                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"处理失败 <span class="hljs-subst">{file_path}</span>: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>)
        
        <span class="hljs-keyword">return</span> results
</code></pre>
<h3 data-id="heading-9">3.2 增量更新处理</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IncrementalIndexUpdater</span>:
    <span class="hljs-string">"""增量索引更新器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, index_storage_path: <span class="hljs-built_in">str</span></span>):
        self.index_storage_path = index_storage_path
        self.processed_files = self._load_processed_files()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_load_processed_files</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""加载已处理文件记录"""</span>
        record_file = os.path.join(self.index_storage_path, <span class="hljs-string">"processed_files.json"</span>)
        
        <span class="hljs-keyword">if</span> os.path.exists(record_file):
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(record_file, <span class="hljs-string">'r'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
                <span class="hljs-keyword">return</span> json.load(f)
        <span class="hljs-keyword">return</span> {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_save_processed_files</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""保存已处理文件记录"""</span>
        record_file = os.path.join(self.index_storage_path, <span class="hljs-string">"processed_files.json"</span>)
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(record_file, <span class="hljs-string">'w'</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
            json.dump(self.processed_files, f, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_changed_files</span>(<span class="hljs-params">self, 
                         directory_path: <span class="hljs-built_in">str</span>, 
                         extensions: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""获取有变化的文件"""</span>
        
        changed_files = []
        
        <span class="hljs-keyword">for</span> root, _, files <span class="hljs-keyword">in</span> os.walk(directory_path):
            <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:
                file_path = os.path.join(root, file)
                ext = os.path.splitext(file)[<span class="hljs-number">1</span>].lower()
                
                <span class="hljs-keyword">if</span> extensions <span class="hljs-keyword">and</span> ext <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> extensions:
                    <span class="hljs-keyword">continue</span>
                
                <span class="hljs-comment"># 检查文件是否已处理或有更新</span>
                file_hash = self._calculate_file_hash(file_path)
                
                <span class="hljs-keyword">if</span> (file_path <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.processed_files <span class="hljs-keyword">or</span> 
                    self.processed_files[file_path] != file_hash):
                    changed_files.append(file_path)
                    self.processed_files[file_path] = file_hash
        
        <span class="hljs-keyword">return</span> changed_files
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_calculate_file_hash</span>(<span class="hljs-params">self, file_path: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
        <span class="hljs-string">"""计算文件哈希"""</span>
        hasher = hashlib.md5()
        
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:
            buf = f.read(<span class="hljs-number">65536</span>)
            <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(buf) &gt; <span class="hljs-number">0</span>:
                hasher.update(buf)
                buf = f.read(<span class="hljs-number">65536</span>)
        
        <span class="hljs-keyword">return</span> hasher.hexdigest()
</code></pre>
<h2 data-id="heading-10">四、常见问题与解决方案</h2>
<h3 data-id="heading-11">问题1：文档格式兼容性</h3>
<p><strong>解决方案</strong>：使用多个解析库，并实现降级策略</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">robust_pdf_parsing</span>(<span class="hljs-params">file_path: <span class="hljs-built_in">str</span></span>):
    <span class="hljs-string">"""鲁棒的PDF解析"""</span>
    parsers = [PyPDFLoader, UnstructuredPDFLoader]
    
    <span class="hljs-keyword">for</span> parser_class <span class="hljs-keyword">in</span> parsers:
        <span class="hljs-keyword">try</span>:
            loader = parser_class(file_path)
            <span class="hljs-keyword">return</span> loader.load()
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">continue</span>
    
    <span class="hljs-comment"># 降级到文本提取</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">import</span> textract
        text = textract.process(file_path).decode(<span class="hljs-string">'utf-8'</span>)
        <span class="hljs-keyword">return</span> [Document(page_content=text, metadata={<span class="hljs-string">'source'</span>: file_path})]
    <span class="hljs-keyword">except</span>:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f"无法解析PDF文件: <span class="hljs-subst">{file_path}</span>"</span>)
</code></pre>
<h3 data-id="heading-12">问题2：中文文档分块效果不佳</h3>
<p><strong>解决方案</strong>：使用专门的中文分块器</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ChineseTextSplitter</span>:
    <span class="hljs-string">"""中文文本分块器"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, chunk_size=<span class="hljs-number">500</span>, chunk_overlap=<span class="hljs-number">50</span></span>):
        self.chunk_size = chunk_size
        self.chunk_overlap = chunk_overlap
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">split_text</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-comment"># 使用中文标点进行分割</span>
        separators = [<span class="hljs-string">'\n\n'</span>, <span class="hljs-string">'\n'</span>, <span class="hljs-string">'。'</span>, <span class="hljs-string">'！'</span>, <span class="hljs-string">'？'</span>, <span class="hljs-string">'；'</span>, <span class="hljs-string">'……'</span>, <span class="hljs-string">'…'</span>, <span class="hljs-string">'，'</span>, <span class="hljs-string">'、'</span>]
        
        chunks = []
        current_chunk = <span class="hljs-string">""</span>
        
        <span class="hljs-comment"># 按句子分割</span>
        sentences = self._split_into_sentences(text)
        
        <span class="hljs-keyword">for</span> sentence <span class="hljs-keyword">in</span> sentences:
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(current_chunk) + <span class="hljs-built_in">len</span>(sentence) &lt;= self.chunk_size:
                current_chunk += sentence
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">if</span> current_chunk:
                    chunks.append(current_chunk)
                current_chunk = sentence
        
        <span class="hljs-keyword">if</span> current_chunk:
            chunks.append(current_chunk)
        
        <span class="hljs-keyword">return</span> chunks
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_split_into_sentences</span>(<span class="hljs-params">self, text: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]:
        <span class="hljs-string">"""将中文文本分割成句子"""</span>
        <span class="hljs-keyword">import</span> re
        <span class="hljs-comment"># 中文句子分割规则</span>
        pattern = <span class="hljs-string">r'([。！？；…]+\s*)'</span>
        parts = re.split(pattern, text)
        
        sentences = []
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(parts)-<span class="hljs-number">1</span>, <span class="hljs-number">2</span>):
            sentence = parts[i] + (parts[i+<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> i+<span class="hljs-number">1</span> &lt; <span class="hljs-built_in">len</span>(parts) <span class="hljs-keyword">else</span> <span class="hljs-string">''</span>)
            <span class="hljs-keyword">if</span> sentence.strip():
                sentences.append(sentence)
        
        <span class="hljs-keyword">return</span> sentences
</code></pre>
<h2 data-id="heading-13">五、实战：构建完整的RAG索引系统</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CompleteRAGIndexer</span>:
    <span class="hljs-string">"""完整的RAG索引构建系统"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, 
                 embedding_model=<span class="hljs-literal">None</span>,
                 vector_store=<span class="hljs-literal">None</span></span>):
        
        self.pipeline = DocumentProcessingPipeline()
        self.parallel_processor = ParallelDocumentProcessor()
        self.updater = IncrementalIndexUpdater(<span class="hljs-string">"./vector_store"</span>)
        
        self.embedding_model = embedding_model
        self.vector_store = vector_store
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">build_index</span>(<span class="hljs-params">self, 
                   knowledge_base_path: <span class="hljs-built_in">str</span>,
                   incremental: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""构建知识库索引"""</span>
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始构建RAG索引..."</span>)
        
        <span class="hljs-comment"># 1. 获取需要处理的文件</span>
        <span class="hljs-keyword">if</span> incremental:
            files_to_process = self.updater.get_changed_files(
                knowledge_base_path,
                extensions=[<span class="hljs-string">'.pdf'</span>, <span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.md'</span>, <span class="hljs-string">'.txt'</span>, <span class="hljs-string">'.html'</span>]
            )
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"增量更新: 发现 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(files_to_process)}</span> 个变更文件"</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 获取所有文件</span>
            all_files = []
            <span class="hljs-keyword">for</span> root, _, files <span class="hljs-keyword">in</span> os.walk(knowledge_base_path):
                <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:
                    <span class="hljs-keyword">if</span> file.lower().endswith((<span class="hljs-string">'.pdf'</span>, <span class="hljs-string">'.docx'</span>, <span class="hljs-string">'.md'</span>, <span class="hljs-string">'.txt'</span>, <span class="hljs-string">'.html'</span>)):
                        all_files.append(os.path.join(root, file))
            files_to_process = all_files
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> files_to_process:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"没有需要处理的文件"</span>)
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'status'</span>: <span class="hljs-string">'no_changes'</span>, <span class="hljs-string">'chunks'</span>: []}
        
        <span class="hljs-comment"># 2. 并行处理文档</span>
        processing_results = self.parallel_processor.process_batch(files_to_process)
        
        <span class="hljs-comment"># 3. 提取所有文本块</span>
        all_chunks = []
        <span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> processing_results:
            all_chunks.extend(result[<span class="hljs-string">'chunks'</span>])
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"总共生成 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(all_chunks)}</span> 个文本块"</span>)
        
        <span class="hljs-comment"># 4. 生成向量嵌入</span>
        <span class="hljs-keyword">if</span> self.embedding_model <span class="hljs-keyword">and</span> self.vector_store:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"开始生成向量嵌入..."</span>)
            
            texts = [chunk.page_content <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> all_chunks]
            metadatas = [chunk.metadata <span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> all_chunks]
            
            embeddings = self.embedding_model.embed_documents(texts)
            
            <span class="hljs-comment"># 存储到向量数据库</span>
            self.vector_store.add_embeddings(
                texts=texts,
                embeddings=embeddings,
                metadatas=metadatas
            )
            
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"向量索引构建完成"</span>)
        
        <span class="hljs-comment"># 5. 保存处理记录</span>
        self.updater._save_processed_files()
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'status'</span>: <span class="hljs-string">'success'</span>,
            <span class="hljs-string">'total_chunks'</span>: <span class="hljs-built_in">len</span>(all_chunks),
            <span class="hljs-string">'processed_files'</span>: <span class="hljs-built_in">len</span>(files_to_process),
            <span class="hljs-string">'chunks'</span>: all_chunks
        }

<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># 初始化组件</span>
    <span class="hljs-keyword">from</span> langchain.embeddings <span class="hljs-keyword">import</span> OpenAIEmbeddings
    <span class="hljs-keyword">from</span> langchain.vectorstores <span class="hljs-keyword">import</span> Chroma
    
    embedding_model = OpenAIEmbeddings()
    vector_store = Chroma(
        persist_directory=<span class="hljs-string">"./chroma_db"</span>,
        embedding_function=embedding_model
    )
    
    <span class="hljs-comment"># 构建索引</span>
    indexer = CompleteRAGIndexer(
        embedding_model=embedding_model,
        vector_store=vector_store
    )
    
    <span class="hljs-comment"># 首次全量构建</span>
    result = indexer.build_index(
        knowledge_base_path=<span class="hljs-string">"./knowledge_base"</span>,
        incremental=<span class="hljs-literal">False</span>
    )
    
    <span class="hljs-comment"># 后续增量更新</span>
    result = indexer.build_index(
        knowledge_base_path=<span class="hljs-string">"./knowledge_base"</span>,
        incremental=<span class="hljs-literal">True</span>
    )
</code></pre>
<h2 data-id="heading-14">六、总结与展望</h2>
<p>文档解析是RAG系统的基石，一个优秀的解析系统应该具备：</p>
<ol>
<li>1. <strong>多格式支持</strong>：能处理各种常见文档格式</li>
<li>2. <strong>智能分块</strong>：理解文档结构，保持语义完整性</li>
<li>3. <strong>丰富元数据</strong>：提取有用信息辅助检索</li>
<li>4. <strong>高效处理</strong>：支持并行和增量更新</li>
<li>5. <strong>鲁棒性</strong>：能处理各种异常情况</li>
</ol>
<p>随着大模型技术的发展，未来的文档解析会更加智能化，比如：</p>
<ul>
<li>• 使用视觉模型解析复杂版式</li>
<li>• 利用大模型理解文档语义结构</li>
<li>• 自动识别文档类型和领域</li>
<li>• 智能提取表格、图表等非文本内容</li>
</ul>
<p>希望本文对你构建自己的RAG系统有所帮助！记住，好的开始是成功的一半，精心设计的文档解析流程会让你的RAG系统事半功倍。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS一杯冰美式的时间 -- FullScreenLaunchComponent]]></title>    <link>https://juejin.cn/post/7593338828195577896</link>    <guid>https://juejin.cn/post/7593338828195577896</guid>    <pubDate>2026-01-09T15:58:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195577896" data-draft-id="7593187953272160256" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS一杯冰美式的时间 -- FullScreenLaunchComponent"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2026-01-09T15:58:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="猫猫头啊"/> <meta itemprop="url" content="https://juejin.cn/user/1283876003519357"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS一杯冰美式的时间 -- FullScreenLaunchComponent
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1283876003519357/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    猫猫头啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T15:58:51.000Z" title="Fri Jan 09 2026 15:58:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>最近在开发中，我们的元服务需要被其他应用通过FullScreenLaunchComponent拉起，我只能说当时上了5.0的当，FullScreenLaunchComponent也是Beta版本的！在实际开发中作为碰了几次灰，踩了不少坑，觉得有必要分享下，故有了此篇文章。</p>
<p>该系列依旧会带着大家，了解，开阔一些不怎么热门的API，也可能是偷偷被更新的API，也可以是好玩的，藏在官方文档的边边角角~当然也会有一些API，之前是我们辛辛苦苦的手撸代码，现在有一个API能帮我们快速实现的，希望大家能找宝藏。</p>
<p>如果您有任何疑问、对文章写的不满意、发现错误或者有更好的方法，欢迎在评论、私信或邮件中提出，非常感谢您的支持。🙏</p>
<h2 data-id="heading-1">二、FullScreenLaunchComponent的诞生背景</h2>
<p>OK，步入正题把，在HarmonyOS开发中，我们可能会需要在一个应用中嵌入另一个应用的能力。比如，你的应用想要使用某个元服务提供的功能，但又不想让用户跳转到另一个应用，而是希望在自己的应用内无缝使用这个能力。</p>
<p>以前我们可能需要通过跳转的方式拉起另一个应用，这样用户体验就不够流畅。FullScreenLaunchComponent就是为了解决这个问题而生的，它允许我们以全屏方式拉起元服务，使得应用能够提供更友好的用户体验。虽然我不是很喜欢这个能力，因为真的坑到我了。</p>
<h3 data-id="heading-2">1. 什么是FullScreenLaunchComponent</h3>
<p>FullScreenLaunchComponent是由ArkUI提供的组件，简单来说，它就是一个"容器"，可以嵌入运行另一个元服务的UI。</p>
<p>当被拉起方授权使用方应用嵌入式运行元服务时，使用方应用可全屏嵌入式运行该服务；若未授权，则使用方应用将以跳出式方式拉起元服务。</p>
<h2 data-id="heading-3">三、基本使用</h2>
<h3 data-id="heading-4">1. 版本说明</h3>
<ul>
<li>该组件从API version 12开始支持</li>
<li>该组件不支持在Wearable设备上使用（真的需要在穿戴设备使用这个功能吗？？？？）</li>
<li>5.0和6.0的表现非常不一样！</li>
</ul>
<h3 data-id="heading-5">2. 使用方接入</h3>
<p>使用方接入非常简单，只需要几行代码就能搞定：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FullScreenLaunchComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">appId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'XXXXX'</span>; <span class="hljs-comment">// 元服务appId</span>

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Row</span>() {
      <span class="hljs-title class_">Column</span>() {
        <span class="hljs-title class_">FullScreenLaunchComponent</span>({
          <span class="hljs-attr">content</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">ColumnChild</span>,  <span class="hljs-comment">// 占位图标组件</span>
          <span class="hljs-attr">appId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">appId</span>,     <span class="hljs-comment">// 元服务appId</span>
          <span class="hljs-attr">options</span>: {},           <span class="hljs-comment">// 拉起参数</span>
          <span class="hljs-attr">onTerminated</span>: <span class="hljs-function">(<span class="hljs-params">info</span>) =&gt;</span> {
            <span class="hljs-comment">// 元服务退出时的回调</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onTerminated code: <span class="hljs-subst">${info.code.toString()}</span>`</span>);
          },
          <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
            <span class="hljs-comment">// 发生异常时的回调</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`onError code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);
          },
          <span class="hljs-attr">onReceive</span>: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
            <span class="hljs-comment">// 接收元服务传递的数据</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onReceive, data: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data)}</span>`</span>);
          }
        }).<span class="hljs-title function_">width</span>(<span class="hljs-string">"80vp"</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">"80vp"</span>)
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    }
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
  }
}

<span class="hljs-comment">// 占位图标，点击后拉起元服务</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ColumnChild</span>(<span class="hljs-params"/>) {
  <span class="hljs-title class_">Column</span>() {
    <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.startIcon'</span>))
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'test'</span>)
  }
}
</code></pre>
<p>可以看到，接入确实非常方便！只需要：</p>
<ol>
<li>导入<code>FullScreenLaunchComponent</code></li>
<li>传入<code>appId</code>（元服务的唯一标识）</li>
<li>传入<code>content</code>（占位图标组件）</li>
<li>可选：设置回调函数</li>
</ol>
<h3 data-id="heading-6">3. 提供方实现</h3>
<p>提供方需要继承<code>EmbeddableUIAbility</code>，这是<strong>必须</strong>的！否则系统无法保证元服务功能正常(刚开始，你继承或者不继承，都不影响不正常...)。</p>
<p>提供方入口文件：<code>/src/main/ets/entryability/EntryAbility.ets</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Want</span>, <span class="hljs-title class_">EmbeddableUIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;
<span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DOMAIN</span> = <span class="hljs-number">0x0000</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">EmbeddableUIAbility</span> {
  storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();
  
  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);
  }

  <span class="hljs-title function_">onDestroy</span>(): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onDestroy'</span>);
  }

  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onWindowStageCreate'</span>);
    <span class="hljs-comment">// ⚠️ 重要：正常开发中getMainWindowSync可以正常使用，但如果需要提供给FullScreenLaunchComponent，</span>
    <span class="hljs-comment">// 在FullScreenLaunchComponent场景下getMainWindowSync会崩溃，必须使用try-catch，虽然你也拿不到，笑死了。</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">let</span> mainWindow = windowStage.<span class="hljs-title function_">getMainWindowSync</span>();
    <span class="hljs-comment">//TODO 做点什么</span>
    } <span class="hljs-keyword">catch</span> (err) {
      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'getMainWindowSync failed: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));
    }
    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>);
  }

  <span class="hljs-title function_">onWindowStageDestroy</span>(): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onWindowStageDestroy'</span>);
  }

  <span class="hljs-title function_">onForeground</span>(): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onForeground'</span>);
  }

  <span class="hljs-title function_">onBackground</span>(): <span class="hljs-built_in">void</span> {
    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onBackground'</span>);
  }
}
</code></pre>
<h2 data-id="heading-7">四、实际开发中的坑点</h2>
<p>以下问题都是我们在作为提供方开发时遇到的，如果你是使用方，可能不会遇到这些问题，但了解这些限制也有助于更好地使用FullScreenLaunchComponent。</p>
<h3 data-id="heading-8">1. 状态栏高度获取问题</h3>
<p>在HarmonyOS 6.0之前，我们在EmbeddableUIAbility中顶部的状态栏高度没有办法正确的获取。这个问题很隐蔽，因为不会报错，只是获取到的值不对，导致UI布局出现问题。</p>
<p><strong>解决方案：</strong></p>
<p>在6.0之前，我直接使用了固定的值。虽然不够优雅，但这是最稳妥的方案。如果你的应用需要适配多个版本，建议封装一个工具方法来处理状态栏高度的获取，避免在不同版本上出现显示问题。</p>
<h3 data-id="heading-9">2. Window相关API的异常处理</h3>
<p>在正常开发中，我们一般会使用<code>windowStage.getMainWindowSync()</code>来获取主窗口，这个方法在普通场景下是可以正常工作的。但是，如果你的元服务需要提供给FullScreenLaunchComponent使用，<code>getMainWindowSync()</code>会崩!!!!！</p>
<p>很多地方习惯性地使用<code>getMainWindow()</code>或者<code>windowStage.getMainWindowSync()</code>，结果在FullScreenLaunchComponent场景下直接崩溃，当时真的是一脸懵逼。(这也促使我们在后面的代码规范中，禁止所有对window方法的直接使用)</p>
<p>这是因为FullScreenLaunchComponent内部默认方式下，提供方无真正的窗口承载，所以无法正常获取Window对象。如果你没有进行try-catch的话，哦吼，崩掉。</p>
<h3 data-id="heading-10">3. 调试困难问题</h3>
<p>调试非常困难，特别是你需要调试的东西在启动流程（如<code>onCreate</code>、<code>onWindowStageCreate</code>）的时候，没法进行调试。因为每次被使用方拉起时，都会创建一个新的Embeddable进程，没办法提前断点，或者断点启动，所以根本没有办法进行启动流程的调试。</p>
<p>我们只能通过日志来一点点排查问题，非常痛苦。</p>
<p><strong>解决方案：</strong></p>
<p>只能一点点的加日志输出。虽然调试体验不好，但这是跨进程架构带来的限制，我们只能通过日志来排查问题。</p>
<h3 data-id="heading-11">4. UIContext获取异常</h3>
<p>因为提供方无真正的窗口承载，所以第2点说的window异常的，实际上获取的UIContext的获取也是异常的。我们在代码中大量使用了<code>getUIContext()</code>来获取UIContext，结果在FullScreenLaunchComponent场景下可能获取不到正确的值，导致很多功能异常。</p>
<p>最后我们修改了大量的使用Context的地方，部分改用<code>applicationContext</code>，才解决了这个问题。</p>
<p>在FullScreenLaunchComponent场景下，尽量避免使用UIContext，优先使用<code>applicationContext</code>或<code>UIAbilityContext</code>。如果必须使用UIContext，一定要做好异常处理。</p>
<h3 data-id="heading-12">5. 不支持富文本组件</h3>
<p>部分功能使用了RichText组件来显示富文本内容，然后发现RichText组件在FullScreenLaunchComponent中不支持。淦！</p>
<p><strong>解决方案：</strong></p>
<p>阿弥陀佛，我们直接重写了一套，富文本组件，搞心态。</p>
<h3 data-id="heading-13">6. EmbeddableUIAbilityContext的特殊性</h3>
<p>作为提供方，我们必须继承<code>EmbeddableUIAbility</code>，但是<code>EmbeddableUIAbility</code>的上下文，是和普通的<code>UIAbility</code>的上下文<code>UIAbilityContext</code>不一样的，使用的是<code>EmbeddableUIAbilityContext</code>，虽然是有继承关系，但在某些API的使用上可能存在差异。</p>
<p>我们在开发时，有些原本在普通UIAbility中能正常工作的代码，在EmbeddableUIAbility中就不行了，就是因为上下文类型的差异导致的。</p>
<p>在使用上下文相关API时，要注意<code>EmbeddableUIAbilityContext</code>和<code>UIAbilityContext</code>的差异，做好兼容处理。</p>
<h2 data-id="heading-14">五、能力范围与限制</h2>
<p>官方文档其实也列出很多限制场景，如下：</p>
<h3 data-id="heading-15">1. 不支持的能力</h3>
<p><strong>组件方面：</strong></p>
<ul>
<li><code>FullScreenLaunchComponent</code>：不支持嵌套拉起（总不能套娃吧...）</li>
<li><code>EmbeddedComponent</code>：不支持嵌套拉起</li>
<li><code>RichText</code>：不支持富文本组件</li>
<li><code>FolderStack</code>：不支持（需要和宿主方窗口形成联动）</li>
<li><code>XComponent</code>：不支持</li>
<li><code>FormLink</code>：不支持</li>
<li><code>HyperLink</code>：不支持</li>
<li><code>ContextMenu</code>：不支持</li>
</ul>
<p><strong>Node-API接口方面：</strong></p>
<ul>
<li>页面间转场：不支持</li>
<li>组件内隐式共享元素转场：不支持</li>
<li><code>componentUtils</code>：不支持（获取的位置信息是EmbeddableUIAbility的WindowProxy的信息）</li>
<li><code>UIContext</code>：不支持（提供方无真正的窗口承载）</li>
<li><code>DragController</code>：不支持（依赖UIContext）</li>
<li>注册自定义字体：不支持</li>
</ul>
<h3 data-id="heading-16">2. 部分支持的能力</h3>
<p><strong>弹窗组件：</strong></p>
<ul>
<li>警告弹窗、列表选择弹窗、自定义弹窗：部分支持</li>
<li>若在FullScreenLaunchComponent中设置<code>showInSubWindow</code>为<code>true</code>，弹窗将基于FullScreenLaunchComponent的宿主窗口对齐</li>
<li>仅限于窗口对齐，其他能力可能受限</li>
</ul>
<p><strong>Navigation组件：</strong></p>
<ul>
<li>部分支持</li>
<li>如果FullScreenLaunchComponent未设置模态或沉浸式，Navigation无法扩展到安全区</li>
<li>无法路由到宿主方的页面中</li>
</ul>
<h3 data-id="heading-17">3. 其他约束</h3>
<p><strong>安全能力约束：</strong></p>
<ul>
<li>FullScreenLaunchComponent能力无法独立提供安全保障机制</li>
<li>提供方应用需要结合使用其他ArkUI的能力进行安全保护</li>
<li>如果存在安全方面的诉求，建议优先使用其他方案</li>
</ul>
<p><strong>嵌套约束：</strong></p>
<ul>
<li>FullScreenLaunchComponent暂不支持嵌套</li>
<li>不支持A应用(UIAbility)-&gt;B应用(EmbeddableUIAbility)-&gt;C应用(EmbeddableUIAbility)这种嵌套能力依赖</li>
</ul>
<p><strong>事件处理机制约束：</strong></p>
<ul>
<li>FullScreenLaunchComponent不支持通用事件，会将事件经过坐标转换后传递给提供方EmbeddableUIAbility处理</li>
<li>宿主进程与提供方进程的交互默认均是异步处理</li>
<li>某些事件（如按键事件、焦点事件）支持同步处理，但支持超时等待机制</li>
</ul>
<p><strong>页面渲染效果体验约束：</strong></p>
<ul>
<li><strong>闪白现象</strong>：创建并拉起另一个进程是耗时的，使用方在等待过程中会感知到FullScreenLaunchComponent的背景色（默认是白色）</li>
<li><strong>渲染显示不同步现象</strong>：当使用方应用页面快速变化时（如横竖屏切换），会出现使用方页面渲染过程和FullScreenLaunchComponent组件中展示的内容不同步的情况</li>
</ul>
<p><strong>消减闪白问题的方法：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">FullScreenLaunchComponent</span>({
  <span class="hljs-attr">content</span>: <span class="hljs-title class_">ColumnChild</span>,
  <span class="hljs-attr">appId</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">appId</span>,
  <span class="hljs-attr">options</span>: {},
})
.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5F5F5'</span>)  <span class="hljs-comment">// 根据提供方页面背景色设置，实现无跳变感知</span>
.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
</code></pre>
<h2 data-id="heading-18">六、总结</h2>
<p>总的来说，FullScreenLaunchComponent是一个很强大的组件，使用方接入确实非常方便（苦了我们这些提供方），虽然存在一些限制和坑点，但FullScreenLaunchComponent的效果其实还不错的，有时候都感知不到是到了我们的元服务里面，以为就是自己~</p>
<p>好了，关于FullScreenLaunchComponent的内容我们就介绍到这里。虽然使用方接入很方便，但作为提供方在实际开发中确实有不少坑，希望这篇文章能帮助到正在开发或准备开发可被FullScreenLaunchComponent接入的元服务的开发者。</p>
<h2 data-id="heading-19">七、最后</h2>
<p>因为篇幅原因，我们先到这，哈、下一篇还没想好写什么，如果你有想看的也可以在评论区，或者私信给我，马上写～咕咕咕。</p>
<p>如果您有任何疑问、对文章写的不满意、发现错误或者有更好的方法，欢迎在评论、私信或邮件中提出，非常感谢您的支持。🙏</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[阿里Qwen3-VL双子星开源：图文视频混合检索的“降维打击”]]></title>    <link>https://juejin.cn/post/7593181244709158964</link>    <guid>https://juejin.cn/post/7593181244709158964</guid>    <pubDate>2026-01-09T14:06:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593181244709158964" data-draft-id="7593338828195381288" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="阿里Qwen3-VL双子星开源：图文视频混合检索的“降维打击”"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-09T14:06:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            阿里Qwen3-VL双子星开源：图文视频混合检索的“降维打击”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:06:21.000Z" title="Fri Jan 09 2026 14:06:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你关注大模型领域的最新动态，应该注意到了2026年1月8日的一个重磅消息：阿里通义千问团队把他们的“看家本领”拿出来了。</p>
<p>这次开源的不是又一个单纯聊天的Chatbot，而是一套专门解决“多模态检索”难题的工具链——<strong>Qwen3-VL-Embedding</strong> 和 <strong>Qwen3-VL-Reranker</strong>。</p>
<p>简单说，这套模型是基于强大的Qwen3-VL底座打造的，它们解决了一个让开发者头疼已久的问题：在这个图文、视频爆炸的年代，我们该如何像搜索文字一样，精准地搜索视频片段、复杂图表和截屏？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2F640-1-1024x576.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/640-1-1024x576.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/501a319dc2c4490587c242d5ae9b79cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768572381&amp;x-signature=9pbNLT5ePNNnmXBKeTBP4lrDIdA%3D" alt="640" loading="lazy"/></a></p>
<h3 data-id="heading-0">为什么需要这套“双子星”？</h3>
<p>在过去的一年里，RAG（检索增强生成）几乎成了企业级应用的标配。但痛点在于，传统的RAG大多是“瞎子”，只能处理纯文本。一旦文档里夹杂了流程图、或者知识库里堆满了视频素材，传统模型就歇菜了。</p>
<p>通义团队这次打出的组合拳，正是为了填补这个空白。</p>
<p>这套系统由两个核心角色组成，配合起来就像是一个经验丰富的“图书管理员”：</p>
<p><strong>第一步：Qwen3-VL-Embedding（负责“广撒网”）</strong> 这是检索的第一道关卡。它的任务是把所有的素材——无论是PDF里的文字、PPT里的架构图，还是长视频里的某一帧，统统“翻译”成统一的数学向量。 这打破了模态之间的“生殖隔离”。有了它，你不仅可以用文字搜图，还能用图搜视频。而且，它支持所谓的“Matryoshka”套娃式表示学习，这意味着你可以在推理时灵活截断向量维度，在精度和速度之间自由切换，不用重新训练模型。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Ffadsfsfg-1024x500.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/fadsfsfg-1024x500.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a2d5e703f69423f8c3d203da61a01b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768572381&amp;x-signature=9WjHLkPivbiU9%2F3tsAo8PhyeOH8%3D" alt="fadsfsfg" loading="lazy"/></a></p>
<p><strong>第二步：Qwen3-VL-Reranker（负责“精挑选”）</strong> Embedding虽然快，但有时候不够精准。这时候就需要Reranker登场了。 不同于市面上常见的双塔结构，这个Reranker会把用户的查询和Embedding捞回来的候选内容放在一起进行“深度阅读”。它会通过交叉注意力机制，仔细比对查询意图和素材细节的匹配度，然后重新排座次。官方数据显示，这个精排步骤能显著提升最终结果的准确性。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fffdsdgdfg-1024x305.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/ffdsdgdfg-1024x305.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfe24a8d53184aeead17e71bfae239d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768572381&amp;x-signature=BjbU%2FxDF86qAR%2FFRzaPB4ESvd%2B4%3D" alt="ffdsdgdfg" loading="lazy"/></a></p>
<h3 data-id="heading-1">看起来很强，用起来重吗？</h3>
<p>这可能是开发者最关心的问题。好消息是，这套模型非常“亲民”。</p>
<p><strong>Qwen3-VL-Embedding</strong> 提供了 <strong>2B</strong> 和 <strong>8B</strong> 两个版本。 <strong>Qwen3-VL-Reranker</strong> 目前开源了 <strong>2B</strong> 版本。</p>
<p>对于大多数商业应用或个人开发者来说，2B和8B的参数量意味着你不需要拥有显卡集群，就能在本地或中型服务器上跑起来。同时，它们原生支持32K的上下文长度，处理长文档或长视频片段绰绰有余。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fsdfgfdgdf-1024x553.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/sdfgfdgdf-1024x553.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2076c3f1cc334ac3946a76c3347a078c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768572381&amp;x-signature=7RS0IbloSWnZyv2DRpZ9EReFZEo%3D" alt="sdfgfdgdf" loading="lazy"/></a></p>
<h3 data-id="heading-2">硬实力的证明</h3>
<p>在技术圈，不服跑个分。</p>
<p>根据官方和第三方的测试数据（如MMEB-V2、MMTEB基准），Qwen3-VL-Embedding的8B版本在多模态检索任务上，性能直接超越了目前市面上已知的开源模型，甚至把一些闭源商业服务甩在了身后。</p>
<p>特别是对于那些复杂的视觉文档——比如包含代码截图的教程、充满UI组件的设计稿，这套模型的理解能力展现出了SOTA（当前最佳）的水准。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F01%2Fsdfsgdf-1024x441.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/01/sdfsgdf-1024x441.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9cddc8554724dcaa9aa9f26056b60f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768572381&amp;x-signature=QjrUwFj3cFEE3OLJ1WQgxRi%2FHuc%3D" alt="sdfsgdf" loading="lazy"/></a></p>
<h3 data-id="heading-3">总结</h3>
<p>通义千问这次的开源动作，实际上是把多模态RAG的门槛给踏平了。</p>
<p>无论你是想做一个能看懂设计图的企业知识库，还是想搭建一个能搜到“主角穿红衣服那个镜头”的视频搜索引擎，Qwen3-VL的这套Embedding和Reranker组合，都是目前开源界最值得尝试的基石。</p>
<p>目前，模型权重已经全部托管在Hugging Face和ModelScope上，遵循Apache 2.0协议。也就是说，哪怕你是拿去商用，也是完全免费且合规的。</p>
<p>对于正在构建下一代AI应用的开发者来说，这绝对是2026年开年的一份大礼。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GDAL 实现空间分析]]></title>    <link>https://juejin.cn/post/7593175890794758190</link>    <guid>https://juejin.cn/post/7593175890794758190</guid>    <pubDate>2026-01-09T14:26:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593175890794758190" data-draft-id="7593171168259489801" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GDAL 实现空间分析"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-09T14:26:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GDAL 实现空间分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:26:23.000Z" title="Fri Jan 09 2026 14:26:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">^ 关注我，带你一起学GIS ^</h2>
<h2 data-id="heading-1">前言</h2>
<blockquote>
<p>❝</p>
<p>空间分析基于空间关系，常见的如叠加、求差、取反等。在GIS开发中，空间分析作为其灵魂支柱，具有重要意义，是每一个GISer都必须要掌握的技能。</p>
</blockquote>
<p>在之前的文章中讲了如何使用<code>GDAL</code>或者<code>ogr2ogr</code>工具将<code>txt</code>以及<code>csv</code>文本数据转换为<code>Shp</code>格式，本篇教程在之前一系列文章的基础上讲解如何使用<strong>GDAL 实现空间分析</strong>。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487980%26idx%3D1%26sn%3Dbfd72c505f12f36cc459989cb16229db%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487980&amp;idx=1&amp;sn=bfd72c505f12f36cc459989cb16229db&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GDAL 简介</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247488004%26idx%3D1%26sn%3D3cab0afab44ff1c9d2e583933d6b4c3e%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247488004&amp;idx=1&amp;sn=3cab0afab44ff1c9d2e583933d6b4c3e&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GDAL 下载安装</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247488017%26idx%3D1%26sn%3De41670cf4042e17353ad7ee507423269%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247488017&amp;idx=1&amp;sn=e41670cf4042e17353ad7ee507423269&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GDAL 开发起步</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247488343%26idx%3D1%26sn%3D39a39704cd83d5b4a955cef28c1df5ba%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247488343&amp;idx=1&amp;sn=39a39704cd83d5b4a955cef28c1df5ba&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GDAL 实现 GIS 数据读取转换（全）</a></li>
</ul>
<p>如果你还没有看过，建议从以上内容开始。</p>
<h2 data-id="heading-2">1. 开发环境</h2>
<p>本文使用如下开发环境，以供参考。</p>
<p>时间：<code>2025年</code></p>
<p>系统：<code>Windows 11</code></p>
<p>Python：<code>3.11.7</code></p>
<p>GDAL：<code>3.11.1</code></p>
<h2 data-id="heading-3">2. 空间分析</h2>
<p>定义一个方法<code>SpatialAnalysis</code>用于判断要素间空间关系，该方法接收两个参数，其中<code>sourcePath</code>指向源数据路径，<code>resultPath</code>指向结果文件路径。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""说明：GDAL 空间分析操作参数：    -sourcePath：Shp 数据路径    -resultPath：生成结果数据路径"""</span><span class="hljs-keyword">def</span> <span class="hljs-title function_">SpatialAnalysis</span>(<span class="hljs-params">sourcePath,resultPath</span>):
</code></pre>
<p>接着是基础的常规操作，添加数据驱动，获取数据源，获取目标图层。</p>
<pre><code class="hljs language-scss" lang="scss"># 检查文件是否存在<span class="hljs-built_in">checkFilePath</span>(sourcePath)# 添加数据驱动shpDriver = ogr<span class="hljs-selector-class">.GetDriverByName</span>("ESRI Shapefile")# 获取数据源shpDs = shpDriver<span class="hljs-selector-class">.Open</span>(sourcePath)# 获取图层shpLayer = shpDs<span class="hljs-selector-class">.GetLayer</span>(<span class="hljs-number">0</span>)srs = shpLayer<span class="hljs-selector-class">.GetSpatialRef</span>()geomType = shpLayer<span class="hljs-selector-class">.GetGeomType</span>()
</code></pre>
<p>方法<code>checkFilePath</code>用于检查文件路径是否正常，接受一个路径参数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""说明：检查文件路径是否正常参数：    -filePath：文件数据路径"""</span><span class="hljs-keyword">def</span> <span class="hljs-title function_">checkFilePath</span>(<span class="hljs-params">filePath</span>):    <span class="hljs-keyword">if</span> os.path.exists(filePath):        <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件数据路径存在"</span>)    <span class="hljs-keyword">else</span>:        <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件数据路径不存在，请检查！"</span>)
</code></pre>
<p>本文基于以下数据进行空间分析操作。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2189f144c614661a9fef63f88994be5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=hdfUeyRmF5vXPSmyDUG7cTerUio%3D" alt="" loading="lazy"/>对涉及面的操作分别获取面0和面1两个要素。<code>GDAL</code>中的几何处理操作，如叠加、缓冲、求差等均返回一个新的几何对象。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-string">""</span><span class="hljs-string">"获取第一个图层要素"</span><span class="hljs-string">""</span># feature = shpLayer.GetNextFeature()# 根据FId获取指定要素feature1 = shpLayer.GetFeature(<span class="hljs-number">0</span>)<span class="hljs-built_in">print</span>(f<span class="hljs-string">"n面状要素~~~~~Id：{feature1.GetField('Id')}n"</span>)# 获取要素IdfeatId1 = feature1.GetField(<span class="hljs-string">"Id"</span>)# 获取几何要素geom1 = feature1.GetGeometryRef()# <span class="hljs-built_in">print</span>(f<span class="hljs-string">"面状几何：{geom1}"</span>)<span class="hljs-string">""</span><span class="hljs-string">"    获取第二个要素"</span><span class="hljs-string">""</span>feature2 = shpLayer.GetFeature(<span class="hljs-number">1</span>)geom2 = feature2.GetGeometryRef()featId2 = feature2.GetField(<span class="hljs-string">"Id"</span>)
</code></pre>
<h2 data-id="heading-4">3. 空间叠加</h2>
<p><code>Geometry</code>对象上具有一个方法<code>Intersection</code>用于空间叠加操作，该方法接收另一个几何对象，并返回一个新的<code>Geometry</code>对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    空间操作之【叠加】"""</span>resultGeom = geom1.Intersection(geom2)<span class="hljs-comment"># print(f"面要素【{featId1}】与 面要素【{featId2}】相交结果：{resultGeom}")</span>
</code></pre>
<p>如下面0和面1相交结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d619ddfbcda40b5ab01557eb23d3e03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=B5UbEDIDlw02JRX9e8BFfr2hH20%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">4. 空间缓冲</h2>
<p><code>Geometry</code>对象上具有一个方法<code>Buffer</code>用于空间缓冲区生成，该方法接收另一个几何对象，并返回一个新的<code>Geometry</code>对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    空间操作之【缓冲】"""</span>resultGeom = geom1.Buffer(<span class="hljs-number">1</span>)<span class="hljs-comment"># print(f"面要素【{featId1}】缓冲结果：{resultGeom}")</span>
</code></pre>
<p>如下面0缓冲结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5eb05561a414420eb2c175f0c095996b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=GP7XuRjGDG90TirqHtK5LKEW2bg%3D" alt="" loading="lazy"/></p>
<p>如下线段缓冲结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/159214a6f1ab4ada9cb8cfa4ea460a5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=bquL9YUDQH6qRD50v%2BF1BraUmjo%3D" alt="" loading="lazy"/></p>
<p>如下点缓冲结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b39a30c67ebc4c00b98428c9a7d3e6d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=itnwOfIeftwgpOZEiA7QML%2FxueM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">5. 空间联合</h2>
<p><code>Geometry</code>对象上具有一个方法<code>Union</code>用于合并几何对象，该方法接收另一个几何对象，并返回一个新的<code>Geometry</code>对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    空间操作之【联合】"""</span>resultGeom = geom1.<span class="hljs-type">Union</span>(geom2)<span class="hljs-comment"># print(f"面要素【{featId1}】联合结果：{resultGeom}")</span>
</code></pre>
<p>如下面0和面1联合结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6c12332463c4924831aa4cb51d92545~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=QIRtnMa3eycbAuknLlH8%2B5703yc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">6. 空间求差</h2>
<p><code>Geometry</code>对象上具有一个方法<code>Difference</code>用于求取目标几何对象差集，该方法接收另一个几何对象，并返回一个新的<code>Geometry</code>对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    空间操作之【求差】"""</span>resultGeom = geom1.Difference(geom2)<span class="hljs-comment"># print(f"面要素【{featId1}】联合结果：{resultGeom}")</span>
</code></pre>
<p>如下面0和面1求差结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfb4347595ca40d7bda087cb5a248a44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=2vIKI0zhMalaCisV%2Bky%2FEfLkB8Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-8">7. 对称差集</h2>
<p><code>Geometry</code>对象上具有一个方法<code>SymmetricDifference</code>用于几何对象交集取反操作，该方法接收另一个几何对象，并返回一个新的<code>Geometry</code>对象。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    空间操作之【求对称差集】"""</span>resultGeom = geom1.SymmetricDifference(geom2)<span class="hljs-built_in">print</span>(<span class="hljs-string">f"面要素【<span class="hljs-subst">{featId1}</span>】联合结果：<span class="hljs-subst">{resultGeom}</span>"</span>)
</code></pre>
<p>如下面0和面1求对称差集结果为图中高亮部分。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/338b1c838355433885d47b7d8ec89cb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=Y0AuvimPbfrWicKaqHb3HalSQsw%3D" alt="" loading="lazy"/></p>
<p>还有一些几何操作，如求等、求距离等内容本教程并未涉及，留给感兴趣的读者自行实践。</p>
<h2 data-id="heading-9">8. 创建新图层</h2>
<p>几何运算完成之后，需要将分析结果保存到新的Shp图层。通过数据驱动方法<code>CreateDataSource</code>创建<code>Shp</code>数据源，再使用数据源方法<code>CreateLayer</code>创建图层即可。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""    创建新图层"""</span>targetDs = shpDriver.CreateDataSource(resultPath)targetLayer = targetDs.CreateLayer(<span class="hljs-string">"result_layer"</span>,srs,ogr.wkbPolygon)featureDefn = shpLayer.GetLayerDefn()tarFeat = ogr.Feature(featureDefn)fieldCount = featureDefn.GetFieldCount()tarFeat.SetGeometry(resultGeom)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(fieldCount):    fieldDefn = featureDefn.GetFieldDefn(i)    name = fieldDefn.GetName()    value = feature1.GetField(i)    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"字段名称：<span class="hljs-subst">{name}</span>，字段值：<span class="hljs-subst">{value}</span>"</span>)    <span class="hljs-comment"># tarFeat.SetField(i,value)    tarFeat.SetField(name,value)targetLayer.CreateFeature(tarFeat)</span>
</code></pre>
<h2 data-id="heading-10">9. 注意事项</h2>
<p>在<code>windows</code>开发环境中同时安装<code>GDAL</code>与<code>PostGIS</code>，其中投影库<code>PROJ</code>的环境变量指向<code>PostGIS</code>的安装路径，在运行GDAL程序时，涉及到要素、几何与投影操作时会导致异常。<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/148dec8809004a7f82878a7cb92dce35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=wYkNfSx%2FymT3ZpqRPyJvwt3xznQ%3D" alt="" loading="lazy"/>具体意思为<code>GDAL</code>不支持<code>PostGIS</code>插件中的投影库版本，需要更换投影库或者升级版本。</p>
<p><code>RuntimeError: PROJ: proj_identify: D:Program FilesPostgreSQL13sharecontribpostgis-3.5projproj.db contains DATABASE.LAYOUT.VERSION.MINOR = 2 whereas a number &gt;= 5 is expected. It comes from another PROJ installation.</code><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bdac5e5380141dea1389f3bd6cc5943~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=rSr9R6m1P%2Fw0%2FE13l7Z2bZYjY1E%3D" alt="" loading="lazy"/></p>
<p>解决办法为修改<code>PROJ</code>的环境变量到<code>GDAL</code>支持的版本或者在<code>GDAL</code>程序开头添加以下代码：</p>
<pre><code class="hljs language-python" lang="python">os.environ[<span class="hljs-string">'PROJ_LIB'</span>] = <span class="hljs-string">r'D:\Programs\Python\Python311\Libsite-packages\osgeo\data\proj'</span>
</code></pre>
<p><strong>视频效果</strong></p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247488572%26idx%3D1%26sn%3D603105f8b81f906457b8ea337e1b0fc8%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247488572&amp;idx=1&amp;sn=603105f8b81f906457b8ea337e1b0fc8&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GDAL 实现空间分析操作</a></strong></p>
<p><strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc9ccc6dca604c8392c9ec0d62cd0867~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=bG3Rr2gBEnfVPCXxSXLW7ksBC2g%3D" alt="" loading="lazy"/></strong></p>
<blockquote>
<p>❝</p>
<p>OpenLayers示例数据下载，请在公众号后台回复：<strong>ol数据</strong></p>
<p>全国信息化工程师－GIS 应用水平考试资料，请在公众号后台回复：<strong>GIS考试</strong></p>
</blockquote>
<blockquote>
<p>❝</p>
<p><em><strong>GIS之路</strong></em> 公众号已经接入了<strong>智能</strong> <strong>助手</strong>，可以在对话框进行提问，也可以直接搜索历史文章进行查看。</p>
</blockquote>
<p>都看到这了，不要忘记<em><strong>点赞、收藏</strong></em> <strong>+</strong> <em><strong>关注</strong></em> 哦 <strong>！</strong></p>
<p>本号不定时更新有关 <em><strong>GIS开发</strong></em> 相关内容，<em><strong>欢迎关注 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/552828aca9ae4df692fa55f644156d58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=vO62dYay0T9roF5ciVtHNqZqTJw%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf2e562008794b31ab08c6e96ca264bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=OZuuQgLCxbCNqdsaeDlU%2BkwxXrk%3D" alt="" loading="lazy"/></strong></em></p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51655673d28b4719a4149fa8be980a66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=u2sgFAOuodmJgzwMiZIdnNsynlw%3D" alt="" loading="lazy"/></p>
<p>   <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31b07311d2364df8833c4b632ee43b09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573583&amp;x-signature=ZJEzCpfE6%2FEs%2BHVS%2Fa2GCQfEzBM%3D" alt="" loading="lazy"/> </p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487953%26idx%3D1%26sn%3D0b2d5aeefdb290583cf8cdd82f3c2077%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487953&amp;idx=1&amp;sn=0b2d5aeefdb290583cf8cdd82f3c2077&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">GeoTools 开发合集（全）</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwOTEzNjI5NQ%3D%3D%26mid%3D2247487119%26idx%3D1%26sn%3Dc313efa84c27bf933ef2f2a47991ef2d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwOTEzNjI5NQ==&amp;mid=2247487119&amp;idx=1&amp;sn=c313efa84c27bf933ef2f2a47991ef2d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">OpenLayers 开发合集</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Ffkf6VAObpTjPutJplco7wA" target="_blank" title="https://mp.weixin.qq.com/s/fkf6VAObpTjPutJplco7wA" ref="nofollow noopener noreferrer">GDAL 实现空间分析操作</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F_DVIdV5_bBPn3zVzUSoZ0w" target="_blank" title="https://mp.weixin.qq.com/s/_DVIdV5_bBPn3zVzUSoZ0w" ref="nofollow noopener noreferrer">GDAL 空间关系解析</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Ff1GPy_DNqtvEDzojlRmcBg" target="_blank" title="https://mp.weixin.qq.com/s/f1GPy_DNqtvEDzojlRmcBg" ref="nofollow noopener noreferrer">GDAL 实现数据空间查询</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FEyUADPYCf7O_9b0u8LUQCg" target="_blank" title="https://mp.weixin.qq.com/s/EyUADPYCf7O_9b0u8LUQCg" ref="nofollow noopener noreferrer">GDAL 实现数据属性查询</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FRdlldTRZ6c7FzfjBSdSPMg" target="_blank" title="https://mp.weixin.qq.com/s/RdlldTRZ6c7FzfjBSdSPMg" ref="nofollow noopener noreferrer">GDAL 实现创建几何对象</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FTUdUHgYra6oMlOaRIL1m4w" target="_blank" title="https://mp.weixin.qq.com/s/TUdUHgYra6oMlOaRIL1m4w" ref="nofollow noopener noreferrer">GDAL 实现自定义数据坐标系</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPGxwhRbuiRUKIpT2D2cVGQ" target="_blank" title="https://mp.weixin.qq.com/s/PGxwhRbuiRUKIpT2D2cVGQ" ref="nofollow noopener noreferrer">GDAL 实现矢量数据读写</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fi77nCatd4V2nuybZFIs-xA" target="_blank" title="https://mp.weixin.qq.com/s/i77nCatd4V2nuybZFIs-xA" ref="nofollow noopener noreferrer">GDAL 数据类型大全</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0DGoC0oFHizJbweBnEvI-g" target="_blank" title="https://mp.weixin.qq.com/s/0DGoC0oFHizJbweBnEvI-g" ref="nofollow noopener noreferrer">GDAL 实现 GIS 数据读取转换（全）</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码高亮、数学公式、流程图... Astro 博客进阶全指南]]></title>    <link>https://juejin.cn/post/7592990758476857363</link>    <guid>https://juejin.cn/post/7592990758476857363</guid>    <pubDate>2026-01-09T14:25:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592990758476857363" data-draft-id="7592990758476824595" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码高亮、数学公式、流程图... Astro 博客进阶全指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-09T14:25:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="技术更好说"/> <meta itemprop="url" content="https://juejin.cn/user/2735240657517816"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码高亮、数学公式、流程图... Astro 博客进阶全指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2735240657517816/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    技术更好说
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:25:36.000Z" title="Fri Jan 09 2026 14:25:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c265db806be4a5390aa23e84b3e7d4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5pu05aW96K-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573536&amp;x-signature=He9qccJAXS%2FR%2BmjsJOhDq6Up58U%3D" alt="1.jpg" loading="lazy"/>
你刚用 Astro 搭好博客，开始写第一篇技术文章。想要高亮代码的某一行？不行。想加个可折叠的警告框提醒读者注意事项？做不到。想在算法讲解里加个数学公式？完全没思路。</p>
<p>我也遇到过这种尴尬。用纯 Markdown 写了几篇文章后发现，能表达的东西太有限了。看别人的技术博客，代码块可以标注重点、可以展示代码改动前后的对比，文章里还能嵌入交互式的组件,自己却只能干巴巴地贴代码。</p>
<p>好在 Astro 提供了 MDX 这个"增强版 Markdown"。说白了，MDX 让你在写文章的时候可以用组件、可以写 JSX，能做的事情一下子多了好几倍。</p>
<p>这篇文章我会分享 7 个 Astro Markdown/MDX 的进阶用法，从最基础的环境配置到代码高亮、自定义组件、数学公式、流程图，每个技巧都配了完整的代码和配置步骤。读完这篇，你的技术博客能从"能看"升级到"专业"。</p>
<h2 data-id="heading-0">第一部分：基础升级 - 从 Markdown 到 MDX</h2>
<h3 data-id="heading-1">为什么要用 MDX？</h3>
<p>Markdown 和 MDX 的区别，其实就像自行车和电动车——都能骑,但体验完全不同。</p>
<p>纯 Markdown 只能写文本、代码块、图片这些静态内容。你想加个提示框？得用 HTML 硬编码。想在文章里嵌入一个可交互的组件？基本没戏。</p>
<p>MDX 就不一样了，它是"Markdown + JSX"的结合体。你可以：</p>
<ul>
<li><strong>导入和使用组件</strong>：直接在 .mdx 文件里 import 任何 Astro 组件或 React/Vue 组件</li>
<li><strong>写 JSX 表达式</strong>：在文章里用 <code>{variable}</code> 插入变量，甚至写循环和条件判断</li>
<li><strong>自定义元素样式</strong>：把标准的 <code>&lt;h1&gt;</code> 替换成你自己的样式化组件</li>
</ul>
<p>举个具体例子。你想在文章里加个警告框，用纯 Markdown 得这样写：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"warning"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>注意：这个操作会删除所有数据！<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>用 MDX 就能这样：</p>
<pre><code class="hljs language-mdx" lang="mdx">import Alert from '@/components/Alert.astro';

&lt;Alert type="warning"&gt;
  注意：这个操作会删除所有数据！
&lt;/Alert&gt;
</code></pre>
<p>看出区别了吗？MDX 让你的文章更像是在"组装积木"，而不是"写代码"。</p>
<h3 data-id="heading-2">5分钟配置 MDX 环境</h3>
<p>配置 MDX 其实超简单，三步搞定。</p>
<p><strong>第一步：安装集成包</strong></p>
<p>打开终端，在你的 Astro 项目里运行：</p>
<pre><code class="hljs language-bash" lang="bash">npx astro add mdx
</code></pre>
<p>Astro CLI 会自动帮你安装 <code>@astrojs/mdx</code> 并更新配置文件。这个命令会问你几个问题（要不要更新配置、要不要安装依赖），全部选 Yes 就行。</p>
<p><strong>第二步：验证配置</strong></p>
<p>装完后，打开 <code>astro.config.mjs</code>，应该能看到这样的代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro/config'</span>;
<span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">'@astrojs/mdx'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">mdx</span>()],
});
</code></pre>
<p>如果没有自动添加，手动加上就行。</p>
<p><strong>第三步：测试 MDX 是否生效</strong></p>
<p>在 <code>src/pages/</code> 或 <code>src/content/</code> 目录下创建一个 <code>test.mdx</code> 文件：</p>
<pre><code class="hljs language-mdx" lang="mdx">
---

title: 测试MDX

---

# 这是 MDX 测试

普通的 Markdown 文本。

export const greeting = "你好";

现在可以用变量了：{greeting}！

&lt;div style="padding: 1rem; background: #f0f0f0;"&gt;
  这是一个 JSX 元素
&lt;/div&gt;
</code></pre>
<p>运行 <code>npm run dev</code>，访问对应页面，如果能看到变量和 JSX 元素正常显示，说明 MDX 已经配置成功了。</p>
<p><strong>关于 .md 和 .mdx 文件的共存</strong></p>
<p>装了 MDX 集成后，你的 <code>.md</code> 文件还是正常工作的，不用担心。Astro 会根据文件扩展名自动选择处理方式：</p>
<ul>
<li><code>.md</code> 文件：按标准 Markdown 处理</li>
<li><code>.mdx</code> 文件：按 MDX 处理，支持组件和 JSX</li>
</ul>
<p>我的建议是：普通文章用 <code>.md</code>，需要用组件的文章用 <code>.mdx</code>。不是所有文章都需要 MDX 的能力。</p>
<h2 data-id="heading-3">第二部分：代码高亮的进阶技巧</h2>
<h3 data-id="heading-4">配置代码高亮主题（Shiki）</h3>
<p>Astro 默认用 Shiki 做代码高亮，这已经很不错了。但默认主题是 <code>github-dark</code>，你可能想换个更符合自己博客风格的。</p>
<p><strong>Shiki vs Prism 该选哪个？</strong></p>
<p>老实讲，我推荐 Shiki。它是 Astro 默认的方案，支持 100 多种编程语言和主题，而且是服务端渲染的，不需要加载额外的 JavaScript。Prism 也不错，但需要引入 CSS 文件，配置相对麻烦一点。</p>
<p><strong>切换内置主题</strong></p>
<p>打开 <code>astro.config.mjs</code>，在 <code>markdown</code> 配置里加上 <code>shikiConfig</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro/config'</span>;
<span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">'@astrojs/mdx'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">mdx</span>()],
  <span class="hljs-attr">markdown</span>: {
    <span class="hljs-attr">shikiConfig</span>: {
      <span class="hljs-attr">theme</span>: <span class="hljs-string">'dracula'</span>, <span class="hljs-comment">// 可选：github-dark, nord, monokai, dracula 等</span>
    },
  },
});
</code></pre>
<p>Shiki 支持超多主题，我常用的有：</p>
<ul>
<li><code>github-dark</code> / <code>github-light</code> - GitHub 风格</li>
<li><code>dracula</code> - 经典的紫黑配色</li>
<li><code>nord</code> - 清冷的北欧风</li>
<li><code>one-dark-pro</code> - VSCode 默认深色主题</li>
</ul>
<p>你可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fshiki.style%2Fthemes" target="_blank" title="https://shiki.style/themes" ref="nofollow noopener noreferrer">Shiki 主题预览</a> 里挑一个自己喜欢的。</p>
<p><strong>实现浅色/深色双主题切换</strong></p>
<p>如果你的博客支持深浅色模式切换，Shiki 可以配置双主题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">markdown</span>: {
  <span class="hljs-attr">shikiConfig</span>: {
    <span class="hljs-attr">themes</span>: {
      <span class="hljs-attr">light</span>: <span class="hljs-string">'github-light'</span>,
      <span class="hljs-attr">dark</span>: <span class="hljs-string">'github-dark'</span>,
    },
  },
},
</code></pre>
<p>这样配置后，Shiki 会根据 CSS 的 <code>prefers-color-scheme</code> 或你自定义的主题切换逻辑自动应用对应的代码高亮主题。</p>
<h3 data-id="heading-5">高亮特定行和代码注释</h3>
<p>写教程的时候，经常需要标注"看这一行很重要"或者展示"代码改了哪些地方"。Shiki Transformers 可以实现这些功能。</p>
<p><strong>高亮重点代码行</strong></p>
<p>先安装 Shiki 的 transformers：</p>
<pre><code class="hljs language-bash" lang="bash">npm install shiki
</code></pre>
<p>然后在配置里启用 <code>transformerNotationHighlight</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro/config'</span>;
<span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">'@astrojs/mdx'</span>;
<span class="hljs-keyword">import</span> { transformerNotationHighlight } <span class="hljs-keyword">from</span> <span class="hljs-string">'@shikijs/transformers'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">mdx</span>()],
  <span class="hljs-attr">markdown</span>: {
    <span class="hljs-attr">shikiConfig</span>: {
      <span class="hljs-attr">theme</span>: <span class="hljs-string">'github-dark'</span>,
      <span class="hljs-attr">transformers</span>: [<span class="hljs-title function_">transformerNotationHighlight</span>()],
    },
  },
});
</code></pre>
<p>现在可以在代码块里用 <code>// [!code highlight]</code> 注释来标记需要高亮的行：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```javascript
function hello() {
  console.log('这行是普通的');
  console.log('这行会高亮显示'); // [!code highlight]
}
```</span>
</code></pre>
<p><strong>展示代码变更（Diff 风格）</strong></p>
<p>在对比"修改前/后"的代码时，可以用 <code>transformerNotationDiff</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { transformerNotationDiff, transformerNotationHighlight } <span class="hljs-keyword">from</span> <span class="hljs-string">'@shikijs/transformers'</span>;

<span class="hljs-attr">markdown</span>: {
  <span class="hljs-attr">shikiConfig</span>: {
    <span class="hljs-attr">theme</span>: <span class="hljs-string">'github-dark'</span>,
    <span class="hljs-attr">transformers</span>: [
      <span class="hljs-title function_">transformerNotationHighlight</span>(),
      <span class="hljs-title function_">transformerNotationDiff</span>(),
    ],
  },
},
</code></pre>
<p>用法：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```javascript
function calculate(a, b) {
  return a + b; // [!code --]
  return a * b; // [!code ++]
}
```</span>
</code></pre>
<p>带 <code>--</code> 的行会显示为红色（删除），带 <code>++</code> 的行显示为绿色（新增）。这个功能写代码教程时超级实用。</p>
<p><strong>聚焦特定代码</strong></p>
<p>还有一个 <code>transformerNotationFocus</code>，可以让其他代码"变灰"，只突出你想强调的部分：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { transformerNotationFocus } <span class="hljs-keyword">from</span> <span class="hljs-string">'@shikijs/transformers'</span>;

<span class="hljs-comment">// 添加到 transformers 数组</span>
<span class="hljs-attr">transformers</span>: [
  <span class="hljs-title function_">transformerNotationFocus</span>(),
],
</code></pre>
<p>使用 <code>// [!code focus]</code> 标记：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```javascript
function process() {
  console.log('这行会变灰');
  console.log('这行正常显示'); // [!code focus]
  console.log('这行也变灰');
}
```</span>
</code></pre>
<h3 data-id="heading-6">升级到 Expressive Code（可选）</h3>
<p>如果你觉得 Shiki 的功能还不够，可以试试 Expressive Code。它是社区开发的增强版代码展示方案，提供了更多开箱即用的功能：</p>
<ul>
<li>代码块标题</li>
<li>一键复制按钮</li>
<li>行号显示</li>
<li>终端窗口样式</li>
<li>代码对比（Side-by-Side）</li>
</ul>
<p><strong>安装超简单</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx astro add astro-expressive-code
</code></pre>
<p>Astro CLI 会自动配置好一切。装完后，你的代码块就自动带上这些功能了，不需要额外配置。</p>
<p><strong>什么时候用 Expressive Code？</strong></p>
<p>说实话，我一开始用的是默认的 Shiki，后来发现读者经常想复制代码，就换成了 Expressive Code。如果你的博客主要是写教程、分享代码，Expressive Code 能让读者体验好很多。</p>
<p>但如果只是偶尔放点代码，用 Shiki + Transformers 就够了，不用增加额外的依赖。</p>
<h2 data-id="heading-7">第三部分：嵌入自定义组件</h2>
<h3 data-id="heading-8">在 MDX 中导入和使用组件</h3>
<p>MDX 最强大的地方就是可以直接在文章里用组件。我经常用这个功能做提示框、代码对比、可折叠区域等。</p>
<p><strong>创建一个警告框组件</strong></p>
<p>先在 <code>src/components/</code> 目录下创建一个 <code>Alert.astro</code>：</p>
<pre><code class="hljs language-astro" lang="astro">
---

interface Props {
  type?: 'info' | 'warning' | 'error';
}

const { type = 'info' } = Astro.props;

const styles = {
  info: 'bg-blue-50 border-blue-200 text-blue-800',
  warning: 'bg-yellow-50 border-yellow-200 text-yellow-800',
  error: 'bg-red-50 border-red-200 text-red-800',
};

---

&lt;div class={`border-l-4 p-4 ${styles[type]}`}&gt;
  &lt;slot /&gt;
&lt;/div&gt;
</code></pre>
<p><strong>在 MDX 文章中使用</strong></p>
<p>在你的 <code>.mdx</code> 文件里导入并使用它：</p>
<pre><code class="hljs language-mdx" lang="mdx">
---

title: 我的技术文章

---

import Alert from '@/components/Alert.astro';

# 文章标题

这是普通的文章内容。

&lt;Alert type="warning"&gt;
  注意：运行这个命令前请备份数据！
&lt;/Alert&gt;

&lt;Alert type="info"&gt;
  提示：你也可以在组件里用 **Markdown 语法**，很方便。
&lt;/Alert&gt;
</code></pre>
<p>看到了吗？在 <code>&lt;Alert&gt;</code> 组件里，你还可以继续用 Markdown 语法（如加粗、链接等），MDX 会自动处理。</p>
<p><strong>使用 React/Vue 组件</strong></p>
<p>MDX 不仅支持 Astro 组件，也可以用 React、Vue 等框架组件。不过要注意加上 <code>client:</code> 指令：</p>
<pre><code class="hljs language-mdx" lang="mdx">import Counter from '@/components/Counter.tsx';

&lt;Counter client:load initialCount={0} /&gt;
</code></pre>
<p><code>client:load</code> 表示这个组件会在页面加载时在客户端运行。如果不加，组件只会服务端渲染，交互功能不生效。</p>
<p><strong>组件文件组织建议</strong></p>
<p>我习惯把文章里常用的组件放在 <code>src/components/mdx/</code> 目录下，这样好管理：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">src</span>/
├── components/
│   ├── mdx/
│   │   ├── Alert<span class="hljs-selector-class">.astro</span>
│   │   ├── CodeCompare<span class="hljs-selector-class">.astro</span>
│   │   ├── Callout<span class="hljs-selector-class">.astro</span>
│   │   └── Tabs<span class="hljs-selector-class">.astro</span>
│   └── ...其他组件
</code></pre>
<h3 data-id="heading-9">映射 Markdown 语法到自定义组件</h3>
<p>这个功能有点"黑魔法"的感觉——你可以把 Markdown 的标准元素（如 h1、a、img）替换成你自己的组件。</p>
<p><strong>为什么要这么做？</strong></p>
<p>比如你想给所有的标题加个锚点图标，或者给外部链接自动加个"↗"标记，手动一个个加太麻烦了。用组件映射，写标准 Markdown 就自动应用你的样式。</p>
<p><strong>实战：自定义标题组件</strong></p>
<p>先创建一个 <code>CustomHeading.astro</code>：</p>
<pre><code class="hljs language-astro" lang="astro">
---

interface Props {
  level: 1 | 2 | 3 | 4 | 5 | 6;
  id?: string;
}

const { level, id } = Astro.props;
const Tag = `h${level}` as any;

---

&lt;Tag id={id} class="group relative"&gt;
  &lt;slot /&gt;
  {id &amp;&amp; (
    &lt;a href={`#${id}`} class="ml-2 opacity-0 group-hover:opacity-100 transition-opacity"&gt;
      #
    &lt;/a&gt;
  )}
&lt;/Tag&gt;
</code></pre>
<p><strong>在 MDX 中使用映射</strong></p>
<p>在你的 <code>.mdx</code> 文件里，导出一个 <code>components</code> 对象：</p>
<pre><code class="hljs language-mdx" lang="mdx">
---

title: 文章标题

---

import CustomHeading from '@/components/CustomHeading.astro';

export const components = {
  h2: (props) =&gt; &lt;CustomHeading level={2} {...props} /&gt;,
  h3: (props) =&gt; &lt;CustomHeading level={3} {...props} /&gt;,
};

## 这是二级标题

鼠标悬停在标题上，会出现 # 锚点链接。

### 这是三级标题

所有 h2 和 h3 都自动应用了自定义样式。
</code></pre>
<p><strong>实战：给外部链接加图标</strong></p>
<p>创建 <code>ExternalLink.astro</code>：</p>
<pre><code class="hljs language-astro" lang="astro">
---

interface Props {
  href?: string;
}

const { href } = Astro.props;
const isExternal = href?.startsWith('http');

---

&lt;a href={href} target={isExternal ? '_blank' : undefined} rel={isExternal ? 'noopener noreferrer' : undefined}&gt;
  &lt;slot /&gt;
  {isExternal &amp;&amp; &lt;span class="ml-1 text-xs"&gt;↗&lt;/span&gt;}
&lt;/a&gt;
</code></pre>
<p>映射使用：</p>
<pre><code class="hljs language-mdx" lang="mdx">import ExternalLink from '@/components/ExternalLink.astro';

export const components = {
  a: ExternalLink,
};

[这是内部链接](/about)
[这是外部链接](https://example.com) ← 会自动加 ↗ 图标
</code></pre>
<p><strong>全局配置映射（高级）</strong></p>
<p>如果你想让所有 MDX 文件都用同一套组件映射，可以在 <code>astro.config.mjs</code> 里配置。不过这个需要自定义 MDX 插件，稍微复杂一点，我一般是在单个文件里配置就够了。</p>
<h2 data-id="heading-10">第四部分：数学公式和图表集成</h2>
<h3 data-id="heading-11">集成 KaTeX 展示数学公式</h3>
<p>如果你写算法、数学或数据科学类的文章，肯定需要展示公式。KaTeX 是目前最好的选择，比 MathJax 快很多，而且支持服务端渲染。</p>
<p><strong>安装 KaTeX</strong></p>
<p>需要安装三个包：</p>
<pre><code class="hljs language-bash" lang="bash">npm install remark-math rehype-katex katex
</code></pre>
<ul>
<li><code>remark-math</code>：解析 LaTeX 语法</li>
<li><code>rehype-katex</code>：渲染公式为 HTML</li>
<li><code>katex</code>：KaTeX 核心库</li>
</ul>
<p><strong>配置 Astro</strong></p>
<p>打开 <code>astro.config.mjs</code>，添加这两个插件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro/config'</span>;
<span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">'@astrojs/mdx'</span>;
<span class="hljs-keyword">import</span> remarkMath <span class="hljs-keyword">from</span> <span class="hljs-string">'remark-math'</span>;
<span class="hljs-keyword">import</span> rehypeKatex <span class="hljs-keyword">from</span> <span class="hljs-string">'rehype-katex'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">mdx</span>()],
  <span class="hljs-attr">markdown</span>: {
    <span class="hljs-attr">remarkPlugins</span>: [remarkMath],
    <span class="hljs-attr">rehypePlugins</span>: [rehypeKatex],
  },
});
</code></pre>
<p><strong>引入 KaTeX 样式</strong></p>
<p>这一步很重要，不然公式渲染不出来。在你的布局文件（如 <code>src/layouts/MarkdownLayout.astro</code>）的 <code>&lt;head&gt;</code> 里加上：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span>
  <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span>
  <span class="hljs-attr">href</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"</span>
  <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">"anonymous"</span>
/&gt;</span>
</code></pre>
<p><strong>在文章中使用公式</strong></p>
<p>配置好后，就可以在 Markdown/MDX 里写公式了。</p>
<p><strong>行内公式</strong>（用单个 <code>$</code> 包裹）：</p>
<pre><code class="hljs language-markdown" lang="markdown">质能方程：$E = mc^2$

二次方程的解：$x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$
</code></pre>
<p><strong>块级公式</strong>（用双 <code>$$</code> 包裹）：</p>
<pre><code class="hljs language-markdown" lang="markdown">$$
\int<span class="hljs-emphasis">_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}
$$

$$
\sum_</span>{i=1}^{n} i = \frac{n(n+1)}{2}
$$
</code></pre>
<p><strong>常见问题：公式不显示</strong></p>
<p>如果公式不显示或样式不对，检查这几点：</p>
<ol>
<li>KaTeX CSS 是否正确引入（F12 看 Network 面板）</li>
<li>rehype-katex 的版本是否兼容（试试降到 6.x 版本）</li>
<li>公式语法是否正确（去 <a href="https://link.juejin.cn?target=https%3A%2F%2Fkatex.org%2Fdocs%2Fsupported.html" target="_blank" title="https://katex.org/docs/supported.html" ref="nofollow noopener noreferrer">KaTeX 支持列表</a> 确认）</li>
</ol>
<h3 data-id="heading-12">集成 Mermaid 绘制流程图和图表</h3>
<p>Mermaid 可以用代码画流程图、时序图、甘特图等，特别适合技术文档。</p>
<p><strong>三种集成方案对比</strong></p>
<p>社区有几种 Mermaid 集成方案，我简单说说区别：</p>

































<table><thead><tr><th>方案</th><th>渲染方式</th><th>SEO</th><th>配置难度</th><th>推荐指数</th></tr></thead><tbody><tr><td>rehype-mermaid</td><td>服务端</td><td>好</td><td>中</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>astro-diagram</td><td>服务端</td><td>好</td><td>低</td><td>⭐⭐⭐⭐</td></tr><tr><td>astro-mermaid</td><td>客户端</td><td>差</td><td>低</td><td>⭐⭐⭐</td></tr></tbody></table>
<p>我推荐 <strong>rehype-mermaid</strong>，服务端渲染，SEO 友好，生成的是静态 SVG。</p>
<p><strong>安装 rehype-mermaid</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install rehype-mermaid
</code></pre>
<p><strong>配置</strong></p>
<p>在 <code>astro.config.mjs</code> 里添加：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro/config'</span>;
<span class="hljs-keyword">import</span> mdx <span class="hljs-keyword">from</span> <span class="hljs-string">'@astrojs/mdx'</span>;
<span class="hljs-keyword">import</span> rehypeMermaid <span class="hljs-keyword">from</span> <span class="hljs-string">'rehype-mermaid'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [<span class="hljs-title function_">mdx</span>()],
  <span class="hljs-attr">markdown</span>: {
    <span class="hljs-attr">rehypePlugins</span>: [
      [rehypeMermaid, { <span class="hljs-attr">strategy</span>: <span class="hljs-string">'img-svg'</span> }]
    ],
  },
});
</code></pre>
<p><code>strategy: 'img-svg'</code> 表示生成 SVG 图片，这是最稳定的方案。</p>
<p><strong>在文章中画图</strong></p>
<p>用 <code>mermaid</code> 代码块就行：</p>
<p><strong>流程图示例</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```mermaid
graph TD
    A[开始] --&gt; B{是否安装MDX}
    B --&gt;|是| C[配置代码高亮]
    B --&gt;|否| D[安装MDX]
    D --&gt; C
    C --&gt; E[完成]
```</span>
</code></pre>
<p><strong>时序图示例</strong>：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">```mermaid
sequenceDiagram
    用户-&gt;&gt;浏览器: 访问页面
    浏览器-&gt;&gt;服务器: 请求HTML
    服务器-&gt;&gt;浏览器: 返回渲染后的页面
    浏览器-&gt;&gt;用户: 显示内容
```</span>
</code></pre>
<p><strong>构建时生成</strong></p>
<p>运行 <code>npm run build</code> 时，Mermaid 图表会在构建阶段生成为 SVG，最终页面里是静态图片，加载速度快，也不需要客户端 JavaScript。</p>
<p><strong>注意事项</strong></p>
<p>如果构建时报错"找不到 Puppeteer"，可能需要额外配置。试试安装 playwright：</p>
<pre><code class="hljs language-bash" lang="bash">npm install -D playwright
</code></pre>
<p>或者换用 astro-diagram 方案，它内置了浏览器环境。</p>
<h2 data-id="heading-13">第五部分：高级技巧和最佳实践</h2>
<h3 data-id="heading-14">Content Collections 的 MDX 优化</h3>
<p>如果你用 Astro 的 Content Collections 管理博客文章（强烈推荐），MDX 文件可以获得更好的类型支持和开发体验。</p>
<p><strong>Content Collections 是什么？</strong></p>
<p>简单说，就是把文章放在 <code>src/content/</code> 目录下，Astro 会自动识别、验证 frontmatter，并提供类型安全的 API 来读取内容。</p>
<p><strong>配置 Content Collections</strong></p>
<p>在 <code>src/content/config.ts</code> 定义你的集合：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineCollection, z } <span class="hljs-keyword">from</span> <span class="hljs-string">'astro:content'</span>;

<span class="hljs-keyword">const</span> blog = <span class="hljs-title function_">defineCollection</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'content'</span>, <span class="hljs-comment">// 表示这是内容文件（Markdown/MDX）</span>
  <span class="hljs-attr">schema</span>: z.<span class="hljs-title function_">object</span>({
    <span class="hljs-attr">title</span>: z.<span class="hljs-title function_">string</span>(),
    <span class="hljs-attr">description</span>: z.<span class="hljs-title function_">string</span>(),
    <span class="hljs-attr">pubDate</span>: z.<span class="hljs-title function_">date</span>(),
    <span class="hljs-attr">tags</span>: z.<span class="hljs-title function_">array</span>(z.<span class="hljs-title function_">string</span>()).<span class="hljs-title function_">optional</span>(),
    <span class="hljs-attr">draft</span>: z.<span class="hljs-title function_">boolean</span>().<span class="hljs-title function_">default</span>(<span class="hljs-literal">false</span>),
  }),
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> collections = { blog };
</code></pre>
<p><strong>在 MDX 中使用</strong></p>
<p>MDX 文件的 frontmatter 会被自动验证：</p>
<pre><code class="hljs language-mdx" lang="mdx">
---

title: Astro MDX 进阶教程
description: 学习 MDX 的高级用法
pubDate: 2025-12-02
tags: [Astro, MDX, 教程]

---

import Alert from '@/components/Alert.astro';

# {frontmatter.title}

&lt;Alert type="info"&gt;
  发布日期：{frontmatter.pubDate.toLocaleDateString()}
&lt;/Alert&gt;
</code></pre>
<p><strong>自动生成目录</strong></p>
<p>Content Collections 提供了 <code>getHeadings()</code> 方法，可以获取文章的所有标题，用来生成目录：</p>
<pre><code class="hljs language-astro" lang="astro">
---

import { getEntry } from 'astro:content';

const entry = await getEntry('blog', 'my-mdx-article');
const { Content, headings } = await entry.render();

---

&lt;aside&gt;
  &lt;h2&gt;目录&lt;/h2&gt;
  &lt;ul&gt;
    {headings.map(h =&gt; (
      &lt;li style={`margin-left: ${(h.depth - 1) * 1}rem`}&gt;
        &lt;a href={`#${h.slug}`}&gt;{h.text}&lt;/a&gt;
      &lt;/li&gt;
    ))}
  &lt;/ul&gt;
&lt;/aside&gt;

&lt;article&gt;
  &lt;Content /&gt;
&lt;/article&gt;
</code></pre>
<p>这个功能在写长文时特别实用，读者可以快速跳转到感兴趣的章节。</p>
<h3 data-id="heading-15">性能优化和常见陷阱</h3>
<p>MDX 很强大，但用不好也会拖慢网站。这里分享几个要注意的点。</p>
<p><strong>避免过度使用客户端组件</strong></p>
<p>MDX 里可以用 React/Vue 组件，但别忘了加 <code>client:*</code> 指令。如果不加，组件只会服务端渲染，交互功能不生效；如果滥用 <code>client:load</code>，会增加大量 JavaScript，拖慢页面加载。</p>
<p>我的建议：</p>
<ul>
<li>静态内容用 Astro 组件（如 Alert、Callout）</li>
<li>需要交互的用 <code>client:visible</code>（可见时才加载）或 <code>client:idle</code>（空闲时加载）</li>
<li>除非必要，不用 <code>client:load</code></li>
</ul>
<p><strong>图片优化</strong></p>
<p>在 MDX 里插入图片，别直接用 <code>&lt;img&gt;</code>，用 Astro 的 Image 组件：</p>
<pre><code class="hljs language-mdx" lang="mdx">
---

title: 我的文章

---

import { Image } from 'astro:assets';
import cover from './cover.jpg';

&lt;Image src={cover} alt="封面图" width={800} height={600} /&gt;
</code></pre>
<p>Astro 会自动优化图片（压缩、生成 WebP、懒加载等），性能好很多。</p>
<p><strong>MDX 的 optimize 选项</strong></p>
<p>如果你的站点有很多 MDX 文件，构建很慢，可以试试开启 <code>optimize</code> 选项：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">integrations</span>: [
    <span class="hljs-title function_">mdx</span>({
      <span class="hljs-attr">optimize</span>: <span class="hljs-literal">true</span>,
    }),
  ],
});
</code></pre>
<p>这个选项会通过内部的 rehype 插件优化 MDX 输出，加快构建速度。不过可能会改变生成的 HTML 结构，用之前先测试一下。</p>
<p><strong>常见错误和解决方案</strong></p>



































<table><thead><tr><th>错误</th><th>原因</th><th>解决方案</th></tr></thead><tbody><tr><td>MDX 组件不显示</td><td>忘了导入组件</td><td>检查 import 语句</td></tr><tr><td>交互组件不工作</td><td>缺少 client: 指令</td><td>加上 <code>client:load</code> 等</td></tr><tr><td>代码高亮不生效</td><td>Shiki 配置错误</td><td>检查 astro.config.mjs</td></tr><tr><td>数学公式不渲染</td><td>KaTeX CSS 未引入</td><td>在 layout 里加 CSS 链接</td></tr><tr><td>构建很慢</td><td>MDX 文件太多</td><td>开启 optimize 选项</td></tr></tbody></table>
<h2 data-id="heading-16">结论</h2>
<p>说了这么多，总结一下核心要点：</p>
<p><strong>快速回顾 7 个技巧</strong>：</p>
<ol>
<li><strong>配置 MDX 环境</strong> - 一行命令搞定，5分钟上手</li>
<li><strong>切换代码高亮主题</strong> - 用 Shiki 配置你喜欢的风格</li>
<li><strong>高亮和注释代码</strong> - 用 Transformers 标注重点、展示改动</li>
<li><strong>嵌入自定义组件</strong> - 让文章更生动，从 Alert 到交互式 Demo</li>
<li><strong>映射 Markdown 元素</strong> - 批量定制标题、链接等默认样式</li>
<li><strong>展示数学公式</strong> - KaTeX 让你的算法讲解更专业</li>
<li><strong>绘制流程图</strong> - Mermaid 用代码画图，服务端渲染</li>
</ol>
<p>现在就选一个最感兴趣的功能，在你的博客上试试吧。配置过程中遇到问题也别慌，官方文档和社区都很友好，搜一下基本都能找到答案。</p>
<p>话说回来，技术博客最重要的还是内容本身。这些工具只是让你的表达更清晰、更专业，真正吸引读者的，是你的观点和经验。祝你的 Astro 博客越来越好！</p>
<blockquote>
<p>原文首发<a href="https://link.juejin.cn?target=https%3A%2F%2Feastondev.com%2Fblog%2Fzh%2Fposts%2Fdev%2F20251202-astro-mdx-advanced-guide%2F" target="_blank" title="https://eastondev.com/blog/zh/posts/dev/20251202-astro-mdx-advanced-guide/" ref="nofollow noopener noreferrer">自个人博客</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uni-app实现本地MQTT连接]]></title>    <link>https://juejin.cn/post/7593165280488931369</link>    <guid>https://juejin.cn/post/7593165280488931369</guid>    <pubDate>2026-01-09T14:27:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593165280488931369" data-draft-id="7593165280488865833" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uni-app实现本地MQTT连接"/> <meta itemprop="keywords" content="前端,Trae"/> <meta itemprop="datePublished" content="2026-01-09T14:27:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="李剑一"/> <meta itemprop="url" content="https://juejin.cn/user/4147782344247918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uni-app实现本地MQTT连接
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4147782344247918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    李剑一
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:27:23.000Z" title="Fri Jan 09 2026 14:27:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近接到安卓端的需求，要求使用MQTT连接实现设备信息的收发。</p>
<p>可能有兄弟不太清楚 <strong>MQTT协议</strong> 是什么，简单地说它是一种轻量级的、基于<strong>发布/订阅</strong>模式的消息传输协议，广泛用于物联网（IoT）领域。</p>
<p>常见的操作就是连接后有N个设备订阅了主题A，这时候任意一台设备对主题A发布了一条信息，则当前N个设备都能收到这条消息。</p>
<p>至于其他的也不用知道的太清楚，反正知道一般是这么玩的就行。</p>
<p>假如你想知道的更为详细，可以询问 <code>Trae</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8193f4914934c5b9c4d8096aac846ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p2O5YmR5LiA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768573643&amp;x-signature=3lDmOEgK8hGFoRJoioo1g73ZWdQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">需求</h2>
<ol>
<li>实现MQTT连接</li>
<li>实现主题(Topic)订阅</li>
<li>能够发送消息</li>
<li>能够接收消息</li>
</ol>
<h2 data-id="heading-1">实现方案</h2>
<p>首先是安装 <code>mqtt.js</code> 插件和 <code>uuid.js</code> 插件。</p>
<pre><code class="hljs language-bash" lang="bash">npm i mqtt@3.0.0 uuid
</code></pre>
<p><strong>注意</strong>: 这里一定要安装 <code>mqtt v3.0</code> 版本，我之前装了一个 v5.x 版本，有比较大的 API 改动。项目上时间紧张，遂没有再尝试。（有兴趣的朋友可以考虑用最新版实现）</p>
<p><code>uuid</code> 只是起到生成 连接ID 和 消息ID 的作用，这里也可以直接使用时间戳的方式，但是为了保证不重复，这里便不再更换了。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// mqttClient.js 对 MQTT 的简单封装</span>
<span class="hljs-keyword">let</span> client = <span class="hljs-literal">null</span>;
<span class="hljs-comment">/**
 * 初始化 MQTT 连接
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">options</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} options.host - 服务器地址（不带协议）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} options.port - 端口（通常 WebSocket 是 8083、8084 或 443）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} options.clientId - 客户端 ID（建议唯一）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [options.username] - 用户名
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [options.password] - 密码
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">boolean</span>} [options.useWss=false] - 是否使用 wss（HTTPS）
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initMqtt</span>(<span class="hljs-params">options</span>) {
	<span class="hljs-keyword">const</span> {
		host,
		port,
		clientId,
		username = <span class="hljs-string">''</span>,
		password = <span class="hljs-string">''</span>,
		useWss = <span class="hljs-literal">false</span>
	} = options;

	<span class="hljs-comment">// 根据平台选择协议（App 和 H5 用 ws/wss，小程序用 wxs/wss）</span>
	<span class="hljs-keyword">let</span> protocol = <span class="hljs-string">'ws'</span>;
	<span class="hljs-keyword">if</span> (useWss) protocol = <span class="hljs-string">'wss'</span>;

	<span class="hljs-comment">// #ifdef MP-WEIXIN</span>
	protocol = useWss ? <span class="hljs-string">'wxs'</span> : <span class="hljs-string">'wxs'</span>;
	<span class="hljs-comment">// #endif</span>

	<span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${protocol}</span>://<span class="hljs-subst">${host}</span>:<span class="hljs-subst">${port}</span>/mqtt`</span>; <span class="hljs-comment">// 注意：路径可能是 / 或 /mqtt，根据你的 broker 配置</span>

	<span class="hljs-keyword">const</span> connectOptions = {
		<span class="hljs-attr">clientId</span>: clientId,
		<span class="hljs-attr">username</span>: username,
		<span class="hljs-attr">password</span>: password,
		<span class="hljs-attr">keepalive</span>: <span class="hljs-number">60</span>, <span class="hljs-comment">// 心跳间隔（秒）</span>
		<span class="hljs-attr">reconnectPeriod</span>: <span class="hljs-number">5000</span>, <span class="hljs-comment">// 自动重连间隔（毫秒）</span>
		<span class="hljs-attr">connectTimeout</span>: <span class="hljs-number">10000</span>, <span class="hljs-comment">// 连接超时</span>
		<span class="hljs-attr">clean</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 是否清除会话</span>
	};

	<span class="hljs-comment">// 引入 mqtt（必须用 min 版本，否则小程序报错）</span>
	<span class="hljs-keyword">const</span> mqtt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mqtt/dist/mqtt.min.js'</span>);

	client = mqtt.<span class="hljs-title function_">connect</span>(url, connectOptions);

	<span class="hljs-comment">// 监听连接事件</span>
	client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-function">() =&gt;</span> {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MQTT 连接成功'</span>);
	});

	client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'reconnect'</span>, <span class="hljs-function">() =&gt;</span> {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MQTT 正在重连...'</span>);
	});

	client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'MQTT 连接错误:'</span>, err);
	});

	client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">() =&gt;</span> {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MQTT 连接已关闭'</span>);
	});

	<span class="hljs-keyword">return</span> client;
}

<span class="hljs-comment">/**
 * 订阅主题
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">topic</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Function</span>} <span class="hljs-variable">callback</span> - (topic, message) =&gt; {}
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">subscribe</span>(<span class="hljs-params">topic, callback</span>) {
	<span class="hljs-keyword">if</span> (!client) {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'MQTT 客户端未初始化'</span>);
		<span class="hljs-keyword">return</span>;
	}

	client.<span class="hljs-title function_">subscribe</span>(topic, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
		<span class="hljs-keyword">if</span> (!err) {
			<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`订阅主题成功: <span class="hljs-subst">${topic}</span>`</span>);
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'订阅失败:'</span>, err);
		}
	});

	<span class="hljs-comment">// 监听消息（全局监听，需配合 topic 过滤）</span>
	client.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">receivedTopic, message</span>) =&gt;</span> {
		<span class="hljs-comment">// if (receivedTopic === topic) {</span>
			<span class="hljs-keyword">try</span> {
				<span class="hljs-comment">// 尝试解析 JSON</span>
				<span class="hljs-keyword">const</span> payload = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(message.<span class="hljs-title function_">toString</span>());
				<span class="hljs-title function_">callback</span>(receivedTopic, payload);
			} <span class="hljs-keyword">catch</span> (e) {
				<span class="hljs-comment">// 非 JSON 消息</span>
				<span class="hljs-title function_">callback</span>(receivedTopic, message.<span class="hljs-title function_">toString</span>());
			}
		<span class="hljs-comment">// }</span>
	});
}

<span class="hljs-comment">/**
 * 发布消息
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">topic</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string|object</span>} <span class="hljs-variable">message</span>
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">publish</span>(<span class="hljs-params">topic, message</span>) {
	<span class="hljs-keyword">if</span> (!client) {
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'MQTT 客户端未初始化'</span>);
		<span class="hljs-keyword">return</span>;
	}

	<span class="hljs-keyword">const</span> payload = <span class="hljs-keyword">typeof</span> message === <span class="hljs-string">'object'</span> ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(message) : message;
	client.<span class="hljs-title function_">publish</span>(topic, payload, {
		<span class="hljs-attr">qos</span>: <span class="hljs-number">1</span>
	}, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
		<span class="hljs-keyword">if</span> (err) {
			<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'发布失败:'</span>, err);
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`发布成功: <span class="hljs-subst">${topic}</span>`</span>, payload);
		}
	});
}

<span class="hljs-comment">/**
 * 断开连接
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"/>) {
	<span class="hljs-keyword">if</span> (client) {
		client.<span class="hljs-title function_">end</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// true 表示强制断开</span>
		client = <span class="hljs-literal">null</span>;
		<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'MQTT 已断开'</span>);
	}
}
</code></pre>
<p>我让 <strong>Trae</strong> 基于网上的封装简单进行了修改，生成了上述封装Js文件。</p>
<p><strong>注意</strong>：在<code>监听消息</code>的部分，如果你的 Topic 是固定的，则请将 <code>if (receivedTopic === topic)</code> 的<strong>注释打开</strong>，如果不是，则<strong>注释掉</strong>，后续有详解。</p>
<p>现在进入到 <code>page/index/index.vue</code> 文件中</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> {initMqtt, subscribe, publish, disconnect} <span class="hljs-keyword">from</span> <span class="hljs-string">'./mqttClient.js'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">host</span>: <span class="hljs-string">'broker.emqx.io'</span>,
            <span class="hljs-attr">messages</span>: []
        }
    },
    <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">connect</span>()
    },
    <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">disconnect</span>()
    },
    <span class="hljs-attr">methods</span>: {
        <span class="hljs-comment">// 连接</span>
        <span class="hljs-title function_">connect</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">const</span> uuid = <span class="hljs-title function_">uuidv4</span>();
            <span class="hljs-keyword">const</span> client = <span class="hljs-title function_">initMqtt</span>({
                <span class="hljs-attr">host</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">host</span>,
                <span class="hljs-attr">port</span>: <span class="hljs-number">8083</span>,
                <span class="hljs-attr">clientId</span>: uuid,
                <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">password</span>: <span class="hljs-string">''</span>,
                <span class="hljs-attr">useWss</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 如果是 HTTPS/WSS，设为 true</span>
            });
            <span class="hljs-keyword">if</span> (client) {
                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">subscribeTopic</span>();
            }
        },
        <span class="hljs-comment">// 订阅 test/topic 主题</span>
        <span class="hljs-title function_">subscribeTopic</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">subscribe</span>(<span class="hljs-string">'test/topic'</span>, <span class="hljs-function">(<span class="hljs-params">topic, message</span>) =&gt;</span> {
                <span class="hljs-comment">// 接收到的消息</span>
                <span class="hljs-keyword">const</span> msg = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(message);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">unshift</span>(msg);
            });
        },
        <span class="hljs-comment">// 订阅 带通配符 的主题</span>
        <span class="hljs-title function_">subscribeTopics</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">subscribe</span>(<span class="hljs-string">'+/topic'</span>, <span class="hljs-function">(<span class="hljs-params">topic, message</span>) =&gt;</span> {
                <span class="hljs-comment">// 接收到的消息</span>
                <span class="hljs-keyword">const</span> msg = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(message);
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">messages</span>.<span class="hljs-title function_">unshift</span>(msg);
            });
        },
        <span class="hljs-comment">// 发送消息到 test/topic 主题</span>
        <span class="hljs-title function_">publishMessage</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">publish</span>(<span class="hljs-string">'test/topic'</span>, {
                <span class="hljs-attr">name</span>: <span class="hljs-string">'uni-app'</span>,
                <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),
                <span class="hljs-attr">msg</span>: <span class="hljs-string">'测试信息'</span>
            });
        },
        <span class="hljs-title function_">disconnect</span>(<span class="hljs-params"/>) {
            <span class="hljs-title function_">disconnect</span>();
        }
    }
}
</code></pre>
<p><strong>注意</strong>：在卸载页面的时候建议将 MQTT连接 断开，或者在 uni-app 中使用也可以使用 unload 方法断开连接。</p>
<p>另外订阅主题可以采用常规的，确定性的 <code>Topic</code> 主题名称，也可以采用 <code>通配符(+)</code> 的主题名称。</p>
<p><strong>Trae</strong>还提醒我一定要注意，假如你的 Topic 为：</p>
<p><code>123/456/report</code> 则你的通配符主题名称为 <code>+/+/report</code></p>
<p>假如你的 Topic 为：</p>
<p><code>/123/456/report</code> 则你的通配符主题名称为 <code>+/+/+/report</code>，因为他的第一位是 <strong>空字符串</strong>。</p>
<h2 data-id="heading-2">结论</h2>
<p>在开发 IoT 设备时这个协议用的比较广泛，如果不接触这个方面一般不会用上这个。</p>
<p>另外 MQTT 本身自带<code>心跳</code>和<code>自动重连</code>机制，大致上相当于 <code>WebSocket</code>，这个部分一般不需要做特殊开发。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【重磅福利】学生认证可免费领取 Gemini 3 Pro 一年]]></title>    <link>https://juejin.cn/post/7593338828195446824</link>    <guid>https://juejin.cn/post/7593338828195446824</guid>    <pubDate>2026-01-09T14:35:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195446824" data-draft-id="7593193235251396660" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【重磅福利】学生认证可免费领取 Gemini 3 Pro 一年 "/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-09T14:35:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大卫"/> <meta itemprop="url" content="https://juejin.cn/user/1961184474695213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【重磅福利】学生认证可免费领取 Gemini 3 Pro 一年 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1961184474695213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大卫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:35:54.000Z" title="Fri Jan 09 2026 14:35:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>谷歌正式发布最新一代推理模型 Gemini 3.0 Pro，并同步开放 API 接口及在 谷歌 AI Studio 推出预览版。这款模型一经发布，立刻横扫各大评测榜单，以“一夜封神”的姿态震撼了全球 AI 社群。</p>
<p>值得玩味的是，OpenAI 首席执行官奥特曼也隔空向谷歌发来“贺电”，在社交媒体上评价“Gemini 3 看起来很不错”，谷歌首席执行官皮查伊（Sundar Pichai）则以一个轻松的表情包回应，尽显王者风范。</p>
<p>Gemini 3.0 Pro 的强大并非空穴来风，其在关键的基准测试中实现了全面“碾压式”的领先：</p>
<p><strong>数学能力登顶全球：</strong> 在被誉为“地狱难度”的数学竞赛基准 MathArena 中，当 GPT-5.1 等其他顶级大模型仍在 1% 左右徘徊时，Gemini 3.0 Pro 的得分一举达到 <strong>23.4%</strong> ，毫无争议地成为当前全球数学能力最强的 AI。</p>
<h2 data-id="heading-1">重磅福利</h2>
<p>现在一年会员只要 <strong>29.9</strong> 元，帮您解决以下 4 大问题。</p>
<blockquote>
<p>⚠️注：优惠截止日期 2026年1月31日</p>
<p>如有问题可以联系V：zm_david。</p>
</blockquote>
<h2 data-id="heading-2">1. 出了点问题（Something went wrong）</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/228d3b26acee4cb0a60a7d1b40514c86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=FwqoEmTGrfzbyt7J09CcHSndlfs%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b44ecadaba1b48cca89662ae802a29de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=pwcwTIc%2FPwlJUvIiHD0rgaSDr2A%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">2. 此账号无法订阅 Google AI 方案</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e3e2b44eed343e3b9b73e9b19001e46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=3iNaktoFMgp17ihOUw1uZu9hNe0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">3. 无法享受此优惠</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64f8c40de8054a4684fbed1304e96c21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=hX5x6DXtJ4ygmXzSruRwL7lJopM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0af1afa414f74c259acab6a7b0121e16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=vguhpjj9Aa0x0AN%2FHR%2F9xc4aHI0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">4. 没有 Visa 卡绑定</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0983335f6f548109905edf089f93f30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768574154&amp;x-signature=i7%2BbFbh%2B9LL59ZGJHssYSysd%2Bqk%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose内部的不同节点类型]]></title>    <link>https://juejin.cn/post/7593164154632126473</link>    <guid>https://juejin.cn/post/7593164154632126473</guid>    <pubDate>2026-01-09T14:55:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593164154632126473" data-draft-id="7593175890794840110" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose内部的不同节点类型"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2026-01-09T14:55:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose内部的不同节点类型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T14:55:00.000Z" title="Fri Jan 09 2026 14:55:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「The Different Node Types in Jetpack Compose」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.grokkingandroid.com%2Fthe-different-node-types-in-jetpack-compose%2F" target="_blank" title="https://www.grokkingandroid.com/the-different-node-types-in-jetpack-compose/" ref="nofollow noopener noreferrer">www.grokkingandroid.com/the-differe…</a>，由Wolfram Rittmeyer发布于2025年12月30日。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a732fb91ad6842e5ac8ac107d3ad45a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768575299&amp;x-signature=MY8MC4m7UqcnVuXbWeLfU%2BG8XFg%3D" alt="预览图展示了 ComposeUiNode 的部分列表" loading="lazy"/></p>
<p>如果你仔细观察 Compose，你会发现它很奇怪。你会发现很多函数都没有返回值。然而，<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fui%2Fcompose%2Fmental-model" target="_blank" title="https://developer.android.com/develop/ui/compose/mental-model" ref="nofollow noopener noreferrer">Android 文档</a>却说：</p>
<blockquote>
<p>可组合函数会生成 UI 层级结构。</p>
</blockquote>
<p>这到底是什么意思呢？从函数式编程的角度来看，你那些看似无害的无状态可组合函数实际上会产生大量的<em>副作用[1]</em>。其中就包括<em>创建节点[2]</em>。</p>
<p>有时你可能会创建一些可组合函数来自己创建节点。但更多时候，你会直接委托给其他可组合函数来创建节点。</p>
<p>那么，让我们来看看有哪些节点，它们的创建位置以及它们的用途：</p>
<ul>
<li>ComposeUiNode</li>
<li>LayoutNode</li>
<li>Modifier.Node</li>
<li>SemanticsNode</li>
</ul>
<h2 data-id="heading-0">ComposeUiNode</h2>
<p>当你深入研究<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2Flayout%2Fpackage-summary%23Layout(androidx.compose.ui.Modifier%2Candroidx.compose.ui.layout.MeasurePolicy)" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/layout/package-summary#Layout(androidx.compose.ui.Modifier,androidx.compose.ui.layout.MeasurePolicy)" ref="nofollow noopener noreferrer"><code>Layout</code></a>可组合对象时，你会发现它调用了<code>ReusableComposeNode[3]</code>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-meta">@UiComposable</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">Layout</span><span class="hljs-params">(modifier: <span class="hljs-type">Modifier</span> = Modifier, measurePolicy: <span class="hljs-type">MeasurePolicy</span>)</span></span> {
    <span class="hljs-keyword">val</span> compositeKeyHash = currentCompositeKeyHash
    <span class="hljs-keyword">val</span> materialized = currentComposer.materialize(modifier)
    <span class="hljs-keyword">val</span> localMap = currentComposer.currentCompositionLocalMap
    ReusableComposeNode&lt;ComposeUiNode, Applier&gt;(
        factory = ComposeUiNode.Constructor,
        update = {
            <span class="hljs-keyword">set</span>(measurePolicy, SetMeasurePolicy)
            <span class="hljs-keyword">set</span>(localMap, SetResolvedCompositionLocals)
            <span class="hljs-keyword">set</span>(materialized, SetModifier)
            <span class="hljs-keyword">set</span>(compositeKeyHash, SetCompositeKeyHash)
        },
    )
}
</code></pre>
<p><strong><code>ReusableComposeNode</code>本身并不是一个节点。</strong> 上面的代码中并没有构造函数调用，而是对另一个可组合对象的调用。第八行的工厂参数看似无关紧要，但实际上非常重要。因为最终会创建节点的就是这个函数。它会创建一个 <code>ComposeUiNode</code>。</p>
<p><code>ReusableComposeNode</code> Composable 与 Compose 运行时紧密相关。这段代码告诉 Composer 应该启动一个 <code>GroupKind.ReusableNode</code> 类型的新组，然后代码会创建一个新节点，或者在重新组合时重用现有节点。最后，当使用 update 函数参数时，它会设置节点的内容：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Any, <span class="hljs-keyword">reified</span> E : Applier&gt;</span> <span class="hljs-title">ReusableComposeNode</span><span class="hljs-params">(
    <span class="hljs-keyword">noinline</span> factory: () -&gt; <span class="hljs-type">T</span>,
    update: @<span class="hljs-type">DisallowComposableCalls</span> <span class="hljs-type">Updater</span>.() -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    <span class="hljs-keyword">if</span> (currentComposer.applier !<span class="hljs-keyword">is</span> E) invalidApplier()
    currentComposer.startReusableNode()
    <span class="hljs-keyword">if</span> (currentComposer.inserting) {
        currentComposer.createNode(factory)
    } <span class="hljs-keyword">else</span> {
        currentComposer.useNode()
    }
    Updater(currentComposer).update()
    currentComposer.endNode()
}
</code></pre>
<p>我们看到工厂被传递给了 <code>createNode()</code> 调用。此调用会安排在所有插入操作处理完毕后创建节点。Compose 运行时内部会延迟执行许多操作以实现优化。这里我们并不关心具体何时发生，只需知道它_将会_发生即可。当它发生时，工厂将被调用。</p>
<p>现在让我们更仔细地看一下工厂本身：<code>ComposeUiNode.Constructor</code> 看起来像是 <code>ComposeUiNode</code> 的构造函数。但事实并非如此。实际上，<code>ComposeUiNode</code> 是一个接口，它本身并不执行任何操作。它实际上是 <code>LayoutNode</code> 使用的基接口。至于这个接口和构造函数的用途，在接口声明上方的注释中已经给出：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/** Interface extracted from LayoutNode to not mark the whole LayoutNode class as <span class="hljs-doctag">@PublishedApi</span>. */</span>
<span class="hljs-meta">@PublishedApi</span>
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComposeUiNode</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-comment">/** Object of pre-allocated lambdas used to make use with ComposeNode allocation-less. */</span>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">val</span> Constructor: () -&gt; ComposeUiNode = LayoutNode.Constructor
        <span class="hljs-keyword">val</span> VirtualConstructor: () -&gt; ComposeUiNode = { LayoutNode(isVirtual = <span class="hljs-literal">true</span>) }
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p><strong>所以 <code>ComposeUiNode</code> 只是 <code>LayoutNode</code> 的一个抽象。</strong></p>
<h2 data-id="heading-1">布局节点（LayoutNode）</h2>
<p>在上一节中，我们已经了解了 <code>LayoutNode</code> 的实际创建时间。基本上，每当调用 <code>Layout</code> 可组合组件时，都会创建 <code>LayoutNode</code>。<code>LayoutNode</code> 是树状结构中的元素，代表屏幕上的内容。它需要被测量，可以在其边界内放置子元素，也可以绘制内容。</p>
<p>每个 <code>LayoutNode</code> 都知道它的子元素和父元素。因此，<code>LayoutNode</code> 构成了一个节点树，代表了已发出的内容。需要明确的是：Compose 创建的树状结构与其他 UI 框架一样——但 Google 更倾向于使用一些更高级的命名方式。<strong>因此，每当你听到/读到有关可组合组件发出内容时，请将其理解为一个 LayoutNode 被创建并插入到树中。</strong></p>
<p><code>LayoutNode</code> 类实际上非常有趣，因此值得单独撰写一篇博文，我将在其中更详细地介绍它的一些方面。</p>
<p>这里有两点值得一提：</p>
<ul>
<li><code>Applier</code> 是调用 <code>LayoutNode</code> 相应树状结构处理方法的实例。 - <code>LayoutNode</code> 持有对 <code>Owner</code> 的引用。</li>
</ul>
<p>由于 <code>Applier</code> 和 <code>Owner</code> 在 Compose 中都是非常重要的概念，我将在单独的博文中分别介绍它们。</p>
<h3 data-id="heading-2">LayoutNode 的用途</h3>
<p><code>LayoutNode</code> 构成 UI 树，并跟踪其父节点和子节点。UI 树本身的管理由 <code>Applier</code> 完成，我将在另一篇文章中介绍它。</p>
<p>另外，需要记住的一点是，<code>LayoutNode</code> 存储在 <code>SlotTable[4]</code> 中。因此，在重新组合时，如果运行时认为树的这一部分不需要更改，则可以重用现有的 <code>LayoutNode</code>。</p>
<p><code>LayoutNode</code> 还会保存其修饰符（参见下一节），并委托这些修饰符来决定该 <code>LayoutNode</code> 需要多少空间（测量）、在屏幕上放置元素的位置（布局）以及最终在屏幕上显示什么内容（绘制）。</p>
<p>还有更多内容——但正如我提到的，那是另一篇文章的一部分。</p>
<h2 data-id="heading-3">Modifier.Node</h2>
<p>修饰符在内部由 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2FModifier.Node" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/Modifier.Node" ref="nofollow noopener noreferrer"><code>Modifier.Node</code></a> 对象表示。<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2FModifier.Node" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/Modifier.Node" ref="nofollow noopener noreferrer">根据文档</a>，它是“为应用于 androidx.compose.ui.layout.Layout 的每个 Modifier.Element 创建的生命周期更长的对象”。</p>
<p>这个“生命周期更长”很有意思。基本上，只要 <code>Modifier.Node</code> 属于 <code>LayoutNode</code> 的修饰符链，它就会一直存在。 <code>LayoutNode</code> 持有一个 <code>NodeChain</code> 类型的对象，该对象内部维护着一个修饰符列表，并检查该列表是否发生更改，以及 <code>Modifier.Node</code> 的生命周期方法（例如 <code>onAttach()</code>）是否被调用。</p>
<p><code>Modifier.Node</code> 有许多现有的子类型，例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2Fnode%2FLayoutModifierNode" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/node/LayoutModifierNode" ref="nofollow noopener noreferrer"><code>LayoutModifierNode</code></a>（见下文）或 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2Fnode%2FDrawModifierNode%3Fhl%3Den" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/node/DrawModifierNode?hl=en" ref="nofollow noopener noreferrer"><code>DrawModifierNode</code></a>。后者负责实际在屏幕上绘制内容，我计划在另一篇文章中详细介绍。</p>
<p>由于 <code>LayoutNode</code> 是 <code>SlotTable</code> 的一部分，因此附加到 <code>LayoutNode</code> 的 <code>NodeChain</code> 对象的 <code>Modifier.Node</code> 显然也是 <code>SlotTable</code> 的一部分。</p>
<h3 data-id="heading-4">特殊子类型：<code>LayoutModifierNode</code></h3>
<p><code>LayoutModifierNode</code>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2Fnode%2FLayoutModifierNode%25EF%25BC%2589%25E6%2598%25AF%25E5%25AE%259E%25E9%2599%2585%25E8%25BF%259B%25E8%25A1%258C%25E6%25B5%258B%25E9%2587%258F%25E7%259A%2584%25E8%258A%2582%25E7%2582%25B9%25EF%25BC%258C%25E5%259B%25A0%25E4%25B8%25BA%25E5%25AE%2583%25E4%25BB%25AC%25E4%25BC%259A%25E5%25BD%25B1%25E5%2593%258D%25E5%25B1%258F%25E5%25B9%2595%25E4%25B8%258A%25E5%2585%2583%25E7%25B4%25A0%25E7%259A%2584%25E5%25A4%25A7%25E5%25B0%258F%25E5%2592%258C%25E4%25BD%258D%25E7%25BD%25AE%25E3%2580%2582%25E6%25AD%25A3%25E5%25A6%2582%25E6%2596%2587%25E6%25A1%25A3%25E6%2589%2580%25E8%25BF%25B0%25EF%25BC%259A%25E2%2580%259C%2560LayoutModifierNode%2560" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/node/LayoutModifierNode%EF%BC%89%E6%98%AF%E5%AE%9E%E9%99%85%E8%BF%9B%E8%A1%8C%E6%B5%8B%E9%87%8F%E7%9A%84%E8%8A%82%E7%82%B9%EF%BC%8C%E5%9B%A0%E4%B8%BA%E5%AE%83%E4%BB%AC%E4%BC%9A%E5%BD%B1%E5%93%8D%E5%B1%8F%E5%B9%95%E4%B8%8A%E5%85%83%E7%B4%A0%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%92%8C%E4%BD%8D%E7%BD%AE%E3%80%82%E6%AD%A3%E5%A6%82%E6%96%87%E6%A1%A3%E6%89%80%E8%BF%B0%EF%BC%9A%E2%80%9C%60LayoutModifierNode%60" ref="nofollow noopener noreferrer">developer.android.com/reference/k…</a> 会改变其包裹内容的测量和布局方式。”。因此，在测量和布局过程中，每当遍历 <code>ModifierNode</code> 链时，这些节点实际上都会开始进行测量。</p>
<p>因此，所有想要改变其子元素位置或对整个 Composable 元素大小产生任何影响的修饰符都需要实现 <code>LayoutModifierNode</code> 接口。例如，<code>SizeNode</code> 就是一个实现 <code>LayoutModifierNode</code> 接口的例子，它是 <code>height()</code>、<code>width()</code> 或 <code>size()</code> 等修饰符实际使用的节点。</p>
<h2 data-id="heading-5">SemanticsNode</h2>
<p>当你想要向设备的*辅助功能服务[5]*传递一些信息时，你可以使用 Compose 中的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fkotlin%2Fandroidx%2Fcompose%2Fui%2FModifier%23(androidx.compose.ui.Modifier).semantics(kotlin.Boolean%2Ckotlin.Function1)" target="_blank" title="https://developer.android.com/reference/kotlin/androidx/compose/ui/Modifier#(androidx.compose.ui.Modifier).semantics(kotlin.Boolean,kotlin.Function1)" ref="nofollow noopener noreferrer"><code>semantics</code></a> 修饰符来告知系统要向用户传达哪些语义属性。</p>
<p>但是辅助功能服务并不了解 Compose。在其他平台上，这一点显而易见，但考虑到 Compose 向后兼容（而且它并非 Android 框架的组成部分），在 Android 上也是如此。</p>
<p>对于辅助功能，前面提到的 <code>Owner</code> 再次发挥作用。它持有一个 <code>SemanticsOwner</code>，该 <code>SemanticsOwner</code> 充当了与相应平台语义框架之间的桥梁。</p>
<p>为此，<code>SemanticsOwner</code> 维护着一个 <code>SemanticNode</code> 对象树，用于向辅助功能服务的用户描述屏幕内容。这也是我未来会更详细介绍的内容之一。</p>
<p>敬请期待更多关于 Compose 内部运作机制的见解。祝你编码愉快！</p>
<h2 data-id="heading-6">脚注</h2>
<ul>
<li>[1] 我在本段中使用“副作用”一词，是因为它在<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSide_effect_(computer_science)" target="_blank" title="https://en.wikipedia.org/wiki/Side_effect_(computer_science)" ref="nofollow noopener noreferrer">计算机科学和函数式编程</a>中由来已久。我这里指的并非官方 Compose 文档中提到的<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fui%2Fcompose%2Fside-effects" target="_blank" title="https://developer.android.com/develop/ui/compose/side-effects" ref="nofollow noopener noreferrer">副作用</a>。Compose 文档至少在过去有时会提及副作用的这种用法——尽管实际上 Compose 函数并非纯函数。</li>
<li>[2] 如果在 Compose Compiler 插件完成工作后查看 Composable，你会发现它不仅创建了节点，而且你的函数还会进行大量调用，从而改变应用程序的全局状态。但这些调用并不会实际绘制任何内容。它们最多只会创建一些绘制操作，这些操作会被记录下来，并在系统认为需要绘制时，于未来的某个时间点被调用。我将在以后的两篇文章中分别介绍绘制过程以及编译器对代码所做的更改。</li>
<li>[3] 实际上，布局可组合对象共有三个。但它们最终都会调用 <code>ReusableComposeNode</code>。其他变体的示例也与之非常相似。</li>
<li>[4] 本系列文章中我可能不会介绍 SlotTable。我推荐 Richard Leland 的这篇关于 compose 的文章（<a href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2Fandroiddevelopers%2Funder-the-hood-of-jetpack-compose-part-2-of-2-37b2c20c6cdd%25EF%25BC%2589%25EF%25BC%258C%25E4%25BB%25A5%25E5%258F%258A" target="_blank" title="https://medium.com/androiddevelopers/under-the-hood-of-jetpack-compose-part-2-of-2-37b2c20c6cdd%EF%BC%89%EF%BC%8C%E4%BB%A5%E5%8F%8A" ref="nofollow noopener noreferrer">medium.com/androiddeve…</a> Mohit Sarveiya 的关于 slotTable 的视频（<a href="https://link.juejin.cn?target=https%3A%2F%2Fcodingwithmohit.com%2F%25EF%25BC%2589%25EF%25BC%258C%25E8%25BF%2599%25E4%25BA%259B%25E8%25A7%2586%25E9%25A2%2591%25E8%25AE%25B2%25E8%25A7%25A3%25E4%25BA%2586%25E5%25A6%2582%25E4%25BD%2595%25E6%25AD%25A3%25E7%25A1%25AE%25E4%25BD%25BF%25E7%2594%25A8" target="_blank" title="https://codingwithmohit.com/%EF%BC%89%EF%BC%8C%E8%BF%99%E4%BA%9B%E8%A7%86%E9%A2%91%E8%AE%B2%E8%A7%A3%E4%BA%86%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8" ref="nofollow noopener noreferrer">codingwithmohit.com/），这些视频讲解了如何…</a> slotTable。</li>
<li>[5] 设备上的辅助功能服务在 Android 系统中是 AccessibilityService 的实现，但在 iOS、桌面或 Web 端则有所不同，因此我在本文中使用“辅助功能服务”这个通用术语。</li>
</ul>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GIS中的“高度”到底指什么？一文厘清正高、正常高与大地高的区别]]></title>    <link>https://juejin.cn/post/7593098101432729654</link>    <guid>https://juejin.cn/post/7593098101432729654</guid>    <pubDate>2026-01-09T13:23:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593098101432729654" data-draft-id="7593145583348088874" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GIS中的“高度”到底指什么？一文厘清正高、正常高与大地高的区别"/> <meta itemprop="keywords" content="GIS"/> <meta itemprop="datePublished" content="2026-01-09T13:23:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="charlee44"/> <meta itemprop="url" content="https://juejin.cn/user/1117549770846872"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GIS中的“高度”到底指什么？一文厘清正高、正常高与大地高的区别
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1117549770846872/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    charlee44
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:23:01.000Z" title="Fri Jan 09 2026 13:23:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>节选自<a href="https://link.juejin.cn?target=https%3A%2F%2Fitem.jd.com%2F14603137.html" target="_blank" title="https://item.jd.com/14603137.html" ref="nofollow noopener noreferrer">《GIS基础原理与技术实践》</a>第2章 地理空间参考系统</strong>
作者原创内容，转载请注明出处。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f40e608f94c493889e21857893f4279~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569781&amp;x-signature=2RdCPNt9Q2tYu%2B%2F3LRnrwqZ0woU%3D" alt="GIS基础原理与技术实践" loading="lazy"/></p>
<h2 data-id="heading-0">2.3 高程参考系统</h2>
<p>使用经度和纬度表示的地理坐标系是一种水平坐标系统（这里的水平坐标系统并不表示其就是平面坐标系的意思，更准确的含义是其表达了三维空间坐标系的两个维度），缺少对于第三维度也就是高程的参考，也就是本节我们要介绍的：高程参考系统。高程参考系统是一种垂直坐标系。</p>
<h3 data-id="heading-1">2.3.1 大地水准面</h3>
<p>我们知道，参考椭球体是对地球表面的一种逼近。那么问题来了，参考椭球体是用喜马拉雅山所在的高度进行逼近，还是以马里亚纳海沟的高度进行逼近？答案肯定都不是。其实，这其中还隐藏了另一个逼地球自然表面的参考面，那就是本节我们要讲的——大地水准面（Geoid）。</p>
<p>地理坐标系的第三维度通常使用海拔高度（Elevation），而不是到球心的距离。然而问题在于，高度的值是一个相对量，需要一个起算点。并且，这个高度必须沿着重力方向（铅锤方向）才有物理意义（想一想为什么建筑物总是要修的与地面垂直）。我们说到“海拔”这个名词，就会联想到高度的值应该是一个目标地物距离海平面的高差。事实也确实如此，我们可以定一个平均海平面作为高程的起算点，并且假设这个海平面完全静止，并且延伸到所有大陆下部，生成了一个密闭的曲面——这个曲面就是大地水准面。</p>
<p>与参考椭球面不同的是，参考椭球面是数学模型得到的，处处平滑且平整；而大地水准面虽然平滑但不平整，是一个不规则但连续的闭合曲面。这其中的原因在于，地球质量分布不均匀，造成地球的引力场也是分布不均的。假设地球球体完全被水覆盖，水的高度也不会是完全一样：在地球局部密度更大的地方，地球施加的引力就会越大，造成水位越高。换句话说，大地水准面是一个重力等势面，重力方向（铅垂方向）在其任何地方都与其表面垂直；由于质量（引力）不均，每个位置的铅垂方向不一样，结果就是大地水准面并不平整。如下图2.8所示。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d53017b72e44df6ad9ded58c1b883c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569781&amp;x-signature=PypzjF4eh0ArCPUww%2B2Blb2KwRI%3D" alt="图2.8 大地水准面与旋转椭球体" loading="lazy"/></p>
<h3 data-id="heading-2">2.3.2 三级逼近</h3>
<p>现在我们已经有了大地水准面、参考椭球面和大地基准面。那么它们的关系是如何呢？简单来说，它们共同组成了对地球自然表面的三级逼近。</p>
<ul>
<li>大地水准面是对地球自然表面的第一级逼近。大地水准面通过重力等势，确定了一个高程起算面，它远比地球自然表面平整得多，但是不是完全平整。地球自然表面具有从珠穆朗玛峰（+8800米）到马里亚纳海沟（-11,000米）的高差，但大地水准面与参考椭球面的偏差范围不超过200m（从+85米的冰岛到-106米的印度南部）。</li>
<li>参考椭球面是对地球自然表面的第二级逼近。地球自然表面和大地水准面都是不规则的曲面，无法通过数学模型对其进行表达，这也意味着难以对其进行测算和分析。通过将大地水准面拟合成一个旋转椭球体，使我们可以对地球自然表面进行空间几何计算。参考椭球面是测量计算的基准面。</li>
<li>大地基准面是对地球自然表面的第三极逼近。参考椭球体是对地球球体的抽象，但大地基准面解决的是这个参考椭球体如何摆放的问题：大地基准面要么与地球自然表面的局部区域具有较好的重合度，以便解决局部区域精度的问题；要么让椭球体中心位于地球质心，以便具有全球范围可使用的便捷性。</li>
</ul>
<h3 data-id="heading-3">2.3.3 高程系统</h3>
<h4 data-id="heading-4">1 似大地水准面</h4>
<p>如前所述，大地水准面确定了高程的起算面。那么，地球表面上一点到大地水准面必然有一个高度，这个高度就是正高（Orthometric Height）。正高就是我们通常意义上所说的海拔或者海拔高度，也叫做高程（Elevation）。这个高程系统就是正高系统。</p>
<p>然而，大地水准面的问题是其仅仅只是一个理想化的模型，是不能准确测量的。客观地说，大地水准面所假想的大陆下部的海平面无法被量测，没有现实意义。为了解决这个问题，就引入了一个数学辅助面：似大地水准面（Quasi-geoid）。似大地水准面采用平均正常重力值来拟合水准面曲线（大地某一点的重力值无法精确求取），导致两者在海洋上完全重合，在大陆上有2 ~ 4米的微小差异。如果不能理解不要紧，我们可以定性的理解：似大地水准面是对大地水准面的数学近似，似大地水准面可以精确求得，大地水准面不可以精确求得。</p>
<p>同样的，地球表面上一点到似大地水准面也有一个高度，我们把这个高度叫做正常高（Normal height），其高程就是正常高系统。正因为似大地水准面是大地水准面得近似且可求取，所以一般使用正常高来替代正高，正常高系统结果也可以称为海拔高度。我国目前采用的法定高程系统就是正常高系统。</p>
<p>正高和正常高，大地水准面和似大地水准面的示意图如下图2.9所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0724c4f0f8084ebab6f8e5d74660fb1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569781&amp;x-signature=WFVH8luc5ce1hikIEldLD4ErKDI%3D" alt="图2.9 正高、正常高与大地高" loading="lazy"/></p>
<h4 data-id="heading-5">2 高程系统</h4>
<p>如图2.9中所示，除了正高系统和正常高系统，还有一类常用的高程系统就是大地高系统。所谓大地高，指的是以参考椭球面为基准面的高程系统，其值是地面上一点沿该点的椭球面法线到参考椭球面的距离。大地高也称为椭球高。</p>
<p>虽然我们一般采用的高程系统是正常高系统，但在实际的使用过程中，有的时候知道正常高需要计算大地高，有的时候又需要通过大地高来计算正常高。一个很典型的例子就是，GPS（Global Positioning System，全球定位系统）获取的高程一般是大地高，那么如何得到我们想要的正常高呢？</p>
<p>如下表2.4所述，对于高程系统中变量，我们有如下定义：</p>




































<table><thead><tr><th align="center">符号</th><th align="center">名称</th><th align="center">含义</th></tr></thead><tbody><tr><td align="center"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">H_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></td><td align="center">正常高（Normal Height）</td><td align="center">地面上一点沿重力方向到似大地水准面的距离</td></tr><tr><td align="center"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>o</mi></msub></mrow><annotation encoding="application/x-tex">H_o</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span></td><td align="center">正高 （Orthometric Height）</td><td align="center">地面上一点沿重力方向到大地水准面的距离</td></tr><tr><td align="center"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">H_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span></td><td align="center">大地高（Geodetic Height）</td><td align="center">地面上一点沿椭球面法线方向到参考椭球面的距离</td></tr><tr><td align="center"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ζ</mi></mrow><annotation encoding="application/x-tex">\zeta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span></span></span></span></span></td><td align="center">高程异常（Height Anomaly）</td><td align="center">似大地水准面到参考椭球面的距离</td></tr><tr><td align="center"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span></span></td><td align="center">大地水准面差距（Geoid Undulation）</td><td align="center">大地水准面到参考椭球面的距离</td></tr></tbody></table>
<p>将它们在示意图中标识，如下图2.10所示：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/86f67969c61e4eafaf010751f95ea2d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2hhcmxlZTQ0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768569781&amp;x-signature=3J2R4NYxMc2jIP%2F%2FX4u8oDPWyOA%3D" alt="图2.10 正高、正常高与大地高" loading="lazy"/></p>
<p>根据图示很显然可以得到如下公式：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"/><mtd><mrow><msub><mi>H</mi><mi>g</mi></msub><mo>=</mo><msub><mi>H</mi><mi>n</mi></msub><mo>+</mo><mi>ζ</mi></mrow></mtd><mtd width="50%"/><mtd><mtext>(2.6)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">H_g = H_n + \zeta \tag{2.6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span></span><span class="tag"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2.6</span></span><span class="mord">)</span></span></span></span></span></span></div>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"/><mtd><mrow><msub><mi>H</mi><mi>g</mi></msub><mo>=</mo><msub><mi>H</mi><mi>o</mi></msub><mo>+</mo><mi>N</mi></mrow></mtd><mtd width="50%"/><mtd><mtext>(2.7)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">H_g = H_o + N \tag{2.7}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">o</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span><span class="tag"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2.7</span></span><span class="mord">)</span></span></span></span></span></span></div>
<p>回到之前提到的问题，GPS获取的高程为大地高<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">H_g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span></span></span></span>，那么再通过大地测量的方法，可以精确确定高程异常<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ζ</mi></mrow><annotation encoding="application/x-tex">\zeta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.07378em;">ζ</span></span></span></span></span>，根据公式2.6，大地高减去高程异常就可以得到正常高<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">H_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span></span></span></span>，正常高可以用来代替正高，正高即最常用的海拔高度。在实际的应用中，有时需要大地高，有时需要正常高，可根据上述公式灵活转换。</p>
<h4 data-id="heading-6">3 高程基准</h4>
<p>如2.3.1节所述，大地水准面使用一个假想的平均海平面作为高程起点（基准），这个平均海面可以通过在各地的验潮站观测、计算、综合得到。我国根据实际的观测结果之上，建立多个高程基准面，其中最常用的两个国家高程基准是：</p>
<ul>
<li>1956黄海高程基准，水准原点高程72.289米。</li>
<li>1985国家高程基准，水准原点高程72.260米。</li>
</ul>
<p>目前，1985国家高程基准已经全部替代1956黄海高程基准，之前所有使用1956黄海高程基准的高程结果都需要通过下式2.8进行转换：</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>H</mi><mn>85</mn></msub><mo>=</mo><msub><mi>H</mi><mn>56</mn></msub><mo>−</mo><mn>0.029</mn></mrow><annotation encoding="application/x-tex">H_{85} = H_{56} - 0.029</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">85</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0813em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">56</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0.029</span></span></span></span></span></div>
<p>此外，国际上通用的还有美国国家地理空间情报局（National Geospatial-Intelligence Agency，NGA）发布的EGM（Earth Gravitational Models，地球重力模型）大地水准面。这个大地水准面模型是综合利用现有全球大量重力数据计算出来的，适用于全球范围。目前已经发布了EGM84、EGM96、EGM2008和EGM2020四个版本。</p>
<hr/>
<p>本文节选自作者新书《GIS基础原理与技术实践》第2章。书中系统讲解 GIS 核心理论与多语言实战，适合开发者与高校师生。</p>
<p>📚 <strong>配套资源开源</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffafa1899%2FGISBasic" target="_blank" title="https://github.com/fafa1899/GISBasic" ref="nofollow noopener noreferrer">GitHub</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Fcharlee44%2FGISBasic" target="_blank" title="https://gitcode.com/charlee44/GISBasic" ref="nofollow noopener noreferrer">GitCode</a></p>
<p>🛒 <strong>支持正版</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fitem.jd.com%2F14603137.html" target="_blank" title="https://item.jd.com/14603137.html" ref="nofollow noopener noreferrer">京东</a>｜<a href="https://link.juejin.cn?target=https%3A%2F%2Fproduct.dangdang.com%2F29988568.html" target="_blank" title="https://product.dangdang.com/29988568.html" ref="nofollow noopener noreferrer">当当</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（31）Hibernate的原生SQL查询是什么？]]></title>    <link>https://juejin.cn/post/7593145583348105258</link>    <guid>https://juejin.cn/post/7593145583348105258</guid>    <pubDate>2026-01-09T13:47:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593145583348105258" data-draft-id="7593098101432778806" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（31）Hibernate的原生SQL查询是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T13:47:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（31）Hibernate的原生SQL查询是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:47:01.000Z" title="Fri Jan 09 2026 13:47:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的原生SQL查询</h3>
<p>在某些情况下，HQL（Hibernate Query Language）或Criteria API可能无法满足复杂查询的需要，这时可以使用原生SQL查询（Native SQL Query）。原生SQL查询允许开发者直接编写SQL语句，并通过Hibernate执行这些语句，将结果映射为实体类或自定义结果集。</p>
<h3 data-id="heading-1">使用原生SQL查询</h3>
<p>原生SQL查询主要分为两种：</p>
<ol>
<li><strong>实体查询</strong>：返回实体对象。</li>
<li><strong>非实体查询</strong>：返回自定义对象或投影结果。</li>
</ol>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">实体类定义</h4>
<p>我们将定义两个实体类：<code>Person</code> 和 <code>Address</code>。</p>
<h5 data-id="heading-4">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-5">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-6">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-8">使用原生SQL查询示例</h3>
<h4 data-id="heading-9">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-10">使用原生SQL查询</h4>
<h5 data-id="heading-11">查询所有Person记录</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAllPersons</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM person"</span>;
            NativeQuery&lt;Person&gt; query = session.createNativeQuery(sql, Person.class);
            List&lt;Person&gt; persons = query.getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-12">使用投影查询返回自定义结果</h5>
<p>假设我们只想查询Person的姓名和年龄，而不是整个实体，这时可以使用投影查询（Projection Query）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateProjectionQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL投影查询</span>
        queryPersonNameAndAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonNameAndAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT name, age FROM person"</span>;
            NativeQuery&lt;Object[]&gt; query = session.createNativeQuery(sql);
            List&lt;Object[]&gt; results = query.getResultList();
            System.out.println(<span class="hljs-string">"Query person name and age:"</span>);
            <span class="hljs-keyword">for</span> (Object[] row : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
                <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> (Integer) row[<span class="hljs-number">1</span>];
                System.out.println(name + <span class="hljs-string">" - "</span> + age);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-13">原生SQL查询详细解释</h3>
<ol>
<li>
<p><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象供查询使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>查询所有Person记录</strong>：使用原生SQL查询所有Person记录并映射为<code>Person</code>实体。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（31）Hibernate的原生SQL查询是什么？]]></title>    <link>https://juejin.cn/post/7593165280488833065</link>    <guid>https://juejin.cn/post/7593165280488833065</guid>    <pubDate>2026-01-09T13:47:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593165280488833065" data-draft-id="7593098101432795190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（31）Hibernate的原生SQL查询是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T13:47:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（31）Hibernate的原生SQL查询是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:47:44.000Z" title="Fri Jan 09 2026 13:47:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的原生SQL查询</h3>
<p>在某些情况下，HQL（Hibernate Query Language）或Criteria API可能无法满足复杂查询的需要，这时可以使用原生SQL查询（Native SQL Query）。原生SQL查询允许开发者直接编写SQL语句，并通过Hibernate执行这些语句，将结果映射为实体类或自定义结果集。</p>
<h3 data-id="heading-1">使用原生SQL查询</h3>
<p>原生SQL查询主要分为两种：</p>
<ol>
<li><strong>实体查询</strong>：返回实体对象。</li>
<li><strong>非实体查询</strong>：返回自定义对象或投影结果。</li>
</ol>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">实体类定义</h4>
<p>我们将定义两个实体类：<code>Person</code> 和 <code>Address</code>。</p>
<h5 data-id="heading-4">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h5 data-id="heading-5">Address类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h4 data-id="heading-6">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-8">使用原生SQL查询示例</h3>
<h4 data-id="heading-9">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-10">使用原生SQL查询</h4>
<h5 data-id="heading-11">查询所有Person记录</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAllPersons</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT * FROM person"</span>;
            NativeQuery&lt;Person&gt; query = session.createNativeQuery(sql, Person.class);
            List&lt;Person&gt; persons = query.getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-12">使用投影查询返回自定义结果</h5>
<p>假设我们只想查询Person的姓名和年龄，而不是整个实体，这时可以使用投影查询（Projection Query）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.NativeQuery;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateProjectionQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL投影查询</span>
        queryPersonNameAndAge(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonNameAndAge</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"SELECT name, age FROM person"</span>;
            NativeQuery&lt;Object[]&gt; query = session.createNativeQuery(sql);
            List&lt;Object[]&gt; results = query.getResultList();
            System.out.println(<span class="hljs-string">"Query person name and age:"</span>);
            <span class="hljs-keyword">for</span> (Object[] row : results) {
                <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> (String) row[<span class="hljs-number">0</span>];
                <span class="hljs-type">Integer</span> <span class="hljs-variable">age</span> <span class="hljs-operator">=</span> (Integer) row[<span class="hljs-number">1</span>];
                System.out.println(name + <span class="hljs-string">" - "</span> + age);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-13">原生SQL查询详细解释</h3>
<ol>
<li>
<p><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象供查询使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>查询所有Person记录</strong>：使用原生SQL查询所有Person记录并映射为<code>Person</code>实体。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateNativeQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用原生SQL查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝被找回！MJJ必修课：Outlook邮箱交易后的“防回手”安全设置全攻略]]></title>    <link>https://juejin.cn/post/7593338828195233832</link>    <guid>https://juejin.cn/post/7593338828195233832</guid>    <pubDate>2026-01-09T13:43:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593338828195233832" data-draft-id="7593193235251216436" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝被找回！MJJ必修课：Outlook邮箱交易后的“防回手”安全设置全攻略"/> <meta itemprop="keywords" content="服务器"/> <meta itemprop="datePublished" content="2026-01-09T13:43:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝被找回！MJJ必修课：Outlook邮箱交易后的“防回手”安全设置全攻略
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:43:03.000Z" title="Fri Jan 09 2026 13:43:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">拒绝被找回！MJJ必修课：Outlook邮箱交易后的“防回手”安全设置全攻略</h2>
<p>在MJJ的日常交易中，遵循“一机一号”的祖训，Outlook凭借其高风控阈值和广泛的接受度，始终稳坐交易市场的头把交椅。</p>
<p>但是，买来的号总是心惊胆战？担心卖家留了后门随时“回手掏”？</p>
<p>别慌，只要按照这篇教程的<strong>三个核心步骤</strong>操作，就能把账号彻底清洗干净，变成你自己的私有财产。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/351c3ffc076f47719b46f4c491fe67e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=XdkTbu9V3mIQCcYNuSrapYxzqg0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">准备工作</h2>
<p>登录你的Outlook账号，进入 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Faccount.microsoft.com%2Fsecurity" target="_blank" title="https://account.microsoft.com/security" ref="nofollow noopener noreferrer">Microsoft 账户安全页面</a></strong>。</p>
<blockquote>
<p><strong>高危预警</strong>：在进行以下操作前，请确保你当前的网络环境相对稳定，最好使用浏览器的隐私模式登录，避免缓存冲突。</p>
</blockquote>
<h2 data-id="heading-2">第一步：清洗辅助验证方式</h2>
<p>这是最基础也是最容易被忽视的一步。很多时候你改了密码，卖家却能通过预留的辅助邮箱轻松重置。</p>
<p><strong>操作逻辑：</strong> 先加后删。确保手里有粮，心中不慌。</p>
<ul>
<li>点击 <strong>“高级安全选项” (Advanced security options)</strong>。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72a1c40439954dbda99f400f498be873~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=H4xgaheWMWWQkdVRHwL1KdWH82w%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>仔细检查</strong>当前的辅助验证方式（手机号、备用邮箱）。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/767aef44bb984a778d680e710218c54d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=jYKGKYGTVmoZkSxpFHaliAn%2FIcA%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p><strong>添加自己的验证方式</strong>：</p>
</li>
<li>
<p>强烈建议添加<strong>邮箱</strong>作为辅助验证，操作方便且接收验证码稳定。</p>
</li>
<li>
<p><em>注意：如果账号当前只有一个辅助邮箱（卖家的），千万别急着删！一定要先添加并验证你自己的邮箱，成功上位后，再把卖家的踢掉。</em></p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5ec71484b9e45f3a587a5900c7b6dca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=Gc6g9Dy7MfwqXsBrWQ4XL2E8bCU%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>添加完成后</strong>，果断删除所有不属于你的邮箱和手机号。</li>
</ul>
<h2 data-id="heading-3">第二步：重置安全恢复码</h2>
<p>很多人改了密码、换了手机号，最后还是被找回了，为什么？因为你漏掉了Outlook的“尚方宝剑”——<strong>恢复代码（Recovery Code）</strong>。</p>
<h3 data-id="heading-4">为什么必须重置它？</h3>
<p>Outlook的恢复代码是一串25位的随机字符。它是账户的<strong>最后一道防线</strong>。哪怕没有密码、没有手机验证码，拥有这串代码的人可以直接绕过所有验证，强行重置账户。</p>
<p><strong>风险点</strong>：如果前号主保留了之前的恢复代码，他随时可以“复活”并接管账号。</p>
<h3 data-id="heading-5">如何操作？</h3>
<ul>
<li>在“高级安全选项”页面，向下拉，找到 <strong>“恢复代码” (Recovery code)</strong> 区域。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/058cea4ff65a478aa46a329e261f45cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=VS5Rws8Sc3d7uiOzrc%2BGkFcS0fc%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>点击 <strong>“生成新代码” (Generate new code)</strong> 或 <strong>“替换”</strong>。</p>
</li>
<li>
<p><strong>系统逻辑</strong>：当你生成新代码的瞬间，<strong>旧的代码会立即失效</strong>。这意味着前号主手里的那个备份彻底变成了废纸。</p>
</li>
<li>
<p><strong>保存新代码</strong>：系统会显示一个新的25位代码（如 <code>XXXXX-XXXXX-...</code>）。</p>
</li>
<li>
<p><em>建议：截图保存或抄写下来，存放在本地安全的地方，不要只保存在网盘或邮箱里。</em></p>
</li>
</ul>
<h2 data-id="heading-6">第三步：踢掉所有登入设备</h2>
<p>改完所有设置后，如果卖家的电脑或手机还保持着登录状态（Cookie/Session未失效），他依然有机会在你眼皮底下查看验证码或进行破坏。</p>
<ul>
<li>在“高级安全选项”页面下方，找到 <strong>“注销我” (Sign me out)</strong> 或 <strong>“注销所有位置”</strong>。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3773885afb0c4fedb09add7a1ce0a658~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=op1vPNzcG37lu6VN6EplBvJ%2Bqc0%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>点击确认。</p>
</li>
<li>
<p><em>备注：微软官方提示该操作可能需要24小时生效，但实测通常几分钟内就会把所有设备（包括你自己当前的设备）全部强制下线。</em></p>
</li>
</ul>
<h2 data-id="heading-7">第四步：修改登录密码</h2>
<p>做完以上三个“大手术”后，账号已经基本安全。最后一步，为了仪式感和绝对的安全：</p>
<ul>
<li>去修改一个高强度的<strong>登录密码</strong>。</li>
<li>重新登录你的账号，享受完全掌控的快感。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/343d74b03e2c4feabb8c7a223e7a23f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768570983&amp;x-signature=PfG2SSs%2F1iJ5N3l7cXVHsdV9b4w%3D" alt="" loading="lazy"/></p>
<p>总结与防坑小贴士</p>
<ol>
<li><strong>顺序不能乱</strong>：建议按 <strong>添加自己邮箱 → 删别人邮箱 → 重置恢复码 → 踢设备 → 改密码</strong> 的顺序操作。</li>
<li><strong>风控注意</strong>：如果账号IP变动极其剧烈，连续修改安全设置可能会触发微软的30天安全挂起期（Security wait period）。如果遇到提示需等待30天，说明账号被风控，此时账号仍可登录但无法修改安全信息，建议挂机养号几天再试。</li>
<li><strong>双重验证(2FA)</strong>：如果条件允许，建议绑定微软自家的 Authenticator App，安全性远高于短信验证。</li>
</ol>
<p>做完这套流程，你的Outlook账号就像穿了防弹衣，除了你没人能进得去！</p>
<p><em>如果有遗漏的细节或遇到特殊的风控情况，欢迎在评论区补充交流！</em></p>
<h3 data-id="heading-8">如果觉得文章好，可以关注<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.legacyvps.com%2F" target="_blank" title="https://www.legacyvps.com/" ref="nofollow noopener noreferrer">传家宝VPS</a></h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（32）什么是Hibernate的Criteria查询？]]></title>    <link>https://juejin.cn/post/7592990758476759059</link>    <guid>https://juejin.cn/post/7592990758476759059</guid>    <pubDate>2026-01-09T13:49:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592990758476759059" data-draft-id="7593145583348121642" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（32）什么是Hibernate的Criteria查询？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-09T13:49:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（32）什么是Hibernate的Criteria查询？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:49:00.000Z" title="Fri Jan 09 2026 13:49:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernate的Criteria查询</h3>
<p>Hibernate的Criteria查询是一种面向对象的查询方式，它允许开发者以编程方式构建查询，而不是直接编写HQL或SQL语句。它的主要特点包括：</p>
<ul>
<li><strong>类型安全</strong>：编译时检查可以捕捉到错误。</li>
<li><strong>面向对象</strong>：使用Java对象和方法来构建查询。</li>
<li><strong>动态生成</strong>：可以在运行时动态生成查询，而不是在编译时固定查询。</li>
</ul>
<h3 data-id="heading-1">使用Criteria查询</h3>
<p>在Hibernate 5之前，Criteria API是通过<code>org.hibernate.Criteria</code>接口实现的。在Hibernate 5及之后，Criteria API被重新设计为JPA的Criteria API（<code>javax.persistence.criteria</code>）。</p>
<h3 data-id="heading-2">示例代码</h3>
<h4 data-id="heading-3">实体类定义</h4>
<p>继续使用之前定义的<code>Person</code>和<code>Address</code>实体类。</p>
<h5 data-id="heading-4">Person类</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters 和 Setters</span>

    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-5">Hibernate配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">HibernateUtil类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h3 data-id="heading-7">使用Criteria查询示例</h3>
<h4 data-id="heading-8">插入示例数据</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-9">使用Criteria查询</h4>
<h5 data-id="heading-10">查询所有Person记录</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;

<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCriteriaQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用Criteria查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAllPersons</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">HibernateCriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            JpaCriteriaQuery&lt;Person&gt; criteriaQuery = criteriaBuilder.createQuery(Person.class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);
            criteriaQuery.select(root);

            List&lt;Person&gt; persons = session.createQuery(criteriaQuery).getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-11">使用条件查询</h5>
<p>假设我们想查询年龄大于25岁的Person。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.HibernateCriteriaBuilder;
<span class="hljs-keyword">import</span> org.hibernate.query.criteria.JpaCriteriaQuery;

<span class="hljs-keyword">import</span> javax.persistence.criteria.Root;
<span class="hljs-keyword">import</span> javax.persistence.criteria.Predicate;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCriteriaConditionalQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用Criteria条件查询</span>
        queryPersonsByAge(sessionFactory, <span class="hljs-number">25</span>);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryPersonsByAge</span><span class="hljs-params">(SessionFactory sessionFactory, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">HibernateCriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            JpaCriteriaQuery&lt;Person&gt; criteriaQuery = criteriaBuilder.createQuery(Person.class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);

            <span class="hljs-type">Predicate</span> <span class="hljs-variable">agePredicate</span> <span class="hljs-operator">=</span> criteriaBuilder.greaterThan(root.get(<span class="hljs-string">"age"</span>), age);
            criteriaQuery.select(root).where(agePredicate);

            List&lt;Person&gt; persons = session.createQuery(criteriaQuery).getResultList();
            System.out.println(<span class="hljs-string">"Query persons with age greater than "</span> + age + <span class="hljs-string">":"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() + <span class="hljs-string">" - "</span> + person.getAge());
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-12">Criteria查询详细解释</h3>
<ol>
<li>
<p><strong>插入示例数据</strong>：向数据库中插入两个<code>Person</code>对象供查询使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateInsertData</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 插入示例数据</span>
        insertSampleData(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSampleData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">28</span>);

            session.save(person1);
            session.save(person2);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted sample data"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
</li>
<li>
<p><strong>查询所有Person记录</strong>：使用Criteria查询所有Person记录。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCriteriaQueryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// 使用Criteria查询所有Person记录</span>
        queryAllPersons(sessionFactory);

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryAllPersons</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">HibernateCriteriaBuilder</span> <span class="hljs-variable">criteriaBuilder</span> <span class="hljs-operator">=</span> session.getCriteriaBuilder();
            JpaCriteriaQuery&lt;Person&gt; criteriaQuery = criteriaBuilder.createQuery(Person.class);
            Root&lt;Person&gt; root = criteriaQuery.from(Person.class);
            criteriaQuery.select(root);

            List&lt;Person&gt; persons = session.createQuery(criteriaQuery).getResultList();
            System.out.println(<span class="hljs-string">"Query all persons:"</span>);
            <span class="hljs-keyword">for</span> (Person person : persons) {
                System.out.println(person.getName() );
</code></pre>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TIOBE 公布 C# 是 2025 年度编程语言]]></title>    <link>https://juejin.cn/post/7593145583348154410</link>    <guid>https://juejin.cn/post/7593145583348154410</guid>    <pubDate>2026-01-09T13:50:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593145583348154410" data-draft-id="7593145583348138026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TIOBE 公布 C# 是 2025 年度编程语言"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2026-01-09T13:50:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TIOBE 公布 C# 是 2025 年度编程语言
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T13:50:40.000Z" title="Fri Jan 09 2026 13:50:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>TIOBE 公布的数据显示，C# 以 2.94% 的年度最大涨幅再度获评<code>2025 年度编程语言</code>，在近三年内，C# 第二次被 TIOBE 指数评为<code>年度编程语言</code>。这一荣誉授予了在年度排名中涨幅最大的编程语言，而 C# 正是凭借这一最大增幅获此殊荣。</p>
<p>多年来，C# 经历了根本性的变革：从语言设计的角度来看，它常常是主流编程语言中率先采纳新趋势的先行者。与此同时，C# 成功实现了两次重大转型：一是从仅限 Windows 平台转向跨平台支持，二是从微软专属走向开源。C# 总能在关键时刻及时演进，持续保持活力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9efab1720cfb4a098214fc1bc9a19002~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=56IL1QkVj62Pi5L73pwiu9Cr0Ng%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">TIOBE 介绍</h2>
<p>TIOBE 是一个编程社区指数，用于衡量不同编程语言的受欢迎程度。TIOBE 指数基于全球范围内熟练工程师数量、课程和第三方供应商等多个因素进行评估。指数每月更新一次，并使用一系列流行搜索引擎（如Google、必应、雅虎、维基百科、亚马逊、YouTube 和百度等）来计算编程语言的相关搜索结果和讨论量等数据。需要注意的是，TIOBE指数并不代表“最佳”编程语言，也不是指“代码行数最多”的语言。</p>
<h2 data-id="heading-2">TIOBE 编程语言评分排行榜</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92c779c82b854290816f4396cc320533~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=hCQs6c6Gzbu0Y0Ps%2FXEYhXm1XDM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">TIOBE 编程社区指数</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31112bd0097c4660b1272fdf21a1b1a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=KdGoNORKkJlLIuwx1kEnyD%2BCnNc%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">编程语言名人堂</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daacdb4c6e8242a78563e6fbeb56ab1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=bf6rUUACsxZKLI3ynVuQW4v5S5Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">C# 14 新增的一些功能</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flearn.microsoft.com%2Fzh-cn%2Fdotnet%2Fcsharp%2Fwhats-new%2Fcsharp-14" target="_blank" title="https://learn.microsoft.com/zh-cn/dotnet/csharp/whats-new/csharp-14" ref="nofollow noopener noreferrer">learn.microsoft.com/zh-cn/dotne…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d072ec259f374da79a919240c05a54f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=wUSBMB9X3hRndwbmAWNMPAZ5wg4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">.NET 10 正式发布</h2>
<p>.NET 团队于 2025 年 11 月 11 日宣布 .NET 10 正式发布，这是迄今为止最高效、最现代、最安全、最智能且性能最高的 .NET 版本。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c979d7cb5a04cf0bcef7a6b36a09951~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=cKvrDewsmjUqjqQ6ef%2FXF8gykh8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/795eebe014c24ae2b0033a8512e9104c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=IlShUQwb6ShlcOHMfdJZ%2BbrORfM%3D" alt="" loading="lazy"/></p>
<p>.NET 10 是一个长期支持版本（LTS） ，将支持三年 ，直至 2028 年 11 月 10 日。我们强烈建议生产环境中的应用程序升级到 .NET 10，以便享受更长的支持周期、显著的性能提升以及众多新功能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ec524c0f9b64bc99db0dc14ac9ebef4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=cpkwTi1BWbSltzksruzMkp2ICNw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">.NET 让构建 AI 驱动的应用变得简单直接</h2>
<p>.NET 让构建 AI 驱动的应用变得简单直接，无论是轻量级集成还是复杂的多智能体系统都能轻松应对。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6da089f82e8045ecbbb398c50e0950e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=cDembuQ%2FJC%2FFyM6IQyh%2BSxVWD0w%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">Microsoft 代理框架：构建智能多代理系统</h3>
<p>Microsoft 代理框架通过将语义内核和 AutoGen 的优点结合到统一体验中，简化了智能代理 AI 系统的构建。无论您是构建单个 AI 代理还是协调多个代理协同工作，该框架都能提供您所需的模式和基础设施。</p>
<ul>
<li>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fagent-framework" target="_blank" title="https://github.com/microsoft/agent-framework" ref="nofollow noopener noreferrer">github.com/microsoft/a…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a1f1f9bd5404a859ccbf778af773579~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=4rknz7UhUdiZl%2B8tCYTA3SPpHwQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">人工智能应用的统一构建模块</h3>
<p><code>Microsoft.Extensions.AI</code> 和 <code>Microsoft.Extensions.VectorData</code> 提供统一的抽象，用于将 AI 服务集成到您的应用程序中。IChatClient 接口通过一致的 API 与任何提供程序（OpenAI、Azure OpenAI、GitHub Models、Ollama）配合使用，从而可以轻松切换提供程序或支持多个后端，而无需重写代码。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5750b0dd079b4a6e83eefdc566c8244f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=qGdSGXp6cQup8yooeR1D4Ss0DKQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">.NET 提供一流的 MCP 支持</h3>
<p>.NET 提供对 Model Context Protocol（MCP，模型上下文协议） 的一流支持，让 AI 智能体能够通过标准化方式连接外部工具和服务。MCP 使 AI 智能体可以访问数据源、API 和各种工具，从而显著提升其能力和适用场景的多样性。</p>
<ul>
<li>C# MCP SDK：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelcontextprotocol%2Fcsharp-sdk" target="_blank" title="https://github.com/modelcontextprotocol/csharp-sdk" ref="nofollow noopener noreferrer">github.com/modelcontex…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/812d793e7d804298a82435ced941c698~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=uPUD5dHJGpCPNyHrXfCqoREwRzM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-11">C#/.NET/.NET Core学习、工作、面试指南</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49f7c96db26c44b99ddb009725ca2f6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768571440&amp;x-signature=wPR4hGqvcs%2FSk7vHiSC0q4HJsvk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">参考文章</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftiobe.org.cn%2Ftiobe-index" target="_blank" title="https://tiobe.org.cn/tiobe-index" ref="nofollow noopener noreferrer">tiobe.org.cn/tiobe-index</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.tiobe.com%2Ftiobe-index" target="_blank" title="https://www.tiobe.com/tiobe-index" ref="nofollow noopener noreferrer">www.tiobe.com/tiobe-index</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink源码阅读：Netty通信]]></title>    <link>https://juejin.cn/post/7593164154631815177</link>    <guid>https://juejin.cn/post/7593164154631815177</guid>    <pubDate>2026-01-09T12:13:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7593164154631815177" data-draft-id="7593164154631798793" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink源码阅读：Netty通信"/> <meta itemprop="keywords" content="Flink,大数据"/> <meta itemprop="datePublished" content="2026-01-09T12:13:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink源码阅读：Netty通信
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-09T12:13:27.000Z" title="Fri Jan 09 2026 12:13:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前文中我们了解了 Flink 的数据交互过程，上游的 Task 将数据写入到 ResultSubpartition 的 buffers 队列中。下游的 Task 通过 LocalInputChannel 和 RemoteInputChannel 消费上游的数据。</p>
<p>LocalInputChannel 是上下游的 Task 部署在同一个 TaskManager 时使用的，在本地即可完成数据交换，无需网络通信。当上下游的 Task 部署在不同的 TaskManager 时，就需要用到 RemoteInputChannel，Flink 利用 Netty 来进行数据交互。本文我们来一起梳理一下 Netty 相关的源码。</p>
<h3 data-id="heading-0">初始化</h3>
<p>我们先来看 NettyServer 和 NettyClient 的初始化过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ba4706fbb604cc5884638aaad02c95b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=ro8kY7ZVGC%2BQRjha4Mu06IgMWMI%3D" alt="NettyInit" loading="lazy"/></p>
<p>Netty 的初始化阶段是在 TaskManager 启动的过程中执行的。在 <code>TaskManagerServices.fromConfiguration</code> 方法中，会创建并启动 ShuffleEnvironment。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> TaskManagerServices <span class="hljs-title function_ invoke__">fromConfiguration</span>(
        TaskManagerServicesConfiguration taskManagerServicesConfiguration,
        PermanentBlobService permanentBlobService,
        MetricGroup taskManagerMetricGroup,
        ExecutorService ioExecutor,
        ScheduledExecutor scheduledExecutor,
        FatalErrorHandler fatalErrorHandler,
        WorkingDirectory workingDirectory)
        throws <span class="hljs-built_in">Exception</span> {
    ...

    <span class="hljs-keyword">final</span> ShuffleEnvironment<span class="hljs-meta">&lt;?</span>, <span class="hljs-meta">?&gt;</span> shuffleEnvironment =
            <span class="hljs-title function_ invoke__">createShuffleEnvironment</span>(
                    taskManagerServicesConfiguration,
                    taskEventDispatcher,
                    taskManagerMetricGroup,
                    ioExecutor,
                    scheduledExecutor);
    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> listeningDataPort = shuffleEnvironment.<span class="hljs-title function_ invoke__">start</span>();
    ...
}
</code></pre>
<p>我们顺着调用链路可以一直找到 <code>NettyShuffleServiceFactory.createNettyShuffleEnvironment</code> 方法，这个方法中创建了 NettyConnectionManager，在 NettyConnectionManager 中有几个很重要的对象。</p>
<pre><code class="hljs language-ini" lang="ini">public NettyConnectionManager(
        NettyBufferPool bufferPool,
        ResultPartitionProvider partitionProvider,
        TaskEventPublisher taskEventPublisher,
        NettyConfig nettyConfig,
        boolean connectionReuseEnabled) {

    <span class="hljs-attr">this.server</span> = new NettyServer(nettyConfig)<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.client</span> = new NettyClient(nettyConfig)<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.bufferPool</span> = checkNotNull(bufferPool)<span class="hljs-comment">;</span>

    <span class="hljs-attr">this.partitionRequestClientFactory</span> =
            new PartitionRequestClientFactory(
                    client, nettyConfig.getNetworkRetries(), connectionReuseEnabled)<span class="hljs-comment">;</span>

    <span class="hljs-attr">this.nettyProtocol</span> =
            new NettyProtocol(
                    checkNotNull(partitionProvider), checkNotNull(taskEventPublisher))<span class="hljs-comment">;</span>
}
</code></pre>
<p>server 和 client 不需要多介绍，就是 Netty 的服务端和客户端。bufferPool 是缓冲池，用于存储要传输的数据。nettyProtocol 提供了 NettyClient 和 NettyServer 引导启动注册的 Channel Handler。</p>
<p>后面就是创建 NettyShuffleEnvironment 及其需要的对象了。在创建完成后，会调用它的 start 方法启动。这个启动方法就是调用了 <code>connectionManager.start</code>，在 NettyConnectionManager 中，就是初始化客户端和服务端。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">start</span>() throws IOException</span> {
    client.<span class="hljs-keyword">init</span>(nettyProtocol, bufferPool);

    <span class="hljs-keyword">return</span> server.<span class="hljs-keyword">init</span>(nettyProtocol, bufferPool);
}
</code></pre>
<h4 data-id="heading-1">client 初始化</h4>
<p>client 的初始化过程是先创建并初始化 Bootstrap。</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">initEpollBootstrap</span>() {
    <span class="hljs-comment">// Add the server port number to the name in order to distinguish</span>
    <span class="hljs-comment">// multiple clients running on the same host.</span>
    String name =
            NettyConfig<span class="hljs-selector-class">.CLIENT_THREAD_GROUP_NAME</span> + " (" + config.getServerPortRange() + ")";

    EpollEventLoopGroup epollGroup =
            new <span class="hljs-built_in">EpollEventLoopGroup</span>(
                    config.getClientNumThreads(), NettyServer<span class="hljs-selector-class">.getNamedThreadFactory</span>(name));
    bootstrap<span class="hljs-selector-class">.group</span>(epollGroup)<span class="hljs-selector-class">.channel</span>(EpollSocketChannel.class);

    config<span class="hljs-selector-class">.getTcpKeepIdleInSeconds</span>()
            <span class="hljs-selector-class">.ifPresent</span>(idle -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPIDLE, idle));
    config<span class="hljs-selector-class">.getTcpKeepInternalInSeconds</span>()
            <span class="hljs-selector-class">.ifPresent</span>(
                    interval -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPINTVL, interval));
    config<span class="hljs-selector-class">.getTcpKeepCount</span>()
            <span class="hljs-selector-class">.ifPresent</span>(count -&gt; bootstrap.option(EpollChannelOption.TCP_KEEPCNT, count));
}
</code></pre>
<p>初始化过程重要设置 EventLoopGroup 和 channel，可以用 epoll 的话就用 epoll，否则就用 nio。设置好这些后就是设置了一些通道参数（连接超时时间、Bufffer 池等）。</p>
<p>到这里 client 的初始化其实并没有结束，还需要设置 Handler 流水线，这些工作是在 Task 启动时执行了。</p>
<h4 data-id="heading-2">server 初始化</h4>
<p>server 的初始化过程是先创建并初始化了 ServerBootstrap。之后同样也是设置 EventLoopGroup 和 channel，以及通道相关的各种参数。</p>
<p>设置好之后，会添加 ChannelHandler 流水线，这里的 ChannelHandler 流水线就是我们前面创建的 NettyProtocol 提供的。</p>
<pre><code class="hljs language-ini" lang="ini">public ChannelHandler<span class="hljs-section">[]</span> getServerChannelHandlers() {
    PartitionRequestQueue <span class="hljs-attr">queueOfPartitionQueues</span> = new PartitionRequestQueue()<span class="hljs-comment">;</span>
    PartitionRequestServerHandler <span class="hljs-attr">serverHandler</span> =
            new PartitionRequestServerHandler(
                    partitionProvider, taskEventPublisher, queueOfPartitionQueues)<span class="hljs-comment">;</span>

    return new ChannelHandler<span class="hljs-section">[]</span> {
        messageEncoder,
        new NettyMessage.NettyMessageDecoder(),
        serverHandler,
        queueOfPartitionQueues
    }<span class="hljs-comment">;</span>
}
</code></pre>
<p>流水线上包含了消息编码器、解码器、PartitionRequestServerHandler 请求服务端处理器和 PartitionRequestQueue 分区请求队列。</p>
<p>这些都设置好之后，就开始启动 NettyServer 服务了。</p>
<pre><code class="hljs language-scss" lang="scss">Iterator&lt;Integer&gt; portsIterator = config<span class="hljs-selector-class">.getServerPortRange</span>()<span class="hljs-selector-class">.getPortsIterator</span>();
while (portsIterator.hasNext() &amp;&amp; bindFuture == null) {
    Integer port = portsIterator<span class="hljs-selector-class">.next</span>();
    LOG<span class="hljs-selector-class">.debug</span>("Trying to bind Netty server to port: {}", port);

    bootstrap<span class="hljs-selector-class">.localAddress</span>(config.getServerAddress(), port);
    try {
        bindFuture = bootstrap<span class="hljs-selector-class">.bind</span>()<span class="hljs-selector-class">.syncUninterruptibly</span>();
    } catch (Exception e) {
        <span class="hljs-comment">// syncUninterruptibly() throws checked exceptions via Unsafe</span>
        <span class="hljs-comment">// continue if the exception is due to the port being in use, fail early</span>
        <span class="hljs-comment">// otherwise</span>
        if (isBindFailure(e)) {
            LOG<span class="hljs-selector-class">.debug</span>("Failed to bind Netty server", e);
        } else {
            throw e;
        }
    }
}

if (bindFuture == null) {
    throw new <span class="hljs-built_in">BindException</span>(
            "Could not start rest endpoint on any port in port range "
                    + config.getServerPortRange());
}

localAddress = (InetSocketAddress) bindFuture<span class="hljs-selector-class">.channel</span>()<span class="hljs-selector-class">.localAddress</span>();
</code></pre>
<h3 data-id="heading-3">客户端请求远端子分区</h3>
<p>服务端和客户端初始化之后，在 Task 运行时，会先完成 Client 的 ChannelHandler 的配置，然后请求 Netty 远端服务。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b99d38c65200487f8f5f1d7e05cc2b36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=7ig7BNFyUGozffh2yuryKQkj%2FHo%3D" alt="NettyRequestPartition" loading="lazy"/></p>
<p>我们来看具体过程，在 Task 初始化时，会调用 <code>StreamTask.invoke</code> 方法，其内部会调用 <code>StreamTask.restoreStateAndGate</code> 方法，这里会便利 Task 的所有 InputGate，然后调用 requestPartitions。在 InputGate 的 requestPartitions 逻辑中，又便利所有的 InputChannel，调用 requestSubpartitions。</p>
<pre><code class="hljs language-scss" lang="scss">for (InputGate inputGate : inputGates) {
    recoveredFutures<span class="hljs-selector-class">.add</span>(inputGate.getStateConsumedFuture());

    inputGate
            <span class="hljs-selector-class">.getStateConsumedFuture</span>()
            <span class="hljs-selector-class">.thenRun</span>(
                    () -&gt;
                            mainMailboxExecutor<span class="hljs-selector-class">.execute</span>(
                                    inputGate::requestPartitions,
                                    "Input gate request partitions"));
}


private void <span class="hljs-built_in">internalRequestPartitions</span>() {
    for (InputChannel inputChannel : inputChannels()) {
        try {
            inputChannel<span class="hljs-selector-class">.requestSubpartitions</span>();
        } catch (Throwable t) {
            inputChannel<span class="hljs-selector-class">.setError</span>(t);
            return;
        }
    }
}
</code></pre>
<p>我们来看 <code>RemoteInputChannel.requestSubpartitions</code> 的逻辑。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">requestSubpartitions</span>() throws IOException, InterruptedException</span> {
    <span class="hljs-keyword">if</span> (partitionRequestClient == <span class="hljs-literal">null</span>) {
        LOG.debug(
                <span class="hljs-string">"{}: Requesting REMOTE subpartitions {} of partition {}. {}"</span>,
                <span class="hljs-keyword">this</span>,
                consumedSubpartitionIndexSet,
                partitionId,
                channelStatePersister);
        <span class="hljs-comment">// Create a client and request the partition</span>
        <span class="hljs-keyword">try</span> {
            partitionRequestClient =
                    connectionManager.createPartitionRequestClient(connectionId);
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-comment">// IOExceptions indicate that we could not open a connection to the remote</span>
            <span class="hljs-comment">// TaskExecutor</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> PartitionConnectionException(partitionId, e);
        }

        partitionRequestClient.requestSubpartition(
                partitionId, consumedSubpartitionIndexSet, <span class="hljs-keyword">this</span>, <span class="hljs-number">0</span>);
    }
}
</code></pre>
<p>这里主要有两个步骤，先是创建 partitionRequestClient，然后调用 requestSubpartition。</p>
<h4 data-id="heading-4">创建请求客户端</h4>
<p>PartitionRequestClient 是在 <code>PartitionRequestClientFactory.connect</code> 中创建的。先调用了 <code>NettyClient.connect</code>，同步等待客户端连接到服务端，这个过程中会进行 ChannelHandler 配置，也就是我们在初始化的过程中介绍的，NettyClient 没有完成的步骤。</p>
<pre><code class="hljs language-scss" lang="scss">public ChannelHandler<span class="hljs-selector-attr">[]</span> <span class="hljs-built_in">getClientChannelHandlers</span>() {
    NetworkClientHandler networkClientHandler = new <span class="hljs-built_in">CreditBasedPartitionRequestClientHandler</span>();

    return new ChannelHandler<span class="hljs-selector-attr">[]</span> {
        messageEncoder,
        new <span class="hljs-built_in">NettyMessageClientDecoderDelegate</span>(networkClientHandler),
        networkClientHandler
    };
}
</code></pre>
<p>Handler 包括了消息编码器、解码器和 CreditBasedPartitionRequestClientHandler 这个基于 Credit 的分区请求客户端处理器。Handler 配置好之后会利用 bootstrap 连接到服务端。</p>
<p>在获取到 Channel 和 NetworkClientHandler 之后，就直接创建了 NettyPartitionRequestClient。</p>
<h4 data-id="heading-5">请求子分区数据</h4>
<p>让我们再回到 RemoteInputChannel 的 requestSubpartitions 方法中，现在我们创建好了 NettyPartitionRequestClient，接下来就是调用它的 requestSubpartition 方法来发起请求。</p>
<p>这里逻辑也比较简单：</p>
<ol>
<li>向 NetworkClientHandler 注册当前 RemoteInputChannel。</li>
<li>构造请求对象 PartitionRequest，这里包含了分区 ID、子分区索引、inputChannel ID 以及初识的 Credit。</li>
<li>调用 <code>tcpChannel.writeAndFlush</code> 发起请求，并添加请求失败的监听。</li>
<li>如果请求失败，移除当前 inputChannel。</li>
</ol>
<h3 data-id="heading-6">服务端响应</h3>
<p>现在数据到了服务端，我们来看服务端处理的具体过程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/339a67c8d7c64865bc109c665e60c60c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=xpUm9gskdJn323LGxtvTmcAThSc%3D" alt="NettyServerHandler" loading="lazy"/></p>
<p>在 NettyServer 初始化的过程中，我们添加了两个重要的 Handler，分别是 PartitionRequestServerHandler 和 PartitionRequestQueue。服务端响应数据的过程就是这两个 Handler 在发挥作用。</p>
<p>PartitionRequestServerHandler 负责处理 Client 端通过 PartitionRequestClient 发送的请求，处理过程是先创建 CreditBasedSequenceNumberingViewReader 类型的 reader，然后将它放入 PartitionRequestQueue 维护的 reader 队列中。PartitionRequestQueue 会监听 Netty Channel 的可写入状态，当 Netty Channel 可写入时，会消费数据并写入网络。</p>
<p>下面我们来看具体的源码。</p>
<p>服务端的响应入口在 <code>PartitionRequestServerHandler.channelRead0</code> 方法，这里在处理 PartitionRequest 请求时，先是创建 CreditBasedSequenceNumberingViewReader，然后调用 requestSubpartitionViewOrRegisterListener。</p>
<p>requestSubpartitionViewOrRegisterListener 的逻辑是创建 ResultSubpartitionView，并提醒 PartitionRequestQueue 有数据可用。</p>
<pre><code class="hljs language-ini" lang="ini">Optional&lt;ResultSubpartitionView&gt; <span class="hljs-attr">subpartitionViewOptional</span> =
        partitionProvider.createSubpartitionViewOrRegisterListener(
                resultPartitionId,
                subpartitionIndexSet,
                this,
                partitionRequestListener)<span class="hljs-comment">;</span>
...

notifyDataAvailable(subpartitionView)<span class="hljs-comment">;</span>
</code></pre>
<p>ResultSubpartitionView 就是用来消费 ResultSubpartition 的数据。</p>
<p>notifyDataAvailable 内部调用了 notifyReaderNonEmpty，notifyReaderNonEmpty 又触发了 userEventTriggered，这里调用 enqueueAvailableReader 将 reader 放入到可用队列 availableReaders 中。</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">enqueueAvailableReader</span>(final NetworkSequenceViewReader reader) throws Exception {
    if (reader.isRegisteredAsAvailable()) {
        return;
    }

    ResultSubpartitionView<span class="hljs-selector-class">.AvailabilityWithBacklog</span> availabilityWithBacklog =
            reader<span class="hljs-selector-class">.getAvailabilityAndBacklog</span>();
    if (!availabilityWithBacklog.isAvailable()) {
        int backlog = availabilityWithBacklog<span class="hljs-selector-class">.getBacklog</span>();
        if (backlog &gt; <span class="hljs-number">0</span> &amp;&amp; reader.needAnnounceBacklog()) {
            <span class="hljs-built_in">announceBacklog</span>(reader, backlog);
        }
        return;
    }

    <span class="hljs-comment">// Queue an available reader for consumption. If the queue is empty,</span>
    <span class="hljs-comment">// we try trigger the actual write. Otherwise this will be handled by</span>
    <span class="hljs-comment">// the writeAndFlushNextMessageIfPossible calls.</span>
    boolean triggerWrite = availableReaders<span class="hljs-selector-class">.isEmpty</span>();
    <span class="hljs-built_in">registerAvailableReader</span>(reader);

    if (triggerWrite) {
        <span class="hljs-built_in">writeAndFlushNextMessageIfPossible</span>(ctx.channel());
    }
}
</code></pre>
<p>如果 reader 是队列中的第一个元素，会触发数据写入网络。</p>
<p>writeAndFlushNextMessageIfPossible 的处理步骤如下：</p>
<ol>
<li>取出可用 reader。</li>
<li>调用 <code>reader.getNextBuffer</code> 获取数据。</li>
<li>如果 reader 仍然可用，将其加回队列。</li>
<li>向下游写入数据并添加下次写入的监听。</li>
</ol>

<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> BufferAndAvailability <span class="hljs-title function_">getNextBuffer</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-type">BufferAndBacklog</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> subpartitionView.getNextBuffer();
    <span class="hljs-keyword">if</span> (next != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (next.buffer().isBuffer() &amp;&amp; --numCreditsAvailable &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"no credit available"</span>);
        }

        <span class="hljs-keyword">final</span> Buffer.<span class="hljs-type">DataType</span> <span class="hljs-variable">nextDataType</span> <span class="hljs-operator">=</span> getNextDataType(next);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferAndAvailability</span>(
                next.buffer(), nextDataType, next.buffersInBacklog(), next.getSequenceNumber());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p>在 getNextBuffer 方法中，会将 credit 值减 1，并判断是否小于 0。如果小于 0 会抛出异常，reader 是否可用也是根据 numCreditsAvailable 是否大于 0 来判断的。</p>
<h3 data-id="heading-7">客户端接收数据</h3>
<p>NettyClient 在消费数据时，同样也是以 ChannelHandler 作为入口。这里的入口方法是 <code>CreditBasedPartitionRequestClientHandler.channelRead</code> 。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e3e211ea7d445e8a040cfd2e5bac1dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=QzLjqwFQqFXMQxN4wlfezdFTli4%3D" alt="NettyClientHandler" loading="lazy"/></p>
<p>在 decodeMsg 方法中，先解码 msg，判断 InputChannel 是否可用，如果不可用，则取消当前 InputChannel 的订阅。如果可用，继续调用 decodeBufferOrEvent 进行处理。decodeBufferOrEvent 的核心逻辑是调用 <code>RemoteInputChannel.onBuffer</code> 方法，将数据加入到 receivedBuffers 队列。</p>
<p>如果 receivedBuffers 队列在此之前处于空闲状态，会调用 notifyChannelNonEmpty，将当前 RemoteInputChannel 加入到 inputChannelsWithData 队列中，同时还会唤醒 inputChannelsWithData 上的阻塞线程，让 inputGate 可以消费 RemoteInputChannel 的数据。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> boolean <span class="hljs-title">queueChannelUnsafe</span>(<span class="hljs-params">InputChannel channel, boolean priority</span>)</span> {
    assert Thread.holdsLock(inputChannelsWithData);
    <span class="hljs-keyword">if</span> (channelsWithEndOfPartitionEvents.<span class="hljs-keyword">get</span>(channel.getChannelIndex())) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    final boolean alreadyEnqueued =
            enqueuedInputChannelsWithData.<span class="hljs-keyword">get</span>(channel.getChannelIndex());
    <span class="hljs-keyword">if</span> (alreadyEnqueued
            &amp;&amp; (!priority || inputChannelsWithData.containsPriorityElement(channel))) {
        <span class="hljs-comment">// already notified / prioritized (double notification), ignore</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 当前 inputChannel 加入到 inputChannelsWithData</span>
    inputChannelsWithData.<span class="hljs-keyword">add</span>(channel, priority, alreadyEnqueued);
    <span class="hljs-keyword">if</span> (!alreadyEnqueued) {
        enqueuedInputChannelsWithData.<span class="hljs-keyword">set</span>(channel.getChannelIndex());
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-comment">// 唤醒线程</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyDataAvailable</span>()</span> {
    availabilityMonitor.notifyAll();
    toNotify = inputGate.availabilityHelper.getUnavailableToResetAvailable();
}
</code></pre>
<p>如果客户端有积压，还需要根据积压申请 Buffer 并更新 Credit 值。这里申请的 buffer 数量为积压数量+初识 Credit 值。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSenderBacklog</span><span class="hljs-params">(<span class="hljs-type">int</span> backlog)</span> <span class="hljs-keyword">throws</span> IOException {
    notifyBufferAvailable(bufferManager.requestFloatingBuffers(backlog + initialCredit));
}
</code></pre>
<p>如果 RemoteInputChannel 没有足够的 buffer，则会向 LocalBufferPool 申请新的 buffer，如果申请不到，会加一个监听，等 LocalBufferPool 有空闲时再触发申请 buffer。</p>
<pre><code class="hljs language-ini" lang="ini">private int tryRequestBuffers() {
    assert Thread.holdsLock(bufferQueue)<span class="hljs-comment">;</span>

    int <span class="hljs-attr">numRequestedBuffers</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    while (bufferQueue.getAvailableBufferSize() &lt; numRequiredBuffers
            &amp;&amp; !isWaitingForFloatingBuffers) {
        BufferPool <span class="hljs-attr">bufferPool</span> = inputChannel.inputGate.getBufferPool()<span class="hljs-comment">;</span>
        Buffer <span class="hljs-attr">buffer</span> = bufferPool.requestBuffer()<span class="hljs-comment">;</span>
        if (buffer != null) {
            bufferQueue.addFloatingBuffer(buffer)<span class="hljs-comment">;</span>
            numRequestedBuffers++<span class="hljs-comment">;</span>
        } else if (bufferPool.addBufferListener(this)) {
            <span class="hljs-attr">isWaitingForFloatingBuffers</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
            break<span class="hljs-comment">;</span>
        }
    }
    return numRequestedBuffers<span class="hljs-comment">;</span>
}
</code></pre>
<p>当 RemoteInputChannel 申请到了需要的 buffer 之后，就会向 NettyServer 发送 AddCredit 消息，请求更新 Credit 值。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyCreditAvailable</span>() throws IOException</span> {
    checkPartitionRequestQueueInitialized();

    partitionRequestClient.notifyCreditAvailable(<span class="hljs-keyword">this</span>);
}


<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">notifyCreditAvailable</span>(<span class="hljs-params">RemoteInputChannel inputChannel</span>)</span> {
    sendToChannel(<span class="hljs-keyword">new</span> AddCreditMessage(inputChannel));
}
</code></pre>
<p>NettyServer 收到请求后，会将对应的 Credit 值进行更新。</p>
<pre><code class="hljs language-ini" lang="ini">else if (<span class="hljs-attr">msgClazz</span> == AddCredit.class) {
    AddCredit <span class="hljs-attr">request</span> = (AddCredit) msg<span class="hljs-comment">;</span>

    outboundQueue.addCreditOrResumeConsumption(
            request.receiverId, reader -&gt; reader.addCredit(request.credit))<span class="hljs-comment">;</span>
}

void addCreditOrResumeConsumption(
        InputChannelID receiverId, Consumer&lt;NetworkSequenceViewReader&gt; operation)
        throws Exception {
    if (fatalError) {
        return<span class="hljs-comment">;</span>
    }

    NetworkSequenceViewReader <span class="hljs-attr">reader</span> = obtainReader(receiverId)<span class="hljs-comment">;</span>

    operation.accept(reader)<span class="hljs-comment">;</span>
    enqueueAvailableReader(reader)<span class="hljs-comment">;</span>
}


public void addCredit(int creditDeltas) {
    numCreditsAvailable += creditDeltas<span class="hljs-comment">;</span>
}
</code></pre>
<p>此外，Flink 还有两种场景会更新 Credit 值。</p>
<p>一种是 LocalBufferPool 回收空闲 buffer 时，会将 buffer 分配给申请者，分配之后会调用对应 InputChannel 的 notifyBufferAvailable 方法通知更新 Credit。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91654d63dada40089adc39ddeaa32f16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=%2B6Q5%2FPKgLnUQeBSJ7%2BBwQflI7Ik%3D" alt="LocalBufferPool" loading="lazy"/></p>
<p>另一种是 RemoteInputChannel 独占的 buffer 队列释放 buffer 时，会触发 Credit 更新。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c5cb9fddc0d4e18802107951125230b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768565606&amp;x-signature=T4scDtDnWrMIvABCUiom8RV0bTQ%3D" alt="BufferManager" loading="lazy"/></p>
<h3 data-id="heading-8">反压</h3>
<p>通过前面的学习，我们其实已经理解了反压的机制了。当前 Flink 的反压就是通过 Credit 来实现反压的，如果下游数据处理速度慢，Credit 会被耗尽，上游也就不会继续处理和下发数据了。直到下游处理完成，有了空闲的 buffer，此时向上游反馈更新 Credit 值，上游就会继续处理数据。</p>
<h3 data-id="heading-9">总结</h3>
<p>最后我们总结一下，本文我们一起梳理了 Flink Netty 相关的源码。包括 NettyClient 和 NettyServer 的初始化，初始化过程中会创建一系列 ChannelHandler，之后利用这些Handler 处理数据，数据处理包括 Client 端的发送和接收消息，Server 端处理消息的过程。中间还穿插着 Credit 的处理。Flink 的反压逻辑就是依赖于 Credit 来实现的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>